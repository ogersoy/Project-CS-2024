# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The objective of this Technical Report is to investigate scenarios for co-
existence of subscription data pertaining to legacy system (EPS) with data
pertaining to the 5G system, when the HSS+UDM defined in Rel-15 is separated
and both UDM and HSS are independent, and will propose solutions to support
this deployment where necessary.
NOTE 1: The subscription data referred to by this Technical Report comprises
both static as well as dynamic data, including IMS, LCS, SMS data.
\- study diverse scenarios related to the storage of subscription data
including, but not limited to, those of common repository for subscription
data from EPS and 5GS, as well as separate repositories for EPS and 5GS
subscription data,
\- investigate the relevant procedures in TS 23.502 [2] (for e.g.
authentication, mobility, handover and procedures for IMS and SMS handling in
interworking between 5G system and EPS),
\- determine if there is a need for interaction between the consumers of EPS
and 5GS data, in the different interworking cases and deployment scenarios.
Existing procedures in TS 23.502 [2] shall not be impacted.
Provisioning aspects are outside this study.
Direct interactions between the EPS UDR and the 5GS UDR are out of the scope
of this TR (i.e. it is assumed that there is no direct interaction between
these two repositories).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.502: \"Procedures for the 5G System\".
[3] 3GPP TS 23.335: \"User Data Convergence (UDC); Technical realization and
information flows; Stage 2\".
[4] 3GPP TS 29.335: \"User Data Convergence (UDC); User data repository access
protocol over the Ud interface; Stage 3\".
[5] 3GPP TS 23.002: \"Network architecture\".
[6] 3GPP TS 23.501: \"System Architecture for the 5G System\".
[7] 3GPP TS 23.228: \"IP Multimedia Subsystem\".
[8] 3GPP TS 23.380: \"IMS Restoration Procedures\".
[9] 3GPP TS 29.505: \"5G System; Usage of the Unified Data Repository services
for Subscription Data\".
[10] 3GPP TS 29.228: \"IP Multimedia (IM) Subsystem Cx and Dx Interfaces;
Signalling flows and message contents\".
[11] 3GPP TS 29.328: \"IP Multimedia (IM) Subsystem Sh interface; Signalling
flows and message contents\".
[12] 3GPP TS 33.501: \"Security architecture and procedures for 5G System\".
[13] 3GPP TS 33.401: \"System Architecture Evolution (SAE) - Security
architecture\".
[14] 3GPP TS 23.794: \"Study on Enhanced IMS to 5GC Integration\".
[15] 3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service
description; Stage 2\".
[16] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[17] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[18] 3GPP TS 29.214: \"Policy and charging control over Rx reference point\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**5G Repository** : Repository hosting subscription data for 5G UEs.
**5GS UDR** : term used to identify the Unified Data Repository defined in TS
23.501 [6] (clause 4.2.5).
**EPS UDR** : term used to identify the User Data Repository defined in TS
23.335 [3] (clause 4.2.3).
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
5GC 5G Core
5GS 5G System
5GS UDR 5G Unified Data Repository
HSS FE Home Subscriber Server Front End
EPS Enhanced Packet core System
EPS UDR EPS User Data Repository
E-UTRAN Evolved Universal mobile telecommunications system Terrestrial Radio
Access Network
UDM Unified Data Management
# 4 Architectural Assumptions and Principles
## 4.1 Architectural Assumptions
The 5GS data storage architecture defined in TS 23.501 [6], for structured
data, is used as the baseline network architecture.
The User Data Convergence concept specified in TS 23.335 [3], is used for
reference to EPS/legacy system architecture for data storage, when layered
architecture is deployed (i.e. application front-end decoupled from data
repository using the standard interface Ud defined in TS 29.335 [4]).
The Home Subscriber Server (HSS) architecture specified in clause 4.1.1 of TS
23.002 [5], is used for reference to EPS/legacy system architecture for data
storage, when non-layered HSS architecture is deployed (i.e. monolithic
deployment where user data are stored within the entity itself (or in an
external entity via non-standard interfaces)).
## 4.2 Architectural Principles
In the UDC concept used for reference, HSS FE and EPS UDR defined in TS 23.335
[3] are assumed to interact for any data required by the study: no
standardization will be considered for the interface between HSS FE and EPS
UDR.
# 5 Key Issues
## 5.1 Key Issue 1: Interaction between UDM and HSS with separate repositories
### 5.1.1 Description
This key issue, which assumes the HSS is deployed using the UDC architecture
in TS 23.335 [3], is to study how the UDM and HSS with separate repositories
interact in the scenario that the HSS FE and UDM are separately deployed and
the user data of 5G and 4G/3G/2G are also stored separately in different
repositories (i.e. EPS UDR storing user data for 4G/3G/2G and IMS domains and
5GS UDR storing user data for 5G domain).
The interaction between UDM and HSS FE with separate repositories should be
based on specific procedures that require data from one to the other.
The solutions to this key issue need to:
\- Clarify what user data is involved for the interaction between UDM and HSS
FE with separate repositories;
\- Study the scenarios of interaction between UDM and HSS FE with separate
repositories, specifically:
\- IMS and 5GS interworking required for the following cases:
\- Terminating Access Domain Selection (T-ADS).
When requested by IMS, the HSS+UDM shall be able to query the serving AMF for
T-ADS related information (see clause 5.16.3.6 in TS 23.501 [6]).
\- P-CSCF Restoration
As defined in clause 5.8.4 in TS 23.380 [8], upon request by IMS when P-CSCF
failure is detected, the HSS+UDM shall send a P-CSCF restoration indication to
either the SMF serving the IMS PDU session for the UE or to the AMF serving
the UE.
\- Network Provided Location Information (NPLI).
As defined in clause Y.6 in TS 23.228 [7], an IMS AS can trigger the retrieval
of the user location and/or UE Time Zone information from the AMF via the
HSS+UDM.
\- EPS and 5GS interworking required for mobility cases from EPS to 5GS and
from 5GS to EPS, including the impacts on SMS handling.
\- Avoid the impact on existing procedures between HSS/UDM and the rest of the
network.
## 5.2 Key Issue 2: Supporting a common repository for both HSS and UDM
### 5.2.1 Description
This key issue studies network deployments where a common repository (acting
as EPS UDR and 5GS UDR) is shared between HSS and UDM, analyses the
interactions between the HSS, UDM, & common repository, and examines the
potential of shared data fields in the repository.
The solutions to this key issue need to:
\- Study the scenarios of interaction between UDM and HSS FE with common
repository, specifically:
\- IMS and 5GS interworking required for the following cases:
\- Terminating Access Domain Selection (T-ADS).
When requested by IMS, the HSS+UDM shall be able to query the serving AMF for
T-ADS related information (see clause 5.16.3.6 in TS 23.501 [6]).
\- P-CSCF Restoration
As defined in clause 5.8.4 in TS 23.380 [8], upon request by IMS when P-CSCF
failure is detected, the HSS+UDM shall send a P-CSCF restoration indication to
either the SMF serving the IMS PDU session for the UE or to the AMF serving
the UE.
\- Network Provided Location Information (NPLI).
As defined in clause Y.6 in TS 23.228 [7], an IMS AS can trigger the retrieval
of the user location and/or UE Time Zone information from the AMF via the
HSS+UDM.
\- EPS and 5GS interworking required for mobility cases from EPS to 5GS and
from 5GS to EPS, including the impacts on SMS handling.
# 6 Solutions
## 6.1 Solution #1: Retrieving subscription data from separate UDR
repositories for EPS and 5GS subscription data using a UDR Translation
Function (UTF)
### 6.1.1 Introduction
Solution #1 addresses Key Issue 1.
### 6.1.2 High-level Description
It is proposed to introduce a UTF (UDR Translation Function) to allow
subscription data exchange between the HSS FE and the UDM when each function
has a separate UDR repository. The UTF is a logical function that can be
standalone or collocated with the UDM or HSS FE. The assumption with the
proposed architecture is that the UDR database of the UDM contains the related
5G subscription data, whereas the UDR of the HSS FE contains the related EPS
and IMS subscription data.
The UTF function contains a translation table that allows conversion of an
Nudr to a Ud request and vice versa. If the UDM requires information from the
EPS UDR , the UTF allows facilitating translation of an Nudr request to Ud
request. If the HSS FE requires information from the UDM UDR the UTF is
responsible to convert the Ud request to an Nudr request targeting specific
subscription data based on the semantics defined in TS 29.505 [9].
NOTE: The UTF would require to implement a translation table supporting the
HSS FE vendor specific Ud implementation.
The architecture is illustrated below:
Figure 6.1.2-1: UDM/HSS FE interworking architecture
### 6.1.3 Services and Illustrated Procedures
#### 6.1.3.1 General
When the HSS FE or UDM determine that subscription data needs to be fetched
from a different UDR an Ud or Nudr message requesting subscription details is
sent to UTF. The UTF translates the message into the corresponding message
towards the HSS FE (Ud message) or UDM (Nudr message) that is proxied towards
the UDR (Option 1). The UTF may also provide the translated message directly
to the target UDR repository bypassing the target HSS FE or UDM (Option 2).
An example procedure is illustrated below:
Figure 6.1.3.1-1: Procedure to retrieve subscription data from separate UDR
repository
The following cases have been identified where subscription data are retrieved
from different UDR:
\- 5GS to EPS interworking when no N26 is supported: In 5GS to EPS handover,
the HSS FE retrieves from the 5GS UDR the PGW-C+SMF ID in order to establish a
UE requested PDN connection. In EPS to 5GS handover the UDM retrieves from the
EPS UDR the PGW-C+SMF ID in order to establish a PDU session.
\- Support of T-ADS: When IMS core interfaces with the HSS FE and the UE is
camped on a 5G network the HSS FE retrieves from the 5GS UDR the IMS over PS
support and current RAT type.
#### 6.1.3.2 5GS to EPS Interworking when N26 is not supported
##### 6.1.3.2.1 5GS to EPS handover
During 5GS to EPS handover when the HSS FE receives the Update Location
Request from the MME (as described in step 8 of Figure 4.11.2.2-1 of TS 23.502
[2] the HSS FE needs to retrieve the address of the combo PGW-C+SMF. The HSS
FE is aware that the information is located at the 5G UDR as the UPDATE
LOCATION REQUEST includes information that registration of an AMF shall not be
cancelled. The HSS FE sends a vendor specific Ud request towards the UTF. The
UTF must translate the vendor specific Ud request from the HSS FE to an
Nudr_DM_Query service request including a Data Subset \"UE Context in SMF
data\" towards the 5GS UDR (the Nudr request may be proxied via the UDM to the
5GS UDR).
Figure 6.1.3.2.1-1: HSS FE retrieves PGW-C + SMF ID from 5G UDR
If during 5GS to EPS interworking the UE indicates that dual registration is
not supported the HSS needs to notify the UDM to deregister the UE from the 5G
network. Such notification can be supported indirectly via the UDR. The steps
required are:
\- The HSS FE creates a vendor specific Ud request to delete the 5G
subscription data of the UE from the 5G UDR
\- The UTF translates the request into an Nudr_DM_Update message including
information to remove all related 5G subscription data for the UE from the 5G
UDR
\- The 5G UDR deletes the subscription data and notify the UDM of the result
using an Nudr_DM_Notify service operation
\- The UDM notifies the AMF of the deregistration by invoking the
Nudm_UECM_DeregistrationNotify service operation
The steps are shown in the Figure below:
Figure 6.1.3.2.1-1: Indirect procedure for the HSS to notify the UDM to
deregister the UE from the 5G network
##### 6.1.3.2.2 EPS to 5GS handover
When the UDM requires the PGW-C+SMF ID the UDM sends an Nudr_DM_Query service
request including a Data Subset \"UE Context in SMF data\" towards the UTF to
retrieve the address. The UTF translates the Nudr request into a vendor
specific Ud request in order to retrieve the same information from the EPS
UDR. The UDM knows that the information required is located at the EPS UDR as
the AMF sends an Update Location Request message to the UDM including the ULR-
Flags indicating that registration of an MME shall not be cancelled.
Figure 6.1.3.2.2-1: UDM retrieves PGW-C + SMF ID from EPS UDR
If during EPS to 5G interworking the UE indicates that dual registration is
not supported the UDM needs to notify the HSS to deregister the UE from the
EPS network. The steps required are:
\- The UDM creates an Nudr_DM_Update request to delete the EPS subscription
data
\- The UTF translates the request into a vendor specific Ud request
\- The EPS UDR deletes the subscription data and notify the HSS of the result
\- The HSS notifies the MME of the deregistration by invoking a Cancel
Location request.
The steps are shown in the Figure below:
Figure 6.1.3.2.2-2: Indirect procedure for the UDM to notify the HSS to
deregister the UE from the EPS network
#### 6.1.3.3 Terminating Access Domain Selection (T-ADS)
##### 6.1.3.3.1 Alternative 1
This alternative assumes the IMS network interfaces only with the HSS FE over
Sh interface.
When the HSS FE requires the homogeneous IMS voice over PS supporting
indication and the UE is camped on 5G network, the HSS FE constructs a Ud
request to retrieve the subscription information from the 5G UDR
NOTE 1: It is assumed that the HSS FE first sends a request to retrieve the
related information from the 4G UDR. When the 4G UDR responds that there is no
4G related subscription content the HSS FE determines that the user is camped
on 5G access and re-sends the Ud message towards the UTF.
The UTF must translate the vendor specific Ud request from the HSS FE to an
Nudr_DR_Get service request including a Data Subset
\"Amf3GPPAccessRegistration\" towards the 5GS UDR (the Nudr request may be
proxied via the UDM to the UDR).
NOTE 2: For T-ADS it is not possible to obtain the most recent access network
capabilities for domain selection. The T-ADS makes the decision based on
whether IMS over PS session is supported homogeneously over all TAs served by
the AMF.
If the network does not support N26 then the UE may operate in Dual
Registration mode. In that case a UE may have an PDN connection for IMS over
EPS core or an PDU session for IMS over 5G core. When the IMS AS requires the
most recent access network capabilities for domain selection the IMS AS
interrogates the HSS.
One method to support the case of UEs in Dual Registration mode is for the IMS
AS to derive from the P-Access-Network-Info header the core network access
path (i.e. via EPS or 5G core) via which the UE has established an IMS
session. When the IMS AS requires T-ADS information, the IMS AS includes in
the Sh request the information on the network node (MME or AMF) that needs to
be triggered.
The IMS AS can derive the path (EPS or 5G core) via which a UE has established
an IMS session from the \"P-Access-Network-Info header when the following take
place:
\- P-CSCF adds within the PANI header the \"access-class\" field corresponding
to the IP-CAN type provided by the PCRF as described in TS 24.229 [17]
\- P-CSCF obtains from the PCRF via Rx the IP-CAN type when the PCRF
subscribes to be informed of the IP-CAN type as described in TS 29.214 [18]
NOTE 3: The above procedure may require further normative work in stage 3
This is illustrated schematically below taking into account that the IMS AS
supports an Sh interface only towards the HSS.
Figure 6.1.3.3.1-1: Support of T-ADS when the UE operates in Dual Registration
mode (example of UE accessing IMS via 5G core)
1\. UE registers with IMS including the PANI header as specified in TS 24.229
[17] via the 5G core network
2\. IMS AS identifies from the PANI header that the UE is accessing the 5G
core network access
3\. When the IMS AS requires T-ADS information the IMS AS includes in the Sh
request information on the node that contain the information
4\. The HSS identifies from the Sh request that T-ADS information is available
from the 5G UDR
5\. HSS constructs a Ud message towards the UTF
6\. UTF converts the Ud to a Nudr message
7\. UTF sends the Nudr message to the UDR of the UDM
8\. The UDR obtains the T-ADS info
9\. The UDR provides the T-ADS info within the Nudr response to the UTF
10\. The UTF translates Nudr response to a Ud response and sends to HSS
11\. HSS provides the T-ADS info within the Sh response to the IMS AS.
##### 6.1.3.3.2 Alternative 2
This alternative assumes that the IMS AS can interface to both HSS and UDM
over Sh interface. In such a case the IMS AS can obtain the most recent access
network capabilities for domain selection by interrogating the HSS and UDM.
When the UE is in dual registration the IMS AS can derive from the P-Access-
Network-Info header the core network access path for IMS (i.e. via EPS or 5G
core) via which the UE has established an IMS session. When the IMS AS
requires T-ADS information the IMS AS interrogates the HSS or the UDM based on
the derived core network access path for IMS.
It is important to note that additional enhancements to UDM - IMS core network
interaction will be defined by FS_eIMS5G study where an SBI interface between
the UDM and IMS AS will be supported. In such case support of lite Sh
interface at the UDM will not be required and an SBI interface can be used
instead.
#### 6.1.3.4 P-CSCF restoration
The P-CSCF restoration is an optional feature allowing the IMS network to
notify the HSS or UDM to re-establish the IMS related PDU session in case of
P-CSCF failure.
One approach to support this feature is the S-CSCF to support a Cx interface
to both HSS and UDM. In case of P-CSCF failure, the S-CSCF reports failure to
the UDM or HSS.
For networks that do not support N26, when the UE is in dual registration mode
the S-CSCF can derive from the P-Access-Network-Info header the core network
access path for IMS (i.e. via EPS or 5G core) via which the UE has established
an IMS session. When the S-CSCF initiates P-CSCF restoration procedure the
S-CSCF triggers the HSS or the UDM based on the derived core network access
path for IMS.
The UDM would support limited Cx functionality to be notified by the S-CSCF of
a P-CSCF failure. Once notified the UDF invokes the procedures described in
clause 5.8 of TS 23.380 [8].
NOTE: The IMS network interfaces with the HSS (i.e. via Cx/Sh interfaces) for
any IMS related subscription information.
It is important to note that additional enhancements to UDM - IMS core network
interaction will be defined by FS_eIMS5G study where an SBI interface between
the UDM and S-CSCFwill be supported. In such case support of lite Cx interface
at the UDM will not be required and an SBI interface can be used instead.
### 6.1.4 Impacts on existing services and interfaces
The impacts are as follows:
\- HSS FE
\- Identifies that subscription information is stored on a UDR repository
containing 5GS subscription data
\- For option 1: proxies a Ud request/answer from the UTF/UDR respectively
\- UDM
\- Identifies that subscription information is stored on a UDR repository
containing EPS subscription data
\- For Option 1: proxies an Nudr request/answer from the UTF/UDR respectively.
\- S-CSCF
\- When the network uses the P-CSCF restoration procedure via the AMF, the
S-CSCF interrogates the HSS FE and the UDM in order to identify the serving
network and report the P-CSCF failure
\- For networks supporting no N26, where the UE operates in Dual Registration
case, the S-CSCF uses the P-Access-Network-Info header to identify if the UE
is accessing IMS via 5G or EPS access
\- IMS AS
\- For networks supporting no N26, where the UE operates in Dual Registration
case, the IMS AS uses the P-Access-Network-Info header to identify if the UE
is accessing IMS via 5G or EPS access
### 6.1.5 Evaluation
Solution 1 proposes an architecture that does not require direct interaction
between the UDM and the HSS FE. The solution requires a new function (UTF)
that translate subscription data exchange between the HSS FE and the UDM where
each have a separate UDR repository. The solution assumes that the UDR of the
HSS contains EPS and IMS subscription details whereas the UDR of the UDM
contain 5G subscription details only. It is also assumed that the HSS contain
all IMS subscription related information. The solution requires the standalone
HSS to support the functionality to retrieve information from the UDR of the
UDM in certain scenarios (e.g. T-ADS for IMS) as described in clause 6.1.3 of
the present TR. The advantages of this solution is that:
\- It avoids defining a new interface between the HSS and UDM which would
require both legacy HSS and UDM to support a new interface.
\- It is possible to introduce only UDM and 5G UDR when deploying a 5GS
system, without having to update/upgrade either HSS FE or the EPS UDR, or
having to introduce these functionalities in deployments with single core
networks.
\- Standardisation is minimised and restricted to potential incorporation of
lite Sh/Cx interfaces for the UDM, or even not needed in case the FS_eIMS5G
study incorporates the needed interactions of UDM with IMS
\- Introduction of a UTF does not affect other network functions that may be
accessing the different repositories, while it provides the means to further
split other network functions defined in Rel-15 (i.e. PCF/PCRF).
The disadvantage is that a new UTF is deployed in an operator\'s network that
requires to support a vendor specific Ud implementation of the deployed HSS.
Limitations of the solution are as follows:
\- Support of T-ADS: When the UE is camped on 5G core network the IMS AS can
obtain T-ADS information only if there is homogeneous IMS voice over PS
support.
\- Support of P-CSCF restoration via HSS: When the UE is camped on 5G core
network P-CSCF restoration is not possible via the HSS as the HSS cannot
directly trigger the UDM to trigger P-CSCF restoration.
The limitations can be solved with the following additions:
\- Support of T-ADS: UDM implements a lite Sh implementation. IMS AS triggers
UDM directly for any T-ADS information. Requires the IMS AS to be aware of the
core network access path for IMS sessions by inspecting the P-Access-Network-
Identifier header.
\- Support of P-CSCF restoration: Support of P-CSCF restoration is also
supported via the PCRF/PCF which has no impacts on HSS/UDM. Alternatively, the
UDM can implement a lite Cx implementation. S-CSCF triggers UDM directly for
P-CSCF restoration. Requires the S-CSCF to be aware of the core network access
path for IMS sessions by inspecting the P-Access-Network-Identifier header.
## 6.2 Solution #2: Direct SBA UDM-HSS Interworking
### 6.2.1 Introduction
This solution is applicable to key issues 1 and 2.
This solution proposes a new Service Based Interface between UDM and HSS.
### 6.2.2 High-level Description
This contribution proposes a service based interface between HSS and UDM. The
architecture for this solution is outlined in the following figure:
Figure 6.2.2-1: Architecture for Direct UDM-HSS Interworking with independent
UDRs
Figure 6.2.2-2: Architecture for Direct UDM-HSS Interworking with a common
repository
A new reference point between UDM and HSS within the combined HSS/UDM (i.e.
Nxx as depicted in Figures 6.2.2-1 and 6.2.2-2) is proposed. The new interface
for interworking between HSS and UDM is proposed to be based on SBI
principles.
NOTE: The UDM and the HSS may be deployed in a stand-alone manner and could be
from different vendors.
### 6.2.3 Services and Illustrated Procedures
Figure 6.2.3-1 shows a high-level illustration of the EPS/IMS and 5GS
interworking procedures that requires interworking via HSS/UDM for procedures
triggered from the EPS/IMS.
#### 6.2.3.1 General
Figure 6.2.3-1: High Level Illustration of HSS-UDM Interworking
1\. IMS/EPC interacts with HSS over existing interfaces for the purpose of
e.g. Updating Location of an MME in HSS, and/or requesting HSS to execute some
actions in the access network (e.g. P-CSCF restoration) or retrieve some
information from the access network (e.g. TADS or NPLI information).
2\. Depending on the type of request, the HSS may be able to serve the request
and reply to the request with no interaction with UDM (e.g. for ULR from MME
or P-CSCF restoration request from S-CSCF). In this case, the HSS replies the
request as in step 6.
Otherwise, the HSS interacts with UDM over the new Nxx reference point
proposed in this solution using new service operations under the Nudm service
set. The definition of these new service operations is out of the scope of the
description of this solution.
In either case, in a layered architecture, the HSS interacts with the 4G/IMS
UDR (using Ud). The HSS does not need to retrieve any subscription data
belonging to the 5G subscription profile.
3\. UDM receives the request from HSS over the new Nxx reference point and
interacts with the 5GC as needed using existing defined procedures. UDM
interacts with the 5G UDR (using Nudr). The UDM does not need to retrieve any
subscription data belonging to the 4G/IMS subscription profile.
Editor\'s note: Analysis on the existing defined procedures in UDM that are
used is FFS.
Depending on the request, UDM may omit the request to the 5GC and reply to HSS
as in step 5 based on information stored under the 5GC subscription profile
(e.g. in case of a TADS requests for which the AMF has already informed UDM
that \"Homogeneous support for Voice over IP\" is supported).
In case of P-CSCF restoration or AMF deregistration, the UDM does not wait for
the acknowledgement from 5GC, it sends the response back like in step 5.
4\. 5GC replies the request from UDM including the requested information (e.g.
TADS, NPLI) or confirming the execution of the requested action (e.g. P-CSCF
restoration, deregistration of the UE from the AMF).
5\. UDM responds to HSS including the requested information (e.g. TADS, NPLI)
or confirming the execution of the requested action (e.g. for the P-CSCF
restoration request, it confirms the deregistration of the UE from the AMF).
6\. HSS responds to EPC/IMS. Depending on the request, the response from HSS
will include information received from 5GC via UDM (e.g. TADS, NPLI).
Figure 6.2.3-2 shows a high-level illustration of the 5GS and EPS/IMS
interworking procedures that requires interworking via HSS/UDM for procedures
triggered from the 5GC.
Figure 6.2.3-2: High Level Illustration of UDM-HSS Interworking
In this case, an interaction between the 5GC and the UDM (e.g. an AMF
registration in UDM in the context of a mobility scenario from EPC to 5GC
using interworking with N26 procedures) triggers a request from UDM to HSS
over the new Nxx reference point proposed in this solution using new service
operations under a new service set offered by the HSS, e.g. Nhss service set.
Similar interactions as described for the HSS-UDM interworking for procedures
triggered from the EPC/IMS apply here too. Depending on the procedure, the
interactions between the UDM and the 5GC, the UDM and HSS and HSS and the EPS,
may be executed asynchronously (e.g. the UDM may not wait to the response from
HSS, not even to trigger the request to HSS to send a response to the 5GC).
#### 6.2.3.2 Subscriber Profile Indications
Different subscriber types may exist in a network with Nxx interface. For
example, some subscribers will use the full network, i.e. 5GC, the EPC and the
IMS, while others might use 5G and IMS but no EPC, and legacy subscribers
might just remain limited to EPC and IMS services without subscription to the
5GC. The different subscription types determine, whether the use of the Nxx
interface is required for a subscriber. Thus, a \"5GC subscription
indication\" is part of the HSS subscription data as well as a \"SMS via 5G
NAS support\" indication. Similarly, an \"EPC subscription indication\" and an
\"IMS subscription\" indication are stored in the UDM subscription data.
Editor\'s note: Requirement for \"IMS subscription indication\" to be
confirmed.
#### 6.2.3.3 Authentication
If security credentials are stored in one single place in the system, there
are multiple options for this storage. Some possibilities are analysed in this
clause.
##### 6.2.3.3.1 Single AV Generation Engine in HSS(AuC) and Credentials stored
in EPC-UDR
As an option, 5G and EPC users\'credentials may be stored in the EPC-UDR,
(i.e. credentials for existing and users with a 2/3/4G/5G subscriptions and
also credentials for users with only 5G subscription) and the authentication
vectors are generated in HSS(AuC). In this case, the UDM needs to retrieve the
authentication vectors from the HSS. The collocation of the 5G and 4G/3G/2G
credentials is required to avoid distributed vectors generation lacking
coordinated Sequence numbers.
Figure 6.2.3.3.1-1 shows the interaction in an interworking scenario with N26
interface, when the UE attaches to the 5GC, but authentication data are stored
in the EPC-UDR and authentication vectors are generated in HSS(AuC).
Figure 6.2.3.3.1-1: Authentication in 5GC with generation of AV in HSS
1\. The UDM receives a Nudm_UEAuthentication_Get Request, containing the SUPI
of the user.
2\. The UDM queries the UDR for the user profile belonging to the SUPI.
3\. The UDM receives the user profile, which includes the IMSI, the
authentication method, an EPC subscription indication, but no authentication
data.
4\. The UDM sends a Nhss_UEAuthentication_Get request to the HSS, containing
the IMSI, Serving network information, and the Authentication Method (which
specifies whether the 5G AKA or the EAP-AKA authentication methods is used)
5\. If the EPC UDR is used, the HSS reads the IMSI, SQN and other data from
the EPC-UDR.
6\. The AuC as part of the HSS generates the 5G AKA or EAP-AKA authentication
vectors.
7\. If the EPC UDR is used, the HSS updates the SQN in the EPC-UDR.
8\. The HSS provides the authentication vectors to the UDM in the
Nhss_UEAuthentication Response.
9\. The UDM proceeds with the authentication.
##### 6.2.3.3.2 Single AV Generation Engine in UDM and Credentials stored in
UDR
As an option, 5G and EPC users\' credentials may be stored in the UDR (i.e.
credentials for users with a 4G subscription and credentials for users with a
5G subscription) and the authentication vectors are generated in UDM(ARPF). In
this case, the HSS needs to retrieve the authentication vectors from the UDM.
Figure 6.2.3.3.2-1 shows the interaction in an interworking scenario, when the
UE attaches to EPC, but authentication data is stored in the UDR.
Figure 6.2.3.3.2-1: Authentication in EPC with generation of AV in UDM
1\. The HSS receives an Authentication-Information-Request, containing the
identification of the user.
2\. The HSS sends a Nudm_UEAuthentication_Get request to the UDM, containing
the user identification, Service Network Id (SNI) and the Authentication
Method (e.g. EPS-AKA).
NOTE: Whether one or multiple services are required, and specific naming for
the operation, could be taken during normative phase.
3,4. If the UDR is deployed, the UDM reads the credentials and related
authentication data stored in the UDR.
5\. The AuC/ARPF as part of the UDM generates the authentication vectors as
requested.
6,7. If the UDR is used, the UDM updates the SQN in the UDR.
8\. The UDM provides the authentication vectors to the HSS in the
Nudm_UEAuthentication_Get response.
9\. The HSS proceeds with the authentication.
#### 6.2.3.4 Mobility Scenarios
##### 6.2.3.4.1 Mobility from 5GC to EPC, single registration, with N26
Interface
In a single registration scenario, the attachment in an MME triggers a
cancellation of the AMF address in the UDM/UDR.
Figure 6.2.3.4.1-1shows the interaction in an interworking scenario with N26
interface, when the UE attaches to the EPC.
Figure 6.2.3.4.1-1: Mobility from 5GC to EPC
1\. The HSS receives an S6a ULR request containing the IMSI of the subscriber.
2\. If the EPC UDR is used, the HSS reads the subscription information related
to the IMSI from the EPC-UDR. In particular, it receives the 5GC subscription
information.
3\. If the EPC-UDR is used, the HSS updates the EPC-UDR with the new MME
address.
4\. The HSS responds to the MME with an S6a-ULA.
5\. If the 5GC subscription indication is received in step 2, i.e. if there is
an 5GC subscription for the user, then the HSS uses the Nudm_UECM_Deregister
service of the HSS for the IMSI of the user. This does not include the AMF
address as when a AMF triggers that hence this is marked with a *.
6\. The UDM responds to the HSS.
7\. The UDM uses the Nudr_DM_Query service to retrieve the AMF address
previously assigned to the UE, if any. If the UE is registered at an AMF,
steps 8 and 9 are executed.
8\. If there is an AMF address found for the user, the UDM cancels the
attachment by sending a Nudm_UECM_DeregistrationNotification to the AMF.
9\. In this case, the UDM also updates the UDR entry using the Nudr_DM_Update
service.
##### 6.2.3.4.2 Mobility from EPC to 5GC, single registration, with N26
Interface
In a single registration scenario, the attachment in an AMF triggers a
cancellation of the MME address in the HSS.
Figure 6.2.3.4.2-1 shows the interaction in an interworking scenario with N26
interface, when the UE attaches to the 5GC.
Figure 6.2.3.4.2-1: Mobility from EPC to 5GC
1\. The UDM receives an Nudm_UECM_Registration request containing the SUPI of
the subscriber.
2\. The UDM queries the UDR with an Nudr_DM_query for the old AMF address and
the EPC subscription indication belonging to the SUPI.
3\. The UDR provides the requested data to the UDM.
4\. The UDM updates the UDR with the new AMF registration data using the
Nudr_DM_Update service.
5\. If the EPC subscription indication is received in step 3, i.e. if there is
an EPC subscription for the user, then the UDM uses the Nhss_UECM_Deregister
service of the HSS for the IMSI of the user.
6\. The HSS responds to the UDM.
7\. If the EPC UDR is used, The HSS reads the MME mobility information in the
EPC-UDR. If the UE is registered at an MME, steps 8 and 9 are executed.
8\. If there is an MME address found for the user, the HSS cancels the
attachment of the IMSI in the MME by sending a CLR via the S6a interface.
9\. IF step 8 was executed, and EPC UDR is used, the HSS also updates the EPC-
UDR entry to remove the MME assignment.
##### 6.2.3.4.3 Interworking without N26 Interface
For interworking without the N26 interface in Rel-15, IP address preservation
is provided to UEs on inter-system mobility by storing and fetching PGW-C+SMF
and corresponding APN/DDN information via the HSS+UDM, see TS 23.501 [6]
clause 5.17.2.3.1. In an architecture with Nxx interface between HSS and UDM,
this information must be exchanged via the Nxx interface.
For mobility from 5GC to EPC, the HSS can use the
Nudm_SubscriberDataManagement (SDM) service for \"UE context in SMF\" data.
For mobility from EPC to 5GC, the HSS Nhss_SubscriberDataManagement service
for the \"UE context in PGW\" provides the PDN-GW address per subscriber and
APN. The UDM can use this service.
This service is also applicable for interworking with non-3GPP access if IP
address preservation is requested.
#### 6.2.3.5 T-ADS
Figure 6.2.3.5-1 shows the interaction when the SCC-AS sends a T-ADS query to
the HSS, and the user is subscribed to 5GC as well.
Figure 6.2.3.5-1: Terminating Access Domain Selection
1\. The HSS receives a UDR T-ADS query from the SCC-AS over the Sh interface.
2\. If EPC-UDR is used, the HSS reads the MME, SGSN, T-ADS related information
and the 5G subscription indication from the EPC-UDR.
3\. Depending on registration state, the HSS queries the MME and/or SGSN for
IMS over PS session support.
4\. If the user has a 5G subscription, the HSS requests 5GC-related T-ADS
information from the UDM, using the Nudm_MT_ProvideDomainSelectionInfo service
provided by the UDM. The HSS includes an indication, whether a time stamp of
last attachment is required.
5\. On receipt of the request, the UDM queries the UDR for the AMF
registration state and the stored T-ADS related information (e.g. homogenous
support).
6\. If the user is registered in an AMF and there is no information regarding
homogenous support or non-support, or if a time stamp has been requested by
the HSS, the UDM sends an Namf_MT_ProvideDomainSelectionInfo service request
to the AMF.
7\. The AMF responds with the T-ADS information.
8\. The UDM passes the T-ADS information to the HSS - in the response to the
Nudm_MT_ProvideDomainSelectionInfo request.
9\. The HSS combines the information related to SGSN, MME and AMF and provides
it to the SCC-AS in the Sh-UDA message.
#### 6.2.3.6 P-CSCF Restoration
Figure 6.2.3.6-1 shows the interaction when the S-CSCF initiates a P-CSCF
restoration at the HSS, and the user is attached to 5GC. In this example the
AMF based restoration is shown. The procedure for the SMF follows the same
approach and same method across the Nxx interface.
Figure 6.2.3.6-1: P-CSCF Restoration
1\. The HSS receives a Cx-SAR (Server Assignment Request) message from the
S-CSCF, which includes the P-CSCF restoration indication.
2\. If the EPC-UDR is used, the HSS reads the subscriber data from the EPC-
UDR.
3\. If applicable, the HSS sends a P-CSCF restoration information towards the
supporting nodes (SGSN, MME) and performs the unregistration/deregistration of
the UE in IMS, as described in step 5 of TS 23.380 [8], clause 5.4.2.1. This
includes the necessary updates in the EPC-UDR.
4\. The HSS replies with a Cx SAA (Server Assignment Answer) to the S-CSCF.
5\. In case of 5GC subscription indication, the HSS uses the enhanced
Nudm_UECM_PcscfRestoration service of the UDM to trigger the P-CSCF
restoration indication in the 5GC.
6\. The UDM reads the subscriber profile in the UDR to retrieve the relevant
AMF address and callback-URI.
7\. (copy of step 6 in TS 23.380 [8], clause 5.8.4.3) The UDM sends
Nudm_UECM_PcscfRestoration notification to the AMF serving the UE, using the
received callback URI for P-CSCF restoration notifications. The AMF accepts
the Nudm message and sends a response message to the UDM.
8\. The UDM responds to the HSS. Note: Message 8 may be sent at the same time
like message 7 and need not wait for the response to message 7.
#### 6.2.3.7 SMS support
The interworking between EPS and 5GC, as described in clause 6.2.3.4, also has
an impact on SMS handling. For example, if an SMS cannot be delivered to a
subscriber which is not attached to the mobile network at all, it cannot be
predicted how the subscriber will be reachable for SMS next. The subscriber
may attach in 2G/3G only, in LTE/EPC or in 5G via NR - the network must be
prepared to deliver the SMS anyway. In the following clauses we focus on the
SMS message flows initiated towards the HSS. Similar flows apply for the SMS
delivery described in TS 23.502 [2].
##### 6.2.3.7.1 Terminating SMS location query
Figure 6.2.3.7-1 shows the interaction when the SMSC or IP-SM-GW queries the
HSS for SMS routing information.
Figure 6.2.3.7-1: SMS Location Query
1\. The SMSC queries the HSS for routing information for SMS.
2\. If the EPC-UDR is used, the HSS reads the necessary information from the
EPC-UDR.
3\. The HSS uses the Nudm_UECM_Get request to query the UDM for the serving
SMSF address(es).
4\. The UDM queries the UDR with an Nudr_DM_query for the SMSF address(es).
5\. The UDR provides the SMSF address(es) to the UDM.
6\. The UDM passes the SMSF address(es) to the HSS in the Nudm_UECM response.
7\. The HSS replies to the SMSC with a list of supporting nodes.
##### 6.2.3.7.2 Terminating SMS delivery failure
After delivery of an SMS failed, the HSS stores message waiting information.
In order to enable message delivery via 5G NAS, the HSS subscribes to the UDM
(and indirectly AMF) for UE availability. Figure 6.2.3.7-2 shows the related
interaction; it is assumed that there was no previously waiting message
before.
Figure 6.2.3.7-2: SMS Delivery Failure
1\. The SMSC informs the HSS about the delivery failure.
2\. The HSS reads the necessary information from the EPC-UDR.
3\. The HSS updates the Message Waiting status in UDR.
4\. The HSS acknowledges the receipt of the delivery status to the SMSC.
5\. The HSS subscribes for UE reachability information at the UDM, using the
Nudm_EventExposure service.
6\. The UDM requests the relevant subscriber information from the UDR.
7\. The UDR provides the requested information.
8\. The UDM subscribes for UE reachability information at the AMF, using the
Namf_EventExposure service.
9\. The AMF acknowledges the subscription by the UDM.
10\. UDM updates the subscriber specific event subscription information in the
UDR.
11\. The UDR acknowledges the update to the UDM.
12\. The UDM acknowledges the subscription by the AMF.
##### 6.2.3.7.3 SMS Alerting
Once the UE becomes available again, the SMSC(s) will be informed about the
availability. Figure 6.2.3.7-3 shows the related interaction if the UE becomes
reachable in 5G. This assumes the existence of a subscription as described in
clause 6.2.3.7.2.
Figure 6.2.3.7-3: SMS Alerting
1\. The AMF informs the UDM about the UE reachability.
2\. The UDM reads the necessary information from the UDR.
3\. The UDM acknowledges the receipt of the Notification to the AMF.
4\. The UDM updates the AMF-URRP flag in the UDR.
5\. The UDM informs the HSS about the UE availability.
6\. The HSS may read the subscriber related information in the EPC-UDR.
7\. The HSS acknowledges the receipt of the notification to the UDM.
8\. The HSS alerts all relevant SMSCs regarding the UE availability. Only one
such SMSC is shown in the figure for simplicity.
9\. The HSS may update the subscriber information in the EPC-UDR.
10\. The SMSC replies to the alerting.
### 6.2.4 Impacts on existing services and interfaces
Following impacts are identified:
a) Impacts in HSS:
New SBA service at least with one operation Request/Response, at described in
figure 6.2.3-2.
This SBA service has to follow registration/discovery/selection procedures (by
means of interaction with NRF or by configuration) as defined for Relâ€‘15 or
its evolution/adaptation to Relâ€‘16.
No impacts to existing interfaces or procedures.
b) Impacts in UDM
New SBA service at least with one operation Request/Response, at described in
figure 6.2.3-1.
### 6.2.5 Evaluation
This solution identifies an approach that can work for both layered and not
layered architectures of HSS.
In addition, it supports all the procedures that have been defined on EPS and
5GS without any impact on any other interface than the one between HSS and UDM
this solution defines.
If this solution is adopted, it requires standardisation of the interface
between HSS and UDM.
## 6.3 Solution #3: UDM/HSS FE interaction reusing legacy protocol
### 6.3.1 Introduction
This solution addresses Key Issue #1: Interaction between UDM and HSS with
separate repositories.
The assumption of this solution is that 5GS UDR and EPS UDR are separate,
between which there is no interface for direct interactions. The EPS and IMS
profiles are stored in EPS UDR and the 5GS profile is stored in 5GS UDR.
UDM and HSS FE interacts to retrieve or update the required user data for the
following procedures:
\- Authentication procedure, i.e. initial attach/registration.
\- Network Provided Location Information (NPLI).
\- Procedure on IP address continuity of interworking without N26 from 5GS to
EPS.
\- T-ADS query for IMS voice.
\- IMS related procedures related to Cx/Dx and Sh interfaces.
\- SMS over NAS.
To avoid the impact on legacy HSS, the interactions for retrieving or updating
user data are initiated by UDM through reusing existing HSS supported protocol
and procedures, i.e. this solution only requires UDM to retrieve or update
user data stored in EPS UDR via HSS FE. The interface between HSS FE and EPS
UDR is also not impacted.
### 6.3.2 High-level Description
#### 6.3.2.1 Authentication
A new interface, Shu, between UDM and HSS FE is introduced, by which UDM
initiates interactions with HSS FE to retrieve or update user data stored in
EPS UDR. Shu is a Point-to-Point reference point.
UDM is the only access point both to 5GC and EPC.
Figure 6.3.2.1.1: Solution architecture
In some 5G deployment, when a 4G subscriber is updated to 5G subscriber, the
4G subscription profile keeps stored in EPS UDR while the new 5G subscription
data is provisioned in 5GS UDR. In this case it is assumed that the
authentication data is only stored in EPS UDR and is reused by 5GS
authentication.
For new 5G subscriber, all the subscription data is stored in 5GS UDR.
Therefore, the solution described in this clause does not apply.
In this scenario, when a UE with 5GS subscription registers on 5GS, the UDM
needs to interact with HSS FE to retrieve authentication information data
stored in EPS UDR.
NOTE: The UDM is a combo node which simultaneously supports UDM and HSS FE
functionality.
In case of single registration in 5G, in order to cancel the registration in
the other RAT, the UDM supports to perform a fake 4G registration in the HSS,
as shown in Figure 6.3.3.1-2. This trigger the HSS to cancel the 4G
registration. When the UE moves back to 4G, the HSS sends cancel location to
UDM which trigger the UDM to deregister the UE in 5G.
#### 6.3.2.2 IP address continuity of interworking without N26 from 5GS to EPS
Shu interface defined in clause 6.3.2.1 is reused.
UDM is the only access point both to 5GC and EPC.
Figure 6.3.2.2-1: Solution architecture
When a UE initially registers in 5GC, the FQDN for the S5/S8 interface of the
PGW-C+SMF is registered into UDM via Nudm as specified in clause 4.11.2 of TS
23.502 [2].
When UE attaches in EPS due to interworking without N26, the procedure
specified in clause 4.11.2 of TS 23.502 [2] applies. When MME sends Update
Location Request to UDM, after forwarding the request to HSS FE, UDM needs to
retrieve the stored PGW-C+SMF FQDN and add it into the Update Location Ack
message returned from HSS FE.
The MME use PGW-C+SMF FQDN received from the Update Location Ack message to
determine the address of PGW-C+SMF.
#### 6.3.2.3 T-ADS for IMS voice
Shu interface defined in clause 6.3.2.1 is reused.
UDM is the only access point both to 5GC, EPC and IMS, i.e. UDM supports S6a
and Sh interfaces along with Nudm.
Figure 6.3.2.3-1: Solution architecture
SCC AS initiates T-ADS query towards UDM via Sh interface as specified in TS
29.328 [11].
To handle T-ADS query, the UDM queries T-ADS information towards HSS FE to get
T-ADS information related to EPS and UMTS. HSS FE may query MME and SGSN to
get information as specified in TS 23.401 [16] and TS 23.060 [15].
After receiving response of T-ADS query from HSS FE, UDM responds T-ADS query
to SCC AS based on the T-ADS information received from HSS FE and T-ADS
information in UDM. UDM may query AMF to get necessary information as
specified in TS 23.501 [6].
#### 6.3.2.4 Supporting IMS related procedures
Shu interface defined in clause 6.3.2.1 is reused.
UDM, which is a combo node supporting UDM and HSS functionalities, is the only
access point both to 5GC, EPC and IMS.
Figure 6.3.2.4-1: Solution architecture
Since IMS profile is stored in EPS UDR, the UDM needs to forward all the
requests received from IMS via Cx/Dx or Sh interfaces to HSS FE to handle, and
further forwards all the responses from HSS FE to IMS.
For some scenarios that HSS FE and EPS UDR may generate requests to IMS, the
UDM needs to forward all the requests received from HSS FE to IMS via Cx/Dx or
Sh interfaces to handle, and further forwards all the responses from IMS to
HSS FE.
#### 6.3.2.5 SMS over NAS
Shu interface defined in clause 6.3.2.1 is reused.
UDM is the only access point both to SMSF, SMS router and SMSC/SM GMSC.
Figure 6.3.2.5-1: Solution architecture
### 6.3.3 Services and Illustrated Procedures
#### 6.3.3.1 Authentication
The procedure of the interaction between UDM and HSS FE for Authentication
Information Retrieval is shown in Figure 6.3.3.1-1.
Figure 6.3.3.1-1: Authentication Info Retrieval Procedure between UDM and HSS
FE
1a. When the UE attaches from EPS, MME sends Authentication-Information-
Request to UDM to get authentication information for the UE. The MME message
is sent to UDM by DRA routing (i.e., based on IMSI range).
1b. When the UE registers from 5GS, AMF invokes
Nausf_UEAuthentication_authenticate service operation to AUSF to get
authentication information for the UE.
1b\'. AUSF invokes Nudm_UEAuthentication_Get service operation.
2\. When UDM receives Nudm_UEAuthentication_Get, it determines to generate and
send S6a Authentication-Information-Request message to HSS-FE based on local
configuration, if the authentication information is stored in EPS UDR due to
operator\'s deployment.
3\. HSS FE interacts with EPS UDR to retrieve authentication information of
the UE via legacy UDC architecture.
4\. HSS FE returns Authentication-Information-Answer with authentication
vectors to UDM.
5a. UDM forwards Authentication-Information-Answer with authentication vectors
to MME.
5b\'. UDM generates the respond to Nudm_UEAuthentication_Get service operation
invocation with authentication vectors received in Authentication-Information-
Answer, and sends the respond to AUSF.
5b. AUSF response the AMF invoked Nausf_UEAuthentication_authenticate service.
Editor\'s note: This procedure may be modified based on SA WG3 LS response.
The procedure of the interaction between UDM and HSS FE for single
Registration is shown in Figure 6.3.3.1-1.
Figure 6.3.3.1-2: Single Registration Procedure between UDM and HSS FE
1\. The UE is registered in 5G. The AMF perform UE registration in UDM. The
AMF indicates whether it requires single registration or dual registration.
2\. If the AMF requires single registration then the following steps are
performed. Otherwise the procedure stops.
3\. The UDM selects the HSS FE based on the SUPI and sends Update Location
Request to HSS FE. In this message a dedicated MME Identity is included. This
dedicated MME Identity is pointing to the UDM. From HSS FE point of view, the
UDM is now acted as a MME. This message also includes an indication to
indicate single registration and an indication to indicate the skip of
subscription data so the HSS FE will not send the UE 4G subscription data.
4\. The HSS FE stores the dedicated MME Identity into EPS UDR via Ud
interface.
5\. The HSS FE sends Update Location Response to UDM.
6\. If the UE has been registered in an old MME, the HSS FE sends Cancel
Location Request towards this old MME. This message will be routed to MME
directly based on the old MME Identity.
7\. The old MME deregisters the UE and sends Cancel Location Response to the
HSS FE.
8\. After the UE reselects 4G and performs Tracking Area Update procedure in
4G, the new MME sends Update Location Request towards the HSS FE. As the UDM
is the only access point both to 5GC and EPC, this message is sent to UDM and
the UDM relays this message to HSS FE.
9\. The HSS stores the new MME information into EPS UDR via Ud interface.
10\. The HSS sends Update Location Response to new MME via UDM including the
UE 4G subscription.
11\. Because the UE has been registered in 5G and a dedicated MME Identity
pointing to the UDM is stored in the EPS UDR, the EPS UDR triggers the HSS FE
to send Cancel Location Request towards the UDM. This message will be routed
to UDM based on the dedicated MME Identity.
12\. UDM sends Cancel Location Response to HSS FE.
13\. Upon receiving Cancel Location Request from HSS FE targeting to
deregister the UE in 5G, the UDM initiated Deregistration procedure to
deregister the UE in 5G.
#### 6.3.3.2 IP address continuity of interworking without N26 from 5GS to EPS
The procedure of the interaction between UDM and HSS FE is shown in Figure
6.3.3.2-1.
Figure 6.3.3.2-1: IP continuity procedure for interworking without N26 from
5GS to EPS
0\. PGW-C+SMF registers its FQDN in UDM during registration procedure. UDM
stores the FQDN in 5GS UDR.
1\. When the UE attaches in EPS due to interworking without N26 from 5GS to
EPS, during the procedure, MME sends Update Location Request to UDM.
2\. UDM forwards Update Location Request to HSS FE for further handling.
3\. HSS FE interacts with EPS UDR to handle Update Location Request.
4\. HSS FE returns Update Location Ack to UDM.
5\. after receiving Update Location Ack, UDM retrieve PGW-C+SMF FQDN from 5GS
UDR.
6\. UDM generates a new Update Location Ack to add PGW-C+SMF FQDN into the
message and forwards the message to MME.
NOTE: the other signalling interactions not related to the solution are not
present in this figure for simplification.
#### 6.3.3.3 T-ADS for IMS voice
The procedure of the interaction between UDM and HSS FE is shown in Figure
6.3.3.3-1.
Figure 6.3.3.3-1: T-ADS Procedure between UDM and HSS FE
1\. SCC AS initiates T-ADS query towards UDM by sending a User-Data-Request
message via Sh interface.
2\. UDM forwards this User-Data-Request message to get T-ADS information
related to EPS and UMTS.
3\. HSS FE may query MME to get more T-ADS information as specified in TS
23.401 [16].
4\. HSS FE may query SGSN to get more T-ADS information as specified in TS
23.060 [15].
5\. HSS FE returns T-ADS information based on the information it derives by
sending a User-Data-Answer message.
6\. after receiving T-ADS information from HSS FE, UDM may query AMF for more
T-ADS information as specified in TS 23.501 [6].
7\. UDM determines T-ADS result based on T-ADS information received from HSS
FE and AMF and responds to SCC AS with the T-ADS information by sending a
User-Data-Answer message.
NOTE: the other signalling interactions not related to the solution are not
present in this figure for simplification.
For the single registration case the following message flow in figure
6.3.3.3-2 applies:
Figure 6.3.3.3-2: T-ADS Procedure with Single registration and UE is 5GS
registered
In Figure 6.3.3.3-2 it is clear that due to the fake registration concept, the
HSS is the entity that is in charge of taking T-ADS decisions, and not the
UDM, even when the UE is registered in the 5GS with the UDM.
#### 6.3.3.4 **S** upporting IMS related procedures
The procedure of the interaction between UDM and HSS FE is shown in Figure
6.3.3.4-1.
Figure 6.3.3.4-1: IMS procedures between UDM and HSS FE
1a or 1b. UDM receives Cx/Dx requests or Sh requests from IMS.
2\. UDM identifies these requests are for IMS procedures, and forwards the
requests to HSS FE.
3\. HSS FE interacts with EPS UDR to handle the requests.
4\. HSS FE sends responses to the requests to UDM.
5a or 5b. UDM forwards the received responses to IMS accordingly.
6\. EPS UDR and HSS FE may generates requests to IMS, e.g. PNR to IMS AS or
RTR to S-CSCF.
7\. HSS FE sends the requests to UDM.
8a or 8b. UDM forwards the requests to IMS accordingly.
9a or 9b. IMS sends responses to the requests to UDM.
10\. UDM forwards the responses to HSS FE.
NOTE: the other signalling interactions not related to the solution are not
present in this figure for simplification.
#### 6.3.3.5 SMSF address storage and retrieval
The procedure of the interaction between UDM and HSS FE is shown in Figure
6.3.3.5-1.
Figure 6.3.3.5-1: SMSF address storage and retrieval between UDM and HSS FE
1\. SMSF invokes Nudm_UECM_Registration service operation to register its
address in UDM.
2\. UDM interacts with 5GS UDR to store the SMSF address.
3\. When SMS-SC or SMS GMSC initiates MT SMS delivery procedure, SMS-SC or SMS
GMSC send MAP request i.e. Send Routing Information for SM request, to UDM.
4\. UDM interacts with 5GS UDR to retrieve stored SMSF address.
5\. UDM responds with SMSF address.
Editor\'s note: How other procedures is supported, e.g. UDM and HSS support MT
SMS domain selection to provide other available SMS delivery addresses, is
FFS.
### 6.3.4 Impacts on existing services and interfaces
#### 6.3.4.1 Authentication impacts
UDM supports:
\- generating Diameter S6a Authentication-Information-Request message based on
Nudm_UEAuthentication_Get service operation;
\- forwarding Diameter S6a Authentication-Information-Answer message with
authentication vectors to MME;
\- generating the respond to Nudm_UEAuthentication_Get service operation
invocation with authentication vectors received in Authentication-Information-
Answer, and sends the respond to AMF;
\- generating and sending Location Update Request message to perform fake 4G
registration in HSS FE when the UE is registered in 5G;
\- de-registering the UE in 5G when it receives Cancel Location request with
dedicated MME Identity from the HSS FE.
HSS FE: No impact.
5GS UDR: No impact.
EPS UDR: No impact.
#### 6.3.4.2 IP address continuity impacts
UDM supports:
\- forwarding Diameter S6a Update Location Request message to HSS FE;
\- retrieving PGW-C+SMF FQDN from 5GS UDR after receiving Update Location Ack
from HSS FE;
\- generating new Update Location Ack to add PGW-C+SMF FQDN into the message
and forwarding the message to MME.
HSS FE: No impact.
5GS UDR: No impact.
EPS UDR: No impact.
#### 6.3.4.3 T-ADS for voice impacts
UDM supports:
\- forwarding User-Data-Answer message to HSS FE;
\- determine T-ADS result based on T-ADS information received from HSS FE and
AMF.
HSS FE: No impact.
5GS UDR: No impact.
EPS UDR: No impact.
#### 6.3.4.4 **S** upporting IMS related procedures
UDM supports:
\- forwarding requests for IMS procedures received from IMS to HSS FE and
further forwarding responses from HSS FE to IMS;
\- forwarding requests for IMS procedures received from HSS FE to IMS and
further forwarding responses from IMS to HSS FE.
HSS FE: No impact.
5GS UDR: No impact.
EPS UDR: No impact.
### 6.3.5 Evaluation
The Solution does not provide the possibility to deploy a pure UDM without HSS
functionality.
The EPS and 5GS UDRs both need to keep up to date registration status for the
UE, i.e. the EPS UDR has to know the registration status of the UE also when
the UE is in the 5GS (due to the fake registration concept). This means that
there is duplication of registration data in EPS and 5GS UDR, which is adding
load and storage requirement to the system
Due to the fake registration concept, the T-ADS master node is always the
legacy HSS, not the UDM, even when the UE is 5GS registered. So, the
functional allocation between 5GS and EPS specific entities is blurred for as
long as there are combined 4G/5G subscribers.
S6a specification impact where the 5G authentication vectors need to be
carried and also 5G vectors need to be requested.
NOTE: The above authentication related issue should be evaluated by SA WG3.
## 6.4 Solution #4: Use of a Data Access Layer for interaction between HSS FE
and UDM with common repository
### 6.4.1 Introduction
This solution applies to Key Issue 2 and describes how HSS FE and UDM interact
when data repositories are common.
### 6.4.2 High-level Description
#### 6.4.2.1 Assumptions
It is assumed that:
\- UE 4G and 5G profiles in the common repository may be a common record for
the UE or be split into different records.
\- The solution leverages EPS UDR to become the common repository for 4G and
5G subscription profiles to be accessed by means of the Ud reference point.
\- Technologies and protocols to access the data stored in the common
repository are assumed to be database specific or proprietary, but exposing Ud
operations to query, create, delete and update of data, as well as
subscriptions/notifications to modifications of such data.
\- 5G UEs are assumed to be provisioned in the repository and able to use 4G
networks (with the corresponding limitations). 4G UEs are provisioned in the
repository, as of today, but not assumed to be able to use 5G core services.
\- From an authentication perspective, this proposal assumes ARPF to be a
separate entity from UDM, collocated with or incorporated to the HE/AuC
specified in TS 33.401 [13], and it does not specifically address separation
of ARPF logic from ARPF storage, in which case the interface would remain
unspecified as it is for HE(AuC). This implies that each system will retrieve
authentication data from the same subscriber credentials storage and vectors
generation will be performed without SQN reuse. For handovers security with
and without N26 for single and dual registration modes, the same procedures as
described in TS 33.501 [12] clause 8 are assumed. - The IMS data for the UEs
is assumed to be stored in the same common repository.
\- From an IMS interaction perspective, it is assumed that IMS HSS/SLF is a
logical entity that can act as an application front end making use of the
common repository, following the specification TS 23.335 [3] and implementing
Cx/Dx and Sh/Dh interfaces that remain untouched. The colocation of IMS
HSS/SLF and HSS FE is an operator option.
NOTE: This is considered as a temporary solution in order to cope with the
transition of legacy IMS towards a service based IMS, work in progress in TR
23.794 [14].
#### 6.4.2.2 Architectural proposal
This solution makes use of a layer that separates the applications front end
logic from the database technology/protocol used, leveraging the authorisation
and policing capabilities from Rel-15 data storage architecture, and
incorporating additional features to serve interworking with legacy systems.
Hence, in addition to access control for application front ends, policing and
offering a common view of the information irrespective of where it is stored,
the solution adds protocol conversion between application front ends and the
repository, as well as a notifications engine to mimic the relevant
notifications that will trigger specific procedures at the different front end
applications and related to handovers between one system and the other.
The solution facilitates keeping existing deployments of application front
ends and their repositories without modification, and provides a flexible
model to introduce new application front ends without having to impact
existing deployments and procedures.
With few updates compared to what is reflected in the next clauses, the
solution also facilitates migration of 4G users to be able to receive services
from the 5G core, with the limitations imposed by 4G subscriptions, as when
e.g. accessing the 5GC from a E-UTRAN radio access (option 5 type of
deployment).
Figure 6.4.2.2-1: High level architecture for interaction of HSS FE and UDM
with common repository
Figure 6.4.2.2-2: High level architecture for interaction of HSS FE, IMS
HSS/SLF and UDM with common repository
### 6.4.3 Services and Illustrated Procedures
#### 6.4.3.1 General description
The proposed data access layer will subscribe to changes performed in the
repository, issuing some notifications towards the UDM or the HSS FE for
specific UEs that may maintain profiles for 4G and 5G.
Figure 6.4.3.1-1: General procedure for notifications via the Data Access
Layer
#### 6.4.3.2 5GS procedures
The procedures specified in TS 23.502 [2] for Registration (clause 4.2.2.2),
Deregistration (clause 4.2.2.3), UE Configuration Update (clause 4.2.4),
Reachability procedures (clause 4.2.5), Session Management (clause 4.3), and
User profile Management (clause 4.2.5) do not change when introducing this
solution.
Authentication procedures at registration (step 9 in clause 4.2.2.2 of TS
23.502 [2]) does not change either when introducing this solution.
Any potential query of information related to the 4G subscription profile of
the UE, would imply a mapping/translation of the NUdr_DM_Query in the Data
Access Layer to be converted into a Ud query.
#### 6.4.3.3 EPS procedures
EPS procedures, including authentication ones, are not expected to be affected
from the point of view of network signalling.
The Data Access Layer will subscribe to changes in the common repository
related to 5G subscribers having also 4G profiles. When any action is
performed at the level of 4G data for the particular UE (like attachment,
detachment, etc), the Data Access Layer will issue a notification towards the
UDM. UDM will perform any action needed depending on the status of the UE,
interworking needed, etc.
This is intended to facilitate the tracking of the subscriber in either
system, in order to execute the relevant deregistration in case the subscriber
moves from one to the other.
Figure 6.4.3.3-1: Notification to UDM when UE attaches to EPS
The Ud Request expected to trigger a notification is Update Data as specified
by TS 23.335 [3]. There is no need to notify any query of data performed by
HSS FE.
Any potential query of information related to the 5G subscription profile of
the UE, would imply a mapping/translation of the Ud Query in the Data Access
Layer to be converted into a query to the common repository.
As the technologies and protocols used to access the data stored in the common
repository are operator deployment choices, the mapping of the response
depicted in the previous chart to the Nudr_DM_Notify operation towards the UDM
is left as an operator deployment choice in agreement with its vendors.
#### 6.4.3.4 Handover procedures
##### 6.4.3.4.0 General
For handover procedures, three cases are differentiated according to TS 23.501
[6] and TS 23.502 [2]:
\- Single registration mode with N26 support.
\- Single registration mode without N26 support.
\- Dual registration.
For single registration mode with N26 support, any registration/attachment
shall convey a cancelation of the location in the source system.
For single registration without N26 support, registration/attachment shall
also convey a cancelation of the location in the source system if simultaneous
registration of both MME and AMF is not supported, according to TS 23.501 [6]
clause 5.17.2.3.1.
NOTE 1: Since UDM and HSS FE are split but common repository exists, the
support of simultaneous registration of MME and AMF should be configurable in
UDM, HSS FE and in the proposed Access Data Layer
This solution proposes that, in single registration modes with and without
N26, the PGW-C+SMF with corresponding APN/DNN is stored in the common
repository, either in a single record or separate ones, and updated/queried by
either party in the different handover scenarios.
NOTE 2: Storing of PGW-C+SMF and APN/DNN information in the same EPS UDR
record will preclude the possibility of proper behaviour of dual registration
procedures.
This can be achieved as follows:
Figure 6.4.3.4.0-1: Storage of PGW-C+SMF and APN/DNN with UE camping in EPS in
single registration mode
While for 5GS, it is stored as following:
Figure 6.4.3.4.0-2: Storage of PGW-C+SMF and APN/DNN with UE camping in 5GS in
single registration mode
For handover procedures in dual registration mode, the information needs to be
stored in different records of the EPS UDR. The UE will remain
registered/attached to the two system simultaneously with valid subscription
data for both systems at the same time. Moving sessions between systems
remains a UE implementation option.
##### 6.4.3.4.1 5GS to EPS with N26
In 5GS to EPS handovers, the attach in the EPS will generate a Ud Request to
modify data by HSS FE followed by a Response by the repository and a
notification to the Data Access Layer. This will trigger a notification to the
UDM to indicate the UE is now under EPS control. UDM should in turn modify the
location data in the 5G profile and will proceed to deregister the AMF the UE
moved from.
Figure 6.4.3.4.1-1: Notification to the UDM at UE attachment to EPS
No other action is expected to be performed by the UDM, and the control by the
EPS will proceed as specified in the TS 23.502 [2], clause 4.11.1.2.1, with
the difference that the HSS FE will not cancel the location of the AMF during
the TAU procedure. Instead, the HSS FE will acknowledge the location update to
the new MME and proceed as normal.
##### 6.4.3.4.2 EPS to 5GS with N26
In EPS to 5GS handovers, the registration in the 5GS will generate a Nudr
request and subsequent notification when data is stored in the common
repository. The Data Access Layer will capture that and generate a
notification towards the HSS FE indicating the UE has left the EPS.
Figure 6.4.3.4.2-1: Notification to the HSS FE at UE registration in 5GS
NOTE: HSS FE subscribed to changes in the common repository when UE data was
stored.
The procedure follows the specification in TS 23.502 [2] clause 4.11.1.2.2
with the modification that it is the HSS FE the one initiating the relevant
cancel location towards the MME node the UE has moved from.
##### 6.4.3.4.3 5GS to EPS without N26 - single registration
For single registration without N26, HSS FE will be configured as not
supporting dual registration. Thus, the attach to the EPS when UE moves from
5GS to EPS, will imply a cancelation of location in the AMF from where the UE
moved.
This procedure is aligned with what is described in clause 6.4.3.4.1 of this
solution.
The EPS attach is expected to trigger a Ud Update operation towards the EPS
UDR, and a response to HSS FE including the PGW-C+SMF address (together with
APN/DNN information) being used.
##### 6.4.3.4.4 EPS to 5GS without N26 - single registration
For single registration without N26, UDM will be configured as not supporting
dual registration. Thus, the registration to the 5GS when UE moves from EPS to
5GS, will imply a cancelation of location in the MME from where the UE moved.
The registration in the 5GS, would trigger a notification to the Access Data
Layer that, in turn, would imply a Ud notification to the HSS FE to cancel the
location in the MME. This procedure is aligned with what is described in
clause 6.4.3.4.2 of this solution.
##### 6.4.3.4.5 Handovers without N26 - dual registration
For handover procedures in dual registration mode, the UE will remain
registered/attached to the two system simultaneously with valid subscription
data for both systems at the same time, including valid session information
for both systems. Moving sessions between systems remains as a UE
implementation option.
Attachment/Registration of the UE in either system does not convey any
cancellation in the source system. This is achieved by analysing the UDM and
HSS FE configuration to support or not dual registrations.
#### 6.4.3.5 IMS interaction
##### 6.4.3.5.1 Access to IMS data
Access to IMS data for creation, deletion, query and modification follows the
specification in TS 23.228 [7] and TS 23.335 [3] by IMS making use of the IMS
HSS/SLF functionality (either as a stand-alone application front end or
collocated with HSS FE).
It is not expected that any of the IMS entities need to interact with UDM,
with the exception of the P-CSCF restoration mechanism invoked by S-CSCF, and
the T-ADS information retrieval by the IMS AS.
For these specific cases, it is proposed to use the SLF functionality for UE
identity to UDM identity or HSS FE identity resolution, according to TS 23.228
[7] clause 5.8.
NOTE 1: It is proposed to introduce SLF functionality since the split of UDM
and HSS FE will imply multiple addressable location servers for the 5G UEs and
these IMS procedures.
NOTE 2: Since the I-CSCF, S-CSCF and IMS AS will always interrogate the SLF to
find the location server serving the UE, the SLF needs to be configured to
return the IMS HSS address in first place since it is the front end able to
return the IMS profile for the UE.
Any Cx or Sh operation triggered by CSCF or IMS AS, except restoration and
T-ADS information retrieval, will be handled by the IMS HSS front end (either
stand alone or collocated with the HSS FE).
When UE is registered to IMS, the common repository will contain the
indication regarding the UE being served by 5GS or EPS. This is proposed to be
done as per the description in the common procedures, regardless the UE re-
registers or not to IMS when moving between the systems (according to clause
5.2.2.4 of TS 23.228 [7]). This indication is proposed to be checked when
either P-CSCF restoration or T-ADS information retrieval is received by UDM or
HSS FE (see next clauses).
In principle, both UDM and HSS FE would not require any additional action than
what is described before for the general procedures.
##### 6.4.3.5.2 P-CSCF Restoration procedures
The P-CSCF restoration procedure via UDM is an optional mechanism according to
TS 23.380 [8].
The following two options are considered regardless the support of N26 and UE
mode of operation (single or dual registration).
**\- Option 1:** When UDM and HSS FE are split, the preferred P-CSCF
restoration procedure would be that performed by detection of the failure by
SMF/UPF according to TS 23.380 [8] clause 5.8.3, or using the PCF based P-CSCF
restoration as specified in clause 5.8.5 of TS 23.380 [8].
NOTE 1: The adaptation of IMS to service based architecture, making use of
proper virtualisation/cloud mechanisms for e.g.self-healing, high
availability, redundancy, etc, would most likely make unnecessary the use of
the current restoration procedures.
**\- Option 2:** To enable the P-CSCF restoration via either the UDM or the
HSS FE, the SLF functionality is invoked in order to perform a user identity
to HSS FE identity or UDM identity resolution.
The SLF will return the list of different servers (UDMs and HSS FEs) that may
be in charge of the UE at that point in time, for the S-CSCF to request the
relevant P-CSCF restoration mechanism to the relevant entity. This procedure
is according to TS 29.228 [10] clause 6.4.
Figure 6.4.3.5.2-1: User identity to HSS FE identity or UDM identity
resolution for S-CSCF
NOTE 2: This assumes that UDM implements the Cx operations SAR/SAA to trigger
the P-CSCF restoration. Potential conversion of Diameter Cx operation to an
Nudm service operation is out of the scope of this study.
NOTE 3: It is assumed that S-CSCF is aware of the IMS registration status of
the UE prior to request P-CSCF restoration.
Both HSS FE and UDM will check the UE registration status in the corresponding
network (either 5GS or EPS) in order to either execute the procedure
(according to TS 23.380 [8]) or reject it.
No other impact is expected for restoration.
##### 6.4.3.5.3 Terminating domain selection information for IMS voice
According to TS 23.501 [6], clause 5.16.3.6, the UDM/HSS shall be able to
query the serving AMF for T-ADS related information, and AMF shall respond to
the query with the relevant information unless the UE is detached:
\- whether or not IMS voice over PS Session is supported in the registration
area(s) where the UE is currently registered;
\- whether or not IMS voice over PS Session Supported Indication over non-3GPP
access is supported in the WLAN where the UE is currently registered;
\- the time of the last radio contact with the UE; and
\- the current Access Type and RAT type.
Retrieval of T-ADS information is initiated by the IMS AS.
To retrieve the T-ADS information from either the UDM or the HSS FE, the SLF
functionality is invoked in order to perform a user identity to HSS FE
identity or UDM identity resolution.
The SLF will return the list of different servers (UDMs and HSS FEs) that may
be in charge of the UE at that point in time, for the IMS AS to request the
information for access domain selection. This procedure is according to TS
29.328 [11] clause 6.5.
If the UE is attached to IMS via 5GS, the T-ADS information request to the IMS
HSS/SLF will end up in a Sh request (UDR/UDA) to UDM, which in turn will
invoke the AMF service Namf_MT_ ProvideDomainSelectionInfo as specified in TS
23.501 [6] clause 5.16.3.6 and TS 23.228 [7] annex Y.
To translate IMPU to SUPI, for the cases in which the Sh request is based on
IMPU, the 5G UDR can incorporate a new data key (=IMPU) for the Subscription
Data data set to be used for the Nudr_DM_Query operation, in order to request
identifier translation from IMPU to SUPI.:
The query to the 5G UDR is simply converted by the Access Data Layer into a Ud
request to the EPS UDR repository hosting the IMS data, in order to retrieve
the IMSI that is associated with the IMPU received in the Sh request.
The request from IMS AS, when the UE is attached to the EPS, should follow the
same procedures as defined in TS 23.228 [7] clause 4.2.4a.
NOTE 1: It is assumed that IMS AS is aware of the IMS registration status of
the UE prior to request T-ADS information.
Both UDM and HSS FE will check the registration status in the corresponding
network in order to either execute the procedure (according to TS 23.228 [7])
or reject it.
In case of dual registration, and according to annex D of TS 29.328 [11], the
IMS AS will expect the T-ADS information containing 0 or 1 RAT types,
depending on whether IMS Voice over PS is supported or not. So, in order to
avoid impacts on the IMS AS, this solution proposes that UDM and HSS FE are
configured with indication regarding being the default system for IMS voice.
Both will inspect this default indication, in order to execute the T-ADS
information retrieval procedure, or reject it.
Figure 6.4.3.5.3-1: User identity to HSS FE identity or UDM identity
resolution for IMS AS
NOTE 2: This assumes that UDM implements the Sh operations UDR/UDA to trigger
the T-ADS retrieval procedure. Potential conversion of Diameter Sh operation
to an Nudm service operation is out of the scope of this study.
### 6.4.4 Impacts on existing services and interfaces
#### 6.4.4.1 General
This solution addresses scenarios in which the operator deployment is already
a layered architecture according to TS 23.335 [3] or when user data are stored
in an external entity via non-standard interfaces, according to TS 23.002 [5],
clause 4.1.1. Purely monolithic scenarios, in which the user data are stored
within the HSS itself, would need to migrate towards a layered architecture.
The solution is basically an operator choice restricted to the introduction of
a Data Access Layer with the capabilities described in clauses 6.4.3.1 to
6.4.3.4, and does not impact the specified interfaces with new operations.
The solution is also based on network configuration, by including SLF
functionality for every IMS operation directed towards a location server
(either HSS FE, IMS HSS or UDM). The SLF is configured as the contact point
for I-CSCF, S-CSCF and IMS AS, and needs to be provisioned with the list of
location servers serving the UEs in the network.
The solution proposes to add information regarding the system registration
status, i.e. the system serving the UE:
\- For 5G profile, this extension can be handled as the resources
Amf3GppAccessRegistration and AmfNon3GppAccessRegistration in the
Nudr_DM_Update service operation as specified in TS 29.505 [9].
\- For 4G profile, this extension can be mapped to the repository field where
MME reference is held. Since the organisation of data in the EPS UDR is not
standardised, this mapping would be left for implementation.
Finally, the solution proposes adding the Sh pair UDR/UDA (Diameter) to UDM as
a temporary solution until IMS is adapted to service based architecture or any
other solution is specified for T-ADS information retrieval by IMS.
It also proposes to add a new data key (=IMPU) to the Subscription Data data
set in the Nudr_DM_Query operation.
#### 6.4.4.2 Summary of impacts on UDM
\- For handovers without N26 support:
\- Add configuration indication regarding support or not of dual registrations
\- For T-ADS information retrieval: Add Sh pair UDR/UDA in case of single and
dual registrations:
\- Add indication regarding default system for IMS Voice over PS for dual
registration mode of operation.
\- For P-CSCF restoration:
\- For Option 1, no impact (i.e. make use of PCF based restoration or
detection of failure by SMF/UPF)
\- For Option 2: Add Cx pair SAR/SAA for P-CSCF restoration
#### 6.4.4.3 Summary of impacts on HSS FE
No impact for procedures with N26 support.
For handovers without N26 support:
\- Add configuration indication regarding support or not of dual
registrations.
For T-ADS information retrieval in dual registration mode of operation:
\- Add indication regarding default system for IMS Voice over PS.
#### 6.4.4.4 Summary of impacts on EPS UDR
The impacts on the EPS UDR are left for implementation, since the protocols to
access and the organisation of data is implementation specific.
### 6.4.5 Evaluation
Solution 4 proposes an architecture that does not require direct interaction
between the UDM and the HSS FE.
The solution makes use of an adaptation layer, named Access Data Layer, that
separates the applications front end logic from database technology/protocol
in the back end repositories.
The solution addresses all interworking scenarios depicted in TS 23.501 [6]
and TS 23.502 [2], including support for IMS procedures.
The advantages of this solution is that:
\- It addresses effective separation of HSS FE and UDM to enable multivendor
deployments
\- It avoids new interface and new operations specification between the HSS
and UDM
\- It is possible to introduce only UDM when deploying a 5GS system, without
having to update/upgrade the HSS FE, or having to introduce this functionality
in deployments with single core network.
\- Standardisation effort is minimised and restricted to potential
incorporation of Sh/Cx operations for UDM, in case FS_eIMS5G study (TS 23.794
[14]) does not incorporate the changes needed for P-CSCF restoration and T-ADS
information retrieval.
\- Introduction of this solution does not impact other network functions that
may be accessing the different repositories, while it provides the means to
further split other network functions defined in Rel-15 (i.e. PCF/PCRF).
The disadvantage of this solution is to making use of SLF functionality for
IMS when some deployments may not be using it.
This solution would not be possible if a monolithic HSS is deployed, unless
this monolithic HSS becomes the shared subscriptions repository that
interfaces to the Data access layer.
In a scenario where a layered architecture is used, taking into account that
Ud data model is not standardised, this would require that the Data Access
Layer is aware of the structure of the Ud notifications deployed by the
operator, i.e. the Data Access Layer needs to be implemented in alignment with
the existing EPS UDR implementations.
## 6.5 Solution #5: Use of a Data Access Layer for interaction between HSS FE
and UDM with separate repositories
### 6.5.1 Introduction
This solution applies to Key Issue 1 and describes how HSS FE and UDM interact
when data repositories are separate.
### 6.5.2 High-level Description
#### 6.5.2.1 Assumptions
It is assumed that:
\- Technologies and protocols to access the data stored in the 5G repository
are assumed to be database specific or proprietary, but exposing operations to
query, create, delete and update of data, as well as
subscriptions/notifications to modifications of such data..
\- 5G UEs are assumed to be provisioned in the 5G repository and able to use
4G networks (with the corresponding limitations). 4G UEs are provisioned in
the EPS UDR, as of today, but not assumed to be able to use 5G core services.
\- From an authentication perspective, this proposal assumes ARPF to be a
separate entity from UDM, collocated with or incorporated to the HE/AuC
specified in TS 33.401 [13], and it does not specifically address separation
of ARPF logic from ARPF storage, in which case the interface would remain
unspecified as it is for HE(AuC). This implies that each system will retrieve
authentication data from the same subscriber credentials storage and vectors
generation will be performed without SQN reuse. For handovers security with
and without N26 for single and dual registration modes, the same procedures as
described in TS 33.501 [12] clause 8 are assumed.
\- The IMS data for the UEs is assumed to be stored in the EPS UDR.
\- From an IMS interaction perspective, it is assumed that IMS HSS/SLF is a
logical entity that can act as an application front end making use of the EPS
UDR, following the specification TS 23.335 [3] and implementing Cx/Dx and
Sh/Dh interfaces that remain untouched. The colocation of IMS HSS/SLF and HSS
FE is an operator option.
NOTE: This is considered as a temporary solution in order to cope with the
transition of legacy IMS towards a service based IMS, work in progress in TR
23.794 [14].
#### 6.5.2.2 Architectural proposal
This solution makes use of a layer that separates the applications front end
logic from the database technology/protocol used, leveraging the authorisation
and policing capabilities from Rel-15 data storage architecture, and
incorporating additional features to serve interworking with legacy systems.
Hence, in addition to access control for application front ends, policing and
offering a common view of the information irrespective of where it is stored,
the solution adds protocol conversion between application front ends and the
repository, as well as a notifications engine to mimic the relevant
notifications that will trigger specific procedures at the different front end
applications and related to handovers between one system and the other.
The solution uses similar concepts as the current Solution #1 (\"Retrieving
subscription data from separate UDR repositories for EPS and 5GS subscription
data using a UDR Translation Function (UTF)\"), but makes use of different
procedures for IMS interactions.
Figure 6.5.2.2-1: High level architecture for interaction of HSS FE and UDM
with separate repositories
Figure 6.5.2.2-2: High level architecture for interaction of HSS FE, IMS
HSS/SLF and UDM with separate repositories
### 6.5.3 Services and Illustrated Procedures
#### 6.5.3.1 General description
The proposed data access layer will subscribe to changes performed in the EPS
UDR and 5G repository, issuing some notifications towards the UDM or the HSS
FE for specific UEs that may maintain profiles for 4G and 5G. When needed, the
Data Access layer translates Nudr operations issued by UDM into Ud requests
towards the EPS UDR and vice-versa.
Figure 6.5.3.1-1: General procedure for notifications via a Data Access Layer
#### 6.5.3.2 5GS procedures
The procedures specified in TS 23.502 [2] for Registration (clause 4.2.2.2),
Deregistration (clause 4.2.2.3), UE Configuration Update (clause 4.2.4),
Reachability procedures (clause 4.2.5), Session Management (clause 4.3), and
User profile Management (clause 4.2.5) do not change when introducing this
solution.
Authentication procedures at registration (step 9 in clause 4.2.2.2 of TS
23.502 [2]) does not change either when introducing this solution.
Any potential query of information related to the 4G subscription profile of
the UE, would imply a mapping/translation of the NUdr_DM_Query in the Data
Access Layer to be converted into a Ud query to the EPS UDR.
#### 6.5.3.3 EPS procedures
EPS procedures, including authentication ones, are not expected to be affected
from the point of view of network signalling.
The Data Access Layer will subscribe to changes in the EPS UDR related to 5G
subscribers having also 4G profiles in the EPS UDR. When any action is
performed at the level of 4G data for the particular UE (like attachment,
detachment, etc), the Data Access Layer will issue a notification towards the
UDM. UDM will perform any action needed depending on the status of the UE,
interworking needed, etc.
This is intended to facilitate the tracking of the subscriber in either
system, in order to execute the relevant deregistration in case the subscriber
moves from one to the other.
Figure 6.5.3.3-1: Notification to UDM when UE attaches to EPS
The Ud Request expected to trigger a notification is Update Data as specified
by TS 23.335 [3]. There is no need to notify any query of data performed by
HSS FE.
Any potential query of information related to the 5G subscription profile of
the UE, would imply a mapping/translation of the Ud Query in the Data Access
Layer to be converted into a query to the 5G repository.
As the technologies and protocols used to access the data stored in the
repositories are operator deployment choices, the mapping of the Ud Notify
depicted in the previous chart to the Nudr_DM_Notify operation towards the UDM
is left as an operator deployment choice in agreement with its vendors.
#### 6.5.3.4 Handover procedures
##### 6.5.3.4.0 General
For handover procedures, three cases are differentiated according to TS 23.501
[6] and TS 23.502 [2]:
\- Single registration mode with N26 support.
\- Single registration mode without N26 support.
\- Dual registration.
For single registration mode with N26 support, any registration/attachment
shall convey a cancelation of the location in the source system. The UE
subscription data, with the exception of the Intersystem Continuity Data, will
be valid in only one of the systems at a time.
For single registration without N26 support, registration/attachment shall
also convey a cancelation of the location in the source system if simultaneous
registration of both MME and AMF is not supported, according to TS 23.501 [6]
clause 5.17.2.3.1.
NOTE 1: Since UDM and HSS FE are split and separate repositories exist,
simultaneous registration of MME and AMF should always be possible, unless it
is disabled by configuration in UDM, HSS FE and in the proposed Access Data
Layer.
This solution proposes that, in single registration modes with and without
N26, the PGW-C+SMF with corresponding APN/DNN is replicated in both
repositories and updated/queried by either party from their associated back-
end repository. I.e. at handover 5GS-EPS, HSS FE will query from EPS UDR and
at EPS-5GS, UDM will query the 5G UDR.
This replication, together with an indication regarding the UE being served by
5GC or EPC facilitates all handover scenarios with single registration.
This can be achieved as follows:
Figure 6.5.3.4.0-1: Storage of PGW-C+SMF and APN/DNN with UE camping in EPS in
single registration mode
While for 5GS, it is stored as following:
Figure 6.5.3.4.0-2: Storage of PGW-C+SMF and APN/DNN with UE camping in 5GS in
single registration mode
NOTE 2: To avoid impacts on HSS FE and its related procedures, the data is
written directly by the Data Access Layer. HSS FE will find the information
available when UE camps back in EPS and requests continuity for single
registration without N26
For handover procedures in dual registration mode, the UE will remain
registered/attached to the two system simultaneously with valid subscription
data in both systems at the same time. Moving sessions between systems remains
as a UE implementation option.
##### 6.5.3.4.1 5GS to EPS with N26
In 5GS to EPS handovers, the attach in the EPS will generate a Ud Request to
modify data by HSS FE followed by a Ud Response by the EPS UDR and a Ud
notification to the Data Access Layer. This will trigger a Nudr_DM_Notify to
the UDM to indicate the UE is now under EPS control. UDM should in turn modify
the location data in the 5G profile and will proceed to deregister the AMF the
UE moved from.
Figure 6.5.3.4.1-1: Notification to UDM at UE attachment to EPS
No other action is expected to be performed by the UDM, and the control by the
EPS will proceed as specified in the TS 23.502 [2], clause 4.11.1.2.1, with
the difference that the HSS FE will not cancel the location of the AMF during
the TAU procedure.
Instead, the HSS FE will acknowledge the location update to the new MME and
proceed as normal and it will be the UDM the one deregistering the AMF
following the flow shown before.
##### 6.5.3.4.2 EPS to 5GS with N26
In EPS to 5GS handovers, the registration in the 5GS will generate a Nudr
request and subsequent notification when data is stored in the 5G repository.
The Data Access Layer will capture that and generate a notification towards
the HSS FE indicating the UE has left the EPS.
Figure 6.5.3.4.2-1: Notification to HSS FE at UE registration in 5GS
NOTE 1: HSS FE subscribed to changes regarding UEs having 4G and 5G profiles.
The procedure follows the specification in TS 23.502 [2] clause 4.11.1.2.2
with the modification that it is the HSS FE the one initiating the relevant
cancel location towards the MME node the UE has moved from.
NOTE 2: The mapping of the acknowledgement from the 5G repository to the Ud
Notify towards the HSS FE depicted in the previous chart is left for
implementation based on operator deployment.
As an alternative to the previous flow, the Data Access Layer can modify the
UE data in the EPS UDR, which in turn would trigger a notification towards the
HSS FE (HSS FE would have subscribed to changes in the EPS UDR). This
alternative would save impacts in the HSS FE that would only need to subscribe
to changes in the EPS UDR and be notified when the data is updated.
##### 6.5.3.4.3 5GS to EPS without N26 - single registration
For single registration without N26, HSS FE will be configured as not
supporting dual registration. Thus, the attach to the EPS when UE moves from
5GS to EPS, will imply a cancelation of location in the AMF from where the UE
moved.
This procedure is aligned with what is described in clause 6.5.3.4.1 of this
solution.
The EPS attach is expected to trigger a Ud Update operation towards the EPS
UDR, and a response to HSS FE including the PGW-C+SMF address (together with
APN/DNN information) being used.
The proposal with this solution is to replicate the information in both
repositories. This way EPS UDR will contain the information about PGW-C+SMF
needed for the handover cases and will return it to the MME in the Update
Location Response. See general clause 6.5.3.4.0 of this solution.
##### 6.5.3.4.4 EPS to 5GS without N26 - single registration
For single registration without N26, UDM will be configured as not supporting
dual registration. Thus, the registration to the 5GS when UE moves from EPS to
5GS, will imply a cancelation of location in the MME from where the UE moved.
The registration in the 5GS, would trigger a notification to the Access Data
Layer that, in turn, would imply a Ud notification to the HSS FE to cancel the
location in the MME. This procedure is aligned with what is described in
clause 6.5.3.4.2 of this solution.
##### 6.5.3.4.5 Handovers without N26 - dual registration
For handover procedures in dual registration mode, the UE will remain
registered/attached to the two system simultaneously with valid subscription
data in both systems at the same time. Moving sessions between systems remains
as a UE implementation option.
Attachment/Registration of the UE in either system does not convey any
cancellation in the source system. This is achieved by analysing the UDM and
HSS FE configuration to support or not dual registrations.
#### 6.5.3.5 IMS interaction
##### 6.5.3.5.1 Access to IMS data
Access to IMS data for creation, deletion, query and modification follows the
specification in TS 23.228 [7] and TS 23.335 [3] by IMS making use of the IMS
HSS/SLF functionality (either as a stand alone application front end or
collocated with HSS FE).
It is not expected that any of the IMS entities need to interact with UDM,
with the exception of the P-CSCF restoration mechanism invoked by S-CSCF, and
the T-ADS information retrieval by the IMS AS.
For these specific cases, it is proposed to use the SLF functionality for UE
identity to UDM identity or HSS FE identity resolution, according to TS 23.228
[7] clause 5.8.
NOTE 1: It is proposed to introduce SLF functionality since the split of UDM
and HSS FE will imply multiple addressable location servers for the 5G UEs and
these IMS procedures.
NOTE 2: Since the I-CSCF, S-CSCF and IMS AS will always interrogate the SLF to
find the location server serving the UE, the SLF needs to be configured to
return the IMS HSS address in first place since it is the front end able to
return the IMS profile for the UE.
NOTE 3: The evolution of IMS can also imply the IMS profile of the 5G UEs to
be moved into the 5G repository. This can impact the way some procedures are
executed for the different UEs.
Any Cx or Sh operation triggered by CSCF or IMS AS, except restoration and
T-ADS information retrieval, will be handled by the IMS HSS front end (either
stand alone or collocated with the HSS FE).
When UE is registered to IMS, EPS UDR will contain the indication regarding
the UE being served or not by EPS, and 5G repository will contain the
indication regarding the UE being served by 5GS. This is proposed to be done
as per the description in the common procedures, regardless the UE re-
registers or not to IMS when moving between the systems (according to clause
5.2.2.4 of TS 23.228 [7]).
These indications are proposed to be checked when either P-CSCF restoration or
T-ADS information retrieval is received by UDM or HSS FE (see next clauses).
In principle, both UDM and HSS FE would not require any additional action than
what is described before for the general procedures.
##### 6.5.3.5.2 P-CSCF Restoration procedures
The P-CSCF restoration procedure via UDM is an optional mechanism according to
TS 23.380 [8].
The following two options are considered regardless the support of N26 and UE
mode of operation (single or dual registration).
**\- Option 1:** When UDM and HSS FE are split, the preferred P-CSCF
restoration procedure would be that performed by detection of the failure by
SMF/UPF according to TS 23.380 [8] clause 5.8.3, or using the PCF based P-CSCF
restoration as specified in clause 5.8.5 of TS 23.380 [8].
NOTE 1: The adaptation of IMS to service based architecture, making use of
proper virtualisation/cloud mechanisms for e.g.self-healing, high
availability, redundancy, etc, would most likely make unnecessary the use of
the current restoration procedures.
**\- Option 2:** To enable the P-CSCF restoration via either the UDM or the
HSS FE, the SLF functionality is invoked in order to perform a user identity
to HSS FE identity or UDM identity resolution.
The SLF will return the list of different servers (UDMs and HSS FEs) that may
be in charge of the UE at that point in time, for the S-CSCF to request the
relevant P-CSCF restoration mechanism to the relevant entity. This procedure
is according to TS 29.228 [10] clause 6.4.
Figure 6.5.3.5.2-1: User identity to HSS FE identity or UDM identity
resolution for S-CSCF
NOTE 2: This assumes that UDM implements the Cx operations SAR/SAA to trigger
the P-CSCF restoration. Potential conversion of Diameter Cx operation to an
Nudm service operation is out of the scope of this study.
NOTE 3: It is assumed that S-CSCF is aware of the IMS registration status of
the UE prior to request P-CSCF restoration.
Both HSS FE and UDM will check the UE registration status in the corresponding
network in order to either execute the procedure (according to TS 23.380 [8])
or reject it.
No other impact is expected for restoration.
##### 6.5.3.5.3 Terminating domain selection information for IMS voice
According to TS 23.501 [6], clause 5.16.3.6, the UDM/HSS shall be able to
query the serving AMF for T-ADS related information, and AMF shall respond to
the query with the relevant information unless the UE is detached:
\- whether or not IMS voice over PS Session is supported in the registration
area(s) where the UE is currently registered;
\- whether or not IMS voice over PS Session Supported Indication over non-3GPP
access is supported in the WLAN where the UE is currently registered;
\- the time of the last radio contact with the UE; and
\- the current Access Type and RAT type.
Retrieval of T-ADS information is initiated by the IMS AS.
To retrieve the T-ADS information from either the UDM or the HSS FE, the SLF
functionality is invoked in order to perform a user identity to HSS FE
identity or UDM identity resolution.
The SLF will return the list of different servers (UDMs and HSS FEs) that may
be in charge of the UE at that point in time, for the IMS AS to request the
information for access domain selection. This procedure is according to TS
29.328 [11] clause 6.5.
If the UE is attached to IMS via 5GS, the T-ADS information request to the IMS
HSS/SLF will end up in a Sh request (UDR/UDA) to UDM, which in turn will
invoke the AMF service Namf_MT_ ProvideDomainSelectionInfo as specified in TS
23.501 [6] clause 5.16.3.6 and TS 23.228 [7] Annex Y.
To translate IMPU to SUPI, for the cases in which the Sh request is based on
IMPU, the 5G UDR can incorporate a new data key (=IMPU) for the Subscription
Data data set to be used for the Nudr_DM_Query operation, in order to request
identifier translation from IMPU to SUPI.:
The query to the 5G UDR is simply converted by the Access Data Layer into a Ud
request to the IMS data repository, in order to retrieve the IMSI that is
associated with the IMPU received in the Sh request.
The request from IMS AS, when the UE is attached to the EPS, should follow the
same procedures as defined in TS 23.228 [7] clause 4.2.4a.
NOTE 1: It is assumed that IMS AS is aware of the IMS registration status of
the UE prior to request T-ADS information.
Both UDM and HSS FE will check the registration status in the corresponding
network in order to either execute the procedure (according to TS 23.228 [7])
or reject it.
In case of dual registration, and according to annex D of TS 29.328 [11], the
IMS AS will expect the T-ADS information containing 0 or 1 RAT types,
depending on whether IMS Voice over PS is supported or not. So, in order to
avoid impacts on the IMS AS, this solution proposes that UDM and HSS FE are
configured with indication regarding being the default system for IMS voice.
Both will inspect this default indication, in order to execute the T-ADS
information retrieval procedure, or reject it.
Figure 6.5.3.5.3-1: User identity to HSS FE identity or UDM identity
resolution for IMS AS
NOTE 2: This assumes that UDM implements the Sh operations UDR/UDA to trigger
the T-ADS information retrieval procedure. Potential conversion of Diameter Sh
operation to an Nudm service operation is out of the scope of this study.
### 6.5.4 Impacts on existing services and interfaces
#### 6.5.4.1 General
This solution addresses scenarios in which the operator deployment is already
a layered architecture according to TS 23.335 [3]. Non-layered scenarios would
need to migrate towards a layered architecture prior to deploying this
solution.
The solution is basically an operator choice restricted to the introduction of
a Data Access Layer with the capabilities described in clauses 6.5.3.1 to
6.5.3.4, and does not impact the specified interfaces with new operations.
The solution is also based on network configuration, by including SLF
functionality for every IMS operation directed towards a location server
(either HSS FE, IMS HSS or UDM). The SLF is configured as the contact point
for I-CSCF, S-CSCF and IMS AS, and needs to be provisioned with the list of
location servers serving the UEs in the network.
The solution proposes to add information regarding the system registration
status, i.e. the system serving the UE:
\- For 5G profile, this extension can be handled as the resources
Amf3GppAccessRegistration and AmfNon3GppAccessRegistration in the
Nudr_DM_Update service operation as specified in TS 29.505 [9].
\- For 4G profile, this extension can be mapped to the repository field where
MME reference is held. Since the organisation of data in the EPS UDR is not
standardised, this mapping would be left for implementation.
Finally, the solution proposes adding the Sh pair UDR/UDA (Diameter) to UDM as
a temporary solution until IMS is adapted to service based architecture or any
other solution is specified for T-ADS information retrieval by IMS.
#### 6.5.4.2 Summary of impacts on UDM
\- For handovers without N26 support:
\- Add configuration indication regarding support or not of dual
registrations.
\- For T-ADS information retrieval: Add Sh pair UDR/UDA in case of single and
dual registrations:
\- Add indication regarding default system for IMS Voice over PS for dual
registration mode of operation.
\- For P-CSCF restoration:
\- For Option 1, no impact (i.e. make use of PCF based restoration or
detection of failure by SMF/UPF).
\- For Option 2: Add Cx pair SAR/SAA for P-CSCF restoration.
#### 6.5.4.3 Summary of impacts on HSS FE
No impact on network procedures.
For handovers without N26 support:
\- Add configuration indication regarding support or not of dual registrations
For T-ADS information retrieval in dual registration mode of operation:
\- Add indication regarding default system for IMS Voice over PS.
Depending on operator choice either:
\- A new subscription/notification interaction between HSS FE and the Data
Access Layer in order to be informed when a 5G UE that camped in the EPS has
moved back to 5GS system (in order to trigger a cancel location procedure), or
\- No impact expected, if alternative depicted in clause 6.5.3.4.2 is decided.
#### 6.5.4.4 Summary of impacts on EPS UDR or 5G repository
The impacts on the EPS UDR or 5G repository are left for implementation, since
the protocols and technologies to access their data is implementation
specific.
### 6.5.5 Evaluation
Solution 5 proposes an architecture that does not require direct interaction
between the UDM and the HSS FE or interaction between EPS UDR and 5G UDR.
The solution makes use of an adaptation layer, named Access Data Layer, that
separates the applications front end logic from database technology/protocol
in the back end repositories.
The solution addresses all interworking scenarios depicted in TS 23.501 [6]
and TS 23.502 [2], including support for IMS procedures.
The advantages of this solution is that:
\- It addresses effective separation of HSS FE and UDM and EPS UDR from 5G UDR
to enable multivendor deployments
\- It avoids new interface and new operations specification between the HSS
and UDM
\- It is possible to introduce only UDM and 5G UDR when deploying a 5GS
system, without having to update/upgrade either HSS FE or the EPS UDR, or
having to introduce these functionalities in deployments with single core
network.
\- Standardisation effort is minimised and restricted to potential
incorporation of Sh/Cx operations for UDM, in case FS_eIMS5G study (TS 23.794
[14]) does not incorporate the changes needed for P-CSCF restoration and T-ADS
information retrieval.
\- Introduction of this solution does not impact other network functions that
may be accessing the different repositories, while it provides the means to
further split other network functions defined in Rel-15 (i.e. PCF/PCRF).
The disadvantage of this solution is to making use of SLF functionality for
IMS when some deployments may not be using it.
Additionally, the Ud interaction which terminates on the 5GS UDR means that
the structure of the notifications carried in Ud for this particular case
remains proprietary, implying that the Data Access Layer needs to be
implemented in alignment with the existing HSS FE and EPS UDR implementations.
## 6.6 Solution #6: Deployment and coexistence without interworking between
UDM and existing HSS
### 6.6.1 Introduction
This solution is applicable to Key Issue 1 and Key Issue 2.
This solution proposes a deployment and coexistence alternative which avoids
the need of specification of interworking procedures between UDM and the
existing HSS.
### 6.6.2 High-level Description
This solution proposes an alternative for coexistence between UDM and HSS
based on:
\- Deploying HSS and UDM in a single network entity, referred as Combined
HSS/UDM, supporting interfaces and procedures specified for 5GC, EPC and IMS.
\- UDM and HSS deployed in the Combined network entity may interact with a 5GS
UDR that stores 4G/IMS/5G subscription data for 5G enabled users (when using a
common repository). Alternatively, the Combined HSS/UDM may also use separate
repositories for subscription data of 5G enabled users.
\- The functions of the Combined HSS/UDM are provided by a single network
entity, so that the interactions between HSS and UDM within the Combined
entity are performed internally and therefore it is not required to define
such interworking.
\- The existing HSS and EPS UDR keep serving only 4G users.
\- A routing solution routes Diameter EPC/IMS requests to either the Combined
HSS/UDM for 5G enabled users or the existing HSS for 4G only users. This kind
of solution can be achieved e.g. by using a network entity that provides
SLF/DRA functionality and/or by local configuration in network entities
interacting with HSS (e.g. configuring IMSI ranges in MME), and other
alternatives may be possible. The routing solution includes redundancy
mechanisms to prevent single point of failure issues.
\- There is no need of interworking between UDM and existing HSS out of the
Combined network entity.
\- The different options regarding deployment of subscription data repository
are described below, gathering the considerations described previously.
\- **Option 1** : A common repository is used for the Combined HSS/UDM.
Subscription data of new 5G enabled users is directly provisioned in 5GS UDR.
Subscription data of existing 4G users that becomes 5G enabled is relocated
from existing EPS UDR to 5GS UDR. When and how the subscription data
relocation is performed depends on the overall migration plan and the
procedure designed for that purpose, and it is out of scope of the description
of this solution.
This option may be considered the most appropriate for a multivendor
deployment, while providing centralization of subscription data, allowing
consolidation of user profiles for a given user in a single repository. This
consolidation simplifies provisioning process, providing a single point of
provisioning and ensuring data consistency.
It minimizes deployment impacts, providing a flexible network evolution to 5G
while users become 5G enabled through subscription relocation according to
plans and speed chosen by the operator.
Additionally, this option may be considered to follow a smooth evolution of
the subscription data repository used for 5G enabled users to a cloud native
deployment.
The figure 6.6.1-1 shows the network architecture using a common repository
for the Combined HSS/UDM:
Figure 6.6.1-1: Coexistence of existing HSS and Combined HSS/UDM with common
repository used by the Combined entity
\- **Option 2** : Separate repositories are deployed for subscription data of
5G enabled users accessed by the Combined HSS/UDM. In this case, provisioning
and/or subscription relocation to EPS UDR used by the Combined HSS/UDM is also
needed.
This option allows multivendor deployment for 5G enabled users and legacy
users, as well as keeping open the way for the evolution of the subscription
data repository used for 5G enabled users to a cloud native deployment.
However, subscription data centralization is not achieved, and deployment,
management and provisioning of subscription repositories becomes not optimal
and complex.
The figure 6.6.1-2 shows the network architecture using separate repositories
for the Combined HSS/UDM:
Figure 6.6.1-2: Coexistence of existing HSS and Combined HSS/UDM with separate
repositories deployed for the Combined entity
\- **Option 3** : Separate repositories are used and the existing EPS UDR
keeps storing 4G/IMS subscription data for 5G enabled users as well as 4G only
users, as shown in figure 6.6.1-3. Subscription relocation is not required in
this option.
Both the existing HSS and the HSS within the Combined entity interact with the
EPS UDR using the same proprietary Ud interface, implying that a multivendor
deployment will require integration of the non-standard Ud interface with the
HSS in the Combined HSS/UDM.
This option does not allow centralization of user profiles for a given user in
a single repository, making provisioning more complex as multiple subscription
repositories are required to be populated for the same user.
It enables evolution of subscription repository to cloud native technology
only for the 5G profiles. EPC and IMS profiles are assumed to be kept in the
existing EPS UDR using legacy repository technology.
Figure 6.6.1-3: Coexistence of existing HSS and Combined HSS/UDM with separate
repositories using existing EPS UDR for 4G/IMS subscription data
\- **Option 4** : Another option is to deploy a single repository to store
subscription data for all domains used by the Combined HSS/UDM and the
existing HSS, as depicted in figure 6.6.1-4. This option may not require
subscription relocation either.
This alternative allows user profiles centralization, although in a
multivendor deployment it will require integration of the non-standard Ud
interface with the HSS in the Combined HSS/UDM.
Figure 6.6.1-4: Coexistence of existing HSS and Combined HSS/UDM using a
common repository
### 6.6.3 Services and Illustrated Procedures
The interactions between UDM and HSS within the Combined network entity are
internal, so it is not required to define such interworking.
### 6.6.4 Impacts on existing services and interfaces
This solution has no impact on existing services and interfaces.
### 6.6.5 Evaluation
Solution 6 proposes a coexistence scenario where a Combined HSS/UDM network
entity serving 5G enabled users can coexist without interaction with any
existing HSS supporting EPC and IMS for 4G only users. Since there is no
interaction needed between UDM and the existing HSS out of the Combined
entity, this solution does not require any standardization effort.
Additionally, this solution avoids any impact on existing nodes (HSS, EPS
UDR), services, protocols and interfaces. Some options require migration of
subscriber data.
For IMS and EPC services, the solution requires the use of a routing solution
which can be based on standard functions (e.g. DRA/SLF) and it is normally
deployed in the operator\'s network for different purposes. Impacts are
limited to provisioning/configuration updates for the routing function to
route Diameter EPC/IMS requests to either the Combined HSS/UDM for 5G enabled
users or the existing HSS for 4G only users. Supporting SMS and the relevant
routing capabilities during normative phase
This solution offers different UDR deployment alternatives, from which option
1 as described previously is considered the option providing the most future
proof benefits in terms of centralization/consolidation of subscription data
for 5G enabled users, management of subscription data, multivendor support and
network evolution.
However, an operator may find among the different alternatives proposed the
option that fits better its network evolution plans, based on the current
deployment and evaluation of the aspects the operator considers as most
relevant.
# 7 Evaluation
## 7.1 Evaluation of solutions
This study has emerged from the need of a multivendor approach for UDM and HSS
nodes, currently not allowed by Release 15 specifications for 5GS, and
facilitate scenarios in which introducing only UDM and UDR is an effective way
to introduce 5GS.
According to the Study Item objectives, this technical report has focused on
scenarios involving co-existence of EPS subscriber data and 5GS subscriber
data with common or separate storages, determining whether interaction between
UDM and HSS is needed in the different interworking cases and deployment
scenarios.
Thus, the evaluation of the solutions focus on the following technical and
deployment requirements:
\- Decoupling of UDM and HSS - with common/separate repository.
\- Interworking scenarios fulfilment.
\- Impacts (standardisation, deployment, etc.
\- Limitations.
In addition, and considering that specific scenarios exist in which UDM and/or
HSS provide support to IMS procedures, the evaluation should as well take into
account these interactions, considering that the evolution of IMS work in
progress is independent from this study, but may incorporate additions to
specific solutions addressed in this document.
The following graph shows how the different solutions address the different
key issues:
Figure 7.1-1: Solutions vs Key Issues
### 7.1.1 Evaluation of solutions with separation of FEs and repositories
Solutions 1, 2 and 5 address key issue #1 for separation of repositories and
front ends.
\- Solution #1 provides an implementation option not requiring standardisation
for separating the front ends and to access the back end repositories
independently. The implementation is based on a translation function used to
access data from the different repositories in order to execute different
network procedures in EPS or 5GS.
For IMS procedures, it proposes implementing a lite Sh interface by UDM in
order to support T-ADS information retrieval when UE is camped in the 5GS and,
as an alternative for P-CSCF restoration via UDM, a lite Cx interface by UDM.
**EVALUATION:** the solution can be considered an option for deployments with
separate 5GS UDR and EPS UDR, accessed by UDM and HSS respectively. It can be
suitable for scenarios of interworking in which full separation of front ends
exist; however, for IMS interaction, the AS and S-CSCF impacts may not be
feasible/acceptable in some deployments and a different solution may be
selected.
\- Solution #2 implies standardisation of a service based interface between
HSS and UDM, for separation of front ends, that access the back end
repositories independently.
The solution addresses separation of UDM from HSS, where HSS contains as well
IMS logic.
For IMS procedures, the solution proposes operations Cx/Sh-like as part of the
service based interface to support T-ADS information retrieval and P-CSCF
restoration via UDM.
**EVALUATION:** the solution can be considered an option for deployments using
EPS UDR and 5GS UDR separate repositories, accessed by an HSS containing
several applications front end logic (i.e. IMS HSS, AuC, EPS HSS) via Ud and
by UDM via Nudr respectively, and when converting HSS into an SBA entity is a
suitable/feasible operator option.
**OPEN POINTS** if conclusion is to progress during normative work:
\- The solution does not address cases in which the applications front end
logic is split
\- The solution does not address the case of IMS requests based on IMPU (e.g.
T-ADS information retrieval) that need to be translated into SUPI in order to
obtain the right information, either from the 5GS UDR or from the AMF.
\- Solution #5 provides, similarly to solution #1, an implementation option
for separating the front ends and accessing the back end repositories, with
the difference that this solution is based on using notifications triggered by
the repositories, at data modification related to a particular 5G enabled
subscriber, in order to execute different network procedures in EPS or 5GS.
The solution assumes full separation of all front ends, i.e. UDM, IMS HSS, EPC
HSS, and AuC/ARPF.
For IMS procedures, the solution proposes making use of the IMS SLF
functionality and implementation of a lite Sh interface by UDM in order to
support T-ADS information retrieval when UE is camped in the 5GS and, as an
alternative for P-CSCF restoration via UDM, a lite Cx interface by UDM.
**EVALUATION:** the solution can be considered an implementation option for
deployments with separate 5GS UDR and EPS UDR, accessed by UDM and HSS or IMS
HSS respectively. It can be suitable for scenarios of interworking in which
full separation of front ends and repositories exist; however, for IMS
interaction, the introduction of SLF functionality and use of Diameter
interfaces in the UDM may not be feasible/acceptable in some deployments and a
different solution may be preferred. In order to reduce the number of options
to address during normative phase, this solution is proposed to not be pursued
during the normative stage 2 work in Rel-16.
### 7.1.2 Evaluation of solutions with separation of FEs with common
repository
Solutions 2 and 4 address key issue #1 for common repository with separation
of front ends.
\- Solution #2 implies standardisation of a service based interface between
HSS and UDM, for separation of front ends, that access the back end repository
independently.
The access to the common repository is performed by both Nudr and Ud
interfaces.
The solution addresses separation of UDM from HSS, where HSS contains as well
IMS logic.
For IMS procedures, the solution proposes lite Cx/Sh operations as part of the
service based interface to support T-ADS information retrieval and P-CSCF
restoration via UDM.
**EVALUATION:** the solution can be considered an option for deployments
reusing EPS UDR as common repository, accessed by an HSS containing all
applications front end logic (i.e. IMS HSS, AuC, EPS HSS) via Ud, and by UDM
via Nudr, and when converting HSS into an SBA entity is a suitable/feasible
option for the operator.
**OPEN POINTS** if conclusion is to progress during normative work:
\- The solution does not address cases in which the applications front end
logic is split
\- The solution does not address conversion of Nudr to Ud when the common
repository is based on EPS UDR.
\- The solution does not address the case of IMS requests based on IMPU (e.g.
T-ADS retrieval) that need to be translated into SUPI in order to obtain the
right information, either from the 5GS UDR or from the AMF.
\- Solution #4 provides an implementation option for separating the front ends
and accessing the common back end repository, i.e. the EPS UDR. The
implementation is based of using notifications triggered by the repository in
order to execute different network procedures in EPS or 5GS.
The solution assumes full separation of all front ends, i.e. UDM, IMS HSS, EPC
HSS, and AuC/ARPF.
For IMS procedures, the solution proposes making use of the IMS SLF
functionality and implementation of a lite Sh interface by UDM in order to
support T-ADS information retrieval when UE is camped in the 5GS and, as an
alternative for P-CSCF restoration via UDM, a lite Cx interface by UDM.
**EVALUATION:** the solution can be considered an implementation option for
deployments reusing EPS UDR as common repository, accessed by UDM, HSS or IMS
HSS independently. It can be suitable for scenarios of interworking in which
full separation of front ends exist; however, for IMS interaction, the
introduction of SLF functionality and use of Diameter interfaces in the UDM
may not be feasible/acceptable in some deployments and a different solution
may be preferred.
### 7.1.3 Evaluation of solutions with common FEs with separate repositories
Solutions 3 and 6 address key issue #2 for separate repositories, with no
separation of front ends.
\- Solution #3 implies no standardisation of interfaces between UDM and HSS
FE, as UDM acts as a combo node that is the single point of contact for IMS,
SMS, 5GC and EPC.
The solution assumes UDM incorporates HSS FE interfaces (i.e. S6a, Sh, Cx/Dx,
C/S6c), with no impact on legacy HSS.
The EPC repository holds both 4G and IMS data, whilst 5GS UDR holds 5G data.
The combo node UDM/HSS FE interfaces both 5GS UDR, via Nudr, and EPS UDR via
legacy interface.
**EVALUATION:** This solution can be considered a suitable solution in order
to introduce 5G subscription data without impacting or migrating legacy
subscription data already provisioned, or impacting legacy HSS.
**OPEN POINTS** if conclusion is to progress during normative work:
\- The solution does not address the case of IMS requests based on IMPU (e.g.
T-ADS retrieval) that need to be translated into SUPI in order to obtain the
right information, either from the 5GS UDR or from the AMF.
\- Solution #6 implies another combo node UDM/HSS FE, interfacing separate 5GS
UDR and EPS UDR holding 5G and 4G/IMS data, respectively.
The solution assumes coexistence of the combo UDM/HSS FE with legacy HSS/UDR
(monolithic or layered) that keeps serving legacy 4G subscribers.
The solution assumes impacts for migration of 4G/IMS profiles when separate
repositories are used and requires the introduction of a Routing Function
based on subscriber IMSI.
**EVALUATION** : This solution can be considered as addressing the goals of
the study as long as migration of legacy 4G data is acceptable for the 5G
enabled subscribers. It does not require standardisation so normative work
will not be pursued.
### 7.1.4 Evaluation of solutions with common FEs with common repository
Solutions 6 addresses the case of common repository and no separation of front
ends. However, this solution does not address any of the goals of the study
and thus it is not intended to be progressed as standardisation work.
# 8 Conclusions
## 8.1 For EPS and 5GS interworking required for mobility cases from EPS to
5GS and from 5GS to EPS, including the impacts on SMS handling
Solution #2 is considered to progress as normative optional feature, both
stage 2 and stage 3 for deployments in which upgrading legacy systems to
service based architectures is a feasible/acceptable option for the network
operator. A number of open issues listed in clause 7 need to be addressed
during normative phase.
CT WG4 is expected to take the responsibility of the normative specification
work while SA WG2 will add relevant references in affected 5G specifications
(TS 23.501 [6], TS 23.502 [2]).
Solutions #3 and #6 are feasible alternatives in different scenarios where
migration of subscription data or upgrades of legacy systems are not
possible/feasible, and conclusion is to document them as
implementation/deployment options, addressing the open issues in the relevant
evaluation clauses.
Editor\'s note: A 900 series TR will be created from this TR, to clearly
document these solutions with reference to the CT WG4 TS for what relates to
solution #2.
## 8.2 For IMS and 5GS interworking required for T-ADS, P-CSCF restoration and
NPLI retrieval
Three different scenarios are addressed by the proposed solutions:
\- HSS as single point of contact for IMS (diameter based).
\- An UDM/HSS combo as single point of contact for IMS (diameter based).
\- IMS HSS/SLF as single point of contact for IMS (diameter based).
To facilitate this, conclusion is to progress normative work for new
service(s) with new service Request-Response operation(s) produced by UDM: for
T-ADS (i.e. IMS over PS support) and NPLI (i.e. time stamp and RAT type), and
for P-CSCF restoration. The decision about the number of operations is left
for normative work.
The operations can be consumed by HSS (as in solution #2) for scenarios in
which HSS is the single point of contact for IMS (diameter based) interactions
and adapted to SBA.
The operations can be consumed by an IMS HSS when in stand-alone mode and
acting as a single point of contact for a diameter-based IMS. This case would
correspond to solution #2 when the HSS referred acts as IMS HSS and is adapted
to SBA.
NOTE 1: These new operations require coordination with the normative work
derived from FS_eIMS5G (TS 23.794 [14]).
NOTE 2: Any Modification of TS 23.228 [7] to clarify the interactions between
HSS, UDM and IMS will be coordinated with any normative work arising from
FS_eIMS5G (TS 23.794 [14]).
Solutions #3 and #6 are feasible alternatives and concluded to be documented
as implementation/deployment options.
Editor\'s note: A 900 series TR will be created from this TR, to clearly
document these solutions with reference to the CT WG4 TS for what relates to
solution #2.
#
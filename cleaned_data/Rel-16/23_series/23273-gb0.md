# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document specifies the stage 2 of the service-based architecture
used for location services in the 5G system, and corresponding Network
Functions (NFs), NF services and procedures, to meet the service requirements
defined in TS 22.261 [3] and TS 22.071 [2].
Location Services specified in the present document include regulatory
location services and commercial location services. The architecture and
signalling procedures in NG-RAN are defined in TS 38.305 [9].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.071: \"Technical Specification Group Systems Aspects; Location
Services (LCS)\".
[3] 3GPP TS 22.261: \"Service requirements for next generation new services
and markets; Stage 1\".
[4] 3GPP TS 23.271: \"Functional stage 2 description of Location Services
(LCS)\".
[5] 3GPP TS 43.059: \"Functional Stage 2 description of Location Services in
GERAN\".
[6] Void.
[7] 3GPP TS 36.305: \"Stage 2 functional specification of User Equipment (UE)
positioning in E-UTRAN\".
[8] 3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".
[9] 3GPP TS 38.305: \"Stage 2 functional specification of User Equipment (UE)
positioning in NG-RAN\".
[10] 3GPP TS 23.167: \"IP Multimedia Subsystem (IMS) emergency sessions\".
[11] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
[12] 3GPP TS 29.572: \"5G System; Location Management Services; Stage 3\".
[13] OMA MLP TS: \"Mobile Location Protocol\",
[http://www.openmobilealliance.org].
[14] OMA RLP TS: \"Roaming Location Protocol\",
[http://www.openmobilealliance.org].
[15] 3GPP TS 38.455: \"NG-RAN; NR Positioning Protocol A (NRPPa)\".
[16] 3GPP TS 29.518: \"5G System; Access and Mobility Management Services;
Stage 3\".
[17] 3GPP TS 25.305: \"Stage 2 functional specification of User Equipment (UE)
positioning in UTRAN\".
[18] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[19] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[20] 3GPP TS 36.355: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
LTE Positioning Protocol (LPP)\".
[21] 3GPP TS 23.316: \"Wireless and wireline convergence access support for
the 5G System (5GS)\".
[22] ETSI ES 282 004: \"Telecommunications and Internet converged Services and
Protocols for Advanced Networking (TISPAN); NGN Functional Architecture;
Network Attachment Sub-System (NASS)\".
[23] ITU-T Recommendation E.164: \"The international public telecommunication
numbering plan\".
[24] 3GPP TS 23.222: \"Common Application Programming Interface (API)
framework for 3GPP northbound APIs\".
[25] RFC 2396: \"Uniform Resource Identifiers\".
[26] RFC 3261: \"SIP: Session Initiation Protocol\".
[27] 3GPP TS 23.228: \"IP multimedia subsystem (IMS)\".
[28] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[29] 3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".
[30] 3GPP TS 32.271: \"Telecommunication management; Charging management;
Location Services (LCS) charging\".
[31] 3GPP TS 32.298: \"Telecommunication management; Charging management;
Charging Data Record (CDR) parameter description\".
[32] Void.
[33] 3GPP TS 29.571: \"5G System; Common Data Types for Service Based
Interfaces; Stage 3\".
[34] 3GPP TS 29.171: \"Location Services (LCS); LCS Application Protocol (LCS-
AP) between the Mobile Management Entity (MME) and Evolved Serving Mobile
Location Centre (E-SMLC); SLs interface\".
[35] 3GPP TS 29.122: \"T8 reference point for Northbound APIs\".
[36] 3GPP TS 24.571: \"5G System (5GS); Control plane Location Services (LCS)
procedures; Stage 3\".
# 3 Definitions and Abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**LCS Client:** entity that interacts with GMLC for the purpose of obtaining
location information for one or more UEs. The LCS Client may reside in the UE.
For the purposes of the present document, the following terms and definitions
given in TS 23.271 [4] apply:
**Call Related:** see TS 23.271 [4].
**Codeword:** see TS 23.271 [4].
**Current Location:** see TS 23.271 [4].
**Deferred location request:** see TS 23.271 [4].
**Immediate location request:** see TS 23.271 [4].
**Last Known Location:** see TS 23.271 [4].
**LCS (LoCation Services):** see TS 23.271 [4].
**Location Estimate:** see TS 23.271 [4].
**Pseudonym:** see TS 23.271 [4].
**Pseudonym mediation device** : Functionality that verifies pseudonyms to
verinyms.
**Requestor** : see TS 23.271 [4].
**Requestor Identity** : see TS 23.271 [4].
**Response Method:** for LCS Client using the OMA MLP protocol. Detail see TS
23.271 [4].
**Service Type:** see TS 23.271 [4].
**Target UE:** see TS 23.271 [4].
**Velocity:** see TS 23.271 [4].
**Verinym** : see TS 23.271 [4].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
APN Access Point Name
APN-NI APN Network Identifier
EDT Early Data Transmission
E-SMLC Evolved Serving Mobile Location Centre
GMLC Gateway Mobile Location Centre
HGMLC Home GMLC
LCS LoCation Services
LDR Location Deferred Request
LMF Location Management Function
LPI LCS Privacy Indicator
LRF Location Retrieval Function
MO-LR Mobile Originated Location Request
MT-LR Mobile Terminated Location Request
NI-LR Network Induced Location Request
PMD Pseudonym mediation device functionality
POI Privacy Override Indicator
TNAN Trusted Non-3GPP Access Network
UNAN Untrusted Non-3GPP Access Network
VGMLC Visited GMLC
# 4 Architecture Model and Concepts
## 4.1 General Concepts
A general description of location services and service requirements are given
in the specification TS 22.071 [2]. Support of location services for GERAN,
UTRAN and E-UTRAN access networks is described in TS 23.271 [4], TS 43.059
[5], TS 25.305 [17] and TS 36.305 [7].
The positioning of a UE can be supported by RAT dependent position methods,
which rely on for example 3GPP RAT measurements obtained by a target UE and/or
on measurements obtained by an Access Network of 3GPP RAT signals transmitted
by a target UE. Positioning of a UE can also be supported by RAT independent
position methods which may rely on non-RAT measurements obtained by a UE
and/or on other information.
The positioning of a UE can be performed by either 3GPP access network or
non-3GPP access network. A proper access type shall be determined to assure
that the positioning result can fulfil the requested QoS and operator policy.
Location information for one or multiple target UEs may be requested by and
reported to an LCS client or an AF within or external to a PLMN, or a control
plane NF within a PLMN. Location information contained in the location request
and location information contained in the location response are defined in
clause 5.5.
For location request from LCS client (neither in the UE nor in the NG-RAN) or
AF external to a PLMN, privacy verification of the target UE shall be enabled
to check whether it is allowed to acquire the UE location information based on
UE LCS privacy profile and whether the LCS client or the AF is authorised to
use the location service as defined in clause 5.4. Additionally, UEs may
optionally support privacy notification and verification on behalf of a user.
Privacy override is also supported for regulatory LCS services according to
local regulation.
The capabilities of a target UE to support LCS may be signalled by the UE to a
serving PLMN at the AS, NAS and application (positioning protocol) levels to
enable use of position methods supported by the UE.
To provide Location Service in the EPC interworking scenario, an EPC and 5GC
common interface shall be used for the location request from LCS client or AF.
## 4.1a Types of Location Request
### 4.1a.1 Network Induced Location Request (NI-LR)
With a Network Induced Location Request (NI-LR), a serving AMF for a UE
initiates location of the UE for some regulatory service (e.g. an emergency
call from the UE).
### 4.1a.2 Mobile Terminated Location Request (MT-LR)
With a Mobile Terminated Location Request (MT-LR), an LCS client or AF
external to or internal to a serving PLMN sends a location request to the PLMN
(which may be the HPLMN or VPLMN) for the location of a target UE.
### 4.1a.3 Mobile Originated Location Request (MO-LR)
With a Mobile Originated Location Request (MO-LR), a UE sends a request to a
serving PLMN for location related information for the UE.
### 4.1a.4 Immediate Location Request
With an immediate location request, an LCS client or AF sends or instigates a
location request for a target UE (or group of target UEs) and expects to
receive a response containing location information for the target UE (or group
of target UEs) within a short time period which may be specified using QoS. An
immediate location request may be used for an NI-LR. MT-LR or MO-LR.
### 4.1a.5 Deferred Location Request
With a deferred location request, an LCS client or AF sends a location request
to a PLMN for a target UE (or group of target UEs) and expects to receive a
response containing the indication of event occurrence and location
information if requested for the target UE (or group of target UEs) at some
future time (or times), which may be associated with specific events
associated with the target UE (or group of target UEs). In this version of the
specification, only deferred location requests for an MT-LR are supported.
#### 4.1a.5.1 Types of event
The following types of event are defined for a deferred location request.
a) UE availability: Any event in which the 5GCN has established a contact with
the UE. This event is considered to be applicable when the UE is temporarily
unavailable due to inaction by the user, or for temporarily loss of radio
connectivity or IMSI detach and so on. The UE Available event only requires
one response to an LCS client/AF and after this response, the UE Available
event is concluded.
b) Area: An event where the UE enters, leaves or remains within a pre-defined
geographical area. At least one type of area event can be defined (i.e.
entering, leaving or remaining within the area). The LCS client or AF may
define the target area as a geographical area or as a geopolitical name of an
area. The PLMN may translate and define the target area as the identities of
one or more radio cells or tracking areas. The area event may be reported one
time only, or multiple times. The area event report shall contain an
indication of the event occurrence. The location estimate may be included in
the report. If an area event is detected by the UE but an event report cannot
be sent (e.g. because the UE cannot access the network or due to a minimum
reporting interval), a report shall be sent later when possible irrespective
of whether the area event still applies for the current UE location. Area
event reporting is controlled by a minimum and a maximum reporting time. The
minimum reporting time defines the minimum allowed time between successive
area events. The maximum reporting time defines the maximum time between
successive reports. When a UE sends a report due to expiration of the maximum
reporting time, the UE indicates expiration of the maximum reporting time as
the trigger event. The maximum reporting time enables the AF, LCS client and
HGMLC to remain aware of continuing support by the UE for the area event (e.g.
to detect if area event reporting may have been aborted due to UE power off).
c) Periodic Location: An event where a defined periodic timer expires in the
UE and activates a location report. If a periodic event is detected by the UE
but an event report cannot be sent (e.g. because the UE cannot access the
network temporarily), a report shall be sent later when possible and the
periodic timer for the next event shall then be started. The reporting
duration for periodic location shall equal the requested number of reports
multiplied by the periodic interval even when reports are delayed.
d) Motion: An event where the UE moves by more than some predefined straight
line distance from a previous location. The motion event may be reported one
time only, or multiple times. The motion event report shall contain an
indication of the event occurrence. A location estimate may be included in the
report if requested by the LCS client or AF. For successive motion event
reports, motion is determined relative to the UE location corresponding to the
immediately preceding event report (including an event report triggered by
expiration of the maximum reporting time). If a motion event is detected by
the UE but an event report is deferred (e.g. because the UE cannot access the
network temporarily), a report shall be sent later when possible irrespective
of whether the motion event still applies to the current UE location. Motion
reporting is controlled by a minimum and a maximum reporting time. The minimum
reporting time defines the minimum allowed time between successive event
reports. The maximum reporting time defines the maximum time between
successive reports. When a UE sends a report due to expiration of the maximum
reporting time, the UE indicates expiration of the maximum reporting time as
the trigger event. The maximum reporting time enables the AF, LCS client and
HGMLC to remain aware of continuing support by the UE for the motion event
(e.g. to detect if motion event reporting may have been aborted due to UE
power off).
## 4.1b LCS Quality of Service
LCS Quality of Service is used to characterise the location request. It can
either be determined by the operator or determined based on the negotiation
with the LCS client or the AF. It is optional for LCS client or the AF to
provide the LCS Quality of Service in the location request.
LCS Quality of Service information is characterised by 3 key attributes:
\- LCS QoS Class as defined below.
\- Accuracy: i.e. Horizontal Accuracy (see clause 4.3.1 of TS 22.071 [2]) and
Vertical Accuracy (see clause 4.3.2 of TS 22.071 [2].
\- Response Time (e.g. no delay, low delay or delay tolerant as described in
clause 4.3.3 of TS 22.071 [2]).
The LCS QoS Class defines the degree of adherence by the Location Service to
another quality of service parameter (Accuracy), if requested. The 5G system
shall attempt to satisfy the other quality of service parameter regardless of
the use of QoS Class. There are 2 LCS QoS Classes:
\- Best Effort Class: This class defines the least stringent requirement on
the QoS achieved for a location request. If a location estimate obtained does
not fulfil the other QoS requirements, it should still be returned but with an
appropriate indication that the requested QoS was not met. If no location
estimate is obtained, an appropriate error cause is sent.
\- Assured Class: This class defines the most stringent requirement on the
accuracy achieved for a location request. If a location estimate obtained does
not fulfil the other QoS requirements, then it shall be discarded, and an
appropriate error cause shall be sent.
For LCS client, it may indicate accuracy defined in TS 29.572 [12], tables
6.1.6.3.2-1 and 6.1.6.3.5-1. For AF, it may either indicate the accuracy
defined in TS 29.572 [12], table 6.1.6.3.2-1, or indicate a particular value
e.g. PLMN ID defined in TS 29.122 [35], table 5.3.2.4.7-1.
## 4.2 Architectural Reference Model
### 4.2.1 Non-roaming reference architecture
Figure 4.2.1-1 shows an architectural reference model for 5GS LCS for a non-
roaming UE in reference point representation.
Figure 4.2.1-1: Non-roaming reference architecture for Location Services in
reference point representation
NOTE 1: (R)AN represents NG-RAN, trusted non-3GPP access or untrusted non-3GPP
access.
NOTE 2: Reference point interface related to charging functionality is not
shown in this specification.
Figure 4.2.1-2 shows an architectural reference model for 5GS LCS for a non-
roaming UE in SBI representation.
Figure 4.2.1-2: Non-roaming reference architecture for Location Services in
SBI representation
### 4.2.2 Roaming reference architecture
Figure 4.2.2-1 shows an architectural reference model for 5GS LCS for a
roaming UE in reference point representation.
Figure 4.2.2-1: Roaming reference architecture for Location Services in
reference point representation
NOTE 1: (R)AN represents NG-RAN, trusted non-3GPP access or untrusted non-3GPP
access.
NOTE 2: Reference point interface related to charging functionality is not
shown in this specification.
Figure 4.2.2-2 shows an architectural reference model for 5GS LCS for a
roaming UE in SBI representation.
Figure 4.2.2-2: Roaming reference architecture for Location Services in SBI
representation
## 4.2a Interconnection between 5GC and EPC
### 4.2a.1 General
For MT-LR Location Request, when a LCS service request is received at 5GC
GMLC, the target UE may be served by either 5GC or EPC. An EPC/5GC common
interface is used between the LCS Client and the 5GC GMLC to enable the
location service request being handled based on whether the target UE is
served by EPC or 5GC. The AF initiates the service request to the 5GC GMLC via
NEF.
NOTE: The LCS Client doesn\'t know if UE is currently served by EPC or 5GC.
For MT-LR Location Request, the 5GC interconnection with EPC happens:
\- when an LCS service request is received by the 5GC GMLC and the target UE
is served by EPC in non-roaming case;
\- when an LCS request is received by the 5GC GMLC in the HPLMN of the target
UE and the target UE is served by EPC in the VPLMN in roaming case.
### 4.2a.2 Non-roaming architecture
Figure 4.2a.2-1 represents the non-roaming architecture of Location Services
for interconnection between 5GC and EPC.
Figure 4.2a.2-1: Non-roaming architecture of interconnection between 5GC and
EPC
NOTE 1: EPC GMLC and 5GC GMLC can be collocated in implementation, in such
case, Lr\' is not needed.
NOTE 2: For this release, Lr\' is not standardized.
### 4.2a.3 Roaming architecture
Figure 4.2a.2-1 and Figure 4.2a.2-2 represent the Roaming architecture of
interconnection between 5GC and EPC.
Figure 4.2a.2-1: Roaming architecture of Location Services for interconnection
between 5GC and EPC (5GC GMLC and EPC GMLC are separately deployed in VPLMN)
Figure 4.2a.2-2: Roaming architecture of Location Services for interconnection
between 5GC and EPC (5GC GMLC and EPC GMLC are co-located in VPLMN)
## 4.2b Positioning methods
The LCS feature utilises one or more positioning methods in order to determine
the location of user equipment (UE). Determining the position of a UE involves
two main steps:
\- Radio signal measurements or non-RAT measurements; and
\- Position estimate computation based on the measurements.
The positioning methods for 3GPP access are described in clause 5.2.
The positioning methods for non-3GPP access are described in clause 5.3.1.
## 4.3 Functional description of LCS per network function
### 4.3.1 Access Network
The Access Network is involved in the handling of various positioning
procedures including positioning of a target UE, provision of location related
information not associated with a particular target UE and transfer of
positioning messages between an AMF or LMF and a target UE. The Access Network
shall support determination of location estimates in geographical co-ordinates
as defined in TS 23.032 [8].
In this version of the specification, location services are supported for NG-
RAN, trusted non-3GPP access and untrusted non-3GPP access.
The LCS specific functionalities of the radio access network elements are
specified in TS 38.305 [9] for NG-RAN.
### 4.3.2 LCS Clients, Application Functions and Network Functions
AFs and NFs may access LCS services from a GMLC in the same trust domain (e.g.
in the same PLMN) using the Ngmlc interface or Event Exposure with location
information from an AMF in the same trust domain using the Namf interface.
LCS Clients may access LCS services from a GMLC (e.g. HGMLC) using the Le
reference point.
External AFs may access LCS services from an NEF using Nnef interface or CAPIF
API. The CAPIF and associated API provider domain functions are specified in
TS 23.222 [24].
### 4.3.3 Gateway Mobile Location Centre, GMLC
The Gateway Mobile Location Centre (GMLC) contains functionality required to
support LCS. In one PLMN, there may be more than one GMLC.
A GMLC is the first node an external LCS client accesses in a PLMN (i.e. the
Le reference point is supported by the GMLC). AFs and NFs may access GMLC
directly or via NEF. The GMLC may request routing information and/or target UE
privacy information from the UDM via the Nudm interface. After performing
authorization of an external LCS Client or AF and verifying target UE privacy,
a GMLC forwards a location request to either a serving AMF using Namf
interface or to a GMLC in another PLMN using the Ngmlc interface in the case
of a roaming UE.
The target UE\'s privacy profile settings shall always be checked in the UE\'s
home PLMN prior to delivering a location estimate.
The \"Visited GMLC\" (VGMLC) is the GMLC, which is associated with the serving
node of the target UE.
The \"Home GMLC\" (HGMLC) is the GMLC residing in the target UE\'s home PLMN,
which is responsible for the control of privacy checking of the target UE.
Additional functions which may be performed by a GMLC to support location
services include the following.
\- At an HGMLC, determine the serving AMF for a target UE when there is more
than one serving AMF.
\- At an HGMLC, determine whether to attempt a second location request for a
target UE from a different AMF when location information returned by a first
AMF does not meet QoS requirements and there is more than one serving AMF.
\- At an HGMLC, support location requests from an external LCS client or NEF
for a 5GC-MT-LR and deferred 5GC-MT-LR for periodic, triggered and UE
available location events.
\- At an HGMLC, forward location requests for a roaming UE to a VGMLC or
serving AMF in the VPLMN based on deployment configurations.
\- At an HGMLC, receive event reports from a VGMLC or LMF for a deferred 5GC-
MT-LR for periodic or triggered location and return to an external LCS Client
or NEF.
\- At an HGMLC, support cancelation of a periodic or triggered location.
\- At an HGMLC, receive location information from an VGMLC for a 5GC-MO-LR and
forwards to an LCS Client or an AF (via NEF) if requested by the UE.
\- At a VGMLC, receive location requests from an HGMLC for a roaming UE and
forward to a serving AMF.
\- At a VGMLC, receive event reports from an LMF for a deferred 5GC-MT-LR for
periodic or triggered location for a roaming UE and forward to an HGMLC.
\- At a VGMLC, receive location information from an AMF for a 5GC-MO-LR and
forwards to an HGMLC.
\- At an HGMLC, reject the LCS request coming from a LCS client, e.g. when the
number of Target UEs in the LCS request exceeds the Maximum Target UE Number
of such client.
\- At an HGMLC, allocate the reference number for each location request from
an external LCS client for LDR.
\- At an HGMLC, assign the pseudonym if pseudonym indicator is received in the
service request and transfer it to external LCS client, e.g. when core network
provides the UE\'s location information to LCS client. Resolve the verinym
from the pseudonym, if it is received from the LCS client.
\- At an HGMLC, resolve group identifier to identifier of individual UEs and
aggregate responses to LCS Client or NEF during bulk operation procedure.
### 4.3.4 Location Retrieval Function, LRF
The Location Retrieval Function (LRF) may be collocated with a GMLC or
separate and is responsible for retrieving or validating location information,
providing routing and/or correlation information for a UE which has initiated
an IMS emergency session. The information is provided by an LRF to an E-CSCF.
For more details, refer to TS 23.167 [10].
### 4.3.5 UE
A target UE may support positioning according to four different modes:
\- UE assisted mode (the UE obtains location measurements and sends the
measurements to another entity (e.g. an LMF) to compute a location);
\- UE based mode (the UE obtains location measurements and computes a location
estimate making use of assistance data provided by serving PLMN);
\- standalone mode (the UE obtains location measurements and computes a
location estimate without making use of assistance data provided by serving
PLMN);
\- network based mode (a serving PLMN obtains location measurements of signals
transmitted by a target UE and computes a location estimate).
NOTE: The transmission of UE signals for network based mode may or may not be
transparent to the UE.
Positioning procedures used by a UE for NG-RAN access are described in TS
38.305 [9].
A limited set of UE positioning capabilities can be transferred to the 5GCN
during registration of the UE as described in TS 24.501 [11]. Some of these
positioning capabilities may be transferred subsequently to an LMF as
described in TS 29.572 [12]. UE positioning capabilities may also be
transferred directly to a location server (e.g. LMF).
Additional functions which may be supported by a UE to support location
services include the following.
\- Support location requests received from a network for 5GC-MT-LR, 5GC-NI-LR
or a deferred 5GC-MT-LR for periodic or triggered location.
\- Support location requests to a network for a 5GC-MO-LR.
\- Support privacy notification and verification for a 5GC-MT-LR or deferred
5GC-MT-LR for periodic or triggered location.
\- Send updated privacy requirements to a serving AMF (for transfer to a UDR
via UDM).
\- Support periodic or triggered location reporting to an LMF.
\- Support change of a serving LMF for periodic or triggered location
reporting.
\- Support cancelation of periodic or triggered location reporting.
\- Support multiple simultaneous location sessions.
\- Support the reception of unciphered and/or ciphered assistance data
broadcast by NG-RAN.
\- Support the reception of ciphering keys for the assistance data from the
AMF.
### 4.3.6 UDM
The UDM contains LCS subscriber LCS privacy profile and routing information.
The UDM is accessible from an AMF, GMLC or NEF via the Nudm interface.
### 4.3.7 Access and Mobility Management Function, AMF
The AMF contains functionality responsible for managing positioning for a
target UE for all types of location request. The AMF is accessible to the GMLC
and NEF via the Namf interface, to the RAN via the N2 reference point and to
the UE via the N1 reference point.
Functions which may be performed by an AMF to support location services
include the following.
\- Initiate an NI-LR location request for a UE with an IMS emergency call.
\- Receive and manage location requests from a GMLC for a 5GC-MT-LR and
deferred 5GC-MT-LR for periodic, triggered and UE available location events.
\- Receive and manage location requests from a UE for a 5GC-MO-LR.
\- Receive and manage Event Exposure request for location information from an
NEF.
\- Select an LMF.
\- Receive updated privacy requirements from a UE and transfer to a UDR via
UDM.
\- Support cancelation of periodic or triggered location reporting for a
target UE.
\- Support change of a serving LMF for periodic or triggered location
reporting for a target UE.
\- When assistance data is broadcast by 5GS in ciphered form, the AMF receives
ciphering keys from the LMF and forwards to suitably subscribed UEs using
mobility management procedures.
### 4.3.8 Location Management Function, LMF
The LMF manages the overall co-ordination and scheduling of resources required
for the location of a UE that is registered with or accessing 5GCN. It also
calculates or verifies a final location and any velocity estimate and may
estimate the achieved accuracy. The LMF receives location requests for a
target UE from the serving AMF using the Nlmf interface. The LMF interacts
with the UE in order to exchange location information applicable to UE
assisted and UE based position methods and interacts with the NG-RAN, N3IWF or
TNAN in order to obtain location information.
The LMF shall determine the result of the positioning in geographical co-
ordinates as defined in TS 23.032 [8]. If requested and if available, the
positioning result may also include the velocity of the UE.
Additional functions which may be performed by an LMF to support location
services include the following.
\- Support a request for a single location received from a serving AMF for a
target UE.
\- Support a request for periodic or triggered location received from a
serving AMF for a target UE.
\- Determine position methods based on UE and PLMN capabilities, QoS, UE
connectivity state per access type, LCS Client type and optionally service
type.
\- Report UE location estimates directly to a GMLC for periodic or triggered
location of a target UE.
\- Support cancelation of periodic or triggered location for a target UE.
\- Support the provision of broadcast assistance data to UEs via NG-RAN in
ciphered or unciphered form and forward any ciphering keys to subscribed UEs
via the AMF.
\- Support change of a serving LMF for periodic or triggered location
reporting for a target UE.
### 4.3.9 Network Exposure Function, NEF
An NEF provides a means of accessing location services by an external AF or
internal AF. AFs access location services from an NEF using an API. Depending
on QoS requirements, an NEF can forward a location request to a GMLC or
request an event exposure for location information from serving AMF
(optionally via a UDM). When event exposure via AMF is used, an NEF may
request routing information and/or target UE privacy information from the UDM
via the Nudm interface.
Additional functions which may be performed by an NEF to support location
services include the following.
\- Support location requests from an AF for immediate location and for
deferred periodic and triggered location events.
\- Support location information exposure to an AF based on the location
request.
\- Support determination of GMLC or AMF based on e.g. the QoS requirements
from AF, type of the location request.
\- Select the serving AMF for a target UE when there is more than one serving
AMF.
\- Determine whether to attempt a second location request for a target UE from
a different AMF when location information returned by a first AMF does not
meet QoS requirements and there is more than one serving AMF.
\- Support UE LCS privacy profile provision from the AF.
\- Support suspending and cancellation of a periodic or triggered location
request.
\- Support authorization of LCS request from the AF.
\- Support rejecting the LCS request coming from an AF, e.g. when the number
of Target UEs in the LCS request exceeds the Maximum Target UE Number of such
client.
\- Support allocating the reference number for each location request from an
AF for LDR.
### 4.3.10 Unified Data Repository, UDR
The UDR contains privacy data information for target UEs and may be updated by
a serving AMF via UDM with new privacy information received from a UE.
## 4.4 Reference Point to Support Location Services
### 4.4.1 Le Reference Point
The Le reference point supports location requests sent by an LCS Client to a
GMLC or LRF.
The Le reference point may be supported using the Mobile Location Protocol
(MLP) defined by OMA [13].
### 4.4.2 NL3 Reference Point
The NL3 reference point supports location requests forwarded by an HGMLC to a
VGMLC.
### 4.4.3 N1 Reference Point
The N1 reference point supports transfer of supplementary services messages
between a serving AMF and target UE to support privacy notification and
verification and change of UE privacy preference. The N1 reference point also
supports transfer of positioning protocol messages and location event reports
between a target UE and an LMF via a serving AMF. The N1 reference point
supports the transfer of ciphering keys from an AMF to a suitably subscribed
UE to enable the UE to receive ciphered broadcast assistance data. All
messages sent over the N1 reference point for support of location services are
encapsulated in NAS Transport messages as defined in TS 24.501 [11].
### 4.4.4 N2 Reference Point
The N2 reference point supports transfer of positioning messages, via an AMF,
between an LMF and a RAN node, or N3IWF in the case of untrusted non-3GPP
access. The N2 reference point also supports transfer of messages, via an AMF,
from an LMF to an NG-RAN node, which carry assistance data to be broadcast by
the NG-RAN node. Positioning messages relevant to the N2 interface are defined
in TS 38.455 [15].
### 4.4.5 Void
### 4.4.6 NL5 Reference Point
The NL5 reference point supports location requests sent by an NEF or other NF
to a GMLC.
### 4.4.7 NL2 Reference Point
The NL2 reference point supports location requests sent by a GMLC to a serving
AMF for a target UE.
Messages for the NL2 reference point are defined in TS 29.518 [16].
### 4.4.8 NL6 Reference Point
The NL6 reference point supports queries from an HGMLC to a UDM for privacy
subscription information for a target UE and routing information for a target
UE.
### 4.4.9 N51 Reference Point
The N51 reference point supports queries from an NEF to a serving AMF for the
location of a target UE.
Messages for the N51 reference point are defined in TS 29.518 [16].
### 4.4.10 NL1 Reference Point
The NL1 reference point supports location requests for a target UE sent from a
serving AMF for the target UE to an LMF. Location requests are supported for
immediate location and for deferred location for periodic or triggered
location events.
The NL1 reference point also supports the transfer from an LMF to an AMF of
ciphering keys and associated data that enable deciphering by suitably
subscribed UEs of ciphered broadcast assistance data.
Messages for the NLI reference point are defined in in TS 29.518 [16] and TS
29.572 [12].
### 4.4.11 N52 Reference Point
The N52 reference point supports queries from an NEF to a UDM for privacy
subscription information for a target UE and routing information for a target
UE. The N52 interface also supports a request from an NEF to a UDM to forward
a location request from the NEF to a serving AMF for the target UE.
### 4.4.12 NL7 Reference Point
The NL7 reference point supports location context transfer between two LMFs.
## 4.5 Service Based Interfaces to Support Location Services
The 5GS LCS architecture contains the following service-based interfaces for
Location Services:
**Nlmf:** Service-based interface exhibited by LMF.
**Ngmlc:** Service-based interface exhibited by GMLC.
# 5 High Level Features
## 5.1 LMF Selection
LMF selection functionality is supported by the AMF to determine an LMF for
location estimation of the target UE. The LMF selection functionality is also
supported by the LMF if it determines that it is unsuitable or unable to
support location for the current UE access network or serving cell for the
deferred 5GC-MT-LR procedure for periodic, or triggered location events.
LMF reselection is a functionality supported by AMF when necessary, e.g. due
to UE mobility.
The LMF selection/reselection may be performed at the AMF or LMF based on the
locally available information i.e. LMF profiles are configured locally at AMF
or LMF, or by querying NRF.
The following factors may be considered during the LMF selection:
\- LCS client type.
\- Requested Quality of Service information, e.g.:
\- LCS accuracy,
\- Response time (latency),
\- Access Type (3GPP /N3GPP).
NOTE 1: Location methods may differ depending on the Access Type, e.g. in the
case of WLAN Access Location determination may just correspond to retrieval of
IP addressing information from the N3IWF/TNGF; As another example, for
Wireline access, Location determination may just correspond to retrieval of
geo coordinates corresponding to a GLI as defined in TS 23.316 [21] clause
4.7.8 or a HFC Node ID.
\- RAT type (i.e. 5G NR or eLTE) and/or the serving AN node (i.e. gNB or NG-
eNB) of the target UE.
\- RAN configuration information.
\- LMF capabilities.
\- LMF load.
\- LMF location.
\- Indication of either a single event report or multiple event reports.
\- Duration of event reporting.
\- Network slicing information, e.g. S-NSSAI and/or NSI ID.
When receiving a NAS message from UE, including an LMF ID together with a LPP
message (refer to step 25 in clause 6.3.1 for event reporting for a deferred
5GC-MT-LR), AMF sends the LPP message to the LMF, as indicated by the LMF ID.
NOTE 2: description on how UE encapsulates the LMF ID in the NAS message is
documented in TS 24.571 [36].
## 5.1a GMLC Discovery and Selection
More than one GMLC in the HPLMN can serve the location requests for a single
UE. GMLC discovery and selection functionality is supported by AMF, LMF, NEF,
LCS client and GMLC.
A LCS client may be configured with GMLC address(es). It may also determine
the GMLC address by performing a DNS query.
A NEF, LMF, AMF or GMLC may be configured with GMLC address(es). Those NF may
also query the NRF to get GMLC address(es).
In the following scenarios, information about the GMLC instance may be
provided by UE, in such case, this GMLC instance is used:
\- In the deferred MT-LR procedure, when UE reports the detected event to the
AMF, it may also include the (H)GMLC address.
\- In the MO-LR procedure, when UE initiates the LCS service request, it may
also include the (H)GMLC address if the location estimation is reported to the
(H)GMLC.
## 5.2 3GPP access specific aspects
When 3GPP access type is selected, the positioning methods for 3GPP access
defined in TS 38.305 [9] apply.
Access Type Selection for LCS Service is defined in clause 5.3.2.
## 5.3 Non-3GPP Access Specific Aspects
### 5.3.1 Location Information for Non-3GPP Access
If the UE registered to non-3GPP access, following information can be regarded
as UE location information:
Table 5.3.1-1: Supported UE location information of non-3GPP access
+----------------+----------------+----------------+----------------+ | | Untrusted | Trusted | Wireline | | | non-3GPP | non-3GPP | Access | | | Access | Access | | +================+================+================+================+ | UE Side | UE local IP | UE/N5CW device | Null | | | address, | local IP | | | N5CW device | | address | | | Side for | In the case of | (NOTE 2). | | | Trusted WLAN | WLAN access, | | | | Access | BSSID of the | In the case of | | | | attached AP or | WLAN access, | | | 5G-RG side for | BSSID of | BSSID of the | | | Wireline | detected AP, | attached AP or | | | Access | | BSSID of | | | | Civic address | detected AP, | | | | and/or | | | | | geospatial | Civic address | | | | location | and/or | | | | information | geospatial | | | | (NOTE 1, | location | | | | NOTE 5, | information | | | | NOTE 6). | (NOTE 1, | | | | | NOTE 5, | | | | | NOTE 6). | | +----------------+----------------+----------------+----------------+ | N3IWF Side for | UE local IP | UE/N5CW device | HFC node ID | | Untrusted | address and | local IP | for 5G-CRG in | | non-3GPP | optionally UDP | address and | TS | | Access; | or TCP source | optionally UDP | 23.316 [21] | | | port (NOTE 2) | or TCP source | clause 10.1; | | TNGF Side for | | port (NOTE 2), | | | trusted | | | GLI for 5G-BRG | | non-3GPP | | TNAP/TWAP Id | in | | Access; | | (NOTE 2) | TS | | | | | 23.316 [21] | | TWIF Side for | | | clause 10.1. | | trusted WLAN | | | | | Access; | | | | | | | | | | W-AGF Side for | | | | | wireline | | | | | Access | | | | +----------------+----------------+----------------+----------------+ | AMF Side | UE local IP | UE/N5CW device | HFC node ID | | | address and | local IP | for 5G-CRG in | | | optionally UDP | address and | TS | | | or TCP source | optionally UDP | 23.316 [21] | | | port (NOTE 3). | or TCP source | clause 10.1; | | | | port (NOTE 2, | | | | Last known | NOTE 3). | GLI for 5G-BRG | | | 3GPP access | | in | | | User Location | Last known | TS | | | Info (NOTE 4). | 3GPP access | 23.316 [21] | | | | User Location | clause 10.1 | | | | Info (NOTE 4). | | | | | | | | | | TNAP/TWAP Id | | | | | (NOTE 2) | | +----------------+----------------+----------------+----------------+ | NOTE 1: In the | | | | | case of WLAN | | | | | access, the UE | | | | | may retrieve | | | | | its location | | | | | from a WLAN | | | | | AP, prior or | | | | | after | | | | | association | | | | | with the AP, | | | | | requesting the | | | | | Civic Location | | | | | ANQP element, | | | | | the Geospatial | | | | | Location ANQP | | | | | element or | | | | | both as | | | | | specified in | | | | | IEEE Std | | | | | 802.11-2012, | | | | | using ANQP | | | | | procedures | | | | | described in | | | | | HS2.0 Rel-12 | | | | | specification. | | | | | | | | | | NOTE 2: More | | | | | details can | | | | | refer to | | | | | TS | | | | | 23.501 [18] | | | | | clause 5.6.2. | | | | | | | | | | NOTE 3: This | | | | | location | | | | | information | | | | | can be | | | | | provided by | | | | | location | | | | | change event, | | | | | more details | | | | | can refer to | | | | | TS | | | | | 23.502 [19] | | | | | cla | | | | | use 5.2.2.3.1. | | | | | | | | | | NOTE 4: This | | | | | location | | | | | information is | | | | | also named as | | | | | Last known | | | | | Cell-Id, more | | | | | details can | | | | | refer to | | | | | TS | | | | | 23.501 [18] | | | | | clause 5.6.2. | | | | | | | | | | NOTE 5: | | | | | Geospatial | | | | | location | | | | | information | | | | | can be | | | | | obtained if UE | | | | | (e.g. laptop) | | | | | has installed | | | | | GNSS receiver, | | | | | i.e. GPS. | | | | | | | | | | NOTE 6: Some | | | | | Applications | | | | | (e.g. Google | | | | | Map) may map | | | | | the WiFi AP\'s | | | | | BSSID with the | | | | | geospatial | | | | | locations | | | | | obtain through | | | | | GPS when the | | | | | UE switch on | | | | | the GPS and | | | | | WiFi | | | | | s | | | | | imultaneously. | | | | | When another | | | | | UE detect the | | | | | same AP, the | | | | | Application | | | | | will send the | | | | | geospatial | | | | | locations to | | | | | the UE. Thus | | | | | the UE obtain | | | | | the geospatial | | | | | locations even | | | | | without switch | | | | | on the GPS. If | | | | | the | | | | | Application | | | | | map the | | | | | geospatial | | | | | locations to | | | | | civic address, | | | | | the UE can | | | | | also obtain | | | | | the civic | | | | | address. | | | | +----------------+----------------+----------------+----------------+
If the UE registered to 3GPP access and non-3GPP access simultaneously,
following information can be regarded as UE location information:
\- All location information when the UE only registered to non-3GPP access,
\- All location information when the UE only registered to 3GPP access, more
details can refer to TS 36.305 [7].
### 5.3.2 Access Type Selection for LCS Service
The positioning of a UE can be performed via either 3GPP access network or
non-3GPP access network.
For a MT-LR Location Service request, in order to select the positioning
access type, the GMLC uses information retrieved from the UDM and optionally
serving AMFs, e.g. access type, its serving AMF identity(ies), and UE
connectivity state of this access, if available, and locally configured
operator policy as follows:
\- If only one AMF identity is provided by the UDM, the GMLC selects this AMF
for UE positioning.
\- When the UE is concurrently served by multiple PLMNs respectively for 3GPP
access and non-3GPP access, multiple AMF identities with corresponding access
types may be provided by the UDM, and the GMLC selects one access type and its
associated AMF, which may be based on access type and its AMF, UE connectivity
state per access type information, if this is retrieved from UDM or AMFs, PLMN
identity, and/or locally configured operator policy. If the location
estimation result provided by this AMF cannot fulfil the QoS requirements, the
GMLC may reselect another access type and its associated AMF from the
candidate list provided by the UDM to perform positioning.
When AMF receives a MT-LR Location Service request, the AMF shall provide to
the LMF UE connectivity state per access type as well as the QoS requirement
that are received from the GMLC.
When AMF receives the event report from the UE for a periodic or triggered MT-
LR Location Service, the AMF may select a LMF or use the LMF indicated by the
UE as described in clause 6.4 and clause 6.3.1 and may provide the UE
connectivity state per access type to the LMF.
The LMF determines the positioning access type and positioning method based on
the QoS requirement, UE/network positioning capability, and UE connectivity
state per access type received from the AMF and the locally configured
operator policy.
## 5.4 UE LCS privacy
### 5.4.1 General
An LCS client or AF may or may not be authorised to retrieve the UE location,
e.g. for commercial use. UE LCS privacy is a feature which allows a UE and/or
AF to control which LCS clients and AFs are and are not allowed access to UE
location information. UE LCS privacy can be supported via subscription and via
UE LCS privacy profile handling.
With subscription, privacy preferences for a UE are stored in a UE LCS privacy
profile as part of UE subscription data in the UDM and queried from the UDM by
another NF such as GMLC or NEF. The UDM may also store the UE privacy profile
in the UDR. In this release of the specification, subscription of privacy
preferences is restricted to the Call/Session unrelated Class as defined in
clause 5.4.2.2.3 and the PLMN Operator Class as defined in clause 5.4.2.2.4.
With UE LCS privacy profile handling, the UE and/or AF can provide and update
part of the UE privacy profile and provide it to the network as an update to
the UDR. In this release of the specification, UE LCS privacy profile handling
is restricted to the Location Privacy Indication as defined in clause 5.4.2.3.
The UE LCS privacy profile is used to indicate whether LCS requests from LCS
clients and AFs are allowed or disallowed, together with the POI as defined in
clause 5.4.4.
NOTE: In clause 5.4, even if the UE LCS privacy detail is only described for
LCS client, the same detail is also applicable for AF, if no exception
statement.
### 5.4.2 Content of UE LCS Privacy Profile
#### 5.4.2.1 General
The UE LCS privacy profile shall include information related to classes of LCS
client, referred to as \"privacy classes\", which are permitted, or
conditionally permitted, to obtain location information for the UE. Privacy
classes are defined in clause 9.5.3 of TS 23.271 [4], but not all classes
defined in TS 23.271 [4] are supported in this specification. Privacy classes
are supported as described below. The differences between the Privacy classes
for 5GS and those for EPS are described in Annex A.
The UE LCS privacy profile also includes the Location Privacy Indication, as
defined in clause 5.4.2.3, which can be provided and updated by the UE and/or
AFs.
#### 5.4.2.2 Privacy Classes
##### 5.4.2.2.1 Universal Class
The universal class defined in clause 9.5.3.1 of TS 23.271 [4] is not
supported in this specification.
##### 5.4.2.2.2 Call/Session related Class
The call/session related class defined in clause 9.5.3.2 of TS 23.271 [4] is
not supported in this specification.
##### 5.4.2.2.3 Call/Session unrelated Class
The call/session unrelated class defined in clause 9.5.3.3 of TS 23.271 [4] is
supported for a 5GC-MT-LR. The subscription options for the Call/Session
unrelated Class may be assigned to an identified value added LCS Client, AF,
value added LCS Client group or service type as described in clause 7.1 and
comprise one of the following alternatives:
\- positioning allowed without notifying the UE user (default case);
\- positioning allowed with notification to the UE user;
\- positioning requires notification and verification by the UE user;
positioning is allowed only if granted by the UE user or if there is no
response to the notification;
\- positioning requires notification and verification by the UE user;
positioning is allowed only if granted by the UE user.
NOTE: LCS service types are defined in TS 22.071 [2] and numeric values for
LCS service types are listed in clause 17.7.8 of TS 29.002 [29].
A default subscription as described in TS 23.271 [4] clause 9.5.3.3 is
included in the UE LCS privacy profile for any value added LCS client or AF
not otherwise identified for the Call/Session unrelated Class and defines one
of the following alternatives:
\- positioning not allowed (default case);
\- positioning allowed with notification to the UE user;
\- positioning requires notification and verification by the UE user;
positioning is allowed only if granted by the UE user or if there is no
response to the notification;
\- positioning requires notification and verification by the UE user;
positioning is allowed only if granted by the UE user.
The subscription options for the Call/Session unrelated Class may further
indicate additional information for each identified value added LCS client,
for each identified service type and for the unidentified value added LCS
clients as follows:
\- A valid time period for positioning;
\- A valid geographic area for positioning.
The UE LCS privacy profile may also indicate that any unidentified value added
LCS client or an LCS Client associated with an identified service type shall
provide a codeword in order to locate the UE, where the codeword is verified
by either a GMLC or the UE. When verification by a GMLC is indicated, a list
of one or more codewords is included as part of the UE LCS privacy profile.
##### 5.4.2.2.4 PLMN Operator Class
The PLMN operator class defined in clause 9.5.3.4 of TS 23.271 [4] is
supported.
#### 5.4.2.3 Location Privacy Indication (LPI)
The Location Privacy Indication is not defined in TS 23.271 [4]. The Location
Privacy Indication defines whether LCS requests for UE from any LCS clients
are allowed or disallowed.
The LPI at least includes one of the following global settings (for all LCS
clients and AFs):
\- Location for UE is disallowed (location for UE not allowed to any LCS
client except where POI applies).
\- Location for UE is allowed (default setting, and LCS requests for UE from
LCS clients are authorized based on their associated privacy classes as
defined in clause 5.4.2.2).
NOTE: Additional LPI values may be supported for additional differentiation of
location request types.
The LPI also allows the following optional settings:
\- Valid time period for LPI, including start time and end time.
The LPI takes precedence on the subscribed privacy classes as defined in
clause 5.4.2.2. The LPI allows a UE to override the location preference of the
subscribed privacy classes. The usage of LPI is described in clause 6.1.2.
### 5.4.3 Provision of UE LCS privacy profile
A generation or change to the LPI in UE LCS privacy profile is determined by
the UE and provided to the network using N1 NAS message. It may be updated by
UE any time.
An authorized AF is allowed to provision the LPI in UE LCS privacy profile for
specific UE(s) via NEF.
NOTE: The AF allowed to provision the UE LCS privacy profile is different from
the AF sending location requests.
The LPI in UE LCS privacy profile may be provided or updated by the target UE
during the 5GC-MT-LR and Deferred 5GC-MT-LR Procedure for Periodic, Triggered
and UE Available Location Events. The updated profile is stored into the UDR
by the UDM after the interaction with the AMF. The LPI in UE LCS privacy
profile shall include an indication if location is allowed or disallowed and
may include a valid time period for LPI as described in clause 5.4.2.3.
In addition, a notification is sent by the UDM in order to notify the
subscribed consumer i.e. GMLC and NEF about the change of UE LCS privacy
profile:
\- Target UE identity (one or both of GPSI and SUPI);
\- Updated UE LCS privacy profile.
### 5.4.4 Privacy Override Indicator (POI)
The POI is used to determine whether the UE LCS privacy profile of the
subscriber to be positioned shall be overridden by the request for location
services. The POI is applicable only to regulatory services. The assignment of
a POI value with an \"override\" or \"not override\" value in the LCS client
profile (see clause 7.2.1) is done during the LCS client provisioning (out of
scope of this specification). The type of LCS client requesting location
information (i.e. emergency, law-enforcement etc.) shall determine the value
of the POI assigned to the LCS client profile.
### 5.4.5 LCS service authorization for an Immediate UE Location
UDM provides the UE LCS privacy profile to NEF and GMLC, if the information is
available.
For a 5GC_MT_LR request for immediate location, the GMLC in the HPLMN, or the
HGMLC when the UE is roaming, determines whether the LCS client or NF is
authorized to retrieve UE location, based on the UE privacy profile.
NOTE 1: The UE LCS privacy profiles are not sent to the VGMLC.
Authorization is determined by first verifying whether the location request is
allowed according to the Location Privacy Indication (LPI) defined in clause
5.4.2.3. If the location request is not allowed, an error response is returned
to the LCS client, AF, or NF. If the location request is allowed according to
the LPI, authorization is next verified according to the Call/Session
unrelated Class for an LCS Client or AF or according to the PLMN Operator
Class for an NF.
For the Call/Session unrelated Class client types where POI does not apply,
the HGMLC determines one of the following indications to be included in the
location request forwarded to the serving AMF, or VGMLC in the case of
roaming:
\- Location allowed without notification;
\- Location allowed with notification;
\- Location with notification and privacy verification; location allowed if no
response;
\- Location with notification and privacy verification; location restricted if
no response.
For PLMN Operator Class client types that are permitted to receive UE location
information or where POI applies, a \"location allowed without notification\"
is included.
For a Call/Session unrelated Class client type, which a geographic area
restriction was included in the UE LCS privacy profile, the (H)GMLC performs
an initial location by including a \"location allowed without notification\"
indication in the location request sent to the VGMLC or AMF. The (H)GMLC then
determines, based on the obtained location, whether location of the UE is
allowed. If location of the UE is allowed subject to notification or
verification, the (H)GMLC initiates a second location request to the VGMLC or
serving AMF for the purpose of notification and/or verification only and
includes one of the following indications in the second location request
forwarded to the serving AMF, or VGMLC in the case of roaming:
\- Notification only
\- Notification and privacy verification only
When \"Notification and privacy verification only\" is included, the serving
AMF shall report the result of privacy verification back to the (H)GMLC (i.e.
location allowed, location not allowed or timeout on a response) and the
(H)GMLC shall determine whether or not to return the location received for the
first request back to the LCS client based or AF on this result.
For a direct NEF query to a serving AMF, or for an NEF query via the UDM, if
GMLC is not involved, the NEF determines whether the AF is authorized to
retrieve UE location, based on the UE LCS privacy profile.
NOTE 2: Notification and verification are not supported for a direct NEF query
to a serving AMF, or for an NEF query via the UDM. Consequently, when
notification or verification are required, or may be required based on a
geographic area restriction, an NEF shall forward a location request to a GMLC
or return an error indication to the requesting AF.
### 5.4.6 LCS service authorization for a Deferred UE Location
Support of UE LCS privacy for a deferred UE location is the same as that
described in clause 5.4.5 for an immediate UE location with the differences
and qualifications described in this clause.
An (H)GMLC or NEF shall subscribe to notification of a change in the UE LCS
privacy profile from the UDM at the start of a deferred 5GC-MT-LR procedure
and shall verify UE privacy both at the start of the deferred 5GC-MT-LR
procedure and for each location result returned to an LCS client or AF based
on the most recent UE LCS privacy profile received from the UDM.
If the UE LCS privacy profile indicates notification or verification of a
location request is required for a particular value added LCS client, the
(H)GMLC indicates this in the initial location request sent to the serving AMF
and the serving AMF notifies the UE or verifies the location request with the
UE, as for an immediate location request, when the UE first becomes reachable.
The serving AMF also indicates the type of deferred location request in the
NAS Location Notification Invoke Request sent to the UE. However, the location
notification or verification is not repeated for each UE location in the case
of a periodic or triggered 5GC-MT-LR.
For a value added LCS client, AF, value added LCS client group or LCS service
type, for which a geographic area restriction was included, the (H)GMLC
includes any request for notification or verification of the location request
in the initial location request sent to the serving AMF. The (H)GMLC then
determines whether a location result can be returned to the LCS client or AF
based on whether the location result is or is not restricted by the geographic
area restriction. If the location result is allowed by the geographic area
restriction, the (H)GMLC does not perform a second location request to the
serving AMF for the purpose of notification and/or verification only. If the
location result is not allowed by the geographic area restriction, the (H)GMLC
discards the location result without notifying the LCS client or AF.
## 5.5 Location service exposure
Location service can be exposed to the authorized control plane NF or the LCS
client to obtain the UE location to enable their application and services
using the MT-LR procedure. For the location service exposed to the AF which is
not allowed to directly interact with the GMLC or AMF, CAPIF API may be used
between NEF and the AF as described in clause 6.2.5.1 of TS 23.501 [18].
For location service exposure, there are two types of location service
requests as defined in clause 4.1a.4 and clause 4.1a.5:
\- Location Immediate Request (LIR); and
\- Location Deferred Request (LDR).
The following attributes may be included in the location service requests:
\- Target UE identity;
\- LCS Client identity or AF ID;
\- Service identity, if needed;
\- Codeword, if needed;
\- Type of Event definition, i.e. UE available, change of area, motion or
periodic location, applicable to deferred location requests only;
\- Definitions for change of area type deferred location requests. Following
parameters may be defined, if needed;
a) Indication for event trigger, i.e. UE enters, leaves or is within requested
target area;
b) Indication of either a single event report or multiple event reports;
c) Minimum time interval between area event reports, if multiple event reports
are requested;
d) Indication of the requested location estimate; i.e. whether the location
estimate of the target UE should be contained in the change of area event
report;
e) Duration of event reporting;
f) Maximum time interval between reports;
g) Maximum sampling time for event detection;
\- Definitions for motion type deferred location requests. Following
parameters may be defined, if needed;
a) Linear distance threshold;
b) Indication of either a single event report or multiple event reports;
c) Minimum time interval between motion event reports, if multiple event
reports are requested;
d) Indication of the requested location estimate; i.e. whether the location
estimate of the target UE should be contained in the motion event report;
e) Duration of event reporting;
e) Maximum time interval between reports;
f) Maximum sampling time for event detection;
\- Definitions for periodic location type deferred location requests.
Following parameters may be defined, if needed:
a) Time interval between successive location reports;
b) Total number of reports;
\- Start time, stop time (i.e. specifying the validity time of LCS request),
if needed for LCS Client e.g. using the OMA MLP protocol;
\- Interval, applicable to periodical requests only;
\- Requested LCS Quality of Service information, if needed, i.e. accuracy,
response time and LCS QoS Class;
\- Requested type of location, i.e. \"current location\", \"current or last
known location\" or \"initial location\" applicable to LIR only (current
location is only available for LDR);
\- Velocity of the UE, if needed;
\- Priority, if needed;
\- Service coverage (i.e. E.164 country codes for geographic areas, ITU-T
Recommendation E.164 [23]), if needed;
\- Requested maximum age of location, if needed;
\- Local coordinate reference system, if needed for LCS Client e.g. using the
OMA MLP protocol;
\- Target area, i.e. geographical area expressed as one of the following
format, if needed:
a) a shape defined in TS 23.032 [8];
b) local coordinate system for LCS Client e.g. using the OMA MLP protocol;
c) E.164 country code for a geographic area [23] for LCS Client e.g. using the
OMA MLP protocol;
d) PLMN identity for LCS Client e.g. using the OMA MLP protocol;
e) geopolitical name of the area (e.g. London) for LCS Client e.g. using the
OMA MLP protocol;
\- Response Method, if needed for LCS Client e.g. using the OMA MLP protocol.
The following attributes may be included in the location service response:
\- Location indication of UE in geographical coordinates expressed as a shape
as defined in TS 23.032 [8] or for LCS Client e.g. using the OMA MLP protocol,
local coordinate system;
\- Velocity of the UE as defined in TS 23.032 [8], if requested and if
available;
\- The information about the positioning method used to obtain the location
estimate of the UE, if it is available at the LCS server and if needed;
\- Time stamp of location estimate;
\- Indication when UE enters, is within or leaves the Geographical area, if
needed;
\- Acknowledgement for a deferred location request, if needed.
\- Request id, if needed.
\- Indication that the requested QoS was not met, if needed, only applicable
if the request was for best effort class
\- Indication of a periodic event.
\- Indication of a motion event.
\- Indication that a deferred location request has been activated in a UE.
\- Indication of expiration of the maximum reporting interval for the area
event or motion event for LCS Client e.g. using the OMA MLP protocol.
In addition, the information attributes of the location service request may be
used also in the location service response.
For a LCS client in the core network, the LCS service request is sent to GMLC
using Le interface.
For an AF not allowed to directly interact with the GMLC or AMF, the LCS
service request is sent to NEF using the service based interface.
For an internal control plane NF, the LCS service request is sent to AMF or
GMLC using the service based interface.
NOTE: For regulatory services, any control plane NF can be LCS client.
To support location service exposure through NEF, when NEF receives a LCS
service request, it determines based on the location accuracy of the QoS
requirement, e.g. lower or higher than cell-ID level, on whether to invoke the
GMLC service or the AMF service for the LCS service request.
## 5.6 LCS Charging
Charging Information for LCS service is collected at GMLC and AMF. For roaming
case, the Charging Information shall be collected in both home PLMN and
visited PLMN for inter-operator charging purpose.
Charging mechanism for LCS service and the Charging Information collected at
GMLC and at AMF are defined in TS 32.271 [30] and TS 32.298 [31].
## 5.7 Support of Concurrent Location Requests
### 5.7.1 General
Concurrent Location Requests occur when any entity (e.g. UE, AMF, LMF, GMLC,
NEF):
\- Case A: receives/initiates multiple LCS requests (e.g. 5GC-MT LR, 5GC-MO
LR, 5GC-NI LR) for the location estimate of the same target UE within a time
period; or
\- Case B: receives/initiates one or more new LCS request(s) (e.g. 5GC-MT LR,
5GC-MO LR, 5GC-NI LR) for the location estimate of the same target UE during
the location session to support the old LCS request(s).
In either case, if allowed by the QoS requirements and privacy settings, the
entity may combine the concurrent location requests by fully executing one of
the requests and using the ensuing location estimate result(s) to satisfy the
other request(s) without fully executing the latter. When concurrent location
requests are supported, each entity needs to ensure it correlates each
location/position response with the associated request and different
concurrent location requests shall be treated separately without any
dependency on one another by any entity.
NOTE 1: Combining of location requests is not allowed for a deferred 5GC-MT-LR
for periodic or triggered location for privacy reasons (e.g. a target UE would
not be aware that location event reports were being sent to multiple AFs
and/or external LCS clients).
NOTE 2: An entity (e.g. AMF, GMLC, NEF) may cache location information
obtained for one location request and use this information to support later
location requests for \"current or last known location\". This is not
considered to be a case of concurrent location requests.
If the entity, either itself or in association with another entity, cannot
support concurrent location requests or it can only support up to a certain
number of concurrent location requests, it can reject or defer a new
concurrent request or cancel one or more existing requests. For Case B, it can
also allow the new location request to proceed concurrently with and
separately from the previous requests.
LCS Client/AF priority and any other relevant priority information (e.g. UE
subscription preferences) should be considered when rejecting or deferring a
concurrent request or when cancelling one or more existing requests. In
particular, location requests associated with emergency services or lawful
interception clients should be given priority over other location requests.
### 5.7.2 Combining location requests by an H-GMLC or NEF
An H-GMLC or NEF may combine concurrent location requests (e.g. 5GC-MT LR,
5GC-MO LR, 5GC-NI LR) for the same target UE by executing only one request and
using the ensuing location estimate result(s) to satisfy the other request(s).
The conditions for this are as follows:
\- the H-GMLC must be able to fully resolve privacy requirements for the other
location request(s) without requiring notification or verification by the UE
(though notification only as in steps 17-23 of clause 6.1.2 could still be
used in the case of location dependent privacy); and
\- the QoS for the other request(s) should be less strict than the QoS for the
executed location request.
An H-GMLC may also combine concurrent location requests in the case of a bulk
location request for a group of UEs as described in clause 6.8. In this case,
location information for any UE in the group may be obtained from location
information obtained from another concurrent location request for the same UE.
### 5.7.3 Combining location requests by a V-GMLC
A V GMLC may combine concurrent 5GC-MT LR and 5GC-MO-LR related location
requests for the same target UE provided it is clear and unambiguous for any
5GC-MT LR that will not be fully executed (e.g. from the contents of any
location request received from the H GMLC) that no outstanding privacy related
actions are required for the UE (e.g. no privacy notification and/or privacy
verification interaction with the UE). QoS requirements must also be satisfied
for the non-executed location requests.
### 5.7.4 Combining location requests by an AMF
An AMF may combine concurrent 5GC-MT LR, 5GC-MO LR and 5GC-NI LR location
requests once any needed privacy related actions (e.g. UE notification and
verification) have been performed for each 5GC-MT LR. (i.e. AMF may decide to
not execute multiple positioning procedures for the concurrent location
requests) QoS requirements must also be satisfied for the non-executed
location requests.
### 5.7.5 Combining location requests by an LMF
An LMF may combine concurrent location requests for the same target UE
provided QoS requirements can be satisfied for the non-executed location
requests.
### 5.7.6 Combining location requests by a UE
A UE may combine concurrent location requests provided QoS requirements can be
satisfied and provided any positioning procedures with an LMF remain supported
according to the positioning protocol.
## 5.8 Interworking with the IMS
When the location service request is initiated by the LCS Client / AF for the
location estimation of a target UE in an IMS session, a SIP-URI or a TEL-URL
maybe included in the request to identify the target UE. In that case, the
H-GMLC of the UE shall be able to convert the SIP-URI/TEL-URL into SUPI of the
target UE.
NOTE 1: The H-GMLC may query IMS-HSS or UDM to retrieve the SUPI of the target
UE based on its SIP-URI/TEL-URL.
NOTE 2: If multiple SUPIs are resolved for the SIP-URI/TEL-URL, the H-GMLC
behaviour is out of scope of this specification.
# 6 Location Service Procedures
## 6.1 5GC-MT-LR Procedure
### 6.1.1 5GC-MT-LR procedure for the regulatory location service
Figure 6.1.1-1 illustrates the general network positioning for the LCS clients
external to the PLMN for the regulatory location service for non-roaming
scenario. In this scenario, it is assumed that the target UE is identified
using an SUPI or GPSI.
This procedure is applicable to a request from an LCS client for a current
location of the target UE, and it is assumed that the LCS client is authorised
to use the location service and no privacy verification is required.
Figure 6.1.1-1: 5GC-MT-LR procedure for the regulatory location service
1\. The external location services client sends a request to the GMLC for a
location for the target UE identified by an GPSI or an SUPI. The request may
include the required QoS and Supported GAD shapes. If location is required for
more than one UE, the steps following below may be repeated and in that case
the GMLC shall verify whether the number of Target UEs in the LCS request is
equal to or less than the Maximum Target UE Number of the LCS client. If
Maximum Target UE Number is exceeded, the GMLC shall reject the LCS request,
the step 2-10 are skipped, and then GMLC respond to the client with proper
error cause in the step 11.
2\. The GMLC invokes a Nudm_UECM_Get service operation towards the home UDM of
the target UE to be located with the GPSI or SUPI of this UE.
3\. The UDM returns the network addresses of the current serving AMF.
NOTE: For backward compatibility, the GMLC can use a Nudm_SDM_Get service
operation to retrieve the SUPI of the target UE from a Rel-15 UDM as defined
in 23.502 [19] clause 5.2.3.3.2.
4\. The GMLC invokes the Namf_Location_ProvidePositioningInfo service
operation towards the AMF to request the current location of the UE. The
service operation includes the SUPI, and client type and may include the
required QoS and Supported GAD shapes.
5\. If the UE is in CM IDLE state, the AMF initiates a network triggered
Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19] to
establish a signalling connection with the UE.
6\. The AMF selects an LMF based on the available information as defined in
clause 5.1 or based on AMF local configuration. The LMF selection takes the
5G-AN currently serving the UE into account. The selection may use a NRF
query.
7\. The AMF invokes the Nlmf_Location_DetermineLocation service operation
towards the LMF to request the current location of the UE. The service
operation includes a LCS Correlation identifier, the serving cell identity of
the Primary Cell in the Master RAN node and the Primary Cell in the Secondary
RAN node when available based on Dual Connectivity scenarios, and the client
type and may include an indication if UE supports LPP, the required QoS and
Supported GAD shapes. If any of the procedures in clause 6.11.1 or clause
6.11.2 are used the service operation includes the AMF identity.
8\. The LMF performs one or more of the positioning procedures described in
clauses 6.11.1, 6.11.2 and 6.11.3. During this step the LMF may use the
Namf_Communication_N1N2MessageTransfer service operation to request the
transfer of a Positioning related N1 message to the UE or the transfer of a
Network Positioning message to the serving NG-RAN node (gNB or NG-eNB) for the
UE.
9\. The LMF returns the Nlmf_Location_DetermineLocation Response towards the
AMF to return the current location of the UE. The service operation includes
the LCS Correlation identifier, the location estimate, its age and accuracy
and may include information about the positioning method.
10\. The AMF returns the Namf_Location_ProvidePositioningInfo Response towards
the GMLC/LRF to return the current location of the UE. The service operation
includes the location estimate, its age and accuracy and may include
information about the positioning method.
11\. The GMLC sends the location service response to the external location
services client.
### 6.1.2 5GC-MT-LR Procedure for the commercial location service
Figure 6.1.2-1 illustrates the general network positioning requested by the
LCS clients or the AF. In this scenario, it is assumed that the target UE may
be identified using an SUPI or GPSI. This procedure is applicable to a request
from an LCS client or AF for a current location of the target UE, and it is
assumed that
\- Privacy verification may be required for the location service request;
\- The LCS client or the AF needs to be authorised to use the location
service.
Figure 6.1.2-1: 5GC-MT-LR Procedure for the commercial location services
1\. The LCS Client or the AF (via NEF) sends a request to the (H)GMLC for a
location and optionally a velocity for the target UE which may be identified
by an GPSI or an SUPI. The request may include the required QoS, supported GAD
shapes and other attributes. (H)GMLC (for 1a) or NEF (for 1b) authorizes the
LCS Client or the AF for the usage of the LCS service. If the authorization
fails, step 2-23 are skipped and (H)GMLC (for 1a) or NEF (for 1b) responds to
the LCS Client or the AF the failure of the service authorization in step 24.
In some cases, the (H)GMLC derives the GPSI or SUPI of the target UE and
possibly the QoS from either subscription data or other data supplied by the
LCS Client or AF.
The LCS request may carry also the Service Identity (see TS 22.071 [2]) and
the Codeword and the service coverage information. The (H)GMLC may verify that
the Service Identity received in the LCS request matches one of the service
identities allowed for the LCS client or AF. If the service identity does not
match one of the service identities for the LCS client or AF, the (H)GMLC
shall reject the LCS request. Otherwise, the (H)GMLC can map the received
service identity in a corresponding service type.
If the LCS service request contains the pseudonym of the target UE and the
(H)GMLC cannot resolve the PMD address from the pseudonym, the (H)GMLC itself
determines the verinym (GPSI or SUPI) of the target UE. If the (H)GMLC can
resolve the address of PMD from the pseudonym, the HGMLC requests the verinym
from its associated PMD. If (H)GMLC is not able to obtain the verinym of the
target UE, the (H)GMLC shall cancel the location request.
If the requested type of location is \"current or last known location\" and
the requested maximum age of location information is available, the (H)GMLC
verifies whether it stores the previously obtained location estimate of the
target UE. If the HGMLC stores the location estimate and the location estimate
satisfies the requested accuracy and the requested maximum age of location,
the (H)GMLC checks the result of the privacy check at step 2. If the result of
the privacy check for call/session unrelated class is \"Location allowed
without notification\" then steps 3-23 may be skipped.
1b-1 AF sends the Nnef_EventExposure_Subscribe to the NEF.
1b-2 The NEF identifies based on the QoS attribute received from the location
request that higher than cell-ID level location accuracy is required and
invokes the Ngmlc_Location_ProvideLocation_Request service operation to the
(H)GMLC, which contains the attributes received from the AF request. The NEF
may also invoke the Ngmlc_Location_ProvideLocation_Request service operation
to the (H)GMLC for lower than cell-ID location accuracy as an implementation
option. NEF derives the LCS client type of the AF, and provides it to H-GMLC.
If step 1a is received, H-GMLC derives the LCS client type of the LCS client.
If location is required for more than one UE, the steps following below may be
repeated and in that case the NEF or HGMLC receiving location request, shall
verify whether the number of Target UEs in the Nnef_EventExposure_Subscribe or
LCS request is equal to or less than the Maximum Target UE Number of the LCS
client. If Maximum Target UE Number is exceeded, the NEF or HGMLC shall reject
the Nnef_EventExposure_Subscribe or LCS request, the steps 2-23 are skipped,
and then GMLC respond to the client with proper error cause in the step 24.
NOTE 1: If cell-ID level or lower than cell-ID level location accuracy is
required in the location request, the NEF may invoke an
Namf_EventExposure_Subscribe service operation to subscribe location event
reporting from the AMF for the target UE as further described in clause 6.5.
2\. The (H)GMLC invokes a Nudm_SDM_Get service operation towards the UDM of
the target UE to get the privacy settings of the UE identified by its GPSI or
SUPI. The UDM returns the target UE Privacy setting of the UE. The (H)GMLC
checks the UE LCS privacy profile. If the target UE is not allowed to be
located, steps 3-23 are skipped.
3\. The (H)GMLC invokes a Nudm_UECM_Get service operation towards the UDM of
the target UE with GPSI or SUPI of this UE. The UDM returns the network
addresses of the current serving AMF and additionally the address of a VGMLC
(for roaming case). If the location request is an immediate location request,
the (H)GMLC checks the country codes of the serving node addresses. If the
(H)GMLC finds the current AMF is out of the service coverage of the (H)GMLC,
the (H)GMLC returns an appropriate error message to the LCS client or AF (via
NEF).
NOTE 2: The UDM is aware of the serving AMF address at UE registration on an
AMF as defined in clause 4.2.2.2.2 of TS 23.502 [19]. The UDM is aware of a
serving VGMLC address at UE registration on an AMF as defined in clause
4.2.2.2.2 of TS 23.502 [19].
NOTE 3: The HGMLC can also query the HSS of the target UE for a serving MME
address as described in clause 9.1.1 of TS 23.271 [4]. The EPC-MT-LR procedure
described in clause 9.1.15 of TS 23.271 [4], excluding the UE availability
event, may then be performed instead of steps 4-23, e.g. if the HSS returns an
MME address but the UDM does not return an AMF address.
4\. For a non-roaming case, this step is skipped. In the case of roaming, the
HGMLC may receive an address of a VGMLC (together with the network address of
the current serving AMF) from the UDM in step 3, otherwise, the HGMLC may use
the NRF service in the HPLMN to select an available VGMLC in the VPLMN, based
on the VPLMN identification contained in the AMF address received in step 3.
The HGMLC then sends the location request to the VGMLC by invoking the
Ngmlc_Location_ProvideLocation service operation towards the VGMLC. In the
cases when the HGMLC did not receive the address of the VGMLC, or when the
VGMLC address is the same as the HGMLC address, or when both PLMN operators
agree, the HGMLC sends the location service request message to the serving
AMF. In this case, step 4 is skipped. If the result of privacy check indicates
that the verification based on current location is needed, the HGMLC shall
send a location request to the VGMLC (in the case of roaming) or to the AMF
(in the case of non-roaming) indicating \"positioning allowed without
notification\" and VGMLC shall invoke an Namf_Location_ProvidePositioningInfo
Request service operation towards the AMF at step 5. H-GMLC also provides the
LCS client type of AF, if received in step 41b-2, or LCS client type of LCS
client and other attributes to be sent to AMF in step 5.
5\. In the case of roaming, the VGMLC first authorizes that the location
request is allowed from this HGMLC, PLMN or from this country. If not, an
error response is returned. The (H)GMLC or VGMLC invokes the
Namf_Location_ProvidePositioningInfo service operation towards the AMF to
request the current location of the UE. The service operation includes the
SUPI, the client type and may include the required LCS QoS, supported GAD
shapes, service type and other attributes as received or determined in step 1.
NOTE 4: The location request forwarded at step 4 and step 5 may also carry the
result of the privacy check in step 2 which may include a codeword provided by
the LCS Client or AF and an indication of a privacy related action as
described in clause 5.4.
6\. If the UE is in CM IDLE state, the AMF initiates a network triggered
Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19] to
establish a signalling connection with the UE.
If signalling connection establishment fails, step 7-13 are skipped and the
AMF answers to the GMLC in step 14 with the last known location of the UE
(i.e. Cell ID) together with the age of this location.
7\. If the indicator of privacy check related action indicates that the UE
must either be notified or notified with privacy verification and if the UE
supports LCS notification (according to the UE capability information), a
notification invoke message is sent to the target UE, indicating the identity
of the LCS client and the service type (if that is both supported and
available) and whether privacy verification is required.
8\. The target UE notifies the UE user of the location request and, if privacy
verification was requested, waits for the user to grant or withhold
permission. The UE then returns a notification result to the AMF indicating,
if privacy verification was requested, whether permission is granted or denied
for the current LCS request. If the UE user does not respond after a
predetermined time period, the AMF shall infer a \"no response\" condition.
The AMF shall return an error response in step 14 and if roaming VGMLC in step
15 to the HGMLC if privacy verification was requested and either the UE user
denies permission or there is no response with the indication received from
the (H)GMLC indicating barring of the location request and steps 10\~13 are
skipped.
The notification result may also indicate the Location Privacy Indication
setting for subsequent LCS requests; i.e. whether subsequent LCS requests, if
generated, will be allowed or disallowed by the UE. The Location Privacy
Indication may also indicate a time for disallowing the subsequent LCS
requests.
9\. The AMF invokes the Nudm_ParameterProvision_Update (LCS privacy) service
operation to store in the UDM the Location Privacy Indication information
received from the UE. The UDM may then store the updated UE privacy setting
information into the UDR as the \"LCS privacy\" Data Subset of the
Subscription Data.
10-13. Step 10-13 are the same as steps 6-9 defined in clause 6.1.1 with the
addition that service type may be indicated towards the LMF.
14\. The AMF returns the Namf_Location_ProvidePositioningInfo Response towards
the (V)GMLC (or HGMLC for roaming when the NL3 reference point is not
supported) to return the current location of the UE. The service operation
includes the location estimate, its age and accuracy and may include
information about the positioning method.
15\. In the case of roaming, the VGMLC forwards the location estimation of the
target UE, its age, its accuracy and optionally the information about the
positioning method received at step 14 to the HGMLC. For non-roaming scenario,
this step is skipped.
16\. If the privacy check in step 2 indicates that further privacy checks are
needed, the (H)GMLC shall perform an additional privacy check in order to
decide whether the (H)GMLC can forward the location information to the LCS
client or AF or send a notification if the result of the privacy check
requires the notification and verification based on current location. One
example when this additional privacy check is needed is when the target UE
user has defined different privacy settings for different geographical
locations. When an additional privacy check is not needed, the (H)GMLC skips
steps 17-23.
17\. If the result of privacy checks in step 16 indicates that the
notification (and verification) based on current location is needed, and in
the case of roaming, the (H)GMLC shall send a location request to the VGMLC
with location type indicating \"notification only\".
18\. The (H)GMLC or VGMLC invokes the Namf_Location_ProvidePositioningInfo
service operation towards the AMF to request notification (and verification)
based on current location.
19\. If the UE is in CM IDLE state, the AMF initiates a network triggered
Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19] to
establish a signalling connection with the UE.
20\. If the indicator of privacy check related action indicates that the UE
must either be notified or notified with privacy verification and if the UE
supports LCS notification, the AMF sends a notification invoke message to the
target UE, indicating the identity of the LCS client and the service type (if
that is both supported and available) and whether privacy verification is
required.
21\. Step 21 is the same as step 8.
22\. The AMF returns the Namf_Location_ProvidePositioningInfo Response towards
the (V)GMLC (or HGMLC for roaming when the NL3 reference point is not
supported) with an indication of the result of notification and verification
procedure performed in steps 20-21.
23\. In the case of roaming, the VGMLC forwards an indication of the result of
notification and verification procedure to the HGMLC. For non-roaming
scenario, this step is skipped.
24\. The (H)GMLC sends the location service response to the LCS Client or AF
(via the NEF) if the target UE is allowed to be located by the LCS Client or
AF. Accordingly, NEF invokes Nnef_EventExposure_Notify or sends
Nnef_EventExposure_Subscribe Response to the AF. If the location request from
the LCS Client contained the pseudonym and the (H)GMLC resolved the verinym
from the pseudonym in step 1, the (H)GMLC shall use the pseudonym of the
target UE in the location response to the external LCS client. If the external
LCS client or AF requires it, the (H)GMLC may first transform the universal
location co-ordinates provided by the AMF into some local geographic system.
The (H)GMLC may record charging information both for the LCS Client or AF and
inter-network revenue charges from the AMF\'s network. The location service
response from the (H)GMLC to the LCS Client or AF may contain the information
about the positioning method used and the indication whether the obtained
location estimate satisfies the requested accuracy or not. If in step 2, step
15, step 16 or step 23 the (H)GMLC identifies that the target UE is not
allowed to be located by the LCS Client or AF, it rejects the LCS service
request, and optionally indicate in the response the reason of the rejection,
i.e. the target UE is not allowed to be located. If the LCS QoS Class is
Assured and (H)GMLC detects that requested accuracy is not achieved, the
(H)GMLC sends error response including failure cause.
## 6.2 5GC-MO-LR Procedure
Figure 6.2-1 illustrates the general network positioning requested by the UE
to the serving PLMN for obtaining the location related information of itself
or just assistance data.
Figure 6.2-1: 5GC-MO-LR Procedure
1) If the UE is in CM-IDLE state, UE instigates the UE triggered Service
Request as defined in clause 4.2.3.2 of TS 23.502 [19] in order to establish a
signalling connection with the AMF.
2) The UE sends an MO-LR Request message included in a UL NAS TRANSPORT
message. The MO-LR Request may optionally include an LPP positioning message.
Different types of location services can be requested: location estimate of
the UE, location estimate of the UE to be sent to an LCS client or AF, or
location assistance data. If the UE is requesting its own location or that its
own location be sent to an LCS client or AF, this message carries LCS
requested QoS information (e.g. accuracy, response time, LCS QoS Class), the
requested maximum age of location and the requested type of location (e.g.
\"current location\", \"current or last known location\"). If the UE is
requesting that its location be sent to an LCS client, the message shall
include the identity of the LCS client or the AF, and may include the address
of the GMLC through which the LCS client or AF (via NEF) should be accessed.
In addition, a Service Type indicates which MO-LR service of the LCS Client is
requested by the UE may be included. The message also may include a pseudonym
indicator to indicate a pseudonym should be assigned by the network and
transferred to the LCS Client as the UE\'s identity. If the UE is instead
requesting location assistance data, the embedded LPP message specifies the
type of assistance data and the positioning method for which the assistance
data applies.
For an LCS 5GC-MO-LR requesting location transfer to an LCS Client or AF, the
AMF shall assign a GMLC address, i.e. VGMLC address, which is stored in the
AMF. If a VGMLC address is not available, the AMF may reject the location
request. The AMF verifies the subscription profile of the UE and decides if
the requested service is allowed or not by checking the Mobile Originated data
retrieved from UDM during the UE Registration Procedure, as defined in clause
4.2.2.2.2 of TS 23.502 [19].
3) The AMF selects an LMF as described in clause 5.1.
4) The AMF invokes the Nlmf_Location_DetermineLocation service operation
towards the LMF. The service operation includes an LCS Correlation identifier,
the serving cell identity, the client type, an indication whether a location
estimate, or location assistance data is requested and any embedded LPP
message in the MO-LR Request. If the UE\'s location is requested, the service
request may include an indication if UE supports LPP, the requested QoS and
Supported GAD shapes. If location assistance data is requested, the embedded
LPP message will convey the requested types of location assistance data. If
any of the procedures in clause 6.11.1 or 6.11.2 are used the service
operation includes the AMF identity. Once an AMF has selected an LMF it must
continue to use that LMF for the duration of the session.
5) If the UE is requesting its own location, the actions described in clause
6.11 are performed. If the UE is instead requesting location assistance data,
the LMF transfers this data to the UE as described in clause 6.11.1. The LMF
determines the exact location assistance data to transfer according to the
type of data specified by the UE, the UE location capabilities and the current
cell.
6) When a location estimate best satisfying the requested QoS has been
obtained or when the requested location assistance data has been transferred
to the UE, the LMF returns the Nlmf_Location_DetermineLocation Response
towards the AMF. The service operation includes the LCS Correlation
identifier, the location estimate, if this was obtained, its age and accuracy
and may include information about the positioning method.
If a location estimate was not successfully obtained, or if the requested
location assistance data could not be transferred successfully to the UE, a
failure cause is included in the service operation.
If the UE is requesting location assistance data, steps 7 to 12 are skipped.
7) If the location estimate was successfully obtained, the AMF invokes the
Ngmlc_Location_LocationUpdate service operation towards to the VGMLC assigned
in the step 2. The service operation carries the identity of the UE, the event
causing the location estimate (5GC-MO-LR) and the location estimate, its age,
obtained accuracy indication and the LCS QoS Class requested by the target UE.
In addition, the service operation may include the pseudonym indicator, the
identity of the LCS Client, AF ID, the GMLC address and the Service Type
specified by the UE, if available.
8) If the UE did not request transfer of its location to an LCS Client or AF
in step 2, steps 8 to 11 are skipped. If the VGMLC is same NF instance as
HGMLC this step is skipped. Otherwise VGMLC invokes the
Ngmlc_Location_LocationUpdate service operation towards to the HGMLC (the
VGMLC may query the NRF to obtain the address of the HGMLC) including the
information received from the AMF.
9a) If the pseudonym indicator is included in the MO-LR Location Information,
the HGMLC assigns a pseudonym to the UE. If the identified LCS Client is not
accessible by the HGMLC, step 9a and step 10a are skipped. Otherwise the GMLC
transfers the location information to the LCS client, carrying the identity or
the pseudonym of the UE, the event causing the location estimate (5GC-MOâ€‘LR),
the Service Identity, if available, and the location estimate and its age, in
accordance with the LCS QoS Class requested by the target UE. If the UE
requested LCS QoS class was Assured, GMLC sends the result to the LCS client
only if the result has been indicated to fulfil the requested accuracy. If the
UE requested LCS QoS class was Best Effort, GMLC sends whatever result it
received to the LCS client with an appropriate indication if the requested
accuracy was not met.
NOTE: The HGMLC maps any Service Type received in step 8 into a Service
Identity.
9b-1) If the AF ID is included in step 1, the HGMLC assigns the NEF address
based on local configuration or via NRF and invokes
Ngmlc_Location_LocationUpdateNotify service request towards the NEF, carrying
the AF ID. The location information parameters sent within this service
operation are same as the step 9a except that no pseudonym is included.
9b-2) If the identified AF is not accessible by the NEF, step 9b-2 and step
10b-1 are skipped. Otherwise, the NEF transfer the location information to the
identified AF by invoking the Nnef_Location_LocationUpdateNotify service.
10a) If the LCS Client does not support MO-LR (for temporary or permanent
reasons) or cannot handle the location estimate of the UE, e.g. the LCS Client
does not know the Service Identity, or the UE does not register to the LCS
Client, the LCS Client has no corresponding data of the UE, the LCS Client
shall return the Location Information ack message to the HGMLC with a suitable
error cause. Otherwise, the LCS Client handles the location estimate according
to the Service Identity, sends the GMLC or the HGMLC the Location Information
ack message signalling that the location estimate of the UE has been handled
successfully.
10b-1) If the AF cannot handle the location estimate of the UE, e.g. the UE
does not register to the AF, the AF has no corresponding data of the UE, the
AF shall respond to the Nnef_Location_LocationUpdateNotify service request
with a suitable error cause. Otherwise, the AF handles the location estimate
according to the Service Identity and respond to the
Nnef_Location_LocationUpdateNotify service request indicating that the
location estimate of the UE has been handled successfully.
10b-2) The NEF sends a Ngmlc_Location_LocationUpdateNotify service response
towards the HGMLC with the outcome of the operation.
11) If the VGMLC is same NF instance as HGMLC this step is skipped. If the
identified LCS Client or AF is not accessible, the HGMLC sends a
Ngmlc_Location_LocationUpdate service response to VGMLC with an appropriate
error cause. Otherwise, the response shall include an acknowledgement. The
message shall specify whether the location estimate of the UE has been handled
successfully by the identified LCS Client or AF, and if not, the corresponding
error cause obtained in step 10. In addition, the HGMLC may record charging
information both for the UE and inter-working revenues charges.
12) If the VGMLC receives the MO-LR Location Information Acknowledgement from
the HGMLC, if the identified LCS Client or AF is not accessible, the VGMLC
sends a Ngmlc_Location_LocationUpdate service response to AMF with an
appropriate error cause. Otherwise, the response shall include an
acknowledgement. The message shall specify whether the location estimate of
the UE has been handled successfully by the identified LCS Client or AF, and
if not, the corresponding error cause obtained in step 9 or 10. In addition,
the VGMLC may record charging information both for the UE and inter-working
revenue charges.
If the VGMLC receives Ngmlc_Location_LocationUpdate Request from the AMF and
it is not required to send to any LCS Client or AF, the VGMLC may record
charging information for the UE and response the Ngmlc_Location_LocationUpdate
Request to the AMF.
13) The AMF sends an MO-LR Response message included in a DL NAS TRANSPORT
message. If the UE is requesting its own location, the response carries any
location estimate requested by the UE including the indication received from
LMF whether the obtained location estimate satisfies the requested accuracy or
not, or an indicator whether a location estimate was successfully transferred
to the identified LCS client or AF. If the location estimate was successfully
transferred to the identified LCS Client or AF, the MO-LR Response message
shall specify whether the location estimate of the UE has been handled
successfully by the identified LCS Client or AF, and if not, the corresponding
error cause obtained in step 12. In addition, AMF may record charging
information.
## 6.3 Deferred 5GC-MT-LR Procedure for Periodic, Triggered and UE Available
Location Events
### 6.3.1 Initiation and Reporting of Location Events
Figure 6.3.1-1 summarizes the initiation and reporting of location events for
a deferred 5GC-MT-LR procedure for Periodic, Triggered and UE Available
Location Events. The procedure supports mobility of a UE within a VPLMN 5GCN
and from a 5GCN to an EPC.
Figure 6.3.1-1: Deferred 5GC-MT-LR for periodic, triggered and UE available
location events
1\. The external location services client or the AF (via NEF) sends a request
to the (H)GMLC for location reporting for periodic, triggered or UE available
location events. The request is sent as described for step 1 in clause 6.1.2
with the differences described here. The LCS Service Request provides the type
of periodic or triggered location reporting being requested and associated
parameters. For periodic location, the LCS Service Request includes the time
interval between successive location reports, the total number of reports and
may include location QoS. For area event reporting, the LCS Service Request
includes details of the target geographical area, whether the event to be
reported is the UE being inside, entering into or leaving the target area, the
duration of event reporting, the minimum and maximum time intervals between
successive event reports, the maximum event sampling interval, whether
location estimates shall be included in event reports (and associated location
QoS), and whether only one location report is required or more than one. If
the target area is expressed by a local coordinate system or a geopolitical
name, the (H)GMLC shall convert the target area to a geographical area
expressed by a shape as defined in TS 23.032 [8]. For motion event reporting,
the LCS Service Request includes the threshold linear distance, the duration
of event reporting, the minimum and maximum time intervals between successive
event reports, the maximum event sampling interval, whether location estimates
shall be included in event reports (and associated location QoS), and whether
only one location report is required or more than one.
1b-1 AF invokes the Nnef_EventExposure_Subscribe service operation to the NEF.
1b-2 The NEF forwards the request to the (H)GMLC. The NEF assigns a LDR
refence number locally and sends it to (H-)GMLC,
2\. The (H)GMLC may verify UE privacy requirements as for step 2 in clause
6.1.2. The (H)GMLC may also subscribe to and receive notification of UE
privacy profile updates according to steps 0 and 4 of clause 6.12.1.
3\. The (H)GMLC queries the UDM for the AMF address and, in the case of
roaming, a VGMLC address as for step 3 in clause 6.1.2.
NOTE 1: The HGMLC may also query the HSS of the target UE for a serving MME
address as described in clause 9.1.1 of TS 23.271 [4]. The deferred EPC-MT-LR
procedure for Periodic and Triggered Location described in clause 9.1.19 of TS
23.271 [4] or the EPC-MT-LR procedure for the UE availability event described
in clause 9.1.15 of TS 23.271 [4] may then be performed instead of steps 4-31
- e.g. if the HSS returns an MME address but the UDM does not return an AMF
address.
4\. This step is skipped for a non-roaming UE. For a roaming UE, the HGMLC
obtains a VGMLC address if not received at step 3 and invokes the
Ngmlc_Location_Provide Location Request service operation to forward the
location request to the VGMLC as described for step 4 of in clause 6.1.2. The
(H)GMLC also includes a contact address for the (H)GMLC (Notification Target
Address, e.g. a URI) and an LDR reference number (Notification correlation ID)
to be used for event reporting at steps 20 and 29. The LDR reference number is
either allocated by (H-)GMLC based on predefined rule, e.g. operator\'s policy
if the location request is received in step 1a, or allocated by NEF, if the
location request is received in step 1b.
5\. The (H)GMLC or VGMLC invokes the Namf_Location_ProvidePositioningInfo
Request service operation to forward the location request to the serving AMF
as described for step 5 in clause 6.1.2 and includes the (H)GMLC contact
address and LDR reference number. The LDR reference number is either allocated
by (H-)GMLC based on predefined rule, e.g. operator\'s policy if the location
request is received in step 1a, or allocated by NEF, if the location request
is received in step 1b. For area event reporting, the target geographical area
is converted into a corresponding list of cell and/or tracking area
identities.
6-8. If the AMF supports a deferred location request, the AMF returns an
acknowledgment to the external LCS client, via the (H)GMLC and, in the case of
roaming, the VGMLC, indicating that the request for deferred location was
accepted. The VGMLC, when used, may optionally release resources for the
deferred location request at this point.
9\. If the UE is not currently reachable (e.g. is using eDRX or PSM), the AMF
waits for the UE to become reachable.
NOTE 2: In the event of mobility of the UE to another AMF or to EPC when the
UE becomes reachable, the old AMF can return an event indication to the
(H)GMLC as at steps 19 and 20 and may include the address of the new serving
AMF or MME if known. If a new serving AMF or MME is not known, the (H)GMLC can
repeat step 3 to query the UDM and HSS for the new AMF or MME address. If a
new AMF address is received, the (H)GMLC can restart the procedure from step
4.
10\. Once the UE is reachable, if the UE is then in CM IDLE state, the AMF
initiates a network triggered Service Request procedure as defined in clause
4.2.3.3 of TS 23.502 [19] to establish a signalling connection with the UE.
NOTE 3: The AMF may decide to cancel the location request before the UE
becomes reachable (e.g. due to lack of resources or due to a timeout on the UE
becoming reachable) or when the UE becomes reachable (e.g. if the AMF executes
NAS level congestion control on the UE, or for other reasons). The AMF then
skips steps 10-18 and proceeds to step 19 to return an indication of location
cancelation to the VGMLC or (H)GMLC.
11-12. The AMF performs steps 7-8 in clause 6.1.2 to notify the UE of the
location request and verify privacy requirements if required by the location
request received at step 5 and supported by the UE. The AMF includes in the
notification to the UE the type of deferred location request in the case of
periodic or triggered location.
13\. The AMF selects an LMF as described for step 6 in clause 6.1.1. The
selection may take into account the type of deferred location request (e.g.
whether periodic or triggered) and any parameters for the deferred location
request (e.g. the number of event reports required and/or the duration).
14\. The AMF invokes the Nlmf_Location_DetermineLocation Request service
operation towards the LMF to initiate a request for deferred UE location. For
a request for periodic or triggered location, the service operation includes
all the information received in step 4 or step 5 including the (H)GMLC contact
address and LDR reference number and may include a list of allowed access
types for event reporting at step 22. For a request for the UE available
location event, the (H)GMLC contact address and LDR reference number are not
included. In all cases, the service operation includes an LCS Correlation
identifier, the AMF identifier, the serving cell identity, the client type and
may include an indication if UE supports LPP, the required QoS and Supported
GAD shapes.
15\. The LMF performs one or more of the positioning procedures described in
clause 6.11.1, 6.11.2 and 6.11.3 and as described for step 8 in clause 6.1.1.
During this step, the LMF may request and obtain the UE positioning
capabilities (e.g. which may indicate the type(s) of periodic and triggered
location supported by the UE and the access types supported by the UE for
event reporting). The LMF may also obtain the UE location - e.g. for a request
for the UE available location event or when an initial location is requested
for periodic or triggered UE location. For a request for the UE available
location event, the LMF skips steps 16 and 17.
16\. If periodic or triggered location was requested, the LMF sends a
supplementary services LCS Periodic-Triggered Invoke Request to the UE via the
serving AMF by invoking the Namf_Communication_N1N2MessageTransfer service
operation. The LCS Periodic-Triggered Location Invoke carries the location
request information received from the AMF at step 14, including the (H)GMLC
contact address and LDR reference number. The LCS Periodic-Triggered Location
Invoke also includes a deferred routing identifier, which can be the
identification of the LMF when the LMF will act as a serving LMF or a default
LMF identification otherwise. The LCS Periodic-Triggered Location Invoke may
indicate the allowed access types for event reporting at step 25 (e.g. one or
more of NR, E-UTRA connected to 5GC, non-3GPP access connected to 5GC) and may
include an embedded positioning message which indicates certain allowed or
required location measurements (or a location estimate) at step 24 for each
location event reported (e.g. based on the positioning capabilities of the UE
obtained in step 14 and the allowed access types). As part of NAS transport of
the LCS Periodic-Triggered Location Invoke from the serving AMF to the UE, the
serving AMF includes an immediate routing identifier in the NAS transport
message containing an LCS Correlation identifier - e.g. according to clause
6.11.1.
NOTE 4: The deferred routing identifier may be global (e.g. an IP address,
UUID or URI) or may be local. The deferred routing identifier is used for
routing in step 25. However, the immediate routing identifier included by the
AMF in step 15 is used for routing in step 17.
17\. If the request in step 16 can be supported, the UE returns a
supplementary services acknowledgment to the LMF, which is transferred via the
serving AMF using the immediate routing identifier and delivered to the LMF
using an Namf_Communication_N1MessageNotify service operation.
18\. The LMF invokes the Nlmf_Location_DetermineLocation Response service
operation towards the AMF to respond to the request at step 14. For a request
for the UE available location event, the response includes any UE location
obtained at step 15 and the LMF then releases all resources. For a periodic or
triggered location request, the response includes any location obtained at
step 15, a confirmation of whether periodic or triggered location was
successfully activated in the UE according to steps 16 and 17 and the
identification of the LMF in the case of successful activation with a serving
LMF; the LMF also retains state information and resources for later steps if
the LMF acts a serving LMF. If the UE cannot support the periodic and
triggered location request, the service operation returned to the AMF shall
include a suitable error cause.
19\. The AMF invokes the Namf_Location_EventNotify service operation towards
the VGMLC for roaming, or (H)GMLC for non-roaming, and includes any location
received at step 18 and, for periodic or triggered location, a confirmation of
whether or not periodic or triggered location was successfully activated in
the target UE. The VGMLC, if used, may be the same VGMLC used in steps 5 and 6
or may be a different VGMLC. In the case of a different VGMLC, the AMF
includes the HGMLC contact address and LDR reference number. The AMF also
includes the LMF identification if received at step 18. The AMF may then
release all resources for the location request and cease support for the
procedure.
20\. This step is skipped for a non-roaming UE. For a roaming UE, The VGMLC
forwards the response received at step 19 to the HGMLC using the HGMLC contact
address received at step 19 (for a different VGMLC) or received and stored at
step 4 (for the same VGMLC) and includes the LDR reference number and any LMF
identification that was received. The VGMLC may then release all resources for
the location request and cease support for the procedure.
NOTE 5: As an optional optimization for a roaming UE, instead of performing
steps 19 and 20, the AMF may invoke the Namf_Location_EventNotify service
operation directly towards the HGMLC (e.g. if a VGMLC is not used or if the
VGMLC ceases support after step 8).
21\. The (H)GMLC forwards the response to the external LCS client or AF (via
the NEF). If the location request at step 1 was for the UE available location
event, the procedure terminates here and further steps 22-31 are not
performed.
22\. For a periodic or triggered location request where steps 16 and 17 were
successfully performed, the UE monitors for occurrence of the trigger or
periodic event requested in step 16. For the area event or motion event, the
UE monitors the requested event at intervals equal to or less than the maximum
event sampling interval. An event trigger is detected by the UE when any of
the following occur: (i) a requested area event or motion event has been
detected and the minimum reporting time interval has elapsed since the last
report (if this is not the first event report); (ii) a requested periodic
location event has occurred; or (iii) the maximum reporting time for an area
event or motion event has expired. When a trigger or periodic event is
detected and if the UE is camped on or connected to (or can otherwise access)
an access type allowed by the LMF at step 16, the UE proceeds to step 23. If
the UE cannot access an allowed access type, the UE may skip reporting the
trigger event or may report the trigger event at a later time when an allowed
access type becomes available, according to requirements received from the LMF
at step 16.
23\. The UE obtains any location measurements or a location estimate that were
requested or allowed at step 16.
NOTE 6: Obtaining a location estimate when requested also applies to the
trigger event corresponding to expiration of the maximum reporting interval
for an area event or motion event.
24\. The UE performs a UE triggered service request as defined in clause
4.2.3.2 of TS 23.502 [19] if in CM-IDLE state in order to establish a
signalling connection with the AMF.
25\. The UE sends a supplementary services event report message to the LMF
which is transferred via the serving AMF (which may be different to the
original serving AMF for steps 14-16) and is delivered to the LMF using an
Namf_Communication_N1MessageNotify service operation. The event report may
indicate the type of event being reported (e.g. whether a normal event or
expiration of the maximum reporting interval) and may include an embedded
positioning message which includes any location measurements or location
estimate obtained at step 23. The UE also includes the deferred routing
identifier received in step 16 in the NAS Transport message used to transfer
the event report from the UE to the AMF. The AMF then forwards the event
report to either the serving LMF or any suitable LMF based on whether the
deferred routing identifier indicates a particular LMF or any (default) LMF.
If a different LMF than the serving LMF is used, procedure in clause 6.4 is
used. The UE also includes the (H)GMLC contact address, the LDR reference
number, whether location estimates are to be reported and if so the location
QoS in the event report.
NOTE 7: When forwarding the event report message to the LMF in step 25, the
AMF includes the deferred routing identifier received in step 25 as the LCS
Correlation Identifier. The deferred routing identifier can assist a serving
LMF in identifying the periodic or triggered location session if the same
serving LMF had assigned the deferred routing identifier at step 16 or can
indicate to the LMF that it is acting as a default LMF.
26\. When the LMF receives the event report and if it can handle this event
report, the LMF updates the status of event reporting(e.g. the number of event
reports so far received from the UE and/or the duration of event reporting so
far) and returns a supplementary services acknowledgment for the event report
to the UE. The acknowledgment may optionally include a new deferred routing
identifier indicating a new serving LMF or a default (any) LMF. If the UE does
not receive any response from the LMF after a predefined time, i.e. the
current LMF does not support the deferred location request (for temporary or
permanent reasons) or due to some radio access failures, the UE may re-send
the report one or more times. If the UE sends the repeated event report more
than the predefined maximum resending time and the UE still does not receive
any response from AMF, the UE shall stop resending the report and reserve the
event report, then record a corresponding flag to indicate that a report has
been sent unsuccessfully. When the UE performs location update and detects the
PLMN is changed, if the flag has been set, the UE shall send the report to the
corresponding AMF, and the flag will be cleared upon a success of the sending.
NOTE 8: Inclusion of a new deferred routing identifier in the event report
acknowledgment at step 26 may be used to change the serving LMF (e.g. if a UE
moves into an area or to an access type that is better supported by a
different LMF or if the serving LMF is overloaded) or to enable a default LMF
to become a serving LMF.
27\. If a location estimate is needed for event reporting, the LMF may perform
one or more of the positioning procedures described in clause 6.11.1, 6.11.2
and 6.11.3 and as described for step 8 in clause 6.1.1. The LMF then
determines the UE location using the location measurements and/or location
estimate(s) obtained at this step and/or received at step 25.
NOTE 9: A precondition for the procedure in clause 6.11.1 is that an LCS
Correlation identifier assigned by the serving AMF has been previously passed
to the LMF. The LCS Correlation identifier is used in steps 1, 3, 6 and 7 in
clause 6.11.1 to ensure that during a positioning session between the LMF and
UE, positioning response messages from the UE are returned by the AMF to the
correct LMF and carrying an indication (the LCS Correlation identifier) which
can be recognized by the LMF. To retain this capability in step 27, the LMF
shall assign a Correlation identifier indicating the LMF (and optionally a
positioning session) for use at step 1 in clause 6.11.1. To enable an AMF to
distinguish a Correlation identifier assigned by an LMF (used in this
procedure) from a Correlation identifier assigned by the AMF (used otherwise
for clause 6.11.1), the two types of Correlation identifier could be selected
from different ranges, with or without a flag.
28\. In the case of roaming, the LMF selects a VGMLC (which may be different
to the VGMLC for steps 3-8 and steps 19-21), The LMF then invokes an
Nlmf_Location_EventNotify service operation towards the selected VGMLC or
(H)GMLC with an indication of the type of event being reported, the (H)GMLC
contact address and LDR reference number, the identification of the LMF if
this is a serving LMF, and any location estimate obtained at step 27.
NOTE 10: In the case of roaming, the LMF may select the VGMLC for step 28
using the NRF service or using configuration information in the LMF or may use
the same VGMLC as for steps 3-8 (e.g. if the LMF acts as a serving LMF and
received the VGMLC address from the AMF as part of step 14).
29\. This step is skipped for a non-roaming UE. For a roaming UE, the VGMLC
invokes an Ngmlc_Location_EventNotify service operation to forward the
information received in step 28 (e.g. including the type of event being
reported, the LDR reference number and possibly the LMF identification) to the
HGMLC which identifies the periodic and triggered location request from the
LDR reference number.
NOTE 11: As an optional optimization for a roaming UE, instead of performing
steps 28 and 29, the LMF may invoke the Nlmf_Location_EventNotify service
operation directly towards the HGMLC.
NOTE 12: In the event of mobility of the UE to an access network for which
event reporting at step 22 is not allowed (e.g. an access network in EPS) or
if the UE is otherwise unable to send event reports (e.g. due to being powered
off), the (H)GMLC may not receive event reports at step 28 or step 29 at fixed
intervals for periodic location or at intervals equal to or less than the
maximum reporting interval for triggered location. In such a case, the (H)GMLC
may cancel the periodic or triggered location reporting using the procedures
defined in clause 6.3.3. The UE may also cancel the periodic or triggered
location reporting either locally or using the procedure defined in clause
6.3.2 once the UE can access an access network that is allowed for event
reporting.
30\. The (H)GMLC uses the LDR reference number received in step 28 or step 29
to identify the periodic and triggered location request received in step 1 and
then sends the type of event being reported and any location estimate and used
positioning methods to the external LCS client or AF (via the NEF), and sends
the LDR reference number to LCS client. The (H)GMLC may also verify UE privacy
requirements before reporting the event and any location to the external LCS
client or AF.
31\. The UE continues to monitor for further periodic or trigger events as in
step 22 and instigates steps 23-30 each time a trigger event is detected.
NOTE 13: Service continuity for reporting of periodic or trigger events when a
UE moves between 5GS and EPS is not supported in this release of the
specification.
### 6.3.2 Cancellation of Reporting of Location Events by a UE
Figure 6.3.2-1 summarizes a procedure to enable a UE to cancel a deferred 5GC-
MT-LR procedure for periodic, or triggered location events (e.g. if the UE is
powered off or if the UE cancels the location request based on user\'s input).
It is assumed that a deferred 5GC-MT-LR for periodic or triggered location
events has already been initiated in the UE according to steps 1-17 for the
procedure in clause 6.3.1. If a network entity (e.g. (H)GMLC, AMF or LMF)
cancels a deferred 5GC-MT-LR procedure for periodic or triggered location
events, part of the procedure in clause 6.3.3 for cancellation by an AF or
external LCS Client would be used to cancel towards the UE and part of the
procedure in this clause would be used to cancel towards the AF or external
LCS Client.
Figure 6.3.2-1: UE Cancellation of a Deferred 5GC-MT-LR for periodic or
triggered location events
1\. The UE performs a UE triggered service request as defined in clause
4.2.3.2 of TS 23.502 [19] if in CM-IDLE state in order to establish a
signalling connection with the AMF.
2\. The UE sends a Cancel Location request message to the LMF which is
transferred via the serving AMF and is delivered to the LMF using an
Namf_Communication_N1MessageNotify service operation. The UE includes the
deferred routing identifier originally received in step 16 of the procedure in
clause 6.3.1 (or as updated by step 26 in clause 6.3.1 or by the procedure in
clause 6.4) in the NAS Transport message used to transfer the cancel location
request from the UE to the AMF. The AMF then forwards the cancel location
request to either the serving LMF or any suitable LMF based on whether the
deferred routing identifier indicates a particular LMF or any (default) LMF.
The UE also includes the (H)GMLC contact address and the LDR reference number.
3\. In the case of roaming, the LMF selects a VGMLC. The LMF then invokes an
Nlmf_Location_EventNotify service operation towards the selected VGMLC or
(H)GMLC with an indication of the cancelation of location event reporting, the
(H)GMLC contact address and LDR reference number.
NOTE 1: In the case of roaming, the LMF may select the VGMLC for step 3 using
the NRF service or using configuration information in the LMF or may use the
same VGMLC as for steps 3-8 of clause 6.3.1 (e.g. if the LMF acts as a serving
LMF and received the VGMLC address from the AMF as part of step 14 of clause
6.3.1).
4\. This step is skipped for a non-roaming UE. For a roaming UE, the VGMLC
invokes an Ngmlc_Location_EventNotify service operation to forward the cancel
location request (including the LDR reference number) to the HGMLC which
identifies the periodic and triggered location request from the LDR reference
number.
NOTE 2: As an optional optimization for a roaming UE, instead of performing
steps 3 and 4, the LMF may invoke the Nlmf_Location_EventNotify service
operation directly towards the HGMLC.
5\. The (H)GMLC uses the LDR reference number received in step 3 or step 4 to
identify the periodic and triggered location request received in step 1 of
clause 6.3.1 and then forwards the cancel location to the external LCS client
or AF (via the NEF).
6\. The LMF returns an acknowledgment to the UE via the serving AMF.
### 6.3.3 Cancellation of Reporting of Location Events by an AF or External
LCS Client or GMLC
Figure 6.3.3-1 summarizes a procedure to enable an AF or External LCS Client
or GMLC to cancel a deferred 5GC-MT-LR procedure for periodic, or triggered
location. It is assumed that a deferred 5GC-MT-LR for periodic or triggered
location events has already been requested according to the procedure in
clause 6.3.1 up until at least step 20.
Figure 6.3.3-1: Cancellation of a Deferred 5GC-MT-LR for periodic or triggered
location events by an AF or External LCS Client
1\. The external LCS client or AF (via an NEF) send a request to cancel the
periodic or triggered location to the (H)GMLC, the external LCS client or AF
shall include the identity of the deferred request.
The HGMLC may itself initiate the cancellation procedure, e.g. when it is
notified that the UE LCS privacy profile stored in the UDM was changed. For
every outstanding Deferred Location Request against that UE, the HGMLC shall
perform a new privacy check based on the updated UE LCS privacy profile stored
in the UDM. If the privacy check passes, i.e. the LCS Client is still allowed
to position the target UE, the handling of the outstanding Deferred Location
Request shall be continued. Otherwise, if the privacy check does not pass,
i.e. the Location estimate of the target UE is not allowed to be provided to
the LCS Client, the HGMLC shall initiate a cancellation procedure
NOTE: GMLC may perform privacy check for more than one location request as a
bulk operation.
2\. The (H)GMLC queries the UDM to determine the serving AMF address as in
step 3 of clause 6.3.1.
3\. For a roaming UE, the HGMLC obtains a VGMLC address if not received at
step 2 and invokes an Ngmlc_Location_CancelLocation service operation to
forward the cancellation request to the VGMLC. The (H)GMLC also includes the
contact address for the (H)GMLC and the LDR reference number in the request
and the latest LMF identification received in step 20 or step 29 in clause
6.3.1 if either step has occurred and included an LMF identification.
4\. The (H)GMLC or VGMLC invokes the Namf_Location_CancelLocation service
operation to forward the cancellation request to the serving AMF and includes
the (H)GMLC contact address, LDR reference number and LMF identification if
available.
5\. If an LMF identification was included in step 4, the AMF forwards the
cancelation request to the indicated LMF by invoking an
Nlmf_Location_CancelLocation service operation and includes the (H)GMLC
contact address and LDR reference number. The LMF then releases all resources
for the location request.
6\. If the UE is not currently reachable (e.g. is using eDRX or PSM), the AMF
waits for the UE to become reachable.
7\. Once the UE is reachable, if the UE is then in CM IDLE state, the AMF
initiates a network triggered Service Request procedure as defined in clause
4.2.3.3 of TS 23.502 [19] to establish a signalling connection with the UE.
8\. The AMF sends the cancelation request to the target UE and includes the
(H)GMLC contact address and the LDR reference number. The UE then releases all
resources for the location request.
9\. The UE returns an acknowledgment to the AMF.
10\. The AMF responds to Namf_Location_CancelLocation, then V-GMLC or (H)GMLC
releases all resources for the location request. AMF releases all resources
for the location request.
11\. For a roaming UE, the VGMLC responds to Ngmlc_Location_CancelLocation,
then HGMLC releases all resources for the location request.
12\. [Conditional] If the cancellation procedure is requested by HGMLC (i.e.
the procedure is triggered in step 1c) and the cancelled location event is
reported to external client or AF (via NEF).
## 6.4 LMF Change Procedure
The LMF Change procedure supports change of a serving LMF during a deferred
5GC-MT-LR procedure for periodic, or triggered location events as defined in
clause 6.3.1. When a serving LMF is used for the procedure in clause 6.3.1,
mobility of the target UE may lead to a change of serving AMF for which the
original serving LMF is not suitable. For example, the serving LMF may be very
remote from the new serving AMF leading to higher resource utilisation for AMF
to LMF signalling or the LMF may not be configured with information (e.g. a
cell database) for the current access network for the UE to enable location.
In such a case, the serving LMF may need to change. Figure 6.4-1 shows a
procedure to enable change of the serving LMF when a UE sends an event report
as at step 25 in clause 6.3.1.
Figure 6.4-1: Change of serving LMF for periodic and triggered UE location
events
**Precondition:** Steps 1-23 in clause 6.3.1 have already been performed and
steps 22-30 may have been performed or repeated. A serving LMF is used and the
current serving LMF is LMF1.
1\. The UE performs a service request if needed as for step 24 in clause
6.3.1.
2\. The UE sends a NAS Transport message containing a supplementary services
event report message to the serving AMF. The NAS Transport message includes a
deferred routing identifier indicating LMF1. Step 2 corresponds to part of
step 25 for clause 6.3.1.
3\. Based on operator configuration and policy, the AMF may evaluate and
determine that LMF1 is unsuitable or unable to support location for the
current UE access network or serving cell and determines LMF2 as being a more
suitable LMF.
4\. The AMF invokes the Namf_Communication_N1MessageNotify service operation
towards LMF1. The service operation includes the event report received in step
2. If the AMF determined in step 3 that a new LMF2 should be used, it
indicates that to the LMF1 as well.
5\. If the AMF did not indicate a new LMF in step 4, based on the operator
configuration and policy, LMF1 may evaluate and determine that it is
unsuitable or unable to support location for the current UE access network or
serving cell and determines LMF2 as being a more suitable LMF.
6\. LMF1 invokes an Nlmf_Location_LocationContextTransfer Request service
operation towards LMF2 to provide the current location context of the UE and
includes the event report message received in step 4. The service operation
includes the AMF identity and all the information originally received by LMF1
for the periodic or triggered location request either from the AMF according
to the procedure in clause 6.3.1 or from an earlier serving LMF according to
this procedure. The service operation may also include the current status of
event reporting (e.g. the number of event reports so far received from the UE
and/or the duration of event reporting so far) and may include location
related information for the UE such a previous location estimate or location
measurements.
7\. LMF2 informs LMF1 of the location context transfer operation results. LMF1
then releases all resources for the procedure.
8\. LMF2 invokes the Namf_Communication_N1N2MessageTransfer service operation
towards the AMF to request the transfer of a supplementary services Event
Report Acknowledgment message to the UE. The Event Report Acknowledgment
indicates a change of LMF and includes a deferred routing identifier
indicating LMF2.
9\. The AMF forwards the Event Report Acknowledgment to the UE in a NAS
Transport message. The AMF also informs the LMF2 of the result of the delivery
of the Event Report Acknowledgement.
10\. If a location estimate is needed for event reporting, LMF2 may perform
positioning of the UE and determines the UE location as at step 27 in clause
6.3.1. The rest of the procedure in clause 6.3.1 then continues from step 28
with LMF2 retaining state information to enable support of subsequent event
reports from the UE.
## 6.5 Unified Location Service Exposure Procedure
### 6.5.1 Unified Location Service Exposure Procedure without routing by a UDM
Figure 6.5.1-1 shows a unified location service exposure procedure provided by
an NEF in an HPLMN for a target UE to an NF in the HPLMN or to an external AF
outside the HPLMN. The procedure enables a request for an immediate location
or for a deferred location for a target UE.
Figure 6.5.1-1: Unified Location Service Exposure Procedure without routing by
a UDM
1a. An external AF invokes an Nnef_EventExposure_Subscribe service operation
towards an NEF in the HPLMN for a target UE and includes an identification of
the UE (e.g. SUPI or GPSI) and details of the location request such as whether
a current or last know immediate location or a deferred location is requested,
the location accuracy and response time, LDR request information and other
information applicable to the type of request.
1b. As an alternative to step 1a, a consumer NF in the HPLMN for a target UE
invokes an Nnef_EventExposure_Subscribe service operation towards an NEF in
the HPLMN and includes a global identification of the UE (e.g. SUPI or GPSI)
and details of the location request as in step 1a.
2\. Based on the service requirements in step 1a or step 1b (e.g. location QoS
and whether an immediate or deferred location is requested) and on the
availability of GMLC versus AMF based location service, the NEF determines
whether the location request in step 1a or step 1b can be mapped to a GMLC
based location service or to an AMF location event exposure service. The NEF
determines to use whichever mapping is supported or, when both mappings are
supported, may employ implementation or operator dependent procedures to make
a choice. When a GMLC based location service is determined, steps 3-6 are
performed and steps 7-15 are omitted. When an AMF location event exposure
service is determined, steps 7-15 are performed and steps 3-6 are omitted. If
NEF determines the location request is handled by AMF, it allocates an LDR
reference number.
NOTE 1: The NEF may take the potential load to the system, e.g. AMF/UDM load,
or GMLC load, into consideration when deciding which location service to use,
or whether to reject the request from NF or AF. The NEF may also take into
account QoS. For example, when QoS accuracy exceeds cell ID, the GMLC location
service shall be used if available.
3\. When a GMLC based location service is determined in step 2, the NEF
invokes an Ngmlc_Location_ProvideLocation Request service operation towards an
HGMLC in the HPLMN. The service operation may include all of the information
received from the AF or NF in step 1a or 1b.
4\. For a request for an immediate location, the HGMLC performs steps 2-10 of
the 5GC-MT-LR procedure in clause 6.1.1 in the case of regulatory location or
steps 2-23 of the 5GC-MT-LR procedure in clause 6.1.2 in the case of
commercial location. For a request for deferred location, the HGMLC performs
steps 2-29 of the deferred 5GC-MT-LR procedure for periodic, triggered or UE
available location events in clause 6.3.1.
5\. The HGMLC invokes the Ngmlc_Location_ProvideLocation Response service
operation towards the NEF to confirm the request in step 3 for a request for
deferred location or to return the UE location for a request for an immediate
location.
6\. If deferred location was requested in step 1, the HGMLC invokes one or
more Ngmlc_Location_EventNotify service operations towards the NEF, to convey
a single UE location in the case of deferred location for the UE available
event or to convey an indication of location activation in the UE followed by
one or more location event reports in the case of deferred location for
periodic or triggered location events.
7\. When an AMF location event exposure service is determined in step 2, if
the NEF needs to verify the target UE privacy requirements, the NEF invokes a
Nudm_SDM_Get service operation towards the UDM of the target UE to get the
privacy settings of the UE identified by its GPSI or SUPI. The UDM returns the
target UE Privacy setting and the SUPI of the UE. The NEF checks the privacy
settings. If the target UE is not allowed to be located, steps 8-14 are
skipped.
NOTE 2: The AMF location event exposure service does not support a real time
query to the UE to verify UE privacy requirement by the user. If the NEF finds
this is needed, the NEF either selects a GMLC location service or returns an
error to the external AF or NF.
8\. The NEF invokes a Nudm_UECM_Get service operation towards the UDM of the
target UE with SUPI of this UE. The UDM returns the network addresses of the
current serving AMF. If the location request is an immediate location request,
the NEF checks the country codes of the serving node addresses. If the NEF
finds out the current AMF locates out of the service coverage, the NEF returns
an appropriate error message to the AF or NF.
When the UE is concurrently served by multiple PLMNs respectively for 3GPP
access and non-3GPP access, multiple AMF IDs with corresponding access type
are provided by the UDM, the NEF selects one access type and its associated
AMF based on principle defined in clause 5.3.2.
9\. The NEF invokes an Namf_EventExposure Subscribe service operation towards
the serving AMF for the target UE and indicates whether a one-time UE location
is requested or multiple UE locations for some triggering event and includes
information on location accuracy (e.g. cell ID or TA granularity). If the NEF
has no direct access to AMF or is configured to use UDM for the AMF event
exposure, procedure in clause 6.5.2 is used instead.
10\. The AMF responds to the service operation in step 9.
11\. If the UE is currently reachable and in CM-IDLE state and if location is
requested in step 9 with a cell ID accuracy, the AMF perform a network
triggered service request as described in TS 23.502 [19] to place the UE in
CM-CONNECTED state.
12\. If an immediate location is requested in step 9 which the AMF can support
based on AMF knowledge of the current or last known serving cell or serving TA
for the UE, the AMF uses this information. Otherwise, the AMF invokes the NG-
RAN location reporting procedure defined in clause 4.10 of TS 23.502 [19] to
obtain a single location or multiple UE locations according to the request in
step 9. The AMF may convert any location that was obtained in the form of a
cell ID or TAI into geographical information based on TS 23.032 [8] and as
defined in TS 29.518 [16] clause 6.2.6.2.5 and TS 29.571 [33], clauses
5.4.4.7, 5.4.4.8 and 5.4.4.9 before proceeding to step 13.
13\. The AMF invokes the Namf_EventExposure Notify service operation towards
the NEF to provide the current or last known UE location as obtained at step
12.
When the NEF obtains more than one serving AMF and corresponding access type
from UDM at step 8, if the location information provided by AMF can not meet
the required LCS QoS, the NEF may forward the location request to another AMF,
i.e. Steps 9-15 is performed in another PLMN served by this AMF. In this case,
if the access type associated with another AMF is non-3GPP access, procedure
defined in clause 6.9.2 applies.
14\. If the AMF invokes the NG-RAN location reporting procedure in step 12 to
obtain multiple UE locations and receives multiple location reports from NG-
RAN as part of step 12, the AMF invokes one or more additional
Namf_EventExposure Notify service operations towards the NEF to provide each
additional UE location provided by NG-RAN. The AMF may convert each additional
UE location in the form of a cell ID or TAI into geographical information as
in step 12.
NOTE 4: AMF conversion of a UE location in the form of a cell ID or TAI into
geographical information in step 12 and step 14 can be PLMN operator
dependent. However, it is expected that AMF conversion will normally be needed
for a roaming UE to avoid VPLMN cell ID and TAI configuration in the HPLMN
NEF.
15\. In the case of LDR, the NEF may itself initiate the Namf_EventExposure
Unsubscribe service operation, e.g. if when the UE\'s privacy setting stored
in the UDM was changed. For every outstanding Deferred Location Request
against that UE, the NEF shall perform a new privacy check based on the
updated privacy setting stored in the UDM. If the privacy check passes, i.e.
the LCS Client is still allowed to position the target UE, the handling of the
outstanding Deferred Location Request should be continued. Otherwise, if the
privacy check does not pass, i.e. the Location estimate of the target UE is
not allowed to be provided to the LCS Client, the NEF shall initiate a
cancellation. Then AMF then releases all resources for the LDR request, and
NEF shall send a notification of cancellation of LDR request to consumer AF or
NF in the step 17a, 17b.
16a, 16b. The NEF returns the first UE location received at step 5 or step 13
or a confirmation of a request for deferred location received at step 5 in the
case of a GMLC location service to the external AF (step 15a) or NF (step
15b).
17a, 17b. If one or more additional location reports are received at step 6 or
step 14, the NEF returns one or more additional locations to the external AF
(step 16a) or NF (step 16b). If step 15 occurs, a notification of cancellation
of LDR request shall be sent to the consumer AF (step 17a) or consumer NF
(step 17b).
NOTE 5: As part of step 16 and step 17, the NEF converts any UE location
received in the form of a cell ID or TAI into geographical information prior
to sending the location to a consumer AF or NF.
### 6.5.2 Unified Location Service Exposure Procedure with routing via a UDM
Figure 6.5.2-1 shows the procedure used by an NEF to access the serving AMF
for the UE when the NEF does not have direct access to the serving AMF or is
configured to use UDM for AMF location event exposure service. When this
procedure is used, steps 1-8 in Figure 6.5.2-1 replace steps 8-14 in Figure
6.5.1-1.
{width="5.333333333333333in" height="3.3020833333333335in"}
Figure 6.5.2-1: Unified Location Service Exposure Procedure with routing by a
UDM
1\. The NEF invokes an Nudm_EventExposure Subscribe service operation towards
the UDM for the target UE for location reporting and indicates whether a one-
time UE location is requested or multiple UE locations for some triggering
event and includes the UE identity (SUPI or GPSI) and information on location
accuracy (e.g. cell ID or TA granularity). A correlation ID is also included.
2\. The UDM invokes an Namf_EventExposure Subscribe service operation towards
the serving AMF for the target UE for location reporting and includes the
information received in the service operation for step 1 including the
correlation ID and a URI for the NEF.
3\. The AMF responds to the service operation in step 2.
4\. The UDM responds to acknowledges the service operation in step 1.
5\. The AMF performs a Network Triggered Service Request if needed as for step
11 of clause 6.5.1.
6\. The AMF obtains a location of the UE or invokes a location reporting
procedure with NG-RAN to obtain a UE location or multiple UE locations as for
step 12 of clause 6.5.1.
7\. The AMF invokes the Namf_EventExposure Notify service operation towards
the NEF indicated by the URI received in step 2 and includes the first UE
location obtained at step 6 and the correlation ID received at step 2.
8\. If the AMF invokes a location reporting procedure with NG-RAN to obtain
multiple UE locations at step 6, the AMF invokes one or more
Namf_EventExposure Notify service operations towards the NEF to provide each
additional UE location as in step 14 for clause 6.5.1.
## 6.6 NG-RAN Location Service Exposure Procedure
The NG-RAN Location Service Exposure procedure is not supported in this
Release of the specification.
## 6.7 Low Power Periodic and Triggered 5GC-MT-LR Procedures
The low power periodic and triggered 5GC-MT-LR procedures may be used to
support a request from an external LCS client or AF for deferred location for
periodic or triggered location events. The procedures may be used as
alternatives to the procedures in clause 6.3.1 and clause 6.4. If the
procedures are used, cancellation of the reporting of location events is still
supported using the procedures in clause 6.3.2 and clause 6.3.3.
### 6.7.1 Event Reporting with no change of LMF
Figure 6.7.1-1 summarizes the initiation and reporting of location events for
a deferred 5GC-MT-LR procedure for Periodic or Triggered Location Events using
low power event reporting.
Figure 6.7.1-1: Low Power Periodic and Triggered 5GC-MT-LR Procedure with no
change of LMF
1\. Steps 1-23 for the deferred 5GC-MT-LR procedure for periodic or triggered
location events in clause 6.3.1 are performed with the following exceptions.
\- At step 14, the AMF includes an indication in the
Nlmf_Location_DetermineLocation Request service operation that the UE supports
and is allowed to use Control Plane CIoT 5GS Optimisation as described in TS
23.501 [18] clause 5.31.4.
\- At step 16, if the AMF indicates the UE supports and is allowed to use
Control Plane CIoT 5GS Optimisation at step 14 and if the LMF decides to allow
Control Plane CIoT 5GS Optimisation, the LMF includes an indication in the LCS
Periodic-Triggered Invoke Request that the UE is allowed to use Control Plane
CIoT 5GS Optimisation to send Event Reports. The LMF may also include criteria
indicating when Control Plane CIoT 5GS Optimisation may be used to send Event
Reports. The criteria may include a maximum duration for sending Event Reports
using Control Plane CIoT 5GS Optimisation, a maximum number of consecutive
Event Reports to be sent using Control Plane CIoT 5GS Optimisation or both.
NOTE 1: As part of negotiating 5G network behaviour during registration, a UE
indicates in a Registration Request whether Control Plane CIoT 5GS
Optimisation is supported for location event reporting. This indication may be
passed to the LMF by the AMF at step 14 for clause 6.3.1.
2\. The UE determines whether to report the event detected at step 22 in
clause 6.3.1 using Control Plane CIoT 5GS Optimisation or using a NAS
signalling connection. If the UE is currently in CM CONNECTED state or is not
accessing E-UTRA connected to 5GC, the UE shall use a NAS signalling
connection. Otherwise, the determination shall be based on criteria received
from the LMF at step 14 in clause 6.3.1 when criteria are received. When the
criteria include a maximum duration for sending event reports using Control
Plane CIoT 5GS Optimisation, the UE shall report the event using a NAS
signalling connection if the UE has not used a NAS signalling connection to
report events during an immediately preceding time interval equal to the
maximum duration. When the criteria include a maximum number of consecutive
Event Reports to be sent using Control Plane CIoT 5GS Optimisation, the UE
shall report the event using a NAS signalling connection if the UE has used
Control Plane CIoT 5GS Optimisation to report each of the N previous events,
where N equals the maximum number of consecutive Event Reports. In other
cases, Control Plane CIoT 5GS Optimisation may be used to report the event if
supported by the 3GPP access type. If use of a NAS signalling connection is
determined, steps 24-31 for the procedure in clause 6.3.1 are performed and
steps 3-11 below are skipped. If use of Control Plane CIoT 5GS Optimisation is
determined, steps 3-11 below are performed.
3\. If the UE and ng-eNB node both support EDT, the UE sends an
RRCEarlyDataRequest message to the ng-eNB node and includes a NAS control
plane service request.
Otherwise, the UE established an RRC connection with the ng-eNB node and sends
the NAS control plane service request. The NAS control plane service request
includes an event report message which includes the information described in
step 25 in clause 6.3.1 (e.g. the type of event being reported and any
location measurements or location estimate obtained at step 23 in clause
6.3.1). The control plane service request also includes the deferred routing
identifier received in step 16 in clause 6.3.1. The UE also includes a NAS
Release Assistance Indication (NAS RAI) in the NAS message. The NAS RAI
indicates a single response is expected.
NOTE 2: Event reporting using Control Plane CIoT 5GS Optimisation requires a
single Event report acknowledgment from the LMF.
4\. The ng-eNB node forwards the NAS message to the AMF in an N2 Initial UE
message and includes an \"EDT Session\" indication if EDT was used at step 3.
5\. The AMF checks the integrity of the NAS message and deciphers its
contents. The AMF then invokes an Namf_Communication_N1MessageNotify service
operation to forward the event report to either the serving LMF or any
suitable LMF as described for step 25 for clause 6.3.1. The AMF includes an
indication of Control Plane CIoT 5GS Optimisation in the service operation and
the serving cell ID.
6\. The AMF returns a NAS Service Accept to the ng-eNB node which is
encapsulated in an N2 Downlink NAS Transport message.
7\. If EDT was used at step 3, the ng-eNB node establishes an RRC connection
to the UE.
8\. The ng-eNB node sends an RRC DL Information Transfer message to the UE and
includes the NAS Service Accept message received in step 6.
9\. The LMF invokes an Namf_Communication_N1N2MessageTransfer operation to
return an acknowledgment for the event report as described for step 26 for
clause 6.3.1.
10\. The AMF forwards the acknowledgment to the ng-eNB node in a NAS DL NAS
Transport message which is encapsulated in an N2 Downlink NAS Transport
message. The AMF also includes an \"end indication\" in the N2 message.
NOTE 3: If the AMF determines more data or signalling may be pending for the
UE, the AMF does not include the \"end indication\" at step 10 and step 12
below is not performed.
11\. The ng-eNB node sends an RRC DL Information Transfer message to the UE
and includes the NAS message received in step 10.
12\. If the \"end indication\" was received in step 10, the ng-eNB node
releases the RRC connection.
13\. If a location estimate is needed for event reporting, the LMF determines
the UE location using the location measurements and/or location estimate
received in the event report at step 5 and/or the serving cell ID provided by
the AMF at step 5.
NOTE 4: The LMF does not attempt to obtain additional location measurements
from the UE or from the NG-RAN.
14\. Steps 28-31 for clause 6.3.1 are performed to send the event report to
the external client or AF and to continue event detection at the UE.
### 6.7.2 Event Reporting with change of LMF
Figure 6.7.2-1 shows a procedure to enable change of the serving LMF when a UE
sends an event report as at steps 3 and 4 in clause 6.7.1.
Figure 6.7.2-1: Event Reporting with change of LMF
**Precondition:** Step 1 in clause 6.7.1 has already been performed and steps
2-11 in clause 6.7.1 may have been performed or repeated. A serving LMF is
used and the current serving LMF is LMF1.
1\. Steps 2-4 for Event Reporting for no change of LMF in clause 6.7.1 are
performed with the following exceptions.
\- At step 3, the NAS control plane service request includes a deferred
routing identifier indicating LMF1.
2\. Steps 3-8 for the LMF Change procedure in clause 6.4 are performed with
the following exceptions.
\- At step 4, the Namf_Communication_N1MessageNotify service operation
includes an indication of Control Plane CIoT 5GS Optimisation.
\- At step 6, the Nlmf_Location_LocationContextTransfer Request service
operation includes an indication of Control Plane CIoT 5GS Optimisation and
the serving cell ID.
3\. Steps 7-10 for Event Reporting for no change of LMF in clause 6.7.1 are
performed with LMF2 replacing the LMF in clause 6.7.1. The rest of the
procedure in clause 6.7.1 then continues in step 11 with LMF2 retaining state
information to enable support of subsequent event reports from the UE.
## 6.8 Bulk Operation of LCS Service Request Targeting to Multiple UEs
The procedure described in this clause applies to 5GC_MT_LR and Deferred 5GC-
MT-LR request targeting to a group of UE identified by an external/internal
group ID, if available.
Figure 6.8-1: Bulk operation of LCS service request targeting to multiple UEs
1\. This step is the same as step 1 of clause 6.1.2 and step 1 of clause
6.3.1, with the difference that the LCS request is targeting a group of UE
identified by a group ID. The GMLC may map the external/internal group ID to
the list of UE ID (i.e. SUPI) using Nudm_SDM_Get (Group Identifier
Translation, External Group Identifier) service operation.
NOTE: Step 1b-1 assumes the LCS QoS provided by AF indicate \"high-accuracy\",
and NEF determines the location request is handled by GMLC.
1b-2. The NEF shall send a Ngmlc_Location_ProvideLocation Request to the GMLC
with the group of UE identified by a group ID to indicate a bulk operation
procedure. If deferred location is requested the NEF shall include an Event
type to indicate that deferred location is requested and provides an LDR
reference number (Notification Correlation ID) to be used for event reporting
at steps 6b-1 and 11b-1. If immediate location is requested the NEF shall not
provide an Event type to indicate that immediate location is requested and
provides a Notification Correlation ID to be used for reporting at steps 6b-1.
2a. If deferred location is requested from the LCS Client, the GMLC responds
with an acknowledgment.
2b-1. The GMLC responds with a Ngmlc_Location_ProvideLocation Response.
GMLC may decide whether completely or partially (i.e. accept part of the UE(s)
within the group identified by the group ID in step 1) reject the location
request. If GMLC decides to partially reject the location request, GMLC will
respond to the LCS client /AF with a proper error cause.
2b-2. The NEF acknowledges the execution of the Nnef_EventExposure_Subscribe.
Steps 3 to 5 are carried out once per UE.
3\. The GMLC invokes a Nudm_SDM_Get (LCS privacy, SUPI) service operation
towards the UDM to get the UE LCS privacy profile of the target UE. The GMLC
checks the privacy settings. For the UE whose privacy setting does not allow
it to be located, steps 4 and 5 are skipped. The GMLC may also subscribe to
and receive notification of UE privacy profile updates according to steps 0
and 4 of clause 6.12.1.
4\. The GMLC invokes a Nudm_UECM_Get service operation towards the UDM of the
target UE with SUPI of this UE. The UDM returns the current serving AMF ID to
the GMLC.
5a. If no AMF ID is returned at step 4:
\- if it is a deferred location request and the GMLC supports the storage of
the LCS service request for a group of UE, the GMLC subscribes the UE
reachability status to the UDM using Nudm_EventExposure_Subscribe service
operation with the data key \"SUPI\";
\- otherwise, this step is skipped and the GMLC returns an appropriate error
cause to the LCS client or NEF at step 6.
5b. If the UDM returns the current serving AMF ID to the GMLC at step 4:
\- the GMLC initiates 5GC_MT_LR procedure (from step 4 onwards) as described
in clause 6.1.2, with the difference that Step 24 is skipped (as it is
replaced by step 6 below); The GMLC shall not include the Notification
Correlation ID received from NEF in step 1b-2.
\- or the GMLC initiates Deferred 5GC-MT-LR Procedure (from step 4 onwards) as
described in clause 6.3.1 with the difference that steps 8,21 and 30 are
skipped (as it is replaced by steps 2, 6 and 11 below) and that GMLC assign
LDR reference numbers (separate number for each UE) to be used for event
reporting at steps 20 and 29.
6a. The GMLC receives response messages as defined in clause 6.1.2 step 22 or
23 or GMLC receives notification messages as defined in clause 6.3.1 step 28
or 29. The GMLC sends one or more LCS Service Responses to the LCS Client to
convey UE locations or event reports.
6b-1. The GMLC receives response messages as defined in clause 6.1.2 step 22
or 23 or GMLC receives notification messages as defined in clause 6.3.1 step
28 or 29. The GMLC maps the messages to the Request received in step 1b-2 and
invokes one or more Ngmlc_Location_EventNotify service operations towards the
NEF to convey UE locations or event reports. GMLC may aggregate one or more UE
location estimates / event reports in each message sent to NEF.
6b-2. The NEF invokes one or more Nnef_EventExposure_Notify service operations
towards the AF, to convey UE locations or event reports , received from GMLC
in step 6b-1.
7\. For the deferred location request, if any UE in the group didn\'t get its
serving AMF ID at step 4, the GMLC may store the LCS service request locally
if the GMLC supports the storage of the LCS service request for a group of UE;
otherwise, this step is skipped.
Further steps apply to the UEs of the group who was not registered to the
network when the LCS service request is received at GMLC.
8\. UE performs the registration as described in clause 4.2.2 of TS 23.502,
during which an AMF is selected to serve the UE, and the AMF ID is stored into
UDM.
9\. UDM notifies the GMLC who had subscribed the UE registration at step 5a
using Nudm_EventExposure_Notify service operation, which includes \"SUPI\" and
UE registration status.
10\. GMLC initiates Deferred 5GC-MT-LR Procedure as described in step 5b.
11a. The GMLC receives notification messages as defined in clause 6.3.1 step
28 or 29. The GMLC sends one or more LCS Service Responses to the LCS Client
to convey UE locations or event reports.
11b-1. The GMLC receives notification messages as defined in clause 6.3.1 step
28 or 29. The GMLC maps the messages to the Request received in step 1b-2 and
invokes one or more Ngmlc_Location_EventNotify service operations towards the
NEF to convey UE locations or event reports. GMLC may aggregate one or more UE
location estimates / event reports in each message sent to NEF.
11b-2. The NEF invokes one or more Nnef_EventExposure_Notify service
operations towards the AF, to convey event reports received from GMLC in step
11b-1.
## 6.9 Procedures to Support Non-3GPP Access
### 6.9.1 Common Positioning Procedures when a UE is served by only one PLMN
Figure 6.9.1-1 shows the common positioning procedures to support location
services with non-3GPP access when UE is served by only one PLMN, which
provides either non-3GPP access only or both 3GPP access and non-3GPP access.
The common positioning procedures can be triggered by:
\- 5GC-NI-LR procedure (described in clause 6.10.1), which assumes that the
serving AMF is aware of the emergency session initiation - e.g. due to
supporting an Emergency Registration procedure or assisting in establishing an
emergency PDU Session. If such emergency session procedure is initiated via
non-3GPP access, the AMF provides access type to LMF in step 2 in clause
6.10.1,the LMF shall use the access type provided by AMF in step 2 in clause
6.9.1; or
\- 5GC-MT-LR procedure (described in clause 6.1.1 and 6.1.2 and 6.10.2), which
is applicable to a request from an LCS client for a current location.
\- 5GC-MO-LR procedure (described in clause 6.2), for this case, the access
type is selected by the UE using the UE Local Configuration to initiate MO-LR
procedure which is the same as the 5GC-MO-LR Procedure in clause 6.2 with
following differences:
\- The AMF shall in step 4 of clause 6.2 include UE connectivity state per
access type.
\- In step 5 of clause 6.2 the modification in this clause shall be applied,
the LMF shall also determine positioning methods and the positioning access
type, which can be different with the access type selected by the UE.
\- Deferred 5GC-MT-LR procedure for periodic, triggered and UE available
location events (described in clause 6.3.1), which is applicable to report of
location event for a deferred 5GC-MT-LR procedure.
\- Unified Location Service Exposure Procedure (described in clause 6.5),
which allows an NEF to provide location service exposure to an NF in HPLMN or
to an external AF outside the HPLMN when requested by the NF or the AF.
{width="5.008333333333334in" height="4.575694444444444in"}
Figure 6.9.1-1: Common positioning procedures when UE is served by the one
PLMN
1\. The AMF invokes the Nlmf_Location_DetermineLocation service operation
towards the LMF to request the current location of the UE, which includes the
QoS requirement and UE connectivity state per access type.
2\. The LMF determines the positioning access type and the positioning method
based on the UE/network positioning capability, the QoS requirement and UE
connectivity state per access type received from the AMF and the locally
configured operator policy. The LMF may also determine the access type for
transmission of an LPP message to the UE (e.g. in order to ensure the UE will
be in a connected state for the selected positioning access type).
When the LPP protocol in TS 36.355 [20] is determined to be used to obtain
location information from the UE and the UE has both 3GPP and non-3GPP access,
the AMF shall decide which access type should be used to transmit the location
information if the LMF did not select an access type. For example, if the UE
is in CM-IDLE state in 3GPP access and in CM-CONNECTED state in Non-3GPP
access, AMF may prefer to select the N3IWF/TNGF/W-AGF to relay positioning
signalling to UE, rather than performing paging procedures via the 3GPP
access.
When the NRPPa protocol in TS 38.455 [15] is determined to be used to obtain
location information from the NG-RAN or N3IWF/TNGF/W-AGF:
\- In the case that 3GPP Access is determined to be used to transmit the
location information, the Network Assisted Positioning procedure in step 3b
and/or the obtaining Non-UE Associated Network Assistance Data procedure in
step 3c shall be performed.
\- In the case that non-3GPP Access is determined to be used to obtain the
location information, the Network Assisted Positioning procedure in step 3e
shall be performed.
When the LPP protocol in TS 36.355 [20] is determined to be used to obtain
location information from the UE:
\- In the case that 3GPP Access is determined to be used to relay the location
information, the UE Assisted and UE Based Positioning procedure in step 3a
shall be performed.
\- In the case that non-3GPP Access is determined to be used to relay the
location information, the UE Assisted and UE Based Positioning procedure in
step 3d shall be performed.
3a. This step is same as the UE Assisted and UE Based Positioning procedure in
clause 6.11.1.
3b. This step is same as the Network Assisted Positioning procedure in clause
6.11.2 with the difference that step 1 of clause 6.11.2 includes the selected
Access Type (i.e. 3GPP access). The AMF forwards the Network Positioning
message to the NG-RAN in step 3 of clause 6.11.2 based on the received Access
Type.
3c. This step is same as the Obtaining Non-UE Associated Network Assistance
Data procedure in clause 6.11.3.
3d. This step is same as the UE Assisted and UE Based Positioning procedure in
clause 6.11.1 with the following difference:
\- The NG-RAN in clause 6.11.1 is replaced by the N3IWF/TNGF/W-AGF in Figure
6.9.1-1;
\- Steps 2 and 5 in clause 6.11.1 are omitted;
\- The location information returned by the UE can include information
specified in clause 5.3.1.
3e. This step is same as the Network Assisted Positioning procedure in clause
6.11.2 with the following difference:
\- The NG-RAN in clause 6.11.2 is replaced by the N3IWF/TNGF/W-AGF in Figure
6.9.1-1;
\- Steps 2 and 4 in clause 6.11.2 are omitted;
\- The Access Type, i.e. non-3GPP access type, which is selected to provide
the location information is included in step 1 of clause 6.11.2. The AMF
forwards the Network Positioning message to the N3IWF/TNGF/W-AGF based on the
received Access Type in step 1 of clause 6.11.2.
\- The location information returned in step 5 of clause 6.11.2 is specified
in clause 5.3.1.
The UE is replaced by 5G-RG in the case of wireline access type.
### 6.9.2 MT-LR Procedures when a UE is served by Different PLMNs for 3GPP
Access and Non-3GPP Access
Figure 6.9.2-1 and Figure 6.9.2-2 show the enhanced MT-LR positioning
procedures to support location service with non-3GPP access when the UE is
served by different PLMNs for 3GPP access and non-3GPP access. The procedures
can be triggered by the 5GC-MT-LR Procedures described in clause 6.1.1, clause
6.1.2 and clause 6.3, which are applicable to a request from an LCS client for
an immediate current location or a deferred location.
Figure 6.9.2-1: MT-LR positioning procedures when UE is served by the two
VPLMNs
1\. The step is same as step 1 in clause 6.1.1 or clause 6.3.1.
2\. The step is same as step 2 in clause 6.1.1 or clause 6.3.1.
3\. The step is same as step 3 in clause 6.1.1 or clause 6.3.1 with the
difference that when the UE is served by more than one AMF the UDM provides to
the HGMLC for each access type,
\- serving AMF identity with the corresponding PLMN Id,
\- possibly a VGMLC address.
4\. When the HGMLC identifies that the UE is served by different PLMNs
according to the returned information from the UDM in step 3 it may retrieve
the CM state(s) per Access Type from the candidate AMFs by using
Namf_EventExposure service, or from the UDM using Nudm_EventExposure service.
The HGMLC selects one access type and its associated AMF based on the UDM
returned information in step 3, QoS requirement, CM state(s) per Access type
of the UE, PLMN identity and/or the locally configured operator policy.
NOTE: The locally configured operator policy in the HGMLC can include access
type and CM state and PLMN priority for positioning. For example, the local
policy can be 3GPP access first and/or connected state first and/or V-PLMN
and/or H-PLMN first.
5\. The HGMLC forwards the location request to the VGMLC-1 and may include the
V-AMF-1 identity received in step 3 and the target UE identity (e.g. SUPI).
6\. The VGMLC-1 invokes the Namf_Location_ProvideLocation_Request service
operation to forward the location request to the V-AMF-1. Then the V-LMF-1
receives the location request from the V-AMF-1.
7\. This step is same as step 2-3 of the Common Positioning Procedures in
clause 6.9.1.
8-9. The VGMLC-1 receive the location service response from the V-LMF-1 and
for a request for an immediate location, returns positioning results to the
HGMLC. For an immediate location, the location service response contains
positioning information, the information about the positioning method used and
the indication of whether the obtained location estimate satisfies the
requested LCS QoS (e.g. accuracy) or not (described in TS 23.271 [4] clause
9.1.1). For a request for a deferred location, the location service response
indicates whether the location request was accepted.
10\. For a request for an immediate location, if the HGMLC identifies that the
location service response from the chosen PLMN meets required LCS QoS, it
returns the results to the LCS Client directly. Otherwise, the HGMLC may
forward the location request to another AMF (in another PLMN) so as to obtain
the positioning result which can meet required LCS QoS shown as step 11. For a
request for a deferred location, if the HGMLC identifies that location service
was accepted (by the chosen PLMN), it returns this indication to the LCS
Client directly. Otherwise, the HGMLC may forward the location request to
another AMF (in another PLMN).
11\. This step obtains the immediate positioning information or requests a
deferred location from another PLMN, the details are the same as steps 5-9.
12-13. The HGMLC returns a location service response to the LCS client. For a
request for immediate location, if the positioning result from the other PLMN
meets the QoS requirement, the HGMLC returns it to the LCS client. Otherwise,
the HGMLC returns final location service response without including any
positioning result. For a request for deferred location, if the result from
the other PLMN indicates acceptance of the location request, the HGMLC returns
this to the LCS client. Otherwise, the HGMLC returns a final location service
response indicating failure of the deferred location request.
Figure 6.9.2-2: MT-LR positioning procedures when UE is served by HPLMN and
VPLMN
Figure 6.9.2-2 shows the MT-LR positioning procedures when the UE is served by
the H-PLMN and a V-PLMN. The difference with procedures shown in Figure
6.9.2-1 is that the HGMLC interacts with AMF directly shown in step 11 of
Figure 6.9.2-2 without involving VGMLC shown in step 11 of Figure 6.9.2-1. In
scenarios where the HGMLC prioritizes location by the H-PLMN rather than
V-PLMN at step 4, steps 5-9 may be replaced by step 11 and step 11 (when step
11 occurs) is then replaced by steps 5-9.
### 6.9.3 MO-LR Procedures when UE is served by the Different PLMNs via 3GPP
Access and Non-3GPP Access
When UE is served by the different PLMNs via 3GPP access and Non-3GPP access,
UE uses the UE Local Configuration to select the access to initiate MO-LR
procedure which is the same as the 5GC-MO-LR Procedure in clause 6.2. If
Non-3GPP access is selected, the following difference exists:
\- The NG-RAN in 5GC-MO-LR Procedure in clause 6.2 is corresponding to the
N3IWF/TNGF;
\- Step 5 in 5GC-MO-LR Procedure in clause 6.2 is the same as step 3d or 3e in
Common Positioning Procedure when UE is served by the same PLMN in clause
6.9.1.
### 6.9.4 NI-LR Procedures when a UE is served by Different PLMNs for 3GPP
access and non-3GPP access
When UE is served by the different PLMNs via 3GPP access and non-3GPP access,
the UE selects one access to register to the 5GC for emergency services as
defined in TS 23.167 [10], or request the establishment of a PDU Session
related to an emergency session.
The NI-LR procedures are the same as the 5GC-NI-LR Procedure (described in
clause 6.10.1) with the difference that:
\- if the procedures are performed for non-3GPP access, NG-RAN in Figure
6.10.1 is replaced by an N3IWF/TNGF/W-AGF and the UE Positioning in step 3 in
Figure 6.10.1 is performed according to steps 3d and 3e in Figure 6.9.1-1.
\- In step 2 in 5GC-NI-LR Procedure in clause 6.10.1, AMF also provides access
type to LMF. LMF shall use the access type provided by AMF for positioning.
The UE is replaced by 5G-RG in the case of wireline access type.
## 6.10 Procedures dedicated to Support Regulatory services
### 6.10.1 5GC-NI-LR Procedure
Figure 6.10.1-1 shows a Network Induced Location Request (NI-LR) procedure for
a UE in the case where the UE initiates an emergency session or other session
using NG-RAN. The procedure assumes that the serving AMF is aware of the
regulatory service associated with the session (e.g. emergency session
initiation - e.g. due to supporting an Emergency Registration procedure or
assisting in establishing an emergency PDU Session).
{width="6.688194444444444in" height="4.159722222222222in"}
Figure 6.10.1-1: 5GC Network Induced Location Request (5GC-NI-LR) for a UE
1\. The UE registers to the 5GC for emergency services or requests the
establishment of a PDU Session related to an applicable regulatory service
(e.g., emergency session initiation).
2\. The AMF may select an LMF based on NRF query or configuration in AMF and
invoke the Nlmf_Location_DetermineLocation service operation towards the LMF
to request the current location of the UE. The service operation includes a
LCS Correlation identifier, the serving cell identity of the Primary Cell in
the Master RAN node and the Primary Cell in the Secondary RAN node when
available based on Dual Connectivity scenarios, and an indication of a
location request from a regulatory services client (e.g., emergency services)
and may include an indication if UE supports LPP, the required QoS and
Supported GAD shapes. If any of the procedures in clause 6.11.1 or 6.11.2 are
used the service operation includes the AMF identity.
3\. If step 2 occurs, the LMF performs one or more of the positioning
procedures described in clause 6.11.1, 6.11.2 and 6.11.3.
4\. If step 3 occurs, the LMF returns the Nlmf_Location_DetermineLocation
Response towards the AMF to return the current location of the UE. The service
operation includes the LCS Correlation identifier, the location estimate, its
age and accuracy and may include information about the positioning method.
NOTE 1: Any remaining procedures for regulatory services other than emergency
services are not addressed in this flow. The remaining steps are applicable
for emergency services.
5\. For emergency services, the AMF selects an GMLC based on NRF query or
configuration in AMF. The information regarding the endpoint in the GMLC to
deliver the event notification, is obtained from the NRF as specified in
clause 7.1.2 of TS 23.501 [18] or from local configuration in the AMF. AMF
invokes the Namf_Location_EventNotify service operation towards the selected
GMLC to notify the GMLC of an emergency session initiation. The service
operation includes the SUPI or the PEI, and the GPSI if available, the
identity of the AMF, an indication of an emergency session and any location
obtained in step 3.
6\. For emergency services, the GMLC forwards the location to an external
emergency services client or may wait for a request for the location from the
external emergency services client (not shown in Figure 6.10.1-1) before
forwarding the location.
7\. For emergency services, the emergency services session and emergency PDU
Session are released.
8\. For emergency services, the AMF invokes the Namf_Location_EventNotify
service operation towards the GMLC to notify the GMLC that the emergency
session was released to enable the GMLC and LRF to release any resources
associated with the emergency session.
### 6.10.2 5GC-MT-LR Procedure without UDM Query
Figure 6.10.2-1 illustrates a location request for an emergency services
session, where an emergency services client (e.g. a Public Safety Answering
Point) identifies the target UE and the serving LRF using correlation
information that was previously provided to it by the IMS Core. The signalling
used to provide the correlation information to the PSAP is defined in TS
23.167 [10]. The correlation information may be used by the LRF to retrieve
other information previously provided to it by the IMS Core and/or AMF as
described for Figure 6.10.1-1. This allows the GMLC associated with the LRF to
request a location from the AMF without needing to query the UDM of the target
UE for the serving AMF address. This scenario therefore supports location of
emergency sessions from roamers and USIM-less and other non-registered UEs,
and requires that identifying information for the UE and AMF have been
provided to the GMLC/LRF as described in clauses 6.10.1 and 6.10.3.
Figure 6.10.2-1: 5GC-MT-LR Procedure without UDM Query
1\. The external emergency services client (e.g. a PSAP) sends a request to
the LRF for a location for the target UE and includes correlation information
identifying the target UE. The request may include the required QoS and
Supported GAD shapes. The LRF address and the correlation information would
have been previously provided to the external client when the emergency
session from the UE was established.
2\. The LRF/GMLC determines the AMF by associating the correlation information
received from the external client with other information received previously
from the AMF as described in step 5 of clause 6.10.1 and step 7 of clause
6.10.3. The GMLC invokes the Namf_Location_ProvidePositioningInfo service
operation towards the AMF to request the current location of the UE. The
service operation includes the SUPI or the PEI and an indication of a location
request from an emergency services client and may include the required QoS and
Supported GAD shapes. The AMF identifies the target UE using the SUPI or in
the case of a USIM-less emergency session, or non-registered USIM emergency
session, the PEI.
3\. The AMF selects an LMF based on NRF query or configuration in AMF and
invokes the Nlmf_Location_DetermineLocation service operation towards the LMF
to request the current location of the UE. The service operation includes a
LCS Correlation identifier, the serving cell identity and an indication of a
location request from an emergency services client and may include an
indication if UE supports LPP, the required QoS and Supported GAD shapes. If
any of the procedures in clause 6.11.1 or clause 6.11.2 are used the service
operation includes the AMF identity.
4\. The LMF performs one or more of the positioning procedures described in
clauses 6.11.1, 6.11.2 and 6.11.3.
5\. The LMF returns the Nlmf_Location_DetermineLocation Response towards the
AMF to return the current location of the UE. The service operation includes
the location estimate, its age and accuracy and may include information about
the positioning method.
6\. The AMF returns the Namf_Location_ProvidePositioningInfo Response towards
the GMLC/LRF to return the current location of the UE. The service operation
includes the LCS Correlation identifier, the location estimate, its age and
accuracy and may include information about the positioning method.
7\. The LRF sends the location service response to the external emergency
services client.
### 6.10.3 Location continuity for Handover of an Emergency session from NG-
RAN
Figure 6.10.3-1 shows support for location continuity for handover of an
emergency session from NG-RAN on the source side to either NG-RAN or another
3GPP RAN on the target side. The procedure applies when control plane location
according to Figures 6.10.1-1 and 6.10.2-1 is used for location of the UE on
the source side. The procedure is based on the procedures for location
continuity currently defined in TS 23.271 [4] clause 9.4.5.4.
NOTE: If User Plane (SUPL) Location Protocol [bb] is used on the source (NG-
RAN) side, then the current procedure for location continuity in TS 23.271 [4]
can be used.
Figure 6.10.3-1: Location Continuity for Handover of an Emergency session from
NG-RAN
1\. Following the request for an emergency session, the UE establishes a PDU
Session for emergency services and an IMS emergency session for NG-RAN access,
during which an LRF is assigned in the serving network IMS and a source GMLC
may be chosen. The 5GC-NI-LR procedure of Figure 6.10.1-1 is also performed
which provides the source AMF identity to the GMLC and LRF and optionally an
initial location for the UE.
2\. At some later time, the LRF may need the UE location and requests the
source GMLC to invoke the Namf_Location_ProvidePositioningInfo service
operation towards the AMF to request the current location of the UE. The
service operation includes the SUPI or the PEI, the required QoS and an
indication of a location request from an emergency services client.
3\. If step 2 occurs or if support for an NI-LR is required, the source AMF
starts a location session to obtain the location of the UE as described in
clause 6.10.2 or clause 6.10.1.
4\. The source AMF receives a request to handover the UE to a cell associated
with a different target node which may be another AMF for intra-RAN handover
or a different type of node (e.g. an MME) for inter-RAN handover (e.g. to
E-UTRAN connected to EPC).
5\. The handover procedure is executed as specified in clause 4.9.1.3 of TS
23.502 [19].
6\. Any location session started in step 3 may terminate normally before step
6. If not, the source AMF shall abort the location session once step 5 is
complete.
7a. If steps 2 and 3 has occurred, the source AMF returns the
Namf_Location_ProvidePositioningInfo Response towards the GMLC to return any
location estimate obtained for the UE. The service operation includes the
target node identity.
7b. If steps 2 and 7a do not occur, the source AMF may invoke the
Namf_Location_EventNotify service operation towards the source GMLC (i.e. the
GMLC used in step 1) to indicate the handover. The service operation includes
the SUPI or the PEI and the GPSI if available, an event type indicating
handover and the identity of the target node.
8a. For inter-RAN handover (e.g. to E-UTRAN connected to EPC) and if control
plane location will be used on the target side, the target node (e.g. MME) may
send a Subscriber Location Report to a GMLC on the target side after
completion of the handover in step 6. The Subscriber Location Report carries
the UE identity (IMSI, MSISDN and/or IMEI), an event type indicating handover
and the identity of the target node. The target node may determine the target
GMLC from configuration information.
8b. For intra-RAN handover and if control plane location will be used on the
target side, the target AMF may invoke the Namf_Location_EventNotify service
operation towards the GMLC to indicate the handover. The service operation
includes the SUPI or the PEI and the GPSI if available, an event type
indicating handover and the identity of the target node.
9\. Reconfiguration of the LRF and the source and target GMLCs may occur in a
manner outside the scope of 3GPP.
10\. If the LRF needs a location estimate for the UE after handover has
occurred and if control plane location is used on the target side, the LRF may
instigate an MT-LR request via the target Node.
## 6.11 Common Sub-Procedures
### 6.11.1 UE Assisted and UE Based Positioning Procedure
Figure 6.11.1-1 shows a positioning procedure used by an LMF to support UE
based positioning, UE assisted positioning and delivery of assistance data.
The procedure is based on use of the LPP protocol defined in TS 36.355 [20]
between the LMF and UE.
Figure 6.11.1-1: UE Assisted and UE Based Positioning Procedure
**Precondition:** A LCS Correlation identifier and the AMF identity has been
passed to the LMF by the serving AMF.
1\. The LMF invokes the Namf_Communication_N1N2MessageTransfer service
operation towards the AMF to request the transfer of a Downlink (DL)
Positioning message to the UE. The service operation includes the DL
Positioning message. The Session ID parameter of the
Namf_Communication_N1N2MessageTransfer service operation is set to the LCS
Correlation identifier. The Downlink Positioning message may request location
information from the UE, provide assistance data to the UE or query for the UE
capabilities.
2\. If the UE is in CM IDLE state, the AMF initiates a network triggered
Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19] to
establish a signalling connection with the UE.
3\. The AMF forwards the Downlink Positioning message to the UE in a DL NAS
TRANSPORT message. The AMF includes a Routing identifier, in the DL NAS
TRANSPORT message, which is set to the LCS Correlation identifier. The
Downlink Positioning message may request the UE to response to the network,
e.g. may request the UE to acknowledge the Downlink Positioning message, to
return location information or to return capabilities, as defined in TS 36.355
[20].
4\. The UE stores any assistance data provided in the Downlink Positioning
message and performs any positioning measurements and/or location computation
requested by the Downlink Positioning message.
5\. If the UE has entered CM-IDLE state during step 4 and needs to responses
to the request received in step 3, the UE instigates the UE triggered Service
Request as defined in clause 4.2.3.2 of TS 23.502 [19] in order to establish a
signalling connection with the AMF.
6\. [Conditional] The UE sends to the AMF the Uplink Positioning message
included in a NAS TRANSPORT message, e.g. to acknowledge the Downlink
Positioning message, to return any location information obtained in step 4 or
returns any capabilities, as requested in step 3. When the UE sends Uplink
Positioning message in a NAS TRANSPORT message, the UE shall also include in
the UL NAS TRANSPORT message the Routing identifier received in step 3.
7\. [Conditional] The AMF invokes the Namf_Communication_N1MessageNotify
service operation towards the LMF indicated by the routing identifier received
in step 6. The service operation includes the Uplink Positioning message
received in step 6 and the LCS Correlation identifier. Steps 6 and 7 may be
repeated if the UE needs to send multiple Uplink Positioning messages to
respond to the request received in Step 3. Steps 1 to 7 may be repeated to
send new assistance data, and to request further location information and
further UE capabilities.
### 6.11.2 Network Assisted Positioning Procedure
Figure 6.11.2-1 shows a procedure that may be used by an LMF to support
network assisted and network based positioning. The procedure may be based on
an NRPPa protocol in TS 38.455 [15] between the LMF and NG-RAN.
Figure 6.11.2-1: Network Assisted Positioning Procedure
**Precondition:** A LCS Correlation identifier and the AMF identity have been
passed to the LMF by the serving AMF.
1\. The LMF invokes the Namf_Communication_N1N2MessageTransfer service
operation towards the AMF to request the transfer of a Network Positioning
message to the serving NG-RAN node (gNB or ng-eNB) for the UE. The service
operation includes the Network Positioning message and the LCS Correlation
identifier. The Network Positioning message may request location information
for the UE from the NG-RAN.
2\. If the UE is in CM IDLE state, the AMF initiates a network triggered
Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19], to
establish a signalling connection with the UE.
3\. The AMF forwards the Network Positioning message to the serving NG-RAN
node in an N2 Transport message. The AMF includes a Routing identifier, in the
N2 Transport message, identifying the LMF (e.g. a global address of the LMF).
4\. The serving NG-RAN node obtains any location information for the UE
requested in step 3.
5\. The serving NG-RAN node returns any location information obtained in step
4 to the AMF in a Network Positioning message included in an N2 Transport
message. The serving NG-RAN node shall also include the Routing identifier in
the N2 Transport message received in step 3.
6\. The AMF invokes the Namf_Communication_N2InfoNotify service towards the
LMF indicated by the routing identifier received in step 5. The service
operation includes the Network Positioning message received in step 5 and the
LCS Correlation identifier. Steps 1 to 6 may be repeated to request further
location information and further NG-RAN capabilities.
### 6.11.3 Obtaining Non-UE Associated Network Assistance Data
Figure 6.11.3-1 shows a procedure which may be used by an LMF to support
network assisted and network based positioning. This procedure is not
associated with a UE location session. It is used to obtain network assistance
data from a NG-RAN node (e.g. gNB or ng-eNB). The procedure may be based on an
NRPPa protocol in TS 38.455 [15] between the LMF and NG-RAN.
Figure 6.11.3-1: Procedure for Obtaining Non-UE Associated Network Assistance
Data
1\. The LMF invokes the Namf_Communication_NonUeN2MessageTransfer service
operation towards the AMF to request the transfer of a Network Positioning
message to a NG-RAN node (gNB or ng-eNB) in the NG-RAN. The service operation
includes the Network Positioning message and the target NG-RAN node identity.
The Network Positioning message may request position related information from
the NG-RAN.
2\. The AMF forwards the Network Positioning message to the target NG-RAN node
indicated in step 1 in an N2 Transport message. The AMF includes a Routing
identifier, in the N2 Transport message, identifying the LMF.
3\. The target NG-RAN node obtains any position related information requested
in step 2.
4\. The target NG-RAN node returns any position related information obtained
in step 3 to the AMF in a Network Positioning message included in an N2
Transport message. The target NG-RAN node shall also include the Routing
identifier in the N2 Transport message received in step 2.
5\. The AMF invokes the Namf_Communication_NonUeN2InfoNotify service operation
towards the LMF indicated by the routing identifier received in step 4. The
service operation includes the Network Positioning message received in step 4.
Steps 1 to 5 may be repeated to request further position related information
from the NG-RAN.
## 6.12 UE Location Privacy Setting Procedure
### 6.12.1 UE Location Privacy Setting Procedure Initiated by UE
Figure 6.12.1-1: UE Location Privacy Setting procedure initiated by UE
0\. NF (e.g. GMLCã€NEF) may subscribe to UDM notifications of UE LCS privacy
profile updates.
NOTE: NF can decide to subscribe to such notifications while a deferred
location request is on-going.
1\. If the UE has generated or updated the UE Location Privacy Indication, the
UE sends the Location Privacy Indication to the AMF via UE Location Privacy
Setting Request in N1 NAS message. The UE Location Privacy Indication
indicates whether allows or disallows the subsequent LCS requests for the UE,
as defined in clause 5.4.
2\. The AMF invokes a Nudm_ParameterProvision_Update (LCS privacy) service
operation towards the UDM and the service operation carries the Location
Privacy Indication information. The UDM stores or updates the UE LCS privacy
profile in the UDR by invoking a Nudr_DM_Update (SUPI, Subscription Data)
service operation accordingly.
3\. The AMF responses to the UE via UE Location Privacy Setting Response in N1
NAS message.
4\. UDM notifies the subscribed Network Function (e.g. GMLC, NEF) of the
updated UE LCS privacy profile via Nudm_SDM_Notification Notify message.
5\. NF (e.g. GMLC, NEF) may unsubscribe to UDM notifications of UE LCS privacy
profile updates e.g. if a deferred location procedure is cancelled.
### 6.12.2 UE Location Privacy Setting Procedure Initiated by AF
The procedure is defined by using the procedure in clause 4.15.6.2 of TS
23.502 [19] to set the Location Privacy Indication parameters and should in
addition unsubscribe to UDM notifications of UE LCS privacy profile updates
e.g. if a deferred location procedure is cancelled.
## 6.13 Procedures with interaction between 5GC and EPC
### 6.13.1 MT-LR Procedure
Figure 6.13.1-1 illustrates network positioning requested by the LCS clients
or the AF external to the PLMN for the case where the LCS Client or AF is
associated with a GMLC in 5GC domain and the UE is served by the EPC domain.
Both non-roaming and roaming scenarios are described. For non-roaming scenario
both the case of separate EPC GMLC and 5GC GMLC connected with Lr reference
point and the case with combined 5GC GMLC and EPC GMLC are described. For
roaming scenario, the 5GC GMLC in the HPLMN uses NL3 to interconnect with the
combined 5GC+EPCGMLC in the VPLMN.
Figure 6.13.1-1: MT-LR procedure with 5GC and EPC interaction
1\. Steps 1-3 in clause 6.1.2 are performed.
2\. For non-roaming case and if 5GC GMLC and EPC GMLC are combined, steps 2a
and 2b are skipped. Otherwise the 5GC GMLC may derive an address of a EPC GMLC
or 5GC+EPC GMLC, either received together with the network address of the
current serving node) from the UDM/HSS in step 1, by internal configuration or
by query to NRF.
2a. If an address of a EPC GMLC is derived, the 5GC GMLC then sends the Lr
location request to the EPC GMLC. If the result of privacy check indicates
that the notification (and verification) based on current location is needed,
the 5GC GMLC shall send a location request to the VGMLC indicating
\"positioning allowed without notification\".
2b. If an address of an 5GC+EPC GMLC is derived, the 5GC GMLC invokes a
Ngmlc_Location_ProvideLocation service operation towards the 5GC+EPC GMLC. If
the result of privacy check indicates that the notification (and verification)
based on current location is needed, the 5GC GMLC invokes the service request
indicating \"positioning allowed without notification\"
3 Steps 2-9 or 9b in TS 23.271 [4] clause 9.1.15 are performed.
4\. For non-roaming case and if 5GC GMLC and EPC GMLC are combined, step 4a
and 4b are skipped. Otherwise the following applies:
4a. If step 2a was performed, the EPC GMLC forwards the location estimation of
the target UE, its age, its accuracy and optionally the information about the
positioning method to the 5GC GMLC.
4b. If step 2b was performed, the 5GC+EPC GMLC forwards the location
estimation of the target UE, its age, its accuracy and optionally the
information about the positioning method to the 5GC+EPC GMLC in a
Ngmlc_Location_ProvideLocation service Response.
5\. If the privacy check in step 1 indicates that further privacy checks are
needed, the 5GC GMLC shall perform an additional privacy check in order to
decide whether the 5GC GMLC can forward the location information to the LCS
client or AF or send a notification if the result of the privacy check
requires the notification and verification based on current location. One
example when this additional privacy check is needed is when the target UE
user has defined different privacy settings for different geographical
locations. When an additional privacy check is not needed, the (H)GMLC skips
steps 6-8.
6\. For non-roaming case and if5GC GMLC and EPC GMLC are combined, step 6a and
6b are skipped. Otherwise the following applies:
6a. If step 2a was performed and if the result of privacy checks in step 5
indicates that the notification (and verification) based on current location
is needed, and in the case of roaming, the 5GC GMLC shall send a location
request to the EPC GMLC indicating \"notification only\".
6b. If step 2b was performed and if the result of privacy checks in step 5
indicates that the notification (and verification) based on current location
is needed, and in the case of roaming, the 5GC GMLC shall invokes a
Ngmlc_Location_ProvideLocation service operation to the 5GC+EPC GMLC
indicating \"notification only\".
7\. The EPC post positioning notification and verification procedure in TS
23.271 [4] clause 9.1.18 is performed.
8\. For non-roaming case and if 5GC GMLC and EPC GMLC are combined, step 8a
and 8b are skipped. Otherwise the following applies:
8a. If step 2a was performed, the EPC GMLC forwards an indication of the
result of notification and verification procedure to the 5GC GMLC.
8b. If step 2b was performed, the 5GC+EPC GMLC forwards an indication of the
result of notification and verification procedure to the 5GC GMLC.
9\. Steps 24 in clause 6.1.2 are performed.
### 6.13.2 MO-LR Transfer to a Third Party Procedure
Figure 6.13.2-1 illustrates the UE requesting its location to be sent to a
Third Party (i.e. an external LCS Client) for the case where the LCS Client is
associated with a GMLC in 5GC domain and the UE is served by the EPC domain.
Both non-roaming and roaming scenarios are described. For non-roaming scenario
both the case of separate 5GC GMLC and EPC GMLC connected with Lr reference
point and the case with co-located 5GC GMLC and EPC GMLC are described. For
roaming scenario, when the combined 5GC GMLC and EPC GMLC are deployed in the
HPLMN, it uses NL3 to interconnect with the EPCGMLC in the VPLMN.
Figure 6.13.2-1: MO-LR procedure with 5GC and EPC interaction
1Steps 1-6 in TS 23.271 [4] clause 9.2.6 are performed.
2\. For non-roaming case and if 5GC GMLC and EPC GMLC is combined, this step
is skipped. Otherwise the EPC GMLC sends Location Update Notification Request
towards to the 5GC GMLC including the information received in step 1.
3 Steps 9-10 in clause 6.2 are performed.
4\. For non-roaming case and if 5GC GMLC and EPC GMLC are combined, this step
is skipped. Otherwise if the identified LCS Client is not accessible, the EPC
GMLC sends a Location Update Notification response to AMF with an appropriate
error cause. Otherwise, the response shall include an acknowledgement. The
message shall specify whether the location estimate of the UE has been handled
successfully by the identified LCS Client, and if not, the corresponding error
cause obtained in step.
5 Steps 13-14 in TS 23.271 [4] clause 9.2.6 are performed.
## 6.14 Procedures for Broadcast of Assistance Data
### 6.14.1 Broadcast of Assistance Data by an LMF
The following procedure is used by the LMF to support broadcasting of network
assistance data to target UEs. This procedure is not associated with a UE
location session. It is used in an AMF to send network assistance data to an
NG-RAN node for broadcasting by the NG-RAN node to target UEs. NG-RAN
positioning procedures related to LMF and NG-RAN node communication are
specified in TS 38.455 [15].
Figure 6.14.1-1: Broadcasting Network Assistance Data
1\. The LMF invokes the Namf_Communication_NonUeN2MessageTransfer service
operation towards the AMF to request the transfer of a Network Assistance Data
message to an NG-RAN node (gNB or ng-eNB) in the NG-RAN. The service operation
includes the Network Assistance Data message and the target NG-RAN node
identity. The Network Assistance Data message includes assistance data which
may be optionally ciphered.
2\. The AMF forwards the Network Assistance Data message to the target NG-RAN
node indicated in step 1 in an N2 Transport message. The AMF includes a
Routing identifier, in the N2 Transport message, identifying the LMF.
3\. The NG-RAN node broadcasts the assistance data contained in the Network
Assistance Data message.
4\. The target NG-RAN node may return feedback on assistance information
broadcasting to the AMF in a Network Assistance Feedback message. The target
NG-RAN node shall also include the Routing identifier in the N2 Transport
message received in step 2.
5\. The AMF invokes the Namf_Communication_NonUeN2InfoNotify service operation
towards the LMF indicated by the routing identifier received in step 4. The
service operation includes the Network Assistance Data Feedback message
received in step 4.
### 6.14.2 Delivery of Ciphering Keys to UEs for Broadcast Assistance Data
The following procedure is used by the LMF and the AMF to distribute ciphering
keys to UEs to enable UEs to decipher broadcast assistance data that was
ciphered by the LMF. This procedure is not associated with a UE location
session. The procedure makes use of the Registration procedure defined in TS
23.502 [19].
Figure 6.14.2-1: Delivery of Ciphering Keys to UEs for Broadcast Assistance
Data
1\. The LMF invokes the Nlmf_Broadcast_CipheringKeyData Notify service
operation towards the AMF carrying one or more ciphering keys used to cipher
network assistance data that is broadcast to UEs according to the procedure in
clause 6.14.1. For each ciphering key, the LMF includes a ciphering key value,
a ciphering key identifier, a validity period, a set of applicable tracking
areas and a set of applicable types of broadcast assistance data.
NOTE 1: The LMF may send a new ciphering key to the AMF at a time T1 if this
will start to be used to cipher network assistance data at a later time T2
(e.g. will replace a previous ciphering key which expires at time T2). The
value of (T2 - T1) should exceed the longest periodic registration timer of
any UE subscribed to receive ciphering keys to ensure that periodic
registration can be used to request new ciphering keys as described in note 2.
2\. The AMF stores the ciphering keys including the validity periods,
applicable tracking areas and the types of applicable broadcast assistance
data.
3\. A UE sends a Registration Request to a RAN node. The Registration Request
may be sent as part of normal mobility management, A Registration Request may
also be sent specifically to request and obtain ciphering keys. The UE
includes in the Registration Request an indication that ciphering keys are
requested. Other details of the Registration Request are as defined in TS
23.502 [19].
NOTE 2: A UE should request new ciphering keys using a Registration Request
caused by periodic registration if the remaining validity period for one or
more ciphering keys received earlier by the UE is less than the periodic
registration timer value. This can help avoid all UEs initiating a
Registration procedure at the same time to obtain new ciphering keys when a
validity period for a ciphering key is about to expire. A UE should also
request new ciphering keys for a Registration Request caused by entering a new
tracking area if previous ciphering keys are not applicable to the new
tracking area.
4\. The RAN node selects the AMF if the UE is in CM IDLE state or determines
the AMF for CM CONNECTED state.
5\. The RAN node forwards the Registration Request to the AMF.
6\. The AMF returns a Registration Accept to the RAN node as defined in TS
23.502 [19]. If the UE is subscribed to receive ciphered broadcast data, the
AMF includes in the Registration Accept one or more ciphering keys applicable
to the current tracking area for the UE. The AMF also includes for each
ciphering key the ciphering key value, the ciphering key identifier, the
validity period, the set of applicable tracking areas and the set of
applicable types of broadcast assistance data.
NOTE 3: The AMF does not need to keep a record of ciphering keys delivered to
a UE and may instead send all ciphering keys stored at step 2 that are
applicable to the current tracking area, for which the UE has a subscription
and whose validity period has not yet expired.
7\. The RAN node forwards the Registration Accept to the UE. The UE may start
to use each ciphering key to decipher network assistance data that is
broadcast according to the procedure in clause 6.14.1 once the validity period
for the ciphering key has started and if the UE is currently in an applicable
tracking area. The UE shall cease using a ciphering key when entering a
tracking area not applicable to the ciphering key. The UE shall cease using
and shall delete a ciphering key when the validity period for the ciphering
key has expired.
NOTE 4: A UE that receives no ciphering keys in response to a request for
ciphering keys may assume that the UE does not have a subscription to receive
ciphering keys in the serving PLMN.
8\. The AMF deletes all information for a ciphering key when the validity
period has expired.
# 7 Information storage
## 7.1 UDM
For each UE subscriber the UDM stores LCS related data as part of the
Subscriber Data Management (SDM) service as defined in clause 5.2.3.3.1 of TS
23.502 [19].
The privacy profile data is defined in table 7.1-1 containing data for the
privacy classes for which location of the target UE is permitted. For the
meaning of each LCS privacy profile data type and included data, refer to
clause 5.4.2.
Table 7.1-1: LCS privacy profile data stored in the UDM for a UE Subscriber
+----------------------------+----------+----------------------------+ | Privacy Profile Data Type | Presence | UDM data | +----------------------------+----------+----------------------------+ | Location Privacy | M | Indication of one of the | | Indication | | following mutually | | | O | exclusive global settings: | | | | | | | | > \- Location is | | | | > disallowed | | | | > | | | | > \- Location is allowed | | | | > (default) | | | | | | | | Time period when the | | | | Location Privacy | | | | Indication is valid | +----------------------------+----------+----------------------------+ | Call/session Unrelated | M | For any LCS client or AF | | Class | | not in the external LCS | | | O | client list or otherwise | | | | identified for the | | | O | Call/session Unrelated | | | | Class, the following data | | | O | may be present: | | | | | | | O | > \- One of the following | | | | > mutually exclusive | | | O | > options: | | | | > | | | O | > \- Location not allowed | | | | > (default case) | | | O | > | | | | > \- Location allowed with | | | O | > notification | | | | > | | | O | > \- Location with | | | | > notification and privacy | | | O | > verification; location | | | | > allowed if no response | | | O | > | | | | > \- Location with | | | O | > notification and privacy | | | | > verification; location | | | O | > restricted if no | | | | > response | | | | > | | | | > \- Time period when | | | | > positioning is allowed | | | | > | | | | > \- Geographical area | | | | > where positioning is | | | | > allowed | | | | > | | | | > \- Indication that | | | | > codeword shall be | | | | > checked in UE or one or | | | | > more codeword values to | | | | > be checked in GMLC | | | | | | | | External LCS client list: | | | | a list of zero or more LCS | | | | clients, AFs and LCS | | | | Client groups with the | | | | following data for each | | | | entry: | | | | | | | | > \- One of the following | | | | > mutually exclusive | | | | > options: | | | | > | | | | > \- Location allowed | | | | > without notification | | | | > (default case) | | | | > | | | | > \- Location allowed with | | | | > notification | | | | > | | | | > \- Location with | | | | > notification and privacy | | | | > verification; location | | | | > allowed if no response | | | | > | | | | > \- Location with | | | | > notification and privacy | | | | > verification; location | | | | > restricted if no | | | | > response | | | | > | | | | > \- Time period when | | | | > positioning is allowed | | | | > | | | | > \- Geographical area | | | | > where positioning is | | | | > allowed | | | | | | | | Service types list: a list | | | | of one or more service | | | | types for which the LCS | | | | client is allowed to | | | | locate the particular UE. | | | | The possible service types | | | | are defined in | | | | TS 22.071 [2]. The | | | | following data may be | | | | present for each service | | | | type in the list: | | | | | | | | > \- One of the following | | | | > mutually exclusive | | | | > options: | | | | > | | | | > \- Location allowed | | | | > without notification | | | | > (default case) | | | | > | | | | > \- Location allowed with | | | | > notification | | | | > | | | | > \- Location with | | | | > notification and privacy | | | | > verification; location | | | | > allowed if no response | | | | > | | | | > \- Location with | | | | > notification and privacy | | | | > verification; location | | | | > restricted if no | | | | > response | | | | > | | | | > \- Time period when | | | | > positioning is allowed | | | | > | | | | > \- Geographical area | | | | > where positioning is | | | | > allowed | | | | > | | | | > \- Indication that | | | | > codeword shall be | | | | > checked in UE or one or | | | | > more codeword values to | | | | > be checked in GMLC | +----------------------------+----------+----------------------------+ | PLMN Operator Class | O | LCS client list: a list of | | | | one or more generic | | | | classes of LCS client that | | | | are allowed to locate the | | | | particular UE. The | | | | following classes are | | | | distinguished: | | | | | | | | > \- LCS client | | | | > broadcasting location | | | | > related information | | | | > | | | | > \- O&M LCS client in the | | | | > HPLMN | | | | > | | | | > \- O&M LCS client in the | | | | > VPLMN | | | | > | | | | > \- LCS client recording | | | | > anonymous location | | | | > information | | | | > | | | | > \- LCS Client supporting | | | | > a bearer service, | | | | > teleservice or | | | | > supplementary service to | | | | > the target UE | +----------------------------+----------+----------------------------+
The Mobile Originating data is defined in table 7.1-1 containing the LCS MO-LR
services that a UE can receive.
Table 7.1-2: LCS Mobile Originated data for a UE Subscriber
+------------------------+----------+----------------------------+ | MO-LR Data | Presence | UDM data | +------------------------+----------+----------------------------+ | Mobile Originated data | M | List of MO-LR services | | | | allowed for a UE | | | | subscriber: | | | | | | | | > \- Basic Self Location | | | | > (UE can receive its own | | | | > location) | | | | > | | | | > \- Autonomous Self | | | | > Location (UE can receive | | | | > location assistance | | | | > data) | | | | > | | | | > \- Transfer to Third | | | | > Party | +------------------------+----------+----------------------------+
Table 7.1-3: LCS broadcasting data for a UE subscriber
* * *
Broadcasting Data Presence Description List of Assistance Data Types O A list
of one or more types of location assistance data for which ciphering keys
should be provided to the UE if requested by the UE when the assistance data
is broadcast using ciphering.
* * *
## 7.2 GMLC
### 7.2.1 Information for an LCS Client
The GMLC holds information for external LCS clients which are permitted to
request location information for UE subscribers. Table 7.2.1-1 shows the
information which may be stored in the GMLC for an external LCS Client.
Table 7.2.1-1: GMLC Information for an External LCS Client
+-----------------------------+--------+-----------------------------+ | LCS Client Information | Status | Description | +-----------------------------+--------+-----------------------------+ | LCS Client Type | M | Identifies the type of LCS | | | | client from among the | | | | following: | | | | | | | | - Emergency Services | | | | | | | | - Value Added Services | | | | | | | | - PLMN Operator Services | | | | | | | | - Lawful Intercept | | | | Services | +-----------------------------+--------+-----------------------------+ | External identifier | O | A list of one or more | | | | identifiers used to | | | | identify an external LCS | | | | client. The identifier may | | | | be used for a 5GC-MT-LR | | | | and/or 5GC-MO-LR. The | | | | format of the identifier is | | | | an international E.164 | | | | address, ITU-T | | | | Recommendation | | | | E.164 [23]. | +-----------------------------+--------+-----------------------------+ | Authentication data | MO | Data employed to | | | | authenticate an external | | | | LCS client if the | | | | authentication is not done | | | | by a security gateway -- | | | | details are outside the | | | | scope of the present | | | | document | +-----------------------------+--------+-----------------------------+ | Internal identifier | O | Identifies the sub-type of | | | | a PLMN operator services | | | | LCS Client from among the | | | | following: | | | | | | | | - LCS client broadcasting | | | | location related | | | | information | | | | | | | | - O&M LCS client in the | | | | HPLMN | | | | | | | | - O&M LCS client in the | | | | VPLMN | | | | | | | | - LCS client recording | | | | anonymous location | | | | information | | | | | | | | - LCS Client supporting a | | | | bearer service, teleservice | | | | or supplementary service to | | | | the target UE | +-----------------------------+--------+-----------------------------+ | Client name | O | An address string which is | | | | associated with the LCS | | | | client\'s external identity | | | | (i.e., E.164 address). | +-----------------------------+--------+-----------------------------+ | Client name type | O | Indication of the type of | | | | the LCS client name. The | | | | type of the LCS client name | | | | can be one of the | | | | following: | | | | | | | | - Logical name | | | | | | | | - MSISDN | | | | | | | | - E-mail address | | | | (RFC 2396 [25]) | | | | | | | | - URL (RFC 2396 [25]) | | | | | | | | - SIP URL | | | | (RFC 3261 [26]) | | | | | | | | - IMS public identity | | | | (1 23.228 [27]) | | | | | | | | - GPSI | +-----------------------------+--------+-----------------------------+ | Privacy Override Indication | O | Indication of whether the | | | | LCS client possesses the | | | | POI capability (only | | | | applicable to lawful | | | | intercept and emergency | | | | services clients) | +-----------------------------+--------+-----------------------------+ | Authorized UE List | O | A list of SUPIs and/or | | | | groups of SUPI for which | | | | the LCS client may issue a | | | | request for a 5GC-MT-LR for | | | | immediate or deferred | | | | location. | +-----------------------------+--------+-----------------------------+ | Priority | O | The priority of the LCS | | | | client | +-----------------------------+--------+-----------------------------+ | QoS parameters | M | The default QoS | | | | requirements for the LCS | | | | client, comprising: | | | | | | | | - Accuracy | | | | | | | | - Response time | | | | | | | | - LCS QoS Class | +-----------------------------+--------+-----------------------------+ | Service Coverage | O | A list of E.164 country | | | | codes for geographic areas, | | | | ITU-T Recommendation | | | | E.164 [23] where the LCS | | | | client is permitted to | | | | request and receive UE | | | | location information. | +-----------------------------+--------+-----------------------------+ | Allowed LCS Request Types | M | Indicates which of the | | | | following are allowed: | | | | | | | | - Request of current | | | | immediate location | | | | | | | | - Request of current or | | | | last known immediate | | | | location | | | | | | | | - Request of deferred | | | | location for the UE | | | | available event | | | | | | | | - Request of deferred | | | | location for UE periodic | | | | events | | | | | | | | - Request of deferred | | | | location for the Area Event | | | | | | | | - Request of deferred | | | | location for the Motion | | | | Event | +-----------------------------+--------+-----------------------------+ | Local Co-ordinate System | O | Definition of the | | | | co-ordinate system(s) in | | | | which a location estimate | | | | shall be provided -- | | | | details are outside the | | | | scope of the present | | | | document | +-----------------------------+--------+-----------------------------+ | Access Barring List(s) | O | List(s) of SUPIs or groups | | | | of SUPI for which a | | | | location request is barred | +-----------------------------+--------+-----------------------------+ | Service types | O | List of service type | | | | allowed for the LCS client. | +-----------------------------+--------+-----------------------------+ | Maximum Target UE Number | O | The maximum number of the | | | | Target UEs in one LCS | | | | request. For a specific LCS | | | | Client, this parameter may | | | | have different values for | | | | different service types. | +-----------------------------+--------+-----------------------------+
# 8 Network Function Services
## 8.1 AMF Services
AMF services related to location service are defined in TS 23.502 [19] clause
5.2.2.
## 8.2 UDM Services
UDM services related to location service are defined in TS 23.502 [19] clause
5.2.3.
## 8.3 LMF Services
### 8.3.1 General
The following table shows the LMF Services and LMF Service Operations.
Table 8.3.1-1: List of LMF Services
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Example | | | Operations | | Consumer(s) | | | | Semantics | | +================+================+================+================+ | Nlmf_Location | Det | Re | AMF | | | ermineLocation | quest/Response | | +----------------+----------------+----------------+----------------+ | | EventNotify | Notify | GMLC | +----------------+----------------+----------------+----------------+ | | CancelLocation | Re | AMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | LocationC | Re | LMF | | | ontextTransfer | quest/Response | | +----------------+----------------+----------------+----------------+ | N | Ci | Notify | AMF | | lmf_Broadcast | pheringKeyData | | | +----------------+----------------+----------------+----------------+
### 8.3.2 Nlmf_Location service
#### 8.3.2.1 General
**Service description:** This service enables an NF to request location
determination for a target UE. The following are the key functionalities of
this NF service.
\- Allow the consumer NF to request the current geodetic and optionally civic
location of a target UE.
\- Allow the consumer NF to subscribe/unsubscribe the geodetic and optionally
civic location of a target UE for some certain events.
\- Allow the consumer NF to get notified about the geodetic and optionally
civic location of a target UE when some certain events are detected.
\- Allows the consumer NF to cancel location event reporting for a target UE.
\- Allows the consumer NF to transfer location context information for
location event reporting for a target UE.
The events to trigger location estimation notification are defined in clause
4.1a.5.1
#### 8.3.2.2 Nlmf_Location_DetermineLocation service operation
**Service operation name:** Nlmf_Location_DetermineLocation
**Description:** Provides UE location information to the consumer NF.
NOTE: For deferred location request, this service operation is used to
implicitly subscribe to the notification of the UE location information.
**Input, Required:** Client Type, LCS Correlation Identifier.
**Input, Optional:** Serving cell identifier of the Primary Cell in the Master
RAN node and the Primary Cell in the Secondary RAN node when available based
on Dual Connectivity scenarios if the UE is using 3GPP access, Location QoS,
Supported GAD shapes, service type, AMF identity if a UE associated
Namf_Communication service is to be invoked by LMF, Type of request for a 5GC-
MO-LR, Embedded LPP message for a 5GC-MO-LR, Deferred location type, Deferred
location parameters, indication if UE supports LPP or not, Notification Target
Address, Notification Correlation ID.
**Output, Required:** Success/Failure indication
**Output, Optional:** Geodetic Location, Civic Location, Position Methods Used
(in the case of success indication provided), Serving LMF identification,
Failure Cause (in the case of failure indication provided).
See clause 6.1, clause 6.2. and clause 6.3.1 for examples of usage of this
service operation.
#### 8.3.2.3 Nlmf_Location_EventNotify service operation
**Service operation name:** Nlmf_Location_EventNotify.
**Service operation description:** Allow the consumer NF to get notified about
the geodetic and optionally civic location of a target UE when some certain
events are detected, either the events implicitly subscribed by the AMF using
Nlmf_Location_DetermineLocation service operation or the cancellation of
reporting of periodic or triggered location events.
**Input, Required:** Notification Correlation ID, UE (SUPI and if available
GPSI), Type of event.
**Input, Optional:** Geodetic Location, Civic Location, Position Methods Used
(in the case of success indication provided), Notification Target address,
Serving LMF identification, Failure Cause (in the case of failure indication
provided).
**Output, Required:** None _._
**Output, Optional:** Success/Failure indication _._
See clause 6.3.1 and clause 6.3.2 for examples of usage of this service
operation.
#### 8.3.2.4 Nlmf_Location_CancelLocation service operation
**Service operation name:** Nlmf_Location_CancelLocation
**Description:** The consumer NF cancels a deferred 5GC-MT-LR procedure for
periodic or triggered location request.
**Input, Required:** Notification Target Address, Notification Correlation ID.
**Input, Optional:** None.
**Output, Required:** Success/Failure indication
**Output, Optional:** None.
See clause 6.3.3 for an example of usage of this service operation.
#### 8.3.2.5 Nlmf_Location_LocationContextTransfer service operation
**Service operation name:** Nlmf_Location_LocationContextTransfer
**Description:** Transfers location context information for location event
reporting for a target UE from the consumer NF.
**Input, Required:** AMF identity, Location QoS, Supported GAD shapes,
Deferred location type, Deferred location parameters, Notification Target
Address, Notification Correlation ID, Embedded event report message.
**Input, Optional:** Event reporting status, UE location information.
**Output, Required:** Success/Failure indication
**Output, Optional:** None.
See clause 6.4 for an example of usage of this service operation.
### 8.3.3 Nlmf_Broadcast service
#### 8.3.3.1 General
Service description: This service enables an NF to receive information related
to broadcast of location assistance by an LMF. The following are the key
functionalities of this NF service.
\- Allow the consumer NF to be notified about ciphering keys used to cipher
broadcast assistance data.
The events to trigger ciphering key notification are defined in clause 6.14.2.
#### 8.3.3.2 Nlmf_Broadcast_CipheringKeyData service operation
**Service operation name:** Nlmf_Broadcast_CipheringKeyData
**Description:** Provides ciphering key data to the consumer NF.
**Input, Required:** For each ciphering key: ciphering key value, ciphering
key identifier, validity period, set of applicable types of broadcast
assistance data.
**Input, Optional:** For each ciphering key: set of applicable tracking areas.
**Output, Required:** For each ciphering key: ciphering key identifier,
success/failure indication.
**Output, Optional:** none.
See clause 6.14.2 for an example of usage of this service operation.
## 8.4 GMLC Services
### 8.4.1 General
The following table shows the GMLC Services and GMLC Service Operations.
Table 8.4.1-1: List of GMLC Services
+-----------------+----------------------+--------------------+---------------------+ | Service Name | Service Operations | Operation | Example Consumer(s) | | | | | | | | | Semantics | | +=================+======================+====================+=====================+ | Ngmlc_Location | ProvideLocation | Request / Response | GMLC, NEF | +-----------------+----------------------+--------------------+---------------------+ | | LocationUpdate | Request / Response | AMF, GMLC | +-----------------+----------------------+--------------------+---------------------+ | | LocationUpdateNotify | Notify | NEF | +-----------------+----------------------+--------------------+---------------------+ | | CancellLocation | Request / Response | GMLC, NEF | +-----------------+----------------------+--------------------+---------------------+ | | EventNotify | Notify | GMLC, NEF | +-----------------+----------------------+--------------------+---------------------+
### 8.4.2 Ngmlc_Location service
#### 8.4.2.1 General
**Service description:** This service enables an NF to request location
determination for a target UE. The following are the key functionalities of
this NF service.
\- Allow the consumer NF to request the current geodetic and optionally civic
location of a target UE.
\- Allow the consumer NF to subscribe/unsubscribe the geodetic and optionally
civic location of a target UE for some certain events.
\- Allow the consumer NF to cancel an on-going periodic or triggered location
request of a target UE.
\- Allow the consumer NF to get notified about the geodetic and optionally
civic location of a target UE when some certain events are detected.
#### 8.4.2.2 Ngmlc_Location_ProvideLocation service operation
**Service operation name:** Ngmlc_Location_ProvideLocation
**Description:** Provides UE location information to the consumer NF.
NOTE 1: For deferred location request, this service operation is used to
implicitly subscribe to the notification of the UE location information.
NOTE 2: For bulk LCS service request from NEF to GMLC, this service operation
is used to implicitly subscribe to the notification of UE location information
**Input, Required:** UE identifier (GPSI, SUPI, Internal Group Identifier or
External Group Identifier), Client Type.
**Input, Optional:** Required QoS, Supported GAD shapes, UE privacy
requirements, LCS Client Identification, Service type, Notification Target
Address, Notification Correlation ID, Event Type (defined in clause 4.1a.5.1),
and:
\- For periodic event type, optional input further includes the time interval
between successive location reports, the total number of reports, location
QoS.
\- For area event type, optional input further includes target geographical
area, whether the event to be reported is the UE being inside, entering into
or leaving the target area, the duration of event reporting, the minimum and
maximum time intervals between successive event reports, the maximum event
sampling interval, whether location estimates and associated location QoS
shall be included in event reports, and whether only one location report is
required or more than one.
\- For motion event type, optional input further includes the threshold linear
distance, the duration of event reporting, the minimum and maximum time
intervals between successive event reports, the maximum event sampling
interval, whether location estimates and associated location QoS shall be
included in event reports, and whether only one location report is required or
more than one.
**Output, Required:** Success/Failure indication
**Output, Optional:** Geodetic location, civic location, age of location,
position methods used (in the case of success indication provided), failure
cause (in the case of failure indication provided).
See clauses 6.3.1 and 6.8 for examples of usage of this service operation.
#### 8.4.2.3 Ngmlc_Location_LocationUpdate service operation
**Service operation name:** Ngmlc_Location_LocationUpdate
**Description:** Consumer NF provides UE location information to the GMLC.
**Input, Required:** UE identifier (GPSI or SUPI), event causing the location
estimate (5GC-MO-LR), location estimate, age of location estimate, accuracy
indication, LCS QoS class.
**Input, Optional:** pseudonym indicator, identity of the LCS client, identity
of the AF, GMLC address, service type specified by UE.
**Output, Required:** Success/Failure indication
**Output, Optional:** Failure Cause (in the case of failure indication
provided).
See clause 6.2 for example of usage of this service operation.
#### 8.4.2.4 Ngmlc_Location_EventNotify service operation
**Service operation name:** Ngmlc_Location_EventNotify
**Description:** Allow the consumer NF to get notified about the geodetic and
optionally civic location of one or more target UEs when some certain events,
either the events implicitly subscribed by the AMF using
Ngmlc_Location_ProvideLocation service operation, or the cancellation of
reporting of periodic or triggered location events, are detected or at bulk
reporting of location.
**Input, Required:** Notification Correlation ID, UE (SUPI and if available
GPSI), Type of location related event (e.g. deferred location for the UE
available event, activation of location for periodic or triggered location,
mobility of a target UE to a new AMF or MME for a deferred location).
**Input, Optional:** Geodetic Location, Civic Location, Position Methods Used
(in the case of success indication provided), Failure Cause (in the case of
failure indication provided), address of a new AMF or MME.
**Output, Required:** None _._
**Output, Optional:** None _._
See clauses 6.3 and 6.8 for examples of usage of this service operation.
#### 8.4.2.5 Ngmlc_Location_CancelLocation service operation
**Service operation name:** Ngmlc_Location_CancelLocation
**Description:** The consumer NF uses this service operation to cancel a
deferred 5GC-MT-LR procedure for periodic or triggered location.
**Input, Required:** UE Identification (SUPI), Notification Target address,
Notification Correlation ID.
**Input, Optional:** None.
**Output, Required:** None _._
**Output, Optional:** None _._
See clause 6.3.3 for example of usage of this service operation.
#### 8.4.2.6 Ngmlc_Location_LocationUpdateNotify service operation
**Service operation name:** Ngmlc_Location_LocationUpdateNotify
**Description:** Provides UE location information to the consumer NF.
**Input, Required:** UE identifier (GPSI or SUPI), identity of the AF, event
causing the location estimate (5GC-MO-LR), location estimate, age of location
estimate, accuracy indication, LCS QoS class.
**Input, Optional:** Service identity (mapped from service type by HGMLC).
**Output, Required:** Success/Failure indication.
**Output, Optional:** Failure Cause (in the case of failure indication
provided).
See clause 6.2 for example of usage of this service operation.
## 8.5 NEF Services
For 5GC-MT-LR procedures, location reporting is one of the monitoring events,
as defined in clause 4.15.3.1 of TS 23.502 [19], supported by
Nnef_EventExposure service.
Nnef_EventExposure service operations are defined in TS 23.502 [19] clause
5.2.6.2.
The attributes that may be included in the location service request and
response are listed in clause 5.5.
For 5GC-MO-LR procedure, if UE requests to report its location to AF, the
location reporting is supported by Nnef_Location_LocationUpdateNotify service
operation defined in TS 23.502 [19] clause 5.2.6.21.
## 8.6 UDR Services
UDR services related to location service are defined in TS 23.502 [19] clause
5.2.3.
###### ## Annex A (informative): Differences with TS 23.271 [4]
# A.0 General
Differences with TS 23.271 [4] are described here where these may impact
service to a target UE, LCS client, or client AF or NF. The differences are
restricted to those applicable to a UE with EPS access in the case of TS
23.271 [4] and do not include all differences applicable to GERAN or UTRAN
access.
# A.1 Differences in Parameters for a Location Request
Table A.1-1 shows a list of parameters applicable to a location request sent
by an external LCS client to a GMLC which are defined in TS 23.271 [4],
differences if any with this TS, and comments on these including any
significant consequences.
Table A.1-1: Differences in Parameters for a Location Request with TS 23.271
[4]
+----------------------+----------------------+----------------------+ | Location Request | Difference | Comments | | Parameter | | | +======================+======================+======================+ | Target UE Identity | GPSI, SUPI or | | | | pseudonym in this TS | | | | | | | | MSISDN, IMSI or | | | | pseudonym in | | | | TS 23.271 [4] | | +----------------------+----------------------+----------------------+ | LCS QoS | None | | +----------------------+----------------------+----------------------+ | Supported GAD shapes | None | | +----------------------+----------------------+----------------------+ | LCS Client type | None | | +----------------------+----------------------+----------------------+ | Called Party Number | Not supported in | If provided, this | | | this TS | parameter should be | | | | ignored by a GMLC | +----------------------+----------------------+----------------------+ | APN NI | Not supported in | If provided, this | | | this TS | parameter should be | | | | ignored by a GMLC | +----------------------+----------------------+----------------------+ | Service Identity | None | | +----------------------+----------------------+----------------------+ | Codeword | None | | +----------------------+----------------------+----------------------+ | Service coverage | None | | | information | | | +----------------------+----------------------+----------------------+ | Requestor Identity | Not supported in | If provided, this | | | this TS | parameter should be | | | | ignored by a GMLC | +----------------------+----------------------+----------------------+ | Type of Requestor | Not supported in | If provided, this | | Identity | this TS | parameter should be | | | | ignored by a GMLC | +----------------------+----------------------+----------------------+ | Type of a deferred | None | | | location request | | | +----------------------+----------------------+----------------------+ | Periodic Location | None | | | parameters | | | +----------------------+----------------------+----------------------+ | Area Event | None | | | parameters | | | +----------------------+----------------------+----------------------+ | Motion Event | None | | | parameters | | | +----------------------+----------------------+----------------------+
# A.2 Differences in Information Storage in the UDR/UDM versus HSS/GMLC for
EPS
Table A.2-1 shows a list of LCS information storage items for a UE in the UDR
and UDM defined in this TS and for the HSS and/or GMLC defined in TS 23.271
[4], differences if any between this TS and TS 23.271 [4], and comments on
these including any significant consequences.
Table A.2-1: Differences in Information Storage for a UE in the UDR/UDM versus
HSS/GMLC for EPS
+----------------------+----------------------+----------------------+ | Information Storage | Difference | Comments | | Item(s) | | | +======================+======================+======================+ | UE Privacy Universal | Not supported in | This privacy class | | Class | this TS | should not be | | | | supported for 5GC | | | | capable UEs on the | | | | EPS side to avoid | | | | differences in LCS | | | | privacy support | | | | between EPS access | | | | and 5GS access for | | | | the same UE. (Note | | | | 1) | +----------------------+----------------------+----------------------+ | UE Location Privacy | Not supported in | This indication can | | Indication | TS 23.271 [4] | create differences | | | | between LCS client | | | | access to a UE which | | | | has 5GS access | | | | versus EPS access. | | | | (Note 1) | +----------------------+----------------------+----------------------+ | UE Privacy | Not supported in | This privacy class | | Call/Session related | this TS | should not be | | Class | | supported for 5GC | | | | capable UEs on the | | | | EPS side to avoid | | | | differences in LCS | | | | privacy support | | | | between EPS access | | | | and 5GS access for | | | | the same UE. (Note | | | | 1) | +----------------------+----------------------+----------------------+ | UE Privacy | Supported as defined | This privacy class | | Call/Session | in TS 23.271 [4] | can create | | unrelated Class | with the following | differences between | | | differences: | LCS client access to | | | | a UE which has 5GS | | | - Information | access versus EPS | | | related to an RGMLC | access. (Note 1) | | | is not included | | | | | | | | - An optional time | | | | period is not | | | | supported in | | | | TS 23.271 [4] | | | | | | | | - An optional | | | | geographic area is | | | | not supported in | | | | TS 23.271 [4] | | +----------------------+----------------------+----------------------+ | UE Privacy PLMN | None | | | Operator Class | | | +----------------------+----------------------+----------------------+ | UE LCS Mobile | None | | | Originating Data | | | +----------------------+----------------------+----------------------+ | NOTE 1: A PLMN | | | | operator can avoid | | | | any difference in UE | | | | privacy support for | | | | EPS access versus | | | | 5GS access by only | | | | storing information | | | | for UE privacy (in | | | | the UE LCS privacy | | | | profile) in a UDR | | | | (and UDM) and not in | | | | an HSS or GMLC. | | | +----------------------+----------------------+----------------------+
# A.3 Differences in Information Storage in the GMLC
Table A.3-1 shows a list of information storage items in the GMLC for an LCS
Client defined in this TS and in TS 23.271 [4], differences if any between
this TS and TS 23.271 [4], and comments on these including any significant
consequences.
Table A.3-1: Differences in Information Storage for an LCS Client in the GMLC
+----------------------+----------------------+----------------------+ | Information Storage | Difference | Comments | | Item(s) | | | +======================+======================+======================+ | LCS Client Type | None | | +----------------------+----------------------+----------------------+ | LCS Client Type | None | | +----------------------+----------------------+----------------------+ | External identity | None | | +----------------------+----------------------+----------------------+ | Authentication data | None | | +----------------------+----------------------+----------------------+ | Call/session related | Not supported in | This information | | identity | this TS | item can create | | | | differences between | | | | LCS client access to | | | | a UE which has 5GS | | | | access versus EPS | | | | access. (Note 1) | +----------------------+----------------------+----------------------+ | Internal identity | None | | +----------------------+----------------------+----------------------+ | Client name | None | | +----------------------+----------------------+----------------------+ | Client name type | No difference except | A GPSI can be an | | | that this TS adds a | MSISDN or External | | | Client Name type in | Identifier in the | | | the form of a GPSI. | form of | | | | \"username\@realm\" | | | | as defined in | | | | TS 23.003 [28]. | | | | | | | | TS 23.271 [4] | | | | allows an MSISDN but | | | | the External | | | | Identifier is not | | | | included. | +----------------------+----------------------+----------------------+ | Override capability | None | | +----------------------+----------------------+----------------------+ | Authorized UE List | None | | +----------------------+----------------------+----------------------+ | Priority | None | | +----------------------+----------------------+----------------------+ | QoS parameters | None | | +----------------------+----------------------+----------------------+ | Service Coverage | None | | +----------------------+----------------------+----------------------+ | Allowed LCS + | TS 23.271 [4] | This TS should take | | Request Types | includes the | precedence (Note 1) | | | following items | | | | which are not in | | | | this TS: | | | | | | | | - Non-call related | | | | CS-MT-L | | | | R/PS-MT-LR/EPC-MT-LR | | | | | | | | - Call/session | | | | related | | | | CS-MT-L | | | | R/PS-MT-LR/EPC-MT-LR | | | | | | | | - Specification or | | | | negotiation of | | | | priority | | | | | | | | - Specification or | | | | negotiation of QoS | | | | parameters | | | | | | | | - Specification or | | | | negotiation of | | | | Service Coverage | | | | parameter | | | | | | | | This TS includes the | | | | following items | | | | which are not in | | | | TS 23.271 [4]: | | | | | | | | - Request of | | | | deferred location | | | | for the UE available | | | | event | | | | | | | | - Request of | | | | deferred location | | | | for UE periodic | | | | events | | | | | | | | - Request of | | | | deferred location | | | | for the Area Event | | | | | | | | - Request of | | | | deferred location | | | | for the Motion Event | | +----------------------+----------------------+----------------------+ | Local Co-ordinate | None | | | System | | | +----------------------+----------------------+----------------------+ | Access Barring | TS 23.271 [4] | This TS can take | | List(s) | includes a list of | precedence (Note 1) | | | MSISDNs. | | | | | | | | This TS includes a | | | | list of SUPIs | | +----------------------+----------------------+----------------------+ | Service Identities | None | | +----------------------+----------------------+----------------------+ | Maximum Target UE | None | | | Number | | | +----------------------+----------------------+----------------------+ | NOTE 1: A PLMN | | | | operator can avoid | | | | any difference in | | | | LCS Client support | | | | for a target UE with | | | | EPS access versus | | | | 5GS access by only | | | | storing information | | | | for an LCS Client in | | | | a GMLC as defined in | | | | this TS. | | | +----------------------+----------------------+----------------------+
# A.4 Differences with TS 23.271 [4] on Privacy
## A.4.1 Differences in UE LCS Privacy
Table A.4.1-1 shows a list of UE LCS privacy features defined in this
specification and in TS 23.271 [4], differences if any between these, and
comments on these including any significant consequences.
Table A.4.1-1: Differences in UE LCS Privacy with TS 23.271 [4]
+----------------------+----------------------+----------------------+ | UE LCS Privacy | Difference | Comments | | Feature | | | +======================+======================+======================+ | Privacy Override | None | | | Indicator (POI) | | | +----------------------+----------------------+----------------------+ | UE Privacy Universal | Not supported in | This class allows a | | Class | this TS | UE to subscribe to | | | | location by any LCS | | | | client. For such a | | | | UE, a 5GC GMLC will | | | | not support such | | | | location. | +----------------------+----------------------+----------------------+ | Location Privacy | Not supported in | As defined in | | Indication | TS 23.271 [4] | clause 5.4.2.3. | +----------------------+----------------------+----------------------+ | UE Privacy | Not supported in | This class permits | | Call/Session related | this TS | location by LCS | | Class | | clients to which the | | | | UE has established a | | | | PS session. | | | | | | | | A 5GC GMLC will not | | | | allow such location. | | | | However, the | | | | location can be | | | | allowed as part of | | | | the Call/Session | | | | unrelated class. | +----------------------+----------------------+----------------------+ | UE Privacy | Supported as defined | The optional valid | | Call/Session | in TS 23.271 [4] | time period and | | unrelated Class | with the following | valid geographic | | | differences: | area allow more | | | | precise control of | | | An optional valid | location reporting. | | | time period is added | For example, | | | | tracking of | | | An optional valid | employees by an | | | geographic area is | employer can be | | | added | restricted to a work | | | | location and/or | | | | normal work hours. | +----------------------+----------------------+----------------------+ | UE Privacy PLMN | Supported as defined | | | Operator Class | in TS 23.271 [4] | | +----------------------+----------------------+----------------------+
###### ## Annex B (informative): LCS privacy selection rule in serving NF
# B.1 LCS privacy selection flow rule
A 5GS-MT-LR may be applied to more than one LCS privacy data in the LCS
privacy profile, e.g. one or more privacy classes as defined in clause 5.4.2.2
and LPI as defined in clause 5.4.2.3. The 5GS-MT-LR may also require POI as
defined in clause 5.4.4. The Privacy selection flow is shown in Figure B.1-1.
Figure B.1-1: Privacy selection flow diagram
#
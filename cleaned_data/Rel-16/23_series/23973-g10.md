# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
Introduction
During the network migration to 5GC, it is possible for operators to deploy
separate HSS and UDM/UDR in e.g. multi-vendor scenario. This document
describes the scenarios of separate UDM and HSS with separate repositories and
with a common repository, and provides the corresponding solutions for these
scenarios.\ 1 Scope
This Technical Report describes scenarios for co-existence of subscription
data pertaining to legacy system (EPS) with data pertaining to the 5G system,
when the HSS+UDM defined in Rel-15 is separated and both UDM and HSS are
independent, and provides solutions to support this deployment where
necessary.
NOTE 1: The subscription data referred to by this Technical Report comprises
both static as well as dynamic data, including IMS, LCS, SMS data.
This technical report includes:
\- diverse scenarios related to the storage of subscription data including,
but not limited to, those of common repository for subscription data from EPS
and 5GS, as well as separate repositories for EPS and 5GS subscription data;
and
\- the solutions supporting relevant procedures in TS 23.502 [2] (for e.g.
authentication, mobility, handover and procedures for IMS and SMS handling in
interworking between 5G system and EPS),
Provisioning aspects are out of the scope of this document.
Direct interactions between the EPS UDR and the 5GS UDR are out of the scope
of this document.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.502: \"Procedures for the 5G System\".
[3] 3GPP TS 23.335: \"User Data Convergence (UDC); Technical realization and
information flows; Stage 2\".
[4] 3GPP TS 29.335: \"User Data Convergence (UDC); User data repository access
protocol over the Ud interface; Stage 3\".
[5] 3GPP TS 23.002: \"Network architecture\".
[6] 3GPP TS 23.501: \"System Architecture for the 5G System\".
[7] 3GPP TS 23.228: \"IP Multimedia Subsystem\".
[8] 3GPP TS 23.380: \"IMS Restoration Procedures\".
[9] 3GPP TS 29.505: \"5G System; Usage of the Unified Data Repository services
for Subscription Data\".
[10] 3GPP TS 29.228: \"IP Multimedia (IM) Subsystem Cx and Dx Interfaces;
Signalling flows and message contents\".
[11] 3GPP TS 29.328: \"IP Multimedia (IM) Subsystem Sh interface; Signalling
flows and message contents\".
[12] 3GPP TS 33.501: \"Security architecture and procedures for 5G System\".
[13] 3GPP TS 33.401: \"System Architecture Evolution (SAE) - Security
architecture\".
[14] 3GPP TS 23.794: \"Study on Enhanced IMS to 5GC Integration\".
[15] 3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service
description; Stage 2\".
[16] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[17] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[18] 3GPP TS 29.214: \"Policy and charging control over Rx reference point\".
[19] 3GPP TS 23.632: \"User data interworking, coexistence and migration;
Stage 2\".
[20] 3GPP TS 29.563: \"5G System (5GS); Home Subscriber Server (HSS) services
for interworking with Unified Data Management (UDM); Stage 3\".
[21] 3GPP TS 23.040: \"Technical realization of the Short Message Service
(SMS)\".
[22] 3GPP TS 23.204: \"Support of SMS over generic 3GPP IP access; Stage 2\".
[23] 3GPP TS 29.272: \"Mobility Management Entity (MME) and Serving GPRS
Support Node (SGSN) related interfaces based on Diameter protocol\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**5G Repository** : Repository hosting subscription data for 5G UEs.
**5GS UDR** : term used to identify the Unified Data Repository defined in TS
23.501 [6] (clause 4.2.5).
**EPS UDR** : term used to identify the User Data Repository defined in TS
23.335 [3] (clause 4.2.3).
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
5GC 5G Core
5GS 5G System
5GS UDR 5G Unified Data Repository
HSS FE Home Subscriber Server Front End
EPS Enhanced Packet core System
EPS UDR EPS User Data Repository
E-UTRAN Evolved Universal mobile telecommunications system Terrestrial Radio
Access Network
UDM Unified Data Management
# 4 Architectural Assumptions and Principles
## 4.1 Architectural Assumptions
The 5GS data storage architecture defined in TS 23.501 [6], for structured
data, is used as the baseline network architecture.
The User Data Convergence concept specified in TS 23.335 [3], is used for
reference to EPS/legacy system architecture for data storage, when layered
architecture is deployed (i.e. application front-end decoupled from data
repository using the standard interface Ud defined in TS 29.335 [4]).
The Home Subscriber Server (HSS) architecture specified in clause 4.1.1 of TS
23.002 [5], is used for reference to EPS/legacy system architecture for data
storage, when non-layered HSS architecture is deployed (i.e. monolithic
deployment where user data are stored within the entity itself (or in an
external entity via non-standard interfaces)).
## 4.2 Architectural Principles
In the UDC concept used for reference, HSS FE and EPS UDR defined in TS 23.335
[3] are assumed to interact for any data required by the study: no
standardization will be considered for the interface between HSS FE and EPS
UDR.
# 5 Deployment Scenarios
This document supports the following deployment scenarios:
Scenario 1: the HSS FE and` UDM are separately deployed and the user data of
5GC, EPC, CS and IMS domains are also stored separately in different
repositories (i.e. EPS UDR storing user data for EPC, CS and IMS domains, and
5GC UDR storing user data for 5GS domain). It is assumed that the HSS is
deployed using the UDC architecture in TS 23.335 [3].
Scenario 2: a common repository (acting as EPS UDR and 5GS UDR) is shared
between separate HSS and UDM, in which both the user data for 5GC, EPC, CS and
IMS domains are stored. It is also assumed that the HSS is deployed using the
UDC architecture in TS 23.335 [3].
# 6 Solutions
## 6.1 Solution #1: Direct SBA UDM-HSS Interworking
### 6.1.1 Introduction
This solution applies to deployment scenario 1 and 2.
This solution proposes a new Service Based Interface between UDM and HSS.
### 6.1.2 High-level Description
This contribution proposes a service based interface between HSS and UDM. The
architecture for this solution is outlined in the following figure:
Figure 6.1.2-1: Architecture for Direct UDM-HSS Interworking with independent
UDRs
Figure 6.1.2-2: Architecture for Direct UDM-HSS Interworking with a common
repository
A new reference point between UDM and HSS within the combined HSS/UDM (i.e.
Nxx as depicted in Figures 6.1.2-1 and 6.1.2-2) is proposed. The new interface
for interworking between HSS and UDM is proposed to be based on SBI
principles.
NOTE: The UDM and the HSS may be deployed in a stand-alone manner and could be
from different vendors.
### 6.1.3 Services and Illustrated Procedures
The Procedures and protocols for the Nxx interface are documented in TS 23.632
[19] and TS 29.563 [20] respectively.
Editor\'s note: The correct references need to be added when available. Nxx
name may also need update.
### 6.1.4 Impacts on existing services and interfaces
Following impacts are identified:
a) Impacts in HSS:
New SBA service as documented in TS 23.632 [19] and TS 29.563 [20]
respectively.
This SBA service has to follow registration/discovery/selection procedures (by
means of interaction with NRF or by configuration) as defined for Rel‑15 or
its evolution/adaptation to Rel‑16.
No impacts to existing interfaces or procedures.
b) Impacts in UDM
New SBA service as documented in documented in TS 23.632 [19] and TS 29.563
[20] respectively.
### 6.1.5 Evaluation
This solution identifies an approach that can work for both layered and not
layered architectures of HSS.
In addition, it supports all the procedures that have been defined on EPS and
5GS without any impact on any other interface than the one between HSS and UDM
this solution defines.
## 6.2 Solution #2: UDM/HSS FE interaction reusing legacy protocol
### 6.2.1 Introduction
This solution applies to deployment scenario 1 and 2.
The assumption of this solution is that 5GS UDR and EPS UDR are separate,
between which there is no interface for direct interactions. The EPS and IMS
profiles are stored in EPS UDR and the 5GS profile is stored in 5GS UDR.
UDM and HSS FE interacts to retrieve or update the required user data for the
following procedures:
\- Authentication procedure, i.e. initial attach/registration.
\- Network Provided Location Information (NPLI).
\- Procedure on IP address continuity of interworking without N26 from 5GS to
EPS.
\- T-ADS query for IMS voice.
\- IMS related procedures related to Cx/Dx and Sh interfaces.
\- SMS over NAS.
To avoid the impact on legacy HSS, the interactions for retrieving or updating
user data are initiated by UDM through reusing existing HSS supported protocol
and procedures, i.e. this solution only requires UDM to retrieve or update
user data stored in EPS UDR via HSS FE. The interface between HSS FE and EPS
UDR is also not impacted.
### 6.2.2 High-level Description
#### 6.2.2.1 Authentication and Registration
A new interface, Shu, between UDM and HSS FE is introduced, by which UDM
initiates interactions with HSS FE to retrieve or update user data stored in
EPS UDR. Shu is a Point-to-Point reference point.
UDM is the only access point both to 5GC and EPC.
Figure 6.2.2.1.1: Solution architecture
In some 5G deployment, when a 4G subscriber is updated to 5G subscriber, the
4G subscription profile keeps stored in EPS UDR while the new 5G subscription
data is provisioned in 5GS UDR. In this case it is assumed that the
authentication data is only stored in EPS UDR and is reused by 5GS
authentication.
For new 5G subscriber, all the subscription data is stored in 5GS UDR.
Therefore, the solution described in this clause does not apply.
In this scenario, when a UE with 5GS subscription registers on 5GS, the UDM
needs to interact with HSS FE to retrieve authentication vector(s) generated
in EPS UDR.
NOTE 1: The UDM is a combo node which simultaneously supports UDM and HSS FE
functionality.
NOTE 2: The authentication vector(s) can be authentication vector(s) for SGSN,
which is 5 tuple vector that UDM can convert it into 5GC authentication
vector(s) by implementation to avoid impact on HSS.
In the case of single registration in 5G, in order to cancel the registration
in the other RAT, the UDM supports to perform a fake 4G registration in the
HSS, as shown in Figure 6.2.3.1-2. This trigger the HSS to cancel the 4G
registration. When the UE moves back to 4G, the HSS sends cancel location to
UDM which trigger the UDM to deregister the UE in 5G.
#### 6.2.2.2 IP address continuity of interworking without N26 from 5GS to EPS
Shu interface defined in clause 6.2.2.1 is reused.
UDM is the only access point both to 5GC and EPC.
Figure 6.2.2.2-1: Solution architecture
When a UE initially registers in 5GC, the FQDN for the S5/S8 interface of the
PGW-C+SMF is registered into UDM via Nudm as specified in clause 4.11.2 of TS
23.502 [2].
When UE attaches in EPS due to interworking without N26, the procedure
specified in clause 4.11.2 of TS 23.502 [2] applies. When MME sends Update
Location Request to UDM, after forwarding the request to HSS FE, UDM needs to
retrieve the stored PGW-C+SMF FQDN and add it into the Update Location Ack
message returned from HSS FE.
The MME use PGW-C+SMF FQDN received from the Update Location Ack message to
determine the address of PGW-C+SMF.
#### 6.2.2.3 T-ADS for IMS voice
Shu interface defined in clause 6.2.2.1 is reused.
UDM is the only access point both to 5GC, EPC and IMS, i.e. UDM supports S6a
and Sh interfaces along with Nudm.
Figure 6.2.2.3-1: Solution architecture
SCC AS initiates T-ADS query towards UDM via Sh interface as specified in TS
29.328 [11].
To handle T-ADS query, the UDM queries T-ADS information towards HSS FE to get
T-ADS information related to EPS and UMTS. HSS FE may query MME and SGSN to
get information as specified in TS 23.401 [16] and TS 23.060 [15].
After receiving response of T-ADS query from HSS FE, UDM responds T-ADS query
to SCC AS based on the T-ADS information received from HSS FE and T-ADS
information in UDM. UDM may query AMF to get necessary information as
specified in TS 23.501 [6].
#### 6.2.2.4 Supporting IMS related procedures
Shu interface defined in clause 6.2.2.1 is reused.
UDM, which is a combo node supporting UDM and HSS functionalities, is the only
access point both to 5GC, EPC and IMS.
Figure 6.2.2.4-1: Solution architecture
Since IMS profile is stored in EPS UDR, the UDM needs to forward all the
requests received from IMS via Cx/Dx or Sh interfaces to HSS FE to handle, and
further forwards all the responses from HSS FE to IMS.
For some scenarios that HSS FE and EPS UDR may generate requests to IMS, the
UDM needs to forward all the requests received from HSS FE to IMS via Cx/Dx or
Sh interfaces to handle, and further forwards all the responses from IMS to
HSS FE.
#### 6.2.2.5 SMS over NAS
Shu interface defined in clause 6.2.2.1 is reused.
UDM is the only access point both to SMSF, SMS router and SMSC/SM GMSC.
Figure 6.2.2.5-1: Solution architecture
### 6.2.3 Services and Illustrated Procedures
#### 6.2.3.1 Authentication and Registration
The procedure of the interaction between UDM and HSS FE for Authentication
vector(s) Retrieval is shown in Figure 6.2.3.1-1.
Figure 6.2.3.1-1: Authentication vectors Retrieval Procedure between UDM and
HSS FE
1a. When the UE attaches from EPS, MME sends Authentication-Information-
Request to UDM to get authentication information for the UE. The MME message
is sent to UDM by DRA routing (i.e. based on IMSI range).
1b. When the UE registers from 5GS, AMF invokes
Nausf_UEAuthentication_authenticate service operation to AUSF to get
authentication information for the UE.
1b\'. AUSF invokes Nudm_UEAuthentication_Get service operation.
2\. When UDM receives Nudm_UEAuthentication_Get, it determines to generate and
send S6a Authentication-Information-Request message to HSS-FE based on local
configuration, to retrieve UTRAN authentication vectors, if the authentication
information is stored in EPS UDR due to operator\'s deployment.
3\. HSS FE interacts with EPS UDR to retrieve requested type of authentication
information of the UE via legacy UDC architecture.
4\. HSS FE returns Authentication-Information-Answer with E-UTRAN
authentication vectors or UTRAN authentication vectors to UDM.
5\. if MAP_SEND_AUTHENTICATION_INFO response is received, UDM converts CS or
PS authentication vectors to 5GS authentication vectors.
5a. UDM forwards Authentication-Information-Answer with E-UTRAN authentication
vectors to MME.
5b\'. If UTRAN authentication vectors are received, UDM generates the respond
to Nudm_UEAuthentication_Get service operation invocation with 5GS
authentication vectors converted from UTRAN authentication vectors, and sends
the respond to AUSF.
5b. AUSF response the AMF invoked Nausf_UEAuthentication_authenticate service.
NOTE: How UDM converts authentication vector is implementation specific.
The procedure of the interaction between UDM and HSS FE for single
Registration is shown in Figure 6.2.3.1-1.
Figure 6.2.3.1-2: Single Registration Procedure between UDM and HSS FE
1\. The UE is registered in 5G. The AMF perform UE registration in UDM. The
AMF indicates whether it requires single registration or dual registration.
2\. If the AMF requires single registration then the following steps are
performed. Otherwise the procedure stops.
3\. The UDM selects the HSS FE based on the SUPI and sends Update Location
Request to HSS FE. In this message a dedicated MME Identity is included. This
dedicated MME Identity is pointing to the UDM. From HSS FE point of view, the
UDM is now acted as a MME. This message also includes an indication to
indicate single registration and an indication to indicate the skip of
subscription data so the HSS FE will not send the UE 4G subscription data.
4\. The HSS FE stores the dedicated MME Identity into EPS UDR via Ud
interface.
5\. The HSS FE sends Update Location Response to UDM.
6\. If the UE has been registered in an old MME, the HSS FE sends Cancel
Location Request towards this old MME. This message will be routed to MME
directly based on the old MME Identity.
7\. The old MME deregisters the UE and sends Cancel Location Response to the
HSS FE.
8\. After the UE reselects 4G and performs Tracking Area Update procedure in
4G, the new MME sends Update Location Request towards the HSS FE. As the UDM
is the only access point both to 5GC and EPC, this message is sent to UDM and
the UDM relays this message to HSS FE.
9\. The HSS stores the new MME information into EPS UDR via Ud interface.
10\. The HSS sends Update Location Response to new MME via UDM including the
UE 4G subscription.
11\. Because the UE has been registered in 5G and a dedicated MME Identity
pointing to the UDM is stored in the EPS UDR, the EPS UDR triggers the HSS FE
to send Cancel Location Request towards the UDM. This message will be routed
to UDM based on the dedicated MME Identity.
12\. UDM sends Cancel Location Response to HSS FE.
13\. Upon receiving Cancel Location Request from HSS FE targeting to
deregister the UE in 5G, the UDM initiated Deregistration procedure to
deregister the UE in 5G.
#### 6.2.3.2 IP address continuity of interworking without N26 from 5GS to EPS
The procedure of the interaction between UDM and HSS FE is shown in Figure
6.2.3.2-1.
Figure 6.2.3.2-1: IP continuity procedure for interworking without N26 from
5GS to EPS
0\. PGW-C+SMF registers its FQDN in UDM during registration procedure. UDM
stores the FQDN in 5GS UDR.
1\. When the UE attaches in EPS due to interworking without N26 from 5GS to
EPS, during the procedure, MME sends Update Location Request to UDM.
2\. UDM forwards Update Location Request to HSS FE for further handling.
3\. HSS FE interacts with EPS UDR to handle Update Location Request.
4\. HSS FE returns Update Location Ack to UDM.
5\. after receiving Update Location Ack, UDM retrieve PGW-C+SMF FQDN from 5GS
UDR.
6\. UDM generates a new Update Location Ack to add PGW-C+SMF FQDN into the
message and forwards the message to MME.
NOTE: The other signalling interactions not related to the solution are not
present in this figure for simplification.
#### 6.2.3.3 T-ADS for IMS voice
The procedure of the interaction between UDM and HSS FE is shown in Figure
6.2.3.3-1.
Figure 6.2.3.3-1: T-ADS Procedure between UDM and HSS FE
1\. SCC AS initiates T-ADS query towards UDM by sending a User-Data-Request
message via Sh interface.
2\. UDM forwards this User-Data-Request message to get T-ADS information
related to EPS and UMTS.
3\. HSS FE may query MME to get more T-ADS information as specified in TS
23.401 [16].
4\. HSS FE may query SGSN to get more T-ADS information as specified in TS
23.060 [15].
5\. HSS FE returns T-ADS information based on the information it derives by
sending a User-Data-Answer message.
6\. after receiving T-ADS information from HSS FE, UDM may query AMF for more
T-ADS information as specified in TS 23.501 [6].
7\. UDM determines T-ADS result based on T-ADS information received from HSS
FE and AMF and responds to SCC AS with the T-ADS information by sending a
User-Data-Answer message.
NOTE: The other signalling interactions not related to the solution are not
present in this figure for simplification.
For the single registration case the following message flow in figure
6.2.3.3-2 applies:
Figure 6.2.3.3-2: T-ADS Procedure with Single registration and UE is 5GS
registered
In Figure 6.2.3.3-2 it is clear that due to the fake registration concept, the
HSS is the entity that is in charge of taking T-ADS decisions, and not the
UDM, even when the UE is registered in the 5GS with the UDM.
#### 6.2.3.4 **S** upporting IMS related procedures
The procedure of the interaction between UDM and HSS FE is shown in Figure
6.2.3.4-1.
Figure 6.2.3.4-1: IMS procedures between UDM and HSS FE
1a or 1b. UDM receives Cx/Dx requests or Sh requests from IMS.
2\. UDM identifies these requests are for IMS procedures, and forwards the
requests to HSS FE.
3\. HSS FE interacts with EPS UDR to handle the requests.
4\. HSS FE sends responses to the requests to UDM.
5a or 5b. UDM forwards the received responses to IMS accordingly.
6\. EPS UDR and HSS FE may generates requests to IMS, e.g. PNR to IMS AS or
RTR to S-CSCF.
7\. HSS FE sends the requests to UDM.
8a or 8b. UDM forwards the requests to IMS accordingly.
9a or 9b. IMS sends responses to the requests to UDM.
10\. UDM forwards the responses to HSS FE.
NOTE: The other signalling interactions not related to the solution are not
present in this figure for simplification.
#### 6.2.3.5 SMSF address storage and retrieval
The procedure of the interaction between UDM and HSS FE is shown in Figure
6.2.3.5-1.
Figure 6.2.3.5-1: SMSF address storage and retrieval between UDM and HSS FE
1\. SMSF invokes Nudm_UECM_Registration service operation to register its
address in UDM.
2\. UDM interacts with 5GS UDR to store the SMSF address.
3\. When SMS-SC or SMS GMSC initiates MT SMS delivery procedure, SMS-SC or SMS
GMSC send MAP request i.e. Send Routing Information for SM request, to UDM.
4\. UDM interacts with 5GS UDR to retrieve stored SMSF address.
5\. UDM responds with SMSF address.
#### 6.2.3.6 MT SMS domain selection
The procedure of the interaction between UDM and HSS FE for MT SMS domain
selection is shown in Figure 6.2.3.6-1.
Figure 6.2.3.6-1: MT SMS domain selection
1\. SMS SC/SMS-GMSC sends MAP Send Routing Info for SM request to UDM to query
routing address for MT SMS.
2\. UDM retrieves SMSF address from 5GS UDR as specified in clause 6.2.3.5.
3\. UDM forwards MAP Send Routing Info for SM request to HSS FE to query more
routing addresses for MT SMS.
4\. HSS FE retrieves SMS routing addresses stored in EPS UDR.
5\. HSS FE sends Send Routing Info for SM response with all addresses
currently available, e.g. IP-SM-GW/ SMS Router address, MME address and MSC
address.
6\. Based on configured policy, UDM selects the SMS routing address to be used
for SMS SC/SMS-GMSC, e.g. IP-SM-GW/SMS Router address, and returns the address
to SMS SC/SMS-GMSC.
7\. SMS SC/SMS-GMSC forwards SMS message to IP-SM-GW/SMS Router.
8\. IP-SM-GW/SMS Router fails to deliver the SMS message to the UE via IMS.
9\. IP-SM-GW/SMS Router may query UDM again to get other address for SMS
delivery retry.
10\. Based on configured policy, UDM returns other available SMS routing
address to IP-SM-GW/SMS Router.
11\. IP-SM-GW/SMS Router retries message delivery to the received address.
6.2.3.7 Messages-Waiting-Data handling
In this solution, the Messages-Waiting-Data as specified in TS 23.040 [21] are
stored in HSS.
When SMS related entities, e.g. SMS SC/SMS-GMSC or IP-SM-GW, send
corresponding requests to create or modify the Messages-Waiting-Data as
specified in TS 23.040 [21] and TS 23.204 [22], the UDM forwards the requests
with no change to HSS FE. The HSS FE interacts with EPS UDR to complete the
handling of the Messages-Waiting-Data. The HSS FE sends responses to the UDM,
which forwards the responses to the corresponding entities.
When the HSS detects or is informed that the MS/UE is reachable or is
available again, the HSS clears corresponding flags and alerts SMS SC/SMS-GMSC
as specified in TS 23.040 [21]. The UDM forwards the messages in these
procedures.
When the UDM receives UE reachability notification, addition to the procedures
defined in TS 23.502 [2], the UDM acts as a MME and generates request to HSS
HE to notify the reachability of the UE as specified in TS 29.272 [23].
### 6.2.4 Impacts on existing services and interfaces
#### 6.2.4.1 Authentication impacts
UDM supports:
\- generating Diameter S6a Authentication-Information-Request message based on
Nudm_UEAuthentication_Get service operation;
\- forwarding Diameter S6a Authentication-Information-Request message to HSS-
FE and Authentication-Information-Answer message with authentication vectors
to MME;
\- converting UTRAN authentication vector into 5GS authentication vector;
\- generating the respond to Nudm_UEAuthentication_Get service operation
invocation with 5GS authentication vectors, and sends the respond to AMF;
\- generating and sending Location Update Request message to perform fake 4G
registration in HSS FE when the UE is registered in 5G;
\- de-registering the UE in 5G when it receives Cancel Location request with
dedicated MME Identity from the HSS FE.
HSS FE: No impact.
5GS UDR: No impact.
EPS UDR: No impact.
#### 6.2.4.2 IP address continuity impacts
UDM supports:
\- forwarding Diameter S6a Update Location Request message to HSS FE;
\- retrieving PGW-C+SMF FQDN from 5GS UDR after receiving Update Location Ack
from HSS FE;
\- generating new Update Location Ack to add PGW-C+SMF FQDN into the message
and forwarding the message to MME.
HSS FE: No impact.
5GS UDR: No impact.
EPS UDR: No impact.
#### 6.2.4.3 T-ADS for voice impacts
UDM supports:
\- forwarding User-Data-Answer message to HSS FE;
\- determine T-ADS result based on T-ADS information received from HSS FE and
AMF.
HSS FE: No impact.
5GS UDR: No impact.
EPS UDR: No impact.
#### 6.2.4.4 **S** upporting IMS related procedures
UDM supports:
\- forwarding requests for IMS procedures received from IMS to HSS FE and
further forwarding responses from HSS FE to IMS;
\- forwarding requests for IMS procedures received from HSS FE to IMS and
further forwarding responses from IMS to HSS FE.
HSS FE: No impact.
5GS UDR: No impact.
EPS UDR: No impact.
### 6.2.5 Evaluation
This solution has no impact on entities other than UDM.
The Solution does not provide the possibility to deploy a pure UDM without HSS
functionality.
The EPS and 5GS UDRs both need to keep up to date registration status for the
UE, i.e. the EPS UDR has to know the registration status of the UE also when
the UE is in the 5GS (due to the fake registration concept). This means that
there is duplication of registration data in EPS and 5GS UDR, which is adding
load and storage requirement to the system
Due to the fake registration concept, the T-ADS master node is always the
legacy HSS, not the UDM, even when the UE is 5GS registered. So, the
functional allocation between 5GS and EPS specific entities is blurred for as
long as there are combined 4G/5G subscribers.
Implementation to convert UTRAN authentication vectors to 5GS authentication
vectors is needed.
NOTE: The above implementation should be evaluated by SA WG3.
## 6.3 Solution #3: Deployment and coexistence without interworking between
UDM and existing HSS
### 6.3.1 Introduction
This solution applies to deployment scenario 1 and 2.
This solution proposes a deployment and coexistence alternative which avoids
the need of specification of interworking procedures between UDM and the
existing HSS.
### 6.3.2 High-level Description
This solution proposes an alternative for coexistence between UDM and HSS
based on:
\- Deploying HSS and UDM in a single network entity, referred as Combined
HSS/UDM, supporting interfaces and procedures specified for 5GC, EPC and IMS.
\- UDM and HSS deployed in the Combined network entity may interact with a 5GS
UDR that stores 4G/IMS/5G subscription data for 5G enabled users (when using a
common repository). The 5GS UDR may also store _2G/3G subscription profiles
for 5G enabled users in case coexistence with 2G/3G networks is required._
Alternatively, the Combined HSS/UDM may also use separate repositories for
subscription data of 5G enabled users.
\- The functions of the Combined HSS/UDM are provided by a single network
entity, so that the interactions between HSS and UDM within the Combined
entity are performed internally and therefore it is not required to define
such interworking.
\- The existing HSS and EPS UDR keep serving only 4G users. The existing EPS
UDR may also store _2G/3G subscription profiles for non 5G enabled users in
case coexistence with 2G/3G networks is required._
\- A routing solution routes Diameter EPC/IMS requests to either the Combined
HSS/UDM for 5G enabled users or the existing HSS for 4G only users. This kind
of solution can be achieved e.g. by using a network entity that provides
SLF/DRA functionality and/or by local configuration in network entities
interacting with HSS (e.g. configuring IMSI ranges in MME), and other
alternatives may be possible. The routing solution includes redundancy
mechanisms to prevent single point of failure issues.
\- Considering that HLR is an integral part of the HSS, both within the
existing HSS and the HSS within the Combined HSS/UDM, the routing solution is
also required to route MAP requests to either the Combined HSS/UDM for 5G
enabled users or the existing HSS for non 5G enabled users. This enables the
coexistence of 2G/3G domain in both HSS platforms including the support for
MAP based SMS use cases.
\- There is no need of interworking between UDM and existing HSS out of the
Combined network entity.
\- The different options regarding deployment of subscription data repository
are described below, gathering the considerations described previously.
\- **Option 1** : A common repository is used for the Combined HSS/UDM.
Subscription data of new 5G enabled users is directly provisioned in 5GS UDR.
Subscription data of existing 4G users that becomes 5G enabled is relocated
from existing EPS UDR to 5GS UDR. When and how the subscription data
relocation is performed depends on the overall migration plan and the
procedure designed for that purpose, and it is out of scope of the description
of this solution.
This option may be considered the most appropriate for a multivendor
deployment, while providing centralization of subscription data, allowing
consolidation of user profiles for a given user in a single repository. This
consolidation simplifies provisioning process, providing a single point of
provisioning and ensuring data consistency.
It minimizes deployment impacts, providing a flexible network evolution to 5G
while users become 5G enabled through subscription relocation according to
plans and speed chosen by the operator.
Additionally, this option may be considered to follow a smooth evolution of
the subscription data repository used for 5G enabled users to a cloud native
deployment.
Figures 6.3.1-1 and 6.3.1-2 show the network architecture using a common
repository for the Combined HSS/UDM:
Figure 6.3.1-1: Coexistence of existing HSS and Combined HSS/UDM with common
repository used by the Combined entity
Figure 6.1.1-2: Coexistence of existing HSS and Combined HSS/UDM with common
repository used by the Combined entity -- Including MAP access
\- **Option 2** : Separate repositories are deployed for subscription data of
5G enabled users accessed by the Combined HSS/UDM. In this case, provisioning
and/or subscription relocation to EPS UDR used by the Combined HSS/UDM is also
needed.
This option allows multivendor deployment for 5G enabled users and legacy
users, as well as keeping open the way for the evolution of the subscription
data repository used for 5G enabled users to a cloud native deployment.
However, subscription data centralization is not achieved, and deployment,
management and provisioning of subscription repositories becomes not optimal
and complex.
Figures 6.3.1-3, and 6.3.1-4 show the network architecture using separate
repositories for the Combined HSS/UDM:
Figure 6.3.1-3: Coexistence of existing HSS and Combined HSS/UDM with separate
repositories deployed for the Combined entity
Figure 6.3.1-4: Coexistence of existing HSS and Combined HSS/UDM with separate
repositories deployed for the Combined entity - Including MAP access
\- **Option 3** : Separate repositories are used and the existing EPS UDR
keeps storing 4G/IMS subscription data for 5G enabled users as well as 4G only
users, as shown in figures 6.3.1-5, and figure 6.3.1-6. Subscription
relocation is not required in this option.
Both the existing HSS and the HSS within the Combined entity interact with the
EPS UDR using the same proprietary Ud interface, implying that a multivendor
deployment will require integration of the non-standard Ud interface with the
HSS in the Combined HSS/UDM.
This option does not allow centralization of user profiles for a given user in
a single repository, making provisioning more complex as multiple subscription
repositories are required to be populated for the same user.
It enables evolution of subscription repository to cloud native technology
only for the 5G profiles. EPC and IMS profiles are assumed to be kept in the
existing EPS UDR using legacy repository technology.
Figure 6.3.1-5: Coexistence of existing HSS and Combined HSS/UDM with separate
repositories using existing EPS UDR for 4G/IMS subscription data
Figure 6.3.1-6: Coexistence of existing HSS and Combined HSS/UDM with separate
repositories using existing EPS UDR for 4G/IMS subscription data - Including
MAP access
\- **Option 4** : Another option is to deploy a single repository to store
subscription data for all domains used by the Combined HSS/UDM and the
existing HSS, as depicted in figures 6.3.1-7, and 6.3.1-8. This option may not
require subscription relocation either.
This alternative allows user profiles centralization, although in a
multivendor deployment it will require integration of the non-standard Ud
interface with the HSS in the Combined HSS/UDM.
Figure 6.3.1-7: Coexistence of existing HSS and Combined HSS/UDM using a
common repository
Figure 6.3.1-8: Coexistence of existing HSS and Combined HSS/UDM using a
common repository - Including MAP access
### 6.3.3 Services and Illustrated Procedures
The interactions between UDM and HSS within the Combined network entity are
internal, so it is not required to define such interworking.
### 6.3.4 Impacts on existing services and interfaces
This solution has no impact on existing services and interfaces.
### 6.3.5 Evaluation
Solution 3 proposes a coexistence scenario where a Combined HSS/UDM network
entity serving 5G enabled users can coexist without interaction with any
existing HSS supporting EPC and IMS for 4G only users. Since there is no
interaction needed between UDM and the existing HSS out of the Combined
entity, this solution does not require any standardization effort.
Additionally, this solution avoids any impact on existing nodes (HSS, EPS
UDR), services, protocols and interfaces. Some options require migration of
subscriber data.
For IMS and EPC services, the solution requires the use of a routing solution
which can be based on standard functions (e.g. DRA/SLF) and it is normally
deployed in the operator\'s network for different purposes.
In case of coexistence with 2G/3G networks (including support for MAP based
SMS use cases) is required, the routing solution is also required to route MAP
requests to either the Combined HSS/UDM for 5G enabled users or the existing
HSS for non 5G enabled users.
Impacts are limited to provisioning/configuration updates for the routing
function to route Diameter EPC/IMS requests and/or MAP requests to either the
Combined HSS/UDM for 5G enabled users or the existing HSS for non 5G enabled
users.
This solution offers different UDR deployment alternatives, from which option
1 as described previously is considered the option providing the most future
proof benefits in terms of centralization/consolidation of subscription data
for 5G enabled users, management of subscription data, multivendor support and
network evolution.
However, an operator may find among the different alternatives proposed the
option that fits better its network evolution plans, based on the current
deployment and evaluation of the aspects the operator considers as most
relevant.
# 7 Conclusions
It is concluded that normative work, as specified in the present document and
TS 29.563 [20], proceeds based on solution defined in clause 6.1 as normative
optional feature, both stage 2 and stage 3 for deployments in which upgrading
legacy systems to service based architectures is a feasible/acceptable option
for the network operator.
Solutions defined in clauses 6.2 and 6.3 are concluded as
implementation/deployment options with no need of normative work for scenarios
where migration of subscription data or upgrades of legacy systems are not
possible/feasible.
#
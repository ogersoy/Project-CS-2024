# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The objective of this Technical Report is to study and perform an evaluation
of potential architecture enhancements for supporting URLLC services in 5G
System (5GS). Specifically, the following aspects are covered:
\- Investigate the key issues for meeting the URLLC requirements on latency,
jitter and reliability in 5G System as defined in TS 22.261 [5].
\- Study how to minimize the impacts of UE mobility to the latency and jitter
between AN and CN, and within CN.
\- Study how to realize transmission with reliability higher than the
reliabilities of single user plane tunnel of N3 and N9 and NFs in the user
plane path.
\- Study how to monitor the QoS of the QoS flow with URLLC requirement.
\- Study potential impacts to charging and policy control.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
> [1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
>
> [2] 3GPP TS 23.501: \"System Architecture for the 5G System\".
>
> [3] 3GPP TS 23.502: \"Procedures for the 5G System\".
>
> [4] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G
> System\".
>
> [5] 3GPP TS 22.261: \"Service requirements for the 5G system\".
>
> [6] IEEE 802.1CB-2017: IEEE Standard for Local and metropolitan area
> networks--Frame Replication and Elimination for Reliability,
> https://ieeexplore.ieee.org/document/8091139/.
>
> [7] 3GPP TS 37.340: \"Evolved Universal Terrestrial Radio Access (E-UTRA)
> and NR; Multi-connectivity\".
>
> [8] ETSI GS MEC 003: \"Mobile Edge Computing (MEC); Framework and Reference
> Architecture\".
>
> [9] draft-ietf-detnet-architecture-06 (June 2018): \"Deterministic
> Networking Architecture\".
>
> [10] IEEE 802.1Q: \"IEEE Standard for Local and metropolitan area networks
> -- Bridges and Bridged Networks\".
>
> [11] 3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description; Stage 2\".
>
> [12] 3GPP TS 38.420: \"NG-RAN; Xn general aspects and principles\".
>
> [13] 3GPP TS 38.415: \"NG-RAN; PDU Session User Plane protocol\".
>
> [14] 3GPP TS 23.734: \"Study on 5GS Enhanced support of Vertical and LAN
> Services\".
>
> [15] 3GPP TS 28.552: \"Management and orchestration; 5G performance
> measurements\".
>
> [16] 3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to
> support network data analytics services\".
>
> [17] 3GPP TS 29.281: \"General Packet Radio System (GPRS) Tunnelling
> Protocol User Plane (GTPv1-U)\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
C-TAG Customer VLAN Tag
CU Central Unit
DC Dual Connectivity
DU Distributed Unit
EDT Early Data Transmission
FRER Frame Replication and Elimination for Reliability
GARP Gratuitous ARP
HRP High Reliability Protocol
LLC Low Latency Communication
MCG Master Cell Group
MgNB Master gNB
MO Mobile Originated
M-RAN Master RAN
MT Mobile Terminated
NDP Neighbor Discovery Protocol
NRG Network Reliability Group
PDB Packet Delay Budget
PDCP Packet Data Convergence Protocol
QMP QoS Monitoring Packet
RFSP RAT/Frequency Selection Priority
RG Reliability Group
RHF Redundancy Handling Function
RNA RAN Notification Area
RSN Redundancy Sequence Number
RTT Round-trip Time
SCG Secondary Cell Group
SgNB Secondary gNB
S-RAN Secondary RAN
S-TAG Service VLAN Tag
STP Spanning Tree Protocol
TSN Time Sensitive Network
URLLC Ultra-Reliable and Low Latency Communication
URR Usage Reporting
# 4 Architecture Assumptions
The following architectural assumptions are applicable for all potential
solutions:
1) The 5GS defined in TS 23.501 [2] is used as the baseline network
architecture for URLLC.
2) For QoS flows with low latency requirement, at least one user plane path
between the application and UE that be able to satisfy the requirement for
latency should exist in the network.
3) For QoS flows with ultra-high reliability requirement, there is no
assumption on whether each NF or connection segment is able to meet the
reliability requirements.
NOTE 1: For some QoS flows, there might be only one of the requirements on low
latency and high reliability.
NOTE 2: Interworking between 5GS and EPS is out of scope in this study.
# 5 Key Issues
## 5.1 Key Issue #1: Supporting high reliability by redundant transmission in
user plane
### 5.1.1 General description
In order to ensure the high reliability which can hardly be achieved by single
path on user plane, redundant transmission in 5GS may be supported. Depending
on the condition of network deployment, e.g., which NFs or segments cannot
meet the requirements of reliability, the redundant transmission may be
applied on the user plane path between the UE and the network. The following
aspects need to be studied for this key issue:
\- How to establish, modify or release multiple tunnels for redundant data
transmission on N3 and N9.
\- How to support handover procedure for PDU session using redundant
transmission.
\- How to ensure the multiple tunnels on N3, N6 and N9 for redundant
transmission to be transferred over separate transport layer paths in case
single transport layer path cannot support the reliability requirements.
\- How to make decision on enabling redundant transmission or not for a
specific QoS flow.
\- How to replicate the data packets in UE/RAN/UPF, when needed.
NOTE: This does not intend to study mechanism on air interface.
\- How to eliminate the replicates received from different paths in
UE/RAN/UPF, when needed.
\- Identify the impact to protocol stack of user plane to support redundant
transmission.
## 5.2 Key Issue #2: Supporting low latency and low jitter during handover
procedure
### 5.2.1 General description
In current handover procedure defined in TS 23.502 [3], for the QoS flow that
requires lossless handover, the direct /indirect data forwarding tunnel is
used to forward packets from the source RAN node to the target RAN node. This
forwarding tunnel introduces additional latency and jitter within RAN and CN.
Furthermore, if no forwarding tunnel is used, the DL path will be interrupted
during HO execution until the establishment of GTP-U tunnel towards the target
RAN node finished.
The optimization of handover procedure need to be considered to guarantee low
latency and low jitter to the URLLC services. In this key issue, the following
aspects will be studied:
\- How to fulfil URLLC requirement during UE handover procedure.
## 5.3 Key Issue #3: Enhancement of Session Continuity during UE Mobility
### 5.3.1 General Description
This key issue focuses on enhancing session continuity while maintaining UP
efficiency. The follow problems are to be studied.
\- How to enable runtime coordination between AF and 5GC for supporting
application relocation without breaking upper layer session and service
continuity.
When application relocates to a new DNAI, N6 connection is re-established with
the new DNAI. To support upper layer session and service continuity,
application traffic should be routed over the new N6 connection only after it
is fully ready. This requires the 5GC to know when the end of N6 connection in
the DN is ready before it switches to the new N6 connection. In Rel-15, such
runtime coordination is not supported yet.
\- How to handle ULCL relocation or PSA relocation (for SSC mode 3) for URLLC
services, and how the traffic routing on N6 interface is fulfilled are FFS.
NOTE: The solutions to this key issue should reuse, if possible, functions of
the 5GC developed in Rel-15.
## 5.4 Key Issue #4: QoS Monitoring to Assist URLLC Service
### 5.4.1 General description
For URLLC services, E2E stringent QoS requirements include very low latency
and very high reliability. This poses some challenges to the 5G System as
several factors could affect the E2E QoS performance such as wireless
coverage, 3GPP network node (UPF/RAN/UE) resources, and transport network.
The current 5GS QoS Notification Control is supported in 5G-AN to monitor the
GBR QoS flow status in the 5G-AN. This mechanism only supports GFBR monitoring
may not be sufficient for E2E URLLC services where packet latency, jitter,
packet loss parameters are the key requirements.
In order to achieve requirements of URLLC services, the following aspects
should be studied:
\- Study solutions for the specific UE with URLLC services to improve the
monitoring of QoS, such as packet delay, jitter and packet error rate to
assist to achieve URLLC services and identify the relevant NF(s) and entities
(e.g. 5GC, third party AF).
\- Study means to better control the monitoring of QoS for URLLC e.g. means
whether or not to trigger the above solution(s). If triggered, how to use the
exposed QoS monitoring result to fulfil the QoS requirement of the URLLC
service when the threshold that required QoS of URLLC services will not be
satisfied is reached.
## 5.5 Key Issue #5: Supporting low latency without requiring that the UE to
always be in RRC_Connected Mode
### 5.5.1 General description
To efficient support event driven low latency scenarios, this key issue shall
study ways to reduce usage of network radio resources and power consumption in
the UE. This key issue shall include scenarios when the UE is able to avoid
Connected Mode between low latency data transmissions. The specific areas we
need to study is when:
\- the UE transitioning from RRC_Inactive Mode to RRC_Connected Mode under an
NG RAN node that is different from the NG RAN node storing the UE context
within the same RAN Notification Area (RNA).
NOTE: Dependent of the solution, the main work is expected to be done in RAN
WG but in this study the 5GC may need to indicate to RAN that this is an LLC
PDU Session to allow RAN to handle it accordingly.
## 5.6 Key Issue #6: Division of E2E PDB
### 5.6.1 Description
E2E PDB is composed of AN part delay and CN part delay. In Relâ€‘15, the PDB
received by NG-RAN is the end-to-end delay (from UE to anchor UPF), and there
are notes under the table in clause 5.7.4 in TS 23.501 [2], which clarify the
RAN can assume CN PDBs are fixed for different 5QIs.
In different deployments, the delay between RAN nodes and PSA UPFs can be
different. Currently the PDB is not considering the deployment variety. The
key issue investigates if and how to flexibly differentiate CN PDB subtraction
towards different PSA UPFs (e.g. DNs).
## 5.7 Key Issue #7: Automatic GBR service recovery after handover
### 5.7.1 General description
When a machine needs a Guaranteed Bit Rate service, it is likely to need that
quality level in order to do its job. Hence if the QoS level cannot be
maintained (e.g. handover into a congested cell; temporary cell overload due
to higher priority services; etc), the QoS level should be restored as soon as
possible, and, without a storm of signalling messages.
Release 15 5GC has partially solved this issue by introducing a
\"notification\" mechanism that allows the core network to request the RAN to
not release the radio bearer/QoS Flow when the QoS guarantee cannot be met,
but, instead to notify the Core Network when the QoS drops, AND, when the RAN
has restored the QoS level. This allows the controller of the machine (e.g.
car/train) to adapt its behaviour (e.g. reduce speed) and ensures that the RAN
continues to try to restore the QoS level while the device is in that cell.
However, at Xn or N2 handover, the target RAN node applies admission control
and if it cannot support the required GBR QoS, the target RAN node does not
establish that QoS Flow. In such a case, if, e.g. due to movement of the UE,
the source RAN node has no choice but to handover to that target RAN node,
then the target RAN node will complete the handover but will NOT notify the CN
if and when the GBR QoS can be supplied to that UE.
As the machine needs to have its GBR service restored as soon as possible, the
CN needs to repeatedly attempt to re-establish the GBR service. These re-
attempts involve a considerable number of signalling messages, and are sent
without any awareness of RAN congestion or potential link quality.
This is an inadequate solution for any mobile \"non-human device\" that needs
to maintain a GBR data link during mobility (e.g. a car, a train, robots
moving around a factory).
# 6 Solutions
## 6.1 Solution #1 for Key Issue #1: Redundant user plane paths based on dual
connectivity
### 6.1.1 Description
The solution will enable a terminal device to set up two redundant PDU
Sessions over the 5G network, so that the network will attempt to make the
paths of the two redundant PDU sessions independent whenever that is possible.
It is out of scope of this specific 3GPP solution to how to make use of the
duplicate paths for redundant traffic delivery end-to-end. It is possible to
rely on upper layer protocols, such as the IEEE TSN (Time Sensitive
Networking) FRER (Frame Replication and Elimination for Reliability), to
manage the replication and elimination of redundant packets/frames over the
duplicate paths which can span both the 3GPP segments and possibly fixed
network segments as well. Refer to Annex A for more details on how the IEEE
TSN solution can make use of two independent networking paths. Other upper
layer protocols, including IP based ones such as a DetNet based solution as
described in Annex B, can also be possible for redundant packet transmission
over multiple paths or for managing a backup path in addition to the active
path.
The overall solution is shown in the Figure below. The 3GPP network provides
two paths from the device: the first PDU Session spans from the UE via gNB1 to
UPF1 acting as the PDU Session Anchor, and the second PDU Session spans from
the UE via gNB2 to UPF2 acting as the PDU Session Anchor. Based on these two
independent PDU Sessions, two independent paths are set up, which may span
even beyond the 3GPP network. In the example shown in the Figure below, we
have two paths set up between Host A in the device and Host B, with some
(optional) fixed intermediate nodes. The Redundancy Handling Function, RHF
entities (out of 3GPP scope) that reside in Host A and Host B make use of the
independent paths. The IEEE TSN FRER mentioned above is an example for a RHF.
For Host A within the device, the two PDU Sessions appear as different
networking interfaces, making the host multi-homed. Note that in the network
side, other solutions are also possible, where redundancy spans only up to an
intermediate node and not to the endhost.
Figure 6.1.1-1: High level architecture with single device
This solution is based on the Dual Connectivity feature that is supported both
by LTE and NR. The Figure 6.1.1-2 below illustrates the architecture view of
the solution. A single UE has user plane connectivity with both a Master gNB
(MgNB) and a Secondary gNB (SgNB). The RAN control plane and N1 are handled
via the MgNB. The MgNB controls the selection of SgNB and the setup of the
dual connectivity feature via the Xn interface. The UE sets up two PDU
Sessions, one via MgNB to UPF1 acting as the PDU Session anchor, and another
one via SgNB to UPF2 acting as the PDU session anchor. UPF1 and UPF2 connect
to the same Data Network (DN), even though the traffic via UPF1 and UPF2 might
be routed via different user plane nodes within the DN. UPF1 and UPF2 are
controlled by SMF1 and SMF2, respectively, where SMF1 and SMF2 may coincide
depending on operator configuration of the SMF selection. (Other 3GPP entities
not relevant for this solution are not shown in the figure).
Figure 6.1.1-2: Solution architecture
The solution differs from the RAN based PDCP packet duplication function (see
TS 38.300 [11] clause 16.1.3) which is internal to RAN, and the packet
duplication takes place between the UE and the MgNB. In this solution, the
redundant paths span the whole system including RAN, CN, and can possibly
extend to Data Network beyond 3GPP scope as well.
The solution has a number of assumptions to be applicable.
\- RAN supports dual connectivity, and RAN coverage is sufficient for dual
connectivity in the target area.
\- UEs support dual connectivity.
\- The core network UPF deployment is aligned with RAN deployment and supports
redundant user plane paths.
\- The underlying transport topology is aligned with the RAN and UPF
deployment and supports redundant user plane paths.
\- The physical network topology and geographical distribution of functions
also supports the redundant user plane paths to the extent deemed necessary by
the operator.
\- The operation of the redundant user plane paths is made sufficiently
independent, to the extent deemed necessary by the operator, e.g., independent
power supplies.
NOTE 1: The redundant network deployment aspects mentioned above are within
the responsibility of the operator and are not subject to 3GPP
standardization.
Two options are provided for the selection of the UPFs and the gNBs. A static
approach for UPF selection that takes place before the SgNB is selected in
RAN; this is applicable to both IP based and Ethernet based PDU sessions. In
addition, a dynamic approach for UPF selection, which enhances the Static
approach taking into account the SgNB selected in RAN - this is applicable to
Ethernet PDU Sessions.
The solution is illustrated showing two SMFs, though the solution is also
applicable using single SMF. The solution does not affect SMF selection, and
the solution can be applied no matter whether the same or different SMFs are
chosen, even though the existing mechanisms based on the DNN or S-NSSAI may be
used to influence whether different SMFs are selected or whether the same SMF
is selected. In case of two SMFs are used, the SMFs are aware the sessions are
redundant (two distinct sessions). In case of multiple SMFs are used, the SMFs
are configured to have different UPF pool in order to avoid reuse of same UPF
by different SMFs.
SMF(s) are aware of redundant sessions based on a new indication, Redundancy
Sequence Number (RSN) provided by the UE in the PDU Session Establishment
Request message. The presence of the RSN indicates redundant handling, and the
value of the RSN indicates whether the first or the second PDU session is
being established. As a fallback solution when the RSN is not provided by the
UE, the SMF may also use the DNN or the S-NSSAI in combination with operator
configuration to determine whether the first or second PDU session is being
established for redundancy. The SMF uses the knowledge about whether the first
or second PDU session is being established in combination with proper
provisioning during UPF selection.
**Static approach:**
This applies to both IP and Ethernet PDU sessions. The solution is illustrated
in the Figure below:
Figure 6.1.1-3: Static UPF selection
\- The UPF selection is based on existing mechanisms, with the extension that
it is known in the SMF, based on UE indication of the RSN or network
configuration based on the DNN or S-NSSAI, whether the UE is establishing the
first or second PDU session. This information may be used as an input to the
UPF selection.
\- When the PDU Sessions are established, it is explicitly requested that RAN
handles the first PDU Session at the MgNB and the second PDU Session at the
SgNB using dual connectivity.
\- Initially, the two PDU Sessions use the same MgNB, but as soon as dual
connectivity is set up in RAN, the second PDU Session\'s user plane connection
is moved to the SgNB, and the user plane tunnelling is switched to go via the
SgNB.
**Dynamic approach:**
This applies to Ethernet PDU Sessions. The solution is illustrated in the
Figure below:
Figure 6.1.1-4: Dynamic UPF Selection: anchor change after DC setup for
Ethernet PDU Sessions
\- UPF selection for the first PDU Session and initial UPF selection for the
second PDU session is based on existing mechanisms as described above for the
Static approach.
\- When dual connectivity is established and the SgNB is added in RAN for the
second PDU Session, this may result in a change in the UPF acting as the PSA,
using Solution #11 described in clause 6.11 on Anchor change for Ethernet PDU
Sessions.
The solution takes the following main steps.
\- The UE requests the establishment of a first and a second PDU Session. The
UE also indicates the RSN in the PDU Session Establishment Request message;
alternatively the UE uses different DNN and/or S-NSSAIs for the PDU Sessions
so that the SMF can determine, considering operator configuration, whether the
first or second PDU session is established.
\- The SMF determines that the PDU Session establishment is for a redundant
PDU Session. This determination may be based on the RSN indication from the
UE, or it may be based on network configuration considering the DNN or the
S-NSSAI.
\- UPF selection can take into account the identity of the MgNB and also the
information about whether the first or second PDU session is being established
for redundancy for a given UE. The proper operator configuration of the UPF
selection can ensure that the UPF selected for the first and second PDU
Session are different, and that they are selected close to the MgNB. It is up
to operator configuration to consider the independence of the paths also in
the transport network.
\- While the PDU Sessions are being established, dual connectivity handling of
these PDU Sessions is not yet set up in RAN. When the two redundant PDU
Sessions are initially established, both PDU Sessions go via the MgNB. The
second PDU Session will be handed over to SgNB when the dual connectivity
handling in RAN can be established.
\- To enable a UE to send and receive frames with the same MAC address but
different VLAN IDs in different PDU sessions to the same DNN, e.g. to allow
for Redundancy Handling Functions like IEEE 802.1CB [6] (FRER) to ensure
separate paths by means of IEEE 802.1Q [10] the following applies:
\- In configurations where more than one PDU Session to the same DNN (e.g. for
more than one UE) corresponds to the same N6 interface (see TS 23.501 [2]
clause 5.16.10.2), the UPF acting as PDU session anchor (PSA) learns MAC
addresses and VLAN IDs (S-TAG VID field and/or C-TAG VID fields depending on
which tags are present in the frame) used by a UE in UL direction and uses the
combination of VLAN ID and MAC address to determine the target PDU session for
downlink switching of Ethernet frames;
\- MAC address reporting mechanism from UPF to SMF and SMF to PCF/BSF is
enhanced to also report VLAN IDs used by the UE to support session binding in
presence of Ethernet frames tagged using IEEE 802.1Q [10];
\- The MgNB is informed by the SMF about the two PDU Sessions which need to be
handled redundantly using the RSN. The SMF determines the RSN either based on
the UE indication, or based on the DNN/S-NSSAI settings considering operator
configuration. The SMF then provides the RSN to RAN via the AMF at user plane
establishment for the PDU session. RSN=1 indicates that the given session is
requested to be handled by the MgNB; RSN=2 indicates that the given session is
requested to be handled by the SgNB. When there is at least one session with
RSN=1 and at least one session with RSN=2 indicates to RAN that CN is
requesting dual connectivity to be set up with the RSN=1 session(s) handled by
MgNB and RSN=2 session(s) handled by SgNB. Based on the RSN indication, the
MgNB sets up dual connectivity in such a way that both the MgNB and the SgNB
have an independent PDCP entity for handling the two independent user plane
paths (i.e. setup of MCG bearer and SCG bearer for MgNB and SgNB,
respectively). The second PDU Session\'s user plane is switched to the SgNB,
and in this way both the RAN node and the UPF can be different for the two
redundant PDU Sessions.
NOTE 2: The decision to set up dual connectivity remains in RAN as defined
today. RAN takes into account the additional request for the dual connectivity
setup provided by the CN.
NOTE 3: There may also be other sessions for which redundancy is not applied
and for which RSN is not set; RAN can select on its own whether those sessions
are handled by MgNB or SgNB (or both), as today. Use of RSN values 1 and 2
also allows indication of which PDU Session is handled by MgNB and which is
handled by SgNB.
\- In the case of Ethernet PDU Sessions, the SMF has the possibility to change
the UPF (acting as the PSA) and select a new UPF based on the identity of the
SgNB for the second PDU Session in case the SgNB is modified (or
added/released) while the PDU Session remains established, according to
Solution #11 described in clause 6.11. This makes it possible to dynamically
select the UPF close to the SgNB for the second PDU Session, and in that way
further optimize the second PDU Sessions UPF selection.
\- The SMF sends the RSN to the PCF as part of the session parameters. This
allows the PCF to configure different policy or charging rules for the two
redundant PDU sessions.
Regarding the mobility handling of the solution, it is important to separate
the case whether mobility takes place below an unchanged PSA (PDU Session
Anchor), or whether mobility involves the change of the PSA as well.
\- Mobility below unchanged PSA. This is supported by the solution; mobility
below the PSA is hidden from external mechanisms handling the multiple end to
end paths. Note however that handovers may introduce interruptions (though RAN
mechanisms may reduce such interruptions). In case the SgNB is changed but the
MgNB remains unchanged, the path via the MgNB remains uninterrupted though.
Note also that the handovers may also lead to a change in the end to end
delay.
\- Mobility involving change of the PSA. This is the case with SSC mode 2 or
SSC mode 3 procedures, or a change of the PSA for Ethernet PDU Sessions. A
change of the PSA is possible, but we note that external mechanisms for
setting up redundant paths, such as IEEE TSN FRER described in Annex A, would
need to support the change of the PSA as well. Based on current IEEE TSN FRER
specifications, support of PSA change is possible as long as the necessary
configuration (such as VLAN configuration and resource reservation) along the
new path is ensured.
### 6.1.2 Procedures
The setup of the two PDU Sessions and the subsequent establishment of dual
connectivity takes place as follows in the static approach.
Figure 6.1.2-1: Procedure based on static approach
1\. PDU Session 1 is established according to TS 23.502 [3] clause 4.3.2.2.
SMF1 determines based on the RSN provided by the UE, or based on the DNN or
S-NSSAI and corresponding network configuration that the PDU Session is to be
handled redundantly and this is the first PDU Session. SMF1 selects UPF1,
where SMF1 may take into account in the selection that the current RAN node is
MgNB and this is the first PDU session in the redundant handling. An
indication is sent to RAN that this PDU Session is the first in the redundant
handling that is requesting dual connectivity.
2\. Similarly, PDU Session 2 is established according to TS 23.502 [3] clause
4.3.2.2. SMF2 determines based on the RSN provided by the UE, or based on the
DNN or S-NSSAI and corresponding network configuration that the PDU Session is
to be handled redundantly and this is the second PDU session. SMF2 selects
UPF2, where SMF2 may take into account in the selection that the current RAN
node is MgNB and this is the second PDU session in the redundant handling. An
indication is sent to RAN that this PDU Session is the second in the redundant
handling that is requesting dual connectivity.
After step 2, the user plane of both PDU sessions still go via MgNB.
3\. If feasible based on RAN conditions as evaluated by the MgNB, dual
connectivity is established in RAN according to TS 37.340 [7], clause 10.2.2.
RAN should observe the requests sent in steps 1 and 2 and set up dual
connectivity in such a way that the user plane of PDU Session 2 will be
handled in SgNB as a SCG bearer, while the user plane of PDU Session 1 will be
handled in the MgNB as a MCG bearer. As part of the dual connectivity setup,
data forwarding can be started from MgNB to SgNB for the data of PDU Session
2.
If dual connectivity is not possible to be set up in RAN as requested by the
CN, then an appropriate indication is sent from RAN for both PDU Sessions via
the AMF to the appropriate SMFs. The SMFs may decide whether to release the
given PDU Sessions.
4\. The user plane path of PDU Session 2 is switched from MgNB to SgNB
according to TS 23.502 [3] clause 4.9.1.2.2.
As a result, the user plane of PDU Session 1 and PDU Session 2 now take
independent paths both in RAN and in the CN.
The dynamic approach for Ethernet PDU Sessions is illustrated in the figure
below.
Figure 6.1.2-2: Procedure based on dynamic approach
Steps 1-3 are as described above for the static approach.
4\. Path switch is performed in combination with an anchor change for PDU
Session 2, which is performed according to the Anchor change for Ethernet PDU
Sessions solution described in clause 6.11.
### 6.1.3 Impacts on Existing Nodes and Functionality
SMF impacts:
\- Determine, based on the UE indication of the RSN or based on the DNN or
S-NSSAI and corresponding network configuration, whether a PDU session is to
be handled redundantly.
\- Select UPF based on the identity of the MgNB and whether it is the first
and second PDU session.
\- Report not only MAC addresses but also VLAN IDs used by a UE from SMF to
PCF;
UPF impacts:
\- Support VLAN ID and MAC address learning in case of configurations and uses
the combination of VLAN ID and MAC address to determine the target PDU session
for downlink switching of Ethernet frames for configurations where more than
one PDU Session to the same DNN (e.g. for more than one UE) corresponds to the
same N6 interface (see TS 23.501 [2], clause 5.16.10.2).
\- Report not only MAC addresses but also VLAN IDs used by a UE in UL frames
to SMF.
PCF/BSF impacts:
\- Support session binding based on MAC address and VLAN ID.
RAN impacts:
\- Attempt to establish and maintain dual connectivity when the need for
redundant user planes are indicated for a pair of PDU Sessions.
\- Set up dual connectivity in such a way that both the MgNB and the SgNB have
an independent PDCP entity for handling the two independent user plane paths.
AMF impacts:
\- Forward the relevant indications between RAN and SMF.
UE impacts:
\- Based on device configuration, trigger the setup of redundant PDU Session,
with RSN or DNN/S-NSSAI setting indicating the need for redundant handling.
\- An upper layer solution for the handling of the duplicate redundant paths
with a corresponding configuration mechanism, both are out of 3GPP scope.
Additionally, UE configuration mechanisms may be applied to trigger the
establishment of duplicate PDU Sessions.
### 6.1.4 Solution Evaluation
\- The solution can provide disjoint redundant user plane paths through the
3GPP system including RAN and CN.
\- The solution uses IEEE FRER on upper layer between UE and DN.
\- The solution does not impact the application itself, as replication can be
performed by a networking protocol such as IEEE TSN FRER (see Annex A) which
operates at an intermediate Ethernet switch or at the Ethernet layer of the
endhost. Other protocols for replication are also applicable, such as DetNet
(see Annex B) or proprietary protocols.
\- The solution can be integrated with end to end redundancy solutions.
\- The solution can provide the same level of redundancy as typically applied
for fixed industrial deployments today.
\- The solution requires already existing dual connectivity feature to be
available.
\- By reusing existing DC principle it is easy to deploy in the networks and
terminals.
\- The solution extends the dual connectivity by a CN trigger to request dual
connectivity setup on a per session basis.
\- The solution uses a single UE in the terminal, hence it does not provide
redundant UEs.
## 6.2 Solution #2 for Key Issue #1: Multiple UEs per device for user plane
redundancy
### 6.2.1 Description
The solution will enable a terminal device to set up multiple redundant PDU
Sessions over the 5G network, so that the network will attempt to make the
paths of the multiple redundant PDU sessions independent whenever that is
possible. It is out of scope of this specific 3GPP solution to how to make use
of the multiple paths for redundant traffic delivery end-to-end. It is
possible to rely on upper layer protocols, such as the IEEE TSN (Time
Sensitive Networking), to manage the replication and elimination of redundant
packets/frames over the multiple paths which can span both the 3GPP segments
and possibly fixed network segments as well. Refer to Annex A for more details
on how the IEEE TSN solution can make use of the independent networking paths.
Other upper layer protocols, including IP based ones such as a DetNet based
solution as described in Annex B, can also be possible for redundant packet
transmission over multiple paths or for managing a backup path in addition to
the active path.
The solution is shown in the Figure below for the case when the terminal
device is equipped with two UEs. The first PDU Session spans from the UE1 via
gNB1 to UPF1, while the second PDU Session spans from the UE2 via gNB2 to
UPF2. Based on these two independent PDU Sessions, two independent paths are
set up, which may span even beyond the 3GPP network. In the example shown in
the Figure below, we have two paths set up between Host A in the device and
Host B, with some (optional) fixed intermediate nodes. The Redundancy Handling
Function, RHF entities (out of 3GPP scope) that reside in Host A and Host B
make use of the independent paths. The IEEE TSN FRER mentioned above is an
example for a RHF. For Host A within the device, the two UEs provide different
networking interfaces, making the host redundantly connected. Note that in the
network side, other solutions are also possible, where redundancy spans only
up to an intermediate node and not to the endhost.
Figure 6.2.1-1: Solution architecture with two UEs in a host
This solution makes use of the integration of multiple UEs into the device,
and assumes a RAN deployment where redundant coverage by multiple gNBs is
generally available. Multiple PDU Sessions are set up from the UEs, which use
independent RAN (gNB) and CN (UPF) entities. The Figure 6.2.1-2 below
illustrates the architecture view of the solution. UE1 and UE2 are connected
to gNB1 and gNB2, respectively and UE1 sets up a PDU Session via gNB1 to UPF1,
and UE2 sets up a PDU Session via gNB2 to UPF2. UPF1 and UPF2 connect to the
same Data Network (DN), even though the traffic via UPF1 and UPF2 might be
routed via different user plane nodes within the DN. UPF1 and UPF2 are
controlled by SMF1 and SMF2, respectively. (Other 3GPP entities not relevant
for this solution are not shown in the figure).
Figure 6.2.1-2: Solution architecture mapped into 3GPP
The solution has a number of assumptions to be applicable.
The solution uses separate gNBs to achieve user plane redundancy over the 3GPP
system. It is however up to operator deployment and configuration whether
separate gNBs are available and used. If separate gNBs are not available for a
device, the solution may still be applied to provide user plane redundancy in
the rest of the network as well as between the device and the gNB using
multiple UEs.
\- Terminal devices integrate multiple UEs which can connect to different gNBs
independently.
\- RAN coverage is redundant in the target area: it is possible to connect to
multiple gNBs from the same location. To ensure that the two UEs connect to
different gNBs, the gNBs need to operate such that the selection of gNBs can
be distinct from each other (e.g. gNBs operating in different frequencies
etc.).
\- The core network UPF deployment is aligned with RAN deployment and supports
redundant user plane paths.
\- The underlying transport topology is aligned with the RAN and UPF
deployment and supports redundant user plane paths.
\- The physical network topology and geographical distribution of functions
also supports the redundant user plane paths to the extent deemed necessary by
the operator.
\- The operation of the redundant user plane paths is made sufficiently
independent, to the extent deemed necessary by the operator, e.g., independent
power supplies.
NOTE 1: The redundant network deployment aspects mentioned above are within
the responsibility of the operator and are not subject to 3GPP
standardization.
The solution comprises the following main components.
\- gNB selection: The selection of different gNBs for the UEs in the same
device is realized by defining UE Reliability Groups (RG) for the UEs and also
for the cells of gNBs. By grouping the UEs in the device and cells of gNBs in
the network into more than one reliability group and preferably selecting
cells in the same reliability group as the UE, it is ensured that UEs in the
same device can be assigned different gNBs for redundancy as illustrated in
Figure 6.2.1-3 below, where UE1 and the cells of gNB1 belong to reliability
group A, and UE2 and the cells of gNB2 belong to reliability group B.
Figure 6.2.1-3: Reliability group-based redundancy concept in RAN
For determining the reliability grouping of a UE, one of the following methods
or a combination of them can be used:
\- It could be configured explicitly to the UE and sent in a Registration
Request message to the network using an existing parameter (such as an S-NSSAI
in the Requested NSSAI where the SST is URLLC) or a new parameter.
\- It could be part of the subscription.
\- It could also be derived from other system parameters (e.g., SUPI, PEI,
S-NSSAI, RFSP) based on operator configuration.
The Reliability Group of each UE is sent from AMF to RAN when the RAN context
is established, and maintained as part of the RAN context, so each gNB has
knowledge about the reliability group of the connected UEs.
NOTE 2: Whether the UE RG parameter sent to RAN is defined as a new parameter
or encoded into the already existing RFSP parameter can be determined as part
of stage 3 work.
The reliability group of the RAN (cells of gNBs) entities are pre-configured
by the O&M system in RAN. It is possible for gNBs to learn the reliability
group neighbouring cells as the Xn connectivity is set up.
In the case of connected mode mobility, the serving gNB down-prioritizes
candidate target cells that belong to different reliability group than the UE.
It follows that normally the UE is handed over only to cells in the same
reliability group. If cells in the same reliability group are not available
(UE is out of the coverage of cells of its own reliability group or link
quality is below a given threshold) the UE may be handed over to a cell in
another reliability group as well.
In case the UE connects to a cell in the wrong reliability group, the gNB
initiates a handover to a cell in the appropriate reliability group whenever
such a suitable cell is available.
If redundant RAN coverage is available at a certain location, then UEs that
belong to the same terminal device will connect to different gNBs based on the
reliability group classification using the connected mode mobility scheme
described above.
If no cells in the same reliability group as the UE is available, then the UE
may connect to a cell in another RGs.
\- Selection of different UPFs for the individual UEs within the device.
Existing mechanisms can be used to select different UPFs for the two UEs. The
selection may be based either on UE configuration or network configuration of
different DNNs, or different slices for the two UEs. Optionally, it may also
be possible to use the UE\'s RG, described above, as an input to the UPF
selection.
\- The solution may also apply different control plane entities for the
individual UEs within the device, even though this is optional and not
necessary for the key issue. This may be achieved by using:
\- different (possibly decorated) DNNs for the individual UEs within the
device to select different SMFs,
\- or applying different slices for the individual UEs within the device
either based on UE configuration or network subscription, to select different
AMFs and/or SMFs,
\- or selecting different PLMNs (within single Operator) for the individual
UEs within the device. As operators may have limited possibilities for
assigning new PLMN numbers, this case may be difficult to apply in practice.
Should an operator deploy networks with multiple PLMN numbers, it is up to
current PLMN selection mechanisms to manage UE mobility and coordinated PLMN
selection in such deployments. The solution does not introduce new mechanisms
for the handling of such deployments. Current described solution is based on
both PDU sessions by the two UEs belonging to single PLMN and operator`s
network configuration ensuring that the two UEs select two different entities
in the network.
\- To enable a UE to send and receive frames with the same MAC address but
different VLAN IDs in different PDU sessions to the same DNN, e.g. to allow
for Redundancy Handling Functions like IEEE 802.1CB [6] (FRER) to ensure
separate paths by means of IEEE 802.1Q [10] the following applies:
\- in configurations where more than one PDU Session to the same DNN (e.g. for
more than one UE) corresponds to the same N6 interface (see TS 23.501 [2]
clause 5.16.10.2), the UPF acting as PDU session anchor (PSA) learns MAC
addresses and VLAN IDs (S-TAG VID field and/or C-TAG VID fields depending on
which tags are present in the frame) used by a UE in UL direction and uses the
combination of VLAN ID(s) and MAC address to determine the target PDU session
for downlink switching of Ethernet frames;
\- MAC address reporting mechanism from UPF to SMF and SMF to PCF/BSF is
enhanced to also report VLAN IDs used by the UE to support session binding in
presence of Ethernet frames tagged using IEEE 802.1Q [10];
\- The UEs belonging to the same terminal device request the establishment of
PDU Sessions that use independent RAN and CN network resources using the
mechanisms outlined above.
\- The proper operator configuration of the UPF selection can ensure that the
path of the PDU Sessions of UE1 and UE2 are independent.
Regarding mobility handling of the multiple UEs, the solution defined in
Solution #14 to Key Issue#2 achieves co-ordination of the handovers of the UEs
so that packet losses during handover can be avoided.
Regarding the mobility handling, it is important to separate the case whether
mobility takes place below an unchanged PSA (PDU Session Anchor), or whether
mobility involves the change of the PSA as well.
â€¢ Mobility below unchanged PSA. This is supported by the solution; mobility
below the PSA is hidden from external mechanisms handling the multiple end to
end paths. Note that handovers may lead to a change in the end to end delay.
â€¢ Mobility involving change of the PSA. This is the case with SSC mode 2 or
SSC mode 3 procedures, or a change of the PSA for Ethernet PDU Sessions. A
change of the PSA is possible, but we note that external mechanisms for
setting up redundant paths, such as IEEE TSN FRER described in Annex A, would
need to support the change of the PSA as well. Based on current IEEE TSN FRER
specifications, support of PSA change is possible as long as the necessary
configuration (such as VLAN configuration and resource reservation) along the
new path is ensured.
### 6.2.2 Procedures
\- The UE can optionally provide its UE RG (Reliability Group) in the
Registration Request message, either using a newly defined parameter, or using
an existing parameter such as an S-NSSAI of the Requested NSSAI.
\- The UE RG may also be part of the subscription.
\- Based on the combination of the above information and possible local
configuration, the AMF determines the UE RG and stores it in the UE Context.
\- When the UE transitions to connected state, the UE RG is sent to RAN and
will be maintained in the RAN context of the UE.
RAN has its own RAN RG parameter configured into the gNBs on a per cell basis.
gNBs may be pre-configured with the RAN RG parameter of the neighbouring cells
or may learn that information.
The RAN connected mode mobility handling is extended as follows.
\- RAN node down-prioritizes handover targets for a UE to cells whose RG is
different from the UE RG.
\- In case the UE connects to a cell in the wrong reliability group (i.e., UE
RG is different from the RAN RG), the gNB initiates a handover to the
appropriate reliability group when a suitable gNB is available as a handover
target.
In case of an idle UE, it is possible to use the existing cell (re-)selection
priority mechanism, with a priori UE config using dedicated signalling (in the
_RRCConnectionRelease_ message during transition from connected to idle mode)
to configure the UE to reselect the cells of the appropriate reliability group
for camping in deployments where the cell reliability groups use different
sets of frequencies.
Existing mechanisms are used select different UPFs for the two UEs. The
selection may be based either on UE configuration or network configuration of
different DNNs, or different slices for the two UEs. Optionally, it may also
be possible to use the UE\'s RG as an input to the UPF selection.
The solution may be realized with or without standards changes to the
signalling messages.
\- With standards changes, using new parameters. The following are added to
existing signalling messages.
\- A new parameter, UE RG, is added to the Registration Request message to
indicate the UE\'s configured Reliability Group.
\- The UE RG may also be part of the subscription.
\- The UE RG, as determined by the AMF from the UE indication and possibly
other information such as subscription or local configuration, is conveyed
from the AMF to the SMF in the Nsmf_PDUSession_Create_SMContext Request when
the PDU Session is established so that the SMF can consider the information
for UPF selection.
\- The UE RG, as determined by the AMF, is sent to the RAN node when the RAN
context is established during transition to connected mode.
\- Without standards changes, using existing parameters.
\- The UE\'s RG is set per the S-NSSAI, e.g. decided by the SD part, which is
conveyed from the UE to the AMF, and is used for SMF selection, and also
conveyed from the AMF to the SMF and is used for UPF selection.
\- The UE\'s Allowed NSSAI is used as input to select the RFSP index value for
the UE. The RAN node uses the RFSP for RRM purposes and can based on local
configuration determine the UE\'s RG based on the S-NSSAI in Allowed NSSAI
and/or S-NSSAI for the PDU Session(s).
The benefit of avoiding standards changes is easier deployment. The benefit of
adding standards changes is easier network operation (because we do not
overload a single parameter with multiple meanings, creating a configuration
burden), and better scalability (because a single parameter carrying multiple
meanings may have a lot more values to interpret).
### 6.2.3 Impacts on Existing Nodes and Functionality
SMF impacts:
\- Determine, based on a combination of UE and network information, which PDU
sessions to handle redundantly.
\- Select UPF such that user plane redundancy is achieved.
\- Report not only MAC addresses but also VLAN IDs used by a UE from SMF to
PCF;
UPF impacts:
\- Support VLAN ID and MAC address learning in case of configurations and uses
the combination of VLAN ID and MAC address to determine the target PDU session
for downlink switching of Ethernet frames for configurations where more than
one PDU Session to the same DNN (e.g. for more than one UE) corresponds to the
same N6 interface (see TS 23.501 [2] clause 5.16.10.2).
\- Report not only MAC addresses but also VLAN IDs used by a UE in UL frames
to SMF.
PCF/BSF impacts:
\- Support session binding based on MAC address and VLAN ID.
RAN impacts:
\- O&M configuration of the RAN RGs on a per cell level.
\- Prioritization of the handover of the UE to a cell whose RAN RG coincides
with the UE RG, when such a suitable target cell is available.
Subscription impacts:
\- In case such a new parameter is defined include the UE RG parameter.
AMF impacts:
\- In case new parameters are defined, forward the relevant indications
between RAN and SMF.
\- Determine the UE RG to be sent to RAN (using new or existing parameter)
based on one or more of UE indication, subscription information or local
configuration based on other information elements.
UE impacts:
\- Support of multiple UEs per device.
\- Optional configuration of the UE RG for the UEs in the device.
\- An upper layer solution for the handling of the multiple paths with a
corresponding configuration mechanism, both are out of 3GPP scope.
Additionally, UE configuration mechanisms may be applied to set the UE
identification and trigger the establishment of the redundant PDU Sessions.
### 6.2.4 Solution Evaluation
\- The solution can provide disjoint redundant user plane paths through the
3GPP system including RAN and CN.
\- The solution depends on IEEE FRER on upper layer between UE and DN.
\- The solution can provide the same level of redundancy as typically applied
for fixed industrial deployments today.
\- If desired by the operator, the solution can also be used for redundant
control plane handling.
\- The solution uses multiple UEs in the terminal, hence it also provides
redundant UEs.
\- The solution requires device manufacturers to integrate multiple UEs.
## 6.3 Solution #3 for Key Issue #1: Supporting redundant data transmission
via single UPF and two RAN nodes
### 6.3.1 Description
This solution addresses the KI#1 of How to \"Supporting high reliability by
redundant transmission in user plane\".
This solution focuses on how to realize the reliability of user plane between
UPF and UE. For control plane network functions, the existing network device
failure recovery mechanisms, e.g. N+1 resilience, should be enough to fulfil
the high reliability requirements on control plane. Though the failover may
cause a very short interrupt (typically on xx ms level), but this control
plane failover will not impact the traffic routing on user plane.
Typically telecom-level equipments are able to provide up to five-nine
reliability. However, in many cases the end-to-end reliability of real
deployed network might be lower than that considering the susceptible
deployment environments, especially in the last-mile.
To realize ultra-high reliability for URLLC services in the commercial
deployed network, this solution proposes to use redundant transmission over
different physical transport paths in CN and RAN to enhance the reliability of
upper layer service.
Whether redundant transmission need to be activated for a QoS Flow can be
decided by the SMF based on local policies for the DNN and/or S-NSSAI, or by
the PCF based on its QoS requirement, UE\'s subscription and condition of
network deployment.
Editor\'s note: It is FFS whether and how to coordinate with other redundancy
mechanisms if such mechanisms were used in DN.
Editor\'s note: It is FFS how the UE becomes aware which flows redundancy
should be applied to.
In this solution, it is assumed that the reliability of UPF and CP NFs are
high enough to fulfill the reliability requirement of URLLC services served by
these NFs, and the UE is under overlapping coverage of the two RAN nodes. The
reliabilities of these NFs can be realized based on implementation (e.g.
redundant mechanisms provided by NFV platform), which is out of scope of this
solution. However a single RAN node cannot provide enough reliability in air
interface for the QoS flow, so the redundant packets will be transferred
between UPF and UE via two independent N3 tunnel and two RAN nodes to enhance
the reliability of service.
To ensure the two N3 tunnels can be transferred via disjointed transport layer
paths, the M-RAN (Master RAN) node, SMF or UPF may provide different routing
information in the tunnel information (e.g. different IP addresses or
different Network Instances), and these routing information will be mapped to
disjoint transport layer paths according to network deployment configuration.
The redundant transmission is based on the DC architecture, except that same
PDU is transferred via both M-RAN and S-RAN (Secondary RAN) nodes. With two
different NG-RAN nodes, separate transport layer paths are used for redundant
data transmission in user plane.
Figure 6.3.1-1: Redundant transmission with two N3 tunnels between a UPF and
two NG-RAN nodes
Figure 6.3.1-2: Redundant transmission with two N3 and N9 tunnels between a
UPF and two NG-RAN nodes
In deployments where the M-RAN/S-RAN needs to connect to the anchor UPF via
intermediate UPF nodes, one or two Intermediate UPFs (I-UPFs) may be inserted
between the anchor UPF and the M-RAN/S-RAN nodes separately to support the
redundant transmission with one or two N3 and N9 tunnels, as shown in figure
6.3.1-2.
NOTE 1: The I-UPFs on the leg of the redundant paths shall not behave in an UL
CL or Branching Point role anymore.
For DL traffic, without changing sequence number in GTP-U packet, the two
I-UPFs receive the traffic duplicated by the anchor UPF via N9 tunnels and
without any further duplication forward them to the M-RAN and S-RAN via N3
tunnels separately. In case of UL traffic, by keeping sequence number in GTP-U
packet unchanged, the two I-UPFs without any further duplication forward the
traffic received from the M-RAN and S-RAN via N3 tunnels to the anchor UPF via
N9 tunnels separately.
Figure 6.3.1-3: Redundant transmission with two NG-RAN nodes in HR roaming
scenario
As shown in figure 6.3.1-3, in home routed roaming scenario, the M-RAN/S-RAN
nodes are connected to the anchor UPF in the HPLMN via two intermediate UPF
nodes in the VPLMN separately to support redundant transmission with two N3
and N9 tunnels. The V-SMF selects the two intermediate UPFs and setup the
redundant transmission tunnels on N3 and N9 in case it receive two CN tunnel
info for a URLLC QoS flow from H-SMF.
NOTE 2: Supporting the above HR redundant transmission requests two disjointed
transport paths exist between the two I-UPFs and PSA UPF.
### 6.3.1a User Plane Protocol Stack options
#### 6.3.1a.1 Option 1: Enhancement of PDCP and GTP-U protocols
In this option, PDCP protocol and GTP-U protocol are enhanced to support
packet replication and elimination function.
Figure 6.3.1a.1-1: User Plane Protocol Stack - Option1
In this option, it is required there is only one QoS Flow per DRB.
Editor\'s note: It is FFS how the limitation of one QoS flow per DRB is known
and enforced in RAN. It is FFS whether the limitation of one QoS flow per DRB
imply also a limitation on the number of QoS flows, and if so, how is that
limitation known in the core network?
In this option, for DL traffic, the UPF replicates the packet received from
the DN and includes the same sequence number in GTP-U headers of the
replicates for the redundant transmission. When the M-RAN and S-RAN receive
the packets from UPF, they set the DL PDCP sequence number of the PDCP packet
according to the sequence number in the GTP-U headers received from UPF. With
that, the two PDCP packets that UE received from M-RAN and S-RAN carries same
PDCP sequence number, so that the UE can eliminate the duplicated packets at
PDCP layer based on the PDCP sequence number.
NOTE: The detail of how to map SNs between GTP-U and PDCP packets can be
decided in stage 3. Each QoS Flow have an individual GTP-U SN space. One
possible way is to reuse GTP-U extension header \"PDCP PDU number\" together
with QFI to directly carry the PDCP sequence number per QoS Flow in the GTP-U
packet.
For UL traffic, the UE replicates the packet and assigns the same PDCP
sequence number to them for the redundant transmission. One of these packets
is transmitted to the M-RAN, and the other to the S-RAN. The sequence number
in GTP-U header for the packet sent to the UPF is assigned by the M-RAN and
S-RAN based on the PDCP sequence number received from UE. The UPF eliminates
the duplicated packets at GTP-U layer based on the sequence number in GTP-U
header.
#### 6.3.1a.2 Option2: HRP protocol layer
In this option, a HRP (High Reliability Protocol) layer is implemented on the
UE and UPF to support packet replication and elimination function.
Figure 6.3.1a.2-1: User Plane Protocol Stack - Option2
In this option, for DL traffic, the UPF replicates the DL packet and assigns
the same HRP sequence number to them for the redundant transmission. When the
UE receives the replicates from M-RAN and S-RAN, it eliminates the duplicated
packets at HRP layer based on the HRP sequence number.
For UL traffic, the UE replicates the packet and assigns the same HRP sequence
number to them for the redundant transmission. The UPF eliminates the
duplicated packets at HRP layer based on the HRP sequence number.
NOTE: In this option, the HRP layer may cause additional delay for internal
handlings within UE and UPF.
### 6.3.2 Procedures
#### 6.3.2.1 Activate Redundant Transmission during PDU Session Establishment
procedure
The redundant transmission will be established during a PDU Session
establishment procedure or a PDU Session Modification procedure.
Figure 6.3.2.1-1 depicts the establishment of redundant transmission during
the PDU session establishment procedure in the non-roaming and roaming with
local breakout cases.
Figure 6.3.2.1-1: Activate Redundant Transmission during PDU Session
Establishment procedure
1\. Steps 1-12 from clause 4.3.2.2.1(UE requested PDU Session Establishment)
in TS 23.502 [3] are performed with the following differences:
In step 7b, the PCF indicates the SMF and the NG-RAN to activate redundant
transmission for the QoS flow by the 5QI if the UE requested PDU Session
Establishment procedure is initiated for a URLLC service.
In step 10, the SMF then initiates an N4 Session Establishment procedure with
the selected UPF and CN Tunnel Info 1& CN Tunnel Info 2 are allocated by the
SMF or UPF.
In step 11, the N2 SM information includes the QFI(s), QoS Profile(s), CN
Tunnel Info 1& CN Tunnel Info 2 corresponding to each N3 tunnel.
2\. RRC Connection Reconfiguration takes place with the UE establishing the
necessary NG-RAN resources related to the QoS Rules for the PDU Session
request. The Secondary NG-RAN node Addition procedure is performed as defined
in TS 37.340 [7].
3\. Steps 14-20 from clause 4.3.2.2.1(UE requested PDU Session Establishment)
in TS 23.502 [3] are performed with the following differences:
The AN Tunnel Info provided by the NG-RAN includes AN Tunnel Info 1 and AN
Tunnel Info 2. Each AN Tunnel Info includes a tunnel endpoint for each
involved NG-RAN node, and the QFIs assigned to each tunnel endpoint. The M-RAN
node assigns the appropriate CN tunnel information to each of the NG-RAN
nodes.
The SMF provides AN Tunnel Info 1 and AN Tunnel Info 2 to the UPF as well as
the corresponding forwarding rules. The forwarding rules indicates the UPF to
replicate the downlink packets and send each replicate via one of DL N3
tunnels separately to NG-RAN, and eliminate the duplicate uplink packets
received from the two UL N3 tunnels.
During the course of PDU Session Establishment procedure, in case N2 PDU
Session Request message contains one CN Tunnel Info, based on radio resource,
wireless conditions or local policy, if the NG-RAN may determine to send N2
PDU Session Failure Response to the SMF via the AMF with the cause indicating
redundant transmission establishment. Considering it, the SMF may initiates
redundant transmission with two CN Tunnel Info, or the SMF may report
subscribed event to the PCF, it is up to the PCF to determine whether
redundant transmission needs to be activated.
NOTE: The above mechanism may apply to PDU Session Modification and mobility
procedure.
Editor\'s note: whether the NG-RAN can trigger the 5GC to initiate redundant
transmission is FFS.
#### 6.3.2.2 Activate Redundant Transmission during PDU Session Modification
procedure
Figure 6.3.2.2-1 depicts the establishment of redundant transmission during
the UE or network requested PDU session modification procedure in the non-
roaming and roaming with local breakout cases.
Figure 6.3.2.2-1: Activate Redundant Transmission during PDU Session
Modification procedure
1\. Steps 1-4 from clause 4.3.3.2 (UE or network requested PDU Session
Modification) in TS 23.502 [3] are performed with the following differences:
The PDU Session Modification procedure is triggered by the UE or the SMF to
add a QoS flow for a URLLC service.
In step 1b or step 2, the PCF indicates the SMF to activate redundant
transmission for the QoS flow by the 5QI.
The SMF initiates an N4 Session modification procedure with the UPF and a new
CN Tunnel for redundant transmission may be allocated by the SMF or UPF.
In step 4, the N2 SM information includes the QFI(s), QoS Profile(s) for each
N3 tunnel, and the CN Tunnel Info corresponding to the new N3 tunnel.
2\. RRC Connection Reconfiguration takes place with the UE establishing the
necessary NG-RAN resources related to the QoS Rules for the PDU Session
request. The Secondary NG-RAN node Addition procedure can be performed as
defined in TS 37.340 [7].
3\. Steps 6-12 from clause 4.3.3.2 (UE or network requested PDU Session
Modification) in TS 23.502 [3] are performed with the following differences:
The AN Tunnel Info for the redundant transmission is provided by the NG-RAN.
The AN Tunnel Info includes a tunnel endpoint for the NG-RAN node used for
redundant transmission, and the QFIs assigned to the tunnel endpoint.
The SMF provides AN Tunnel Info to the UPF as well as the corresponding
forwarding rules. The forwarding rules indicates the UPF to replicate the
downlink packets and send each replicate via one of DL N3 tunnels separately
to NG-RAN, and eliminate the duplicate uplink packets received from the two UL
N3 tunnels.
#### 6.3.2.3 Handover procedure
In this solution, the UE can connect to two NG-RAN nodes simultaneously when
redundant transmission is used. Either the M-RAN node or the S-RAN node may
perform handover at a time.
In the case that the S-RAN node handover, the M-RAN Node will initiates a
Secondary Node Change procedure as defined in TS 37.340 [7]. The transmission
between UE and UPF via M-RAN node will not be impacted during the handover
procedure.
In the case that the M-RAN node handover, the Master Node handover without
Secondary Node change procedure will be applied as defined in TS 37.340 [7].
The transmission between UE and UPF via S-RAN node will not be impacted during
the handover procedure.
In the case that both M-RAN node and S-RAN node handover, it follows the
procedures defined in TS 37.340 [7].
### 6.3.3 Impacts on Existing Nodes and Functionality
PCF:
\- The PCF can determine whether redundant transmission needs to be activated
for a QoS Flow based on its QoS requirement, UE\'s subscription and condition
of network deployment.
AMF:
\- No impact in this solution.
SMF:
\- The SMF can determine whether redundant transmission needs to be activated
for a QoS Flow based on local policies for the DNN and/or S-NSSAI.
\- In case the SMF allocates CN Tunnel Info, it shall provide the CN Tunnel
Info for two tunnels of the redundant transmission paths.
\- The SMF shall indicate the UPF to replicate the downlink packet and send
the duplicate packets to the two N3 tunnels, and indicate the UPF to eliminate
the duplicate uplink packets.
UPF:
\- In case the UPF allocates CN Tunnel Info, it shall provide the CN Tunnel
Info for two tunnels of the redundant transmission paths.
\- The UPF shall be able to replicate the downlink packet and send the
duplicate packets to the two N3 tunnels, and eliminate the duplicate uplink
packets, based on either sequence numbering in GTP-U header (option 1) or a
new protocol (option 2).
RAN:
\- The RAN node shall support redundant transmission via DC architecture with
two N3 tunnels.
\- In case protocol stack option 1 is adopted, RAN need to ensure there is
only one QoS Flow per DRB, and map or reuse PDCP SN and sequence number in
GTP-U header.
\- RAN needs to be able to combine dual connectivity setup with the
establishment or modification of radio bearers within the session management
procedures.
UE:
\- The UE shall be able to replicate the uplink packets and eliminate the
downlink packets for a URLLC service.
\- The UE can determine whether to replicate the uplink packets for a QoS Flow
based on its QoS profile.
\- In case of option 1, UE needs to support a new variant of PDCP replication
and elimination compared to the existing RAN PDCP duplication mechanism.
\- In case of option 2, UE needs to support a new protocol for replication and
elimination.
### 6.3.4 Solution Evaluation
This solution provides high reliability transporting mechanism by performing
redundant transmission between Anchor UPF and UE via disjointed CN tunnels and
two different RAN nodes. The solution has the following properties:
\- The solution provides the same level of redundancy on the air interface as
the existing PDCP packet duplication function in Rel-15 (see TS 38.300 [11]
clause 16.1.3).
\- The solution avoids the MgNB being a single point of failure in the user
plane.
\- UPF is a single point of failure in the user plane. In case of UPF failure,
the session is completely lost.
\- The operator can control the activation of redundant transmission or not by
PCC mechanism.
\- This solution has no dependency on the protocol used in application layer,
which is out of control of the operator.
\- The redundant transmission can be activated on demand per QoS Flow but
limits to single QoS Flow per DRB.
\- Current existing PDU session/QoS Flow management mechanisms are reused in
this solution with limited extensions shown in 6.3.3. No further impact on
existing CN control plane mechanisms, however RAN is impacted by the need to
be able to combine dual connectivity setup with the establishment or
modification of radio bearers within the session management procedures.
\- If protocol stack option 1 is adopted, there is no additional replication
protocol defined for the UE. If protocol stack option 2 is adopted, there is
no additional replication protocol functionality for the RAN node. But
interactions with existing Rel-16 RAN PDCP duplication is not investigated
yet.
## 6.4 Solution #4 for Key Issue #1: Supporting redundant data transmission
via single UPF and single RAN node
### 6.4.1 Description
This solution addresses the KI#1 of How to \"Supporting high reliability by
redundant transmission in user plane\". It focuses on the redundant
transmission between RAN and UPF.
In this solution, it is assumed that the reliability of NG-RAN node, UPF and
CP NFs are high enough to fulfil the reliability requirement of URLLC services
served by these NFs. The reliabilities of these NFs can be realized based on
implementation (e.g. redundant mechanisms provided by NFV platform), which is
out of scope of this solution. However, the reliability of single N3 tunnel is
considered not high enough, e.g. due to the deployment environment of backhaul
network, so the redundant packets will be transferred between UPF and RAN via
two independent N3 tunnels, which are associated with a single PDU Session,
over different transport layer path to enhance the reliability of service.
To ensure the two N3 tunnels can be transferred via disjointed transport layer
paths, the NG-RAN node, SMF or UPF will provide different routing information
in the tunnel information (e.g. different IP addresses or different Network
Instances), and these routing information will be mapped to disjoint transport
layer paths according to network deployment configuration.
This solution supports the redundant transmission based on two N3 tunnels
between a single NG-RAN mode and the UPF. The RAN node and UPF shall support
the packet replication and elimination function.
Figure 6.4.1-1: Redundant transmission with two N3 tunnels between the UPF and
a single NG-RAN node
Packet replication and elimination can be realized by modifying the GTP-U
protocol. In case of DL traffic, the UPF replicates the packet from the DN and
assigns the same GTP-U sequence number to them for the redundant transmission.
These packets are transmitted to the NG-RAN via the N3 Tunnel 1 and the N3
Tunnel 2 separately. In order to eliminate the duplicated packet, the NG-RAN
forwards the packet received first from either tunnel to the UE and drops the
replicated packet which has the same GTP-U sequence number as the forwarded
packet.
In case of UL traffic, the NG-RAN replicates the packet and assigns the same
GTP-U sequence number to them and the UPF eliminates the duplicated packet
based on the GTP-U sequence number.
One of the N3 Tunnels is determined as main transport path during the GTP-U
tunnel establishment. For those QoS Flows of the same PDU session that don\'t
need redundant transmission, this main N3 Tunnel is used.
NOTE 1: The RAN node capability to support the solution can be configured in
the SMF per network slice or per SMF service area.
The solution can be extended by inserting two Intermediate UPFs (I-UPFs)
between the UPF acting as the PDU Session Anchor and the NG-RAN to support the
redundant transmission based on two N3 and N9 tunnels between a single NG-RAN
mode and the UPF. The RAN node and UPF shall support the packet replication
and elimination function.
Figure 6.4.1-2 Two N3 and N9 tunnels between NG-RAN and UPF for redundant
transmission
In figure 6.4.1.2, there are two N3 and N9 tunnels between NG-RAN and UPF for
redundant transmission. The UPF interfacing the DN and acting as the Traffic
Distributor for DL traffic duplicates the packet of the URLLC service from the
DN and assigns the same GTP-U sequence number to them. These duplicated
packets are transmitted to I-UPF1 and I-UPF2 via N9 Tunnel 1 and N9 Tunnel 2
separately. Each I-UPF forwards the packet with the same GTP-U sequence number
which receives from the UPF to NG-RAN via N3 Tunnel 1 and N3 Tunnel 2
respectively. The NG-RAN eliminates the duplicated packet based on the GTP-U
sequence number. In case of UL traffic, the NG-RAN acting as the Traffic
Distributer for UL traffic duplicates the packet of the URLLC service for the
UE and the UPF eliminates the duplicated packet.
NOTE 2: The I-UPFs inserted on one leg of the redundant paths shall not behave
in an UL CL or Branching Point role.
Figure 6.4.1-3: Redundant transmission with one NG-RAN node in HR roaming
scenario
As shown in figure 6.4.1-3, in home routed roaming scenario, the NG RAN node
is connected to the anchor UPF in the HPLMN via an intermediate UPF node in
the VPLMN to support redundant transmission with two N3 and N9 tunnels. The
V-SMF selects the two intermediate UPFs and setup the redundant transmission
tunnels on N3 and N9 in case it receive two CN tunnel info for a URLLC QoS
flow from H-SMF.
NOTE 3: Supporting the above HR redundant transmission requests two disjointed
transport paths exist between I-UPF and PSA UPF.
### 6.4.2 Procedures
The Procedures for activate redundant transmission during PDU session
establishment/modification are same as corresponding procedures shown in
clause 6.3.2 except for both of two AN tunnels are terminated on M-RAN nodes
and S-RAN node addition is not needed.
The handover procedures in this solution can refer to the handover procedures
defined in TS 23.502 [3]. The only difference is that the NG RAN node shall
provide the CN with the AN Tunnel Info for the two N3 tunnels and the CN will
also provide the NG RAN node with the CN Tunnel Info for the two N3 tunnels.
### 6.4.3 Impacts on Existing Nodes and Functionality
PCF:
\- The PCF can determine whether redundant transmission need to be activate
for a QoS Flow based on its QoS requirement, UE\'s subscription and condition
of network deployment.
AMF:
\- No impact in this solution.
SMF:
\- The SMF can determine whether redundant transmission need to be activated
for a QoS Flow based on local policies for the DNN or S-NSSAI.
\- In case the SMF allocates CN Tunnel Info, it shall provide the CN Tunnel
Info for two tunnels of the redundant transmission paths.
\- The SMF shall indicate the UPF to replicate the downlink packet and send
the duplicate packets to the two N3 tunnels, and indicate the UPF to eliminate
the duplicate uplink packets.
UPF:
\- In case the UPF allocates CN Tunnel Info, it shall provide the CN Tunnel
Info for two tunnels of the redundant transmission paths.
\- The UPF shall be able to replicate the downlink packet and send the
duplicate packets to the two N3 tunnels, and eliminate the duplicate uplink
packets.
RAN:
\- The RAN shall be able to replicate the uplink packet and send the duplicate
packets to the two N3 tunnels, and eliminate the duplicate downlink packets.
UE:
\- No impact in this solution.
### 6.4.4 Solution Evaluation
This solution provides high reliability transporting mechanism by performing
redundant transmission between Anchor UPF and RAN node via disjointed CN
tunnels. The solution has the following properties:
\- The operator can control the activation of redundant transmission or not by
PCC mechanism.
\- Use of certain transport network (e.g. TSN) in the backhaul (i.e. over
N3/N9) can address this issue.
\- The solution provides a 3GPP solution for setting up redundant paths on N3
in case transport layer cannot meet the reliability requirement.
\- The UPF is a single point of failure in the user plane. In case of UPF
failure, the session is lost.
\- This solution has no dependency on the protocol used in application layer,
which is out of control of the operator.
\- The redundant transmission can be activated on demand per QoS Flow.
\- Current existing PDU session/QoS Flow management mechanisms are reused in
this solution with limited extensions shown in 6.4.3. No further impact on
existing control plane mechanisms.
\- No impact on air interface and UE.
## 6.5 Solution #5 for Key Issue #2: Duplication of user plane tunnelling
during HO
### 6.5.1 Functional Description
This solution addresses Key Issue#2 (supporting low latency and low jitter
during HO). The basic idea is that the user plane tunnel will be established
and used to transmit data as long as the DRB is established during handover
procedure, which is called \"enhanced handover\", so as to avoid the
additional latency and jitter brought by data forwarding and/or data path
switch on CN side.
The \"enhanced handover\" is defined per [S-NSSAI, DNN]. It can be dynamically
provisioned to SMF from UDM or PCF during PDU session procedure, or statically
preconfigured in SMF. Then SMF determines if apply this \"enhanced handover\"
for each PDU session and store the association of the \"enhanced handover\"
and PDU session id.
When handover is triggered by source RAN node, the SMF will duplicate the
tunnel for the PDU session which is associated to \"enhanced handover\", and
send the downlink data to both source and target RAN node until the handover
is completed.
NOTE: This solution needs to be checked with RAN2/RAN3 before final
conclusion.
### 6.5.2 Procedures
#### 6.5.2.1 PDU session establishment or modification
Figure 6.5.2.1-1: PDU session establishment or modification for \"enhanced
handover\" provisioning
In step3, based on the \"enhanced handover\" policy provided from PCF or
static policy stored in SMF, the SMF determines if the PDU session should be
applied for \"enhanced handover\" and store the association between PDU
session id and \"enhanced handover\" indication.
NOTE: The SMF may add an indicator to the PDU Session create/update message
sent from SMF to RAN to indicate if the PDU session data needs data forwarding
when handover happens.
#### 6.5.2.2 Enhanced N2 based Handover
Figure 6.5.2.2-1: Enhanced N2 based handover
The procedure reuse existing N2 based handover, with the following
characteristics:
1\. The UL/DL SN mapping relation between PDCP and GTP-U can be used for
redundancy elimination, and if so the source RAN node needs to add the mapping
relation when sending handover required and it is forwarded to target RAN node
in step-5.
3\. During session modification, the SMF establish the secondary tunnel for
PDU sessions marked as \"enhanced handover\" which sharing the same IP address
with the original tunnel within the same PDU session.
11\. When the secondary tunnel is finished (after step-8), the UPF begins to
duplicate the downlink data and send to both source and target RAN node
simultaneously. An indication can be included in the GTP-U header of the first
duplicated packet to the source RAN to indicate the start of duplicated
transmission. After receiving the indication, the source RAN will trigger
handover command.
12a. The source RAN will send handover command to UE once it receives the
indication for the start of redundant transmission and finishes the
transmission of the packets received before the indication.
12b. Before the target DRBs are not established, the target RAN node cache the
downlink data from UPF. As long as the target DRBs are established, the UL and
DL data transmission will be performed.
13\. As long as the DRBs in target RAN node are established, UE will transmit
the UL and DL data via target RAN node before the handover procedure is
totally finished (UE sending handover complete). In dual radio based handover
case, the UE will transmit the data via source and target RAN nodes
simultaneously before the handover procedure is totally finished.
UE performs the redundancy elimination of DL data from source and/or target
RAN node using the DL PDCP SN for URLLC QoS flow. UPF performs the redundancy
elimination of UL data from RAN node using the GTP-U SN for URLLC QoS flow.
NOTE 1: It is assumed there is a 1 to 1 mapping between DRB and URLLC QoS
flow. The size of GTP-U SN and the size of PDCP SN are aligned.
NOTE 2: Since there may be a few UL/DL of packets transmitted between the HO
triggering and target N3 tunnel established, the SN value will be increased
comparing to the SN value when triggering HO, so the target RAN node needs to
derive the DL PDCP SN and/or UL GTP-U SN value for the packets transmitted in
the target path.
15-16: When receiving handover notify, the core network release the tunnel in
source RAN side.
#### 6.5.2.3 Enhanced Handover with Xn
Figure 6.5.2.3-1: Enhanced handover with Xn
The procedure reuse existing Xn based handover, with the following new
features.
1-2. When the handover in radio interface is ongoing, the source RAN node
sends N2 message for handover to SMF to establish the secondary tunnel in
target side for the PDU session. The step 2 will be triggered during the
handover procedure in radio interface.
If SMF determines an intermediate UPF (I-UPF) is needed in the secondary
tunnel, then, SMF selects an intermediate UPF (I-UPF) to update PDU session.
The UL/DL SN mapping relation between PDCP and GTP-U can be used for the
redundancy elimination, and if so the source RAN node needs to tell the target
RAN node the mapping relation via Xn in step 1 (e.g. in handover request).
3\. When the secondary tunnel is finished (after step-2b), the UPF begin to
send duplicate the downlink data and send to both source and target RAN node
simultaneously. An indication can be included in the GTP-U header of the first
duplicated packet to the source RAN to indicate the start of duplicated
transmission. After receiving the indication, the source RAN will trigger Uu
handover.
In case of the I-UPF insertion, the UPF sends the downlink data to the target
RAN node via the I-UPF.
5\. Before the DRB is established, the target RAN node cache the downlink data
from UPF.
6\. As long as the DRBs in target Node are established, the target RAN node,
UE will transmit the UL and DL data via target RAN node before the handover
procedure is totally finished (UE sending handover complete). In dual radio
based handover case, the UE will transmit the data via source and target RAN
nodes simultaneously before the handover procedure is totally finished.
UE eliminates the redundancy of the DL data from both source and target RAN
node using the DL PDCP SN for URLLC QoS flow. UPF eliminates the redundancy of
the UL data from RAN node using the GTP-U SN for URLLC QoS flow.
NOTE 1: It is assumed there is a 1 to 1 mapping between DRB and URLLC QoS
flow. The size of GTP-U SN and the size of PDCP SN are aligned.
NOTE 2: Since there may have been a few UL/DL of packets transmitted between
the HO triggering and target N3 tunnel established, the SN value will be
increased comparing to the SN value when triggering HO, so the target RAN node
needs to derive the DL PDCP SN and/or UL GTP-U SN value for the packets
transmitted in the target path.
8-13. When receiving path switch request, the core network release the N3
tunnel to source RAN. The target RAN node triggers the release of resources
with the source RAN node if it confirms success of the handover by receiving
the path switch request ACK.
### 6.5.3 Impact on existing entities and interfaces
UE:
For duplicated transmission during HO,
\- if redundancy elimination is performed in application layer, UE shall
support this redundancy elimination in upper layer (out of 3GPP scope); or
\- if redundancy elimination is performed in 3GPP layer, UE shall eliminate
the DL data redundancy using the DL PDCP SN.
NG-RAN:
For the source RAN node:
\- If the packets redundancy elimination is performed in 3GPP layer, the
source RAN node needs to notify the target RAN node the UL/DL SN mapping
relation between PDCP and GTP-U.
\- The source RAN will send handover command to UE when it receives the
indication for the start of redundant transmission.
For the target RAN node:
\- If the packets redundancy elimination is performed in 3GPP layer, the
target RAN node needs to derive the UL GTP-U SN and DL PDCP SN based on the
mapping relation received from source RAN node;
\- Before the target DRBs are not established, the target RAN node cache the
downlink data from UPF. As long as the target DRBs are established, the UL and
DL data transmission will be performed.
SMF:
\- Determine which PDU session or flow needs the \"enhanced handover\".
\- During HO procedure preparation, the SMF establishes the target N3 tunnel
for PDU sessions marked as \"enhanced handover\" which sharing the same IP
address with the original tunnel within the same PDU session.
UPF:
\- When the target N3 tunnel is established, the UPF begins to duplicate the
downlink data and send to both source and target RAN node simultaneously.
\- UPF shall perform redundancy elimination of the UL data from RAN node using
the GTP-U SN for URLLC QoS flow.
### 6.5.4 Solution Evaluation
This solution is to avoid additional latency incurred by data forwarding via
Xn in case of handover scenario. With this enhancement, it helps to realize a
relatively stable e2e transmission time during UE mobility because the
additional latency due to data forwarding will be avoided. It has the
following advantages:
\- The procedure of this solution is decoupled to the RAN solution, i.e.
either existing handover or the enhanced handover (e.g. \"make before break\"
handover) in radio interface can be fitted into this solution.
\- The latency due to data forwarding will be avoided and the transmission
time will be stable even in case of UE mobility.
\- The existing N2 and Xn based handover procedure will be enhanced with
minimum impact to existing system.
\- For the method to performing redundant transmission, it follows the same
method as the agreement for KI#1.
\- The duplication of user plane tunneling to avoid data forwarding latency is
determined in operator\'s network based on existing parameters e.g. S-NSSAI
and/or DNN.
## 6.6 Solution #6 for Key Issue #3: Forwarding tunnel between source and
target UL CL
### 6.6.1 Description
Consider the architecture depicted in Figure 6.6.1-1. Initially UE is
connected to Source RAN (S-RAN) and has a PDU Session established with a
remote PDU Session Anchor (PSA1). The network has inserted an Uplink
Classifier (S-ULCL) that directs selected traffic to a local PDU Session
Anchor (PSA2). The traffic flows exchanged via PSA-2 are terminated in a
Source Application Server (S-AS) which is a user plane entity (e.g. content
distribution server) that is controlled by an AF via an interface that is
outside of 3GPP scope (e.g. ETSI MEC architecture as defined in ETSI ISG MEC
GS MEC-003 [8] is an example illustrating the split into a control and user
plane entity in the context of edge computing; other architectures are also
possible).
At some point UE is handed over to the Target RAN (T-RAN). This solution
proposes that upon instantiation of the Target Uplink Classifier (T-ULCL) a N9
forwarding tunnel is created between the Source Uplink Classifier (S-ULCL) and
the T-ULCL, as depicted in Figure 6.6.1-1.
Figure 6.6.1-1: Architecture with N9 forwarding tunnel between source and
target ULCL
The N9 forwarding tunnel is maintained until all active traffic flowing on it
ceases to exist for a configurable period of time.
T-ULCL is configured with packet filters that:
\- force uplink traffic from existing sessions (between UE and Source AS) on
the following path: T-RAN - T-ULCL - S-ULCL - PSA2. Similarly, S-ULCL is
configured to forward all downlink traffic for this UE coming from S-AS into
the N9 forwarding tunnel towards T-ULCL.
\- force any new DNS requests (relating to the local DN) to go to the new
local DN (via PSA3).
\- force any traffic related to the Target Application Server (T-AS) in the
new local DN (e.g. identified by a match between the destination IP address of
uplink packets and the IP address of T-AS) to go to the new local DN (via
PSA3).
\- let any remaining traffic go to the remote PDU Session Anchor (PSA1).
SMF may send a Late Notification to AF to inform it about the DNAI change
(i.e. change of local PSA). Based on this notification the AF triggers the
S-AS to use upper layer (e.g. IP level or HTTP level) mechanisms to redirect
the ongoing traffic sessions towards a server in the new local DN (i.e.
towards Target AS). If target AS, located in local data network, is associated
with local AF instance (called T-AF), then below steps are in response to Late
Notification from SMF to AF:
\- AF acknowledges receipt of late notification, and also provides N6 traffic
routing details (i.e. due to change to T-AS in local data network) and T-AF
identifier.
\- SMF/AF cancels earlier subscribed user plane management event
notifications.
\- SMF configures PSA-3 with received N6 traffic routing information.
\- T-AF subscribes to user plane management event notifications.
\- SMF sends late notification to T-AF, along with PSA-3 details and AF
request ID.
NOTE: Communication between AF and T-AF and AF behaviours on handling service
relocation are out of scope of this study.
### 6.6.2 Procedures
Depicted in Figure 6.6.2-1 is an example call flow illustrating how the
overall solution works.
Figure 6.6.2-1: Overall call flow
1\. At some point SMF decides to change the UL CL due to UE mobility. This may
be e.g. the AMF notifying the SMF that the target (R)AN has sent an N2 Path
Switch Request message to an AMF. The SMF selects a UPF and using N4
establishes the Target UL CL for the PDU Session and also establishes an N9
forwarding tunnel towards S-AS via the UPF acting as Source UL CL. SMF
provides the T-ULCL with the necessary uplink forwarding rules towards PSA1,
PSA3 and the N9 forwarding tunnel (i.e. towards S-ULCL), including the Tunnel
Info for each UPF. In addition, the AN Tunnel Info to target (R)AN is provided
to T-ULCL for downlink forwarding. The SMF provides traffic filters indicating
what traffic shall be forwarded towards PSA1, PSA3 and S-ULCL, respectively.
SMF provides the CN Tunnel Info to Source ULCL for downlink traffic. At this
point, the downlink traffic goes through S-ULCL, T-ULCL and Target (R)AN.
2\. The SMF updates (R)AN via N2 SM information over N11. It provides the new
CN Tunnel Info corresponding to the Target UL CL. At this point all uplink and
downlink traffic between UE and PSA2, as well as between UE and PSA1, is
forwarded via the N9 forwarding tunnel between S-ULCL and T-ULCL.
NOTE 1: Alternatively, an N9 interface can be established directly between UPF
acting as T-ULCL and PSA-2.
3\. The SMF updates the PSA1 via N4. It provides the PDU Session CN Tunnel
Info for the downlink traffic. At this point all uplink and downlink traffic
between UE and PSA1 are exchanged on the direct path between T-ULCL and PSA1.
NOTE 2: At this stage, the UPF acting as S-ULCL only acts as an intermediate
UPF.
4\. The SMF selects a local Target UPF (PSA3) and using N4 establishes the
local Target UPF for the PDU Session.
NOTE 3: In case the Target UL CL and the PSA3 are co-located in a single UPF
then step 4 is merged into step 1.
5\. The SMF sends a Late Notification to the AF indicating a change of DNAI
(i.e. a change of the local PSA). The message may optionally include an
identifier (IP address or FQDN) pointing to a Target AS. Alternatively the
target AS IP address can be configured at the AF and the AF can include T-AS
address using the Application Function influence on traffic routing described
in clause 4.3.6 in TS 23.502 [3], which help the SMF generate the routing rule
on the T-ULCL to PSA3 (i.e. towards target AS).
6\. The AF triggers S-AS to redirect the UE towards a Target AS using upper
layer (e.g. IP-level or HTTP-level) redirection mechanisms that are out of the
scope of 3GPP. The redirection may point to a specific Target AS as indicated
in step 5. Based on this redirection the UE starts using a new destination IP
address (with or without prior DNS resolution) which leads the T-ULCL to force
the traffic towards PSA3.
7\. Detection of no active traffic over the N9 forwarding tunnel during a
preconfigured time interval. The detection can be done by either S-ULCL or
T-ULCL, either of which can notify the SMF.
8\. The SMF releases the UPF acting as Source UL CL and the Source UPF (PSA2).
NOTE 4: As an alternative to the detection of no active traffic in step 7, the
AF can send an explicit notification to the SMF when traffic to/from this UE
ceases to exist, leading the SMF to release the Source UL CL and the Source
UPF (PSA2).
### 6.6.3 Impacts on Existing Nodes and Functionality
UPF is impacted so that the UL CL function needs to support temporary N9
tunnel forwarding to/from another UL CL, in addition to forwarding packets
to/from the local PSA and to/from the remote PSA.
### 6.6.4 Solution Evaluation
The solution primarily addresses an aspect of Key Issue #3 (\"How to handle
ULCL relocation ... for URLLC services, and how the traffic routing on N6
interface is fulfilled are FFS\").
While the study is carried out under the URLLC umbrella, the solution also
addresses an acknowledged issue with the ULCL relocation defined in Rel-15.
Namely, when the ULCL is relocated in the Rel-15 5GS architecture, the Stage 2
specifications do not provide any hint as to how service continuity is
provided in a seamless manner.
The solution relies on temporary tunnel forwarding from old ULCL to new ULCL
and on upper layer redirection. The UE is involved in the upper layer
redirection, but only at the \"upper layers\" that are outside 3GPP scope.
The solution applies to PDU Session of IP and Unstructured type.
\- for PDU Session of IP type the redirection can be performed e.g. using HTTP
redirect or via unspecified application-level redirection message triggered
from the old network server.
\- for PDU Session of Unstructured type the trailing forwarding tunnel
provided by this solution is useful for collecting the in-flight downlink data
that were directed to the old network server.
## 6.7 Solution #7 for Key Issue #1: Replication framework in 3GPP System
### 6.7.1 Description
This solution addresses the KI#1 of How to \"Supporting high reliability by
redundant transmission in user plane\".
This solution introduces a replicator that allows the 3GPP system to be aware
(e.g. detect or have explicit information) that two or more \"streams\" of
replicated packets belong together, and guide the lower layers to ensure these
packets get an optimized treatment in the 3GPP system depending on whether the
streams are terminated in a single UE or by two different UEs that belong
together within the same hub-solution (e.g. TSN hub with two or more redundant
5G modems). This is to specifically ensure that 3GPP features are used
optimally to ensure that latency/availability/reliability requirements and
expectations of external duplication methods are fulfilled (e.g. including
hybrid access solutions, IEEE 802.1CB, etc.). Additionally, the replicator is
applicable to any external multi-path mechanism even if the multiple paths are
not used in a redundancy fashion (i.e., duplicating each packet on all paths)
but for partly or fully disjoint data transmission.
Replicator functionality can be supported within the 5GS without making any
assumption on support for IEEE FRER in the application layer (DN only) at the
same time it can be introduced without much impact on the UE, UPF, NG-RAN
rather isolated to the replicator framework (e.g. it can be realized by
integrating IEEE FRER within the 3GPP system) that can be integrated within
3GPP system.
Replicator functionality within 3GPP system helps avoid blind replication
irrespective of the type of application. If the application does not support
replication of traffic stream but requires lowest latency and high
availability, replicator within 5GS can perform replication of the traffic
stream. If the application supports replication of traffic stream in order to
support lowest possible latency, replicator within 5GS can avoid further
replication of the traffic stream.
In short, the main principles of the solution are as follows:
1\. An entity/functionality in the 3GPP system, refer to it as replicator
functionality, is able to detect multiple related flows, and whether they are
utilized for redundant packets, of incoming IP/Ethernet flows at the
transmitter side. Control plane aspects necessary for the replicator
functionality resides in the SMF and the User plane aspects necessary for the
replicator functionality resides in the UPF and the NG-RAN.
2\. The replicator guides the lower layers to ensure their corresponding
latency/availability/reliability requirements are fulfilled.
> a. Case 1: Based on the application requirement to support lowest latency
> and the need to support replication within 5G System (within the domain of
> 3GPP System), the replicator framework replicates the packets towards the
> lower layers.
>
> b. Case 2: Based on the application functionality to support redundancy by
> default, replication framework within 5G System (within the domain of 3GPP
> System), replicator framework can eliminate further replication rather it
> can transmit the packet stream just once towards the lower layers.
3\. For case 1, to ensure the two N3 tunnels can be transferred via disjointed
transport layer paths, the NG-RAN node, SMF or UPF will provide different
routing information in the tunnel information (e.g. different IP addresses or
different Network Instances), and the routing information will be mapped to
disjoint transport layer paths according to network deployment configuration.
4\. At the receiver side, the receiver translates and forwards the internal
streams to the corresponding external application either in the UE side or in
the network side. To make it transparent to the external application, further
combine/remove/replicate operations may be applied to \"reverse\" the
operations in step 2b. The replicator at the receiver can use the header
information (or share explicit information with the replicator entity at the
other end) to translate/re-build packets according to the external application
requirements.
5\. Following are the main 5G System impacts and principles:
> a. 5G System can have an API or direct interaction with external management
> system to become aware of the expected application behaviour with regards to
> replication functionality. UPF can also perform data inspection in the UPF
> (with replicator) for autonomous discovery of multiple related flows (e.g.
> it can detect if the MPTCP layer is duplicating the flows).
>
> b. Based on policies, the SMF determines whether a particular PDU Session is
> subject to replication, selects an UPF with replicator functionality; It
> also provides the necessary replicator information as part of rules to the
> selected UPF.
>
> c. Based on the rules received from SMF, UPF activates replicator
> functionality for the User plane traffic. For DL traffic, UPF can perform
> further replication and provide an indication (e.g. GTP-U header) to the
> RAN. If the UPF duplicates the traffic, it transmits over multiple tunnels
> (using disjoint transport path) towards the RAN.
>
> d. The replicator functionality in the RAN can take potential actions such
> as eliminate the received duplicated DL data prior to transmitting it to the
> UE. Other potential actions are also listed in 6.7.2.1 bullet 2).
>
> e. If the UE with the replicator functionality receives duplicated packets,
> it can re-assemble the packets to ensure transparency to the application
> layer. The replicator at the receiver forwards the received data to one or
> more output ports, as expected by the application layer protocol.
Figure 6.7.1-1 below shows an example of the user-plane system architecture of
the proposed solution. The Replicator functionality may be a part of the UPF
(or collocated with the UPF) for user plane functionality and SMF for control
plane functionality. We consider a multi-UE transceiver that encompasses
various UEs with independent hardware and protocol stacks. Each gNB can also
consist of multiple distributed units (DU) attached to a central unit (CU).
Figure 6.7.1-1 Architecture with Replication Framework - Single UE/UPF case
(Case 1)
Figure 6.7.1-2 Architecture with Replication Framework - Dual UE/Dual UPF case
(Case 2)
### 6.7.2 Procedures
#### 6.7.2.1 Downlink User Plane Transmission
We use a downlink traffic flow example where redundant data (e.g. generated by
802.1 standard) enter the 3GPP system and must be reliable received at the UE
receiver:
**1) Discovery of multiple \"streams\" of packets.**
The replicator functionality in the 3GPP system is introduced to be aware that
two or more \"streams\" of packets belong together. This can be achieved with
an API or direct communication with an external management system.
Data inspection in the UP can also be applied to some extent for autonomous
discovery of multiple related flows.
The replicator informs the lower-layers (e.g. SDAP at the gNB/UE) of the
detected redundant packets. As an option, it can also manipulate the incoming
data, e.g. merging two packets into a single packet but mapping it and
indicating the higher reliability needs for the packet. It should also ensure
that the packets requiring higher reliability are transported via disjoint
transport layer paths according to network configuration (i.e. different IP
address configurations).
#### 6.7.2.2 Activate Redundant Transmission during PDU Session Establishment
procedure
The replicator functionality can be activated during a PDU Session
establishment procedure as described in this clause.
Figure 6.7.2.2-1 depicts the establishment of during the PDU session
establishment procedure in the non-roaming and roaming with local breakout
cases for case 1) with single UE and single UPF.
Figure 6.7.2.2-1: Activate Replicator functionality during PDU Session
Establishment procedure
1\. Steps 1-12 from clause 4.3.2.2.1(UE requested PDU Session Establishment)
in TS 23.502 [3] are performed with the following differences:
In Step 1, the UE initiates the UE Requested PDU Session Establishment
procedure by the transmission of a NAS message containing a PDU Session
Establishment Request within the N1 SM container and it can include its
capability to support replicator protocol (but not required). The UE can also
indicate a specific DNN and S-NSSAI.
In step 7b, the PCF indicates to the SMF and the NG-RAN to activate replicator
functionality for the QoS flow by the 5QI if the UE requested PDU Session
Establishment procedure is initiated for a URLLC service (based on parameters
provided by the UE).
The SMF then initiates an N4 Session Establishment procedure with the selected
UPF (with replicator functionality) and CN Tunnel ID(s) are allocated by the
SMF or UPF.
In step 11, the N2 SM information includes the QFI(s), QoS Profile(s), CN
Tunnel Information corresponding to each N3 tunnel.
2\. RRC Connection Reconfiguration takes place with the UE establishing the
necessary NG-RAN resources related to Replicator functionality.
3\. Steps 14-20 from clause 4.3.2.2.1(UE requested PDU Session Establishment)
in TS 23.502 [3] are performed with the following differences:
The AN Tunnel Info provided by the NG-RAN includes AN Tunnel ID(s) for
replicated paths. Each AN Tunnel Information includes a tunnel endpoint for
each involved NG-RAN node, and the QFIs assigned to each tunnel endpoint. The
SMF provides AN Tunnel Information for each tunnel to the UPF.
For case 2), main addition to the above procedure would be for the two UE(s)
to provide a parameter (e.g. SD part of the S-NSSAI has a commonly configured
value, support for replicator functionality) in the PDU Session Establishment
request that gives a hint to the network for selecting the same UPF or two
UPF(s) with access to the same replicator functionality towards the DN.
### 6.7.3 Impacts on Existing Nodes and Functionality
UE:
\- Optional support for replicator functionality.
NG-RAN:
\- Access to replicator functionality support. Replicator in the RAN has the
capability to replicate packets over N3 and/or eliminate further replication
of packets over Uu/N3.
SMF:
\- Based on parameters (e.g. DNN, S-NSSAI, replicator support) provided by the
UE in the PDU Session request, ability for SMF to select UPF with access to
replicator functionality and also activate replicator functionality in the NG-
RAN as part of N2 SM context activation.
UPF:
\- Access to replicator functionality support. Replicator in the UPF has the
capability to replicate packets and/or eliminate further replication of
packets.
### 6.7.4 Solution Evaluation
Editor\'s note: This clause provides an evaluation of this solution.
## 6.8 Solution #8 for Key Issue #4: QoS Monitoring
### 6.8.1 Description
Based on the TS 22.261 [5], clause 6.23 (QoS Monitoring), the vertical
applications may want to be aware of the real time latency (e.g., UL, DL or
Round trip latency) of the URLLC service in 5G system, and the trouble
shooting could be done based on the real time latency as the input. QoS
Notification Control is performed to monitoring the GFBR on RAN side only, to
achieve the E2E QoS monitoring, the real time packet delay in 5GC and 5G-AN
can be jointly monitored to achieve the E2E QoS monitoring by sending the
monitoring packets periodically when QoS monitoring activated. There are two
ways to monitor packet delay: round-trip time (RTT) delay and one-way delay.
#### 6.8.1.1 QoS Monitoring Activation
The QoS monitoring could be activated dynamically by the 5GC for certain UEs,
UE group, or network slice instance, based on the subscription, the request
from the AF, or the command from the OAM system, etc.
During the PDU Session Establishment or Modification procedure, the PCF may
send QoS Monitoring Policy to the SMF based on subscription or AF request. The
QoS Monitoring policy contains the QoS parameters to be monitored, event
report triggers, the validity timer length for round trip monitoring, the
threshold of QoS parameters and the relevant actions when threshold is
exceeded are also included in the QoS Monitoring policy. The QoS Monitoring
Policy can also be pre-configured at SMF by the operator. When receiving the
QoS Monitoring Policy from the PCF, The SMF maps the QoS Monitoring Policy in
the URRs to the UPF, the URR includes QoS parameters to be monitored,
threshold, the validity timer length for round trip monitoring and relevant
action, and event report for specific QoS flows. The SMF notifies the RAN and
UE to enable the QoS Monitoring for the QoS Flow via the
Namf_Communication_N1N2MessageTransfer message and PDU Session Modification
Command message.
When the event reports is triggered, e.g. when the round trip or UL/DL packet
delay is longer than the threshold, or when the UPF does not receive the round
trip monitoring respond packet within the length of the validity timer, the
UPF can report the events via N4 interface, respectively. After receiving the
QoS monitoring events report from UPF, the SMF may forward the report to e.g.
PCF. The detailed procedure for QoS Monitoring activation is defined in the
clause 6.8.2.
#### 6.8.1.2 Enforce QoS Monitoring
##### 6.8.1.2.1 Option 1: Using newly defined packet as monitoring packets
The monitoring packet is using the same QoS flow as the URLLC service packet
data to be monitored. To distinguish the GTP-Us delivering the monitoring
packets from the ones delivering the service packets, a new payload type QMP
(QoS Monitoring Packet) in GTP-U header (between UPF and RAN) is introduced.
Figure 6.8.1.2.1-1: Packet delay measurement
The round trip latency could be monitored by sending the round trip monitoring
packets between the UE and UPF.
When the packet delay monitoring is activated by the network, the UPF creates
and sends the monitoring packets to the RAN:
\- Step1. UPF generates the monitoring request packets and assigns a relevant
sequence number with each packet. UPF encapsulates the GTP-U header with QFI,
TEID and QMP indicator. The UPF records the local time T1 and starts validity
timers for each monitoring packet with the length provided as the validity
timer length for round trip monitoring after sending out the packets to the
RAN successfully.
\- Step2. When receiving the monitoring request packets, RAN records the
sequence number and the local time T2, initiates packet delay measurement
between RAN and UE.
The length of the monitoring packet could be defined equal to the typical
packet size of the actual URLLC service packet. The length of the monitoring
packet could be contained in the QoS Monitoring policy.
NOTE: QoS monitoring mechanisms adopted in RAN part depends on RAN conclusion.
\- Step3. When receiving the monitoring response packet from UE, RAN
encapsulates QMP indicator in the GTP-U header of the measurement response
packet and send it out to the UPF. RAN also includes the corresponding
sequence number, the one way (UL and DL) packet delay result of Uu interface,
local time T5 the response packet sent out, together with the T2 in step2 in
the response packet.
\- Step4. UPF records the local time T6 and gets the one way (UL and DL)
packet delay result of Uu interface when receiving the monitoring response
packet identified by the sequence number. In case the UPF does not receive a
monitoring respond packet before the corresponding timer is ended, the UPF
take that monitoring respond packet as lost.
The UPF calculates the latency as the following:
\- RTT1: Round trip latency between the RAN and UPF: (T6-T1) - (T5-T2).
\- RTT2: Round trip latency between the RAN and UE: Calculated by RAN based on
the packet delay mechanism of Uu interface.
\- RTT3: Round trip latency between the UPF and UE: RTT1+RTT2.
\- In case the monitoring respond packet is lost, Round trip latency is set to
the length of the corresponding validity timer.
It is assumed that the time synchronization precision between the UE and RAN
achieves to microsecond level and the network latency between the RAN and UPF
is regarded as symmetric, so we suggest approximate one way latency could also
be calculated:
\- One way delay 1: DL or UL between the RAN and UE: Calculated by RAN based
on the packet delay mechanism of Uu interface.
\- One way delay 2: DL or UL between the RAN and UPF: [(T6-T1) - (T5-T2)]/2
\- One way delay 3: DL or UL between the UE and UPF: One way delay1 + One way
delay2
The UPF and RAN could encapsulate the sequence number timestamp in the
monitoring packets to calculate the one way or RTT packet delay between the
RAN and UPF.
##### 6.8.1.2.2 Option 2: Using actual service packets as monitoring packets
The monitoring packet is sampled from the service packets of URLLC service by
UE and UPF based on the measurement period in the QoS Monitoring policy. If
the round trip packet delay is requested to be measured, it is proposed that
the UL one way packet delay plus DL one way packet delay could be regarded
equal to the round trip packet delay. To distinguish the GTP-U packets for QoS
Monitoring from the ones delivering the service packets, a new payload type
QMP (QoS Monitoring Packet) in GTP-U header (between UPF and RAN) and in
SDAP/PDCP header (between UE and RAN) is introduced.
When the DL one way packet delay monitoring is activated by the network, the
UPF samples the DL service packets of the QoS Flow as monitoring packet and
sends it to the RAN:
\- Step1. UPF samples the DL service packets of the QoS Flow based on the
measurement period as monitoring packet. The UPF encapsulates the GTP-U header
with QFI, TEID, sequence number and QMP indicator. The UPF sends the
monitoring packets to the RAN. The UPF records the local time T1 after sending
out the packets to the RAN successfully.
\- Step2. When receiving the monitoring packets, RAN records the sequence
number in the GTP-U header and the local time T2, initiates packet delay
measurement between RAN and UE.
NOTE 1: How RAN and UE measure the DL packet delay of Uu interface depends on
RAN decision.
\- Step3. When getting the DL packet delay result of Uu interface, RAN
encapsulates QMP indicator in the GTP-U header of the measurement response
packet and sends it to the UPF. RAN also includes the corresponding sequence
number, DL one way packet delay result of Uu interface (T~DL-Uu~), local time
T5 when the response packet sent out, together with the T2 recorded in step 2,
in the response packet.
NOTE 2: RAN can send a new defined message as the monitoring response packet
to the UPF, or the RAN could utilize the UL G-PDU which delivering the service
packets as the monitoring response packet. If the G-PDU is used, the
information in step 3 is contained in the GTP-U extended header.
\- Step4. UPF records the local time T6 and gets the DL one way packet delay
of Uu interface when receiving the monitoring response packet identified by
the sequence number.
It is assumed that the packet delay between the RAN and UPF is regarded as
symmetric, so approximate one way latency of N3 interface could be calculated
based on the round trip packet delay of N3 interface. The round trip packet
delay of N3 interface could be calculated by UPF as T~RTT-N3~ = (T6-T1) -
(T5-T2).
The E2E DL one way packet delay could be calculated by UPF as T~PDB-DL~ =
T~DL-Uu~ + (T~RTT-N3~ / 2).
When the UL one way packet delay monitoring is activated by the network:
\- Step 1. UE samples the UL service packets of the QoS Flow based on the
measurement period as monitoring packet. UE encapsulates the SDAP/PDCP header
with QMP indicator. The UE sends the monitoring packets to the RAN.
\- Step 2. When receiving the monitoring packets, RAN would calculate the UL
packet delay of Uu interface.
NOTE 3: The detailed QoS Monitoring mechanisms adopted in RAN part depends on
RAN decision.
\- Step 3. RAN encapsulates QMP indicator in the GTP-U header of the UL G-PDU
packet and send it to the UPF. RAN also includes the UL one way packet delay
result (T~UL-Uu~) of Uu interface in the GTP-U extended header.
\- Step 4. UPF gets the UL one way packet delay of Uu interface when receiving
the monitoring packet.
The E2E UL one way packet delay is calculated by UPF as T~PDB-UL~ = T~UL-Uu~ +
(T~RTT-N3~ / 2).
NOTE 4: RAN can encapsulate both DL and UL packet delay of Uu interface in the
GTP-U extended header of the same UL G-PDU packet in step 3.
##### 6.8.1.2.3 Option 3: Using newly defined packets based on time
synchronization
This solution assumes the 5G internal system clock or external system clock
(e.g. TSN network domain) is made available to all user plane nodes in the 5G
system. The one way packet delay of Uu interface could be measured by UE and
RAN based on time synchronization mechanism between UE and RAN, and the one
way packet delay of N3 interface could be measured by RAN and UPF directly
according to the time stamp information carried by the measurement packet, if
UPF is time synchronized with RAN and UE. This solution is quite similar as
option 1, with the following exceptions:
When the packet delay monitoring is activated by the network:
\- The UPF records the local time T1 when creating the monitoring packets and
encapsulates the time stamp T1 in the monitoring packets (e.g. in the GTP-U
header or in the monitoring packets body).
\- When receiving the monitoring packets from UPF, RAN records local time T2,
and calculates the DL packet delay of N3 interface as T~DL-N3~ = T2-T1.
\- When receiving the monitoring response packets form UE, RAN encapsulates
local time T5 when sending the response packet to the UPF, together with the
T~DL-N3~ in step2 in the response packet.
\- When receiving the monitoring packets from RAN, the UPF records local time
T6, and calculates the UL packet delay of N3 interface as T~UL-N3~= T6-T5.
NOTE: How the UPF get the UL and DL packet delay of Uu interface refers to
option 1.
#### 6.8.1.2.4 Option 4: Using actual service packets based on time
synchronization
This solution assumes the 5G internal system clock or external system clock
(e.g. TSN network domain) is made available to all user plane nodes in the 5G
system. The one way packet delay of Uu interface could be measured by UE and
RAN based on time synchronization mechanism between UE and RAN, and the one
way packet delay of N3 interface could be measured by RAN and UPF directly
according to the time stamp information carried by the measurement packet, if
UPF is time synchronized with RAN and UE. This solution is quite similar as
option 2, with the following exceptions:
When the one way packet delay monitoring for DL is activated by the network:
\- The UPF samples the DL service packets of the QoS Flow as monitoring
packet. The UPF encapsulates time stamp T1 when sampling the DL service
packets in the GTP-U header (other parameters encapsulated in the GTP-U header
refer to option 2).
\- When receiving the monitoring packets, RAN records the local time T2, and
calculates the DL packet delay of N3 interface as T~DL-N3~ = T2-T1.
\- When getting the DL packet delay result of Uu interface, the RAN
encapsulates the T~DL-Uu~ and T~DL-N3~ in the packet sent to the UPF.
\- The E2E DL one way packet delay is calculated by the UPF as T~PDB-DL~ =
T~DL-Uu~ + T~DL-N3~.
NOTE 1: How the UPF gets the DL packet delay of Uu interface refers to option
2.
When the one way packet delay monitoring for UL is activated by the network:
\- When receiving the monitoring packets from UE, RAN encapsulates the T~UL-
Uu~ and the time stamp T5 when sending out the UL G-PDU packet in the GTP-U
extended header.
\- When receiving the monitoring packets from RAN, the UPF records local time
T6, and calculates the UL packet delay of N3 interface as T~UL-N3~ = T6-T5.
\- The E2E UL one way packet delay is calculated by UPF as T~PDB-UL~ = T~UL-
Uu~ + T~UL-N3~.
NOTE 2: How UPF gets the UL packet delay of Uu interface refers to option 2.
#### 6.8.1.3 QoS Monitoring Policy
The QoS Monitoring Policy is created by the PCF. The PCF sends the QoS
Monitoring policy via Session Management Policy Modification procedure to the
SMF, and instructs the SMF to initiate QoS Monitoring for the QoS Flow. The
QoS Monitoring Policy provides round trip and/or one- way packet delay to be
monitored and monitoring periodicity, optionally the corresponding threshold
to trigger the reporting of the packet delay. Besides, the PCF also instructs
the QoS Monitoring events report method in the QoS Monitoring policy, e.g.
immediate report when the monitored QoS KPI cannot be fulfilled or reach
certain threshold, or non-real time report. If the option 1 is adopted, the
length of the monitoring packet may be included in the QoS Monitoring policy.
NOTE: The non-real-time report can be sent according to one of the following
configured events: Periodic report, when the UE enters CM-IDLE state, when the
UE enters RRC-INACTIVE state, when the PDU Session is released. The PCF should
also indicate the report period if periodic report is required.
### 6.8.2 Procedures
#### 6.8.2.1 QoS Monitoring Procedure
Procedure in Figure 6.8.2-1 is used to activate QoS Monitoring. The QoS
Monitoring can be triggered by the AF and PCF.
Figure 6.8.2.1-1 Procedure for QoS Monitoring Activation
0\. The AF could trigger the QoS Monitoring procedure or subscribe for QoS
Event Report by sending the Npcf_Policy_Authorization_Create/Update request
message directly to the PCF or via NEF which is based on local configuration.
1\. Based on the service subscription and/or the request from the AF, the PCF
determines to activate QoS Monitoring for the QoS Flow and generates the QoS
Monitoring policy for the QoS Flow. The PCF sends the QoS Monitoring policy
via Session Management Policy Modification procedure to the SMF, and instructs
the SMF to initiate QoS Monitoring for the QoS Flow.
2\. When the SMF receives the QoS Monitoring policy via the Session Management
Policy Modification procedure, the SMF indicates to the RAN to start QoS
Monitoring via AMF in the Namf_Communication_N1N2 message transfer message.
The SMF may indicate to the RAN via AMF to report the DL and UL packet delay
result of Uu interface to the UPF. If option 2 is adopted, the SMF also
includes the QoS Monitoring policy in the PDU Session Modification Command
message sent to UE.
3\. The AMF forwards the QoS Monitoring indication received from SMF to the
RAN via N2 Session Request message.
4\. The RAN forwards the PDU Session Modification Command message to UE.
5\. The RAN sends the N2 Session Response to the AMF. The RAN indicates
whether the QoS Monitoring is accepted or not in this message.
NOTE: RAN could reject the QoS Monitoring request for the QoS Flow based on
RAN situation, e.g. when the load of RAN node is close to its capacity.
6\. The AMF sends the Nsmf_PDUSession_UpdateSMContext Request to the SMF to
indicate whether the QoS Monitoring policy is accepted or not by RAN.
7\. SMF sends Nsmf_PDUSession_UpdateSMContext Response to the AMF.
8\. The SMF determines the QoS parameters and QoS Monitoring events which need
to be monitored and reported by UPF, e.g., one-way/round trip packet delay,
and optionally the corresponding threshold and/or reporting period, and sends
them to UPF via N4 Session modification request.
9\. When the UPF receives the QoS Monitoring policy of the QoS Flow, the UPF
initiates QoS Monitoring.
10\. The SMF indicates the QoS Monitoring policy activation result to the PCF
via the Session Management Policy Modification procedure.
11\. If QoS Monitoring activation is initiated by AF, the PCF sends the
Npcf_Policy_Authorization_Create/Update response to the AF to indicate the QoS
Monitoring policy activation result.
#### 6.8.2.2 QoS Monitoring Event Report by UPF
Procedure in Figure 6.8.2.2-1 is used for UPF to report QoS Monitoring Event
to the SMF.
{width="3.9381944444444446in" height="2.636111111111111in"}
Figure 6.8.2.2-1: Procedure for QoS Monitoring Event Report by UPF
1\. When the QoS Monitoring event is triggered, the UPF initiates QoS
Monitoring events report via the N4 Session report procedure.
2a. The UPF sends N4 Report to the SMF carrying the QoS Monitoring Event
Report: Timestamp of event, Name of event, measured value of QoS parameter,
PDU Session ID, QFI. If the cell ID can be obtained by the UPF, the cell ID
may also be included in the report message.
2b. The SMF sends N4 Report ACK to the UPF.
3\. The SMF forwards the QoS Monitoring Event Report to the PCF by using
Npcf_SMPolicyControl_Update service. The message includes Timestamp of event,
reporting function ID (RAN ID or UPF ID), Name of event, measured value of QoS
parameter, UE ID (GPSI), and optionally the cell ID.
4\. The PCF sends QoS Monitoring Event Notification to the subscribed AF by
using Npcf_PolicyAuthorization_Notify service. The QoS Monitorng Event
Notification include Timestamp of event, Name of event, measured value of QoS
parameter(s), UE ID (GPSI).
### 6.8.3 Impacts on Existing Nodes and Functionality
\- AF: AF may send request message to trigger the 5GC to initiate QoS
Monitoring for the URLLC service of the UE. The monitored QoS parameters may
be included in the request message.
\- PCF: Based on the subscription and/or AF\'s request, PCF creates the QoS
Monitoring policy. PCF provides the QoS Monitoring policy to the SMF and
instructs the SMF to initiate QoS Monitoring for the QoS Flow.
\- SMF: SMF decomposes the QoS Monitoring policy received from the PCF, and
triggers the QoS Monitoring in the UPF, RAN and UE respectively.
\- UPF: Initiates QoS Monitoring for the QoS Flow based on the QoS Monitoring
policy received via N4 message. When the QoS Monitoring events match the
reporting condition, the UPF reports the QoS Monitoring events to the SMF.
If all user plane nodes of 5G system are time synchronized, the UPF sends the
DL monitoring packet to RAN, which carrying the time stamp when sampling the
service packet as the monitoring packet. The UPF may calculate the UL packet
delay of N3 interface based on the time stamp received from RAN and the local
time when receiving the monitoring packet if the RAN sends the DL packet delay
report to the UPF.
\- RAN: When receiving the monitoring packet from UPF and UE, RAN initiates
the DL and UL packet delay measurement for Uu interface. RAN provides the
packet delay of Uu interface to the UPF via a new GTP-U packet or via the UL
GTP-U data packet.
If all user plane nodes of 5G system are time synchronized, the RAN sends the
UL monitoring packet to UPF, which carries the time stamp when sending out the
monitoring packet. The RAN calculates the DL packet delay of N3 interface
based on the time stamp received from UPF and the local time when receiving
the monitoring packet.
\- UE: If option 1 is adopted, the UE cooperates with RAN to measure the DL
and UL packet delay of Uu interface. If option 2 is adopted, the UE initiates
QoS Monitoring for the QoS Flow based on the QoS Monitoring policy received
via N1 message.
### 6.8.4 Solution Evaluation
Editor\'s note: As indicated by RAN2 in LS from RAN2 S2-1812451 the RAN
aspects fall within scope of the planned Rel-16 WI/SI \"RAN-centric Data
Collection and Utilization for NR\" that will start in Feb. 2019.
## 6.9 Solution #9 for Key Issue 5, supporting low latency for initial data
delivery without requiring that the UE to always be in RRC_Connected State
### 6.9.1 Description
This solution applies to key Issue 5 when the UE change state from
RRC_Inactive to RRC_Connected in another NG-RAN node than the one that has the
UE context, where the nodes are within the same RAN Notification Area, and
there are MO or MT data that need to be delivered with ultra low latency or
with low jitter.
This solution allows the UE to deliver initial ultra low latency data to the
existing DNN via the Xn interface without having the network to reconfigure
the N3 and possible also the N6 interface.
CM-CONNECTED with RRC Inactive is used for URLLC User Data with following
enhancement:
\- RAN uses at least the QoS information to detect if URLLC is requested.
\- RAN receives an indication from the UE if a URLLC PDU Session shall be
resumed.
\- When the UE send RRC_Resume request to a NG-RAN Node that does not have the
UE Context then RAN may decide that the anchor NG-RAN Node will not do a path
switch of N3 to the new NG-RAN Node immediately.
NOTE: It is up to RAN to decide when to start the transfer of user data to the
Anchor RAN Node in relation to the procedure to retrieve the UE Context from
the Anchor RAN Node. RAN may decide to only deliver the first EDT from the UE
and then perform N3 path switch or, temporary setup a data forwarding tunnel
of the PDU session over the Xn interface (TS 38.420 [12] and TS 38.415 [13])or
not to switching N3 path to serving NG-RAN to avoid unnecessary N2 signalling
if it is limited size of URLLC user data. If the path switch was executed then
the new NG-RAN node will become the new anchor NG-RAN node.
\- When the UE is handed over from one non-anchor RAN node to another within
the same RAN Notification Area (RNA), the RAN anchor node may decide to defer
re-anchoring.
Editor\'s note: It is FFS how N2 control plane signalling is to be handled for
a UE for which the path switch is deferred.
### 6.9.2 Procedures
The procedure below shows the ultra low latency solution where the user data
is delivered over Xn.
Figure 6.9.2.1: Ultra low latency user data delivery
0\. Precondition is that the UE successfully done a PDU Session Establishment
Procedure according to clause 4.3.2.2.1 in TS 23.502 [3] and that SMF
indicates in the N2 SM container using QoS information to the anchor NG-RAN
Node that the PDU Session is used for URLLC.
1\. UE to NG-RAN: RRC Resume Request (Resume ID, Indicator) according to
existing procedure under Non-anchor NG-RAN node 1.
NOTE 1: A UE may have many PDU sessions established before entering
RRC_Inactive. Therefore, the UE need to indicate whether the Resume Request is
linked to an URLLC PDU session or not. RAN needs to decide the format of this
indication e.g. simple flag or PDU session ID.
2\. The new NG-RAN node (Non-anchor NG-RAN node 1) uses the Resume ID to
identify the anchor NG-RAN node and request to retrieve the UE Context from
the anchor NG-RAN Node. In case of EDT the UE context retrieval may also
include the early data. If the resumed PDU Session is an URLLC PDU Session,
the anchor NG-RAN Node may decide to configure the Non-anchor NG-RAN Node as a
relay for that UE. In that case the Non-anchor NG-RAN Node 1 will relay future
MO & MT user data between the UE and the Anchor RAN Node.
NOTE 2: RAN needs to decide messages and procedures to support Xn forwarding
tunnel feature.
3\. The Non-anchor RAN Node 1 sends the RRC Resume message to the UE.
4\. The UE Enter RRC_Connected state.
5\. All MO user data will be transferred from the UE to the Non-anchor NG-RAN
Node 1 and then over Xn to the anchor NG-RAN Node and further transported via
existing N3 & N6 to the DNN and the low latency application service. MT user
data will be sent in the opposite direction.
6\. Due to UE mobility the UE is handed over from Non-anchor NG-RAN node 1 to
Non-anchor NG-RAN node 2. The Anchor NG-RAN node decides to remain as anchor
and defer any re-anchoring to later.
7\. All MO and MT data between NG-RAN node 2 and the CN are relayed via the
Anchor NG-RAN node.
NOTE 3: Keeping the Anchor RAN node unchanged for UE in RRC_CONNECTED state
can be beneficial for low-latency communication by avoiding delays associated
with traffic forwarding of traffic upon handover between Non-anchor RAN node 1
and Non-anchor RAN node 2 (either directly or via the Anchor RAN node). It is
assumed that it is used in conjunction with RAN-level mechanisms for low-
latency communication that are out of scope of this TR. The benefits of this
specific aspect of the solution need to be evaluated.
### 6.9.3 Impacts on Existing Nodes and Functionality
RAN:
\- RAN, based on if the PDU Session is an URLLC PDU Session received from the
SMF, may decide to establish a forwarding tunnel between the new NG-RAN and
anchor NG-RAN during the Resume procedure or, RAN may decide to only forward
the EDT user data included in RRC_Resume_Request in the UE Context Retrieval
request and allow the Anchor NG-RAN Node to deliver the EDT user data over
existing N3 without any N3 path switch.
UE:
\- Indication of whether the Resume Request is linked to an URLLC PDU session
or not.
### 6.9.4 Solution Evaluation
Editor\'s note: This clause provides an evaluation of this solution.
## 6.10 Solution #10 for Key Issue #1: Multiple UEs per device for user plane
redundancy with broadcast Network Reliability Group
### 6.10.1 Description
This solution is a variant of Solution #2 for Key Issue #1 (see clause 6.2).
Only the differences compared to Solution #2 are described in this clause.
To enable the UEs in the same device to select cells not sharing the same
physical infrastructure (e.g. site, power supply, backhaul links), reliability
groups are defined and configured by the operator, but (unlike Solution #2),
these pertain only to the network and are broadcast by the gNBs in System
Information. They are called Network Reliability Group (NRG). The operator may
define a large number of NRGs (e.g. one NRG correspond to a set of cells
either sharing their backhaul link), and each of the UEs in the device is not
bound to a specific NRG. The UEs in the device coordinate with each other so
that they do not camp on cells broadcasting the same NRG.
NRG are assigned according to the risk modelling of the network
infrastructure. When two cells have different NRG values, the network operator
provides the guaranty that there no shared risk in the infrastructure. When
two cells have the same NRG value, there is a possibility of shared risk /
common point of failure in the network infrastructure, e.g. a shared backhaul
link.
The assumptions of Solution #2 apply, expect the following:
\- To ensure that the two UEs connect to different gNBs, the gNBs need to
operate such that the selection of gNBs can be distinct from each other (e.g.
gNBs operating in different frequencies etc.).
The NRG of the RAN (cells of gNBs) entities are configured by the OAM system
in RAN. It is possible for gNBs to learn the reliability group neighbouring
cells as the Xn connectivity is set up.
The NRG parameter of each cell is broadcast by the gNB, and each UE in the
device stores this information and communicates it to the other UEs in the
same device, so each UE in the device has knowledge about the NRG used by the
other UEs. Each UE then provides NRG about the other UEs and its own to its
RAN node via RRC. This will avoid selecting a cell broadcasting one of these
NRGs, for initial Registration and idle-mode mobility.
At device manufacture, the UEs in the device are assigned a rank: e.g. UE1,
UE2, UE3, etc. When the device is started, first UE1 performs network
selection normally. Then UE2 performs network selection and down-prioritizes
cells broadcasting the NRG selected by UE1. Then UE3 performs network
selection and down-prioritizes cells broadcasting any of the NRGs selected by
UE1 or UE2. Etc.
It follows that the device is always using cells belonging to different NRGs
(as long as redundant RAN coverage is available), without the need for the gNB
to redirect the UE to another cell.
For connected mode mobility, each UE of the device informs the serving gNB of
the NRG used by other UEs of the same device (e.g. along with measurement
reports), and the serving gNB down-prioritizes candidate target cells that
belong to NRGs already used by the device. It follows that the UE is
preferably handed over only to cells in a way to preserve the diversity of
NRGs for the device.
### 6.10.2 Procedures
RAN has its own NRG parameter configured into the gNBs on a per cell basis and
broadcasts it in System Information. gNBs may learn the RAN NRG parameter of
the neighbouring cells.
The Registration procedure is unchanged.
The RAN connected mode mobility handling is extended as follows.
\- UE informs the serving gNB of the NRGs used by other UEs of the same device
(e.g. along with measurement reports).
\- RAN node down-prioritizes handover targets whose NRG is used by other UEs
of the device.
### 6.10.3 Impacts on Existing Nodes and Functionality
SMF, UPF, PCF/BSF impacts: see clause 6.2.3.
RAN impacts:
\- OAM configuration of the NRG on a per cell level.
\- Addition of NRG to System Information.
\- RRC: gNB obtains the NRGs used by other UEs of the same device (e.g. along
with measurement reports).
\- gNB down-prioritizes handover targets whose NRG is used by other UEs of the
device.
Subscription impacts: none.
AMF impacts:
\- Forward the relevant indications between RAN and SMF (not related to NRG
but to Solution 2).
UE impacts:
\- Support of multiple UEs per device.
\- UE reads the NRG in System Information.
\- UE interacts with other UEs in the device so that each UE knows the NRGs
already used by other UEs.
\- UE selects the cell based on NRG information.
\- UE informs the serving gNB of the NRGs used by other UEs of the same device
(e.g. along with measurement reports).
### 6.10.4 Solution Evaluation
\- The solution can provide disjoint redundant user plane paths through the
3GPP system including UE, RAN and CN.
\- The solution ensures that the redundant user plane paths do not share the
same risks, whenever possible.
\- The solution uses IEEE FRER on upper layer between UE and DN.
\- The solution does not impact the application itself, as replication can be
performed by a networking protocol such as IEEE TSN FRER (see Annex A) which
operates at an intermediate Ethernet switch or at the Ethernet layer of the
endhost. Other protocols for replication are also applicable, such as DetNet
(see Annex B) or proprietary protocols.
\- The solution can be integrated with end to end redundancy solutions.
\- The solution can provide the same level of redundancy as typically applied
for fixed industrial deployments today.
\- The solution is under control of the terminals.
\- The solution uses multiple UEs in the terminal, hence it provides redundant
UEs.
\- The solution enables a flexible deployment as it can be deployed by
defining NRGs based on the already deployed network without requiring the
deployment of fully disjoint RANs or CNs.
\- In certain deployments, this solution might require the UE(s) to be aware
of the frequencies supported by gNB(s).
Editor\'s note: need for gNB to be aware of neighbour node\'s support for NRG
to make it usable in certain deployment scenarios is FFS.
## 6.11 Solution #11 for Key Issue #3: Anchor change for Ethernet PDU Session
### 6.11.1 Description
The solution allows for Ethernet PDU Sessions to change the PDU Session Anchor
(PSA) while the session remains set up. Originally the Ethernet PDU Session
goes via the Source UPF acting as the PSA. The Source UPF maintains an
Ethernet context which includes the MAC address of the UE (and possibly its
VLAN tag) that the Source UPF has learned. It is possible to store multiple
MAC addresses (with their VLAN tags) in case multiple MAC addresses are
reachable via the UE. The Ethernet context is replicated in the SMF.
{width="4.002777777777778in" height="2.6944444444444446in"}
Figure 6.11.1-1: Solution architecture
The SMF determines that a serving PDU Session anchor needs to be changed.
Specific event triggers are not specified; hence the SMF has the flexibility
to change the anchor according to the needs of various use cases. UE idle and
connected mode mobility may be a frequent trigger for changing the anchor
point, however other events should not be excluded. For example, the SMF could
decide to relocate an Ethernet PDU Session anchor for load balancing or
rebalancing, because a different UPF provides a data path with greater
reliability, because a different UPF is more suitable for meeting QoS
requirements, for maintenance, or for other reasons. The SMF determines the
need for changing the anchor, selects the Target UPF when necessary, and
establishes the N4 session at the Target UPF. The Ethernet context is also
sent to the Target UPF. Based on the information in the Ethernet context, the
Target UPF may take action to update the Ethernet forwarding in the data
network.
\- If the Ethernet subnetwork uses forwarding based on MAC learning, then the
fast update of the Ethernet forwarding can be achieved via a variety of
mechanisms the use of which are specific to the DN and the specification of
which are out-of-scope for 3GPP. The UPF may for example issue a Gratuitous
ARP (GARP) containing the MAC address(es) of the UE that has switched to the
new anchor. Alternatively, the UPF may send an unsolicited Neighbor Discovery
Protocol (NDP) Neighbor Advertisement message indicating the UE MAC addresses,
the UPF may generate a user plane frame with the UE\'s MAC addresses (and
possibly its VLAN tag) and configurable payload which will be dropped by the
endhosts, or the UPF may send another message compatible with DN protocols.
Note that the Ethernet forwarding would eventually be updated without these
techniques, when the UE sends an uplink Ethernet frame; but in that case the
update of the forwarding is slower and prior to the sending of the uplink
frame from the UE, downlink frames would be forwarded to the source UPF.
\- If the Ethernet subnetwork uses forwarding based on a centralized
controller setting the forwarding rules of the Ethernet switches, then the
update of the Ethernet forwarding rules can be achieved by the Target UPF also
acting as an Ethernet switch notifying the central controller that the given
MAC address is now reachable at the new address.
When the Ethernet context includes multiple MAC addresses, the above is
performed for each MAC address. After the Target UPF is set up for the given
UE, the RAN is notified about the change in the UPF, and the Source UPF can be
released.
### 6.11.2 Procedures
This procedure for Ethernet PDU Session Anchor relocation is shown in figure
6.11.2-1. It greatly simplifies release 15 mechanisms for Ethernet PDU session
re-anchoring while maintaining flexible triggering of the SMF to select a new
anchor UPF for any reason. Unlike SSC Mode 2 or SSC Mode 3 procedures, the UE
is not impacted by signaling or by the allocation of a new address.
When the SMF decides that an anchor relocation is necessary, it establishes an
N4 session with the new UPF. The RAN is informed of the new N3 GTP tunnel
endpoint, and switches the uplink path to the new UPF. The SMF may
subsequently instruct the UPF to assist with update of DN switch forwarding
tables.
Figure 6.11.2-1: Procedure for anchor change
Initially, the Ethernet PDU Session is established with the user data going
via the Source UPF. The Source UPF acts as the PSA.
1\. The Source UPF informs the SMF about the Ethernet context, i.e. any
information maintained related to the Ethernet network that the UPF interfaces
with. Specifically, this contains the MAC address (or addresses) , and
possibly the VLAN tag that the UPF has learned from the UE side. In case of
any changes in the Ethernet context, the change is updated to the SMF so that
the SMF maintains an up-to-date copy of the Ethernet context in the UPF. This
signaling may be realized based on the N4 reporting procedure. Note that SMF
notification about the MAC address in use is already defined for Ethernet PDU
Sessions. As specified in TS 23.501 [2], clause 5.8.2.5: \"The SMF may ask to
get notified with the source MAC addresses used by the UE and provide UPF with
corresponding forwarding rules related with these MAC addresses.\" The
solution here works no matter whether the MAC forwarding rules are provided to
the UPF by SMF or not.
2\. The UPF\'s report is acknowledged.
3-5. Handover procedure may take place, including path switch signalling to
the AMF and corresponding signalling to SMF.
6\. The SMF decides that the PSA is to be changed for the Ethernet PDU
Session, and selects the Target UPF that will act as the new PSA. The decision
may be triggered by a mobility event, such as receiving the message in step 5.
7\. The Target UPF N4 session is established. The SMF provides the N3 tunnel
endpoint used by RAN.
8\. The establishment of the new N4 session is acknowledged from the Target
UPF to the SMF. The UPF provides its N3 tunnel endpoint.
> 9-10. In case of a handover, the SMF signals to the gNB via the AMF to
> provide the Path Switch Request Ack, which includes the update of the uplink
> N3 tunnel endpoint to the target UPF.
>
> 11-12. If there is no handover, but the UE is in connected mode, the SMF
> sends PDU Session Modify Request message to the RAN via the AMF, which
> includes the update of the uplink N3 tunnel endpoint to the target UPF. The
> RAN acknowledges the message.
After steps 9-10 or 11-12, uplink frames pass via the target UPF. Downlink
frames may continue to be delivered from the source UPF to the gNB. In case of
handover, the frames are forwarded from the source gNB to the target gNB.
13-14. The SMF sends an N4 Session Modification Request to the Target UPF
which includes the Ethernet context that serves as a trigger for the next step
15. The Target UPF acknowledges by an N4 Session Modification Response.
15\. The Target UPF may assist update of Ethernet forwarding tables in the DN
via a variety of mechanisms, the use of which are specific to the DN and the
specification of which are out-of-scope for 3GPP. The UPF may for example
issue a Gratuitous ARP (GARP) containing the MAC address(es) of the UE that
has switched to the new anchor, or the UPF may send an unsolicited Neighbor
Discovery Protocol (NDP) Neighbor Advertisement message indicating the UE MAC
addresses, or the UPF may generate a user plane frame with the UE\'s MAC
addresses (and possibly its VLAN tag) and configurable payload which will be
dropped by endhosts, or the UPF may send another message or frame compatible
with DN protocols.
In the case of a central controller in the Ethernet network which sets the
forwarding tables, the central controller may be instructed that the given MAC
address is reachable at the new location. When multiple MAC addresses are
present in the Ethernet context, this step may be repeated for each MAC
address.
16\. The N4 session is released at the Source UPF. The source UPF may wait for
a configurable period before it stops delivering downlink frames for the given
PDU Session.
17\. The N4 session release is acknowledged from the Source UPF to the SMF.
NOTE: The procedure does not send an end marker to RAN. RAN should be
configured such that it does not expect such an end marker and may decide to
deliver downlink frames coming on the new user plane path even before the end
of downlink frames on the old path.
### 6.11.3 Impacts on Existing Nodes and Functionality
The solution has the following impact on the nodes:
SMF:
\- Store the Ethernet context including one or more MAC addresses based on
reporting from the UPF.
\- Decide to establish new PSA and release old PSA for the Ethernet PDU
Session.
UPF:
\- Report the Ethernet context including one or more MAC addresses.
\- Update the Ethernet forwarding in the Ethernet subnetwork after the SMF has
established a new N4 session at a new UPF and the Ethernet context has been
sent to the new UPF.
RAN:
\- Be configured not to expect an end marker for the Ethernet PDU Session.
### 6.11.4 Solution Evaluation
Editor\'s note: This clause provides an evaluation of this solution.
## 6.12 Solution #12 for Key Issue #3: Ethernet PDU Session Anchor Relocation
### 6.12.1 Description
NOTE: This solution has been merged into Solution #11. It will not be updated
anymore.
This solution addresses Key Issue #3: Enhancement of Session Continuity during
UE Mobility, which \"focuses on enhancing session continuity while maintaining
UP efficiency\". To achieve low latency for URLLC, close proximity between the
PDU Session Anchor and the access node is required. Maintaining this proximity
as the UE moves will at times require re-anchoring of the PDU session. The
solution also supports Key Issue #1: Supporting high reliability by redundant
transmission in user plane, as the ability to re-anchor a PDU session
facilitates establishing and maintaining multiple paths to the UE.
In Release 15, procedures were defined in TS 23.502 [3] to allow for change of
the PDU session anchor according to the PDU Session SSC Mode. For SSC mode 2,
the network may trigger the release of a PDU session and then instruct the UE
to immediately establish a new PDU Session to the same DN, at which point a
new PDU Session anchor may be selected. For SSC mode 3, the network allows the
establishment of UE connectivity via a new PDU Session Anchor to the same DN
before connectivity between the UE and the previous PDU Session Anchor is
released. In both cases the PDU session anchor is transferred to a new UPF as
illustrated in Figure 6.12.1-1. For IP PDU Sessions the UE is allocated an IP
address corresponding to the prefix/subnet of the PDU session anchor. When the
anchor changes, the old IP address may be released and a new one assigned to
the UE. The process is message intensive (as many as 30+, counting optional
messages) and requires signaling with the UE.
Figure 6.12.1-1: Ethernet PDU Session Anchor Relocation
For Ethernet PDU sessions, a PDU Session re-anchor does not require a UE
address change as the UE MAC address is not tied to the network topology.
Forwarding of Ethernet frames is based on MAC learning or other mechanisms to
update the forwarding tables of switches in the DN. Re-anchor of Unstructured
Data PDU Sessions in which UE identifiers are not associated with the PDU
Session anchor also does not impact the UE. Hence for these non-IP PDU
Sessions, altering a data path to a new PDU session anchor may be achieved by
updating forwarding tables rather than through 3GPP signaling. For Ethernet
PDU sessions, well established protocols to update switch paths may be used.
Observation 1: PDU session anchor change for Ethernet PDU Sessions does not
require signaling with the UE.
In current TS 23.502 [3] procedures, the SMF determines that the serving PDU
Session anchor needs to be changed. Specific event triggers are not specified;
hence the SMF has the flexibility to change the anchor according to the needs
of various use cases. For URLLC, UE mobility may be a frequent trigger for
changing the anchor point, however other events should not be excluded. For
example, the SMF could decide to relocate an Ethernet PDU Session anchor for
load balancing or rebalancing, because a different UPF provides a data path
with greater reliability, because a different UPF is more suitable for meeting
QoS requirements, for maintenance, because a UPF resides in a specific
jurisdiction, or for other reasons.
Observation 2: Currently any event can trigger the SMF to relocate a PDU
session anchor. A variety of triggers can be useful for URLLC Ethernet PDU
Sessions.
For switches upstream of the UPF, normal Ethernet networking applies after a
PDU session anchor has relocated to a new UPF. When a new UPF sends a DN
switch an uplink packet containing a UE MAC address, the switch updates its
forwarding table so that downlink packets are forwarded to the new UPF. In the
absence of uplink packets from the UE, the downlink path may still be updated
by having the new UPF issue Gratuitous ARPs (ARP Requests) containing the MAC
address(es) of the UE that has switched to the new anchor. The MAC address(es)
may be obtained via 3GPP signalling from the old UPF. The switch table updated
changes the downlink path from the old UPF to the new UPF. Note that the
gratuitous ARP is sent by the UPF only towards the DN.
Observation 3: Ethernet PDU Session relocation may be further optimized by the
new UPF issuing to the DN, an ARP containing MAC address(es) of the UE. The
ARP updates switch forwarding tables so that in the absence of an uplink
packet from the UE, downlink packets are sent to the new UPF.
For IPv6 networks Neighbor Discovery Protocol (NDP) Neighbor Advertisement
messages (unsolicited) may be used in place of ARP.
### 6.12.2 Procedures
This solution proposes Ethernet PDU Session Anchor relocation that eliminates
signaling with the UE. The procedure is greatly simplified compared to release
15 while flexible triggering of the SMF to select a new anchor UPF for any
reason is maintained. Because signalling is not required with the UE, a
procedure for SSC Mode 2, where the old PDU session anchor is released before
a new anchor is setup, is no longer needed.
When the SMF decides that an anchor relocation is necessary, it establishes an
N4 session with the new UPF. The RAN is informed of the new N3 GTP tunnel
endpoint, which switches the uplink path to the new UPF. The SMF may then
obtain from the old UPF, the UE MAC addresses of packets sent via the old
path. The SMF subsequently requests that the new UPF issue a gratuitous ARP
for the MAC addresses of the UE.
The sequence is shown in Figure 6.12.2-1.
Figure 6.12.2-1: Ethernet PDU Session Relocation
1\. The SMF determines that the UE will be better served by UPF2.
2\. The SMF sets up the new Ethernet PDU Session Anchor in UPF2 by sending an
N4 Session Establishment Request, providing UPF2 with the RAN N3 tunnel
endpoint of the PDU Session.
3\. The SMF sends a UPF Path Switch Request to the RAN. The SMF provides the
RAN with the IP@ and TEID for UPF2. The RAN sends uplink packets through the
tunnel to the new PDU Session anchor in UPF2. Responses to those packets are
sent back to UPF2 (e.g. via switch data plane learning in the DN).
4\. The SMF sends UPF1 an N4 Anchor Change Notification.
4b. UPF1 responds to the SMF with a N4 Anchor Change Notification Ack. The Ack
contains UE MAC Address(es) learned from packets that traversed the UPF1 PDU
session anchor. From this point onwards, UPF1 forwards DL data towards UPF2
for delivering towards the UE (for a preconfigured duration). The UPF1
releases the resources after data forwarding complete (for a preconfigured
duration).
5\. The SMF sends UPF2 a DN Update Request containing the UE MAC Addresses
received in Step 5.
6\. In order to ensure DN switches will forward downlink packets to UPF2
instead of UPF1, UPF2 sends to the DN a Gratuitous ARP, an unsolicited NDP
Neighbor Advertisement or other message compatible with DN protocols.
NOTE: Gratuitous ARP/ND assumes that the SMF/UPF can detect that the PDU
Session of Ethernet type is used for IP traffic based on User plane traffic
inspection.
Editor\'s note: whether STP (spanning tree protocol) or some other protocol is
used for informing the DN regarding PSA anchor change is FFS.
Editor\'s note: how UPF relocation can be integrated along with HO procedure
is FFS.
### 6.12.3 Impacts on Existing Nodes and Functionality
The solution has the following impact on the nodes.
UE: No Impact.
AMF: No Impact - messages to SMF are sent via transparent container.
SMF:
\- Request MAC addresses from old UPF and Transport it to a new UPF.
UPF:
\- Record/Store UE MAC addresses for each PDU Session and send them on N4 when
requested by SMF.
\- Send a Gratuitous ARP or UL Packet on N6 informing upstream switches to
update their forwarding tables to the new UPF.
### 6.12.4 Solution Evaluation
Editor\'s note: This clause provides an evaluation of this solution.
## 6.13 Solution #13 for Key Issue #3: Session continuity enhancement based on
the coordination between AF and 5GC
### 6.13.1 General Description
This solution addresses the problem in the key issue 3 regarding \"How to
enable runtime coordination between AF and 5GC for supporting application
relocation without breaking upper layer session and service continuity\".
In order to enable low latency service in the 5GC, a UE may establish a SSC
mode 3 PDU session, or a PDU session with UL CL or branch point. In this case,
if the PDU sessions anchor (PSA) needs to be relocated due to UE mobility, the
SMF needs to select a new PSA.
In order to avoid or minimize service interruption during PSA relocation, the
solution proposes that, after the SMF prepares the UP path towards the new
PSA, the SMF does not activate the UP path toward the new PSA immediately.
Instead, the SMF sends a notification to the Application Function (AF). Before
the UP path toward the new PSA is activated, application traffic data (if any
exists) is routed through the old PSA..
The notification sent from the SMF to the AF indicates UP path management
events as described in the TS 23.502 [3], such as \'PSA change\' or \'DNAI
change\'. The AF can determine whether application relocation is needed
according to the notification. If not, the AF can send a positive response to
the notification, indicating application layer is ready, to the SMF
immediately; otherwise, the AF sends the positive response after application
relocation is completed or a negative response if the AF determines that the
application relocation cannot be completed on time (e.g. due to temporary
congestion). Once the SMF receives the positive AF response, the SMF activates
the UP path toward the new PSA. After the UP path toward the new PSA is
activated, data is routed through the new PSA. If the SMF receives a negative
response, the SMF can cancel the PSA relocation.
The SMF can assume according to local policy a negative response if a response
is expected and but not received from the AF within a certain time window.
### 6.13.2 Procedures
#### 6.13.2.1 Procedure of Enhancing SSC mode 3 PDU Session Anchor Change with
Multiple PDU Sessions
Figure 6.13.2.1-1: Procedure of Enhancing SSC mode 3 PDU Session Anchor Change
with Multiple PDU Sessions
1-2. The SMF determines to select a new target UPF as the new PSA based on the
UE location or DNAIs received from an AF, e.g. after the handover.
NOTE 1: While providing the DNAIs via PCF and NEF as specified in Clause 4.3.6
TS 23.502, according to the local policies, the AF may also indicate a
preference of maintaining UE IP address. The SMF may take this indication into
account to determine whether PSA change is needed.
3\. In the case of early notification, the SMF send a notification indicating
PSA change and/or DNAI change for a UE (identified by the IP address/prefix of
the UE or the MAC address used by the UE) to the AF. The AF determines whether
the application layer service needs to be relocated for the UE based on the
info of new PSA or DNAI, if not, the AF can send back a positive response
immediately, otherwise, the AF responds the SMF with an ACK (a positive
response) after the application relocation is completed successfully. If the
AF sends a negative response, the SMF may decide to cancel the following PSA
relocation.
NOTE 2: The SMF determines according to local policy whether to wait for a
response from the AF before continuing with the procedure of PSA relocation.
NOTE 3: The AF behaviours on handling application relocation are out of scope
of this study. However, target AS, located in target data network may be
associated with local AF instance (called T-AF). In such cases, SMF/AF cancels
earlier subscribed user plane management event notifications and T-AF
subscribes to user plane management event notifications.
4\. SMF starts the procedure for change of SSC mode 3 PDU session anchor with
multiple PDU sessions as defined in clause 4.3.5.2 in TS 23.502 [3].
5\. In the case of late notification, the SMF send notification indicating PSA
change or DNAI change for the UE to the AF. The AF determines whether
application relocation is required for the UE based on the info of new PSA or
DNAI, if not, the AF can send back a positive response immediately, otherwise,
the AF responds the SMF with an ACK (a positive response) after the
application relocation is completed successfully.
6\. SMF releases the old PDU session after the new PDU session is established
and a positive response is received from the AF.
NOTE 4: The SMF can assume according to local policy a negative response if a
response is expected and but not received from the AF within a certain time
window at the step 3 or step 5.
#### 6.13.2.2 Procedure of Session Continuity Enhancement for a PDU Session
with UL/CL or BP
Figure 6.13.2.2-1 illustrates the procedure of using the coordination between
AF and 5GC to enhance the session continuity for a PDU session with UL CL or
BP.
Figure 6.13.2.2-1: Session continuity enhancement based on the coordination
between AF and 5GC
NOTE 1: The remote PDU session anchor exists but is not shown in the Figure
6.13.2.2-1.
1-2. The SMF determines to select a new target UPF as the new PSA based on the
UE location or DNAI, e.g. after the handover.
3\. In the case of early notification, the SMF send a notification indicating
PSA change and/or DNAI change for a UE (identified by the IP address/prefix of
the UE or the MAC address used by the UE) to the AF. The AF determines whether
the application layer service needs to be relocated for the UE based on the
info of new PSA or DNAI, if not, the AF can send back a positive response
immediately, and then step 7 or 12 is not executed. If the AF sends a negative
response in step 3b, the SMF may decide to cancel the following PSA
relocation.
NOTE 2: The SMF determines according to local policy whether to wait for a
response from the AF before proceeding to configure the UP path toward the new
PSA.
NOTE 3: The AF behaviours on handling application relocation are out of scope
of this study. However, target AS, located in target data network may be
associated with local AF instance (called T-AF). In such cases, SMF/AF cancels
earlier subscribed user plane management event notifications and T-AF
subscribes to user plane management event notifications.
4-5. Based on the new selected PSA, if UL CL or BP is used, the SMF may also
determine to select a new UPF to act as UL CL or BP, and then selects a new UL
CL or BP further. The SMF establishes CN tunnel between the new UL CL or BP
and the new PSA if UL CL or BP is used.
Steps 6 to 9 are only applied to UL CL case:
6\. In the case of late notification, the SMF send notification indicating PSA
change or DNAI change for the UE to the AF. The AF determines whether
application relocation is required for the UE based on the info of new PSA or
DNAI, if not, the AF can send back a positive response immediately and step 7
is not executed.
NOTE 4: The SMF determines according to local policy whether to wait for a
response from the AF before proceeding to configure the UP path toward the new
PSA.
7\. (Optional) In the case of application relocation, if the application
relocation is completed successfully, the AF responds the SMF with an ACK (a
positive response) which may include N6 traffic routing information,
otherwise, the AF sends a negative response, and the SMF cancels the following
PSA relocation without configuring the UP path toward the new PSA.
8\. Once the SMF receives the positive response in step 7 from the AF, the SMF
updates the new PSA using the received N6 traffic routing information, and
activates the UP path toward the new PSA (PSA2).
9\. The SMF activates the UP path toward the new PSA by sending N3 CN tunnel
info of new UL CL to the RAN node, which is similar as the step 6 in Figure
4.3.5.4-1 in TS 23.502 [3].
Steps 10 to 14 are only applied to BP case:
10\. The SMF sends CN tunnel info of the new BP to the RAN node to establish
the CN tunnel between the RAN and the BP, which is similar as the step 6 in
Figure 4.3.5.4-1 in TS 23.502 [3].
11-13. Similar as steps 6 - 8.
14\. The SMF activates the UP path toward the new PSA by providing new
allocated IPv6 prefix to the UE.
15-16. The SMF release the UP path toward the old PSA.
NOTE 5: The SMF can assume according to local policy a negative response if a
response is expected and but not received from the AF within a certain time
window after the step 3a, step 6a or step 11a.
### 6.13.2 Impacts on Existing Nodes and Functionality
In the SMF:
\- Wait for a response from the AF according to local policy after sending a
UP path management event notification to the AF.
\- Maintain old UP path while waiting for the response and take actions
according to the response: activate the new UP path (including configuring N6
traffic routing info received in the AF response into PSA) or cancel the PSA
relocation.
In the AF:
\- Indicate an AF preference of maintaining UE IP address to the 5GC.
### 6.13.3 Solution Evaluation
This solution relies on runtime coordination between the SMF and the AF to
enable the SMF to maintain the old UP path and switch traffic to new UP path
only after being confirmed by the AF that the application layer is ready,
which ensures session continuity and minimizes service interruption.
## 6.14 Solution #14 for Key Issue #2: Lossless handover by timing
coordination with multiple UEs per device
### 6.14.1 Description
This solution is an extension of Solution #2 described in clause 6.2 which
provides redundancy against failures using two UEs in the device by setting up
two independent paths via different gNBs in RAN. The solution provided here
extends Solution #2 to protect against handover losses in order to address
also Key Issue #2 in addition to addressing Key Issue #1.
The two redundant paths can help improve the handover performance, since even
if one of the paths suffers from a period of disruption during handover, the
other path can still deliver the packets uninterrupted. For this, it is
necessary to co-ordinate the handover timing at the gNBs where the UEs of the
devices are connected.
The Reliability Grouping concept in solution #2 is extended for handover
timing co-ordination: each Reliability Group is assigned with preferred time
periods for handover, so that these periods are disjoint for the Reliability
Group. A UE in given reliability group will therefore be preferably scheduled
for handover at a different time than a UE in another reliability group. E.g.,
periods of 100ms can be defined, so that for UEs in reliability group 1
handover are preferably started at odd periods, while for UEs in reliability
group 2 handovers are preferably started at even periods. Note that the
solution defines preferences, and in typical circumstances it can be possible
to defer the handover for a short duration; but in cases where the radio link
quality is quickly deteriorating, it is more important to perform handover as
soon as possible and in such circumstances the preference may be ignored.
The proposed handover coordination solution provides a simple extension to
enhance then handover performance without applying complex signalling
sequences and introducing additional handover timing coordination
functionality. The extension allows the mobile operator to make good use of
the redundant paths in a mobile system. While such redundant paths are set up
to provide redundancy against node and link failures, in a mobile system the
volatile handover process may be the one which is could most often actually
cause disruption, hence the mechanisms for redundant user plane paths are made
good use of.
The figure below shows the solution architecture, with the Redundancy Grouping
1 (green) and 2. Using Solution #2, it is ensured that both UE1 and UE2
connect to gNBs in the same group. In the example shown below, UE1 performs
handover from gNB1.1 to gNB1.2, while UE2 performs handover from gNB2.1 to
gNB2.2. The solution relies on pre-configured schedules in the gNBs on when
the handover for a UE in group 1 or in group 2 can be started. By keeping
these schedules, the handover times of the UEs within the same device can be
made different.
{width="4.139583333333333in" height="3.4541666666666666in"}
Figure 6.14.1-1: Reliability group-based redundancy concept in RAN
### 6.14.2 Procedures
The solution consists of the following steps.
\- A priori configuration is used to configure preferred handover periods in
each gNB for each reliability group. These preferred handover periods should
be sufficiently long to allow handovers to be completed, and should be
possible to be kept by the gNBs given the existing time synchronization; yet
the preferred handover periods should not be too long to avoid having to wait
too long with handovers.
\- When a gNB determines that handover needs to take place for a UE which is a
member of a reliability group (hence, we know that the UE is in a device
equipped with multiple UEs), the gNB, whenever possible, schedules the
handover in a preferred handover period corresponding to the reliability group
(RG) of the given UE. That is, if the start of the handover would not be
within the preferred handover period for the given RG, the gNB defers the
handover until the start of the next preferred handover period for the given
UE\'s RG. The deferral only applies to the execution of the handover, while
the handover preparation can be done immediately. The RG of the UE is stored
in the UE context based on information received from the CN.
### 6.14.3 Impacts on Existing Nodes and Functionality
In addition to the solution described in Key Issue #1, Solution #2, the
following additional implementation impacts occur from this solution.
RAN impacts:
\- Pre-configuration of preferred handover timing periods for each reliability
group.
\- Possible deferral of the handover so that it falls within a preferred
handover period whenever possible.
### 6.14.4 Solution Evaluation
\- Low impact extension of Solution #2 for Key Issue #1 provides a solution
also for Key Issue #2 in a single solution framework.
\- No need for additional RAN signalling for handover co-ordination.
\- Possibility for limited deferral of the handover even if other UE of the
same device does not perform handover.
\- Lossless communication can be ensured even when the handover would imply
temporary disruption.
\- Lossless communication can be ensured even when one of the UEs experiences
radio link failure.
## 6.15 Solution #15 for Key Issue #6: Division of E2E PDB
### 6.15.1 Description
This solution applies to key Issue #6. In the solution, besides of current PDB
(i.e. PDB between UE and PSA UPF), the SMF will provide the RAN with the PDB
between the PSA UPF and the RAN (i.e. PSA-RAN PDB), so that the RAN nodes can
take it into account when deriving AN PDB.
NOTE: Operator shall ensure the backhaul delay can satisfy the PSA-RAN PDB
configured on the SMF.
The SMF is locally configured by the OAM with the packet delay budgets between
a specific RAN node and an PSA UPF (i.e. PSA-RAN PDB) for different 5QIs. The
SMF can provide the RAN with the PSA-RAN PDB for a QoS Flow during the PDU
Session Establishment procedure, the PDU Session Modification procedure or the
Service Request procedure.
### 6.15.2 Procedures
#### 6.15.2.1 PDB provisioning during PDU Session Establishment /Modification
or Service Request procedure
Figure 6.15.2.1-1 depicts the enhanced PDB provision for a URLLC QoS Flow
during PDU Session Establishment /Modification procedure and Service Request
procedure.
Figure 6.15.2.1-1: Enhanced PDB provisioning for a URLLC QoS Flow
During UE triggered Service Request procedure, steps 1-22b from clause 4.2.3.2
in TS 23.502 [3] are performed with the following differences:
\- In steps 11-12, the PSA-RAN PSA-RAN PDB together with PDB for each QoS Flow
may be included in the N2 SM information and provided to the RAN node as
depicted in step 2a and step 3 in Figure 6.15.2.1-1.
During Network triggered Service Request procedure, steps 1-7 from clause
4.2.3.3 in TS 23.502 [3] are performed with the following differences:
\- In step 3a, the PSA-RAN PDB together with PDB for each QoS Flow may be
included in the N2 SM information and sent to the AMF via
Namf_Communication_N1N2MessageTransfer request as depicted in step 2b in
Figure 6.15.2.1-1.
\- In step 4a, when the steps 12 to 22 in UE Triggered Service Request
procedure in clause 4.2.3.2 in TS 23.502 [3] are invoked, the PSA-RAN PDB
together with PDB for each QoS Flow may be included in the N2 SM information
and sent to the RAN node via N2 Session Request as depicted in step 3 in
Figure 6.15.2.1-1.
\- In step 6, when the steps in UE Triggered Service Request procedure in
clause 4.2.3.2 in TS 23.502 [3] are invoked, the PSA-RAN PDB together with PDB
for each QoS Flow may be included in the N2 SM information and provided to the
RAN node as depicted in step 2a and step 3 in Figure 6.15.2.1-1.
During UE requested PDU Session Establishment procedure, steps 1-20 from
clause 4.3.2.2.1 in TS 23.502 [3] are performed with the following
differences:
\- In steps 11-12, the PSA-RAN PSA-RAN PDB together with PDB for each QoS Flow
may be included in the N2 SM information and provided to the RAN node as
depicted in step 2b and step 3 in Figure 6.15.2.1-1.
During UE or network requested PDU Session Modification procedure, steps 1-13
from clause 4.3.3.2 in TS 23.502 [3] are performed with the following
differences:
\- In step 3a, 3b and step 4, the PSA-RAN PSA-RAN PDB together with PDB for
each QoS Flow may be included in the N2 SM information and provided to the RAN
node as depicted in step 2a, 2b and step 3 in Figure 6.15.2.1-1.
After RAN receive PSA-RAN PSA-RAN PDB and PDB for the QoS Flow, RAN can derive
PDB for RAN part of this QoS Flow accordingly.
NOTE 1: If standardized 5QI is used for the QoS Flow, the PDB in the N2
information is omitted, but the PSA-RAN PDB may still be included.
NOTE 2: The PSA-RAN PDB is only apply to QoS Flows of Delay Critical GBR
resource type.
### 6.15.3 Impacts on Existing Nodes and Functionality
SMF:
\- The SMF provides PSA-RAN PDB for a QoS Flow to the NG-RAN node during PDU
session establishment/modification or service request procedures.
RAN: Derive the PDB of RAN part based on the received PDB and PSA-RAN PDB.
### 6.15.4 Solution Evaluation
With this solution, SMF needs to be configured with PSA-RAN PDB and RAN node
can obtain PSA-RAN PDB for a specific QoS Flow via N2 information from SMF, so
that RAN can derive PDB for RAN part by taking it into account. If PSA-RAN PDB
is not used in N2 signalling the PSA-RAN PDB decided as in existing Rel-15 PDB
mechanism.
## 6.16 Solution #16 for Key Issue #7: Automatic GBR service recovery after
handover
### 6.16.1 Description
During the Handover Preparation phase, an additional attribute \"GBR required
as soon as possible\" is proposed to be sent by the Source RAN node to the
Target RAN node in the Xn/N2 interface signalling when the existing
\"notification control\" QoS attribute is sent.
With this new QoS attribute, at handover, the Target RAN node will perform
admission control for the GBR flow. If the GBR admission control fails, the
Target RAN node performs admission control for that flow as a \'best effort\'
(e.g. QFI=8) flow.
The signalling from the Target RAN to the Source RAN node is extended to
indicate which GBR flows are able to be established with the correct target
QoS, and which GBR flows are accepted with a best effort QoS.
If the GBR flow(s) could not be admitted with the proper GBR QoS, the Source
RAN node can consider whether other candidate Target RAN nodes are available.
The Source RAN may then perform Handover Preparation with other candidate
Target RAN nodes, and if successful, the Source RAN node cancels the earlier
handover attempt.
Upon handover completion in a congested RAN node the new RAN node notifies the
CN that the GBR QoS cannot be met and sends another notification when the GBR
QoS can again be guaranteed for that flow.
In the handover instruction that the target RAN node prepares for the source
RAN node to send to the UE, the target RAN node may map the GBR QFI (that is
accepted with a best effort QoS) to a Logical Channel Identifier that is not
shared with other flows, or, may make a different choice. After the UE
accesses the target RAN Node:
\- in the latter case, an RRC Reconfiguration is likely to be needed when the
GBR QoS is subsequently restored;
\- in the former case the RAN node can choose whether or not to allocate any
uplink resources;
\- in both cases, the RAN can choose whether or not to allocate any downlink
resources to that GBR QFI. If downlink resources are not going to be
allocated, then, as an option, the SMF could be requested (via a notification
command) to request the UPF to discard the downlink packets (and may record
corresponding information on the CDR).
The target RAN node to UE signalling may also carry an RRC indication that is
to be passed to the UE\'s NAS layer to inform the UE\'s NAS that the GBR QoS
will not be immediately available. After the handover, when the GBR QoS is
able to be restored, the RAN node sends an indication of the restoration of
QoS to the UE, e.g. using new Rel-16 RRC signalling.
NOTE: The above new Rel-16 RAN signalling functionality that informs the UE\'s
NAS layer about N2 interface GBR Notification signalling should be extended to
also cover the non-handover \'Notification\' situations that exist in Rel-15.
### 6.16.2 Procedures
These are readily derivable from the above description.
### 6.16.3 Impacts on Existing Nodes and Functionality
AMF:
\- no impact unless the \"Notification of lack of GBR QoS\" is piggy-backed on
the Path Switch Request rather than being sent immediately afterwards.
PCF:
\- no impact if this is developed as an extension of Rel-15 Notification
Control. Impact expected if this is developed as an alternative to Rel-15
Notification Control.
SMF
\- Impact expected if this is developed as an alternative to Rel-15
Notification Control.
Impact also expected if RAN wants SMF to get UPF to discard downlink packets.
UPF:
\- existing data forwarding functionality can probably be re-purposed if the
RAN wishes to have the core network discard downlink packets.
RAN:
a) the main \"radio resource scheduler\" functionality is common with Rel-15.
b) NG-RAN implementation will be impacted (For example, updates to the
\"controller\" of the admission control process are needed, e.g. to re-run the
admission control process once every 500 ms for UE\'s with \"notified\"
(suspended) GBR QoS Flows.)
c) new RRC signalling to keep the UE\'s NAS aligned with the Notification
status in the Core Network.
d) additional parameter in Xn/N2 signalling to indicate to the source RAN node
the new handling of this GFBR flow at the target RAN node.
UE (that co-exists with Rel-15 Notifications sent for GBR flows)
a) new RRC signalling to keep the UE\'s NAS aligned with the Notification
status in the Core Network.
### 6.16.4 Solution Evaluation
Editor\'s note: This clause provides an evaluation of this solution.
## 6.17 Solution #17 for Key Issue #6: Configuration of CN PDB in NG-RAN
### 6.17.1 Description
This solution applies to key Issue #6. In the solution, the PLMN operator with
OAM configure locally at the NG-RAN the packet delay budgets between a
specific RAN node and PSA UPF for different 5QIs in RAN node. The
configuration can be based on a variety of inputs: IP address of the N3 UPF,
TEID range etc. There is no normative SA WG2 work for this option.
### 6.17.2 Impacts on Existing Nodes and Functionality
RAN: Configure the PDB between a specific RAN node and PSA UPF with O&M. The
configuration can be based on a variety of inputs: IP address of the N3 UPF,
TEID range etc
### 6.17.3 Solution Evaluation
If there is no direct connection between PSA UPF and N3 UPF and I-UPF is
inserted for the PDU session, the RAN cannot be aware of the transient delays.
In that case the SMF can select the specific I-UPF and the operator can also
evaluate the PDB between the RAN node and PSA UPF with I-UPF and configure the
value in the NG-RAN based on statistical analysis of the average I-UPF to PSA
UPF delay.
While this configuration, based solution is still not deterministic since the
transport delays cannot be accurately predicted, the benefit of RAN
configuration is that there is no impact to SMF and N2 signalling message,
there is no normative work in SA WG2 since the configuration can be done
locally in the RAN using O&M methods. The benefit of this solution compared to
what is supported in Rel-15 (standardised CN PDB per 5QI) is that it allows
somewhat more accurate prediction of the CN PDB between the specific NG-RAN
node and specific PSA UPF.
## 6.18 Solution #18 for Key Issue #6: Deterministic solution based accurate
time stamping of packets in downlink
### 6.18.1 Description
This solution applies to Key Issue #6.
In this solution, it is assumed that time synchronisation using TSN is applied
between RAN and PSA UPF e.g. as defined in solutions 8 and 11 of TR 23.734
[14].
When the DL PDB monitoring is activated, the PSA that is time synchronised
using TSN adds the accurate time stamping in GTP-U header for the DL packets.
SMF activates the PDB monitoring in PSA according to the request from PCF or
local policy configured in SMF. If the PDB monitoring is created by PCF, the
PCF sends the PDB Monitoring policy via Session Management Policy Modification
procedure to the SMF and instructs the SMF to initiate PDB monitoring for the
QoS Flow.
RAN node calculates the PDB between RAN and PSA UPF according to the received
time stamping in GTP-U header and the current time that received the DL
packet.
In UL this solution requires some predetermined UL CN PDB either signalled
from SMF or locally configured in NG-RAN as defined in other solutions for key
issue #6.
### 6.18.2 Procedures
Editor\'s note: This clause describes services and related procedures for the
solution.
### 6.18.3 Impacts on Existing Nodes and Functionality
SMF:
\- The SMF activates the PDB monitoring for a QoS Flow.
UPF:
\- When the DL PDB monitoring is activated, UPF adds the accurate time
stamping in GTP-U header of packets.
\- Time synchronisation using TSN is applied between RAN and UPF.
RAN:
\- Calculate the PDB between RAN and UPF according to the time stamping in
GTP-U header of DL packets.
\- Time synchronisation using TSN is applied in RAN and UPF.
### 6.18.4 Solution Evaluation
This solution provides deterministic calculation of the \"remaining\" PDB to
RAN for DL packets since the incoming packets are time-stamped. It requires
all UP CN nodes and transport to be time synchronised using the same TSN GM.
The solution can use the same approach as other solutions for UL.
## 6.19 Solution #19 for Key Issue #4: Using control plane procedure on Uu
interface for QoS Monitoring
### 6.19.1 Description
The E2E QoS monitoring can be divided into packet delay on Uu interface and
packet delay on N3/N9 interface. The UL/DL packet delay on Uu interface is in
the scope of \"RAN-centric Data Collection and Utilization for LTE and NR\"
SI. The same mechanism that defined by RAN can be reused to collect the packet
delay on Uu interface. A user plane based solution is used to collect the
packet delay on N3/N9 interface.
#### 6.19.1.1 QoS Monitoring
If the delay is requested to be measured, SMF activates the QoS Monitoring to
UPF and RAN respectively.
SMF indicates to the RAN to start QoS Monitoring via AMF in the
Namf_Communication_N1N2 message transfer message. The SMF indicates to the RAN
via AMF to report the DL and UL packet delay result of Uu interface. SMF may
also indicates to the RAN to activate the N3 delay monitoring procedure.
The SMF determines the QoS parameters and QoS Monitoring events which need to
be monitored and reported by UPF, e.g. one-way/round trip packet delay, and
optionally the corresponding threshold and/or reporting period, and sends them
to UPF via N4 Session modification request.
RAN initiates the measurement procedure of DL and UL packet delay on Uu
interface.
NOTE 5: How does the RAN initiates the DL and UL packet delay procedure
depends on RAN decision.
RAN reports the DL and UL packet delay results of Uu interface to the CN.
**Option 1:** RAN reports the packet delay results of Uu interface to SMF
For this option, RAN reports the DL and UL packet delay with the 5QI to SMF
via N2 signalling. Which N2 signalling is used depends on RAN3\'s decision.
**Option 2:** RAN reports the packet delay results of Uu interface to UPF
For this option, RAN includes the DL/UL packet delay in the GTP-U header of
the UL data packet as described in solution#8.
UPF activates the QoS Monitoring by using newly defined packet as monitoring
packets as option 1 in clause 6.8.1.2.1or actual service packets as monitoring
packets as option 2 in clause 6.8.1.2.2.
According to description in option 1 and option 2, the round trip packet delay
of N3 interface could be calculated by UPF as TRTT-N3 = (T6-T1) - (T5-T2).
For option 1, UPF sends the TRTT-N3 to SMF with the 5QI. SMF calculates the
One way delay and Round trip delay for the 5QI.
For option 2, UPF receives both the packey delay on Uu interface and TRTT-N3.
UPF calculates the One way dealy and Round trip delay.
The packet delays for the 5QI are calculated as below:
\- One way delay 1: DL between the RAN and UE: Calculated by RAN based on the
packet delay mechanism of Uu interface.
\- One way delay 2: UL between the RAN and UE: Calculated by RAN based on the
packet delay mechanism of Uu interface.
\- One way delay 3: DL or UL between the RAN and UPF: [(T6-T1) - (T5-T2)]/2
\- One way delay 4: DL or UL between the UE and UPF: One way delay 1+One way
delay 3 or One way delay 2+One way delay 3.
\- Round Trip Delay 1: Round trip latency between the UPF and UE: One way
delay 1+One way delay 2+TRTT-N3.
### 6.19.2 Procedures
Editor\'s note: This clause describes services and related procedures for the
solution.
### 6.19.3 Impacts on Existing Nodes and Functionality
SMF:
\- SMF triggers the QoS Monitoring in the UPF and RAN respectively:
\- For option 1, SMF receives the DL and UL packet delay results of Uu
interface with the 5QI from RAN. SMF receives the packet delay of N3 interface
with 5QI from UPF.
\- For option 1, SMF calculates the One way delay and Round trip delay for the
5QI.
UPF:
\- Initiates QoS Monitoring for the QoS Flow based on the QoS Monitoring
policy received via N4 message. When the QoS Monitoring events match the
reporting condition, the UPF reports the QoS Monitoring events to the SMF.
RAN:
\- When receiving the monitoring packet delay request, RAN initiates the DL
and UL packet delay measurement for Uu interface:
\- For option 1, RAN sends the DL and UL packet delay measurement result with
5QI to SMF.
\- For option 2, RAN includes the DL and UL packet delay measurement report in
the GTP-U header.
UE:
\- The impacts to UE is depend on RAN\'s decision about DL and UL packet delay
measurement of Uu interface.
### 6.19.4 Solution Evaluation
Editor\'s note: This clause provides an evaluation of this solution.
## 6.20 Solution #20 for Key Issue #7: SMF starts the pending timer for the
non-accepted GBR QoS flow
### 6.20.1 Description
During the Handover Preparation phase, Target RAN node performs admission
control for the QoS flow. If the GBR QoS flow is not accepted by the admission
control, Target RAN node rejects the GBR QoS flows.
Target RAN node sends the non-accepted GBR QoS flow to SMF during handover
procedure. For Xn based HO, the non-accepted GBR QoS flow is included in the
Path Switch Request message. For N2 based HO, the non-accepted GBR QoS flow is
included in the Handover Request ACK message. AMF forwards the information to
the associated SMF.
SMF activates a pending timer based on local configuration for the non-
accepted GBR QoS flow. All new QoS establishment request for the non-accepted
GBR QoS flow is rejected by the SMF when the pending timer is running. SMF can
send the QoS re-establishment request for the non-accepted GBR QoS flow after
the timer expiration.
RAN stores the QoS profile for the non-accepted GBR QoS flow. If RAN recovers
from congestion state, RAN informs the SMF(s) using QoS notification control
message. If pending timer is running in SMF, SMF stops the pending timer and
re-establishes the non-accepted GBR QoS flow for the data transmission by
local policy or QoS rule received from PCF.
### 6.20.2 Procedures
Editor\'s note: This clause describes services and related procedures for the
solution.
### 6.20.3 Impacts on Existing Nodes and Functionality
SMF:
\- SMF activates a pending timer for the non-accepted QoS flow based on local
configuration.
\- SMF maintains context for non-accepted QoS flow until the pending timer
expires.
\- SMF rejects the new QoS flow establishment when the pending timer is
running.
\- SMF establishes the QoS flow for the non-accepted QoS after the pending
timer expiration or receiving the information that RAN is recovery.
RAN:
\- RAN maintains the QoS profile for the non-accepted GBR QoS flow.
## 6.21 Solution #21 for Key Issue #7: Extending notification control for QoS
flow setup and handover
### 6.21.1 Description
The current notification control mechanism is used after the related QoS flow
setting up successfully. Admission control function is performed during QoS
flow setup or handover procedure without taking the notification control
parameter into account. In this solution, we extend the notification control
parameter to be used for the admission control function.
After the interaction with PCF, SMF provides a QoS profile including
notification control parameter to AN to setup a new QoS Flow. With the
notification control parameter, AN performs admission control but will not
reject the QoS Flow due to radio resource limitation. AN responds to SMF that
the QoS Flow is setup successfully, and whether the GFBR can be guaranteed. If
the GFBR can\'t be guaranteed, SMF may further modify or release the QoS Flow
after the interaction with PCF. AN keeps trying to allocate radio resource for
this QoS Flow, once the radio resource is efficient, AN indicates to SMF and
the related service can be used immediately.
During a handover, the notification control parameter is provided by the
Source RAN to the Target RAN node in the QoS profile, the Target RAN node
performs admission control but will not reject the QoS Flow due to radio
resource limitation. The Target RAN indicates to the Source RAN and CN that
the QoS Flow is setup successfully, and whether the GFBR can be guaranteed. If
the GFBR can\'t be guaranteed, SMF may further modify or release the QoS Flow
after the interaction with PCF. The Target RAN keeps trying to allocate radio
resource for this QoS Flow, once the radio resource is efficient, The Target
RAN indicates to SMF and the related service can be used immediately.
### 6.21.2 Procedures
The PDU session establishment procedure as described in TS 23.502 [3], clause
4.3.2.2 is reused with the difference that AN may indicate to SMF at step 14
and step15 that the QoS Flow is setup successfully but the GFBR can\'t be
guaranteed.
The PDU session modification procedure as described in TS 23.502 [3], clause
4.3.3.2 is reused with the difference that AN may indicate to SMF at step 6
and step7a that the QoS Flow is setup successfully but the GFBR can\'t be
guaranteed.
The Xn based inter NG-RAN handover procedure as described in TS 23.502 [3],
clause 4.9.1.2 is reused with the difference that at handover preparation
phase, the Target RAN may indicate to the Source RAN that the QoS Flow is
setup successfully, but the GFBR can\'t be guaranteed. The Target RAN may
indicate to SMF at step 1 and step2 that the QoS Flow is setup successfully
but the GFBR can\'t be guaranteed.
The inter NG-RAN node N2 based handover procedure as described in TS 23.502
[3], clause 4.9.1.3 is reused with the difference that the Target RAN may
indicate to the Source RAN that the QoS Flow is setup successfully, but the
GFBR can\'t be guaranteed. The Target RAN may indicate to SMF at step 10 and
step11a, clause 4.9.1.3.2, that the QoS Flow is setup successfully but the
GFBR can\'t be guaranteed.
### 6.21.3 Impacts on Existing Nodes and Functionality
The current notification control parameter is extended to be considered for
admission control.
NG-RAN:
\- Performs admission control with taking the notification control parameter
into account.
\- Indicates to the source RAN and SMF that QoS Flow is setup successfully,
and whether the GFBR can be guaranteed.
SMF:
\- Receiving the indication from NG-RAN that the QoS Flow is setup
successfully, and whether the GFBR can be guaranteed. If the GFBR can\'t be
guaranteed, SMF follows the current notification control mechanism.
### 6.21.4 Solution Evaluation
Editor\'s note: This clause provides an evaluation of this solution.
## 6.22 Solution #22 for Key Issue #7: Automatic GBR service recovery after
handover
### 6.22.1 Description
This solution applies to key Issue #7 \"Automatic GBR service recovery after
handover\".
At Xn or N2 handover, the target NG-RAN applies admission control and if it
cannot support the required GBR QoS, the target NG-RAN does not establish that
QoS Flow. The QoS Flow that was not accepted in the target NG-RAN, i.e. its
establishment was failed, is informed to the SMF during the handover
procedure.
In this solution, for the non-accepted GBR QoS Flow(s), the SMF requests the
target NG-RAN to enable QoS Notification Control (QNC) which is called \"QNC
for GBR Service Recovery\". This request can be made during Xn or N2 handover
procedure or PDU Session Modification procedure after the handover is
complete. The SMF shall request this QNC when the QoS Notification Control
parameter is set in the PCC rule (received from the PCF) that is bound to the
non-accepted QoS Flow. During the Xn or N2 handover procedure, the target NG-
RAN does not send a notification informing the SMF that the GFBR cannot be
guaranteed for the non-accepted GBR QoS Flow(s).
The proposed QNC is not for GBR QoS Flow successfully established but for non-
accepted GBR QoS Flow and is to recover the non-accepted GBR QoS Flow fast and
in a signal-efficient way when the target NG-RAN is considered to establish
the QoS Flow, e.g. due to congestion resolved.
When the target NG-RAN receives the request about QNC for GBR Service Recovery
for any non-accepted QoS Flow from the SMF, the NG-RAN performs the following:
\- maintains QoS parameters related to the QoS Flow targeted for QNC for GBR
Service Recovery only for QNC purpose (e.g. QoS Flow level QoS parameters);
\- enables QNC for the QoS Flow; and
\- sends a notification informing the SMF that the GFBR can be guaranteed for
the QoS Flow when the NG-RAN determines that the GFBR can be guaranteed for
the QoS Flow.
When the SMF receives the notification from the NG-RAN, the SMF requests the
NG-RAN to establish the QoS Flow, i.e. to add the QoS Flow to the PDU Session,
by triggering a PDU Session Modification procedure. At this time, the SMF
provides the UE with a PDU Session Modification Command to add the QoS Flow to
the PDU Session. This SMF operation may be based on interaction with PCF. When
the NG-RAN receives the QoS Flow establishment request from the SMF, the NG-
RAN establishes the QoS Flow, i.e. associates the QoS Flow with a DRB of the
PDU session.
Editor\'s note: It is FFS whether and how the UE\'s NAS layer is informed that
GBR radio resource has not been allocated for the GBR QoS Flow non-accepted in
the target NG-RAN.
### 6.22.2 Procedures
#### 6.22.2.1 QNC request for GBR Service Recovery during handover
Figure 6.22.2.1-1 shows that a request related to QNC for GBR Service Recovery
is made by the SMF during handover.
Figure 6.22.2.1-1: QNC request for GBR Service Recovery during handover
1\. During the Xn based inter NG-RAN handover without UPF re-allocation
procedure, steps 1-5 from clause 4.9.1.2.2 in TS 23.502 [3] are performed. The
figure only shows one of Xn based handover procedures and other Xn based
handover procedures in TS 23.502 [3] apply.
OR
All steps of the Inter NG-RAN node N2 based handover, Preparation phase
procedure defined in clause 4.9.1.3.2 of TS 23.502 [3] are performed and
during the inter-NG-RAN node N2 based handover, execution phase procedure,
steps 1-10 from clause 4.9.1.3.3 of TS 23.502 [3] are performed.
2\. When sending Nsmf_PDUSession_UpdateSMContext Response to the AMF, the SMF
requests the target NG-RAN to enable QNC for GBR Service Recovery for the non-
accepted GBR QoS Flow(s) as described in clause 6.22.1. The SMF maintains
context for the QNC requested GBR QoS Flow(s) only for QNC purpose (e.g. QoS
Flow level QoS parameters).
3\. The QNC request for GBR Service Recovery is transferred to the target NG-
RAN.
4\. Steps 8-9 of Xn based inter NG-RAN handover without UPF re-allocation
procedure defined in clause 4.9.1.2.2 of TS 23.502 [3] are performed.
OR
Steps 12-15 of inter NG-RAN node N2 based handover, execution phase procedure
defined in clause 4.9.1.3.3 of TS 23.502 [3] are performed.
5\. At some point after the handover, the NG-RAN determines that the GFBR can
be guaranteed for the QoS Flow bounded to the QNC for GBR Service Recovery.
6\. The NG-RAN sends a notification informing the SMF that the GFBR can be
guaranteed for the QoS Flow.
7\. The SMF triggers PDU Session Modification procedure to add the QoS Flow to
the PDU Session.
#### 6.22.2.2 QNC request for GBR Service Recovery after handover
Figure 6.22.2.2-1 shows that a request related to QNC for GBR Service Recovery
is made by the SMF after handover.
Figure 6.22.2.2-1: QNC request for GBR Service Recovery after handover
1\. Xn or N2 handover procedure is performed.
2\. For the non-accepted GBR QoS Flow(s) in the target NG-RAN as a result of
handover, the SMF initiates PDU Session Modification procedure in order to
request the NG-RAN to enable QNC for GBR Service Recovery for the non-accepted
GBR QoS Flow(s) as described in clause 6.22.1. Therefore, the SMF includes the
request in Namf_Communication_N1N2MessageTransfer. The SMF maintains context
for the QNC requested GBR QoS Flow(s) only for QNC purpose (e.g. QoS Flow
level QoS parameters).
3\. The QNC request for GBR Service Recovery is transferred to the target NG-
RAN.
4\. The rest of the PDU Session Modification procedure is performed.
5\. At some point, the NG-RAN determines that the GFBR can be guaranteed for
the QoS Flow bounded to the QNC for GBR Service Recovery.
6\. The NG-RAN sends a notification informing the SMF that the GFBR can be
guaranteed for the QoS Flow.
7\. The SMF triggers PDU Session Modification procedure to add the QoS Flow to
the PDU Session.
### 6.22.3 Impacts on Existing Nodes and Functionality
SMF:
\- For the non-accepted GBR QoS Flow(s) in the target NG-RAN as a result of
handover, the SMF requests the target NG-RAN to enable QNC for GBR Service
Recovery and maintains context for the QNC requested GBR QoS Flow(s) only for
QNC purpose (e.g. QoS Flow level QoS parameters).
\- When the SMF receives the notification from the NG-RAN for the QoS Flow
bounded to QNC for GBR Service Recovery, the SMF triggers PDU Session
Modification procedure to add the QoS Flow to the PDU Session.
NG-RAN:
\- For the non-accepted GBR QoS Flow(s) as a result of handover, the NG-RAN
enables QNC for GBR Service Recovery per request from the SMF. For this, the
NG-RAN maintains context for the QNC requested GBR QoS Flow(s) only for QNC
purpose (e.g. QoS Flow level QoS parameters).
\- When the NG-RAN determines that the GFBR can be guaranteed for the QoS Flow
bounded to the QNC for GBR Service Recovery, the NG-RAN sends a notification
informing the SMF about that.
### 6.22.4 Solution Evaluation
Editor\'s note: This clause will provide evaluation of different solutions.
## 6.23 Solution #23 for Key Issue #7: Always On control for URLLC GBR QoS
Flow
### 6.23.1 Description
The QoS Parameter Always On control indicates whether the NG-RAN keeps the QoS
Flow when the GFBR can no longer (or can again) be guaranteed because of radio
resource admission control (e.g. the ARP priority level of the QoS Flow is
higher value than a MPS/Emergency Service QoS Flow or during the handover
procedure) for a QoS Flow during the lifetime of the QoS Flow. Always On
control may be used for a GBR QoS Flow if the application traffic is able to
adapt to the change in the QoS (e.g. if the AF is capable to trigger rate
adaptation or trigger application to change its behaviours).
The SMF shall only enable Always On control when the QoS Always On Control
parameter is set in the PCC rule (received from the PCF) that is bound to the
QoS Flow. The Always On control parameter is signalled to the NG-RAN as part
of the QoS profile and to the UE with the QoS rule. If, for a given GBR QoS
Flow, Always On control is enabled and the NG-RAN determines that the GFBR can
no longer be guaranteed because of radio resource admission control, then the
NG-RAN may:
\- initiate a Xn/N2 handover to move the UE to a target NG-RAN in order to
keep the QoS Flow in the target NG-RAN if the target NG-RAN can provide the
required radio resource (the source NG-RAN can try different NG-RAN to
handover). or
\- send an Always On notification towards SMF, e.g. if handover to target NG-
RAN is not possible (e.g. no suitable neighbour cell). After the SMF receives
the Always On notification from the RAN, the SMF may:
a) request to change the QoS Flow from (DC)GBR type to non-GBR type, the NG-
RAN still try to guarantee the GFBR again before the QoS Flow changed to the
non-GBR QoS Flow, or
b) perform the selective DRB deactivation for the GBR QoS Flow and rejects any
DL packet for this QoS Flow . After the selective DRB deactivation, the UE
will reject any UL packet of the QoS Flow without DRB and does not initiate
Service Request to activate the DRB for the QoS Flow with Always On Control.
NOTE: The PCF will decide the QoS parameters (e.g. 5QI and ARP) for the target
non-GBR QoS Flow.
Upon receiving an Always On notification from the NG-RAN that the GFBR can no
longer be guaranteed because of radio resource admission control, the SMF
forwards the Always On notification to the PCF. 5GC may initiate N1 and N2
signalling to modify the QoS Flow into a non-GBR QoS Flow with a higher ARP
priority level than the GBR QoS Flow or performs the selective DRB
deactivation for the GBR QoS Flow. With changing to non-GBR QoS Flow, the SMF
also indicates whether the NG-RAN and UE keeps the GBR QoS Flow QoS parameter
and Always On control. If the GBR QoS Flow is DRB deactivated, the SMF will
reject the UE initialled SM procedure and reject any DL packet for this QoS
Flow.
When the NG-RAN (this NG-RAN can be the Target NG-RAN after handover)
determines that the GFBR can be guaranteed again for a QoS Flow with Always On
control for which the GBR QoS Flow is DRB deactivated or has been changed to a
non-GBR QoS Flow with Always On control), the NG-RAN sends an Always On
notification with the stored previous GBR QoS parameters , informing the SMF
that the GFBR can be guaranteed again and the SMF may forward the notification
to the PCF. The SMF decides to activate the DRB if the DRB is deactivated or
may decide to change the non-GBR QoS Flow with Always On control back into the
GBR QoS Flow with the required GBR QoS and Always On control.
During the handover procedure, the NG-RAN will transfer the QoS Profile of the
QoS Flow with Always On control to the target NG-RAN with the original GBR QoS
Flow QoS parameter (if available) and current QoS Flow QoS parameter and
Always On control attribute. After handover, the target NG-RAN continues to
try to guarantee radio resource and continues the Always On control for this
QoS flow as described in this clause.
### 6.23.2 Procedures
Editor\'s note: This clause describes services and related procedures for the
solution.
### 6.23.3 Impacts on Existing Nodes and Functionality
UE:
\- For the QoS Flow with Always On Control, the UE rejects any UL packet and
does not initiate Service Request for the Always On Control QoS Flow with no
DRB.
\- The UE needs to support the selective DRB deactivation and activation.
SMF:
\- During the QoS Flow with Always On Control establishment procedure, the SMF
provides Always On control to the UE and NG-RAN.
\- After the SMF receives the Always On notification from the RAN, the SMF may
change the QoS Flow between (DC)GBR type and non-GBR type.
\- After the SMF receives the Always On notification from the RAN, the SMF may
perform the selective DRB deactivation/activation for the GBR QoS Flow and
request the UPF to reject/forward any DL packet for this QoS Flow.
\- The SMF needs to support the selective DRB deactivation and activation.
NG-RAN:
\- The NG-RAN continues to guarantee the radio resource for the QoS Flow with
Always On Control.
\- When the GFBR of the QoS Flow with Always On Control can no longer be
guaranteed, the NG-RAN may initiate a Xn/N2 handover to move the UE to a
target NG-RAN in order to keep the QoS Flow in the target NG-RAN if the target
NG-RAN can provide the required radio resource
\- When the GFBR of the QoS Flow with Always On Control can be again (or no
longer be) guaranteed, the NG-RAN may send an Always On notification towards
SMF.
\- The NG-RAN needs to support the selective DRB deactivation and activation.
### 6.23.4 Solution Evaluation
Editor\'s note: This clause provides an evaluation of this solution.
## 6.24 Solution #24 for Key Issues #4 and #6: Accumulated packet delay
estimation for QoS monitoring and division of PDB
### 6.24.0 General
This solution uses monitoring of packets on the GTP-U to determine the delay
budget between gNB and UPF.
**Alternative 1:**
This alternative solution proposes enhancements GTP-U protocol and GTP-U end-
points functionalities for the purposes of QoS monitoring and end-to-end
packet delay budget division on user plane path in uplink and downlink. In
this solution, a GTP-U sender performs an estimation of RTT to the next hop
GTP-U receiver by sending Echo messages and measuring time that elapses
between the transmission of Echo Request message and the reception of Echo
Response message. A GTP-U sender is also expected to estimate its user plane
processing time as a general value or a user plane processing time related to
a particular QoS requirement of existing QoS flow. A GTP-U sender computes an
estimated accumulated packet delay by adding RTT/2, the processing time and,
if available, an estimated accumulated packet delay from an upstream GTP-U
sender (i.e. an immediately preceding GTP-U sender in user plane path) thus
the estimated accumulated delay represents an estimated elapsed time since a
user plane packet entered 3GPP domain. More specifically, the first GTP-U
sender in the uplink direction (i.e. gNB-DU or gNB) computes the estimated
packet delay by adding RTT/2, its estimated processing time and
estimated/measured Uu delay. In the downlink direction, the first GTP-U sender
is PSA UPF for which the estimated packet delay is the sum of RTT/2 and its
processing delay.
It is expected that a GTP-U sender estimates RTT periodically in order to
detect changes in transport delays.
A GTP-U sender may send the estimated packet delay that it accumulated to the
next hop GTP-U receiver
\- in every header of GTP-U PDU (e.g. G-PDU);
\- in a header of one or more GTP-U PDUs (e.g. G-PDU) and a GTP-U receiver is
assumed to store the received value;
\- in a header of one or more GTP-U PDUs that are sent first to a GTP-U
receiver within a given QoS flow; or
\- in a GTP-U signalling message.
QoS monitoring is performed by network nodes that receive and store QoS with a
requested packet delay budget for QoS flow by comparing a received accumulated
packet delay with a requested packet delay budget possibly also taking into
the account the estimated/measured nest hop transmission delay and node\'s
processing time. If the node determines that the packet delay exceeds the
requested packet delay budget then the node triggers QoS monitoring alert
signalling to a control plane network function, e.g. SMF.
Echo Request message and Echo Response message are sent outside GTP-U tunnels
(the messages are using TEID set to 0). If underlaying transport is using QoS
differentiation (e.g. IP DiffServ) then it is up to the implementation to
ensure that the Echo messages are classified correctly and receive similar
treatment by the underlaying transport as GTP-U G-PDUs carrying QoS flows
(user data).
**Alternative 2:**
This alternative solution provides means for QoS monitoring for URLLC on the
N3 interface between the UPF and NG-RAN as well as on the N9 interface between
the UPF (PSA) and the I-UPF. The solution is based on the specification of the
measurements specified for GTP based N3 interface in TS 28.552 [15].
NOTE: Measurements defined in TS 28.552 [15] includes estimated gNB internal
delays which is provided to the OAM and as such is included to the measurement
data.
This measurement provides the average (arithmetic mean) GTP packet delay on
the N3 and N9 interface. The measurement is optionally split into subcounters
per QoS level (5QI). In the below sequence, when the measurement is to be
obtained for the N9 interface, the gNB is replaced by I-UPF and the UPF is
replaced by UPF (PSA).
1\. This measurement is obtained as: the time when receiving a GTP Echo
Response message from the gNB at the egress GTP termination, minus time when
sending the GTP Echo Request to gNB at the GTP ingress termination and divides
it by two. OAM adjusts the N3 delay measurements by removal of the internal
delay time in gNB as defined in TS 28.552 [15].
2\. Each measurement is an integer representing the mean delay in
microseconds. The number of measurements is equal to one. If the optional QoS
level measurement is performed, the number of measurements is equal to the
number of QoS level parameters.
3\. Measurement is taken at UPF.
As in alternative 1, GTP Echo Request message and GTP Echo Response message
are sent outside GTP-U tunnels (the messages are using TEID set to 0). If
underlaying transport is using QoS differentiation (e.g. IP DiffServ) and the
5QIs associated with the relevant QoS Flows are provided to the UPF over N4
then it is up to the implementation in UPF to ensure that the Echo messages
are classified correctly and receive similar treatment by the underlaying
transport as GTP-U G-PDUs carrying QoS flows (user data).
### 6.24.2 Procedures
**Alternative 1:**
Figure 6.24.2.1: Accumulated packet delay estimation for QoS monitoring and
division of PDB in downlink
NOTE: I-UPF is shown in the figure just to show irrespective of number of UPFs
in the path, the same approach can be used however presence of I-UPF is not a
pre-requisite for the packet delay estimation.
The procedure of accumulated packet delay estimation for QoS monitoring and
division of PDB in downlink is illustrated in Figure 6.24.2.1.
1\. PSA UPF sends one or more Echo Request messages to measure RTT to I-UPF.
2\. PSA UPF computes an accumulated packet delay by adding the half of
measured RTT and estimated user plane processing time at PSA UPF that may be
QoS flow specific.
3\. PSA UPF sends the accumulated packet delay to I-UPF in GTP-U PDU (e.g.
G-PDU or a signalling message).
4\. I-UPF measures RTT to NG-RAN by sending one or more Echo Request messages.
5\. An accumulated packet delay at I-UPF is computed by adding the value of
accumulated packet delay received from PSA UPF, the half of RTT between I-UPF
and NG-RAN and estimated user plane processing time at I-UPF.
6\. I-UPF sends the accumulated packet delay computed at I-UPF to NG-RAN.
7\. As an option, NG-RAN can determine the remaining available PDB by
subtracting the accumulated packet delay from the allowed PDB for the given
5QI. The available PDB defines the PDB split between RAN and 5GC.
8\. NG-RAN can measure delay encountered in the air interface (Uu) based on
\"_RAN centric data collection and utilization for LTE and NR SI_ \"
The above call flow is an illustration to perform QoS monitoring. This can
also be performed in the Uplink direction with the RAN performing one-way
delay estimation over Uu, then delay estimation over N3 and N9 can be
performed by I-UPF/PSA UPF. In this case, the PSA UPF can perform total
accumulated delay estimation (one-way delay of Uu, RTT for N3, N9 user plane
path).
**Alternative 2:**
This measurement provides the average (arithmetic mean) GTP packet delay on
the N3 and N9 interface. In the below sequence, when the measurement is to be
obtained for the N9 interface, the gNB is replaced by I-UPF and the UPF is
replaced by UPF (PSA).
1\. This measurement is obtained as: the time when receiving a GTP Echo
Response message from the gNB at the egress GTP termination, minus time when
sending the GTP Echo Request to gNB at the GTP ingress termination.
2\. Each measurement is an integer representing the mean delay in
microseconds. The number of measurements is equal to one.
3\. Measurement is taken at UPF.
4\. UPF provides the measurement results to OAM. OAM adjusts the N3 delay
measurements by removal of the internal delay time in gNB as defined in TS
28.552 [15].
NOTE 1: Measurements defined in TS 28.552 [15] includes estimated gNB internal
delays which is provided to the OAM and as such is included to the measurement
data.
NOTE 2: Providing Delay measurement from UPF to OAM requires SA5 involvement.
NOTE 3: QoS monitoring within NG-RAN and between NG-RAN and UE (Uu) will be
specified by RAN WGs.
GTP Echo Request message and GTP Echo Response message are sent outside GTP-U
tunnels (the messages are using TEID set to 0). If underlaying transport is
using QoS differentiation (e.g. IP DiffServ) and the 5QIs associated with the
relevant QoS Flows are provided to the UPF over N4, then it is up to the
implementation to ensure that the Echo messages are classified correctly and
receive similar treatment by the underlaying transport as GTP-U G-PDUs
carrying QoS flows (user data).
### 6.24.3 Impacts on Existing Nodes and Functionality
**Alternative 1:**
The transmission of Echo Request message is implementation specific. However,
TS 29.281 [17] currently imposes a restriction on the frequency with which
Echo Request messages may be sent. An Echo Request shall not be sent more
often than every 60 seconds on each path. This doesn\'t prevent resending an
Echo Request with the same sequence number according to the T3-RESPONSE timer.
It should be noted that an Echo Request with the same sequence number should
not be resend if an Echo Request is used to measure RTT. More frequent sending
of Echo Request may be necessary with a possible exceptional treatment of
T3-RESPONSE timer.
This solution requires definition of either a new GTP-U extension header or a
signalling message.
**Alternative 2:**
The gNB (I-UPF) provides GTP Echo Response to the UPF. The UPF calculates the
GTP packet delay and makes it available to OAM.
To provide 5QI level of measurement, the 5QIs associated with the relevant QoS
Flows (QFIs) are provided over N4 to UPF at relevant procedures.
### 6.24.4 Solution Evaluation
**Alternative 1:**
This solution provides a method that allows the system to determine PDB split
dynamically and perform QoS monitoring with minimum changes to GTP-U protocol.
Moreover, this solution does not require precise time synchronization amongst
system entities.
This solution performs packet delay estimation without considering 5QI for a
given QoS flow rather it performs Echo Request / Echo Response in the
corresponding user plane path outside GTP-U tunnels.
As an implementation option, GTP-U receiver can also use this method to
estimate packet delay and determine the remaining PDB available in user plane
path (e.g. 5G-AN part of PDB). Remaining PDB is determined by subtracting the
accumulated packet delay from the allowed PDB for the given 5QI that
corresponds to the QoS flow.
**Alternative 2:**
This solution provides a method that allows the system to perform QoS
monitoring for URLLC with minimum changes applying already specified
measurements for GTP based N3 interface in TS 28.552 [15]. This solution does
not require precise synchronization among system entities. This solution does
not support standardized means of AF enabled dynamic QoS monitoring for URLLC.
# 7 Overall Evaluation
Editor\'s note: This clause will provide evaluation of different solutions.
## 7.1 Evaluation for key issue 3
For QoS flows with low latency requirements:
1) The server supporting the UE\'s applications needs to be kept
geographically and topologically close to the UE, e.g. within a transmission
latency of 0.1 ms to 1 ms from the radio base station site.
2) The low latency targets can be supported with triggering the anchor
relocation after the mobility event to target NG-RAN node takes place.
NOTE: This assumption means that transient delays can be afforded since the UE
can be temporarily connected to a \"suboptimal\" UPF until the UPF is
relocated.
3) The SMF that will trigger the anchor relocation, does not have to
anticipate in advance the mobility event, before the actual mobility event
occurs.
Regarding how to enable runtime coordination between AF and 5GC and how to
route traffic on N6 interface for case of PSA relocation, solution 6 and 13
touch the issues:
\- Solution 6 utilizes late notification to inform AF that DNAI is changed or
PSA is changed after the PSA relocation is completed. If application
relocation happens, the AF responds the notification with N6 traffic routing
details, so that the SMF can configures the new PSA with received N6 traffic
routing information.
\- Solution 13 supports both early notification and late notification for SSC
mode 3 PDU session, UL CL and Branch point cases. If early notification, the
SMF sends the notification to the AF before establishing a new UP path towards
new PSA, and waits for an acknowledgement from the AF before switching traffic
to new UP path. If late notification, the SMF prepares the new UP path before
sending the notification to the AF, the SMF also waits for the acknowledgement
from the AF before switching traffic to new UP path. In case of application
relocation, the acknowledgement from the AF may include N6 traffic routing
information, so that the SMF can configure the new PSA to route the traffic on
N6 interface correctly.
For handling ULCL relocation:
1) Forwarding tunnel needs to be established between source UL CL and target
UL CL for routing leftover DL traffic from the source PSA to the UE.
For handling PSA relocation and fulfilling traffic routing on N6 interface:
1) The SMF can receive Ethernet context from source PSA and configures it into
target PSA.
2) Target PSA can assist the DN in updating Ethernet forwarding configuration
in the DN.
3) If the above two bullets apply, RAN needs to be configured not to expect
End marker from source PSA.
# 8 Conclusions
## 8.1 Key Issue #1: Supporting high reliability by redundant transmission in
user plane
It is recommended that normative work proceed as follows:
\- Focusing on backhaul reliability improvements only i.e. without changes to
the radio interface and associated protocols; and
\- Requiring single UE only i.e. no UE redundancy shall be specified; and
\- Introducing enablers in the network for:
a) Redundancy of network nodes (UPF and gNB) and associated interface (N3),
and concurrent PDU Sessions (see Solution #1); and
b) GTP-U / TRANSPORT LAYER redundancy over N3 with single network nodes i.e.
UPF and gNB (see Solutions #4, #7). No UE impact;
c) Enablers to support appropriate gNB/UPF selection as applicable for a) and
b).
UE impact with a) shall be minimized.
NOTE: An informative annex will be created during the normative work to
document UE redundancy option with no 3GPP specification impact as enabled
with Solution #2.
## 8.2 Key Issue #3: Enhancement of Session Continuity during UE Mobility
Agreement on Key Issue #3: Enhancement of Session Continuity during UE
Mobility:
\- Solution 6 is selected as baseline for handling ULCL relocation in Rel-16
normative phase.
\- Solution 11 is selected as baseline for handling PSA relocation for
Ethernet PDU session type in Rel-16 normative phase.
\- Solution 13 is selected as baseline for the runtime coordination between AF
and 5GC in Rel-16 normative phase.
## 8.3 Key Issue #5: Supporting low latency without requiring that the UE to
always be in RRC_Connected Mode
For Key Issue #5, it is recommended to not continue with Solution #9:
\"Supporting low latency for initial data delivery without requiring that the
UE to always be in RRC_Connected State\" for normative work in the Rel-16.
## 8.4 Key Issue #6: Division of E2E PDB
Agreements on Key Issue #6:
\- Solution #17 is selected as the solution for the PDU sessions that RAN
directly connects to the PSA UPF, i.e. no I-UPF is used between. For this
solution, there is no impact to 5GS NFs except for enhancements of RAN
configuration.
\- Solution #15 is selected as the solution for the PDU sessions that RAN
directly connects to the PSA UPF, or Iâ€‘UPF/ULCL is used. For the former case,
the operator can decide whether to use solution A# or solution 15# based on
operator policy.
\- No normative work for Solution #18 in Rel-16.
## 8.5 Key Issue #4: QoS Monitoring to Assist URLLC Service
Agreements on Key Issue #4:
NOTE 1: SA WG2 might revisit the following conclusions according to the
outcome of RAN WG2/RAN WG3 study. SA2 will not proceed to normative work until
receiving feedback from RAN WGs.
The QoS Monitoring can be performed on different levels of granularities, i.e.
per QoS Flow per UE level, or per node level, subject to the operators\'
configuration, and/or 3rd party application request, and/or PCF policy control
for the URLLC services. Accordingly, two alternative solutions are concluded.
**Method #1:** The following principles are concluded for normative work for
the cases a real time QoS Monitoring and/or an update/refresh rate for QoS
Monitoring within a specified time (e.g. at least 1 per second) per QoS Flow
per UE level is requested, e.g. by 3rd party application, needs to be
performed:
\- Using some of the actual service packets for QoS Monitoring between the PSA
UPF and RAN node.
\- The UL/DL packet delay between UE and PSA UPF for per UE per QoS Flow is a
combination of the UL/DL packet delay between UE and RAN node, relying on RAN
support, and the UL/DL packet delay between RAN node and PSA UPF.
\- The SMF sends the QoS Monitoring policy for the QoS Flow to the PSA UPF and
RAN via the PDU Session Establishment or Modification procedure. The PSA UPF
initiates DL packet delay measurement between RAN node and PSA UPF for the QoS
Flow and RAN node initiates the packet delay measurement of UL/DL packet delay
on Uu interface, based on the QoS Monitoring policy received from the SMF.
\- RAN node provides the UL/DL packet delay measurement result of Uu interface
to the PSA UPF via the N3 interface. The RAN node may send a dummy UL packet
as the monitoring response packet to the UPF in case there is no UL service
packet.
\- The PSA UPF calculates the UL/DL packet delay of N3 interface based on the
time stamps provided by RAN node via N3 interface. If all user plane nodes of
5G system are time synchronized, the UL/DL packet delay of N3 interface could
be calculated by PSA UPF and RAN respectively based on the received time stamp
and the local time stamp when receiving the measurement packets.
\- The PSA UPF calculates the UL/DL packet delay between UE and PSA UPF per
QoS Flow based on the UL/DL packet delay result of Uu and N3 interface, and
reports QoS Monitoring result to the SMF based on some specific conditions,
e.g. when thresholds for reporting to SMF are reached.
\- The PCC framework is used to activate or deactivate the QoS Monitoring for
the QoS Flow when receiving the request from AF. RAN node could reject the QoS
Monitoring for the QoS Flow based on the RAN\'s conditions (e.g. load
situation).
NOTE 2: The a) DL packet delay between UE and PSA UPF and b) the UL packet
delay between UE and PSA UPF are calculated independently.
NOTE 3: The QoS Monitoring requests RAN node to provide UL/DL packet delay of
Uu interface between UE and RAN node. How to measure the UL/DL packet delay of
Uu interface between UE and RAN node depends on RAN decision. The impact on
RAN will be evaluated by RAN, and SA2 will consider the RAN feedback on the
impact, if received.
NOTE 4: Whether the above time synchronized based solution can be supported
will rely on the final conclusion of Time Sync solution as part of
FS_Vertical_LAN study. Furthermore, how to transport the time stamp might be
reconsidered during the normative phase.
**Method #2:** The following principles are concluded for normative work if
per node level QoS Monitoring needs to be performed.
\- Packet delay estimation is performed by using GTP-U Echo Request/Response,
as defined in the TS 28.552 [15], in the corresponding user plane transport
path(s), independent of the corresponding PDU Session and the 5QI for a given
QoS flow, for a specific URLLC service.
**For Alternative 1, solution#24:**
\- RAN node provides the UL/DL packet delay measurement result of Uu interface
to the PSA UPF via the N3 interface.
\- The PSA UPF calculates the UL/DL packet delay of N3 interface based on the
time stamps provided by RAN node via N3 interface.
\- The PSA UPF calculates the UL/DL packet delay between UE and PSA UPF based
on the UL/DL packet delay result of Uu and N3 interface, and reports QoS
Monitoring result to the SMF based on some specific conditions, e.g. when
thresholds for reporting to SMF are reached.
\- The UPF performing the monitoring estimation can provide the corresponding
{Network instance, DSCP} along with the estimated packet delay for the
corresponding transport path. Based on this, SMF can determine QoS flow
mapping to the appropriate {Network instance, DSCP} considering {5QI, QoS
characteristics, ARP} for the given QoS flow.
**For Alternative 2, solution #24:**
\- RAN node provides the UL/DL packet delay measurement result of Uu interface
to OAM directly.
\- For 28.552 [15] based approach, UPF (or I-UPF) takes measurement on N3 (or
N9) interface and provide the information to the OAM system. OAM has the rest
of the measurements from NG-RAN (including delays between the UE and NG-RAN as
well as NG-RAN internal delays) and can take appropriate actions to mitigate
any unwanted situation.
\- For GTP Echo/Response mechanism, the UPF performing the monitoring
estimation can provide the corresponding {Network instance, DSCP} along with
the estimated packet delay for the corresponding transport path. At PDU
Session Establishment/Modification the SMF provides the 5QI associated with a
given QFI to the UPF over N4. Based on this, UPF can determine QoS flow
mapping to the appropriate {Network instance, DSCP} considering {5QI, QoS
characteristics, ARP} for the given QoS flow and provide it to OAM.
NOTE 5: Alternative 2 of method 2 does not provide means for measurements per
AF request to dynamically trigger QoS monitoring.\ Alternative 2 of method 2
reuses existing principles already available.
NOTE 6: The system behaviour with the monitored information, will be worked
out during normative phase.
## 8.6 Key Issue #2: Supporting low latency and low jitter during handover
procedure
No normative work for the Key Issue#2 is needed in Rel-16 URLLC work item.
###### ### Annex A: Overview of IEEE TSN Frame Replication and Elimination for
Reliability
Following Annex describes IEEE TSN overview and possible applicability to 3GPP
networks.
IEEE 802.1 has been standardizing Time Sensitive Networking (TSN) to provide
low and bounded end to end latency as well as high reliability. As part of
this standards effort, the IEEE 802.1CB Frame Replication and Elimination for
Reliability (FRER) [6] is the standard to provide high reliability, primarily
for Ethernet networks.
This standard provides identification and replication of frames for redundant
transport over multiple paths. When received, the duplicate frames can be
identified based on sequence numbering, and the duplicates are eliminated.
The Figure below illustrates the FRER solution in an example. At switch N1,
the frames are duplicated, and sequence numbers are added to the frame
headers. The different copies of the frames are forwarded via disjoint paths
in the network. At switch N2, the duplicates are identified based on the
sequence numbers, and only one copy is forwarded, the redundant copies are
eliminated. The ordering of the frames can also be maintained at N2 based on
the sequence numbering. Generally speaking, FRER can be considered as a per
frame level 1+n redundancy solution.
Figure A-1: Illustration of IEEE TSN Replication and Elimination function
The solution can be configured in a flexible way. It is possible to apply more
than two paths for additional redundancy. A FRER entity can play the
replication role and the elimination role at the same time for the two
different directions.
In typical deployments, the FRER functionality is set up using management
protocols, and controlled by a centralized entity. Note that it is possible to
set up FRER functionality both at intermediate switches, or at end hosts, even
though the central controller and the management protocol may differ. There
can be multiple replication and elimination points defined for a flow
depending on the requirements and the network characteristics. The set up of
the FRER functionality by means of a central controller is not part of the
802.1CB standard. IEEE P802.1Qcc specifies centralized TSN configuration both
for bridges and end hosts, including FRER.
The FRER, as defined by IEEE, adds 6 bytes to the Ethernet header, what is
called Redundancy tag, or just \"R-tag\". The R-tag consists of 2 bytes for
the EtherType which identifies the tag as an R-tag, 2 bytes for the actual
sequence number, and 2 bytes reserved for future versions of the protocol.
###### ### Annex B: A summary of the IETF DetNet activity
The IETF Deterministic Networking (DetNet) Working Group focuses on
deterministic data paths that operate over Layer 2 bridged and Layer 3 routed
segments, where such paths can provide bounds on latency, packet delay
variation (jitter), and loss. The Working Group addresses Layer 3 aspects in
support of applications requiring deterministic networking. The Working Group
collaborates with the IEEE 802.1 Time Sensitive Networking (TSN) Task Group,
which is responsible for Layer 2 operations, to define a common architecture
for both Layer 2 and Layer 3.
The Working Group initially focuses on solutions for networks that are under a
single administrative control or within a closed group of administrative
control; these include not only campus-wide networks but also can include
private WANs.
DetNet is concerned solely with worst-case values for the end-to-end latency.
The DetNet Quality of Service can be expressed in terms of minimum and maximum
end-to-end latency from source to destination, and probability of loss of a
packet. Three techniques are used by DetNet to provide these qualities of
service:
\- Congestion protection. Congestion protection greatly reduces, or even
eliminates entirely, packet loss due to output packet congestion within the
network. DetNet achieves congestion protection and bounded delivery latency by
reserving bandwidth and buffer resources at every hop along the path of the
DetNet flow. The actual queuing and shaping mechanisms are typically provided
by the underlying subnet layers, e.g., MPLS or Ethernet bridging. For example,
the IEEE 802.1 WG has specified (and is specifying) a set of queuing, shaping,
and scheduling algorithms that enable each transit node (bridge or router).
While these techniques are currently embedded in Ethernet and bridging
standards, we can note that they are all, except perhaps for packet
preemption, equally applicable to other media than Ethernet, and to routers as
well as bridges.
\- Explicit routes DetNet includes mechanisms to ensure that fixed paths are
provided for DetNet flows. These explicit paths do not normally suffer
temporary interruptions caused by the convergence of routing or bridging
protocols.
\- Service protection, as discussed below.
After congestion, the most important contributions to packet loss are
typically from random media errors and equipment failures. Service protection
is the name for the mechanisms used by DetNet to address these losses. Both
causes of packet loss can be greatly reduced by spreading the data in a packet
over multiple transmissions. Packet replication and elimination is the most
capable service protection mechanism for DetNet, and a major point of
discussions during DetNet standardization work. It involves four capabilities:
\- Providing sequencing information, once, at or near the source, to the
packets of a DetNet compound flow. This may be done by adding a sequence
number as part of DetNet, or may be inherent in the packet, e.g. in a
transport protocol, or associated to other physical properties such as the
precise time (and radio channel) of reception of the packet.
\- Replicating these packets into multiple DetNet member flows and, typically,
sending them along at least two different paths to the destination(s).
\- Eliminating duplicated packets. This may be done at any step along the path
to save network resources further down, in particular when multiple
Replication points exist. But the most common case is to perform this
operation at the very edge of the DetNet network, preferably in or near the
receiver.
\- Re-ordering a DetNet flow\'s packets that are received out of order.
In the simplest case, this amounts to replicating each packet in a source that
has two interfaces, and conveying them through the network, along separate
paths, to the similarly dual-homed destinations, that discard the extras. This
ensures that one path (with zero congestion loss) remains, even if some
intermediate node fails. The sequence numbers can also be used for loss
detection and for re-ordering.
More information on DetNet is available as defined in draft-ietf-detnet-
architecture-06 [9].
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the LWIP Encapsulation Protocol.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 36.300: \"E-UTRA and E-UTRAN Overall Description; Stage 2\".
[3] 3GPP TS 36.331: \"E-UTRA RRC Protocol specification\".
[4] IETF RFC 2784: \"Generic Routing Encapsulation (GRE)\".
[5] IETF RFC 2890: \"Key and Sequence Number Extensions to GRE\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
DL DownLink
DRB Data Radio Bearer
eNB E-UTRAN Node B
E-UTRA Evolved UMTS Terrestrial Radio Access
E-UTRAN Evolved UMTS Terrestrial Radio Access Network
IP Internet Protocol
LWIP LTE/WLAN Radio Level Integration Using IPsec Tunnel
LWIPEP LWIP Encapsulation Protocol
GRE Generic Routing and Encapsulation
PDCP Packet Data Convergence Protocol
PDU Protocol Data Unit
RRC Radio Resource Control
SAP Service Access Point
SDU Service Data Unit
UE User Equipment
# 4 General
## 4.1 Introduction
The objective is to describe the use of encapsulation for IP packets over the
LWIP Tunnel as defined in TS 36.300 [2] and TS 36.331 [3].
## 4.2 LWIPEP architecture
### 4.2.1 LWIPEP entities
The description in this sub clause is a model and does not specify or restrict
implementations.
RRC is in control of the LWIPEP configuration.
Functions of the LWIPEP sublayer are performed by LWIPEP entities. For an
LWIPEP entity configured at the eNB, there is a peer LWIPEP entity configured
at the UE and vice versa. The LWIPEP entity responsible for encapsulating
LWIPEP SDUs is referred to as the transmitter. The LWIPEP entity responsible
for decapsulating LWIPEP PDUs is referred to as the receiver.
An LWIPEP entity receives/delivers LWIPEP SDUs from/to upper layers (i.e. IP)
and sends/receives LWIPEP PDUs to/from its peer LWIPEP entity via an LWIP
Tunnel and E-UTRA.
\- At the transmitting side, when an LWIPEP entity receives an LWIPEP SDU from
upper layers, it constructs the corresponding LWIPEP PDU and delivers it to
lower layers;
\- At the receiving side, when an LWIPEP entity receives an LWIPEP PDU from
lower layers, it reassembles the corresponding LWIPEP SDU and delivers it to
upper layers.
Figure 4.2.1-1 illustrates the overview model of the LWIPEP sublayer.
Figure 4.2.1-1: Overview model of the LWIPEP sublayer
An LWIPEP entity delivers/receives the following LWIPEP PDU to/from a lower
layer entity:
\- LWIPEP data PDU.
## 4.3 Services
### 4.3.1 Services provided to upper layers
The following services are provided by LWIPEP to upper layers (i.e. IP):
\- transfer of user plane data;
### 4.3.2 Services expected from lower layers
The following services are expected by LWIPEP from lower layers (i.e. LWIP
Tunnel and E-UTRA):
\- transfer of user plane data;
## 4.4 Functions
The following functions are supported by the LWIPEP sublayer:
\- transfer of user plane data;
\- identification of the DRB identity to which the LWIPEP SDU belongs.
# 5 Procedures
## 5.1 Data transfer procedures
### **5.1.1 UL data transfer procedures**
**When receiving an** LWIPEP **SDU from upper layers, the** LWIPEP **entity
shall form the LWIPEP PDU as described in Section 6.1.**
### **5.1.2 DL data transfer procedures**
**When receiving an** LWIPEP **PDU from lower layers, the** LWIPEP **entity
shall:**
\- if configured by upper layers to enable aggregation in DL:
\- **interpret the LWIPEP PDU as having both _Key_ and _Sequence Number_
fields included as described in Section 6.1;**
\- **reorder received packets according to the _Sequence Number_ field before
delivering them to higher layers as specified in** RFC 2890 [5];
\- else:
\- interpret the LWIPEP PDU as having _Key_ field included as described in
Section 6.1;
## 5.2 Handling of unknown, unforeseen and erroneous protocol data
When an LWIPEP entity receives an LWIPEP PDU that contains reserved or invalid
values, the LWIPEP entity shall:
\- discard the received PDU.
# 6 Protocol data units, formats and parameters
## 6.1 Protocol data units
### 6.1.1 General
An LWIPEP PDU is a bit string that is byte aligned (i.e. multiple of 8 bits)
in length. In the figures in subclause 6.1, bit strings are represented by
tables in which the most significant bit is the leftmost bit of the first line
of the table, the least significant bit is the rightmost bit on the last line
of the table, and more generally the bit string is to be read from left to
right and then in the reading order of the lines. The bit order of each
parameter field within an LWIPEP PDU is represented with the first and most
significant bit in the leftmost bit and the last and least significant bit in
the rightmost bit.
An LWIPEP SDU is a bit string that is byte aligned (i.e. multiple of 8 bits)
in length. An LWIPEP SDU is included into an LWIPEP PDU from the first bit
onward.
Only one type of LWIPEP PDU is defined, i.e. LWIPEP data PDU.
### 6.1.2 LWIPEP data PDU
An LWIPEP data PDU consists of the LWIPEP header and the LWIPEP SDU, as
described in Figure 6.1.2-1. The LWIPEP header is populated as described in
6.2.1.
Figure 6.1.2-1: LWIPEP data PDU
## 6.2 Formats and parameters
### 6.2.1 LWIPEP header
The LWIPEP Header is a GRE header as specified in RFC 2890 [5] and has a fixed
size of eight bytes (if only the _Key_ field is included) or twelve bytes (if
both the _Key_ and _Sequence Number_ fields are included).
The transmitter shall set the 5 LSB\'s of the _Key_ field in the GRE header to
the DRB Identity associated with the LWIPEP SDU and set the remaining MSB\'s
to \'0\'. If instructed by RRC to enable aggregation in UL or DL, the
transmitter shall in addition include the _Sequence Number_ field as specified
by RFC 2890 [5] in the LWIPEP header. All other optional fields are unused,
and the values of other fields shall be set as specified in RFC 2784 [4] and
RFC 2890 [5].
#
# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
The present document is part 2 of a multi-part deliverable covering
conformance test specification for Mission Critical Services over LTE
consisting of:
3GPP TS 36.579-1 [2]: \"Mission Critical (MC) services over LTE; Part 1:
Common test environment\"
**3GPP TS 36.579-2: \"** Mission Critical (MC) services **over LTE; Part 2:
Mission Critical Push To Talk (MCPTT) User Equipment (UE) Protocol conformance
specification\" (the present document);**
3GPP TS 36.579-3 [3]: \" Mission Critical (MC) services over LTE; Part 3:
Mission Critical Push To Talk (MCPTT) Server Application conformance
specification\";
3GPP TS 36.579-4 [4]: \"Mission Critical (MC) services over LTE; Part 4: Test
Applicability and Implementation Conformance Statement (ICS) proforma
specification\";
3GPP TS 36.579-5 [5]: \"Mission Critical (MC) services over LTE; Part 5:
Abstract test suite (ATS)\".
# 1 Scope
The present document specifies the protocol conformance testing for testing a
MCPTT Client for compliance to the Mission Critical Push To Talk (MCPTT) over
LTE protocol requirements defined by 3GPP.
In particular the present document contains:
\- the overall test structure;
\- the test configurations;
\- the conformance requirement and reference to the core specifications;
\- the test purposes; and
\- a brief description of the test procedure, the specific test requirements
and short message exchange table.
The present document is valid for MCPTT Clients implemented according to 3GPP
releases starting from Release 13 up to the Release indicated on the cover
page of the present document.
The following information relevant to testing specified in the present
document could be found in accompanying specifications:
\- default setting of the test parameters TS 36.579-1 [2];
\- Implementation Conformance Statement (ICS) TS 36.579-4 [4] and
Implementation eXtra Information for Testing (IXIT) TS 36.579-5 [5];
\- the applicability of each test case TS 36.579-4 [4].
The test cases are expected to be executed through the 3GPP radio interface.
The present document does not specify the protocol conformance testing for the
EPS (LTE) bearers which carry the MCPTT data sent or received by the MCPTT
Client and which are required to be supported by the UE in which the MCPTT
Client is installed. This is defined in TS 36.523-1 [6].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 36.579-1: \"Mission Critical (MC) services over LTE; Part 1:
Common test environment\".
[3] 3GPP TS 36.579-3: \" Mission Critical (MC) services over LTE; Part 3:
Mission Critical Push To Talk (MCPTT) Server Application test specification\".
[4] 3GPP TS 36.579-4: \" Mission Critical (MC) services over LTE; Part 4: Test
Applicability and Implementation Conformance Statement (ICS).
[5] 3GPP TS 36.579-5: \"Mission Critical (MC) services over LTE; Part 5:
Abstract test suite (ATS)\".
[6] 3GPP TS 36.523-1: \"Evolved Universal Terrestrial Radio Access (E-UTRA)
and Evolved Packet Core (EPC); User Equipment (UE) conformance specification;
Part 1: Protocol conformance specification\".
[7] 3GPP TS 22.179: \"Mission Critical Push To Talk (MCPTT) over LTE; Stage
1\".
[8] 3GPP TS 23.179: \"Functional architecture and information flows to support
mission critical communication services; Stage 2\".
[9] 3GPP TS 24.379: \"Mission Critical Push To Talk (MCPTT) call control;
Protocol specification\".
[10] 3GPP TS 24.380: \"Mission Critical Push To Talk (MCPTT) media plane
control; Protocol specification \".
[11] 3GPP TS 24.481: \"Mission Critical Services (MCS) group management;
Protocol specification\".
[12] 3GPP TS 24.482: \"Mission Critical Services (MCS) identity management;
Protocol specification\".
[13] 3GPP TS 24.483: \"Mission Critical Services (MCS) Management Object
(MO)\".
[14] 3GPP TS 24.484: \"Mission Critical Services (MCS) configuration
management; Protocol specification\".
[15] 3GPP TS 33.179: \" Security of Mission Critical Push To Talk (MCPTT) over
LTE \".
[16] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[17] Void.
[18] Void.
[19] 3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS); Stage 3\".
[20] 3GPP TS 24.008: \"Mobile Radio Interface Layer 3 specification; Core
Network Protocols; Stage 3\".
[21] Void.
[22] Void.
[23] 3GPP TS 36.509: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Special
conformance testing functions for User Equipment (UE)\".
[24] 3GPP TS 36.508: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access (E-UTRAN); Common Test Environments
for User Equipment (UE) Conformance Testing\".
[25] OpenID Connect 1.0: \"OpenID Connect Core 1.0 incorporating errata set
1\", http://openid.net/specs/openid-connect-core-1_0.html.
[26] Void.
[27] Void
[28] Void.
[29] Void.
[30] 3GPP TS 33.310: \"Network Domain Security (NDS); Authentication Framework
(AF)\".
[31] Void.
[32] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[33] 3GPP TS 33.180: \"Security of the mission critical service\".
[34] IETF RFC 4354 \"A Session Initiation Protocol (SIP) Event Package and
Data Format for Various Settings in Support for the Push-to-Talk over Cellular
(PoC) Service\"
[35] IETF RFC 4575 \" A Session Initiation Protocol (SIP) Event Package for
Conference State\"
[36] 3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
For the purpose of the present document, the following terms and definitions
given in 3GPP TS 24.379 [9] apply:
**An MCPTT user is affiliated to an MCPTT group**
**An MCPTT user is affiliated to an MCPTT group at an MCPTT client**
**Affiliation status**
**Group identity**
**In-progress emergency private call state**
**In-progress imminent peril group state**
**MCPTT client ID**
**MCPTT emergency alert state**
**MCPTT emergency group state**
**MCPTT emergency group call state**
**MCPTT emergency private call state**
**MCPTT emergency private priority state**
**MCPTT imminent peril group call state**
**MCPTT imminent peril group state**
**MCPTT private emergency alert state**
**MCPTT speech**
**Media-floor control entity**
**Temporary MCPTT group identity**
**Trusted mutual aid**
**Untrusted mutual aid**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 22.179 [7] apply:
**In-progress emergency**
**MCPTT emergency alert**
**MCPTT emergency group call**
**MCPTT emergency state**
**Partner MCPTT system**
**Primary MCPTT system**
For the purpose of the present document, the following terms and definitions
given in 3GPP TS 24.380 [10] apply:
**MBMS subchannel**
For the purpose of the present document, the following terms and definitions
given in 3GPP TS 23.179 [8] apply:
**Pre-selected MCPTT user profile**
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
None.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
ECGI E-UTRAN Cell Global Identification
FFS For Further Study
ICS Implementation Conformance Statement
IPEG In-Progress Emergency Group
IPEPC In-Progress Emergency Private Call
IPIG In-Progress Imminent peril Group
IUT Implementation Under Test
IXIT Implementation eXtra Information for Testing
MBMS Multimedia Broadcast and Multicast Service
MBSFN Multimedia Broadcast multicast service Single Frequency Network
MCPTT Mission Critical Push To Talk
MCPTT group ID MCPTT group IDentity
MEA MCPTT Emergency Alert
MEG MCPTT Emergency Group
MEGC MCPTT Emergency Group Call
MEPC MCPTT Emergency Private Call
MEPP MCPTT Emergency Private Priority
MES MCPTT Emergency State
MIME Multipurpose Internet Mail Extensions
MIG MCPTT Imminent peril Group
MIGC MCPTT Imminent peril Group Call
MONP MCPTT Off-Network Protocol
MPEA MCPTT Private Emergency Alert
NAT Network Address Translation
PLMN Public Land Mobile Network
QCI QoS Class Identifier
RTP Real-time Transport Protocol
SAI Service Area Identifier
SDP Session Description Protocol
SIP Session Initiation Protocol
SS System Simulator
SSRC Synchronization SouRCe
TGI Temporary MCPTT Group Identity
TMGI Temporary Mobile Group Identity
TP Transmission Point
TP Test Purpose
UE User Equipment
URI Uniform Resource Identifier
# 4 General
## 4.1 Test methodology
### 4.1.1 Testing of optional functions and procedures
Any function or procedure which is optional, may be subject to a conformance
test if it is implemented in the MCPTT Client.
A declaration by the MCPTT Client supplier (to use the Implementation
Conformance Statement (ICS) proforma specified in TS 36.579-4 [4]) is used to
determine whether an optional function/procedure has been implemented.
### 4.1.2 Test interfaces and facilities
Detailed descriptions of the MCPTT Client test interfaces and special
facilities for testing are provided in 3GPP TS 36.509 [23].
## 4.2 Implicit testing
For some 3GPP MCPTT protocol features conformance is not verified explicitly
in the present document. This does not imply that correct functioning of these
features is not essential, but that these are implicitly tested to a
sufficient degree in tests which are not explicitly dedicated to test the
feature.
## 4.3 Repetition of tests
As a general rule, the test cases specified in the present document are highly
reproducible and do not need to be repeated unless otherwise stated.
## 4.4 Handling of differences between conformance requirements in different
releases of cores specifications
The conformance requirements which determine the scope of each test case are
explicitly copy-pasted from relevant core specifications in the especially
dedicated for this clause of each test with the title \'Conformance
requirements\'.
NOTE: When in the copy/pasted text there are references to other
specifications the reference numbers will not match the reference numbers used
in the present document. This approach has been taken in order to allow easy
copy and then search for conformance requirements in those specifications.
When differences between conformance requirements in different releases of the
cores specifications have impact on the Pre-test conditions, Test procedure
sequence or/and the Specific message contents, the Conformance requirements
related to different releases are specified separately with clear indication
of the Release of the spec from which they were copied.
When there is no Release indicated for a conformance requirement text, this
should be understood either as the Conformance requirements in the latest
version of the spec with release = the TC Applicability release (which can be
found in TS 36.579-4 [4], Table 4-1: Applicability of tests and additional
information for testing, column \'Release\'), or, as the Conformance
requirements in the latest version of the spec of the release when the feature
was introduced to the core specs.
## 4.5 Reference conditions
The reference environments used by all signalling and protocol tests is
specified in TS 36.579-1 [2]. Where a test requires an environment that is
different, this will be specified in the test itself.
For all test cases in this document unless specified otherwise the condition
MCPTT applies for all message contents.
## 4.6 Generic setup procedures
A set of basic generic procedures for MCPTT Client-Server communication are
described in TS 36.579-1 [2]. These procedures will be used in numerous test
cases throughout the present document.
# 5 MCPTT Client Configuration
5.1 Configuration / Authentication / User Authorisation / UE Configuration /
User Profile / Key Generation
##### 5.1.1 Test Purpose (TP) {#test-purpose-tp .H6}
##### (1) {#section .H6}
**with** { UE (MCPTT Client) attached to EPS services }
ensure that {
**when** { the MCPTT User activates an MCPTT application and requests MCPTT
initialisation }
**then** { UE (MCPTT Client) performs MCPTT User Authentication }
}
##### (2) {#section-1 .H6}
**with** { UE (MCPTT Client) user authenticated }
ensure that {
**when** { the UE (MCPTT Client) has established a secure HTTP tunnel }
**then** { UE (MCPTT Client) performs key management authorization and obtains
identity management key material }
}
##### (3) {#section-2 .H6}
**with** { UE (MCPTT Client) has obtained identity management key material }
ensure that {
**when** { the UE (MCPTT Client) requests user service authorization }
**then** { UE (MCPTT Client) sends a user authorization request to the MCPTT
Server }
}
##### (4) {#section-3 .H6}
**with** { UE (MCPTT Client) authorized for user services }
ensure that {
**when** { the UE (MCPTT Client) requests configuration management
authorization}
**then** { UE (MCPTT Client) requests subscription to multiple documents
simultaneously **and** request the retrieval of the MCPTT UE Configuration
document, the MCPTT User Profile Configuration Document and the MCPTT Service
Configuration Document }
}
##### (5) {#section-4 .H6}
**with** { UE (MCPTT Client) having obtained user configuration data }
ensure that {
**when** { the UE (MCPTT Client) requests group management authorization }
**then** { UE (MCPTT Client) receives the group profile including group
traffic keys }
}
##### (6) {#section-5 .H6}
**with** { UE (MCPTT Client) having obtained all required configuration data }
ensure that {
**when** { the UE (MCPTT Client) requires to refresh its service settings }
**then** { UE (MCPTT Client) sends a SIP PUBLISH request }
}
##### 5.1.2 Conformance requirements {#conformance-requirements .H6}
References: The conformance requirements covered in the present TC are
specified in: TR 24.980 clauses 4.2.1 and 4.3.1, TS 24.482 clause 6.2.1 and
Annex A.2.1.2, TS 24.484 clauses 4.2.1, 4.2.2, 6.2.2, 6.3.1.1, 6.3.2.1,
6.3.2.2, 6.3.13.2.1 and 6.3.13.2.2, TS 24.481 clauses 6.2.2.2, 6.2.3,
6.3.3.2.1, 6.3.3.2.2 and 6.3.13.2.1, TS 24.379 clauses 7.2.1, 7.2.1A, 7.2.2
and 7.2.3, TS 33.179 clauses 5.6.1, 6.2, 7.2.3 and Annex D. Unless otherwise
stated these are Rel-13 requirements.
[TR 24.980, clause 4.2.1]
The MCPTT UE follows the SIP registration procedures defined in 3GPP TS 24.229
[4]. In addition, when the conditions for performing IMS registration in
bullets 2, 3, 4, 5 and 6 in subclause L.3.1.2 of 3GPP TS 24.229 [4] evaluate
to true, the MCPTT UE registers with the IMS.
[TR 24.980, clause 4.3.1]
The MCPTT UE follows the procedures defined in 3GPP TS 24.229 [4] and 3GPP TS
33.203 [7] for authentication with IMS Authentication and Key Agreement (IMS-
AKA), Sec-Agree and IPSec. The MCPTT UE supports integrity protection.
[TS 24.482, clause 6.2.1]
Upon an indication from the MCPTT client to initiate MCPTT user
authentication, the IdM client shall perform the user authentication procedure
according to 3GPP TS 33.179 [2] with the following clarifications:
> 1) shall establish a TLS tunnel to the authorisation endpoint of the IdM
> server as specified in 3GPP TS 33.179 [2] using the configured URL of the
> authorisation endpoint of the IdM server as specified in the
> \"/\/OnNetwork/AppServerInfo/IDMSAuthEndpoint\" leaf node defined in 3GPP
> TS 24.383 [11] and the clarifications in annex A;
>
> 2) shall generate an OIDC Authentication Request message as specified in the
> OpenID Connect 1.0 [6] and IETF RFC 6749 [5] with the following
> clarifications:
>
> a) shall generate an HTTP GET request method according to IETF RFC 2616 [4];
>
> b) shall include the configured parameter IdM client id as the client_id
> parameter specified in 3GPP TS 33.179 [2] in the query component of the
> authorization endpoint's URI using the \"application/x-www-form-urlencoded\"
> format as specified in W3C.REC-html401-19991224 [7]; and
>
> NOTE 1: The configuration of client_id is specified in 3GPP TS 24.383 [11].
>
> c) shall include the remaining required parameters as specified in 3GPP TS
> 33.179 [2] in the query component of the authorization endpoint's URI using
> the \"application/x-www-form-urlencoded\" format as specified in W3C.REC-
> html401-19991224 [7]; and
>
> 3) shall send the HTTP GET request method towards the IdM server.
>
> NOTE 2: The OpenID Connect 1.0 [6] specification allows for an alternative
> mechanism for sending the OIDC Authentication request message using an HTTP
> POST request method which can be used in place of steps 1, 2, and 3 above.
Upon receipt of an HTTP 200 (OK) response from the IdM server, the IdM client:
> 1) shall prompt the MCPTT user for their username and password;
>
> NOTE 3: Other types of authentication are supported and are not defined by
> the OIDC specifications. 3GPP TS 33.179 [2] has defined username and
> password as a mandatory authentication method to be supported; hence a
> procedure to realize that method is included here.
>
> 2) shall generate an HTTP POST request method containing the MCPTT user\'s
> username and password; and
>
> 3) shall send the HTTP POST request method towards the IdM server.
Upon receipt of an OIDC Authentication Response message, the IdM client:
> 1) shall establish a TLS tunnel to the token endpoint of the IdM server as
> specified in 3GPP TS 33.179 [2] using the configured URL of the token
> endpoint of the IdM server as specified in the
> \"/\/OnNetwork/AppServerInfo/IDMSTokenEndpoint\" leaf node defined in
> 3GPP TS 24.383 [11] and the clarifications in annex A;
>
> 2) shall generate an OIDC Token Request message as specified in OpenID
> Connect 1.0 [6] and IETF RFC 6749 [5] with the following clarifications:
>
> a) shall generate an HTTP POST request method according to IETF RFC 2616
> [4]; and
>
> b) shall include the grant_type parameter set to a value of
> \"authorization_code\" and the other required parameters in the entity body
> of the HTTP POST request method using the using the \"application/x-www-
> form-urlencoded\" format as specified in 3GPP TS 33.179 [2]; and
>
> 3) shall send the HTTP POST request method towards the IdM server.
Upon receipt of an OIDC Token Response message, the IdM client:
> 1) shall validate the id_token, access_token and refresh token in the
> received OIDC Token Response message as specified in the OpenID Connect 1.0
> [6] specification; and
>
> 2) shall provide the id_token and access_token in the received OIDC Token
> Response message to the MCPTT client.
>
> NOTE 4: The method in which the IdM client provides the id_token and
> access_token to the MCPTT client is implementation specific.
[TS 24.482, Annex A.2.1.2]
The HTTP client in the UE shall establish a TCP connection towards the home
HTTP proxy FQDN and the home HTTP proxy port, unless the specific TCP
connection is to be used for the IdM client to IdM server procedures described
in subclause 6.2 and subclause 6.3 in the present document, in which case the
HTTP client shall establish a TCP connection towards the IdM server.
The HTTP client in the UE shall establish a TLS tunnel via the TCP connection
as specified in 3GPP TS 33.179 [2]. When establishing the TLS tunnel, the HTTP
client in the UE shall act as a TLS client and the UE shall perform the TLS
tunnel authentication using the TLS authentication method indicated by the TLS
tunnel authentication method parameter according to 3GPP TS 33.179 [2]. The UE
shall use the configured TLS tunnel authentication X.509 certificate and the
configured TLS tunnel authentication pre-shared key when applicable for the
used TLS authentication method. In order to prevent man-in-the-middle attacks,
the HTTP client in the UE shall check the home HTTP proxy FQDN against the
server\'s identity as presented in the received server\'s certificate message
if the TCP connection terminates on the HTTP proxy. The HTTP client in the UE
shall not check the portion of dereferenced HTTP URL against the server\'s
identity as presented in the received server\'s certificate message if the TCP
connection terminates on the HTTP proxy, but shall do so if the TCP connection
terminates on the IdM server.
> NOTE: The TLS tunnel can be terminated in the HTTP proxy (rather than in the
> HTTP server providing the dereferenced HTTP URL).
The HTTP client in the UE shall send and receive all HTTP messages via the TLS
tunnel.
If the HTTP client in the UE has an access token of the \"bearer\" token type
as specified in IETF RFC 6750 [14], the HTTP client in the UE shall include an
Authorization header field with the \"Bearer\" authentication scheme as
specified in IETF RFC 6750 [14] in HTTP requests.
[TS 33.179 Annex D]
All KMS communications are made via HTTPS. The MCPTT key management client is
provisioned via XML content in the KMS\'s response. The XML content is
designed to be extendable to allow KMS/client providers to add further
information in the XML. Where the interface is extended, a different XML
namespace should be used (so that may be ignored by non-compatible clients).
It is assumed that transmissions between the KMS and the key management client
are secure and that the KMS has authenticated the identity of the key
management client.
Additionally, to allow the transmission of key material securely between a
secure element within the KMS and a secure element within the key management
client, a security extension is defined which allows messages to be signed and
key material to be encrypted using a shared Transport Key (TrK).
[TS 33.179 clause 5.6.1]
For key management authorization, the KM client in the UE presents an access
token to the KMS over HTTP. The KMS validates the access token and if
successful, provides user specific key material back to the UE KM client based
on the MCPTT ID of the user. This includes identity based key information used
for media and signalling protection.
For user service authorization, the MCPTT client in the UE presents an access
token to the MCPTT server over SIP. The MCPTT server validates the access
token and if successful, authorizes the user for full MCPTT services and sends
an acknowledgement back to the MCPTT client. The MCPTT server then maps and
maintains the IMPU to MCPTT ID association. The MCPTT ID to IMPU association
shall only be known to the application layer. The SIP message used to convey
the access token from the MCPTT client to the MCPTT server may be either a SIP
REGISTER or SIP PUBLISH message.
The UE can now perform configuration management authorization and download the
user profile. Following the flow described in subclause 10.1.4.2 of 3GPP TS
23.179 [2] \"MCPTT user obtains the user profile (UE initiated)\", the
Configuration Management (CM) client in the UE sends an access token in the
user profile query to the Configuration Management server over HTTP. The CM
server receives the request and validates the access token, and if valid, the
CM server uses the MCPTT ID to obtain the user profile from the MCPTT user
database. The CM server then sends the user profile back to the CM client over
HTTP.
Upon receiving the user\'s profile, the Group Management (GM) client in the UE
can now perform group management authorization. The GM client obtains the
user\'s group membership information from the user\'s profile, and following
the flow shown in clause 10.1.5.2 of 3GPP TS 23.179 [2] \"Retrieve group
configurations at the group management client\", the Group Management (GM)
client in the UE sends an access token in the Get group configuration request
to the host GM server of the group membership over HTTP. The GM server
validates the access token, and if valid, completes the flow. As part of group
management authorization, group key information is provided as per subclause
7.3.2 of the present document.
[TS 33.179 clause 7.2.3]
Case that HTTP proxy is used between the KMC and KMS
> 0) The key management client establishes a connection to the MCPTT KMS. As
> with other elements in the Common Services Core, the connection routed via,
> and secured by, the HTTP Proxy. The message flow below is within this secure
> connection.
>
> NOTE: Additionally, the connection between the MCPTT KMS and the HTTP Proxy
> is secured according to clause 8.
>
> 1) The key management client makes a request for user key material from the
> MCPTT KMS. The request contains details of the identity (e.g. the MCPTT ID)
> requested for key management, and the time for which the key material is
> required.
>
> 2) The KMS provides a response containing key material. The response
> includes the type of key material, the period of use for the material and
> any domain-specific parameters required for its use. For public safety use,
> the key material itself shall be wrapped using a 256-bit transport key
> (TrK). The TrK is distributed via an out-of-band mechanism along with a
> 32-bit identifier, TrK-ID.
Case that HTTP proxy is not used between the KMC and KMS
> 0) The key management client establishes a direct HTTPS connection to the
> MCPTT KMS. The following message flow is within this secure connection.
>
> 1) The key management client makes a request for user key material from the
> MCPTT KMS. The request contains details of the identity requested for key
> management, and the time at which the key material is required.
>
> 2) The KMS provides a response containing key material. The response
> includes the type of key material, the period of use for the material and
> any domain-specific parameters required for its use. Optionally, the key
> material itself may also be wrapped using a 256-bit transport key (TrK),
> distributed via an out-of-band mechanism along with a 32-bit identifier
> (TrK-ID).
[TS 24.484, clause 4.2.1]
Upon start up the MCPTT UE bootstraps the required information (e.g. FQDN or
IP address) to locate the configuration management server for configuration of
the MCPTT UE initial configuration management object (MO) and the default
MCPTT user profile configuration management object (MO).
In order to obtain access to the MCPTT service the MCPTT UE needs to obtain
configuration data either online via the network or offline using some
external device (e.g. a laptop). As part of the bootstrap process the MCPTT UE
needs to discover either:
> 1\. the online configuration management server in the network that
> configures the MPCTT UE initial configuration MO and the default MCPTT user
> profile configuration MO, then the MCPTT UE:
>
> a) using the URI of the configuration management server obtained from the
> MPCTT UE initial configuration MO, obtains:
>
> \- the MCPTT UE configuration document;
>
> \- the MCPTT user profile configuration document; and
>
> \- the MCPTT service configuration document; and
>
> b) using the URI of the group management server obtained from the MPCTT UE
> initial configuration MO obtain the MCPTT group document; or
[TS 24.484, clause 4.2.2]
The MCPTT UE contacts the identity management server using the HTTPS URI
stored in the MCPTT UE initial configuration MO and performs MCPTT User
authentication as specified in 3GPP TS 24.382 [6].
The MCPTT UE, using the MCPTT ID obtained during MCPTT user authentication,
subscribes to the MCPTT UE configuration document, the MCPTT user profile
configuration document and the MCPTT service configuration document using the
procedure for subscribing to multiple documents simultaneously using the
subscription proxy function specified in subclause 6.3.13.2.2 (i.e., the CMS
acts as a Subscription Proxy) and subscribes to the MCPTT group document using
the procedure specified in 3GPP TS 24.381 [5]. If these documents have been
updated since the current version stored in the MCPTT UE, then the MCPTT UE
will receive a SIP NOTIFY request with an XCAP Diff document (see IETF RFC
5875 [11]), in which case the CMC updates its local document copies. Retrieval
by the MCPTT UE using the notified HTTPS URI of the MCPTT group document is
performed as specified in 3GPP TS 24.381 [5].
[TS 24.484, clause 6.2.2]
The CMC shall send the HTTP request over TLS connection as specified for the
HTTP client in the UE in annex A of 3GPP TS 24.382 [6].
[TS 24.484, clause 6.3.1.1]
A CMC shall support subclause 6.1.1 \"_Document Management_ \" of OMA OMA-TS-
XDM_Core-V2_1 [2] and subclause 6.3.13.2.2 for subscribing to configuration
management documents.
[TS 24.484, clause 6.3.3.2.1]
In order to retrieve a configuration management document, a GC shall send an
HTTP GET request with the Request URI that references the document to be
updated to the network according to procedures specified in IETF RFC 4825 [14]
\"_Retrieve a Document_ \".
[TS 24.484, clause 6.3.3.2.2]
In order to retrieve a configuration management document, a CMC shall perform
the procedures in subclause 6.3.3.2.1 specified for GC. The CMC shall set the
Request-URI of the HTTP GET request to the \"CMSXCAPRootURI\" configured as
per 3GPP TS 24.383 [4] and include the \"auid\" as per the appropriate
application usage in clause 7.
Subclause 7.5 specifies which configuration management documents can be
retrieved from the CMS over the CSC-4 reference point.
[TS 24.484, clause 6.3.13.2.1]
This procedure enables the CMC to subscribe to notification of changes of one
or more configuration management documents defined in clause 7.
This procedure enables the MCPTT server to subscribe to notification of
changes of the MCPTT service configuration document.
[TS 24.484, clause 6.3.13.2.2]
In order to subscribe to Configuration management document, a CMC shall send
an initial SIP SUBSCRIBE request to the network according to the UE
originating procedures specified in 3GPP TS 24.229 [22] and IETF RFC 5875
[11]. In the initial SIP SUBSCRIBE request, the CMC:
> a) ...
>
> b) if subscription to multiple documents simultaneously using the
> subscription proxy function is used:
>
> 1) shall include an application/resource-lists+xml MIME body. In the
> application/resource-lists+xml MIME body, the CMC shall include one \
> element for each document or element to be subscribed to, such that the
> \"uri\" attribute of the \ element contains a relative path
> reference:
>
> A) with the base URI being equal to the \"CMSXCAPRootURI\" configured in the
> CMC as per 3GPP TS 24.383 [4]; and
>
> B) with the \"auid\" parameter set to the appropriate application usage
> identifying a configuration management document as described in clause 7;
>
> 2) shall set the Request-URI to the configured public service identity for
> performing subscription proxy function of the CMS;
>
> c) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element set to the value of the access token received
> during authentication procedure as described in 3GPP TS 24.382 [6];
>
> d) if identity hiding is required:
>
> 1) shall perform the confidentiality protection procedures and integrity
> protection procedures defined in 3GPP TS 24.379 [9] for MCPTT client on the
> application/vnd.3gpp.mcptt-info+xml MIME body and on the
> application/resource-lists+xml MIME body; and
>
> 2) shall include an application/mikey MIME body with the CSK as specified in
> 3GPP TS 24.379 [9];
>
> e) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [22]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [23]; and
>
> f) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field.
Upon receiving a SIP NOTIFY request associated with a subscription created as
result of the sent initial SIP SUBSCRIBE request:
> 1) if identity hiding is required, the CMC shall perform the confidentiality
> protection procedures and integrity protection procedures defined in 3GPP TS
> 24.379 [9] for MCPTT client; and
>
> 2) shall handle the SIP NOTIFY request according to IETF RFC 5875 [11].
[TS 24.481, clauses 6.2.2.2]
In order to address an existing group document defining a group ID known by
GC, the GC shall set the Request-URI of an HTTP request to a XCAP URI
identifying a group document addressed by a group ID as described in subclause
7.2.10.2, where the group ID is set to the group ID known by GC and where the
XCAP root URI is the XCAP root URI configured in the UE.
[TS 24.481, clauses 6.2.3]
The GMC shall send the HTTP request over a TLS connection as specified for the
HTTP client in the UE in annex A of 3GPP TS 24.382 [10].
The GMC shall perform the procedures in subclause 6.2.2 specified for GC.
[TS 24.481, clauses 6.3.3.2.1]
In order to retrieve a group document, a GC shall send an HTTP GET request
with the Request URI that references the document to be retrieved to the
network according to procedures specified in IETF RFC 4825 [22] \"_Fetch a
Document_ \".
[TS 24.481, clauses 6.3.3.2.2]
In order to retrieve a group document, a GMC shall perform the procedures in
subclause 6.3.3.2.1 specified for GC.
[TS 24.481, clauses 6.3.13.2.1]
In order to subscribe to notification of changes of:
> a) one or more MCPTT group documents of MCPTT groups identified by MCPTT
> group IDs;
>
> ...
a GMC shall send an initial SIP SUBSCRIBE request to the network according to
the UE originating procedures specified in 3GPP TS 24.229 [12] and IETF RFC
5875 [13]. In the initial SIP SUBSCRIBE request, the GMC:
> a) shall include an application/resource-lists+xml MIME body. In the
> application/resource-lists+xml MIME body, the GMC shall include one \
> element for each document or element to be subscribed to, such that the
> \"uri\" attribute of the \ element:
>
> 1) contains a relative path reference:
>
> A) with the base URI being equal to the XCAP root URI configured in the GMC;
> and
>
> B) identifying a group document addressed by a group ID as described in
> subclause 7.2.10.2 where the group ID is set to the MCPTT group ID; or
>
> ...
>
> b) shall set the Request-URI to the configured public service identity for
> performing subscription proxy function of the GMS;
>
> c) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element set to the value of the access token received
> during authentication procedure as described in 3GPP TS 24.382 [49];
>
> d) if identity hiding is required:
>
> 1) shall perform the confidentiality protection procedures and integrity
> protection procedures defined in 3GPP TS 24.379 [5] for MCPTT client on the
> application/vnd.3gpp.mcptt-info+xml MIME body and on the
> application/resource-lists+xml MIME body; and
>
> 2) shall include an application/mikey MIME body with the CSK as specified in
> 3GPP TS 24.379 [5];
>
> e) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [12]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [14]; and
>
> f) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field.
Upon receiving a SIP NOTIFY request associated with a subscription created as
result of the sent initial SIP SUBSCRIBE request:
> 1) if identity hiding is required, the GMC shall perform the confidentiality
> protection procedures and integrity protection procedures defined in 3GPP TS
> 24.379 [5] for MCPTT client; and
>
> 2) shall handle the SIP NOTIFY request according to IETF RFC 5875 [13].
[TS 24.379, clause 7.2.1]
When the MCPTT client performs SIP registration the MCPTT client shall perform
the registration procedures as specified in 3GPP TS 24.229 [4].
The MCPTT client shall include the following media feature tags in the Contact
header field of the SIP REGISTER request:
> 1) the g.3gpp.mcptt media feature tag; and
>
> 2) the g.3gpp.icsi-ref media feature tag containing the value of
> \"urn:urn-7:3gpp-service.ims.icsi.mcptt\".
...
If the MCPTT client, upon performing SIP registration:
> 1) has successfully finished the user authentication procedure as described
> in 3GPP TS 24.382 [49];
>
> 2) has an available access-token;
>
> 3) based on implementation decides to use SIP REGISTER for service
> authorization; and
>
> 4) either confidentiality protection is enabled as specified in subclause
> 6.6.2.3.1 or integrity protection is enabled as specified in subclause
> 6.6.3.3.1;
then the MCPTT client:
> ...
>
> 2) if confidentiality protection is enabled as specified in subclause
> 6.6.2.3.1, shall encrypt the received access-token using the client server
> key (CSK) and shall include in the body of the SIP REGISTER request, an
> application/vnd.3gpp.mcptt-info+xml MIME body with the \
> element set to the encrypted access-token, as specified in subclause
> 6.6.2.3.3;
>
> ...
>
> 4) if integrity protection is enabled as specified in subclause 6.6.3.3.1,
> shall use the CSK to integrity protect the application/vnd.3gpp.mcptt-
> info+xml MIME body by following the procedures in subclause 6.6.3.3.3.
[TS 24.379, clause 7.2.1A]
This procedure is only referenced from other procedures.
When populating the SIP PUBLISH request, the MCPTT client shall:
> 1) shall set the Request-URI to the public service identity identifying the
> participating MCPTT function serving the MCPTT user;
>
> 2) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9];
>
> 3) shall set the Event header field to the \"poc-settings\" value; and
>
> 4) shall set the Expires header field according to IETF RFC 3903 [37], to
> 4294967295, if the MCPTT user is not removing the MCPTT service settings,
> otherwise to remove the MCPTT service settings the MCPTT client shall set
> the Expires header field to zero.
[TS 24.379, clause 7.2.2]
If based on implementation the MCPTT client decides to use SIP PUBLISH for
MCPTT server settings to also perform service authorization and
> 1) has successfully finished the user authentication procedure as described
> in 3GPP TS 24.382 [49]; and
>
> 2) has available an access-token;
then the MCPTT client:
> 1) shall perform the procedures in subclause 7.2.1A;
>
> ...
>
> 3) if either confidentiality protection is enabled as specified in subclause
> 6.6.2.3.1 or integrity protection is enabled as specified in subclause
> 6.6.3.3.1 shall include an application/mikey MIME body with the CSK as
> MIKEY-SAKKE I_MESSAGE as specified in 3GPP TS 33.179 [46] in the body of the
> SIP PUBLISH request;
>
> 4) if confidentiality protection is enabled as specified in subclause
> 6.6.2.3.1, shall include in the body of the SIP PUBLISH request an
> application/vnd.3gpp.mcptt-info+xml MIME body with:
>
> a) the \ element set to the received access-token
> encrypted using the client server key (CSK), as specified in subclause
> 6.6.2.3.3; and
>
> b) the \ element set to the encrypted MCPTT client ID of
> the originating MCPTT client, as specified in subclause 6.6.2.3.3;
>
> ...
>
> 6) shall include an application/poc-settings+xml MIME body containing the
> Answer-Mode Indication setting in the \ element of the poc-
> settings event package set to the current answer mode setting (\"auto-
> answer\" or \"manual-answer\") of the MCPTT client according to IETF RFC
> 4354 [55]; and
>
> 7) if integrity protection is enabled as specified in subclause 6.6.3.3.1,
> shall use the CSK to integrity protect the application/vnd.3gpp.mcptt-
> info+xml MIME body and application/poc-settings+xml MIME body by following
> the procedures in subclause 6.6.3.3.3.
The MCPTT client shall send the SIP PUBLISH request according to 3GPP TS
24.229 [4].
[TS 24.379, clause 7.2.3]
To set, update, remove or refresh the MCPTT service settings, the MCPTT client
shall generate a SIP PUBLISH request according 3GPP TS 24.229 [4], IETF RFC
3903 [37] and IETF RFC 4354 [55]. In the SIP PUBLISH request, the MCPTT
client:
> 1) shall perform the procedures in subclause 7.2.1A;
>
> 2) if confidentiality protection is enabled as specified in subclause
> 6.6.2.3.1, shall include in the body of the SIP PUBLISH request, an
> application/vnd.3gpp.mcptt-info+xml MIME body with:
>
> a) the \ element set to the targeted MCPTT ID encrypted
> using the client server key (CSK), as specified in subclause 6.6.2.3.3; and
>
> b) the \ element set to the encrypted MCPTT client ID of
> the originating MCPTT client, as specified in subclause 6.6.2.3.3;
>
> ...
>
> 4) shall include an application/poc-settings+xml MIME body containing the
> Answer-Mode Indication setting in the \ element of the poc-
> settings event package set to the current answer mode setting (\"auto-
> answer\" or \"manual-answer\") of the MCPTT client according to IETF RFC
> 4354 [55]; and
>
> 5) if integrity protection is enabled as specified in subclause 6.6.3.3.1,
> shall use the CSK to integrity protect the application/vnd.3gpp.mcptt-
> info+xml MIME body and application/poc-settings+xml MIME body by following
> the procedures in subclause 6.6.3.3.3.
The MCPTT client shall send the SIP PUBLISH request according to 3GPP TS
24.229 [4].
On receiving the SIP 200 (OK) response to the SIP PUBLISH request the MCPTT
client may indicate to the MCPTT User the successful communication of the
MCPTT service settings to the MCPTT server.
[TS 33.179, clause 6.2]
The support of Transport Layer Security (TLS) on HTTP-1 is mandatory. The
profile for TLS implementation and usage shall follow the provisions given in
3GPP TS 33.310 [5], annex E.
If the PSK TLS based authentication mechanism is supported, the HTTP client in
the MCPTT UE and the HTTP Proxy shall support the TLS version, PSK
ciphersuites and TLS Extensions as specified in the TLS profile given in 3GPP
TS 33.310 [5], annex E. The usage of pre-shared key ciphersuites for TLS is
specified in the TLS profile given in 3GPP TS 33.310 [5], annex E.
##### 5.1.3 Test description {#test-description .H6}
##### 5.1.3.1 Pre-test conditions {#pre-test-conditions .H6}
##### System Simulator: {#system-simulator .H6}
\- SS (MCPTT server).
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- The MCPTT client has been provisioned with the Initial UE Configuration
Data as specified in TS 36.579-1 [2] clause 5.5.8.1 allowing for the location
of the configuration management server for configuration of the MCPTT UE
initial configuration management object (MO) and the default MCPTT user
profile configuration management object (MO).
\- A single APN (px_MCX_APN, TS 36.579-5 [5]) shall be provided in the Initial
UE Configuration Data which the UE shall use to access each and all MCPTT
relevant services including the MCPTT SIP-1 reference point, the MC common
core services for the HTTP-1 reference point and the MC identity management
service for the CSC-1 reference point.
\- According to TS 33.180 [94] all HTTP connections are secured by TLS.\ The
HTTP-1 interface authentication between the HTTP client in the MC UE and the
HTTP server endpoint (HTTP proxy, IdM server or KMS) shall be performed by
one-way authentication of the HTTP server endpoint based on server certificate
as described in TS 33.180 [33] clause 6.1.1.
\- The UE User is provided with username/password for user authentication
(px_MCX_User_A_username, px_MCX_User_A_password as provided in TS 36.579-5
[5], Table 9.2-1: MCX Client Common PIXIT).
\- The UE is provisioned with the names and values of the Transport Key (TrK)
and the Integrity Key (InK), since the KMS shall encrypt the key material sent
to the client with the TrK and sign the response with the TrK or the InK
according to TS 33.180 [94].
##### Preamble: {#preamble .H6}
\- The UE is Switched OFF (state 1) according to TS 36.508 [24].
##### 5.1.3.2 Test procedure sequence {#test-procedure-sequence .H6}
Table 5.1.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | The UE is | - | - | - | - | | | swi | | | | | | | tched-on. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | related | | | | | | | actions | | | | | | | triggered | | | | | | | by step 1 | | | | | | | above are | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | clause | | | | | | | 5.4.2 | | | | | | | \'MCPTT | | | | | | | UE | | | | | | | regis | | | | | | | tration\' | | | | | | | starting | | | | | | | with step | | | | | | | 2. The | | | | | | | test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | service | | | | | | | authorisa | | | | | | | tion/conf | | | | | | | iguration | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3-12 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1-10 of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | user | | | | | | | authent | | | | | | | ication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.2.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13-16 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 11-14 of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | user | | | | | | | authent | | | | | | | ication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.2.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | In | | | | | | | parallel | | | | | | | to the | | | | | | | events | | | | | | | described | | | | | | | in all | | | | | | | steps | | | | | | | below, | | | | | | | the steps | | | | | | | in Table | | | | | | | 5.1.3.2-2 | | | | | | | and Table | | | | | | | 5.1.3.2-3 | | | | | | | shall | | | | | | | take | | | | | | | place. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 17a1-17b2 | | | | | | | describe | | | | | | | behaviour | | | | | | | that | | | | | | | depends | | | | | | | on UE | | | | | | | implem | | | | | | | entation; | | | | | | | the | | | | | | | \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | i | | | | | | | dentifies | | | | | | | a step | | | | | | | sequence | | | | | | | that take | | | | | | | place | | | | | | | when one | | | | | | | or the | | | | | | | other is | | | | | | | the case. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 17a1 | Check: | --> | SIP | 3 | P | | | Does the | | REGISTER | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | REGISTER | | | | | | | request | | | | | | | for | | | | | | | service | | | | | | | autho | | | | | | | risation? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 17a2 | The SS | \ | SIP | 6 | P | | | Does the | | PUBLISH | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | PUBLISH | | | | | | | request | | | | | | | for | | | | | | | update of | | | | | | | PoC- | | | | | | | settings? | | | | | | | | | | | | | | NOTE: See | | | | | | | NOTE 1 of | | | | | | | TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.2.3-2. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 17a4 | The SS | \ | SIP | 3, 6 | P | | | Does the | | PUBLISH | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | PUBLISH | | | | | | | request | | | | | | | for | | | | | | | service | | | | | | | auth | | | | | | | orisation | | | | | | | and | | | | | | | update of | | | | | | | PoC- | | | | | | | settings? | | | | | | | | | | | | | | NOTE: See | | | | | | | NOTE 1 of | | | | | | | TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.2.3-2. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 17b2 | The SS | \ a) shall set the Request-URI to an XCAP URI:
>
> 1) in users tree where the XUI is set to a group creation XUI configuration
> parameter; and
>
> 2) with the document selector identifying the temporary MCPTT group to be
> created; and
>
> b) shall include an application/vnd.3gpp.GMOP+xml MIME body containing a
> GMOP document requesting group regroup creation specified in subclause
> 7.3.4.3, with a \ element containing a group document for an MCPTT
> group. In the group document, the GMC shall include the \ temporary> element according to subclause 7.2. In the \ temporary> element, the GMC shall include \
> element according to subclause 7.2. In the \
> element, the GMC shall include one \ element
> according to subclause 7.2 for each MCPTT group to be combined.
Upon reception of an HTTP 2xx response to the sent HTTP POST request, the GMC
shall consider the temporary MCPTT group formation as successful.
Upon reception of an HTTP 409 (Conflict) response with at least one \ element in the \ error element, the GMC may repeat
procedures of the present subclause and identify the temporary MCPTT group
being formed with an MCPTT Group ID indicated in an \ element.
[TS 24.481 clause 6.3.15.1] This procedure enables a GMC to initiate tear down
of a temporary MCPTT group.
[TS 24.481 clause 6.3.15.2]
In order to tear down a temporary MCPTT group, the GMC shall send an HTTP
DELETE request with Request-URI with an XCAP URI identifying a group document
of the temporary MCPTT group according to procedures specified in IETF RFC
4825 [22] \"_Delete an Element_ \".
[TS 33.180 clause 7.3.2]
The group creation procedure is described in clause 10.2.3 of 3GPP TS 23.280
[36] and applies to the MCPTT scenario of normal group creation by an MC
administrator and user regrouping operations by an authorized user/dispatcher.
To establish the security context for the group, the GMS follows the
procedures in clause 5.7 to create a new GMK and GMK-ID.
The encapsulated GMK and GUK-ID is sent to group members by the GMS within a
notification message (step 4 in clause 10.2.3 of 3GPP TS 23.280 [36]). The
procedure is equivalent to that described in clause 5.7 of this specification.
[TS 33.180 clause 7.3.3.2]
Group Regroup procedures for the MC system are described in clause 10.2.4.1 of
3GPP TS 23.280 [36]. To create the security context for the temporary group,
the GMS follows the procedures in clause 5.7, creating a new GMK and GMK-ID
for the temporary group.
An encapsulated GMK and GUK-ID is sent to the temporary group members by the
GMS within a notification message (step 5 in clause 10.2.4.1 of 3GPP TS 23.280
[36]). The procedure is equivalent to that described in clause 5.7.
##### 5.2.3 Test description {#test-description-1 .H6}
##### 5.2.3.1 Pre-test conditions {#pre-test-conditions-1 .H6}
##### System Simulator: {#system-simulator-1 .H6}
\- SS (MCPTT server)
\- E-UTRA related parameters are set to the default parameters for the basic
single cell environment, as defined in TS 36.508 [6] clause 4.4.
##### IUT: {#iut-1 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-1 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 5.2.3.2 Test procedure sequence {#test-procedure-sequence-1 .H6}
Table 5.2.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | The | | | | | | | E-UTRA/EPC | | | | | | | related | | | | | | | actions | | | | | | | are | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | clause | | | | | | | 5.4.3 | | | | | | | \'MCPTT CO | | | | | | | com | | | | | | | munication | | | | | | | in | | | | | | | E-UTRA\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows only | | | | | | | the MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | being | | | | | | | exchanged. | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | creation | | | | | | | of a new | | | | | | | group | | | | | | | (group B). | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | Group | | | | | | | Creation\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.26.3-1 | | | | | | | to create | | | | | | | group B? | | | | | +------------+------------+------------+---------+---------+----+ | 4-12 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 13 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | creation | | | | | | | of a | | | | | | | temporary | | | | | | | group T | | | | | | | combining | | | | | | | groups A | | | | | | | and B. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 14 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | Group | | | | | | | Creation\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.27.3-1 | | | | | | | to create | | | | | | | temporary | | | | | | | group T? | | | | | +------------+------------+------------+---------+---------+----+ | 14A | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'NW | | | | | | | initiated | | | | | | | not | | | | | | | ifications | | | | | | | regarding | | | | | | | temporary | | | | | | | group | | | | | | | creation\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.22.3-1 | | | | | | | to update | | | | | | | the group | | | | | | | document | | | | | | | of group A | | | | | | | and | | | | | | | retrieve | | | | | | | the GMK | | | | | | | for the | | | | | | | temporary | | | | | | | group | | | | | +------------+------------+------------+---------+---------+----+ | 15-20 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 21 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | tear down | | | | | | | of | | | | | | | temporary | | | | | | | group T. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 22 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | Group Tear | | | | | | | Down\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.28.3-1 | | | | | | | to delete | | | | | | | temporary | | | | | | | group T? | | | | | +------------+------------+------------+---------+---------+----+ | 22A | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'NW | | | | | | | initiated | | | | | | | not | | | | | | | ifications | | | | | | | regarding | | | | | | | temporary | | | | | | | group tear | | | | | | | down\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.22.3-1 | | | | | | | to update | | | | | | | the group | | | | | | | document | | | | | | | and the | | | | | | | GKTP | | | | | | | document | | | | | | | of group | | | | | | | A? | | | | | +------------+------------+------------+---------+---------+----+ | 23-26 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | mechanism | | | | | | | and may be | | | | | | | manually | | | | | | | or | | | | | | | aut | | | | | | | omatically | | | | | | | initiated. | | | | | | +------------+------------+------------+---------+---------+----+
##### 5.2.3.3 Specific message contents {#specific-message-contents-1 .H6}
Table 5.2.3.3-1..16: Void
Table 5.2.3.3-17: HTTP PUT (step 3, Table 5.2.3.2-1;\ step 1, TS 36.579-1 [2],
Table 5.3.26.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.4-1, condition GROUPCREATE
* * *
Table 5.2.3.3-18: HTTP POST (step 14, Table 5.2.3.2-1;\ step 1, TS 36.579-1
[2], Table 5.3.27.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.3-1, condition TEMPGROUP
* * *
Table 5.2.3.3-19: HTTP 200 (OK) (step 14, Table 5.2.3.2-1;\ step 2, TS
36.579-1 [2], Table 5.3.27.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.6-1, condition TEMPGROUP
* * *
Table 5.2.3.3-20: HTTP DELETE (step 22, Table 5.2.3.2-1;\ step 1, TS 36.579-1
[2], Table 5.3.28.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.5-1, condition TEMPGROUP
* * *
5.3 Configuration / Group Affiliation / Remote change / De-affiliation / Home
MCPTT system
##### 5.3.1 Test Purpose (TP) {#test-purpose-tp-2 .H6}
##### (1) {#section-9 .H6}
**with** { MCPTT Client already provisioned with the group information or a
pointer to the group information, that the MCPTT Client is allowed to be
affiliated }
**ensure that** {\ **when** { MCPTT User requests for current affiliation
status and to subscribe to affiliation status changes for the MCPTT User }
**then** { UE (MCPTT Client) requests to subscribe to affiliation status
changes for the MCPTT User by sending the SS a SIP SUBSCRIBE message **and**
starts informing the MCPTT User of any affiliation status changes for the
MCPTT User after the subscription is accepted }
}
##### (2) {#section-10 .H6}
**with** { MCPTT Client already provisioned with the group information or a
pointer to the group information, that the MCPTT Client is allowed to be
affiliated }
**ensure that** {\ **when** { MCPTT User requests to affiliate to an MCPTT
group }
**then** { UE (MCPTT Client) requests to affiliate to an MCPTT group by
sending the SS a SIP PUBLISH message }
}
##### (3) {#section-11 .H6}
**with** { MCPTT Client already provisioned with the group information or a
pointer to the group information, that the MCPTT Client is allowed to be
affiliated }
**ensure that** {\ **when** { MCPTT User requests for current affiliation
status and to subscribe to affiliation status changes for a target user }
**then** { UE (MCPTT Client) requests to subscribe to affiliation status
changes for the target user by sending the SS a SIP SUBSCRIBE message **and**
starts informing the MCPTT User of any affiliation status changes for the
target user after the subscription is accepted }
}
##### (4) {#section-12 .H6}
**with** { MCPTT client already provisioned with the group information or a
pointer to the group information that the MCPTT client is allowed to make
affiliation changes for another user }
**ensure that** {\ **when** { MCPTT User requests that a target user be
affiliated to an MCPTT group via mandatory mode }
**then** { UE (MCPTT Client) requests that a target user be affiliated to an
MCPTT group via mandatory mode by sending the SS a SIP PUBLISH message }
}
##### (5) {#section-13 .H6}
**with** { MCPTT client already provisioned with the group information or a
pointer to the group information that the MCPTT client is allowed to make
affiliation changes for another user }
**ensure that** {\ **when** { MCPTT User requests that a target user be de-
affiliated to an MCPTT group via mandatory mode }
**then** { UE (MCPTT Client) requests that a target user be de-affiliated to
an MCPTT group via mandatory mode by sending the SS a SIP PUBLISH message }
}
##### (6) {#section-14 .H6}
**with** { MCPTT client already provisioned with the group information or a
pointer to the group information that the MCPTT client is allowed to make
affiliation changes for another user }
**ensure that** {\ **when** { MCPTT User requests that a target user be
affiliated to an MCPTT group via negotiated mode }
**then** { UE (MCPTT Client) requests that a target user be affiliated to an
MCPTT group via negotiated mode by sending the SS a SIP MESSAGE message }
}
##### (7) {#section-15 .H6}
**with** { MCPTT Client already provisioned with the group information or a
pointer to the group information, that the MCPTT Client is allowed to be
affiliated }
**ensure that** {\ **when** { MCPTT User requests to de-subscribe to
affiliation status changes for a target user }
**then** { UE (MCPTT Client) requests to de-subscribe to affiliation status
changes for a target user by sending the SS a SIP SUBSCRIBE message }
}
##### (8) {#section-16 .H6}
**with** { MCPTT Client already affiliated with an MCPTT group }
**ensure that** {\ **when** { MCPTT User requests to de-affiliate from an
MCPTT group }
**then** { UE (MCPTT Client) requests to de-affiliate from an MCPTT group by
sending the SS a SIP PUBLISH message }
}
##### (9) {#section-17 .H6}
**with** { MCPTT Client already provisioned with the group information or a
pointer to the group information, that the MCPTT Client is allowed to be
affiliated }
**ensure that** {\ **when** { MCPTT Server requests that the MCPTT User choose
to affiliate to an MCPTT group via negotiated mode by sending a SIP MESSAGE
message }
**then** { UE (MCPTT Client) accepts to affiliate to an MCPTT group by sending
the SS a SIP PUBLISH message }
}
##### 5.3.2 Conformance requirements {#conformance-requirements-2 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379, clauses 9.2.1.2, 9.2.1.3, 9.2.1.4, and 9.2.1.5.
Unless otherwise stated, these are Rel-13 requirements.
[TS 24.379, clause 9.2.1.2]
In order:
> \- to indicate that an MCPTT user is interested in one or more MCPTT
> group(s) at an MCPTT client;
>
> \- to indicate that the MCPTT user is no longer interested in one or more
> MCPTT group(s) at the MCPTT client;
>
> \- to refresh indication of an MCPTT user interest in one or more MCPTT
> group(s) at an MCPTT client due to near expiration of the expiration time of
> an MCPTT group with the affiliation status set to the \"affiliated\" state
> received in a SIP NOTIFY request in subclause 9.2.1.3;
>
> \- to send an affiliation status change request in mandatory mode to another
> MCPTT user; or
>
> \- any combination of the above;
the MCPTT client shall generate a SIP PUBLISH request according to 3GPP TS
24.229 [4], IETF RFC 3903 [37], and IETF RFC 3856 [51].
In the SIP PUBLISH request, the MCPTT client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCPTT function serving the MCPTT user;
>
> 2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the
> application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall
> include the \ element set to the MCPTT ID of the MCPTT
> user;
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9];
>
> 4) if the targeted MCPTT user is interested in at least one MCPTT group at
> the targeted MCPTT client, shall set the Expires header field according to
> IETF RFC 3903 [37], to 4294967295;
>
> NOTE 1: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 5) if the targeted MCPTT user is no longer interested in any MCPTT group at
> the targeted MCPTT client, shall set the Expires header field according to
> IETF RFC 3903 [37], to zero; and
>
> 6) shall include an application/pidf+xml MIME body indicating per-user
> affiliation information according to subclause 9.3.1. In the MIME body, the
> MCPTT client:
>
> a) shall include all MCPTT groups where the targeted MCPTT user indicates
> its interest at the targeted MCPTT client;
>
> b) shall include the MCPTT client ID of the targeted MCPTT client;
>
> c) shall not include the \"status\" attribute and the \"expires\" attribute
> in the \ element; and
>
> d) shall set the \ child element of the \ root element to a
> globally unique value.
The MCPTT client shall send the SIP PUBLISH request according to 3GPP TS
24.229 [4].
[TS 24.379, clause 9.2.1.3]
> NOTE 1: The MCPTT UE also uses this procedure to determine which MCPTT
> groups the MCPTT user successfully affiliated to.
In order to discover MCPTT groups:
> 1) which the MCPTT user at an MCPTT client is affiliated to; or
>
> 2) which another MCPTT user is affiliated to;
the MCPTT client shall generate an initial SIP SUBSCRIBE request according to
3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [27].
In the SIP SUBSCRIBE request, the MCPTT client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCPTT function serving the MCPTT user;
>
> 2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the
> application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall
> include the \ element set to the MCPTT ID of the targeted
> MCPTT user;
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9];
>
> 4) if the MCPTT client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [26], to 4294967295;
>
> NOTE 2: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 5) if the MCPTT client wants to fetch the current state only, shall set the
> Expires header field according to IETF RFC 6665 [26], to zero; and
>
> 6) shall include an Accept header field containing the application/pidf+xml
> MIME type; and
>
> 7) if requesting MCPTT groups where the MCPTT user is affiliated to at the
> MCPTT client, shall include an application/simple-filter+xml MIME body
> indicating per client restrictions of presence event package notification
> information according to subclause 9.3.2.
In order to re-subscribe or de-subscribe, the MCPTT client shall generate an
in-dialog SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856
[51], and IETF RFC 6665 [26]. In the SIP SUBSCRIBE request, the MCPTT client:
> 1) if the MCPTT client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [26], to 4294967295;
>
> NOTE 3: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 2) if the MCPTT client wants to de-subscribe, shall set the Expires header
> field according to IETF RFC 6665 [26], to zero; and
>
> 3) shall include an Accept header field containing the application/pidf+xml
> MIME type.
Upon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC
3856 [51], and IETF RFC 6665 [26], if SIP NOTIFY request contains an
application/pidf+xml MIME body indicating per-user affiliation information
constructed according to subclause 9.3.1, then the MCPTT client shall
determine affiliation status of the MCPTT user for each MCPTT group at the
MCPTT client(s) in the MIME body. If the \ child element of the
\ root element of the application/pidf+xml MIME body of the SIP
NOTIFY request is included, the \ element value indicates the SIP
PUBLISH request which triggered sending of the SIP NOTIFY request.
[TS 24.379, clause 9.2.1.4]
> NOTE: Procedure for sending affiliation status change request in negotiated
> mode to several target MCPTT users is not supported in this version of the
> specification.
Upon receiving a request from the MCPTT user to send an affiliation status
change request in negotiated mode to a target MCPTT user, the MCPTT client
shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and
IETF RFC 3428 [33]. In the SIP MESSAGE request, the MCPTT client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCPTT function serving the MCPTT user;
>
> 2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the
> application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall
> include the \ element set to the MCPTT ID of the target
> MCPTT user;
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP MESSAGE request;
>
> 4) shall include an application/vnd.3gpp.mcptt-affiliation-command+xml MIME
> body as specified in Annex F.4; and
>
> 5) shall send the SIP MESSAGE request according to rules and procedures of
> 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP MESSAGE request, the MCPTT client
shall indicate to the user that the request has been delivered to an MCPTT
client of the target MCPTT user.
[TS 24.379, clause 9.2.1.5]
Upon receiving a SIP MESSAGE request containing:
> 1) the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as
> specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field
> according to IETF RFC 6050 [9]; and
>
> 2) an application/vnd.3gpp.mcptt-affiliation-command+xml MIME body with a
> list of MCPTT groups for affiliation under the \ element and a
> list of MCPTT groups for de-affiliation under the \ element;
then the MCPTT client:
> 1) shall send a 200 (OK) response to the SIP MESSAGE request;
>
> 2) shall seek confirmation of the list of MCPTT groups for affiliation and
> the list of MCPTT groups for de-affiliation, resulting in an accepted list
> of MCPTT groups for affiliation and an accepted list of MCPTT groups for de-
> affiliation; and
>
> 3) if the user accepts the request:
>
> a) shall perform affiliation for each entry in the accepted list of MCPTT
> groups for affiliation for which the MCPTT client is not affiliated, as
> specified in subclause 9.2.1.2; and
>
> b) shall perform de-affiliation for each entry in the accepted list of MCPTT
> groups for de-affiliation for which the MCPTT client is affiliated, as
> specified in subclause 9.2.1.2.
##### 5.3.3 Test description {#test-description-2 .H6}
##### 5.3.3.1 Pre-test conditions {#pre-test-conditions-2 .H6}
##### System Simulator: {#system-simulator-2 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-2 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-2 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble:
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 5.3.3.2 Test procedure sequence {#test-procedure-sequence-2 .H6}
Table 5.3.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +------------+------------+------------+---------+---------+----+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | subscribe | | | | | | | to | | | | | | | a | | | | | | | ffiliation | | | | | | | status | | | | | | | det | | | | | | | ermination | | | | | | | and later | | | | | | | not | | | | | | | ifications | | | | | | | for user | | | | | | | A. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2-4A | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-5 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Su | | | | | | | bscription | | | | | | | and | | | | | | | Noti | | | | | | | fication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.29.3-1 | | | | | | | to | | | | | | | subscribe | | | | | | | to its own | | | | | | | a | | | | | | | ffiliation | | | | | | | status | | | | | | | changes? | | | | | +------------+------------+------------+---------+---------+----+ | 4B | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | being | | | | | | | affiliated | | | | | | | with group | | | | | | | A? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 4C | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | de-a | | | | | | | ffiliation | | | | | | | of user A | | | | | | | from group | | | | | | | A. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 4D-4I | Check: | - | - | 8 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-7 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Group | | | | | | | A | | | | | | | ffiliation | | | | | | | status | | | | | | | change\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.34.3-1 | | | | | | | to | | | | | | | de | | | | | | | -affiliate | | | | | | | with group | | | | | | | A? | | | | | +------------+------------+------------+---------+---------+----+ | 4J | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | being no | | | | | | | longer | | | | | | | affiliated | | | | | | | with group | | | | | | | A? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | a | | | | | | | ffiliation | | | | | | | of user A | | | | | | | to group | | | | | | | A. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 6-9A | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-7 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Group | | | | | | | A | | | | | | | ffiliation | | | | | | | status | | | | | | | change\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.34.3-1 | | | | | | | to | | | | | | | affiliate | | | | | | | with group | | | | | | | A? | | | | | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | being | | | | | | | affiliated | | | | | | | with group | | | | | | | A? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 11 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | subscribe | | | | | | | to | | | | | | | a | | | | | | | ffiliation | | | | | | | status | | | | | | | det | | | | | | | ermination | | | | | | | and later | | | | | | | not | | | | | | | ifications | | | | | | | for | | | | | | | targeted | | | | | | | user B. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 12-13B | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-5 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Su | | | | | | | bscription | | | | | | | and | | | | | | | Noti | | | | | | | fication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.29.3-1 | | | | | | | to | | | | | | | subscribe | | | | | | | to | | | | | | | a | | | | | | | ffiliation | | | | | | | status | | | | | | | changes of | | | | | | | a target | | | | | | | user? | | | | | +------------+------------+------------+---------+---------+----+ | 14 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | send an | | | | | | | a | | | | | | | ffiliation | | | | | | | status | | | | | | | change | | | | | | | request to | | | | | | | affiliate | | | | | | | targeted | | | | | | | user B to | | | | | | | group A | | | | | | | (mandatory | | | | | | | mode). | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 15-18A | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-7 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Group | | | | | | | A | | | | | | | ffiliation | | | | | | | status | | | | | | | change\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.34.3-1 | | | | | | | to have | | | | | | | the target | | | | | | | user | | | | | | | affiliate | | | | | | | with group | | | | | | | A? | | | | | +------------+------------+------------+---------+---------+----+ | 19 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the target | | | | | | | user (user | | | | | | | B) being | | | | | | | affiliated | | | | | | | with group | | | | | | | A? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 20 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | send an | | | | | | | a | | | | | | | ffiliation | | | | | | | status | | | | | | | change | | | | | | | request to | | | | | | | de | | | | | | | -affiliate | | | | | | | targeted | | | | | | | user B | | | | | | | from group | | | | | | | A | | | | | | | (mandatory | | | | | | | mode). | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 21-23C | Check: | - | - | 5 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-7 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Group | | | | | | | A | | | | | | | ffiliation | | | | | | | status | | | | | | | change\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.34.3-1 | | | | | | | to have | | | | | | | the target | | | | | | | user | | | | | | | de | | | | | | | -affiliate | | | | | | | with group | | | | | | | A? | | | | | +------------+------------+------------+---------+---------+----+ | 24 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the target | | | | | | | user (user | | | | | | | B) being | | | | | | | no longer | | | | | | | affiliated | | | | | | | with group | | | | | | | A? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 25 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | send an | | | | | | | a | | | | | | | ffiliation | | | | | | | status | | | | | | | change | | | | | | | request to | | | | | | | affiliate | | | | | | | targeted | | | | | | | user B to | | | | | | | group A | | | | | | | ( | | | | | | | negotiated | | | | | | | mode). | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 26-27 | Check: | - | - | 6 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-3 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.32.3-1 | | | | | | | to have a | | | | | | | target | | | | | | | user | | | | | | | affiliate | | | | | | | with group | | | | | | | A via | | | | | | | negotiated | | | | | | | mode? | | | | | +------------+------------+------------+---------+---------+----+ | 28-29A | Steps 4-7 | - | - | - | - | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Group | | | | | | | A | | | | | | | ffiliation | | | | | | | status | | | | | | | change\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.34.3-1 | | | | | | | are | | | | | | | performed | | | | | | | informing | | | | | | | that the | | | | | | | a | | | | | | | ffiliation | | | | | | | status of | | | | | | | the target | | | | | | | user with | | | | | | | group A is | | | | | | | "af | | | | | | | filiating" | | | | | +------------+------------+------------+---------+---------+----+ | 30 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the target | | | | | | | user (user | | | | | | | B) being | | | | | | | affiliated | | | | | | | with group | | | | | | | A? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 31 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | de | | | | | | | -subscribe | | | | | | | from | | | | | | | getting | | | | | | | a | | | | | | | ffiliation | | | | | | | status | | | | | | | not | | | | | | | ifications | | | | | | | for | | | | | | | targeted | | | | | | | user B. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 32-33 | Check: | - | - | 7 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-3 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Su | | | | | | | bscription | | | | | | | and | | | | | | | Noti | | | | | | | fication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.29.3-1 | | | | | | | to | | | | | | | de | | | | | | | -subscribe | | | | | | | from | | | | | | | a | | | | | | | ffiliation | | | | | | | status | | | | | | | changes | | | | | | | for a | | | | | | | target | | | | | | | user? | | | | | +------------+------------+------------+---------+---------+----+ | 34 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | de-a | | | | | | | ffiliation | | | | | | | of user A | | | | | | | from group | | | | | | | A. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 35-37C | Check: | - | - | 8 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-7 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Group | | | | | | | A | | | | | | | ffiliation | | | | | | | status | | | | | | | change\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.34.3-1 | | | | | | | to | | | | | | | de | | | | | | | -affiliate | | | | | | | with group | | | | | | | A? | | | | | +------------+------------+------------+---------+---------+----+ | 38 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | being no | | | | | | | longer | | | | | | | affiliated | | | | | | | with group | | | | | | | A? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 39-40 | Check: | - | - | 9 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-3 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | to | | | | | | | affiliate | | | | | | | the MCPTT | | | | | | | user to | | | | | | | group A | | | | | | | via | | | | | | | negotiated | | | | | | | mode? | | | | | +------------+------------+------------+---------+---------+----+ | 41 | Check: | - | - | 9 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | another | | | | | | | user is | | | | | | | requesting | | | | | | | user A get | | | | | | | affiliated | | | | | | | to group | | | | | | | A? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 42 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | accept | | | | | | | a | | | | | | | ffiliatiom | | | | | | | of user A | | | | | | | to group | | | | | | | A. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 43-46A | Check: | - | - | 9 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-7 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Group | | | | | | | A | | | | | | | ffiliation | | | | | | | status | | | | | | | change\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.34.3-1 | | | | | | | to | | | | | | | affiliate | | | | | | | with group | | | | | | | A? | | | | | +------------+------------+------------+---------+---------+----+ | 47 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | being | | | | | | | affiliated | | | | | | | with group | | | | | | | A? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 5.3.3.3 Specific message contents {#specific-message-contents-2 .H6}
Table 5.3.3.3-1: SIP SUBSCRIBE from the UE (step 2, Table 5.3.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.29.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.14-1  
Information Element Value/remark Comment Reference Condition **Expires**  
delta-seconds \"4294967295\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.3.3.3-2
* * *
Table 5.3.3.3-2: MCPTT-Info in SIP SUBSCRIBE (Table 5.3.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1  
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri px_MCPTT_ID_User_A
* * *
Table 5.3.3.3-3: SIP SUBSCRIBE from the UE (step 12, Table 5.3.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.29.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.14-1  
Information Element Value/remark Comment Reference Condition **Expires**  
delta-seconds \"4294967295\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.3.3.3-4
* * *
Table 5.3.3.3-4: MCPTT-Info in SIP SUBSCRIBE (Table 5.3.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1  
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri px_MCPTT_ID_User_B
* * *
Table 5.3.3.3-5: Void
Table 5.3.3.3-6: SIP SUBSCRIBE from the UE (step 32, Table 5.3.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.29.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.14-1, condition re-SUBSCRIBE  
Information Element Value/remark Comment Reference Condition **Expires**  
delta-seconds \"0\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.3.3.3-7
* * *
Table 5.3.3.3-7: MCPTT-Info in SIP SUBSCRIBE (Table 5.3.3.3-6)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1  
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri px_MCPTT_ID_User_B
* * *
Table 5.3.3.3-8..11: Void
Table 5.3.3.3-12: SIP PUBLISH from the UE (steps 6, 43, Table 5.3.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.11-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.3.3.3-13  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-14
* * *
Table 5.3.3.3-13: MCPTT-Info in SIP PUBLISH (Table 5.3.3.3-12)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1  
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri px_MCPTT_ID_User_A
* * *
Table 5.3.3.3-14: PIDF in SIP PUBLISH (Table 5.3.3.3-12)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.1-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition ..p-id any
allowed value p-id shall be present acc. to TS 24.379 [9] clause 9.2.2.2.5 and
clause 9.2.2.3.5
* * *
Table 5.3.3.3-15: SIP PUBLISH from the UE (step 15, Table 5.3.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.11-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.3.3.3-16  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-17
* * *
Table 5.3.3.3-16: MCPTT-Info in SIP PUBLISH (Table 5.3.3.3-15)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1  
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri px_MCPTT_ID_User_B
* * *
Table 5.3.3.3-17: PIDF in SIP PUBLISH (Table 5.3.3.3-15)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.1-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
Entity attribute px_MCPTT_ID_User_B  
tuple  
Id attribute px_MCX_Client_B_ID  
..p-id any allowed value p-id shall be present acc. to TS 24.379 [9] clause
9.2.2.2.5 and clause 9.2.2.3.5
* * *
Table 5.3.3.3-18: SIP PUBLISH from the UE (step 21, Table 5.3.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.11-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Expires**  
delta-seconds \"0\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.3.3.3-19  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-20
* * *
Table 5.3.3.3-19: MCPTT-Info in SIP PUBLISH (Table 5.3.3.3-18)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1  
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri px_MCPTT_ID_User_B
* * *
Table 5.3.3.3-20: PIDF in SIP PUBLISH (Table 5.3.3.3-18)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.1-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
entity attribute px_MCPTT_ID_User_B  
tuple  
Id attribute px_MCX_Client_B_ID  
status not present  
..p-id any allowed value p-id shall be present acc. to TS 24.379 [9] clause
9.2.2.2.5 and clause 9.2.2.3.5
* * *
Table 5.3.3.3-21: SIP PUBLISH from the UE (steps 4D, 35, Table 5.3.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.11-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Expires**  
delta-seconds \"0\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.3.3.3-22  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-23
* * *
Table 5.3.3.3-22: MCPTT-Info in SIP PUBLISH (Table 5.3.3.3-21)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1  
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri px_MCPTT_ID_User_A
* * *
Table 5.3.3.3-23: PIDF in SIP PUBLISH (Table 5.3.3.3-21)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.1-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
tuple  
status not present  
..p-id any allowed value p-id shall be present acc. to TS 24.379 [9] clause
9.2.2.2.5 and clause 9.2.2.3.5
* * *
Table 5.3.3.3-24: SIP NOTIFY from the SS (step 4, Table 5.3.3.2-1;\ step 4, TS
36.579-1 [2] Table 5.3.29.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-25
* * *
Table 5.3.3.3-25: PIDF in SIP NOTIFY (Table 5.3.3.3-24)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
tuple  
status  
affiliation  
status "affiliated"
* * *
Table 5.3.3.3-26: SIP NOTIFY from the SS (steps 8, 45, Table 5.3.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-27
* * *
Table 5.3.3.3-27: PIDF in SIP NOTIFY (Table 5.3.3.3-26)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
tuple  
status  
affiliation  
status "affiliating"  
..p-id same value as received in corresponding SIP PUBLISH (step 6, 43)
* * *
Table 5.3.3.3-28: SIP NOTIFY from the SS (steps 9, 46, Table 5.3.3.2-1;\ step
6, TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-29
* * *
Table 5.3.3.3-29: PIDF in SIP NOTIFY (Table 5.3.3.3-28)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
tuple  
status  
affiliation  
status "affiliated"  
..p-id same value as received in corresponding SIP PUBLISH (step 6, 43)
* * *
Table 5.3.3.3-30: SIP NOTIFY from the SS (step 17, Table 5.3.3.2-1;\ step 4,
TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-31
* * *
Table 5.3.3.3-31: PIDF in SIP NOTIFY (Table 5.3.3.3-30)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
entity attribute px_MCPTT_ID_User_B  
tuple  
Id attribute px_MCX_Client_B_ID  
status  
affiliation  
status "affiliating"  
..p-id same value as received in corresponding SIP PUBLISH (step 15)
* * *
Table 5.3.3.3-31A: SIP NOTIFY from the SS (step 28, Table 5.3.3.2-1;\ step 4,
TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-31B
* * *
Table 5.3.3.3-31B: PIDF in SIP NOTIFY (Table 5.3.3.3-31A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
entity attribute px_MCPTT_ID_User_B  
tuple  
Id attribute px_MCX_Client_B_ID  
status  
affiliation  
status "affiliating"
* * *
Table 5.3.3.3-32: SIP NOTIFY from the SS (step 18, Table 5.3.3.2-1;\ step 6,
TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-33
* * *
Table 5.3.3.3-33: PIDF in SIP NOTIFY (Table 5.3.3.3-32)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence entity  
entity attribute px_MCPTT_ID_User_B  
tuple id  
Id attribute px_MCX_Client_B_ID  
status  
affiliation  
status "affiliated"  
..p-id same value as received in corresponding SIP PUBLISH (step 15)
* * *
Table 5.3.3.3-33A: SIP NOTIFY from the SS (step 29, Table 5.3.3.2-1;\ step 6,
TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-33B
* * *
Table 5.3.3.3-33B: PIDF in SIP NOTIFY (Table 5.3.3.3-33A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
entity attribute px_MCPTT_ID_User_B  
tuple  
Id attribute px_MCX_Client_B_ID  
status  
affiliation  
status "affiliated"
* * *
Table 5.3.3.3-34: SIP NOTIFY from the SS (step 23, Table 5.3.3.2-1;\ step 4,
TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-35
* * *
Table 5.3.3.3-35: PIDF in SIP NOTIFY (Table 5.3.3.3-34)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
entity attribute px_MCPTT_ID_User_B  
tuple  
Id attribute px_MCX_Client_B_ID  
status  
affiliation  
status "deaffiliating"  
..p-id same value as received in corresponding SIP PUBLISH (step 21)
* * *
Table 5.3.3.3-36: SIP NOTIFY from the SS (step 37, Table 5.3.3.2-1;\ step 4,
TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-37
* * *
Table 5.3.3.3-37: PIDF in SIP NOTIFY (Table 5.3.3.3-36)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
tuple  
status  
affiliation  
status "deaffiliating"  
..p-id same value as received in corresponding SIP PUBLISH (step 35)
* * *
Table 5.3.3.3-38: SIP MESSAGE from the UE (step 26, Table 5.3.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.32.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.3.3.3-39
* * *
Table 5.3.3.3-39: MCPTT-Info in SIP MESSAGE (Table 5.3.3.3-38)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1  
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri px_MCPTT_ID_User_B
* * *
Table 5.3.3.3-40: Void
Table 5.3.3.3-41: SIP MESSAGE from the SS (step 39, Table 5.3.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.33.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.3.3.3-42
* * *
Table 5.3.3.3-42: MCPTT-Info in SIP MESSAGE (Table 5.3.3.3-41)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1  
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-calling-user-id not present
* * *
Table 5.3.3.3-43: Void
Table 5.3.3.3-44: SIP NOTIFY from the SS (step 13A, Table 5.3.3.2-1;\ step 4,
TS 36.579-1 [2] Table 5.3.29.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-45
* * *
Table 5.3.3.3-45: PIDF in SIP NOTIFY (Table 5.3.3.3-44)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
tuple  
status not present
* * *
Table 5.3.3.3-46: SIP NOTIFY from the SS (steps 4H, 37B, Table 5.3.3.2-1;\
step 6, TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-46A
* * *
Table 5.3.3.3-46A: PIDF in SIP NOTIFY (Table 5.3.3.3-46)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
tuple id  
status not present  
..p-id same value as received in the corresponding SIP PUBLISH (step 4D, 35)
* * *
Table 5.3.3.3-46B: SIP NOTIFY from the SS (step 23B, Table 5.3.3.2-1;\ step 6,
TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-46C
* * *
Table 5.3.3.3-46C: PIDF in SIP NOTIFY (Table 5.3.3.3-46B)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
entity attribute px_MCPTT_ID_User_B  
tuple id  
Id attribute px_MCX_Client_B_ID  
status not present  
..p-id same value as received in corresponding SIP PUBLISH (step 21)
* * *
Table 5.3.3.3-47: SIP NOTIFY from the SS (step 4F, Table 5.3.3.2-1;\ step 4,
TS 36.579-1 [2] Table 5.3.34.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.3.3.3-48
* * *
Table 5.3.3.3-48: PIDF in SIP NOTIFY (Table 5.3.3.3-47)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION  
Information Element Value/remark Comment Reference Condition presence  
tuple  
status  
affiliation  
status "deaffiliating"  
..p-id same value as received in corresponding SIP PUBLISH (step 4D)
* * *
5.4 Configuration / Pre-established Session Establishment / Pre-established
Session Modification / Pre-established Session Release
##### 5.4.1 Test Purpose (TP) {#test-purpose-tp-3 .H6}
##### (1) {#section-18 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service }
**ensure that** {\ **when** { MCPTT User requests the creation of a pre-
established session }
**then** { UE (MCPTT Client) requests the creation of a pre-establish session
by sending a SIP INVITE message }
}
##### (2) {#section-19 .H6}
**with** { the MCPTT client already having a pre-established session created }
**ensure that** {\ **when** { MCPTT User requests the modification of a pre-
established session }
**then** { UE (MCPTT Client) requests the modification of a pre-establish
session by sending a SIP re-INVITE message or a SIP UPDATE message (depending
on UE implementation) }
}
##### (3) {#section-20 .H6}
**with** { the MCPTT client already having a pre-stablished session created }
**ensure that** {\ **when** { MCPTT Server requests the modification of a pre-
established session by sending either a SIP UPDATE message or a SIP re-INVITE
message }
**then** { UE (MCPTT Client) responds to the pre-established session
modification request by sending a SIP 200 (OK) message }
}
##### (4) {#section-21 .H6}
**with** { the MCPTT client already having a pre-stablished session created }
**ensure that** {\ **when** { MCPTT User requests the release of a pre-
established session }
**then** { UE (MCPTT Client) requests the release of a pre-establish session
by sending a SIP BYE message }
}
##### (5) {#section-22 .H6}
**with** { the MCPTT client already having a pre-stablished session created }
**ensure that** {\ **when** { MCPTT Server requests the release of a pre-
established session by sending a SIP BYE message }
**then** { UE (MCPTT Client) responds to the pre-established session release
request by sending a SIP 200 (OK) message }
}
##### 5.4.2 Conformance requirements {#conformance-requirements-3 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379, clauses 8.2.1, 8.3.1.1, 8.3.1.2, 8.4.1.1, 8.4.1.2.
Unless otherwise stated, these are Rel-13 requirements.
[TS 24.379, clause 8.2.1]
When the MCPTT client initiates a pre-established session the MCPTT client
shall:
> 1) gather ICE candidates according to IETF RFC 5245 [17]; and
>
> NOTE 1: ICE candidates are only gathered on interfaces that the MCPTT UE
> uses to obtain MCPTT service.
>
> 2) generate an initial SIP INVITE request by following the UE originating
> session procedures specified in 3GPP TS 24.229 [4], with the clarifications
> given below.
The MCPTT client:
> 1) shall set the Request-URI of the SIP INVITE request to the public service
> identity of the participating MCPTT function serving the MCPTT user;
>
> 2) may include a P-Preferred-Identity header field in the SIP INVITE request
> containing a public user identity as specified in 3GPP TS 24.229 [4];
>
> 3) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP INVITE request according to IETF RFC 3840 [16];
>
> 4) shall include an Accept-Contact header field with the media feature tag
> g.3gpp.mcptt along with parameters \"require\" and \"explicit\" according to
> IETF RFC 3841 [6];
>
> 5) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 6) shall include an Accept-Contact header field with the media feature tag
> g.3gpp.icsi-ref set to the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> along with parameters \"require\" and \"explicit\" according to IETF RFC
> 3841 [6];
>
> 7) shall include the \"timer\" option tag in the Supported header field;
>
> 8) should include the Session-Expires header field according to IETF RFC
> 4028 [7] and should not include the \"refresher\" header field. The
> \"refresher\" header field parameter shall be set to \"uac\" if included;
>
> 9) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.1, and include ICE candidates in the
> SDP offer as per IETF RFC 5245 [17]; and
>
> 10) shall send the SIP INVITE request according to 3GPP TS 24.229 [4].
Upon receiving a SIP 2xx response to the SIP INVITE request the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5].
>
> NOTE 2: If ICE candidate evaluation results in candidate pairs other than
> the default candidate pair being selected a further offer answer exchange
> using the procedures in subclause 8.3 will be needed.
[TS 24.379, clause 8.3.1.1]
When the MCPTT client needs to modify the pre-established session outside of
an MCPTT session, the MCPTT client:
> 1) shall generate a SIP UPDATE request or a SIP re-INVITE request according
> to 3GPP TS 24.229 [4];
>
> 2) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.1, and include ICE candidates in the
> SDP offer as per IETF RFC 5245 [17], if required; and
>
> 3) shall send the SIP request towards the MCPTT server according to rules
> and procedures of 3GPP TS 24.229 [4].
On receipt of the SIP 200 (OK) response the MCPTT client:
> 1) shall interact with media plane as specified in 3GPP TS 24.380 [5], if
> there is change in media parameters or codecs in the received SDP answer,
> compared to those in the previously agreed SDP; and
>
> 2) shall interact with media plane as specified in 3GPP TS 24.380 [5], if
> there is a media stream that is currently used in the pre-established
> session, marked as rejected in the received SDP answer.
>
> NOTE: The MCPTT client keeps resources for previously agreed media stream,
> media parameters and codecs until it receives a SIP 200 (OK) response.
[TS 24.379, clause 8.3.1.2]
Upon receiving a SIP UPDATE request or a SIP re-INVITE request to modify an
existing pre-established session without associated MCPTT session, the MCPTT
client:
> 1) shall validate that the received SDP offer includes at least one media
> stream for which the media parameters and at least one codec is acceptable
> by the MCPTT client and if not reject the request with a SIP 488 (Not
> Acceptable Here) response. Otherwise, continue with the rest of the steps;
> and
>
> 2) shall generate a SIP 200 (OK) response as follows:
>
> a) shall include an SDP answer according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.2, and include ICE candidates in the
> SDP answer as per IETF RFC 5245 [17]. if required.
[TS 24.379, clause 8.4.1.1]
> NOTE: The MCPTT client needs to be prepared to release the pre-established
> session when receiving a SIP BYE request generated by the SIP core (e.g. due
> to network release of media plane resources).
When a MCPTT client needs to release a pre-established session as created in
subclause 8.2.1, the MCPTT client:
> 1) shall generate a SIP BYE request according to rules and procedures of
> 3GPP TS 24.229 [4];
>
> 2) shall set the Request-URI of the SIP BYE request to the URI that
> identifies the pre-established session;
>
> 3) shall send the SIP BYE request towards the participating MCPTT function
> within the SIP dialog of the pre-established session according to rules and
> procedures of the 3GPP TS 24.229 [4]; and
>
> 4) shall, upon receiving a SIP 200 (OK) response to the SIP BYE request
> interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.379, clause 8.4.1.2]
Upon receiving a SIP BYE request from the participating MCPTT function within
a pre-established session the MCPTT client shall check whether there are any
MCPTT sessions using the pre-established session, and:
> 1) if there is an established MCPTT session then the MCPTT client shall
> remove the MCPTT client from the MCPTT session by performing the procedures
> for session release for each MCPTT session as specified in 3GPP TS 24.380
> [5]; and
>
> 2) if there is no MCPTT session using the pre-established session, then the
> MCPTT client shall:
>
> a) interact with the media plane as specified in 3GPP TS 24.380 [5] for
> disconnecting the media plane resources towards the participating MCPTT
> function; and
>
> b) shall generate and send a SIP 200 (OK) response to the SIP BYE request
> according to rules and procedures of 3GPP TS 24.229 [4].
##### 5.4.3 Test description {#test-description-3 .H6}
##### 5.4.3.1 Pre-test conditions {#pre-test-conditions-3 .H6}
##### System Simulator: {#system-simulator-3 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-3 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-3 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 5.4.3.2 Test procedure sequence {#test-procedure-sequence-3 .H6}
Table 5.4.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | initiate | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session | | | | | | | without | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX | | | | | | | pre-es | | | | | | | tablished | | | | | | | session | | | | | | | establ | | | | | | | ishment\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5\. | | | | | | | 3.3.3-1** | | | | | | | to create | | | | | | | a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2A-3A | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 4a1-5b1 | | | | | | | describe | | | | | | | behaviour | | | | | | | that | | | | | | | depends | | | | | | | on the UE | | | | | | | implem | | | | | | | entation. | | | | | | | The | | | | | | | \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | i | | | | | | | dentifies | | | | | | | a step | | | | | | | sequence | | | | | | | that | | | | | | | takes | | | | | | | place if | | | | | | | the UE is | | | | | | | capable | | | | | | | to | | | | | | | provide | | | | | | | pre-es | | | | | | | tablished | | | | | | | session | | | | | | | mod | | | | | | | ification | | | | | | | triggered | | | | | | | by the | | | | | | | user. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4a1 | IF | - | - | - | - | | | p | | | | | | | c_MCX_U | | | | | | | serinitia | | | | | | | tedPreest | | | | | | | ablishedS | | | | | | | essionMod | | | | | | | ification | | | | | | | THEN: | | | | | | | | | | | | | | Make the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | to modify | | | | | | | the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session | | | | | | | by | | | | | | | r | | | | | | | equesting | | | | | | | usage of | | | | | | | implicit | | | | | | | floor | | | | | | | control. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4a2 | The | - | - | - | - | | | E | | | | | | | -UTRA/EPC | | | | | | | s | | | | | | | ignalling | | | | | | | according | | | | | | | to TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | clause | | | | | | | 5.4.3 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | in | | | | | | | E-UTRA\' | | | | | | | takes | | | | | | | place | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 5a1-5b1 | | | | | | | describe | | | | | | | behaviour | | | | | | | that | | | | | | | depends | | | | | | | on the UE | | | | | | | implem | | | | | | | entation; | | | | | | | the | | | | | | | \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | i | | | | | | | dentifies | | | | | | | a step | | | | | | | sequence | | | | | | | that | | | | | | | takes | | | | | | | place if | | | | | | | the UE | | | | | | | uses the | | | | | | | SIP | | | | | | | UPDATE | | | | | | | message | | | | | | | or the | | | | | | | SIP | | | | | | | re-INVITE | | | | | | | message | | | | | | | to modify | | | | | | | an | | | | | | | existing | | | | | | | pre-es | | | | | | | tablished | | | | | | | session. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5a1 | Check: | --> | SIP | 2 | P | | | Does the | | UPDATE | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | UPDATE | | | | | | | message | | | | | | | to modify | | | | | | | the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5a2 | The SS | \ | SIP 200 | 3 | P | | | Does the | | (OK) | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | to the | | | | | | | SIP | | | | | | | UPDATE | | | | | | | message | | | | | | | with a | | | | | | | SIP 200 | | | | | | | (OK) | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5\. | | | | | | | 3.4.3-1** | | | | | | | to modify | | | | | | | the floor | | | | | | | priority | | | | | | | of the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 11 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.10.3-1 | | | | | | | to | | | | | | | release | | | | | | | the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 14 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | initiate | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session | | | | | | | without | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15 | Procedure | - | - | - | - | | | \'MCX | | | | | | | pre-es | | | | | | | tablished | | | | | | | session | | | | | | | establ | | | | | | | ishment\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3.3.3-1 | | | | | | | is | | | | | | | performed | | | | | | | to create | | | | | | | a | | | | | | | pre-es | | | | | | | tablished | | | | | | | s | | | | | | | ession.**| | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15A-16A | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 17 | Check: | - | - | 5 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.12.3-1 | | | | | | |** to | | | | | | | release | | | | | | | the | | | | | | | pre-es | | | | | | | tablished | | | | | | | s | | | | | | | ession**? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 18 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 5.4.3.3 Specific message contents {#specific-message-contents-3 .H6}
Table 5.4.3.3-1..5: Void
Table 5.4.3.3-5A: SIP UPDATE from the UE (step 5a1, Table 5.4.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.15.1-1, condition MO_CALL  
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 5.4.3.3-5B
* * *
Table 5.4.3.3-5B: SDP in SIP UPDATE (Table 5.4.3.3-5A) or re-INVITE (Table
5.4.3.3-6)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_OFFER,
PRE_ESTABLISHED_SESSION, IMPLICIT_GRANT_REQUESTED
* * *
Table 5.4.3.3-6: SIP INVITE from the UE (step 5b1, Table 5.4.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3A.6.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition re-INVITE  
Information Element Value/remark Comment Reference Condition **Contact**
Contact header with the same Contact URI and the same mandatory feature
parameters as in the INVITE creating the dialog  
**Content-Type**  
media-type \"application/sdp\"  
**Message-body**  
SDP Message As described in Table 5.4.3.3-5B
* * *
Table 5.4.3.3-6A: SIP 200 (OK) from the SS (steps 5a2, 5b1, Table 5.4.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP  
Information Element Value/remark Comment Reference Condition **Contact**  
addr-spec  
user-info and host tsc_MCX_SessionID_B The URI that identifies the pre-
established session  
**Message-body**  
SDP Message As described in Table 5.4.3.3-6B
* * *
Table 5.4.3.3-6B: SDP in SIP 200 (OK) (Table 5.4.3.3-6A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
PRE_ESTABLISHED_SESSION, IMPLICIT_GRANT_REQUESTED
* * *
Table 5.4.3.3-6C: SIP UPDATE from the SS (step 7, Table 5.4.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.15.2-1, condition MO_CALL  
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 5.4.3.3-6D
* * *
Table 5.4.3.3-6D: SDP in SIP UPDATE (Table 5.4.3.3-6C)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.3.1.2-1, | | | | | | condition | | | | | | SDP_OFFER, | | | | | | P | | | | | | RE_ESTABLIS | | | | | | HED_SESSION | | | | | +--------------+--------------+--------------+-----------+-----------+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | |** Media | | | | description | | description | | | | [2]**| | for media | | | | | | control** | | | +--------------+--------------+--------------+-----------+-----------+ | **media | | a= line | | | | attribute** | | | | | | | | attribute = | | | | | | fmtp | | | +--------------+--------------+--------------+-----------+-----------+ | fmtp | | | | | +--------------+--------------+--------------+-----------+-----------+ | format | | | | | | specific | | | | | | parameters | | | | | +--------------+--------------+--------------+-----------+-----------+ | mc_priority | \"2\" | | | | +--------------+--------------+--------------+-----------+-----------+
Table 5.4.3.3-6E: SIP 200 (OK) from the UE (steps 8, 9, Table 5.4.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3.4.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP  
Information Element Value/remark Comment Reference Condition **Contact**
Contact header with the same Contact URI and the same mandatory feature
parameters as in the INVITE creating the dialog  
**Content-Type**  
media-type \"application/sdp\"  
**Message-body**  
SDP Message As described in Table 5.4.3.3-6F
* * *
Table 5.4.3.3-6F: SDP in SIP 200 (OK) (Table 5.4.3.3-6E)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_ANSWER,
PRE_ESTABLISHED_SESSION
* * *
Table 5.4.3.3-7: SIP INVITE from the SS (step 9, Table 5.4.3.2-1;\ step 2, TS
36.579-1 [2] Table 5.3.4.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition re_INVITE  
Information Element Value/remark Comment Reference Condition **Contact** same
as in the response for the INVITE creating the dialog  
**Message-body**  
SDP Message As described in Table 5.4.3.3-7A
* * *
Table 5.4.3.3-7A: SDP in SIP INVITE (Table 5.4.3.3-7)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.3.1.2-1, | | | | | | condition | | | | | | SDP_OFFER, | | | | | | P | | | | | | RE_ESTABLIS | | | | | | HED_SESSION | | | | | +--------------+--------------+--------------+-----------+-----------+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | | Media | | | | description | | description | | | | [2]** | | for media | | | | | | control | | | +--------------+--------------+--------------+-----------+-----------+ | **media | | a= line | | | | attribute** | | | | | | | | attribute = | | | | | | fmtp | | | +--------------+--------------+--------------+-----------+-----------+ | fmtp | | | | | +--------------+--------------+--------------+-----------+-----------+ | format | | | | | | specific | | | | | | parameters | | | | | +--------------+--------------+--------------+-----------+-----------+ | mc_priority | \"3\" | | | | +--------------+--------------+--------------+-----------+-----------+
Table 5.4.3.3-7B: Void
Table 5.4.3.3-8: SIP BYE from the UE (step 12, Table 5.4.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3.10.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.1-1  
Information Element Value/remark Comment Reference Condition **Request-Line**  
Request-URI tsc_MCX_SessionID_B The URI that identifies the pre-established
session
* * *
Table 5.4.3.3-9: SIP BYE from the SS (step 17, Table 5.4.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3.12.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1, condition MO_CALL  
Information Element Value/remark Comment Reference Condition **Request-Line**  
Request-URI tsc_MCX_SessionID_B The URI that identifies the pre-established
session
* * *
5.5 Configuration / Determination of MCPTT Service Settings / Current Active
MCPTT Settings / De-subscribe
##### 5.5.1 Test Purpose (TP) {#test-purpose-tp-4 .H6}
##### (1) {#section-23 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
**ensure that** {\ **when** { MCPTT User requests to verify the currently
active MCPTT service settings or to discover MCPTT service settings }
**then** { UE (MCPTT Client) sends a SIP SUBSCRIBE message to find the MCPTT
service settings **and** responds to the SIP NOTIFY message with a SIP 200
(OK) message }
}
##### (2) {#section-24 .H6}
**with** { UE (MCPTT Client) having already subscribed to find the MCPTT
service settings }
**ensure that** {\ **when** { MCPTT User requests to re-subscribe for MCPTT
service settings }
**then** { UE (MCPTT Client) sends a SIP SUBSCRIBE message to re-subscribe for
the MCPTT service settings **and** responds to the SIP NOTIFY message with a
SIP 200 (OK) message }
}
##### (3) {#section-25 .H6}
**with** { UE (MCPTT Client) having already subscribed to find the MCPTT
service settings }
**ensure that** {\ **when** { MCPTT User requests to de-subscribe for MCPTT
service settings }
**then** { UE (MCPTT Client) sends a SIP SUBSCRIBE message to de-subscribe for
the MCPTT service settings **and** responds to the SIP NOTIFY message with a
SIP 200 (OK) message }
}
##### 5.5.2 Conformance requirements {#conformance-requirements-4 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clause 7.2.4. Unless otherwise stated these are Rel-14
requirements.
[TS 24.379, clause 7.2.4]
In order to discover MCPTT service settings of another MCPTT client of the
same MCPTT user or to verify the currently active MCPTT service settings of
this MCPTT client, the MCPTT client shall generate an initial SIP SUBSCRIBE
request according to 3GPP TS 24.229 [4], IETF RFC 6665 [26], and IETF RFC 4354
[55].
In the SIP SUBSCRIBE request, the MCPTT client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCPTT function serving the MCPTT user;
>
> 2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the
> application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall
> include the \ element set to the MCPTT ID of the MCPTT
> user;
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9];
>
> 4) shall set the Event header field to the \'poc-settings\' value;
>
> 5) shall include an Accept header field containing the \"application/poc-
> settings+xml\" MIME type;
>
> 6) if the MCPTT client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [26], to 4294967295; and
>
> NOTE 1: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 7) if the MCPTT client wants to fetch the current state only, shall set the
> Expires header field according to IETF RFC 6665 [26], to zero.
In order to re-subscribe or de-subscribe, the MCPTT client shall generate an
in-dialog SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 6665
[26], IETF RFC 4354 [55]. In the SIP SUBSCRIBE request, the MCPTT client:
> 1) shall set the Event header field to the \'poc-settings\' value;
>
> 2) shall include an Accept header field containing the \"application/poc-
> settings+xml\" MIME type;
>
> 3) if the MCPTT client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [26], to 4294967295; and
>
> NOTE 2: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 4) if the MCPTT client wants to de-subscribe, shall set the Expires header
> field according to IETF RFC 6665 [26], to zero.
Upon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC
6665 [26] and IETF RFC 4354 [55], that contains an application/poc-
settings+xml MIME body the MCPTT client shall cache:
> 1) the \ element of the poc-settings+xml MIME body for each
> MCPTT client identified by the \"id\" attribute according to IETF RFC 4354
> [55] as the current Answer-mode indication of that MPCTT client; and
>
> 2) the \ element of the poc-settings+xml MIME
> body for each MCPTT client identified by the \"id\" attribute according to
> IETF RFC 4354 [55] as the active MCPTT service user profile of that MCPTT
> client.
##### 5.5.3 Test description {#test-description-4 .H6}
##### 5.5.3.1 Pre-test conditions {#pre-test-conditions-4 .H6}
##### System Simulator: {#system-simulator-4 .H6}
\- SS (MCPTT server)
\- E-UTRA related parameters are set to the default parameters for the basic
single cell environment, as defined in TS 36.508 [20] clause 4.4.
##### IUT: {#iut-4 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-4 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 5.5.3.2 Test procedure sequence {#test-procedure-sequence-4 .H6}
Table 5.5.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | subscribe | | | | | | | to MCPTT | | | | | | | service | | | | | | | settings | | | | | | | det | | | | | | | ermination | | | | | | | and later | | | | | | | noti | | | | | | | fications. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Su | | | | | | | bscription | | | | | | | and | | | | | | | Noti | | | | | | | fication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.29.3-1 | | | | | | | to request | | | | | | | to verify | | | | | | | the | | | | | | | currently | | | | | | | active | | | | | | | MCPTT | | | | | | | service | | | | | | | settings | | | | | | | of the UE | | | | | | | (MCPTT | | | | | | | client)? | | | | | +------------+------------+------------+---------+---------+----+ | 3-5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | re | | | | | | | -subscribe | | | | | | | to MCPTT | | | | | | | service | | | | | | | settings | | | | | | | det | | | | | | | ermination | | | | | | | and later | | | | | | | noti | | | | | | | fications. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Su | | | | | | | bscription | | | | | | | and | | | | | | | Noti | | | | | | | fication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.29.3-1 | | | | | | | to | | | | | | | re | | | | | | | -subscribe | | | | | | | to MCPTT | | | | | | | service | | | | | | | settings | | | | | | | and to | | | | | | | receive | | | | | | | later | | | | | | | noti | | | | | | | fications? | | | | | +------------+------------+------------+---------+---------+----+ | 8-10 | Void. | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 11 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | de | | | | | | | -subscribe | | | | | | | from MCPTT | | | | | | | service | | | | | | | settings | | | | | | | noti | | | | | | | fications. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 12-14 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Su | | | | | | | bscription | | | | | | | and | | | | | | | Noti | | | | | | | fication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.29.3-1 | | | | | | | to | | | | | | | de | | | | | | | -subscribe | | | | | | | from MCPTT | | | | | | | service | | | | | | | settings? | | | | | +------------+------------+------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | SS (MCPTT | | | | | | | server) | | | | | | | releases | | | | | | | the E-UTRA | | | | | | | c | | | | | | | onnection. | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI | | | | | | | command. | | | | | | +------------+------------+------------+---------+---------+----+
##### 5.5.3.3 Specific message contents {#specific-message-contents-4 .H6}
Table 5.5.3.3-1: SIP SUBSCRIBE from the UE (step 2, Table 5.5.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.29.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table **5.5.2.14-1, condition POC-SETTINGS-
EVENT**  
Information Element Value/remark Comment Reference Condition **Expires** TS
24.379 [9] clause 7.2.4  
value \"4294967295\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.5.3.3-2
* * *
Table 5.5.3.3-1A: SIP SUBSCRIBE from the UE (step 7, Table 5.5.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.29.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.14-1, condition POC-SETTINGS-
EVENT, re_SUBSCRIBE  
Information Element Value/remark Comment Reference Condition **Expires** TS
24.379 [9] clause 7.2.4  
value \"4294967295\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.5.3.3-2
* * *
Table 5.5.3.3-2: MCPTT-Info in SIP SUBSCRIBE (Table 5.5.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition POC-SETTINGS-
EVENT
* * *
Table 5.5.3.3-3: SIP 200 (OK) from the SS (steps 2, 7, 13, Table 5.5.3.2-1;\
step 3, TS 36.579-1 [2] Table 5.3.29.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition SUBSCRIBE-
RSP
* * *
Table 5.5.3.3-4: SIP NOTIFY from the SS (steps 2, 7, Table 5.5.3.2-1;\ step 4,
TS 36.579-1 [2] Table 5.3.29.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition POC-SETTINGS-
EVENT  
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PoC-Settings** RFC 4354 [103]  
MIME-part-body PoC-Settings as described in Table 5.5.3.3-5
* * *
Table 5.5.3.3-5: PoC-Settings in SIP NOTIFY (Table 5.5.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.11.2-1, condition AUTOMATIC
* * *
Table 5.5.3.3-6: Void
Table 5.5.3.3-7: SIP SUBSCRIBE from the UE (step 12, Table 5.5.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.29.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.14-1, condition POC-SETTINGS-
EVENT, re_SUBSCRIBE  
Information Element Value/remark Comment Reference Condition **Expires** TS
24.379 [9] clause 7.2.4  
value \"0\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.5.3.3-2
* * *
5.6 Configuration / Download CSK
##### 5.6.1 Test Purpose (TP) {#test-purpose-tp-5 .H6}
##### (1) {#section-26 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { MCPTT Client receives a CSK key download message via a SIP MESSAGE
message }
**then** { UE (MCPTT Client) responds with a SIP 200 (OK) message and replaces
the existing CSK and CSK-ID associated with the participating MCPTT function
**and** uses the new CSK information with a SIP INVITE message when prompted
to initiate a call and }
}
##### (2) {#section-27 .H6}
**with** { UE (MCPTT Client) having established an MCPTT On-demand Pre-
arranged Group Call with Automatic Commencement Mode }
ensure that {
**when** { the MCPTT User engages in communication with the invited MCPTT
User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the MCPTT
Server and uses the updated CSK to protect the sent floor control messages }
}
##### (3) {#section-28 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Automatic Commencement Mode }
ensure that {
**when** { MCPTT User requests to terminate the ongoing MCPTT Group Call }
**then** { UE (MCPTT Client) sends a SIP BYE message and leaves the MCPTT
session }
}
##### 5.6.2 Conformance requirements {#conformance-requirements-5 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clause 7.2.5, TS 33.180 clause 9.2.1.4, TS 24.380
clause 13.3.3. Unless otherwise stated these are Rel-15 requirements.
[TS 24.379, clause 7.2.5]
When the MCPTT client receives a SIP MESSAGE request containing:
> 1) a P-Asserted-Service header field containing the \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\"; and
>
> 2) an application/mikey MIME body;
Then, if the key identifier within the CSB-ID of the MIKEY payload is a CSK-ID
(4 most-significant bits have the value \'2\'), the MCPTT client:
> 1) shall follow the security procedures in clause 9.2.1 of 3GPP TS 33.180
> [78] to extract the CSK. The client:
>
> a) if the initiator field (IDRi) has type \'URI\' (identity hiding is not
> used), the client:
>
> i) shall extract the initiator URI from the initiator field (IDRi) of the
> I_MESSAGE as described in 3GPP TS 33.180 [78]. If the initiator URI deviates
> from the public service identity of the participating MCPTT function serving
> the MCPTT user, shall reject the SIP MESSAGE request with a SIP 488 (Not
> Acceptable Here) response as specified in IETF RFC 4567 [47], and include
> warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE
> failed\" in a Warning header field as specified in clause 4.4 and shall not
> continue with the rest of the steps;
>
> ii) shall convert the initiator URI to a UID as described in 3GPP TS 33.180
> [78];
>
> b) if the initiator field (IDRi) has type \'UID\' (identity hiding in use),
> the client:
>
> ii) shall convert the public service identity of participating MCPTT
> function serving the MCPTT user to a UID as described in 3GPP TS 33.180
> [78];
>
> i) shall compare the generated UID with the UID in the initiator field
> (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]. If the two
> initiator UIDs deviate from each other, shall reject the SIP MESSAGE request
> with a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567
> [47], and include warning text set to \"136 authentication of the MIKEY-
> SAKKE I_MESSAGE failed\" in a Warning header field as specified in clause
> 4.4 and shall not continue with the rest of the steps;
>
> c) shall use the UID to validate the signature of the I_MESSAGE as described
> in 3GPP TS 33.180 [78];
>
> d) if authentication verification of the I_MESSAGE fails, shall reject the
> SIP MESSAGE request with a SIP 488 (Not Acceptable Here) response as
> specified in IETF RFC 4567 [47], and include warning text set to \"136
> authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header
> field as specified in clause 4.4 and shall not continue with the rest of the
> steps;
>
> e) shall extract and decrypt the encapsulated CSK using the participating
> MCPTT function\'s (KMS provisioned) UID key as described in 3GPP TS 33.180
> [78]; and
>
> f) shall extract the CSK-ID, from the payload as specified in 3GPP TS 33.180
> [78];
>
> 2) Upon successful extraction, the client shall replace the existing CSK and
> CSK-ID associated with the participating MCPTT function, with the extracted
> CSK and CSK-ID in the \'key download\' message.
[TS 33.180, clause 9.2.1.4]
The MCX Server may decide to update an existing CSK at any time. This may be
due to CSK revocation or expiry.
The CSK shall be updated by the MCX Server using the \'key download\'
procedure, defined in clause 5.8. Upon receipt of a CSK via a \'key download\'
procedure, the MC client shall identify the type of key as a CSK via the 4
most significant bits of the CSK-ID. The MC client shall:
> \- discard any previous CSKs associated with the MC Server FQDN, and
>
> \- use the new CSK for uplink signalling with the MC Server.
[TS 24.380 clause 13.3.3]
The MCPTT client:
> 1\. in an on-network group call of an MCPTT group which is not a constituent
> MCPTT group of a temporary MCPTT group:
>
> A) if protection of media is negotiated and the GMK and the GMK-ID of the
> MCPTT group were received using the group document subscription and
> notification procedure specified in 3GPP TS 24.481 [12] for the MCPTT group:
>
> i) shall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS
> 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and
> GMK-ID as specified in subclause 13.2; and
>
> ii) shall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS
> 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and
> GMK-ID as specified in subclause 13.2;
>
> B) if protection of floor control messages sent using unicast is negotiated
> and the CSK and the CSK-ID were sent to the participating MCPTT function
> using SIP signalling according to 3GPP TS 24.379 [2]:
>
> i) shall encrypt floor control messages sent using unicast according to IETF
> RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
> generated using the CSK and CSK-ID as specified in subclause 13.2; and
>
> ii) shall decrypt floor control messages received using unicast according to
> IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-
> MKI generated using the CSK and CSK-ID as specified in subclause 13.2;
>
> C) if protection of floor control messages sent over the MBMS subchannel
> from the participating MCPTT function to the served MCPTT clients is
> required:
>
> i) if a MuSiK and a MuSiK-ID are associated with the on-network group call,
> shall decrypt floor control messages received over the MBMS subchannel for
> floor control messages according to IETF RFC 3711 [16] and 3GPP TS 33.180
> [14] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the MuSiK and the
> MuSiK-ID associated with the on-network group call as specified in subclause
> 13.2; and
>
> ii) if a MuSiK and a MuSiK-ID are not associated with the on-network group
> call and the MKFC and the MKFC-ID of the MCPTT group were received using the
> group document subscription and notification procedure specified in 3GPP TS
> 24.481 [12] for the MCPTT group, shall decrypt floor control messages
> received over the MBMS subchannel for floor control messages according to
> IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-
> MKI generated using the MKFC and MKFC-ID as specified in subclause 13.2; and
>
> NOTE 1: The MCPTT client can receive floor control messages encrypted using
> SRTP-MK, SRTP-MS and SRTP-MKI generated using the MKFC and MKFC-ID from a
> participating MCPTT function compliant only to Release 13 of the present
> document.
>
> D) if protection of media control messages sent using unicast between the
> participating MCPTT function and the MCPTT client is negotiated and the CSK
> and the CSK-ID were sent to the participating MCPTT function using SIP
> signalling according to 3GPP TS 24.379 [2]:
>
> i) shall encrypt media control messages sent using unicast according to IETF
> RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
> generated using the CSK and CSK-ID as specified in subclause 13.2; and
>
> ii) shall decrypt media control messages received using unicast according to
> IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-
> MKI generated using the CSK and CSK-ID as specified in subclause 13.2;
##### 5.6.3 Test description {#test-description-5 .H6}
##### 5.6.3.1 Pre-test conditions {#pre-test-conditions-5 .H6}
##### System Simulator: {#system-simulator-5 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-5 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-5 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 5.6.3.2 Test procedure sequence {#test-procedure-sequence-5 .H6}
Table 5.6.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | requesting | | | | | | | to update | | | | | | | the | | | | | | | existing | | | | | | | CSK?. | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 3 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a group | | | | | | | call with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 4 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3A.1.3-1 | | | | | | | **to** | | | | | | | establish | | | | | | | a group | | | | | | | call with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.i of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3 | | | | | | | A.1.3-1**, | | | | | | | and using | | | | | | | the | | | | | | | updated | | | | | | | CSK to | | | | | | | protect | | | | | | | the SIP | | | | | | | INVITE | | | | | | | message | | | | | | | and the | | | | | | | SIP ACK | | | | | | | message**? | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 6 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the floor. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | Floor | | | | | | | release -- | | | | | | | Floor | | | | | | | Idle\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3A.15.3-1, | | | | | | | using the | | | | | | | updated | | | | | | | CSK to | | | | | | | protect | | | | | | | the Floor | | | | | | | Release | | | | | | | message? | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.10.3-1 | | | | | | | to release | | | | | | | the call, | | | | | | | using the | | | | | | | updated | | | | | | | CSK to | | | | | | | protect | | | | | | | the SIP | | | | | | | BYE | | | | | | | message? | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 5.6.3.3 Specific message contents {#specific-message-contents-5 .H6}
Table 5.6.3.3-1: SIP MESSAGE from the SS (step 1, Table 5.6.3.2-1;\ step 2, TS
36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1
* * *
Information Element Value/remark Comment Reference Condition **P-Asserted-
Service** TS 24.379 [9] clause 7.3.7  
Service-ID _\"_ urn:urn-7:3gpp-service.ims.icsi.mcptt _\"_  
**Content-Type**  
media-type \"application/mikey\"  
**Message-body**  
MIKEY message base64 encoded MIKEY message as described in TS 36.579-1 [2],
Table 5.5.9.1-1A MIKEY message, containing the updated CSK
Table 5.6.3.3-2: SIP INVITE from the UE (step 4, Table 5.6.3.2-1;\ step 2, TS
36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 5.6.3.3-3  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.6.3.3-4
Table 5.6.3.3-3: SDP in SIP INVITE (Table 5.6.3.3-2)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
INITIAL_SDP_OFFER, IMPLICIT_GRANT_REQUESTED
* * *
Table 5.6.3.3-4: MCPTT-Info in SIP INVITE (Table 5.6.3.3-2)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL,
INVITE_REFER
* * *
Table 5.6.3.3-5: SIP 200 (OK) from the SS (step 4, Table 5.6.3.2-1;\ step 4,
TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 5.6.3.3-6
Table 5.6.3.3-6: SDP in SIP 200 (OK) (Table 5.6.3.3-5)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
IMPLICIT_GRANT_REQUESTED, IMPLICIT_FLOOR_GRANTED
* * *
5.7 Configuration / Subscription to group dynamic data / De-subscribe
##### 5.7.1 Test Purpose (TP) {#test-purpose-tp-6 .H6}
##### (1) {#section-29 .H6}
**with** { UE (MCPTT Client) having established an MCPTT On-demand Pre-
arranged Group Call with Automatic Commencement Mode }
ensure that {
**when** { MCPTT User requests to subscribe to group dynamic data for group
call ongoing information }
**then** { UE (MCPTT Client) sends a SIP SUBSCRIBE message to subscribe to
group dynamic data for group call ongoing information }
}
##### (2) {#section-30 .H6}
**with** { UE (MCPTT Client) having established an MCPTT On-demand Pre-
arranged Group Call with Automatic Commencement Mode }
ensure that {
**when** { UE (MCPTT Client) receives a SIP NOTIFY message indicating the
group call ongoing information }
**then** { UE (MCPTT Client) responds with a SIP 200 (OK) message }
}
##### (3) {#section-31 .H6}
**with** { UE (MCPTT Client) having established an MCPTT On-demand Pre-
arranged Group Call with Automatic Commencement Mode }
ensure that {
**when** { MCPTT User requests to de-subscribe from group dynamic data for
group call ongoing information }
**then** { UE (MCPTT Client) sends a SIP SUBSCRIBE message to de-subscribe
from group dynamic data for group call ongoing information }
}
##### 5.7.2 Conformance requirements {#conformance-requirements-6 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clause 9.2.1.6. Unless otherwise stated these are
Rel-15 requirements.
[TS 24.379, clause 9.2.1.6]
In order to subscribe to changes in per-group dynamic data, the MCPTT client
shall generate an initial SIP SUBSCRIBE request specified in 3GPP TS 24.229
[4], IETF RFC 3856 [51], and IETF RFC 6665 [26].
In the SIP SUBSCRIBE request, the MCPTT client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCPTT function serving the MCPTT user;
>
> 2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the
> application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall
> include the \ element set to the MCPTT group ID of the
> targeted MCPTT group;
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field specified in IETF RFC 6050 [9];
>
> 4) if the MCPTT client wants to receive the current status and later
> notification, shall set the Expires header field specified in IETF RFC 6665
> [26], to 4294967295;
>
> NOTE 1: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 5) if the MCPTT client wants to fetch the current state only, shall set the
> Expires header field specified in IETF RFC 6665 [26], to zero;
>
> 6) shall include an Accept header field containing the application/pidf+xml
> MIME type; and
>
> 7) shall include an application/simple-filter+xml MIME body indicating per-
> group restrictions of presence event package notification information
> specified in clause 9.3.2, indicating the MCPTT group ID.
In order to re-subscribe or de-subscribe, the MCPTT client shall generate an
in-dialog SIP SUBSCRIBE request specified in 3GPP TS 24.229 [4], IETF RFC 3856
[51], and IETF RFC 6665 [26]. In the SIP SUBSCRIBE request, the MCPTT client:
> 1) if the MCPTT client wants to receive the current status and later
> notification, shall set the Expires header field specified in IETF RFC 6665
> [26], to 4294967295;
>
> NOTE 2: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 2) if the MCPTT client wants to de-subscribe, shall set the Expires header
> field specified in IETF RFC 6665 [26], to zero; and
>
> 3) shall include an Accept header field containing the application/pidf+xml
> MIME type.
Upon receiving a SIP NOTIFY request specified in 3GPP TS 24.229 [4], IETF RFC
3856 [51], and IETF RFC 6665 [26], if the SIP NOTIFY request contains an
application/pidf+xml MIME body indicating per-group dynamic data information
constructed according to clause 9.3.1, then the MCPTT client shall determine
per-group dynamic data of the MCPTT group in the MIME body.
##### 5.7.3 Test description {#test-description-6 .H6}
##### 5.7.3.1 Pre-test conditions {#pre-test-conditions-6 .H6}
##### System Simulator: {#system-simulator-6 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-6 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-6 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 5.7.3.2 Test procedure sequence {#test-procedure-sequence-6 .H6}
Table 5.7.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a group | | | | | | | call with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | without | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | The UE | - | - | - | - | | | (MCPTT | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3A.1.3-1 | | | | | | | **to** | | | | | | | establish | | | | | | | a group | | | | | | | call with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | without | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | a of NOTE | | | | | | | 1 in TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.1.3-1. | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 4 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | subscribe | | | | | | | to group | | | | | | | dynamic | | | | | | | data | | | | | | | det | | | | | | | ermination | | | | | | | and later | | | | | | | noti | | | | | | | fications. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 5-8 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-5 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Su | | | | | | | bscription | | | | | | | and | | | | | | | Noti | | | | | | | fication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.29.3-1 | | | | | | | to | | | | | | | subscribe | | | | | | | to group | | | | | | | dynamic | | | | | | | data for | | | | | | | group call | | | | | | | ongoing | | | | | | | in | | | | | | | formation? | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | de | | | | | | | -subscribe | | | | | | | from group | | | | | | | dynamic | | | | | | | data | | | | | | | noti | | | | | | | fications. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 10-11 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-3 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Su | | | | | | | bscription | | | | | | | and | | | | | | | Noti | | | | | | | fication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.29.3-1 | | | | | | | to | | | | | | | de | | | | | | | -subscribe | | | | | | | from group | | | | | | | dynamic | | | | | | | data | | | | | | | noti | | | | | | | fications? | | | | | +------------+------------+------------+---------+---------+----+ | 12-13 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 14 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 15 | The UE | - | - | - | - | | | (MCPTT | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.10.3-1. | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 5.7.3.3 Specific message contents {#specific-message-contents-6 .H6}
Table 5.7.3.3-0: SIP INVITE from the UE (step 1, Table 5.7.3.2-1;\ step 2, TS
36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 5.7.3.3-0A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 5.7.3.3-0B
Table 5.7.3.3-0A: SDP in SIP INVITE (Table 5.7.3.3-0)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
INITIAL_SDP_OFFER
* * *
Table 5.7.3.3-0B: MCPTT-Info in SIP INVITE (Table 5.7.3.3-0)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL,
INVITE_REFER
* * *
Table 5.7.3.3-0C: SIP 200 (OK) from the SS (step 1, Table 5.7.3.2-1;\ step 4,
TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 5.7.3.3-0D
Table 5.7.3.3-0D: SDP in SIP 200 (OK) (Table 5.7.3.3-0C)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER
* * *
Table 5.7.3.3-1: SIP SUBSCRIBE from the UE (step 5, Table 5.7.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.29.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.14-1, condition PRESENCE-EVENT
* * *
Information Element Value/remark Comment Reference Condition **Expires** TS
24.379 [9] clause 9.2.1.6  
value \"4294967295\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-headers  
MIME-part-body MCPTT-Info as described in Table 5.7.3.3-2  
MIME body part **SIMPLE-FILTER**  
MIME-part-headers  
MIME-part-body **SIMPLE-FILTER** as described in Table 5.7.3.3-3
Table 5.7.3.3-2: MCPTT-Info in SIP SUBSCRIBE (Table 5.7.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri Encrypted \ with mcpttURI set to
px_MCPTT_Group_A_ID Encrypted element as described in TS 36.579-1 [2] Table
5.5.3.2.1-1A
Table 5.7.3.3-3: SIMPLE-FILTER in SIP SUBSCRIBE (Table 5.7.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.6-1, condition PER-GROUP
* * *
Table 5.7.3.3-4: SIP NOTIFY from the SS (step 7, Table 5.7.3.2-1;\ step 4, TS
36.579-1 [2] Table 5.3.29.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.7.3.3-5
Table 5.7.3.3-5: PIDF in SIP NOTIFY (Table 5.7.3.3-4)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1
* * *
Information Element Value/remark Comment Reference Condition presence TS
24.379 [9] clause 9.3.1  
entity attribute Encrypted URI (NOTE 1) with value set to px_MCPTT_Group_A_ID
TS 24.379 [9] clause 9.3.1  
tuple TS 24.379 [9] clause 9.3.1  
id attribute Encrypted URI (NOTE 1) with value set to px_MCPTT_ID_User_A TS
24.379 [9] clause 9.3.1  
status TS 24.379 [9] clause 9.3.1  
affiliation TS 24.379 [9] clause 9.3.1  
group not present  
client Encrypted URI (NOTE 1) with value set to the mcptt-client-id as
provided by the UE at registration TS 24.379 [9] clause 9.3.1  
status not present  
expires Current time plus one hour TS 24.379 [9] clause 9.2.2.3.10  
tuple TS 24.379 [9] clause 9.3.1  
id attribute Encrypted URI (NOTE 1) with value set to px_MCPTT_ID_User_B TS
24.379 [9] clause 9.3.1  
status TS 24.379 [9] clause 9.3.1  
affiliation TS 24.379 [9] clause 9.3.1  
group not present  
client Encrypted URI (NOTE 1) with value set to px_MCPTT_Client_B_ID TS 24.379
[9] clause 9.3.1  
status not present  
expires Current time plus one hour TS 24.379 [9] clause 9.2.2.3.10  
additionalData TS 24.379 [9] clause 9.3.1  
groupCallOngoing \"true\" TS 24.379 [9] clause 9.3.1  
NOTE 1: Encrypted attribute as described in TS 36.579-1 [2], Table 5.5.13.3-1
Table 5.7.3.3-6: SIP SUBSCRIBE from the UE (step 10, Table 5.7.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.29.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.14-1, condition PRESENCE-EVENT,
re_SUBSCRIBE
* * *
Information Element Value/remark Comment Reference Condition **Expires** TS
24.379 [9] clause 9.2.1.6  
value \"0\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-headers  
MIME-part-body MCPTT-Info as described in Table 5.7.3.3-2  
MIME body part **SIMPLE-FILTER**  
MIME-part-headers  
MIME-part-body **SIMPLE-FILTER** as described in Table 5.7.3.3-3
5.8 Configuration / Functional Alias / Functional alias status determination /
Activate functional alias / Deactivate functional alias
##### 5.8.1 Test Purpose (TP) {#test-purpose-tp-7 .H6}
##### (1) {#section-32 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { MCPTT User requests to determine the current status of a functional
alias and later notification of status changes of a functional alias }
**then** { UE (MCPTT Client) sends a SIP SUBSCRIBE message to determine the
current status of a functional alias and later notification of status changes
of a functional alias **and** responds to the SIP NOTIFY message with a SIP
200 (OK) message }
}
##### (2) {#section-33 .H6}
**with** { UE (MCPTT Client) having already subscribed to determine the status
of a functional alias }
ensure that {
**when** { MCPTT User requests to activate a functional alias }
**then** { UE (MCPTT Client) sends a SIP PUBLISH message to activate a
functional alias **and** responds to the SIP NOTIFY message with a SIP 200
(OK) message }
}
##### (3) {#section-34 .H6}
**with** { UE (MCPTT Client) having already subscribed to determine the status
of a functional alias }
ensure that {
**when** { MCPTT User requests to deactivate a functional alias }
**then** { UE (MCPTT Client) sends a SIP PUBLISH message to deactivate a
functional alias **and** responds to the SIP NOTIFY message with a SIP 200
(OK) message }
}
##### (4) {#section-35 .H6}
**with** { UE (MCPTT Client) having already subscribed to determine the status
of a functional alias }
ensure that {
**when** { MCPTT User requests to de-subscribe from determining the status of
a functional alias }
**then** { UE (MCPTT Client) sends a SIP SUBSCRIBE message to de-subscribe
from determining the status of a functional alias **and** responds to the SIP
NOTIFY message with a SIP 200 (OK) message }
}
##### 5.8.2 Conformance requirements {#conformance-requirements-7 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clause 9A.2.1.2, 9A.2.1.3. Unless otherwise stated
these are Rel-15 requirements.
[TS 24.379, clause 9A.2.1.2]
In order:
> \- to indicate that an MCPTT user requests to activate one or more
> functional aliases;
>
> \- to indicate that the MCPTT user requests to deactivate one or more
> functional aliases;
>
> \- to refresh indication of an MCPTT user interest in one or more functional
> aliases due to near expiration of the expiration time of a functional alias
> with the status set to the \"activated\" state received in a SIP NOTIFY
> request in clause 9A.2.1.3; or
>
> \- any combination of the above;
the MCPTT client shall generate a SIP PUBLISH request according to 3GPP TS
24.229 [4], IETF RFC 3903 [37], and IETF RFC 3856 [51].
In the SIP PUBLISH request, the MCPTT client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCPTT function serving the MCPTT user;
>
> 2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the
> application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall
> include the \ element set to the MCPTT ID of the MCPTT
> user;
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9];
>
> 4) if the MCPTT client requests to activate one or more functional aliases,
> shall set the Expires header field according to IETF RFC 3903 [37], to
> 4294967295;
>
> NOTE 1: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 5) if the MCPTT client requests to deactivate one or more functional
> aliases, shall set the Expires header field according to IETF RFC 3903 [37],
> to zero; and
>
> NOTE 2: Activation and deactivation of functional alias cannot be performed
> with the same PUBLISH request.
>
> 6) shall include an application/pidf+xml MIME body indicating per-user
> functional alias information according to clause 9A.3.1. In the MIME body,
> the MCPTT client:
>
> a) shall include all functional aliases where the MCPTT user requests
> activation for the MCPTT ID;
>
> b) shall include the MCPTT client ID of the targeted MCPTT client;
>
> c) shall not include the \"status\" attribute and the \"expires\" attribute
> in the \ element;
>
> d) if the MCPTT client has received an indication that take over of a
> functional alias is possible and intends to take over a functional alias,
> shall include a \ child element set to \"true\"; and
>
> e) shall set the \ child element of the \ root element to
> a globally unique value.
The MCPTT client shall send the SIP PUBLISH request according to 3GPP TS
24.229 [4].
[TS 24.379, clause 9A.2.1.3]
> NOTE 1: The MCPTT UE also uses this procedure to determine which functional
> alias have been successfully activated for the MCPTT ID.
In order to discover functional aliases:
> 1) which which are activated for the MCPTT user; or
>
> 2) which another MCPTT user has activated;
the MCPTT client shall generate an initial SIP SUBSCRIBE request according to
3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26].
In the SIP SUBSCRIBE request, the MCPTT client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCPTT function serving the MCPTT user;
>
> 2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the
> application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall
> include;
>
> a) the \ element set to the MCPTT ID of the targeted
> MCPTT user; and
>
> b) the \ element in the \ element of the \ Params> element of the \ element set to the value \"functional-
> alias-status-determination\";
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9];
>
> 4) if the MCPTT client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [26], to 4294967295;
>
> NOTE 2: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 5) if the MCPTT client wants to fetch the current state only, shall set the
> Expires header field according to IETF RFC 6665 [26], to zero;
>
> 6) shall include an Events header field set to \"presence\"; and
>
> 7) shall include an Accept header field containing the application/pidf+xml
> MIME type.
In order to re-subscribe or de-subscribe, the MCPTT client shall generate an
in-dialog SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856
[51], and IETF RFC 6665 [26]. In the SIP SUBSCRIBE request, the MCPTT client:
> 1) if the MCPTT client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [26], to 4294967295;
>
> NOTE 3: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 2) if the MCPTT client wants to de-subscribe, shall set the Expires header
> field according to IETF RFC 6665 [26], to zero;
>
> 3) shall include an Events header field set to \"presence\"; and
>
> 4) shall include an Accept header field containing the application/pidf+xml
> MIME type.
Upon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC
3856 [51], and IETF RFC 6665 [26], if SIP NOTIFY request contains an
application/pidf+xml MIME body indicating per-user functional alias
information constructed according to clause 9A.3.1, then the MCPTT client
shall determine the status of the MCPTT user for each functional alias in the
MIME body. If the \ child element of the \ root element of
the application/pidf+xml MIME body of the SIP NOTIFY request is included, the
\ element value indicates the SIP PUBLISH request which triggered
sending of the SIP NOTIFY request.
##### 5.8.3 Test description {#test-description-7 .H6}
##### 5.8.3.1 Pre-test conditions {#pre-test-conditions-7 .H6}
##### System Simulator: {#system-simulator-7 .H6}
\- SS (MCPTT server)
\- E-UTRA related parameters are set to the default parameters for the basic
single cell environment, as defined in TS 36.508 [20] clause 4.4.
##### IUT: {#iut-7 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-7 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 5.8.3.2 Test procedure sequence {#test-procedure-sequence-7 .H6}
Table 5.8.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'UE | | | | | | | initiated | | | | | | | MCPTT | | | | | | | functional | | | | | | | alias | | | | | | | status | | | | | | | det | | | | | | | ermination | | | | | | | and | | | | | | | subs | | | | | | | cription\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.36.3-1 | | | | | | | to | | | | | | | determine | | | | | | | the | | | | | | | current | | | | | | | status of | | | | | | | a | | | | | | | functional | | | | | | | alias and | | | | | | | to get | | | | | | | later | | | | | | | no | | | | | | | tification | | | | | | | of status | | | | | | | changes of | | | | | | | a | | | | | | | functional | | | | | | | alias? | | | | | | | | | | | | | | NOTE: The | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | sends a | | | | | | | SIP | | | | | | | SUBSCRIBE | | | | | | | message | | | | | | | and | | | | | | | responds | | | | | | | to a SIP | | | | | | | NOTIFY | | | | | | | message | | | | | | | and then | | | | | | | the RRC | | | | | | | connection | | | | | | | is | | | | | | | released. | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'UE | | | | | | | initiated | | | | | | | MCPTT | | | | | | | functional | | | | | | | alias | | | | | | | status | | | | | | | change\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.37.3-1 | | | | | | | to change | | | | | | | the status | | | | | | | of a | | | | | | | functional | | | | | | | alias to | | | | | | | \"ac | | | | | | | tivated\"? | | | | | | | | | | | | | | NOTE: The | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | sends a | | | | | | | SIP | | | | | | | PUBLISH | | | | | | | message | | | | | | | and | | | | | | | responds | | | | | | | to a SIP | | | | | | | NOTIFY | | | | | | | message | | | | | | | and then | | | | | | | the RRC | | | | | | | connection | | | | | | | is | | | | | | | released. | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | status | | | | | | | change of | | | | | | | a | | | | | | | functional | | | | | | | alias to | | | | | | | \"not | | | | | | | ac | | | | | | | tivated\". | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 3A-3E | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'UE | | | | | | | initiated | | | | | | | MCPTT | | | | | | | functional | | | | | | | alias | | | | | | | status | | | | | | | change\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.37.3-1 | | | | | | | from step | | | | | | | 2a1 onward | | | | | | | to change | | | | | | | the status | | | | | | | of a | | | | | | | functional | | | | | | | alias to | | | | | | | \"not | | | | | | | ac | | | | | | | tivated\"? | | | | | | | | | | | | | | NOTE: The | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | sends a | | | | | | | SIP | | | | | | | PUBLISH | | | | | | | message | | | | | | | and | | | | | | | responds | | | | | | | to a SIP | | | | | | | NOTIFY | | | | | | | message | | | | | | | and then | | | | | | | the RRC | | | | | | | connection | | | | | | | is | | | | | | | released. | | | | | +------------+------------+------------+---------+---------+----+ | 4 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | de | | | | | | | -subscribe | | | | | | | from | | | | | | | functional | | | | | | | alias | | | | | | | status | | | | | | | change | | | | | | | noti | | | | | | | fications. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 5-7 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 2a1-4 of | | | | | | | procedure | | | | | | | \'UE | | | | | | | initiated | | | | | | | MCPTT | | | | | | | functional | | | | | | | alias | | | | | | | status | | | | | | | det | | | | | | | ermination | | | | | | | and | | | | | | | subs | | | | | | | cription\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.36.3-1 | | | | | | | to | | | | | | | de | | | | | | | -subscribe | | | | | | | from | | | | | | | functional | | | | | | | alias | | | | | | | status | | | | | | | change | | | | | | | noti | | | | | | | fications? | | | | | +------------+------------+------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | The SS | | | | | | | waits 2 | | | | | | | seconds | | | | | | | before the | | | | | | | SS | | | | | | | d | | | | | | | eactivates | | | | | | | the | | | | | | | dedicated | | | | | | | EPS bearer | | | | | | | and | | | | | | | releases | | | | | | | the RRC | | | | | | | c | | | | | | | onnection. | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The | | | | | | | specified | | | | | | | wait | | | | | | | period of | | | | | | | 2s shall | | | | | | | ensure | | | | | | | that lower | | | | | | | layer | | | | | | | signalling | | | | | | | (TCP) is | | | | | | | finished. | | | | | | +------------+------------+------------+---------+---------+----+
##### 5.8.3.3 Specific message contents {#specific-message-contents-7 .H6}
Table 5.8.3.3-1: SIP PUBLISH from the UE (step 3B, Table 5.8.3.2-1;\ step 3,
TS 36.579-1 [2] Table 5.3.37.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.3.37.4-1
* * *
Information Element Value/remark Comment Reference Condition **Expires** TS
24.379 [9] clause 9A2.1.2  
value \"0\"
Table 5.8.3.3-2: SIP NOTIFY from the SS (step 3D, Table 5.8.3.2-1;\ step 5, TS
36.579-1 [2] Table 5.3.37.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.3.37.4-5
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 5.8.3.3-3
Table 5.8.3.3-3: PIDF in SIP NOTIFY (Table 5.8.3.3-2)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition
NOTIFY_FOR_PUBLISH (NOTE 1)
* * *
NOTE 1: PIDF contains tuple with empty \ element (i.e. there are no
\ entries at all) and \ element with value as
received in the previous SIP PUBLISH.
Table 5.8.3.3-4: SIP SUBSCRIBE from the UE (step 6, Table 5.8.3.2-1;\ step 3,
TS 36.579-1 [2] Table 5.3.36.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.3.36.4-1
* * *
Information Element Value/remark Comment Reference Condition **Expires** TS
24.379 [9] clause 9A2.1.3  
value \"0\"
## 5.9 Configuration / Functional Alias / Location based functional alias
status change
##### 5.9.1 Test Purpose (TP) {#test-purpose-tp-8 .H6}
##### (1) {#section-36 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
**ensure that** {
**when** { UE enters into or exits from a location area that triggers one or
more functional aliases to be activated according to the MCPTT user profile
document }
**then** { sends a SIP PUBLISH message to activate a functional alias }
}
##### (2) {#section-37 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service and
having already activated a functional alias }
**ensure that** {
**when** { UE enters into or exits from a location area that triggers one or
more functional aliases to be deactivated according to the MCPTT user profile
document }
**then** { UE (MCPTT Client) sends a SIP PUBLISH message to deactivate a
functional alias }
}
##### 5.9.2 Conformance requirements {#conformance-requirements-8 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clause 9A.2.1.2, 9A.2.1.4. Unless otherwise stated
these are Rel-16 requirements.
[TS 24.379, clause 9A.2.1.2]
In order:
\- to indicate that an MCPTT user requests to activate one or more functional
aliases;
\- to indicate that the MCPTT user requests to deactivate one or more
functional aliases;
\- to refresh indication of an MCPTT user interest in one or more functional
aliases due to near expiration of the expiration time of a functional alias
with the status set to the \"activated\" state received in a SIP NOTIFY
request in clause 9A.2.1.3;
\- to indicate that the MCPTT client entering into or exiting from a location
area triggers one or more functional aliases to be activated;
\- to indicate that the MCPTT client entering into or exiting from a location
area triggers one or more functional aliases to be deactivated; or
\- any combination of the above;
the MCPTT client shall generate a SIP PUBLISH request according to 3GPP TS
24.229 [4], IETF RFC 3903 [37], and IETF RFC 3856 [51].
When the MCPTT user requests to deactivate a functional alias, the MCPTT
client shall first check the \ element within the \ element of the \ element
corresponding to the functional alias within the \ list
element of the \ element of the \ element of the MCPTT user
profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]).
If the functional alias has been activated due to a location area trigger and
the \ element is set
to a value of \"true\", the MCPTT client shall suppress the MCPTT user\'s
request.
NOTE 1: If the request is suppressed, a notification message can be displayed
to the user.
In the SIP PUBLISH request, the MCPTT client:
1) shall set the Request-URI to the public service identity identifying the
originating participating MCPTT function serving the MCPTT user;
2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the
application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall include
the \ element set to the MCPTT ID of the MCPTT user;
3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
field according to IETF RFC 6050 [9];
4) if the MCPTT client requests to activate one or more functional aliases,
shall set the Expires header field according to IETF RFC 3903 [37], to
4294967295;
NOTE 2: 4294967295, which is equal to 2^32^-1, is the highest value defined
for Expires header field in IETF RFC 3261 [24].
5) if the MCPTT client requests to deactivate one or more functional aliases,
shall set the Expires header field according to IETF RFC 3903 [37], to zero;
and
NOTE 3: Activation and deactivation of functional alias cannot be performed
with the same PUBLISH request.
6) shall include an application/pidf+xml MIME body indicating per-user
functional alias information according to clause 9A.3.1. In the MIME body, the
MCPTT client:
a) shall include all functional aliases where the MCPTT user requests
activation for the MCPTT ID;
b) shall include the MCPTT client ID of the targeted MCPTT client;
c) shall not include the \"status\" attribute and the \"expires\" attribute in
the \ element;
d) if the MCPTT client has received an indication that take over of a
functional alias is possible and intends to take over a functional alias,
shall include a \ child element set to \"true\"; and
e) shall set the \ child element of the \ root element to a
globally unique value.
The MCPTT client shall send the SIP PUBLISH request according to 3GPP TS
24.229 [4].
[TS 24.379, clause 9A.2.1.4]
If a location criterion for functional alias activation or de-activation is
met, the MCPTT client shall initiate the functional alias status change
procedure as specified in clause 9A.2.1.2.
##### 5.9.3 Test description {#test-description-8 .H6}
##### 5.9.3.1 Pre-test conditions {#pre-test-conditions-8 .H6}
##### System Simulator: {#system-simulator-8 .H6}
\- SS (MCPTT server)
\- E-UTRA related parameters are set to the default parameters for the basic
single cell environment, as defined in TS 36.508 [20] clause 4.4.
\- GNSS simulator to simulate a location.
##### IUT: {#iut-8 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-8 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 5.9.3.2 Test procedure sequence {#test-procedure-sequence-8 .H6}
Table 5.9.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT command | | | | | | | (+CUTCR). | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Trigger | - | - | - | - | | | the GNSS | | | | | | | simulator | | | | | | | to start | | | | | | | step 2 of | | | | | | | Scenario | | | | | | | #4 to | | | | | | | simulate | | | | | | | the UE | | | | | | | moving to | | | | | | | location | | | | | | | #7 inside | | | | | | | Ge | | | | | | | ographical | | | | | | | area #1 | | | | | | | as defined | | | | | | | in TS | | | | | | | 36.508 | | | | | | | [24] | | | | | | | Table | | | | | | | 4.11.2-2. | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Wait 10 | - | - | - | - | | | sec to | | | | | | | allow the | | | | | | | simulated | | | | | | | location | | | | | | | to move | | | | | | | app | | | | | | | roximately | | | | | | | 100 m from | | | | | | | the | | | | | | | original | | | | | | | location | | | | | | | to | | | | | | | location | | | | | | | #7. | | | | | +------------+------------+------------+---------+---------+----+ | 4-6 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 2a1-4 of | | | | | | | procedure | | | | | | | \'UE | | | | | | | initiated | | | | | | | MCPTT | | | | | | | functional | | | | | | | alias | | | | | | | status | | | | | | | change\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.37.3-1 | | | | | | | to change | | | | | | | the status | | | | | | | of a | | | | | | | functional | | | | | | | alias to | | | | | | | \"ac | | | | | | | tivated\"? | | | | | | | | | | | | | | NOTE: The | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | sends a | | | | | | | SIP | | | | | | | PUBLISH | | | | | | | message | | | | | | | and the SS | | | | | | | responds | | | | | | | with a SIP | | | | | | | 200(OK) | | | | | | | message | | | | | | | and then | | | | | | | the RRC | | | | | | | connection | | | | | | | is | | | | | | | released. | | | | | +------------+------------+------------+---------+---------+----+ | 7 | The SS | - | - | - | - | | | waits 2 | | | | | | | seconds | | | | | | | before the | | | | | | | SS | | | | | | | d | | | | | | | eactivates | | | | | | | the | | | | | | | dedicated | | | | | | | EPS bearer | | | | | | | and | | | | | | | releases | | | | | | | the RRC | | | | | | | c | | | | | | | onnection. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Trigger | - | - | - | - | | | the GNSS | | | | | | | simulator | | | | | | | to start | | | | | | | step 4 of | | | | | | | Scenario | | | | | | | #4 to | | | | | | | simulate | | | | | | | the UE | | | | | | | moving to | | | | | | | location | | | | | | | #8 inside | | | | | | | Ge | | | | | | | ographical | | | | | | | area #1 | | | | | | | as defined | | | | | | | in TS | | | | | | | 36.508 | | | | | | | [24] | | | | | | | Table | | | | | | | 4.11.2-2. | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Wait 10 | - | - | - | - | | | sec to | | | | | | | allow the | | | | | | | simulated | | | | | | | location | | | | | | | to move | | | | | | | app | | | | | | | roximately | | | | | | | 100 m from | | | | | | | the | | | | | | | original | | | | | | | location | | | | | | | to | | | | | | | location | | | | | | | #8. | | | | | +------------+------------+------------+---------+---------+----+ | 10-12 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 2a1-4 of | | | | | | | procedure | | | | | | | \'UE | | | | | | | initiated | | | | | | | MCPTT | | | | | | | functional | | | | | | | alias | | | | | | | status | | | | | | | change\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.37.3-1 | | | | | | | to change | | | | | | | the status | | | | | | | of a | | | | | | | functional | | | | | | | alias to | | | | | | | \"not | | | | | | | ac | | | | | | | tivated\"? | | | | | | | | | | | | | | NOTE: The | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | sends a | | | | | | | SIP | | | | | | | PUBLISH | | | | | | | message | | | | | | | and the SS | | | | | | | responds | | | | | | | with a SIP | | | | | | | 200(OK) | | | | | | | message | | | | | | | and then | | | | | | | the RRC | | | | | | | connection | | | | | | | is | | | | | | | released. | | | | | +------------+------------+------------+---------+---------+----+ | 13 | The SS | - | - | - | - | | | waits 2 | | | | | | | seconds | | | | | | | before the | | | | | | | SS | | | | | | | d | | | | | | | eactivates | | | | | | | the | | | | | | | dedicated | | | | | | | EPS bearer | | | | | | | and | | | | | | | releases | | | | | | | the RRC | | | | | | | c | | | | | | | onnection. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | The | | | | | | | specified | | | | | | | wait | | | | | | | period of | | | | | | | 2s shall | | | | | | | ensure | | | | | | | that lower | | | | | | | layer | | | | | | | signalling | | | | | | | (TCP) is | | | | | | | finished. | | | | | | +------------+------------+------------+---------+---------+----+
##### 5.9.3.3 Specific message contents {#specific-message-contents-8 .H6}
Table 5.9.3.3-1: SIP PUBLISH from the UE (step 11, Table 5.9.3.2-1;\ step 3,
TS 36.579-1 [2] Table 5.3.37.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.3.37.4-1
* * *
Information Element Value/remark Comment Reference Condition **Expires** TS
24.379 [9] clause 9A2.1.2  
value \"0\"
# 6 MCPTT Client on-network operation
## 6.1 Group Calls
6.1.1 Pre-arranged Group Call
6.1.1.1 On-network / On-demand Pre-arranged Group Call / Automatic
Commencement Mode / End-to-end communication security / Floor Control /
Upgrade to Emergency Group Call / Cancel Emergency State / Upgrade to Imminent
Peril Group Call / Cancel Imminent Peril State / Client Originated (CO)
##### 6.1.1.1.1 Test Purpose (TP) {#test-purpose-tp-9 .H6}
##### (1) {#section-38 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT On-demand
Pre-arranged Group Call requesting force of Automatic Commencement Mode at the
invited MCPTT client(s) and implicit floor control }
**then** { UE (MCPTT Client) requests On-demand Automatic Commencement Mode
Pre-arranged Group Call establishment with implicit floor control by sending a
SIP INVITE message, **and** , after indication from the MCPTT Server that the
call was established and receiving a Floor Granted message, notifies the user
}
}
##### (2) {#section-39 .H6}
**with** { UE (MCPTT Client) having established an MCPTT On-demand Pre-
arranged Group Call with Automatic Commencement Mode }
ensure that {
**when** { the MCPTT User (MCPTT Client) engages in communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the MCPTT
Server (Floor Request during a talk burst, Floor granting/release, Floor idle,
Floor deny, Floor taken/revoked) }
}
##### (3) {#section-40 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Automatic Commencement Mode }
ensure that {
**when** { the SS (MCPTT Server) needs to terminate the ongoing MCPTT Group
Call and the SS (MCPTT Server) sends a SIP BYE request }
**then** { UE (MCPTT Client) responds with a SIP 200 (OK) and leaves the MCPTT
session }
}
##### (4) {#section-41 .H6}
**with** { UE (MCPTT Client) having established an On-demand Pre-arranged
Group Call with Automatic Commencement Mode and the MCPTT User being
authorised for initiating an MCPTT Emergency Group Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) wants to upgrade the ongoing MCPTT
Group Call to an MCPTT Emergency Group Call with floor control }
**then** { UE (MCPTT Client) sends a SIP re-INVITE request and upon receipt of
a SIP 2xx response considers the call as being upgraded to Emergency Group
Call (emergency group call state = \"MEGC 3: emergency-call-granted\") }
}
##### (5) {#section-42 .H6}
**with** { UE (MCPTT Client) having upgraded to an Emergency Group Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) continues communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the MCPTT
Server }
}
##### (6) {#section-43 .H6}
**with** { UE (MCPTT Client) having upgraded an On-demand Pre-arranged Group
Call with Automatic Commencement Mode to an Emergency Group Call and the MCPTT
User being authorised for cancelling an MCPTT Emergency state (MCPTT in-
progress emergency cancel) }
ensure that {
**when** { the MCPTT User (MCPTT Client) wants to cancel the ongoing MCPTT
Emergency state }
**then** { UE (MCPTT Client) sends a SIP re-INVITE request and upon receipt of
a SIP 2xx response considers the emergency condition cancelled }
}
##### (7) {#section-44 .H6}
**with** { UE (MCPTT Client) having established an On-demand Pre-arranged
Group Call with Automatic Commencement Mode and the MCPTT User being
authorised for initiating an MCPTT Imminent Peril Group Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) wants to upgrade the ongoing MCPTT
Group Call to an MCPTT Imminent Peril Group Call with floor control }
**then** { UE (MCPTT Client) sends a SIP re-INVITE request and upon receipt of
a SIP 2xx response considers the call as being upgraded to Imminent Peril
Group Call (imminent peril group call state = \"MIG 2: in-progress\") }
}
##### (8) {#section-45 .H6}
**with** { UE (MCPTT Client) having upgraded to an Imminent Peril Group Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) continues communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the MCPTT
Server }
}
##### (9) {#section-46 .H6}
**with** { UE (MCPTT Client) having upgraded an On-demand Pre-arranged Group
Call with Automatic Commencement Mode to an Imminent Peril Group Call and the
MCPTT User being authorised for cancelling an MCPTT Imminent Peril state
(MCPTT in-progress imminent peril cancel) }
ensure that {
**when** { the MCPTT User (MCPTT Client) wants to cancel the ongoing MCPTT
Imminent Peril state }
**then** { UE (MCPTT Client) sends a SIP re-INVITE request and upon receipt of
a SIP 2xx response considers the imminent peril condition cancelled }
}
##### (10) {#section-47 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Automatic Commencement Mode }
ensure that {
**when** { the MCPTT User (MCPTT Client) wants to terminate the ongoing MCPTT
Group Call }
**then** { UE (MCPTT Client) sends a SIP BYE request and leaves the MCPTT
session }
}
##### (11) {#section-48 .H6}
**with** { UE (MCPTT Client) having established an MCPTT On-demand Pre-
arranged Group Call with Automatic Commencement Mode and
pc_MCPTT_FloorRequestQueueing = "true" }
ensure that {
**when** { the MCPTT User (MCPTT Client) engages in communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control queue handling imposed
by the MCPTT Server (Floor request queued, Floor queue position request and
Floor queue position info) }
}
##### 6.1.1.1.2 Conformance requirements {#conformance-requirements-9 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379, clauses 10.1.1.2.1.1, 6.2.1, 6.2.3.1.2, 6.4, 6.5,
6.2.6, 10.1.1.2.1.3, 10.1.1.2.1.4, 6.2.8.1.3, 10.1.1.2.1.5, 6.2.8.1.11,
6.2.4.1, TS 24.380, clauses 6.2.4.5.3,6.2.4.6.4, 6.2.4.3.5, 6.2.4.4.2,
6.2.4.5.4, 6.2.4.6.5, 6.2.4.4.4, 6.2.4.4.9, 6.2.4.9.9, 6.2.4.9.6, 6.2.4.9.4.
Unless otherwise stated, these are Rel-13 requirements.
[TS 24.379, clause 10.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT prearranged
group session the MCPTT client shall generate an initial SIP INVITE request by
following the UE originating session procedures specified in 3GPP TS 24.229
[4], with the clarifications given below.
The MCPTT client:
> 1) if the MCPTT user has requested the origination of an MCPTT emergency
> group call or is originating an MCPTT prearranged group call and the MCPTT
> emergency state is already set, the MCPTT client shall comply with the
> procedures in subclause 6.2.8.1.1;
>
> 2) if the MCPTT user has requested the origination of an MCPTT imminent
> peril group call, the MCPTT client shall comply with the procedures in
> subclause 6.2.8.1.9;
>
> 3) if the MCPTT user has requested the origination of a broadcast group
> call, the MCPTT client shall comply with the procedures in subclause
> 6.2.8.2;
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 8) should include the \"timer\" option tag in the Supported header field;
>
> 9) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the \"refresher\" header field parameter is
> omitted. If included, the \"refresher\" header field parameter shall be set
> to \"uac\";
>
> 10) shall set the Request-URI of the SIP INVITE request to the public
> service identity identifying the participating MCPTT function serving the
> MCPTT user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 11) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> 12) if the MCPTT emergency state is already set or the MCPTT client
> emergency group state for this group is set to \"MEG 2: in-progress\", the
> MCPTT client shall include the Resource-Priority header field and comply
> with the procedures in subclause 6.2.8.1.2;
>
> 13) if the MCPTT client imminent peril group state for this group is set to
> \"MIG 2: in-progress\" or \"MIG 3: confirm-pending\" shall include the
> Resource-Priority header field and comply with the procedures in subclause
> 6.2.8.1.12;
>
> 14) shall contain in an application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"prearranged\";
>
> b) the \ element set to the group identity;
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client; and
>
> NOTE 2: The MCPTT client does not include the MCPTT ID of the originating
> MCPTT user in the body, as this will be inserted into the body of the SIP
> INVITE request that is sent from the originating participating MCPTT
> function.
>
> d) if the group identity can be determined to be a TGI and if the MCPTT
> client can associate the TGI with a MCPTT group ID, the \ id> element set to the MCPTT group ID;
>
> NOTE 3: The text \"can associate the TGI with a MCPTT group ID\" means that
> the MCPTT client is able to determine that there is a constituent group of
> the temporary group that it is a member of.
>
> NOTE 4: The MCPTT client is informed about temporary groups and regrouping
> of MCPTT groups that the user is a member of as specified in 3GPP TS 24.381
> [31].
>
> NOTE 5: If the MCPTT user selected a TGI where there are several MCPTT
> groups where the MCPTT user is a member, the MCPTT client selects one of
> those MCPTT groups.
>
> 15) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.1;
>
> 16) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 17) shall send the SIP INVITE request towards the MCPTT server according to
> 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5] ;
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in subclause 6.2.8.1.4; and
>
> 3) may subscribe to the conference event package as specified in subclause
> 10.1.3.1.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request:
> 1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\"; or
>
> 2) if the MCPTT imminent peril group call state is set to \"MIGC 2:
> imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";
>
> the MCPTT client shall perform the actions specified in subclause 6.2.8.1.5.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in subclause 6.2.8.1.13.
[TS 24.379, clause 6.2.1]
The SDP offer shall contain only one SDP media-level section for MCPTT speech
according to 3GPP TS 24.229 [4] and, if floor control shall be used during the
session, shall contain one SDP media-level section for a media-floor control
entity according to 3GPP TS 24.380 [5].
When composing an SDP offer according to 3GPP TS 24.229 [4] the MCPTT client:
> 1) shall set the IP address of the MCPTT client for the offered MCPTT speech
> media stream and, if floor control shall be used, for the offered media-
> floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP offer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 2) shall include an \"m=audio\" media-level section for the MCPTT media
> stream consisting of:
>
> a) the port number for the media stream selected; and
>
> b) the codec(s) and media parameters and attributes with the following
> clarification:
>
> i) if the MCPTT client is initiating a call to a group identity;
>
> ii) if the \ element is present in the group
> document retrieved by the group management client as specified in 3GPP TS
> 24.381 [31] containing an \ element with a \"name\" attribute; and
>
> iii) if the MCPTT client supports the encoding name indicated in the value
> of the \"name\" attribute;
>
> then the MCPTT client:
>
> i) shall insert the value of the \"name\" attribute in the \
> field of the \"a=rtpmap\" attribute as defined in IETF RFC 4566 [12]; and
>
> c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4];
>
> 3) if floor control shall be used during the session, shall include an
> \"m=application\" media-level section as specified in 3GPP TS 24.380 [5]
> clause 12 for a media-floor control entity, consisting of:
>
> a) the port number for the media-floor control entity selected as specified
> in 3GPP TS 24.380 [5]; and
>
> b) the \'fmtp\' attributes as specified in 3GPP TS 24.380 [5] clause 14; and
>
> 4) if end-to-end security is required for a private call and the SDP offer
> is not for establishing a pre-established session, shall include the MIKEY-
> SAKKE I_MESSAGE in an \"a=key-mgmt\" attribute as a \"mikey\" attribute
> value in the SDP offer as specified in IETF RFC 4567 [47].
[TS 24.379, clause 6.2.3.1.2]
When performing the automatic commencement mode procedures, the MCPTT client
shall follow the procedures in subclause 6.2.3.1.1 with the following
clarification:
> \- The MCPTT client may include a P-Answer-State header field with the value
> \"Confirmed\" as specified in IETF RFC 4964 [34] in the SIP 200 (OK)
> response.
[TS 24.379, clause 6.4]
An initial SIP INVITE request fulfilling the following criteria shall be
regarded by the MCPTT server as an implicit floor request when the MCPTT
client:
> 1) initiates an MCPTT speech session or initiates a pre-established session;
> and
>
> 2) includes the \"mc_implicit_request\" \'fmtp\' attribute in the associated
> UDP stream for the floor control in the SDP offer/answer as specified in
> 3GPP TS 24.380 [5] clause 12.
A SIP re-INVITE request fulfilling the following criteria shall be regarded by
the MCPTT server as an implicit floor request when the MCPTT client:
> 1) performs an upgrade of:
>
> a) an MCPTT group call to an emergency MCPTT group call;
>
> b) an MCPTT private call to an emergency MCPTT private call; or
>
> c) an MCPTT group call to an imminent peril MCPTT group call; and
>
> 2) includes the \"mc_implicit_request\" \'fmtp\' attribute in the associated
> UDP stream for the floor control in the SDP offer/answer as specified in
> 3GPP TS 24.380 [5] clause 12.
In all other cases the SIP (re-)INVITE request shall be regarded as received
without an implicit floor request.
[TS 24.379, clause 6.5]
The MCPTT client and the MCPTT server shall support several MIME bodies in SIP
request and SIP responses.
When the MCPTT client or the MCPTT server sends a SIP message and the SIP
message contains more than one MIME body, the MCPTT client or the MCPTT
server:
> 1) shall, as specified in IETF RFC 2046 [21], include one Content-Type
> header field with the value set to multipart/mixed and with a boundary
> delimiter parameter set to any chosen value;
>
> 2) for each MIME body:
>
> a) shall insert the boundary delimiter;
>
> b) shall insert the Content-Type header field with the MIME type of the MIME
> body; and
>
> c) shall insert the content of the MIME body;
>
> 3) shall insert a final boundary delimiter; and
>
> 4) if an SDP offer or an SDP answer is one of the MIME bodies, shall insert
> the application/sdp MIME body as the first MIME body.
>
> NOTE: The reason for inserting the application/sdp MIME body as the first
> body is that if a functional entity in the underlying SIP core does not
> understand multiple MIME bodies, the functional entity will ignore all MIME
> bodies with the exception of the first MIME body. The order of multiple
> MCPTT application MIME bodies in a SIP message is irrelevant.
When the MCPTT client or the MCPTT server sends a SIP message and the SIP
message contains only one MIME body, the MCPTT client or the MCPTT server:
> 1) shall include a Content-Type header field set to the MIME type of the
> MIME body; and
>
> 2) shall insert the content of the MIME body.
[TS 24.380, clause 6.2.4.5.3]
Upon receiving an indication from the user to release the permission to send
RTP media, the floor participant:
> 1\. shall send a Floor Release message towards the floor control server The
> Floor Release message:
>
> a. may include the first bit in the subtype of the Floor Release message set
> to \'1\' (acknowledgement is required) as specified in subclause 8.2.2;
>
> NOTE: It is an implementation option to handle the receipt of the Floor Ack
> message and what action to take if the Floor Ack message is not received.
>
> b. if the session is a broadcast call and if the session was established as
> a normal call, shall include the Floor Indicator with the A-bit set to \'1\'
> (Normal call); and
>
> c. if the Floor Granted message included the G-bit set to \'1\' (Dual
> floor), shall include the Floor Indicator with the G-bit set to \'1\' (Dual
> floor);
>
> 2\. shall remove the indication that the participant is overriding without
> revoke if this indication is stored;
>
> 3\. shall start timer T100 (Floor Release) and initialize counter C100
> (Floor Release) to 1; and
>
> 4\. shall enter the \'U: pending Release\' state.
[TS 24.380, Clause 6.2.4.6.4]
Upon receiving a Floor Idle message, the floor participant:
> 1\. if the first bit in the subtype of the Floor Idle message to \'1\'
> (Acknowledgment is required) as described in subclause 8.3.2, shall send a
> Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'5\' (Floor Idle); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. may provide a floor idle notification to the MCPTT user;
>
> 3\. if the Floor Indicator field is included and the B-bit set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. shall stop timer T100 (Floor Release);
>
> 5\. if the session is not a broadcast group call or if the A-bit in the
> Floor Indicator field is set to \'1\' (Normal call), shall enter the \'U:
> has no permission\' state; and
>
> 6\. if the session was initiated as a broadcast group call:
>
> a. shall indicate to the MCPTT client the media transmission is completed;
> and
>
> b shall enter the \'Releasing\' state.
[TS 24.380, clause 6.2.4.3.5]
Upon receiving an indication from the user to request permission to send
media, the floor participant:
> 1\. shall send the Floor Request message toward the floor control server;
> The Floor Request message:
>
> a. if a different priority than the normal priority is required, shall
> include the Floor Priority field with the priority not higher than
> negotiated with the floor control server as specified in subclause 14.3.3;
> and
>
> b. if the floor request is a broadcast group call, system call, emergency
> call or an imminent peril call, shall include a Floor Indicator field
> indicating the relevant call types;
>
> 2\. shall start timer T101 (Floor Request) and initialise counter C101
> (Floor Request) to 1; and
>
> 3\. shall enter the \'U: pending Request\' state.
[TS 24.380, clause 6.2.4.4.2]
Upon receiving a Floor Granted message from the floor control server or a
floor granted indication in an SIP 200 (OK) response in the application and
signalling layer, the floor participant:
> 1\. if the first bit in the subtype of the Floor Granted message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'1\' (Floor Granted); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. shall provide floor granted notification to the user, if not already
> done;
>
> NOTE: Providing the floor granted notification to the user prior to
> receiving the Floor Granted message is an implementation option.
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
> store an indication that the participant is overriding without revoke;
>
> 5\. shall stop the optional timer T103 (End of RTP media), if running;
>
> 6\. shall stop timer T101 (Floor Request); and
>
> 7\. shall enter the \'U: has permission\' state.
[TS 24.380, clause 6.2.4.5.4]
Upon receiving a Floor Revoke message, the floor participant:
> 1\. shall inform the user that the permission to send RTP media is being
> revoked;
>
> 2\. may give information to the user about the reason for revoking the
> permission to send media;
>
> 3\. shall request the media in the MCPTT client discard any remaining
> buffered RTP media packets and to stop forwarding of encoded voice to the
> MCPTT server;
>
> 4 if the G-bit in the Floor Indicator is set to \'1\' (Dual floor):
>
> a. shall send a Floor Release message. In the Floor Release message:
>
> i. shall include the Floor Indicator with the G-bit set to \'1\' (Dual
> floor); and
>
> ii. may set the first bit in the subtype to \'1\' (Acknowledgment is
> required) as described in subclause 8.3.2;
>
> 5 if the G-bit in the Floor Indicator is set to \'0\' (not Dual floor):
>
> a. shall send a Floor Release message. In the Floor Release message:
>
> i. shall include the Floor Indicator with the G-bit set to \'0\' (not Dual
> floor); and
>
> ii. may set the first bit in the subtype to \'1\' (Acknowledgment is
> required) as described in subclause 8.3.2;
>
> NOTE: It is an implementation option to handle the receipt of the Floor Ack
> message and what action to take if the Floor Ack message is not received.
>
> 6\. shall start timer T100 (Floor Release) and initialize counter C100
> (Floor Release) to 1; and
>
> 7\. shall enter the \'U: pending Release\' state.
[TS 24.380, Clause 6.2.4.6.5]
Upon receiving a Floor Taken message, the floor participant:
> 1\. if the first bit in the subtype of the Floor Taken message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'2\' (Floor Taken); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. may provide floor taken notification to the user;
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. should start the optional timer T103 (End of RTP media);
>
> 5\. shall stop timer T100 (Floor Release); and
>
> 6\. shall enter the \'U: has no permission\' state.
[TS 24.380, clause 6.2.4.4.4]
Upon receiving a Floor Deny message, the floor participant:
> 1\. if the first bit in the subtype of the Floor Deny message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'3\' (Floor Deny); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. shall provide floor deny notification to the user;
>
> 3\. may display the floor deny reason to the user using information in the
> Reject Cause field;
>
> 4\. shall stop timer T101 (Floor Request); and
>
> 5\. shall enter the \'U: has no permission\' state.
[TS 24.380, clause 6.2.4.4.9]
Upon receiving a Floor Queue Position Info message, the floor participant:
> 1\. if the first bit in the subtype of the Floor Queue Position Info message
> is set to \'1\' (Acknowledgment is required) as described in subclause
> 8.3.2, shall send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'9\' (Floor Queue Position
> Info); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. shall provide floor request queued response notification to the MCPTT
> user;
>
> 3\. may provide the queue position and priority to the MCPTT user; and
>
> 4\. shall enter the \'U: queued\' state.
[TS 24.380, clause 6.2.4.9.9]
Upon receipt of an indication from the MCPTT client to request the queue
position, the floor participant:
> 1\. shall send the Floor Queue Position Request message;
>
> 2\. shall start timer T104 (Floor Queue Position Request) and initialize
> counter C104 (Floor Queue Position Request) to 1; and
>
> 3\. remain in the \'U: queued\' state.
[TS 24.380, clause 6.2.4.9.6]
Upon receiving an indication from the MCPTT user to release the queued floor
request, the floor participant:
> 1\. shall send a Floor Release message: The Floor Release message:
>
> a. may include the Floor Indicator field changing a broadcast group call to
> a normal call;
>
> 2\. may set the first bit in the subtype of the Floor Release message to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2;
>
> NOTE: It is an implementation option to handle the receipt of the Floor Ack
> message and what action to take if the Floor Ack message is not received.
>
> 3\. shall start timer T100 (Floor Release) and initialise counter C10 (Floor
> Release) to 1;
>
> 4\. shall stop timer T104 (Floor Queue Position Request), if running; and
>
> 5\. shall enter the \'U: pending Release\' state.
[TS 24.380, clause 6.2.4.9.4]
Upon receiving a Floor Granted message, the floor participant:
> 1\. if the first bit in the subtype of the Floor Granted message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'1\' (Floor Granted); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. shall provide a floor granted notification to the MCPTT user;
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. shall stop timer T104 (Floor Queue Position Request), if running;
>
> 5\. shall start timer T132 (Queued granted user action);
>
> 6\. shall indicate the user that the floor is granted; and
>
> 7\. shall remain in the \'U: queued\' state.
[TS 24.379, clause 6.2.6]
Upon receiving a SIP BYE request, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall send SIP 200 (OK) response towards MCPTT server according to 3GPP
> TS 24.229 [4].
[TS 24.379, clause 10.1.1.2.1.3]
This subclause covers both on-demand session and pre-established sessions.
Upon receiving a request from an MCPTT user to upgrade the MCPTT group session
to an emergency condition or an imminent peril condition on an MCPTT
prearranged group, the MCPTT client shall generate a SIP re-INVITE request as
specified in 3GPP TS 24.229 [4], with the clarifications given below.
> 1) if the MCPTT user is requesting to upgrade the MCPTT group session to an
> in-progress emergency group state and this is an unauthorised request for an
> MCPTT emergency call as determined by the procedures of subclause 6.2.8.1.8,
> the MCPTT client:
>
> a) should indicate to the MCPTT user that they are not authorised to upgrade
> the MCPTT group session to an in-progress emergency group state; and
>
> b) shall skip the remaining steps of the current subclause;
>
> 2) if the MCPTT user is requesting to upgrade the MCPTT group session to an
> in-progress imminent peril state and this is an unauthorised request for an
> MCPTT imminent peril group call as determined by the procedures of subclause
> 6.2.8.1.8, the MCPTT client:
>
> a) should indicate to the MCPTT user that they are not authorised to upgrade
> the MCPTT group session to an in-progress imminent peril group state; and
>
> b) shall skip the remaining steps of the current subclause;
>
> 3) if the MCPTT user has requested to upgrade the MCPTT group session to an
> MCPTT emergency call, the MCPTT client:
>
> a) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated
> as specified in subclause 6.2.8.1.1;
>
> b) if an indication of an MCPTT emergency alert is to be included, shall
> perform the procedures specified in subclause 6.2.9.1 for the MCPTT
> emergency alert trigger; and
>
> c) shall include a Resource-Priority header field and comply with the
> procedures in subclause 6.2.8.1.2.
>
> 4) if the MCPTT user has requested to upgrade the MCPTT group session to an
> MCPTT imminent peril call, the MCPTT client:
>
> a) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated
> as specified in subclause 6.2.8.1.9; and
>
> b) shall include a Resource-Priority header field and comply with the
> procedures in subclause 6.2.8.1.12;
>
> 5) if the SIP re-INVITE request is to be sent within an on-demand session,
> shall include in the SIP re-INVITE request an SDP offer according to 3GPP TS
> 24.229 [4] with the clarifications specified in subclause 6.2.1;
>
> 6) if the SIP re-INVITE request is to be sent within a pre-established
> session, shall include an SDP offer in the SIP re-INVITE request according
> to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the
> pre-established session;
>
> NOTE: The SIP re-INVITE request can be sent within an on-demand session or a
> pre-established session. If the SIP re-INVITE request is sent within a pre-
> established session, the media-level section for the offered MCPTT speech
> media stream and the media-level section of the offered media-floor control
> entity are expected to be the same as was negotiated in the existing pre-
> established session.
>
> 7) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 8) shall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP re-INVITE request the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall perform the actions specified in subclause 6.2.8.1.4.
[TS 24.379, clause 10.1.1.2.1.4]
This subclause covers both on-demand session and pre-established sessions.
Upon receiving a request from an MCPTT user to cancel the in-progress
emergency condition on a prearranged MCPTT group, the MCPTT client shall
generate a SIP re-INVITE request by following the UE originating session
procedures specified in 3GPP TS 24.229 [4], with the clarifications given
below.
The MCPTT client:
> 1) if the MCPTT user is not authorised to cancel the in-progress emergency
> group state of the MCPTT group as determined by the procedures of subclause
> 6.2.8.1.7, the MCPTT client:
>
> a) should indicate to the MCPTT user that they are not authorised to cancel
> the in-progress emergency group state of the MCPTT group; and
>
> b) shall skip the remaining steps of the current subclause;
>
> 2) shall, if the MCPTT user is cancelling an in-progress emergency condition
> and optionally an MCPTT emergency alert originated by the MCPTT user,
> include an application/vnd.3gpp.mcptt-info+xml MIME body populated as
> specified in subclause 6.2.8.1.3;
>
> 3) shall, if the MCPTT user is cancelling an in-progress emergency condition
> and an MCPTT emergency alert originated by another MCPTT user, include an
> application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in
> subclause 6.2.8.1.14;
>
> 4) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"prearranged\"; and
>
> b) the \ element set to the group identity;
>
> NOTE 1: The MCPTT ID of the originating MCPTT user is not included in the
> body, as this will be inserted into the body of the SIP INVITE request that
> is sent by the originating participating MCPTT function.
>
> 5) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP re-INVITE request according to IETF RFC 3840 [16];
>
> 6) if the SIP re-INVITE request is to be sent within an on-demand session,
> shall include in the SIP re-INVITE request an SDP offer according to 3GPP TS
> 24.229 [4] with the clarifications specified in subclause 6.2.1;
>
> 7) if the SIP re-INVITE request is to be sent within a pre-established
> session, shall include an SDP offer in the SIP re-INVITE request according
> to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the
> pre-established session;
>
> NOTE 2: The SIP re-INVITE request can be sent within an on-demand session or
> a pre-established session. If the SIP re-INVITE request is sent within a
> pre-established session, the media-level section for the offered MCPTT
> speech media stream and the media-level section of the offered media-floor
> control entity are expected to be the same as was negotiated in the existing
> pre-established session.
>
> 8) shall include a Resource-Priority header field and comply with the
> procedures in subclause 6.2.8.1.2; and
>
> 9) shall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP re-INVITE request, the MCPTT
client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall set the MCPTT emergency group state of the group to \"MEG 1: no-
> emergency\";
>
> 3) shall set the MCPTT emergency group call state of the group to \"MEGC 1:
> emergency-gc-capable\"; and
>
> 4) if the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-
> cancel-pending\", the sent SIP re-INVITE request did not contain an
> \ element in the application/vnd.3gpp.mcptt-info+xml MIME
> body and the SIP 2xx response to the SIP request for a priority group call
> does not contain a Warning header field as specified in subclause 4.4 with
> the warning text containing the mcptt-warn-code set to \"149\", shall set
> the MCPTT emergency alert state to \"MEA 1: no-alert\".
[TS 24.379, clause 6.2.8.1.3]
This subclause is referenced from other procedures.
If the MCPTT emergency group call state is set to \"MEGC 3: emergency-call-
granted\" and the MCPTT emergency alert state is set to \"MEA 1: no-alert\",
the MCPTT client shall generate a SIP re-INVITE request according to 3GPP TS
24.229 [4] with the clarifications given below.
> NOTE 1: This procedure assumes that the calling procedure has verified that
> the MCPTT user has made an authorised request for cancelling MCPTT in-
> progress emergency group state of the group.
The MCPTT client:
> 1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
> info+xml MIME body as defined in clause F.1 with the \
> element set to \"false\";
>
> 2) shall clear the MCPTT emergency state; and
>
> 3) shall set MCPTT emergency group state of the MCPTT group to \"MEG 3:
> cancel-pending\"
>
> NOTE 2: This is the case of an MCPTT user who has initiated an MCPTT
> emergency group call and wants to cancel it.
If the MCPTT emergency group call state is set to \"MEGC 3: emergency-call-
granted\" and the MCPTT emergency alert state is set to a value other than
\"MEA 1: no-alert\" and the MCPTT user has indicated only the MCPTT emergency
group call should be cancelled, the MCPTT client:
> 1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
> info+xml MIME body as defined in clause F.1 with the \
> element set to \"false\"; and
>
> 2) shall set the MCPTT emergency group state of the MCPTT group to \"MEG 3:
> cancel-pending\".
>
> NOTE 3: This is the case of an MCPTT user has initiated both an MCPTT
> emergency group call and an MCPTT emergency alert and wishes to only cancel
> the MCPTT emergency group call. This leaves the MCPTT emergency state set.
If the MCPTT emergency group call state is set to \"MEGC 3: emergency-call-
granted\" and the MCPTT emergency alert state is set to a value other than
\"MEA 1: no-alert\" and the MCPTT user has indicated that the MCPTT emergency
alert on the MCPTT group should be cancelled in addition to the MCPTT
emergency group call, the MCPTT client:
> 1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
> info+xml MIME body as defined in clause F.1 with the \
> element set to \"false\";
>
> 2) shall if this is an authorised request to cancel an MCPTT emergency alert
> as determined by the procedures of subclause 6.2.8.1.6:
>
> a) include in the application/vnd.3gpp.mcptt-info+xml MIME body an \ ind> element set to \"false\";
>
> b) set the MCPTT emergency alert state to \"MEA 4: Emergency-alert-cancel-
> pending\"; and
>
> c) clear the MCPTT emergency state;
>
> 3) should, if this is not an authorised request to cancel an MCPTT emergency
> alert as determined by the procedures of subclause 6.2.8.1.6, indicate to
> the MCPTT user that they are not authorised to cancel the MCPTT emergency
> alert; and
>
> 4) shall set the MCPTT emergency group state of the MCPTT group to \"MEG 3:
> cancel-pending\".
>
> NOTE 4: This is the case of an MCPTT user that has initiated both an MCPTT
> emergency group call and an MCPTT emergency alert and wishes to cancel both.
[TS 24.379, clause 10.1.1.2.1.5]
This subclause covers both on-demand session and pre-established sessions.
Upon receiving a request from an MCPTT user to cancel the in-progress imminent
peril condition on a prearranged MCPTT group, the MCPTT client shall generate
a SIP re-INVITE request by following the procedures specified in 3GPP TS
24.229 [4], with the clarifications given below.
The MCPTT client:
> 1) if the MCPTT user is not authorised to cancel the in-progress imminent
> peril group state of the MCPTT group as determined by the procedures of
> subclause 6.2.8.1.10, the MCPTT client:
>
> a) should indicate to the MCPTT user that they are not authorised to cancel
> the in-progress imminent peril group state of the MCPTT group; and
>
> b) shall skip the remaining steps of the current subclause;
>
> 2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated
> as specified in subclause 6.2.8.1.11; and
>
> 3) shall include a Resource-Priority header field and comply with the
> procedures in subclause 6.2.8.1.12;
>
> 4) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"prearranged\"; and
>
> b) the \ element set to the group identity;
>
> NOTE 1: The MCPTT ID of the originating MCPTT user is not included in the
> body, as this will be inserted into the body of the SIP re-INVITE request
> that is sent by the originating participating MCPTT function.
>
> 5) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP re-INVITE request according to IETF RFC 3840 [16];
>
> 6) if the SIP re-INVITE request is to be sent within an on-demand session,
> shall include in the SIP re-INVITE request an SDP offer according to 3GPP TS
> 24.229 [4] with the clarifications specified in subclause 6.2.1;
>
> 7) if the SIP re-INVITE request is to be sent within a pre-established
> session, shall include an SDP offer in the SIP re-INVITE request according
> to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the
> pre-established session; and
>
> NOTE 2: The SIP re-INVITE request can be sent within an on-demand session or
> a pre-established session. If the SIP re-INVITE request is sent within a
> pre-established session, the media-level section for the offered MCPTT
> speech media stream and the media-level section of the offered media-floor
> control entity are expected to be the same as was negotiated in the existing
> pre-established session.
>
> 8) shall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP re-INVITE request, the MCPTT
client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall set the MCPTT imminent peril group state of the group to \"MIG 1:
> no-imminent-peril\"; and
>
> 3) shall set the MCPTT imminent peril group call state of the group to
> \"MIGC 1: imminent-peril-gc-capable\".
[TS 24.379, clause 6.2.8.1.11]
This subclause is referenced from other procedures.
If the MCPTT imminent peril group call state is set to \"MIGC 3: imminent-
peril-call-granted\" or the MCPTT imminent peril group state of the MCPTT
group is set to \"MIG 2: in-progress\", the MCPTT client shall generate a SIP
re-INVITE request according to 3GPP TS 24.229 [4] with the clarifications
given below.
> NOTE 1: This procedure assumes that the calling procedure has verified that
> the MCPTT user has made an authorised request for cancelling the in-progress
> imminent peril group state of the group.
The MCPTT client:
> 1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
> info+xml MIME body as defined in clause F.1 with the \
> element set to \"false\"; and
>
> 2) shall set MCPTT imminent peril group state of the MCPTT group to \"MIG 4:
> cancel-pending\".
>
> NOTE 2: This is the case of an MCPTT user who has initiated an MCPTT
> imminent peril group call and wants to cancel it, or another authorised
> member of the group who wishes to cancel the in-progress imminent peril
> state of the group.
[TS 24.379, clause 6.2.4.1]
Upon receiving a request from an MCPTT user to leave an MCPTT session
established using on-demand session signalling, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 3) shall set the Request-URI to the MCPTT session identity to leave; and
>
> 4) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT
client shall interact with the media plane as specified in 3GPP TS 24.380 [5].
##### 6.1.1.1.3 Test description {#test-description-9 .H6}
##### 6.1.1.1.3.1 Pre-test conditions {#pre-test-conditions-9 .H6}
##### System Simulator: {#system-simulator-9 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-9 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-9 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.1.3.2 Test procedure sequence {#test-procedure-sequence-9 .H6}
Table 6.1.1.1.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5 | | | | | | | .3A.1.3-1 | | | | | | | to** | | | | | | | establish | | | | | | | a group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.i of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5.3A | | | | | | | .1.3-1**? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3-6 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | not | | | | | | | ification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | Floor | | | | | | | Release | | | | | | | -- Floor | | | | | | | Idle\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3 | | | | | | | A.15.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10a1-11 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 12 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | Floor | | | | | | | Request | | | | | | | -- Floor | | | | | | | Granted\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3 | | | | | | | A.11.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 14-16 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 17 | The SS | - | - | - | - | | | overrides | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | and | | | | | | | grants | | | | | | | the floor | | | | | | | to a | | | | | | | higher | | | | | | | priority | | | | | | | client. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 18 | The SS | \ with mcpttBoolean set to false
Encryption according to NOTE 2 in TS 36.579-1 [2] Table 5.5.3.2.1-1
Table 6.1.1.1.3.3-9A: SIP 200 (OK) from the SS (steps 76, 99, Table
6.1.1.1.3.2-1;\ step 3, TS 36.579-1 [2] Table 5.3A.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.1.1.1.3.3-9B
Table 6.1.1.1.3.3-9B: SDP in SIP 200 (OK) (Table 6.1.1.1.3.3-9A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER
* * *
Table 6.1.1.1.3.3-10: SIP INVITE from the UE (step 83, Table 6.1.1.1.3.2-1;\
step 1, TS 36.579-1 [2] Table 5.3A.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition IMMPERIL-CALL,
re_INVITE
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.1.1.1.3.3-10A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.1.3.3-11
Table 6.1.1.1.3.3-10A: SDP in SIP INVITE (Table 6.1.1.1.3.3-10)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_OFFER,
IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.1.1.3.3-11: MCPTT-Info in SIP INVITE (Table 6.1.1.1.3.3-10)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL,
INVITE_REFER, IMMPERIL-CALL
* * *
Table 6.1.1.1.3.3-12: SIP-INVITE from the UE (step 99, Table 6.1.1.1.3.2-1;\
step 1, TS 36.579-1 [2] Table 5.3A.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition re_INVITE
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-headers  
MIME-part-body SDP Message as described in Table 6.1.1.1.3.3-8A  
MIME body part **MCPTT-Info**  
MIME-part-headers  
MIME-part-body MCPTT-Info as described in Table 6.1.1.1.3.3-13
Table 6.1.1.1.3.3-13: MCPTT-Info in SIP INVITE (Table 6.1.1.1.3.3-12)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
imminentperil-ind Encrypted \ with mcpttBoolean set to
false Encryption according to NOTE 2 in TS 36.579-1 [2] Table 5.5.3.2.1-1
Table 6.1.1.1.3.3-14: Void
Table 6.1.1.1.3.3-15: Floor Request (step 67, Table 6.1.1.1.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3A.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.2-1, condition EMERGENCY-CALL
* * *
Table 6.1.1.1.3.3-16: Floor Request (step 90, Table 6.1.1.1.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3A.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.2-1, condition IMMPERIL-CALL
* * *
Table 6.1.1.1.3.3-17..18: Void
Table 6.1.1.1.3.3-19: Floor Release (steps 63, 72, Table 6.1.1.1.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3A.15.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.5-1, condition EMERGENCY-CALL
* * *
Table 6.1.1.1.3.3-20: Floor Release (steps 86, 95, Table 6.1.1.1.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3A.15.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.5-1, condition IMMPERIL-CALL
* * *
Table 6.1.1.1.3.3-21: Void
Table 6.1.1.1.3.3-22: Floor Idle (steps 63, 72, Table 6.1.1.1.3.2-1;\ step 3,
TS 36.579-1 [2] Table 5.3A.15.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.6-1, condition EMERGENCY-CALL
* * *
Table 6.1.1.1.3.3-23: Floor Idle (steps 86, 95, Table 6.1.1.1.3.2-1;\ step 3,
TS 36.579-1 [2] Table 5.3A.15.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.6-1, condition IMMPERIL-CALL
* * *
Table 6.1.1.1.3.3-24: Void
Table 6.1.1.1.3.3-25: Floor Granted (steps 60, 67, Table 6.1.1.1.3.2-1;\ step
5a1, TS 36.579-1 [2] Table 5.3A.6.3-1; step 2, TS 36.579-1 [2] Table
5.3A.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.3-1, condition EMERGENCY-CALL,
ACK
* * *
Table 6.1.1.1.3.3-26: Floor Granted (steps 83, 90, Table 6.1.1.1.3.2-1;\ step
5, TS 36.579-1 [2] Table 5.3A.6.3-1; step 2, TS 36.579-1 [2] Table
5.3A.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.3-1, condition IMMPERIL-CALL,
ACK
* * *
Table 6.1.1.1.3.3-27..29: Void
Table 6.1.1.1.3.3-30: Floor Deny (step 22, Table 6.1.1.1.3.2-1;\ step 2, TS
36.579-1 [2] Table 5.3A.14.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.6.4-1
* * *
Information Element Value/remark Comment Condition Reject Cause  
Reject Cause \"255\" Cause #255 - Other reason  
Reject Phrase \"Other reason\"
Table 6.1.1.1.3.3-31..32: Void
6.1.1.2 On-network / On-demand Pre-arranged Group Call / Automatic
Commencement Mode / Floor Control / Upgrade to Emergency Group Call / Cancel
Emergency State / Upgrade to Imminent Peril Group Call / Cancel Imminent Peril
State / Client Terminated (CT)
##### 6.1.1.2.1 Test Purpose (TP) {#test-purpose-tp-10 .H6}
##### (1) {#section-49 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT }
**ensure that** {\ **when** { the SS (MCPTT Server) initiates an On-demand
Pre-arranged group call with Automatic Commencement Mode and implicit floor
control }
**then** { UE (MCPTT Client) responds by sending a SIP 200 (OK) message
**and** after indication from the MCPTT Server that the call was established
notifies the user }
}
##### (2) {#section-50 .H6}
**with** { UE (MCPTT Client) having an ongoing MCPTT On-demand Pre-arranged
Group Call with Automatic Commencement Mode }
ensure that {
**when** { the MCPTT User (MCPTT Client) engages in communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the MCPTT
Server (Floor Request during a talk burst, Floor granting/release, Floor idle,
Floor deny, Floor taken/revoked) }
}
##### (3) {#section-51 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Automatic Commencement Mode }
ensure that {
**when** { the MCPTT User (MCPTT Client) wants to terminate the ongoing MCPTT
Group Call }
**then** { UE (MCPTT Client) sends a SIP BYE request and leaves the MCPTT
session }
}
##### (4) {#section-52 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Automatic Commencement Mode }
ensure that {
**when** { the SS (MCPTT Server) upgrades the ongoing MCPTT Group Call to an
MCPTT Emergency Group Call with floor control }
**then** { UE (MCPTT Client) responds to the SIP re-INVITE request with a SIP
200 (OK) response and considers the call as being upgraded to an Emergency
Group Call (emergency group call state = \"MEGC 3: emergency-call-granted\") }
}
##### (5) {#section-53 .H6}
**with** { UE (MCPTT Client) in an upgraded Emergency Group Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) continues communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the MCPTT
Server }
}
##### (6) {#section-54 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Automatic Commencement Mode which was upgraded to an Emergency Group
Call }
ensure that {
**when** { the SS (MCPTT Server) cancels the ongoing MCPTT Emergency state }
**then** { UE (MCPTT Client) responds to the SIP re-INVITE request with a SIP
200 (OK) and considers the emergency condition cancelled }
}
##### (7) {#section-55 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Automatic Commencement Mode }
ensure that {
**when** { the SS (MCPTT Server) upgrades the ongoing MCPTT Group Call to an
MCPTT Imminent Peril Group Call with floor control }
**then** { UE (MCPTT Client) responds to the SIP re-INVITE request with a SIP
200 (OK) response and considers the call as being upgraded to an cImminent
Peril Group Call (imminent peril group call state = \"MIG 2: in-progress\") }
}
##### (8) {#section-56 .H6}
**with** { UE (MCPTT Client) in an upgraded Imminent Peril Group Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) continues communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the MCPTT
Server }
}
##### (9) {#section-57 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Automatic Commencement Mode which was upgraded to an Imminent Peril
Group Call }
ensure that {
**when** { the SS (MCPTT Server) cancels the ongoing MCPTT Imminent Peril
state }
**then** { UE (MCPTT Client) responds to the SIP re-INVITE request with a SIP
200 (OK) and considers the imminent peril condition cancelled }
}
##### (10) {#section-58 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Automatic Commencement Mode }
ensure that {
**when** { the SS (MCPTT Server) needs to terminate the ongoing MCPTT Group
Call }
**then** { the SS (MCPTT Server) sends a SIP BYE request and the UE (MCPTT
Client) responds with a SIP 200 (OK) and leaves the MCPTT session }
}
##### (11) {#section-59 .H6}
**with** { UE (MCPTT Client) having established an MCPTT On-demand Pre-
arranged Group Call with Automatic Commencement Mode and
pc_MCPTT_FloorRequestQueueing = "true" }
ensure that {
**when** { the MCPTT User (MCPTT Client) engages in communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control queue handling imposed
by the MCPTT Server (Floor request queued, Floor queue position request and
Floor queue position info) }
}
##### 6.1.1.2.2 Conformance requirements {#conformance-requirements-10 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379 clauses 10.1.1.2.1.2, 6.2.2, 6.2.3.1.2, 6.2.6,
10.1.1.2.1.6, 6.2.5.1, 10.1.1.2.3.1, 10.1.1.2.3.3 and TS 24.380, clauses
6.2.4.5.3, 6.2.4.3.5, 6.2.4.4.2, 6.2.4.5.4, 6.2.4.4.4, 6.2.4.4.9, 6.2.4.9.9,
6.2.4.9.6, 6.2.4.9.4. The following represents a copy/paste extraction of the
requirements relevant to the test purpose; any references within the
copy/paste text should be understood within the scope of the core spec they
have been copied from. Unless otherwise stated, these are Rel-13 requirements.
[TS 24.379, clause 10.1.1.2.1.2]
In the procedures in this subclause:
> 1) emergency indication in an incoming SIP INVITE request refers to the
> \ element of the application/vnd.3gpp.mcptt-info+xml MIME
> body; and
>
> 2) imminent peril indication in an incoming SIP INVITE request refers to the
> \ element of the application/vnd.3gpp.mcptt-info+xml MIME
> body.
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> 1) may reject the SIP INVITE request if either of the following conditions
> are met:
>
> a) MCPTT client does not have enough resources to handle the call; or
>
> b) any other reason outside the scope of this specification;
>
> and skip the rest of the steps;
>
> 2) if the SIP INVITE request is rejected in step 1), shall respond toward
> participating MCPTT function either with appropriate reject code as
> specified in 3GPP TS 24.229 [4] and warning texts as specified in subclause
> 4.4.2 or with SIP 480 (Temporarily unavailable) response not including
> warning texts if the user is authorised to restrict the reason for failure
> and skip the rest of the steps of this subclause;
>
> NOTE: If the SIP INVITE request contains an emergency indication or imminent
> peril indication, the MCPTT client can by means beyond the scope of the
> present document choose to accept the request.
>
> 3) shall check if a Resource-Priority header field is included in the
> incoming SIP INVITE request and may perform further actions outside the
> scope of the present document to act upon an included Resource-Priority
> header field as specified in 3GPP TS 24.229 [4];
>
> 4) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
> MIME body with the \ element containing the \
> element with the \ element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication that this is a SIP INVITE
> request for an MCPTT emergency group call and:
>
> i) should display the MCPTT ID of the originator of the MCPTT emergency
> group call contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body;
>
> ii) should display the MCPTT group identity of the group with the emergency
> condition contained in the \ element; and
>
> iii) if the \ element is set to \"true\", should display to the
> MCPTT user an indication of the MCPTT emergency alert and associated
> information;
>
> b) shall set the MCPTT emergency group state to \"MEG 2: in-progress\";
>
> c) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
> peril\"; and
>
> d) shall set the MCPTT imminent peril group call state to \"MIGC 1:
> imminent-peril-gc-capable\"; otherwise
>
> 5) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
> MIME body with the \ element containing the \
> element with the \ element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication that this is a SIP INVITE
> request for an MCPTT imminent peril group call and:
>
> i) should display the MCPTT ID of the originator of the MCPTT imminent peril
> group call contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> ii) should display the MCPTT group identity of the group with the imminent
> peril condition contained in the \ element; and
>
> b) shall set the MCPTT imminent peril group state to \"MIG 2: in-progress\";
>
> 6) may display to the MCPTT user the MCPTT ID of the inviting MCPTT user;
>
> 7) shall perform the automatic commencement procedures specified in
> subclause 6.2.3.1.2 if one of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Auto\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to automatic commencement mode; or
>
> b) SIP INVITE request contains an Answer-Mode header field with the value
> \"Auto\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to manual commencement mode, yet the invited MCPTT
> client allows the call to be answered with automatic commencement mode;
>
> 8) shall perform the manual commencement procedures specified in subclause
> 6.2.3.2.2 if one of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is to use manual commencement mode; or
>
> b) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to automatic commencement mode, yet the invited
> MCPTT client allows the call to be answered with manual commencement mode;
> and
>
> 9) when the SIP 200 (OK) response to the SIP INVITE request is sent, may
> subscribe to the conference event package as specified in subclause
> 10.1.3.1.
[TS 24.379, clause 6.2.2]
When the MCPTT client receives an initial SDP offer for an MCPTT session, the
MCPTT client shall process the SDP offer and shall compose an SDP answer
according to 3GPP TS 24.229 [4].
When composing an SDP answer, the MCPTT client:
> 1) shall accept the MCPTT speech media stream in the SDP offer;
>
> 2) shall set the IP address of the MCPTT client for the accepted MCPTT
> speech media stream and, if included in the SDP offer, for the accepted
> media-floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP answer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 3) shall include an \"m=audio\" media-level section for the accepted MCPTT
> speech media stream consisting of:
>
> a) the port number for the media stream;
>
> b) media-level attributes as specified in 3GPP TS 24.229 [4]; and
>
> c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4]; and
>
> 4) if included in the SDP offer, shall include the media-level section of
> the offered media-floor control entity consisting of:
>
> a) an \"m=application\" media-level section as specified in 3GPP TS 24.380
> [5] clause 12; and
>
> b) \'fmtp\' attributes as specified in 3GPP TS 24.380 [5] clause 14.
[TS 24.379, clause 6.2.3.1.2]
When performing the automatic commencement mode procedures, the MCPTT client
shall follow the procedures in subclause 6.2.3.1.1 with the following
clarification:
> \- The MCPTT client may include a P-Answer-State header field with the value
> \"Confirmed\" as specified in IETF RFC 4964 [34] in the SIP 200 (OK)
> response.
[TS 24.379, clause 6.2.6]
Upon receiving a SIP BYE request, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall send SIP 200 (OK) response towards MCPTT server according to 3GPP
> TS 24.229 [4].
[TS 24.379, clause 10.1.1.2.1.6]
This subclause covers both on-demand session and pre-established sessions.
Upon receipt of a SIP re-INVITE request the MCPTT client:
> 1) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
> info+xml MIME body with the \ element containing the \ Params> element with the \ element set to a value of
> \"true\":
>
> a) should display to the MCPTT user the MCPTT ID of the originator of the
> MCPTT emergency group call and an indication that this is an MCPTT emergency
> group call;
>
> b) if the \ element containing the \ element
> contains an \ element set to \"true\", should display to the
> MCPTT user an indication of the MCPTT emergency alert and associated
> information;
>
> c) shall set the MCPTT emergency group state to \"MEG 2: in-progress\";
>
> d) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
> peril\"; and
>
> e) shall set the MCPTT imminent peril group call state to \"MIGC 1:
> imminent-peril-gc-capable\";
>
> 2) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
> info+xml MIME body with the \ element containing the \ Params> element with the \ element set to a value of
> \"true\":
>
> a) should display to the MCPTT user the MCPTT ID of the originator of the
> MCPTT imminent peril group call and an indication that this is an MCPTT
> imminent peril group call; and
>
> b) shall set the MCPTT imminent peril group state to \"MIG 2: in-progress\";
>
> 3) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
> info+xml MIME body with the \ element containing the \ Params> element with the \ element set to a value of
> \"false\":
>
> a) should display to the MCPTT user the MCPTT ID of the MCPTT user
> cancelling the MCPTT emergency group call;
>
> b) if the \ element containing the \ element
> contains an \ element set to \"false\":
>
> i) should display to the MCPTT user an indication of the MCPTT emergency
> alert cancellation and the MCPTT ID of the MCPTT user cancelling the MCPTT
> emergency alert; and
>
> ii) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
> info+xml MIME body including an \ element:
>
> A) should display to the MCPTT user the MCPTT ID contained in the
> \ element of the MCPTT user that originated the MCPTT
> emergency alert; and
>
> B) if the MCPTT ID contained in the \ element is the MCPTT ID
> of the receiving MCPTT user shall set the MCPTT emergency alert state to
> \"MEA 1: no-alert\";
>
> c) shall set the MCPTT emergency group state to \"MEG 1: no-emergency\"; and
>
> d) if the MCPTT emergency group call state of the group is set to \"MEGC 3:
> emergency-call-granted\", shall set the MCPTT emergency group call state of
> the group to \"MEGC 1: emergency-gc-capable\";
>
> 4) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
> info+xml MIME body with the \ element containing the \ Params> element with the \ element set to a value of
> \"false\":
>
> a) should display to the MCPTT user the MCPTT ID of the MCPTT user
> cancelling the MCPTT imminent peril group call and an indication that this
> is an MCPTT imminent peril group call;
>
> b) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
> peril\"; and
>
> c) shall set the MCPTT imminent peril group call state to \"MIGC 1:
> imminent-peril-gc-capable\";
>
> 5) shall check if a Resource-Priority header field is included in the
> incoming SIP re-INVITE request and may perform further actions outside the
> scope of the present document to act upon an included Resource-Priority
> header field as specified in 3GPP TS 24.229 [4];
>
> 6) shall accept the SIP re-INVITE request and generate a SIP 200 (OK)
> response according to rules and procedures of 3GPP TS 24.229 [4];
>
> 7) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 200 (OK) response;
>
> 8) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 200 (OK) response;
>
> 9) if the SIP re-INVITE request was received within an on-demand session,
> shall include an SDP answer in the SIP 200 (OK) response to the SDP offer in
> the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.2;
>
> 10) if the SIP re-INVITE request was received within a pre-established
> session, shall include an SDP answer in the SIP 200 (OK) response to the SDP
> offer in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4],
> based upon the parameters already negotiated for the pre-established
> session;
>
> NOTE: The SIP re-INVITE request can be received within an on-demand session
> or a pre-established session. If the SIP re-INVITE request is received
> within a pre-established session, the media-level section for the MCPTT
> speech media stream and the media-level section of the media-floor control
> entity are expected to be the same as was negotiated in the existing pre-
> established session.
>
> 11) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4]; and
>
> 12) shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.379, clause 6.2.5.1]
When the MCPTT client wants to release an MCPTT session established using on-
demand session signalling, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 3) shall set the Request-URI to the MCPTT session identity to release; and
>
> 4) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT
client shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.379, clause 10.1.1.2.3.1]
When an MCPTT client wants to leave the MCPTT session that has been
established using on-demand session, the MCPTT client shall follow the
procedures as specified in subclause 6.2.4.1.
[TS 24.379, clause 10.1.1.2.3.3]
Upon receiving a SIP BYE request for releasing the prearranged MCPTT group
call, the MCPTT client shall follow the procedures as specified in subclause
6.2.6.
[TS 24.380, clause 6.2.4.5.3]
Upon receiving an indication from the user to release the permission to send
RTP media, the floor participant:
> 1\. shall send a Floor Release message towards the floor control server The
> Floor Release message:
>
> a. may include the first bit in the subtype of the Floor Release message set
> to \'1\' (acknowledgement is required) as specified in subclause 8.2.2;
>
> NOTE: It is an implementation option to handle the receipt of the Floor Ack
> message and what action to take if the Floor Ack message is not received.
>
> b. if the session is a broadcast call and if the session was established as
> a normal call, shall include the Floor Indicator with the A-bit set to \'1\'
> (Normal call); and
>
> c. if the Floor Granted message included the G-bit set to \'1\' (Dual
> floor), shall include the Floor Indicator with the G-bit set to \'1\' (Dual
> floor);
>
> 2\. shall remove the indication that the participant is overriding without
> revoke if this indication is stored;
>
> 3\. shall start timer T100 (Floor Release) and initialize counter C100
> (Floor Release) to 1; and
>
> 4\. shall enter the \'U: pending Release\' state.
[TS 24.380, clause 6.2.4.3.5]
Upon receiving an indication from the user to request permission to send
media, the floor participant:
> 1\. shall send the Floor Request message toward the floor control server;
> The Floor Request message:
>
> a. if a different priority than the normal priority is required, shall
> include the Floor Priority field with the priority not higher than
> negotiated with the floor control server as specified in subclause 14.3.3;
> and
>
> b. if the floor request is a broadcast group call, system call, emergency
> call or an imminent peril call, shall include a Floor Indicator field
> indicating the relevant call types;
>
> 2\. shall start timer T101 (Floor Request) and initialise counter C101
> (Floor Request) to 1; and
>
> 3\. shall enter the \'U: pending Request\' state.
[TS 24.380, clause 6.2.4.4.2]
Upon receiving a Floor Granted message from the floor control server or a
floor granted indication in an SIP 200 (OK) response in the application and
signalling layer, the floor participant:
> 1\. if the first bit in the subtype of the Floor Granted message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'1\' (Floor Granted); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. shall provide floor granted notification to the user, if not already
> done;
>
> NOTE: Providing the floor granted notification to the user prior to
> receiving the Floor Granted message is an implementation option.
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
> store an indication that the participant is overriding without revoke;
>
> 5\. shall stop the optional timer T103 (End of RTP media), if running;
>
> 6\. shall stop timer T101 (Floor Request); and
>
> 7\. shall enter the \'U: has permission\' state.
[TS 24.380, clause 6.2.4.5.4]
Upon receiving a Floor Revoke message, the floor participant:
> 1\. shall inform the user that the permission to send RTP media is being
> revoked;
>
> 2\. may give information to the user about the reason for revoking the
> permission to send media;
>
> 3\. shall request the media in the MCPTT client discard any remaining
> buffered RTP media packets and to stop forwarding of encoded voice to the
> MCPTT server;
>
> 4 if the G-bit in the Floor Indicator is set to \'1\' (Dual floor):
>
> a. shall send a Floor Release message. In the Floor Release message:
>
> i. shall include the Floor Indicator with the G-bit set to \'1\' (Dual
> floor); and
>
> ii. may set the first bit in the subtype to \'1\' (Acknowledgment is
> required) as described in subclause 8.3.2;
>
> 5 if the G-bit in the Floor Indicator is set to \'0\' (not Dual floor):
>
> a. shall send a Floor Release message. In the Floor Release message:
>
> i. shall include the Floor Indicator with the G-bit set to \'0\' (not Dual
> floor); and
>
> ii. may set the first bit in the subtype to \'1\' (Acknowledgment is
> required) as described in subclause 8.3.2;
>
> NOTE: It is an implementation option to handle the receipt of the Floor Ack
> message and what action to take if the Floor Ack message is not received.
>
> 6\. shall start timer T100 (Floor Release) and initialize counter C100
> (Floor Release) to 1; and
>
> 7\. shall enter the \'U: pending Release\' state.
[TS 24.380, clause 6.2.4.4.4]
Upon receiving a Floor Deny message, the floor participant:
> 1\. if the first bit in the subtype of the Floor Deny message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'3\' (Floor Deny); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. shall provide floor deny notification to the user;
>
> 3\. may display the floor deny reason to the user using information in the
> Reject Cause field;
>
> 4\. shall stop timer T101 (Floor Request); and
>
> 5\. shall enter the \'U: has no permission\' state.
[TS 24.380, clause 6.2.4.4.9]
Upon receiving a Floor Queue Position Info message, the floor participant:
> 1\. if the first bit in the subtype of the Floor Queue Position Info message
> is set to \'1\' (Acknowledgment is required) as described in subclause
> 8.3.2, shall send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'9\' (Floor Queue Position
> Info); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. shall provide floor request queued response notification to the MCPTT
> user;
>
> 3\. may provide the queue position and priority to the MCPTT user; and
>
> 4\. shall enter the \'U: queued\' state.
[TS 24.380, clause 6.2.4.9.9]
Upon receipt of an indication from the MCPTT client to request the queue
position, the floor participant:
> 1\. shall send the Floor Queue Position Request message;
>
> 2\. shall start timer T104 (Floor Queue Position Request) and initialize
> counter C104 (Floor Queue Position Request) to 1; and
>
> 3\. remain in the \'U: queued\' state.
[TS 24.380, clause 6.2.4.9.6]
Upon receiving an indication from the MCPTT user to release the queued floor
request, the floor participant:
> 1\. shall send a Floor Release message: The Floor Release message:
>
> a. may include the Floor Indicator field changing a broadcast group call to
> a normal call;
>
> 2\. may set the first bit in the subtype of the Floor Release message to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2;
>
> NOTE: It is an implementation option to handle the receipt of the Floor Ack
> message and what action to take if the Floor Ack message is not received.
>
> 3\. shall start timer T100 (Floor Release) and initialise counter C10 (Floor
> Release) to 1;
>
> 4\. shall stop timer T104 (Floor Queue Position Request), if running; and
>
> 5\. shall enter the \'U: pending Release\' state.
[TS 24.380, clause 6.2.4.9.4]
Upon receiving a Floor Granted message, the floor participant:
> 1\. if the first bit in the subtype of the Floor Granted message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'1\' (Floor Granted); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. shall provide a floor granted notification to the MCPTT user;
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. shall stop timer T104 (Floor Queue Position Request), if running;
>
> 5\. shall start timer T132 (Queued granted user action);
>
> 6\. shall indicate the user that the floor is granted; and
>
> 7\. shall remain in the \'U: queued\' state.
##### 6.1.1.2.3 Test description {#test-description-10 .H6}
##### 6.1.1.2.3.1 Pre-test conditions {#pre-test-conditions-10 .H6}
##### System Simulator: {#system-simulator-10 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-10 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-10 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.2.3.2 Test procedure sequence {#test-procedure-sequence-10 .H6}
Table 6.1.1.2.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CT | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3.4.3-1 | | | | | | | to | | | | | | | es | | | | | | | tablish**| | | | | | | a group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2a1-9 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 10 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | Floor | | | | | | | Request | | | | | | | -- Floor | | | | | | | Granted\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3 | | | | | | | A.11.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12-14 | Void | -- | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 15 | The SS | - | - | - | - | | | overrides | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | and | | | | | | | grants | | | | | | | the floor | | | | | | | to a | | | | | | | higher | | | | | | | priority | | | | | | | client. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16 | The SS | \  with mcpttBoolean set to false
Encryption according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.2.2-1  
alert-ind Encrypted \ with mcpttBoolean set to false Encryption
according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.2.2-1
Table 6.1.1.2.3.3-7: SIP INVITE from the SS (step 78, Table 6.1.1.2.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition re_INVITE
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME part body SDP Message as described in Table 6.1.1.2.3.3-3A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.2.3.3-7A
Table 6.1.1.2.3.3-7A: MCPTT-Info in SIP INVITE (Table 6.1.1.2.3.3-7)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition GROUP-CALL,
IMMPERIL-CALL
* * *
Table 6.1.1.2.3.3-8: SIP INVITE from the SS (step 90, Table 6.1.1.2.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition re_INVITE
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME part body SDP Message as described in Table 6.1.1.2.3.3-3A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.2.3.3-9
Table 6.1.1.2.3.3-9: MCPTT-Info in SIP INVITE (Table 6.1.1.2.3.3-8)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition GROUP-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
imminentperil-ind Encrypted \ with mcpttBoolean set to
false Encryption according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.2.2-1
Table 6.1.1.2.3.3-10..11: Void
Table 6.1.1.2.3.3-11A: Floor Taken (step 54B, Table 6.1.1.2.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.7-1, condition EMERGENCY-CALL
* * *
Table 6.1.1.2.3.3-12: Void
Table 6.1.1.2.3.3-13: Floor Idle (steps 55, 62, Table 6.1.1.2.3.2-1;\ step 3,
TS 36.579-1 [2] Table 5.3A.15.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.6-1, condition EMERGENCY-CALL
* * *
Table 6.1.1.2.3.3-14: Floor Idle (steps 80, 87, Table 6.1.1.2.3.2-1;\ step 3,
TS 36.579-1 [2] Table 5.3A.15.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.6-1, condition IMMPERIL-CALL
* * *
Table 6.1.1.2.3.3-15: Void
Table 6.1.1.2.3.3-16: Floor Request (step 57, Table 6.1.1.2.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3A.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.2-1, condition EMERGENCY-CALL
* * *
Table 6.1.1.2.3.3-17: Floor Request (step 82, Table 6.1.1.2.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3A.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.2-1, condition IMMPERIL-CALL
* * *
Table 6.1.1.2.3.3-18..19: Void
Table 6.1.1.2.3.3-20: Floor Granted (step 57, Table 6.1.1.2.3.2-1;\ step 2, TS
36.579-1 [2] Table 5.3A.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.3-1, condition EMERGENCY-CALL,
ACK
* * *
Table 6.1.1.2.3.3-21: Floor Granted (step 82, Table 6.1.1.2.3.2-1;\ step 2, TS
36.579-1 [2] Table 5.3A.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.3-1, condition IMMPERIL-CALL,
ACK
* * *
Table 6.1.1.2.3.3-22..24: Void
Table 6.1.1.2.3.3-25: Floor Release (step 62, Table 6.1.1.2.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3A.15.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.5-1, condition EMERGENCY-CALL
* * *
Table 6.1.1.2.3.3-26: Floor Release (step 87, Table 6.1.1.2.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3A.15.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.5-1, condition IMMPERIL-CALL
* * *
Table 6.1.1.2.3.3-27: Floor Deny (step 21, Table 6.1.1.2.3.2-1;\ step 2, TS
36.579-1 [2] Table 5.3A.14.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.6.4-1
* * *
Information Element Value/remark Comment Condition Reject Cause  
Reject Cause \"255\" Cause #255 - Other reason  
Reject Phrase \"Other reason\"
Table 6.1.1.2.3.3-28..29: Void
6.1.1.3 On-network / On-demand Pre-arranged Group Call / Manual Commencement
Mode / Client Originated (CO)
##### 6.1.1.3.1 Test Purpose (TP) {#test-purpose-tp-11 .H6}
##### (1) {#section-60 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT On-demand
Pre-arranged Group Call requesting Manual Commencement Mode at the invited
MCPTT client(s) and implicit floor control }
**then** { UE (MCPTT Client) requests On-demand Manual Commencement Mode Pre-
arranged Group Call establishment with implicit floor control by sending a SIP
INVITE message **and** , after indication from the MCPTT Server that the call
was established and receiving a Floor Granted message, notifies the user
**and** respects the floor control imposed by the MCPTT Server }
}
##### (2) {#section-61 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Manual Commencement Mode }
ensure that {
**when** { the MCPTT User (MCPTT Client) wants to terminate the ongoing MCPTT
Group Call }
**then** { UE (MCPTT Client) sends a SIP BYE request and leaves the MCPTT
session }
}
##### 6.1.1.3.2 Conformance requirements {#conformance-requirements-11 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379, clauses 10.1.1.2.1.1, 6.2.1, 10.1.1.2.3.1, 6.2.4.1.
The following represents a copy/paste extraction of the requirements relevant
to the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-13 requirements.
[TS 24.379, clause 10.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT prearranged
group session the MCPTT client shall generate an initial SIP INVITE request by
following the UE originating session procedures specified in 3GPP TS 24.229
[4], with the clarifications given below.
The MCPTT client:
> 1) if the MCPTT user has requested the origination of an MCPTT emergency
> group call or is originating an MCPTT prearranged group call and the MCPTT
> emergency state is already set, the MCPTT client shall comply with the
> procedures in subclause 6.2.8.1.1;
>
> 2) if the MCPTT user has requested the origination of an MCPTT imminent
> peril group call, the MCPTT client shall comply with the procedures in
> subclause 6.2.8.1.9;
>
> 3) if the MCPTT user has requested the origination of a broadcast group
> call, the MCPTT client shall comply with the procedures in subclause
> 6.2.8.2;
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 8) should include the \"timer\" option tag in the Supported header field;
>
> 9) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the \"refresher\" header field parameter is
> omitted. If included, the \"refresher\" header field parameter shall be set
> to \"uac\";
>
> 10) shall set the Request-URI of the SIP INVITE request to the public
> service identity identifying the participating MCPTT function serving the
> MCPTT user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 11) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> 12) if the MCPTT client emergency group state for this group is set to \"MEG
> 2: in-progress\" or \"MEG 4: confirm-pending\", the MCPTT client shall
> include the Resource-Priority header field and comply with the procedures in
> subclause 6.2.8.1.2;
>
> 13) if the MCPTT client imminent peril group state for this group is set to
> \"MIG 2: in-progress\" or \"MIG 3: confirm-pending\" shall include the
> Resource-Priority header field and comply with the procedures in subclause
> 6.2.8.1.12;
>
> 14) shall contain in an application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"prearranged\";
>
> b) the \ element set to the group identity;
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client; and
>
> NOTE 2: The MCPTT client does not include the MCPTT ID of the originating
> MCPTT user in the body, as this will be inserted into the body of the SIP
> INVITE request that is sent from the originating participating MCPTT
> function.
>
> d) if the group identity can be determined to be a TGI and if the MCPTT
> client can associate the TGI with a MCPTT group ID, the \ id> element set to the MCPTT group ID;
>
> NOTE 3: The text \"can associate the TGI with a MCPTT group ID\" means that
> the MCPTT client is able to determine that there is a constituent group of
> the temporary group that it is a member of.
>
> NOTE 4: The MCPTT client is informed about temporary groups and regrouping
> of MCPTT groups that the user is a member of as specified in 3GPP TS 24.381
> [31].
>
> NOTE 5: If the MCPTT user selected a TGI where there are several MCPTT
> groups where the MCPTT user is a member, the MCPTT client selects one of
> those MCPTT groups.
>
> 15) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.1;
>
> 16) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 17) shall send the SIP INVITE request towards the MCPTT server according to
> 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5] ;
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in subclause 6.2.8.1.4; and
>
> 3) may subscribe to the conference event package as specified in subclause
> 10.1.3.1.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request:
> 1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\"; or
>
> 2) if the MCPTT imminent peril group call state is set to \"MIGC 2:
> imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";
>
> the MCPTT client shall perform the actions specified in subclause 6.2.8.1.5.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in subclause 6.2.8.1.13.
[TS 24.379, clause 6.2.1]
The SDP offer shall contain only one SDP media-level section for MCPTT speech
according to 3GPP TS 24.229 [4] and, if floor control shall be used during the
session, shall contain one SDP media-level section for a media-floor control
entity according to 3GPP TS 24.380 [5].
When composing an SDP offer according to 3GPP TS 24.229 [4] the MCPTT client:
> 1) shall set the IP address of the MCPTT client for the offered MCPTT speech
> media stream and, if floor control shall be used, for the offered media-
> floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP offer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 2) shall include an \"m=audio\" media-level section for the MCPTT media
> stream consisting of:
>
> a) the port number for the media stream selected; and
>
> b) the codec(s) and media parameters and attributes with the following
> clarification:
>
> i) if the MCPTT client is initiating a call to a group identity;
>
> ii) if the \ element is present in the group
> document retrieved by the group management client as specified in 3GPP TS
> 24.381 [31] containing an \ element with a \"name\" attribute; and
>
> iii) if the MCPTT client supports the encoding name indicated in the value
> of the \"name\" attribute;
>
> then the MCPTT client:
>
> i) shall insert the value of the \"name\" attribute in the \
> field of the \"a=rtpmap\" attribute as defined in IETF RFC 4566 [12]; and
>
> c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4];
>
> 3) if floor control shall be used during the session, shall include an
> \"m=application\" media-level section as specified in 3GPP TS 24.380 [5]
> clause 12 for a media-floor control entity, consisting of:
>
> a) the port number for the media-floor control entity selected as specified
> in 3GPP TS 24.380 [5]; and
>
> b) the \'fmtp\' attributes as specified in 3GPP TS 24.380 [5] clause 14; and
>
> 4) if end-to-end security is required for a private call and the SDP offer
> is not for establishing a pre-established session, shall include the MIKEY-
> SAKKE I_MESSAGE in an \"a=key-mgmt\" attribute as a \"mikey\" attribute
> value in the SDP offer as specified in IETF RFC 4567 [47].
[TS 24.379, clause 10.1.1.2.3.1]
When an MCPTT client wants to leave the MCPTT session that has been
established using on-demand session, the MCPTT client shall follow the
procedures as specified in subclause 6.2.4.1.
[TS 24.379, clause 6.2.4.1]
Upon receiving a request from an MCPTT user to leave an MCPTT session
established using on-demand session signalling, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 3) shall set the Request-URI to the MCPTT session identity to leave; and
>
> 4) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT
client shall interact with the media plane as specified in 3GPP TS 24.380 [5].
##### 6.1.1.3.3 Test description {#test-description-11 .H6}
##### 6.1.1.3.3.1 Pre-test conditions {#pre-test-conditions-11 .H6}
##### System Simulator: {#system-simulator-11 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-11 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-11 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.3.3.2 Test procedure sequence {#test-procedure-sequence-11 .H6}
Table 6.1.1.3.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | -- | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a group | | | | | | | call with | | | | | | | manual | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | group call | | | | | | | esta | | | | | | | blishment, | | | | | | | manual | | | | | | | comm | | | | | | | encement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3A.1.3-1 | | | | | | | to**| | | | | | | establish | | | | | | | a group | | | | | | | call with | | | | | | | manual | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.ii of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | |** 5.3 | | | | | | | A.1.3-1**? | | | | | +------------+------------+------------+---------+---------+----+ | 3-6 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6A | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 6B | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the floor. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 6C | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | Floor | | | | | | | release -- | | | | | | | Floor | | | | | | | Idle\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3A.15.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.1.3.3.3 Specific message contents {#specific-message-contents-11
.H6}
Table 6.1.1.3.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.1.3.3.2-1);\
step 2, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition MANUAL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.1.1.3.3.3-1A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.3.3.3-1B
Table 6.1.1.3.3.3-1A: SDP in SIP INVITE (Table 6.1.1.3.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
INITIAL_SDP_OFFER, IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.1.3.3.3-1B: MCPTT-Info in SIP INVITE (Table 6.1.1.3.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL,
INVITE_REFER
* * *
Table 6.1.1.3.3.3-2: Void
Table 6.1.1.3.3.3-2A: SIP 200 (OK) from the SS (step 2, Table 6.1.1.3.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.1.1.3.3.3-2B
Table 6.1.1.3.3.3-2B: SDP in SIP 200 (OK) (Table 6.1.1.3.3.3-2A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.1.3.3.3-3: Void
6.1.1.4 On-network / On-demand Pre-arranged Group Call / Manual Commencement
Mode / Client Terminated (CT)
##### 6.1.1.4.1 Test Purpose (TP) {#test-purpose-tp-12 .H6}
##### (1) {#section-62 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT }
**ensure that** {\ **when** { the SS (MCPTT Server) initiates an On-demand
Pre-arranged group call with Manual Commencement Mode }
**then** { UE (MCPTT Client) responds by sending a SIP 200 (OK) message
**and** notifies the user that the call was established **and** respects the
floor control imposed by the MCPTT Server }
}
##### (2) {#section-63 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Manual Commencement Mode }
ensure that {
**when** { the SS (MCPTT Server) ends the ongoing MCPTT Group Call by sending
a SIP BYE message}
**then** { the UE (MCPTT Client) responds with a SIP 200 (OK)}
}
##### (3) {#section-64 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT }
**ensure that** {\ **when** { the SS (MCPTT Server) initiates an On-demand
Pre-arranged group call with Manual Commencement Mode **and** the MCPTT User
(MCPTT Client) chooses to reject the call }
**then** { UE (MCPTT Client) responds by sending a SIP 480 (Temporarily
unavailable) message to the SS in order to reject the call }
}
##### 6.1.1.4.2 Conformance requirements {#conformance-requirements-12 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379, clauses 10.1.1.2.1.2, 6.2.2, 6.2.3.2.2, 6.5,
10.1.1.2.3.3, 6.2.6. Unless otherwise stated these are Rel-13 requirements.
[TS 24.379, clause 10.1.1.2.1.2]
In the procedures in this subclause:
> 1) emergency indication in an incoming SIP INVITE request refers to the
> \ element of the application/vnd.3gpp.mcptt-info+xml MIME
> body; and
>
> 2) imminent peril indication in an incoming SIP INVITE request refers to the
> \ element of the application/vnd.3gpp.mcptt-info+xml MIME
> body.
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> 1) may reject the SIP INVITE request if either of the following conditions
> are met:
>
> a) MCPTT client does not have enough resources to handle the call; or
>
> b) any other reason outside the scope of the present document;
>
> and skip the rest of the steps;
>
> 2) if the SIP INVITE request is rejected in step 1), shall respond toward
> participating MCPTT function either with appropriate reject code as
> specified in 3GPP TS 24.229 [4] and warning texts as specified in subclause
> 4.4.2 or with SIP 480 (Temporarily unavailable) response not including
> warning texts if the user is authorised to restrict the reason for failure
> and skip the rest of the steps of this subclause;
>
> NOTE: If the SIP INVITE request contains an emergency indication or imminent
> peril indication, the MCPTT client can by means beyond the scope of the
> present document choose to accept the request.
>
> 3) shall check if a Resource-Priority header field is included in the
> incoming SIP INVITE request and may perform further actions outside the
> scope of the present document to act upon an included Resource-Priority
> header field as specified in 3GPP TS 24.229 [4];
>
> 4) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
> MIME body with the \ element containing the \
> element with the \ element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication that this is a SIP INVITE
> request for an MCPTT emergency group call and:
>
> i) should display the MCPTT ID of the originator of the MCPTT emergency
> group call contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body;
>
> ii) should display the MCPTT group identity of the group with the emergency
> condition contained in the \ element; and
>
> iii) if the \ element is set to \"true\", should display to the
> MCPTT user an indication of the MCPTT emergency alert and associated
> information;
>
> b) shall set the MCPTT emergency group state to \"MEG 2: in-progress\";
>
> c) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
> peril\"; and
>
> d) shall set the MCPTT imminent peril group call state to \"MIGC 1:
> imminent-peril-gc-capable\"; otherwise
>
> 5) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
> MIME body with the \ element containing the \
> element with the \ element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication that this is a SIP INVITE
> request for an MCPTT imminent peril group call and:
>
> i) should display the MCPTT ID of the originator of the MCPTT imminent peril
> group call contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> ii) should display the MCPTT group identity of the group with the imminent
> peril condition contained in the \ element; and
>
> b) shall set the MCPTT imminent peril group state to \"MIG 3: in-progress\";
>
> 6) may display to the MCPTT user the MCPTT ID of the inviting MCPTT user;
>
> 7) shall perform the automatic commencement procedures specified in
> subclause 6.2.3.1.2 if one of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Auto\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to automatic commencement mode; or
>
> b) SIP INVITE request contains an Answer-Mode header field with the value
> \"Auto\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to manual commencement mode, yet the invited MCPTT
> client allows the call to be answered with automatic commencement mode;
>
> 8) shall perform the manual commencement procedures specified in subclause
> 6.2.3.2.2 if one of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is to use manual commencement mode; or
>
> b) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to automatic commencement mode, yet the invited
> MCPTT client allows the call to be answered with manual commencement mode;
> and
>
> 9) when the SIP 200 (OK) response to the SIP INVITE request is sent, may
> subscribe to the conference event package as specified in subclause
> 10.1.3.1.
[TS 24.379, clause 6.2.2]
When the MCPTT client receives an initial SDP offer for an MCPTT session, the
MCPTT client shall process the SDP offer and shall compose an SDP answer
according to 3GPP TS 24.229 [4].
When composing an SDP answer, the MCPTT client:
> 1) shall accept the MCPTT speech media stream in the SDP offer;
>
> 2) shall set the IP address of the MCPTT client for the accepted MCPTT
> speech media stream and, if included in the SDP offer, for the accepted
> media-floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP answer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 3) shall include an \"m=audio\" media-level section for the accepted MCPTT
> speech media stream consisting of:
>
> a) the port number for the media stream;
>
> b) media-level attributes as specified in 3GPP TS 24.229 [4]; and
>
> c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4]; and
>
> 4) if included in the SDP offer, shall include the media-level section of
> the offered media-floor control entity consisting of:
>
> a) an \"m=application\" media-level section as specified in 3GPP TS 24.380
> [5] clause 12; and
>
> b) \'fmtp\' attributes as specified in 3GPP TS 24.380 [5] clause 14.
[TS 24.379, clause 6.2.3.2.2]
When performing the manual commencement mode procedures:
> 1) the terminating MCPTT client may automatically generate a SIP 183
> (Session Progress) in accordance with 3GPP TS 24.229 [4], prior to the MCPTT
> user\'s acknowledgement; and
>
> 2) if the MCPTT user declines the MCPTT session invitation the MCPTT client
> shall send a SIP 480 (Temporarily Unavailable) response towards the MCPTT
> server with the warning text set to: \"110 user declined the call
> invitation\" in a Warning header field as specified in subclause 4.4, and
> not continue with the rest of the steps in this subclause.
When generating a SIP 183 (Session Progress) response, the MCPTT client:
> 1) shall include the following in the Contact header field:
>
> a) the g.3gpp.mcptt media feature tag; and
>
> b) the g.3gpp.icsi-ref media feature tag containing the value of
> \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and
>
> 2) may include a P-Answer-State header field with the value \"Unconfirmed\"
> as specified in IETF RFC 4964 [34];
When sending the SIP 200 (OK) response to the incoming SIP INVITE request, the
MCPTT client shall follow the procedures in subclause 6.2.3.1.2.
When NAT traversal is supported by the MCPTT client and when the MCPTT client
is behind a NAT, generation of SIP responses is done as specified in this
subclause and as specified in IETF RFC 5626 [15].
[TS 24.379, clause 6.5]
The MCPTT client and the MCPTT server shall support several MIME bodies in SIP
request and SIP responses.
When the MCPTT client or the MCPTT server sends a SIP message and the SIP
message contains more than one MIME body, the MCPTT client or the MCPTT
server:
> 1) shall, as specified in IETF RFC 2046 [21], include one Content-Type
> header field with the value set to multipart/mixed and with a boundary
> delimiter parameter set to any chosen value;
>
> 2) for each MIME body:
>
> a) shall insert the boundary delimiter;
>
> b) shall insert the Content-Type header field with the MIME type of the MIME
> body; and
>
> c) shall insert the content of the MIME body;
>
> 3) shall insert a final boundary delimiter; and
>
> 4) if an SDP offer or an SDP answer is one of the MIME bodies, shall insert
> the application/sdp MIME body as the first MIME body.
>
> NOTE: The reason for inserting the application/sdp MIME body as the first
> body is that if a functional entity in the underlying SIP core does not
> understand multiple MIME bodies, the functional entity will ignore all MIME
> bodies with the exception of the first MIME body. The order of multiple
> MCPTT application MIME bodies in a SIP message is irrelevant.
When the MCPTT client or the MCPTT server sends a SIP message and the SIP
message contains only one MIME body, the MCPTT client or the MCPTT server:
> 1) shall include a Content-Type header field set to the MIME type of the
> MIME body; and
>
> 2) shall insert the content of the MIME body.
[TS 24.379, clause 10.1.1.2.3.3]
Upon receiving a SIP BYE request for releasing the prearranged MCPTT group
call, the MCPTT client shall follow the procedures as specified in subclause
6.2.6.
[TS 24.379, clause 6.2.6]
Upon receiving a SIP BYE request, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall send SIP 200 (OK) response towards MCPTT server according to 3GPP
> TS 24.229 [4].
##### 6.1.1.4.3 Test description {#test-description-12 .H6}
##### 6.1.1.4.3.1 Pre-test conditions {#pre-test-conditions-12 .H6}
##### System Simulator: {#system-simulator-12 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-12 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-12 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.4.3.2 Test procedure sequence {#test-procedure-sequence-12 .H6}
Table 6.1.1.4.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | group | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | with | | | | | | | manual | | | | | | | comme | | | | | | | ncement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.5.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2-7 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5. | | | | | | | 3.12.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9-10 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 11-15c1 | Steps 1a1 | - | - | - | - | | | -- 5c1 of | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | group | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | with | | | | | | | manual | | | | | | | comme | | | | | | | ncement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5.3.5.3-1 | | | | | | | are | | | | | | | p | | | | | | | erformed. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 14 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | decline | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15 | Check: | --> | SIP 480 | 3 | P | | | Does the | | (Te | | | | | UE (MCPTT | | mporarily | | | | | client) | | una | | | | | answer | | vailable) | | | | | the call | | | | | | | with a | | | | | | | SIP 480 | | | | | | | (Te | | | | | | | mporarily | | | | | | | unav | | | | | | | ailable)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16 | SS | \ 1) the \ element in the application/resource-lists MIME body shall
> contain a \"uri\" attribute set to the prearranged MCPTT group identity;
>
> 2) the \ element of the application/vnd.3gpp.mcptt-info MIME
> body in the hname \"body\" URI header field shall be set to a value of
> \"prearranged\"; and
>
> 3) if the MCPTT user has requested the origination of a broadcast group
> call, the MCPTT client shall comply with the procedures in subclause
> 6.2.8.2.
[TS 24.379, clause 10.1.1.2.3.2]
When an MCPTT client wants to leave the MCPTT session within a pre-established
session, the MCPTT client shall follow the procedures as specified in
subclause 6.2.4.2.
[TS 24.379, clause 6.2.4.2]
Upon receiving a request from an MCPTT user to leave an MCPTT session within a
pre-established session, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate an initial SIP REFER request outside a dialog in
> accordance with the procedures specified in 3GPP TS 24.229 [4], IETF RFC
> 4488 [22] and IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF
> RFC 7647 [27];
>
> 3) shall set the Request-URI of the SIP REFER request to the public service
> identity identifying the pre-established session on the MCPTT server serving
> the MCPTT user;
>
> 4) shall include the Refer-Sub header field with value \"false\" according
> to rules and procedures of IETF RFC 4488 [22];
>
> 5) shall include the Supported header field with value \"norefersub\"
> according to rules and procedures of IETF RFC 4488 [22];
>
> 6) shall set the Refer-To header field of the SIP REFER request to the MCPTT
> session identity to leave;
>
> 7) shall include the \"method\" SIP URI parameter with the value \"BYE\" in
> the URI in the Refer-To header field;
>
> 8) shall include a Target-Dialog header field as specified in IETF RFC 4538
> [23] identifying the pre-established session; and
>
> 9) shall send the SIP REFER request according to 3GPP TS 24.229 [4].
Upon receiving a SIP 2xx response to the SIP REFER request, the MCPTT client
shall interact with media plane as specified in 3GPP TS 24.380 [5].
[TS 24.380, clause 9.2.2.2.2]
When a pre-established session is created between the MCPTT client and the
participating MCPTT function, as specified in 3GPP TS 24.379 [2], the MCPTT
client:
> 1\. shall initialize any needed user plane resources for the pre-established
> session as specified in 3GPP TS 24.379 [2]; and
>
> 2\. shall enter the \'U: Pre-established session not in use\' state.
[TS 24.380, clause 9.2.2.3.2]
Upon reception of a Connect message:
> 1\. if the MCPTT client accepts the incoming call the MCPTT client:
>
> a. shall send the Acknowledgement message with Reason Code field set to
> \'Accepted\';
>
> b. shall use only the media streams of the pre-established session which are
> indicated as used in the associated call session Media Streams field, if the
> Connect contains a Media Streams field;
>
> c. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\' as specified in subclause 6.2.4; and
>
> d. shall enter the \'U: Pre-established session in use\' state; or
>
> 2\. Otherwise the MCPTT client:
>
> a. shall send the Acknowledgement message with the Reason Code field set to
> \'Busy\' or \'Not Accepted\'; and
>
> b. shall remain in \'U: Pre-established session not in use\' state.
[TS 24.380, clause 9.2.2.4.6]
Upon receiving a 2xx response to the sent SIP REFER request as described in
3GPP TS 24.379 [2] when the call is released, but the Pre-established Session
is kept alive the MCPTT client:
> 1\. shall enter the \'U: Pre-established session not in use\' state; and
>
> 2\. shall terminate the instance of \'Floor participant state transition
> diagram for basic operation\' state machine as specified in subclause 6.2.4.
##### 6.1.1.5.3 Test description {#test-description-13 .H6}
##### 6.1.1.5.3.1 Pre-test conditions {#pre-test-conditions-13 .H6}
##### System Simulator: {#system-simulator-13 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-13 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-13 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.5.3.2 Test procedure sequence {#test-procedure-sequence-13 .H6}
Table 6.1.1.5.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | group | | | | | | | call | | | | | | | using the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session | | | | | | | with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | esta | | | | | | | blishment | | | | | | | using a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5 | | | | | | | .3A.3.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2A | The SS | \ NOTE: If a terminating client does not have an available pre-established
> session, the call setup proceeds as in on-demand call setup as specified in
> 3GPP TS 24.379 [2].
[TS 24.380, clause 4.1.2.3]
When a call is released by the controlling MCPTT function (as specified in
3GPP TS 24.379 [2]), the participating MCPTT function sends a Disconnect
message to all MCPTT clients which used a pre-established session for this
call. Then the call is released (see also 3GPP TS 24.379 [2]) and the pre-
established session can be used for another call.
When an MCPTT client leaves a call (as specified in 3GPP TS 24.379 [2]) which
was setup over a pre-established session without releasing the pre-established
session, this pre-established session can be used for another call.
[TS 24.380, clause 9.2.2.3.2]
Upon reception of a Connect message:
> 1\. if the MCPTT client accepts the incoming call the MCPTT client:
>
> a. shall send the Acknowledgement message with Reason Code field set to
> \'Accepted\';
>
> b. shall use only the media streams of the pre-established session which are
> indicated as used in the associated call session Media Streams field, if the
> Connect contains a Media Streams field;
>
> c. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\' as specified in subclause 6.2.4; and
>
> d. shall enter the \'U: Pre-established session in use\' state; or
>
> 2\. Otherwise the MCPTT client:
>
> a. shall send the Acknowledgement message with the Reason Code field set to
> \'Busy\' or \'Not Accepted\'; and
>
> b. shall remain in \'U: Pre-established session not in use\' state.
[TS 24.380, clause 9.2.2.3.4]
Upon reception of a Disconnect message the MCPTT client:
> 1\. if the first bit in the subtype of the Disconnect message is set to
> \'1\' (acknowledgement is required), shall send the Acknowledgement message
> with the Reason Code set to \'Accepted\'; and
>
> 2\. shall remain in \'U: Pre-established session not in use\' state.
##### 6.1.1.6.3 Test description {#test-description-14 .H6}
##### 6.1.1.6.3.1 Pre-test conditions {#pre-test-conditions-14 .H6}
##### System Simulator: {#system-simulator-14 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-14 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-14 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.6.3.2 Test procedure sequence {#test-procedure-sequence-14 .H6}
Table 6.1.1.6.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                                                                                      U - S              Message
1 Check: Does the UE (MCPTT client) correctly perform procedure \'MCPTT CT
Call establishment using a pre-established session\' as described in TS
36.579-1 [2] Table 5.3A.8.3-1 to establish a group call with automatic
commencement mode? - - 1 P 2 Void - - - - 3 Check: Does the UE (MCPTT client)
correctly perform procedure \'MCPTT CT call release keeping the pre-
established session\' as described in TS 36.579-1 [2] Table 5.3A.5.3-1 to
release the call? - - 2 P 4 Void - - - -
##### 6.1.1.6.3.3 Specific message contents {#specific-message-contents-14
.H6}
Table 6.1.1.6.3.3-1: Connect (step 1, Table 6.1.1.6.3.2-1;\ step 2, TS
36.579-1 [2] Table 5.3A.8.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.6.12-1, condition GROUP-CALL, ACK
* * *
Information Element Value/remark Comment Condition Answer State field  
Answer State \"0\" unconfirmed
6.1.1.7 On-network / Pre-arranged Group Call using pre-established session /
Manual Commencement Mode / Client Terminated (CT)
##### 6.1.1.7.1 Test Purpose (TP) {#test-purpose-tp-15 .H6}
##### (1) {#section-69 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service and
having a pre-established session with the MCPTT Server }
ensure that {
**when** { the MCPTT Server requests the establishment of an MCPTT On-demand
Pre-arranged Group Call using a pre-established session requesting Manual
Commencement Mode to the UE (MCPTT Client) by sending a SIP re-INVITE}
**then** { UE (MCPTT Client) accepts the On-demand Pre-arranged Group Call by
sending an SIP 200 (OK) **and** responds to MCPC messages with an
Acknowledgement }
}
##### (2) {#section-70 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call using a pre-established session with Automatic Commencement Mode }
ensure that {
**when** { the MCPTT Server wants to terminate the ongoing MCPTT Group Call
and sends a Disconnect }
**then** { UE (MCPTT Client) accepts the ending of the MCPTT Group Call by
sending an Acknowledgement }
}
##### 6.1.1.7.2 Conformance requirements {#conformance-requirements-15 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.380, clauses 4.1.2.2, 4.1.2.3, 9.2.2.3.2, 9.2.2.3.4,
9.2.2.3.3 and TS 24.379, clause 10.1.1.2.2.2, 10.1.1.2.1.2. The following
represents a copy/paste extraction of the requirements relevant to the test
purpose; any references within the copy/paste text should be understood within
the scope of the core spec they have been copied from. Unless otherwise
stated, these are Rel-13 requirements.
[TS 24.380, clause 4.1.2.2]
For a pre-arranged group call if the controlling MCPTT function as triggered
by an originating group member initiates a call as specified in 3GPP TS 24.379
[2], the participating MCPTT function which serves the terminating MCPTT
client sends a Connect message to all affiliated MCPTT clients of this group.
After the reception of the Connect message the terminating MCPTT client sends
an Acknowledgment message by indicating that the connection is accepted or by
indicating that the connection is not accepted. If the connection is accepted
by the terminating MCPTT client, the floor control for this call continues a
specified in clause 6.
> NOTE: If a terminating client does not have an available pre-established
> session, the call setup proceeds as in on-demand call setup as specified in
> 3GPP TS 24.379 [2].
[TS 24.380, clause 4.1.2.3]
When a call is released by the controlling MCPTT function (as specified in
3GPP TS 24.379 [2]), the participating MCPTT function sends a Disconnect
message to all MCPTT clients which used a pre-established session for this
call. Then the call is released (see also 3GPP TS 24.379 [2]) and the pre-
established session can be used for another call.
When an MCPTT client leaves a call (as specified in 3GPP TS 24.379 [2]) which
was setup over a pre-established session without releasing the pre-established
session, this pre-established session can be used for another call.
[TS 24.380, clause 9.2.2.3.2]
Upon reception of a Connect message:
> 1\. if the MCPTT client accepts the incoming call the MCPTT client:
>
> a. shall send the Acknowledgement message with Reason Code field set to
> \'Accepted\';
>
> b. shall use only the media streams of the pre-established session which are
> indicated as used in the associated call session Media Streams field, if the
> Connect contains a Media Streams field;
>
> c. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\' as specified in subclause 6.2.4; and
>
> d. shall enter the \'U: Pre-established session in use\' state; or
>
> 2\. Otherwise the MCPTT client:
>
> a. shall send the Acknowledgement message with the Reason Code field set to
> \'Busy\' or \'Not Accepted\'; and
>
> b. shall remain in \'U: Pre-established session not in use\' state.
[TS 24.380, clause 9.2.2.3.4]
Upon reception of a Disconnect message the MCPTT client:
> 1\. if the first bit in the subtype of the Disconnect message is set to
> \'1\' (acknowledgement is required), shall send the Acknowledgement message
> with the Reason Code set to \'Accepted\'; and
>
> 2\. shall remain in \'U: Pre-established session not in use\' state.
[TS 24.380, clause 9.2.2.3.3]
When the associated pre-established session between the MCPTT client and the
MCPTT server is released the MCPTT client:
> 1\. shall release any user plane resources including any running timers
> associated with the pre-established session; and
>
> 2\. shall enter the \'Start-stop\' state and then the \'Call setup control
> over pre-established session state machine\' is released.
[TS 24.379, clause 10.1.1.2.2.2]
Upon receiving a SIP re-INVITE request within a pre-established Session
without an associated MCPTT session or when generating SIP responses to the
SIP re-INVITE request, the MCPTT client shall follow the procedures in
subclause 10.1.1.2.1.2.
> NOTE: In subclause 10.1.1.2.1.2, the reader is assumed to replace
> occurrences of SIP INVITE request with SIP re-INVITE request.
[TS 24.379, clause 10.1.1.2.2.2]
In the procedures in this subclause:
> 1) emergency indication in an incoming SIP INVITE request refers to the
> \ element of the application/vnd.3gpp.mcptt-info+xml MIME
> body; and
>
> 2) imminent peril indication in an incoming SIP INVITE request refers to the
> \ element of the application/vnd.3gpp.mcptt-info+xml MIME
> body.
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> 1) may reject the SIP INVITE request if either of the following conditions
> are met:
>
> a) MCPTT client does not have enough resources to handle the call; or
>
> b) any other reason outside the scope of this specification;
>
> 2) if the SIP INVITE request is rejected in step 1), shall respond toward
> participating MCPTT function either with appropriate reject code as
> specified in 3GPP TS 24.229 [4] and warning texts as specified in subclause
> 4.4.2 or with SIP 480 (Temporarily unavailable) response not including
> warning texts if the user is authorised to restrict the reason for failure
> and skip the rest of the steps of this subclause;
>
> NOTE: If the SIP INVITE request contains an emergency indication or imminent
> peril indication, the MCPTT client can by means beyond the scope of this
> specification choose to accept the request.
>
> 3) shall check if a Resource-Priority header field is included in the
> incoming SIP INVITE request and may perform further actions outside the
> scope of this specification to act upon an included Resource-Priority header
> field as specified in 3GPP TS 24.229 [4];
>
> 4) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
> MIME body with the \ element containing the \
> element with the \ element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication that this is a SIP INVITE
> request for an MCPTT emergency group call and:
>
> i) should display the MCPTT ID of the originator of the MCPTT emergency
> group call contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body;
>
> ii) should display the MCPTT group identity of the group with the emergency
> condition contained in the \ element; and
>
> iii) if the \ element is set to \"true\", should display to the
> MCPTT user an indication of the MCPTT emergency alert and associated
> information;
>
> b) shall set the MCPTT emergency group state to \"MEG 2: in-progress\";
>
> c) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
> peril\"; and
>
> d) shall set the MCPTT imminent peril group call state to \"MIGC 1:
> imminent-peril-gc-capable\"; otherwise
>
> 5) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
> MIME body with the \ element containing the \
> element with the \ element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication that this is a SIP INVITE
> request for an MCPTT imminent peril group call and:
>
> i) should display the MCPTT ID of the originator of the MCPTT imminent peril
> group call contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> ii) should display the MCPTT group identity of the group with the imminent
> peril condition contained in the \ element; and
>
> b) shall set the MCPTT imminent peril group state to \"MIG 2: in-progress\";
>
> 6) may display to the MCPTT user the MCPTT ID of the inviting MCPTT user;
>
> 7) shall perform the automatic commencement procedures specified in
> subclause 6.2.3.1.2 if one of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Auto\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to automatic commencement mode; or
>
> b) SIP INVITE request contains an Answer-Mode header field with the value
> \"Auto\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to manual commencement mode, yet the invited MCPTT
> client allows the call to be answered with automatic commencement mode;
>
> 8) shall perform the manual commencement procedures specified in subclause
> 6.2.3.2.2 if one of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is to use manual commencement mode; or
>
> b) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to automatic commencement mode, yet the invited
> MCPTT client allows the call to be answered with manual commencement mode;
> and
>
> 9) when the SIP 200 (OK) response to the SIP INVITE request is sent, may
> subscribe to the conference event package as specified in subclause
> 10.1.3.1.
##### 6.1.1.7.3 Test description {#test-description-15 .H6}
##### 6.1.1.7.3.1 Pre-test conditions {#pre-test-conditions-15 .H6}
##### System Simulator: {#system-simulator-15 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-15 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-15 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.7.3.2 Test procedure sequence {#test-procedure-sequence-15 .H6}
Table 6.1.1.7.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                                                 U - S              Message
1 Check: Does the UE (MCPTT client) correctly perform procedure \'MCX CT group
call establishment with manual commencement\' as described in TS 36.579-1 [2]
Table 5.3.5.3-1? - - 1 P 2-6 Void - - - - 7 Check: Does the UE (MCPTT client)
correctly perform procedure \'MCPTT CT Call establishment using a pre-
established session\' as described in TS 36.579-1 [2] Table 5.3A.8.3-1
starting with step 2? - - 1 P 8 Void - - - - 9 Check: Does the UE (MCPTT
client) correctly perform procedure \'MCPTT CT call release keeping the pre-
established session\' as described in TS 36.579-1 [2] Table 5.3A.5.3-1? - - 2
P 10 Void - - - -
##### 6.1.1.7.3.3 Specific message contents {#specific-message-contents-15
.H6}
Table 6.1.1.7.3.3-1: SIP re-INVITE from the SS (step 1, Table 6.1.1.7.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition re_INVITE,
MANUAL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP as described in Table 6.1.1.7.3.3-2A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.7.3.3-3
Table 6.1.1.7.3.3-2: Void
Table 6.1.1.7.3.3-2A: SDP in SIP INVITE (Table 6.1.1.7.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_OFFER,
PRE_ESTABLISHED_SESSION
* * *
Table 6.1.1.7.3.3-3: MCPTT-Info in SIP INVITE (Table 6.1.1.7.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition GROUP-CALL
* * *
Table 6.1.1.7.3.3-4: SIP 200 (OK) from the UE (step 1, Table 6.1.1.7.3.2-1;\
step 7, TS 36.579-1 [2] Table 5.3.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP,
GROUP-CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP as described in Table 6.1.1.7.3.3-5  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.1.1.7.3.3-6
Table 6.1.1.7.3.3-5: SDP in SIP 200 (OK) (Table 6.1.1.7.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_ANSWER,
PRE_ESTABLISHED_SESSION
* * *
Table 6.1.1.7.3.3-6: MCPTT-Info in SIP 200 (OK) (Table 6.1.1.7.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
6.1.1.8 On-network / Pre-arranged Broadcast Group Call / Client Originated
(CO)
##### 6.1.1.8.1 Test Purpose (TP) {#test-purpose-tp-16 .H6}
##### (1) {#section-71 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT On-demand
Pre-arranged Broadcast Group Call }
**then** { UE (MCPTT Client) requests On-demand Pre-arranged Broadcast Group
Call by sending a SIP INVITE message **and** responds to the SS with correct
SIP messages }
}
##### 6.1.1.8.2 Conformance requirements {#conformance-requirements-16 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clause 4.12, 6.2.8.2 and 10.1.1.2.1.1. Unless
otherwise stated, these are Rel-13 requirements.
[TS 24.379, clause 4.12]
A broadcast group call is a group call where the initiating MCPTT user expects
no response from the other MCPTT users, so that when the user\'s transmission
is complete, so is the call. The functionality in the present release of the
specification for broadcast group calls is not compliant to the requirements
for user-broadcast group and group-broadcast group calls as specified in 3GPP
TS 22.179 [2], 3GPP TS 22.280 [76] and 3GPP TS 23.379 [3]. In the present
release of the specification, a broadcast group call can be initiated by an
MCPTT user on any MCPTT group that the MCPTT user is part of.
> NOTE 1: Configuration related to the authorisation to create a user-
> broadcast group or a group-broadcast exists in the user profile document as
> specified in 3GPP TS 24.484 [50], but is not used by any procedures in 3GPP
> TS 24.481 [31] in the current release, as the ability for an authorised user
> to create user-broadcast groups and group-broadcast groups is not provided
> in the current release.
>
> NOTE 2: Configuration related to broadcast group hierarchies can be found in
> the group document as specified in 3GPP TS 24.481 [31] and in the service
> configuration document as specified in 3GPP TS 24.484 [50]. However, this
> configuration is not used by any procedures in 3GPP TS 24.380 [5] in the
> current release.
[TS 24.379, clause 6.2.8.2]
> NOTE: This subclause is referenced from other procedures.
When the MCPTT user initiates a broadcast group call, the MCPTT client:
> 1) in the case of the prearranged group call is initiated on-demand, shall
> include in the application/vnd.3gpp.mcptt-info+xml MIME body the
> \ element set to \"true\" as defined in clause F.1; and
>
> 2) in the case the prearranged group call is initiated using a pre-
> established session, shall include in the application/vnd.3gpp.mcptt-
> info+xml MIME body in the \"body\" URI header field in the Refer-To header
> field the \ element set to \"true\" as defined in clause F.1.
[TS 24.379, clause 10.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT prearranged
group session the MCPTT client shall generate an initial SIP INVITE request by
following the UE originating session procedures specified in 3GPP TS 24.229
[4], with the clarifications given below.
The MCPTT client:
> ...
>
> 3) if the MCPTT user has requested the origination of a broadcast group
> call, the MCPTT client shall comply with the procedures in subclause
> 6.2.8.2;
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 8) should include the \"timer\" option tag in the Supported header field;
>
> 9) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the \"refresher\" header field parameter is
> omitted. If included, the \"refresher\" header field parameter shall be set
> to \"uac\";
>
> 10) shall set the Request-URI of the SIP INVITE request to the public
> service identity identifying the participating MCPTT function serving the
> MCPTT user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 11) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> ...
>
> 14) shall contain in an application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"prearranged\";
>
> b) the \ element set to the group identity;
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client; and
>
> NOTE 2: The MCPTT client does not include the MCPTT ID of the originating
> MCPTT user in the body, as this will be inserted into the body of the SIP
> INVITE request that is sent from the originating participating MCPTT
> function.
>
> d) if the group identity can be determined to be a TGI and if the MCPTT
> client can associate the TGI with a MCPTT group ID, the \ id> element set to the MCPTT group ID;
>
> NOTE 3: The text \"can associate the TGI with a MCPTT group ID\" means that
> the MCPTT client is able to determine that there is a constituent group of
> the temporary group that it is a member of.
>
> NOTE 4: The MCPTT client is informed about temporary groups and regrouping
> of MCPTT groups that the user is a member of as specified in 3GPP TS 24.481
> [31].
>
> NOTE 5: If the MCPTT user selected a TGI where there are several MCPTT
> groups where the MCPTT user is a member, the MCPTT client selects one of
> those MCPTT groups.
>
> 15) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.1;
>
> 16) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 17) shall send the SIP INVITE request towards the MCPTT server according to
> 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5] ;
>
> ...
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in subclause 6.2.8.1.13.
##### 6.1.1.8.3 Test description {#test-description-16 .H6}
##### 6.1.1.8.3.1 Pre-test conditions {#pre-test-conditions-16 .H6}
##### System Simulator: {#system-simulator-16 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-16 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-16 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.8.3.2 Test procedure sequence {#test-procedure-sequence-16 .H6}
Table 6.1.1.8.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a | | | | | | | broadcast | | | | | | | group call | | | | | | | with | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3A.1.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a | | | | | | | broadcast | | | | | | | group call | | | | | | | with | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.iii of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5.3 | | | | | | | A.1.3-1**? | | | | | +------------+------------+------------+---------+---------+----+ | 3-5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | The | - | - | - | - | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.12.3-1 | | | | | | | is | | | | | | | performed. | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.1.8.3.3 Specific message contents {#specific-message-contents-16
.H6}
Table 6.1.1.8.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.1.8.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.1.1.8.3.3-1A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.8.3.3-2
Table 6.1.1.8.3.3-1A: SDP in SIP INVITE (Table 6.1.1.8.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
INITIAL_SDP_OFFER, IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.1.8.3.3-2: MCPTT-Info in SIP INVITE (Table 6.1.1.8.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-REFER,
GROUP-CALL, BROADCAST-CALL
* * *
Table 6.1.1.8.3.3-3: Void
Table 6.1.1.8.3.3-4: SIP 200 (OK) from the SS (step 2, Table 6.1.1.8.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.1.1.8.3.3-2B
Table 6.1.1.8.3.3-5: SDP in SIP 200 (OK) (Table 6.1.1.8.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER
* * *
Table 6.1.1.8.3.3-6: SIP BYE from the SS (step 6, Table 6.1.1.8.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3.12.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1, condition MO_CALL
* * *
6.1.1.9 On-network / Pre-arranged Broadcast Group Call / Client Terminated
(CT)
##### 6.1.1.9.1 Test Purpose (TP) {#test-purpose-tp-17 .H6}
##### (1) {#section-72 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT Client receives a SIP INVITE message of an MCPTT On-
demand Pre-arranged Broadcast Group Call }
**then** { the MCPTT Client displays an indication for the Pre-arranged MCPTT
group call to the user **and** responds to the SS with correct SIP messages }
}
##### (2) {#section-73 .H6}
**with** { UE (MCPTT Client) having an incoming Pre-arranged MCPTT group call
**and** the Answer-Mode header in the SIP INVITE message is set to Manual }
ensure that {
**when** { the user answers the MCPTT group call }
**then** { UE sends a SIP 200 OK as a response to the SIP INVITE message }
}
##### 6.1.1.9.2 Conformance requirements {#conformance-requirements-17 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clauses 4.12, and 10.1.1.2.1.2. Unless otherwise
stated, these are Rel-13 requirements.
[TS 24.379, clause 4.12]
A broadcast group call is a group call where the initiating MCPTT user expects
no response from the other MCPTT users, so that when the user\'s transmission
is complete, so is the call. The functionality in the present release of the
specification for broadcast group calls is not compliant to the requirements
for user-broadcast group and group-broadcast group calls as specified in 3GPP
TS 22.179 [2], 3GPP TS 22.280 [76] and 3GPP TS 23.379 [3]. In the present
release of the specification, a broadcast group call can be initiated by an
MCPTT user on any MCPTT group that the MCPTT user is part of.
> NOTE 1: Configuration related to the authorisation to create a user-
> broadcast group or a group-broadcast exists in the user profile document as
> specified in 3GPP TS 24.484 [50], but is not used by any procedures in 3GPP
> TS 24.481 [31] in the current release, as the ability for an authorised user
> to create user-broadcast groups and group-broadcast groups is not provided
> in the current release.
>
> NOTE 2: Configuration related to broadcast group hierarchies can be found in
> the group document as specified in 3GPP TS 24.481 [31] and in the service
> configuration document as specified in 3GPP TS 24.484 [50]. However, this
> configuration is not used by any procedures in 3GPP TS 24.380 [5] in the
> current release.
[TS 24.379, clause 10.1.1.2.1.2]
In the procedures in this subclause:
> ...
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> ...
>
> 6) may display to the MCPTT user the MCPTT ID of the inviting MCPTT user;
>
> 7) shall perform the automatic commencement procedures specified in
> subclause 6.2.3.1.2 if one of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Auto\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to automatic commencement mode; or
>
> b) SIP INVITE request contains an Answer-Mode header field with the value
> \"Auto\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to manual commencement mode, yet the invited MCPTT
> client allows the call to be answered with automatic commencement mode;
>
> 8) shall perform the manual commencement procedures specified in subclause
> 6.2.3.2.2 if one of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is to use manual commencement mode; or
>
> b) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to automatic commencement mode, yet the invited
> MCPTT client allows the call to be answered with manual commencement mode;
> and
>
> 9) when the SIP 200 (OK) response to the SIP INVITE request is sent, may
> subscribe to the conference event package as specified in subclause
> 10.1.3.1.
##### 6.1.1.9.3 Test description {#test-description-17 .H6}
##### 6.1.1.9.3.1 Pre-test conditions {#pre-test-conditions-17 .H6}
##### System Simulator: {#system-simulator-17 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-17 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-17 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.9.3.2 Test procedure sequence {#test-procedure-sequence-17 .H6}
Table 6.1.1.9.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                       U - S              Message
1 Check: Does the UE (MCPTT client) correctly perform procedure \'MCX CT group
call establishment with manual commencemen\' as described in TS 36.579-1 [2]
Table 5.3.5.3-1? - - 1, 2 P 2-7 Void - - - - 8 The procedure \'MCX CT call
release\' as described in TS 36.579-1 [2] Table 5.3.12.3-1 is performed. - - -
- 9 Void - - - -
##### 6.1.1.9.3.3 Specific message contents {#specific-message-contents-17
.H6}
Table 6.1.1.9.3.3-1: SIP INVITE from the SS (step 1, Table 6.1.1.9.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition MANUAL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP as described in Table 6.1.1.9.3.3-1A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.9.3.3-2
Table 6.1.1.9.3.3-1A: SDP in SIP INVITE (Table 6.1.1.9.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition
INITIAL_SDP_OFFER
* * *
Table 6.1.1.9.3.3-2: MCPTT-Info in SIP INVITE (Table 6.1.1.9.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition GROUP-CALL,
BROADCAST-CALL
* * *
Table 6.1.1.9.3.3-3: Void
Table 6.1.1.9.3.3-4: SIP 200 (OK) from the UE (Step 1, Table 6.1.1.9.3.2-1;\
Step 7, TS 36.579-1 [2] Table 5.3.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP,
GROUP-CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP as described in Table 6.1.1.9.3.3-5  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.9.3.3-6
Table 6.1.1.9.3.3-5: SDP in SIP 200 (OK) (Table 6.1.1.9.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_ANSWER
* * *
Table 6.1.1.9.3.3-6: MCPTT-Info in SIP 200 (OK) (Table 6.1.1.9.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
6.1.1.10 On-network / Broadcast Group Call with Temporary Group / Client
Originated (CO)
##### 6.1.1.10.1 Test Purpose (TP) {#test-purpose-tp-18 .H6}
##### (1) {#section-74 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT On-demand
Pre-arranged Broadcast Group Call with Temporary Group }
**then** { UE (MCPTT Client) requests On-demand Pre-arranged Broadcast Group
Call by sending a SIP INVITE message and respects the floor control imposed by
the MCPTT Server }
}
##### 6.1.1.10.2 Conformance requirements {#conformance-requirements-18 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clause 4.12, 6.2.8.2 and 10.1.1.2.1.1, and TS 24.481
clause 6.3.14. Unless otherwise stated, these are Rel-13 requirements.
[TS 24.379, clause 4.12]
A broadcast group call is a group call where the initiating MCPTT user expects
no response from the other MCPTT users, so that when the user\'s transmission
is complete, so is the call. The functionality in the present release of the
specification for broadcast group calls is not compliant to the requirements
for user-broadcast group and group-broadcast group calls as specified in 3GPP
TS 22.179 [2], 3GPP TS 22.280 [76] and 3GPP TS 23.379 [3]. In the present
release of the specification, a broadcast group call can be initiated by an
MCPTT user on any MCPTT group that the MCPTT user is part of.
> NOTE 1: Configuration related to the authorisation to create a user-
> broadcast group or a group-broadcast exists in the user profile document as
> specified in 3GPP TS 24.484 [50], but is not used by any procedures in 3GPP
> TS 24.481 [31] in the current release, as the ability for an authorised user
> to create user-broadcast groups and group-broadcast groups is not provided
> in the current release.
>
> NOTE 2: Configuration related to broadcast group hierarchies can be found in
> the group document as specified in 3GPP TS 24.481 [31] and in the service
> configuration document as specified in 3GPP TS 24.484 [50]. However, this
> configuration is not used by any procedures in 3GPP TS 24.380 [5] in the
> current release.
[TS 24.379, clause 6.2.8.2]
> NOTE: This subclause is referenced from other procedures.
When the MCPTT user initiates a broadcast group call, the MCPTT client:
> 1) in the case of the prearranged group call is initiated on-demand, shall
> include in the application/vnd.3gpp.mcptt-info+xml MIME body the
> \ element set to \"true\" as defined in clause F.1; and
>
> 2) in the case the prearranged group call is initiated using a pre-
> established session, shall include in the application/vnd.3gpp.mcptt-
> info+xml MIME body in the \"body\" URI header field in the Refer-To header
> field the \ element set to \"true\" as defined in clause F.1.
[TS 24.379, clause 10.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT prearranged
group session the MCPTT client shall generate an initial SIP INVITE request by
following the UE originating session procedures specified in 3GPP TS 24.229
[4], with the clarifications given below.
The MCPTT client:
> ...
>
> 3) if the MCPTT user has requested the origination of a broadcast group
> call, the MCPTT client shall comply with the procedures in subclause
> 6.2.8.2;
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 8) should include the \"timer\" option tag in the Supported header field;
>
> 9) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the \"refresher\" header field parameter is
> omitted. If included, the \"refresher\" header field parameter shall be set
> to \"uac\";
>
> 10) shall set the Request-URI of the SIP INVITE request to the public
> service identity identifying the participating MCPTT function serving the
> MCPTT user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 11) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> ...
>
> 14) shall contain in an application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"prearranged\";
>
> b) the \ element set to the group identity;
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client; and
>
> NOTE 2: The MCPTT client does not include the MCPTT ID of the originating
> MCPTT user in the body, as this will be inserted into the body of the SIP
> INVITE request that is sent from the originating participating MCPTT
> function.
>
> d) if the group identity can be determined to be a TGI and if the MCPTT
> client can associate the TGI with a MCPTT group ID, the \ id> element set to the MCPTT group ID;
>
> NOTE 3: The text \"can associate the TGI with a MCPTT group ID\" means that
> the MCPTT client is able to determine that there is a constituent group of
> the temporary group that it is a member of.
>
> NOTE 4: The MCPTT client is informed about temporary groups and regrouping
> of MCPTT groups that the user is a member of as specified in 3GPP TS 24.481
> [31].
>
> NOTE 5: If the MCPTT user selected a TGI where there are several MCPTT
> groups where the MCPTT user is a member, the MCPTT client selects one of
> those MCPTT groups.
>
> 15) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.1;
>
> 16) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 17) shall send the SIP INVITE request towards the MCPTT server according to
> 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5] ;
>
> ...
>
> 3) may subscribe to the conference event package as specified in subclause
> 10.1.3.1.
...
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in subclause 6.2.8.1.13.
[TS 24.481, clause 6.3.14]
In order to form a temporary MCS group, a GMC shall send a HTTP POST request
according to procedures specified in IETF RFC 2616 [21] and subclause 6.2.3.
In the HTTP POST request, the GMC:
> a) shall set the Request-URI to an XCAP URI:
>
> 1) in users tree where the XUI is set to a group creation XUI configuration
> parameter; and
>
> 2) with the document selector identifying the temporary MCS group to be
> created; and
>
> b) shall include an application/vnd.3gpp.GMOP+xml MIME body containing a
> GMOP document requesting group regroup creation specified in subclause
> 7.3.4.3, with a \ element containing a group document for an MCS
> group. In the group document, the GMC shall include the \ temporary> element according to subclause 7.2. In the \ temporary> element, the GMC shall include \
> element according to subclause 7.2. In the \
> element, the GMC shall include one \ element
> according to subclause 7.2 for each MCS group to be combined.
Upon reception of an HTTP 2xx response to the sent HTTP POST request, the GMC
shall consider the temporary MCS group formation as successful.
Upon reception of an HTTP 409 (Conflict) response with at least one \ element in the \ error element, the GMC may repeat
procedures of the present subclause and identify the temporary MCS group being
formed with an MCS Group ID indicated in an \ element.
##### 6.1.1.10.3 Test description {#test-description-18 .H6}
##### 6.1.1.10.3.1 Pre-test conditions {#pre-test-conditions-18 .H6}
##### System Simulator: {#system-simulator-18 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-18 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-18 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- An MCPTT temporary group T has been created by performing procedure \'MCX
NW initiated temporary group creation\' as specified in TS 36.579-1 [2] clause
5.3.22.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.10.3.2 Test procedure sequence {#test-procedure-sequence-18 .H6}
Table 6.1.1.10.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | broadcast | | | | | | | group | | | | | | | call for | | | | | | | temporary | | | | | | | group T | | | | | | | with | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.1.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a | | | | | | | broadcast | | | | | | | group | | | | | | | call for | | | | | | | temporary | | | | | | | group T | | | | | | | with | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.iii of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3A.1.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3-5 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 5A | The SS | \ | Floor Ack | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor Ack | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | The | - | - | - | - | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.12.3-1 | | | | | | | is | | | | | | | p | | | | | | | erformed. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 6.1.1.10.3.3 Specific message contents {#specific-message-contents-18
.H6}
Table 6.1.1.10.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.1.10.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.1.1.10.3.3-1A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.10.3.3-2
Table 6.1.1.10.3.3-1A: SDP in SIP INVITE (Table 6.1.1.10.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
INITIAL_SDP_OFFER, IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.1.10.3.3-2: MCPTT-Info in SIP INVITE (Table 6.1.1.10.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL,
INVITE_REFER, BROADCAST-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri px_MCPTT_Group_T_ID  
associated-group-id px_MCPTT_Group_A_ID
Table 6.1.1.10.3.3-3: Void
Table 6.1.1.10.3.3-3A: SIP 200 (OK) from the SS (step 2, Table
6.1.1.10.3.2-1;\ step 4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.1.1.10.3.3-3B
Table 6.1.1.10.3.3-3B: SDP in SIP 200 (OK) (Table 6.1.1.10.3.3-3A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER
* * *
Table 6.1.1.10.3.3-4: Floor Taken (step 5A, Table 6.1.1.10.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.7-1, condition ACK
* * *
Table 6.1.1.10.3.3-5: Void
Table 6.1.1.10.3.3-6: SIP BYE from the SS (step 6, Table 6.1.1.10.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3.12.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1, condition MO_CALL
* * *
6.1.1.11 On-network / Pre-arranged Emergency Group Call / Client Originated
(CO)
##### 6.1.1.11.1 Test Purpose (TP) {#test-purpose-tp-19 .H6}
##### (1) {#section-75 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT On-demand
Pre-arranged Emergency Group Call }
**then** { UE (MCPTT Client) requests On-demand Pre-arranged Emergency Group
Call by sending a SIP INVITE message **and** responds to the SS with correct
SIP messages }
}
##### 6.1.1.11.2 Conformance requirements {#conformance-requirements-19 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clause 6.2.8.1.1 and 10.1.1.2.1.1. Unless otherwise
stated, these are Rel-13 requirements.
[TS 24.379, clause 6.2.8.1.1]
When the MCPTT emergency state is set and the MCPTT user is authorised to
initiate an MCPTT emergency group call on the targeted MCPTT group as
determined by the procedures of subclause 6.2.8.1.8, the MCPTT client:
> 1) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the
> SIP INVITE request or SIP REFER request, an \ element set to
> \"true\";
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 1: emergency-gc-
> capable\", shall set the MCPTT emergency group call state to \"MEGC 2:
> emergency-call-requested\";
>
> 3) if the MCPTT user has also requested an MCPTT emergency alert to be sent
> and this is an authorised request for MCPTT emergency alert as determined by
> the procedures of subclause 6.2.8.1.6, and the MCPTT emergency alert state
> is set to \"MEA 1: no-alert\", shall:
>
> a) set the \ element of the application/vnd.3gpp.mcptt-info+xml
> MIME body to \"true\" and set the MCPTT emergency alert state to \"MEA 2:
> emergency-alert-confirm-pending\"; and
>
> b) include in the SIP INVITE request the specific location information for
> MCPTT emergency alert as specified in subclause 6.2.9.1;
>
> 4) if the MCPTT user has not requested an MCPTT emergency alert to be sent
> and the MCPTT emergency alert state is set to \"MEA 1: no-alert\", shall set
> the \ element of the application/vnd.3gpp.mcptt-info+xml MIME
> body to \"false\"; and
>
> 5) if the MCPTT client emergency group state of the group is set to a value
> other than \"MEG 2: in-progress\" set the MCPTT client emergency group state
> of the MCPTT group to \"MEG 4: confirm-pending\".
>
> NOTE 1: This is the case of an MCPTT user already being in the MCPTT
> emergency state it initiated previously while originating an MCPTT emergency
> group call or MCPTT emergency alert. All group calls the MCPTT user
> originates while in MCPTT emergency state will be MCPTT emergency group
> calls.
When the MCPTT emergency state is clear and the MCPTT emergency group call
state is set to \"MEGC 1: emergency-gc-capable\" and the the MCPTT user is
authorised to initiate an MCPTT emergency group call on the targetted MCPTT
group as determined by the procedures of subclause 6.2.8.1.8, the MCPTT
client:
> 1) shall set the MCPTT emergency state;
>
> 2) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the
> SIP INVITE request or SIP REFER request an \ element set to
> \"true\" and set the MCPTT emergency group call state to \"MEGC 2:
> emergency-call-requested\" state;
>
> 3) if the MCPTT user has also requested an MCPTT emergency alert to be sent
> and this is an authorised request for MCPTT emergency alert as determined by
> the procedures of subclause 6.2.8.1.6, shall:
>
> a) include in the application/vnd.3gpp.mcptt-info+xml MIME body the \ ind> element set to \"true\" and set the MCPTT emergency alert state to
> \"MEA 2: emergency-alert-confirm-pending\"; and
>
> b) include in the SIP INVITE request the specific location information for
> MCPTT emergency alert as specified in subclause 6.2.9.1;
>
> 4) if the MCPTT user has not requested an MCPTT emergency alert to be sent,
> shall set the \ element of the application/vnd.3gpp.mcptt-
> info+xml MIME body to \"false\"; and
>
> 5) if the MCPTT client emergency group state of the group is set to a value
> other than \"MEG 2: in-progress\" shall set the MCPTT client emergency group
> state of the MCPTT group to \"MEG 4: confirm-pending\".
>
> NOTE 2: This is the case of an initial MCPTT emergency group call and
> optionally an MCPTT emergency alert being sent. As the MCPTT emergency state
> is not sent, there is no MCPTT emergency alert outstanding.
>
> NOTE 3: An MCPTT group call originated by an affiliated member of an MCPTT
> group which is in an in-progress emergency state (as tracked on the MCPTT
> client by the MCPTT client emergency group state) but is not in an MCPTT
> emergency state of their own will also be an MCPTT emergency group call. The
> \ and \ elements of the
> application/vnd.3gpp.mcptt-info+xml MIME body do not need to be included in
> this case and hence no action needs to be taken in this subclause.
[TS 24.379, clause 10.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT prearranged
group session the MCPTT client shall generate an initial SIP INVITE request by
following the UE originating session procedures specified in 3GPP TS 24.229
[4], with the clarifications given below.
The MCPTT client:
> 1) if the MCPTT user has requested the origination of an MCPTT emergency
> group call or is originating an MCPTT prearranged group call and the MCPTT
> emergency state is already set, the MCPTT client shall comply with the
> procedures in subclause 6.2.8.1.1;
>
> ...
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 8) should include the \"timer\" option tag in the Supported header field;
>
> 9) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the \"refresher\" header field parameter is
> omitted. If included, the \"refresher\" header field parameter shall be set
> to \"uac\";
>
> 10) shall set the Request-URI of the SIP INVITE request to the public
> service identity identifying the participating MCPTT function serving the
> MCPTT user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 11) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> 12) if the MCPTT client emergency group state for this group is set to \"MEG
> 2: in-progress\" or \"MEG 4: confirm-pending\", the MCPTT client shall
> include the Resource-Priority header field and comply with the procedures in
> subclause 6.2.8.1.2;
>
> ...
>
> 14) shall contain in an application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"prearranged\";
>
> b) the \ element set to the group identity;
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client; and
>
> NOTE 2: The MCPTT client does not include the MCPTT ID of the originating
> MCPTT user in the body, as this will be inserted into the body of the SIP
> INVITE request that is sent from the originating participating MCPTT
> function.
>
> d) if the group identity can be determined to be a TGI and if the MCPTT
> client can associate the TGI with a MCPTT group ID, the \ id> element set to the MCPTT group ID;
>
> NOTE 3: The text \"can associate the TGI with a MCPTT group ID\" means that
> the MCPTT client is able to determine that there is a constituent group of
> the temporary group that it is a member of.
>
> NOTE 4: The MCPTT client is informed about temporary groups and regrouping
> of MCPTT groups that the user is a member of as specified in 3GPP TS 24.481
> [31].
>
> NOTE 5: If the MCPTT user selected a TGI where there are several MCPTT
> groups where the MCPTT user is a member, the MCPTT client selects one of
> those MCPTT groups.
>
> 15) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.1;
>
> 16) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 17) shall send the SIP INVITE request towards the MCPTT server according to
> 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5] ;
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in subclause 6.2.8.1.4; and
>
> 3) may subscribe to the conference event package as specified in subclause
> 10.1.3.1.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request:
> 1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\"; or
>
> ...
the MCPTT client shall perform the actions specified in subclause 6.2.8.1.5.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in subclause 6.2.8.1.13.
##### 6.1.1.11.3 Test description {#test-description-19 .H6}
##### 6.1.1.11.3.1 Pre-test conditions {#pre-test-conditions-19 .H6}
##### System Simulator: {#system-simulator-19 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-19 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-19 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.11.3.2 Test procedure sequence {#test-procedure-sequence-19 .H6}
Table 6.1.1.11.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a | | | | | | | emergency | | | | | | | group call | | | | | | | with | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3A.1.3-1 | | | | | | | to**| | | | | | | establish | | | | | | | an | | | | | | | emergency | | | | | | | group call | | | | | | | according | | | | | | | to option | | | | | | | b.i of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | |** 5.3 | | | | | | | A.1.3-1**? | | | | | +------------+------------+------------+---------+---------+----+ | 3-5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 5A | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the call | | | | | | | has been | | | | | | | es | | | | | | | tablished? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 6 | The | - | - | - | - | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3.12.3-1 | | | | | | | is | | | | | | | pe | | | | | | | rformed.** | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.1.11.3.3 Specific message contents {#specific-message-contents-19
.H6}
Table 6.1.1.11.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.1.11.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition EMERGENCY-CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.1.1.11.3.3-1A  
MIME body part MCPTT-Info  
MIME-part-body MCPTT-Info as described in Table 6.1.1.11.3.3-2
Table 6.1.1.11.3.3-1A: SDP in SIP INVITE (Table 6.1.1.10.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
INITIAL_SDP_OFFER, IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.1.11.3.3-2: MCPTT-Info in SIP INVITE (Table 6.1.1.11.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL,
INVITE_REFER, EMERGENCY-CALL
* * *
Table 6.1.1.11.3.3-2A: SIP 200 (OK) from the SS (step 2, Table
6.1.1.11.3.2-1;\ step 4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition Message-body  
SDP Message As described in Table 6.1.1.11.3.3-2B
Table 6.1.1.11.3.3-2B: SDP in SIP 200 (OK) (Table 6.1.1.11.3.3-2A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
IMPLICIT_FLOOR_GRANTED, IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.1.11.3.3-3: Void
Table 6.1.1.11.3.3-4: SIP BYE from the SS (step 6, Table 6.1.1.11.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3.12.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1, condition MO_CALL
* * *
6.1.1.12 On-network / Pre-arranged Emergency Group Call / Client Terminated
(CT)
##### 6.1.1.12.1 Test Purpose (TP) {#test-purpose-tp-20 .H6}
##### (1) {#section-76 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT Client receives a SIP INVITE message with a emergency
indication of an MCPTT On-demand Pre-arranged emergency Group Call }
**then** { the MCPTT Client displays an indication for the Pre-arranged MCPTT
emergency group call to the user **and** responds to the SS with correct SIP
messages }
}
##### (2) {#section-77 .H6}
**with** { UE (MCPTT Client) having an incoming Pre-arranged MCPTT emergency
group call **and** the Answer-Mode header in the SIP INVITE message is set to
Manual }
ensure that {
**when** { the user answers the MCPTT emergency group call }
**then** { UE sends a SIP 200 OK as a response to the SIP INVITE message }
}
##### 6.1.1.12.2 Conformance requirements {#conformance-requirements-20 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clauses 4.12, 6.2.8.2 and 10.1.1.2.1.2. Unless
otherwise stated, these are Rel-13 requirements.
[TS 24.379, clause 4.12]
A broadcast group call is a group call where the initiating MCPTT user expects
no response from the other MCPTT users, so that when the user\'s transmission
is complete, so is the call. The functionality in the present release of the
specification for broadcast group calls is not compliant to the requirements
for user-broadcast group and group-broadcast group calls as specified in 3GPP
TS 22.179 [2], 3GPP TS 22.280 [76] and 3GPP TS 23.379 [3]. In the present
release of the specification, a broadcast group call can be initiated by an
MCPTT user on any MCPTT group that the MCPTT user is part of.
> NOTE 1: Configuration related to the authorisation to create a user-
> broadcast group or a group-broadcast exists in the user profile document as
> specified in 3GPP TS 24.484 [50], but is not used by any procedures in 3GPP
> TS 24.481 [31] in the current release, as the ability for an authorised user
> to create user-broadcast groups and group-broadcast groups is not provided
> in the current release.
>
> NOTE 2: Configuration related to broadcast group hierarchies can be found in
> the group document as specified in 3GPP TS 24.481 [31] and in the service
> configuration document as specified in 3GPP TS 24.484 [50]. However, this
> configuration is not used by any procedures in 3GPP TS 24.380 [5] in the
> current release.
[TS 24.379, clause 6.2.8.2]
> NOTE: This subclause is referenced from other procedures.
When the MCPTT user initiates a broadcast group call, the MCPTT client:
> 1) in the case of the prearranged group call is initiated on-demand, shall
> include in the application/vnd.3gpp.mcptt-info+xml MIME body the
> \ element set to \"true\" as defined in clause F.1; and
>
> 2) in the case the prearranged group call is initiated using a pre-
> established session, shall include in the application/vnd.3gpp.mcptt-
> info+xml MIME body in the \"body\" URI header field in the Refer-To header
> field the \ element set to \"true\" as defined in clause F.1.
[TS 24.379, clause 10.1.1.2.1.2]
In the procedures in this subclause:
> 1) emergency indication in an incoming SIP INVITE request refers to the
> \ element of the application/vnd.3gpp.mcptt-info+xml MIME
> body; and
>
> ...
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> ...
>
> 4) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
> MIME body with the \ element containing the \
> element with the \ element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication that this is a SIP INVITE
> request for an MCPTT emergency group call and:
>
> i) should display the MCPTT ID of the originator of the MCPTT emergency
> group call contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body;
>
> ii) should display the MCPTT group identity of the group with the emergency
> condition contained in the \ element; and
>
> iii) if the \ element is set to \"true\", should display to the
> MCPTT user an indication of the MCPTT emergency alert and associated
> information;
>
> b) shall set the MCPTT emergency group state to \"MEG 2: in-progress\";
>
> ...
>
> 6) may display to the MCPTT user the MCPTT ID of the inviting MCPTT user;
>
> ...
>
> 8) shall perform the manual commencement procedures specified in subclause
> 6.2.3.2.2 if one of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is to use manual commencement mode; or
>
> b) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to automatic commencement mode, yet the invited
> MCPTT client allows the call to be answered with manual commencement mode;
> and
>
> 9) when the SIP 200 (OK) response to the SIP INVITE request is sent, may
> subscribe to the conference event package as specified in subclause
> 10.1.3.1.
##### 6.1.1.12.3 Test description {#test-description-20 .H6}
##### 6.1.1.12.3.1 Pre-test conditions {#pre-test-conditions-20 .H6}
##### System Simulator: {#system-simulator-20 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-20 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-20 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.12.3.2 Test procedure sequence {#test-procedure-sequence-20 .H6}
Table 6.1.1.12.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1, 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | group call | | | | | | | est | | | | | | | ablishment | | | | | | | with | | | | | | | manual | | | | | | | comm | | | | | | | encement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.5.3-1 | | | | | | | to | | | | | | | establish | | | | | | | an | | | | | | | emergency | | | | | | | group call | | | | | | | with | | | | | | | manual | | | | | | | co | | | | | | | mmencement | | | | | | | mode? | | | | | +------------+------------+------------+---------+---------+----+ | 1A-7A | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 7B | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the | | | | | | | emergency | | | | | | | group call | | | | | | | has been | | | | | | | es | | | | | | | tablished? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 8 | The | - | - | - | - | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.12.3-1 | | | | | | | is | | | | | | | performed | | | | | | | to release | | | | | | | the call. | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.1.12.3.3 Specific message contents {#specific-message-contents-20
.H6}
Table 6.1.1.12.3.3-1: SIP INVITE from the SS (step 1, Table 6.1.1.12.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition MANUAL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP as described in Table 6.1.1.12.3.3-1A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.12.3.3-2
Table 6.1.1.12.3.3-1A: SDP in SIP INVITE (Table 6.1.1.12.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition
INITIAL_SDP_OFFER
* * *
Table 6.1.1.12.3.3-2: MCPTT-Info in SIP INVITE (Table 6.1.1.12.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition GROUP-CALL,
EMERGENCY-CALL
* * *
Table 6.1.1.12.3.3-3: Void
Table 6.1.1.12.3.3-4: SIP 200 (OK) from the UE (step 1, Table 6.1.1.12.3.2-1;\
step 7, TS 36.579-1 [2] Table 5.3.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP,
GROUP-CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP as described in Table 6.1.1.12.3.3-5  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.12.3.3-6
Table 6.1.1.12.3.3-5: SDP in SIP 200 (OK) (Table 6.1.1.12.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_ANSWER
* * *
Table 6.1.1.12.3.3-6: MCPTT-Info in SIP 200 (OK) (Table 6.1.1.12.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
6.1.1.13 On-network / Pre-arranged Imminent Peril Group Call / Client
Originated (CO)
##### 6.1.1.13.1 Test Purpose (TP) {#test-purpose-tp-21 .H6}
##### (1) {#section-78 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT On-demand
Pre-arranged Imminent Peril Group Call }
**then** { UE (MCPTT Client) sends a SIP INVITE message to setup the Imminent
Peril Group Call }
}
##### 6.1.1.13.2 Conformance requirements {#conformance-requirements-21 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clause 10.1.1.2.1.1. Unless otherwise stated, these
are Rel-13 requirements.
[TS 24.379, clause 10.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT prearranged
group session the MCPTT client shall generate an initial SIP INVITE request by
following the UE originating session procedures specified in 3GPP TS 24.229
[4], with the clarifications given below.
The MCPTT client:
> ...
>
> 2) if the MCPTT user has requested the origination of an MCPTT imminent
> peril group call, the MCPTT client shall comply with the procedures in
> subclause 6.2.8.1.9;
>
> ...
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 8) should include the \"timer\" option tag in the Supported header field;
>
> 9) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the \"refresher\" header field parameter is
> omitted. If included, the \"refresher\" header field parameter shall be set
> to \"uac\";
>
> 10) shall set the Request-URI of the SIP INVITE request to the public
> service identity identifying the participating MCPTT function serving the
> MCPTT user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 11) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> ...
>
> 13) if the MCPTT client imminent peril group state for this group is set to
> \"MIG 2: in-progress\" or \"MIG 3: confirm-pending\" shall include the
> Resource-Priority header field and comply with the procedures in subclause
> 6.2.8.1.12;
>
> 14) shall contain in an application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"prearranged\";
>
> b) the \ element set to the group identity;
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client; and
>
> NOTE 2: The MCPTT client does not include the MCPTT ID of the originating
> MCPTT user in the body, as this will be inserted into the body of the SIP
> INVITE request that is sent from the originating participating MCPTT
> function.
>
> d) if the group identity can be determined to be a TGI and if the MCPTT
> client can associate the TGI with a MCPTT group ID, the \ id> element set to the MCPTT group ID;
>
> NOTE 3: The text \"can associate the TGI with a MCPTT group ID\" means that
> the MCPTT client is able to determine that there is a constituent group of
> the temporary group that it is a member of.
>
> NOTE 4: The MCPTT client is informed about temporary groups and regrouping
> of MCPTT groups that the user is a member of as specified in 3GPP TS 24.481
> [31].
>
> NOTE 5: If the MCPTT user selected a TGI where there are several MCPTT
> groups where the MCPTT user is a member, the MCPTT client selects one of
> those MCPTT groups.
>
> 15) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.1;
>
> 16) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 17) shall send the SIP INVITE request towards the MCPTT server according to
> 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5] ;
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in subclause 6.2.8.1.4; and
>
> 3) may subscribe to the conference event package as specified in subclause
> 10.1.3.1.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request:
> ...
>
> 2) if the MCPTT imminent peril group call state is set to \"MIGC 2:
> imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";
>
> the MCPTT client shall perform the actions specified in subclause 6.2.8.1.5.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in subclause 6.2.8.1.13.
##### 6.1.1.13.3 Test description {#test-description-21 .H6}
##### 6.1.1.13.3.1 Pre-test conditions {#pre-test-conditions-21 .H6}
##### System Simulator: {#system-simulator-21 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-21 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-21 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.13.3.2 Test procedure sequence {#test-procedure-sequence-21 .H6}
Table 6.1.1.13.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a | | | | | | | imminent | | | | | | | peril | | | | | | | group call | | | | | | | with | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3A.1.3-1 | | | | | | | to**| | | | | | | establish | | | | | | | an | | | | | | | imminent | | | | | | | peril | | | | | | | group call | | | | | | | with | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.i of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | |** 5.3 | | | | | | | A.1.3-1**? | | | | | +------------+------------+------------+---------+---------+----+ | 3-5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 5A | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the call | | | | | | | has been | | | | | | | e | | | | | | | stablished | | | | | | | and the | | | | | | | floor has | | | | | | | been | | | | | | | granted to | | | | | | | the user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 6 | The | - | - | - | - | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3.12.3-1 | | | | | | | is | | | | | | | pe | | | | | | | rformed.** | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.1.13.3.3 Specific message contents {#specific-message-contents-21
.H6}
Table 6.1.1.13.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.1.13.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition IMMPERIL-CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.1.1.13.3.3-1A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.13.3.3-2
Table 6.1.1.13.3.3-1A: SDP in SIP INVITE (Table 6.1.1.13.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
INITIAL_SDP_OFFER, IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.1.13.3.3-2: MCPTT-Info in SIP INVITE (Table 6.1.1.13.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition IMMPERIL-CALL,
INVITE_REFER, GROUP-CALL
* * *
Table 6.1.1.13.3.3-2A: SIP 200 (OK) from the SS (step 2, Table
6.1.1.13.3.2-1;\ step 4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition Message-body  
SDP Message As described in Table 6.1.1.10.3.3-2B
Table 6.1.1.13.3.3-2B: SDP in SIP 200 (OK) (Table 6.1.1.13.3.3-2A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
IMPLICIT_FLOOR_GRANTED, IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.1.13.3.3-3: Void
Table 6.1.1.13.3.3-4: SIP BYE from the SS (step 6, Table 6.1.1.13.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3.12.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1, condition MO_CALL
* * *
6.1.1.14 On-network / Pre-Arranged Imminent Peril Group Call / Client
Terminated (CT)
##### 6.1.1.14.1 Test Purpose (TP) {#test-purpose-tp-22 .H6}
##### (1) {#section-79 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT Client receives a SIP INVITE message of an MCPTT On-
demand Pre-arranged Imminent Peril Group Call }
**then** { the MCPTT Client displays an indication for the Pre-arranged MCPTT
imminent peril group call to the user **and** responds to the SS with correct
SIP messages }
}
##### (2) {#section-80 .H6}
**with** { UE (MCPTT Client) having an incoming Pre-arranged MCPTT imminent
peril group call **and** the Answer-Mode header in the SIP INVITE message is
set to Manual }
ensure that {
**when** { the user answers the MCPTT imminent peril group call }
**then** { UE sends a SIP 200 OK as a response to the SIP INVITE message }
}
##### 6.1.1.14.2 Conformance requirements {#conformance-requirements-22 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clause 10.1.1.2.1.2. Unless otherwise stated, these
are Rel-13 requirements.
[TS 24.379, clause 10.1.1.2.1.2]
In the procedures in this subclause:
> ...
>
> 2) imminent peril indication in an incoming SIP INVITE request refers to the
> \ element of the application/vnd.3gpp.mcptt-info+xml MIME
> body.
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> ...
>
> 5) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
> MIME body with the \ element containing the \
> element with the \ element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication that this is a SIP INVITE
> request for an MCPTT imminent peril group call and:
>
> i) should display the MCPTT ID of the originator of the MCPTT imminent peril
> group call contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> ii) should display the MCPTT group identity of the group with the imminent
> peril condition contained in the \ element; and
>
> b) shall set the MCPTT imminent peril group state to \"MIG 2: in-progress\";
>
> 6) may display to the MCPTT user the MCPTT ID of the inviting MCPTT user;
>
> 7) shall perform the automatic commencement procedures specified in
> subclause 6.2.3.1.2 if one of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Auto\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to automatic commencement mode; or
>
> b) SIP INVITE request contains an Answer-Mode header field with the value
> \"Auto\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to manual commencement mode, yet the invited MCPTT
> client allows the call to be answered with automatic commencement mode;
>
> 8) shall perform the manual commencement procedures specified in subclause
> 6.2.3.2.2 if one of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is to use manual commencement mode; or
>
> b) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to automatic commencement mode, yet the invited
> MCPTT client allows the call to be answered with manual commencement mode;
> and
>
> 9) when the SIP 200 (OK) response to the SIP INVITE request is sent, may
> subscribe to the conference event package as specified in subclause
> 10.1.3.1.
##### 6.1.1.14.3 Test description {#test-description-22 .H6}
##### 6.1.1.14.3.1 Pre-test conditions {#pre-test-conditions-22 .H6}
##### System Simulator: {#system-simulator-22 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-22 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-22 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.14.3.2 Test procedure sequence {#test-procedure-sequence-22 .H6}
Table 6.1.1.14.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1, 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | group call | | | | | | | est | | | | | | | ablishment | | | | | | | with | | | | | | | manual | | | | | | | comm | | | | | | | encement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.5.3-1 | | | | | | | to | | | | | | | establish | | | | | | | an | | | | | | | imminent | | | | | | | peril | | | | | | | group call | | | | | | | with | | | | | | | manual | | | | | | | co | | | | | | | mmencement | | | | | | | mode? | | | | | +------------+------------+------------+---------+---------+----+ | 2-7A | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 7B | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the | | | | | | | imminent | | | | | | | peril | | | | | | | group call | | | | | | | has been | | | | | | | es | | | | | | | tablished? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 8 | The | - | - | - | - | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.12.3-1 | | | | | | | is | | | | | | | performed. | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.1.14.3.3 Specific message contents {#specific-message-contents-22
.H6}
Table 6.1.1.14.3.3-1: SIP INVITE from the SS (step 1, Table 6.1.1.14.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition MANUAL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP as described in Table 6.1.1.14.3.3-1A  
MIME body part **MCPTT-Info**  
**MIME part body** MCPTT-Info as described in Table 6.1.1.14.3.3-2
Table 6.1.1.14.3.3-1A: SDP in SIP INVITE (Table 6.1.1.14.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition
INITIAL_SDP_OFFER
* * *
Table 6.1.1.14.3.3-2: MCPTT-Info in SIP INVITE (Table 6.1.1.14.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition GROUP-CALL,
IMMPERIL-CALL
* * *
Table 6.1.1.14.3.3-3: SIP 200 (OK) from the UE (Step 1, Table 6.1.1.14.3.2-1;\
Step 7, TS 36.579-1 [2] Table 5.3.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP,
GROUP-CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP as described in Table 6.1.1.14.3.3-4  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.14.3.3-5
Table 6.1.1.14.3.3-4: SDP in SIP 200 (OK) (Table 6.1.1.14.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_ANSWER
* * *
Table 6.1.1.14.3.3-5: MCPTT-Info in SIP 200 (OK) (Table 6.1.1.14.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
6.1.1.15 On-network / Emergency Alert / Cancel Emergency Alert / Client
Originated (CO)
##### 6.1.1.15.1 Test Purpose (TP) {#test-purpose-tp-23 .H6}
##### (1) {#section-81 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate an emergency alert }
**ensure that** {\ **when** { the MCPTT User requests to send an emergency
alert with the location of emergency }
**then** { UE (MCPTT Client) sends a SIP MESSAGE initiating an emergency alert
**and** reporting location information }
}
##### (2) {#section-82 .H6}
**with** { UE (MCPTT Client) in the "MEA3: emergency-alert-initiated" state}
ensure that {
**when** { the MCPTT User requests to cancel the emergency alert}
**then** { UE (MCPTT Client) sends a SIP MESSAGE requesting the cancelation of
the emergency alert}
}
##### 6.1.1.15.2 Conformance requirements {#conformance-requirements-23 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379, clauses 12.1.1.1, 12.1.1.2. The following represents
a copy/paste extraction of the requirements relevant to the test purpose; any
references within the copy/paste text should be understood within the scope of
the core spec they have been copied from. Unless otherwise stated, these are
Rel-14 requirements.
[TS 24.379 clause 6.2.9.1]
This procedure is initiated by the MCPTT client when it is including location
report information:
> 1) as part of a SIP request containing an MCPTT emergency alert; or
>
> 2) as part of a SIP request for a specified location trigger.
The MCPTT client:
> 1) if location information is being included as part of a SIP request for a
> specified location trigger criteria as configured in a \
> element contained in a \ element contained in an
> application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in Annex
> F.3 as received in a SIP MESSAGE request by the procedures of subclause
> 13.3.2:
>
> a) shall include in the SIP request the specific location information as
> specified by the procedures of subclause 13.3.4.2; and
>
> b) shall skip the rest of the steps;
>
> 2) if location information is being included as part of a SIP request
> containing an MCPTT emergency alert:
>
> a) shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body
> as specified in Annex F.3 with a \ element included in the
> \ root element;
>
> b) shall set the \ element of the \ element to a value
> of \"Emergency\";
>
> c) if the MCPTT client has been configured with an
> \ element contained in a \
> element contained in an application/vnd.3gpp.mcptt-location-info+xml MIME
> body as specified in Annex F.3 and received in a SIP MESSAGE request by the
> procedures of subclause 13.3.2;
>
> i) shall populate the \ element of the \ element as
> indicated by the \ element contained in the
> \ element contained in an application/vnd.3gpp.mcptt-
> location-info+xml MIME body as specified in Annex F.3 and previously
> received by the procedures of subclause 13.3.2; and
>
> ii) shall skip the rest of the steps; and
>
> d) if the MCPTT client has not been configured with an
> \ element contained in a \
> element contained in an application/vnd.3gpp.mcptt-location-info+xml MIME
> body as specified in Annex F.3 and received in a SIP MESSAGE request by the
> procedures of subclause 13.3.2:
>
> i) shall include in the \ element of the \ element
> of the application/vnd.3gpp.mcptt-location-info+xml MIME body a
> \ element populated as specified in Annex F.3.3.
>
> NOTE: According to local policy, additional location information elements
> specified in Annex F.3.3 can be included in the \ element
> in the event that no \ element was previously
> received.
[TS 24.379 clause 12.1.1.1]
Upon receiving a request from the MCPTT user to send an MCPTT emergency alert
to the indicated MCPTT group and this is an authorised request for an MCPTT
emergency alert as determined by subclause 6.2.8.1.6, the MCPTT client shall
generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF
RFC 3428 [33] with the clarifications given below.
> NOTE 1: this SIP MESSAGE request is assumed to be sent out-of-dialog.
The MCPTT client:
> 1) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP MESSAGE request;
>
> 2) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 3) may include a P-Preferred-Identity header field in the SIP MESSAGE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> 4) shall include an application/vnd.3gpp.mcptt-info+xml MIME body as
> specified in clause F.1 with the \ element containing the
> \ element with:
>
> a) the \ element set to the group identity;
>
> b) the \ element set to a value of \"true\"; and
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client;
>
> 5) shall include in the SIP MESSAGE request the specific location
> information for MCPTT emergency alert as specified in subclause 6.2.9.1;
>
> 6) shall set the MCPTT emergency state if not already set;
>
> 7) shall set the MCPTT emergency alert state to \"MEA 2: emergency-alert-
> confirm-pending\";
>
> 8) shall set the Request-URI to the public service identity identifying the
> participating MCPTT function serving the group identity; and
>
> 9) shall send the SIP MESSAGE request according to rules and procedures of
> 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP MESSAGE request, the MCPTT client
shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-
initiated\".
On receiving a SIP 4xx response a SIP 5xx response or a SIP 6xx response to
the SIP MESSAGE request, the MCPTT client shall set the MCPTT emergency alert
state to \"MEA 1: no-alert\".
> NOTE 2: the MCPTT emergency state is left set in this case as the MCPTT user
> presumably is in the best position to determine whether or not they are in a
> life-threatening condition. The assumption is that the MCPTT user can clear
> the MCPTT emergency state manually if need be.
[TS 24.379 clause 12.1.1.2]
Upon receiving a request from the MCPTT user to send an MCPTT emergency alert
cancellation to the indicated MCPTT group and this is an authorised request
for an MCPTT emergency alert cancellation as determined by subclause
6.2.8.1.6, the MCPTT client shall generate a SIP MESSAGE request in accordance
with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the clarifications given
below.
> NOTE 1: This SIP MESSAGE request is assumed to be sent out-of-dialog.
The MCPTT client:
> 1) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP MESSAGE request;
>
> 2) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 3) may include a P-Preferred-Identity header field in the SIP MESSAGE
> request containing the public user identity of the originator as specified
> in 3GPP TS 24.229 [4];
>
> 4) shall include an application/vnd.3gpp.mcptt-info+xml MIME body as
> specified in clause F.1 with the \ element containing the
> \ element with:
>
> a) the \ element set to the MCPTT group identity;
>
> b) the \ element set to a value of \"false\"; and
>
> c) if the MCPTT user is cancelling an MCPTT emergency alert originated by
> another MCPTT user, include the \ element set to the MCPTT ID
> of the MCPTT user who originated the MCPTT emergency alert;
>
> 5) if the MCPTT user has additionally requested the cancellation of the in-
> progress emergency state of the MCPTT group and this is an authorised
> request for an in-progress emergency group state cancellation as determined
> by subclause 6.2.8.1.7, shall include an \ element set to a
> value of \"false\" in the \ element containing the \ Params> element;
>
> 6) shall set the Request-URI to the public service identity identifying the
> participating MCPTT function serving the group identity;
>
> 7) if the generated SIP MESSAGE request does not contain an \
> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall set the
> MCPTT emergency alert state to \"MEA 4: Emergency-alert-cancel-pending\";
> and
>
> 8) shall send the SIP MESSAGE request according to rules and procedures of
> 3GPP TS 24.229 [4].
On receipt of a SIP MESSAGE request containing an application/vnd.3gpp.mcptt-
info+xml MIME body with an \ element set to true and an
\ matching the MCPTT client ID included in the sent SIP
MESSAGE request:
> 1) if the \ element is set to a value of \"false\" in the
> application/vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE
> request and the sent SIP MESSAGE request did not contain an \
> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall:
>
> a) set the MCPTT emergency alert state to \"MEA 1: no-alert\"; and
>
> b) clear the MCPTT emergency state if not already cleared;
>
> 2) if the \ element in the application/vnd.3gpp.mcptt-info+xml
> MIME body of the received SIP MESSAGE request is set to a value of \"true\"
> and if the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-
> cancel-pending\" and the sent SIP MESSAGE request did not contain an
> \ element in the application/vnd.3gpp.mcptt-info+xml MIME
> body, shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-
> initiated\"; and
>
> NOTE 2: It would appear to be an unusual situation for the initiator of an
> MCPTT emergency alert to not be able to clear their own alert. Nevertheless,
> an MCPTT user can be configured to be authorised to initiate MCPTT emergency
> alerts but not have the authority to clear them. Hence, the case is covered
> here.
>
> 3) if an \ element is present in the
> application/vnd.3gpp.mcptt-info+xml MIME body of received SIP MESSAGE
> request and is set to a value of \"false\":
>
> a) shall set the MCPTT emergency group call state of the group to \"MEGC 1:
> emergency-gc-capable\"; and
>
> b) shall set the MCPTT emergency group state of the group to \"MEG 1: no-
> emergency\".
>
> NOTE 3: The case where an \ element is set to true is
> possible but not handled specifically above as it results in no state
> changes.
On receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the
sent SIP MESSAGE request:
> 1) if the received SIP 4xx response, SIP 5xx response or SIP 6xx response
> contains an application/vnd.3gpp.mcptt-info+xml MIME body as specified in
> clause F.1 with the \ element containing the \
> element with the \ element set to a value of \"true\", the sent
> SIP MESSAGE request did not contain an \ element in the
> application/vnd.3gpp.mcptt-info+xml MIME body and the MCPTT emergency alert
> state is set to \"MEA 4: Emergency-alert-cancel-pending\", shall set the
> MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated\"; and
>
> NOTE 4: In this case, an \ element would either not be
> present or would be set to true. In either case, no change in state would
> result. Hence, this case is not specified above.
>
> 2) if the received SIP 4xx response, SIP 5xx response or a SIP 6xx response
> to the SIP MESSAGE request does not contain an application/vnd.3gpp.mcptt-
> info+xml MIME body with an \ element, the sent SIP MESSAGE
> request does not contain an \ element in the
> application/vnd.3gpp.mcptt-info+xml MIME body and the MCPTT emergency alert
> state is set to \"MEA 4: Emergency-alert-cancel-pending\", shall set the
> MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated\".
##### 6.1.1.15.3 Test description {#test-description-23 .H6}
##### 6.1.1.15.3.1 Pre-test conditions {#pre-test-conditions-23 .H6}
##### System Simulator: {#system-simulator-23 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-23 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-23 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.15.3.2 Test procedure sequence {#test-procedure-sequence-23 .H6}
Table 6.1.1.15.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | send an | | | | | | | emergency | | | | | | | alert. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | Request - | | | | | | | Accept | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.30.3-1 | | | | | | | to request | | | | | | | an | | | | | | | emergency | | | | | | | alert | | | | | | | providing | | | | | | | location | | | | | | | in | | | | | | | formation? | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 4 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | cancel the | | | | | | | emergency | | | | | | | alert. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | Request - | | | | | | | Accept | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.30.3-1 | | | | | | | to cancel | | | | | | | the | | | | | | | emergency | | | | | | | alert? | | | | | +------------+------------+------------+---------+---------+----+ | 6 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.1.15.3.3 Specific message contents {#specific-message-contents-23
.H6}
Table 6.1.1.15.3.3-1: SIP MESSAGE from the UE (step 2, Table 6.1.1.15.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition LOCATION_REPORT
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.15.3.3-1B  
MIME body part **Location-info**  
MIME-part-body Location-info as described in Table 6.1.1.15.3.3-1A
Table 6.1.1.15.3.3-1A: Location-Info in SIP MESSAGE (Table 6.1.1.15.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.4.1-1
* * *
Information Element Value/remark Comment Reference Condition location-info  
Report  
CurrentLocation  
CurrentCoordinate  
longitude Encrypted \ with any content Encryption according to NOTE
1 in TS 36.579-1 [2] Table 5.5.3.4.1-1  
latitude Encrypted \ with any content Encryption according to NOTE 1
in TS 36.579-1 [2] Table 5.5.3.4.1-1
Table 6.1.1.15.3.3-1B: MCPTT-Info in SIP MESSAGE (Table 6.1.1.15.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
alert-ind Encrypted \ with mcpttBoolean set to true Encryption
according to NOTE 2 in TS 36.579-1 [2] Table 5.5.3.2.1-1
Table 6.1.1.15.3.3-2A: SIP MESSAGE from the SS (step 2, Table 6.1.1.15.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.15.3.3-2B
Table 6.1.1.15.3.3-2B: MCPTT-Info in SIP MESSAGE (Table 6.1.1.15.3.3-2A)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-calling-user-id not present  
alert-ind Encrypted \ with mcpttBoolean set to true Encryption
according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.2.2-1  
mcptt-client-id Encrypted \ with mcpttString set to the
client-id as received from the UE Encryption according to NOTE 1 in TS
36.579-1 [2] Table 5.5.3.2.2-1  
alert-ind-rcvd true
Table 6.1.1.15.3.3-3: SIP MESSAGE from the UE (step 5, Table 6.1.1.15.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.15.3.3-3A
Table 6.1.1.15.3.3-3A: MCPTT-Info in SIP MESSAGE (Table 6.1.1.15.3.3-3)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
alert-ind Encrypted \ with mcpttBoolean set to false Encryption
according to NOTE 2 in TS 36.579-1 [2] Table 5.5.3.2.1-1
Table 6.1.1.15.3.3-4: SIP MESSAGE from the SS (step 5, Table 6.1.1.15.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.15.3.3-5
Table 6.1.1.15.3.3-5: MCPTT-Info in SIP MESSAGE (Table 6.1.1.15.3.3-4)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-calling-user-id not present  
emergency-ind Encrypted \ with mcpttBoolean set to false
Encryption according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.2.2-1  
alert-ind Encrypted \ with mcpttBoolean set to false Encryption
according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.2.2-1  
mcptt-client-id Encrypted \ with mcpttString set to the
client-id as received from the UE Encryption according to NOTE 1 in TS
36.579-1 [2] Table 5.5.3.2.2-1  
alert-ind-rcvd true
6.1.1.16 On-network / Emergency Alert / Client Terminated (CT)
##### 6.1.1.16.1 Test Purpose (TP) {#test-purpose-tp-24 .H6}
##### (1) {#section-83 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service}
ensure that {
**when** { MCPTT Server notifies the UE (MCPTT client) with an emergency alert
with the location of emergency by sending the UE (MCPTT Client) a SIP MESSAGE
}
**then** {UE (MCPTT client) acknowledges the emergency alert by sending a SIP
200 (OK) response **and** notifies the user of the emergency alert }
}
##### (2) {#section-84 .H6}
**with** { UE (MCPTT Client) having been previously notified of an emergency
alert}
ensure that {
**when** { MCPTT Server sends an emergency alert cancellation to the UE (MCPTT
client) }
**then** {UE (MCPTT client) acknowledges the cancellation of the emergency
state by sending a SIP 200 (OK) response **and** notifies the user of the
cancellation }
}
##### 6.1.1.16.2 Conformance requirements {#conformance-requirements-24 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379, clause 12.1.1.3. The following represents a
copy/paste extraction of the requirements relevant to the test purpose; any
references within the copy/paste text should be understood within the scope of
the core spec they have been copied from. Unless otherwise stated, these are
Rel-14 requirements.
[TS 24.379 clause 12.1.1.3]
Upon receipt of a \"SIP MESSAGE request for emergency notification\", the
MCPTT client:
> 1) if the received SIP MESSAGE request contains an
> application/vnd.3gpp.mcptt-info+xml MIME body with the \ element
> set to a value of \"true\", should display to the MCPTT user an indication
> of the MCPTT emergency alert and associated information, including:
>
> a) the MCPTT group identity contained in \ element
> application/vnd.3gpp.mcptt-info+xml MIME body;
>
> b) the originator of the MCPTT emergency alert contained in the \ calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME
> body; and
>
> c) the mission critical organization of the MCPTT emergency alert originator
> contained in the \ element of the application/vnd.3gpp.mcptt-
> info+xml MIME body;
>
> NOTE 1: This is the case of the MCPTT client receiving the notification of
> another MCPTT user\'s emergency alert.
>
> 2) if the received SIP MESSAGE request contains an
> application/vnd.3gpp.mcptt-info+xml MIME body with the \ element
> set to a value of \"false\":
>
> a) should display to the MCPTT user an indication of the MCPTT emergency
> alert cancellation and associated information, including:
>
> i) the MCPTT group identity contained in the \
> element application/vnd.3gpp.mcptt-info+xml MIME body;
>
> ii) the originator of the MCPTT emergency alert contained in:
>
> A) if present, the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body; or
>
> B) the \ element of the application/vnd.3gpp.mcptt-
> info+xml MIME body; and
>
> b) if the MCPTT ID contained in the \ element is the MCPTT ID
> of the receiving MCPTT user, shall set the MCPTT emergency alert state to
> \"MEA 1: no-alert\"; and
>
> c) if the received SIP MESSAGE request contains an
> application/vnd.3gpp.mcptt-info+xml MIME body with the \
> element is set to a value of \"false\":
>
> i) shall set the MCPTT emergency group state to \"MEG 1: no-emergency\"; and
>
> ii) shall set the MCPTT emergency group call state to \"MEGC 1: emergency-
> gc-capable\";
>
> NOTE 2: This is the case of the MCPTT client receiving the notification of
> the cancellation by a third party of an MCPTT emergency alert. This can be
> the MCPTT emergency alert of another MCPTT user or the MCPTT emergency alert
> of the recipient, as determined by the contents of the \
> element. Optionally, notification of the cancellation of the in-progress
> emergency state of the MCPTT group can be included.
>
> 3) if the received SIP MESSAGE request contains an
> application/vnd.3gpp.mcptt-info+xml MIME body with the \
> element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication of the additional
> emergency MCPTT user participating in the MCPTT emergency group call
> including the following if not already displayed as part of step 1):
>
> i) the MCPTT group identity contained in the \
> element application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> ii) the \ element of the application/vnd.3gpp.mcptt-
> info+xml MIME body;
>
> b) shall set the MCPTT emergency group state to \"MEG 2: in-progress\" if
> not already set to that value;
>
> NOTE 3: This is the case of the MCPTT client receiving notification of an
> additional MCPTT user in an MCPTT emergency state (i.e., not the MCPTT user
> that originally triggered the in-progress emergency state of the group)
> joining the in-progress emergency group call. An emergency alert indication,
> if included, is handled in step 1).
>
> 4) if the received SIP MESSAGE request contains an
> application/vnd.3gpp.mcptt-info+xml MIME body with the \
> element set to a value of \"false\":
>
> a) should display to the MCPTT user an indication of the cancellation of the
> in-progress emergency state of the MCPTT group call including the following
> if not already displayed as part of step 2):
>
> i) the MCPTT group identity contained in the \
> element application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> ii) the \ element of the application/vnd.3gpp.mcptt-
> info+xml MIME body;
>
> b) shall set the MCPTT emergency group state to \"MEG 1: no-emergency\"; and
>
> c) shall set the MCPTT emergency group call state to \"MEGC 1: emergency-gc-
> capable\";
>
> NOTE 4: This is the case of the MCPTT client receiving the notification of
> the cancellation of the in-progress emergency state of the MCPTT group. In
> this case, the receiving MCPTT client is affiliated with the MCPTT group but
> not participating in the session. An emergency alert cancellation, if
> included, is handled in step 2).
>
> 5) if the received SIP MESSAGE request contains an
> application/vnd.3gpp.mcptt-info+xml MIME body with the \
> element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication of the MCPTT user
> participating in the MCPTT imminent peril group call including the following
> if not already displayed as part of step 1):
>
> i) the MCPTT group identity contained in the \
> element application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> ii) the \ element of the application/vnd.3gpp.mcptt-
> info+xml MIME body; and
>
> b) shall set the MCPTT imminent peril group state to \"MIG 2: in-progress\"
> if not already set to that value;
>
> NOTE 5: This is the case of the MCPTT client receiving notification of an
> additional MCPTT user initiating an imminent peril group call when there is
> already an in-progress imminent peril state in effect on the group.
>
> 6) if the received SIP MESSAGE request contains an
> application/vnd.3gpp.mcptt-info+xml MIME body with the \
> element set to a value of \"false\":
>
> a) should display to the MCPTT user an indication of the cancellation of the
> in-progress imminent peril state of the MCPTT group including the following
> if not already displayed as part of step 2):
>
> i) the MCPTT group identity contained in the \
> element application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> ii) the \ element of the application/vnd.3gpp.mcptt-
> info+xml MIME body;
>
> b) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
> peril\"; and
>
> c) shall set the MCPTT imminent peril group call state to \"MIGC 1:
> imminent-peril-gc-capable\";
>
> NOTE 6: This is the case of the MCPTT client receiving notification of the
> cancellation of the in-progress imminent peril state of the group.
>
> 7) shall generate a SIP 200 (OK) response according to rules and procedures
> of 3GPP TS 24.229 [4]; and
>
> 8) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4].
##### 6.1.1.16.3 Test description {#test-description-24 .H6}
##### 6.1.1.16.3.1 Pre-test conditions {#pre-test-conditions-24 .H6}
##### System Simulator: {#system-simulator-24 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-24 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-24 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.16.3.2 Test procedure sequence {#test-procedure-sequence-24 .H6}
Table 6.1.1.16.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | informing | | | | | | | about an | | | | | | | emergency | | | | | | | alert? | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | Step 3a1 | | | | | | | describes | | | | | | | behaviour | | | | | | | that | | | | | | | depends on | | | | | | | the UE | | | | | | | imple | | | | | | | mentation; | | | | | | | the | | | | | | | \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | identifies | | | | | | | a step | | | | | | | sequence | | | | | | | that take | | | | | | | place if | | | | | | | the UE | | | | | | | displays | | | | | | | an | | | | | | | indication | | | | | | | and | | | | | | | associated | | | | | | | i | | | | | | | nformation | | | | | | | incase of | | | | | | | an | | | | | | | emergency | | | | | | | alert. | | | | | +------------+------------+------------+---------+---------+----+ | 3a1 | IF | - | - | 1 | P | | | pc_ | | | | | | | MCX_Displ | | | | | | | ayInfoEmer | | | | | | | gencyAlert | | | | | | | THEN | | | | | | | Check: | | | | | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the | | | | | | | emergency | | | | | | | alert? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 4 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | informing | | | | | | | about | | | | | | | ca | | | | | | | ncellation | | | | | | | of the | | | | | | | emergency | | | | | | | alert? | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | Step 6a1 | | | | | | | describes | | | | | | | behaviour | | | | | | | that | | | | | | | depends on | | | | | | | the UE | | | | | | | imple | | | | | | | mentation; | | | | | | | the | | | | | | | \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | identifies | | | | | | | a step | | | | | | | sequence | | | | | | | that take | | | | | | | place if | | | | | | | the UE | | | | | | | displays | | | | | | | an | | | | | | | indication | | | | | | | and | | | | | | | associated | | | | | | | i | | | | | | | nformation | | | | | | | incase of | | | | | | | an | | | | | | | emergency | | | | | | | alert | | | | | | | can | | | | | | | cellation. | | | | | +------------+------------+------------+---------+---------+----+ | 6a1 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the | | | | | | | emergency | | | | | | | alert | | | | | | | can | | | | | | | cellation? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.1.16.3.3 Specific message contents {#specific-message-contents-24
.H6}
Table 6.1.1.16.3.3-1: SIP MESSAGE from the SS (Step 1, Table 6.1.1.16.3.2-1;\
Step 2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition LOCATION-INFO
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.16.3.3-1B  
MIME body part **Location-info**  
MIME-part-body Location-info as described in Table 6.1.1.16.3.3-1A
Table 6.1.1.16.3.3-1A: Location-Info in SIP MESSAGE (Table 6.1.1.16.3.3-1)
+-----------------+-----------------+---------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 [2], | | | | | | Table | | | | | | 5.5.3.4.4-1 | | | | | +=================+=================+=========+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +-----------------+-----------------+---------+-----------+-----------+ | location-info | | | | | +-----------------+-----------------+---------+-----------+-----------+ | Report | | | | | +-----------------+-----------------+---------+-----------+-----------+ | CurrentLocation | | | | | +-----------------+-----------------+---------+-----------+-----------+ | Cu | | | | | | rrentCoordinate | | | | | +-----------------+-----------------+---------+-----------+-----------+ | longitude | px_MCX_ | | | | | | CoordinateLongi | | | | | | tude_Client_B | | | | | | (NOTE 1, 2) | | | | +-----------------+-----------------+---------+-----------+-----------+ | latitude | px_MCX\ | | | | | | _CoordinateLati | | | | | | tude_Client_B | | | | | | (NOTE 1, 3) | | | | +-----------------+-----------------+---------+-----------+-----------+ | NOTE 1: Shall | | | | | | be encrypted as | | | | | | described in TS | | | | | | 36.579-1[2] | | | | | | Table | | | | | | 5.5.3.4.4-1A. | | | | | | | | | | | | NOTE 2: | | | | | | Longitude of | | | | | | px_MCX_ | | | | | | CoordinateLongi | | | | | | tude_Client_B | | | | | | degrees encoded | | | | | | according to TS | | | | | | 23.032 [36] | | | | | | clause 6.1. | | | | | | | | | | | | NOTE 3: | | | | | | Latitude of | | | | | | px_MCX\ | | | | | | _CoordinateLati | | | | | | tude_Client_B | | | | | | degrees encoded | | | | | | according to TS | | | | | | 23.032 [36] | | | | | | clause 6.1. | | | | | +-----------------+-----------------+---------+-----------+-----------+
Table 6.1.1.16.3.3-1B: MCPTT-Info in SIP MESSAGE (Table 6.1.1.16.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition GROUP-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
alert-ind Encrypted \ with mcpttBoolean set to true Encryption
according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.2.2-1
Table 6.1.1.16.3.3-2: Void
Table 6.1.1.16.3.3-3: SIP MESSAGE from the SS (Step 4, Table 6.1.1.16.3.2-1;\
Step 2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.16.3.3-3A
Table 6.1.1.16.3.3-3A: MCPTT-Info in SIP MESSAGE (Table 6.1.1.16.3.3-3)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition GROUP-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
alert-ind Encrypted \ with mcpttBoolean set to false Encryption
according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.2.2-1
6.1.1.17 On-network / Broadcast Group Call using pre-established session /
Client originated Pre-established Session Release with associated MCPTT
session / Client Originated (CO)
##### 6.1.1.17.1 Test Purpose (TP) {#test-purpose-tp-25 .H6}
##### (1) {#section-85 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service and
having a pre-established session with the MCPTT Server }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT Broadcast
Group Call using a pre-established session requesting implicit floor control }
**then** { UE (MCPTT Client) requests Broadcast Group Call using a pre-
established session establishment by sending a SIP REFER message **and**
responds to the SS with correct MCPC messages }
}
##### (2) {#section-86 .H6}
**with** { UE (MCPTT Client) having an ongoing Broadcast Group Call using a
pre-established session }
ensure that {
**when** { the MCPTT User (MCPTT Client) wants to terminate the ongoing MCPTT
Broadcast Group Call but keep the pre-established session }
**then** { UE (MCPTT Client) sends a SIP REFER request and leaves the MCPTT
session }
}
##### 6.1.1.17.2 Conformance requirements {#conformance-requirements-25 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clauses 4.12, 6.2.8.2, 10.1.1.2.2.1, 10.1.1.2.3.2 and
6.2.4.2, and TS 24.380, clauses 9.2.2.2.2, 9.2.2.3.2 and 9.2.2.4.6. The
following represents a copy/paste extraction of the requirements relevant to
the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-13 requirements.
[TS 24.379, clause 10.1.1.2.2.1]
Upon receiving a request from an MCPTT user to establish an MCPTT group
session using an MCPTT group identity identifying a prearranged MCPTT group
within the pre-established session, the MCPTT client shall generate a SIP
REFER request as specified in IETF RFC 3515 [25] as updated by IETF RFC 6665
[26] and IETF RFC 7647 [27], and in accordance with the UE procedures
specified in 3GPP TS 24.229 [4], with the clarifications given below.
The MCPTT client shall follow the procedures specified in subclause
10.1.2.2.2.1 with the clarification in step 3) of subclause 10.1.2.2.2.1 that:
> 1) the \ element in the application/resource-lists MIME body shall
> contain a \"uri\" attribute set to the prearranged MCPTT group identity;
>
> 2) the \ element of the application/vnd.3gpp.mcptt-info MIME
> body in the hname \"body\" URI header field shall be set to a value of
> \"prearranged\"; and
>
> 3) if the MCPTT user has requested the origination of a broadcast group
> call, the MCPTT client shall comply with the procedures in subclause
> 6.2.8.2.
[TS 24.379, clause 6.2.8.2]
When the MCPTT user initiates a broadcast group call, the MCPTT client:
> 1) in the case of the prearranged group call is initiated on-demand, shall
> include in the application/vnd.3gpp.mcptt-info+xml MIME body the
> \ element set to \"true\" as defined in clause F.1; and
>
> 2) in the case the prearranged group call is initiated using a pre-
> established session, shall include in the application/vnd.3gpp.mcptt-
> info+xml MIME body in the \"body\" URI header field in the Refer-To header
> field the \ element set to \"true\" as defined in clause F.1.
[TS 24.379, clause 10.1.1.2.3.2]
When an MCPTT client wants to leave the MCPTT session within a pre-established
session, the MCPTT client shall follow the procedures as specified in
subclause 6.2.4.2.
[TS 24.379, clause 6.2.4.2]
Upon receiving a request from an MCPTT user to leave an MCPTT session within a
pre-established session, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate an initial SIP REFER request outside a dialog in
> accordance with the procedures specified in 3GPP TS 24.229 [4], IETF RFC
> 4488 [22] and IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF
> RFC 7647 [27];
>
> 3) shall set the Request-URI of the SIP REFER request to the public service
> identity identifying the pre-established session on the MCPTT server serving
> the MCPTT user;
>
> 4) shall include the Refer-Sub header field with value \"false\" according
> to rules and procedures of IETF RFC 4488 [22];
>
> 5) shall include the Supported header field with value \"norefersub\"
> according to rules and procedures of IETF RFC 4488 [22];
>
> 6) shall set the Refer-To header field of the SIP REFER request to the MCPTT
> session identity to leave;
>
> 7) shall include the \"method\" SIP URI parameter with the value \"BYE\" in
> the URI in the Refer-To header field;
>
> 8) shall include a Target-Dialog header field as specified in IETF RFC 4538
> [23] identifying the pre-established session; and
>
> 9) shall send the SIP REFER request according to 3GPP TS 24.229 [4].
Upon receiving a SIP 2xx response to the SIP REFER request, the MCPTT client
shall interact with media plane as specified in 3GPP TS 24.380 [5].
[TS 24.380, clause 9.2.2.2.2]
When a pre-established session is created between the MCPTT client and the
participating MCPTT function, as specified in 3GPP TS 24.379 [2], the MCPTT
client:
> 1\. shall initialize any needed user plane resources for the pre-established
> session as specified in 3GPP TS 24.379 [2]; and
>
> 2\. shall enter the \'U: Pre-established session not in use\' state.
[TS 24.380, clause 9.2.2.3.2]
Upon reception of a Connect message:
> 1\. if the MCPTT client accepts the incoming call the MCPTT client:
>
> a. shall send the Acknowledgement message with Reason Code field set to
> \'Accepted\';
>
> b. shall use only the media streams of the pre-established session which are
> indicated as used in the associated call session Media Streams field, if the
> Connect contains a Media Streams field;
>
> c. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\' as specified in subclause 6.2.4; and
>
> d. shall enter the \'U: Pre-established session in use\' state; or
>
> 2\. Otherwise the MCPTT client:
>
> a. shall send the Acknowledgement message with the Reason Code field set to
> \'Busy\' or \'Not Accepted\'; and
>
> b. shall remain in \'U: Pre-established session not in use\' state.
[TS 24.380, clause 9.2.2.4.6]
Upon receiving a 2xx response to the sent SIP REFER request as described in
3GPP TS 24.379 [2] when the call is released, but the Pre-established Session
is kept alive the MCPTT client:
> 1\. shall enter the \'U: Pre-established session not in use\' state; and
>
> 2\. shall terminate the instance of \'Floor participant state transition
> diagram for basic operation\' state machine as specified in subclause 6.2.4.
##### 6.1.1.17.3 Test description {#test-description-25 .H6}
##### 6.1.1.17.3.1 Pre-test conditions {#pre-test-conditions-25 .H6}
##### System Simulator: {#system-simulator-25 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-25 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-25 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.17.3.2 Test procedure sequence {#test-procedure-sequence-25 .H6}
Table 6.1.1.17.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a | | | | | | | broadcast | | | | | | | group call | | | | | | | using the | | | | | | | pre-e | | | | | | | stablished | | | | | | | session | | | | | | | with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | call | | | | | | | est | | | | | | | ablishment | | | | | | | using a | | | | | | | pre-e | | | | | | | stablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3A.3.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a | | | | | | | broadcast | | | | | | | group call | | | | | | | with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode? | | | | | +------------+------------+------------+---------+---------+----+ | 3-5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | leave the | | | | | | | session. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | call | | | | | | | release | | | | | | | keeping | | | | | | | the | | | | | | | pre-e | | | | | | | stablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.4.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.1.17.3.3 Specific message contents {#specific-message-contents-25
.H6}
Table 6.1.1.17.3.3-1: SIP REFER from the UE (step 2, Table 6.1.1.17.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.12-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part Resource-Lists  
MIME-part-body Resource-Lists as described in Table 6.1.1.17.3.3-3
Table 6.1.1.17.3.3-2: Void
Table 6.1.1.17.3.3-3: Resource-lists in SIP REFER (Table 6.1.1.17.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.3.1-1, condition PRE-ESTABLISH,
GROUP-CALL with the uri attribute of the entry extended with the SIP URI
header fields as specified in Table 6.1.1.17.3.3-3A
* * *
Table 6.1.1.17.3.3-3A: SIP header fields extending the uri attribute of the
resource-lists\' single entry\ (Table 6.1.1.17.3.3-3)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.12-2, condition GROUP-CALL
* * *
Information Element Value/remark Comment Reference Condition body  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.17.3.3-3B
Table 6.1.1.17.3.3-3B: MCPTT-Info (Table 6.1.1.17.3.3-3A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL,
INVITE_REFER, BROADCAST-CALL
* * *
Table 6.1.1.17.3.3-4..5: Void
Table 6.1.1.17.3.3-6: SIP 200 (OK) from the SS (step 2, Table 6.1.1.17.3.2-1;\
step 3, TS 36.579-1 [2] Table 5.3A.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition REFER-RSP
* * *
Table 6.1.1.17.3.3-7: Connect (step 2, Table 6.1.1.17.3.2-1;\ step 4, TS
36.579-1 [2] Table 5.3A.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.12-1, condition GROUP-CALL, ACK
* * *
6.1.1.18 On-network / Broadcast Group Call using pre-established session /
Automatic Commencement Mode / Server originated Pre-established Session
Release with associated MCPTT session / Client Terminated (CT)
##### 6.1.1.18.1 Test Purpose (TP) {#test-purpose-tp-26 .H6}
##### (1) {#section-87 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service and
having a pre-established session with the MCPTT Server }
ensure that {
**when** { the MCPTT Server requests the establishment of an MCPTT Broadcast
Group Call using a pre-established session requesting Automatic Commencement
Mode to the UE (MCPTT Client) by sending a Connect}
**then** { UE (MCPTT Client) accepts the Broadcast Group Call by sending an
Acknowledgement }
}
##### (2) {#section-88 .H6}
**with** { UE (MCPTT Client) having accepted the Broadcast Group Call }
ensure that {
**when** { the MCPTT Server sends a Floor taken request }
**then** { the user is notified about the type of call }
}
##### (3) {#section-89 .H6}
**with** { UE (MCPTT Client) having an ongoing Broadcast Group Call using a
pre-established session with Automatic Commencement Mode }
ensure that {
**when** { the MCPTT Server wants to terminate the ongoing MCPTT Broadcast
Group Call and sends a Disconnect }
**then** { UE (MCPTT Client) accepts the ending of the MCPTT Group Call by
sending an Acknowledgement }
}
##### 6.1.1.18.2 Conformance requirements {#conformance-requirements-26 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.380, clauses 4.1.2.2, 4.1.2.3, 9.2.2.3.2, 9.2.2.3.4 and
6.2.4.3.3. The following represents a copy/paste extraction of the
requirements relevant to the test purpose; any references within the
copy/paste text should be understood within the scope of the core spec they
have been copied from. Unless otherwise stated, these are Rel-13 requirements.
[TS 24.380, clause 4.1.2.2]
For a pre-arranged group call if the controlling MCPTT function as triggered
by an originating group member initiates a call as specified in 3GPP TS 24.379
[2], the participating MCPTT function which serves the terminating MCPTT
client sends a Connect message to all affiliated MCPTT clients of this group.
After the reception of the Connect message the terminating MCPTT client sends
an Acknowledgment message by indicating that the connection is accepted or by
indicating that the connection is not accepted. If the connection is accepted
by the terminating MCPTT client, the floor control for this call continues a
specified in clause 6.
> NOTE: If a terminating client does not have an available pre-established
> session, the call setup proceeds as in on-demand call setup as specified in
> 3GPP TS 24.379 [2].
[TS 24.380, clause 4.1.2.3]
When a call is released by the controlling MCPTT function (as specified in
3GPP TS 24.379 [2]), the participating MCPTT function sends a Disconnect
message to all MCPTT clients which used a pre-established session for this
call. Then the call is released (see also 3GPP TS 24.379 [2]) and the pre-
established session can be used for another call.
When an MCPTT client leaves a call (as specified in 3GPP TS 24.379 [2]) which
was setup over a pre-established session without releasing the pre-established
session, this pre-established session can be used for another call.
TS 24.380, clause 9.2.2.3.2]
Upon reception of a Connect message:
> 1\. if the MCPTT client accepts the incoming call the MCPTT client:
>
> a. shall send the Acknowledgement message with Reason Code field set to
> \'Accepted\';
>
> b. shall use only the media streams of the pre-established session which are
> indicated as used in the associated call session Media Streams field, if the
> Connect contains a Media Streams field;
>
> c. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\' as specified in subclause 6.2.4; and
>
> d. shall enter the \'U: Pre-established session in use\' state; or
>
> 2\. Otherwise the MCPTT client:
>
> a. shall send the Acknowledgement message with the Reason Code field set to
> \'Busy\' or \'Not Accepted\'; and
>
> b. shall remain in \'U: Pre-established session not in use\' state.
[TS 24.380, clause 9.2.2.3.4]
Upon reception of a Disconnect message the MCPTT client:
> 1\. if the first bit in the subtype of the Disconnect message is set to
> \'1\' (acknowledgement is required), shall send the Acknowledgement message
> with the Reason Code set to \'Accepted\'; and
>
> 2\. shall remain in \'U: Pre-established session not in use\' state.
[TS 24.380, clause 6.2.4.3.3]
Upon receiving the Floor Taken message, the floor participant:
> 1\. if the first bit in the subtype of the Floor Taken message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'2\' (Floor Taken); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. may provide a floor taken notification to the user;
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. should start the optional timer T103 (End of RTP media); and
>
> 5\. shall remain in the \'U: has no permission\' state.
##### 6.1.1.18.3 Test description {#test-description-26 .H6}
##### 6.1.1.18.3.1 Pre-test conditions {#pre-test-conditions-26 .H6}
##### System Simulator: {#system-simulator-26 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-26 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-26 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.18.3.2 Test procedure sequence {#test-procedure-sequence-26 .H6}
Table 6.1.1.18.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CT Call | | | | | | | esta | | | | | | | blishment | | | | | | | using a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3A.8.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 3 | The SS | \ 1) if the MCPTT user has requested the origination of an MCPTT emergency
> group call or is originating an MCPTT prearranged group call and the MCPTT
> emergency state is already set, the MCPTT client shall comply with the
> procedures in subclause 6.2.8.1.1;
>
> 2) if the MCPTT user has requested the origination of an MCPTT imminent
> peril group call, the MCPTT client shall comply with the procedures in
> subclause 6.2.8.1.9;
>
> 3) if the MCPTT user has requested the origination of a broadcast group
> call, the MCPTT client shall comply with the procedures in subclause
> 6.2.8.2;
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 8) should include the \"timer\" option tag in the Supported header field;
>
> 9) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the \"refresher\" header field parameter is
> omitted. If included, the \"refresher\" header field parameter shall be set
> to \"uac\";
>
> 10) shall set the Request-URI of the SIP INVITE request to the public
> service identity identifying the participating MCPTT function serving the
> MCPTT user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 11) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> 12) if the MCPTT client emergency group state for this group is set to \"MEG
> 2: in-progress\" or \"MEG 4: confirm-pending\", the MCPTT client shall
> include the Resource-Priority header field and comply with the procedures in
> subclause 6.2.8.1.2;
>
> 13) if the MCPTT client imminent peril group state for this group is set to
> \"MIG 2: in-progress\" or \"MIG 4: confirm-pending\" shall include the
> Resource-Priority header field and comply with the procedures in subclause
> 6.2.8.1.12;
>
> 14) shall contain in an application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"prearranged\";
>
> b) the \ element set to the group identity;
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client;
>
> NOTE 2: The MCPTT client does not include the MCPTT ID of the originating
> MCPTT user in the body, as this will be inserted into the body of the SIP
> INVITE request that is sent from the originating participating MCPTT
> function.
>
> d) if the group identity can be determined to be a TGI and if the MCPTT
> client can associate the TGI with a MCPTT group ID, the \ id> element set to the MCPTT group ID; and
>
> e) if the MCPTT client is aware of active functional-aliases, and an active
> functional alias is to be included in the initial SIP INVITE request, the
> \ set to the URI of the used functional alias;
>
> NOTE 3: The text \"can associate the TGI with a MCPTT group ID\" means that
> the MCPTT client is able to determine that there is a constituent group of
> the temporary group that it is a member of.
>
> NOTE 4: The MCPTT client is informed about temporary groups and regrouping
> of MCPTT groups that the user is a member of as specified in 3GPP TS 24.481
> [31].
>
> NOTE 5: If the MCPTT user selected a TGI where there are several MCPTT
> groups where the MCPTT user is a member, the MCPTT client selects one of
> those MCPTT groups.
>
> NOTE 6: The MCPTT client learns the functional aliases that are activated
> for an MCPTT ID from procedures specified in subclause 9A.2.1.3.
>
> 15) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.1;
>
> 16) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 17) shall send the SIP INVITE request towards the MCPTT server according to
> 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5] ;
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in subclause 6.2.8.1.4;
>
> 2A) may notify the answer state to the user (i.e. \"Unconfirmed\" or
> \"Confirmed\") if received in the P-Answer-State header field; and
>
> 3) may subscribe to the conference event package as specified in subclause
> 10.1.3.1.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request:
> 1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\"; or
>
> 2) if the MCPTT imminent peril group call state is set to \"MIGC 2:
> imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";
the MCPTT client shall perform the actions specified in subclause 6.2.8.1.5.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in subclause 6.2.8.1.13.
[TS 24.379, clause 6.2.4.1]
Upon receiving a request from an MCPTT user to leave an MCPTT session
established using on-demand session signalling, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 3) shall set the Request-URI to the MCPTT session identity to leave; and
>
> 4) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT
client shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.380, clause 6.2.4.2.2]
When a call is initiated as described in 3GPP TS 24.379 [2], the floor
participant:
> 1\. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\';
>
> 2\. if the originating floor participant receives a floor control message
> before it receives the SIP 200 (OK) response, shall store the floor control
> message;
>
> NOTE: The originating floor participant might receive a floor control
> message before the SIP 200 (OK) response when initiating, joining or
> rejoining a call because of processing delays of the SIP 200 (OK) response
> in the SIP core.
>
> 3\. if the established MCPTT call is a chat group call and the SIP INVITE
> request is not an implicit floor request, shall enter the \'U: has no
> permission\' state; and
>
> 4\. if for the established MCPTT call the SIP INVITE request is an implicit
> floor request:
>
> a. shall start timer T101 (Floor Request) and initialise counter C101 (Floor
> Request) to 1;
>
> b. shall enter the \'U: pending Request\' state; and
>
> c. if the floor participant has received and stored a floor control message
> before the reception of the SIP 200 (OK) response, shall act as if the floor
> control message was received in the \'U: pending Request\' state after
> entering the \'U: pending Request\' state.
When the floor participant is rejoining an ongoing MCPTT call as described in
3GPP TS 24.379 [2] the floor participant shall enter the \'U: has no
permission\' state.
[TS 24.380, clause 6.2.4.4.2]
Upon receiving a Floor Granted message from the floor control server or a
floor granted indication in a SIP 200 (OK) response in the application and
signalling layer, the floor participant:
> 1\. if the first bit in the subtype of the Floor Granted message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'1\' (Floor Granted); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. if the call is not an ambient listening call, shall provide floor
> granted notification to the user, if not already done;
>
> NOTE: Providing the floor granted notification to the user prior to
> receiving the Floor Granted message is an implementation option.
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
> store an indication that the participant is overriding without revoke;
>
> 5\. shall stop the optional timer T103 (End of RTP media), if running;
>
> 6\. shall stop timer T101 (Floor Request); and
>
> 7\. shall enter the \'U: has permission\' state.
##### 6.1.1.19.3 Test description {#test-description-27 .H6}
##### 6.1.1.19.3.1 Pre-test conditions {#pre-test-conditions-27 .H6}
##### System Simulator: {#system-simulator-27 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-27 .H6}
\- UE (MCPTT Client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-27 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'UE initiated MCPTT functional alias status
determination and subscription\' as specified in TS 36.579-1 [2] clause
5.3.36.
\- The UE has performed procedure \'UE initiated MCPTT functional alias status
change\' as specified in TS 36.579-1 [2] clause 5.3.37.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.19.3.2 Test procedure sequence {#test-procedure-sequence-27 .H6}
Table 6.1.1.19.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a group | | | | | | | call using | | | | | | | the active | | | | | | | functional | | | | | | | alias with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3A.1.3-1 | | | | | | | to**| | | | | | | establish | | | | | | | a group | | | | | | | call with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.ii of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | |** 5.3 | | | | | | | A.1.3-1**? | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 4 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.1.19.3.3 Specific message contents {#specific-message-contents-27
.H6}
Table 6.1.1.19.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.1.19.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.1.1.19.3.3-2  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.19.3.3-3
Table 6.1.1.19.3.3-2: SDP in SIP INVITE (Table 6.1.1.19.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
INITIAL_SDP_OFFER, IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.1.19.3.3-3: MCPTT-Info in SIP INVITE (Table 6.1.1.19.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL,
INVITE_REFER, FUNCTIONAL_ALIAS
* * *
Table 6.1.1.19.3.3-4: SIP 200 (OK) from the SS (step 2, Table 6.1.1.19.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.1.1.19.3.3-5
Table 6.1.1.19.3.3-5: SDP in SIP 200 (OK) (Table 6.1.1.19.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
IMPLICIT_GRANT_REQUESTED
* * *
6.1.1.20 On-network / On-demand Pre-arranged Group Call / Multi Talker
##### 6.1.1.20.1 Test Purpose (TP) {#test-purpose-tp-28 .H6}
##### (1) {#section-92 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT On-demand
Pre-arranged Group Call and implicit floor control }
**then** { UE (MCPTT Client) requests On-demand Automatic Commencement Mode
Pre-arranged Group Call establishment with implicit floor control by sending a
SIP INVITE message, **and** , after indication from the MCPTT Server that the
call was established and receiving a Floor Granted message, notifies the MCPTT
User }
}
##### (2) {#section-93 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Automatic Commencement Mode }
ensure that {
**when** { the (MCPTT Client) receives multi-talker floor control messages
from the SS (MCPTT Server) }
**then** { UE (MCPTT Client) notifies the MCPTT User }
}
##### (3) {#section-94 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Automatic Commencement Mode }
ensure that {
**when** { the MCPTT User requests terminate the ongoing MCPTT Group Call }
**then** { UE (MCPTT Client) sends a SIP BYE request and leaves the MCPTT
session }
}
##### 6.1.1.20.2 Conformance requirements {#conformance-requirements-28 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379, clauses 10.1.1.2.1.1, 6.2.4.1, TS 24.380, clauses
6.2.4.2.2, 6.2.4.4.2, 6.2.4.5.8, 6.2.4.5.9. Unless otherwise stated, these are
Rel-15 requirements.
[TS 24.379, clause 10.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT prearranged
group session the MCPTT client shall generate an initial SIP INVITE request by
following the UE originating session procedures specified in 3GPP TS 24.229
[4], with the clarifications given below.
The MCPTT client:
> 1) if the MCPTT user has requested the origination of an MCPTT emergency
> group call or is originating an MCPTT prearranged group call and the MCPTT
> emergency state is already set, the MCPTT client shall comply with the
> procedures in subclause 6.2.8.1.1;
>
> 2) if the MCPTT user has requested the origination of an MCPTT imminent
> peril group call, the MCPTT client shall comply with the procedures in
> subclause 6.2.8.1.9;
>
> 3) if the MCPTT user has requested the origination of a broadcast group
> call, the MCPTT client shall comply with the procedures in subclause
> 6.2.8.2;
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 8) should include the \"timer\" option tag in the Supported header field;
>
> 9) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the \"refresher\" header field parameter is
> omitted. If included, the \"refresher\" header field parameter shall be set
> to \"uac\";
>
> 10) shall set the Request-URI of the SIP INVITE request to the public
> service identity identifying the participating MCPTT function serving the
> MCPTT user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 11) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> 12) if the MCPTT client emergency group state for this group is set to \"MEG
> 2: in-progress\" or \"MEG 4: confirm-pending\", the MCPTT client shall
> include the Resource-Priority header field and comply with the procedures in
> subclause 6.2.8.1.2;
>
> 13) if the MCPTT client imminent peril group state for this group is set to
> \"MIG 2: in-progress\" or \"MIG 4: confirm-pending\" shall include the
> Resource-Priority header field and comply with the procedures in subclause
> 6.2.8.1.12;
>
> 14) shall contain in an application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"prearranged\";
>
> b) the \ element set to the group identity;
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client;
>
> NOTE 2: The MCPTT client does not include the MCPTT ID of the originating
> MCPTT user in the body, as this will be inserted into the body of the SIP
> INVITE request that is sent from the originating participating MCPTT
> function.
>
> d) if the group identity can be determined to be a TGI and if the MCPTT
> client can associate the TGI with a MCPTT group ID, the \ id> element set to the MCPTT group ID; and
>
> e) if the MCPTT client is aware of active functional-aliases, and an active
> functional alias is to be included in the initial SIP INVITE request, the
> \ set to the URI of the used functional alias;
>
> NOTE 3: The text \"can associate the TGI with a MCPTT group ID\" means that
> the MCPTT client is able to determine that there is a constituent group of
> the temporary group that it is a member of.
>
> NOTE 4: The MCPTT client is informed about temporary groups and regrouping
> of MCPTT groups that the user is a member of as specified in 3GPP TS 24.481
> [31].
>
> NOTE 5: If the MCPTT user selected a TGI where there are several MCPTT
> groups where the MCPTT user is a member, the MCPTT client selects one of
> those MCPTT groups.
>
> NOTE 6: The MCPTT client learns the functional aliases that are activated
> for an MCPTT ID from procedures specified in subclause 9A.2.1.3.
>
> 15) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.1;
>
> 16) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 17) shall send the SIP INVITE request towards the MCPTT server according to
> 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5] ;
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in subclause 6.2.8.1.4;
>
> 2A) may notify the answer state to the user (i.e. \"Unconfirmed\" or
> \"Confirmed\") if received in the P-Answer-State header field; and
>
> 3) may subscribe to the conference event package as specified in subclause
> 10.1.3.1.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request:
> 1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\"; or
>
> 2) if the MCPTT imminent peril group call state is set to \"MIGC 2:
> imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";
the MCPTT client shall perform the actions specified in subclause 6.2.8.1.5.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in subclause 6.2.8.1.13.
[TS 24.379, clause 6.2.4.1]
Upon receiving a request from an MCPTT user to leave an MCPTT session
established using on-demand session signalling, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 3) shall set the Request-URI to the MCPTT session identity to leave; and
>
> 4) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT
client shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.380, clause 6.2.4.2.2]
When a call is initiated as described in 3GPP TS 24.379 [2], the floor
participant:
> 1\. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\';
>
> 2\. if the originating floor participant receives a floor control message
> before it receives the SIP 200 (OK) response, shall store the floor control
> message;
>
> NOTE: The originating floor participant might receive a floor control
> message before the SIP 200 (OK) response when initiating, joining or
> rejoining a call because of processing delays of the SIP 200 (OK) response
> in the SIP core.
>
> 3\. if the established MCPTT call is a chat group call and the SIP INVITE
> request is not an implicit floor request, shall enter the \'U: has no
> permission\' state; and
>
> 4\. if for the established MCPTT call the SIP INVITE request is an implicit
> floor request:
>
> a. shall start timer T101 (Floor Request) and initialise counter C101 (Floor
> Request) to 1;
>
> b. shall enter the \'U: pending Request\' state; and
>
> c. if the floor participant has received and stored a floor control message
> before the reception of the SIP 200 (OK) response, shall act as if the floor
> control message was received in the \'U: pending Request\' state after
> entering the \'U: pending Request\' state.
When the floor participant is rejoining an ongoing MCPTT call as described in
3GPP TS 24.379 [2] the floor participant shall enter the \'U: has no
permission\' state.
[TS 24.380, clause 6.2.4.4.2]
Upon receiving a Floor Granted message from the floor control server or a
floor granted indication in a SIP 200 (OK) response in the application and
signalling layer, the floor participant:
> 1\. if the first bit in the subtype of the Floor Granted message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'1\' (Floor Granted); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. if the call is not an ambient listening call, shall provide floor
> granted notification to the user, if not already done;
>
> NOTE: Providing the floor granted notification to the user prior to
> receiving the Floor Granted message is an implementation option.
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
> store an indication that the participant is overriding without revoke;
>
> 5\. shall stop the optional timer T103 (End of RTP media), if running;
>
> 6\. shall stop timer T101 (Floor Request); and
>
> 7\. shall enter the \'U: has permission\' state.
[TS 24.380, clause 6.2.4.5.8]
Upon receiving a Floor Taken message:
> 1\. if the G-bit in the Floor Indicator set to \'1\' (Dual Floor) the floor
> participant:
>
> a. shall inform the user that the call is overridden without revoke;
>
> b. shall store an indication that the participant is overridden without
> revoke; and
>
> c. shall remain in the \'U: has permission\' state; and
>
> 2\. if the I-bit in the Floor Indicator set to \'1\' (Multi-talker) the
> floor participant:
>
> a. may provide a floor taken notification to the user;
>
> b. should start the optional timer T103 (End of RTP media) for the
> participant for which Floor Taken message was received;
>
> c. shall provide a notification to the user indicating the type of call and
> may provide a list of current talkers; and
>
> d. shall remain in the \'U: has permission\' state.
[TS 24.380, clause 6.2.4.5.9]
Upon receiving the Floor Release Multi Talker message, the floor participant:
> 1\. shall provide a notification to the user indicating that the participant
> has released the floor in a multi-talker group; and
>
> 2\. shall remain in the \'U: has permission\' state.
##### 6.1.1.20.3 Test description {#test-description-28 .H6}
##### 6.1.1.20.3.1 Pre-test conditions {#pre-test-conditions-28 .H6}
##### System Simulator: {#system-simulator-28 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-28 .H6}
\- UE (MCPTT Client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-28 .H6}
\- The \ element of the MCPTT Group Configuration
Defaults as specified in TS 36.579-1 [2] Table 5.5.7.1-1 is set to \"true\".
\- The \ element of the MCPTT Group
Configuration Defaults as specified in TS 36.579-1 [2] Table 5.5.7.1-1 is set
to \"2\".
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.20.3.2 Test procedure sequence {#test-procedure-sequence-28 .H6}
Table 6.1.1.20.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5 | | | | | | | .3A.1.3-1 | | | | | | | to** | | | | | | | establish | | | | | | | a group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.ii of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5.3A | | | | | | | .1.3-1**? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | not | | | | | | | ification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | The SS | \ 1) if the MCPTT user has requested the origination of an MCPTT emergency
> group call or is originating an MCPTT prearranged group call and the MCPTT
> emergency state is already set, the MCPTT client shall comply with the
> procedures in subclause 6.2.8.1.1;
>
> 2) if the MCPTT user has requested the origination of an MCPTT imminent
> peril group call, the MCPTT client shall comply with the procedures in
> subclause 6.2.8.1.9;
>
> 3) if the MCPTT user has requested the origination of a broadcast group
> call, the MCPTT client shall comply with the procedures in subclause
> 6.2.8.2;
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 8) should include the \"timer\" option tag in the Supported header field;
>
> 9) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the \"refresher\" header field parameter is
> omitted. If included, the \"refresher\" header field parameter shall be set
> to \"uac\";
>
> 10) shall set the Request-URI of the SIP INVITE request to the public
> service identity identifying the participating MCPTT function serving the
> MCPTT user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 11) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> 12) if the MCPTT client emergency group state for this group is set to \"MEG
> 2: in-progress\" or \"MEG 4: confirm-pending\", the MCPTT client shall
> include the Resource-Priority header field and comply with the procedures in
> subclause 6.2.8.1.2;
>
> 13) if the MCPTT client imminent peril group state for this group is set to
> \"MIG 2: in-progress\" or \"MIG 4: confirm-pending\" shall include the
> Resource-Priority header field and comply with the procedures in subclause
> 6.2.8.1.12;
>
> 14) shall contain in an application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"prearranged\";
>
> b) the \ element set to the group identity;
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client;
>
> NOTE 2: The MCPTT client does not include the MCPTT ID of the originating
> MCPTT user in the body, as this will be inserted into the body of the SIP
> INVITE request that is sent from the originating participating MCPTT
> function.
>
> d) if the group identity can be determined to be a TGI and if the MCPTT
> client can associate the TGI with a MCPTT group ID, the \ id> element set to the MCPTT group ID; and
>
> e) if the MCPTT client is aware of active functional-aliases, and an active
> functional alias is to be included in the initial SIP INVITE request, the
> \ set to the URI of the used functional alias;
>
> NOTE 3: The text \"can associate the TGI with a MCPTT group ID\" means that
> the MCPTT client is able to determine that there is a constituent group of
> the temporary group that it is a member of.
>
> NOTE 4: The MCPTT client is informed about temporary groups and regrouping
> of MCPTT groups that the user is a member of as specified in 3GPP TS 24.481
> [31].
>
> NOTE 5: If the MCPTT user selected a TGI where there are several MCPTT
> groups where the MCPTT user is a member, the MCPTT client selects one of
> those MCPTT groups.
>
> NOTE 6: The MCPTT client learns the functional aliases that are activated
> for an MCPTT ID from procedures specified in subclause 9A.2.1.3.
>
> 15) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.1;
>
> 16) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 17) shall send the SIP INVITE request towards the MCPTT server according to
> 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5] ;
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in subclause 6.2.8.1.4;
>
> 2A) may notify the answer state to the user (i.e. \"Unconfirmed\" or
> \"Confirmed\") if received in the P-Answer-State header field; and
>
> 3) may subscribe to the conference event package as specified in subclause
> 10.1.3.1.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request:
> 1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\"; or
>
> 2) if the MCPTT imminent peril group call state is set to \"MIGC 2:
> imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";
the MCPTT client shall perform the actions specified in subclause 6.2.8.1.5.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in subclause 6.2.8.1.13.
[TS 24.379, clause 6.2.4.1]
Upon receiving a request from an MCPTT user to leave an MCPTT session
established using on-demand session signalling, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 3) shall set the Request-URI to the MCPTT session identity to leave; and
>
> 4) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT
client shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.380, clause 6.2.4.2.2]
When a call is initiated as described in 3GPP TS 24.379 [2], the floor
participant:
> 1\. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\';
>
> 2\. if the originating floor participant receives a floor control message
> before it receives the SIP 200 (OK) response, shall store the floor control
> message;
>
> NOTE: The originating floor participant might receive a floor control
> message before the SIP 200 (OK) response when initiating, joining or
> rejoining a call because of processing delays of the SIP 200 (OK) response
> in the SIP core.
>
> 3\. if the established MCPTT call is a chat group call and the SIP INVITE
> request is not an implicit floor request, shall enter the \'U: has no
> permission\' state; and
>
> 4\. if for the established MCPTT call the SIP INVITE request is an implicit
> floor request:
>
> a. shall start timer T101 (Floor Request) and initialise counter C101 (Floor
> Request) to 1;
>
> b. shall enter the \'U: pending Request\' state; and
>
> c. if the floor participant has received and stored a floor control message
> before the reception of the SIP 200 (OK) response, shall act as if the floor
> control message was received in the \'U: pending Request\' state after
> entering the \'U: pending Request\' state.
When the floor participant is rejoining an ongoing MCPTT call as described in
3GPP TS 24.379 [2] the floor participant shall enter the \'U: has no
permission\' state.
[TS 24.380, clause 6.2.4.3.5]
Upon receiving an indication from the user to request permission to send
media, the floor participant:
> 1\. shall send the Floor Request message toward the floor control server;
> The Floor Request message:
>
> a. if a different priority than the normal priority is required, shall
> include the Floor Priority field with the priority not higher than
> negotiated with the floor control server as specified in subclause 14.3.3;
>
> b. if the floor request is a broadcast group call, system call, emergency
> call or an imminent peril call, shall include a Floor Indicator field
> indicating the relevant call types; and
>
> c. shall include the Location field:
>
> i. if the current location of the talker is not available or is not to be
> reported according to the MCPTT user profile, then the location type is set
> to \'0\' (Not provided); or
>
> ii. if the current location of the talker is available and may be reported
> according to the MCPTT user profile, then the location type and location
> value are set as specified in table 8.2.3.21-3;
>
> 2\. shall start timer T101 (Floor Request) and initialise counter C101
> (Floor Request) to 1; and
>
> 3\. shall enter the \'U: pending Request\' state.
[TS 24.380, clause 6.2.4.4.2]
Upon receiving a Floor Granted message from the floor control server or a
floor granted indication in a SIP 200 (OK) response in the application and
signalling layer, the floor participant:
> 1\. if the first bit in the subtype of the Floor Granted message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'1\' (Floor Granted); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. if the call is not an ambient listening call, shall provide floor
> granted notification to the user, if not already done;
>
> NOTE: Providing the floor granted notification to the user prior to
> receiving the Floor Granted message is an implementation option.
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
> store an indication that the participant is overriding without revoke;
>
> 5\. shall stop the optional timer T103 (End of RTP media), if running;
>
> 6\. shall stop timer T101 (Floor Request); and
>
> 7\. shall enter the \'U: has permission\' state.
##### 6.1.1.21.3 Test description {#test-description-29 .H6}
##### 6.1.1.21.3.1 Pre-test conditions {#pre-test-conditions-29 .H6}
##### System Simulator: {#system-simulator-29 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-29 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-29 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.1.21.3.2 Test procedure sequence {#test-procedure-sequence-29 .H6}
Table 6.1.1.21.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a group | | | | | | | call with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | without | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3A.1.3-1 | | | | | | | to**| | | | | | | establish | | | | | | | a group | | | | | | | call with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | without | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | a of NOTE | | | | | | | 1 in TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | |** 5.3 | | | | | | | A.1.3-1**? | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the floor. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 4 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | Floor | | | | | | | Request -- | | | | | | | Floor | | | | | | | Granted\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3A.11.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 6 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.1.21.3.3 Specific message contents {#specific-message-contents-29
.H6}
Table 6.1.1.21.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.1.21.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.1.1.21.3.3-2  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.1.21.3.3-3
Table 6.1.1.21.3.3-2: SDP in SIP INVITE (Table 6.1.1.21.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_OFFER
* * *
Table 6.1.1.21.3.3-3: MCPTT-Info in SIP INVITE (Table 6.1.1.21.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE_REFER,
GROUP-CALL
* * *
Table 6.1.1.21.3.3-4: SIP 200 (OK) from the SS(step 2, Table 6.1.1.21.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.1.1.21.3.3-5
Table 6.1.1.21.3.3-5: SDP in SIP 200 (OK) (Table 6.1.1.21.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER
* * *
6.1.2 Chat Group Calls
6.1.2.1 Void
6.1.2.2 On-network / Chat Group Call Using Pre-established Session Including
Emergency and Imminent Peril Calls / Client Server originated Pre-established
Session Release with associated MCPTT session / Client Origination (CO)
##### 6.1.2.2.1 Test Purpose (TP) {#test-purpose-tp-30 .H6}
##### (1) {#section-98 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT group session
using an MCPTT group identity identifying a chat MCPTT group that is within a
pre-established session}
**then** { UE (MCPTT Client) requests to join the Chat Group Call within a
pre-established session by generating a SIP REFER message **and** , after
indication from the MCPTT Server that the join request has been accepted, the
user can participate in the group call }
}
##### (2) {#section-99 .H6}
**with** { UE (MCPTT Client) having established a Chat Group Call within a
pre-established session }
ensure that {
**when** { the MCPTT User (MCPTT Client) requests the origination of an
emergency group call }
**then** { UE (MCPTT Client) requests the set up and is able to join an
emergency group call, or if unauthorised indicates to the user that they are
not authorised to set up emergency calls and no call is set up }
}
##### (3) {#section-100 .H6}
**with** { UE (MCPTT Client) having established a Chat Group Call within a
pre-established session }
ensure that {
**when** { the MCPTT User (MCPTT Client) requests the origination of an
imminent peril group call }
**then** { UE (MCPTT Client) requests the set up and is able to join an
imminent peril group call, or if unauthorised indicates to the user that they
are not authorised to set up imminent peril calls and no call is set up }
}
##### (4) {#section-101 .H6}
**with** { UE (MCPTT Client) having established a Chat Group Call within a
pre-established session }
ensure that {
**when** { the UE (MCPTT Client) wishes to leave the MCPTT session within a
pre-established session }
**then** { UE (MCPTT Client) initiates leaving by sending a SIP REFER and
leaves the call }
}
##### 6.1.2.2.2 Conformance Requirements {#conformance-requirements-30 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 4.9, 6.2.4.2, 10.1.2.2.2, 10.1.2.2.3.2. Unless
otherwise stated these are Rel-13 requirements.
[TS 24.379, clause 4.9]
When establishing a pre-established session, the MCPTT client negotiates the
media parameters, including establishing IP addresses and ports using
interactive connectivity establishment (ICE) as specified in IETF RFC 5245
with the participating MCPTT function, prior to using the pre-established
session for establishing MCPTT sessions with other MCPTT users.
The pre-established session can later be used in MCPTT calls. This avoids the
need to negotiate media parameters (including evaluating ICE candidates) and
reserving bearer resources during the MCPTT call establishment that results in
delayed MCPTT call establishment.
The use of pre-established session on the origination side is compatible with
the use of on demand session on the termination side. The use of pre-
established session on the termination side is compatible with the use of on
demand session on the origination side.
[TS 24.379, clause 10.1.2.2.2]
Upon receiving a request from an MCPTT user to establish an MCPTT group
session using an MCPTT group identity identifying a chat MCPTT group within
the pre-established session, the MCPTT client shall generate a SIP REFER
request as specified in IETF RFC 3515 [25] as updated by IETF RFC 6665 [26]
and IETF RFC 7647 [27], and in accordance with the UE procedures specified in
3GPP TS 24.229 [4], with the clarifications given below.
The MCPTT client:
> 1) shall set the Request URI of the SIP REFER request to the session
> identity of the pre-established session;
>
> 2) shall set the Refer-To header field of the SIP REFER request as specified
> in IETF RFC 3515 [25] with a Content-ID (\"cid\") Uniform Resource Locator
> (URL) as specified in IETF RFC 2392 [62] that points to an
> application/resource-lists MIME body as specified in IETF RFC 5366 [20], and
> with the Content-ID header field set to this \"cid\" URL;
>
> 3) shall include in the application/resource-lists MIME body a single
> \ element containing a \"uri\" attribute set to the chat group
> identity, extended with the following URI header fields:
>
> NOTE: Characters that are not formatted as ASCII characters are escaped in
> the following URI header fields;
>
> a) the Accept-Contact header field containing the g.3gpp.mcptt media feature
> tag along with the \"require\" and \"explicit\" header field parameters
> according to IETF RFC 3841 [6];
>
> b) an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag
> containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with
> the \"require\" and \"explicit\" header field parameters according to IETF
> RFC 3841 [6]; and
>
> c) an hname \"body\" URI header field populated with:
>
> i) an application/sdp MIME body containing an SDP offer, if the session
> parameters of the pre-established session require modification or if
> implicit floor control is required, according to the conditions specified in
> subclause 6.4; and
>
> ii) an application/vnd.3gpp.mcptt-info MIME body with:
>
> A) the \ element set to a value of \"chat\"; and
>
> B) the \ element set to the MCPTT client ID of the
> originating MCPTT client;
>
> 4) if the MCPTT user has requested the origination of an MCPTT emergency
> group call or is originating an MCPTT group call and the MCPTT emergency
> state is already set:
>
> a) if this is an authorised request for an MCPTT emergency group call as
> determined by the procedures of subclause 6.2.8.8.1.8, shall comply with the
> procedures in subclause 6.2.8.1.1; and
>
> b) if this is an unauthorised request for an MCPTT emergency group call as
> determined in step a) above, should indicate to the MCPTT user that they are
> not authorised to initiate an MCPTT emergency group call;
>
> ...
>
> 6) if the MCPTT user has requested the origination of an MCPTT imminent
> peril group call:
>
> a) if this is an authorised request for an MCPTT imminent peril group call
> as determined by the procedures of subclause 6.2.8.8.1.8, shall comply with
> the procedures in subclause 6.2.8.1.9;
>
> b) if this is an unauthorised request for an MCPTT imminent peril group call
> as determined in step a) above, should indicate to the MCPTT user that they
> are not authorised to initiate an MCPTT imminent peril group call;
>
> ...
>
> 8) shall include a P-Preferred-Service header field set to the ICSI value
> \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS
> 24.229 [4]), according to IETF RFC 6050 [9];
>
> 9) shall include the following according to IETF RFC 4488 [22]:
>
> a) the option tag \"norefersub\" in the Supported header field; and
>
> b) the value \"false\" in the Refer-Sub header field.
>
> 10) shall include a Target-Dialog header field as specified in IETF RFC 4538
> [23] identifying the pre-established session;
>
> 11) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP REFER request according to IETF RFC 3840 [16]; and
>
> 12) shall send the SIP REFER request according to 3GPP TS 24.229 [4].
On receiving a final SIP 2xx response to the SIP REFER request, the MCPTT
client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5].
On receiving a SIP 4xx response, SIP 5xx response or a SIP 6xx response to the
SIP REFER request:
> 1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\"; or
>
> 2) if the MCPTT imminent peril group call state is set to \"MIGC 2:
> imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";
>
> the MCPTT client shall perform the actions specified in subclause 6.2.8.1.5
> and shall skip the remaining steps.
On receiving a SIP re-INVITE request within the pre-established session
targeted by the sent SIP REFER request, and if the sent SIP REFER request was
a request for an MCPTT emergency group call or an MCPTT imminent peril group
call, the MCPTT client:
> 1) shall perform the actions specified in subclause 6.2.8.1.16;
>
> 2) shall check if a Resource-Priority header field is included in the
> incoming SIP re-INVITE request and may perform further actions outside the
> scope of the present document to act upon an included Resource-Priority
> header field as specified in 3GPP TS 24.229 [4];
>
> 3) shall accept the SIP re-INVITE request and generate a SIP 200 (OK)
> response according to rules and procedures of 3GPP TS 24.229 [4];
>
> 4) shall include an SDP answer in the SIP 200 (OK) response to the SDP offer
> in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4], based
> upon the parameters already negotiated for the pre-established session; and
>
> 5) shall send the SIP 200 (OK) response towards the participating MCPTT
> function according to rules and procedures of 3GPP TS 24.229 [4].
On call release by interaction with the media plane as specified in subclause
9.2.2 of 3GPP TS 24.380 [5] if the sent SIP REFER request was a request for an
MCPTT emergency group call or an MCPTT imminent peril group call, the MCPTT
client shall perform the procedures specified in subclause 6.2.8.1.17.
[TS 24.379, clause 6.2.4.2]
Upon receiving a request from an MCPTT user to leave an MCPTT session within a
pre-established session, the MCPTT client:
> ...
>
> 2) shall generate an initial SIP REFER request outside a dialog in
> accordance with the procedures specified in 3GPP TS 24.229 [4], IETF RFC
> 4488 [22] and IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF
> RFC 7647 [27];
>
> 3) shall set the Request-URI of the SIP REFER request to the public service
> identity identifying the pre-established session on the MCPTT server serving
> the MCPTT user;
>
> 4) shall include the Refer-Sub header field with value \"false\" according
> to rules and procedures of IETF RFC 4488 [22];
>
> 5) shall include the Supported header field with value \"norefersub\"
> according to rules and procedures of IETF RFC 4488 [22];
>
> 6) shall set the Refer-To header field of the SIP REFER request to the MCPTT
> session identity to leave;
>
> 7) shall include the \"method\" SIP URI parameter with the value \"BYE\" in
> the URI in the Refer-To header field;
>
> 8) shall include a Target-Dialog header field as specified in IETF RFC 4538
> [23] identifying the pre-established session; and
>
> 9) shall send the SIP REFER request according to 3GPP TS 24.229 [4].
[TS 24.379, clause 10.1.2.2.3.2]
When an MCPTT client wants to leave the MCPTT session within a pre-established
session, the MCPTT client shall follow the procedures as specified in
subclause 6.2.4.2.
##### 6.1.2.2.3 Test description {#test-description-30 .H6}
##### 6.1.2.2.3.1 Pre-test conditions {#pre-test-conditions-30 .H6}
##### System Simulator: {#system-simulator-30 .H6}
> SS (MCPTT server)
>
> For the underlying \"transport bearer\" over which the SS and the UE will
> communicate Parameters are set to the default parameters for the basic
> E-UTRA Single cell network scenarios, as defined in TS 36.508 [24] clause
> 4.4. The simulated Cell 1 shall belong to PLMN1 (the PLMN specified for
> MCPTT operation in the MCPTT configuration document).
##### IUT: {#iut-30 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-30 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.2.2.3.2 Test procedure sequence {#test-procedure-sequence-30 .H6}
Table 6.1.2.2.3.2-1: Main behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a chat | | | | | | | group | | | | | | | call | | | | | | | using the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session | | | | | | | with | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | esta | | | | | | | blishment | | | | | | | using a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.3.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a chat | | | | | | | group | | | | | | | call with | | | | | | | implicit | | | | | | | floor | | | | | | | control? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3-5 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 6 | The SS | \ | SIP REFER | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP REFER | | | | | | | request | | | | | | | with | | | | | | | \ | | | | | | | set true? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | The SS | \ | SIP REFER | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP REFER | | | | | | | request | | | | | | | with | | | | | | | \ | | | | | | | set to | | | | | | | true? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 24 | The SS | \ 1) if the MCPTT user has requested the origination of an MCPTT emergency
> group call or is originating an MCPTT chat group call and the MCPTT
> emergency state is already set, the MCPTT client shall comply with the
> procedures in subclause 6.2.8.1.1;
>
> ...
>
> 3) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 4) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 5) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 6) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 7) should include the \"timer\" option tag in the Supported header field;
>
> 8) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the refresher parameter is omitted. If
> included, the refresher parameter shall be set to \"uac\";
>
> 9) shall set the Request-URI of the SIP INVITE request to the public service
> identity identifying the participating MCPTT function serving the MCPTT
> user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 10) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> 11) if the MCPTT client emergency group state for this group is set to \"MEG
> 2: in-progress\" or \"MEG 4: confirm-pending\", the MCPTT client shall
> comply with the procedures in subclause 6.2.8.1.2;
>
> ...
>
> 13) shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element containing the \ element with:
>
> a) the \ element set to a value of \"chat\";
>
> b) the \ element set to the group identity; and
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client;
>
> NOTE 2: The MCPTT ID of the originating MCPTT user is not included in the
> body, as this will be inserted into the body of the SIP INVITE request that
> is sent by the originating participating MCPTT function.
>
> 14) shall include in the SIP INVITE request an SDP offer according to 3GPP
> TS 24.229 [4] with the clarifications specified in subclause 6.2.1;
>
> 15) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 16) shall send the SIP INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in subclause 6.2.8.1.4.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request:
> 1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\"; or
>
> ...
>
> the MCPTT client shall perform the actions specified in subclause 6.2.8.1.5.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in subclause 6.2.8.1.13.
[TS 24.380, clause 6.2.4.4.2]
Upon receiving a Floor Granted message from the floor control server or a
floor granted indication in a SIP 200 (OK) response in the application and
signalling layer, the floor participant:
> 1\. if the first bit in the subtype of the Floor Granted message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'1\' (Floor Granted); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. shall provide floor granted notification to the user, if not already
> done;
>
> NOTE: Providing the floor granted notification to the user prior to
> receiving the Floor Granted message is an implementation option.
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
> store an indication that the participant is overriding without revoke;
>
> 5\. shall stop the optional timer T103 (End of RTP media), if running;
>
> 6\. shall stop timer T101 (Floor Request); and
7\. shall enter the \'U: has permission\' state.
##### 6.1.2.7.3 Test description {#test-description-31 .H6}
##### 6.1.2.7.3.1 Pre-test conditions {#pre-test-conditions-31 .H6}
##### System Simulator: {#system-simulator-31 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-31 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-31 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.2.7.3.2 Test procedure sequence {#test-procedure-sequence-31 .H6}
Table 6.1.2.7.3.2-1: Main behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of an | | | | | | | emmergency | | | | | | | chat group | | | | | | | call with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3A.1.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a chat | | | | | | | group call | | | | | | | with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.ii of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.1.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 3-8 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 9 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 10 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 11 | The UE | - | - | - | - | | | (MCPTT | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.10.3-1. | | | | | +------------+------------+------------+---------+---------+----+ | 12 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.2.7.3.3 Specific message contents {#specific-message-contents-31
.H6}
Table 6.1.2.7.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.2.7.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition EMERGENCY-CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.1.2.7.3.3-1A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.2.7.3.3-2
Table 6.1.2.7.3.3-1A: SDP in SIP INVITE (Table 6.1.2.7.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
INITIAL_SDP_OFFER, IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.2.7.3.3-2: MCPTT-Info in SIP INVITE (Table 6.1.2.7.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition EMERGENCY-CALL,
INVITE_REFER, CHAT-GROUP-CALL
* * *
Table 6.1.2.7.3.3-3..4: Void
Table 6.1.2.7.3.3-5: SIP 200 (OK) from the SS (step 2, Table 6.1.2.7.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.1.2.7.3.3-6
Table 6.1.2.7.3.3-6: SDP in SIP 200 (OK) (Table 6.1.1.3.3.3-2A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.2.7.3.3-7: Floor Granted (step 2, Table 6.1.2.7.3.2-1;\ step 6a1, TS
36.579-1 [2] Table 5.3A.1.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.3-1, condition EMERGENCY-CALL
* * *
6.1.2.8 On-network / Chat Group Call / Emergency Group Call / Client
Terminated (CT)
##### 6.1.2.8.1 Test Purpose (TP) {#test-purpose-tp-32 .H6}
##### (1) {#section-103 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT Client receives a SIP INVITE message with an emergency
indication for an MCPTT On-demand Chat Group Emergency Group Call }
**then** { the UE (MCPTT Client) sends a SIP 200 OK as a response to the SIP
INVITE message **and** respects floor control }
}
##### 6.1.2.8.2 Conformance requirements {#conformance-requirements-32 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clause 10.1.2.2.1.6, TS 24.380, clause 6.2.4.3.3.
Unless otherwise stated, these are Rel-13 requirements.
[TS 24.379, clause 10.1.2.2.1.6]
This procedure is used for MCPTT emergency and MCPTT imminent peril calls when
the MCPTT client is affiliated but not joined to the chat group.
In the procedures in this subclause:
> 1) emergency indication in an incoming SIP INVITE request refers to the
> \ element of the application/vnd.3gpp.mcptt-info+xml MIME
> body; and
>
> ...
Upon receipt of an initial SIP INVITE request, the MCPTT client:
> ...
>
> 3) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
> MIME body with the \ element containing the \
> element with the \ element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication that this is a SIP INVITE
> request for an MCPTT emergency group call and:
>
> i) should display the MCPTT ID of the originator of the MCPTT emergency
> group call contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body;
>
> ii) should display the MCPTT group identity of the group with the emergency
> condition contained in the \ element; and
>
> iii) if the \ element is set to \"true\", should display to the
> MCPTT user an indication of the MCPTT emergency alert and associated
> information;
>
> b) shall set the MCPTT emergency group state to \"MEG 2: in-progress\";
...
> 6) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
> according to rules and procedures of 3GPP TS 24.229 [4];
>
> 7) shall include the option tag \"timer\" in a Require header field of the
> SIP 200 (OK) response;
>
> 8) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 200 (OK) response;
>
> 9) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 200 (OK) response;
>
> 10) shall include the Session-Expires header field in the SIP 200 (OK)
> response and start the SIP session timer according to IETF RFC 4028 [7]. If
> no \"refresher\" parameter was included in the received SIP INVITE request
> the \"refresher\" parameter in the Session-Expires header field shall be set
> to \"uas\", otherwise shall include a \"refresher\" parameter set to the
> value received in the Session-Expires header field the received SIP INVITE
> request;
>
> 11) shall include an SDP answer in the SIP 200 (OK) response to the SDP
> offer in the incoming SIP INVITE request according to 3GPP TS 24.229 [4]
> with the clarifications given in subclause 6.2.2;
>
> 12) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4]; and
>
> 13) shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.380, clause 6.2.4.3.3]
Upon receiving the Floor Taken message, the floor participant:
> 1\. if the first bit in the subtype of the Floor Taken message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'2\' (Floor Taken); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. may provide a floor taken notification to the user;
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. should start the optional timer T103 (End of RTP media); and
>
> 5\. shall remain in the \'U: has no permission\' state.
##### 6.1.2.8.3 Test description {#test-description-32 .H6}
##### 6.1.2.8.3.1 Pre-test conditions {#pre-test-conditions-32 .H6}
##### System Simulator: {#system-simulator-32 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-32 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-32 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.2.8.3.2 Test procedure sequence {#test-procedure-sequence-32 .H6}
Table 6.1.2.8.3.2-1: Main behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                                                                                                                                         U - S              Message
1 Check: Does the UE (MCPTT client) correctly perform procedure \'MCX CT
session establishment/modification without provisional responses other than
100 Trying\' as described in TS 36.579-1 [2] Table 5.3.4.3-1 to establish an
emergency chat group call with automatic commencement mode? - - 1 P 1A-3 Void
- - - - 3A The SS (MCPTT server) sends a Floor Taken message with request for
acknowledgement. \ Floor Ack 1 P 4 The procedure \'MCX CT
call release\' as described in TS 36.579-1 [2], Table 5.3.12.3-1 is performed.
- - - - 5 Void - - - -
##### 6.1.2.8.3.3 Specific message contents {#specific-message-contents-32
.H6}
Table 6.1.2.8.3.3-1: SIP INVITE from the SS (step 1, Table 6.1.2.8.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME part body SDP Message as described in Table 6.1.2.8.3.3-1A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.2.8.3.3-1B
Table 6.1.2.8.3.3-1A: SDP in SIP INVITE (Table 6.1.2.8.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition
INITIAL_SDP_OFFER
* * *
Table 6.1.2.8.3.3-1B: MCPTT-Info in SIP INVITE (Table 6.1.2.8.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition CHAT-GROUP-
CALL, EMERGENCY-CALL
* * *
Table 6.1.2.8.3.3-2: SIP 200 (OK) from the UE(step 1, Table 6.1.2.8.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME part body SDP Message as described in Table 6.1.2.8.3.3-2A  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.1.2.8.3.3-2B
Table 6.1.2.8.3.3-2A: SDP in SIP 200 (OK) (Table 6.1.2.8.3.3-2)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_ANSWER
* * *
Table 6.1.2.8.3.3-2B: MCPTT-Info in SIP 200 (OK) (Table 6.1.2.8.3.3-2)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
Table 6.1.2.8.3.3-3: Floor Taken (step 3A, Table 6.1.2.8.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.7-1, condition EMERGENCY-CALL,
ACK
* * *
Table 6.1.2.8.3.3-4..5: Void
6.1.2.9 On-network / Chat Group Call / Imminent Peril Group Call / Client
Originated (CO)
##### 6.1.2.9.1 Test Purpose (TP) {#test-purpose-tp-33 .H6}
##### (1) {#section-104 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT On-demand
Chat Group Imminent Peril Group Call }
**then** { UE (MCPTT Client) sends a SIP INVITE message to setup the Chat
Group Imminent Peril Group Call **and** provides floor granted notification to
the MCPTT User }
}
##### 6.1.2.9.2 Conformance requirements {#conformance-requirements-33 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clause 10.1.2.2.1.1, TS 24.380, clause 6.2.4.4.2.
Unless otherwise stated, these are Rel-13 requirements.
[TS 24.379, clause 10.1.2.2.1.1]
Upon receiving a request from an MCPTT user to initiate or join an MCPTT group
session using an MCPTT group identity, identifying a chat MCPTT group, the
MCPTT client shall generate an initial SIP INVITE request by following the UE
originating session procedures specified in 3GPP TS 24.229 [4], with the
clarifications given below.
The MCPTT client:
> ...
>
> 2) if the MCPTT user has requested the origination of an MCPTT imminent
> peril group call, the MCPTT client shall comply with the procedures in
> subclause 6.2.8.1.9;
>
> 3) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 4) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 5) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 6) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 7) should include the \"timer\" option tag in the Supported header field;
>
> 8) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the refresher parameter is omitted. If
> included, the refresher parameter shall be set to \"uac\";
>
> 9) shall set the Request-URI of the SIP INVITE request to the public service
> identity identifying the participating MCPTT function serving the MCPTT
> user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 10) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> ...
>
> 12) if the MCPTT client imminent peril group state for this group is set to
> \"MIG 2: in-progress\" or \"MIG 4: confirm-pending\" shall include the
> Resource-Priority header field and comply with the procedures in subclause
> 6.2.8.1.12;
>
> 13) shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element containing the \ element with:
>
> a) the \ element set to a value of \"chat\";
>
> b) the \ element set to the group identity; and
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client;
>
> NOTE 2: The MCPTT ID of the originating MCPTT user is not included in the
> body, as this will be inserted into the body of the SIP INVITE request that
> is sent by the originating participating MCPTT function.
>
> 14) shall include in the SIP INVITE request an SDP offer according to 3GPP
> TS 24.229 [4] with the clarifications specified in subclause 6.2.1;
>
> 15) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 16) shall send the SIP INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in subclause 6.2.8.1.4.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request:
> ...
>
> 2) if the MCPTT imminent peril group call state is set to \"MIGC 2:
> imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";
>
> the MCPTT client shall perform the actions specified in subclause 6.2.8.1.5.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in subclause 6.2.8.1.13.
[TS 24.380, clause 6.2.4.4.2]
Upon receiving a Floor Granted message from the floor control server or a
floor granted indication in a SIP 200 (OK) response in the application and
signalling layer, the floor participant:
> 1\. if the first bit in the subtype of the Floor Granted message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'1\' (Floor Granted); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. shall provide floor granted notification to the user, if not already
> done;
>
> NOTE: Providing the floor granted notification to the user prior to
> receiving the Floor Granted message is an implementation option.
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
> store an indication that the participant is overriding without revoke;
>
> 5\. shall stop the optional timer T103 (End of RTP media), if running;
>
> 6\. shall stop timer T101 (Floor Request); and
>
> 7\. shall enter the \'U: has permission\' state.
##### 6.1.2.9.3 Test description {#test-description-33 .H6}
##### 6.1.2.9.3.1 Pre-test conditions {#pre-test-conditions-33 .H6}
##### System Simulator: {#system-simulator-33 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-33 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-33 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.2.9.3.2 Test procedure sequence {#test-procedure-sequence-33 .H6}
Table 6.1.2.9.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of an | | | | | | | imminent | | | | | | | peril chat | | | | | | | group call | | | | | | | with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3A.1.3-1 | | | | | | | to | | | | | | | establish | | | | | | | an | | | | | | | imminent | | | | | | | peril chat | | | | | | | group call | | | | | | | with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.ii of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.1.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 3-8 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 9 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 10 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 11 | The UE | - | - | - | - | | | (MCPTT | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.10.3-1. | | | | | +------------+------------+------------+---------+---------+----+ | 12 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.2.9.3.3 Specific message contents {#specific-message-contents-33
.H6}
Table 6.1.2.9.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.2.9.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition IMMPERIL-CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.1.2.9.3.3-1A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.2.9.3.3-2
Table 6.1.2.9.3.3-1A: SDP in SIP INVITE (Table 6.1.2.9.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
INITIAL_SDP_OFFER, IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.2.9.3.3-2: MCPTT-Info in SIP INVITE (Table 6.1.2.9.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition IMMPERIL-CALL,
CHAT-GROUP-CALL
* * *
Table 6.1.2.9.3.3-2A: SIP 200 (OK) from the SS (step 2, Table 6.1.2.9.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.1.2.9.3.3-2B
Table 6.1.2.9.3.3-2B: SDP in SIP 200 (OK) (Table 6.1.1.3.3.3-2A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.2.9.3.3-3: Floor Granted (step 2, Table 6.1.2.9.3.2-1;\ step 6a1, TS
36.579-1 [2] Table 5.3A.1.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.3-1, condition IMMPERIL-CALL
* * *
6.1.2.10 On-network / Chat Group Call / Imminent Peril Group Call / Client
Terminated (CT)
##### 6.1.2.10.1 Test Purpose (TP) {#test-purpose-tp-34 .H6}
##### (1) {#section-105 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT Client receives a SIP INVITE message for an On-demand
MCPTT Chat Group Imminent Peril Group Call }
**then** { the UE (MCPTT Client) sends a SIP 200 OK as a response to the SIP
INVITE message **and** respects floor control }
}
##### 6.1.2.10.2 Conformance requirements {#conformance-requirements-34 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clause 10.1.2.2.1.6, TS 24.380, clause 6.2.4.3.3.
Unless otherwise stated, these are Rel-13 requirements.
[TS 24.379, clause 10.1.2.2.1.6]
This procedure is used for MCPTT emergency and MCPTT imminent peril calls when
the MCPTT client is affiliated but not joined to the chat group.
In the procedures in this subclause:
> ...
>
> 2) imminent peril indication in an incoming SIP INVITE request refers to the
> \ element of the application/vnd.3gpp.mcptt-info+xml MIME
> body.
Upon receipt of an initial SIP INVITE request, the MCPTT client:
> ...
>
> 4) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
> MIME body with the \ element containing the \
> element with the \ element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication that this is a SIP INVITE
> request for an MCPTT imminent peril group call and:
>
> i) should display the MCPTT ID of the originator of the MCPTT imminent peril
> group call contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> ii) should display the MCPTT group identity of the group with the imminent
> peril condition contained in the \ element; and
>
> b) shall set the MCPTT imminent peril group state to \"MIG 2: in-progress\";
>
> 5) shall check if a Resource-Priority header field is included in the
> incoming SIP INVITE request and may perform further actions outside the
> scope of the present document to act upon an included Resource-Priority
> header field as specified in 3GPP TS 24.229 [4];
>
> 6) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
> according to rules and procedures of 3GPP TS 24.229 [4];
>
> 7) shall include the option tag \"timer\" in a Require header field of the
> SIP 200 (OK) response;
>
> 8) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 200 (OK) response;
>
> 9) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 200 (OK) response;
>
> 10) shall include the Session-Expires header field in the SIP 200 (OK)
> response and start the SIP session timer according to IETF RFC 4028 [7]. If
> no \"refresher\" parameter was included in the received SIP INVITE request
> the \"refresher\" parameter in the Session-Expires header field shall be set
> to \"uas\", otherwise shall include a \"refresher\" parameter set to the
> value received in the Session-Expires header field the received SIP INVITE
> request;
>
> 11) shall include an SDP answer in the SIP 200 (OK) response to the SDP
> offer in the incoming SIP INVITE request according to 3GPP TS 24.229 [4]
> with the clarifications given in subclause 6.2.2;
>
> 12) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4]; and
>
> 13) shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.380, clause 6.2.4.3.3]
Upon receiving the Floor Taken message, the floor participant:
> 1\. if the first bit in the subtype of the Floor Taken message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'2\' (Floor Taken); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. may provide a floor taken notification to the user;
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. should start the optional timer T103 (End of RTP media); and
>
> 5\. shall remain in the \'U: has no permission\' state.
##### 6.1.2.10.3 Test description {#test-description-34 .H6}
##### 6.1.2.10.3.1 Pre-test conditions {#pre-test-conditions-34 .H6}
##### System Simulator: {#system-simulator-34 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-34 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-34 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.2.10.3.2 Test procedure sequence {#test-procedure-sequence-34 .H6}
Table 6.1.2.10.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                                                                                                                                              U - S              Message
1 Check: Does the UE (MCPTT client) correctly perform procedure \'MCX CT
session establishment/modification without provisional responses other than
100 Trying\' as described in TS 36.579-1 [2] Table 5.3.4.3-1 to establish an
imminent peril chat group call with automatic commencement mode? - - 1 P 1A-3
Void - - - - 3A The SS (MCPTT server) sends a Floor Taken message with request
for acknowledgement. \ Floor Ack 1 P 4 The procedure
\'MCX CT call release\' as described in TS 36.579-1 [2], Table 5.3.12.3-1 is
performed. - - - - 5 Void - - - -
##### 6.1.2.10.3.3 Specific message contents {#specific-message-contents-34
.H6}
Table 6.1.2.10.3.3-1: SIP INVITE from the SS (step 1, Table 6.1.2.10.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME part body SDP Message as described in Table 6.1.2.10.3.3-1A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.2.10.3.3-2
Table 6.1.2.10.3.3-1A: SDP in SIP INVITE (Table 6.1.2.10.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition
INITIAL_SDP_OFFER
* * *
Table 6.1.2.10.3.3-2: MCPTT-Info in SIP INVITE (Table 6.1.2.10.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition IMMPERIL-CALL,
CHAT-GROUP-CALL
* * *
Table 6.1.2.10.3.3-2A: SIP 200(OK) from the UE (step 1, Table 6.1.2.10.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME part body SDP Message as described in Table 6.1.2.10.3.3-2B  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.1.2.10.3.3-2C
Table 6.1.2.10.3.3-2B: SDP in SIP 200 (OK) (Table 6.1.2.10.3.3-2A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_ANSWER
* * *
Table 6.1.2.10.3.3-2C: MCPTT-Info in SIP 200 (OK) (Table 6.1.2.10.3.3-2A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
Table 6.1.2.10.3.3-3: Floor Taken (step 3A, Table 6.1.2.10.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.7-1, condition IMMPERIL-CALL
* * *
Table 6.1.2.10.3.3-4..5: Void
6.1.2.11 On-network / Chat Group Call / Join Chat Group Session / Upgrade to
Emergency / Cancel Emergency / Upgrade to Imminent Peril / Cancel Imminent
Peril / Client Originated (CO)
##### 6.1.2.11.1 Test Purpose (TP) {#test-purpose-tp-35 .H6}
##### (1) {#section-106 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests to initiate an MCPTT On-demand Chat Group
Call with implicit floor control }
**then** { UE (MCPTT Client) sends a SIP INVITE message **and** respects the
floor control imposed by the MCPTT Server **and** provides floor granted
notification to the MCPTT User }
}
##### (2) {#section-107 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Chat Group Call }
ensure that {
**when** { the MCPTT User requests to upgrade the MCPTT group session to an
emergency condition }
**then** { UE (MCPTT Client) sends a SIP re-INVITE message **and** respects
the floor control imposed by the MCPTT Server **and** provides floor granted
notification to the MCPTT User }
}
##### (3) {#section-108 .H6}
**with** { UE (MCPTT Client) having an ongoing Emergency Chat Group Call }
ensure that {
**when** { the MCPTT User requests to cancel the in-progress emergency
condition }
**then** { UE (MCPTT Client) sends a SIP re-INVITE message and upon receipt of
a SIP 2xx response considers the emergency condition cancelled and correctly
interacts with the media plane }
}
##### (4) {#section-109 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Chat Group Call }
ensure that {
**when** { the MCPTT User requests to upgrade the MCPTT group session to an
imminent peril condition }
**then** { UE (MCPTT Client) sends a SIP re-INVITE message **and** respects
the floor control imposed by the MCPTT Server **and** provides floor granted
notification to the MCPTT User }
}
##### (5) {#section-110 .H6}
**with** { UE (MCPTT Client) having an ongoing Imminent Peril Chat Group Call
}
ensure that {
**when** { the MCPTT User requests to cancel the in-progress imminent peril
condition }
**then** { UE (MCPTT Client) sends a SIP re-INVITE message **and** upon
receipt of a SIP 2xx response considers the imminent peril condition cancelled
and correctly interacts with the media plane }
}
##### (6) {#section-111 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Chat
Group Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) wants to terminate the ongoing MCPTT
Chat Group Call }
**then** { UE (MCPTT Client) sends a SIP BYE request and leaves the MCPTT
session }
}
##### 6.1.2.11.2 Conformance requirements {#conformance-requirements-35 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clauses 10.1.2.2.1.1, 6.2.4.1, 10.1.2.2.1.4,
6.2.8.1.1, 6.2.8.1.2, 6.2.8.1.4, 10.1.2.2.1.3, 10.1.2.2.1.5, TS 24.380,
clauses 6.2.4.2.2, 6.2.4.5.3. Unless otherwise stated, these are Rel-13
requirements.
[TS 24.379, clause 10.1.2.2.1.1]
Upon receiving a request from an MCPTT user to initiate or join an MCPTT group
session using an MCPTT group identity, identifying a chat MCPTT group, the
MCPTT client shall generate an initial SIP INVITE request by following the UE
originating session procedures specified in 3GPP TS 24.229 [4], with the
clarifications given below.
The MCPTT client:
> ...
>
> 3) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 4) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 5) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 6) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 7) should include the \"timer\" option tag in the Supported header field;
>
> 8) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the refresher parameter is omitted. If
> included, the refresher parameter shall be set to \"uac\";
>
> 9) shall set the Request-URI of the SIP INVITE request to the public service
> identity identifying the participating MCPTT function serving the MCPTT
> user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 10) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> ...
>
> 13) shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element containing the \ element with:
>
> a) the \ element set to a value of \"chat\";
>
> b) the \ element set to the group identity; and
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client;
>
> NOTE 2: The MCPTT ID of the originating MCPTT user is not included in the
> body, as this will be inserted into the body of the SIP INVITE request that
> is sent by the originating participating MCPTT function.
>
> 14) shall include in the SIP INVITE request an SDP offer according to 3GPP
> TS 24.229 [4] with the clarifications specified in subclause 6.2.1;
>
> 15) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 16) shall send the SIP INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in subclause 6.2.8.1.4.
[TS 24.379, clause 6.2.4.1]
Upon receiving a request from an MCPTT user to leave an MCPTT session
established using on-demand session signalling, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 3) shall set the Request-URI to the MCPTT session identity to leave; and
>
> 4) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT
client shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.379, clause 10.1.2.2.1.4]
This subclause covers both on-demand session and pre-established sessions.
Upon receiving a request from an MCPTT user to upgrade the MCPTT group session
to an emergency condition or an imminent peril condition on a chat MCPTT
group, the MCPTT client shall generate a SIP re-INVITE request as specified in
3GPP TS 24.229 [4], with the clarifications given below.
> 1) if the MCPTT user is requesting to upgrade the MCPTT group session to an
> in-progress emergency group state and is not authorised to do so as
> determined by the procedures of subclause 6.2.8.1.8, the MCPTT client:
>
> a) should indicate to the MCPTT user that they are not authorised to upgrade
> the MCPTT group session to an in-progress emergency group state; and
>
> b) shall skip the remaining steps of the current subclause;
>
> 2) if the MCPTT user is requesting to upgrade the MCPTT group session to an
> in-progress imminent peril state and is not authorised to do so as
> determined by the procedures of subclause 6.2.8.1.8, the MCPTT client:
>
> a) should indicate to the MCPTT user that they are not authorised to upgrade
> the MCPTT group session to an in-progress imminent peril group state; and
>
> b) shall skip the remaining steps of the current subclause;
>
> 3) if the MCPTT user has requested to upgrade the MCPTT group session to an
> MCPTT emergency call, the MCPTT client:
>
> a) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated
> as specified in subclause 6.2.8.1.1; and
>
> b) shall include a Resource-Priority header field and comply with the
> procedures in subclause 6.2.8.1.2.
>
> 4) if the MCPTT user has requested to upgrade the MCPTT group session to an
> MCPTT imminent peril call, the MCPTT client:
>
> a) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated
> as specified in subclause 6.2.8.1.9; and
>
> b) shall include a Resource-Priority header field and comply with the
> procedures in subclause 6.2.8.1.12;
>
> 5) if the SIP re-INVITE request is to be sent within an on-demand session,
> shall include in the SIP re-INVITE request an SDP offer according to 3GPP TS
> 24.229 [4] with the clarifications specified in subclause 6.2.1;
>
> 6) if the SIP re-INVITE request is to be sent within a pre-established
> session, shall include an SDP offer in the SIP re-INVITE request according
> to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the
> pre-established session;
>
> NOTE: The SIP re-INVITE request can be sent within an on-demand session or a
> pre-established session associated with an MCPTT group session. If the SIP
> re-INVITE request is sent within a pre-established session, the media-level
> section for the offered MCPTT speech media stream and the media-level
> section of the offered media-floor control entity are expected to be the
> same as was negotiated in the existing pre-established session.
>
> 7) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4;
>
> 8) shall include a Resource-Priority header field and comply with the
> procedures in subclause 6.2.8.1.2; and
>
> 9) shall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP re-INVITE request the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall perform the actions specified in subclause 6.2.8.1.4.
[TS 24.379, clause 6.2.8.1.1]
This subclause is referenced from other procedures.
When the MCPTT emergency state is set and the MCPTT user is authorised to
initiate an MCPTT emergency group call on the targeted MCPTT group as
determined by the procedures of subclause 6.2.8.1.8, the MCPTT client:
> 1) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the
> SIP INVITE request or SIP REFER request, an \ element set to
> \"true\" and if the MCPTT emergency group call state is set to \"MEGC 1:
> emergency-gc-capable\", shall set the MCPTT emergency group call state to
> \"MEGC 2: emergency-call-requested\";
>
> 2) if the MCPTT user has also requested an MCPTT emergency alert to be sent
> and this is an authorised request for MCPTT emergency alert as determined by
> the procedures of subclause 6.2.8.1.6, and the MCPTT emergency alert state
> is set to \"MEA 1: no-alert\", shall:
>
> a) set the \ element of the application/vnd.3gpp.mcptt-info+xml
> MIME body to \"true\" and set the MCPTT emergency alert state to \"MEA 2:
> emergency-alert-confirm-pending\"; and
>
> b) include in the SIP INVITE request the specific location information for
> MCPTT emergency alert as specified in subclause 6.2.9.1;
>
> 3) if the MCPTT user has not requested an MCPTT emergency alert to be sent
> and the MCPTT emergency alert state is set to \"MEA 1: no-alert\", shall set
> the \ element of the application/vnd.3gpp.mcptt-info+xml MIME
> body to \"false\"; and
>
> 4) if the MCPTT client emergency group state of the group is set to a value
> other than \"MEG 2: in-progress\" set the MCPTT client emergency group state
> of the MCPTT group to \"MEG 4: confirm-pending\".
>
> NOTE 1: This is the case of an MCPTT user already being in the MCPTT
> emergency state it initiated previously while originating an MCPTT emergency
> group call or MCPTT emergency alert. All group calls the MCPTT user
> originates while in MCPTT emergency state will be MCPTT emergency group
> calls.
When the MCPTT emergency state is clear and the MCPTT emergency group call
state is set to \"MEGC 1: emergency-gc-capable\" and the received SIP request
contains an authorised request for MCPTT emergency group call as determined by
the procedures of subclause 6.2.8.1.8, the MCPTT client shall set the MCPTT
emergency state and perform the following actions:
> 1) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the
> SIP INVITE request or SIP REFER request an \ element set to
> \"true\" and set the MCPTT emergency group call state to \"MEGC 2:
> emergency-call-requested\" state;
>
> 2) if the MCPTT user has also requested an MCPTT emergency alert to be sent
> and this is an authorised request for MCPTT emergency alert as determined by
> the procedures of subclause 6.2.8.1.6, shall:
>
> a) include in the application/vnd.3gpp.mcptt-info+xml MIME body the \ ind> element set to \"true\" and set the MCPTT emergency alert state to
> \"MEA 2: emergency-alert-confirm-pending\"; and
>
> b) include in the SIP INVITE request the specific location information for
> MCPTT emergency alert as specified in subclause 6.2.9.1;
>
> 3) if the MCPTT user has not requested an MCPTT emergency alert to be sent,
> shall set the \ element of the application/vnd.3gpp.mcptt-
> info+xml MIME body to \"false\"; and
>
> 4) if the MCPTT client emergency group state of the group is set to a value
> other than \"MEG 2: in-progress\" shall set the MCPTT client emergency group
> state of the MCPTT group to \"MEG 4: confirm-pending\".
>
> NOTE 2: This is the case of an initial MCPTT emergency group call and
> optionally an MCPTT emergency alert being sent. As the MCPTT emergency state
> is not sent, there is no MCPTT emergency alert outstanding.
>
> NOTE 3: An MCPTT group call originated by an affiliated member of an MCPTT
> group which is in an in-progress emergency state (as tracked on the MCPTT
> client by the MCPTT client emergency group state) but is not in an MCPTT
> emergency state of their own will also be an MCPTT emergency group call. The
> \ and \ elements of the
> application/vnd.3gpp.mcptt-info+xml MIME body do not need to be included in
> this case and hence no action needs to be taken in this subclause.
[TS 24.379, clause 6.2.8.1.2]
This subclause is referenced from other procedures.
If the MCPTT emergency group call state is set to either \"MEGC 2: emergency-
call-requested\" or \"MEGC 3: emergency-call-granted\" and this is an
authorised request for an MCPTT emergency group call as determined by the
procedures of subclause 6.2.8.1.8, or the MCPTT client emergency group state
of the group is set to \"MEG 2: in-progress\", the MCPTT client shall include
in the SIP INVITE request or SIP REFER request a Resource-Priority header
field populated with the values for an MCPTT emergency group call as specified
in subclause 6.2.8.1.15.
> NOTE: The MCPTT client ideally would not need to maintain knowledge of the
> in-progress emergency state of the group (as tracked on the MCPTT client by
> the MCPTT client emergency group state) but can use this knowledge to
> provide a Resource-Priority header field set to emergency level priority,
> which starts the infrastructure priority adjustment process sooner than
> otherwise would be the case.
If this is an authorised request to cancel the MCPTT emergency group call as
determined by the procedures of subclause 6.2.8.1.7, and the MCPTT client
emergency group state of the group is \"no-emergency\" or \"cancel-pending\",
the MCPTT client shall include in the SIP INVITE request or SIP REFER request
a Resource-Priority header field populated with the values for a normal MCPTT
group call as specified in subclause 6.2.8.1.15.
[TS 24.379, clause 6.2.8.1.4]
In the procedures in this subclause, a priority group call refers to an MCPTT
emergency group call or an MCPTT imminent peril group call.
On receiving a SIP 2xx response to a SIP request for a priority group call,
the MCPTT client:
> 1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\":
>
> a) shall set the MCPTT client emergency group state of the group to \"MEG 2:
> in-progress\" if it was not already set;
>
> b) if the MCPTT emergency alert state is set to \"MEA 2: emergency-alert-
> confirm-pending\" and the SIP 2xx response to the SIP request for a priority
> group call does not contain a Warning header field as specified in subclause
> 4.4 with the warning text containing the mcptt-warn-code set to \"149\",
> shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-
> initiated;
>
> c) shall set the MCPTT emergency group call state to \"MEGC 3: emergency-
> call-granted\"; and
>
> d) shall set the MCPTT imminent peril group call state to \"MIGC 1:
> imminent-peril-capable\" and the MCPTT imminent peril group state to \"MIG
> 1: no-imminent-peril\"; or
>
> 2) if the MCPTT imminent peril group call state is set to \"MIGC 2:
> imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\"
> and the SIP 2xx response to the SIP request for an imminent peril group call
> does not contain a Warning header field as specified in subclause 4.4 with
> the warning text containing the mcptt-warn-code set to \"149\":
>
> a) set the MCPTT imminent peril group call state to \"MIGC 3: imminent-
> peril-call-granted\"; and
>
> b) set the MCPTT imminent peril group state to \"MIG 2: in-progress\".
[TS 24.379, clause 10.1.2.2.1.3]
This subclause covers both on-demand session and pre-established sessions.
Upon receiving a request from an MCPTT user to cancel the in-progress
emergency condition on a chat MCPTT group, the MCPTT client shall generate a
SIP re-INVITE request as specified in 3GPP TS 24.229 [4], with the
clarifications given below.
The MCPTT client:
> 1) if the MCPTT user is not authorised to cancel the in-progress emergency
> group state of the MCPTT group as determined by the procedures of subclause
> 6.2.8.1.7, the MCPTT client:
>
> a) should indicate to the MCPTT user that they are not authorised to cancel
> the in-progress emergency group state of the MCPTT group; and
>
> b) shall skip the remaining steps of the current subclause;
>
> 2) shall, if the MCPTT user is cancelling an in-progress emergency condition
> and optionally an MCPTT emergency alert originated by the MCPTT user,
> include an application/vnd.3gpp.mcptt-info+xml MIME body populated as
> specified in subclause 6.2.8.1.3;
>
> 3) shall, if the MCPTT user is cancelling an in-progress emergency condition
> and optionally an MCPTT emergency alert originated by another MCPTT user,
> include an application/vnd.3gpp.mcptt-info+xml MIME body populated as
> specified in subclause 6.2.8.1.14;
>
> 4) shall, if the SIP re-INVITE request is to be sent within an on-demand
> session, include in the SIP re-INVITE request an SDP offer according to 3GPP
> TS 24.229 [4] with the clarifications specified in subclause 6.2.1;
>
> 5) if the SIP re-INVITE request is to be sent within a pre-established
> session, shall include an SDP offer in the SIP re-INVITE request according
> to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the
> pre-established session;
>
> NOTE 1: The SIP re-INVITE request can be sent within an on-demand session or
> a pre-established session associated with an MCPTT group session. If the SIP
> re-INVITE request is sent within a pre-established session, the media-level
> section for the MCPTT speech media stream and the media-level section of the
> media-floor control entity are expected to be the same as was negotiated in
> the existing pre-established session.
>
> 6) shall include a Resource-Priority header field and comply with the
> procedures in subclause 6.2.8.1.2; and
>
> 7) shall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP re-INVITE request, the MCPTT
client:
> 1) shall set the MCPTT emergency group state of the group to \"MEG 1: no-
> emergency\";
>
> 2) shall set the MCPTT emergency group call state of the group to \"MEGC 1:
> emergency-gc-capable\"; and
>
> 3) if the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-
> cancel-pending\", the sent SIP re-INVITE request did not contain an
> \ element in the application/vnd.3gpp.mcptt-info+xml MIME
> body and the SIP 2xx response to the SIP request for a priority group call
> does not contain a Warning header field as specified in subclause 4.4 with
> the warning text containing the mcptt-warn-code set to \"149\", shall set
> the MCPTT emergency alert state to \"MEA 1: no-alert\".
[TS 24.379, clause 10.1.2.2.1.5]
This subclause covers both on-demand session and pre-established sessions.
Upon receiving a request from an MCPTT user to cancel the in-progress imminent
peril condition on a chat MCPTT group, the MCPTT client shall generate a SIP
re-INVITE request by following the procedures specified in 3GPP TS 24.229 [4],
with the clarifications given below.
The MCPTT client:
> 1) if the MCPTT user is not authorised to cancel the in-progress imminent
> peril group state of the MCPTT group as determined by the procedures of
> subclause 6.2.8.1.10, the MCPTT client:
>
> a) should indicate to the MCPTT user that they are not authorised to cancel
> the in-progress imminent peril group state of the MCPTT group; and
>
> b) shall skip the remaining steps of the current subclause;
>
> 2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated
> as specified in subclause 6.2.8.1.11;
>
> 3) shall include a Resource-Priority header field and comply with the
> procedures in subclause 6.2.8.1.12;
>
> 4) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"chat\"; and
>
> b) the \ element set to the group identity;
>
> NOTE 1: The MCPTT ID of the originating MCPTT user is not included in the
> body, as this will be inserted into the body of the SIP re-INVITE request
> that is sent by the originating participating MCPTT function.
>
> 5) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP re-INVITE request according to IETF RFC 3840 [16];
>
> 6) if the SIP re-INVITE request is to be sent within an on-demand session,
> shall include in the SIP re-INVITE request an SDP offer according to 3GPP TS
> 24.229 [4] with the clarifications specified in subclause 6.2.1;
>
> 7) if the SIP re-INVITE request is to be sent within a pre-established
> session, shall include an SDP offer in the SIP re-INVITE request according
> to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the
> pre-established session; and
>
> NOTE 2: The SIP re-INVITE request can be sent within an on-demand session or
> a pre-established session associated with an MCPTT group session. If the SIP
> re-INVITE request is sent within a pre-established session, the media-level
> section for the offered MCPTT speech media stream and the media-level
> section of the offered media-floor control entity are expected to be the
> same as was negotiated in the existing pre-established session.
>
> 8) shall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP re-INVITE request, the MCPTT
client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall set the MCPTT imminent peril group state of the group to \"MIG 1:
> no-imminent-peril\"; and
>
> 3) shall set the MCPTT imminent peril group call state of the group to
> \"MIGC 1: imminent-peril-gc-capable\".
[TS 24.380, clause 6.2.4.2.2]
When a call is initiated as described in 3GPP TS 24.379 [2], the floor
participant:
> 1\. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\';
>
> 2\. if the originating floor participant receives a floor control message
> before it receives the SIP 200 (OK) response, shall store the floor control
> message;
>
> NOTE: The originating floor participant might receive a floor control
> message before the SIP 200 (OK) response when initiating, joining or
> rejoining a call because of processing delays of the SIP 200 (OK) response
> in the SIP core.
>
> 3\. if the established MCPTT call is a chat group call and the SIP INVITE
> request is not an implicit floor request, shall enter the \'U: has no
> permission\' state; and
>
> 4\. if for the established MCPTT call the SIP INVITE request is an implicit
> floor request:
>
> a. shall start timer T101 (Floor Request) and initialise counter C101 (Floor
> Request) to 1;
>
> b. shall enter the \'U: pending Request\' state; and
>
> c. if the floor participant has received and stored a floor control message
> before the reception of the SIP 200 (OK) response, shall act as if the floor
> control message was received in the \'U: pending Request\' state after
> entering the \'U: pending Request\' state.
When the floor participant is rejoining an ongoing MCPTT call as described in
3GPP TS 24.379 [2] the floor participant shall enter the \'U: has no
permission\' state.
[TS 24.380, clause 6.2.4.5.3]
Upon receiving an indication from the user to release the permission to send
RTP media, the floor participant:
> 1\. shall send a Floor Release message towards the floor control server. The
> Floor Release message:
>
> a. may include the first bit in the subtype of the Floor Release message set
> to \'1\' (acknowledgement is required) as specified in subclause 8.2.2;
>
> NOTE: It is an implementation option to handle the receipt of the Floor Ack
> message and what action to take if the Floor Ack message is not received.
>
> b. if the session is a broadcast call and if the session was established as
> a normal call, shall include the Floor Indicator with the A-bit set to \'1\'
> (Normal call); and
>
> c. if the Floor Granted message included the G-bit set to \'1\' (Dual
> floor), shall include the Floor Indicator with the G-bit set to \'1\' (Dual
> floor);
>
> 2\. shall remove the indication that the participant is overriding without
> revoke if this indication is stored;
>
> 3\. shall remove the indication that the participant is overridden without
> revoke if this indication is stored;
>
> 4\. shall start timer T100 (Floor Release) and initialize counter C100
> (Floor Release) to 1; and
>
> 5\. shall enter the \'U: pending Release\' state.
##### 6.1.2.11.3 Test description {#test-description-35 .H6}
##### 6.1.2.11.3.1 Pre-test conditions {#pre-test-conditions-35 .H6}
##### System Simulator: {#system-simulator-35 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-35 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-35 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.2.11.3.2 Test procedure sequence {#test-procedure-sequence-35 .H6}
Table 6.1.2.11.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a chat | | | | | | | group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.1.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a chat | | | | | | | group | | | | | | | call with | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.ii of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3A.1.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3-6 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | not | | | | | | | ification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7A | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7B | The UE | - | - | - | - | | | (MCPTT | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | Floor | | | | | | | Release | | | | | | | -- Floor | | | | | | | Idle\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3 | | | | | | | A.15.3-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | upgrade | | | | | | | of the | | | | | | | call to | | | | | | | an | | | | | | | emergency | | | | | | | chat | | | | | | | group | | | | | | | call with | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Check: | . | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO | | | | | | | session | | | | | | | modif | | | | | | | ication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.6.3-1 | | | | | | | to | | | | | | | upgrade | | | | | | | the call | | | | | | | to an | | | | | | | emergency | | | | | | | call with | | | | | | | implicit | | | | | | | floor | | | | | | | control? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10-13 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 14 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | not | | | | | | | ification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | Floor | | | | | | | Release | | | | | | | -- Floor | | | | | | | Idle\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3 | | | | | | | A.15.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 17-18 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 19 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | downgrade | | | | | | | of the | | | | | | | call to a | | | | | | | normal | | | | | | | chat | | | | | | | group | | | | | | | call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 20 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO | | | | | | | session | | | | | | | modif | | | | | | | ication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.6.3-1 | | | | | | | to cancel | | | | | | | the | | | | | | | emergency | | | | | | | state | | | | | | | without | | | | | | | implicit | | | | | | | floor | | | | | | | control? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 20A | The SS | \ with mcpttBoolean set to false
Encryption according to NOTE 2 in TS 36.579-1 [2] Table 5.5.3.2.1-1
Table 6.1.2.11.3.3-12..13: Void
Table 6.1.2.11.3.3-14: SIP INVITE from the UE (step 31, Table 6.1.2.11.3.2-1;\
Step 1, TS 36.579-1 [2] Table 5.3A.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition re_INVITE,
IMMPERIL-CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME part body SDP Message as described in Table 6.1.2.11.3.3-14A  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.1.2.11.3.3-15
Table 6.1.2.11.3.3-14A: SDP in SIP INVITE (Table 6.1.2.11.3.3-14)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_OFFER,
IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.2.11.3.3-15: MCPTT-Info in SIP INVITE (Table 6.1.2.11.3.3-14)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE_REFER,
CHAT-GROUP-CALL, IMMPERIL-CALL
* * *
Table 6.1.2.11.3.3-16: Floor Granted (step 31, Table 6.1.2.11.3.2-1;\ step 5,
TS 36.579-1 [2] Table 5.3A.6.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.3-1, condition IMMPERIL-CALL
* * *
Table 6.1.2.11.3.3-16A: Floor Release (step 38, Table 6.1.2.11.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3A.15.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.5-1, condition IMMPERIL-CALL
* * *
Table 6.1.2.11.3.3-17: Floor Idle (step 38, Table 6.1.2.11.3.2-1;\ step 3, TS
36.579-1 [2] Table 5.3A.15.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.6-1, condition IMMPERIL-CALL
* * *
Table 6.1.2.11.3.3-18: SIP INVITE from the UE (step 42, Table 6.1.2.11.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition re_INVITE
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME part body SDP Message as described in Table 6.1.2.11.3.3-18A  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.1.2.11.3.3-19
Table 6.1.2.11.3.3-18A: SDP in SIP INVITE (Table 6.1.2.11.3.3-18)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_OFFER
* * *
Table 6.1.2.11.3.3-19: MCPTT-Info in SIP INVITE (Table 6.1.2.11.3.3-18)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition CHAT-GROUP-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
imminentperil-ind Encrypted \ with mcpttBoolean set to
false Encryption according to NOTE 2 in TS 36.579-1 [2] Table 5.5.3.2.1-1
Table 6.1.2.11.3.3-20: Void
6.1.2.12 On-network / Chat Group Call / Join Chat Group Session / Upgrade to
Emergency / Cancel Emergency / Upgrade to Imminent Peril / Cancel Imminent
Peril / Client Originated (CT)
##### 6.1.2.12.1 Test Purpose (TP) {#test-purpose-tp-36 .H6}
##### (1) {#section-112 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests to initiate an MCPTT On-demand Chat Group
Call with implicit floor control }
**then** { UE (MCPTT Client) sends a SIP INVITE message **and** respects the
floor control imposed by the MCPTT Server **and** provides floor granted
notification to the MCPTT User }
}
##### (2) {#section-113 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Chat Group Call }
ensure that {
**when** { UE (MCPTT Client) receives a SIP re-INVITE message to upgrade the
MCPTT group session to an emergency condition }
**then** { UE (MCPTT Client) responds with a SIP 200 (OK) message **and**
respects the floor control imposed by the MCPTT Server }
}
##### (3) {#section-114 .H6}
**with** { UE (MCPTT Client) participating in an ongoing Emergency Chat Group
Call }
ensure that {
**when** { UE (MCPTT Client) receives a SIP re-INVITE message to cancel the
in-progress emergency condition }
**then** { UE (MCPTT Client) responds with a SIP 200 (OK) message **and**
respects the floor control imposed by the MCPTT Server }
}
##### (4) {#section-115 .H6}
**with** { UE (MCPTT Client) participating in an ongoing On-demand Chat Group
Call }
ensure that {
**when** { UE (MCPTT Client) receives a SIP re-INVITE message to upgrade the
MCPTT group session to an imminent peril condition }
**then** { UE (MCPTT Client) responds with a SIP 200 (OK) message **and**
respects the floor control imposed by the MCPTT Server }
}
##### (5) {#section-116 .H6}
**with** { UE (MCPTT Client) participating in an ongoing Emergency Chat Group
Call }
ensure that {
**when** { UE (MCPTT Client) receives a SIP re-INVITE message to cancel the
in-progress imminent peril condition }
**then** { UE (MCPTT Client) responds with a SIP 200 (OK) message **and**
respects the floor control imposed by the MCPTT Server }
}
##### (6) {#section-117 .H6}
**with** { UE (MCPTT Client) participating in an ongoing On-demand Pre-
arranged Group Call with Manual Commencement Mode }
ensure that {
**when** { UE (MCPTT Client) receives a SIP BYE message to end the Chat Group
Call }
**then** { UE (MCPTT Client) responds with a SIP 200 (OK) message }
}
##### 6.1.2.12.2 Conformance requirements {#conformance-requirements-36 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clauses 10.1.2.2.1.1, 10.1.2.2.1.2, 6.2.6, TS 24.380,
clauses 6.2.4.2.3, 6.2.4.3.3, 6.2.4.3.2. Unless otherwise stated, these are
Rel-13 requirements.
[TS 24.379, clause 10.1.2.2.1.1]
Upon receiving a request from an MCPTT user to initiate or join an MCPTT group
session using an MCPTT group identity, identifying a chat MCPTT group, the
MCPTT client shall generate an initial SIP INVITE request by following the UE
originating session procedures specified in 3GPP TS 24.229 [4], with the
clarifications given below.
The MCPTT client:
> ...
>
> 3) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 4) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 5) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 6) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 7) should include the \"timer\" option tag in the Supported header field;
>
> 8) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the refresher parameter is omitted. If
> included, the refresher parameter shall be set to \"uac\";
>
> 9) shall set the Request-URI of the SIP INVITE request to the public service
> identity identifying the participating MCPTT function serving the MCPTT
> user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 10) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> ...
>
> 13) shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element containing the \ element with:
>
> a) the \ element set to a value of \"chat\";
>
> b) the \ element set to the group identity; and
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client;
>
> NOTE 2: The MCPTT ID of the originating MCPTT user is not included in the
> body, as this will be inserted into the body of the SIP INVITE request that
> is sent by the originating participating MCPTT function.
>
> 14) shall include in the SIP INVITE request an SDP offer according to 3GPP
> TS 24.229 [4] with the clarifications specified in subclause 6.2.1;
>
> 15) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 16) shall send the SIP INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in subclause 6.2.8.1.4.
[TS 24.379, clause 10.1.2.2.1.2]
This subclause covers both on-demand session and pre-established sessions.
Upon receipt of a SIP re-INVITE request the MCPTT client:
> 1) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
> info+xml MIME body with the \ element containing the \ Params> element with the \ element set to a value of
> \"true\":
>
> a) should display to the MCPTT user the MCPTT ID of the originator of the
> MCPTT emergency group call and an indication that this is an MCPTT emergency
> group call;
>
> b) if the \ element containing the \ element
> contains an \ element set to \"true\", should display to the
> MCPTT user an indication of the MCPTT emergency alert and associated
> information;
>
> c) shall set the MCPTT emergency group state to \"MEG 2: in-progress\";
>
> d) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
> peril\";and
>
> e) shall set the MCPTT imminent peril group call state to \"MIGC 1:
> imminent-peril-gc-capable\";
>
> 2) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
> info+xml MIME body with the \ element containing the \ Params> element with the \ element set to a value of
> \"true\":
>
> a) should display to the MCPTT user the MCPTT ID of the originator of the
> MCPTT imminent peril group call and an indication that this is an MCPTT
> imminent peril group call; and
>
> b) shall set the MCPTT imminent peril group state to \"MIG 2: in-progress\";
>
> 3) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
> info+xml MIME body with the \ element containing the \ Params> element with the \ element set to a value of
> \"false\":
>
> a) should display to the MCPTT user the MCPTT ID of the MCPTT user
> cancelling the MCPTT emergency group call;
>
> b) if the \ element containing the \ element
> contains an \ element set to \"false\":
>
> i) should display to the MCPTT user an indication of the MCPTT emergency
> alert cancellation and the MCPTT ID of the MCPTT user cancelling the MCPTT
> emergency alert; and
>
> ii) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
> info+xml MIME body including an \ element:
>
> A) should display to the MCPTT user the MCPTT ID contained in the
> \ element of the MCPTT user that originated the MCPTT
> emergency alert; and
>
> B) if the MCPTT ID contained in the \ element is the MCPTT ID
> of the receiving MCPTT user, shall set the MCPTT emergency alert state to
> \"MEA 1: no-alert\";
>
> c) shall set the MCPTT emergency group state to \"MEG 1: no-emergency\"; and
>
> d) if the MCPTT emergency group call state of the group is set to \"MEGC 3:
> emergency-call-granted\", shall set the MCPTT emergency group call state of
> the group to \"MEGC 1: emergency-gc-capable\";
>
> 4) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
> info+xml MIME body with the \ element containing the \ Params> element with the \ element set to a value of
> \"false\":
>
> a) should display to the MCPTT user the MCPTT ID of the MCPTT user
> cancelling the MCPTT imminent peril group call and an indication that this
> is an MCPTT imminent peril group call;
>
> b) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
> peril\"; and
>
> c) shall set the MCPTT imminent peril group call state to \"MIGC 1:
> imminent-peril-gc-capable\";
>
> 5) may check if a Resource-Priority header field is included in the incoming
> SIP re-INVITE request and may perform further actions outside the scope of
> this specification to act upon an included Resource-Priority header field as
> specified in 3GPP TS 24.229 [4];
>
> 6) shall accept the SIP re-INVITE request and generate a SIP 200 (OK)
> response according to rules and procedures of 3GPP TS 24.229 [4];
>
> 7) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 200 (OK) response;
>
> 8) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 200 (OK) response;
>
> 9) if the SIP re-INVITE request was received within an on-demand session,
> shall include an SDP answer in the SIP 200 (OK) response to the SDP offer in
> the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.2;
>
> 10) if the SIP re-INVITE request was received within a pre-established
> session, shall include an SDP answer in the SIP 200 (OK) response to the SDP
> offer in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4],
> based upon the parameters already negotiated for the pre-established
> session; and
>
> NOTE: The SIP re-INVITE request can be received within an on-demand session
> or a pre-established session associated with an MCPTT group session. If the
> SIP re-INVITE request is received within a pre-established session, the
> media-level section for the MCPTT speech media stream and the media-level
> section of the media-floor control entity are expected to be the same as was
> negotiated in the existing pre-established session.
>
> 11) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4].
[TS 24.379, clause 6.2.6]
Upon receiving a SIP BYE request, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall send SIP 200 (OK) response towards MCPTT server according to 3GPP
> TS 24.229 [4].
[TS 24.380, clause 6.2.4.2.3]
When an MCPTT call is established, the terminating floor participant:
> 1\. shall create an instance of a \'Floor participant state transition
> diagram for basic operation\'; and
>
> 2\. shall enter the \'U: has no permission\' state.
>
> NOTE: From a floor participant perspective the MCPTT call is established
> when the application and signalling plane sends the SIP 200 (OK) response.
[TS 24.380, clause 6.2.4.3.3]
Upon receiving the Floor Taken message, the floor participant:
> 1\. if the first bit in the subtype of the Floor Taken message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'2\' (Floor Taken); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. may provide a floor taken notification to the user;
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. should start the optional timer T103 (End of RTP media); and
>
> 5\. shall remain in the \'U: has no permission\' state.
[TS 24.380, clause 6.2.4.3.2]
Upon receiving a Floor Idle message, the participant:
> 1\. if the first bit in the subtype of the Floor Idle message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'5\' (Floor Idle); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. may provide floor idle notification to the user, if it has not already
> done so;
>
> 3\. shall stop the optional timer T103 (End of RTP media), if it is running;
> and
>
> 4\. shall remain in the \'U: has no permission\' state.
##### 6.1.2.12.3 Test description {#test-description-36 .H6}
##### 6.1.2.12.3.1 Pre-test conditions {#pre-test-conditions-36 .H6}
##### System Simulator: {#system-simulator-36 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-36 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-36 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.2.12.3.2 Test procedure sequence {#test-procedure-sequence-36 .H6}
Table 6.1.2.12.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a chat | | | | | | | group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.1.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a chat | | | | | | | group | | | | | | | call call | | | | | | | with | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.ii of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3A.1.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3-6 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | not | | | | | | | ification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7A | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7B | The UE | - | - | - | - | | | (MCPTT | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | Floor | | | | | | | Release | | | | | | | -- Floor | | | | | | | Idle\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3 | | | | | | | A.15.3-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3.4.3-1 | | | | | | | to**| | | | | | | upgrade | | | | | | | the call | | | | | | | to an | | | | | | | emergency | | | | | | | chat | | | | | | | group | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9-9A | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 10 | The SS | \  | Floor Ack | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor Ack | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | The SS | \ | Floor Ack | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor Ack | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 17 | The SS | \ | Floor Ack | 4 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor Ack | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 22 | The SS | \ | Floor Ack | 5 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor Ack | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 27 | The SS | \ with mcpttBoolean set to false
Encryption according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.2.2-1  
alert-ind Encrypted \ with mcpttBoolean set to false Encryption
according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.2.2-1
Table 6.1.2.12.3.3-10A: Void
Table 6.1.2.12.3.3-11: Floor Taken (steps 15, 25, Table 6.1.2.12.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.7-1, condition ACK
* * *
Table 6.1.2.12.3.3-13: SIP INVITE from the SS (step 18, Table 6.1.2.12.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition re_INVITE,
MO_CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME part body SDP Message as described in Table 6.1.2.12.3.3-4A  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.1.2.12.3.3-14
Table 6.1.2.12.3.3-14: MCPTT-Info in SIP INVITE (Table 6.1.2.12.3.3-13)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition CHAT-GROUP-
CALL, IMMPERIL-CALL
* * *
Table 6.1.2.12.3.3-14A: Void
Table 6.1.2.12.3.3-15: Floor Taken (step 20, Table 6.1.2.12.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.7-1, condition IMMPERIL-CALL,
ACK
* * *
Table 6.1.2.12.3.3-16: Floor Idle (step 22, Table 6.1.2.12.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.6-1, condition IMMPERIL-CALL
* * *
Table 6.1.2.12.3.3-17: SIP INVITE from the SS (step 23, Table 6.1.2.12.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition re_INVITE,
MO_CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME part body SDP Message as described in Table 6.1.2.12.3.3-4A  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.1.2.12.3.3-18
Table 6.1.2.12.3.3-18: MCPTT-Info in SIP INVITE (Table 6.1.2.12.3.3-17)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition CHAT-GROUP-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
imminentperil-ind Encrypted \ with mcpttBoolean set to
false Encryption according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.2.2-1
Table 6.1.2.12.3.3-18A..19: Void
Table 6.1.2.12.3.3-20: SIP BYE from the SS (step 28, Table 6.1.2.12.3.2-1;\
step 1, TS 36.579-1 [2] Table 5.3.12.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1, condition MO_CALL
* * *
6.1.2.13 On-network / Chat Group Call / Join Chat Group Session / Active
functional alias / Client Originated (CO)
##### 6.1.2.13.1 Test Purpose (TP) {#test-purpose-tp-37 .H6}
##### (1) {#section-118 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests to initiate an MCPTT On-demand Chat Group
Call with implicit floor control using an active functional alias }
**then** { UE (MCPTT Client) sends a SIP INVITE message **and** respects the
floor control imposed by the MCPTT Server **and** provides floor granted
notification to the MCPTT User }
}
##### (2) {#section-119 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Chat
Group Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) requests to terminate the ongoing
MCPTT Chat Group Call }
**then** { UE (MCPTT Client) sends a SIP BYE request and leaves the MCPTT
session }
}
##### 6.1.2.13.2 Conformance requirements {#conformance-requirements-37 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clauses 10.1.2.2.1.1, 6.2.4.1, TS 24.380, clauses
6.2.4.2.2, 6.2.4.4.2. Unless otherwise stated, these are Rel-15 requirements.
[TS 24.379, clause 10.1.2.2.1.1]
Upon receiving a request from an MCPTT user to initiate or join an MCPTT group
session using an MCPTT group identity, identifying a chat MCPTT group, the
MCPTT client shall generate an initial SIP INVITE request by following the UE
originating session procedures specified in 3GPP TS 24.229 [4], with the
clarifications given below.
The MCPTT client:
> 1) if the MCPTT user has requested the origination of an MCPTT emergency
> group call or is originating an MCPTT chat group call and the MCPTT
> emergency state is already set, the MCPTT client shall comply with the
> procedures in subclause 6.2.8.1.1;
>
> 2) if the MCPTT user has requested the origination of an MCPTT imminent
> peril group call, the MCPTT client shall comply with the procedures in
> subclause 6.2.8.1.9;
>
> 3) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 4) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 5) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 6) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 7) should include the \"timer\" option tag in the Supported header field;
>
> 8) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the refresher parameter is omitted. If
> included, the refresher parameter shall be set to \"uac\";
>
> 9) shall set the Request-URI of the SIP INVITE request to the public service
> identity identifying the participating MCPTT function serving the MCPTT
> user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 10) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> 11) if the MCPTT client emergency group state for this group is set to \"MEG
> 2: in-progress\" or \"MEG 4: confirm-pending\", the MCPTT client shall
> comply with the procedures in subclause 6.2.8.1.2;
>
> 12) if the MCPTT client imminent peril group state for this group is set to
> \"MIG 2: in-progress\" or \"MIG 4: confirm-pending\" shall include the
> Resource-Priority header field and comply with the procedures in subclause
> 6.2.8.1.12;
>
> 13) shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element containing the \ element with:
>
> a) the \ element set to a value of \"chat\";
>
> b) the \ element set to the group identity;
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client; and
>
> d) if the MCPTT client is aware of active functional-aliases, and an active
> functional alias is to be included in the initial SIP INVITE request, the
> \ set to the URI of the used functional alias;
>
> NOTE 2: The MCPTT ID of the originating MCPTT user is not included in the
> body, as this will be inserted into the body of the SIP INVITE request that
> is sent by the originating participating MCPTT function.
>
> 14) shall include in the SIP INVITE request an SDP offer according to 3GPP
> TS 24.229 [4] with the clarifications specified in subclause 6.2.1;
>
> 15) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 16) shall send the SIP INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in subclause 6.2.8.1.4.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request:
> 1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\"; or
>
> 2) if the MCPTT imminent peril group call state is set to \"MIGC 2:
> imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";
the MCPTT client shall perform the actions specified in subclause 6.2.8.1.5.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in subclause 6.2.8.1.13.
[TS 24.379, clause 6.2.4.1]
Upon receiving a request from an MCPTT user to leave an MCPTT session
established using on-demand session signalling, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 3) shall set the Request-URI to the MCPTT session identity to leave; and
>
> 4) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT
client shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.380, clause 6.2.4.2.2]
When a call is initiated as described in 3GPP TS 24.379 [2], the floor
participant:
> 1\. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\';
>
> 2\. if the originating floor participant receives a floor control message
> before it receives the SIP 200 (OK) response, shall store the floor control
> message;
>
> NOTE: The originating floor participant might receive a floor control
> message before the SIP 200 (OK) response when initiating, joining or
> rejoining a call because of processing delays of the SIP 200 (OK) response
> in the SIP core.
>
> 3\. if the established MCPTT call is a chat group call and the SIP INVITE
> request is not an implicit floor request, shall enter the \'U: has no
> permission\' state; and
>
> 4\. if for the established MCPTT call the SIP INVITE request is an implicit
> floor request:
>
> a. shall start timer T101 (Floor Request) and initialise counter C101 (Floor
> Request) to 1;
>
> b. shall enter the \'U: pending Request\' state; and
>
> c. if the floor participant has received and stored a floor control message
> before the reception of the SIP 200 (OK) response, shall act as if the floor
> control message was received in the \'U: pending Request\' state after
> entering the \'U: pending Request\' state.
When the floor participant is rejoining an ongoing MCPTT call as described in
3GPP TS 24.379 [2] the floor participant shall enter the \'U: has no
permission\' state.
[TS 24.380, clause 6.2.4.4.2]
Upon receiving a Floor Granted message from the floor control server or a
floor granted indication in a SIP 200 (OK) response in the application and
signalling layer, the floor participant:
> 1\. if the first bit in the subtype of the Floor Granted message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'1\' (Floor Granted); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. if the call is not an ambient listening call, shall provide floor
> granted notification to the user, if not already done;
>
> NOTE: Providing the floor granted notification to the user prior to
> receiving the Floor Granted message is an implementation option.
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
> store an indication that the participant is overriding without revoke;
>
> 5\. shall stop the optional timer T103 (End of RTP media), if running;
>
> 6\. shall stop timer T101 (Floor Request); and
>
> 7\. shall enter the \'U: has permission\' state.
##### 6.1.2.13.3 Test description {#test-description-37 .H6}
##### 6.1.2.13.3.1 Pre-test conditions {#pre-test-conditions-37 .H6}
##### System Simulator: {#system-simulator-37 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-37 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-37 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'UE initiated MCPTT functional alias status
determination and subscription\' as specified in TS 36.579-1 [2] clause
5.3.36.
\- The UE has performed procedure \'UE initiated MCPTT functional alias status
change\' as specified in TS 36.579-1 [2] clause 5.3.37.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.2.13.3.2 Test procedure sequence {#test-procedure-sequence-37 .H6}
Table 6.1.2.13.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a chat | | | | | | | group call | | | | | | | using the | | | | | | | active | | | | | | | functional | | | | | | | alias with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3A.1.3-1 | | | | | | | to**| | | | | | | establish | | | | | | | a chat | | | | | | | group call | | | | | | | with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.i of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | |** 5.3 | | | | | | | A.1.3-1**? | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 4 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.2.13.3.3 Specific message contents {#specific-message-contents-37
.H6}
Table 6.1.2.13.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.2.13.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.1.2.13.3.3-2  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.2.13.3.3-3
Table 6.1.2.13.3.3-2: SDP in SIP INVITE (Table 6.1.2.13.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
INITIAL_SDP_OFFER, IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.2.13.3.3-3: MCPTT-Info in SIP INVITE (Table 6.1.2.13.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE_REFER,
CHAT-GROUP-CALL, FUNCTIONAL_ALIAS
* * *
Table 6.1.2.13.3.3-4: SIP 200 (OK) from the SS (step 2, Table 6.1.2.13.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.1.2.13.3.3-5
Table 6.1.2.13.3.3-5: SDP in SIP 200 (OK) (Table 6.1.2.13.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
IMPLICIT_GRANT_REQUESTED, IMPLICIT_FLOOR_GRANTED
* * *
Table 6.1.2.13.3.3-6: Void
6.1.2.14 On-network / Chat Group Call / Chat Group Call Using Pre-established
Session / Active functional alias / Client Originated (CO)
##### 6.1.2.14.1 Test Purpose (TP) {#test-purpose-tp-38 .H6}
##### (1) {#section-120 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests to initiate an MCPTT On-demand Chat Group
Call with implicit floor control using an active functional alias }
**then** { UE (MCPTT Client) sends a SIP INVITE message **and** respects the
floor control imposed by the MCPTT Server **and** provides floor granted
notification to the MCPTT User }
}
##### (2) {#section-121 .H6}
**with** { UE (MCPTT Client) having established a Chat Group Call using an
active functional alias within a pre-established session }
ensure that {
**when** { the UE (MCPTT Client) requests to leave the MCPTT session within a
pre-established session }
**then** { UE (MCPTT Client) initiates leaving by sending a SIP REFER and
leaves the call }
}
##### 6.1.2.14.2 Conformance requirements {#conformance-requirements-38 .H6}
References: The conformance requirements covered in the current TC are
specified in TS 24.379, clauses 10.1.2.2.2.1, 6.2.4.2, TS 24.380, clauses
6.2.4.2.2, 6.2.4.4.2. Unless otherwise stated, these are Rel-15 requirements.
[TS 24.379, clause 10.1.2.2.2.1]
Upon receiving a request from an MCPTT user to initiate or join an MCPTT group
session using an MCPTT group identity identifying a chat MCPTT group within
the pre-established session, the MCPTT client shall generate a SIP REFER
request outside a dialog as specified in IETF RFC 3515 [25] as updated by IETF
RFC 6665 [26] and IETF RFC 7647 [27], and in accordance with the UE procedures
specified in 3GPP TS 24.229 [4], with the clarifications given below.
The MCPTT client:
> 1) shall set the Request URI of the SIP REFER request to the session
> identity of the pre-established session;
>
> 2) shall set the Refer-To header field of the SIP REFER request as specified
> in IETF RFC 3515 [25] with a Content-ID (\"cid\") Uniform Resource Locator
> (URL) as specified in IETF RFC 2392 [62] that points to an
> application/resource-lists MIME body as specified in IETF RFC 5366 [20], and
> with the Content-ID header field set to this \"cid\" URL;
>
> 3) shall include in the application/resource-lists MIME body a single
> \ element containing a \"uri\" attribute set to the chat group
> identity, extended with the following URI header fields:
>
> NOTE 1: Characters that are not formatted as ASCII characters are escaped in
> the following URI header fields;
>
> a) the Accept-Contact header field containing the g.3gpp.mcptt media feature
> tag along with the \"require\" and \"explicit\" header field parameters
> according to IETF RFC 3841 [6];
>
> b) an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag
> containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with
> the \"require\" and \"explicit\" header field parameters according to IETF
> RFC 3841 [6]; and
>
> c) an hname \"body\" URI header field populated with:
>
> i) an application/sdp MIME body containing an SDP offer, if the session
> parameters of the pre-established session require modification or if
> implicit floor control is required, according to the conditions specified in
> subclause 6.4;
>
> ii) an application/vnd.3gpp.mcptt-info MIME body with:
>
> A) the \ element set to a value of \"chat\";
>
> B) the \ element set to the MCPTT client ID of the
> originating MCPTT client; and
>
> C) if the MCPTT client is aware of active functional-aliases, and an active
> functional alias is to be included in the SIP REFER request, the
> \ set to the URI of the used functional alias; and
>
> iii) if:
>
> A) implicit floor control is required; and
>
> B) an application/vnd.3gpp.mcptt-info MIME body with the \ info-when-talking> element of the \ element of the MCPTT user
> profile document identified by the MCPTT ID of the calling MCPTT user (see
> the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of
> \"true\";
>
> then shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body
> with a \ element included in the \ root element;
>
> NOTE 2: The MCPTT client learns the functional aliases that are activated
> for an MCPTT ID from procedures specified in subclause 9A.2.1.3.
>
> 4) if the MCPTT user has requested the origination of an MCPTT emergency
> group call or is originating an MCPTT group call and the MCPTT emergency
> state is already set:
>
> a) if this is an authorised request for an MCPTT emergency group call as
> determined by the procedures of subclause 6.2.8.8.1.8, shall comply with the
> procedures in subclause 6.2.8.1.1; and
>
> b) if this is an unauthorised request for an MCPTT emergency group call as
> determined in step a) above, should indicate to the MCPTT user that they are
> not authorised to initiate an MCPTT emergency group call;
>
> 5) if the MCPTT client emergency group state for this group is set to \"MEG
> 2: in-progress\" or \"MEG 4: confirm-pending\", shall include the Resource-
> Priority header field and comply with the procedures in subclause 6.2.8.1.2;
>
> 6) if the MCPTT user has requested the origination of an MCPTT imminent
> peril group call:
>
> a) if this is an authorised request for an MCPTT imminent peril group call
> as determined by the procedures of subclause 6.2.8.8.1.8, shall comply with
> the procedures in subclause 6.2.8.1.9;
>
> b) if this is an unauthorised request for an MCPTT imminent peril group call
> as determined in step a) above, should indicate to the MCPTT user that they
> are not authorised to initiate an MCPTT imminent peril group call;
>
> 7) if the MCPTT client imminent peril group state for this group is set to
> \"MIG 2: in-progress\" or \"MIG 4: confirm-pending\" shall include the
> Resource-Priority header field and comply with the procedures in subclause
> 6.2.8.1.12;
>
> 8) shall include a P-Preferred-Service header field set to the ICSI value
> \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS
> 24.229 [4]), according to IETF RFC 6050 [9];
>
> 9) shall include the following according to IETF RFC 4488 [22]:
>
> a) the option tag \"norefersub\" in the Supported header field; and
>
> b) the value \"false\" in the Refer-Sub header field.
>
> 10) shall include a Target-Dialog header field as specified in IETF RFC 4538
> [23] identifying the pre-established session;
>
> 11) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP REFER request according to IETF RFC 3840 [16]; and
>
> 12) shall send the SIP REFER request according to 3GPP TS 24.229 [4].
On receiving a final SIP 2xx response to the SIP REFER request, the MCPTT
client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5].
On receiving a SIP 4xx response, SIP 5xx response or a SIP 6xx response to the
SIP REFER request:
> 1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\"; or
>
> 2) if the MCPTT imminent peril group call state is set to \"MIGC 2:
> imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";
>
> the MCPTT client shall perform the actions specified in subclause 6.2.8.1.5
> and shall skip the remaining steps.
On receiving a SIP re-INVITE request within the pre-established session
targeted by the sent SIP REFER request, and if the sent SIP REFER request was
a request for an MCPTT emergency group call or an MCPTT imminent peril group
call, the MCPTT client:
> 1) shall perform the actions specified in subclause 6.2.8.1.16;
>
> 2) shall check if a Resource-Priority header field is included in the
> incoming SIP re-INVITE request and may perform further actions outside the
> scope of this specification to act upon an included Resource-Priority header
> field as specified in 3GPP TS 24.229 [4];
>
> 3) shall accept the SIP re-INVITE request and generate a SIP 200 (OK)
> response according to rules and procedures of 3GPP TS 24.229 [4];
>
> 4) shall include an SDP answer in the SIP 200 (OK) response to the SDP offer
> in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4], based
> upon the parameters already negotiated for the pre-established session; and
>
> 5) shall send the SIP 200 (OK) response towards the participating MCPTT
> function according to rules and procedures of 3GPP TS 24.229 [4].
On call release by interaction with the media plane as specified in subclause
9.2.2 of 3GPP TS 24.380 [5] if the sent SIP REFER request was a request for an
MCPTT emergency group call or an MCPTT imminent peril group call, the MCPTT
client shall perform the procedures specified in subclause 6.2.8.1.17.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in subclause 6.2.8.1.13.
[TS 24.379, clause 6.2.4.2]
Upon receiving a request from an MCPTT user to leave an MCPTT session within a
pre-established session, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate an initial SIP REFER request outside a dialog in
> accordance with the procedures specified in 3GPP TS 24.229 [4], IETF RFC
> 4488 [22] and IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF
> RFC 7647 [27];
>
> 3) shall set the Request-URI of the SIP REFER request to the public service
> identity identifying the pre-established session on the MCPTT server serving
> the MCPTT user;
>
> 4) shall include the Refer-Sub header field with value \"false\" according
> to rules and procedures of IETF RFC 4488 [22];
>
> 5) shall include the Supported header field with value \"norefersub\"
> according to rules and procedures of IETF RFC 4488 [22];
>
> 6) shall set the Refer-To header field of the SIP REFER request to the MCPTT
> session identity to leave;
>
> 7) shall include the \"method\" SIP URI parameter with the value \"BYE\" in
> the URI in the Refer-To header field;
>
> 8) shall include a Target-Dialog header field as specified in IETF RFC 4538
> [23] identifying the pre-established session; and
>
> 9) shall send the SIP REFER request according to 3GPP TS 24.229 [4].
Upon receiving a SIP 2xx response to the SIP REFER request, the MCPTT client
shall interact with media plane as specified in 3GPP TS 24.380 [5].
[TS 24.380, clause 6.2.4.2.2]
When a call is initiated as described in 3GPP TS 24.379 [2], the floor
participant:
> 1\. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\';
>
> 2\. if the originating floor participant receives a floor control message
> before it receives the SIP 200 (OK) response, shall store the floor control
> message;
>
> NOTE: The originating floor participant might receive a floor control
> message before the SIP 200 (OK) response when initiating, joining or
> rejoining a call because of processing delays of the SIP 200 (OK) response
> in the SIP core.
>
> 3\. if the established MCPTT call is a chat group call and the SIP INVITE
> request is not an implicit floor request, shall enter the \'U: has no
> permission\' state; and
>
> 4\. if for the established MCPTT call the SIP INVITE request is an implicit
> floor request:
>
> a. shall start timer T101 (Floor Request) and initialise counter C101 (Floor
> Request) to 1;
>
> b. shall enter the \'U: pending Request\' state; and
>
> c. if the floor participant has received and stored a floor control message
> before the reception of the SIP 200 (OK) response, shall act as if the floor
> control message was received in the \'U: pending Request\' state after
> entering the \'U: pending Request\' state.
When the floor participant is rejoining an ongoing MCPTT call as described in
3GPP TS 24.379 [2] the floor participant shall enter the \'U: has no
permission\' state.
[TS 24.380, clause 6.2.4.4.2
Upon receiving a Floor Granted message from the floor control server or a
floor granted indication in a SIP 200 (OK) response in the application and
signalling layer, the floor participant:
> 1\. if the first bit in the subtype of the Floor Granted message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'1\' (Floor Granted); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. if the call is not an ambient listening call, shall provide floor
> granted notification to the user, if not already done;
>
> NOTE: Providing the floor granted notification to the user prior to
> receiving the Floor Granted message is an implementation option.
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
> store an indication that the participant is overriding without revoke;
>
> 5\. shall stop the optional timer T103 (End of RTP media), if running;
>
> 6\. shall stop timer T101 (Floor Request); and
>
> 7\. shall enter the \'U: has permission\' state.
##### 6.1.2.14.3 Test description {#test-description-38 .H6}
##### 6.1.2.14.3.1 Pre-test conditions {#pre-test-conditions-38 .H6}
##### System Simulator: {#system-simulator-38 .H6}
> SS (MCPTT server)
>
> For the underlying \"transport bearer\" over which the SS and the UE will
> communicate Parameters are set to the default parameters for the basic
> E-UTRA Single cell network scenarios, as defined in TS 36.508 [24] clause
> 4.4. The simulated Cell 1 shall belong to PLMN1 (the PLMN specified for
> MCPTT operation in the MCPTT configuration document).
##### IUT: {#iut-38 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-38 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- The UE has performed procedure \'UE initiated MCPTT functional alias status
determination and subscription\' as specified in TS 36.579-1 [2] clause
5.3.36.
\- The UE has performed procedure \'UE initiated MCPTT functional alias status
change\' as specified in TS 36.579-1 [2] clause 5.3.37.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.2.14.3.2 Test procedure sequence {#test-procedure-sequence-38 .H6}
Table 6.1.2.14.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a chat | | | | | | | group | | | | | | | call | | | | | | | using the | | | | | | | pre-es | | | | | | | tablished | | | | | | | and the | | | | | | | active | | | | | | | f | | | | | | | unctional | | | | | | | alias, | | | | | | | with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | esta | | | | | | | blishment | | | | | | | using a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5 | | | | | | | .3A.3.3-1 | | | | | | | to** | | | | | | | establish | | | | | | | a chat | | | | | | | group | | | | | | | call with | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | using an | | | | | | | active | | | | | | | f | | | | | | | unctional | | | | | | | alias? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | The SS | \ element containing the \ element with:
a) the \ element set to a value of \"prearranged\";
b) the \ element set to the group identity;
c) the \ element set to the MCPTT client ID of the
originating MCPTT client;
NOTE 2: The MCPTT client does not include the MCPTT ID of the originating
MCPTT user in the body, as this will be inserted into the body of the SIP
INVITE request that is sent from the originating participating MCPTT function.
d) if the group identity can be determined to be a TGI and if the MCPTT client
can associate the TGI with a MCPTT group ID, the \
element set to the MCPTT group ID; and
e) if the MCPTT client is aware of active functional-aliases, and an active
functional alias is to be included in the initial SIP INVITE request, the
\ set to the URI of the used functional alias;
NOTE 3: The text \"can associate the TGI with a MCPTT group ID\" means that
the MCPTT client is able to determine that there is a constituent group of the
temporary group that it is a member of.
NOTE 4: The MCPTT client is informed about temporary groups and regrouping of
MCPTT groups that the user is a member of as specified in 3GPP TS 24.481 [31].
NOTE 5: If the MCPTT user selected a TGI where there are several MCPTT groups
where the MCPTT user is a member, the MCPTT client selects one of those MCPTT
groups.
NOTE 6: The MCPTT client learns the functional aliases that are activated for
an MCPTT ID from procedures specified in clause 9A.2.1.3.
15) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
clarifications given in clause 6.2.1;
16) if an implicit floor request is required, shall indicate this as specified
in clause 6.4; and
17) shall send the SIP INVITE request towards the MCPTT server according to
3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
1) shall interact with the user plane as specified in 3GPP TS 24.380 [5] ;
2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-
requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent peril
group call state is set to \"MIGC 2: imminent-peril-call-requested\" or \"MIGC
3: imminent-peril-call-granted\", the MCPTT client shall perform the actions
specified in clause 6.2.8.1.4;
2A) may notify the answer state to the user (i.e. \"Unconfirmed\" or
\"Confirmed\") if received in the P-Answer-State header field; and
3) may subscribe to the conference event package as specified in clause
10.1.3.1.
[TS 24.379, clause 10.1.3.2]
A MCPTT client may subscribe to the conference event package when a group call
is ongoing and the ongoing group call is not initiated as a broadcast group
call by sending a SIP SUBSCRIBE request to obtain information of the status of
a group session.
When subscribing to the conference event package, the MCPTT client:
1) shall generate a SIP SUBSCRIBE request and use a new SIP-dialog according
to IETF RFC 6665 [26], IETF RFC 4575 [30] and 3GPP TS 24.229 [4];
2) shall set the Request-URI of the SIP SUBSCRIBE request to the MCPTT session
identity of the group session;
3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
field according to IETF RFC 6050 [9];
4) shall include an Accept-Contact header with the media feature tag
g.3gpp.icsi-ref with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along
with \"require\" and \"explicit\" header field parameters according to IETF
RFC 3841 [6];
5) if the MCPTT client wants to receive the current status and later
notification, shall set the Expires header field according to IETF RFC 6665
[26], to 4294967295;
NOTE 1: 4294967295, which is equal to 2^32^-1, is the highest value defined
for Expires header field in IETF RFC 3261 [24].
6) if the MCPTT client wants to fetch the current state only, shall set the
Expires header field according to IETF RFC 6665 [26], to zero;
7) shall include an Accept header field containing the application/conference-
info+xml\"MIME type;
8) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element set to the MCPTT group ID of the group session;
and
9) shall send the SIP SUBSCRIBE request using a new SIP dialog according to
3GPP TS 24.229 [4].
The responses to the SIP SUBSCRIBE request shall be handled according to IETF
RFC 6665 [26], IETF RFC 4575 [30] and TS 24.229 [4].
Upon receiving a SIP NOTIFY requests to the previously sent SIP SUBSCRIBE
request the MCPTT client:
1) shall handle the request according to IETF RFC 6665 [26] and IETF RFC 4575
[30]; and
2) may display the current state information to the MCPTT client based on the
information in the SIP NOTIFY request body.
When needed the MCPTT client shall terminate the subscription and indicate it
terminated according to IETF RFC 6665 [26].
NOTE 2: The contents of the received SIP NOTIFY request body is specified in
clause 6.3.3.4.
[TS 24.379, clause 10.1.1.2.3.1]
When an MCPTT client wants to leave the MCPTT session that has been
established using on-demand session, the MCPTT client shall follow the
procedures as specified in clause 6.2.4.1.
##### 6.1.3.1.3 Test description {#test-description-39 .H6}
##### 6.1.3.1.3.1 Pre-test conditions {#pre-test-conditions-39 .H6}
##### System Simulator: {#system-simulator-39 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-39 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-39 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.3.1.3.2 Test procedure sequence {#test-procedure-sequence-39 .H6}
Table 6.1.3.1.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5 | | | | | | | .3A.1.3-1 | | | | | | | to** | | | | | | | establish | | | | | | | a group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.i of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5.3A | | | | | | | .1.3-1**? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | not | | | | | | | ification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | subscribe | | | | | | | to the | | | | | | | c | | | | | | | onference | | | | | | | event | | | | | | | package | | | | | | | for the | | | | | | | ongoing | | | | | | | group | | | | | | | call to | | | | | | | receive | | | | | | | the | | | | | | | current | | | | | | | status | | | | | | | and later | | | | | | | notif | | | | | | | ications. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5-8 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-5 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Sub | | | | | | | scription | | | | | | | and | | | | | | | Notif | | | | | | | ication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.29.3-1 | | | | | | | to | | | | | | | subscribe | | | | | | | to the | | | | | | | c | | | | | | | onference | | | | | | | event | | | | | | | package | | | | | | | for the | | | | | | | ongoing | | | | | | | group | | | | | | | call to | | | | | | | receive | | | | | | | the | | | | | | | current | | | | | | | status | | | | | | | and later | | | | | | | notif | | | | | | | ications? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | The SS | \ | SIP 200 | 2 | P | | | Does the | | (OK) | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | with a | | | | | | | SIP 200 | | | | | | | (OK) | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | de- | | | | | | | subscribe | | | | | | | from the | | | | | | | c | | | | | | | onference | | | | | | | event | | | | | | | package. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | Check: | --> | SIP | 3 | P | | | Does the | | SUBSCRIBE | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | SUBSCRIBE | | | | | | | message | | | | | | | with the | | | | | | | Expires | | | | | | | header | | | | | | | field set | | | | | | | to 0? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13 | The SS | \ with mcpttURI set to
px_MCPTT_Group_A_ID The URI of the group  
NOTE 1: Encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.1-1A
Table 6.1.3.1.3.3-8: SIP 200 (OK) from the SS (Steps 6, 13, Table
6.1.3.1.3.2-1;\ step 3, TS 36.579-1 [2] Table 5.3.29.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition SUBSCRIBE-
RSP
* * *
Information Element Value/remark Comment Reference Condition **Contact**  
addr-spec  
user-info and host \"sip:\" & \"conference-event-package\@cf.\" &
px_MCX_DomainName_Organization_A  
port not present
Table 6.1.3.1.3.3-9: SIP NOTIFY from the SS (step 7, Table 6.1.3.1.3.2-1;\
Step 4, TS 36.579-1 [2] Table 5.3.29.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1
* * *
Information Element Value/remark Comment Reference Condition **P-Asserted-
Identity**  
addr-spec  
user-info and host tsc_MCPTT_PublicServiceId_A TS 24.379 [9] clause 6.3.3.4  
**Event**  
**event-type** \"conference\" TS 24.379 [9] clause 6.3.3.4  
**Expires**  
**value** \"3600\" 3600 seconds TS 24.379 [9] clause 6.3.3.4  
**Subscription-State**  
expires \"3600\"  
**P-Preferred-Service**  
**Service-ID** \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" TS 24.379 [9] clause
6.3.3.4  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.3.1.3.3-10  
MIME body part **Conference-Info**  
MIME-part-body Conference-Info as described in Table 6.1.3.1.3.3-11
Table 6.1.3.1.3.3-10: MCPTT-Info in SIP NOTIFY (Table 6.1.3.1.3.3-9)
+-----------------+-----------------+---------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 [2], | | | | | | Table | | | | | | 5.5.3.2.2-1 | | | | | +=================+=================+=========+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +-----------------+-----------------+---------+-----------+-----------+ | mcpttinfo | | | | | +-----------------+-----------------+---------+-----------+-----------+ | mcptt-Params | | | | | +-----------------+-----------------+---------+-----------+-----------+ | mcptt- | not present | | | | | calling-user-id | | | | | +-----------------+-----------------+---------+-----------+-----------+ | mcptt-c | Encrypted (NOTE | | | | | alling-group-id | 1) | | | | | | \ | | | | | | with mcpttURI | | | | | | set to | | | | | | px\\_MCPT | | | | | | T\\_Group\\_A\\_ID | | | | +-----------------+-----------------+---------+-----------+-----------+ | > NOTE 1: | | | | | | > Encrypted | | | | | | > element as | | | | | | > described in | | | | | | > TS 36.579-1 | | | | | | > [2] Table | | | | | | > 5.5.3.2.2-1A | | | | | +-----------------+-----------------+---------+-----------+-----------+
Table 6.1.3.1.3.3-11: Conference-Info in SIP NOTIFY (Table 6.1.3.1.3.3-9)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.15-1
* * *
Table 6.1.3.1.3.3-12: SIP NOTIFY from the SS (step 9, Table 6.1.3.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1
* * *
Information Element Value/remark Comment Reference Condition **P-Asserted-
Identity**  
addr-spec  
user-info and host tsc_MCPTT_PublicServiceId_A TS 24.379 [9] clause 6.3.3.4  
**Event**  
**event-type** \"conference\" TS 24.379 [9] clause 6.3.3.4  
**Expires**  
**value** \"3600\" 3600 seconds TS 24.379 [9] clause 6.3.3.4  
**Subscription-State**  
expires \"3600\"  
**P-Preferred-Service**  
**Service-ID** \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" TS 24.379 [9] clause
6.3.3.4  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.3.1.3.3-10  
MIME body part **Conference-Info**  
MIME-part-body Conference-Info as described in Table 6.1.3.1.3.3-13
Table 6.1.3.1.3.3-13: Conference-Info in SIP NOTIFY (Table 6.1.3.1.3.3-12)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.15-1
* * *
Information Element Value/remark Comment Reference Condition conference-info  
users  
**user [3]**  
endpoint  
status disconnected
Table 6.1.3.1.3.3-14: SIP SUBSCRIBE from the UE (step 12, Table 6.1.3.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.14-1, condition re_SUBSCRIBE
* * *
Information Element Value/remark Comment Reference Condition **Accept-
Contact**  
**ac-value**  
**feature-param** **\"+g.3gpp.icsi-ref=urn:urn-7:3gpp-
service.ims.icsi.mcptt\"** TS 24.379 [9] clause 10.1.3.2  
**req-param** **\"require\"** TS 24.379 [9] clause 10.1.3.2  
**explicit-param** **\"explicit\"** TS 24.379 [9] clause 10.1.3.2  
**Expires**  
**value** \"0\" TS 24.379 [9] clause 10.1.3.2  
**Accept**  
**media-range** \"application/conference-info+xml\" TS 24.379 [9] clause
10.1.3.2  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.3.1.3.3-7
6.1.4 Remote Change of Selected Group
6.1.4.1 On-network / Remote Change of Selected Group / Selected Group Change
of Targeted User / Client Originated (CO)
##### 6.1.4.1.1 Test Purpose (TP) {#test-purpose-tp-40 .H6}
##### (1) {#section-125 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests to send a group selection change request to
change the selected group of a targeted MCPTT user to a specific MCPTT group }
**then** { UE (MCPTT Client) sends a SIP MESSAGE message **and** responds to a
SIP MESSAGE message with a SIP 200 (OK) message }
}
##### 6.1.4.1.2 Conformance Requirements {#conformance-requirements-40 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clause 10.1.4.2.1. Unless otherwise stated these are
Rel-15 requirements.
[TS 24.379, clause 10.1.4.2.1]
Upon receiving a request from the MCPTT user to send a group selection change
request to change the selected group of a targeted MCPTT user to a specific
MCPTT group, the MCPTT client:
> 1) if:
>
> a) the \ element does not exist in the MCPTT
> user profile document with one or more \ elements (see the MCPTT user
> profile document in 3GPP TS 24.484 [50]); or
>
> b) the \ element exists in the MCPTT user
> profile document and the MCPTT ID of the targeted MCPTT user does not match
> with one of the \ elements of the \
> element of the MCPTT user profile document (see the MCPTT user profile
> document in 3GPP TS 24.484 [50]);
>
> then:
>
> a) should indicate to the requesting MCPTT user that they are not authorised
> to change the selected MCPTT group of the targeted MCPTT user; and
>
> b) shall skip the rest of the steps of the present clause;
>
> 2) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229
> [4] and IETF RFC 3428 [33] with the following clarifications:
>
> a) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP MESSAGE request;
>
> b) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> c) may include a P-Preferred-Identity header field in the SIP MESSAGE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4]; and
>
> d) shall include an application/vnd.3gpp.mcptt-info+xml MIME body as
> specified in clause F.1 with the \ element containing the
> \ element containing:
>
> i) the \ set to the MCPTT group identity to be selected
> by the targeted MCPTT user; and
>
> ii) the \ element containing the \ element set to a
> value of \"group-selection-change-request\"; and
>
> e) shall insert in the SIP MESSAGE request a MIME resource-lists body with
> the MCPTT ID of the targeted MCPTT user, according to rules and procedures
> of IETF RFC 5366 [20];
>
> 3) shall set the Request-URI to the public service identity identifying the
> participating MCPTT function serving the MCPTT user; and
>
> 4) shall send the SIP MESSAGE request according to rules and procedures of
> 3GPP TS 24.229 [4].
Upon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request,
should indicate to the MCPTT user the failure of the sent group selection
change request and not continue with the rest of the steps.
Upon receiving a \"SIP MESSAGE request for group selection change response for
terminating client\", the MCPTT client:
> 1) shall determine the success or failure of the sent group selection change
> request from the value of the \ element
> contained in the \ element of the \ element of the
> \ element of the application/vnd.3gpp.mcptt-info+xml MIME body
> included in the received SIP MESSAGE request; and
>
> 2) should indicate to the MCPTT user the success or failure of the sent
> group selection change request.
##### 6.1.4.1.3 Test description {#test-description-40 .H6}
##### 6.1.4.1.3.1 Pre-test conditions {#pre-test-conditions-40 .H6}
##### System Simulator: {#system-simulator-40 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-40 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-40 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.4.1.3.2 Test procedure sequence {#test-procedure-sequence-40 .H6}
Table 6.1.4.1.3.2-1: Main behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request to | | | | | | | change the | | | | | | | selected | | | | | | | group of | | | | | | | user C to | | | | | | | group B. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | Request - | | | | | | | Accept | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.30.3-1 | | | | | | | to change | | | | | | | the | | | | | | | selected | | | | | | | group of a | | | | | | | targeted | | | | | | | user to a | | | | | | | specific | | | | | | | group? | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.4.1.3.3 Specific message contents {#specific-message-contents-40
.H6}
Table 6.1.4.1.3.3-1: SIP MESSAGE from the UE (Step 2, Table 6.1.4.1.3.2-1;\
Step 2, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info** TS 24.379 [9] clause F.1  
MIME-part-body MCPTT-Info as described in Table 6.1.4.1.3.3-2  
MIME body part **Resource-lists**  
MIME-part-body Resource-lists as described in Table 6.1.4.1.3.3-3
Table 6.1.4.1.3.3-2: MCPTT-Info in SIP MESSAGE (Table 6.1.4.1.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri Encrypted (NOTE 1) \ with mcpttURI set to
px_MCPTT_Group_B_ID The MCPTT group identity to be selected by the targeted
MCPTT user TS 24.379 [9] clause 10.1.4.2.1  
anyExt  
request-type \"group-selection-change-request\" TS 24.379 [9] clause
10.1.4.2.1  
NOTE 1: Encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.1-1A.
Table 6.1.4.1.3.3-3: Resource lists in SIP MESSAGE (Table 6.1.4.1.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.3.1-1
* * *
Information Element Value/remark Comment Reference Condition resource-lists  
list  
entry[1]  
uri attribute px_MCPTT_ID_User_C The targeted MCPTT user TS 24.379 [9] clause
10.1.4.2.1
Table 6.1.4.1.3.3-4: SIP MESSAGE from the SS (Step 2, Table 6.1.4.1.3.2-1;\
Step 4, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **P-Asserted-
Identity**  
name-addr px_MCX_SIP_PublicUserId_C TS 24.379 [9] clause 10.1.4.4  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.4.1.3.3-5
Table 6.1.4.1.3.3-5: MCPTT-Info in SIP MESSAGE (Table 6.1.4.1.3.3-4)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri Encrypted (NOTE 1) \ with mcpttURI set to
px_MCPTT_ID_User_A TS 24.379 [9] clause 10.1.4.4  
mcptt-calling-user-id Encrypted (NOTE 1) \ with
mcpttURI set to px_MCPTT_ID_User_C  
mcptt-calling-group-id Encrypted (NOTE 1) \ with
mcpttURI set to px_MCPTT_Group_B_ID  
anyExt  
response-type \"group-selection-change-response\" TS 24.379 [9] clause
10.1.4.4  
selected-group-change-outcome \"success\"  
NOTE 1: Encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.2-1A.
6.1.4.2 On-network / Remote Change of Selected Group / Selected Group Change
of Targeted User / Client Terminated (CT)
##### 6.1.4.2.1 Test Purpose (TP) {#test-purpose-tp-41 .H6}
##### (1) {#section-126 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { MCPTT User requests group to discover which groups the MCPTT User
is affiliated to and to subscribe to affiliation status changes for the MCPTT
User }
**then** { UE (MCPTT Client) sends a SIP SUBSCRIBE message **and** responds to
a SIP NOTIFY message with a SIP 200 (OK) message }
}
##### (2) {#section-127 .H6}
**with** { UE (MCPTT Client) having subscribed to affiliation status changes }
ensure that {
**when** { MCPTT User requests to de-affiliate from a group }
**then** { UE (MCPTT Client) sends a SIP PUBLISH message **and** responds to a
SIP NOTIFY message with a SIP 200 (OK) message }
}
##### (3) {#section-128 .H6}
**with** { UE (MCPTT Client) having subscribed to affiliation status changes }
ensure that {
**when** { UE (MCPTT Client) receives to send a group selection change request
to change the selected group of a targeted MCPTT user to a specific MCPTT
group via a SIP MESSAGE message }
**then** { UE (MCPTT Client) responds with a SIP 200 (OK) message **and**
initiates affiliation to the group by sending a SIP PUBLISH message **and**
responds to a SIP NOTIFY message with a SIP 200 (OK) message }
}
##### (4) {#section-129 .H6}
**with** { UE (MCPTT Client) having received a SIP MESSAGE message indicating
a group selection change request }
ensure that {
**when** { UE (MCPTT Client) determines that the group selection change is
successful }
**then** { UE (MCPTT Client) sends the group selection determination via a SIP
MESSAGE message }
}
##### 6.1.4.2.2 Conformance Requirements {#conformance-requirements-41 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clause 9.2.1.2, 9.2.1.3, 10.1.4.2.2. Unless otherwise
stated these are Rel-15 requirements.
[TS 24.379, clause 9.2.1.2]
In order:
> \- to indicate that an MCPTT user is interested in one or more MCPTT
> group(s) at an MCPTT client;
>
> \- to indicate that the MCPTT user is no longer interested in one or more
> MCPTT group(s) at the MCPTT client;
>
> \- to refresh indication of an MCPTT user interest in one or more MCPTT
> group(s) at an MCPTT client due to near expiration of the expiration time of
> an MCPTT group with the affiliation status set to the \"affiliated\" state
> received in a SIP NOTIFY request in clause 9.2.1.3;
>
> \- to send an affiliation status change request in mandatory mode to another
> MCPTT user; or
>
> \- any combination of the above;
the MCPTT client shall generate a SIP PUBLISH request according to 3GPP TS
24.229 [4], IETF RFC 3903 [37], and IETF RFC 3856 [51].
In the SIP PUBLISH request, the MCPTT client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCPTT function serving the MCPTT user;
>
> 2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the
> application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall
> include the \ element set to the MCPTT ID of the MCPTT
> user;
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9];
>
> 4) if the targeted MCPTT user is interested in at least one MCPTT group at
> the targeted MCPTT client, shall set the Expires header field according to
> IETF RFC 3903 [37], to 4294967295;
>
> NOTE 1: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 5) if the targeted MCPTT user is no longer interested in any MCPTT group at
> the targeted MCPTT client, shall set the Expires header field according to
> IETF RFC 3903 [37], to zero; and
>
> 6) shall include an application/pidf+xml MIME body indicating per-user
> affiliation information according to clause 9.3.1. In the MIME body, the
> MCPTT client:
>
> a) shall include all MCPTT groups where the targeted MCPTT user indicates
> its interest at the targeted MCPTT client;
>
> b) shall include the MCPTT client ID of the targeted MCPTT client;
>
> c) shall not include the \"status\" attribute and the \"expires\" attribute
> in the \ element; and
>
> d) shall set the \ child element of the \ root element to a
> globally unique value.
The MCPTT client shall send the SIP PUBLISH request according to 3GPP TS
24.229 [4].
[TS 24.379, clause 9.2.1.3]
> NOTE 1: The MCPTT UE also uses this procedure to determine which MCPTT
> groups the MCPTT user successfully affiliated to.
In order to discover MCPTT groups:
> 1) which the MCPTT user at an MCPTT client is affiliated to; or
>
> 2) which another MCPTT user is affiliated to;
the MCPTT client shall generate an initial SIP SUBSCRIBE request according to
3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26].
In the SIP SUBSCRIBE request, the MCPTT client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCPTT function serving the MCPTT user;
>
> 2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the
> application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall
> include the \ element set to the MCPTT ID of the targeted
> MCPTT user;
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9];
>
> 4) if the MCPTT client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [26], to 4294967295;
>
> NOTE 2: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 5) if the MCPTT client wants to fetch the current state only, shall set the
> Expires header field according to IETF RFC 6665 [26], to zero; and
>
> 6) shall include an Accept header field containing the application/pidf+xml
> MIME type; and
>
> 7) if requesting MCPTT groups where the MCPTT user is affiliated to at the
> MCPTT client, shall include an application/simple-filter+xml MIME body
> indicating per-client restrictions of presence event package notification
> information according to clause 9.3.2, indicating the MCPTT client ID of the
> MCPTT client.
In order to re-subscribe or de-subscribe, the MCPTT client shall generate an
in-dialog SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856
[51], and IETF RFC 6665 [26]. In the SIP SUBSCRIBE request, the MCPTT client:
> 1) if the MCPTT client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [26], to 4294967295;
>
> NOTE 3: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 2) if the MCPTT client wants to de-subscribe, shall set the Expires header
> field according to IETF RFC 6665 [26], to zero; and
>
> 3) shall include an Accept header field containing the application/pidf+xml
> MIME type.
Upon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC
3856 [51], and IETF RFC 6665 [26], if SIP NOTIFY request contains an
application/pidf+xml MIME body indicating per-user affiliation information
constructed according to clause 9.3.1, then the MCPTT client shall determine
affiliation status of the MCPTT user for each MCPTT group at the MCPTT
client(s) in the MIME body. If the \ child element of the \
root element of the application/pidf+xml MIME body of the SIP NOTIFY request
is included, the \ element value indicates the SIP PUBLISH request which
triggered sending of the SIP NOTIFY request.
[TS 24.379, clause 10.1.4.2.2]
Upon receiving a \"SIP MESSAGE request for group selection change request for
terminating client\", the MCPTT client:
> 1) if the received SIP MESSAGE request contains an
> application/vnd.3gpp.mcptt-info+xml MIME body containing an \ required> element set to a value of \"true\":
>
> a) shall invoke the procedures of clause 9.2.1.2 to affiliate to the MCPTT
> group identified by the contents of the \ included
> in the application/vnd.3gpp.mcptt-info+xml MIME body;
>
> b) if the MCPTT client has not already invoked the procedures of clause
> 9.2.1.3, shall invoke the procedures of clause 9.2.1.3; and
>
> c) upon receiving a SIP NOTIFY request including a \ element set to a
> value matching the \ value included in the SIP PUBLISH request sent in
> step 1) a) above as specified in clause 9.2.1.3, shall determine if the
> affiliation procedure to the MCPTT group identified by the contents of the
> \ in the received SIP MESSAGE request was
> successful;
>
> 2) if the received SIP MESSAGE request contained an
> application/vnd.3gpp.mcptt-info+xml MIME body containing an \ required> element set to a value of \"true\" and the affiliation was
> successful as determined in step 1) c) above, or if the \ required> element was not present in the received SIP MESSAGE request:
>
> a) shall change the MCPTT client\'s selected group to the MCPTT group
> identified by the contents of the \ element
> contained in the application/vnd.3gpp.mcptt-info+xml MIME body included in
> the received SIP MESSAGE request; and
>
> b) shall determine the success or failure of the change of selected group
> action;
>
> 3) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229
> [4] and IETF RFC 3428 [33] with the following clarifications:
>
> a) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP MESSAGE request;
>
> b) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> c) may include a P-Preferred-Identity header field in the SIP MESSAGE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> d) shall include in an application/resource-lists+xml MIME body, the MCPTT
> ID contained in the \ element in the application/
> vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request; and
>
> e) shall include an application/vnd.3gpp.mcptt-info+xml MIME body as
> specified in clause F.1 with the \ element containing the
> \ element containing:
>
> i) the \ element set to a value of \"group-selection-change-
> response\"; and
>
> ii) the \ element containing:
A) the \ element set to a value of \"group-selection-change-
response\";
> B) if the MCPTT client was able to successfully change the selected group as
> determined in step 2) b) above, then a \
> element set to a value of \"success\"; and
>
> C) if the MCPTT client:
>
> I) was required to affiliate to the MCPTT group identified by the contents
> of the \ in the received SIP MESSAGE request and the
> affiliation failed as determined in step 1) c); or
>
> II) failed to change the selected group as determined in step 2) b);
>
> then a \ element set to a value of \"fail\";
>
> 4) should indicate to the MCPTT user the success or failure of the requested
> change of selected group action;
>
> 5) shall set the Request-URI to the public service identity identifying the
> participating MCPTT function serving the MCPTT user; and
>
> 6) shall send the SIP MESSAGE request according to rules and procedures of
> 3GPP TS 24.229 [4].
##### 6.1.4.2.3 Test description {#test-description-41 .H6}
##### 6.1.4.2.3.1 Pre-test conditions {#pre-test-conditions-41 .H6}
##### System Simulator: {#system-simulator-41 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-41 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-41 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.4.2.3.2 Test procedure sequence {#test-procedure-sequence-41 .H6}
Table 6.1.4.2.3.2-1: Main behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | subscribe | | | | | | | to | | | | | | | a | | | | | | | ffiliation | | | | | | | status | | | | | | | det | | | | | | | ermination | | | | | | | and later | | | | | | | not | | | | | | | ifications | | | | | | | for user | | | | | | | A. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Su | | | | | | | bscription | | | | | | | and | | | | | | | Noti | | | | | | | fication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5.3.29.3-1 | | | | | | | to | | | | | | | subscribe | | | | | | | to its own | | | | | | | a | | | | | | | ffiliation | | | | | | | status | | | | | | | changes? | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | de-a | | | | | | | ffiliation | | | | | | | of user A | | | | | | | from group | | | | | | | A. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 4 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Group | | | | | | | A | | | | | | | ffiliation | | | | | | | Status | | | | | | | Change\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5.3.34.3-1 | | | | | | | to | | | | | | | de | | | | | | | -affiliate | | | | | | | with group | | | | | | | A? | | | | | +------------+------------+------------+---------+---------+----+ | 5-7 | Steps | - | - | - | - | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5.3.33.3-1 | | | | | | | are | | | | | | | performed | | | | | | | asking the | | | | | | | UE (MCPTT | | | | | | | client) to | | | | | | | change the | | | | | | | selected | | | | | | | group to | | | | | | | group A. | | | | | +------------+------------+------------+---------+---------+----+ | 8-12A | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-7 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Group | | | | | | | A | | | | | | | ffiliation | | | | | | | Status | | | | | | | Change\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5.3.34.3-1 | | | | | | | to | | | | | | | affiliate | | | | | | | with group | | | | | | | A? | | | | | +------------+------------+------------+---------+---------+----+ | 13-15 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-4 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5.3.32.3-1 | | | | | | | indicating | | | | | | | successful | | | | | | | change of | | | | | | | the | | | | | | | selected | | | | | | | group? | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.4.2.3.3 Specific message contents {#specific-message-contents-41
.H6}
Table 6.1.4.2.3.3-1: SIP SUBSCRIBE from the UE (step 2, Table 6.1.4.2.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.29.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.14-1
* * *
Information Element Value/remark Comment Reference Condition **Expires**  
delta-seconds \"4294967295\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.4.2.3.3-2
Table 6.1.4.2.3.3-2: MCPTT-Info in SIP SUBSCRIBE (Table 6.1.4.2.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri Encrypted (NOTE 1) \ with mcpttURI set to
px_MCPTT_ID_User_A  
NOTE 1: Encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.1-1A.
Table 6.1.4.2.3.3-3: SIP NOTIFY from the SS (step 2, Table 6.1.4.2.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.29.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 6.1.4.2.3.3-4
Table 6.1.4.2.3.3-4: PIDF in SIP NOTIFY (Table 6.1.4.2.3.3-3)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION
* * *
Information Element Value/remark Comment Reference Condition presence  
tuple  
status  
affiliation  
status affiliated
Table 6.1.4.2.3.3-5: SIP PUBLISH from the UE (step 4, Table 6.1.4.2.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.34.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.11-1, condition PRESENCE-EVENT
* * *
Information Element Value/remark Comment Reference Condition **Expires**  
delta-seconds 0  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.4.2.3.3-6  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 6.1.4.2.3.3-7
Table 6.1.4.2.3.3-6: MCPTT-Info in SIP PUBLISH (Table 6.1.4.2.3.3-5)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri Encrypted (NOTE 1) \ with mcpttURI set to
px_MCPTT_ID_User_A  
NOTE 1: Encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.1-1A.
Table 6.1.4.2.3.3-7: PIDF in SIP PUBLISH (Table 6.1.4.2.3.3-5)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.1-1, condition AFFILIATION
* * *
Information Element Value/remark Comment Reference Condition presence  
tuple  
status not present  
..p-id any allowed value p-id shall be present acc. to TS 24.379 [9] clause
9.2.2.2.5 and clause 9.2.2.3.5
Table 6.1.4.2.3.3-8: SIP NOTIFY from the SS (step 4, Table 6.1.4.2.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.34.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 6.1.4.2.3.3-9
Table 6.1.4.2.3.3-9: PIDF in SIP NOTIFY (Table 6.1.4.2.3.3-8)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION
* * *
Information Element Value/remark Comment Reference Condition presence  
tuple  
status  
affiliation  
status deaffiliating  
..p-id same value as received in corresponding SIP PUBLISH
Table 6.1.4.2.3.3-10: SIP NOTIFY from the SS (step 4, Table 6.1.4.2.3.2-1;\
step 6, TS 36.579-1 [2] Table 5.3.34.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 6.1.4.2.3.3-11
Table 6.1.4.2.3.3-11: PIDF in SIP NOTIFY (Table 6.1.4.2.3.3-10)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION
* * *
Information Element Value/remark Comment Reference Condition presence  
tuple id  
status not present  
..p-id same value as received in the corresponding SIP PUBLISH
Table 6.1.4.2.3.3-12: SIP MESSAGE from the SS (Step 6, Table 6.1.4.2.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info** TS 24.379 [9] clause F.1  
MIME-part-body MCPTT-Info as described in Table 6.1.4.2.3.3-13
Table 6.1.4.2.3.3-13: MCPTT-Info in SIP MESSAGE (Table 6.1.4.2.3.3-12)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri Encrypted (NOTE 1) \ with mcpttURI set to
px_MCPTT_ID_User_A TS 24.379 [9] clause 10.1.4.4  
mcptt-calling-group-id Encrypted (NOTE 1) \ with
mcpttURI set to px_MCPTT_Group_A_ID  
anyExt  
request-type \"group-selection-change-request\" TS 24.379 [9] clause 10.1.4.4  
affiliation-required \"true\" TS 24.379 [9] clause 10.1.4.4  
NOTE 1: Encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.2-1A.
Table 6.1.4.2.3.3-14: SIP PUBLISH from the UE (step 8, Table 6.1.4.2.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.34.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.11-1, condition PRESENCE-EVENT
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.4.2.3.3-15  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 6.1.4.2.3.3-16
Table 6.1.4.2.3.3-15: MCPTT-Info in SIP PUBLISH (Table 6.1.4.2.3.3-14)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri Encrypted (NOTE 1) \ with mcpttURI set to
px_MCPTT_ID_User_A  
NOTE 1: Encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.1-1A.
Table 6.1.4.2.3.3-16: PIDF in SIP PUBLISH (Table 6.1.4.2.3.3-14)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.1-1, condition AFFILIATION
* * *
Information Element Value/remark Comment Reference Condition ..p-id any
allowed value p-id shall be present acc. to TS 24.379 [9] clause 9.2.2.2.5 and
clause 9.2.2.3.5
Table 6.1.4.2.3.3-17: SIP NOTIFY from the SS (step 10, Table 6.1.4.2.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.34.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 6.1.4.2.3.3-18
Table 6.1.4.2.3.3-18: PIDF in SIP NOTIFY (Table 6.1.4.2.3.3-17)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION
* * *
Information Element Value/remark Comment Reference Condition presence  
tuple  
status  
affiliation  
status affiliating  
..p-id same value as received in corresponding SIP PUBLISH
Table 6.1.4.2.3.3-18A: SIP NOTIFY from the SS (step 12, Table 6.1.4.2.3.2-1;\
step 6, TS 36.579-1 [2] Table 5.3.34.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **PIDF**  
MIME-part-body PIDF as described in Table 6.1.4.2.3.3-18B
Table 6.1.4.2.3.3-18B: PIDF in SIP NOTIFY (Table 6.1.4.2.3.3-18A)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION
* * *
Information Element Value/remark Comment Reference Condition presence  
tuple  
status  
affiliation  
status affiliated  
..p-id same value as received in corresponding SIP PUBLISH
Table 6.1.4.2.3.3-19: SIP MESSAGE from the UE (Step 13, Table 6.1.4.2.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.32.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition RESOURCE_LISTS
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.4.2.3.3-20
Table 6.1.4.2.3.3-20: MCPTT-Info in SIP MESSAGE (Table 6.1.4.2.3.3-19)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri Encrypted (NOTE 1) \ with mcpttURI set to
px_MCPTT_Group_A_ID The MCPTT group identity to be selected by the targeted
MCPTT user TS 24.379 [9] clause 10.1.4.2.2  
anyExt  
response-type \"group-selection-change-response\" TS 24.379 [9] clause
10.1.4.2.2  
selected-group-change-outcome \"success\" TS 24.379 [9] clause 10.1.4.2.2  
NOTE 1: Encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.1-1A.
6.1.5 Remotely initiated group call
6.1.5.1 On-network / Remotely initiated group call / Client Originated (CO)
##### 6.1.5.1.1 Test Purpose (TP) {#test-purpose-tp-42 .H6}
##### (1) {#section-130 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests to send a remotely initiated group call
request to a remote MCPTT user for a targeted MCPTT group, Group A, with
affiliation status of the remote MCPTT user to the targeted MCPTT group
needing to be verified, and indicate that the remote MCPTT user not be
notified of the remotely initiated group call request }
**then** { UE (MCPTT Client) sends a SIP SUBSCRIBE message to subscribe to
affiliation status changes of a target user **and** responds to a SIP NOTIFY
message with a SIP 200 (OK) message }
}
##### (2) {#section-131 .H6}
**with** { MCPTT User having requested to send a remotely initiated group call
request to a remote MCPTT user }
ensure that {
**when** { UE (MCPTT Client) determines that the targeted MCPTT user is
affiliated to the targeted group }
**then** { UE (MCPTT Client) sends a SIP MESSAGE message to initiate a
remotely initiated group call **and** responds to a SIP MESSAGE status
response with a SIP 200 (OK) message }
}
##### 6.1.5.1.2 Conformance Requirements {#conformance-requirements-42 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 10.1.5.2.1, 9.2.1.3. Unless otherwise stated
these are Rel-15 requirements.
[TS 24.379, clause 10.1.5.2.1]
Upon receiving a request from the requesting MCPTT user to send a remotely
initiated group call request to the remote MCPTT user for a targeted MCPTT
group, the MCPTT client:
> 1) if:
>
> a) the \ element of the \
> element is not present in the requesting MCPTT user\'s MCPTT user profile
> document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is
> set to a value of \"false\":
>
> then:
>
> a) should indicate to the requesting MCPTT user that the requesting MCPTT
> user is not authorised to initiate a remotely initiated group call request
> to the remote MCPTT user; and
>
> b) shall skip the rest of the steps of the present clause;
>
> 2) if:
>
> a) the requesting MCPTT user has indicated that the affiliation status of
> the remote MCPTT user to the targeted MCPTT group needs to be verified; and
>
> b) the \ element of the \ element
> of the MCPTT user profile document identified by the MCPTT ID of the
> requesting MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484
> [50]) is set to a value of \"false\";
>
> i) should indicate to the requesting MCPTT user that the requesting MCPTT
> user is not authorised to request the affiliation status of other MCPTT
> users; and
>
> ii) shall skip the rest of the steps of the present clause; and
>
> c) the \ element of the of the \
> element of the MCPTT user profile document identified by the MCPTT ID of the
> requesting MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484
> [50]) is set to a value of \"true\";
>
> then:
>
> a) shall invoke the procedures of clause 9.2.1.3 to determine if the remote
> MCPTT user is affiliated to the targeted MCPTT group; and
>
> b) if the remote MCPTT user is determined to not be affiliated to the
> targeted MCPTT group:
>
> i) if the \ of the \
> element of the MCPTT user profile document identified by the MCPTT ID of the
> requesting MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484
> [50]) is set to a value of \"false\":
>
> A) should indicate to the requesting MCPTT user that the requesting MCPTT
> user is not authorised to initiate a remotely initiated group call request
> to the targeted MCPTT user; and
>
> B) shall skip the rest of the steps of the present clause; and
>
> ii) if the \ of the \
> element of the MCPTT user profile document identified by the MCPTT ID of the
> requesting MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484
> [50]) is set to a value of \"true\";
>
> A) shall invoke the procedures of clause 9.2.1.2 to affiliate the remote
> MCPTT user to the targeted MCPTT group by the requesting MCPTT user;
>
> B) if the procedures of clause 9.2.1.2 were not successful:
>
> I) should indicate to the requesting MCPTT user that the requesting MCPTT
> user is not authorised to initiate a remotely initiated group call request
> to the remote MCPTT user; and
>
> II) shall skip the rest of the steps of the present clause; and
>
> C) upon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF
> RFC 3856 [51], and IETF RFC 6665 [26]:
>
> I) if the SIP NOTIFY request contains an application/pidf+xml MIME body
> indicating per-user affiliation information constructed according to clause
> 9.3.1, shall determine if the per user affiliation information indicates
> that the remote MCPTT user is affiliated;
>
> II) if per user affiliation information in the received SIP NOTIFY request
> indicates that the remote MCPTT user is not affiliated to the targeted MCPTT
> group, should indicate to the requesting MCPTT user that the remote MCPTT
> user cannot be affiliated to the targeted MCPTT group; and
>
> III) if it is determined in the previous step that the remote MCPTT user
> cannot be affiliated to the targeted MCPTT group, shall skip the rest of the
> steps of the present clause;
>
> 3) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229
> [4] and IETF RFC 3428 [33] with the following clarifications:
>
> a) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP MESSAGE request;
>
> b) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> c) may include a P-Preferred-Identity header field in the SIP MESSAGE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> d) shall include an application/vnd.3gpp.mcptt-info+xml MIME body as
> specified in clause F.1 with the \ element containing the
> \ element containing:
>
> i) the \ set to the MCPTT group identity of the targeted
> MCPTT group for the remotely initiated call; and
>
> ii) an \ element containing:
>
> A) the \ element set to a value of \"remotely-initiated-
> private-call-request\";
>
> B) the \ element set to a value of \"true\" if the
> requesting MCPTT user has indicated that the remote MCPTT user be notified
> of the remotely initiated group call request; and
>
> C) the \ element set to a value of \"false\" if the
> requesting MCPTT user has indicated that the remote MCPTT user not be
> notified of the remotely initiated group call request;
>
> e) shall insert in the SIP MESSAGE request a MIME resource-lists body with
> the MCPTT ID of the remote MCPTT user, according to rules and procedures of
> IETF RFC 5366 [20]; and
>
> f) shall set the Request-URI to the public service identity identifying the
> participating MCPTT function serving the remote MCPTT user; and
>
> 4) shall send the SIP MESSAGE request towards the MCPTT server according to
> rules and procedures of 3GPP TS 24.229 [4].
Upon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request,
should indicate to the requesting MCPTT user the failure of the sent remotely
initiated group call request and not continue with the rest of the steps.
Upon receiving a \"SIP MESSAGE request for remotely initiated group call
response for terminating client\", the MCPTT client:
> 1) shall determine the success or failure of the sent remotely initiated
> group call request from the value of the \
> element contained in the \ element of the \ element of
> the \ element of the application/vnd.3gpp.mcptt-info+xml MIME
> body included in the received SIP MESSAGE request; and
>
> 2) should indicate to the requesting MCPTT user the success or failure of
> the sent remotely initiated group call request.
[TS 24.379, clause 9.2.1.3]
> NOTE 1: The MCPTT UE also uses this procedure to determine which MCPTT
> groups the MCPTT user successfully affiliated to.
In order to discover MCPTT groups:
> 1) which the MCPTT user at an MCPTT client is affiliated to; or
>
> 2) which another MCPTT user is affiliated to;
the MCPTT client shall generate an initial SIP SUBSCRIBE request according to
3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26].
In the SIP SUBSCRIBE request, the MCPTT client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCPTT function serving the MCPTT user;
>
> 2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the
> application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall
> include the \ element set to the MCPTT ID of the targeted
> MCPTT user;
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9];
>
> 4) if the MCPTT client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [26], to 4294967295;
>
> NOTE 2: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 5) if the MCPTT client wants to fetch the current state only, shall set the
> Expires header field according to IETF RFC 6665 [26], to zero; and
>
> 6) shall include an Accept header field containing the application/pidf+xml
> MIME type; and
>
> 7) if requesting MCPTT groups where the MCPTT user is affiliated to at the
> MCPTT client, shall include an application/simple-filter+xml MIME body
> indicating per-client restrictions of presence event package notification
> information according to clause 9.3.2, indicating the MCPTT client ID of the
> MCPTT client.
In order to re-subscribe or de-subscribe, the MCPTT client shall generate an
in-dialog SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856
[51], and IETF RFC 6665 [26]. In the SIP SUBSCRIBE request, the MCPTT client:
> 1) if the MCPTT client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [26], to 4294967295;
>
> NOTE 3: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [24].
>
> 2) if the MCPTT client wants to de-subscribe, shall set the Expires header
> field according to IETF RFC 6665 [26], to zero; and
>
> 3) shall include an Accept header field containing the application/pidf+xml
> MIME type.
Upon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC
3856 [51], and IETF RFC 6665 [26], if SIP NOTIFY request contains an
application/pidf+xml MIME body indicating per-user affiliation information
constructed according to clause 9.3.1, then the MCPTT client shall determine
affiliation status of the MCPTT user for each MCPTT group at the MCPTT
client(s) in the MIME body. If the \ child element of the \
root element of the application/pidf+xml MIME body of the SIP NOTIFY request
is included, the \ element value indicates the SIP PUBLISH request which
triggered sending of the SIP NOTIFY request.
##### 6.1.5.1.3 Test description {#test-description-42 .H6}
##### 6.1.5.1.3.1 Pre-test conditions {#pre-test-conditions-42 .H6}
##### System Simulator: {#system-simulator-42 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-42 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-42 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The affiliation status of MCPTT User B, the targeted MCPTT User, is
unknown.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.5.1.3.2 Test procedure sequence {#test-procedure-sequence-42 .H6}
Table 6.1.5.1.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a | | | | | | | remotely | | | | | | | initiated | | | | | | | group call | | | | | | | by user B | | | | | | | in group A | | | | | | | with | | | | | | | ve | | | | | | | rification | | | | | | | of user | | | | | | | B\'s | | | | | | | a | | | | | | | ffiliation | | | | | | | status and | | | | | | | user B not | | | | | | | being | | | | | | | notified | | | | | | | of the | | | | | | | remotely | | | | | | | initiated | | | | | | | group call | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX | | | | | | | Su | | | | | | | bscription | | | | | | | and | | | | | | | Noti | | | | | | | fication\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.29.3-1 | | | | | | | to | | | | | | | subscribe | | | | | | | to | | | | | | | a | | | | | | | ffiliation | | | | | | | status | | | | | | | changes of | | | | | | | a target | | | | | | | user? | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | Request - | | | | | | | Accept | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.30.3-1 | | | | | | | to send a | | | | | | | remotely | | | | | | | initiated | | | | | | | group call | | | | | | | request to | | | | | | | a remote | | | | | | | user for a | | | | | | | targeted | | | | | | | group? | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.5.1.3.3 Specific message contents {#specific-message-contents-42
.H6}
Table 6.1.5.1.3.3-1: SIP SUBSCRIBE from the UE (step 2, Table 6.1.5.1.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.29.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.14-1
* * *
Information Element Value/remark Comment Reference Condition **Expires**  
delta-seconds \"4294967295\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.5.1.3.3-2
Table 6.1.5.1.3.3-2: MCPTT-Info in SIP SUBSCRIBE (Table 6.1.5.1.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri Encrypted (NOTE 1) \ with mcpttURI set to
px_MCPTT_ID_User_B  
NOTE 1: Encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.1-1A.
Table 6.1.5.1.3.3-3: SIP NOTIFY from the SS (step 2, Table 6.1.5.1.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.29.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.8-1, condition PRESENCE-EVENT
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
**MIME body part** **PIDF**  
MIME-part-body PIDF as described in Table 6.1.5.1.3.3-4
Table 6.1.5.1.3.3-4: PIDF in SIP NOTIFY (Table 6.1.5.1.3.3-3)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.5.2-1, condition AFFILIATION
* * *
Information Element Value/remark Comment Reference Condition presence entity  
entity attribute Encrypted URI (NOTE 1) with value set to px_MCPTT_ID_User_B  
tuple id  
Id attribute Encrypted URI (NOTE 1) with value set to px_MCPTT_Client_B_ID  
status  
affiliation  
status "affiliated"  
NOTE 1: Encrypted attribute as described in TS 36.579-1 [2] Table 5.5.13.3-1
Table 6.1.5.1.3.3-5: SIP MESSAGE from the UE (step 3, Table 6.1.5.1.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition RESOURCE_LISTS
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.5.1.3.3-6
Table 6.1.5.1.3.3-6: MCPTT-Info in SIP MESSAGE (Table 6.1.5.1.3.3-5)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri Encrypted (NOTE 1) \ with mcpttURI set to
px_MCPTT_Group_A_ID The MCPTT group identity of the targeted MCPTT group for
the remotely initiated call TS 24.379 [9] clause 10.1.5.2.1  
anyExt  
request-type \"remotely-initiated-group-call-request\" TS 24.379 [9] clause
10.1.5.2.1  
notify-remote-user \"false\" TS 24.379 [9] clause 10.1.5.2.1  
NOTE 1: Encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.1-1A.
Table 6.1.5.1.3.3-7: SIP MESSAGE from the SS (step 3, Table 6.1.5.1.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **P-Asserted-
Identity**  
name-addr px_MCX_SIP_PublicUserId_B TS 24.379 [9] clause 10.1.5.4  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.5.1.3.3-8
Table 6.1.5.1.3.3-8: MCPTT-Info in SIP MESSAGE (Table 6.1.5.1.3.3-7)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri Encrypted (NOTE 1) \ with mcpttURI set to
px_MCPTT_ID_User_A TS 24.379 [9] clause 10.1.5.4  
mcptt-calling-group-id Encrypted (NOTE 1) \ with
mcpttURI set to px_MCPTT_Group_A_ID TS 24.379 [9] clause 10.1.5.4  
anyExt  
response-type \"remotely-initiated-group-call-response\" TS 24.379 [9] clause
10.1.5.4  
remotely-initiated-call-outcome \"success\" TS 24.379 [9] clause 10.1.5.4  
NOTE 1: Encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.2-1A.
6.1.5.2 On-network / Remotely initiated group call / Client Terminated (CT)
##### 6.1.5.2.1 Test Purpose (TP) {#test-purpose-tp-43 .H6}
##### (1) {#section-132 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { UE (MCPTT Client) receives a request for a remotely initiated group
call via a SIP MESSAGE message }
**then** { UE (MCPTT Client) responds with a SIP 200 (OK) message **and**
initiates a group call via a SIP INVITE message **and** responds to the
corresponding SIP 200 (OK) message with a SIP ACK message **and** provides
floor granted notification to the MCPTT User }
}
##### (2) {#section-133 .H6}
**with** { UE (MCPTT Client) having a request for a remotely initiated group
call }
ensure that {
**when** { UE (MCPTT Client) successfully initiates the requested group call }
**then** { UE (MCPTT Client) sends a SIP MESSAGE message to indicate the
status of the remotely initiated group call }
}
##### (3) {#section-134 .H6}
**with** { UE (MCPTT Client) having an ongoing group call }
ensure that {
**when** { UE (MCPTT Client) receives a SIP BYE message}
**then** { UE (MCPTT Client) responds with a SIP 200 (OK) message and releases
the call }
}
##### 6.1.5.2.2 Conformance Requirements {#conformance-requirements-43 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 10.1.5.2.2, 10.1.1.2.1.1, 10.1.1.2.3.3. Unless
otherwise stated these are Rel-15 requirements.
[TS 24.379, clause 10.1.5.2.2]
Upon receiving a \"SIP MESSAGE request for remotely initiated group call
request for terminating client\", the MCPTT client:
> 1) if the \ element contained in the
> application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP
> MESSAGE request is set to a value of \"true\", may indicate to the remote
> MCPTT user that a remotely initiated call request to call the targeted MCPTT
> group has been received; and
>
> 2) shall invoke the procedures of clause 10.1.1.2.1.1 to originate an MCPTT
> group call to the targeted MCPTT group with the following clarifications:
>
> a) if the \ element contained in the
> application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP
> MESSAGE request is set to a value of \"false\":
>
> i) shall not indicate to the remote MCPTT user that a remotely initiated
> call request to call the targeted MCPTT group has been received; and
>
> ii) shall not give any indication to the remote MCPTT user that the remotely
> initiated call origination is in progress.
Upon completion of the procedures of clause 10.1.1.2.1.1, the MCPTT client:
> 1) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229
> [4] and IETF RFC 3428 [33] with the following clarifications:
>
> a) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP MESSAGE request;
>
> b) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> c) may include a P-Preferred-Identity header field in the SIP MESSAGE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4]; and
>
> d) shall include in an application/resource-lists+xml MIME body the MCPTT ID
> contained in the \ element in the application/
> vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request; and
>
> e) shall include an application/vnd.3gpp.mcptt-info+xml MIME body as
> specified in clause F.1 with the \ element containing the
> \ element containing:
>
> i) the \ set to the MCPTT group identity called by the
> remote MCPTT user; and
>
> ii) an \ element containing:
>
> A) the \ element set to a value of \"remotely-initiated-
> group-call-response\";
>
> B) if the procedures of clause 10.1.1.2.1.1 were successful in originating
> an MCPTT group call to the targeted MCPTT group, a \ call-outcome> element set to a value of \"success\"; and
>
> C) if the procedures of clause 10.1.1.2.1.1 were not successful in
> originating an MCPTT group call to the targeted MCPTT group, a \ initiated-call-outcome> element set to a value of \"fail\";
>
> 2) shall set the Request-URI to the public service identity identifying the
> participating MCPTT function serving the requesting MCPTT user; and
>
> 3) shall send the SIP MESSAGE request according to rules and procedures of
> 3GPP TS 24.229 [4].
[TS 24.379, clause 10.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT prearranged
group session the MCPTT client shall generate an initial SIP INVITE request by
following the UE originating session procedures specified in 3GPP TS 24.229
[4], with the clarifications given below.
The MCPTT client:
> 1) if the MCPTT user has requested the origination of an MCPTT emergency
> group call or is originating an MCPTT prearranged group call and the MCPTT
> emergency state is already set, the MCPTT client shall comply with the
> procedures in clause 6.2.8.1.1;
>
> 2) if the MCPTT user has requested the origination of an MCPTT imminent
> peril group call, the MCPTT client shall comply with the procedures in
> clause 6.2.8.1.9;
>
> 3) if the MCPTT user has requested the origination of a broadcast group
> call, the MCPTT client shall comply with the procedures in clause 6.2.8.2;
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 8) should include the \"timer\" option tag in the Supported header field;
>
> 9) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the \"refresher\" header field parameter is
> omitted. If included, the \"refresher\" header field parameter shall be set
> to \"uac\";
>
> 10) shall set the Request-URI of the SIP INVITE request to the public
> service identity identifying the participating MCPTT function serving the
> MCPTT user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 11) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> 12) if the MCPTT client emergency group state for this group is set to \"MEG
> 2: in-progress\" or \"MEG 4: confirm-pending\", the MCPTT client shall
> include the Resource-Priority header field and comply with the procedures in
> clause 6.2.8.1.2;
>
> 13) if the MCPTT client imminent peril group state for this group is set to
> \"MIG 2: in-progress\" or \"MIG 4: confirm-pending\" shall include the
> Resource-Priority header field and comply with the procedures in clause
> 6.2.8.1.12;
>
> 14) shall contain in an application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"prearranged\";
>
> b) the \ element set to the group identity;
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client;
>
> NOTE 2: The MCPTT client does not include the MCPTT ID of the originating
> MCPTT user in the body, as this will be inserted into the body of the SIP
> INVITE request that is sent from the originating participating MCPTT
> function.
>
> d) if the group identity can be determined to be a TGI and if the MCPTT
> client can associate the TGI with a MCPTT group ID, the \ id> element set to the MCPTT group ID; and
>
> e) if the MCPTT client is aware of active functional-aliases, and an active
> functional alias is to be included in the initial SIP INVITE request, the
> \ set to the URI of the used functional alias;
>
> NOTE 3: The text \"can associate the TGI with a MCPTT group ID\" means that
> the MCPTT client is able to determine that there is a constituent group of
> the temporary group that it is a member of.
>
> NOTE 4: The MCPTT client is informed about temporary groups and regrouping
> of MCPTT groups that the user is a member of as specified in 3GPP TS 24.481
> [31].
>
> NOTE 5: If the MCPTT user selected a TGI where there are several MCPTT
> groups where the MCPTT user is a member, the MCPTT client selects one of
> those MCPTT groups.
>
> NOTE 6: The MCPTT client learns the functional aliases that are activated
> for an MCPTT ID from procedures specified in clause 9A.2.1.3.
>
> 15) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarifications given in clause 6.2.1;
>
> 16) if an implicit floor request is required, shall indicate this as
> specified in clause 6.4; and
>
> 17) shall send the SIP INVITE request towards the MCPTT server according to
> 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5] ;
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in clause 6.2.8.1.4;
>
> 2A) may notify the answer state to the user (i.e. \"Unconfirmed\" or
> \"Confirmed\") if received in the P-Answer-State header field; and
>
> 3) may subscribe to the conference event package as specified in clause
> 10.1.3.1.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request:
> 1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\"; or
>
> 2) if the MCPTT imminent peril group call state is set to \"MIGC 2:
> imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";
the MCPTT client shall perform the actions specified in clause 6.2.8.1.5.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the MCPTT client shall follow
the actions specified in clause 6.2.8.1.13.
[TS 24.379, clause 10.1.1.2.3.3]
Upon receiving a SIP BYE request for releasing the prearranged MCPTT group
call, the MCPTT client shall follow the procedures as specified in clause
6.2.6.
##### 6.1.5.2.3 Test description {#test-description-43 .H6}
##### 6.1.5.2.3.1 Pre-test conditions {#pre-test-conditions-43 .H6}
##### System Simulator: {#system-simulator-43 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-43 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-43 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.1.5.2.3.2 Test procedure sequence {#test-procedure-sequence-43 .H6}
Table 6.1.5.2.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1-3 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5\. | | | | | | | 3.33.3-1** | | | | | | | to send | | | | | | | the | | | | | | | request | | | | | | | for a | | | | | | | remotely | | | | | | | initiated | | | | | | | group call | | | | | | | to the UE | | | | | | | (MCPTT | | | | | | | client)? | | | | | +------------+------------+------------+---------+---------+----+ | 4 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3A.1.3-1 | | | | | | | to**| | | | | | | establish | | | | | | | a group | | | | | | | call with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.i of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | |** 5.3 | | | | | | | A.1.3-1**? | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6-7 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-3 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3.32.3-1 | | | | | | | f** or a | | | | | | | remotely | | | | | | | initiated | | | | | | | group call | | | | | | | response? | | | | | +------------+------------+------------+---------+---------+----+ | 7A | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.12.3-1 | | | | | | | to release | | | | | | | the call? | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.5.2.3.3 Specific message contents {#specific-message-contents-43
.H6}
Table 6.1.5.2.3.3-1: SIP MESSAGE from the SS (Step 2, Table 6.1.5.2.3.2-1;\
Step 2, TS 36.579-1 [2], Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **P-Asserted-
Identity**  
name-addr px_MCX_SIP_PublicUserId_B TS 24.379 [9] clause 10.1.5.4  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.5.2.3.3-2
Table 6.1.5.2.3.3-2: MCPTT-Info in SIP MESSAGE (Table 6.1.5.2.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri Encrypted (NOTE 1) \ with mcpttURI set to
px_MCPTT_ID_User_A TS 24.379 [9] clause 10.1.5.4  
mcptt-calling-group-id Encrypted (NOTE 1) \ with
mcpttURI set to px_MCPTT_Group_A_ID TS 24.379 [9] clause 10.1.5.4  
anyExt  
request-type \"remotely-initiated-group-call-request\" TS 24.379 [9] clause
10.1.5.4  
notify-remote-user \"true\" TS 24.379 [9] clause 10.1.5.4  
NOTE 1: Encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.2-1A.
Table 6.1.5.2.3.3-3: SIP INVITE from the UE (step 4, Table 6.1.5.2.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.1.5.2.3.3-4  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.5.2.3.3-5
Table 6.1.5.2.3.3-4: SDP in SIP INVITE (Table 6.1.5.2.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
INITIAL_SDP_OFFER, IMPLICIT_GRANT_REQUESTED
* * *
Table 6.1.5.2.3.3-5: MCPTT-Info in SIP INVITE (Table 6.1.5.2.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL,
INVITE_REFER
* * *
Table 6.1.5.2.3.3-6: SIP 200 (OK) from the SS (step 4, Table 6.1.5.2.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.1.5.2.3.3-7
Table 6.1.5.2.3.3-7: SDP in SIP 200 (OK) (Table 6.1.5.2.3.3-6)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
IMPLICIT_GRANT_REQUESTED, IMPLICIT_FLOOR_GRANTED
* * *
Table 6.1.5.2.3.3-8: SIP MESSAGE from the UE (Step 6, Table 6.1.5.2.3.2-1;\
step 2, TS 36.579-1 [2], Table 5.3.32.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition RESOURCE_LISTS
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.1.5.2.3.3-9
Table 6.1.5.2.3.3-9: MCPTT-Info in SIP MESSAGE (Table 6.1.5.2.3.3-8)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-request-uri Encrypted (NOTE 1) \ with mcpttURI set to
px_MCPTT_Group_A_ID The MCPTT group identity called by the remote MCPTT user
TS 24.379 [9] clause 10.1.5.2.2  
anyExt  
response-type \"remotely-initiated-group-call-response\" TS 24.379 [9] clause
10.1.5.2.2  
remotely-initiated-call-outcome \"success\" TS 24.379 [9] clause 10.1.5.2.2  
NOTE 1: Encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.1-1A.
Table 6.1.5.2.3.3-10: SIP BYE from the SS (step 8, Table 6.1.5.2.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3.12.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1, condition MO_CALL
* * *
## 6.2 Private Calls
6.2.1 On-network / Private Call / On-demand / Automatic Commencement Mode /
With Floor Control / Upgrade to Emergency Call / Cancellation of Emergency on
User request / Client Originated (CO)
##### 6.2.1.1 Test Purpose (TP) {#test-purpose-tp-44 .H6}
##### (1) {#section-135 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate/cancel private and private emergency calls
with automatic commencement }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT private call,
on-demand Automatic Commencement Mode, no Force of automatic commencement,
applying End-to-end communication security with Floor Control }
**then** { UE (MCPTT Client) sends a SIP INVITE message requesting private
call on-demand Automatic Commencement Mode, applying End-to-end communication
security, and offering a media-level section for a media-floor control entity,
**and** , after indication from the MCPTT Server that the call was established
notifies the user }
}
##### (2) {#section-136 .H6}
**with** { UE (MCPTT Client) having established an MCPTT private call, on-
demand Automatic Commencement Mode with Floor Control }
ensure that {
**when** { the MCPTT User engages in communication with the invited MCPTT User
}
**then** { UE (MCPTT Client) respects the floor control imposed by the MCPTT
Server (Floor granting/release/deny) applying Floor Control confidentiality
and integrity protection }
}
##### (3) {#section-137 .H6}
**with** { UE (MCPTT Client) having established an MCPTT private call, on-
demand Automatic Commencement Mode with Floor Control }
ensure that {
**when** { the MCPTT User wants to upgrade the ongoing MCPTT private call to
an MCPTT emergency private call with floor control }
**then** { UE (MCPTT Client) sends a SIP re-INVITE message requesting private
emergency call on-demand Automatic Commencement Mode offering a media-level
section for a media-floor control entity, **and** , upon receipt of a SIP 200
(OK) response considers the call as being upgraded to emergency private call
(emergency private call state = \"MEPC 3: emergency-pc-granted\") }
}
##### (4) {#section-138 .H6}
**with** { UE (MCPTT Client) having upgraded an MCPTT private call, on-demand
Automatic Commencement Mode with Floor Control to emergency private call with
floor control }
ensure that {
**when** { the MCPTT User engages in communication with the invited MCPTT User
}
**then** { UE (MCPTT Client) respects the floor control imposed by the MCPTT
Server including override of the invited MCPTT user (who is not in MCPTT
emergency state) and applying Floor Control confidentiality and integrity
protection }
}
##### (5) {#section-139 .H6}
**with** { UE (MCPTT Client) having upgraded an MCPTT private call, on-demand
Automatic Commencement Mode with Floor Control to emergency private call with
floor control }
ensure that {
**when** { the MCPTT User wants to cancel the ongoing MCPTT emergency private
call }
**then** { UE (MCPTT Client) sends a SIP re-INVITE request requesting the
emergency state cancellation, **and**. upon receipt of a SIP 200 (OK) response
considers the emergency condition cancelled and the call being reverted back
to MCPTT Private Call }
}
##### (6) {#section-140 .H6}
**with** { UE (MCPTT Client) having an ongoing MCPTT private call, on-demand
Automatic Commencement Mode with Floor Control }
ensure that {
**when** { the MCPTT User wants to terminate the ongoing MCPTT private call }
**then** { UE (MCPTT Client) sends a SIP BYE request and after receiving a SIP
200 (OK) leaves the MCPTT session }
}
##### 6.2.1.2 Conformance requirements {#conformance-requirements-44 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 4.6.2, 4.7, 6.2.1, 6.2.5.1, 6.2.8.3.4,
6.2.8.3.6, 11.1.1.2.1.1, 11.1.1.2.1.4, 11.1.1.2.1.5, 11.1.3.1.1.1, TS 24.380
clauses 4.1.1.2, 5.2.1, 5.2.2, 12.1.2.2, 13.1, 13.3.3, TS 33.180, clause
5.3.4. Unless otherwise stated these are Rel-13 requirements.
[TS 24.379, clause 4.6.2]
Key aspects of MCPTT emergency private calls include:
> \- adjusted EPS bearer priority for both participants whether or not they
> are both in an emergency condition (i.e. both have their MCPTT emergency
> state set). This is achieved by using the Resource-Priority header field as
> specified in IETF RFC 4412 [29] with namespaces defined for use by MCPTT
> specified in draft-holmberg-dispatch-mcptt-rp-namespace [48];
>
> \- the initiator of the MCPTT emergency private call can override the other
> MCPTT user in the MCPTT emergency private call unless that user also has
> their MCPTT emergency state set;
>
> ...
>
> \- restoration of normal floor control priority participants when the
> emergency elevated priority is cancelled;
>
> \- requires the MCPTT user to be authorised to either originate or cancel an
> MCPTT emergency private call;
>
> ...
>
> \- the originator of the MCPTT emergency private call can request that the
> call use either manual or automatic commencement mode.
[TS 24.379, clause 4.7]
If a mission critical organisation requires MCPTT users to communicate using
end-to-end security, a security context needs to be established between the
initiator of the call and the recipient(s) of the call, prior to the
establishment of media, or floor control signalling. This provides assurance
to MCPTT users that no unauthorised access to communications is taking place
within the MCPTT network. An MCPTT key management server (KMS) manages the
security domain. For any end-point to use or access end-to-end secure
communications, it needs to be provisioned with keying material associated to
its identity by the KMS as specified in 3GPP TS 33.179 [46].
...
For private calls, the security context is initiated at call setup. An end-to-
end security context is established that is unique to the pair of users
involved in the call. The procedure involves transferral of an encapsulated
private call key (PCK) and private call key id (PCK-ID) from the initiator to
the terminator. The PCK is encrypted using the terminator\'s MCPTT ID and
domain-specific material provided from the KMS. The PCK and PCK-ID are
distributed within a MIKEY payload within the SDP offer of the private call
request. This payload is called a MIKEY-SAKKE I_MESSAGE, as defined in IETF
RFC 6509 [75], which ensures the confidentiality, integrity and authenticity
of the payload. The encoding of the MIKEY payload in the SDP offer is
described in IETF RFC 4567 [47] using an \"a=key-mgmt\" attribute. The payload
is signed using a key associated to the identity of the initiating user. At
the terminating side, the signature is validated. If valid, the UE extracts
and decrypts the encapsulated PCK. The MCPTT UE also extracts the PCK-ID. This
process is described in 3GPP TS 33.179 [46]. With the PCK successfully shared
between the two MCPTT UEs, the UEs are able to use SRTP/SRTCP to create an
end-to-end secure session.
End-to-end security is independent of the transmission path and hence is
applicable to both on and off-network communications. With a security context
established, the group call key and private call key can be used to encrypt
media and, if required, floor control traffic between the end-points as
described in 3GPP TS 24.380 [5] clause 13.
[TS 33.179, clause 5.3.4]
End-to-end communication security for either group or private calls requires
the provisioning of key material from the KMS. The key material provisioned to
each user is listed below:
> \- A KMSInit Response contains the Home KMS Certificate (domain specific key
> material associated to the KMS), and may contain:
>
> \- An updated TrK for the user (to replace the offline-provisioned,
> bootstrap TrK).
>
> \- A KMSKeyProv Response contains zero, or more, KMSKeySets and may contain:
>
> \- An updated TrK for the user (to replace existing TrK).
>
> \- A KMSCertCache Response may contain:
>
> \- Home KMS Certificate(s) (current, updated or future).
>
> \- External KMS Certificates. This is domain specific key material
> associated with other KMSs. It is required to enable secure communications
> across security domains.
[TS 24.379, clause 6.2.1]
The SDP offer shall contain only one SDP media-level section for MCPTT speech
according to 3GPP TS 24.229 [4] and, if floor control shall be used during the
session, shall contain one SDP media-level section for a media-floor control
entity according to 3GPP TS 24.380 [5].
When composing an SDP offer according to 3GPP TS 24.229 [4] the MCPTT client:
> 1) shall set the IP address of the MCPTT client for the offered MCPTT speech
> media stream and, if floor control shall be used, for the offered media-
> floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP offer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 2) shall include an \"m=audio\" media-level section for the MCPTT media
> stream consisting of:
>
> a) the port number for the media stream selected; and
>
> b) the codec(s) and media parameters and attributes with the following
> clarification:
>
> ...
>
> c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4];
>
> 3) if floor control shall be used during the session, shall include an
> \"m=application\" media-level section as specified in 3GPP TS 24.380 [5]
> clause 12 for a media-floor control entity, consisting of:
>
> a) the port number for the media-floor control entity selected as specified
> in 3GPP TS 24.380 [5]; and
>
> b) the \'fmtp\' attributes as specified in 3GPP TS 24.380 [5] clause 14; and
>
> 4) if end-to-end security is required for a private call and the SDP offer
> is not for establishing a pre-established session, shall include the MIKEY-
> SAKKE I_MESSAGE in an \"a=key-mgmt\" attribute as a \"mikey\" attribute
> value in the SDP offer as specified in IETF RFC 4567 [47].
[TS 24.379, clause 6.2.5.1]
When the MCPTT client wants to release an MCPTT session established using on-
demand session signalling, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 3) shall set the Request-URI to the MCPTT session identity to release; and
>
> 4) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT
client shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.379, clause 6.2.8.3.4]
On receiving a SIP 2xx response to a SIP request for an MCPTT emergency
private call and if the MCPTT emergency private call state is set to \"MEPC 2:
emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\", the MCPTT
client:
> 1) shall set the MCPTT emergency private priority state of the call to
> \"MEPP 2: in-progress\" if it was not already set;
>
> 2) shall set the MCPTT emergency private call state to \"MEPC 3: emergency-
> pc-granted\"; and
[TS 24.379, clause 6.2.8.3.6]
When the MCPTT emergency private call state is set to \"MEPC 3: emergency-pc-
granted\" and the MCPTT emergency alert state is set to \"MPEA 1: no-alert\",
the MCPTT client shall generate a SIP re-INVITE request according to 3GPP TS
24.229 [4] with the clarifications given below.
> NOTE 1: This procedure assumes that the MCPTT client in the calling
> procedure has verified that the MCPTT user has made an authorised request
> for cancelling MCPTT the in-progress emergency private call state of the
> call.
The MCPTT client:
> 1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
> info+xml MIME body as defined in clause F.1 with the \
> element set to \"false\";
>
> 2) shall clear the MCPTT emergency state; and
>
> 3) shall set MCPTT emergency private priority state of the MCPTT emergency
> private call to \"MEPP 3: cancel-pending\".
>
> NOTE 2: This is the case of an MCPTT user who has initiated an MCPTT
> emergency private call and wants to cancel it.
[TS 24.379, clause 11.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT private call
the MCPTT client shall generate an initial SIP INVITE request by following the
UE originating session procedures specified in 3GPP TS 24.229 [4], with the
clarifications given below.
The MCPTT client:
> 1) shall set the Request-URI of the SIP INVITE request to a public service
> identity of the participating MCPTT function serving the MCPTT user;
>
> ...
>
> 3) may include a P-Preferred-Identity header field in the SIP INVITE request
> containing a public user identity as specified in 3GPP TS 24.229 [4];
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the media feature tag
> g.3gpp.icsi-ref contain with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\"
> according to IETF RFC 3841 [6];
>
> 8) shall insert in the SIP INVITE request a MIME resource-lists body with
> the MCPTT ID of the invited MCPTT user, according to rules and procedures of
> IETF RFC 5366 [20];
>
> 9) if an end-to-end security context needs to be established then:
>
> a) if necessary, shall instruct the key management client to request keying
> material from the key management server as described in 3GPP TS 33.179 [46];
>
> b) shall use the keying material to generate a PCK as described in 3GPP TS
> 33.179 [46];
>
> c) shall use the PCK to generate a PCK-ID with the four most significant
> bits set to \"0001\" to indicate that the purpose of the PCK is to protect
> private call communications and with the remaining twenty eight bits being
> randomly generated as described in 3GPP TS 33.179 [46];
>
> d) shall encrypt the PCK to a UID associated to the MCPTT client using the
> MCPTT ID of the invited user and a time related parameter as described in
> 3GPP TS 33.179 [46];
>
> e) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and
> PCK-ID as specified in 3GPP TS 33.179 [46]; and
>
> g) shall add the MCPTT ID of the originating MCPTT to the initiator field
> (IDRi) of the I_MESSAGE as described in 3GPP TS 33.179 [46]; and
>
> f) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user\'s
> signing key provided in the keying material together with a time related
> parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
> 33.179 [46].
>
> 10) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarification given in subclause 6.2.1 and with a media stream of the
> offered media-floor control entity;
>
> 11) if implicit floor control is required, shall comply with the conditions
> specified in subclause 6.4;
>
> ...13) if force of automatic commencement mode at the invited MCPTT client
> is not requested by the MCPTT user and:
>
> a) if automatic commencement mode at the invited MCPTT client is requested
> by the MCPTT user, shall include in the SIP INVITE request an Answer-Mode
> header field with the value \"Auto\" according to the rules and procedures
> of IETF RFC 5373 [18]; and
>
> ...
>
> 14) shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element containing the \ element with the
> \ element set to a value of \"private\";
>
> ...
>
> 16) shall send SIP INVITE request towards the MCPTT server according to 3GPP
> TS 24.229 [4].
Upon receiving a SIP 183(Session Progress) response to the SIP INVITE request
the MCPTT client:
> 1) may indicate the progress of the session establishment to the inviting
> MCPTT user.
Upon receiving a SIP 200 (OK) response to the SIP INVITE request the MCPTT
client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> ...
>
> 3) shall notify the user that the call has been successfully established.
[TS 24.379, clause 11.1.1.2.1.4]
Upon receiving a request from an MCPTT user to cancel the in-progress
emergency condition on an MCPTT emergency private call, the MCPTT client shall
generate a SIP re-INVITE request by following the UE session procedures
specified in 3GPP TS 24.229 [4], with the clarifications given below.
The MCPTT client:
> 1) if the MCPTT user is not authorised to cancel the in-progress emergency
> condition on an MCPTT emergency private call as determined by the procedures
> of subclause 6.2.8.3.1.2, the MCPTT client:
>
> a) should indicate to the MCPTT user that they are not authorised to cancel
> the in-progress emergency condition on an MCPTT emergency private call; and
>
> b) shall skip the remaining steps of the current subclause;
>
> 2) shall, if the MCPTT user is cancelling an in-progress emergency condition
> and optionally an MCPTT emergency alert originated by the MCPTT user,
> include an application/vnd.3gpp.mcptt-info+xml MIME body populated as
> specified in subclause 6.2.8.3.6;
>
> ...
>
> 4) shall include a Resource-Priority header field and comply with the
> procedures in subclause 6.2.8.3.3;
>
> 5) shall include in the SIP re-INVITE request an SDP offer the media
> parameters as currently established;
>
> NOTE 1: The SIP re-INVITE request can be sent within an on-demand session or
> a pre-established session associated with an MCPTT group session. If the SIP
> re-INVITE request is sent within a pre-established session, the media-level
> section for the offered MCPTT speech media stream and the media-level
> section of the offered media-floor control entity are expected to be the
> same as was negotiated in the existing pre-established session.
>
> 6) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 7) shall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP re-INVITE request, the MCPTT
client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall set the MCPTT emergency private priority state of the MCPTT private
> call to \"MEPP 1: no-emergency\";
>
> 3) shall set the MCPTT emergency private call state of the call to \"MEPC 1:
> emergency-pc-capable\"; and
[TS 24.379, clause 11.1.1.2.1.5]
Upon receiving a request from an MCPTT user to upgrade the ongoing MCPTT
private call to an MCPTT emergency private call, the MCPTT client shall
generate a SIP re-INVITE request as specified in 3GPP TS 24.229 [4], with the
clarifications given below.
> 1) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated
> as specified in subclause 6.2.8.3.2;
>
> 2) shall include a Resource-Priority header field and comply with the
> procedures in subclause 6.2.8.3.3.
>
> 3) shall include an SDP offer with the media parameters as currently
> established according to 3GPP TS 24.229 [4];
>
> NOTE: The SIP re-INVITE request can be sent within an on-demand session or a
> pre-established session associated with an MCPTT private call. If the SIP
> re-INVITE request is sent within a pre-established session, the media-level
> section for the offered MCPTT speech media stream and the media-level
> section of the offered media-floor control entity are expected to be the
> same as was negotiated in the existing pre-established session.
>
> 4) if an implicit floor request is required, shall indicate this as
> specified in subclause 6.4; and
>
> 5) shall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP re-INVITE request the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall perform the actions specified in subclause 6.2.8.3.4.
[TS 24.379, clause 11.1.3.1.1.1]
Upon receiving a request from an MCPTT user to release an MCPTT private call
session established using on-demand session signalling, the MCPTT client shall
follow the procedures as specified in subclause 6.2.5.1.
[TS 24.380, clause 4.1.1.2]
At any point in time a group member can request permission to talk.
When all group members are silent, a group member can press the PTT button,
meaning the request for permission to talk. The floor participant entity of
this user reflects this request to the floor control server by sending a Floor
Request message. If the floor control server decides to permit, it informs
this permission for this request by sending a Floor Granted message to the
requesting group member. The floor control server informs the initiation of
the talk to the other group members by sending a Floor Taken message. Once the
group member receives the permission, a permission indication (permission
tone) is generated and the user can talk. The media packets (encoded voice)
are sent to the controlling MCPTT server and from there they are distributed
to all listeners of this group. The release of the PTT button indicates the
user's intension to end talking. Once the PTT button is released, the floor
participant sends a Floor Release message to the floor control server
indicating that this user has finished talking. This cycle, starting from the
Floor Granted message and ending with Floor Release message, is known as
\'talk burst\' or \'media burst\'.
In the beginning of a call the initial talk permission request can be implied
by the SIP message which initiates the call as specified in 3GPP TS 24.379 [2]
without any specific Floor Request message.
A group member can also request for permission to talk by sending a Floor
Request message during a talk burst. The floor control server can resolve this
request in several ways.
> 1\. If this request has higher priority than the ongoing talk burst, the
> floor control server revokes the current talk burst by sending a Floor
> Revoke message to the current talker. The current talker is interrupted and
> the current media burst is ended by the current floor participant by sending
> a Floor Release message. Then the floor control server sends a Floor Granted
> message to the revoking user and send Floor Taken message to other group
> members. Then a new media burst starts.
>
> 2\. If this request does not have higher priority and floor request queuing
> is not used the floor control server rejects this request by sending a Floor
> Deny message to the requester. Then a reject indication (reject tone) is
> generated for the user. The ongoing talk burst continues.
...
During silence (when no talk burst is ongoing), the floor control server can
send Floor Idle message to all floor participants from time to time. The floor
control server sends Floor Idle message in the beginning of silence.
[TS 24.380, clause 5.2.1]
To be compliant with the procedures in the present document, an MCPTT client
shall:
> 1\. support the role of an MCPTT client as specified 3GPP TS 23.179 [5];
>
> 2\. support the on-network MCPTT client role as specified in 3GPP TS 24.379
> [2];
>
> ...
>
> 4\. support media plane security as specified in clause 13.
To be compliant with the on-network procedures in the present document, an
MCPTT client shall:
> 1\. provide the role of a floor participant in on-network mode as specified
> in subclause 5.2.2;
>
> 2\. provide the media mixer function as described in subclause 4.2.2 and
> support the related procedures in subclause 6.2;
>
> ...
>
> 4\. provide PTT button events towards the on-network floor participant as
> specified in subclause 6.2;
>
> 5\. provide means (sound, display, etc.) for indications towards the MCPTT
> user as specified in subclause 6.2;
>
> 6\. support negotiating media plane control channel media level attributes
> as specified in subclause 4.3; and
[TS 24.380, clause 5.2.2]
To be compliant with the on-network procedures in the present document, a
floor participant in on-network mode shall:
> 1\. support the on-network floor control procedures as defined in 3GPP TS
> 23.179 [5];
>
> 2\. support acting as an on-network floor participant as specified in
> subclause 6.2; and
>
> 3\. support the on-network mode floor control protocol elements as specified
> in the clause 8.
A floor participant in on-network mode may:
> 1\. support queuing of floor requests as specified in subclause 6.2 and
> subclause 4.1.1.2.
[TS 24.380, clause 12.1.2.2]
In an SDP offer, the \"mc_priority\" fmtp attribute indicates (using an
integer value between \'1\' and \'255\') the maximum floor priority that the
offeror requests to be used with Floor Request messages sent by the offeror.
In an SDP answer, the attribute parameter indicates the maximum priority level
that the answerer has granted to the offeror. The value has to be equal or
less than the value provided in the associated SDP offer.
> NOTE 1: If the \"mc_priority\" fmtp attribute is not used within an SDP
> offer or answer, a default priority value is assumed.
In an SDP offer, the \"mc_granted\" fmtp attribute parameter indicates that
the offeror supports the procedure where the answerer indicates, using the
fmtp attribute in the associated SDP answer, that the floor has been granted
to the offeror.
> NOTE 2: When the \"mc_granted\" fmtp attribute is used in an SDP offer, it
> does not indicate an actual request for the floor. The SDP
> \"mc_implicit_request\" fmtp attribute can be used to request the floor. In
> an SDP answer, the attribute indicates that the floor has been granted to
> the offeror.
>
> NOTE 3: Once the offeror has been granted the floor, the offeror has the
> floor until it receives a Floor Revoke message, or until the offeror itself
> releases the floor by sending a Floor Release message, as described in the
> present specification.
In an SDP offer, the \"mc_implicit_request\" fmtp attribute indicates that the
offeror implicitly requests the floor (without the need to send a Floor
Request message). In an SDP answer, the attribute parameter indicates that the
answerer has accepted the implicit floor request. Once the answerer grants the
floor to the offeror, the answerer will send a Floor Granted message.
> NOTE 4: The usage of the \"mc_implicit_request\" fmtp attribute in an SDP
> answer does not mean that the answerer has granted the floor to the offeror,
> only that the answerer has accepted the implicit floor request.
[TS 24.380, clause 13.1]
Media plane security provides integrity and confidentiality protection of
individual media streams and media plane control messages in MCPTT sessions.
The media plane security is based on 3GPP MCPTT security solution including
key management and end-to-end media and floor control messages protection as
defined in 3GPP TS 33.179 [14].
Various keys and associated key identifiers protect:
> 1\. RTP transported media;
>
> 2\. RTCP transported media control messages (i.e. RTCP SR packets, RTCP RR
> packets, RTCP SDES packets);
>
> 3\. RTCP APP transported floor control messages;
>
> ...
In an on-network private call:
> 1\. if protection of media is negotiated, the PCK and the PCK-ID protect
> media sent and received by the MCPTT clients;
>
> 2\. if protection of floor control messages sent using unicast between the
> MCPTT client and the participating MCPTT function serving the MCPTT client
> is negotiated, the CSK and the CSK-ID protect the floor control messages
> sent and received by the MCPTT client and by the participating MCPTT
> function;
>
> ...
>
> 4\. if protection of media control messages sent using unicast between the
> MCPTT client and the participating MCPTT function serving the MCPTT client
> is negotiated, the CSK and the CSK-ID protect the media control messages
> sent and received using unicast by the MCPTT client and by a participating
> MCPTT function; and
...
The CSK and the CSK-ID are generated by the MCPTT client and provided to the
participating MCPTT function serving the MCPTT client using SIP signalling
according to 3GPP TS 24.379 [2].
..
The PCK and the PCK-ID are generated by the MCPTT client initiating the
private call and provided to the MCPTT client receiving the private call using
SIP signalling according to 3GPP TS 24.379 [2], using Connect message
described in subclause 8.3.4 or using MONP signalling according to 3GPP TS
24.379 [2].
[TS 24.380, clause 13.3.3]
> 3\. in an on-network private call:
>
> A) if:
>
> i) protection of media is negotiated in originating call and the PCK and the
> PCK-ID were sent to the remote MCPTT client using SIP signalling according
> to 3GPP TS 24.379 [2]; or
>
> ...
>
> then:
>
> i) shall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS
> 33.179 [14] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the PCK and
> PCK-ID as specified in subclause 13.2; and
>
> ii) shall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS
> 33.179 [14] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the PCK and
> PCK-ID as specified in subclause 13.2;
>
> B) if protection of floor control messages is negotiated and the CSK and the
> CSK-ID were sent to the participating MCPTT function using SIP signalling
> according to 3GPP TS 24.379 [2]:
>
> i) shall encrypt sent floor control messages according to IETF RFC 3711 [16]
> and 3GPP TS 33.179 [14] using SRTP-MK, SRTP-MS and SRTP-MKI generated using
> the CSK and CSK-ID as specified in subclause 13.2; and
>
> ii) shall decrypt received floor control messages according to IETF RFC 3711
> [16] and 3GPP TS 33.179 [14] using SRTP-MK, SRTP-MS and SRTP-MKI generated
> using the CSK and CSK-ID as specified in subclause 13.2; and
>
> D) if protection of media control messages sent using unicast between the
> participating MCPTT function and the MCPTT client is negotiated and the CSK
> and the CSK-ID were sent to the participating MCPTT function using SIP
> signalling according to 3GPP TS 24.379 [2]:
>
> i) shall encrypt media control messages sent using unicast according to IETF
> RFC 3711 [16] and 3GPP TS 33.179 [14] using SRTP-MK, SRTP-MS and SRTP-MKI
> generated using the CSK and CSK-ID as specified in subclause 13.2; and
>
> ii) shall decrypt media control messages received using unicast according to
> IETF RFC 3711 [16] and 3GPP TS 33.179 [14] using SRTP-MK, SRTP-MS and SRTP-
> MKI generated using the CSK and CSK-ID as specified in subclause 13.2;
##### 6.2.1.3 Test description {#test-description-44 .H6}
##### 6.2.1.3.1 Pre-test conditions {#pre-test-conditions-44 .H6}
##### System Simulator: {#system-simulator-44 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-44 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-44 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.1.3.2 Test procedure sequence {#test-procedure-sequence-44 .H6}
Table 6.2.1.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | private | | | | | | | call to | | | | | | | user B | | | | | | | with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1, 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.1.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a private | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.ii of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3A.1.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3-5 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 5A | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | not | | | | | | | ification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | Floor | | | | | | | Release | | | | | | | -- Floor | | | | | | | Taken\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3 | | | | | | | A.16.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8-9 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 10 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | Floor | | | | | | | Request | | | | | | | -- Floor | | | | | | | Deny\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3 | | | | | | | A.14.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 13 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 14 | The SS | \ with mcpttBoolean set to false
Encryption according to NOTE 2 in TS 36.579-1 [2] Table 5.5.3.2.1-1
Table 6.2.1.3.3-5A: SIP 200 (OK) from the SS (step 34, Table 6.2.1.3.2-1;\
step 3, TS 36.579-1 [2] Table 5.3A.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.2.1.3.3-5B
Table 6.2.1.3.3-5B: SDP in SIP 200 (OK) (Table 6.2.1.3.3-3A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER
* * *
Table 6.2.1.3.3-6..12: Void
Table 6.2.1.3.3-13: Floor Request (Step 28, Table 6.2.1.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3A.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.2-1, condition EMERGENCY_CALL.
* * *
Table 6.2.1.3.3-14: Floor Granted (Steps 20, 28, Table 6.2.1.3.2-1;\ step 5,
TS 36.579-1 [2] Table 5.3A.6.3-1; step 2, TS 36.579-1 [2] Table 5.3A.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.3-1, condition EMERGENCY_CALL
* * *
Table 6.2.1.3.3-15: Floor Release (Steps 24, 31, Table 6.2.1.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3A.16.3-1; step 1, TS 36.579-1 [2] Table 5.3A.15.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.5-1, condition EMERGENCY_CALL
* * *
Table 6.2.1.3.3-16: Floor Taken (Step 24, Table 6.2.1.3.2-1;\ step 3, TS
36.579-1 [2] Table 5.3A.16.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.7-1, condition EMERGENCY_CALL
* * *
Table 6.2.1.3.3-17: Floor Idle (Step 31, Table 6.2.1.3.2-1;\ step 3, TS
36.579-1 [2] Table 5.3A.15.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.6-1, condition EMERGENCY_CALL
* * *
6.2.2 On-network / Private Call / On-demand / Automatic Commencement Mode /
With Floor Control / Upgrade to Emergency Call / Cancellation of Emergency on
User request / Client Terminated (CT)
##### 6.2.2.1 Test Purpose (TP) {#test-purpose-tp-45 .H6}
##### (1) {#section-141 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to receive private and private emergency calls with
automatic commencement }
ensure that {
**when** { the UE (MCPTT Client) receives a request for establishment of an
MCPTT private call, on-demand Automatic Commencement Mode, no Force of
automatic commencement, applying End-to-end communication security with Floor
Control }
**then** { UE (MCPTT Client) sends a SIP 200 (OK) accepting the establishment
of an MCPTT private call, on-demand Automatic Commencement Mode applying End-
to-end communication security with Floor Control, **and** , notifies the user
for the call establishment }
##### (2) {#section-142 .H6}
**with** { UE (MCPTT Client) having established an On-demand Automatic
Commencement Mode Private Call with Floor Control }
ensure that {
**when** { the MCPTT User (MCPTT Client) engages in communication with the
inviting MCPTT User }
**then** { UE (MCPTT Client) respects the floor control imposed by the MCPTT
Server (Floor granting/release/deny) applying Floor Control confidentiality
and integrity protection }
}
##### (3) {#section-143 .H6}
**with** { UE (MCPTT Client) having established an MCPTT private call, on-
demand Automatic Commencement Mode with Floor Control }
ensure that {
**when** { the MCPTT User (MCPTT Client) receives a request for upgrade of the
ongoing MCPTT private call to an MCPTT emergency private call with floor
control }
**then** { UE (MCPTT Client) accepts the request and upon sending SIP 200 (OK)
message considers the call as being upgraded to emergency private call
(emergency private call state = \"MEPC 3: emergency-pc-granted\") }
}
##### (4) {#section-144 .H6}
**with** { UE (MCPTT Client) having upgraded an On-demand Automatic
Commencement Mode Private Call to emergency private call }
ensure that {
**when** { the MCPTT User (MCPTT Client) continues communication with the
invited MCPTT User }
**then** { UE (MCPTT Client) respects the floor control imposed by the MCPTT
Server including being able to handle override requested by the inviting MCPTT
user and applying Floor Control confidentiality and integrity protection }
}
##### (5) {#section-145 .H6}
**with** { UE (MCPTT Client) having upgraded an On-demand Automatic
Commencement Mode Private Call to an Emergency Private Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) receives a request to cancel the
ongoing MCPTT emergency private call }
**then** { UE (MCPTT Client) accepts the request and after sending a SIP 200
(OK) response considers the emergency condition cancelled and the call being
reverted back to MCPTT Private Call }
}
##### (6) {#section-146 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Automatic
Commencement Mode Private Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) receives a request for termination of
the ongoing MCPTT private call }
**then** { UE (MCPTT Client) accept the request and after sending a SIP 200
(OK) response leaves the MCPTT session }
}
##### 6.2.2.2 Conformance requirements {#conformance-requirements-45 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 4.6.2, 4.7, 6.2.2, 6.2.3.1.1, 6.2.6,
11.1.1.2.1.2, 11.1.1.2.1.3, 11.1.3.1.1.2, TS 24.380 clauses 4.1.1.2, 5.2.1,
5.2.2, 12.1.2.2, 13.1, 13.3.3, TS 33.180, clause 5.3.4. Unless otherwise
stated these are Rel-13 requirements.
[TS 24.379, clause 4.6.2]
Key aspects of MCPTT emergency private calls include:
> \- adjusted EPS bearer priority for both participants whether or not they
> are both in an emergency condition (i.e. both have their MCPTT emergency
> state set). This is achieved by using the Resource-Priority header field as
> specified in IETF RFC 4412 [29] with namespaces defined for use by MCPTT
> specified in draft-holmberg-dispatch-mcptt-rp-namespace [48];
>
> \- the initiator of the MCPTT emergency private call can override the other
> MCPTT user in the MCPTT emergency private call unless that user also has
> their MCPTT emergency state set;
>
> ...
>
> \- restoration of normal floor control priority participants when the
> emergency elevated priority is cancelled;
>
> ...
>
> \- requires the targeted MCPTT user to be authorised to receive an MCPTT
> emergency private call;
[TS 24.379, clause 4.7]
If a mission critical organisation requires MCPTT users to communicate using
end-to-end security, a security context needs to be established between the
initiator of the call and the recipient(s) of the call, prior to the
establishment of media, or floor control signalling. This provides assurance
to MCPTT users that no unauthorised access to communications is taking place
within the MCPTT network. An MCPTT key management server (KMS) manages the
security domain. For any end-point to use or access end-to-end secure
communications, it needs to be provisioned with keying material associated to
its identity by the KMS as specified in 3GPP TS 33.179 [46].
...
For private calls, the security context is initiated at call setup. An end-to-
end security context is established that is unique to the pair of users
involved in the call. The procedure involves transferral of an encapsulated
private call key (PCK) and private call key id (PCK-ID) from the initiator to
the terminator. The PCK is encrypted using the terminator\'s MCPTT ID and
domain-specific material provided from the KMS. The PCK and PCK-ID are
distributed within a MIKEY payload within the SDP offer of the private call
request. This payload is called a MIKEY-SAKKE I_MESSAGE, as defined in IETF
RFC 6509 [75], which ensures the confidentiality, integrity and authenticity
of the payload. The encoding of the MIKEY payload in the SDP offer is
described in IETF RFC 4567 [47] using an \"a=key-mgmt\" attribute. The payload
is signed using a key associated to the identity of the initiating user. At
the terminating side, the signature is validated. If valid, the UE extracts
and decrypts the encapsulated PCK. The MCPTT UE also extracts the PCK-ID. This
process is described in 3GPP TS 33.179 [46]. With the PCK successfully shared
between the two MCPTT UEs, the UEs are able to use SRTP/SRTCP to create an
end-to-end secure session.
End-to-end security is independent of the transmission path and hence is
applicable to both on and off-network communications. With a security context
established, the group call key and private call key can be used to encrypt
media and, if required, floor control traffic between the end-points as
described in 3GPP TS 24.380 [5] clause 13.
[TS 33.180, clause 5.3.4]
End-to-end communication security for either group or private calls requires
the provisioning of key material from the KMS. The key material provisioned to
each user is listed below:
> \- A KMSInit Response contains the Home KMS Certificate (domain specific key
> material associated to the KMS), and may contain:
>
> \- An updated TrK for the user (to replace the offline-provisioned,
> bootstrap TrK).
>
> \- A KMSKeyProv Response contains zero, or more, KMSKeySets and may contain:
>
> \- An updated TrK for the user (to replace existing TrK).
>
> \- A KMSCertCache Response may contain:
>
> \- Home KMS Certificate(s) (current, updated or future).
>
> \- External KMS Certificates. This is domain specific key material
> associated with other KMSs. It is required to enable secure communications
> across security domains.
[TS 24.379, clause 6.2.2]
When the MCPTT client receives an initial SDP offer for an MCPTT session, the
MCPTT client shall process the SDP offer and shall compose an SDP answer
according to 3GPP TS 24.229 [4].
When composing an SDP answer, the MCPTT client:
> 1) shall accept the MCPTT speech media stream in the SDP offer;
>
> 2) shall set the IP address of the MCPTT client for the accepted MCPTT
> speech media stream and, if included in the SDP offer, for the accepted
> media-floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP answer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 3) shall include an \"m=audio\" media-level section for the accepted MCPTT
> speech media stream consisting of:
>
> a) the port number for the media stream;
>
> b) media-level attributes as specified in 3GPP TS 24.229 [4]; and
>
> c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4]; and
>
> 4) if included in the SDP offer, shall include the media-level section of
> the offered media-floor control entity consisting of:
>
> a) an \"m=application\" media-level section as specified in 3GPP TS 24.380
> [5] clause 12; and
>
> b) \'fmtp\' attributes as specified in 3GPP TS 24.380 [5] clause 14.
[TS 24.379, clause 6.2.3.1.1]
When performing the automatic commencement mode procedures, the MCPTT client:
> 1) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
> according to rules and procedures of 3GPP TS 24.229 [4];
>
> 2) shall include the option tag \"timer\" in a Require header field of the
> SIP 200 (OK) response;
>
> 3) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 200 (OK) response;
>
> 4) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 200 (OK) response;
>
> 5) shall include the Session-Expires header field in the SIP 200 (OK)
> response and start the SIP session timer according to IETF RFC 4028 [7]. The
> \"refresher\" parameter in the Session-Expires header field shall be set to
> \"uas\";
>
> ...
>
> 7) shall, if the incoming SIP INVITE request does not contain a Replaces
> header field, include an SDP answer in the SIP 200 (OK) response to the SDP
> offer in the incoming SIP INVITE request according to 3GPP TS 24.229 [4]
> with the clarifications given in subclause 6.2.2;
>
> NOTE: In the case of a new emergency call where the terminating client is
> using a pre-established session, the SIP INVITE request containing a
> Replaces header is used to replace the pre-established session.
>
> 8) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4];
>
> ...
>
> 10) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
> subclause 6.2.
When NAT traversal is supported by the MCPTT client and when the MCPTT client
is behind a NAT, generation of SIP responses is done as specified in this
subclause and as specified in IETF RFC 5626 [15].
[TS 24.379, clause 6.2.6]
Upon receiving a SIP BYE request, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall send SIP 200 (OK) response towards MCPTT server according to 3GPP
> TS 24.229 [4].
[TS 24.379, clause 11.1.1.2.1.2]
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> ...
>
> 3) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
> MIME body with the \ element containing the \
> element with the \ element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication that this is a SIP INVITE
> request for an MCPTT emergency private call and:
>
> i) should display the MCPTT ID of the originator of the MCPTT emergency
> private call contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> ...
>
> b) shall set the MCPTT emergency private priority state to \"MEPP 2: in-
> progress\" for this private call;
>
> 4) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
> attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
> I_MESSAGE:
>
> a) shall extract the MCPTT ID of the originating MCPTT from the initiator
> field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.179 [46];
>
> b) shall convert the MCPTT ID to a UID as described in 3GPP TS 33.179 [46];
>
> c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE
> as described in 3GPP TS 33.179 [46];
>
> d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
> reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response
> as specified in IETF RFC 4567 [47], and include warning text set to \"136
> authentication of the MIKEY-SAKE I_MESSAGE failed\" in a Warning header
> field as specified in subclause 4.4; and
>
> e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
>
> i) shall extract and decrypt the encapsulated PCK using the terminating
> user\'s (KMS provisioned) UID key as described in 3GPP TS 33.179 [46]; and
>
> ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS
> 33.179 [46];
>
> NOTE: With the PCK successfully shared between the originating MCPTT client
> and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to
> create an end-to-end secure session.
>
> 5) may check if a Resource-Priority header field is included in the incoming
> SIP INVITE request and may perform further actions outside the scope of this
> specification to act upon an included Resource-Priority header field as
> specified in 3GPP TS 24.229 [4];
>
> 6) may display to the MCPTT user the MCPTT ID of the inviting MCPTT user;
>
> 7) shall perform the automatic commencement procedures specified in
> subclause 6.2.3.1.1 if one of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Auto\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to automatic commencement mode;
[TS 24.379, clause 11.1.1.2.1.3]
Upon receipt of a SIP re-INVITE request for an existing private call session,
the MCPTT client shall:
> 1) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
> info+xml MIME body with the \ element containing the \ Params> element with the \ element set to a value of
> \"true\":
>
> a) should display to the MCPTT user an indication that this is a SIP re-
> INVITE request to upgrade this call to an MCPTT emergency private call and:
>
> i) should display the MCPTT ID of the originator of the MCPTT emergency
> private call contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> ii) if the \ element is set to \"true\", should display to the
> MCPTT user an indication of the MCPTT emergency alert and associated
> information; and
>
> b) shall set the MCPTT emergency private priority state to \"MEPP 2: in-
> progress\" for this private call;
>
> 2) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
> info+xml MIME body with the \ element containing the \ Params> element with the \ element set to a value of
> \"false\":
>
> a) should display to the MCPTT user an indication that this is a SIP re-
> INVITE request to downgrade this emergency private call to a normal priority
> private call and:
>
> i) should display the MCPTT ID of the sender of the SIP re-INVITE request
> contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> ..
>
> b) shall set the MCPTT emergency private priority state to \"MEPP 1: no-
> emergency\" for this private call; and
>
> c) if the MCPTT emergency private call state of the call is set to \"MEPC 3:
> emergency-call-granted\", shall set the MCPTT emergency private call state
> of the call to \"MEPC 1: emergency-pc-capable\";
>
> 3) may check if a Resource-Priority header field is included in the incoming
> SIP INVITE request and may perform further actions outside the scope of this
> specification to act upon an included Resource-Priority header field as
> specified in 3GPP TS 24.229 [4];
>
> 4) may display to the MCPTT user the MCPTT ID of the inviting MCPTT user if
> not done so in step 1 or step 2 above;
>
> NOTE 1: As this is a re-INVITE for an existing MCPTT private call session,
> there is no attempt made to change the answer-mode from its current state.
>
> 5) shall accept the SIP re-INVITE request and generate a SIP 200 (OK)
> response according to rules and procedures of 3GPP TS 24.229 [4];
>
> 6) if the SIP re-INVITE request was received within an on-demand session,
> shall include an SDP answer in the SIP 200 (OK) response to the SDP offer in
> the incoming SIP INVITE request according to 3GPP TS 24.229 [4] with the
> clarifications given in subclause 6.2.2;
>
> ...
>
> 8) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4]; and
>
> 9) shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.379, clause 11.1.3.1.1.2]
Upon receiving a SIP BYE request for private call session, the MCPTT client
shall follow the procedures as specified in subclause 6.2.6.
[TS 24.380, clause 4.1.1.2]
At any point in time a group member can request permission to talk.
When all group members are silent, a group member can press the PTT button,
meaning the request for permission to talk. The floor participant entity of
this user reflects this request to the floor control server by sending a Floor
Request message. If the floor control server decides to permit, it informs
this permission for this request by sending a Floor Granted message to the
requesting group member. The floor control server informs the initiation of
the talk to the other group members by sending a Floor Taken message. Once the
group member receives the permission, a permission indication (permission
tone) is generated and the user can talk. The media packets (encoded voice)
are sent to the controlling MCPTT server and from there they are distributed
to all listeners of this group. The release of the PTT button indicates the
user's intension to end talking. Once the PTT button is released, the floor
participant sends a Floor Release message to the floor control server
indicating that this user has finished talking. This cycle, starting from the
Floor Granted message and ending with Floor Release message, is known as
\'talk burst\' or \'media burst\'.
In the beginning of a call the initial talk permission request can be implied
by the SIP message which initiates the call as specified in 3GPP TS 24.379 [2]
without any specific Floor Request message.
A group member can also request for permission to talk by sending a Floor
Request message during a talk burst. The floor control server can resolve this
request in several ways.
> 1\. If this request has higher priority than the ongoing talk burst, the
> floor control server revokes the current talk burst by sending a Floor
> Revoke message to the current talker. The current talker is interrupted and
> the current media burst is ended by the current floor participant by sending
> a Floor Release message. Then the floor control server sends a Floor Granted
> message to the revoking user and send Floor Taken message to other group
> members. Then a new media burst starts.
>
> 2\. If this request does not have higher priority and floor request queuing
> is not used the floor control server rejects this request by sending a Floor
> Deny message to the requester. Then a reject indication (reject tone) is
> generated for the user. The ongoing talk burst continues.
...
During silence (when no talk burst is ongoing), the floor control server can
send Floor Idle message to all floor participants from time to time. The floor
control server sends Floor Idle message in the beginning of silence.
[TS 24.380, clause 5.2.1]
To be compliant with the procedures in the present document, an MCPTT client
shall:
> 1\. support the role of an MCPTT client as specified 3GPP TS 23.179 [5];
>
> 2\. support the on-network MCPTT client role as specified in 3GPP TS 24.379
> [2];
>
> ...
>
> 4\. support media plane security as specified in clause 13.
To be compliant with the on-network procedures in the present document, an
MCPTT client shall:
> 1\. provide the role of a floor participant in on-network mode as specified
> in subclause 5.2.2;
>
> 2\. provide the media mixer function as described in subclause 4.2.2 and
> support the related procedures in subclause 6.2;
>
> ...
>
> 4\. provide PTT button events towards the on-network floor participant as
> specified in subclause 6.2;
>
> 5\. provide means (sound, display, etc.) for indications towards the MCPTT
> user as specified in subclause 6.2;
>
> 6\. support negotiating media plane control channel media level attributes
> as specified in subclause 4.3; and
[TS 24.380, clause 5.2.2]
To be compliant with the on-network procedures in the present document, a
floor participant in on-network mode shall:
> 1\. support the on-network floor control procedures as defined in 3GPP TS
> 23.179 [5];
>
> 2\. support acting as an on-network floor participant as specified in
> subclause 6.2; and
>
> 3\. support the on-network mode floor control protocol elements as specified
> in the clause 8.
A floor participant in on-network mode may:
> 1\. support queuing of floor requests as specified in subclause 6.2 and
> subclause 4.1.1.2.
[TS 24.380, clause 12.1.2.2]
In an SDP offer, the \"mc_priority\" fmtp attribute indicates (using an
integer value between \'1\' and \'255\') the maximum floor priority that the
offeror requests to be used with Floor Request messages sent by the offeror.
In an SDP answer, the attribute parameter indicates the maximum priority level
that the answerer has granted to the offeror. The value has to be equal or
less than the value provided in the associated SDP offer.
> NOTE 1: If the \"mc_priority\" fmtp attribute is not used within an SDP
> offer or answer, a default priority value is assumed.
In an SDP offer, the \"mc_granted\" fmtp attribute parameter indicates that
the offeror supports the procedure where the answerer indicates, using the
fmtp attribute in the associated SDP answer, that the floor has been granted
to the offeror.
> NOTE 2: When the \"mc_granted\" fmtp attribute is used in an SDP offer, it
> does not indicate an actual request for the floor. The SDP
> \"mc_implicit_request\" fmtp attribute can be used to request the floor. In
> an SDP answer, the attribute indicates that the floor has been granted to
> the offeror.
>
> NOTE 3: Once the offeror has been granted the floor, the offeror has the
> floor until it receives a Floor Revoke message, or until the offeror itself
> releases the floor by sending a Floor Release message, as described in the
> present specification.
In an SDP offer, the \"mc_implicit_request\" fmtp attribute indicates that the
offeror implicitly requests the floor (without the need to send a Floor
Request message). In an SDP answer, the attribute parameter indicates that the
answerer has accepted the implicit floor request. Once the answerer grants the
floor to the offeror, the answerer will send a Floor Granted message.
> NOTE 4: The usage of the \"mc_implicit_request\" fmtp attribute in an SDP
> answer does not mean that the answerer has granted the floor to the offeror,
> only that the answerer has accepted the implicit floor request.
[TS 24.380, clause 13.1]
Media plane security provides integrity and confidentiality protection of
individual media streams and media plane control messages in MCPTT sessions.
The media plane security is based on 3GPP MCPTT security solution including
key management and end-to-end media and floor control messages protection as
defined in 3GPP TS 33.179 [14].
Various keys and associated key identifiers protect:
> 1\. RTP transported media;
>
> 2\. RTCP transported media control messages (i.e. RTCP SR packets, RTCP RR
> packets, RTCP SDES packets);
>
> 3\. RTCP APP transported floor control messages;
>
> ...
In an on-network private call:
> 1\. if protection of media is negotiated, the PCK and the PCK-ID protect
> media sent and received by the MCPTT clients;
>
> 2\. if protection of floor control messages sent using unicast between the
> MCPTT client and the participating MCPTT function serving the MCPTT client
> is negotiated, the CSK and the CSK-ID protect the floor control messages
> sent and received by the MCPTT client and by the participating MCPTT
> function;
>
> ...
>
> 4\. if protection of media control messages sent using unicast between the
> MCPTT client and the participating MCPTT function serving the MCPTT client
> is negotiated, the CSK and the CSK-ID protect the media control messages
> sent and received using unicast by the MCPTT client and by a participating
> MCPTT function; and
...
The CSK and the CSK-ID are generated by the MCPTT client and provided to the
participating MCPTT function serving the MCPTT client using SIP signalling
according to 3GPP TS 24.379 [2].
..
The PCK and the PCK-ID are generated by the MCPTT client initiating the
private call and provided to the MCPTT client receiving the private call using
SIP signalling according to 3GPP TS 24.379 [2], using Connect message
described in subclause 8.3.4 or using MONP signalling according to 3GPP TS
24.379 [2].
[TS 24.380, clause 13.3.3]
> 3\. in an on-network private call:
>
> A) if:
>
> ...
>
> ii) protection of media is negotiated in terminating call and the PCK and
> the PCK-ID were received from the remote MCPTT client using SIP signalling
> according to 3GPP TS 24.379 [2];
>
> then:
>
> i) shall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS
> 33.179 [14] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the PCK and
> PCK-ID as specified in subclause 13.2; and
>
> ii) shall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS
> 33.179 [14] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the PCK and
> PCK-ID as specified in subclause 13.2;
>
> B) if protection of floor control messages is negotiated and the CSK and the
> CSK-ID were sent to the participating MCPTT function using SIP signalling
> according to 3GPP TS 24.379 [2]:
>
> i) shall encrypt sent floor control messages according to IETF RFC 3711 [16]
> and 3GPP TS 33.179 [14] using SRTP-MK, SRTP-MS and SRTP-MKI generated using
> the CSK and CSK-ID as specified in subclause 13.2; and
>
> ii) shall decrypt received floor control messages according to IETF RFC 3711
> [16] and 3GPP TS 33.179 [14] using SRTP-MK, SRTP-MS and SRTP-MKI generated
> using the CSK and CSK-ID as specified in subclause 13.2; and
>
> D) if protection of media control messages sent using unicast between the
> participating MCPTT function and the MCPTT client is negotiated and the CSK
> and the CSK-ID were sent to the participating MCPTT function using SIP
> signalling according to 3GPP TS 24.379 [2]:
>
> i) shall encrypt media control messages sent using unicast according to IETF
> RFC 3711 [16] and 3GPP TS 33.179 [14] using SRTP-MK, SRTP-MS and SRTP-MKI
> generated using the CSK and CSK-ID as specified in subclause 13.2; and
>
> ii) shall decrypt media control messages received using unicast according to
> IETF RFC 3711 [16] and 3GPP TS 33.179 [14] using SRTP-MK, SRTP-MS and SRTP-
> MKI generated using the CSK and CSK-ID as specified in subclause 13.2;
##### 6.2.2.3 Test description {#test-description-45 .H6}
##### 6.2.2.3.1 Pre-test conditions {#pre-test-conditions-45 .H6}
##### System Simulator: {#system-simulator-45 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-45 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-45 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.2.3.2 Test procedure sequence {#test-procedure-sequence-45 .H6}
Table 6.2.2.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.4.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a private | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | floor | | | | | | | control? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2-3 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 4 | The SS | \ with mcpttBoolean set to false
Encryption according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.2.2-1  
alert-ind Encrypted \ with mcpttBoolean set to false Encryption
according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.2.2-1
Table 6.2.2.3.3-5A: SIP 200 (OK) from the UE (Steps 1, 16, 35, Table
6.2.2.3.2-1;\ step 4, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME part body SDP Message as described in Table 6.2.2.3.3-5B  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.2.2.3.3-5C
Table 6.2.2.3.3-5B: SDP in SIP 200 (OK) (Table 6.2.2.3.3-5A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_ANSWER
* * *
Table 6.2.2.3.3-5C: MCPTT-Info in SIP 200 (OK) (Table 6.2.2.3.3-5A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
Table 6.2.2.3.3-6..12: Void
Table 6.2.2.3.3-13: Floor Request (Steps 23, 33, Table 6.2.2.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3A.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.2-1, condition EMERGENCY_CALL.
* * *
Table 6.2.2.3.3-14: Floor Granted (Steps 23, 33, Table 6.2.2.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3A.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.3-1, condition EMERGENCY_CALL.
* * *
Table 6.2.2.3.3-15: Floor Release (Step 27, Table 6.2.2.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3A.16.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.5-1, condition EMERGENCY_CALL
* * *
Table 6.2.2.3.3-16: Floor Taken (Steps 19, 27, Table 6.2.2.3.2-1;\ step 3, TS
36.579-1 [2] Table 5.3A.16.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.7-1, condition EMERGENCY_CALL
* * *
Table 6.2.2.3.3-17: Floor Revoke (Step 25, Table 6.2.2.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.8-1, condition EMERGENCY-CALL
* * *
Table 6.2.2.3.3-18: Floor Idle (Steps 21, 31, Table 6.2.2.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.6-1, condition EMERGENCY-CALL.
* * *
6.2.3 On-network / Private Call / On-demand / Automatic Commencement Mode /
Without Floor Control / Client Originated (CO)
##### 6.2.3.1 Test Purpose (TP) {#test-purpose-tp-46 .H6}
##### (1) {#section-147 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate/cancel private calls with automatic
commencement }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT private call,
on-demand Automatic Commencement Mode, no Force of automatic commencement,
without floor control }
**then** { UE (MCPTT Client) sends a SIP INVITE message requesting on-demand
Automatic Commencement Mode and not offering a media-level section for a
media-floor control entity, **and** , after indication from the MCPTT Server
that the call was established notifies the user }
}
##### (2) {#section-148 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Automatic
Commencement Mode Private Call without Floor control }
ensure that {
**when** { the MCPTT User wants to terminate the ongoing MCPTT private call }
**then** { UE (MCPTT Client) sends a SIP BYE request and after receiving a SIP
200 (OK) leaves the MCPTT session }
}
##### 6.2.3.2 Conformance requirements {#conformance-requirements-46 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 6.2.1, 6.2.5.1, 11.1.1.2.1.1, 11.1.2.2,
11.1.3.1.1.1. Unless otherwise stated these are Rel-13 requirements.
[TS 24.379, clause 6.2.1]
The SDP offer shall contain only one SDP media-level section for MCPTT speech
according to 3GPP TS 24.229 [4] and, if floor control shall be used during the
session, shall contain one SDP media-level section for a media-floor control
entity according to 3GPP TS 24.380 [5].
When composing an SDP offer according to 3GPP TS 24.229 [4] the MCPTT client:
> 1) shall set the IP address of the MCPTT client for the offered MCPTT speech
> media stream and, if floor control shall be used, for the offered media-
> floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP offer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 2) shall include an \"m=audio\" media-level section for the MCPTT media
> stream consisting of:
>
> a) the port number for the media stream selected; and
>
> b) the codec(s) and media parameters and attributes with the following
> clarification:
>
> i) if the MCPTT client is initiating a call to a group identity;
>
> ii) if the \ element is present in the group
> document retrieved by the group management client as specified in 3GPP TS
> 24.381 [31] containing an \ element with a \"name\" attribute; and
>
> iii) if the MCPTT client supports the encoding name indicated in the value
> of the \"name\" attribute;
>
> then the MCPTT client:
>
> i) shall insert the value of the \"name\" attribute in the \
> field of the \"a=rtpmap\" attribute as defined in IETF RFC 4566 [12]; and
>
> c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4];
[TS 24.379, clause 6.2.5.1]
When the MCPTT client wants to release an MCPTT session established using on-
demand session signalling, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 3) shall set the Request-URI to the MCPTT session identity to release; and
>
> 4) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT
client shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.379, clause 11.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT private call
the MCPTT client shall generate an initial SIP INVITE request by following the
UE originating session procedures specified in 3GPP TS 24.229 [4], with the
clarifications given below.
The MCPTT client:
> 1) shall set the Request-URI of the SIP INVITE request to a public service
> identity of the participating MCPTT function serving the MCPTT user;
>
> ...
>
> 3) may include a P-Preferred-Identity header field in the SIP INVITE request
> containing a public user identity as specified in 3GPP TS 24.229 [4];
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the media feature tag
> g.3gpp.icsi-ref contain with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\"
> according to IETF RFC 3841 [6];
>
> 8) shall insert in the SIP INVITE request a MIME resource-lists body with
> the MCPTT ID of the invited MCPTT user, according to rules and procedures of
> IETF RFC 5366 [20];
>
> ...
>
> 13) if force of automatic commencement mode at the invited MCPTT client is
> not requested by the MCPTT user and:
>
> a) if automatic commencement mode at the invited MCPTT client is requested
> by the MCPTT user, shall include in the SIP INVITE request an Answer-Mode
> header field with the value \"Auto\" according to the rules and procedures
> of IETF RFC 5373 [18]; and
>
> ...
>
> 14) shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element containing the \ element with the
> \ element set to a value of \"private\";
>
> ...
>
> 16) shall send SIP INVITE request towards the MCPTT server according to 3GPP
> TS 24.229 [4].
Upon receiving a SIP 183(Session Progress) response to the SIP INVITE request
the MCPTT client:
> 1) may indicate the progress of the session establishment to the inviting
> MCPTT user.
Upon receiving a SIP 200 (OK) response to the SIP INVITE request the MCPTT
client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> ...
>
> 3) shall notify the user that the call has been successfully established.
[TS 24.379, clause 11.1.2.2]
When the MCPTT user wants to make an on-demand private call without floor
control, the MCPTT client shall follow the procedures in subclause
11.1.1.2.1.1 with the following exceptions:
> 1) in step 10) of subclause 11.1.1.2.1.1, the MCPTT client shall not offer a
> media-level section for a media-floor control entity; and
>
> 2) step 11) of subclause 11.1.1.2.1.1 shall be ignored.
[TS 24.379, clause 11.1.3.1.1.1]
Upon receiving a request from an MCPTT user to release an MCPTT private call
session established using on-demand session signalling, the MCPTT client shall
follow the procedures as specified in subclause 6.2.5.1.
##### 6.2.3.3 Test description {#test-description-46 .H6}
##### 6.2.3.3.1 Pre-test conditions {#pre-test-conditions-46 .H6}
##### System Simulator: {#system-simulator-46 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-46 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-46 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.3.3.2 Test procedure sequence {#test-procedure-sequence-46 .H6}
Table 6.2.3.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a | | | | | | | private | | | | | | | call to | | | | | | | user B | | | | | | | with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | without | | | | | | | floor | | | | | | | control. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3A.1.3-1 | | | | | | | to**| | | | | | | establish | | | | | | | a private | | | | | | | call with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | without | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | c of NOTE | | | | | | | 1 in TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | |** 5.3 | | | | | | | A.1.3-1**? | | | | | +------------+------------+------------+---------+---------+----+ | 3-4 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 5 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the call | | | | | | | has been | | | | | | | es | | | | | | | tablished? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 6-7 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 8 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 10-11 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.3.3.3 Specific message contents {#specific-message-contents-46 .H6}
Table 6.2.3.3.3-1: SIP INVITE from the UE (Step 2, Table 6.2.3.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3A.1.3-1)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.2.5.1-1, | | | | | | condition | | | | | | PRIVATE-CALL | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Me | | | | | | ssage-body** | | | | | +--------------+--------------+--------------+-----------+-----------+ | MIME body | | **SDP | | | | part | | message** | | | +--------------+--------------+--------------+-----------+-----------+ | MI | SDP Message | | | | | ME-part-body | as described | | | | | | in Table | | | | | | 6.2.3.3.3-2 | | | | +--------------+--------------+--------------+-----------+-----------+ | **MIME body | | ** | | | | part** | | MCPTT-Info** | | | +--------------+--------------+--------------+-----------+-----------+ | MI | MCPTT-Info | | | | | ME-part-body | as described | | | | | | in Table | | | | | | | | | | | | 6.2.3.3.3-2A | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.2.3.3.3-2: SDP Message in SIP INVITE (Table 6.2.3.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition PRIVATE-CALL,
INITIAL_SDP_OFFER, WITHOUT_FLOORCONTROL
* * *
Table 6.2.3.3.3-2A: MCPTT-Info in SIP INVITE (Table 6.2.3.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE_REFER,
PRIVATE-CALL
* * *
Table 6.2.3.3.3-3: SIP 200 (OK) from the SS (Step 2, Table 6.2.3.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.2.3.3.3-4
Table 6.2.3.3.3-4: SDP Message in SIP 200 (OK) (Table 6.2.3.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
WITHOUT_FLOORCONTROL
* * *
Table 6.2.3.3.3-5: Void
6.2.4 On-network / Private Call / On-demand / Automatic Commencement Mode /
Without Floor Control / Client Terminated (CT)
##### 6.2.4.1 Test Purpose (TP) {#test-purpose-tp-47 .H6}
##### (1) {#section-149 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to receive private and private emergency calls with
automatic commencement }
ensure that {
**when** { the UE (MCPTT Client) receives a request for establishment of an
MCPTT private call, on-demand Automatic Commencement Mode, no Force of
automatic commencement, without Floor Control }
**then** { UE (MCPTT Client) sends a SIP 200 (OK) accepting the establishment
of an MCPTT private call, on-demand Automatic Commencement Mode and not
offering a media-level section for a media-floor control entity }
##### (2) {#section-150 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Automatic
Commencement Mode Private Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) receives a request for termination of
the ongoing MCPTT private call }
**then** { UE (MCPTT Client) accept the request and after sending a SIP 200
(OK) response leaves the MCPTT session }
}
##### 6.2.4.2 Conformance requirements {#conformance-requirements-47 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 6.2.2, 6.2.3.1.1, 6.2.6, 11.1.1.2.1.2,
11.1.2.2, 11.1.3.1.1.2. Unless otherwise stated these are Rel-13 requirements.
[TS 24.379, clause 6.2.2]
When the MCPTT client receives an initial SDP offer for an MCPTT session, the
MCPTT client shall process the SDP offer and shall compose an SDP answer
according to 3GPP TS 24.229 [4].
When composing an SDP answer, the MCPTT client:
> 1) shall accept the MCPTT speech media stream in the SDP offer;
>
> 2) shall set the IP address of the MCPTT client for the accepted MCPTT
> speech media stream and, if included in the SDP offer, for the accepted
> media-floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP answer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 3) shall include an \"m=audio\" media-level section for the accepted MCPTT
> speech media stream consisting of:
>
> a) the port number for the media stream;
>
> b) media-level attributes as specified in 3GPP TS 24.229 [4]; and
>
> c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4]; and
[TS 24.379, clause 6.2.3.1.1]
When performing the automatic commencement mode procedures, the MCPTT client:
> 1) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
> according to rules and procedures of 3GPP TS 24.229 [4];
>
> 2) shall include the option tag \"timer\" in a Require header field of the
> SIP 200 (OK) response;
>
> 3) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 200 (OK) response;
>
> 4) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 200 (OK) response;
>
> 5) shall include the Session-Expires header field in the SIP 200 (OK)
> response and start the SIP session timer according to IETF RFC 4028 [7]. The
> \"refresher\" parameter in the Session-Expires header field shall be set to
> \"uas\";
>
> ...
>
> 8) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4];
[TS 24.379, clause 6.2.6]
Upon receiving a SIP BYE request, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall send SIP 200 (OK) response towards MCPTT server according to 3GPP
> TS 24.229 [4].
[TS 24.379, clause 11.1.2.2]
Upon receipt of an initial SIP INVITE request for the private call with an SDP
offer not including a media-level section for a media-floor control entity,
the MCPTT client shall consider it as the request for private call without
floor control and shall follow the procedures as specified in subclause
11.1.1.2.1.2 for on-demand session and subclause 11.1.1.2.2.2 for pre-
established session.
[TS 24.379, clause 11.1.1.2.1.2]
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> ...
>
> 4) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
> attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
> I_MESSAGE:
>
> a) shall extract the MCPTT ID of the originating MCPTT from the initiator
> field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.179 [46];
>
> b) shall convert the MCPTT ID to a UID as described in 3GPP TS 33.179 [46];
>
> c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE
> as described in 3GPP TS 33.179 [46];
>
> ...
>
> e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
>
> i) shall extract and decrypt the encapsulated PCK using the terminating
> user\'s (KMS provisioned) UID key as described in 3GPP TS 33.179 [46]; and
>
> ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS
> 33.179 [46];
>
> NOTE: With the PCK successfully shared between the originating MCPTT client
> and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to
> create an end-to-end secure session.
>
> ...
>
> 7) shall perform the automatic commencement procedures specified in
> subclause 6.2.3.1.1 if one of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Auto\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to automatic commencement mode;
[TS 24.379, clause 11.1.3.1.1.2]
Upon receiving a SIP BYE request for private call session, the MCPTT client
shall follow the procedures as specified in subclause 6.2.6.
##### 6.2.4.3 Test description {#test-description-47 .H6}
##### 6.2.4.3.1 Pre-test conditions {#pre-test-conditions-47 .H6}
##### System Simulator: {#system-simulator-47 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-47 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-47 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.4.3.2 Test procedure sequence {#test-procedure-sequence-47 .H6}
Table 6.2.4.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                                                                                                                                                                                                                                     U - S              Message
1 Check: Does the UE (MCPTT client) correctly perform procedure \'MCX CT
session establishment/modification without provisional responses other than
100 Trying\' as described in TS 36.579-1 [2] Table **5.3.4.3-1 to establish**
a private call with automatic commencement mode and without floor control? - -
1 P 2-4 Void - - - - 5 Check: Does the UE (MCPTT client) correctly perform
procedure \'MCX CT call release\' as described in TS 36.579-1 [2] Table
5.3.12.3-1? - - 2 P 6-7 Void - - - - NOTE 1: This is expected to be done via a
suitable implementation dependent MMI.
##### 6.2.4.3.3 Specific message contents {#specific-message-contents-47 .H6}
Table 6.2.4.3.3-1: SIP INVITE from the SS (Step 1, Table 6.2.4.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP Message as described in Table 6.2.4.3.3-2  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.2.4.3.3-2A
Table 6.2.4.3.3-2: SDP Message in SIP INVITE (Table 6.2.4.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition PRIVATE-CALL,
INITIAL_SDP_OFFER, WITHOUT_FLOORCONTROL
* * *
Table 6.2.4.3.3-2A: MCPTT-Info in SIP INVITE (Table 6.2.4.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Table 6.2.4.3.3-3: SIP 200 (OK) from the UE (Step 1, Table 6.2.4.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP Message as described in Table 6.2.4.3.3-4  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.2.4.3.3-6
Table 6.2.4.3.3-4: SDP Message in SIP 200 (OK) (Table 6.2.4.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_ANSWER,
WITHOUT_FLOORCONTROL
* * *
Table 6.2.4.3.3-5: Void
Table 6.2.4.3.3-6: MCPTT-Info in SIP 200 (OK) (Table 6.2.4.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
6.2.5 On-network / Private Call / Emergency Private Call / On-demand /
Automatic Commencement Mode / Force of automatic commencement mode / Without
Floor Control / Client Originated (CO)
##### 6.2.5.1 Test Purpose (TP) {#test-purpose-tp-48 .H6}
##### (1) {#section-151 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service
including authorization to initiate and cancel emergency calls }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT private
emergency call, on-demand, automatic commencement mode, Force of automatic
commencement mode without floor control }
**then** { UE (MCPTT Client) requests Private Emergency Call establishment
without floor control by sending a SIP INVITE message including a Priv-Answer-
Mode header field with the value \"Auto\" not offering a media-level section
for a media-floor control entity, **and** , after indication from the MCPTT
Server that the call was established notifies the user}
}
##### (2) {#section-152 .H6}
**with** { UE (MCPTT Client) having established an Emergency Private Call }
ensure that {
**when** { the MCPTT User wants to terminate the ongoing MCPTT emergency
private call }
**then** { UE (MCPTT Client) sends a SIP BYE request and after receiving a SIP
200 (OK) leaves the MCPTT session }
}
##### 6.2.5.2 Conformance requirements {#conformance-requirements-48 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 6.2.1, 6.2.5.1, 6.2.8.3.2, 6.2.8.3.3,
6.2.8.3.4, 6.2.8.3.6, 11.1.1.2.1.1, 11.1.2.2, 11.1.3.1.1.1. Unless otherwise
stated these are Rel-13 requirements.
[TS 24.379, clause 6.2.1]
The SDP offer shall contain only one SDP media-level section for MCPTT speech
according to 3GPP TS 24.229 [4] and, if floor control shall be used during the
session, shall contain one SDP media-level section for a media-floor control
entity according to 3GPP TS 24.380 [5].
When composing an SDP offer according to 3GPP TS 24.229 [4] the MCPTT client:
> 1) shall set the IP address of the MCPTT client for the offered MCPTT speech
> media stream and, if floor control shall be used, for the offered media-
> floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP offer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 2) shall include an \"m=audio\" media-level section for the MCPTT media
> stream consisting of:
>
> a) the port number for the media stream selected; and
>
> b) the codec(s) and media parameters and attributes with the following
> clarification:
>
> ...
>
> c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4];
>
> 4) if end-to-end security is required for a private call and the SDP offer
> is not for establishing a pre-established session, shall include the MIKEY-
> SAKKE I_MESSAGE in an \"a=key-mgmt\" attribute as a \"mikey\" attribute
> value in the SDP offer as specified in IETF RFC 4567 [47].
[TS 24.379, clause 6.2.5.1]
When the MCPTT client wants to release an MCPTT session established using on-
demand session signalling, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 3) shall set the Request-URI to the MCPTT session identity to release; and
>
> 4) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT
client shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.379, clause 6.2.8.3.2]
When the MCPTT emergency private call state is set to \"MEPC 1: emergency-pc-
capable\" and this is an authorised request for an MCPTT emergency private
call as determined by the procedures of subclause 6.2.8.3.1.1, the MCPTT
client:
> 1) shall set the MCPTT emergency state if not already set;
>
> 2) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the
> SIP request an \ element set to \"true\" and set the MCPTT
> emergency private call state to \"MEPC 2: emergency-pc-requested\";
>
> 3) if the MCPTT user has also requested an MCPTT emergency alert to be sent
> and this is an authorised request for MCPTT emergency alert as determined by
> the procedures of subclause 6.2.8.3.1.3, shall:
>
> a) include in the application/vnd.3gpp.mcptt-info+xml MIME body the \ ind> element set to \"true\" and set the MCPTT private emergency alert state
> to \"MPEA 2: emergency-alert-confirm-pending\"; and
>
> b) include in the SIP request the specific location information for MCPTT
> emergency alert as specified in subclause 6.2.9.1;
>
> 4) if the MCPTT user has not requested an MCPTT emergency alert to be sent,
> shall set the \ element of the application/vnd.3gpp.mcptt-
> info+xml MIME body to \"false\"; and
>
> 5) if the MCPTT emergency private priority state of this private call is set
> to a value other than \"MEPP 2: in-progress\" shall set the MCPTT emergency
> private priority state to \"MEPP 4: confirm-pending\".
[TS 24.379, clause 6.2.8.3.3]
If the MCPTT emergency private call state is set to either \"MEPC 2:
emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\" and this is an
authorised request for an MCPTT emergency private call as determined by the
procedures of subclause 6.2.8.3.1.1, or the MCPTT emergency private priority
state of the call is set to \"MEPP 2: in-progress\", the MCPTT client shall
include in the SIP request a Resource-Priority header field populated with the
values for an MCPTT emergency private call as specified in subclause
6.2.8.1.15.
> NOTE: The MCPTT client ideally would not need to maintain knowledge of the
> in-progress emergency state of the call (as tracked on the MCPTT client by
> the MCPTT client emergency private state) but can use this knowledge to
> provide a Resource-Priority header field set to emergency level priority,
> which starts the infrastructure priority adjustment process sooner than
> otherwise would be the case.
[TS 24.379, clause 6.2.8.3.4]
On receiving a SIP 2xx response to a SIP request for an MCPTT emergency
private call and if the MCPTT emergency private call state is set to \"MEPC 2:
emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\", the MCPTT
client:
> 1) shall set the MCPTT emergency private priority state of the call to
> \"MEPP 2: in-progress\" if it was not already set;
>
> 2) shall set the MCPTT emergency private call state to \"MEPC 3: emergency-
> pc-granted\"; and
[TS 24.379, clause 6.2.8.3.6]
When the MCPTT emergency private call state is set to \"MEPC 3: emergency-pc-
granted\" and the MCPTT emergency alert state is set to \"MPEA 1: no-alert\",
the MCPTT client shall generate a SIP re-INVITE request according to 3GPP TS
24.229 [4] with the clarifications given below.
> NOTE 1: This procedure assumes that the MCPTT client in the calling
> procedure has verified that the MCPTT user has made an authorised request
> for cancelling MCPTT the in-progress emergency private call state of the
> call.
The MCPTT client:
> 1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
> info+xml MIME body as defined in clause F.1 with the \
> element set to \"false\";
>
> 2) shall clear the MCPTT emergency state; and
>
> 3) shall set MCPTT emergency private priority state of the MCPTT emergency
> private call to \"MEPP 3: cancel-pending\".
>
> NOTE 2: This is the case of an MCPTT user who has initiated an MCPTT
> emergency private call and wants to cancel it.
[TS 24.379, clause 11.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT private call
the MCPTT client shall generate an initial SIP INVITE request by following the
UE originating session procedures specified in 3GPP TS 24.229 [4], with the
clarifications given below.
The MCPTT client:
> 1) shall set the Request-URI of the SIP INVITE request to a public service
> identity of the participating MCPTT function serving the MCPTT user;
>
> 2) if the MCPTT user has requested the origination of an MCPTT emergency
> private call or is originating an MCPTT private call and the MCPTT emergency
> state is already set, the MCPTT client:
>
> a) shall, if this is an authorised request for an MCPTT emergency private
> call as determined by the procedures of subclause 6.2.8.3.1.1, comply with
> the procedures in subclause 6.2.8.3.2; and
>
> b) should, if this is an unauthorised request for an MCPTT emergency private
> call as determined in step a) above, indicate to the MCPTT user that they
> are not authorised to initiate an MCPTT emergency private call;
>
> 3) may include a P-Preferred-Identity header field in the SIP INVITE request
> containing a public user identity as specified in 3GPP TS 24.229 [4];
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the media feature tag
> g.3gpp.icsi-ref contain with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\"
> according to IETF RFC 3841 [6];
>
> 8) shall insert in the SIP INVITE request a MIME resource-lists body with
> the MCPTT ID of the invited MCPTT user, according to rules and procedures of
> IETF RFC 5366 [20];
>
> 9) if an end-to-end security context needs to be established then:
>
> a) if necessary, shall instruct the key management client to request keying
> material from the key management server as described in 3GPP TS 33.179 [46];
>
> b) shall use the keying material to generate a PCK as described in 3GPP TS
> 33.179 [46];
>
> c) shall use the PCK to generate a PCK-ID with the four most significant
> bits set to \"0001\" to indicate that the purpose of the PCK is to protect
> private call communications and with the remaining twenty eight bits being
> randomly generated as described in 3GPP TS 33.179 [46];
>
> d) shall encrypt the PCK to a UID associated to the MCPTT client using the
> MCPTT ID of the invited user and a time related parameter as described in
> 3GPP TS 33.179 [46];
>
> e) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and
> PCK-ID as specified in 3GPP TS 33.179 [46]; and
>
> g) shall add the MCPTT ID of the originating MCPTT to the initiator field
> (IDRi) of the I_MESSAGE as described in 3GPP TS 33.179 [46]; and
>
> f) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user\'s
> signing key provided in the keying material together with a time related
> parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
> 33.179 [46].
>
> 10) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarification given in subclause 6.2.1 and with a media stream of the
> offered media-floor control entity;
>
> ...
>
> 12) if force of automatic commencement mode at the invited MCPTT client is
> requested by the MCPTT user, shall include in the SIP INVITE request a Priv-
> Answer-Mode header field with the value \"Auto\" according to the rules and
> procedures of IETF RFC 5373 [18];
>
> ...
>
> 14) shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element containing the \ element with the
> \ element set to a value of \"private\";
>
> 15) if the MCPTT emergency private call state is set to either \"MEPC 2:
> emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\" or the MCPTT
> emergency private priority state for this private call is set to \"MEPP 2:
> in-progress\", the MCPTT client shall comply with the procedures in
> subclause 6.2.8.3.3; and
>
> 16) shall send SIP INVITE request towards the MCPTT server according to 3GPP
> TS 24.229 [4].
Upon receiving a SIP 183(Session Progress) response to the SIP INVITE request
the MCPTT client:
> 1) may indicate the progress of the session establishment to the inviting
> MCPTT user.
Upon receiving a SIP 200 (OK) response to the SIP INVITE request the MCPTT
client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) if the MCPTT emergency private call state is set to \"MEPC 2: emergency-
> pc-requested\" or \"MEPC 3: emergency-pc-granted\", shall perform the
> actions specified in subclause 6.2.8.3.4; and
>
> 3) shall notify the user that the call has been successfully established.
[TS 24.379, clause 11.1.2.2]
Upon receipt of an initial SIP INVITE request for the private call with an SDP
offer not including a media-level section for a media-floor control entity,
the MCPTT client shall consider it as the request for private call without
floor control and shall follow the procedures as specified in subclause
11.1.1.2.1.2 for on-demand session and subclause 11.1.1.2.2.2 for pre-
established session.
[TS 24.379, clause 11.1.3.1.1.1]
Upon receiving a request from an MCPTT user to release an MCPTT private call
session established using on-demand session signalling, the MCPTT client shall
follow the procedures as specified in subclause 6.2.5.1.
##### 6.2.5.3 Test description {#test-description-48 .H6}
##### 6.2.5.3.1 Pre-test conditions {#pre-test-conditions-48 .H6}
##### System Simulator: {#system-simulator-48 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-48 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-48 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.5.3.2 Test procedure sequence {#test-procedure-sequence-48 .H6}
Table 6.2.5.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of an | | | | | | | emergency | | | | | | | private | | | | | | | call to | | | | | | | user B | | | | | | | with force | | | | | | | of | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | without | | | | | | | floor | | | | | | | control. | | | | | | | | | | | | | | (NOTE 1). | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3A.1.3-1 | | | | | | | to**| | | | | | | establish | | | | | | | a private | | | | | | | call with | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | without | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | c of NOTE | | | | | | | 1 in TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | |** 5.3 | | | | | | | A.1.3-1**? | | | | | +------------+------------+------------+---------+---------+----+ | 3-4 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 5 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the call | | | | | | | has been | | | | | | | es | | | | | | | tablished? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 6-7 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 8 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1): | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 10-11 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.5.3.3 Specific message contents {#specific-message-contents-48 .H6}
Table 6.2.5.3.3-1: SIP INVITE from the UE (Step 2, Table 6.2.5.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition PRIVATE-CALL,
EMERGENCY-CALL
* * *
Information Element Value/remark Comment Reference Condition **Answer-Mode**
Not present  
**Priv-Answer-Mode**  
answer-mode-value \"Auto\"  
answer-mode-param _"_ require"  
**Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.5.3.3-2  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.5.3.3-3
Table 6.2.5.3.3-2: SDP Message in SIP INVITE (Table 6.2.5.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition PRIVATE-CALL,
INITIAL_SDP_OFFER, WITHOUT_FLOORCONTROL
* * *
Table 6.2.5.3.3-3: MCPTT-Info in SIP INVITE (Table 6.2.5.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition PRIVATE-CALL,
INVITE_REFER, EMERGENCY-CALL
* * *
Table 6.2.5.3.3-4: SIP 200 (OK) from the SS (Step 2, Table 6.2.5.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.2.5.3.3-5
Table 6.2.5.3.3-5: SDP Message in SIP 200 (OK) (Table 6.2.5.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
WITHOUT_FLOORCONTROL
* * *
Table 6.2.5.3.3-6: Void
6.2.6 On-network / Private Call / Emergency Private Call / On-demand /
Automatic Commencement Mode / Force of automatic commencement mode / Without
Floor Control / Client Terminated (CT)
##### 6.2.6.1 Test Purpose (TP) {#test-purpose-tp-49 .H6}
##### (1) {#section-153 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service
including authorization to receive an MCPTT private call, the MCPTT service
setting for answering the call is set to manual commencement mode }
ensure that {
**when** { the UE (MCPTT Client) receives a request for establishment of an
MCPTT emergency private call, On-demand Automatic Commencement Mode, Force of
automatic commencement mode without floor control }
**then** { UE (MCPTT Client) accepts the call (automatic commencement) by
sending a SIP 200 (OK) message accepting the private emergency call, on-demand
Automatic Commencement Mode, not offering a media-level section for a media-
floor control entity, **and** , optionally notifies the user }
}
##### (2) {#section-154 .H6}
**with** { UE (MCPTT Client) having established an MCPTT Emergency Private
Call }
ensure that {
**when** { the UE (MCPTT Client) is informed by the remote client that the
ongoing MCPTT emergency private call has been cancelled }
**then** { UE (MCPTT Client) accept the request and after sending a SIP 200
(OK) response leaves the MCPTT session }
}
##### 6.2.6.2 Conformance requirements {#conformance-requirements-49 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 6.2.2, 6.2.3.1.1, 6.2.6, 11.1.1.2.1.2,
11.1.2.2, 11.1.3.1.1.2. Unless otherwise stated these are Rel-13 requirements.
[TS 24.379, clause 6.2.2]
When the MCPTT client receives an initial SDP offer for an MCPTT session, the
MCPTT client shall process the SDP offer and shall compose an SDP answer
according to 3GPP TS 24.229 [4].
When composing an SDP answer, the MCPTT client:
> 1) shall accept the MCPTT speech media stream in the SDP offer;
>
> 2) shall set the IP address of the MCPTT client for the accepted MCPTT
> speech media stream and, if included in the SDP offer, for the accepted
> media-floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP answer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 3) shall include an \"m=audio\" media-level section for the accepted MCPTT
> speech media stream consisting of:
>
> a) the port number for the media stream;
>
> b) media-level attributes as specified in 3GPP TS 24.229 [4]; and
>
> c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4]; and
[TS 24.379, clause 6.2.3.1.1]
When performing the automatic commencement mode procedures, the MCPTT client:
> 1) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
> according to rules and procedures of 3GPP TS 24.229 [4];
>
> 2) shall include the option tag \"timer\" in a Require header field of the
> SIP 200 (OK) response;
>
> 3) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 200 (OK) response;
>
> 4) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 200 (OK) response;
>
> 5) shall include the Session-Expires header field in the SIP 200 (OK)
> response and start the SIP session timer according to IETF RFC 4028 [7]. The
> \"refresher\" parameter in the Session-Expires header field shall be set to
> \"uas\";
>
> ...
>
> 7) shall, if the incoming SIP INVITE request does not contain a Replaces
> header field, include an SDP answer in the SIP 200 (OK) response to the SDP
> offer in the incoming SIP INVITE request according to 3GPP TS 24.229 [4]
> with the clarifications given in subclause 6.2.2;
>
> NOTE: In the case of a new emergency call where the terminating client is
> using a pre-established session, the SIP INVITE request containing a
> Replaces header is used to replace the pre-established session.
>
> 8) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4];
>
> ...
>
> 10) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
> subclause 6.2.
When NAT traversal is supported by the MCPTT client and when the MCPTT client
is behind a NAT, generation of SIP responses is done as specified in this
subclause and as specified in IETF RFC 5626 [15].
[TS 24.379, clause 6.2.6]
Upon receiving a SIP BYE request, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall send SIP 200 (OK) response towards MCPTT server according to 3GPP
> TS 24.229 [4].
[TS 24.379, clause 11.1.1.2.1.2]
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> ...
>
> 3) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
> MIME body with the \ element containing the \
> element with the \ element set to a value of \"true\":
>
> a) should display to the MCPTT user an indication that this is a SIP INVITE
> request for an MCPTT emergency private call and:
>
> i) should display the MCPTT ID of the originator of the MCPTT emergency
> private call contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> ...
>
> b) shall set the MCPTT emergency private priority state to \"MEPP 2: in-
> progress\" for this private call;
>
> ...
>
> 5) may check if a Resource-Priority header field is included in the incoming
> SIP INVITE request and may perform further actions outside the scope of the
> present document to act upon an included Resource-Priority header field as
> specified in 3GPP TS 24.229 [4];
>
> ...
>
> 7) shall perform the automatic commencement procedures specified in
> subclause 6.2.3.1.1 if one of the following conditions are met:
>
> ...
>
> c) SIP INVITE request contains a Priv-Answer-Mode header field with the
> value of \"Auto\"; and
[TS 24.379, clause 11.1.2.2]
Upon receipt of an initial SIP INVITE request for the private call with an SDP
offer not including a media-level section for a media-floor control entity,
the MCPTT client shall consider it as the request for private call without
floor control and shall follow the procedures as specified in subclause
11.1.1.2.1.2 for on-demand session and subclause 11.1.1.2.2.2 for pre-
established session.
[TS 24.379, clause 11.1.3.1.1.2]
Upon receiving a SIP BYE request for private call session, the MCPTT client
shall follow the procedures as specified in subclause 6.2.6.
##### 6.2.6.3 Test description {#test-description-49 .H6}
##### 6.2.6.3.1 Pre-test conditions {#pre-test-conditions-49 .H6}
##### System Simulator: {#system-simulator-49 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-49 .H6}
\- UE (MCPTT client)
\- receive emergency calls; MCPTT service setting for answering the call is
set to manual commencement mode (3GPP TS 24.483 [12],
/\/\/Common/PrivateCall/AutoCommence=\"false\",
/\/\/Common/PrivateCall/ManualCommence=\"true\")
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-49 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.6.3.2 Test procedure sequence {#test-procedure-sequence-49 .H6}
Table 6.2.6.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | * | | | | | | | _5.3.4.3-1 | | | | | | | to | | | | | | | e | | | | | | | stablish_ * | | | | | | | a private | | | | | | | emergency | | | | | | | call with | | | | | | | force of | | | | | | | automatic | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | without | | | | | | | floor | | | | | | | control? | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | Step 3a1 | | | | | | | describes | | | | | | | behaviour | | | | | | | that | | | | | | | depends on | | | | | | | the UE | | | | | | | imple | | | | | | | mentation; | | | | | | | the | | | | | | | \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | identifies | | | | | | | a step | | | | | | | sequence | | | | | | | that take | | | | | | | place if | | | | | | | the UE | | | | | | | displays | | | | | | | i | | | | | | | nformation | | | | | | | to the | | | | | | | User upon | | | | | | | accepting | | | | | | | est | | | | | | | ablishment | | | | | | | /releasing | | | | | | | of private | | | | | | | call. | | | | | +------------+------------+------------+---------+---------+----+ | 3a1 | IF | - | - | 1 | P | | | pc\ | | | | | | | _MCX_Disp | | | | | | | layInfoEme | | | | | | | rgencyCall | | | | | | | THEN | | | | | | | | | | | | | | Check: | | | | | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the call | | | | | | | has been | | | | | | | es | | | | | | | tablished? | | | | | | | | | | | | | | (NOTE 1) | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 4-5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.12.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 7-8 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The | | | | | | | display | | | | | | | i | | | | | | | nformation | | | | | | | may | | | | | | | include\ | | | | | | | - | | | | | | | indication | | | | | | | for | | | | | | | upgrade | | | | | | | /downgrade | | | | | | | of call\ | | | | | | | - the | | | | | | | MCPTT ID | | | | | | | of the | | | | | | | sender of | | | | | | | the SIP | | | | | | | INVITE. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.6.3.3 Specific message contents {#specific-message-contents-49 .H6}
Table 6.2.6.3.3-1: MCPTT User Profile (Preamble, USIM)
Derivation Path: TS 36.579-1 [2], Table 5.5.8.3-1
* * *
Information Element Value/remark Comment Reference Condition mcptt-user-
profile  
cp:ruleset  
cp:rule  
cp:actions  
allow-automatic-commencement false
Table 6.2.6.3.3-2: SIP INVITE from the SS (Step 1, Table 6.2.6.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1
* * *
Information Element Value/remark Comment Reference Condition **Answer-Mode**
Not present  
**Priv-Answer-Mode**  
answer-mode-value \"Auto\"  
answer-mode-param _"_ require"  
**Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP Message as described in Table 6.2.6.3.3-3  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.2.6.3.3-3A
Table 6.2.6.3.3-3: SDP Message in SIP INVITE (Table 6.2.6.3.3-2)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition PRIVATE-CALL,
INITIAL_SDP_OFFER, WITHOUT_FLOORCONTROL
* * *
Table 6.2.6.3.3-3A: MCPTT-Info in SIP INVITE (Table 6.2.6.3.3-2)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL,
EMERGENCY-CALL
* * *
Table 6.2.6.3.3-3: SIP 200 (OK) from the UE (Step 1, Table 6.2.6.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP Message as described in Table 6.2.6.3.3-4  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.2.4.3.3-5
Table 6.2.6.3.3-4: SDP Message in SIP 200 (OK) (Table 6.2.6.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_ANSWER,
WITHOUT_FLOORCONTROLL
* * *
Table 6.2.6.3.3-5: MCPTT-Info in SIP 200 (OK) (Table 6.2.6.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
Table 6.2.6.3.3-6: Void
6.2.7 On-network / Private Call / On-demand / Manual Commencement Mode /
Without Floor Control / Client Originated (CO)
##### 6.2.7.1 Test Purpose (TP) {#test-purpose-tp-50 .H6}
##### (1) {#section-155 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service and
authorized to initiate private calls with manual commencement }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT on-demand
Manual Commencement private call without floor control }
**then** { UE (MCPTT Client) requests On-demand Manual Commencement Mode
Private Call establishment without floor control by sending a SIP INVITE
message not offering a media-level section for a media-floor control entity,
**and** , after indication from the MCPTT Server that the call was established
the UE notifies the user }
}
##### (2) {#section-156 .H6}
**with** { UE (MCPTT Client) having established an MCPTT on-demand Manual
Commencement private call without floor control }
ensure that {
**when** { the MCPTT User wants to cancel the ongoing MCPTT on-demand Manual
Commencement private call }
**then** { UE (MCPTT Client) sends a SIP BYE request and after receiving a SIP
200 (OK) response leaves the MCPTT session }
}
##### 6.2.7.2 Conformance requirements {#conformance-requirements-50 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 6.2.1, 6.2.5.1, 11.1.1.2.1.1, 11.1.2.2,
11.1.3.1.1.1. Unless otherwise stated these are Rel-13 requirements.
[TS 24.379, clause 6.2.1]
The SDP offer shall contain only one SDP media-level section for MCPTT speech
according to 3GPP TS 24.229 [4] and, if floor control shall be used during the
session, shall contain one SDP media-level section for a media-floor control
entity according to 3GPP TS 24.380 [5].
When composing an SDP offer according to 3GPP TS 24.229 [4] the MCPTT client:
> 1) shall set the IP address of the MCPTT client for the offered MCPTT speech
> media stream and, if floor control shall be used, for the offered media-
> floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP offer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 2) shall include an \"m=audio\" media-level section for the MCPTT media
> stream consisting of:
>
> a) the port number for the media stream selected; and
>
> b) the codec(s) and media parameters and attributes with the following
> clarification:
>
> ...
>
> i) shall insert the value of the \"name\" attribute in the \
> field of the \"a=rtpmap\" attribute as defined in IETF RFC 4566 [12]; and
>
> c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4];
>
> ...
>
> 4) if end-to-end security is required for a private call and the SDP offer
> is not for establishing a pre-established session, shall include the MIKEY-
> SAKKE I_MESSAGE in an \"a=key-mgmt\" attribute as a \"mikey\" attribute
> value in the SDP offer as specified in IETF RFC 4567 [47].
[TS 24.379, clause 6.2.5.1]
When the MCPTT client wants to release an MCPTT session established using on-
demand session signalling, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 3) shall set the Request-URI to the MCPTT session identity to release; and
>
> 4) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT
client shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.379, clause 11.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT private call
the MCPTT client shall generate an initial SIP INVITE request by following the
UE originating session procedures specified in 3GPP TS 24.229 [4], with the
clarifications given below.
The MCPTT client:
> 1) shall set the Request-URI of the SIP INVITE request to a public service
> identity of the participating MCPTT function serving the MCPTT user;
>
> 9...
>
> 3) may include a P-Preferred-Identity header field in the SIP INVITE request
> containing a public user identity as specified in 3GPP TS 24.229 [4];
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the media feature tag
> g.3gpp.icsi-ref contain with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\"
> according to IETF RFC 3841 [6];
>
> 8) shall insert in the SIP INVITE request a MIME resource-lists body with
> the MCPTT ID of the invited MCPTT user, according to rules and procedures of
> IETF RFC 5366 [20];
>
> 9) if an end-to-end security context needs to be established then:
>
> a) if necessary, shall instruct the key management client to request keying
> material from the key management server as described in 3GPP TS 33.179 [46];
>
> b) shall use the keying material to generate a PCK as described in 3GPP TS
> 33.179 [46];
>
> c) shall use the PCK to generate a PCK-ID with the four most significant
> bits set to \"0001\" to indicate that the purpose of the PCK is to protect
> private call communications and with the remaining twenty eight bits being
> randomly generated as described in 3GPP TS 33.179 [46];
>
> d) shall encrypt the PCK to a UID associated to the MCPTT client using the
> MCPTT ID of the invited user and a time related parameter as described in
> 3GPP TS 33.179 [46];
>
> e) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and
> PCK-ID as specified in 3GPP TS 33.179 [46]; and
>
> g) shall add the MCPTT ID of the originating MCPTT to the initiator field
> (IDRi) of the I_MESSAGE as described in 3GPP TS 33.179 [46]; and
>
> f) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user\'s
> signing key provided in the keying material together with a time related
> parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
> 33.179 [46].
>
> 10) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarification given in subclause 6.2.1 and with a media stream of the
> offered media-floor control entity;
>
> ...
>
> 13) if force of automatic commencement mode at the invited MCPTT client is
> not requested by the MCPTT user and:
>
> b) if manual commencement mode at the invited MCPTT client is requested by
> the MCPTT user, shall include in the SIP INVITE request an Answer-Mode
> header field with the value \"Manual\" according to the rules and procedures
> of IETF RFC 5373 [18];
>
> 14) shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element containing the \ element with the
> \ element set to a value of \"private\";
>
> ...
>
> 16) shall send SIP INVITE request towards the MCPTT server according to 3GPP
> TS 24.229 [4].
Upon receiving a SIP 183(Session Progress) response to the SIP INVITE request
the MCPTT client:
> 1) may indicate the progress of the session establishment to the inviting
> MCPTT user.
Upon receiving a SIP 200 (OK) response to the SIP INVITE request the MCPTT
client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> ...
>
> 3) shall notify the user that the call has been successfully established.
[TS 24.379, clause 11.1.2.2]
When the MCPTT user wants to make an on-demand private call without floor
control, the MCPTT client shall follow the procedures in subclause
11.1.1.2.1.1 with the following exceptions:
> 1) in step 10) of subclause 11.1.1.2.1.1, the MCPTT client shall not offer a
> media-level section for a media-floor control entity; and
>
> 2) step 11) of subclause 11.1.1.2.1.1 shall be ignored.
[TS 24.379, clause 11.1.3.1.1.1]
Upon receiving a request from an MCPTT user to release an MCPTT private call
session established using on-demand session signalling, the MCPTT client shall
follow the procedures as specified in subclause 6.2.5.1.
##### 6.2.7.3 Test description {#test-description-50 .H6}
##### 6.2.7.3.1 Pre-test conditions {#pre-test-conditions-50 .H6}
##### System Simulator: {#system-simulator-50 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-50 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-50 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.7.3.2 Test procedure sequence {#test-procedure-sequence-50 .H6}
Table 6.2.7.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a | | | | | | | private | | | | | | | call to | | | | | | | user B | | | | | | | with | | | | | | | manual | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | without | | | | | | | floor | | | | | | | control. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | private | | | | | | | call | | | | | | | est | | | | | | | ablishment | | | | | | | with | | | | | | | manual | | | | | | | comm | | | | | | | encement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.35.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a private | | | | | | | call with | | | | | | | manual | | | | | | | co | | | | | | | mmencement | | | | | | | mode and | | | | | | | without | | | | | | | floor | | | | | | | control? | | | | | +------------+------------+------------+---------+---------+----+ | 3-5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the call | | | | | | | has been | | | | | | | es | | | | | | | tablished? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 7-8 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 9 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 11-12 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.7.3.3 Specific message contents {#specific-message-contents-50 .H6}
Table 6.2.7.3.3-1: SIP INVITE from the UE (Step 2, Table 6.2.7.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3.35.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition PRIVATE-CALL,
MANUAL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP Message as described in Table 6.2.7.3.3-2  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.7.3.3-2A
Table 6.2.7.3.3-2: SDP Message in SIP INVITE (Table 6.2.7.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition PRIVATE-CALL,
INITIAL_SDP_OFFER, WITHOUT_FLOORCONTROL
* * *
Table 6.2.7.3.3-2A: MCPTT-Info in SIP INVITE (Table 6.2.7.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE_REFER,
PRIVATE-CALL
* * *
Table 6.2.7.3.3-3: SIP 200 (OK) from the SS (Step 2, Table 6.2.7.3.2-1;\ step
5, TS 36.579-1 [2] Table 5.3.35.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.2.7.3.3-4
Table 6.2.7.3.3-4: SDP Message in SIP 200 (OK) (Table 6.2.7.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
WITHOUT_FLOORCONTROL
* * *
Table 6.2.7.3.3-5: Void
6.2.8 On-network / Private Call / On-demand / Manual Commencement Mode /
Without Floor Control / Client Terminated (CT)
##### 6.2.8.1 Test Purpose (TP) {#test-purpose-tp-51 .H6}
##### (1) {#section-157 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service
including authorization to receive an MCPTT private call }
ensure that {
**when** { the UE (MCPTT Client) receives a request for establishment of an
MCPTT private call, On-demand Manual Commencement Mode without floor control }
**then** { UE (MCPTT Client) notifies the User for the incoming call
responding to the Server with a SIP 180 (Ringing) message, **and** , after the
User accepts the call sends to the Server a SIP 200 (OK) message, **and** ,
does not apply floor control }
}
##### (2) {#section-158 .H6}
**with** { UE (MCPTT Client) having established an MCPTT Private Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) is informed for the termination of
the ongoing MCPTT private call }
**then** { UE (MCPTT Client) accepts the request and after sending a SIP 200
(OK) response leaves the MCPTT session }
}
##### 6.2.8.2 Conformance requirements {#conformance-requirements-51 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 6.2.2, 6.2.3.2.1, 6.2.6, 11.1.1.2.1.2,
11.1.1.2.1.3, 11.1.3.1.1.2. Unless otherwise stated these are Rel-13
requirements.
[TS 24.379, clause 6.2.2]
When the MCPTT client receives an initial SDP offer for an MCPTT session, the
MCPTT client shall process the SDP offer and shall compose an SDP answer
according to 3GPP TS 24.229 [4].
When composing an SDP answer, the MCPTT client:
> 1) shall accept the MCPTT speech media stream in the SDP offer;
>
> 2) shall set the IP address of the MCPTT client for the accepted MCPTT
> speech media stream and, if included in the SDP offer, for the accepted
> media-floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP answer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 3) shall include an \"m=audio\" media-level section for the accepted MCPTT
> speech media stream consisting of:
>
> a) the port number for the media stream;
>
> b) media-level attributes as specified in 3GPP TS 24.229 [4]; and
>
> c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4]; and
[TS 24.379, clause 6.2.3.2.1]
The MCPTT client:
> 1) shall accept the SIP INVITE request and generate a SIP 180 (Ringing)
> response according to rules and procedures of 3GPP TS 24.229 [4];
>
> 2) shall include the option tag \"timer\" in a Require header field of the
> SIP 180 (Ringing) response;
>
> 3) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 180 (Ringing) response;
>
> 4) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 180 (Ringing) response; and
>
> 5) shall send the SIP 180 (Ringing) response to the MCPTT server.
When sending the SIP 200 (OK) response to the incoming SIP INVITE request, the
MCPTT client shall follow the procedures in subclause 6.2.3.1.1.
When NAT traversal is supported by the MCPTT client and when the MCPTT client
is behind a NAT, generation of SIP responses is done as specified in this
subclause and as specified in IETF RFC 5626 [15].
[TS 24.379, clause 6.2.6]
Upon receiving a SIP BYE request, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall send SIP 200 (OK) response towards MCPTT server according to 3GPP
> TS 24.229 [4].
[TS 24.379, clause 11.1.1.2.1.2]
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> ...
>
> 4) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
> attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
> I_MESSAGE:
>
> a) shall extract the MCPTT ID of the originating MCPTT from the initiator
> field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.179 [46];
>
> b) shall convert the MCPTT ID to a UID as described in 3GPP TS 33.179 [46];
>
> c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE
> as described in 3GPP TS 33.179 [46];
>
> d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
> reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response
> as specified in IETF RFC 4567 [47], and include warning text set to \"136
> authentication of the MIKEY-SAKE I_MESSAGE failed\" in a Warning header
> field as specified in subclause 4.4; and
>
> e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
>
> i) shall extract and decrypt the encapsulated PCK using the terminating
> user\'s (KMS provisioned) UID key as described in 3GPP TS 33.179 [46]; and
>
> ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS
> 33.179 [46];
>
> NOTE: With the PCK successfully shared between the originating MCPTT client
> and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to
> create an end-to-end secure session.
>
> 5) may check if a Resource-Priority header field is included in the incoming
> SIP INVITE request and may perform further actions outside the scope of the
> present document to act upon an included Resource-Priority header field as
> specified in 3GPP TS 24.229 [4];
>
> 6) may display to the MCPTT user the MCPTT ID of the inviting MCPTT user;
>
> ...
>
> 8) shall perform the manual commencement procedures specified in subclause
> 6.2.3.2.1 if either of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to manual commencement mode; or
[TS 24.379, clause 11.1.2.2]
Upon receipt of an initial SIP INVITE request for the private call with an SDP
offer not including a media-level section for a media-floor control entity,
the MCPTT client shall consider it as the request for private call without
floor control and shall follow the procedures as specified in subclause
11.1.1.2.1.2 for on-demand session and subclause 11.1.1.2.2.2 for pre-
established session.
[TS 24.379, clause 11.1.3.1.1.2]
Upon receiving a SIP BYE request for private call session, the MCPTT client
shall follow the procedures as specified in subclause 6.2.6.
##### 6.2.8.3 Test description {#test-description-51 .H6}
##### 6.2.8.3.1 Pre-test conditions {#pre-test-conditions-51 .H6}
##### System Simulator: {#system-simulator-51 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-51 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-51 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.8.3.2 Test procedure sequence {#test-procedure-sequence-51 .H6}
Table 6.2.8.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                                                                                                               U - S              Message
1 Check: Does the UE (MCPTT client) correctly perform procedure \'MCX CT
private call establishment with manual commencement\' as described in TS
36.579-1 [2] Table 5.3.6.3-1 to establish a private call with manual
commencement mode and without floor control? - - 1 P 2-6 Void. - - - - 7 Wait
5 sec - - - - 8 Check: Does the UE (MCPTT client) correctly perform procedure
\'MCX CT call release\' as described in TS 36.579-1 [2] Table 5.3.12.3-1? - -
2 P 9-10 Void. - - - -
##### 6.2.8.3.3 Specific message contents {#specific-message-contents-51 .H6}
Table 6.2.8.3.3-1: SIP INVITE from the SS (Step 1, Table 6.2.8.3.2-1;\ step 2,
TS 36.579-1 [2], Table 5.3.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition MANUAL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.8.3.3-2  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.8.3.3-2B
Table 6.2.8.3.3-2: SDP Message in SIP INVITE (Table 6.2.8.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition PRIVATE-CALL,
INITIAL_SDP_OFFER, WITHOUT_FLOORCONTROL
* * *
Table 6.2.8.3.3-2B: MCPTT-Info in SIP INVITE (Table 6.2.8.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Table 6.2.8.3.3-3: SIP 200 (OK) from the UE (Step 1, Table 6.2.8.3.2-1;\ step
6, TS 36.579-1 [2], Table 5.3.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.8.3.3-4  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.8.3.3-4A
Table 6.2.8.3.3-4: SDP Message in SIP 200 (OK) (Table 6.2.8.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_ANSWER,
WITHOUT_FLOORCONTROL
* * *
Table 6.2.8.3.3-4A: MCPTT-Info in SIP 200 (OK) (Table 6.2.8.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
Table 6.2.8.3.3-5: Void
6.2.9 On-network / Private Call / Within a pre-established session / Automatic
Commencement Mode / Without Floor Control / Client Originated (CO)
##### 6.2.9.1 Test Purpose (TP) {#test-purpose-tp-52 .H6}
##### (1) {#section-159 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate/cancel private calls with automatic
commencement, **and** , having established a pre-established session }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT private call
within the pre-established session, Automatic Commencement Mode, no Force of
automatic commencement, without floor control }
**then** { UE (MCPTT Client) sends a SIP REFER request outside a dialog
indicating Automatic Commencement Mode and not offering a media-level section
for a media-floor control entity, **and** , after receiving a Connect message
from the participating MCPTT function sends an Acknowledgment message
indicating that the connection is accepted }
}
##### (2) {#section-160 .H6}
**with** { UE (MCPTT Client) having Private Call Within a pre-established
session, Automatic Commencement Mode Private Call without Floor control }
ensure that {
**when** { the MCPTT User wants to release the ongoing MCPTT private call }
**then** { UE (MCPTT Client) sends a REFER request with the value \"BYE\" in
the URI in the Refer-To header field and after receiving a SIP 200 (OK) leaves
the MCPTT session }
}
##### 6.2.9.2 Conformance requirements {#conformance-requirements-52 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.1.2.2, 11.1.1.2.2.1, 11.1.3.1.2.1, 6.2.5.2,
TS 24.380 clauses 4.1.2.1, 4.1.2.2, 9.2.2.3.2, 9.2.2.4.6. Unless otherwise
stated these are Rel-13 requirements.
[TS 24.379, clause 11.1.2.2]
When the MCPTT user wants to make a private call without floor control using a
pre-established session, the MCPTT client shall follow the procedures in
subclause 11.1.1.2.2.1 with the exception that step 8 c) i) is re-written as:
> \- if the SDP parameters of the pre-established session contain a media-
> level section of a media-floor control entity or if end-to-end security is
> required for the private call, an application/sdp MIME body containing the
> SDP parameters of the pre-established session according to 3GPP TS 24.229
> [4] with the clarification given in subclause 6.2.1. If the pre-established
> session was established with implicit floor control, then the
> application/sdp MIME body shall not contain the implicit floor request as
> specified in subclause 6.4.
[TS 24.379, clause 11.1.1.2.2.1]
Upon receiving a request from an MCPTT user to establish an MCPTT private call
within a pre-established session the MCPTT client shall generate a SIP REFER
request outside a dialog in accordance with the procedures specified in 3GPP
TS 24.229 [4], IETF RFC 4488 [22] and IETF RFC 3515 [25] as updated by IETF
RFC 6665 [26] and IETF RFC 7647 [27], with the clarifications given below.
...
The MCPTT client populates the SIP REFER request as follows:
> 1) shall include the Request-URI set to the public service identity
> identifying the pre-established session on the MCPTT server serving the
> MCPTT user;
>
> 2) shall include the Refer-Sub header field with value \"false\" according
> to rules and procedures of IETF RFC 4488 [22];
>
> 3) shall include the Supported header field with value \"norefersub\"
> according to rules and procedures of IETF RFC 4488 [22];
>
> 4) shall include the option tag \"multiple-refer\" in the Require header
> field;
>
> 5) may include a P-Preferred-Identity header field in the SIP REFER request
> containing a public user identity as specified in 3GPP TS 24.229 [4];
>
> 6) shall include a P-Preferred-Service header field set to the ICSI value
> \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS
> 24.229 [4]), according to IETF RFC 6050 [9];
>
> 7) shall set the Refer-To header field of the SIP REFER request as specified
> in IETF RFC 3515 [25] with a Content-ID (\"cid\") Uniform Resource Locator
> (URL) as specified in IETF RFC 2392 [62] that points to an
> application/resource-lists MIME body as specified in IETF RFC 5366 [20], and
> with the Content-ID header field set to this \"cid\" URL.
>
> 8) shall include in the application/resource-lists MIME body a single
> \ element containing a \"uri\" attribute set to the MCPTT ID of the
> called user, extended with the following URI header fields:
>
> NOTE: Characters that are not formatted as ASCII characters are escaped in
> the following URI header fields
>
> ..
>
> b) if force of automatic commencement mode at the invited MCPTT client is
> not requested by the MCPTT user and:
>
> i) if automatic commencement mode at the invited MCPTT client is requested
> by the MCPTT user, shall include an Answer-Mode header field with the value
> \"Automatic\" according to rules and procedures of IETF RFC 5373 [18]; and
>
> ...
>
> c) shall include in a hname \"body\" URI header field:
>
> i) ...
>
> ii) an application/vnd.3gpp.mcptt-info MIME body with the \
> element set to \"private\"; and
>
> iii) an application/resources-list MIME body with an \ element
> containing a \"uri\" attribute set to the MCPTT ID of the called user;
>
> ...
>
> 11) shall include a Target-Dialog header field as specified in IETF RFC 4538
> [23] identifying the pre-established session.
The MCPTT client shall send the SIP REFER request towards the MCPTT server
according to 3GPP TS 24.229 [4].
Upon receiving a final SIP 2xx response to the SIP REFER request the MCPTT
client shall interact with media plane as specified in 3GPP TS 24.380 [5].
[TS 24.379, clause 11.1.3.1.2.1]
Upon receiving a request from an MCPTT user to release an MCPTT private call
within a pre-established session, the MCPTT client shall follow the procedures
as specified in subclause 6.2.5.2.
[TS 24.379, clause 6.2.5.2]
When the MCPTT client wants to release an MCPTT session using a pre-
established session, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate an initial SIP REFER request outside a dialog in
> accordance with the procedures specified in 3GPP TS 24.229 [4], IETF RFC
> 4488 [22] and IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF
> RFC 7647 [27];
>
> 3) shall set the Request-URI of the SIP REFER request to the public service
> identity identifying the pre-established session on the MCPTT server serving
> the MCPTT user;
>
> 4) shall include the Refer-Sub header field with value \"false\" according
> to rules and procedures of IETF RFC 4488 [22];
>
> 5) shall include the Supported header field with value \"norefersub\"
> according to rules and procedures of IETF RFC 4488 [22];
>
> 6) shall set the Refer-To header field of the SIP REFER request to the MCPTT
> session identity to release;
>
> 7) shall include the \"method\" SIP URI parameter with the value \"BYE\" in
> the URI in the Refer-To header field;
>
> 8) shall include a Target-Dialog header field as specified in IETF RFC 4538
> [23] identifying the pre-established session; and
>
> 9) shall send the SIP REFER request according to 3GPP TS 24.229 [4].
Upon receiving a SIP 2xx response to the SIP REFER request, the MCPTT client
shall interact with media plane as specified in 3GPP TS 24.380 [5].
[TS 24.380, clause 4.1.2.1]
A pre-established session can be used when initiating a pre-arranged group
call, a chat group call or a private call. Similarly a pre-established session
can be released for reuse after the termination of a pre-arranged group call,
chat group call and private call.
The media plane control messages related to call setup over a pre-established
session are sent over the channel used for media plane control. The media
plane control messages related to the release of a call which was setup over a
pre-established session, without terminating the pre-established session, are
sent over the channel used for media plane control. The unicast channel for
media plane control is over the MCPTT-4 reference point.
[TS 24.380, clause 4.1.2.2]
For a pre-arranged group call, when the originator initiates the call setup
indicating the use of a pre-established session using SIP messages as
specified in 3GPP TS 24.379 [2], the participating MCPTT function (which
serves the originating MCPTT client) sends to the originating MCPTT client a
Connect message after the controlling MCPTT function accepts the initiation of
this call. After the reception of this Connect message the originating MCPTT
client sends an Acknowledgment message by indicating that the connection is
accepted or by indicating that the connection is not accepted. If the
connection is accepted by the originating MCPTT client, the floor control for
this call continues a specified in clause 6.
[TS 24.380, clause 9.2.2.3.2]
Upon reception of a Connect message:
> 1\. if the MCPTT client accepts the incoming call the MCPTT client:
>
> a. shall send the Acknowledgement message with Reason Code field set to
> \'Accepted\';
>
> b. shall use only the media streams of the pre-established session which are
> indicated as used in the associated call session Media Streams field, if the
> Connect contains a Media Streams field;
>
> c. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\' as specified in subclause 6.2.10; and
>
> d. shall enter the \'U: Pre-established session in use\' state; or
[TS 24.380, clause 9.2.2.4.6]
Upon receiving a 2xx response to the sent SIP REFER request as described in
3GPP TS 24.379 [2] when the call is released, but the Pre-established Session
is kept alive the MCPTT client:
> 1\. shall enter the \'U: Pre-established session not in use\' state; and
>
> 2\. shall terminate the instance of \'Floor participant state transition
> diagram for basic operation\' state machine as specified in subclause 6.2.4.
##### 6.2.9.3 Test description {#test-description-52 .H6}
##### 6.2.9.3.1 Pre-test conditions {#pre-test-conditions-52 .H6}
##### System Simulator: {#system-simulator-52 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-52 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-52 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.9.3.2 Test procedure sequence {#test-procedure-sequence-52 .H6}
Table 6.2.9.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | private | | | | | | | call to | | | | | | | user B | | | | | | | using the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session | | | | | | | with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | without | | | | | | | floor | | | | | | | control. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | esta | | | | | | | blishment | | | | | | | using a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5 | | | | | | | .3A.3.3-1 | | | | | | | to | | | | | | | establish | | | | | | | an MCPTT | | | | | | | private | | | | | | | call | | | | | | | without | | | | | | | floor | | | | | | | control? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3-5 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 5A | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5B | Check: | --> | Floor | 1 | F | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | in the | | | | | | | next 5 | | | | | | | sec? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | release | | | | | | | keeping | | | | | | | the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5. | | | | | | | 3A.4.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8-9 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The media | | | | | | | plane | | | | | | | control | | | | | | | messages | | | | | | | related | | | | | | | to call | | | | | | | setu | | | | | | | p/release | | | | | | | over a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session | | | | | | | are sent | | | | | | | over the | | | | | | | channel | | | | | | | used for | | | | | | | media | | | | | | | plane | | | | | | | control. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 6.2.9.3.3 Specific message contents {#specific-message-contents-52 .H6}
Table 6.2.9.3.3-1: SIP REFER from the UE (Step 2, Table 6.2.9.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3A.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.12-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **Resource-lists**  
MIME-part-body Resource-lists as described in Table 6.2.9.3.3-1A
Table 6.2.9.3.3-1A: Resource-lists in SIP REFER (Table 6.2.9.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.3.1-1, condition PRE-ESTABLISH,
PRIVATE-CALL with the uri attribute of the entry extended with the SIP URI
header fields as specified in Table 6.2.9.3.3-1B
* * *
Table 6.2.9.3.3-1B: SIP header fields extending the uri attribute of the
resource-lists\' single entry\ (Table 6.2.9.3.3-1A)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.12-2, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition body  
MIME body part **SDP Message**  
MIME-part-headers  
Content-Type "application/sdp"  
MIME-part-body SDP Message as described in **Table 6.2.9.3.3-2**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.9.3.3-2A
Table 6.2.9.3.3-2: SDP Message in SIP REFER (Table 6.2.9.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_OFFER,
PRE_ESTABLISHED_SESSION, PRIVATE-CALL, WITHOUT_FLOORCONTROL
* * *
Table 6.2.9.3.3-2A: MCPTT-Info in SIP header fields (Table 6.2.9.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition PRIVATE-CALL,
INVITE-REFER
* * *
Table 6.2.9.3.3-3: SIP 200 (OK) from the SS (Step 2, Table 6.2.9.3.2-1;\ step
3, TS 36.579-1 [2] Table 5.3A.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition REFER-RSP
* * *
Information Element Value/remark Comment Reference Condition **Content-Type**  
media-type \"application/sdp\"  
**Message-body**  
SDP message As described in Table 6.2.9.3.3-3A
Table 6.2.9.3.3-3A: SDP Message in SIP OK (Table 6.2.9.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
PRE_ESTABLISHED_SESSION, WITHOUT_FLOORCONTROL
* * *
Table 6.2.9.3.3-3B: Connect (Step 2, Table 6.2.9.3.2-1;\ step 4, TS 36.579-1
[2] Table 5.3A.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.12-1, condition PRIVATE-CALL,
WITHOUT_FLOORCONTROL, ACK
* * *
Table 6.2.9.3.3-4-5: Void
6.2.10 On-network / Private Call / Within a pre-established session /
Automatic Commencement Mode / Without Floor Control / Client Terminated (CT)
##### 6.2.10.1 Test Purpose (TP) {#test-purpose-tp-53 .H6}
##### (1) {#section-161 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to receive private calls with automatic commencement,
and, having established a pre-established session, Automatic Commencement Mode
without End-to-end communication security and without floor control }
ensure that {
**when** { the UE (MCPTT Client) receives a media plane control Connect
message as a part of request for establishment of a client Terminated MCPTT
private call, within the pre-established session }
**then** { UE (MCPTT Client) sends a media plane control Acknowledgement
message accepting the establishment of the media plane and thereby the
establishment of the MCPTT private call }
##### (2) {#section-162 .H6}
**with** { UE (MCPTT Client) having Private Call Within a pre-established
session }
ensure that {
**when** { the MCPTT User (MCPTT Client) receives a media plane control
Disconnect message for termination of the ongoing MCPTT private call }
**then** { UE (MCPTT Client) accept the request by sending a media plane
control Acknowledgement message and releases the call but keeps the pre-
established session, **and,** does not terminate the pre-established session }
}
##### 6.2.10.2 Conformance requirements {#conformance-requirements-53 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.380 clauses 4.1.2.1, 4.1.2.3, 9.2.2.3.2, 9.2.2.3.4. Unless
otherwise stated these are Rel-13 requirements.
[TS 24.380, clause 4.1.2.1]
A pre-established session can be used when initiating a pre-arranged group
call, a chat group call or a private call. Similarly a pre-established session
can be released for reuse after the termination of a pre-arranged group call,
chat group call and private call.
The media plane control messages related to call setup over a pre-established
session are sent over the channel used for media plane control. The media
plane control messages related to the release of a call which was setup over a
pre-established session, without terminating the pre-established session, are
sent over the channel used for media plane control. The unicast channel for
media plane control is over the MCPTT-4 reference point.
[TS 24.380, clause 4.1.2.3]
When an MCPTT client leaves a call (as specified in 3GPP TS 24.379 [2]) which
was setup over a pre-established session without releasing the pre-established
session, this pre-established session can be used for another call.
[TS 24.380, clause 9.2.2.3.2]
Upon reception of a Connect message:
> 1\. if the MCPTT client accepts the incoming call the MCPTT client:
>
> a. shall send the Acknowledgement message with Reason Code field set to
> \'Accepted\';
>
> b. shall use only the media streams of the pre-established session which are
> indicated as used in the associated call session Media Streams field, if the
> Connect contains a Media Streams field;
>
> c. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\' as specified in subclause 6.2.10; and
>
> d. shall enter the \'U: Pre-established session in use\' state; or
[TS 24.380, clause 9.2.2.3.4]
Upon reception of a Disconnect message the MCPTT client:
> 1\. if the first bit in the subtype of the Disconnect message is set to
> \'1\' (acknowledgement is required), shall send the Acknowledgement message
> with the Reason Code set to \'Accepted\'; and
>
> 2\. shall remain in \'U: Pre-established session not in use\' state.
##### 6.2.10.3 Test description {#test-description-53 .H6}
##### 6.2.10.3.1 Pre-test conditions {#pre-test-conditions-53 .H6}
##### System Simulator: {#system-simulator-53 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-53 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-53 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.10.3.2 Test procedure sequence {#test-procedure-sequence-53 .H6}
Table 6.2.10.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CT Call | | | | | | | esta | | | | | | | blishment | | | | | | | using a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5. | | | | | | | 3A.8.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify | | | | | | | the user | | | | | | | that the | | | | | | | call has | | | | | | | been | | | | | | | est | | | | | | | ablished? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4A | Check: | --> | Floor | 1 | F | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | in the | | | | | | | next 5 | | | | | | | sec? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CT call | | | | | | | release | | | | | | | keeping | | | | | | | the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5. | | | | | | | 3A.5.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify | | | | | | | the user | | | | | | | that the | | | | | | | call has | | | | | | | been | | | | | | | released? | | | | | | | | | | | | | | (NOTE 1): | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | private | | | | | | | call to | | | | | | | user B | | | | | | | using the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session | | | | | | | with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | without | | | | | | | floor | | | | | | | control. | | | | | | | | | | | | | | (NOTE 1). | | | | | | | | | | | | | | NOTE: | | | | | | | This is | | | | | | | to verify | | | | | | | that | | | | | | | although | | | | | | | the | | | | | | | Client | | | | | | | has | | | | | | | released | | | | | | | the call | | | | | | | it has | | | | | | | not | | | | | | | t | | | | | | | erminated | | | | | | | the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | esta | | | | | | | blishment | | | | | | | using a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5 | | | | | | | .3A.3.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a private | | | | | | | call | | | | | | | without | | | | | | | floor | | | | | | | control? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11-12 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 13 | Wait for | - | - | - | - | | | 5 sec. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 14 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15 | The UE | - | - | - | - | | | (MCPTT | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | release | | | | | | | keeping | | | | | | | the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5 | | | | | | | .3A.4.3-1 | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The media | | | | | | | plane | | | | | | | control | | | | | | | messages | | | | | | | related | | | | | | | to call | | | | | | | setu | | | | | | | p/release | | | | | | | over a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session | | | | | | | are sent | | | | | | | over the | | | | | | | channel | | | | | | | used for | | | | | | | media | | | | | | | plane | | | | | | | control. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 6.2.10.3.3 Specific message contents {#specific-message-contents-53 .H6}
Table 6.2.10.3.3-1: Connect (Step 1, Table 6.2.10.3.2-1;\ step 2, TS 36.579-1
[2] Table 5.3A.8.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.12-1, condition PRIVATE-CALL,
WITHOUT_FLOORCONTROL
* * *
Table 6.2.10.3.3-2..3: Void
Table 6.2.10.3.3-4: SIP REFER from the UE (Step 10, Table 6.2.10.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3A.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.12-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **Resource-lists**  
MIME-part-body Resource-lists as described in Table 6.2.10.3.3-4A
Table 6.2.10.3.3-4A: Resource-lists (Table 6.2.10.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.3.1-1, condition PRE-ESTABLISH,
PRIVATE-CALL with the uri attribute of the entry extended with the SIP URI
header fields as specified in Table 6.2.10.3.3-4B
* * *
Table 6.2.10.3.3-4B: SIP header fields extending the uri attribute of the
resource-lists\' single entry\ (Table 6.2.10.3.3-4A)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.12-2, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition body  
MIME body part **SDP Message**  
MIME-part-headers  
Content-Type "application/sdp"  
MIME-part-body SDP Message as described in **Table 6.2.10.3.3.5**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.10.3.3-5A
Table 6.2.10.3.3-5: SDP Message in SIP REFER (Table 6.2.10.3.3-4B)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_OFFER,
PRE_ESTABLISHED_SESSION, PRIVATE-CALL, WITHOUT_SECURITY, WITHOUT_FLOORCONTROL
* * *
Table 6.2.10.3.3-5A: MCPTT-Info in SIP header fields (Table 6.2.10.3.3-4B)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL,
INVITE-REFER
* * *
Table 6.2.10.3.3-6: SIP 200 (OK) from the SS (Step 10, Table 6.2.10.3.2-1;\
step 3, TS 36.579-1 [2] Table 5.3A.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition REFER-RSP
* * *
Information Element Value/remark Comment Reference Condition **Content-Type**  
media-type \"application/sdp\"  
**Message-body**  
SDP message As described in Table 6.2.10.3.3-7
Table 6.2.10.3.3-7: SDP Message in SIP 200 (OK) (Table 6.2.10.3.3-6)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
PRE_ESTABLISHED_SESSION, WITHOUT_FLOORCONTROL
* * *
Table 6.2.10.3.3-7A: Connect (Step 10, Table 6.2.10.3.2-1;\ step 4, TS
36.579-1 [2] Table 5.3A.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.12-1, condition PRIVATE-CALL,
WITHOUT_FLOORCONTROL, ACK
* * *
Table 6.2.10.3.3-8..9: Void
6.2.11 On-network / Private Call / Within a pre-established session / Manual
Commencement Mode / Without Floor Control / Release of the Call and the pre-
established session / Client Terminated (CT)
##### 6.2.11.1 Test Purpose (TP) {#test-purpose-tp-54 .H6}
##### (1) {#section-163 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to receive private calls with manual commencement, and,
having established a pre-established session, without End-to-end communication
security and without floor control }
ensure that {
**when** { the UE (MCPTT Client) receives a SIP re-INVITE message as a part of
request for establishment of a client Terminated MCPTT private call, within
the pre-established session, Manual Commencement Mode }
**then** { UE (MCPTT Client) notifies the User for the incoming call, **and**
, responds to the Server with a SIP 180 (Ringing) message, **and** , after the
User accepts the call sends to the Server a SIP 200 (OK) message }
}
##### (2) {#section-164 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to receive private calls with automatic commencement,
and, having established a pre-established session, Automatic Commencement Mode
without End-to-end communication security and without floor control, and, the
User having accepted a request for the establishment of a client Terminated
MCPTT private call within the pre-established session }
ensure that {
**when** { the UE (MCPTT Client) receives a media plane control Connect
message as a part of request for establishment of a client Terminated MCPTT
private call, within the pre-established session }
**then** { UE (MCPTT Client) sends a media plane control Acknowledgement
message accepting the establishment of the media plane and thereby the
establishment of the MCPTT private call }
}
##### (3) {#section-165 .H6}
**with** { UE (MCPTT Client) having Private Call Within a pre-established
session }
ensure that {
**when** { the MCPTT User (MCPTT Client) is informed for the termination of
the ongoing MCPTT private call by the Server sending a SIP BYE message }
**then** { UE (MCPTT Client) accepts the request and after sending a SIP 200
(OK) response terminates the call and the pre-established MCPTT session }
}
##### 6.2.11.2 Conformance requirements {#conformance-requirements-54 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 6.2.3.1.1, 6.2.3.2.1, 6.2.6, 11.1.1.2.1.2,
11.1.1.2.2.2, 11.1.2.2, TS 24.380 clauses 4.1.2.1, 4.1.2.3, 9.2.2.3.2. Unless
otherwise stated these are Rel-13 requirements.
[TS 24.379, clause 6.2.3.1.1]
> 2) shall include the option tag \"timer\" in a Require header field of the
> SIP 200 (OK) response;
>
> 3) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 200 (OK) response;
>
> 4) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 200 (OK) response;
>
> 5) shall include the Session-Expires header field in the SIP 200 (OK)
> response and start the SIP session timer according to IETF RFC 4028 [7]. The
> \"refresher\" parameter in the Session-Expires header field shall be set to
> \"uas\";
>
> 6) shall, if the incoming SIP INVITE request contains a Replaces header
> field, include in the SDP answer in the SIP 200 (OK) response to the SDP
> offer the parameters used for the pre-established session identified by the
> contents of the Replaces header field;
>
> 7) shall, if the incoming SIP INVITE request does not contain a Replaces
> header field, include an SDP answer in the SIP 200 (OK) response to the SDP
> offer in the incoming SIP INVITE request according to 3GPP TS 24.229 [4]
> with the clarifications given in subclause 6.2.2;
>
> NOTE: In the case of a new emergency call where the terminating client is
> using a pre-established session, the SIP INVITE request containing a
> Replaces header is used to replace the pre-established session.
>
> 8) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4];
>
> 9) shall, if the incoming SIP INVITE request contains a Replaces header
> field, release the pre-established session identified by the contents of the
> Replaces header field; and
>
> 10) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
> subclause 6.2.
When NAT traversal is supported by the MCPTT client and when the MCPTT client
is behind a NAT, generation of SIP responses is done as specified in this
subclause and as specified in IETF RFC 5626 [15].
[TS 24.379, clause 6.2.3.2.1]
The MCPTT client:
> 1) shall accept the SIP INVITE request and generate a SIP 180 (Ringing)
> response according to rules and procedures of 3GPP TS 24.229 [4];
>
> 2) shall include the option tag \"timer\" in a Require header field of the
> SIP 180 (Ringing) response;
>
> 3) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 180 (Ringing) response;
>
> 4) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 180 (Ringing) response; and
>
> 5) shall send the SIP 180 (Ringing) response to the MCPTT server.
When sending the SIP 200 (OK) response to the incoming SIP INVITE request, the
MCPTT client shall follow the procedures in subclause 6.2.3.1.1.
When NAT traversal is supported by the MCPTT client and when the MCPTT client
is behind a NAT, generation of SIP responses is done as specified in this
subclause and as specified in IETF RFC 5626 [15].
[TS 24.379, clause 6.2.6]
Upon receiving a SIP BYE request, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall send SIP 200 (OK) response towards MCPTT server according to 3GPP
> TS 24.229 [4].
[TS 24.379, clause 11.1.1.2.1.2]
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> ...
>
> 4) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
> attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
> I_MESSAGE:
>
> a) shall extract the MCPTT ID of the originating MCPTT from the initiator
> field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.179 [46];
>
> b) shall convert the MCPTT ID to a UID as described in 3GPP TS 33.179 [46];
>
> c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE
> as described in 3GPP TS 33.179 [46];
>
> d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
> reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response
> as specified in IETF RFC 4567 [47], and include warning text set to \"136
> authentication of the MIKEY-SAKE I_MESSAGE failed\" in a Warning header
> field as specified in subclause 4.4; and
>
> e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
>
> i) shall extract and decrypt the encapsulated PCK using the terminating
> user\'s (KMS provisioned) UID key as described in 3GPP TS 33.179 [46]; and
>
> ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS
> 33.179 [46];
>
> NOTE: With the PCK successfully shared between the originating MCPTT client
> and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to
> create an end-to-end secure session.
>
> ...
>
> 8) shall perform the manual commencement procedures specified in subclause
> 6.2.3.2.1 if either of the following conditions are met:
>
> a) SIP INVITE request contains an Answer-Mode header field with the value
> \"Manual\" and the MCPTT service setting at the invited MCPTT client for
> answering the call is set to manual commencement mode; or
[TS 24.379, clause 11.1.1.2.2.2]
The MCPTT client shall follow the procedures for termination of multimedia
sessions as specified in subclause 11.1.1.2.1.2 with the following
clarifications:
> ...
>
> 2) if the MCPTT client is targeted for a new normal priority private call,
> the MCPTT client receives a SIP re-INVITE request rather than a SIP INVITE
> request.
[TS 24.379, clause 11.1.2.2]
Upon receipt of an initial SIP INVITE request for the private call with an SDP
offer not including a media-level section for a media-floor control entity,
the MCPTT client shall consider it as the request for private call without
floor control and shall follow the procedures as specified in subclause
11.1.1.2.1.2 for on-demand session and subclause 11.1.1.2.2.2 for pre-
established session.
[TS 24.380, clause 4.1.2.1]
A pre-established session can be used when initiating a pre-arranged group
call, a chat group call or a private call. Similarly a pre-established session
can be released for reuse after the termination of a pre-arranged group call,
chat group call and private call.
The media plane control messages related to call setup over a pre-established
session are sent over the channel used for media plane control. The media
plane control messages related to the release of a call which was setup over a
pre-established session, without terminating the pre-established session, are
sent over the channel used for media plane control. The unicast channel for
media plane control is over the MCPTT-4 reference point.
[TS 24.380, clause 4.1.2.3]
A call setup over a pre-established session can also be released by using the
specifications in 3GPP TS 24.379 [2] (without the use of Disconnect message)
as a result the pre-established session, which has been used for this call, is
also released.
[TS 24.380, clause 9.2.2.3.2]
Upon reception of a Connect message:
> 1\. if the MCPTT client accepts the incoming call the MCPTT client:
>
> a. shall send the Acknowledgement message with Reason Code field set to
> \'Accepted\';
>
> b. shall use only the media streams of the pre-established session which are
> indicated as used in the associated call session Media Streams field, if the
> Connect contains a Media Streams field;
>
> c. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\' as specified in subclause 6.2.11; and
>
> d. shall enter the \'U: Pre-established session in use\' state; or
##### 6.2.11.3 Test description {#test-description-54 .H6}
##### 6.2.11.3.1 Pre-test conditions {#pre-test-conditions-54 .H6}
##### System Simulator: {#system-simulator-54 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-54 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-54 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.11.3.2 Test procedure sequence {#test-procedure-sequence-54 .H6}
Table 6.2.11.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | C | - | - | 1 | P | | | heck:Does | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | private | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | with | | | | | | | manual | | | | | | | comme | | | | | | | ncement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.6.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a private | | | | | | | call | | | | | | | without | | | | | | | floor | | | | | | | control? | | | | | | | | | | | | | | Note: The | | | | | | | session | | | | | | | has been | | | | | | | es | | | | | | | tablished | | | | | | | by the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | and the | | | | | | | request | | | | | | | is for | | | | | | | manual | | | | | | | answer | | | | | | | mode, | | | | | | | therefore | | | | | | | INVITE is | | | | | | | used for | | | | | | | est | | | | | | | ablishing | | | | | | | the call | | | | | | | as | | | | | | | specified | | | | | | | in TS | | | | | | | 24.380 | | | | | | | [10], | | | | | | | clause | | | | | | | 9.3.2.3.3 | | | | | | | and TS | | | | | | | 24.379 | | | | | | | [9] | | | | | | | clause | | | | | | | 11.1 | | | | | | | .1.2.2.2. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2-3 | Void. | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 4 | The SS | \ | Ac | 2 | P | | | Does the | | knowledge | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send an | | | | | | | Ack | | | | | | | nowledge? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Void. | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7A | Check: | --> | Floor | 1 | F | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | in the | | | | | | | next 5 | | | | | | | sec? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3.12.3-1? | | | | | | | | | | | | | | NOTE: | | | | | | | This way | | | | | | | of | | | | | | | release | | | | | | | is used | | | | | | | to | | | | | | | trigger | | | | | | | not only | | | | | | | release | | | | | | | of the | | | | | | | call but | | | | | | | also | | | | | | | release | | | | | | | of the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session, | | | | | | | see TS | | | | | | | 24.380 | | | | | | | [10], | | | | | | | clause | | | | | | | 4.1.2.3. | | | | | | | Whether | | | | | | | the | | | | | | | session | | | | | | | was | | | | | | | released | | | | | | | is then | | | | | | | verified | | | | | | | with the | | | | | | | step 12. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 10 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify | | | | | | | the user | | | | | | | that the | | | | | | | call has | | | | | | | been | | | | | | | released? | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 12 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | private | | | | | | | call to | | | | | | | user B | | | | | | | with | | | | | | | manual | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | without | | | | | | | floor | | | | | | | control. | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | private | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | with | | | | | | | manual | | | | | | | comme | | | | | | | ncement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.35.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a private | | | | | | | call with | | | | | | | manual | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | without | | | | | | | floor | | | | | | | control? | | | | | | | | | | | | | | Note: If | | | | | | | the | | | | | | | session | | | | | | | was not | | | | | | | t | | | | | | | erminated | | | | | | | then the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | will send | | | | | | | a REFER. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 14-16 | Void. | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 17 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 18 | The UE | - | - | - | - | | | (MCPTT | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3.10.3-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 19 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | The media | | | | | | | plane | | | | | | | control | | | | | | | messages | | | | | | | related | | | | | | | to call | | | | | | | setu | | | | | | | p/release | | | | | | | over a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session | | | | | | | are sent | | | | | | | over the | | | | | | | channel | | | | | | | used for | | | | | | | media | | | | | | | plane | | | | | | | control. | | | | | | | | | | | | | | NOTE 2: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 6.2.11.3.3 Specific message contents {#specific-message-contents-54 .H6}
Table 6.2.11.3.3-1: SIP INVITE from the SS (Step 1, Table 6.2.11.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition re_INVITE,
MANUAL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.11.3.3-2  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.11.3.3-2A
Table 6.2.11.3.3-2: SDP Message in SIP INVITE (Table 6.2.11.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition PRIVATE-CALL,
SDP_OFFER, PRE_ESTABLISHED_SESSION, WITHOUT_SECURITY, WITHOUT_FLOORCONTROL
* * *
Table 6.2.11.3.3-2A: MCPTT-Info in SIP INVITE (Table 6.2.11.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Table 6.2.11.3.3-3: SIP 200 (OK) from the UE (Step 3, Table 6.2.11.3.2-1;\
step 6, TS 36.579-1 [2], Table 5.3.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.11.3.3-4  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.11.3.3-4A
Table 6.2.11.3.3-4: SDP Message in SIP 200 (OK) (Table 6.2.11.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition PRIVAT-CALL,
SDP_ANSWER, PRE_ESTABLISHED_SESSION, WITHOUT_FLOORCONTROL
* * *
Table 6.2.11.3.3-4A: MCPTT-Info in SIP 200 (OK) (Table 6.2.11.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
Table 6.2.11.3.3-5: Void
Table 6.2.11.3.3-6: Connect (Step 4, Table 6.2.11.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.12-1, condition PRIVATE-CALL,
WITHOUT_FLOORCONTROL
* * *
Table 6.2.11.3.3-7: Void
Table 6.2.11.3.3-8: SIP INVITE from the UE (Step 13, Table 6.2.11.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.35.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition PRIVATE-CALL,
MANUAL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP-Message as described in Table 6.2.11.3.3-9  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.11.3.3-9A
Table 6.2.11.3.3-9: SDP Message in SIP INVITE (Table 6.2.11.3.3-8)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition PRIVATE-CALL,
INITIAL_SDP_OFFER, WITHOUT_FLOORCONTROL
* * *
Table 6.2.11.3.3-9A: MCPTT-Info in SIP INVITE (Table 6.2.11.3.3-8)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE_REFER,
PRIVATE-CALL
* * *
Table 6.2.11.3.3-10: SIP 200 (OK) from the SS (step 13, Table 6.2.11.3.2-1;\
step 5, TS 36.579-1 [2] Table 5.3.35.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.2.11.3.3-9B
Table 6.2.11.3.3-11: SDP in SIP 200 (OK) (Table 6.2.11.3.3-3A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
WITHOUT_FLOORCONTROL
* * *
6.2.12 On-network / Private Call / Private Call Call-Back Request / Private
Call Call-Back Cancel Request / Client Originated (CO) / Private call call-
back fulfilment
##### 6.2.12.1 Test Purpose (TP) {#test-purpose-tp-55 .H6}
##### (1) {#section-166 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service and
authorized to initiate and receive private calls with manual commencement and
to request and cancel private call call-back }
ensure that {
**when** { the MCPTT User requests sending a private call call-back request to
a targeted user }
**then** { UE (MCPTT Client) sends a SIP MESSAGE message requesting the call-
back and including the MCPTT ID of the targeted MCPTT user, **and** , upon
receiving a SIP MESSAGE request for private call call-back response for
terminating client with an \ element in the
application/vnd.3gpp.mcptt-info+xml MIME body set to an MCPTT-ID matching a
\"PCCB requesting client entry\" stored on the client then the MCPTT client
sets the private call call-back requesting client state to \"PCCB-I3:
confirmed\" }
}
##### (2) {#section-167 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service and
authorized to initiate and receive private calls with manual commencement and
to request and cancel private call call-back, and, the MCPTT client private
call call-back requesting client state equal to \"PCCB-I3: confirmed\" }
ensure that {
**when** { the MCPTT User wants to cancel the private call call-back }
**then** { UE (MCPTT Client) sends a SIP MESSAGE message cancelling the call-
back and including the MCPTT ID of the targeted MCPTT user, **and** , upon
receiving a SIP MESSAGE request for private call call-back cancel response for
terminating client with an \ element in the
application/vnd.3gpp.mcptt-info+xml MIME body set to an MCPTT-ID matching a
\"PCCB requesting client entry\" stored on the client then the MCPTT client
sets the private call call-back requesting client state to \"PCCB-I1: no-call-
back\" }
}
##### (3) {#section-168 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service and
authorized to initiate and receive private calls with manual commencement and
to request and cancel private call call-back, and, the MCPTT client private
call call-back requesting client state equal to \"PCCB-I3: confirmed\" }
ensure that {
**when** { the UE (MCPTT Client) receives a request for private call
establishment from the target for a call-back MCPTT User (MCPTT-ID matching a
\"PCCB requesting client entry\") }
**then** { UE (MCPTT Client) upon sending a SIP 200 (OK) response to the
request for establishment of a private call, sets the private call call-back
requesting client state to \"PCCB-I1: no-call-back\" and shall delete the
\"PCCB requesting client entry\" associated with the target MCPTT user }
}
##### 6.2.12.2 Conformance requirements {#conformance-requirements-55 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.1.5.2.1, 11.1.5.2.3. Unless otherwise
stated these are Rel-14 requirements.
[TS 24.379, clause 11.1.5.2.1]
Upon receiving a request from the requesting MCPTT user to send a private call
call-back request or to send a private call call-back cancel request, that has
been authorised successfully by the requesting MCPTT client, the MCPTT client
shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and
IETF RFC 3428 [33] with the clarifications given below.
The MCPTT client:
> 1) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP MESSAGE request;
>
> 2) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 3) may include a P-Preferred-Identity header field in the SIP MESSAGE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> 4) shall set the Request-URI to the public service identity identifying the
> participating MCPTT function serving the MCPTT user;
>
> 5) shall include in an application/resource-lists+xml MIME body, the MCPTT
> ID of the targeted MCPTT user, according to rules and procedures of IETF RFC
> 5366 [20];
>
> 6) shall include an application/vnd.3gpp.mcptt-info+xml MIME body as
> specified in clause F.1 with the \ element containing the
> \ element with the \ element containing:
>
> a) if the request is a private call call-back request:
>
> i) the \ set to a value of \"private-call-call-back-request>;
>
> ii) the \ set to a value of \"low\", \"normal\" or \"high\" to
> indicate the urgency of the call-back request; and
>
> iii) the \ set to the date and time of the request using
> the format specified in clause F.1.3; and
>
> b) if the request is a private call call-back cancel request, the \ type> set to a value of \"private-call-call-back-cancel-request\";
>
> 7) shall store a \"PCCB requesting client entry\" containing the MCPTT ID of
> the targeted user and:
>
> a) if the request is a private call call-back request, shall set the private
> call call-back requesting client state to \"PCCB-I2: confirm-pending\"; and
>
> b) if the request is a private call call-back cancel request, shall set the
> private call call-back requesting client state to \"PCCB-I4: cancel-
> pending\"; and
>
> 8) shall send the SIP MESSAGE request according to rules and procedures of
> 3GPP TS 24.229 [4].
....
Upon receiving a \"SIP MESSAGE request for private call call-back response for
terminating client\" with an \ element in the
application/vnd.3gpp.mcptt-info+xml MIME body set to an MCPTT-ID matching a
\"PCCB requesting client entry\" stored on the client, if the private call
call-back requesting client state is set to \"PCCB-I2: confirm-pending\", then
the MCPTT client shall set the private call call-back requesting client state
to \"PCCB-I3: confirmed\".
Upon receiving a \"SIP MESSAGE request for private call call-back cancel
response for terminating client\" with an \ element in
the application/vnd.3gpp.mcptt-info+xml MIME body set to the an MCPTT-ID
matching a \"PCCB requesting client entry\" entry stored on the client, if the
private call call-back requesting client state is set to \"PCCB-I4: cancel-
pending\", then the MCPTT client set the private call call-back requesting
client state to \"PCCB-I1: no-call-back\" and shall delete the \"PCCB
requesting client entry\" associated with the target MCPTT user.
[TS 24.379, clause 11.1.5.2.3]
When the target MCPTT user wants to make a private call call-back, the target
MCPTT client shall initiate a private call in manual commencement mode towards
the requesting MCPTT client using the MCPTT ID of the requesting MCPTT user as
found in the \"PCCB target client entry\" stored on the UE, by following the
procedures in:
> ...
>
> 2) subclause 11.1.2.2 for private call without floor control;
Upon sending a SIP 200 (OK) response to the request for establishment of a
private call as specified in subclause 11.1.1.2.1.1, subclause 11.1.1.2.2.1 or
subclause 11.1.2.2, if the \"PCCB requesting client entry\" of the target
MCPTT user contains a private call call-back requesting client state set to
\"PCCB-I3: confirmed\", then the requesting MCPTT client shall set the private
call call-back requesting client state to \"PCCB-I1: no-call-back\" and shall
delete the \"PCCB requesting client entry\" associated with the target MCPTT
user.
##### 6.2.12.3 Test description {#test-description-55 .H6}
##### 6.2.12.3.1 Pre-test conditions {#pre-test-conditions-55 .H6}
##### System Simulator: {#system-simulator-55 .H6}
\- SS (MCPTT server)
\- For the underlining \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-55 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-55 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.12.3.2 Test procedure sequence {#test-procedure-sequence-55 .H6}
Table 6.2.12.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | private | | | | | | | call | | | | | | | call-back | | | | | | | request | | | | | | | for | | | | | | | targeted | | | | | | | user B. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2-3B | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-5 of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | Request - | | | | | | | Accept | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.30.3-1 | | | | | | | r | | | | | | | equesting | | | | | | | a private | | | | | | | call | | | | | | | call-back | | | | | | | providing | | | | | | | the MCPTT | | | | | | | ID of the | | | | | | | targeted | | | | | | | MCPTT | | | | | | | user? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | cancel | | | | | | | the | | | | | | | private | | | | | | | call | | | | | | | call-back | | | | | | | request | | | | | | | for | | | | | | | targeted | | | | | | | user B. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5-6A | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-5 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | Request - | | | | | | | Accept | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.30.3-1 | | | | | | | to cancel | | | | | | | the | | | | | | | private | | | | | | | call | | | | | | | c | | | | | | | all-back? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | cancel | | | | | | | the | | | | | | | private | | | | | | | call | | | | | | | call-back | | | | | | | request | | | | | | | for | | | | | | | targeted | | | | | | | user B. | | | | | | | | | | | | | | (NOTE 1, | | | | | | | NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Check: | --> | SIP | 2 | F | | | Does, in | | MESSAGE | | | | | the next | | | | | | | 5 sec, | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | message | | | | | | | c | | | | | | | ancelling | | | | | | | the | | | | | | | private | | | | | | | call | | | | | | | c | | | | | | | all-back? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The SS | | | | | | | releases | | | | | | | the RRC | | | | | | | co | | | | | | | nnection. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | private | | | | | | | call | | | | | | | call-back | | | | | | | request | | | | | | | for | | | | | | | targeted | | | | | | | user B. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | Request - | | | | | | | Accept | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.30.3-1 | | | | | | | r | | | | | | | equesting | | | | | | | a private | | | | | | | call | | | | | | | call-back | | | | | | | providing | | | | | | | the MCPTT | | | | | | | ID of the | | | | | | | targeted | | | | | | | MCPTT | | | | | | | user? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10A-11A | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 12 | Wait for | - | - | - | - | | | 5 sec | | | | | | | (randomly | | | | | | | chosen | | | | | | | value to | | | | | | | simulate | | | | | | | realistic | | | | | | | behaviour | | | | | | | at the | | | | | | | targeted | | | | | | | side). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | private | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | with | | | | | | | manual | | | | | | | comme | | | | | | | ncement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.6.3-1 | | | | | | | to | | | | | | | establish | | | | | | | an MCX | | | | | | | private | | | | | | | call | | | | | | | (private | | | | | | | call call | | | | | | | back | | | | | | | ful | | | | | | | filment)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 14-16 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 17-18 | Steps 1 | - | - | - | - | | | and 2 of | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.12.3-1 | | | | | | | are | | | | | | | performed | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 19 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | cancel | | | | | | | the | | | | | | | private | | | | | | | call | | | | | | | call-back | | | | | | | request | | | | | | | for | | | | | | | targeted | | | | | | | user B. | | | | | | | | | | | | | | (NOTE 1, | | | | | | | NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 20 | Check: | --> | SIP | 3 | F | | | Does, in | | MESSAGE | | | | | the next | | | | | | | 5 sec, | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | message | | | | | | | c | | | | | | | ancelling | | | | | | | the | | | | | | | private | | | | | | | call | | | | | | | c | | | | | | | all-back? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The SS | | | | | | | releases | | | | | | | the RRC | | | | | | | co | | | | | | | nnection. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Depending | | | | | | | on the | | | | | | | imple | | | | | | | mentation | | | | | | | the User | | | | | | | may not | | | | | | | be | | | | | | | provided | | | | | | | with an | | | | | | | entry for | | | | | | | pending | | | | | | | c | | | | | | | all-back. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 6.2.12.3.3 Specific message contents {#specific-message-contents-55 .H6}
Table 6.2.12.3.3-1: SIP MESSAGE from the UE (Steps 2, 10, Table 6.2.12.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition RESOURCE_LISTS
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.12.3.3-2
Table 6.2.12.3.3-2: MCPTT-Info in SIP MESSAGE (Table 6.2.12.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
anyExt  
request-type \"private-call-call-back-request\"  
urgency-ind \"low\", \"normal\" or \"high\"  
time-of-request \"YYYY-MM-DDThh:mm:ss\" set to the date and time of the
request
Table 6.2.12.3.3-3: SIP MESSAGE from the SS (Steps 3, 10, Table 6.2.12.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.12.3.3-4
Table 6.2.12.3.3-4: MCPTT-Info in SIP MESSAGE (Table 6.2.12.3.3-3)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
anyExt  
response-type \"private-call-call-back-response\"
Table 6.2.12.3.3-5: Void
Table 6.2.12.3.3-6: SIP MESSAGE from the UE (Step 5, Table 6.2.12.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition RESOURCE_LISTS
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.12.3.3-7
Table 6.2.12.3.3-7: MCPTT-Info in SIP MESSAGE (Table 6.2.12.3.3-6)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
anyExt  
request-type \"private-call-call-back-cancel-request\"
Table 6.2.12.3.3-8: SIP MESSAGE from the SS (Step 6, Table 6.2.12.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.12.3.3-9
Table 6.2.12.3.3-9: MCPTT-Info in SIP MESSAGE (Table 6.2.12.3.3-8)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
anyExt  
response-type \"private-call-call-back-cancel-response\"
Table 6.2.12.3.3-10: Void
Table 6.2.12.3.3-11: SIP INVITE from the SS (Step 13, Table 6.2.12.3.2-1;\
step 2, TS 36.579-1 [2], Table 5.3.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition MANUAL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP-Message**  
MIME-part-body SDP Message as described in Table 6.2.12.3.3-12  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.12.3.3-12B
Table 6.2.12.3.3-12: SDP Message in SIP INVITE (Table 6.2.12.3.3-11)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition
INITIAL_SDP_OFFER, PRIVATE-CALL, WITHOUT_FLOORCONTROL
* * *
Table 6.2.12.3.3-12B: MCPTT-Info in SIP INVITE (Table 6.2.12.3.3-11)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Table 6.2.12.3.3-13: SIP 200 (OK) from the UE (Step 13, Table 6.2.12.3.2-1;\
step 6, TS 36.579-1 [2], Table 5.3.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.12.3.3-14  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.12.3.3-14A
Table 6.2.12.3.3-14: SDP Message in SIP 200 (OK) (Table 6.2.12.3.3-13)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition SDP_ANSWER,
PRIVATE-CALL, WITHOUT_FLOORCONTROL
* * *
Table 6.2.12.3.3-14A: MCPTT-Info in SIP 200 (OK) (Table 6.2.12.3.3-13)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
Table 6.2.12.3.3-15: Void
6.2.13 On-network / Private Call / Private Call Call-Back Request / Private
Call Call-Back Cancel Request / Client Terminated (CT) / Private call call-
back fulfilment
##### 6.2.13.1 Test Purpose (TP) {#test-purpose-tp-56 .H6}
##### (1) {#section-169 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service and
authorized to initiate and receive private calls with manual commencement and
to request and cancel private call call-back }
ensure that {
**when** { the UE (MCPTT Client) receives a SIP MESSAGE message request for a
private call call-back request for terminating client }
**then** { UE (MCPTT Client) shall store a \"PCCB target client entry\" and
notify the user of the stored information related to the private call call
back request, **and** , send a SIP MESSAGE message response acknowledging the
request, including in an application/resource-lists+xml MIME body, the MCPTT
ID contained in the \ element in the application/
vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request }
}
##### (2) {#section-170 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service and
authorized to initiate and receive private calls with manual commencement and
to request and cancel private call call-back, **and** , the MCPTT client
having responded positively to a private call call-back request and set the
private call call-back receiving client state set to \"PCCB-R2: private-call-
pending\" }
ensure that {
**when** { the UE (MCPTT Client) receives a SIP MESSAGE message request for
private call call-back cancel request for terminating client where the \"PCCB
target client entry\" associated with the MCPTT ID in the \ element in the application/vnd.3gpp.mcptt-info+xml MIME body contains
a private call call-back requesting client state set to \"PCCB-R2: private-
call-pending\" }
**then** { UE (MCPTT Client) the MCPTT client shall set the private call call-
back requesting client state to \"PCCB-R1: no-call-back\" and shall delete the
\"PCCB target client entry\" associated with the requesting MCPTT user and
sends a SIP MESSAGE message acknowledging the cancelling of the call-back }
}
##### (3) {#section-171 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service and
authorized to initiate and receive private calls with manual commencement and
to request and cancel private call call-back, **and** , the MCPTT client
having responded positively to a private call call-back request and set the
private call call-back receiving client state set to \"PCCB-R2: private-call-
pending\" }
ensure that {
**when** { the target MCPTT user wants to make a private call call-back using
the MCPTT ID of the requesting MCPTT user as found in the \"PCCB target client
entry\" stored on the UE }
**then** { UE (MCPTT Client), the target MCPTT client, shall initiate a
private call in manual commencement mode towards the requesting MCPTT client,
**and** , upon receiving a SIP 2xx response to the SIP INVITE request for
establishment of the private call shall set the private call call-back target
client state to \"PCCB-R1: no-call-back\" and shall delete the \"PCCB target
client entry\" associated with the requesting MCPTT user }
}
##### 6.2.13.2 Conformance requirements {#conformance-requirements-56 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.1.5.2.2, 11.1.5.2.3. Unless otherwise
stated these are Rel-14 requirements.
[TS 24.379, clause 11.1.5.2.2]
Upon receiving a \"SIP MESSAGE request for private call call-back request for
terminating client\", the MCPTT client:
> 1) shall store a \"PCCB target client entry\" entry with:
>
> a) the MCPTT ID set to the MCPTT ID contained in the \ id> element in the application/vnd.3gpp.mcptt-info+xml MIME body;
>
> b) the private call call-back receiving client state set to \"PCCB-I2:
> private-call-pending\";
>
> c) the urgency set to the value of the \ element in the
> application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> d) the time-of-request set to the value of the \ element in
> the application/vnd.3gpp.mcptt-info+xml MIME body; and
>
> 2) shall notify the user of the stored information related to the private
> call call back request.
Upon receiving a \"SIP MESSAGE request for private call call-back cancel
request for terminating client\" where the \"PCCB target client entry\"
associated with the MCPTT ID in the \ element in the
application/vnd.3gpp.mcptt-info+xml MIME body contains a private call call-
back requesting client state set to \"PCCB-R2: private-call-pending\", the
MCPTT client shall set the private call call-back requesting client state to
\"PCCB-R1: no-call-back\" and shall delete the \"PCCB target client entry\"
associated with the requesting MCPTT user.
The MCPTT client:
> 1) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229
> [4] and IETF RFC 3428 [33]:
>
> 2) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP MESSAGE request;
>
> 3) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6] in the SIP MESSAGE request
>
> 4) may include a P-Preferred-Identity header field in the SIP MESSAGE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> 5) shall set the Request-URI in the SIP MESSAGE request to the public
> service identity identifying the participating MCPTT function serving the
> MCPTT user;
>
> 6) shall include in an application/resource-lists+xml MIME body, the MCPTT
> ID contained in the \ element in the application/
> vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request;
>
> 7) shall include an application/vnd.3gpp.mcptt-info+xml MIME body as
> specified in clause F.1 with the \ element containing the
> \ element with the \ element containing:
>
> a) if the received SIP MESSAGE was a \"SIP MESSAGE request for private call
> call-back request for terminating MCPTT client\", the \
> element set to a value of \"private-call-call-back-response\"; and
>
> b) if the received SIP MESSAGE was a \"SIP MESSAGE request for private call
> call-back cancel request for terminating MCPTT client\", the \ type> element set to a value of \"private-call-call-back-cancel-response\";
> and
>
> 8) shall send the SIP MESSAGE request according to rules and procedures of
> 3GPP TS 24.229 [4].
[TS 24.379, clause 11.1.5.2.3]
When the target MCPTT user wants to make a private call call-back, the target
MCPTT client shall initiate a private call in manual commencement mode towards
the requesting MCPTT client using the MCPTT ID of the requesting MCPTT user as
found in the \"PCCB target client entry\" stored on the UE, by following the
procedures in:
> ...
>
> 2) subclause 11.1.2.2 for private call without floor control;
...
Upon receiving a SIP 2xx response to the SIP INVITE request or SIP REFER
request for establishment of the private call, as specified in subclause
11.1.1.2.1.1, subclause 11.1.1.2.2.1 or subclause 11.1.2.2, if the \"PCCB
target client entry\" of the requesting MCPTT user contains a private call
call-back target client state set to \"PCCB-R2: private-call-pending\", then
the target MCPTT client shall set the private call call-back target client
state to \"PCCB-R1: no-call-back\" and shall delete the \"PCCB target client
entry\" associated with the requesting MCPTT user.
##### 6.2.13.3 Test description {#test-description-56 .H6}
##### 6.2.13.3.1 Pre-test conditions {#pre-test-conditions-56 .H6}
##### System Simulator: {#system-simulator-56 .H6}
\- SS (MCPTT server)
\- For the underlining \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-56 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-56 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.13.3.2 Test procedure sequence {#test-procedure-sequence-56 .H6}
Table 6.2.13.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | Request - | | | | | | | Accept | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.31.3-1 | | | | | | | r | | | | | | | equesting | | | | | | | a private | | | | | | | call | | | | | | | call-back | | | | | | | providing | | | | | | | the MCPTT | | | | | | | ID of the | | | | | | | UE (MCPTT | | | | | | | user) ? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | in | | | | | | | formation | | | | | | | related | | | | | | | to the | | | | | | | private | | | | | | | call call | | | | | | | back | | | | | | | request | | | | | | | to the | | | | | | | user | | | | | | | (mcpt | | | | | | | t-calling | | | | | | | -user-id, | | | | | | | call back | | | | | | | urgency, | | | | | | | time-of- | | | | | | | request)? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2-2A | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 3-4B | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-5 of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | Request - | | | | | | | Accept | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.31.3-1 | | | | | | | c | | | | | | | ancelling | | | | | | | the | | | | | | | private | | | | | | | call | | | | | | | call-back | | | | | | | providing | | | | | | | the MCPTT | | | | | | | ID of the | | | | | | | UE (MCPTT | | | | | | | user)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | cancel | | | | | | | the | | | | | | | private | | | | | | | call | | | | | | | call-back | | | | | | | request | | | | | | | of user B | | | | | | | (MCPTT ID | | | | | | | as | | | | | | | indicated | | | | | | | at step | | | | | | | 1A). | | | | | | | | | | | | | | (NOTE 1) | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Check: | --> | SIP | 2 | F | | | Does, in | | MESSAGE | | | | | the next | | | | | | | 5 sec, | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | message | | | | | | | c | | | | | | | ancelling | | | | | | | the | | | | | | | private | | | | | | | call | | | | | | | c | | | | | | | all-back? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The SS | | | | | | | releases | | | | | | | the RRC | | | | | | | co | | | | | | | nnection. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | Request - | | | | | | | Accept | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.31.3-1 | | | | | | | r | | | | | | | equesting | | | | | | | a private | | | | | | | call | | | | | | | call-back | | | | | | | providing | | | | | | | the MCPTT | | | | | | | ID of the | | | | | | | UE (MCPTT | | | | | | | user)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7A | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | in | | | | | | | formation | | | | | | | related | | | | | | | to the | | | | | | | private | | | | | | | call call | | | | | | | back | | | | | | | request | | | | | | | to the | | | | | | | user | | | | | | | (mcpt | | | | | | | t-calling | | | | | | | -user-id, | | | | | | | call back | | | | | | | urgency, | | | | | | | time-of- | | | | | | | request)? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8-8A | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The SS | | | | | | | releases | | | | | | | the RRC | | | | | | | co | | | | | | | nnection. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | private | | | | | | | call-back | | | | | | | call to | | | | | | | user B | | | | | | | (MCPTT ID | | | | | | | as | | | | | | | indicated | | | | | | | at step | | | | | | | 7A) | | | | | | | without | | | | | | | floor | | | | | | | control. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | private | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | with | | | | | | | manual | | | | | | | comme | | | | | | | ncement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.35.3-1 | | | | | | | **to | | | | | | | establish | | | | | | | a private | | | | | | | call with | | | | | | | manual | | | | | | | com | | | | | | | mencement | | | | | | | and | | | | | | | without | | | | | | | floor | | | | | | | c | | | | | | | ontrol**? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11-13 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 14 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15-16 | Steps 1 | - | - | - | - | | | and 2 of | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.10.3-1 | | | | | | | are | | | | | | | performed | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 17 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | cancel | | | | | | | the | | | | | | | private | | | | | | | call | | | | | | | call-back | | | | | | | request | | | | | | | of user B | | | | | | | (MCPTT ID | | | | | | | as | | | | | | | indicated | | | | | | | at step | | | | | | | 7A). | | | | | | | | | | | | | | (NOTE 1) | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 18 | Check: | --> | SIP | 3 | F | | | Does, in | | MESSAGE | | | | | the next | | | | | | | 5 sec, | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | message | | | | | | | c | | | | | | | ancelling | | | | | | | the | | | | | | | private | | | | | | | call | | | | | | | c | | | | | | | all-back? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The SS | | | | | | | releases | | | | | | | the RRC | | | | | | | co | | | | | | | nnection. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Depending | | | | | | | on the | | | | | | | imple | | | | | | | mentation | | | | | | | the User | | | | | | | may not | | | | | | | be | | | | | | | provided | | | | | | | with an | | | | | | | entry for | | | | | | | pending | | | | | | | c | | | | | | | all-back. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
Table 6.2.13.3.2-2: Void
##### 6.2.13.3.3 Specific message contents {#specific-message-contents-56 .H6}
Table 6.2.13.3.3-1: SIP MESSAGE from the SS (Steps 1, 7, Table 6.2.13.3.2-1;\
step 2, TS 36.579-1 [2], Table 5.3.31.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.13.3.3-2
Table 6.2.13.3.3-2: MCPTT-Info in SIP MESSAGE (Table 6.2.13.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
anyExt  
request-type \"private-call-call-back-request\"  
urgency-ind \"normal\"  
time-of-request \"YYYY-MM-DDThh:mm:ss\" set to the date and time of the
request
Table 6.2.13.3.3-3: SIP MESSAGE from the UE (Steps 1, 7, Table 6.2.13.3.2-1;\
step 4, TS 36.579-1 [2], Table 5.3.31.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition RESOURCE_LISTS
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.13.3.3-4  
MIME body part **Resource-lists**  
MIME-part-body Resource-lists as described in Table 6.2.13.3.3-5
Table 6.2.13.3.3-4: MCPTT-Info in SIP MESSAGE (Table 6.2.13.3.3-3)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
anyExt  
response-type \"private-call-call-back-response\"
Table 6.2.13.3.3-5: Resource-lists in SIP MESSAGE (Table 6.2.13.3.3-3)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.3.2-1
* * *
Information Element Value/remark Comment Reference Condition resource-lists  
list[1]  
entry[1]  
uri attribute MCPTT ID as contained in the \ element of
the MCPTT-Info sent in the SIP MESSAGE from the SS at steps 1, 7
Table 6.2.13.3.3-6: SIP MESSAGE from the SS (Step 3, Table 6.2.13.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.31.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.13.3.3-7
Table 6.2.13.3.3-7: MCPTT-Info in SIP MESSAGE (Table 6.2.13.3.3-6)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
anyExt  
request-type \"private-call-call-back-cancel-request\"
Table 6.2.13.3.3-8: SIP MESSAGE from the UE (Step 3, Table 6.2.13.3.2-1;\ step
4, TS 36.579-1 [2], Table 5.3.31.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition RESOURCE_LISTS
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.13.3.3-9  
MIME body part **Resource-lists**  
MIME-part-body Resource-lists as described in Table 6.2.13.3.3-10
Table 6.2.13.3.3-9: MCPTT-Info in SIP MESSAGE (Table 6.2.13.3.3-8)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
anyExt  
response-type \"private-call-call-back-cancel-response\"
Table 6.2.13.3.3-10: Resource-lists in SIP MESSAGE (Table 6.2.13.3.3-8)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.3.2-1
* * *
Information Element Value/remark Comment Reference Condition resource-lists  
list[1]  
entry[1]  
uri attribute MCPTT ID as contained in the \ element of
the MCPTT-Info sent in the SIP MESSAGE from the SS at step 3
Table 6.2.13.3.3-11: SIP INVITE from the UE (Step 10, Table 6.2.13.3.2-1;\
step 2, TS 36.579-1 [2], Table 5.3.35.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition PRIVATE-CALL,
MANUAL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP-Message**  
MIME-part-body SDP-Message as described in Table 6.2.13.3.3-12  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.13.3.3-12A
Table 6.2.13.3.3-12: SDP Message in SIP INVITE (Table 6.2.13.3.3-11)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition PRIVATE-CALL,
INITIAL_SDP_OFFER, WITHOUT_FLOORCONTROL
* * *
Table 6.2.13.3.3-12A: MCPTT-Info in SIP INVITE (Table 6.2.13.3.3-11)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE_REFER,
PRIVATE-CALL
* * *
Table 6.2.13.3.3-13: SIP 200 (OK) from the SS (Step 10, Table 6.2.13.3.2-1;\
step 5, TS 36.579-1 [2], Table 5.3.35.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.2.13.3.3-14
Table 6.2.13.3.3-14: SDP Message in SIP 200 (OK) (Table 6.2.13.3.3-13)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
WITHOUT_FLOORCONTROL
* * *
Table 6.2.13.3.3-15: Void
6.2.14 On-network / Private Call / Ambient listening call / Remotely initiated
Ambient listening call / Remotely initiated ambient listening call release /
Success / Client Originated (CO) / Server initiated ambient call release
##### 6.2.14.1 Test Purpose (TP) {#test-purpose-tp-57 .H6}
##### (1) {#section-172 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate Remotely initiated ambient listening }
ensure that {
**when** { UE (MCPTT User) requests the establishment of a remotely initiated
ambient listening call }
**then** { UE (MCPTT Client) sends a SIP INVITE message (end-to-end security
context provided) requesting the establishment of a remotely initiated ambient
listening call, **and** , after indication from the MCPTT Server that the call
was established notifies the MCPTT user, and does not do any floor request }
}
##### (2) {#section-173 .H6}
**with** { UE (MCPTT Client) having initiated a remotely initiated ambient
listening call, and, having been notified by the server that the MCPTT server
is capable of receiving a SIP BYE from an MCPTT client to release an ambient-
listening call }
ensure that {
**when** { UE (MCPTT User) wants to release the MCPTT remotely initiated
ambient listening call }
**then** { UE (MCPTT Client) sends a SIP BYE request and after receiving a SIP
200 (OK) terminates the call }
}
##### (3) {#section-174 .H6}
**with** { UE (MCPTT Client) having initiated a remotely initiated ambient
listening call }
ensure that {
**when** { UE (MCPTT client) receives a SIP BYE message including a \ element set to \"administrator-action\" }
**then** { UE (MCPTT Client) sends a SIP 200 (OK) response and terminates the
call }
}
##### 6.2.14.2 Conformance requirements {#conformance-requirements-57 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.1.6.2.1.1, 11.1.6.2.1.3, 11.1.6.2.1.4,
6.2.1, 6.4, F.1.3. Unless otherwise stated these are Rel-14 requirements.
[TS 24.379, clause 11.1.6.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT ambient
listening call that has been authorised successfully by the requesting MCPTT
client, the MCPTT client shall generate an initial SIP INVITE request by
following the UE originating session procedures specified in 3GPP TS 24.229
[4], with the clarifications given below.
The MCPTT client:
> 1) shall set the Request-URI of the SIP INVITE request to a public service
> identity of the participating MCPTT function serving the MCPTT user;
>
> 2) may include a P-Preferred-Identity header field in the SIP INVITE request
> containing a public user identity as specified in 3GPP TS 24.229 [4];
>
> 3) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 4) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 5) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 6) shall include an Accept-Contact header field with the media feature tag
> g.3gpp.icsi-ref contain with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\"
> according to IETF RFC 3841 [6];
>
> 7) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element set to a value of \"ambient-listening\";
>
> 8) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body an
> \ element set to a value of:
>
> ...
>
> b) \"remote-init\", if the MCPTT user has requested a remotely initiated
> ambient listening call;
>
> 9) shall insert in the SIP INVITE request a MIME resource-lists body with
> the MCPTT ID of the targeted MCPTT user, according to rules and procedures
> of IETF RFC 5366 [20];
>
> NOTE 1: the targeted MCPTT user is the listened-to MCPTT user in the case of
> a remotely initiated ambient listening call or the listening MCPTT user in
> the case of a locally initiated listening call.
>
> 10) if an end-to-end security context needs to be established then:
>
> a) if necessary, shall instruct the key management client to request keying
> material from the key management server as described in 3GPP TS 33.180 [78];
>
> b) shall use the keying material to generate a PCK as described in 3GPP TS
> 33.180 [78];
>
> c) shall use the PCK to generate a PCK-ID with the four most significant
> bits set to \"0001\" to indicate that the purpose of the PCK is to protect
> private call communications and with the remaining twenty eight bits being
> randomly generated as described in 3GPP TS 33.180 [78];
>
> d) shall encrypt the PCK to a UID associated to the MCPTT client using the
> MCPTT ID and KMS URI of the invited user and a time related parameter as
> described in 3GPP TS 33.180 [78];
>
> e) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and
> PCK-ID as specified in 3GPP TS 33.180 [78];
>
> f) shall add the MCPTT ID of the originating MCPTT to the initiator field
> (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]; and
>
> g) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user\'s
> signing key provided in the keying material together with a time related
> parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
> 33.180 [78];
>
> 11) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarification given in subclause 6.2.1 and with a media stream of the
> offered media-floor control entity;
>
> ...
>
> 13) if this is a remotely initiated ambient listening call, shall comply
> with the conditions for an implicit request to grant the floor to the
> terminating MCPTT client as specified in subclause 6.4;
>
> 14) shall include in the SIP INVITE request a Priv-Answer-Mode header field
> with the value \"Auto\" according to the rules and procedures of IETF RFC
> 5373 [18]; and
>
> 15) shall send the SIP INVITE request towards the participating MCPTT
> function according to 3GPP TS 24.229 [4].
...
Upon receiving a SIP 200 (OK) response to the SIP INVITE request the MCPTT
client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) if this is a remotely initiated ambient listening call, shall notify the
> user that the call has been successfully established;
[TS 24.379, clause 11.1.6.2.1.3]
Upon receiving a request from an MCPTT user to release an MCPTT ambient
listening call:
The MCPTT client:
> ...
>
> 2) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 3) shall generate a SIP BYE request according to rules and procedures of
> 3GPP TS 24.229 [4] and IETF RFC 6086 [64]; and
>
> 4) shall send the SIP BYE request within the dialog of the MCPTT ambient
> call session as specified in 3GPP TS 24.229 [4].
Upon receipt of the SIP 200 (OK) response to the SIP BYE request the MCPTT
client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
[TS 24.379, clause 11.1.6.2.1.4]
Upon receipt of a SIP BYE request in the dialog of an ambient listening
session, the MCPTT client:
> 1) shall comply with the procedures of subclause 6.2.6;
[TS 24.379, clause 6.2.1]
The SDP offer shall contain only one SDP media-level section for MCPTT speech
according to 3GPP TS 24.229 [4] and, if floor control shall be used during the
session, shall contain one SDP media-level section for a media-floor control
entity according to 3GPP TS 24.380 [5].
When composing an SDP offer according to 3GPP TS 24.229 [4] the MCPTT client:
> ...
>
> 2) shall include an \"m=audio\" media-level section for the MCPTT media
> stream consisting of:
>
> ...
>
> c) if the SDP offer is for an ambient listening call:
>
> i) if this is a remotely initiated ambient listening call, include an
> \"a=recvonly\" attribute; or
[TS 24.379, clause 6.4]
An initial SIP INVITE request fulfilling the following criteria shall be
regarded by the MCPTT server as an implicit request to grant the floor to the
terminating MCPTT client when the originating MCPTT client:
> 1) initiates a remotely initiated MCPTT ambient listening call; and
>
> 2) includes the \"mc_implicit_request\" \'fmtp\' attribute in the associated
> UDP stream for the floor control in the SDP offer/answer as specified in
> 3GPP TS 24.380 [5] clause 12.
[TS 24.379, clause F.1.3]
If the \ contains the \ element then:
> ...
>
> 2) the \ can be included with:
>
> ...
>
> e) a value of \"ambient-listening\" to indicate the MCPTT client wants to
> make an ambient listening call;
>
> ...
>
> 19) the \ can be included with the following elements not declared
> in the XML schema:
>
> a) an \ of type \"xs:string\":
>
> i) set to a value of \"remote-init\" when the listening MCPTT user of an
> ambient listening call initiates the call; or
##### 6.2.14.3 Test description {#test-description-57 .H6}
##### 6.2.14.3.1 Pre-test conditions {#pre-test-conditions-57 .H6}
##### System Simulator: {#system-simulator-57 .H6}
\- SS (MCPTT server)
\- For the underlining \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-57 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-57 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The MCPTT user is authorized to initiate remotely initiated ambient
listening: the \ element of
the \ element is present in the MCPTT user profile document and is
set to \"true\"
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.14.3.2 Test procedure sequence {#test-procedure-sequence-57 .H6}
Table 6.2.14.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | remotely | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call to | | | | | | | user B. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.1.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a | | | | | | | remotely | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call | | | | | | | without | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | a of NOTE | | | | | | | 1 in TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3A.1.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 4 | The SS | \ | Floor | 1 | F | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | in the | | | | | | | next 5 | | | | | | | sec? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3.10.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9-10 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 11 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | remotely | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call to | | | | | | | user B. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.1.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a | | | | | | | remotely | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call | | | | | | | without | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | a of NOTE | | | | | | | 1 in TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3A.1.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 14 | The SS | \ ...
>
> 3) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
> attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
> I_MESSAGE:
>
> a) shall extract the MCPTT ID of the originating MCPTT from the initiator
> field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];
>
> b) shall convert the MCPTT ID to a UID as described in 3GPP TS 33.180 [78];
>
> c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE
> as described in 3GPP TS 33.180 [78];
>
> d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
> reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response
> as specified in IETF RFC 4567 [47], and include warning text set to \"136
> authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header
> field as specified in subclause 4.4; and
>
> e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
>
> i) shall extract and decrypt the encapsulated PCK using the terminating
> user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and
>
> ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS
> 33.180 [78];
>
> NOTE 1: With the PCK successfully shared between the originating MCPTT
> client and the terminating MCPTT client, both clients are able to use
> SRTP/SRTCP to create an end-to-end secure session.
>
> ...
>
> 6) shall perform the automatic commencement procedures specified in
> subclause 6.2.3.1.1;
>
> ...
>
> 8) if the received SIP INVITE request includes an alert-info header field as
> specified in IETF RFC 3261 [24] and as updated by IETF RFC 7462 [77] set to
> a value of \"\\" shall not give any indication of the
> progress of the call to the MCPTT user;
>
> NOTE 3: The alert-info header field having the value of
> \"\\" is intended to result in having a \"null\" alert,
> i.e. an alert with no content or physical manifestation of any kind.
[TS 24.379, clause 11.1.6.2.1.4]
Upon receipt of a SIP BYE request in the dialog of an ambient listening
session, the MCPTT client:
> 1) shall comply with the procedures of subclause 6.2.6;
>
> 2) if the cached ambient listening client role is equal to \"listened-to
> MCPTT user\", shall provide no indication that an ambient listening call has
> been terminated;
[TS 24.379, clause 6.2.3.1.1]
When performing the automatic commencement mode procedures, the MCPTT client:
> 1) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
> according to rules and procedures of 3GPP TS 24.229 [4];
>
> 2) shall include the option tag \"timer\" in a Require header field of the
> SIP 200 (OK) response;
>
> 3) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 200 (OK) response;
>
> 4) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 200 (OK) response;
>
> ...
>
> 8) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4];
>
> ...
>
> 10) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
> subclause 6.2.
[TS 24.379, clause 6.2.6]
Upon receiving a SIP BYE request, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall send SIP 200 (OK) response towards MCPTT server according to 3GPP
> TS 24.229 [4].
##### 6.2.15.3 Test description {#test-description-58 .H6}
##### 6.2.15.3.1 Pre-test conditions {#pre-test-conditions-58 .H6}
##### System Simulator: {#system-simulator-58 .H6}
\- SS (MCPTT server)
\- For the underlining \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-58 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-58 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.15.3.2 Test procedure sequence {#test-procedure-sequence-58 .H6}
Table 6.2.15.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5\. | | | | | | | 3.4.3-1** | | | | | | | to | | | | | | | establish | | | | | | | a | | | | | | | remotely | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 3 | The SS | \\"  
**Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP Message as described in Table 6.2.15.3.3-3  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.15.3.3-2
Table 6.2.15.3.3-2: MCPTT-Info in SIP INVITE (Table 6.2.15.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
session-type \"ambient-listening\"  
anyExt  
ambient-listening-type \"remote-init\"
Table 6.2.15.3.3-3: SDP Message in SIP INVITE (Table 6.2.15.3.3-1)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.3.1.2-1, | | | | | | condition | | | | | | P | | | | | | RIVATE-CALL, | | | | | | INITIAL | | | | | | _SDP_OFFER | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | | Media | | | | descri | | description | | | | ption[1]** | | for audio | | | +--------------+--------------+--------------+-----------+-----------+ | **media | | a=line | | | | attribute** | | | | | | | | attrib | | | | | | ute=recvonly | | | +--------------+--------------+--------------+-----------+-----------+ | recvonly | | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.2.15.3.3-3A: SIP 200 (OK) from the UE (Step 2, Table 6.2.15.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP Message as described in Table 6.2.15.3.3-3B  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.2.15.3.3-3C
Table 6.2.15.3.3-3B: SDP Message in SIP 200 OK (Table 6.2.15.3.3-3A)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.3.1.1-1, | | | | | | condition | | | | | | SDP_ANSWER | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | | Media | | | | descri | | description | | | | ption[1]** | | for audio | | | +--------------+--------------+--------------+-----------+-----------+ | **media | | a=line | | | | attribute** | | | | | | | | attrib | | | | | | ute=sendonly | | | +--------------+--------------+--------------+-----------+-----------+ | sendonly | | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.2.15.3.3-3C: MCPTT-Info in SIP 200 (OK) (Table 6.2.15.3.3-3A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
Table 6.2.15.3.3-4..5: Void
6.2.16 On-network / Private Call / Ambient listening call / Locally initiated
Ambient listening call / Locally initiated ambient listening call release /
Success / Client Originated (CO) / Server initiated ambient call release
##### 6.2.16.1 Test Purpose (TP) {#test-purpose-tp-59 .H6}
##### (1) {#section-177 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate Locally initiated ambient listening }
ensure that {
**when** { the MCPTT User requests the establishment of a MCPTT Locally
initiated ambient listening call }
**then** { UE (MCPTT Client) sends a SIP INVITE message requesting the
establishment of a locally initiated ambient listening call, **and** , upon
indication from the MCPTT Server for the call progress and that the call was
established does not notify the user }
}
##### (2) {#section-178 .H6}
**with** { UE (MCPTT Client) having initiated a locally initiated ambient
listening call, and, having been notified by the server that the MCPTT server
is capable of receiving a SIP BYE from an MCPTT client to release an ambient-
listening call }
ensure that {
**when** { the MCPTT User wants to release the MCPTT locally initiated ambient
listening call }
**then** { UE (MCPTT Client) sends a SIP BYE request and after receiving a SIP
200 (OK) terminates the call }
}
##### (3) {#section-179 .H6}
**with** { UE (MCPTT Client) having initiated a locally initiated ambient
listening call }
ensure that {
**when** { the UE (MCPTT client) receives a SIP BYE message including a
\ element set to \"administrator-action\" }
**then** { UE (MCPTT Client) sends a SIP 200 (OK) response and terminates the
call }
}
##### 6.2.16.2 Conformance requirements {#conformance-requirements-59 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.1.6.2.1.1, 11.1.6.2.1.3, 11.1.6.2.1.4,
6.2.1, 6.2.4.2.2, 6.4, F.1.3, TS 24.380, clause 12.1.2.2. Unless otherwise
stated these are Rel-14 requirements.
[TS 24.379, clause 11.1.6.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT ambient
listening call that has been authorised successfully by the requesting MCPTT
client, the MCPTT client shall generate an initial SIP INVITE request by
following the UE originating session procedures specified in 3GPP TS 24.229
[4], with the clarifications given below.
The MCPTT client:
> 1) shall set the Request-URI of the SIP INVITE request to a public service
> identity of the participating MCPTT function serving the MCPTT user;
>
> 2) may include a P-Preferred-Identity header field in the SIP INVITE request
> containing a public user identity as specified in 3GPP TS 24.229 [4];
>
> 3) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 4) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 5) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 6) shall include an Accept-Contact header field with the media feature tag
> g.3gpp.icsi-ref contain with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\"
> according to IETF RFC 3841 [6];
>
> 7) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element set to a value of \"ambient-listening\";
>
> 8) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body an
> \ element set to a value of:
>
> a) \"local-init\", if the MCPTT user has requested a locally initiated
> ambient listening call; or
>
> ...
>
> 9) shall insert in the SIP INVITE request a MIME resource-lists body with
> the MCPTT ID of the targeted MCPTT user, according to rules and procedures
> of IETF RFC 5366 [20];
>
> NOTE 1: the targeted MCPTT user is the listened-to MCPTT user in the case of
> a remotely initiated ambient listening call or the listening MCPTT user in
> the case of a locally initiated listening call.
>
> 10) if an end-to-end security context needs to be established then:
>
> a) if necessary, shall instruct the key management client to request keying
> material from the key management server as described in 3GPP TS 33.180 [78];
>
> b) shall use the keying material to generate a PCK as described in 3GPP TS
> 33.180 [78];
>
> c) shall use the PCK to generate a PCK-ID with the four most significant
> bits set to \"0001\" to indicate that the purpose of the PCK is to protect
> private call communications and with the remaining twenty eight bits being
> randomly generated as described in 3GPP TS 33.180 [78];
>
> d) shall encrypt the PCK to a UID associated to the MCPTT client using the
> MCPTT ID and KMS URI of the invited user and a time related parameter as
> described in 3GPP TS 33.180 [78];
>
> e) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and
> PCK-ID as specified in 3GPP TS 33.180 [78];
>
> f) shall add the MCPTT ID of the originating MCPTT to the initiator field
> (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]; and
>
> g) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user\'s
> signing key provided in the keying material together with a time related
> parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
> 33.180 [78];
>
> 11) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarification given in subclause 6.2.1 and with a media stream of the
> offered media-floor control entity;
>
> 12) if this is a locally initiated ambient listening call, shall comply with
> the conditions for implicit floor control as specified in subclause 6.4;
>
> ...
>
> 14) shall include in the SIP INVITE request a Priv-Answer-Mode header field
> with the value \"Auto\" according to the rules and procedures of IETF RFC
> 5373 [18]; and
>
> 15) shall send the SIP INVITE request towards the participating MCPTT
> function according to 3GPP TS 24.229 [4].
Upon receiving a SIP 183(Session Progress) response to the SIP INVITE request
the MCPTT client:
> 1) if the SIP 183(Session Progress) response includes an alert-info header
> field as specified in IETF RFC 3261 [24] and as updated by IETF RFC 7462
> [77] set to a value of
> \"\\" shall not give
> any indication of the progress of the call setup to the MCPTT user; and
>
> NOTE 2: The alert-info header field having the value of
> \"\\" is intended to
> result in having a \"null\" alert, i.e. an alert with no content or physical
> manifestation of any kind.
>
> ...
Upon receiving a SIP 200 (OK) response to the SIP INVITE request the MCPTT
client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> ...
>
> 3) if this is a locally initiated ambient listening call, shall not provide
> any indication to the user that the call has been successfully established;
[TS 24.379, clause 11.1.6.2.1.3]
Upon receiving a request from an MCPTT user to release an MCPTT ambient
listening call:
The MCPTT client:
> ...
>
> 2) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 3) shall generate a SIP BYE request according to rules and procedures of
> 3GPP TS 24.229 [4] and IETF RFC 6086 [64]; and
>
> 4) shall send the SIP BYE request within the dialog of the MCPTT ambient
> call session as specified in 3GPP TS 24.229 [4].
Upon receipt of the SIP 200 (OK) response to the SIP BYE request the MCPTT
client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> ...
>
> 3) if the cached ambient listening client role is equal to \"listening MCPTT
> user\", may provide an indication to the MCPTT user that the ambient
> listening call has been terminated; and
[TS 24.379, clause 11.1.6.2.1.4]
Upon receipt of a SIP BYE request in the dialog of an ambient listening
session, the MCPTT client:
> 1) shall comply with the procedures of subclause 6.2.6;
>
> ...
>
> 3) if the cached ambient listening client role is equal to \"listening MCPTT
> user\", may provide an indication to the MCPTT user that the ambient
> listening call has been terminated; and
[TS 24.379, clause 6.2.1]
The SDP offer shall contain only one SDP media-level section for MCPTT speech
according to 3GPP TS 24.229 [4] and, if floor control shall be used during the
session, shall contain one SDP media-level section for a media-floor control
entity according to 3GPP TS 24.380 [5].
When composing an SDP offer according to 3GPP TS 24.229 [4] the MCPTT client:
> ...
>
> 2) shall include an \"m=audio\" media-level section for the MCPTT media
> stream consisting of:
>
> ...
>
> c) if the SDP offer is for an ambient listening call:
>
> ...
>
> ii) if this is a locally initiated ambient listening call, include an
> \"a=sendonly\" attribute; and
[TS 24.379, clause 6.2.4.2.2]
When a call is initiated as described in 3GPP TS 24.379 [2], the floor
participant:
> 1\. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\';
>
> ...
>
> 4\. if for the established MCPTT call the SIP INVITE request is an implicit
> floor request:
>
> a. shall start timer T101 (Floor Request) and initialise counter C101 (Floor
> Request) to 1;
>
> b. shall enter the \'U: pending Request\' state; and
[TS 24.379, clause 6.4]
An initial SIP INVITE request fulfilling the following criteria shall be
regarded by the MCPTT server as an implicit floor request by the originating
MCPTT client when the MCPTT client:
> 1) initiates an MCPTT speech session or initiates a pre-established session
> that is not used for a remotely initiated MCPTT ambient listening call; and
>
> 2) includes the \"mc_implicit_request\" \'fmtp\' attribute in the associated
> UDP stream for the floor control in the SDP offer/answer as specified in
> 3GPP TS 24.380 [5] clause 12.
[TS 24.380, clause 12.1.2.2]
In an SDP offer, the \"mc_granted\" fmtp attribute parameter indicates that
the offeror supports the procedure where the answerer indicates, using the
fmtp attribute in the associated SDP answer, that the floor has been granted
to the offeror.
> NOTE 2: When the \"mc_granted\" fmtp attribute is used in an SDP offer, it
> does not indicate an actual request for the floor. The SDP
> \"mc_implicit_request\" fmtp attribute can be used to request the floor. In
> an SDP answer, the attribute indicates that the floor has been granted to
> the offeror.
>
> NOTE 3: Once the offeror has been granted the floor, the offeror has the
> floor until it receives a Floor Revoke message, or until the offeror itself
> releases the floor by sending a Floor Release message, as described in the
> present specification.
In an SDP offer, the \"mc_implicit_request\" fmtp attribute indicates that the
offeror implicitly requests the floor (without the need to send a Floor
Request message). In an SDP answer, the attribute parameter indicates that the
answerer has accepted the implicit floor request. Once the answerer grants the
floor to the offeror, the answerer will send a Floor Granted message.
> NOTE 4: The usage of the \"mc_implicit_request\" fmtp attribute in an SDP
> answer does not mean that the answerer has granted the floor to the offeror,
> only that the answerer has accepted the implicit floor request.
[TS 24.379, clause F.1.3]
If the \ contains the \ element then:
> ...
>
> 2) the \ can be included with:
>
> ...
>
> e) a value of \"ambient-listening\" to indicate the MCPTT client wants to
> make an ambient listening call;
>
> ...
>
> 19) the \ can be included with the following elements not declared
> in the XML schema:
>
> a) an \ of type \"xs:string\":
>
> ...
>
> ii) set to a value of \"local-init\" when the listened-to MCPTT user of an
> ambient listening call initiates the call; and
##### 6.2.16.3 Test description {#test-description-59 .H6}
##### 6.2.16.3.1 Pre-test conditions {#pre-test-conditions-59 .H6}
##### System Simulator: {#system-simulator-59 .H6}
\- SS (MCPTT server)
\- For the underlining \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-59 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-59 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The MCPTT User is authorized to initiate locally initiated ambient
listening call: the \
element of the \ element is present in the MCPTT user profile
document and is set to \"true\"
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.16.3.2 Test procedure sequence {#test-procedure-sequence-59 .H6}
Table 6.2.16.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a | | | | | | | locally | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call to | | | | | | | user B. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | ** | | | | | | | 5.3A.1.3-1 | | | | | | | to**| | | | | | | establish | | | | | | | a locally | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call with | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.i of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.1.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 3-6 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 1 | F | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the | | | | | | | locally | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call has | | | | | | | been | | | | | | | es | | | | | | | tablished? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 9 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 9A | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.10.3-1 | | | | | | | ? | | | | | +------------+------------+------------+---------+---------+----+ | 11-12 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 13 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a | | | | | | | locally | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call to | | | | | | | user B. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 14 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT CO | | | | | | | session | | | | | | | establ | | | | | | | ishment/mo | | | | | | | dification | | | | | | | without | | | | | | | p | | | | | | | rovisional | | | | | | | responses | | | | | | | other than | | | | | | | 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | |** 5\. | | | | | | | 3A.1.3-1** | | | | | | | to | | | | | | | establish | | | | | | | a locally | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call with | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.i of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3A.1.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 15-18 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 19 | Check: | - | - | - | - | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.12.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 20-21 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Void | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.16.3.3 Specific message contents {#specific-message-contents-59 .H6}
Table 6.2.16.3.3-1: SIP INVITE from the UE (Steps 2, 14, Table 6.2.16.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition **Answer-Mode**
**not present**  
**Priv-Answer-Mode**  
answer-mode-value \"Auto\"  
answer-mode-param _"_ require"  
**Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.16.3.3-3  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.16.3.3-2
Table 6.2.16.3.3-2: MCPTT-Info in SIP INVITE (Table 6.2.16.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition PRIVATE-CALL,
INVITE_RFEER
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
session-type \"ambient-listening\"  
anyExt  
ambient-listening-type \"local-init\"
Table 6.2.16.3.3-3: SDP Message in SIP INVITE (Table 6.2.16.3.3-1)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.3.1.1-1, | | | | | | condition | | | | | | P | | | | | | RIVATE-CALL, | | | | | | INITIAL\ | | | | | | _SDP_OFFER, | | | | | | IM | | | | | | PLICIT_GRAN | | | | | | T_REQUESTED | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | | Media | | | | descri | | description | | | | ption[1]** | | for audio | | | +--------------+--------------+--------------+-----------+-----------+ | **media | | a=line | | | | attribute** | | | | | | | | attrib | | | | | | ute=sendonly | | | +--------------+--------------+--------------+-----------+-----------+ | sendonly | | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.2.16.3.3-4: SIP 200 (OK) from the SS (Steps 2, 14, Table
6.2.16.3.2-1;\ Step 4, TS 36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Feature-Caps**  
fcap-name \"g.3gpp.mcptt.ambient-listening-call-release\" Indicates that the
MCPTT server is capable of receiving a SIP BYE from an MCPTT client to release
an ambient-listening call  
**Message-body**  
SDP Message As described in Table 6.2.16.3.3-4A
Table 6.2.16.3.3-4A: SDP in SIP 200 (OK) (Table 6.2.16.3.3-4)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.3.1.2-1, | | | | | | condition | | | | | | SDP_ANSWER, | | | | | | IMP | | | | | | LICIT_GRANT | | | | | | _REQUESTED, | | | | | | IMPLICIT_FL | | | | | | OOR_GRANTED | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | | Media | | | | descri | | description | | | | ption[1]** | | for audio | | | +--------------+--------------+--------------+-----------+-----------+ | **media | | a=line | | | | attribute** | | | | | | | | attrib | | | | | | ute=recvonly | | | +--------------+--------------+--------------+-----------+-----------+ | recvonly | | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.2.16.3.3-5..6: Void
Table 6.2.16.3.3-7: SIP BYE from the SS (Step 19, Table 6.2.16.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3.12.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1, condition MO_CALL
* * *
Information Element Value/remark Comment Reference Condition **Content-Type**  
media-type \"multipart/mixed\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-info+xml\"  
Content-ID Unique id in format of a Message-ID assigned by the SS  
MIME-part-body MCPTT-Info as described in Table 6.2.16.3.3-8  
MIME body part **Signature**  
MIME-part-headers  
MIME-Content-Type \"application/vnd.3gpp.mcptt-signed+xml\"  
MIME-part-body Signatures for XML MIME bodies as described in TS 36.579-1 [2]
Table 5.5.13.1-2
Table 6.2.16.3.3-8: MCPTT-Info in SIP BYE (Table 6.2.16.3.3-7)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
anyExt  
release-reason \"administrator-action\"
6.2.17 On-network / Private Call / Ambient listening call / Locally initiated
Ambient listening call / Locally initiated ambient listening call release /
Success / Client Terminated (CT)
##### 6.2.17.1 Test Purpose (TP) {#test-purpose-tp-60 .H6}
##### (1) {#section-180 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to receive private calls }
ensure that {
**when** { the UE (MCPTT Client) receives a request for establishment of an
MCPTT locally initiated ambient listening call the SDP offer of the SIP INVITE
request contains an \"a=key-mgmt\" attribute field with a \"mikey\" attribute
value containing a MIKEY-SAKKE I_MESSAGE }
**then** { UE (MCPTT Client) sends a SIP 200 (OK) accepting the establishment
of the MCPTT locally initiated ambient listening call applying End-to-end
communication security and does not do any floor request }
}
##### (2) {#section-181 .H6}
**with** { UE (MCPTT Client) having accepted a locally initiated ambient
listening call }
ensure that {
**when** { the UE (MCPTT Client) receives a SIP BYE request for release of the
MCPTT locally initiated ambient listening call }
**then** { UE (MCPTT Client) sends a SIP 200 (OK) response and terminates the
call }
}
##### 6.2.17.2 Conformance requirements {#conformance-requirements-60 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.1.6.2.1.2, 11.1.6.2.1.4, 6.2.3.1.1, 6.2.6.
Unless otherwise stated these are Rel-14 requirements.
[TS 24.379, clause 11.1.6.2.1.2]
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> ...
>
> 3) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
> attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
> I_MESSAGE:
>
> a) shall extract the MCPTT ID of the originating MCPTT from the initiator
> field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];
>
> b) shall convert the MCPTT ID to a UID as described in 3GPP TS 33.180 [78];
>
> c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE
> as described in 3GPP TS 33.180 [78];
>
> d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
> reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response
> as specified in IETF RFC 4567 [47], and include warning text set to \"136
> authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header
> field as specified in subclause 4.4; and
>
> e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
>
> i) shall extract and decrypt the encapsulated PCK using the terminating
> user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and
>
> ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS
> 33.180 [78];
>
> NOTE 1: With the PCK successfully shared between the originating MCPTT
> client and the terminating MCPTT client, both clients are able to use
> SRTP/SRTCP to create an end-to-end secure session.
>
> ...
>
> 6) shall perform the automatic commencement procedures specified in
> subclause 6.2.3.1.1;
[TS 24.379, clause 11.1.6.2.1.4]
Upon receipt of a SIP BYE request in the dialog of an ambient listening
session, the MCPTT client:
> 1) shall comply with the procedures of subclause 6.2.6;
[TS 24.379, clause 6.2.3.1.1]
When performing the automatic commencement mode procedures, the MCPTT client:
> 1) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
> according to rules and procedures of 3GPP TS 24.229 [4];
>
> 2) shall include the option tag \"timer\" in a Require header field of the
> SIP 200 (OK) response;
>
> 3) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 200 (OK) response;
>
> 4) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 200 (OK) response;
>
> ...
>
> 8) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4];
>
> ...
>
> 10) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
> subclause 6.2.
[TS 24.379, clause 6.2.4.2.3]
When an MCPTT call is established, the terminating floor participant:
> 1\. shall create an instance of a \'Floor participant state transition
> diagram for basic operation\'; and
>
> 2\. shall enter the \'U: has no permission\' state.
>
> NOTE: From a floor participant perspective the MCPTT call is established
> when the application and signalling plane sends the SIP 200 (OK) response.
[TS 24.379, clause 6.2.6]
Upon receiving a SIP BYE request, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall send SIP 200 (OK) response towards MCPTT server according to 3GPP
> TS 24.229 [4].
##### 6.2.17.3 Test description {#test-description-60 .H6}
##### 6.2.17.3.1 Pre-test conditions {#pre-test-conditions-60 .H6}
##### System Simulator: {#system-simulator-60 .H6}
\- SS (MCPTT server)
\- For the underlining \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-60 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-60 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.17.3.2 Test procedure sequence {#test-procedure-sequence-60 .H6}
Table 6.2.17.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CT | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5.3.4.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a locally | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Void. | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 3 | The SS | \ | Floor | 1 | F | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | in the | | | | | | | next 5 | | | | | | | sec? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3.12.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6-7 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | The test | | | | | | | scenario | | | | | | | simulates | | | | | | | the floor | | | | | | | being | | | | | | | given to | | | | | | | the | | | | | | | or | | | | | | | iginating | | | | | | | Client. | | | | | | | The floor | | | | | | | control | | | | | | | server | | | | | | | informs | | | | | | | all other | | | | | | | Clients | | | | | | | ( | | | | | | | including | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | client)) | | | | | | | that the | | | | | | | floor is | | | | | | | taken. | | | | | | | | | | | | | | NOTE 2: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 6.2.17.3.3 Specific message contents {#specific-message-contents-60 .H6}
Table 6.2.17.3.3-1: SIP INVITE from the SS (Step 1, Table 6.2.17.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1
* * *
Information Element Value/remark Comment Reference Condition **Answer-Mode**
**not present**  
**Priv-Answer-Mode**  
answer-mode-value \"Auto\"  
answer-mode-param _"_ require"  
**Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP Message as described in Table 6.2.17.3.3-3  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.17.3.3-2
Table 6.2.17.3.3-2: MCPTT-Info in SIP INVITE (Table 6.2.17.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL,
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
session-type \"ambient-listening\"  
anyExt  
ambient-listening-type \"local-init\"
Table 6.2.17.3.3-3: SDP Message in SIP INVITE (Table 6.2.17.3.3-1)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.3.1.2-1, | | | | | | condition | | | | | | P | | | | | | RIVATE-CALL, | | | | | | INITIAL | | | | | | _SDP_OFFER | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | | Media | | | | descri | | description | | | | ption[1]** | | for audio | | | +--------------+--------------+--------------+-----------+-----------+ | **media | | a=line | | | | attribute** | | | | | | | | attrib | | | | | | ute=sendonly | | | +--------------+--------------+--------------+-----------+-----------+ | sendonly | | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.2.17.3.3-3A: SIP 200 (OK) from the UE (Step 2, Table 6.2.17.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP Message as described in Table 6.2.17.3.3-3B  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.2.17.3.3-3C
Table 6.2.17.3.3-3B: SDP Message in SIP 200 OK (Table 6.2.17.3.3-3A)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.3.1.1-1, | | | | | | condition | | | | | | SDP_ANSWER | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | | Media | | | | descri | | description | | | | ption[1]** | | for audio | | | +--------------+--------------+--------------+-----------+-----------+ | **media | | a=line | | | | attribute** | | | | | | | | attrib | | | | | | ute=recvonly | | | +--------------+--------------+--------------+-----------+-----------+ | recvonly | | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.2.17.3.3-3C: MCPTT-Info in SIP 200 (OK) (Table 6.2.17.3.3-3A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
Table 6.2.17.3.3-4: Floor Taken (Step 3, Table 6.2.17.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.6.3-7
* * *
Information Element Value/remark Comment Condition Permission to Request the
Floor  
Permission to Request the Floor \"0\" The receiver is NOT permitted to request
floor
Table 6.2.17.3.3-5: Void
6.2.18 On-network / Private call / Ambient listening call / Remote initiated
ambient listening call / Pre-established session / Ambient listening call
release / Client Originated (CO)
##### 6.2.18.1 Test Purpose (TP) {#test-purpose-tp-61 .H6}
##### (1) {#section-182 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate remotely initiated ambient listening, **and**
having established a pre-established session }
ensure that {
**when** { UE (MCPTT User) requests the establishment of a remotely initiated
ambient listening call within a pre-established session}
**then** { UE (MCPTT Client) sends a SIP REFER message requesting the
establishment of a remotely initiated ambient listening call within a pre-
established session, **and** , after indication from the MCPTT Server that the
call was established notifies the MCPTT user }
}
##### (2) {#section-183 .H6}
**with** { UE (MCPTT Client) having initiated a remotely initiated ambient
listening call within a pre-established session }
ensure that {
**when** { MCPTT User requests to release the MCPTT remotely initiated ambient
listening call and keep the pre-established session }
**then** { UE (MCPTT Client) sends a SIP REFER message with method "BYE" to
release the MCPTT session and keep the pre-established session }
}
##### 6.2.18.2 Conformance requirements {#conformance-requirements-61 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.1.6.2.2.1, 11.1.6.2.2.3, 6.2.5.2, TS 24.380
clause 9.2.2.3.2. Unless otherwise stated these are Rel-15 requirements.
[TS 24.379, clause 11.1.6.2.2.1]
Upon receiving a request from the MCPTT user to originate a remote initiated
ambient listening call, if the \ element of the \ element is not present in the MCPTT user
profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50])
or is set to a value of \"false\", the MCPTT client shall inform the MCPTT
user and shall exit this procedure.
Upon receiving a request from the MCPTT user to originate a locally initiated
ambient listening call, if the \ element of the \ element is not present in the MCPTT user
profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50])
or is set to a value of \"false\", the MCPTT client shall inform the MCPTT
user and shall exit this procedure.
Upon receiving a request from an MCPTT user to establish an MCPTT ambient
listening call that has been authorised successfully by the requesting MCPTT
client within a pre-established session, the MCPTT client shall generate a SIP
REFER request outside a dialog in accordance with the procedures specified in
3GPP TS 24.229 [4], IETF RFC 4488 [22] and IETF RFC 3515 [25] as updated by
IETF RFC 6665 [26] and IETF RFC 7647 [27], with the clarifications given
below.
If an end-to-end security context needs to be established the MCPTT client:
> 1) if necessary, shall instruct the key management client to request keying
> material from the key management server as described in 3GPP TS 33.180 [78];
>
> 2) shall use the keying material to generate a PCK as described in 3GPP TS
> 33.180 [78];
>
> 3) shall use the PCK to generate a PCK-ID with the four most significant
> bits set to \"0001\" to indicate that the purpose of the PCK is to protect
> private call communications and with the remaining twenty eight bits being
> randomly generated as described in 3GPP TS 33.180 [78];
>
> 4) shall encrypt the PCK to a UID associated to the MCPTT client using the
> MCPTT ID of the invited user and a time related parameter as described in
> 3GPP TS 33.180 [78];
>
> 5) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and
> PCK-ID as specified in 3GPP TS 33.180 [78];
>
> 6) shall add the MCPTT ID of the originating MCPTT to the initiator field
> (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]; and
>
> 7) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user\'s
> signing key provided in the keying material together with a time related
> parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
> 33.180 [78].
The MCPTT client populates the SIP REFER request as follows:
> 1) shall include the Request-URI set to the public service identity
> identifying the pre-established session on the MCPTT server serving the
> MCPTT user;
>
> 2) shall include the Refer-Sub header field with value \"false\" according
> to rules and procedures of IETF RFC 4488 [22];
>
> 3) shall include the Supported header field with value \"norefersub\"
> according to rules and procedures of IETF RFC 4488 [22];
>
> 4) shall include the option tag \"multiple-refer\" in the Require header
> field;
>
> 5) may include a P-Preferred-Identity header field in the SIP REFER request
> containing a public user identity as specified in 3GPP TS 24.229 [4];
>
> 6) shall include a P-Preferred-Service header field set to the ICSI value
> \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS
> 24.229 [4]), according to IETF RFC 6050 [9];
>
> 7) shall set the Refer-To header field of the SIP REFER request as specified
> in IETF RFC 3515 [25] with a Content-ID (\"cid\") Uniform Resource Locator
> (URL) as specified in IETF RFC 2392 [62] that points to an
> application/resource-lists MIME body as specified in IETF RFC 5366 [20], and
> with the Content-ID header field set to this \"cid\" URL;
>
> 8) shall include in the application/resource-lists MIME body a single
> \ element containing a \"uri\" attribute set to the MCPTT ID of the
> targeted user, extended with hname \"body\" parameter containing:
>
> a) an application/vnd.3gpp.mcptt-info MIME body containing:
>
> i) a \ element set to \"ambient-listening\";
>
> ii) if the MCPTT user has requested a locally initiated ambient listening
> call, an \ element set to a value of \"local-init\";
> or
>
> iii) if the MCPTT user has requested a remotely initiated ambient listening
> call, an \ element set to a value of \"remote-
> init\";
>
> b) a Priv-Answer-Mode header field with the value \"Auto\" according to the
> rules and procedures of IETF RFC 5373 [18];
>
> c) if the SDP parameters of the pre-established session do not contain a
> media-level section of a media-floor control entity or if end-to-end
> security is required for the ambient listening call, an application/sdp MIME
> body containing the SDP parameters of the pre-established session according
> to 3GPP TS 24.229 [4] with the clarification given in clause 6.2.1;
>
> d) if this is a locally initiated ambient listening call, shall comply with
> the conditions for implicit floor control as specified in clause 6.4;
>
> e) if this is a remotely initiated ambient listening call, shall comply with
> the conditions for an implicit request to grant the floor to the terminating
> MCPTT client as specified in clause 6.4; and
>
> f) if implicit floor control is to be requested per clause 6.4, then:
>
> i) the application/sdp MIME body shall contain an implicit floor request as
> specified in clause 6.4; and
>
> ii) if the \ element of the \
> element of the MCPTT user profile document identified by the MCPTT ID of the
> calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484
> [50]) is set to a value of \"true\", then shall include an
> application/vnd.3gpp.mcptt-location-info+xml MIME body with a \
> element included in the \ root element; and
>
> 9) shall include a Target-Dialog header field as specified in IETF RFC 4538
> [23] identifying the pre-established session.
The MCPTT client shall send the SIP REFER request towards the MCPTT server
according to 3GPP TS 24.229 [4].
Upon receiving a final SIP 2xx response to the SIP REFER request the MCPTT
client:
> 1) shall interact with media plane as specified in 3GPP TS 24.380 [5]; and
>
> 2) if this is a locally initiated ambient listening call, shall not provide
> any indication to the user that the call setup is in progress.
On call establishment by interaction with the media plane as specified in
clause 9.2.2 of 3GPP TS 24.380 [5] if the sent SIP REFER request the MCPTT
client:
> 1) if the MCPTT user has requested a locally initiated ambient listening
> call shall provide no indication to the MCPTT user that the ambient
> listening call has been successfully established; and
>
> 2) if the MCPTT user has requested a remotely initiated ambient listening
> call shall provide an indication to the MCPTT user that the ambient
> listening call has been successfully established.
>
> 3) if the \ element contained in the
> application/vnd.3gpp.mcptt-info+xml MIME body in the sent SIP REFER request
> was set to a value of \"local-init\":
>
> a) shall cache the value of \"listened-to MCPTT user\" as the ambient
> listening client role for this call; or
>
> b) if the \ element contained in the
> application/vnd.3gpp.mcptt-info+xml MIME body was set to a value of
> \"remote-init\" shall cache the value of \"listening MCPTT user\" as the
> ambient listening client role for this call; and
>
> 4) shall cache the value contained in the \ element
> of the application/vnd.3gpp.mcptt-info+xml MIME body set in step 8) as the
> ambient listening type of this call.
[TS 24.379, clause 11.1.6.2.2.3]
Upon receiving a request from an MCPTT user to release an MCPTT ambient
listening call when using a pre-established MCPTT session:
The MCPTT client:
> 1) if the MCPTT client has not received a g.3gpp.mcptt.ambient-listening-
> call-release feature-capability indicator as described in clause D.3 in the
> Feature-Caps header field according to IETF RFC 6809 [60] in;
>
> a) a received SIP INVITE request for the ambient listening call; or
>
> b) a received SIP 200 (OK) response to a sent SIP INVITE request or SIP
> REFER request for the ambient listening call;
>
> then shall skip the rest of the steps; and
>
> 2) shall perform the actions specified in clause 6.2.5.2.
If the procedures of clause 6.2.5.2 were successful:
> 1) if the cached ambient listening client role is equal to \"listened-to
> MCPTT user\", shall provide no indication that an ambient listening call has
> been terminated;
>
> 2) if the cached ambient listening client role is equal to \"listening MCPTT
> user\", may provide an indication to the MCPTT user that the ambient
> listening call has been terminated; and
>
> 3) shall clear the cache of the data stored as:
>
> a) ambient listening client role; and
>
> b) ambient listening type.
[TS 24.379, clause 6.2.5.2]
When the MCPTT client wants to release an MCPTT session using a pre-
established session, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate an initial SIP REFER request outside a dialog in
> accordance with the procedures specified in 3GPP TS 24.229 [4], IETF RFC
> 4488 [22] and IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF
> RFC 7647 [27];
>
> 3) shall set the Request-URI of the SIP REFER request to the public service
> identity identifying the pre-established session on the MCPTT server serving
> the MCPTT user;
>
> 4) shall include the Refer-Sub header field with value \"false\" according
> to rules and procedures of IETF RFC 4488 [22];
>
> 5) shall include the Supported header field with value \"norefersub\"
> according to rules and procedures of IETF RFC 4488 [22];
>
> 6) shall set the Refer-To header field of the SIP REFER request to the MCPTT
> session identity to release;
>
> 7) shall include the \"method\" SIP URI parameter with the value \"BYE\" in
> the URI in the Refer-To header field;
>
> 8) shall include a Target-Dialog header field as specified in IETF RFC 4538
> [23] identifying the pre-established session; and
>
> 9) shall send the SIP REFER request according to 3GPP TS 24.229 [4].
Upon receiving a SIP 2xx response to the SIP REFER request, the MCPTT client
shall interact with media plane as specified in 3GPP TS 24.380 [5].
[TS 24.380, clause 9.2.2.4.2]
Upon reception of a Connect message the MCPTT client:
> 1\. if the first bit in the subtype of the Connect message is set to \'1\'
> (acknowledgement is required), shall send Acknowledgement message with the
> Reason Code field set to \'Accepted\'; and
>
> 2\. shall remain in the \'U: Pre-established session in use\' state.
##### 6.2.18.3 Test description {#test-description-61 .H6}
##### 6.2.18.3.1 Pre-test conditions {#pre-test-conditions-61 .H6}
##### System Simulator: {#system-simulator-61 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-61 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-61 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- The MCPTT User is authorized to initiate remotely initiated ambient
listening: the \ element of
the \ element is present in the MCPTT user profile document and is
set to \"true\"
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.18.3.2 Test procedure sequence {#test-procedure-sequence-61 .H6}
Table 6.2.18.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | remotely | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call to | | | | | | | user B | | | | | | | using the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | esta | | | | | | | blishment | | | | | | | using a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5 | | | | | | | .3A.3.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a | | | | | | | remotely | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | The SS | \ NOTE: The terminating MCPTT client in an ambient listening call receives a
> SIP INVITE request with Replaces header field when using a pre-established
> session.
[TS 24.379, clause 11.1.6.2.1.2]
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> 1) may reject the SIP INVITE request if either of the conditions in step a)
> or b) are met:
>
> a) MCPTT client is already occupied in another session and the number of
> simultaneous sessions exceeds \, the maximum simultaneous MCPTT
> session for private call, as specified in TS 24.384 [50]; or
>
> b) MCPTT client does not have enough resources to handle the call;
>
> c) if neither condition a) nor b) are met, continue with the rest of the
> steps;
>
> 2) if the SIP INVITE request is rejected in step 1):
>
> a) shall respond towards the participating MCPTT function either with:
>
> i) an appropriate reject code as specified in 3GPP TS 24.229 [4] and warning
> texts as specified in clause 4.4.2; or
>
> ii) with a SIP 480 (Temporarily unavailable) response not including warning
> texts if the user is authorised to restrict the reason for failure according
> to \ as specified in 3GPP TS 24.384 [50]; and
>
> b) skip the rest of the steps of this clause;
>
> 3) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
> attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
> I_MESSAGE:
>
> a) shall extract the MCPTT ID of the originating MCPTT from the initiator
> field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];
>
> b) shall convert the MCPTT ID to a UID as described in 3GPP TS 33.180 [78];
>
> c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE
> as described in 3GPP TS 33.180 [78];
>
> d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
> reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response
> as specified in IETF RFC 4567 [47], and include warning text set to \"136
> authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header
> field as specified in clause 4.4; and
>
> e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
>
> i) shall extract and decrypt the encapsulated PCK using the terminating
> user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and
>
> ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS
> 33.180 [78];
>
> NOTE 1: With the PCK successfully shared between the originating MCPTT
> client and the terminating MCPTT client, both clients are able to use
> SRTP/SRTCP to create an end-to-end secure session.
>
> 4) may check if a Resource-Priority header field is included in the incoming
> SIP INVITE request and may perform further actions outside the scope of this
> specification to act upon an included Resource-Priority header field as
> specified in 3GPP TS 24.229 [4];
>
> 5) if the received SIP INVITE request contains an
> application/vnd.3gpp.mcptt-info+xml MIME body with the \ element
> containing the \ element with the \
> element set to a value of \"local-init\", may display to the MCPTT user the
> MCPTT ID of the inviting MCPTT user;
>
> 6) shall perform the automatic commencement procedures specified in clause
> 6.2.3.1.1;
>
> NOTE 2: Auto-answer is the commencement mode for both participants in
> locally initiated and remotely initiated ambient listening calls.
>
> 7) if the \ element contained in the
> application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP INVITE
> request was set to a value of \"remote-init\":
>
> a) shall cache the value of \"listened-to MCPTT user\" as the ambient
> listening client role for this call; or;
>
> b) if the \ element contained in the
> application/vnd.3gpp.mcptt-info+xml MIME body was set to a value of \"local-
> init\" \" shall cache the value of \"listening MCPTT user\" as the ambient
> listening client role for this call;
>
> 8) if the received SIP INVITE request includes an alert-info header field as
> specified in IETF RFC 3261 [24] and as updated by IETF RFC 7462 [77] set to
> a value of \"\\" shall not give any indication of the
> progress of the call to the MCPTT user;
>
> NOTE 3: The alert-info header field having the value of
> \"\\" is intended to result in having a \"null\" alert,
> i.e. an alert with no content or physical manifestation of any kind.
>
> 9) if the \ element contained in the
> application/vnd.3gpp.mcptt-info+xml MIME body is set to a value of \"local-
> init\", should provide an indication to the MCPTT user that the ambient
> listening call is in progress; and
>
> NOTE 4: The terminating user in a remotely initiated ambient listening is
> the listened-to MCPTT user and is intended to be totally unaware that their
> microphone is activated and a call is in progress.
>
> 10) shall cache as the ambient listening type for the call the value
> contained in the \ element of the
> application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP
> INVITE request.
[TS 24.379, clause 11.1.6.2.1.4]
...
Upon receipt of a SIP BYE request in the dialog of an ambient listening
session, the MCPTT client:
> 1) shall comply with the procedures of subclause 6.2.6;
>
> 2) if the cached ambient listening client role is equal to \"listened-to
> MCPTT user\", shall provide no indication that an ambient listening call has
> been terminated;
>
> 3) if the cached ambient listening client role is equal to \"listening MCPTT
> user\", may provide an indication to the MCPTT user that the ambient
> listening call has been terminated; and
>
> 4) shall clear the cache of the data stored as:
>
> a) ambient listening client role; and
>
> b) ambient listening type.
[TS 24.379, clause 11.1.6.2.2.5]
This clause is referenced from other procedures.
Upon receiving an interaction with the media plane indicating release of the
ambient listening call but preservation of the pre-established session as
specified in clause 9.2 of 3GPP TS 24.380 [5], the MCPTT client:
> 1) if the cached ambient listening client role is equal to \"listened-to
> MCPTT user\", shall provide no indication that an ambient listening call has
> been terminated;
>
> 2) if the cached ambient listening client role is equal to \"listening MCPTT
> user\", may provide an indication to the MCPTT user that the ambient
> listening call has been terminated; and
>
> 3) shall clear the cache of the data stored as:
>
> a) ambient listening client role; and
>
> b) ambient listening type.
##### 6.2.19.3 Test description {#test-description-62 .H6}
##### 6.2.19.3.1 Pre-test conditions {#pre-test-conditions-62 .H6}
##### System Simulator: {#system-simulator-62 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-62 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-62 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.19.3.2 Test procedure sequence {#test-procedure-sequence-62 .H6}
Table 6.2.19.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CT | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5.3.4.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a | | | | | | | remotely | | | | | | | initiated | | | | | | | ambient | | | | | | | listening | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | The SS | \\" The alert-info header field having the value of
\"\\" is intended to result in having a \"null\" alert, i.e.
an alert with no content or physical manifestation of any kind. TS 24.379 [9]
clause 11.1.6.2.1.2  
**Replaces** RFC 3891 [117] TS 24.379 [9] clause 6.3.2.2  
callid callid of the targeted pre-established session  
replaces-params  
from-tag to-tag of the targeted pre-established session  
to-tag from-tag of the targeted pre-established session  
**Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP Message as described in Table 6.2.19.3.3-1A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.19.3.3-2
Table 6.2.19.3.3-1A: SDP Message in SIP INVITE (Table 6.2.19.3.3-1)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.3.1.2-1, | | | | | | condition | | | | | | INITIAL\ | | | | | | _SDP_OFFER, | | | | | | PR | | | | | | E_ESTABLISH | | | | | | ED_SESSION, | | | | | | PRIVATE-CALL | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Session | | | | | | de | | | | | | scription:** | | | | | +--------------+--------------+--------------+-----------+-----------+ | Origin | | | | | +--------------+--------------+--------------+-----------+-----------+ | sess-id | \"87654321\" | different | | | | | | value than | | | | | | for | | | | | | pre | | | | | | -established | | | | | | session | | | +--------------+--------------+--------------+-----------+-----------+ | sess-version | \"87654321\" | different | | | | | | value than | | | | | | for | | | | | | pre | | | | | | -established | | | | | | session | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | | Media | | | | descri | | description | | | | ption[1]** | | for audio | | | +--------------+--------------+--------------+-----------+-----------+ | fmt | same value | | | | | | as used for | | | | | | pre | | | | | | -established | | | | | | session | | | | +--------------+--------------+--------------+-----------+-----------+ | **media | | a=line | | | | attribute** | | | | | | | | attrib | | | | | | ute=recvonly | | | +--------------+--------------+--------------+-----------+-----------+ | recvonly | | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.2.19.3.3-2: MCPTT-Info in SIP INVITE (Table 6.2.19.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
session-type \"ambient-listening\" TS 24.379 [9] clause 11.1.6.2.1.2  
anyExt  
ambient-listening-type \"remote-init\" TS 24.379 [9] clause 11.1.6.2.1.2
Table 6.2.19.3.3-2A: SIP 200 (OK) from the UE (Step 2, Table 6.2.19.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP Message**  
MIME-part-body SDP Message as described in Table 6.2.19.3.3-2B  
MIME body part **MCPTT-Info**  
MIME part body MCPTT-Info as described in Table 6.2.19.3.3-2C
Table 6.2.19.3.3-2B: SDP Message in SIP 200 OK (Table 6.2.19.3.3-2A)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.3.1.1-1, | | | | | | condition | | | | | | SDP_ANSWER, | | | | | | P | | | | | | RE_ESTABLIS | | | | | | HED_SESSION | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | | Media | | | | descri | | description | | | | ption[1]** | | for audio | | | +--------------+--------------+--------------+-----------+-----------+ | **media | | a=line | | | | attribute** | | | | | | | | attrib | | | | | | ute=sendonly | | | +--------------+--------------+--------------+-----------+-----------+ | sendonly | | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.2.19.3.3-2C: MCPTT-Info in SIP 200 (OK) (Table 6.2.19.3.3-2A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
Table 6.2.19.3.3-3: SIP BYE from the SS (Step 4, Table 6.2.19.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3.12.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1
* * *
Information Element Value/remark Comment Reference Condition **Content-Type**  
media-type \"multipart/mixed  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-headers  
MIME-Content-Type \"application/vnd.3gpp.mcptt-info+xml\"  
Content-ID Unique id in format of a Message-ID assigned by the SS  
MIME-part-body MCPTT-Info as described in Table 6.2.19.3.3-4  
MIME body part **Signature**  
MIME-part-headers  
MIME-Content-Type \"application/vnd.3gpp.mcptt-signed+xml\"  
MIME-part-body Signatures for XML MIME bodies as described in TS 36.579-1 [2]
Table 5.5.13.1-2
Table 6.2.19.3.3-4: MCPTT-Info in SIP BYE (Table 6.2.19.3.3-3)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
session-type \"ambient-listening\"  
anyExt  
ambient-listening-type \"remote-init\"  
release-reason \"call-request-for-listened-to-client\" TS 24.379 [9] clause
11.1.6.4.3
6.2.20 On-network / First-to-answer call / On-demand session / Client
Originated (CO)
##### 6.2.20.1 Test Purpose (TP) {#test-purpose-tp-63 .H6}
##### (1) {#section-186 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate first-to-answer calls }
ensure that {
**when** { UE (MCPTT User) requests the establishment of an on-demand first-
to-answer call }
**then** { UE (MCPTT Client) sends a SIP INVITE message requesting the
establishment of an on-demand first-to-answer call providing a MIME resource-
lists body with the MCPTT IDs of the potential target MCPTT users, **and** ,
after indication from the MCPTT Server that the call was established notifies
the user }
}
##### 6.2.20.2 Conformance requirements {#conformance-requirements-63 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.1.1.2.1.1, 6.2.2. Unless otherwise stated
these are Rel-15 requirements.
[TS 24.379, clause 11.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT private call
the MCPTT client shall generate an initial SIP INVITE request by following the
UE originating session procedures specified in 3GPP TS 24.229 [4], with the
clarifications given below.
The MCPTT client:
> 1) shall set the Request-URI of the SIP INVITE request to a public service
> identity of the participating MCPTT function serving the MCPTT user;
>
> ...
>
> 4) may include a P-Preferred-Identity header field in the SIP INVITE request
> containing a public user identity as specified in 3GPP TS 24.229 [4];
>
> 5) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 6) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 7) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 8) shall include an Accept-Contact header field with the media feature tag
> g.3gpp.icsi-ref contain with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\"
> according to IETF RFC 3841 [6];
>
> ...
>
> 10) for the establishment of a first-to-answer call shall insert in the SIP
> INVITE request a MIME resource-lists body with the MCPTT IDs of the
> potential target MCPTT users, according to rules and procedures of IETF RFC
> 5366 [20];
>
> ...
>
> 12) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarification given in subclause 6.2.1 and with a media stream of the
> offered media-floor control entity;
>
> 13) if implicit floor control is required, shall comply with the conditions
> specified in subclause 6.4 and:
>
> a) if the \ element of the \
> element of the MCPTT user profile document identified by the MCPTT ID of the
> calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484
> [50]) is set to a value of \"true\"; and
>
> b) if location information has not yet been included in the SIP re-INVITE
> request;
>
> then shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body
> with a \ element included in the \ root element;
>
> ...
>
> 15) if the MCPTT user is initiating a first-to-answer call shall contain an
> application/vnd.3gpp.mcptt-info+xml MIME body with the \ element
> containing the \ element with the \ element set
> to a value of \"first-to-answer\";
>
> ...
>
> 17) shall send SIP INVITE request towards the MCPTT server according to 3GPP
> TS 24.229 [4].
Upon receiving a SIP 183(Session Progress) response to the SIP INVITE request
the MCPTT client:
> 1) may indicate the progress of the session establishment to the inviting
> MCPTT user.
Upon receiving a SIP 200 (OK) response to the SIP INVITE request the MCPTT
client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) if the sent SIP INVITE request was for the origination of a first-to-
> answer call and the SDP answer contained in the received SIP 200 (OK)
> response contains an \"a=key-mgmt\" attribute field with a \"mikey\"
> attribute value containing a MIKEY-SAKKE I_MESSAGE:
>
> a) shall extract the MCPTT ID of the sender of the SIP 200 (OK) response
> from the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS
> 33.180 [78];
>
> b) shall convert the MCPTT ID to a UID as described in 3GPP TS 33.180 [78];
>
> c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE
> as described in 3GPP TS 33.180 [78];
>
> ...
>
> e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
>
> i) shall extract and decrypt the encapsulated PCK using the originating
> user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and
>
> ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS
> 33.180 [46];
>
> NOTE: With the PCK successfully shared between the originating MCPTT client
> and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to
> create an end-to-end secure session;
>
> ...
>
> 4) shall notify the user that the call has been successfully established.
[TS 24.379, clause 6.2.2]
When the MCPTT client receives an initial SDP offer for an MCPTT session, the
MCPTT client shall process the SDP offer and shall compose an SDP answer
according to 3GPP TS 24.229 [4].
When composing an SDP answer, the MCPTT client:
> 1) shall accept the MCPTT speech media stream in the SDP offer;
>
> 2) shall set the IP address of the MCPTT client for the accepted MCPTT
> speech media stream and, if included in the SDP offer, for the accepted
> media-floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP answer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 3) shall include an \"m=audio\" media-level section for the accepted MCPTT
> speech media stream consisting of:
>
> a) the port number for the media stream;
>
> b) media-level attributes as specified in 3GPP TS 24.229 [4];
>
> c) if the \"a=recvonly\" attribute is present in the SDP offer, include an
> \"a=sendonly\" attribute;
>
> d) if the \"a=sendonly\" attribute is present in the SDP offer, include an
> \"a=recvonly\" attribute; and
>
> e) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4];
>
> 4) if included in the SDP offer, shall include the media-level section of
> the offered media-floor control entity consisting of:
>
> a) an \"m=application\" media-level section as specified in 3GPP TS 24.380
> [5] clause 12; and
>
> b) \'fmtp\' attributes as specified in 3GPP TS 24.380 [5] clause 14; and
>
> 5) if end-to-end security is required for a first-to-answer call, shall
> include the MIKEY-SAKKE I_MESSAGE in an \"a=key-mgmt\" attribute as a
> \"mikey\" attribute value in the SDP answer as specified in 3GPP TS 33.180
> [78].
##### 6.2.20.3 Test description {#test-description-63 .H6}
##### 6.2.20.3.1 Pre-test conditions {#pre-test-conditions-63 .H6}
##### System Simulator: {#system-simulator-63 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-63 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-63 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The MCPTT User is authorized to initiate first-to-answer call: \ element of the \ element of the
\ element is present in the MCPTT user profile document and is set to
\"true\".
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.20.3.2 Test procedure sequence {#test-procedure-sequence-63 .H6}
Table 6.2.20.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of an | | | | | | | first- | | | | | | | to-answer | | | | | | | call with | | | | | | | targeted | | | | | | | users B | | | | | | | and C. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | The | - | - | - | - | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | described | | | | | | | in | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | cla | | | | | | | use 5.4.3 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | in | | | | | | | E-UTRA\' | | | | | | | take | | | | | | | place. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Check: | --> | SIP | 1 | P | | | Does the | | INVITE | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | INVITE | | | | | | | r | | | | | | | equesting | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of an | | | | | | | MCPTT | | | | | | | first- | | | | | | | to-answer | | | | | | | call | | | | | | | providing | | | | | | | a MIME | | | | | | | resou | | | | | | | rce-lists | | | | | | | body with | | | | | | | the MCPTT | | | | | | | IDs of | | | | | | | the | | | | | | | potential | | | | | | | target | | | | | | | MCPTT | | | | | | | users? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | The SS | \ | SIP ACK | - | - | | | (MCPTT | | | | | | | client) | | | | | | | sends a | | | | | | | SIP ACK. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify | | | | | | | the user | | | | | | | that the | | | | | | | call has | | | | | | | been | | | | | | | est | | | | | | | ablished? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step 9a1 | | | | | | | describes | | | | | | | behaviour | | | | | | | that | | | | | | | depends | | | | | | | on the UE | | | | | | | implem | | | | | | | entation; | | | | | | | the | | | | | | | \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | i | | | | | | | dentifies | | | | | | | a step | | | | | | | sequence | | | | | | | that | | | | | | | takes | | | | | | | place if | | | | | | | the UE | | | | | | | requests | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | in step | | | | | | | 3. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9a1 | The SS | \
element set to a value of \"not selected for call\" }
**then** { UE (MCPTT Client) sends a SIP 200 (OK) to confirm termination of
the MCPTT session }
}
##### 6.2.20.2 Conformance requirements {#conformance-requirements-64 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.1.1.2.1.2, 11.1.4.2, 6.2.2, 6.2.3.1.1,
6.2.3.2.1, 6.2.6. Unless otherwise stated these are Rel-15 requirements.
[TS 24.379, clause 11.1.1.2.1.2]
Upon receipt of an initial SIP INVITE request, the MCPTT client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [4] with the clarifications below.
The MCPTT client:
> ...
>
> 5) if an end-to-end security context needs to be established and if the
> \ in the application/vnd.3gpp.mcptt-info+xml MIME body of the
> incoming SIP INVITE request is set to \"first-to-answer\" then:
>
> a) if necessary, shall instruct the key management client to request keying
> material from the key management server as described in 3GPP TS 33.180 [78];
>
> b) shall use the keying material to generate a PCK as described in 3GPP TS
> 33.180 [78];
>
> c) shall use the PCK to generate a PCK-ID with the four most significant
> bits set to \"0001\" to indicate that the purpose of the PCK is to protect
> private call communications and with the remaining twenty eight bits being
> randomly generated as described in 3GPP TS 33.180 [78];
>
> d) shall encrypt the PCK to a UID associated to the MCPTT client using the
> MCPTT ID and KMS URI of the originator of the SIP INVITE request as
> determined by the procedures of subclause 6.2.8.3.9 and a time related
> parameter as described in 3GPP TS 33.180 [78];
>
> e) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and
> PCK-ID as specified in 3GPP TS 33.180 [78];
>
> f) shall add the MCPTT ID of the MCPTT user to the initiator field (IDRi) of
> the I_MESSAGE as described in 3GPP TS 33.180 [78]; and
>
> NOTE 4: The initiator of the MIKEY-SAKKE I_MESSAGE is in this case the
> terminating client from the perspective of the call.
>
> g) shall sign the MIKEY-SAKKE I_MESSAGE using the MCPTT user\'s signing key
> provided in the keying material together with a time related parameter, and
> add this to the MIKEY-SAKKE payload, as described in 3GPP TS 33.180 [78];
>
> ...
>
> 8) if the \ in the application/vnd.3gpp.mcptt-info+xml MIME
> body of the incoming SIP INVITE request is set to \"first-to-answer\":
>
> a) shall notify the user of the incoming call;
>
> b) shall not forward the first-to-answer call;
>
> c) if the MCPTT user is busy on another call, shall send a SIP 486 (Busy
> Here) to the SIP INVITE request according to 3GPP TS 24.229 [4] and not
> continue with any further steps in this subclause; and
>
> d) if the MCPTT user does not answer the call within a time decided by the
> client implementation, the MCPTT client shall send a SIP 480 (Temporarily
> Unavailable) to the SIP INVITE request according to 3GPP TS 24.229 [4] and
> not continue with any further steps in this subclause;
>
> NOTE 5: In the conditions below, as the SIP layer implements the actions for
> commencement mode, it is assumed that the Answer-Mode or Priv-Answer-Mode
> header fields are set correctly in line with the setting of the \ type> in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming
> SIP INVITE request.
>
> ...
>
> 10) shall perform the manual commencement procedures specified in subclause
> 6.2.3.2.1 if either of the following conditions are met:
>
> ...
Upon receiving the SIP CANCEL request cancelling a SIP INVITE request for
which a dialog exists at the MCPTT client and a SIP 200 (OK) response has not
yet been sent to the SIP INVITE request then the MCPTT client:
> 1) if the session was established with a \ of \"first-to-
> answer\", may notify the MCPTT user of the cancellation of the call;
>
> ...
>
> 3) shall send a SIP 200 (OK) response to the SIP CANCEL request according to
> 3GPP TS 24.229 [4]; and
>
> 4) shall send a SIP 487 (Request Terminated) response to the SIP INVITE
> request according to 3GPP TS 24.229 [4].
Upon receiving a SIP BYE request for an established dialog, the MCPTT client:
> ...
>
> 2) shall follow the procedures in subclause 11.1.4.2.
>
> NOTE 6: The above conditions for SIP CANCEL and SIP BYE cover the case for a
> first-to-answer call where the MCPTT server has already established the
> private call with another MCPTT client and needs to immediately cancel or
> release the dialogs with other MCPTT clients.
[TS 24.379, clause 6.2.3.2.1]
When performing the manual commencement mode procedures:
> 1) if the MCPTT user declines the MCPTT session invitation the MCPTT client
> shall send a SIP 480 (Temporarily Unavailable) response towards the MCPTT
> server with the warning text set to: \"110 user declined the call
> invitation\" in a Warning header field as specified in subclause 4.4, and
> not continue with the rest of the steps in this subclause.
The MCPTT client:
> 1) shall accept the SIP INVITE request and generate a SIP 180 (Ringing)
> response according to rules and procedures of 3GPP TS 24.229 [4];
>
> 2) shall include the option tag \"timer\" in a Require header field of the
> SIP 180 (Ringing) response;
>
> 3) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 180 (Ringing) response;
>
> 4) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 180 (Ringing) response; and
>
> 5) shall send the SIP 180 (Ringing) response to the MCPTT server.
When sending the SIP 200 (OK) response to the incoming SIP INVITE request, the
MCPTT client shall follow the procedures in subclause 6.2.3.1.1.
When NAT traversal is supported by the MCPTT client and when the MCPTT client
is behind a NAT, generation of SIP responses is done as specified in this
subclause and as specified in IETF RFC 5626 [15].
[TS 24.379, clause 6.2.3.1.1]
> 1) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
> according to rules and procedures of 3GPP TS 24.229 [4];
>
> 2) shall include the option tag \"timer\" in a Require header field of the
> SIP 200 (OK) response;
>
> 3) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 200 (OK) response;
>
> 4) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 200 (OK) response;
>
> 5) shall include the Session-Expires header field in the SIP 200 (OK)
> response and start the SIP session timer according to IETF RFC 4028 [7]. The
> \"refresher\" parameter in the Session-Expires header field shall be set to
> \"uas\";
>
> ...
>
> 7) shall, if the incoming SIP INVITE request does not contain a Replaces
> header field, include an SDP answer in the SIP 200 (OK) response to the SDP
> offer in the incoming SIP INVITE request according to 3GPP TS 24.229 [4]
> with the clarifications given in subclause 6.2.2;
>
> ...
>
> 8) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4];
>
> 9) shall, if the incoming SIP INVITE request contains a Replaces header
> field, release the pre-established session identified by the contents of the
> Replaces header field; and
>
> 10) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
> subclause 6.2.
When NAT traversal is supported by the MCPTT client and when the MCPTT client
is behind a NAT, generation of SIP responses is done as specified in this
subclause and as specified in IETF RFC 5626 [15].
[TS 24.379, clause 6.2.2]
When the MCPTT client receives an initial SDP offer for an MCPTT session, the
MCPTT client shall process the SDP offer and shall compose an SDP answer
according to 3GPP TS 24.229 [4].
When composing an SDP answer, the MCPTT client:
> 1) shall accept the MCPTT speech media stream in the SDP offer;
>
> 2) shall set the IP address of the MCPTT client for the accepted MCPTT
> speech media stream and, if included in the SDP offer, for the accepted
> media-floor control entity;
>
> NOTE: If the MCPTT client is behind a NAT the IP address and port included
> in the SDP answer can be a different IP address and port than the actual IP
> address and port of the MCPTT client depending on the NAT traversal method
> used by the SIP/IP Core.
>
> 3) shall include an \"m=audio\" media-level section for the accepted MCPTT
> speech media stream consisting of:
>
> a) the port number for the media stream;
>
> b) media-level attributes as specified in 3GPP TS 24.229 [4];
>
> c) if the \"a=recvonly\" attribute is present in the SDP offer, include an
> \"a=sendonly\" attribute;
>
> d) if the \"a=sendonly\" attribute is present in the SDP offer, include an
> \"a=recvonly\" attribute; and
>
> e) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4];
>
> 4) if included in the SDP offer, shall include the media-level section of
> the offered media-floor control entity consisting of:
>
> a) an \"m=application\" media-level section as specified in 3GPP TS 24.380
> [5] clause 12; and
>
> b) \'fmtp\' attributes as specified in 3GPP TS 24.380 [5] clause 14; and
>
> 5) if end-to-end security is required for a first-to-answer call, shall
> include the MIKEY-SAKKE I_MESSAGE in an \"a=key-mgmt\" attribute as a
> \"mikey\" attribute value in the SDP answer as specified in 3GPP TS 33.180
> [78].
[TS 24.379, clause 11.1.4.2]
Upon receiving a SIP BYE request for private call session, the MCPTT client
shall follow the procedures as specified in subclause 6.2.6.
[TS 24.379, clause 6.2.6]
Upon receiving a SIP BYE request, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
> and
>
> 2) shall send SIP 200 (OK) response towards MCPTT server according to 3GPP
> TS 24.229 [4].
##### 6.2.21.3 Test description {#test-description-64 .H6}
##### 6.2.21.3.1 Pre-test conditions {#pre-test-conditions-64 .H6}
##### System Simulator: {#system-simulator-64 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-64 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-64 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The MCPTT User is authorized to participate in private calls: the \ element of the \ element is present in
the MCPTT user profile document and is set to \"true\".
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.21.3.2 Test procedure sequence {#test-procedure-sequence-64 .H6}
Table 6.2.21.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | private | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | with | | | | | | | manual | | | | | | | comme | | | | | | | ncement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.6.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a | | | | | | | first- | | | | | | | to-answer | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | The | - | - | - | - | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.12.3-1 | | | | | | | is | | | | | | | p | | | | | | | erformed. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3a1-6A | Steps | - | - | - | - | | | 1a1-4A of | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | private | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | with | | | | | | | manual | | | | | | | comme | | | | | | | ncement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.6.3-1 | | | | | | | are | | | | | | | p | | | | | | | erformed. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | The SS | \ | SIP 200 | 3 | P | | | Does the | | (OK) | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | with SIP | | | | | | | 200 (OK)? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Check: | --> | SIP 487 | 3 | P | | | Does the | | (Request | | | | | UE (MCPTT | | Te | | | | | client) | | rminated) | | | | | send a | | | | | | | SIP 487 | | | | | | | (Request | | | | | | | Te | | | | | | | rminated) | | | | | | | to | | | | | | | confirm | | | | | | | te | | | | | | | rminating | | | | | | | of the | | | | | | | dialog? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9A | The SS | \ | | | | | | | element | | | | | | | set to | | | | | | | \"not | | | | | | | selected | | | | | | | for | | | | | | | call\" | | | | | | | (another | | | | | | | Client | | | | | | | has | | | | | | | a | | | | | | | nswered)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | The order | | | | | | | of the | | | | | | | messages | | | | | | | is not | | | | | | | checked. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 6.2.21.3.3 Specific message contents {#specific-message-contents-64 .H6}
Table 6.2.21.3.3-1: SIP INVITE from the SS (Steps 1, 4, 11, Table
6.2.21.3.2-1;\ step 2, TS 36.579-1 [2], Table 5.3.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition FIRST-TO-ANSWER
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.21.3.3-2  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.21.3.3-3
Table 6.2.21.3.3-2: SDP Message in SIP INVITE (Table 6.2.21.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition
INITIAL_SDP_OFFER, WITHOUT_FLOORCONTROL
* * *
Table 6.2.21.3.3-3: MCPTT-Info in SIP INVITE (Table 6.2.21.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition FIRST-TO-ANSWER
* * *
Table 6.2.21.3.3-4: Void
Table 6.2.21.3.3-5: SIP 200 (OK) from the UE (Steps 1, 15, Table
6.2.21.3.2-1;\ step 6, TS 36.579-1 [2], Table 5.3.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.21.3.3-6  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.21.3.3-6A
Table 6.2.21.3.3-6: SDP Message in SIP 200 (OK) (Table 6.2.21.3.3-5)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
WITHOUT_FLOORCONTROL, WITH_SECURITY
* * *
Table 6.2.21.3.3-6A: MCPTT-Info in SIP 200 (OK) (Table 6.2.21.3.3-5)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
Table 6.2.21.3.3-7..8: Void
Table 6.2.21.3.3-8A: SIP ACK from the SS (Step 9A, Table 6.2.21.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.1.2-1, condition NON-2XX
* * *
Table 6.2.21.3.3-9: SIP BYE from the SS (Step 16, Table 6.2.21.3.2-1;\ step 1,
TS 36.579-1 [2], Table 5.3.12.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1
* * *
Information Element Value/remark Comment Reference Condition **Content-Type**  
media-type \"multipart/mixed\"  
**Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-info+xml\"  
Content-ID Unique id in format of a Message-ID assigned by the SS  
MIME-part-body MCPTT-Info as described in Table 6.2.21.3.3-10  
MIME body part **Signature**  
MIME-part-headers  
MIME-Content-Type \"application/vnd.3gpp.mcptt-signed+xml\"  
MIME-part-body Signatures for XML MIME bodies as described in TS 36.579-1 [2]
Table 5.5.13.1-2
Table 6.2.21.3.3-10: MCPTT-Info in SIP BYE (Table 6.2.21.3.3-9)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
anyExt  
release-reason \"not selected for call\"
6.2.22 On-network / First-to-answer call / Pre-established session / Client
Originated (CO)
##### 6.2.22.1 Test Purpose (TP) {#test-purpose-tp-65 .H6}
##### (1) {#section-190 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate first-to-answer calls, **and** , having
established a pre-established session }
ensure that {
**when** { MCPTT User requests the establishment of an MCPTT first-to-answer
call within the pre-established session }
**then** { UE (MCPTT Client) sends a SIP REFER request outside a dialog
requesting an MCPTT first-to-answer call and providing a MIME resource-lists
body with the MCPTT IDs of the potential target MCPTT users }
}
##### (2) {#section-191 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate first-to-answer calls, **and** , having
established a pre-established session, **and** , having send a SIP REFER
request outside a dialog requesting an MCPTT first-to-answer call and
providing a MIME resource-lists body with the MCPTT IDs of the potential
target MCPTT users }
ensure that {
**when** { UE (MCPTT Client) receives a Connect message from the participating
MCPTT function }
**then** { UE (MCPTT Client) sends an Acknowledge message indicating that the
connection to the pre-established session is accepted }
}
##### (3) {#section-192 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate first-to-answer calls, **and** , having
established a pre-established session, **and** , having send a SIP REFER
request outside a dialog requesting an MCPTT first-to-answer call and
providing a MIME resource-lists body with the MCPTT IDs of the potential
target MCPTT users, **and** , having accepted the connection to the pre-
established session }
ensure that {
**when** { UE (MCPTT Client) receives a re-INVITE within the pre-established
session }
**then** { UE (MCPTT Client) sends OK confirming the establishment of the
first-to-answer call and notifies the user }
}
##### 6.2.22.2 Conformance requirements {#conformance-requirements-65 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.1.2.2, 11.1.1.2.2.1, 11.1.1.2.2.2, TS
24.380 clauses 4.1.2.2, 9.2.2.3.2. Unless otherwise stated these are Rel-15
requirements.
[TS 24.379, clause 11.1.2.2]
When the MCPTT user wants to make a private call without floor control or
first-to-answer call without floor control using a pre-established session,
the MCPTT client shall follow the procedures in subclause 11.1.1.2.2.1 with
the following exceptions:
> ...
>
> 2) step 9a) is re-written as: if the SDP parameters of the pre-established
> session contain a media-level section of a media-floor control entity, an
> application/sdp MIME body containing the SDP parameters of the pre-
> established session according to 3GPP TS 24.229 [4] with the clarifications
> given in subclause 6.2.1. If the pre-established session was established
> with implicit floor control, then the application/sdp MIME body shall not
> contain the implicit floor request as specified in subclause 6.4.
[TS 24.379, clause 11.1.1.2.2.1]
Upon receiving a request from an MCPTT user to establish an MCPTT private call
within a pre-established session the MCPTT client shall generate a SIP REFER
request outside a dialog in accordance with the procedures specified in 3GPP
TS 24.229 [4], IETF RFC 4488 [22] and IETF RFC 3515 [25] as updated by IETF
RFC 6665 [26] and IETF RFC 7647 [27], with the clarifications given below.
...
The MCPTT client populates the SIP REFER request as follows:
> 1) shall include the Request-URI set to the public service identity
> identifying the pre-established session on the MCPTT server serving the
> MCPTT user;
>
> 2) shall include the Refer-Sub header field with value \"false\" according
> to rules and procedures of IETF RFC 4488 [22];
>
> 3) shall include the Supported header field with value \"norefersub\"
> according to rules and procedures of IETF RFC 4488 [22];
>
> 4) shall include the option tag \"multiple-refer\" in the Require header
> field;
>
> 5) may include a P-Preferred-Identity header field in the SIP REFER request
> containing a public user identity as specified in 3GPP TS 24.229 [4];
>
> 6) shall include a P-Preferred-Service header field set to the ICSI value
> \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS
> 24.229 [4]), according to IETF RFC 6050 [9];
>
> 7) shall set the Refer-To header field of the SIP REFER request as specified
> in IETF RFC 3515 [25] with a Content-ID (\"cid\") Uniform Resource Locator
> (URL) as specified in IETF RFC 2392 [62] that points to an
> application/resource-lists MIME body as specified in IETF RFC 5366 [20], and
> with the Content-ID header field set to this \"cid\" URL.
>
> ...
>
> 9) for an initiation of a first-to-answer call, shall include in the
> application/resource-lists MIME body an \ element for each of the
> targeted MCPTT users, with each \ element containing a \"uri\"
> attribute set to the MCPTT ID of the targeted user, extended with hname
> \"body\" URI header field containing:
>
> NOTE 2: Characters that are not formatted as ASCII characters are escaped in
> the following URI header fields
>
> a) if the SDP parameters of the pre-established session do not contain a
> media-level section of a media-floor control entity, an application/sdp MIME
> body containing the SDP parameters of the pre-established session according
> to 3GPP TS 24.229 [4] with the clarification given in subclause 6.2.1. If
> implicit floor control is required and the pre-established session was not
> established with an implicit floor request, then the application/sdp MIME
> body shall contain an implicit floor request as specified in subclause 6.4;
> and
>
> b) an application/vnd.3gpp.mcptt-info MIME body with the \
> element set to \"first-to-answer\";
>
> ...
>
> 12) shall include a Target-Dialog header field as specified in IETF RFC 4538
> [23] identifying the pre-established session; and
>
> 13) if:
>
> a) implicit floor control is required;
>
> b) the pre-established session was not established with an implicit floor
> request; and
>
> c) location information has not yet been included in the SIP REFER request;
>
> then shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body
> with a \ element included in the \ root element.
The MCPTT client shall send the SIP REFER request towards the MCPTT server
according to 3GPP TS 24.229 [4].
Upon receiving a final SIP 2xx response to the SIP REFER request the MCPTT
client shall interact with media plane as specified in 3GPP TS 24.380 [5].
...
Upon receipt of a SIP re-INVITE request within the pre-established session
targeted by the sent SIP REFER request, the MCPTT client:
> 1) if the sent SIP REFER request was a request to originate a first-to-
> answer call:
>
> a) if the received SIP re-INVITE request contains an SDP offer including an
> a=key-mgmt attribute field with a \"mikey\" attribute value containing a
> MIKEY-SAKKE I_MESSAGE:
>
> i) shall extract the MCPTT ID of the sender of the SIP 200 (OK) response
> from the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS
> 33.180 [78];
>
> ii) shall convert the MCPTT ID to a UID as described in 3GPP TS 33.180 [78];
>
> iii) shall use the UID to validate the signature of the MIKEY-SAKKE
> I_MESSAGE as described in 3GPP TS 33.180 [78];
>
> ...
>
> vii) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully
> validated:
>
> A) shall extract and decrypt the encapsulated PCK using the originating
> user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and
>
> B) shall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180
> [78];
>
> NOTE 3: With the PCK successfully shared between the originating MCPTT
> client and the terminating MCPTT client, both clients are able to use
> SRTP/SRTCP to create an end-to-end secure session;
>
> ...
>
> 4) shall accept the SIP re-INVITE request and generate a SIP 200 (OK)
> response according to rules and procedures of 3GPP TS 24.229 [4];
>
> 5) shall include an SDP answer in the SIP 200 (OK) response to the SDP offer
> in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4], based
> upon the parameters already negotiated for the pre-established session; and
>
> 6) shall send the SIP 200 (OK) response towards the participating MCPTT
> function according to rules and procedures of 3GPP TS 24.229 [4].
[TS 24.380, clause 4.1.2.2]
For a pre-arranged group call, when the originator initiates the call setup
indicating the use of a pre-established session using SIP messages as
specified in 3GPP TS 24.379 [2], the participating MCPTT function (which
serves the originating MCPTT client) sends to the originating MCPTT client a
Connect message after the controlling MCPTT function accepts the initiation of
this call. After the reception of this Connect message the originating MCPTT
client sends an Acknowledgment message indicating that the connection is
accepted or indicating that the connection is not accepted. If the connection
is accepted by the originating MCPTT client, the floor control for this call
continues as specified in clause 6.
For a pre-arranged group call if the controlling MCPTT function as triggered
by an originating group member initiates a call as specified in 3GPP TS 24.379
[2], the participating MCPTT function which serves the terminating MCPTT
client sends a Connect message to all affiliated MCPTT clients of this group.
After the reception of the Connect message the terminating MCPTT client sends
an Acknowledgment message indicating that the connection is accepted or
indicating that the connection is not accepted. If the connection is accepted
by the terminating MCPTT client, the floor control for this call continues as
specified in clause 6.
> NOTE: If a terminating client does not have an available pre-established
> session, the call setup proceeds as in on-demand call setup as specified in
> 3GPP TS 24.379 [2].
...
For a private call the procedures for the originator are the same as for the
originator initiating a call for a pre-arranged call setup over a pre-
established session, with the difference that the recipient of the call is a
private user and not a pre-arranged group.
For a private call if the controlling MCPTT function as triggered by the
originator initiates a call as specified in 3GPP TS 24.379 [2], the
participating MCPTT function (which serves the terminating MCPTT client) sends
a Connect message to the terminating MCPTT client served by the participating
MCPTT function if this MCPTT client has an available pre-established session
and the commencement mode is automatic. If the commencement mode is manual the
terminating MCPTT client is invited using SIP procedures as specified in 3GPP
TS 24.379 [2].
[TS 24.380, clause 9.2.2.3.2]
Upon reception of a Connect message:
> 1\. if the MCPTT client accepts the incoming call the MCPTT client:
>
> a. shall send the Acknowledgement message with Reason Code field set to
> \'Accepted\';
>
> b. shall use only the media streams of the pre-established session which are
> indicated as used in the associated call session Media Streams field, if the
> Connect contains a Media Streams field;
>
> c. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\' as specified in subclause 6.2.4; and
>
> d. shall enter the \'U: Pre-established session in use\' state; or
##### 6.2.22.3 Test description {#test-description-65 .H6}
##### 6.2.22.3.1 Pre-test conditions {#pre-test-conditions-65 .H6}
##### System Simulator: {#system-simulator-65 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-65 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-65 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- The MCPTT User is authorized to initiate first-to-answer call: \ element of the \ element of the
\ element is present in the MCPTT user profile document and is set to
\"true\".
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.22.3.2 Test procedure sequence {#test-procedure-sequence-65 .H6}
Table 6.2.22.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of an | | | | | | | MCPTT | | | | | | | first- | | | | | | | to-answer | | | | | | | call with | | | | | | | targeted | | | | | | | users B | | | | | | | and C | | | | | | | using the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2a1-4 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | esta | | | | | | | blishment | | | | | | | using a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3 | | | | | | | A.3.3-1?\ | | | | | | | NOTE: The | | | | | | | UE sends | | | | | | | a SIP | | | | | | | REFER | | | | | | | which is | | | | | | | responded | | | | | | | with a | | | | | | | SIP 200 | | | | | | | OK. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5-6 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 7 | The SS | \ | SIP 100 | - | - | | | (MCPTT | | (Trying) | | | | | client) | | | | | | | sends a | | | | | | | SIP 100 | | | | | | | (Trying). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Check: | --> | SIP 200 | 3 | P | | | Does the | | (OK) | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP 200 | | | | | | | (OK)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10 | The SS | \ ...
>
> 5) if an end-to-end security context needs to be established and if the
> \ in the application/vnd.3gpp.mcptt-info+xml MIME body of the
> incoming SIP INVITE request is set to \"first-to-answer\" then:
>
> a) if necessary, shall instruct the key management client to request keying
> material from the key management server as described in 3GPP TS 33.180 [78];
>
> b) shall use the keying material to generate a PCK as described in 3GPP TS
> 33.180 [78];
>
> c) shall use the PCK to generate a PCK-ID with the four most significant
> bits set to \"0001\" to indicate that the purpose of the PCK is to protect
> private call communications and with the remaining twenty eight bits being
> randomly generated as described in 3GPP TS 33.180 [78];
>
> d) shall encrypt the PCK to a UID associated to the MCPTT client using the
> MCPTT ID and KMS URI of the originator of the SIP INVITE request as
> determined by the procedures of subclause 6.2.8.3.9 and a time related
> parameter as described in 3GPP TS 33.180 [78];
>
> e) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and
> PCK-ID as specified in 3GPP TS 33.180 [78];
>
> f) shall add the MCPTT ID of the MCPTT user to the initiator field (IDRi) of
> the I_MESSAGE as described in 3GPP TS 33.180 [78]; and
>
> NOTE 4: The initiator of the MIKEY-SAKKE I_MESSAGE is in this case the
> terminating client from the perspective of the call.
>
> g) shall sign the MIKEY-SAKKE I_MESSAGE using the MCPTT user\'s signing key
> provided in the keying material together with a time related parameter, and
> add this to the MIKEY-SAKKE payload, as described in 3GPP TS 33.180 [78];
>
> ...
>
> 8) if the \ in the application/vnd.3gpp.mcptt-info+xml MIME
> body of the incoming SIP INVITE request is set to \"first-to-answer\":
>
> a) shall notify the user of the incoming call;
>
> b) shall not forward the first-to-answer call;
>
> c) if the MCPTT user is busy on another call, shall send a SIP 486 (Busy
> Here) to the SIP INVITE request according to 3GPP TS 24.229 [4] and not
> continue with any further steps in this subclause; and
>
> d) if the MCPTT user does not answer the call within a time decided by the
> client implementation, the MCPTT client shall send a SIP 480 (Temporarily
> Unavailable) to the SIP INVITE request according to 3GPP TS 24.229 [4] and
> not continue with any further steps in this subclause;
>
> NOTE 5: In the conditions below, as the SIP layer implements the actions for
> commencement mode, it is assumed that the Answer-Mode or Priv-Answer-Mode
> header fields are set correctly in line with the setting of the \ type> in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming
> SIP INVITE request.
>
> ...
>
> 10) shall perform the manual commencement procedures specified in subclause
> 6.2.3.2.1 if either of the following conditions are met:
>
> ...
[TS 24.379, clause 11.1.1.2.2.2]
The MCPTT client shall follow the procedures for termination of multimedia
sessions as specified in clause 11.1.1.2.1.2 with the following
clarifications:
> ...
[TS 24.379, clause 6.2.3.2.1]
When performing the manual commencement mode procedures:
> 1) if the MCPTT user declines the MCPTT session invitation the MCPTT client
> shall send a SIP 480 (Temporarily Unavailable) response towards the MCPTT
> server with the warning text set to: \"110 user declined the call
> invitation\" in a Warning header field as specified in subclause 4.4, and
> not continue with the rest of the steps in this subclause.
The MCPTT client:
> 1) shall accept the SIP INVITE request and generate a SIP 180 (Ringing)
> response according to rules and procedures of 3GPP TS 24.229 [4];
>
> 2) shall include the option tag \"timer\" in a Require header field of the
> SIP 180 (Ringing) response;
>
> 3) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 180 (Ringing) response;
>
> 4) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 180 (Ringing) response; and
>
> 5) shall send the SIP 180 (Ringing) response to the MCPTT server.
When sending the SIP 200 (OK) response to the incoming SIP INVITE request, the
MCPTT client shall follow the procedures in subclause 6.2.3.1.1.
When NAT traversal is supported by the MCPTT client and when the MCPTT client
is behind a NAT, generation of SIP responses is done as specified in this
subclause and as specified in IETF RFC 5626 [15].
[TS 24.379, clause 6.2.3.1.1]
> 1) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
> according to rules and procedures of 3GPP TS 24.229 [4];
>
> 2) shall include the option tag \"timer\" in a Require header field of the
> SIP 200 (OK) response;
>
> 3) shall include the g.3gpp.mcptt media feature tag in the Contact header
> field of the SIP 200 (OK) response;
>
> 4) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of
> the SIP 200 (OK) response;
>
> 5) shall include the Session-Expires header field in the SIP 200 (OK)
> response and start the SIP session timer according to IETF RFC 4028 [7]. The
> \"refresher\" parameter in the Session-Expires header field shall be set to
> \"uas\";
>
> 6) shall, if the incoming SIP INVITE request contains a Replaces header
> field, include in the SDP answer in the SIP 200 (OK) response to the SDP
> offer the parameters used for the pre-established session identified by the
> contents of the Replaces header field;
>
> ...
>
> 8) shall send the SIP 200 (OK) response towards the MCPTT server according
> to rules and procedures of 3GPP TS 24.229 [4];
>
> 9) shall, if the incoming SIP INVITE request contains a Replaces header
> field, release the pre-established session identified by the contents of the
> Replaces header field; and
>
> 10) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
> subclause 6.2.
When NAT traversal is supported by the MCPTT client and when the MCPTT client
is behind a NAT, generation of SIP responses is done as specified in this
subclause and as specified in IETF RFC 5626 [15].
[TS 24.379, clause 6.2.5.1]
When the MCPTT client wants to release an MCPTT session using on-demand
session signalling, the MCPTT client:
> 1) if the session is in the process of being established, shall send a SIP
> CANCEL request according to 3GPP TS 24.229 [4] and skip the rest of the
> steps;
>
> 2) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 3) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 4) shall set the Request-URI to the MCPTT session identity to release; and
>
> 5) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
##### 6.2.23.3 Test description {#test-description-66 .H6}
##### 6.2.23.3.1 Pre-test conditions {#pre-test-conditions-66 .H6}
##### System Simulator: {#system-simulator-66 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-66 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-66 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- The MCPTT User is authorized to participate in private calls: the \ element of the \ element is present in
the MCPTT user profile document and is set to \"true\".
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.23.3.2 Test procedure sequence {#test-procedure-sequence-66 .H6}
Table 6.2.23.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX CT | | | | | | | private | | | | | | | call | | | | | | | est | | | | | | | ablishment | | | | | | | with | | | | | | | manual | | | | | | | comm | | | | | | | encement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.6.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a | | | | | | | first | | | | | | | -to-answer | | | | | | | call? | | | | | +------------+------------+------------+---------+---------+----+ | 2-4 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 5 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 6 | The UE | - | - | 3 | P | | | (MCPTT | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.10.3-1. | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.23.3.3 Specific message contents {#specific-message-contents-66 .H6}
Table 6.2.23.3.3-1: SIP INVITE from the SS (Step 1, Table 6.2.23.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition FIRST-TO-ANSWER
* * *
Information Element Value/remark Comment Reference Condition **Replaces** RFC
3891 [117] TS 24.379 [9] clause 6.3.2.2  
callid callid of the targeted pre-established session  
replaces-params  
from-tag to-tag of the targeted pre-established session  
to-tag from-tag of the targeted pre-established session  
**Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.23.3.3-2  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.23.3.3-3
Table 6.2.23.3.3-2: SDP Message in SIP INVITE (Table 6.2.23.3.3-1)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.3.1.2-1, | | | | | | condition | | | | | | FIRST_SD | | | | | | P_FROM_SS, | | | | | | PR | | | | | | E_ESTABLISH | | | | | | ED_SESSION, | | | | | | WITHOUT_ | | | | | | FLOORCONTROL | | | | | | (NOTE 1) | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Session | | | | | | de | | | | | | scription:** | | | | | +--------------+--------------+--------------+-----------+-----------+ | Origin | | | | | +--------------+--------------+--------------+-----------+-----------+ | sess-id | \"87654321\" | different | | | | | | value than | | | | | | for | | | | | | pre | | | | | | -established | | | | | | session | | | +--------------+--------------+--------------+-----------+-----------+ | sess-version | \"87654321\" | different | | | | | | value than | | | | | | for | | | | | | pre | | | | | | -established | | | | | | session | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | | Media | | | | descri | | description | | | | ption[1]** | | for audio | | | +--------------+--------------+--------------+-----------+-----------+ | media | | m= line | | | | description | | | | | | | | media = | | | | | | audio | | | +--------------+--------------+--------------+-----------+-----------+ | fmt | same value | | | | | | as used for | | | | | | pre | | | | | | -established | | | | | | session | | | | +--------------+--------------+--------------+-----------+-----------+ | NOTE 1: | | | | | | Without | | | | | | floor | | | | | | control is | | | | | | chosen for | | | | | | simplifying | | | | | | the test | | | | | | sequence and | | | | | | to check | | | | | | that the | | | | | | client does | | | | | | not copy the | | | | | | media | | | | | | description | | | | | | for media | | | | | | control as | | | | | | negotiated | | | | | | for the | | | | | | pre | | | | | | -established | | | | | | session to | | | | | | the SDP | | | | | | answer for | | | | | | the new | | | | | | session. | | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.2.23.3.3-3: MCPTT-Info in SIP INVITE (Table 6.2.23.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition FIRST-TO-ANSWER
* * *
Table 6.2.23.3.3-4: Void
Table 6.2.23.3.3-5: SIP 200 (OK) from the UE (Step 1, Table 6.2.23.3.2-1;\
step 6, TS 36.579-1 [2], Table 5.3.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.2.23.3.3-6  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.23.3.3-6A
Table 6.2.23.3.3-6: SDP Message in SIP 200 (OK) (Table 6.2.23.3.3-5)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.3.1.1-1, | | | | | | condition | | | | | | WIT | | | | | | H_SECURITY, | | | | | | PR | | | | | | E_ESTABLISH | | | | | | ED_SESSION, | | | | | | WITHOUT_ | | | | | | FLOORCONTROL | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Session | | | | | | de | | | | | | scription:** | | | | | +--------------+--------------+--------------+-----------+-----------+ | Origin | | o= line | | | +--------------+--------------+--------------+-----------+-----------+ | sess-id | different | | | | | | value than | | | | | | used in the | | | | | | SDP offer | | | | | | for | | | | | | e | | | | | | stablishment | | | | | | of the | | | | | | pre | | | | | | -established | | | | | | session | | | | +--------------+--------------+--------------+-----------+-----------+ | sess-version | any allowed | | | | | | value | | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | | Media | | | | descri | | description | | | | ption[1]** | | for audio | | | +--------------+--------------+--------------+-----------+-----------+ | media | same values | m= line | | | | description | as in in the | | | | | | SDP offer | media = | | | | | for | audio | | | | | e | | | | | | stablishment | Especially | | | | | of the | port and fmt | | | | | pre | shall be the | | | | | -established | same | | | | | session | | | | +--------------+--------------+--------------+-----------+-----------+ | Bandwidth | same values | | | | | | as in in the | | | | | | SDP offer | | | | | | for | | | | | | e | | | | | | stablishment | | | | | | of the | | | | | | pre | | | | | | -established | | | | | | session | | | | +--------------+--------------+--------------+-----------+-----------+ | media | same rtpmap | a= line | | | | attribute | attribute as | | | | | | in in the | attribute = | | | | | SDP offer | rtpmap | | | | | for | | | | | | e | | | | | | stablishment | | | | | | of the | | | | | | pre | | | | | | -established | | | | | | session | | | | +--------------+--------------+--------------+-----------+-----------+ | media | same fmtp | a= line | | | | attribute | attribute as | | | | | | in in the | attribute = | | | | | SDP offer | fmtp | | | | | for | | | | | | e | | | | | | stablishment | | | | | | of the | | | | | | pre | | | | | | -established | | | | | | session | | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | Not present | Media | | | | descri | | description | | | | ption[2]** | | for media | | | | | | control | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.2.23.3.3-6A: MCPTT-Info in SIP 200 (OK) (Table 6.2.23.3.3-5)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE-RSP
* * *
Table 6.2.23.3.3-7-8: Void
6.2.24 On-network / Private call / Remotely initiated private call / Client
Originated (CO)
##### 6.2.24.1 Test Purpose (TP) {#test-purpose-tp-67 .H6}
##### (1) {#section-196 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate Remotely initiated private call and to
participate in private calls }
ensure that {
**when** { UE (MCPTT User) requests the establishment of a remotely initiated
private call to a third party }
**then** { UE (MCPTT Client) sends a SIP MESSAGE message requesting the
establishment of a remotely initiated private call }
}
##### (2) {#section-197 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate Remotely initiated private call and to
participate in private calls, and, having requested the establishment of a
remotely initiated private call }
ensure that {
**when** { UE (MCPTT User) receives a SIP MESSAGE message indicating the
outcome of the requested establishment of a remotely initiated private call }
**then** { UE (MCPTT Client) sends a SIP OK message to confirm the reception
of the SIP MESSAGE }
}
##### 6.2.24.2 Conformance requirements {#conformance-requirements-67 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.1.7.2.1. Unless otherwise stated these are
Rel-15 requirements.
[TS 24.379, clause 11.1.7.2.1]
Upon receiving a request from the MCPTT to send a remotely initiated private
call request to the remote MCPTT user to originate a private call to an
identified MCPTT user, the MCPTT client:
> 1) if:
>
> a) the \ element of the \
> element is not present in the requesting MCPTT user\'s MCPTT user profile
> document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is
> set to a value of \"false\";
>
> ...
>
> 2) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229
> [4] and IETF RFC 3428 [33] with the following clarifications:
>
> a) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP MESSAGE request;
>
> b) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> c) may include a P-Preferred-Identity header field in the SIP MESSAGE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> d) shall include an application/vnd.3gpp.mcptt-info+xml MIME body as
> specified in clause F.1 with the \ element containing the
> \ element containing:
>
> i) the \ element set to the MCPTT ID of the
> identified MCPTT user of the remotely initiated private call; and
>
> ii) an \ element containing:
>
> A) the \ element set to a value of \"remotely-initiated-
> private-call-request\";
>
> B) the \ element set to a value of \"true\" if the
> requesting MCPTT user has indicated that the remote MCPTT user be notified
> of the remotely initiated private call request; and
>
> C) the \ element set to a value of \"false\" if the
> requesting MCPTT user has indicated that the remote MCPTT user not be
> notified of the remotely initiated private call request;
>
> e) shall insert in the SIP MESSAGE request a MIME resource-lists body with
> the MCPTT ID of the remote MCPTT user, according to rules and procedures of
> IETF RFC 5366 [20]; and
>
> f) shall set the Request-URI to the public service identity identifying the
> participating MCPTT function serving the MCPTT user; and
>
> 3) shall send the SIP MESSAGE request towards the MCPTT server according to
> rules and procedures of 3GPP TS 24.229 [4].
...
Upon receiving a \"SIP MESSAGE request for remotely initiated private call
response for terminating client\", the MCPTT client:
> 1) shall determine the success or failure of the sent remotely initiated
> private call request from the value of the \ outcome> element contained in the \ element of the \
> element of the \ element of the application/vnd.3gpp.mcptt-
> info+xml MIME body included in the received SIP MESSAGE request; and
>
> 2) should indicate to the requesting MCPTT user the success or failure of
> the sent remotely initiated private call request.
##### 6.2.24.3 Test description {#test-description-67 .H6}
##### 6.2.24.3.1 Pre-test conditions {#pre-test-conditions-67 .H6}
##### System Simulator: {#system-simulator-67 .H6}
\- SS (MCPTT server)
\- For the underlining \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-67 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-67 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The MCPTT User is authorized to initiate Remotely initiated private call:
the \ element of the \
element is present in the MCPTT user profile document and is set to \"true\".
\- The MCPTT User is authorized to participate in private calls: the \ element of the \ element is present in
the MCPTT user profile document and is set to \"true\".
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.24.3.2 Test procedure sequence {#test-procedure-sequence-67 .H6}
Table 6.2.24.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call from | | | | | | | user B to | | | | | | | user C. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2-4 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.32.3-1 | | | | | | | to request | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of a | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call? | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Wait for 3 | - | - | - | - | | | sec (an | | | | | | | arbitrary | | | | | | | value to | | | | | | | simulate | | | | | | | the time | | | | | | | needed for | | | | | | | the | | | | | | | est | | | | | | | ablishment | | | | | | | of the | | | | | | | remote | | | | | | | private | | | | | | | call). | | | | | +------------+------------+------------+---------+---------+----+ | 6-8 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-4 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | confirming | | | | | | | the | | | | | | | progress | | | | | | | of the | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call? | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The UE is | | | | | | | expected | | | | | | | to | | | | | | | determine | | | | | | | the | | | | | | | success or | | | | | | | failure of | | | | | | | the sent | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call | | | | | | | request. | | | | | | | Following | | | | | | | this the | | | | | | | UE client | | | | | | | may | | | | | | | indicate | | | | | | | to the | | | | | | | requesting | | | | | | | MCPTT user | | | | | | | the | | | | | | | success or | | | | | | | failure of | | | | | | | the sent | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call | | | | | | | request. | | | | | | | This is | | | | | | | not | | | | | | | verified | | | | | | | because | | | | | | | the | | | | | | | indication | | | | | | | to the | | | | | | | User is | | | | | | | not | | | | | | | mandated. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.24.3.3 Specific message contents {#specific-message-contents-67 .H6}
Table 6.2.24.3.3-1: SIP MESSAGE from the UE (Step 3, Table 6.2.24.3.2-1;\ Step
2, TS 36.579-1 [2], Table 5.3.32.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1 condition RESOURCE_LISTS
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body As described in Table 6.2.24.3.3-2
Table 6.2.24.3.3-2: MCPTT-Info in SIP MESSAGE (Table 6.2.24.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-called-party-id Encrypted \ with mcpttURI set to
px_MCPTT_ID_User_C Encrypted element as described in TS 36.579-1 [2] Table
5.5.3.2.1-1A  
anyExt  
request-type \"remotely-initiated-private-call-request\"  
notify-remote-user Any allowed value
Table 6.2.24.3.3-3: SIP MESSAGE from the SS (Step 6, Table 6.2.24.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.24.3.3-4
Table 6.2.24.3.3-4: MCPTT-Info in SIP MESSAGE (Table 6.2.24.3.3-3)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-called-party-id Encrypted \ with mcpttURI set to
px_MCPTT_ID_User_C Encrypted element as described in TS 36.579-1 [2] Table
5.5.3.2.2-1A  
anyExt  
response-type \"remotely-initiated-private-call-response\"  
remotely-initiated-call-outcome \"success\"
6.2.25 On-network / Private call / Remotely initiated private call / On-demand
session / Client Terminated (CT)
##### 6.2.25.1 Test Purpose (TP) {#test-purpose-tp-68 .H6}
##### (1) {#section-198 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate private calls, **and** , according to local
policy on-demand sessions are to be used for remotely initiated private calls
}
ensure that {
**when** { UE (MCPTT Client) receives a request for establishment of an MCPTT
remotely initiated private call with the MCPTT ID of the identified MCPTT user
of the remotely initiated private call set to the ID of the MCPTT user
requesting the call initiation, **and** , the \ element
contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in
the received SIP MESSAGE request is set to a value of \"false\" }
**then** { UE (MCPTT Client) initiates private call establishment to the
requesting User using on-demand session, **and** , does not notify the user
that a remotely initiated private call request to call the identified MCPTT
user has been received, **and** , when a SIP 180 (Ringing) response is
received to the sent SIP INVITE request, does not give any indication to the
remote MCPTT user that the remotely initiated private call origination is in
progress, **and** , does not sent SIP MESSAGE back to the MCPTT user
requesting the call initiation }
}
##### (2) {#section-199 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate private calls, **and** , according to local
policy on-demand sessions are to be used for remotely initiated private calls
}
ensure that {
**when** { UE (MCPTT Client) receives a request for establishment of an MCPTT
remotely initiated private call with the MCPTT ID of the identified MCPTT user
of the remotely initiated private call set to ID different to the ID of the
MCPTT user requesting the call initiation }
**then** { UE (MCPTT Client) initiates private call establishment to the
requested identified MCPTT user using on-demand session, **and** , sends SIP
MESSAGE back to the MCPTT user requesting the call initiation to confirm the
private call initiation }
}
##### 6.2.25.2 Conformance requirements {#conformance-requirements-68 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.1.7.2.2, 11.1.1.2.1.1. Unless otherwise
stated these are Rel-15 requirements.
[TS 24.379, clause 11.1.7.2.2]
Upon receiving a \"SIP MESSAGE request for remotely initiated private call
request for terminating client\", the MCPTT client:
> ...
>
> 2) shall extract the MCPTT ID of the identified MCPTT user from the \ called-party-id> element contained in the \ element of the
> \ element contained in the application/vnd.3gpp.mcptt-info+xml
> MIME body contained in the received SIP MESSAGE request;
>
> 3) if according to local policy on-demand sessions are to be used for
> remotely initiated private calls, shall invoke the procedures of sclause
> 11.1.1.2.1.1 to originate an MCPTT private call to the identified MCPTT user
> with the following clarifications:
>
> a) if the \ element contained in the
> application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP
> MESSAGE request is set to a value of \"false\":
>
> i) shall not indicate to the remote MCPTT user that a remotely initiated
> private call request to call the identified MCPTT user has been received;
> and
>
> ii) if a SIP 180 (Ringing) response or SIP 183 (Session Progress) response
> is received to the to the sent SIP INVITE request, shall not give any
> indication to the remote MCPTT user that the remotely initiated private call
> origination is in progress; and
>
> ...
Upon completion of the procedures of clause 11.1.1.2.1.1 or clause
11.1.1.2.2.1, the MCPTT client:
> 1) if:
>
> a) the MCPTT ID of the identified MCPTT user is identical to the \ calling-user-id> element contained in the \ element of the
> \ element contained in the application/vnd.3gpp.mcptt-info+xml
> MIME body contained in the received SIP MESSAGE request: and
>
> b) the procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1 were
> successful in originating an MCPTT private call to the identified MCPTT
> user;
>
> then:
>
> a) shall skip the remaining steps of the current clause;
>
> NOTE: In this case, it is not necessary to send a response to the sender of
> the remotely initiated private call request as the sender and the
> terminating party of the successful private call origination are the same
> user and will be aware of the request\'s outcome.
>
> 2) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229
> [4] and IETF RFC 3428 [33] with the following clarifications:
>
> a) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP MESSAGE request;
>
> b) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> c) may include a P-Preferred-Identity header field in the SIP MESSAGE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> d) shall include in an application/resource-lists+xml MIME body the MCPTT ID
> contained in the \ element in the application/
> vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request; and
>
> e) shall include an application/vnd.3gpp.mcptt-info+xml MIME body as
> specified in clause F.1 with the \ element containing the
> \ element containing:
>
> i) the \ set to the MCPTT ID of the identified MCPTT
> user called by the remote MCPTT user; and
>
> ii) an \ element containing:
>
> A) the \ element set to a value of \"remotely-initiated-
> private-call-response\";
>
> B) if the procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1 were
> successful in originating an MCPTT private call to the identified MCPTT
> user, a \ element set to a value of
> \"success\"; and
>
> ...
>
> 3) shall set the Request-URI to the public service identity identifying the
> participating MCPTT function serving the MCPTT user identified by the MCPTT
> ID contained in the \ element in the application/
> vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request; and
>
> 4) shall send the SIP MESSAGE request according to rules and procedures of
> 3GPP TS 24.229 [4].
[TS 24.379, clause 11.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT private call
the MCPTT client shall generate an initial SIP INVITE request by following the
UE originating session procedures specified in 3GPP TS 24.229 [4], with the
clarifications given below.
The MCPTT client:
> 1) shall set the Request-URI of the SIP INVITE request to a public service
> identity of the participating MCPTT function serving the MCPTT user;
>
> ...
>
> 4) may include a P-Preferred-Identity header field in the SIP INVITE request
> containing a public user identity as specified in 3GPP TS 24.229 [4];
>
> 5) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 6) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 7) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 8) shall include an Accept-Contact header field with the media feature tag
> g.3gpp.icsi-ref contain with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\"
> according to IETF RFC 3841 [6];
>
> 9) for the establishment of a private call shall insert in the SIP INVITE
> request a MIME resource-lists body with the MCPTT ID of the invited MCPTT
> user, according to rules and procedures of IETF RFC 5366 [20];
>
> ...
>
> 11) if an end-to-end security context needs to be established and if the
> MCPTT user is initiating a private call then:
>
> a) if necessary, shall instruct the key management client to request keying
> material from the key management server as described in 3GPP TS 33.180 [78];
>
> b) shall use the keying material to generate a PCK as described in 3GPP TS
> 33.180 [78];
>
> c) shall use the PCK to generate a PCK-ID with the four most significant
> bits set to \"0001\" to indicate that the purpose of the PCK is to protect
> private call communications and with the remaining twenty eight bits being
> randomly generated as described in 3GPP TS 33.180 [78];
>
> d) shall encrypt the PCK to a UID associated to the MCPTT client using the
> MCPTT ID and KMS URI of the invited user as determined by the procedures of
> clause 6.2.8.3.9 and a time related parameter as described in 3GPP TS 33.180
> [78];
>
> e) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and
> PCK-ID as specified in 3GPP TS 33.180 [78]; and
>
> g) shall add the MCPTT ID of the originating MCPTT to the initiator field
> (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]; and
>
> f) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user\'s
> signing key provided in the keying material together with a time related
> parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
> 33.180 [78];
>
> 12) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarification given in clause 6.2.1 and with a media stream of the offered
> media-floor control entity;
>
> 13) if implicit floor control is required, shall comply with the conditions
> specified in clause 6.4 and:
>
> a) if the \ element of the \
> element of the MCPTT user profile document identified by the MCPTT ID of the
> calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484
> [50]) is set to a value of \"true\"; and
>
> b) if location information has not yet been included in the SIP re-INVITE
> request;
>
> then shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body
> with a \ element included in the \ root element;
>
> 14) if the MCPTT user is initiating a private call then:
>
> a) if force of automatic commencement mode at the invited MCPTT client is
> requested by the MCPTT user, shall include in the SIP INVITE request a Priv-
> Answer-Mode header field with the value \"Auto\" according to the rules and
> procedures of IETF RFC 5373 [18];
>
> b) if force of automatic commencement mode at the invited MCPTT client is
> not requested by the MCPTT user and:
>
> i) if automatic commencement mode at the invited MCPTT client is requested
> by the MCPTT user, shall include in the SIP INVITE request an Answer-Mode
> header field with the value \"Auto\" according to the rules and procedures
> of IETF RFC 5373 [18]; and
>
> ii) if manual commencement mode at the invited MCPTT client is requested by
> the MCPTT user, shall include in the SIP INVITE request an Answer-Mode
> header field with the value \"Manual\" according to the rules and procedures
> of IETF RFC 5373 [18]; and
>
> c) shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ element containing the \ element with the
> \ element set to a value of \"private\";
>
> ...
>
> 17) shall send SIP INVITE request towards the MCPTT server according to 3GPP
> TS 24.229 [4].
##### 6.2.25.3 Test description {#test-description-68 .H6}
##### 6.2.25.3.1 Pre-test conditions {#pre-test-conditions-68 .H6}
##### System Simulator: {#system-simulator-68 .H6}
\- SS (MCPTT server)
\- For the underlining \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-68 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-68 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The MCPTT User is authorized to initiate private calls: the \ element of the \ element is present in the MCPTT user
profile document and is set to \"true\".
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.25.3.2 Test procedure sequence {#test-procedure-sequence-68 .H6}
Table 6.2.25.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1a1 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 2-3A | Steps | - | - | - | - | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.33.3-1 | | | | | | | are | | | | | | | performed | | | | | | | r | | | | | | | equesting | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 5-7 | Check: | --> | SIP | 1 | P | | | Does the | | INVITE | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 2--4 of | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | private | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | with | | | | | | | manual | | | | | | | comme | | | | | | | ncement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.35.3-1 | | | | | | | r | | | | | | | equesting | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | private | | | | | | | call? | | | | | | | | | | | | | | NOTE: Any | | | | | | | SIP | | | | | | | INVITE | | | | | | | content | | | | | | | in regard | | | | | | | to | | | | | | | Automatic | | | | | | | Com | | | | | | | mencement | | | | | | | Mode, | | | | | | | Force of | | | | | | | automatic | | | | | | | comm | | | | | | | encement, | | | | | | | and Floor | | | | | | | Control | | | | | | | shall be | | | | | | | accepted. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Check: | - | - | 1 | F | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify | | | | | | | the user | | | | | | | that a | | | | | | | remotely | | | | | | | initiated | | | | | | | call | | | | | | | request | | | | | | | has been | | | | | | | received | | | | | | | causing | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9-10 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 5--6 of | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | private | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | with | | | | | | | manual | | | | | | | comme | | | | | | | ncement\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.35.3-1 | | | | | | | to | | | | | | | complete | | | | | | | the call | | | | | | | estab | | | | | | | lishment? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11 | Check: | --> | SIP | 1 | F | | | Does, in | | MESSAGE | | | | | the next | | | | | | | 5 sec, | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | c | | | | | | | onfirming | | | | | | | the | | | | | | | progress | | | | | | | of the | | | | | | | MCPTT | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | The | - | - | - | - | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.12.3-1 | | | | | | | is | | | | | | | p | | | | | | | erformed. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13a1-15 | Steps | - | - | - | - | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.33.3-1 | | | | | | | are | | | | | | | performed | | | | | | | r | | | | | | | equesting | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16-16C | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-5 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5 | | | | | | | .3A.1.3-1 | | | | | | | to** | | | | | | | establish | | | | | | | a private | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 17 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.32.3-1 | | | | | | | c | | | | | | | onfirming | | | | | | | the | | | | | | | progress | | | | | | | of the | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 18 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 19 | The | - | - | - | - | | | procedure | | | | | | | \'MCX CT | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.12.3-1 | | | | | | | is | | | | | | | p | | | | | | | erformed. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 6.2.25.3.3 Specific message contents {#specific-message-contents-68 .H6}
Table 6.2.25.3.3-1: SIP MESSAGE from the SS (Step 2, Table 6.2.25.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.25.3.3-2
Table 6.2.25.3.3-2: MCPTT-Info in SIP MESSAGE (Table 6.2.25.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition
mcpttinfo
mcptt-Params
mcptt-calling-user-id Encrypted \ with mcpttURI set to
px_MCPTT_ID_User_B requesting MCPTT user (NOTE 1);\  
encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.2-1A
mcptt-called-party-id Encrypted \ with mcpttURI set to
px_MCPTT_ID_User_B identified MCPTT user (NOTE 1);\  
encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.2-1A
anyExt
request-type \"remotely-initiated-private-call-request\"
notify-remote-user \"false\"
NOTE 1: The MCPTT-Info requests a remotely initiated private call with the
following roles terms of TS 24.379 [9] clause 11.1.7.1:\  
\- requesting MCPTT user: px_MCPTT_ID_User_B (SS)\  
\- remote MCPTT user: px_MCPTT_ID_User_A initiating the call (UE)\  
(contained in the \ per default)\  
\- identified MCPTT user: px_MCPTT_ID_User_B (SS; same as requesting MCPTT
user)\  
\  
As requesting and identified MCPTT user are the same, the UE shall not send a
SIP MESSAGE at step 11 (TS 24.379 [9] clause 11.1.7.2.2).
* * *
Table 6.2.25.3.3-3: SIP INVITE from the UE (Steps 5, 16, Table 6.2.25.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.1.3-1;\ step 2, TS 36.579-1 [2] Table
5.3.35.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition **Answer-Mode**
any value if presen NOTE 1  
**Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.2.25.3.3-3A  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.1.3.3-1B  
NOTE 1: TS 24.379 [9] clause 11.1.7 does not say anything about the
commencement mode to be used for remotely initiated private call
Table 6.2.25.3.3-3A: SDP message in SIP INVITE (Table 6.2.25.3.3-3)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], Table | | | | | | 5.5.3.1.1-1, | | | | | | condition | | | | | | P | | | | | | RIVATE-CALL, | | | | | | INITIAL | | | | | | _SDP_OFFER | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | **Media | optional |** Media | | | | descri | (NOTE 1) | description | | | | ption[2]**| | for media | | | | | | control** | | | +--------------+--------------+--------------+-----------+-----------+ | media | | a= line | | | | attribute | | | | | | | | attribute = | | | | | | fmtp | | | +--------------+--------------+--------------+-----------+-----------+ | fmtp | | | | | +--------------+--------------+--------------+-----------+-----------+ | format | | | | | | specific | | | | | | parameters | | | | | +--------------+--------------+--------------+-----------+-----------+ | mc_impli | optional | | | | | cit_request | (NOTE 1) | | | | +--------------+--------------+--------------+-----------+-----------+ | NOTE 1: | | | | | | Whether the | | | | | | UE (MCPTT | | | | | | client) | | | | | | requests a | | | | | | call with or | | | | | | without | | | | | | Floor | | | | | | control | | | | | | depends on | | | | | | imp | | | | | | lementation. | | | | | | The SS shall | | | | | | respect the | | | | | | type of | | | | | | Floor | | | | | | control | | | | | | being | | | | | | requested, | | | | | | if requested | | | | | | (see Table | | | | | | 6. | | | | | | 2.25.3.3-3C) | | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.2.25.3.3-3B: MCPTT-Info in SIP INVITE (Table 6.2.25.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition INVITE_REFER,
PRIVATE-CALL
* * *
Table 6.2.25.3.3-3C: SIP 200 (OK) from the SS (Steps 9, 16B Table
6.2.25.3.2-1;\ step 4, TS 36.579-1 [2] Table 5.3A.1.3-1;\ step 4, TS 36.579-1
[2] Table 5.3.35.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP message SDP message as described in Table 6.2.25.3.3-3D
Table 6.2.25.3.3-3D: SDP Message in SIP 200 (OK) (Table 6.2.25.3.3-3B)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER
* * *
Information Element Value/remark Comment Reference Condition **Media
description [2]** Media description for media control WITH_MEDIACONTROL
Condition Explanation
* * *
WITH_MEDIACONTROL The SDP offer sent by the UE at step 5 (Table 6.2.25.3.3-3A)
or step 16 (Table 6.2.25.3.3-6) contains a media description for media
control. In this case, independent from whether or not the UE implicitly
requests a grant, neither IMPLICIT_GRANT_REQUESTED nor IMPLICIT_FLOOR_GRANTED
shall be applied
Table 6.2.25.3.3-4: SIP MESSAGE from the SS (Step 14, Table 6.2.25.3.2-1;\
step 2, TS 36.579-1 [2], Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.25.3.3-5
Table 6.2.25.3.3-5: MCPTT-Info in SIP MESSAGE (Table 6.2.25.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition
mcpttinfo
mcptt-Params
mcptt-calling-user-id Encrypted \ with mcpttURI set to
px_MCPTT_ID_User_C requesting MCPTT user (NOTE 1);\  
encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.2-1A
mcptt-called-party-id Encrypted \ with mcpttURI set to
px_MCPTT_ID_User_B identified MCPTT user (NOTE 1);\  
encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.2-1A
anyExt
request-type \"remotely-initiated-private-call-request\"
notify-remote-user \"true\"
NOTE 1: The MCPTT-Info requests a remotely initiated private call with the
following roles terms of TS 24.379 [9] clause 11.1.7.1:\  
\- requesting MCPTT user: px_MCPTT_ID_User_C (SS)\  
\- remote MCPTT user: px_MCPTT_ID_User_A initiating the call (UE)\  
(contained in the \ perdefault)\  
\- identified MCPTT user: px_MCPTT_ID_User_B (SS; same as requesting MCPTT
user)\  
As requesting and identified MCPTT user are different, the UE shall send a SIP
MESSAGE at step 17 (TS 24.379 [9] clause 11.1.7.2.2)
* * *
Table 6.2.25.3.3-6: Void
Table 6.2.25.3.3-7: SIP MESSAGE from the UE(Step 17, Table 6.2.25.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.32.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.25.3.3-8
Table 6.2.25.3.3-8: MCPTT-Info in SIP MESSAGE (Table 6.2.25.3.3-7)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1
* * *
Information Element Value/remark Comment Reference Condition
mcpttinfo
mcptt-Params
mcptt-called-party-id Encrypted \ with mcpttURI set to
px_MCPTT_ID_User_B The MCPTT ID of the identified MCPTT user (see NOTE 1,
Table 6.2.25.3.3-5);\  
encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.1-1A
anyExt
response-type \"remotely-initiated-private-call-response\"
remotely-initiated-call-outcome \"success\"
* * *
Table 6.2.25.3.3-9: SIP BYE from the SS (step 19, Table 6.2.25.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3.12.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1, condition MO_CALL
* * *
6.2.26 On-network / Private call / Remotely initiated private call / Pre-
established session / Client Terminated (CT)
##### 6.2.26.1 Test Purpose (TP) {#test-purpose-tp-69 .H6}
##### (1) {#section-200 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate private calls, **and** , according to local
policy pre-established sessions are to be used for remotely initiated private
calls }
ensure that {
**when** { UE (MCPTT Client) receives a request for establishment of an MCPTT
remotely initiated private call with the MCPTT ID of the identified MCPTT user
of the remotely initiated private call set to the ID of the MCPTT user
requesting the call initiation, **and** , a pre-established session to this
User available, **and** , the \ element contained in the
application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP
MESSAGE request is set to a value of \"false\" }
**then** { UE (MCPTT Client) initiates private call establishment to the
requesting User using the pre-established session, **and** , does not notify
the user that a remotely initiated private call request to call the identified
MCPTT user has been received, **and** , does not give any indication to the
remote MCPTT user that the remotely initiated private call origination is in
progress, **and** , does not sent SIP MESSAGE back to the MCPTT user
requesting the call initiation }
}
##### (2) {#section-201 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate private calls, **and** , according to local
policy pre-established sessions are to be used for remotely initiated private
calls }
ensure that {
**when** { UE (MCPTT Client) receives a request for establishment of an MCPTT
remotely initiated private call with the MCPTT ID of the identified MCPTT user
of the remotely initiated private call set to ID different to the ID of the
MCPTT user requesting the call initiation, **and** , a pre-established session
to this User available }
**then** { UE (MCPTT Client) initiates private call establishment to the
requested identified MCPTT user using the pre-established session, **and** ,
sends SIP MESSAGE back to the MCPTT user requesting the call initiation to
confirm the private call initiation }
}
##### 6.2.26.2 Conformance requirements {#conformance-requirements-69 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.1.7.2.2, 11.1.1.2.2.1. Unless otherwise
stated these are Rel-15 requirements.
[TS 24.379, clause 11.1.7.2.2]
Upon receiving a \"SIP MESSAGE request for remotely initiated private call
request for terminating client\", the MCPTT client:
> ...
>
> 2) shall extract the MCPTT ID of the identified MCPTT user from the \ called-party-id> element contained in the \ element of the
> \ element contained in the application/vnd.3gpp.mcptt-info+xml
> MIME body contained in the received SIP MESSAGE request;
>
> ...
>
> 4) if according to local policy pre-established sessions are to be used for
> remotely initiated private calls and a pre-established session is available,
> shall invoke the procedures of clause 11.1.1.2.2.1 to originate an MCPTT
> private call to the identified MCPTT user with the following clarifications:
>
> a) if the \ element contained in the
> application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP
> MESSAGE request is set to a value of \"false\":
>
> i) shall not indicate to the remote MCPTT user that a remotely initiated
> private call request to call the identified MCPTT user has been received;
> and
>
> ii) shall not give any indication to the remote MCPTT user that the remotely
> initiated private call origination is in progress.
Upon completion of the procedures of clause 11.1.1.2.1.1 or clause
11.1.1.2.2.1, the MCPTT client:
> 1) if:
>
> a) the MCPTT ID of the identified MCPTT user is identical to the \ calling-user-id> element contained in the \ element of the
> \ element contained in the application/vnd.3gpp.mcptt-info+xml
> MIME body contained in the received SIP MESSAGE request: and
>
> b) the procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1 were
> successful in originating an MCPTT private call to the identified MCPTT
> user;
>
> then:
>
> a) shall skip the remaining steps of the current clause;
>
> NOTE: In this case, it is not necessary to send a response to the sender of
> the remotely initiated private call request as the sender and the
> terminating party of the successful private call origination are the same
> user and will be aware of the request\'s outcome.
>
> 2) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229
> [4] and IETF RFC 3428 [33] with the following clarifications:
>
> a) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP MESSAGE request;
>
> b) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> c) may include a P-Preferred-Identity header field in the SIP MESSAGE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> d) shall include in an application/resource-lists+xml MIME body the MCPTT ID
> contained in the \ element in the application/
> vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request; and
>
> e) shall include an application/vnd.3gpp.mcptt-info+xml MIME body as
> specified in clause F.1 with the \ element containing the
> \ element containing:
>
> i) the \ set to the MCPTT ID of the identified MCPTT
> user called by the remote MCPTT user; and
>
> ii) an \ element containing:
>
> A) the \ element set to a value of \"remotely-initiated-
> private-call-response\";
>
> B) if the procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1 were
> successful in originating an MCPTT private call to the identified MCPTT
> user, a \ element set to a value of
> \"success\"; and
>
> ...
>
> 3) shall set the Request-URI to the public service identity identifying the
> participating MCPTT function serving the MCPTT user identified by the MCPTT
> ID contained in the \ element in the application/
> vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request; and
>
> 4) shall send the SIP MESSAGE request according to rules and procedures of
> 3GPP TS 24.229 [4].
[TS 24.379, clause 11.1.1.2.2.1]
Upon receiving a request from an MCPTT user to establish an MCPTT private call
within a pre-established session the MCPTT client shall generate a SIP REFER
request outside a dialog in accordance with the procedures specified in 3GPP
TS 24.229 [4], IETF RFC 4488 [22] and IETF RFC 3515 [25] as updated by IETF
RFC 6665 [26] and IETF RFC 7647 [27], with the clarifications given below.
If the MCPTT user is initiating a private call and an end-to-end security
context needs to be established the MCPTT client:
> 1) if necessary, shall instruct the key management client to request keying
> material from the key management server as described in 3GPP TS 33.180 [78];
>
> 2) shall use the keying material to generate a PCK as described in 3GPP TS
> 33.180 [78];
>
> 3) shall use the PCK to generate a PCK-ID with the four most significant
> bits set to \"0001\" to indicate that the purpose of the PCK is to protect
> private call communications and with the remaining twenty eight bits being
> randomly generated as described in 3GPP TS 33.180 [78];
>
> 4) shall encrypt the PCK to a UID associated to the MCPTT client using the
> MCPTT ID and KMS URI of the invited user as determined by the procedures of
> clause 6.2.8.3.9 and a time related parameter as described in 3GPP TS 33.180
> [78];
>
> 5) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and
> PCK-ID as specified in 3GPP TS 33.180 [78];
>
> 6) shall add the MCPTT ID of the originating MCPTT to the initiator field
> (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]; and
>
> 7) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user\'s
> signing key provided in the keying material together with a time related
> parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
> 33.180 [78].
The MCPTT client populates the SIP REFER request as follows:
> 1) shall include the Request-URI set to the public service identity
> identifying the pre-established session on the MCPTT server serving the
> MCPTT user;
>
> 2) shall include the Refer-Sub header field with value \"false\" according
> to rules and procedures of IETF RFC 4488 [22];
>
> 3) shall include the Supported header field with value \"norefersub\"
> according to rules and procedures of IETF RFC 4488 [22];
>
> 4) shall include the option tag \"multiple-refer\" in the Require header
> field;
>
> 5) may include a P-Preferred-Identity header field in the SIP REFER request
> containing a public user identity as specified in 3GPP TS 24.229 [4];
>
> 6) shall include a P-Preferred-Service header field set to the ICSI value
> \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS
> 24.229 [4]), according to IETF RFC 6050 [9];
>
> 7) shall set the Refer-To header field of the SIP REFER request as specified
> in IETF RFC 3515 [25] with a Content-ID (\"cid\") Uniform Resource Locator
> (URL) as specified in IETF RFC 2392 [62] that points to an
> application/resource-lists MIME body as specified in IETF RFC 5366 [20], and
> with the Content-ID header field set to this \"cid\" URL.
>
> 8) for the initiation of a private call, shall include in the
> application/resource-lists MIME body a single \ element containing a
> \"uri\" attribute set to the MCPTT ID of the called user, extended with the
> following URI header fields:
>
> NOTE 1: Characters that are not formatted as ASCII characters are escaped in
> the following URI header fields
>
> a) if force of automatic commencement mode at the invited MCPTT client is
> requested by the MCPTT user, shall include a Priv-Answer-Mode header field
> with the value \"Auto\" according to the rules and procedures of IETF RFC
> 5373 [18];
>
> b) if force of automatic commencement mode at the invited MCPTT client is
> not requested by the MCPTT user and:
>
> i) if automatic commencement mode at the invited MCPTT client is requested
> by the MCPTT user, shall include an Answer-Mode header field with the value
> \"Automatic\" according to rules and procedures of IETF RFC 5373 [18]; and
>
> ii) if manual commencement mode at the invited MCPTT client is requested by
> the MCPTT user, shall include an Answer-Mode header field with the value
> \"Manual\" according to rules and procedures of IETF RFC 5373 [18]; and
>
> c) shall include in a hname \"body\" URI header field:
>
> i) if the SDP parameters of the pre-established session do not contain a
> media-level section of a media-floor control entity or if end-to-end
> security is required for the private call, an application/sdp MIME body
> containing the SDP parameters of the pre-established session according to
> 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.1. If
> implicit floor control is required and the pre-established session was not
> established with an implicit floor request, then the application/sdp MIME
> body shall contain an implicit floor request as specified in clause 6.4; and
>
> ii) an application/vnd.3gpp.mcptt-info MIME body with the \
> element set to \"private\";
>
> ...
>
> 12) shall include a Target-Dialog header field as specified in IETF RFC 4538
> [23] identifying the pre-established session; and
>
> 13) if:
>
> a) implicit floor control is required;
>
> b) the pre-established session was not established with an implicit floor
> request; and
>
> c) location information has not yet been included in the SIP REFER request;
>
> then shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body
> with a \ element included in the \ root element.
The MCPTT client shall send the SIP REFER request towards the MCPTT server
according to 3GPP TS 24.229 [4].
##### 6.2.26.3 Test description {#test-description-69 .H6}
##### 6.2.26.3.1 Pre-test conditions {#pre-test-conditions-69 .H6}
##### System Simulator: {#system-simulator-69 .H6}
\- SS (MCPTT server)
\- For the underlining \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-69 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-69 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The UE has performed procedure \'MCX pre-established session
establishment\' as specified in TS 36.579-1 [2] clause 5.3.3.
\- The MCPTT User is authorized to initiate private calls: the \ element of the \ element is present in the MCPTT user
profile document and is set to \"true\".
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.2.26.3.2 Test procedure sequence {#test-procedure-sequence-69 .H6}
Table 6.2.26.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 2-3A | Steps | - | - | - | - | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.33.3-1 | | | | | | | are | | | | | | | performed | | | | | | | r | | | | | | | equesting | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 5-5C | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-5 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | esta | | | | | | | blishment | | | | | | | using a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5 | | | | | | | .3A.3.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Check: | --> | SIP | 1 | F | | | Does, in | | MESSAGE | | | | | the next | | | | | | | 5 sec, | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | c | | | | | | | onfirming | | | | | | | the | | | | | | | progress | | | | | | | of the | | | | | | | MCPTT | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6A | Check: | - | - | 1 | F | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | notify | | | | | | | the user | | | | | | | that a | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call has | | | | | | | been | | | | | | | est | | | | | | | ablished? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | The UE | - | - | - | - | | | (MCPTT | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | release | | | | | | | keeping | | | | | | | the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5. | | | | | | | 3A.4.3-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9-11 | Steps | - | - | - | - | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.33.3-1 | | | | | | | are | | | | | | | performed | | | | | | | r | | | | | | | equesting | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12-12C | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-5 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | esta | | | | | | | blishment | | | | | | | using a | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5 | | | | | | | .3A.3.3-1 | | | | | | | to | | | | | | | establish | | | | | | | a | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.32.3-1 | | | | | | | c | | | | | | | onfirming | | | | | | | the | | | | | | | progress | | | | | | | of the | | | | | | | MCPTT | | | | | | | remotely | | | | | | | initiated | | | | | | | private | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 14 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 15 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16 | The UE | - | - | - | - | | | (MCPTT | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | release | | | | | | | keeping | | | | | | | the | | | | | | | pre-es | | | | | | | tablished | | | | | | | session\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | table | | | | | | | 5. | | | | | | | 3A.4.3-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
Table 6.2.26.3.2-2: Void
##### 6.2.26.3.3 Specific message contents {#specific-message-contents-69 .H6}
Table 6.2.26.3.3-1: SIP MESSAGE from the SS (Step 2, Table 6.2.26.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.26.3.3-2
Table 6.2.26.3.3-2: MCPTT-Info in SIP MESSAGE (Table 6.2.26.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition
mcpttinfo
mcptt-Params
mcptt-calling-user-id Encrypted \ with mcpttURI set to
px_MCPTT_ID_User_B requesting MCPTT user (NOTE 1);\  
encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.2-1A
mcptt-called-party-id Encrypted \ with mcpttURI set to
px_MCPTT_ID_User_B identified MCPTT user (NOTE 1);\  
encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.2-1A
anyExt
request-type \"remotely-initiated-private-call-request\"
notify-remote-user \"false\"
NOTE 1: The MCPTT-Info requests a remotely initiated private call with the
following roles terms of TS 24.379 [9] clause 11.1.7.1:\  
\- requesting MCPTT user: px_MCPTT_ID_User_B (SS)\  
\- remote MCPTT user: px_MCPTT_ID_User_A initiating the call (UE)\  
(contained in the \ perdefault)\  
\- identified MCPTT user: px_MCPTT_ID_User_B (SS; same as requesting MCPTT
user)\  
As requesting and identified MCPTT user are the same, the UE shall not send a
SIP MESSAGE at step 11 (TS 24.379 [9] clause 11.1.7.2.2).
* * *
Table 6.2.26.3.3-3: SIP MESSAGE from the SS (Step 10, Table 6.2.26.3.2-1;\
step 2, TS 36.579-1 [2], Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition ACCEPT-CONTACT-
WITH-MEDIA-FEATURE-TAG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.26.3.3-4
Table 6.2.26.3.3-4: MCPTT-Info in SIP MESSAGE (Table 6.2.26.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition
mcpttinfo
mcptt-Params
mcptt-calling-user-id Encrypted \ with mcpttURI set to
px_MCPTT_ID_User_C requesting MCPTT user (NOTE 1);\  
encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.2-1A
mcptt-called-party-id Encrypted \ with mcpttURI set to
px_MCPTT_ID_User_B identified MCPTT user (NOTE 1);\  
encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.2-1A
anyExt
request-type \"remotely-initiated-private-call-request\"
notify-remote-user \"true\"
NOTE 1: The MCPTT-Info requests a remotely initiated private call with the
following roles terms of TS 24.379 [9] clause 11.1.7.1:\  
\- requesting MCPTT user: px_MCPTT_ID_User_C (SS)\  
\- remote MCPTT user: px_MCPTT_ID_User_A initiating the call (UE)\  
(contained in the \ perdefault)\  
\- identified MCPTT user: px_MCPTT_ID_User_B (SS; same as requesting MCPTT
user)\  
As requesting and identified MCPTT user are different, the UE shall send a SIP
MESSAGE at step 17 (TS 24.379 [9] clause 11.1.7.2.2)
* * *
Table 6.2.26.3.3-5: SIP MESSAGE from the UE (Step 13, Table 6.2.26.3.2-1;\
step 2, TS 36.579-1 [2], Table 5.3.32.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition Message-body  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.2.26.3.3-6
Table 6.2.26.3.3-6: MCPTT-Info in SIP MESSAGE (Table 6.2.26.3.3-5)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1
* * *
Information Element Value/remark Comment Reference Condition
mcpttinfo
mcptt-Params
mcptt-called-party-id Encrypted \ with mcpttURI set to
px_MCPTT_ID_User_B The MCPTT ID of the identified MCPTT user (see NOTE 1,
Table 6.2.26.3.3-4);\  
encrypted element as described in TS 36.579-1 [2] Table 5.5.3.2.1-1A
anyExt
response-type \"remotely-initiated-private-call-response\"
remotely-initiated-call-outcome \"success\"
* * *
Table 6.2.26.3.3-7: SIP REFER from the UE (steps 5, 12, Table 6.2.26.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3A.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.12-1, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **Resource-lists**  
MIME-part-body Resource-lists as described in Table 6.2.26.3.3-8
Table 6.2.26.3.3-8: Resource-lists (Table 6.2.26.3.3-7)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition PRE-ESTABLISH,
PRIVATE-CALL with the uri attribute of the entry extended with the SIP URI
header fields as specified in Table 6.2.26.3.3-9
* * *
Table 6.2.26.3.3-9: SIP header fields extending the uri attribute of the
resource-lists\' single entry (Table 6.2.26.3.3-8)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.12-2, condition PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition **Answer-Mode**
any value if present NOTE 1  
body  
MIME body part **SDP Message**  
MIME-part-headers  
Content-Type "application/sdp"  
MIME-part-body SDP Message as described in **Table** 6.2.26.3.3-10  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in **Table** 6.2.26.3.3-11  
NOTE 1: TS 24.379 [9] clause 11.1.7 does not say anything about the
commencement mode to be used for remotely initiated private call.
Table 6.2.26.3.3-10: SDP Message in SIP REFER (Table 6.2.26.3.3-9)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition PRIVATE-CALL,
SDP_OFFER, PRE_ESTABLISHED_SESSION, WITHOUT_FLOORCONTROL
* * *
Table 6.2.26.3.3-11: MCPTT-Info in SIP REFER (Table 6.2.26.3.3-9)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1, condition PRIVATE-CALL
* * *
Table 6.2.26.3.3-11A: SIP 200 (OK) from the SS (steps 5, 12, Table
6.2.26.3.2-1;\ step 3, TS 36.579-1 [2] Table 5.3A.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition REFER-RSP,
PRIVATE-CALL
* * *
Information Element Value/remark Comment Reference Condition **Content-Type**  
media-type \"application/sdp\"  
**Message-body**  
SDP message As described in Table 6.2.8.3.3-4
Table 6.2.26.3.3-11B: SDP Message in SIP 200 (OK) (Table 6.2.26.3.3-11A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
PRE_ESTABLISHED_SESSION, WITHOUT_FLOORCONTROL
* * *
Table 6.2.26.3.3-12: Connect (Steps 5B, 12B, Table 6.2.26.3.2-1;\ step 4, TS
36.579-1 [2] Table 5.3A.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.12-1, condition PRIVATE-CALL,
WITHOUT_FLOORCONTROL, ACK
* * *
6.3 Location
6.3.1 On-network / Location / Event Triggered Location Information report
##### 6.3.1.1 Test Purpose (TP) {#test-purpose-tp-70 .H6}
##### (1) {#section-202 .H6}
**with** { UE (MCPTT Client)registered and authorized for MCPTT service
**and** not in an emergency state **and** having received a location
information configuration message providing configuration parameters for
_NonEmergencyLocationInformation_ requesting indication of ESGIs and location
information, and, TriggeringCriteria set to Cell change, and, a none zero
_minimumReportInterval_ timer }
**ensure that** {\ **when** { UE moves to a different cell }
**then** { UE (MCPTT Client) sends location report obeying the set in the
location configuration parameters for _NonEmergencyLocationInformation_
including waiting for the expiry of _minimumIntervalLength_ timer for before
reporting }
}
##### (2) {#section-203 .H6}
**with** { UE (MCPTT Client)registered and authorized for MCPTT service
**and** not in an emergency state **and** having received a location
information configuration message providing configuration parameters for
_NonEmergencyLocationInformation_ requesting indication of ESGIs and location
information, and, TriggeringCriteria set to PLMN change and PERIODIC, and, a
none zero _minimumReportInterval_ timer }
**ensure that** {\ **when** { UE moves to a cell belonging to different
however allowed for communication PLMN }
**then** { UE (MCPTT Client) sends location report obeying the set in the
location configuration parameters for _NonEmergencyLocationInformation and_
resets all triggers }
}
##### (3) {#section-204 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT service
**and** having received a location information configuration message providing
configuration parameters for _NonEmergencyLocationInformation_ requesting
indication of ESGIs and location information, and, TriggeringCriteria set to
PLMN change and PERIODIC, and, a none zero _minimumReportInterval_ timer }
ensure that {
**when** { when the PERIODIC trigger fires up }
**then** { UE (MCPTT Client) sends location report obeying the set in the
location configuration parameters for _NonEmergencyLocationInformation_ }
}
##### 6.3.1.2 Conformance requirements {#conformance-requirements-70 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379, clause 13.3.2, 13.3.4.1, 13.3.4.2. Unless otherwise
stated, these are Rel-13 requirements.
[TS24.379 clause 13.3.2]
Upon receiving a SIP MESSAGE request containing:
> 1) an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref
> set to the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
>
> 2) a Content-Type header field set to \"application/vnd.3gpp.mcptt-location-
> info+xml\"; and
>
> 3) an application/vnd.3gpp.mcptt-location-info+xml MIME body with a
> \ root element included in the \ root element;
then the MCPTT client:
> 1) shall store the contents of the \ elements;
>
> 2) shall set the location reporting triggers accordingly; and
>
> 3) shall start the minimumReportInterval timer.
[TS 24.379 clause 13.3.4.1]
If a location reporting trigger fires the MCPTT client checks if the
minimumReportInterval timer is running. If the timer is running the MCPTT
client waits until the timer expires. When the minimumReportInterval timer
fires, the MCPTT client:
> 1) shall, if any of the reporting triggers are still true, send a location
> information report as specified in subclause 13.3.4.2.
[TS 24.379 clause 13.3.4.2]
If the MCPTT client does not need to send a SIP request for other reasons, the
MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS
24.229 [4] and IETF RFC 3428 [33]. The MCPTT client;
> 1) shall include in the Request-URI, the SIP URI received in the P-Asserted-
> Identity header field in the received SIP MESSAGE request for location
> report configuration;
>
> 2) shall include a Content-Type header field set to
> \"application/vnd.3gpp.mcptt-location-info+xml\";
>
> 3) shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body
> and in the \ root element include:
>
> a) a \ element and if the Report was triggered by a location request
> include the \ attribute set to the value of the \
> attribute in the received Request;
>
> b) a \ child element set to the value of each \ value
> of the triggers that have fired; and
>
> c) the location reporting elements corresponding to the triggers that have
> fired;
>
> 4) shall include an Accept-Contact header field with the media feature tag
> g.3gpp.mcptt along with parameters \"require\" and \"explicit\" in
> accordance with IETF RFC 3841 [6];
>
> 5) shall set the minimumReportInterval timer to the minimumReportInterval
> time and start the timer;
>
> 6) shall reset all triggers; and
>
> 7) shall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].
##### 6.3.1.3 Test description {#test-description-70 .H6}
##### 6.3.1.3.1 Pre-test conditions {#pre-test-conditions-70 .H6}
##### System Simulator: {#system-simulator-70 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 and Cell 2 shall belong to PLMN1 (the PLMN specified for
MCPTT operation in the MCPTT configuration document). The simulated Cell 4
shall belong to PLMN2. Which cell is simulated at which time and with what
power is described in TS 36.579-1 [2], clause 5.4.9 \'MCX communication in
E-UTRA / Change of cells\' which is called during the test sequence.
\- GNSS simulator to simulate a location.
##### IUT: {#iut-70 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-70 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 to provide a location, as defined in TS 36.508 [24] Table
4.11.2-2, step 1 of scenario #4.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.3.1.3.2 Test procedure sequence {#test-procedure-sequence-70 .H6}
Table 6.3.1.3.2-1: Main Behaviour
+-----+--------------+--------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=====+==============+==============+=============+=========+====+ | | | U - S | Message | | | +-----+--------------+--------------+-------------+---------+----+ | 0 | Trigger the | - | - | - | - | | | UE to reset | | | | | | | UTC time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time and | | | | | | | location | | | | | | | reset may be | | | | | | | performed by | | | | | | | MMI or AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----+--------------+--------------+-------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call | | | | | | | e | | | | | | | stablishment | | | | | | | are | | | | | | | described in | | | | | | | TS 36. | | | | | | | 579-1 [2], | | | | | | | clause 5.4.4 | | | | | | | \'MCX CT | | | | | | | c | | | | | | | ommunication | | | | | | | in E-UTRA\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | exchanged. | | | | | +-----+--------------+--------------+-------------+---------+----+ | 1 | The SS sends | \ | SIP MESSAGE | 1 | P | | | the UE | | | | | | | (MCPTT | | | | | | | client) send | | | | | | | a SIP | | | | | | | MESSAGE | | | | | | | containing | | | | | | | the Cell | | | | | | | change | | | | | | | trigger | | | | | | | id | | | | | | | entification | | | | | | | along with | | | | | | | the location | | | | | | | information | | | | | | | report, the | | | | | | | current | | | | | | | location | | | | | | | coordinates | | | | | | | as specified | | | | | | | in step 1B, | | | | | | | and, the | | | | | | | ECGIs of | | | | | | | Cells 1 and | | | | | | | 2? | | | | | +-----+--------------+--------------+-------------+---------+----+ | 4-8 | Void | - | - | - | - | +-----+--------------+--------------+-------------+---------+----+ | 9 | The SS sends | \ | SIP MESSAGE | 2 | P | | | the UE | | | | | | | (MCPTT | | | | | | | client) send | | | | | | | (NOTE) a SIP | | | | | | | MESSAGE | | | | | | | containing | | | | | | | the PLMN | | | | | | | change | | | | | | | trigger | | | | | | | id | | | | | | | entification | | | | | | | along with | | | | | | | the location | | | | | | | information | | | | | | | report, the | | | | | | | current | | | | | | | location | | | | | | | coordinates | | | | | | | as specified | | | | | | | in step 9B, | | | | | | | and the ECGI | | | | | | | of cell 4 | | | | | | | (the only | | | | | | | cell being | | | | | | | active at | | | | | | | this moment | | | | | | | of time)? | | | | | | | | | | | | | | NOTE: The | | | | | | | _minimumRep | | | | | | | ortInterval_ | | | | | | | time (set in | | | | | | | step 9) has | | | | | | | already | | | | | | | expired | | | | | | | latest at | | | | | | | the end of | | | | | | | step 9B. | | | | | +-----+--------------+--------------+-------------+---------+----+ | 11A | SS cancels | - | - | - | - | | | Timer=60. | | | | | +-----+--------------+--------------+-------------+---------+----+ | 11B | SS starts | - | - | - | - | | | Timer=60. | | | | | +-----+--------------+--------------+-------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | SS releases | | | | | | | the E-UTRA | | | | | | | connection | | | | | +-----+--------------+--------------+-------------+---------+----+ | 12 | Void. | - | - | - | - | +-----+--------------+--------------+-------------+---------+----+ | 13 | Timer=60 sec | - | - | - | - | | | expires | | | | | +-----+--------------+--------------+-------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call | | | | | | | e | | | | | | | stablishment | | | | | | | are | | | | | | | described in | | | | | | | TS 36. | | | | | | | 579-1 [2], | | | | | | | clause 5.4.3 | | | | | | | \'MCX CO | | | | | | | c | | | | | | | ommunication | | | | | | | in E-UTRA\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | exchanged. | | | | | +-----+--------------+--------------+-------------+---------+----+ | 14 | Check: Does | --> | SIP MESSAGE | 3 | P | | | the UE | | | | | | | (MCPTT | | | | | | | client) send | | | | | | | a SIP | | | | | | | MESSAGE | | | | | | | containing | | | | | | | the periodic | | | | | | | trigger | | | | | | | id | | | | | | | entification | | | | | | | along with | | | | | | | location | | | | | | | information | | | | | | | report after | | | | | | | the | | | | | | | n | | | | | | | on-emergency | | | | | | | minimum | | | | | | | interval | | | | | | | length | | | | | | | expired? | | | | | | | | | | | | | | NOTE: The | | | | | | | _minimumRep | | | | | | | ortInterval_ | | | | | | | time (set in | | | | | | | step 9) has | | | | | | | already | | | | | | | expired | | | | | | | before step | | | | | | | 13. | | | | | +-----+--------------+--------------+-------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | SS releases | | | | | | | the E-UTRA | | | | | | | connection | | | | | +-----+--------------+--------------+-------------+---------+----+
##### 6.3.1.3.3 Specific message contents {#specific-message-contents-70 .H6}
Table 6.3.1.3.3-1: SIP MESSAGE (Step 1, Table 6.3.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**
MIME body not including MCPTT-Info and not including MCPTT-Affiliation-Command
not including any MIME body part with Content-Type being
\"application/vnd.3gpp.mcptt-info+xml\" or \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part Location info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-location-info+xml\"  
MIME-part-body Location-info as described in Table 6.3.1.3.3-2
Table 6.3.1.3.3-2: Location-Info in SIP MESSAGE (Table 6.3.1.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.4.2-1
* * *
Information Element Value/remark Comment Reference Condition location-info  
Configuration  
NonEmergencyLocationInformation  
ServingEcgi present Provision of information in the report is requested.  
NeighbouringEcgi present Provision of information in the report is requested.  
MbmsSaId not present Provision of information in the report is not requested.  
MbsfnArea not present Provision of information in the report is not requested.  
GeographicalCoordinate present  
minimumIntervalLength \"25\" the value in seconds  
EmergencyLocationInformation\"  
ServingEcgi present Provision of information in the report is requested.  
NeighbouringEcgi present Provision of information in the report is requested.  
MbmsSaId not present Provision of information in the report is not requested.  
MbsfnArea not present Provision of information in the report is not requested.  
GeographicalCoordinate present Provision of information in the report is
requested.  
minimumIntervalLength \"30\" the value in seconds  
TriggeringCriteria  
CellChange  
AnyCellChange  
TriggerID \"CELLCHANGE\"
Table 6.3.1.3.3-3: SIP MESSAGE (Step 3, Table 6.3.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**
MIME body not including MCPTT-Info and not including MCPTT-Affiliation-Command
not including any MIME body part with Content-Type being
\"application/vnd.3gpp.mcptt-info+xml\" or \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part Location info TS 24.379 [9] clause F.3  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-location-info+xml\"  
MIME-part-body Location-info as described in Table 6.3.1.3.3-4
Table 6.3.1.3.3-4: Location-Info in SIP MESSAGE (Table 6.3.1.3.3-3)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.4.1-1
* * *
Information Element Value/remark Comment Reference Condition location-info  
Report  
TriggerID \"CELLCHANGE\"  
CurrentLocation  
CurrentServingEcgi The E-UTRAN Cell Global Identification (ECGI) of Cell 2  
NeighbouringEcgi The ECGI of Cell 1  
CurrentCoordinate The location simulated by the GNSS simulator at the time of
transmission of the message.  
longitude The longitude value as specified for location number #7 defined in
TS 36.508 [24] Table 4.11.2-3 +/- 0.00016 degrees.  
latitude The latitude value as specified for location number #7 defined in TS
36.508 [24] Table 4.11.2-3 +/- 0.00013 degrees.  
ReportType \"NonEmergency\"
Table 6.3.1.3.3-5 to 8: Void
Table 6.3.1.3.3-9: SIP MESSAGE (Step 9, Table 6.3.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**
MIME body not including MCPTT-Info and not including MCPTT-Affiliation-Command
not including any MIME body part with Content-Type being
\"application/vnd.3gpp.mcptt-info+xml\" or \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part Location info TS 24.379 [9] clause F.3  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-location-info+xml\"  
MIME-part-body Location-info as described in Table 6.3.1.3.3-10
Table 6.3.1.3.3-10: Location-Info in SIP MESSAGE (Table 6.3.1.3.3-9)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.4.2-1
* * *
Information Element Value/remark Comment Reference Condition location-info  
Configuration  
NonEmergencyLocationInformation  
ServingEcgi present Provision of information in the report is requested.  
NeighbouringEcgi present Provision of information in the report is requested.  
MbmsSaId not present Provision of information in the report is not requested.  
MbsfnArea not present Provision of information in the report is not requested.  
GeographicalCoordinate present Provision of information in the report is
requested.  
minimumIntervalLength \"10\" the value in seconds  
EmergencyLocationInformation\"  
ServingEcgi present Provision of information in the report is requested.  
NeighbouringEcgi present Provision of information in the report is requested.  
MbmsSaId not present Provision of information in the report is not requested.  
MbsfnArea not present Provision of information in the report is not requested.  
GeographicalCoordinate present Provision of information in the report is
requested.  
minimumIntervalLength \"70\" the value in seconds  
TriggeringCriteria  
PLMNChange  
AnyPLMNChange  
TriggerID \"ANY PLMN\"  
PeriodicReport  
extension base \"60\" the value in seconds of the time which determines the
periodic provision of the report  
TiggerID \"PERIODIC\"
Table 6.3.1.3.3-11: SIP MESSAGE (Step 11, Table 6.3.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition Content-Type
\"multipart/mixed;boundary=\"any allowed value  
Content-Length length of message body  
Message-body  
MIME-Content-Type not present \"application/vnd.3gpp.mcptt-info+xml\"  
MIME-Content-Type not present \"application/vnd.3gpp.mcptt-affiliation-
command+xml\"  
MIME-Content-Type \"application/vnd.3gpp.mcptt-location-info+xml\"
\"application/vnd.3gpp.mcptt-affiliation-command+xml\" TS 24.379 [9] clause
F.3  
Location-Info As described in Table 6.3.1.3.3-12
Table 6.3.1.3.3-12: Location-Info in SIP MESSAGE (Table 6.3.1.3.3-11)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.4.1-1
* * *
Information Element Value/remark Comment Reference Condition location-info  
Report  
TriggerID \"ANY PLMN\"  
CurrentLocation  
CurrentServingEcgi The ECGI of Cell 4  
NeighbouringEcgi not present Only Cell 4 is active at this moment of time (see
TS 36.579-1 [2], clause 5.4.9)  
CurrentCoordinate The location simulated by the GNSS simulator at the time of
transmission of the message.  
longitude The longitude value as specified for location number #8 defined in
TS 36.508 [24] Table 4.11.2-3 +/- 0.00016 degrees.  
latitude The latitude value as specified for location number #8 defined in TS
36.508 [24] Table 4.11.2-3 +/- 0.00013 degrees.  
ReportType \"NonEmergency\"
Table 6.3.1.3.3-13: SIP MESSAGE (Step 14, Table 6.3.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition Content-Type
\"multipart/mixed;boundary=\"any allowed value  
Content-Length length of message body  
Message-body  
MIME-Content-Type not present \"application/vnd.3gpp.mcptt-info+xml\"  
MIME-Content-Type not present \"application/vnd.3gpp.mcptt-affiliation-
command+xml\"  
MIME-Content-Type \"application/vnd.3gpp.mcptt-location-info+xml\"
\"application/vnd.3gpp.mcptt-affiliation-command+xml\" TS 24.379 [9] clause
F.3  
Location-Info As described in Table 6.3.1.3.3-14
Table 6.3.1.3.3-14: Location-Info in SIP MESSAGE (Table 6.3.1.3.3-13)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.4.1-1
* * *
Information Element Value/remark Comment Reference Condition location-info  
Report  
TriggerID \"PERIODIC\"  
CurrentLocation  
CurrentServingEcgi The ECGI of Cell 4  
NeighbouringEcgi not present  
CurrentCoordinate The location simulated by the GNSS simulator at the time of
transmission of the message.  
longitude The longitude value as specified for location number #8 defined in
TS 36.508 [24] Table 4.11.2-3 +/- 0.00016 degrees.  
latitude The latitude value as specified for location number #8 defined in TS
36.508 [24] Table 4.11.2-3 +/- 0.00013 degrees.  
ReportType \"NonEmergency\"
6.3.2 On-network / Location/ On-demand Location Information Request
##### 6.3.2.1 Test Purpose (TP) {#test-purpose-tp-71 .H6}
##### (1) {#section-205 .H6}
**with** { UE (MCPTT Client)registered and authorized for MCPTT service
**and** not in an emergency state **and** having received a location
information configuration message providing configuration parameters for both
NonEmergencyLocationInformation and EmergencyLocationInformation }
ensure that {
**when** { UE (MCPTT Client) receives a location information request before
the minimumReportInterval timer has expired }
**then** { UE (MCPTT Client)does not wait for the minimumReportInterval timer
to expire, and, sends\"immediately\" a SIP MESSAGE containing location
information report including information in accordance with the
NonEmergencyLocationInformation configuration and the \ attribute
set to the value of the \ attribute in the received Request,
**and** , resets the _minimumReportInterval_ timer }
}
##### (2) {#section-206 .H6}
**with** { UE (MCPTT Client)registered and authorized for MCPTT service
**and** not in an emergency state **and** having received a location
information configuration message }
ensure that {
**when** { UE (MCPTT Client) receives a new location information configuration
message and ConfigScope set to \'Full\' }
**then** { UE (MCPTT Client) stores the contents of the \
elements thereby overriding the previous configuration }
}
##### 6.3.2.2 Conformance requirements {#conformance-requirements-71 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379, clauses 13.3.1, 13.3.2, 13.3.3, 13.3.4.2, F.3.3.
Unless otherwise stated, these are Rel-13 requirements.
[TS 24.379 clause 13.3.2]
The MCPTT client sends a location report when one of the trigger criteria is
fulfilled or when it receives a request from the participating MCPTT function
to send a location report. To send the location report the MCPTT client can
use an appropriate SIP message that it needs to send for other reasons, or it
can include the location report in a SIP MESSAGE request.
To send a location report, the MCPTT client includes in the SIP MESSAGE
request an application/vnd.3gpp.mcptt-location-info+xml MIME body as specified
in clause F.3. The MCPTT client populates the elements in accordance with its
reporting configuration. Further location information may also be included in
the P-Access-Network-Info header field.
[TS 24.379 clause 13.3.2]
Upon receiving a SIP MESSAGE request containing:
> 1) an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref
> set to the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
>
> 2) a Content-Type header field set to \"application/vnd.3gpp.mcptt-location-
> info+xml\"; and
>
> 3) an application/vnd.3gpp.mcptt-location-info+xml MIME body with a
> \ root element included in the \ root element;
then the MCPTT client:
> 1) shall store the contents of the \ elements;
>
> ...
>
> 3) shall start the minimumReportInterval timer.
[TS 24.379 clause 13.3.3]
> Upon receiving a SIP MESSAGE request containing
>
> 1) an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref
> set to the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
>
> 2) a Content-Type header field set to \"application/vnd.3gpp.mcptt-location-
> info+xml\"; and
>
> 3) an application/vnd.3gpp.mcptt-location-info+xml MIME body with a
> \ element included in the \ root element;
>
> then the MCPTT client:
>
> 1) shall send a location report as specified in subclause 13.3.4; and
>
> 2) shall reset the minimumReportInterval timer.
[TS 24.379 clause 13.3.4.2]
If the MCPTT client does not need to send a SIP request for other reasons, the
MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS
24.229 [4] and IETF RFC 3428 [33]. The MCPTT client;
> 1) shall include in the Request-URI, the SIP URI received in the P-Asserted-
> Identity header field in the received SIP MESSAGE request for location
> report configuration;
>
> 2) shall include a Content-Type header field set to
> \"application/vnd.3gpp.mcptt-location-info+xml\";
>
> 3) shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body
> and in the \ root element include:
>
> a) a \ element and if the Report was triggered by a location request
> include the \ attribute set to the value of the \
> attribute in the received Request;
>
> ...
>
> 4) shall include an Accept-Contact header field with the media feature tag
> g.3gpp.mcptt along with parameters \"require\" and \"explicit\" in
> accordance with IETF RFC 3841 [6];
>
> 5) shall set the minimumReportInterval timer to the minimumReportInterval
> time and start the timer;
>
> ...
>
> 7) shall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].
[TS 24.379 clause F.3.3]
\ element has a \ attribute that can assume the
values \"Full\" and \"Update\". The value \"Full\" means that the
Configuration> element contains the full location configuration which replaces
any previous location configuration. The value \"Update\" means that the
location configuration is in addition to any previous location configuration.
To remove configuration elements a \"Full\" configuration is needed. The
\ element contains the following child elements:
##### 6.3.2.3 Test description {#test-description-71 .H6}
##### 6.3.2.3.1 Pre-test conditions {#pre-test-conditions-71 .H6}
##### System Simulator: {#system-simulator-71 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 and Cell 2 shall belong to PLMN1 (the PLMN specified for
MCPTT operation in the MCPTT configuration document).
##### IUT: {#iut-71 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-71 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state on Cell 1 (Serving cell).
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.3.2.3.2 Test procedure sequence {#test-procedure-sequence-71 .H6}
Table 6.3.2.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 0 | Void. | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 1-1AB | Steps | - | - | - | - | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.33.3-1 | | | | | | | are | | | | | | | performed | | | | | | | to | | | | | | | configure | | | | | | | location | | | | | | | reporting | | | | | | | with | | | | | | | _mini | | | | | | | mumReport | | | | | | | Interval_ | | | | | | | timer set | | | | | | | to 20s | | | | | | | and | | | | | | | _Period | | | | | | | icReport_ | | | | | | | reporting | | | | | | | interval | | | | | | | set to | | | | | | | 15s. | | | | | | | | | | | | | | NOTE: The | | | | | | | handling | | | | | | | of the | | | | | | | _Period | | | | | | | icReport_ | | | | | | | is not | | | | | | | tested in | | | | | | | this | | | | | | | test. It | | | | | | | is added | | | | | | | here for | | | | | | | the | | | | | | | purpose | | | | | | | of | | | | | | | verifying | | | | | | | that the | | | | | | | UE | | | | | | | restarts | | | | | | | the | | | | | | | _mini | | | | | | | mumReport | | | | | | | Interval_ | | | | | | | -- when | | | | | | | the | | | | | | | Periodic | | | | | | | report | | | | | | | trigger | | | | | | | fires | | | | | | | before | | | | | | | the | | | | | | | e | | | | | | | xpiration | | | | | | | of the | | | | | | | _mini | | | | | | | mumReport | | | | | | | Interval_ | | | | | | | the UE | | | | | | | needs to | | | | | | | wait for | | | | | | | its | | | | | | | expiry | | | | | | | before | | | | | | | sending | | | | | | | the | | | | | | | periodic | | | | | | | report. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Start | - | - | - | - | | | timer | | | | | | | t\ | | | | | | | _Wait=10s | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1B | Start | - | - | - | - | | | timer | | | | | | | t_ | | | | | | | PeriodicR | | | | | | | eport=15s | | | | | | | (_Period | | | | | | | icReport_ | | | | | | | timer set | | | | | | | in step | | | | | | | 1). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The SS | | | | | | | waits 2 | | | | | | | seconds | | | | | | | before it | | | | | | | releases | | | | | | | the RRC | | | | | | | c | | | | | | | onnection | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1C | t_Wait | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2-2B | Steps | - | - | - | - | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.33.3-1 | | | | | | | are | | | | | | | performed | | | | | | | to | | | | | | | request a | | | | | | | location | | | | | | | report. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3-3AA | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-3 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.32.3-1 | | | | | | | before | | | | | | | t_Perio | | | | | | | dicReport | | | | | | | expires | | | | | | | to | | | | | | | provide | | | | | | | location | | | | | | | in | | | | | | | formation | | | | | | | for the | | | | | | | NonE | | | | | | | mergencyL | | | | | | | ocationIn | | | | | | | formation | | | | | | | c | | | | | | | onfigured | | | | | | | at step | | | | | | | 1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3A | Start | - | - | - | - | | | timer | | | | | | | t | | | | | | | _Minimum | | | | | | | ReportInt | | | | | | | erval=20s | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3B | Stop | - | - | - | - | | | timer | | | | | | | t_Perio | | | | | | | dicReport | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The SS | | | | | | | waits 2 | | | | | | | seconds | | | | | | | before it | | | | | | | releases | | | | | | | the RRC | | | | | | | c | | | | | | | onnection | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3C | Void. | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 3D | t_Min | - | - | - | - | | | imumRepor | | | | | | | tInterval | | | | | | | expires | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3E-3G | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.32.3-1 | | | | | | | to | | | | | | | provide | | | | | | | periodic | | | | | | | location | | | | | | | inf | | | | | | | ormation? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4-4A | Steps 2-3 | - | - | - | - | | | of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.33.3-1 | | | | | | | are | | | | | | | performed | | | | | | | to remove | | | | | | | the | | | | | | | periodic | | | | | | | trigger | | | | | | | criteria | | | | | | | form the | | | | | | | location | | | | | | | reporting | | | | | | | confi | | | | | | | guration. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5-5A | Steps 2-3 | - | - | - | - | | | of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.33.3-1 | | | | | | | are | | | | | | | performed | | | | | | | to | | | | | | | request a | | | | | | | location | | | | | | | report. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6-6A | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-3 | | | | | | | of | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3.32.3-1 | | | | | | | to | | | | | | | provide | | | | | | | location | | | | | | | in | | | | | | | formation | | | | | | | for the | | | | | | | conf | | | | | | | iguration | | | | | | | done at | | | | | | | steps | | | | | | | 4-4A? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7-8 | Void. | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Check: | --> | SIP | 2 | F | | | Does the | | MESSAGE | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send any | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | in the | | | | | | | next 25s? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The SS | | | | | | | waits 2 | | | | | | | seconds | | | | | | | before it | | | | | | | releases | | | | | | | the RRC | | | | | | | c | | | | | | | onnection | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | The value | | | | | | | of 10s is | | | | | | | arbitrary | | | | | | | chosen. | | | | | | | However, | | | | | | | it needs | | | | | | | to be | | | | | | | long | | | | | | | enough to | | | | | | | ensure | | | | | | | that if | | | | | | | the UE | | | | | | | did not | | | | | | | reset the | | | | | | | min | | | | | | | imumRepor | | | | | | | tInterval | | | | | | | timer | | | | | | | after it | | | | | | | sent the | | | | | | | message | | | | | | | in step 3 | | | | | | | the UE | | | | | | | will send | | | | | | | the SIP | | | | | | | MESSAGE | | | | | | | for the | | | | | | | periodic | | | | | | | reporting | | | | | | | before | | | | | | | step 3D | | | | | | | and will | | | | | | | fail, | | | | | | | and, it | | | | | | | needs to | | | | | | | be short | | | | | | | enough so | | | | | | | that step | | | | | | | 2 happens | | | | | | | r | | | | | | | easonably | | | | | | | before | | | | | | | t_Perio | | | | | | | dicReport | | | | | | | expires. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 6.3.2.3.3 Specific message contents {#specific-message-contents-71 .H6}
Table 6.3.2.3.3-1: SIP MESSAGE from the SS (Step 1, Table 6.3.2.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition LOCATION-CONFIG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-info as described in Table 6.3.1.3.3-13  
MIME body part **Location-info** TS 24.379 [9] clause F.3  
MIME-part-body Location-info as described in Table 6.3.1.3.3-2
Table 6.3.2.3.3-2: Location-Info in SIP MESSAGE (Table 6.3.2.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.4.2-1
* * *
Information Element Value/remark Comment Reference Condition location-info  
Configuration  
NonEmergencyLocationInformation  
ServingEcgi not present  
NeighbouringEcgi not present .  
MbmsSaId not present  
MbsfnArea not present  
GeographicalCoordinate present Provision of \ in the
report is requested.  
minimumIntervalLength \"20\"  
TriggeringCriteria  
PeriodicReport  
extension base \"15\" periodicity of the reports (in seconds)  
TiggerID \"PERIODIC\"
Table 6.3.2.3.3-3: SIP MESSAGE from the SS (Step 2, Table 6.3.2.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition LOCATION-INFO
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-info as described in Table 6.3.1.3.3-13  
MIME body part **Location-info** TS 24.379 [9] clause F.3  
MIME-part-body Location-info as described in Table 6.3.1.3.3-4
Table 6.3.2.3.3-4: Location-Info in SIP MESSAGE (Table 6.3.2.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.4.3-1
* * *
Table 6.3.2.3.3-5: SIP MESSAGE from the UE (Step 3, Table 6.3.2.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.32.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition LOCATION_REPORT
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part Not present **MCPTT-Info**  
MIME body part **Location-info** TS 24.379 [9] clause F.3  
MIME-part-body Location-info as described in Table 6.3.1.3.3-6
Table 6.3.2.3.3-6: Location-Info in SIP MESSAGE (Table 6.3.2.3.3-5)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.4.1-1, condition LOCATION-INFO
* * *
Information Element Value/remark Comment Reference Condition location-info  
Report  
ReportID attribute \"1\" The same as the ID in the request message.  
ReportType attribute \"NonEmergency\"  
CurrentLocation Information corresponding to the location reporting
configuration of table 6.3.2.3.3-2  
CurrentServingEcgi not present  
NeighbouringEcgi not present  
MbmsSaId not present  
MbsfnArea not present  
CurrentCoordinate  
longitude Encrypted \ with any content Encryption according to NOTE
1 in TS 36.579-1 [2] Table 5.5.3.4.1-1  
latitude Encrypted \ with any content Encryption according to NOTE 1
in TS 36.579-1 [2] Table 5.5.3.4.1-1
Table 6.3.2.3.3-6A: SIP MESSAGE from the UE (Step 3E, Table 6.3.2.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.32.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition LOCATION-INFO
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part Not present **MCPTT-Info**  
MIME body part **Location-info** TS 24.379 [9] clause F.3  
MIME-part-body Location-info as described in Table 6.3.1.3.3-6B
Table 6.3.2.3.3-6B: Location-Info in SIP MESSAGE (Table 6.3.2.3.3-6A)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.4.1-1
* * *
Information Element Value/remark Comment Reference Condition location-info  
Report  
ReportType attribute \"NonEmergency\"  
TriggerID \"PERIODIC\"  
CurrentLocation Information corresponding to the location reporting
configuration of table 6.3.2.3.3-2  
CurrentServingEcgi not present  
NeighbouringEcgi not present  
MbmsSaId not present  
MbsfnArea not present  
CurrentCoordinate  
longitude Encrypted \ with any content Encryption according to NOTE
1 in TS 36.579-1 [2] Table 5.5.3.4.1-1  
latitude Encrypted \ with any content Encryption according to NOTE 1
in TS 36.579-1 [2] Table 5.5.3.4.1-1
Table 6.3.2.3.3-7: SIP MESSAGE from the SS (Step 4, Table 6.3.2.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition LOCATION-CONFIG
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-info as described in Table 6.3.1.3.3-13  
MIME body part **Location-info** TS 24.379 [9] clause F.3  
MIME-part-body Location-info as described in Table 6.3.1.3.3-8
Table 6.3.2.3.3-8: Location-Info in SIP MESSAGE (Table 6.3.2.3.3-7)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.4.2-1
* * *
Information Element Value/remark Comment Reference Condition location-info  
Configuration  
NonEmergencyLocationInformation  
ServingEcgi present Provision of \ in the report is requested.  
NeighbouringEcgi not present  
MbmsSaId not present  
MbsfnArea not present  
GeographicalCoordinate not present
Table 6.3.2.3.3-9: SIP MESSAGE from the SS (Step 5, Table 6.3.2.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition LOCATION-INFO
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-info as described in Table 6.3.1.3.3-13  
MIME body part **Location-info** TS 24.379 [9] clause F.3  
MIME-part-body Location-info as described in Table 6.3.1.3.3-10
Table 6.3.2.3.3-10: Location-Info in SIP MESSAGE (Table 6.3.2.3.3-9)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.4.3-1
* * *
Information Element Value/remark Comment Reference Condition location-info  
Request  
RequestID \"2\" The RequestID that the MCPTT client shall reference in the
Report
Table 6.3.2.3.3-11: SIP MESSAGE from the UE (Step 6, Table 6.3.2.3.2-1;\ step
2, TS 36.579-1 [2], Table 5.3.32.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition LOCATION_REPORT
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part Not present **MCPTT-Info**  
MIME body part **Location-info** TS 24.379 [9] clause F.3  
MIME-part-body Location-info as described in Table 6.3.1.3.3-12
Table 6.3.2.3.3-12: Location-Info in SIP MESSAGE (Table 6.3.2.3.3-11)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.4.1-1
* * *
Information Element Value/remark Comment Reference Condition location-info
present  
Report present  
ReportID \"2\" The same as the ID in the request message.  
ReportType \"NonEmergency\"  
CurrentLocation present Information corresponding to the location reporting
configuration of table 6.3.2.3.3-8  
CurrentServingEcgi Encrypted \ with any content Encryption
according to NOTE 1 in TS 36.579-1 [2] Table 5.5.3.4.1-1  
NeighbouringEcgi not present  
MbmsSaId not present  
MbsfnArea not present  
CurrentCoordinate not present
Table 6.3.2.3.3-13: MCPTT-Info in SIP MESSAGE (Table 6.3.2.3.3-1, 6.3.2.3.3-3,
6.3.2.3.3-7, 6.3.2.3.3-9)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-1
* * *
Information Element Value/remark Comment Reference Condition mcpttinfo  
mcptt-Params  
mcptt-calling-user-id not present
6.4 MBMS
6.4.1 On-network / MBMS / MBMS Bearer Announcement / MBMS Bearer Listening
Status / Transition to MBMS from Unicast / MBMS Floor Control / Transition to
Unicast from MBMS
##### 6.4.1.1 Test Purpose (TP) {#test-purpose-tp-72 .H6}
##### (1) {#section-207 .H6}
**with** { UE (MCPTT Client) having established an MCPTT On-demand Pre-
arranged Group Call with Automatic Commencement Mode }
ensure that {
**when** { the UE (MCPTT Client) receives MBMS bearer announcements via SIP
MESSAGE messages }
**then** { UE (MCPTT Client) responds by sending a SIP 200 (OK) to the SIP
MESSAGE message **and** the UE (MCPTT Client) sends an MBMS listening status
message via SIP MESSAGE }
}
##### (2) {#section-208 .H6}
**with** { UE (MCPTT Client) having established an MCPTT On-demand Pre-
arranged Group Call with Automatic Commencement Mode }
ensure that {
**when** { the UE (MCPTT Client) receives MBMS subchannel control messages }
**then** { UE (MCPTT Client) responds by sending an MBMS listening status
message via SIP MESSAGE }
}
##### (3) {#section-209 .H6}
**with** { UE (MCPTT Client) listening to the MBMS subchannel during an
ongoing MCPTT On-demand Pre-arranged Group Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) engages in communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the MCPTT
Server on the MBMS subchannel (Floor Taken and Floor Idle) **and** continues
to respect floor control imposed by the MCPTT Server via unicast (Floor Ack
and Floor Release)}
}
##### (4) {#section-210 .H6}
**with** { UE (MCPTT Client) no longer listening to the MBMS subchannel during
an ongoing MCPTT On-demand Pre-arranged Group Call }
ensure that {
**when** { the MCPTT User (MCPTT Client) engages in communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects floor control imposed by the MCPTT
Server via unicast (Floor Idle)}
}
##### (5) {#section-211 .H6}
**with** { UE (MCPTT Client) having established an MCPTT On-demand Pre-
arranged Group Call with Automatic Commencement Mode }
ensure that {
**when** { the UE (MCPTT Client) receives an explicit MuSiK download message }
**then** { UE (MCPTT Client) sends a 200 OK response to accept the key and
associates the key with the group}
}
##### 6.4.1.2 Conformance requirements {#conformance-requirements-72 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379, clause 14.3.3.2, TS 24.380, clauses 10.3.2, 10.3.3,
10.3.4, 6.2.4.3.5, 6.2.4.5.3, 6.2.4.4.2, 6.2.4.3.2. Unless otherwise stated,
these are Rel-13 requirements.
[TS 24.379, clause 14.3.3.2]
When the MCPTT client wants to report the MBMS bearer listening status, the
MCPTT client:
> NOTE 1: The application/vnd.3gpp.mcptt-mbms-usage-info+xml can contain both
> the listening status \"listening\" and \"not listening\" at the same time.
>
> 1) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229
> [4] and IETF RFC 3428 [33]; and
>
> 2) the SIP MESSAGE request:
>
> a) shall include in the Request-URI the MBMS public service identity of the
> participating MCPTT function received in the P-Asserted-Identity header
> field of the announcement message;
>
> b) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media-feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\"
> according to IETF RFC 3841 [6];
>
> c) should include a public user identity in the P-Preferred-Identity header
> field as specified in 3GPP TS 24.229 [4];
>
> d) shall include a P-Preferred-Service header field with the value
> \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
>
> e) shall include an application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body
> with the \ element set to \"1\";
>
> f) if the MCPTT client is listening to the MBMS bearer, the
> application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body:
>
> i) shall include an \ element set to \"listening\";
>
> ii) if the intention is to report that the MCPTT client is listening to the
> MBMS subchannel for an ongoing conversation in a session (e.g. as the
> response to the Map Group To Bearer message), shall include the MCPTT
> session identity of the ongoing conversation in \ element;
>
> iii) shall include one or more \ elements for which the listening
> status applies; and
>
> iv) if the intention is to report that the MCPTT client is listening to the
> general purpose MBMS subchannel, shall include the \
> element set to \"true\";
>
> g) if the MCPTT client is not listening, the application/vnd.3gpp.mcptt-
> mbms-usage-info+xml MIME body:
>
> i) shall include an \ element set to \"not-
> listening\";
>
> iii) shall include one or more \ elements for which the listening
> status applies;
>
> iii) if the intention is to report that the MCPTT client is no longer
> listening to the MBMS subchannel in an ongoing session (e.g. as the response
> to Unmap Group to Bearer message), shall include the MCPTT session identity
> in \ elements; and
>
> iv) if the intention is to report that the MCPTT client is no longer
> listening to general purpose MBMS subchannel, shall include the \ purpose> element set to \"false\"; and
>
> NOTE 2: If the MCPTT client reports that the MCPTT client is no longer
> listening to the general purpose MBMS subchannel, it is implicitly
> understood that the MCPTT client no longer listens to any MBMS subchannel in
> ongoing conversations that the MCPTT client previously reported status
> \"listening\".
>
> h) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ set to the MCPTT ID; and
>
> 3) shall send the SIP MESSAGE request according to 3GPP TS 24.229 [4].
[TS 24.380, clause 10.3.2]
When receiving a Map Group To Bearer message over the general purpose MBMS
subchannel, the MBMS interface in the MCPTT client:
> 1\. shall associate the TMGI in the TMGI field, the MBMS subchannel for
> audio and for floor control with the MCPTT group identity in the MCPTT Group
> ID field.
[TS 24.380, clause 10.3.3]
If the MBMS interface receives RTP media packets or floor control messages
over the MBMS subchannel, the MBMS interface in the MCPTT client:
> 1\. if there is an association between the TMGI, the MBMS subchannel for
> audio and for floor control to an ongoing conversation in a group session:
>
> a. shall forward the received floor control messages to the floor
> participant in the conversation; and
>
> b. if the received RTP medias contains a different SSRC value than the SSRC
> value used by the MCPTT client, shall forward the received RTP packets to
> the media mixer in the conversation; and
>
> 2\. if there is no such association:
>
> a. shall ignore the received floor control message or received RTP media
> packet.
[TS 24.380, clause 10.3.4]
When receiving the Unmap Group To Bearer message over a MBMS subchannel, the
MBMS interface in the MCPTT client:
> 1\. shall remove the association between the TMGI, the MBMS subchannel for
> audio and for floor control from the conversation in the group session
> identified by the MCPTT Group ID field, if such an association exists.
[TS 24.380, clause 6.2.4.3.5]
Upon receiving an indication from the user to request permission to send
media, the floor participant:
> 1\. shall send the Floor Request message toward the floor control server;
> The Floor Request message:
>
> a. if a different priority than the normal priority is required, shall
> include the Floor Priority field with the priority not higher than
> negotiated with the floor control server as specified in subclause 14.3.3;
> and
>
> b. if the floor request is a broadcast group call, system call, emergency
> call or an imminent peril call, shall include a Floor Indicator field
> indicating the relevant call types;
>
> 2\. shall start timer T101 (Floor Request) and initialise counter C101
> (Floor Request) to 1; and
>
> 3\. shall enter the \'U: pending Request\' state.
[TS 24.380, clause 6.2.4.5.3]
Upon receiving an indication from the user to release the permission to send
RTP media, the floor participant:
> 1\. shall send a Floor Release message towards the floor control server The
> Floor Release message:
>
> a. may include the first bit in the subtype of the Floor Release message set
> to \'1\' (acknowledgement is required) as specified in subclause 8.2.2;
>
> NOTE: It is an implementation option to handle the receipt of the Floor Ack
> message and what action to take if the Floor Ack message is not received.
>
> b. if the session is a broadcast call and if the session was established as
> a normal call, shall include the Floor Indicator with the A-bit set to \'1\'
> (Normal call); and
>
> c. if the Floor Granted message included the G-bit set to \'1\' (Dual
> floor), shall include the Floor Indicator with the G-bit set to \'1\' (Dual
> floor);
>
> 2\. shall remove the indication that the participant is overriding without
> revoke if this indication is stored;
>
> 3\. shall remove the indication that the participant is overridden without
> revoke if this indication is stored;
>
> 4\. shall start timer T100 (Floor Release) and initialize counter C100
> (Floor Release) to 1; and
>
> 5\. shall enter the \'U: pending Release\' state.
[TS 24.380, clause 6.2.4.4.2]
Upon receiving a Floor Granted message from the floor control server or a
floor granted indication in an SIP 200 (OK) response in the application and
signalling layer, the floor participant:
> 1\. if the first bit in the subtype of the Floor Granted message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'1\' (Floor Granted); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. shall provide floor granted notification to the user, if not already
> done;
>
> NOTE: Providing the floor granted notification to the user prior to
> receiving the Floor Granted message is an implementation option.
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
> store an indication that the participant is overriding without revoke;
>
> 5\. shall stop the optional timer T103 (End of RTP media), if running;
>
> 6\. shall stop timer T101 (Floor Request); and
>
> 7\. shall enter the \'U: has permission\' state.
[TS 24.380, clause 6.2.4.3.2]
Upon receiving a Floor Idle message, the participant:
> 1\. if the first bit in the subtype of the Floor Idle message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'5\' (Floor Idle); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. may provide floor idle notification to the user, if it has not already
> done so;
>
> 3\. shall stop the optional timer T103 (End of RTP media), if it is running;
> and
>
> 4\. shall remain in the \'U: has no permission\' state.
##### 6.4.1.3 Test description {#test-description-72 .H6}
##### 6.4.1.3.1 Pre-test conditions {#pre-test-conditions-72 .H6}
##### System Simulator: {#system-simulator-72 .H6}
\- Void
##### IUT: {#iut-72 .H6}
\- Void
##### Preamble: {#preamble-72 .H6}
\- A pre-activated MBMS bearer exists
##### 6.4.1.3.2 Test procedure sequence {#test-procedure-sequence-72 .H6}
Table 6.4.1.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | without | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.579 | | | | | | | -1 [2], | | | | | | | clause | | | | | | | 5.4.3 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | in | | | | | | | E-UTRA\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | The UE | --> | SIP | - | - | | | (MCPTT | | INVITE | | | | | client) | | | | | | | sends an | | | | | | | initial | | | | | | | SIP | | | | | | | INVITE | | | | | | | request | | | | | | | r | | | | | | | equesting | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | floor | | | | | | | control, | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | The SS | \ | SIP ACK | - | - | | | (MCPTT | | | | | | | client) | | | | | | | sends a | | | | | | | SIP ACK. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | The UE | - | - | - | - | | | (MCPTT | | | | | | | client) | | | | | | | notifies | | | | | | | the user | | | | | | | that the | | | | | | | call has | | | | | | | been | | | | | | | est | | | | | | | ablished. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | The | - | - | - | - | | | procedure | | | | | | | \'MCPTT | | | | | | | Floor | | | | | | | Release | | | | | | | -- Floor | | | | | | | Idle\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3A.15.3-1 | | | | | | | is | | | | | | | p | | | | | | | erformed. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10-11 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 12 | The SS | \ | SIP 200 | 1 | P | | | Does the | | (OK) | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | with a | | | | | | | SIP 200 | | | | | | | (OK)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 14 | Check: | --> | SIP | 1 | P | | | Does the | | MESSAGE | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | c | | | | | | | ontaining | | | | | | | an MBMS | | | | | | | Bearer | | | | | | | listening | | | | | | | status | | | | | | | report? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15 | The SS | \ | Floor | - | - | | | (MCPTT | | Request | | | | | client) | | | | | | | sends a | | | | | | | Floor | | | | | | | Request | | | | | | | message. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 18 | The SS | \ | SIP | 2 | P | | | Does the | | MESSAGE | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | to the | | | | | | | Map Group | | | | | | | To Bearer | | | | | | | message | | | | | | | by | | | | | | | sending a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | c | | | | | | | ontaining | | | | | | | an MBMS | | | | | | | Bearer | | | | | | | listening | | | | | | | status | | | | | | | report? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 20 | The SS | \ | Floor Ack | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | with a | | | | | | | Floor Ack | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 22a1 | The SS | \ | SIP 200 | 5 | P | | | Does the | | (OK) | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | with a | | | | | | | SIP 200 | | | | | | | (OK)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 23 | The SS | \ | Floor | 3 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Release | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step 26a1 | | | | | | | describes | | | | | | | behaviour | | | | | | | that | | | | | | | depends | | | | | | | on the UE | | | | | | | implem | | | | | | | entation; | | | | | | | the | | | | | | | \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | i | | | | | | | dentifies | | | | | | | a step | | | | | | | sequence | | | | | | | that take | | | | | | | place if | | | | | | | the UE | | | | | | | requests | | | | | | | an | | | | | | | acknow | | | | | | | ledgement | | | | | | | to the | | | | | | | Floor | | | | | | | Release | | | | | | | message. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 26a1 | The SS | \ | Floor Ack | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | with a | | | | | | | Floor Ack | | | | | | | message | | | | | | | sent over | | | | | | | the MBMS | | | | | | | su | | | | | | | bchannel? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 29 | The SS | \ | Floor Ack | 3 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | with a | | | | | | | Floor Ack | | | | | | | message | | | | | | | sent over | | | | | | | the MBMS | | | | | | | su | | | | | | | bchannel? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 33 | The SS | \ | SIP | 2 | P | | | Does the | | MESSAGE | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | to the | | | | | | | Unmap | | | | | | | Group To | | | | | | | Bearer | | | | | | | message | | | | | | | with a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | c | | | | | | | ontaining | | | | | | | an MBMS | | | | | | | bearer | | | | | | | listening | | | | | | | status | | | | | | | report? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 35 | The SS | \ | SIP 200 | 1 | P | | | Does the | | (OK) | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | with a | | | | | | | SIP 200 | | | | | | | (OK)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 38 | Check: | --> | SIP | 1 | P | | | Does the | | MESSAGE | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | c | | | | | | | ontaining | | | | | | | an MBMS | | | | | | | Bearer | | | | | | | listening | | | | | | | status | | | | | | | report? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 38a | The SS | \ | Floor Ack | 4 | P | | | Does the | | | | | | | UE | | | | | | | respond | | | | | | | with a | | | | | | | Floor Ack | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 41 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 42 | The UE | - | - | - | - | | | (MCPTT | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'MCX CO | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3.10.3-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 6.4.1.3.3 Specific message contents {#specific-message-contents-72 .H6}
Table 6.4.1.3.3-1: SIP INVITE (step 2, Table 6.4.1.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition GROUP-CALL
* * *
Table 6.4.1.3.3-2: SIP MESSAGE (step 12, Table 6.4.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1
* * *
Information Element Value/remark Comment Reference Condition **Accept-
Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
**P-Asserted-Identity**  
addr-spec  
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part SDP message  
MIME-part-headers  
Content-Type \"application/sdp\"  
Content-Disposition \"render\"  
MIME-part-body SDP message as described in Table 6.4.1.3.3-3  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.1.3.3-4
Table 6.4.1.3.3-3: SDP in SIP MESSAGE (Table 6.4.1.3.3-2)
+-------------+-------------+-------------+-------------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], | | | | | | Table | | | | | | 5.5.3.1.2-1 | | | | | +=============+=============+=============+=============+===========+ | Information | V | Comment | Reference | Condition | | Element | alue/remark | | | | +-------------+-------------+-------------+-------------+-----------+ | **Media | | | | | | des | | | | | | criptions** | | | | | +-------------+-------------+-------------+-------------+-----------+ | **media | | m= line | | | | de | | | | | | scription** | | media = | | | | | | audio | | | +-------------+-------------+-------------+-------------+-----------+ | media | \"audio\" | | | | +-------------+-------------+-------------+-------------+-----------+ | port | \"9\" | | | | +-------------+-------------+-------------+-------------+-----------+ | proto | \"RTP/AVP\" | | | | +-------------+-------------+-------------+-------------+-----------+ | fmt | \"99\" | | | | +-------------+-------------+-------------+-------------+-----------+ | * | | c= line | | | | _Connection | | | | | | Data_ _| | | | | +-------------+-------------+-------------+-------------+-----------+ | nettype | \"IN\" | | | | +-------------+-------------+-------------+-------------+-----------+ | addrtype | \"IP4\" or | | | | | | "IP6" | | | | | | depending | | | | | | on IP | | | | | | address | | | | +-------------+-------------+-------------+-------------+-----------+ | connect | \"0.0.0.0\" | | | | | ion-address | (IPv4) or | | | | | | domain name | | | | | | within | | | | | | ".invalid" | | | | | | DNS top | | | | | | level | | | | | | domain | | | | | | (IPv6) | | | | +-------------+-------------+-------------+-------------+-----------+ |__media | | m= line | | | | de | | | | | | scription_ _| | media = | | | | | | application | | | +-------------+-------------+-------------+-------------+-----------+ | media | \"ap | | | | | | plication\" | | | | +-------------+-------------+-------------+-------------+-----------+ | port | \"9\" | | | | +-------------+-------------+-------------+-------------+-----------+ | proto | \"udp\" | | | | +-------------+-------------+-------------+-------------+-----------+ | fmt | \"MCPTT\" | | | | +-------------+-------------+-------------+-------------+-----------+ | * | | c= line | | | |_ Connection | | | | | | Data** | | | | | +-------------+-------------+-------------+-------------+-----------+ | nettype | \"IN\" | | | | +-------------+-------------+-------------+-------------+-----------+ | addrtype | \"IP4\" or | | | | | | "IP6" | | | | | | depending | | | | | | on IP | | | | | | address | | | | +-------------+-------------+-------------+-------------+-----------+ | connect | \"0.0.0.0\" | | | | | ion-address | (IPv4) or | | | | | | domain name | | | | | | within | | | | | | ".invalid" | | | | | | DNS top | | | | | | level | | | | | | domain | | | | | | (IPv6) | | | | +-------------+-------------+-------------+-------------+-----------+ | media | | m= line | | | | description | | | | | | | | media = | | | | | | application | | | +-------------+-------------+-------------+-------------+-----------+ | media | \"ap | | | | | | plication\" | | | | +-------------+-------------+-------------+-------------+-----------+ | port | port number | | | | | | assigned by | | | | | | the SS | | | | +-------------+-------------+-------------+-------------+-----------+ | proto | \"udp\" | | | | +-------------+-------------+-------------+-------------+-----------+ | fmt | \"MCPTT\" | | | | +-------------+-------------+-------------+-------------+-----------+ | Connection | | c= line | | | | Data | | | | | +-------------+-------------+-------------+-------------+-----------+ | nettype | \"IN\" | | | | +-------------+-------------+-------------+-------------+-----------+ | addrtype | \"IP4\" | | | | +-------------+-------------+-------------+-------------+-----------+ | connect | multicast | | | | | ion-address | IP assigned | | | | | | by the SS | | | | +-------------+-------------+-------------+-------------+-----------+ | media | | a= line | | | | attribute | | | | | | | | attribute = | | | | | | key-mgmt | | | +-------------+-------------+-------------+-------------+-----------+ | key-mgmt | | | TS 24.379 | | | | | | [9] | | | | | | clause | | | | | | 14.2.2.2 | | +-------------+-------------+-------------+-------------+-----------+ | mikey | MIKEY-SAKKE | MSCCK | RFC 4567 | | | | I_MESSAGE | d | [44] | | | | as | istribution | | | | | specified | as | | | | | in TS | specified | | | | | 36.579-1 | in TS | | | | | [2], | 33.180 | | | | | Table | [33] | | | | | 5.5.9.1-x. | Annex H | | | +-------------+-------------+-------------+-------------+-----------+
Table 6.4.1.3.3-4: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table 6.4.1.3.3-2)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 24.379 | | | | | | [9], | | | | | | Clause F.2 | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | mcptt-mbm | | | | | | s-usage-info | | | | | +--------------+--------------+--------------+-----------+-----------+ | mbms-list | not present | | | | | ening-status | | | | | +--------------+--------------+--------------+-----------+-----------+ | announcement | | | | | +--------------+--------------+--------------+-----------+-----------+ | TMGI | | | | | +--------------+--------------+--------------+-----------+-----------+ | MBMS Service | \"0F0F0F\" | The selected | | | | ID | | value is | | | | | | randomly | | | | | | chosen - a 6 | | | | | | digit | | | | | | hexadecimal | | | | | | number | | | | | | between | | | | | | 000000 and | | | | | | | | | | | | FFFFFF (see | | | | | | TS 23.003 | | | | | | [X] clause | | | | | | 15.2. | | | | | | | | | | | | The coding | | | | | | of the MBMS | | | | | | Service ID | | | | | | is the | | | | | | re | | | | | | sponsibility | | | | | | of each | | | | | | ad | | | | | | ministration | | | +--------------+--------------+--------------+-----------+-----------+ | MCC | The same | Mobile | | | | | value as for | Country Code | | | | | PLMN1 | | | | | | specified in | | | | | | Table | | | | | | 5.5.8.1-x | | | | +--------------+--------------+--------------+-----------+-----------+ | MNC | The same | Mobile | | | | | value as for | Network Code | | | | | PLMN1 | | | | | | specified in | | | | | | Table | | | | | | 5.5.8.1-x | | | | +--------------+--------------+--------------+-----------+-----------+ | QCI | \"65\" | Mission | | | | | | Critical | | | | | | user plane | | | | | | Push To Talk | | | | | | voice | | | +--------------+--------------+--------------+-----------+-----------+ | mbms-s | \"0\" | The selected | | | | ervice-areas | | value is | | | | | | randomly | | | | | | chosen. | | | | | | | | | | | | The value 0 | | | | | | has a | | | | | | special | | | | | | meaning; it | | | | | | shall denote | | | | | | the whole | | | | | | PLMN as the | | | | | | MBMS Service | | | | | | Area | | | +--------------+--------------+--------------+-----------+-----------+ | GPMS | \"2\" | The number | | | | | | of the | | | | | | \"m=a | | | | | | pplication\" | | | | | | media line | | | | | | in the | | | | | | app | | | | | | lication/sdp | | | | | | MIME | | | +--------------+--------------+--------------+-----------+-----------+ | version | \"1\" | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.4.1.3.3-5: SIP MESSAGE (step 14, Table 6.4.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Request-Line**  
Request-URI The value received in the P-Asserted-Identity header field of the
announcement message (px_MBMS_Service_ID)  
**Accept-Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Preferred-Identity**  
PPreferredID-value px_MCPTT_User_A_ID  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.1.3.3-6
Table 6.4.1.3.3-6: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table 6.4.1.3.3-5)
Derivation Path: TS 24.379 [9], Clause F.2
* * *
Information Element Value/remark Comment Reference Condition mcptt-mbms-usage-
info  
mbms-listening-status  
mbms-listening-status \"listening\"  
session-id not present  
general-purpose \"true\"  
TMGI same value as the announcement in the SIP MESSAGE  
announcement not present  
version \"1\"
Table 6.4.1.3.3-7: SIP MESSAGE (step 19, Table 6.4.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Request-Line**  
Request-URI The value received in the P-Asserted-Identity header field of the
announcement message (px_MBMS_Service_ID)  
**Accept-Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Preferred-Identity**  
PPreferredID-value px_MCPTT_User_A_ID  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.1.3.3-8
Table 6.4.1.3.3-8: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table 6.4.1.3.3-7)
Derivation Path: TS 24.379 [9], Clause F.2
* * *
Information Element Value/remark Comment Reference Condition mcptt-mbms-usage-
info  
mbms-listening-status  
mbms-listening-status \"listening\"  
session-id px_sesson_A_ID  
general-purpose not present  
TMGI same value as the announcement in the SIP MESSAGE  
announcement not present  
version \"1\"
Table 6.4.1.3.3-9: SIP MESSAGE (step 34, Table 6.4.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Request-Line**  
Request-URI The value received in the P-Asserted-Identity header field of the
announcement message (px_MBMS_Service_ID)  
**Accept-Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Preferred-Identity**  
PPreferredID-value px_MCPTT_User_A_ID  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.1.3.3-10
Table 6.4.1.3.3-10: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table 6.4.1.3.3-10)
Derivation Path: TS 24.379 [9], Clause F.2
* * *
Information Element Value/remark Comment Reference Condition mcptt-mbms-usage-
info  
mbms-listening-status  
mbms-listening-status \"not-listening\"  
session-id px_sesson_A_ID  
general-purpose not present  
TMGI same value as the announcement in the SIP MESSAGE  
announcement not present  
version \"1\"
Table 6.4.1.3.3-11: SIP MESSAGE (step 36, Table 6.4.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Accept-
Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
**P-Asserted-Identity**  
addr-spec  
user-info and host px_MBMS_Service_ID The MBMS public service identity of the
participating MCPTT function  
port not present  
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.1.3.3-12
Table 6.4.1.3.3-12: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table 6.4.1.3.3-11)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 24.379 | | | | | | [9], | | | | | | Clause F.2 | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | mcptt-mbm | | | | | | s-usage-info | | | | | +--------------+--------------+--------------+-----------+-----------+ | mbms-list | not present | | | | | ening-status | | | | | +--------------+--------------+--------------+-----------+-----------+ | announcement | | | | | +--------------+--------------+--------------+-----------+-----------+ | TMGI | | | | | +--------------+--------------+--------------+-----------+-----------+ | MBMS Service | \"0F0F0F\" | The selected | | | | ID | | value is | | | | | | randomly | | | | | | chosen - a 6 | | | | | | digit | | | | | | hexadecimal | | | | | | number | | | | | | between | | | | | | 000000 and | | | | | | | | | | | | FFFFFF (see | | | | | | TS 23.003 | | | | | | [X] clause | | | | | | 15.2. | | | | | | | | | | | | The coding | | | | | | of the MBMS | | | | | | Service ID | | | | | | is the | | | | | | re | | | | | | sponsibility | | | | | | of each | | | | | | ad | | | | | | ministration | | | +--------------+--------------+--------------+-----------+-----------+ | MCC | The same | Mobile | | | | | value as for | Country Code | | | | | PLMN1 | | | | | | specified in | | | | | | Table | | | | | | 5.5.8.1-x | | | | +--------------+--------------+--------------+-----------+-----------+ | MNC | The same | Mobile | | | | | value as for | Network Code | | | | | PLMN1 | | | | | | specified in | | | | | | Table | | | | | | 5.5.8.1-x | | | | +--------------+--------------+--------------+-----------+-----------+ | QCI | \"65\" | Mission | | | | | | Critical | | | | | | user plane | | | | | | Push To Talk | | | | | | voice | | | +--------------+--------------+--------------+-----------+-----------+ | mbms-s | not present | | | | | ervice-areas | | | | | +--------------+--------------+--------------+-----------+-----------+ | GPMS | not present | | | | +--------------+--------------+--------------+-----------+-----------+ | version | \"1\" | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.4.1.3.3-13: SIP MESSAGE (step 38, Table 6.4.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Request-Line**  
Request-URI The value received in the P-Asserted-Identity header field of the
announcement message (px_MBMS_Service_ID)  
**Accept-Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Preferred-Identity**  
PPreferredID-value px_MCPTT_User_A_ID  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.1.3.3-14
Table 6.4.1.3.3-13a: SIP MESSAGE (step 22a1, Table 6.4.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1
* * *
Information Element Value/remark Comment Reference Condition **Accept-
Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
**P-Asserted-Identity**  
addr-spec  
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.1.3.3-13B  
MIME body part MIKEY message  
MIME-part-headers  
Content-Type \"application/mikey\"  
MIME-part-body As described in TS 36.579-1 [2], Table 5.5.9.1-x. MIKEY message
containing the MuSiK
Table 6.4.1.3.3-13B: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table
6.4.1.3.3-13a)
Derivation Path: TS 24.379 [9], Clause F.2
* * *
Information Element Value/remark Comment Reference Condition mcptt-mbms-usage-
info  
mbms-listening-status not present  
announcement not present  
version \"1\"  
anyExt  
mbms-explicitMuSiK-download  
group px_MCPTT_Group_A_ID
Table 6.4.1.3.3-14: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table 6.4.1.3.3-13)
Derivation Path: TS 24.379 [9], Clause F.2
* * *
Information Element Value/remark Comment Reference Condition mcptt-mbms-usage-
info  
mbms-listening-status  
mbms-listening-status \"not-listening\"  
session-id not present  
general-purpose \"false\"  
TMGI same value as the announcement in the SIP MESSAGE  
announcement not present  
version \"1\"
Table 6.4.1.3.3-19: Floor Idle (steps 27, 31, 39, Table 6.4.1.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.6-1, condition ACK
* * *
Table 6.4.1.3.3-21: Floor Granted (step 21, Table 6.4.1.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.3-1, condition EMERGENCY-CALL.
ACK
* * *
Table 6.4.1.3.3-21..24: Void
6.4.2 On-network / MBMS / Multi Talker
##### 6.4.2.1 Test Purpose (TP) {#test-purpose-tp-73 .H6}
##### (1) {#section-212 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service }
ensure that {
**when** { the MCPTT User requests the establishment of an MCPTT On-demand
Pre-arranged Group Call and implicit floor control }
**then** { UE (MCPTT Client) requests On-demand Automatic Commencement Mode
Pre-arranged Group Call establishment with implicit floor control by sending a
SIP INVITE message, **and** , after indication from the MCPTT Server that the
call was established and receiving a Floor Granted message, notifies the MCPTT
User **and** respects basic floor control (Floor Release, Floor Idle, Floor
Ack, Floor Request)}
}
##### (2) {#section-213 .H6}
**with** { UE (MCPTT Client) having established an MCPTT On-demand Pre-
arranged Group Call with Automatic Commencement Mode }
ensure that {
**when** { the UE (MCPTT Client) receives MBMS bearer announcements via SIP
MESSAGE messages }
**then** { UE (MCPTT Client) responds by sending a SIP 200 (OK) to the SIP
MESSAGE message **and** the UE (MCPTT Client) sends an MBMS listening status
message via SIP MESSAGE }
}
##### (3) {#section-214 .H6}
**with** { UE (MCPTT Client) having established an MCPTT On-demand Pre-
arranged Group Call with Automatic Commencement Mode }
ensure that {
**when** { the UE (MCPTT Client) receives MBMS subchannel control messages }
**then** { UE (MCPTT Client) responds by sending an MBMS listening status
message via SIP MESSAGE }
}
##### (4) {#section-215 .H6}
**with** { UE (MCPTT Client) having established an MCPTT On-demand Pre-
arranged Group Call with Automatic Commencement Mode }
ensure that {
**when** { the UE (MCPTT Client) receives an explicit MuSiK download message }
**then** { UE (MCPTT Client) sends a 200 OK response to accept the key and
associates the key with the group}
}
##### (5) {#section-216 .H6}
**with** { UE (MCPTT Client) listening to the MBMS subchannel during an
ongoing MCPTT On-demand Pre-arranged Group Call }
ensure that {
**when** { the (MCPTT Client) receives multi-talker floor control messages
from the SS (MCPTT Server) over the MBMS subchannel }
**then** { UE (MCPTT Client) notifies the MCPTT User }
}
##### (6) {#section-217 .H6}
**with** { UE (MCPTT Client) listening to the MBMS subchannel during an
ongoing MCPTT On-demand Pre-arranged Group Call }
ensure that {
**when** { the MCPTT User engages in communication with the invited MCPTT
User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the MCPTT
Server on the MBMS subchannel (Floor Taken and Floor Idle) **and** continues
to respect floor control imposed by the MCPTT Server via unicast (Floor Ack
and Floor Release)}
}
##### (7) {#section-218 .H6}
**with** { UE (MCPTT Client) having an ongoing On-demand Pre-arranged Group
Call with Automatic Commencement Mode }
ensure that {
**when** { the MCPTT User requests terminate the ongoing MCPTT Group Call }
**then** { UE (MCPTT Client) sends a SIP BYE request and leaves the MCPTT
session }
}
##### 6.4.2.2 Conformance requirements {#conformance-requirements-73 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379, clauses 10.1.1.2.1.1, 6.2.4.1, 14.3.3.2, TS 24.380,
clauses 10.3.2, 10.3.3, 10.3.4, 6.2.4.2.2, 6.2.4.4.2, 6.2.4.5.3, 6.2.4.6.4,
6.2.4.3.5, 6.2.4.5.8, 6.2.4.5.9, 6.2.4.3.2. Unless otherwise stated, these are
Rel-15 requirements.
[TS 24.379, clause 10.1.1.2.1.1]
Upon receiving a request from an MCPTT user to establish an MCPTT prearranged
group session the MCPTT client shall generate an initial SIP INVITE request by
following the UE originating session procedures specified in 3GPP TS 24.229
[4], with the clarifications given below.
The MCPTT client:
> 1) if the MCPTT user has requested the origination of an MCPTT emergency
> group call or is originating an MCPTT prearranged group call and the MCPTT
> emergency state is already set, the MCPTT client shall comply with the
> procedures in clause 6.2.8.1.1;
>
> 2) if the MCPTT user has requested the origination of an MCPTT imminent
> peril group call, the MCPTT client shall comply with the procedures in
> clause 6.2.8.1.9;
>
> 3) if the MCPTT user has requested the origination of a broadcast group
> call, the MCPTT client shall comply with the procedures in clause 6.2.8.2;
>
> 4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
> media feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE
> request according to IETF RFC 3840 [16];
>
> 5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
> media feature tag along with the \"require\" and \"explicit\" header field
> parameters according to IETF RFC 3841 [6];
>
> 6) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
> (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [9] in the SIP INVITE request;
>
> 7) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media feature tag containing the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header
> field parameters according to IETF RFC 3841 [6];
>
> 8) should include the \"timer\" option tag in the Supported header field;
>
> 9) should include the Session-Expires header field according to IETF RFC
> 4028 [7]. It is recommended that the \"refresher\" header field parameter is
> omitted. If included, the \"refresher\" header field parameter shall be set
> to \"uac\";
>
> 10) shall set the Request-URI of the SIP INVITE request to the public
> service identity identifying the participating MCPTT function serving the
> MCPTT user;
>
> NOTE 1: The MCPTT client is configured with public service identity
> identifying the participating MCPTT function serving the MCPTT user.
>
> 11) may include a P-Preferred-Identity header field in the SIP INVITE
> request containing a public user identity as specified in 3GPP TS 24.229
> [4];
>
> 12) if the MCPTT client emergency group state for this group is set to \"MEG
> 2: in-progress\" or \"MEG 4: confirm-pending\", the MCPTT client shall
> include the Resource-Priority header field and comply with the procedures in
> clause 6.2.8.1.2;
>
> 13) if the MCPTT client imminent peril group state for this group is set to
> \"MIG 2: in-progress\" or \"MIG 4: confirm-pending\" shall include the
> Resource-Priority header field and comply with the procedures in clause
> 6.2.8.1.12;
>
> 14) shall contain in an application/vnd.3gpp.mcptt-info+xml MIME body with
> the \ element containing the \ element with:
>
> a) the \ element set to a value of \"prearranged\";
>
> b) the \ element set to the group identity;
>
> c) the \ element set to the MCPTT client ID of the
> originating MCPTT client;
>
> NOTE 2: The MCPTT client does not include the MCPTT ID of the originating
> MCPTT user in the body, as this will be inserted into the body of the SIP
> INVITE request that is sent from the originating participating MCPTT
> function.
>
> d) if the group identity can be determined to be a TGI and if the MCPTT
> client can associate the TGI with a MCPTT group ID, the \ id> element set to the MCPTT group ID; and
>
> e) if the MCPTT client is aware of active functional-aliases, and an active
> functional alias is to be included in the initial SIP INVITE request, the
> \ set to the URI of the used functional alias;
>
> NOTE 3: The text \"can associate the TGI with a MCPTT group ID\" means that
> the MCPTT client is able to determine that there is a constituent group of
> the temporary group that it is a member of.
>
> NOTE 4: The MCPTT client is informed about temporary groups and regrouping
> of MCPTT groups that the user is a member of as specified in 3GPP TS 24.481
> [31].
>
> NOTE 5: If the MCPTT user selected a TGI where there are several MCPTT
> groups where the MCPTT user is a member, the MCPTT client selects one of
> those MCPTT groups.
>
> NOTE 6: The MCPTT client learns the functional aliases that are activated
> for an MCPTT ID from procedures specified in clause 9A.2.1.3.
>
> 15) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
> clarifications given in clause 6.2.1;
>
> 16) if an implicit floor request is required, shall indicate this as
> specified in clause 6.4; and
>
> 17) shall send the SIP INVITE request towards the MCPTT server according to
> 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:
> 1) shall interact with the user plane as specified in 3GPP TS 24.380 [5] ;
>
> 2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-
> call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent
> peril group call state is set to \"MIGC 2: imminent-peril-call-requested\"
> or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform
> the actions specified in clause 6.2.8.1.4;
>
> 2A) may notify the answer state to the user (i.e. \"Unconfirmed\" or
> \"Confirmed\") if received in the P-Answer-State header field; and
>
> 3) may subscribe to the conference event package as specified in clause
> 10.1.3.1.
[TS 24.379, clause 6.2.4.1]
Upon receiving a request from an MCPTT user to leave an MCPTT session
established using on-demand session signalling, the MCPTT client:
> 1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
>
> 2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4];
>
> 3) shall set the Request-URI to the MCPTT session identity to leave; and
>
> 4) shall send a SIP BYE request towards MCPTT server according to 3GPP TS
> 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT
client shall interact with the media plane as specified in 3GPP TS 24.380 [5].
[TS 24.379, clause 14.3.3.2]
When the MCPTT client wants to report the MBMS bearer listening status, the
MCPTT client:
> NOTE 1: The application/vnd.3gpp.mcptt-mbms-usage-info+xml can contain both
> the listening status \"listening\" and \"not listening\" at the same time.
>
> 1) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229
> [4] and IETF RFC 3428 [33]; and
>
> 2) the SIP MESSAGE request:
>
> a) shall include in the Request-URI the MBMS public service identity of the
> participating MCPTT function received in the P-Asserted-Identity header
> field of the announcement message;
>
> b) shall include an Accept-Contact header field with the g.3gpp.icsi-ref
> media-feature tag with the value of \"urn:urn-7:3gpp-
> service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\"
> according to IETF RFC 3841 [6];
>
> c) should include a public user identity in the P-Preferred-Identity header
> field as specified in 3GPP TS 24.229 [4];
>
> d) shall include a P-Preferred-Service header field with the value
> \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
>
> e) shall include an application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body
> with the \ element set to \"1\";
>
> f) if the MCPTT client is listening to the MBMS bearer, the
> application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body:
>
> i) shall include an \ element set to \"listening\";
>
> ii) if the intention is to report that the MCPTT client is listening to the
> MBMS subchannel for an ongoing conversation in a session (e.g. as the
> response to the Map Group To Bearer message), shall include the MCPTT
> session identity of the ongoing conversation in \ element;
>
> iii) shall include one or more \ elements for which the listening
> status applies; and
>
> iv) if the intention is to report that the MCPTT client is listening to the
> general purpose MBMS subchannel, shall include the \
> element set to \"true\";
>
> g) if the MCPTT client is not listening, the application/vnd.3gpp.mcptt-
> mbms-usage-info+xml MIME body:
>
> i) shall include an \ element set to \"not-
> listening\";
>
> iii) shall include one or more \ elements for which the listening
> status applies;
>
> iii) if the intention is to report that the MCPTT client is no longer
> listening to the MBMS subchannel in an ongoing session (e.g. as the response
> to Unmap Group to Bearer message), shall include the MCPTT session identity
> in \ elements; and
>
> iv) if the intention is to report that the MCPTT client is no longer
> listening to general purpose MBMS subchannel, shall include the \ purpose> element set to \"false\"; and
>
> NOTE 2: If the MCPTT client reports that the MCPTT client is no longer
> listening to the general purpose MBMS subchannel, it is implicitly
> understood that the MCPTT client no longer listens to any MBMS subchannel in
> ongoing conversations that the MCPTT client previously reported status
> \"listening\".
>
> h) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
> \ set to the MCPTT ID; and
>
> 3) shall send the SIP MESSAGE request according to 3GPP TS 24.229 [4].
[TS 24.380, clause 10.3.2]
When receiving a Map Group To Bearer message over the general purpose MBMS
subchannel, the MBMS interface in the MCPTT client:
> 1\. shall associate the TMGI in the TMGI field, the MBMS subchannel for
> audio and for floor control with the MCPTT group identity in the MCPTT Group
> ID field.
[TS 24.380, clause 10.3.3]
If the MBMS interface receives RTP media packets or floor control messages
over the MBMS subchannel, the MBMS interface in the MCPTT client:
> 1\. if there is an association between the TMGI, the MBMS subchannel for
> audio and for floor control to an ongoing conversation in a group session:
>
> a. shall forward the received floor control messages to the floor
> participant in the conversation; and
>
> b. if the received RTP medias contains a different SSRC value than the SSRC
> value used by the MCPTT client, shall forward the received RTP packets to
> the media mixer in the conversation; and
>
> 2\. if there is no such association:
>
> a. shall ignore the received floor control message or received RTP media
> packet.
[TS 24.380, clause 10.3.4]
When receiving the Unmap Group To Bearer message over a MBMS subchannel, the
MBMS interface in the MCPTT client:
> 1\. shall remove the association between the TMGI, the MBMS subchannel for
> audio and for floor control from the conversation in the group session
> identified by the MCPTT Group ID field, if such an association exists.
[TS 24.380, clause 6.2.4.2.2]
When a call is initiated as described in 3GPP TS 24.379 [2], the floor
participant:
> 1\. shall create an instance of the \'Floor participant state transition
> diagram for basic operation\';
>
> 2\. if the originating floor participant receives a floor control message
> before it receives the SIP 200 (OK) response, shall store the floor control
> message;
>
> NOTE: The originating floor participant might receive a floor control
> message before the SIP 200 (OK) response when initiating, joining or
> rejoining a call because of processing delays of the SIP 200 (OK) response
> in the SIP core.
>
> 3\. if the established MCPTT call is a chat group call and the SIP INVITE
> request is not an implicit floor request, shall enter the \'U: has no
> permission\' state; and
>
> 4\. if for the established MCPTT call the SIP INVITE request is an implicit
> floor request:
>
> a. shall start timer T101 (Floor Request) and initialise counter C101 (Floor
> Request) to 1;
>
> b. shall enter the \'U: pending Request\' state; and
>
> c. if the floor participant has received and stored a floor control message
> before the reception of the SIP 200 (OK) response, shall act as if the floor
> control message was received in the \'U: pending Request\' state after
> entering the \'U: pending Request\' state.
When the floor participant is rejoining an ongoing MCPTT call as described in
3GPP TS 24.379 [2] the floor participant shall enter the \'U: has no
permission\' state.
[TS 24.380, clause 6.2.4.4.2]
Upon receiving a Floor Granted message from the floor control server or a
floor granted indication in a SIP 200 (OK) response in the application and
signalling layer, the floor participant:
> 1\. if the first bit in the subtype of the Floor Granted message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'1\' (Floor Granted); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. if the call is not an ambient listening call, shall provide floor
> granted notification to the user, if not already done;
>
> NOTE: Providing the floor granted notification to the user prior to
> receiving the Floor Granted message is an implementation option.
>
> 3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
> store an indication that the participant is overriding without revoke;
>
> 5\. shall stop the optional timer T103 (End of RTP media), if running;
>
> 6\. shall stop timer T101 (Floor Request); and
>
> 7\. shall enter the \'U: has permission\' state.
[TS 24.380, clause 6.2.4.5.3]
Upon receiving an indication from the user to release the permission to send
RTP media, the floor participant:
> 1\. shall send a Floor Release message towards the floor control server. The
> Floor Release message:
>
> a. may include the first bit in the subtype of the Floor Release message set
> to \'1\' (acknowledgement is required) as specified in subclause 8.2.2;
>
> NOTE: It is an implementation option to handle the receipt of the Floor Ack
> message and what action to take if the Floor Ack message is not received.
>
> b. if the session is a broadcast call and if the session was established as
> a normal call, shall include the Floor Indicator with the A-bit set to \'1\'
> (Normal call); and
>
> c. if the Floor Granted message included the G-bit set to \'1\' (Dual
> floor), shall include the Floor Indicator with the G-bit set to \'1\' (Dual
> floor);
>
> 2\. shall remove the indication that the participant is overriding without
> revoke if this indication is stored;
>
> 3\. shall remove the indication that the participant is overridden without
> revoke if this indication is stored;
>
> 4\. shall start timer T100 (Floor Release) and initialize counter C100
> (Floor Release) to 1; and
>
> 5\. shall enter the \'U: pending Release\' state.
[TS 24.380, clause 6.2.4.6.4]
Upon receiving a Floor Idle message, the floor participant:
> 1\. if the first bit in the subtype of the Floor Idle message to \'1\'
> (Acknowledgment is required) as described in subclause 8.3.2, shall send a
> Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'5\' (Floor Idle); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. may provide a floor idle notification to the MCPTT user;
>
> 3\. if the Floor Indicator field is included and the B-bit set to \'1\'
> (Broadcast group call), shall provide a notification to the user indicating
> the type of call;
>
> 4\. shall stop timer T100 (Floor Release);
>
> 5\. if the session is not a broadcast group call or if the A-bit in the
> Floor Indicator field is set to \'1\' (Normal call), shall enter the \'U:
> has no permission\' state; and
>
> 6\. if the session was initiated as a broadcast group call:
>
> a. shall indicate to the MCPTT client the media transmission is completed;
> and
>
> b shall enter the \'Releasing\' state.
[TS 24.380, clause 6.2.4.3.5]
Upon receiving an indication from the user to request permission to send
media, the floor participant:
> 1\. shall send the Floor Request message toward the floor control server;
> The Floor Request message:
>
> a. if a different priority than the normal priority is required, shall
> include the Floor Priority field with the priority not higher than
> negotiated with the floor control server as specified in subclause 14.3.3;
>
> b. if the floor request is a broadcast group call, system call, emergency
> call or an imminent peril call, shall include a Floor Indicator field
> indicating the relevant call types; and
>
> c. shall include the Location field:
>
> i. if the current location of the talker is not available or is not to be
> reported according to the MCPTT user profile, then the location type is set
> to \'0\' (Not provided); or
>
> ii. if the current location of the talker is available and may be reported
> according to the MCPTT user profile, then the location type and location
> value are set as specified in table 8.2.3.21-3;
>
> 2\. shall start timer T101 (Floor Request) and initialise counter C101
> (Floor Request) to 1; and
>
> 3\. shall enter the \'U: pending Request\' state.
[TS 24.380, clause 6.2.4.5.8]
Upon receiving a Floor Taken message:
> 1\. if the G-bit in the Floor Indicator set to \'1\' (Dual Floor) the floor
> participant:
>
> a. shall inform the user that the call is overridden without revoke;
>
> b. shall store an indication that the participant is overridden without
> revoke; and
>
> c. shall remain in the \'U: has permission\' state; and
>
> 2\. if the I-bit in the Floor Indicator set to \'1\' (Multi-talker) the
> floor participant:
>
> a. may provide a floor taken notification to the user;
>
> b. should start the optional timer T103 (End of RTP media) for the
> participant for which Floor Taken message was received;
>
> c. shall provide a notification to the user indicating the type of call and
> may provide a list of current talkers; and
>
> d. shall remain in the \'U: has permission\' state.
[TS 24.380, clause 6.2.4.5.9]
Upon receiving the Floor Release Multi Talker message, the floor participant:
> 1\. shall provide a notification to the user indicating that the participant
> has released the floor in a multi-talker group; and
>
> 2\. shall remain in the \'U: has permission\' state.
[TS 24.380, clause 6.2.4.3.2]
Upon receiving a Floor Idle message, the participant:
> 1\. if the first bit in the subtype of the Floor Idle message is set to
> \'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall
> send a Floor Ack message. The Floor Ack message:
>
> a. shall include the Message Type field set to \'5\' (Floor Idle); and
>
> b. shall include the Source field set to \'0\' (the floor participant is the
> source);
>
> 2\. may provide floor idle notification to the user, if it has not already
> done so;
>
> 3\. shall stop the optional timer T103 (End of RTP media), if it is running;
> and
>
> 4\. shall remain in the \'U: has no permission\' state.
##### 6.4.2.3 Test description {#test-description-73 .H6}
##### 6.4.2.3.1 Pre-test conditions {#pre-test-conditions-73 .H6}
##### System Simulator: {#system-simulator-73 .H6}
\- SS (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
##### IUT: {#iut-73 .H6}
\- UE (MCPTT Client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-73 .H6}
\- A pre-activated MBMS bearer exists
\- The \ element of the MCPTT Group Configuration
Defaults as specified in TS 36.579-1 [2], Table 5.5.7.1-1 is set to \"true\".
\- The \ element of the MCPTT Group
Configuration Defaults as specified in TS 36.579-1 [2], Table 5.5.7.1-1 is set
to \"2\".
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCPTT Client Application has been activated and User has registered-in
as the MCPTT User with the Server as active user at the Client.
##### 6.4.2.3.2 Test procedure sequence {#test-procedure-sequence-73 .H6}
Table 6.4.2.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of a | | | | | | | group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | - | - | 1 | - | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO | | | | | | | session | | | | | | | establis | | | | | | | hment/mod | | | | | | | ification | | | | | | | without | | | | | | | pr | | | | | | | ovisional | | | | | | | responses | | | | | | | other | | | | | | | than 100 | | | | | | | Trying\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5 | | | | | | | .3A.1.3-1 | | | | | | | to** | | | | | | | establish | | | | | | | a group | | | | | | | call with | | | | | | | automatic | | | | | | | com | | | | | | | mencement | | | | | | | mode and | | | | | | | implicit | | | | | | | floor | | | | | | | control | | | | | | | according | | | | | | | to option | | | | | | | b.ii of | | | | | | | NOTE 1 in | | | | | | | TS | | | | | | | 36.579.1 | | | | | | | [2] | | | | | | | Table | | | | | | | **5.3A | | | | | | | .1.3-1**? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Check: | - | - | 1 | - | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | provide | | | | | | | floor | | | | | | | granted | | | | | | | not | | | | | | | ification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the | | | | | | | floor. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | Floor | | | | | | | Release | | | | | | | -- Floor | | | | | | | Idle\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3 | | | | | | | A.15.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | The SS | \ | SIP 200 | 2 | P | | | Does the | | (OK) | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | with a | | | | | | | SIP 200 | | | | | | | (OK)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Check: | --> | SIP | 2 | P | | | Does the | | MESSAGE | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | c | | | | | | | ontaining | | | | | | | an MBMS | | | | | | | Bearer | | | | | | | listening | | | | | | | status | | | | | | | report? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | The SS | \ | Floor | 1 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | The SS | \ | SIP | 3 | P | | | Does the | | MESSAGE | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | to the | | | | | | | Map Group | | | | | | | To Bearer | | | | | | | message | | | | | | | by | | | | | | | sending a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | c | | | | | | | ontaining | | | | | | | an MBMS | | | | | | | Bearer | | | | | | | listening | | | | | | | status | | | | | | | report? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 14 | The SS | \ | Floor Ack | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | with a | | | | | | | Floor Ack | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 17 | The SS | \ | SIP 200 | 4 | P | | | Does the | | (OK) | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | with a | | | | | | | SIP 200 | | | | | | | (OK)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 19 | The SS | \ | Floor | 6 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Release | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step 26a1 | | | | | | | describes | | | | | | | behaviour | | | | | | | that | | | | | | | depends | | | | | | | on the UE | | | | | | | implem | | | | | | | entation; | | | | | | | the | | | | | | | \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | i | | | | | | | dentifies | | | | | | | a step | | | | | | | sequence | | | | | | | that take | | | | | | | place if | | | | | | | the UE | | | | | | | requests | | | | | | | an | | | | | | | acknow | | | | | | | ledgement | | | | | | | to the | | | | | | | Floor | | | | | | | Release | | | | | | | message. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 26a1 | The SS | \ | Floor Ack | 6 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | with a | | | | | | | Floor Ack | | | | | | | message | | | | | | | over the | | | | | | | MBMS | | | | | | | su | | | | | | | bchannel? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 29 | The SS | \ | SIP | 3 | P | | | Does the | | MESSAGE | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | to the | | | | | | | Unmap | | | | | | | Group To | | | | | | | Bearer | | | | | | | message | | | | | | | with a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | c | | | | | | | ontaining | | | | | | | an MBMS | | | | | | | bearer | | | | | | | listening | | | | | | | status | | | | | | | report? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 31 | The SS | \ | SIP 200 | 2 | P | | | Does the | | (OK) | | | | | UE (MCPTT | | | | | | | client) | | | | | | | respond | | | | | | | with a | | | | | | | SIP 200 | | | | | | | (OK)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 34 | Check: | --> | SIP | 2 | P | | | Does the | | MESSAGE | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | c | | | | | | | ontaining | | | | | | | an MBMS | | | | | | | Bearer | | | | | | | listening | | | | | | | status | | | | | | | report? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 35 | The SS | \ | Floor Ack | 1 | P | | | Does the | | | | | | | UE | | | | | | | respond | | | | | | | with a | | | | | | | Floor Ack | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 38 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | client) | | | | | | | release | | | | | | | the call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 39 | Check: | - | - | 7 | - | | | Does the | | | | | | | UE (MCPTT | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCPTT | | | | | | | CO call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3.10.3-1? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 6.4.2.3.3 Specific message contents {#specific-message-contents-73 .H6}
Table 6.4.2.3.3-1: SIP INVITE (step 2, Table 6.4.2.3.2-1; step 2, TS 36.579-1
[2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.3A.1.4-1
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP Message as described in Table 6.4.2.3.3-2  
MIME body part **MCPTT-Info**  
MIME-part-body MCPTT-Info as described in Table 6.4.2.3.3-3
Table 6.4.2.3.3-2: SDP in SIP INVITE (Table 6.4.2.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-1, condition
FIRST_SDP_FROM_UE, INITIAL_SDP_OFFER, IMPLICIT_GRANT_REQUESTED
* * *
Table 6.4.2.3.3-3: MCPTT-Info in SIP INVITE (Table 6.4.2.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-1, condition GROUP-CALL,
INVITE_REFER
* * *
Table 6.4.2.3.3-4: SIP 200 (OK) (step 2, Table 6.4.2.3.2-1; step 4, TS
36.579-1 [2] Table 5.3A.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.3A.1.4-2, condition INVITE_RSP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
SDP Message As described in Table 6.4.2.3.3-5
Table 6.4.2.3.3-5: SDP in SIP 200 (OK) (Table 6.4.2.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-1, condition SDP_ANSWER,
IMPLICIT_GRANT_REQUESTED
* * *
Table 6.4.2.3.3-7: SIP MESSAGE (step 6, Table 6.4.2.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1
* * *
Information Element Value/remark Comment Reference Condition **Accept-
Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
**P-Asserted-Identity**  
addr-spec  
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part SDP message  
MIME-part-headers  
Content-Type \"application/sdp\"  
Content-Disposition \"render\"  
MIME-part-body SDP message as described in Table 6.4.2.3.3-8  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.2.3.3-9
Table 6.4.2.3.3-8: SDP in SIP MESSAGE (Table 6.4.2.3.3-7)
+-------------+-------------+-------------+-------------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 36.579-1 | | | | | | [2], | | | | | | Table | | | | | | 5.5.3.1.2-1 | | | | | +=============+=============+=============+=============+===========+ | Information | V | Comment | Reference | Condition | | Element | alue/remark | | | | +-------------+-------------+-------------+-------------+-----------+ | **Media | | | | | | des | | | | | | criptions** | | | | | +-------------+-------------+-------------+-------------+-----------+ | **media | | m= line | | | | de | | | | | | scription** | | media = | | | | | | audio | | | +-------------+-------------+-------------+-------------+-----------+ | media | \"audio\" | | | | +-------------+-------------+-------------+-------------+-----------+ | port | \"9\" | | | | +-------------+-------------+-------------+-------------+-----------+ | proto | \"RTP/AVP\" | | | | +-------------+-------------+-------------+-------------+-----------+ | fmt | \"99\" | | | | +-------------+-------------+-------------+-------------+-----------+ | * | | c= line | | | | _Connection | | | | | | Data_ _| | | | | +-------------+-------------+-------------+-------------+-----------+ | nettype | \"IN\" | | | | +-------------+-------------+-------------+-------------+-----------+ | addrtype | \"IP4\" or | | | | | | "IP6" | | | | | | depending | | | | | | on IP | | | | | | address | | | | +-------------+-------------+-------------+-------------+-----------+ | connect | \"0.0.0.0\" | | | | | ion-address | (IPv4) or | | | | | | domain name | | | | | | within | | | | | | ".invalid" | | | | | | DNS top | | | | | | level | | | | | | domain | | | | | | (IPv6) | | | | +-------------+-------------+-------------+-------------+-----------+ |__media | | m= line | | | | de | | | | | | scription_ _| | media = | | | | | | application | | | +-------------+-------------+-------------+-------------+-----------+ | media | \"ap | | | | | | plication\" | | | | +-------------+-------------+-------------+-------------+-----------+ | port | \"9\" | | | | +-------------+-------------+-------------+-------------+-----------+ | proto | \"udp\" | | | | +-------------+-------------+-------------+-------------+-----------+ | fmt | \"MCPTT\" | | | | +-------------+-------------+-------------+-------------+-----------+ | * | | c= line | | | |_ Connection | | | | | | Data** | | | | | +-------------+-------------+-------------+-------------+-----------+ | nettype | \"IN\" | | | | +-------------+-------------+-------------+-------------+-----------+ | addrtype | \"IP4\" or | | | | | | "IP6" | | | | | | depending | | | | | | on IP | | | | | | address | | | | +-------------+-------------+-------------+-------------+-----------+ | connect | \"0.0.0.0\" | | | | | ion-address | (IPv4) or | | | | | | domain name | | | | | | within | | | | | | ".invalid" | | | | | | DNS top | | | | | | level | | | | | | domain | | | | | | (IPv6) | | | | +-------------+-------------+-------------+-------------+-----------+ | media | | m= line | | | | description | | | | | | | | media = | | | | | | application | | | +-------------+-------------+-------------+-------------+-----------+ | media | \"ap | | | | | | plication\" | | | | +-------------+-------------+-------------+-------------+-----------+ | port | port number | | | | | | assigned by | | | | | | the SS | | | | +-------------+-------------+-------------+-------------+-----------+ | proto | \"udp\" | | | | +-------------+-------------+-------------+-------------+-----------+ | fmt | \"MCPTT\" | | | | +-------------+-------------+-------------+-------------+-----------+ | Connection | | c= line | | | | Data | | | | | +-------------+-------------+-------------+-------------+-----------+ | nettype | \"IN\" | | | | +-------------+-------------+-------------+-------------+-----------+ | addrtype | \"IP4\" | | | | +-------------+-------------+-------------+-------------+-----------+ | connect | multicast | | | | | ion-address | IP assigned | | | | | | by the SS | | | | +-------------+-------------+-------------+-------------+-----------+ | media | | a= line | | | | attribute | | | | | | | | attribute = | | | | | | key-mgmt | | | +-------------+-------------+-------------+-------------+-----------+ | key-mgmt | | | TS 24.379 | | | | | | [9] | | | | | | clause | | | | | | 14.2.2.2 | | +-------------+-------------+-------------+-------------+-----------+ | mikey | MIKEY-SAKKE | MSCCK | RFC 4567 | | | | I_MESSAGE | d | [44] | | | | as | istribution | | | | | specified | as | | | | | in TS | specified | | | | | 36.579-1 | in TS | | | | | [2], | 33.180 | | | | | Table | [33] | | | | | 5.5.9.1-4. | Annex H | | | +-------------+-------------+-------------+-------------+-----------+
Table 6.4.2.3.3-9: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table 6.4.2.3.3-7)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 24.379 | | | | | | [9], | | | | | | Clause F.2 | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | mcptt-mbm | | | | | | s-usage-info | | | | | +--------------+--------------+--------------+-----------+-----------+ | mbms-list | not present | | | | | ening-status | | | | | +--------------+--------------+--------------+-----------+-----------+ | announcement | | | | | +--------------+--------------+--------------+-----------+-----------+ | TMGI | | | | | +--------------+--------------+--------------+-----------+-----------+ | MBMS Service | \"0F0F0F\" | The selected | | | | ID | | value is | | | | | | randomly | | | | | | chosen - a 6 | | | | | | digit | | | | | | hexadecimal | | | | | | number | | | | | | between | | | | | | 000000 and | | | | | | | | | | | | FFFFFF (see | | | | | | TS 23.003 | | | | | | [32] | | | | | | clause 15.2. | | | | | | | | | | | | The coding | | | | | | of the MBMS | | | | | | Service ID | | | | | | is the | | | | | | re | | | | | | sponsibility | | | | | | of each | | | | | | ad | | | | | | ministration | | | +--------------+--------------+--------------+-----------+-----------+ | MCC | The same | Mobile | | | | | value as for | Country Code | | | | | PLMN1 | | | | | | specified in | | | | | | Table | | | | | | 5.5.8.1-1 | | | | +--------------+--------------+--------------+-----------+-----------+ | MNC | The same | Mobile | | | | | value as for | Network Code | | | | | PLMN1 | | | | | | specified in | | | | | | Table | | | | | | 5.5.8.1-1 | | | | +--------------+--------------+--------------+-----------+-----------+ | QCI | \"65\" | Mission | | | | | | Critical | | | | | | user plane | | | | | | Push To Talk | | | | | | voice | | | +--------------+--------------+--------------+-----------+-----------+ | mbms-s | \"0\" | The selected | | | | ervice-areas | | value is | | | | | | randomly | | | | | | chosen. | | | | | | | | | | | | The value 0 | | | | | | has a | | | | | | special | | | | | | meaning; it | | | | | | shall denote | | | | | | the whole | | | | | | PLMN as the | | | | | | MBMS Service | | | | | | Area | | | +--------------+--------------+--------------+-----------+-----------+ | GPMS | \"2\" | The number | | | | | | of the | | | | | | \"m=a | | | | | | pplication\" | | | | | | media line | | | | | | in the | | | | | | app | | | | | | lication/sdp | | | | | | MIME | | | +--------------+--------------+--------------+-----------+-----------+ | version | \"1\" | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.4.2.3.3-10: SIP MESSAGE (step 8, Table 6.4.2.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Request-Line**  
Request-URI The value received in the P-Asserted-Identity header field of the
announcement message (px_MBMS_Service_ID)  
**Accept-Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Preferred-Identity**  
PPreferredID-value px_MCPTT_User_A_ID  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.2.3.3-11
Table 6.4.2.3.3-11: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table 6.4.2.3.3-10)
Derivation Path: TS 24.379 [9], Clause F.2
* * *
Information Element Value/remark Comment Reference Condition mcptt-mbms-usage-
info  
mbms-listening-status  
mbms-listening-status \"listening\"  
session-id not present  
general-purpose \"true\"  
TMGI same value as the announcement in the SIP MESSAGE  
announcement not present  
version \"1\"
Table 6.4.2.3.3-13: SIP MESSAGE (step 13, Table 6.4.2.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Request-Line**  
Request-URI The value received in the P-Asserted-Identity header field of the
announcement message (px_MBMS_Service_ID)  
**Accept-Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Preferred-Identity**  
PPreferredID-value px_MCPTT_User_A_ID  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.2.3.3-14
Table 6.4.2.3.3-14: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table 6.4.2.3.3-13)
Derivation Path: TS 24.379 [9], Clause F.2
* * *
Information Element Value/remark Comment Reference Condition mcptt-mbms-usage-
info  
mbms-listening-status  
mbms-listening-status \"listening\"  
session-id px_sesson_A_ID  
general-purpose not present  
TMGI same value as the announcement in the SIP MESSAGE  
announcement not present  
version \"1\"
Table 6.4.2.3.3-16: Floor Ack (steps 16, 28, 37, Table 6.4.2.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.11-1, condition UPLINK
* * *
Table 6.4.2.3.3-17: SIP MESSAGE (step 17, Table 6.4.2.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1
* * *
Information Element Value/remark Comment Reference Condition **Accept-
Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
**P-Asserted-Identity**  
addr-spec  
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.2.3.3-18  
MIME body part MIKEY message  
MIME-part-headers  
Content-Type \"application/mikey\"  
MIME-part-body As described in TS 36.579-1 [2], Table 5.5.9.1-5. MIKEY message
containing the MuSiK
Table 6.4.2.3.3-18: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table 6.4.2.3.3-17)
Derivation Path: TS 24.379 [9], Clause F.2
* * *
Information Element Value/remark Comment Reference Condition mcptt-mbms-usage-
info  
mbms-listening-status not present  
announcement not present  
version \"1\"  
anyExt  
mbms-explicitMuSiK-download  
group px_MCPTT_Group_A_ID
Table 6.4.2.3.3-20: Floor Taken (step 20, Table 6.4.2.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.7-1, condition Multi-Talker
* * *
Table 6.4.2.3.3-22: Floor Ack (step 26a1, Table 6.4.2.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.6.11-1, condition DOWNLINK
* * *
Table 6.4.2.3.3-23: SIP MESSAGE (step 30, Table 6.4.2.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Request-Line**  
Request-URI The value received in the P-Asserted-Identity header field of the
announcement message (px_MBMS_Service_ID)  
**Accept-Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Preferred-Identity**  
PPreferredID-value px_MCPTT_User_A_ID  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.2.3.3-24
Table 6.4.2.3.3-24: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table 6.4.2.3.3-23)
Derivation Path: TS 24.379 [9], Clause F.2
* * *
Information Element Value/remark Comment Reference Condition mcptt-mbms-usage-
info  
mbms-listening-status  
mbms-listening-status \"not-listening\"  
session-id px_sesson_A_ID  
general-purpose not present  
TMGI same value as the announcement in the SIP MESSAGE  
announcement not present  
version \"1\"
Table 6.4.2.3.3-25: SIP MESSAGE (step 32, Table 6.4.2.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Accept-
Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
**P-Asserted-Identity**  
addr-spec  
user-info and host px_MBMS_Service_ID The MBMS public service identity of the
participating MCPTT function  
port not present  
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.2.3.3-26
Table 6.4.2.3.3-26: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table 6.4.2.3.3-25)
+--------------+--------------+--------------+-----------+-----------+ | Derivation | | | | | | Path: TS | | | | | | 24.379 | | | | | | [9], | | | | | | Clause F.2 | | | | | +==============+==============+==============+===========+===========+ | Information | Value/remark | Comment | Reference | Condition | | Element | | | | | +--------------+--------------+--------------+-----------+-----------+ | mcptt-mbm | | | | | | s-usage-info | | | | | +--------------+--------------+--------------+-----------+-----------+ | mbms-list | not present | | | | | ening-status | | | | | +--------------+--------------+--------------+-----------+-----------+ | announcement | | | | | +--------------+--------------+--------------+-----------+-----------+ | TMGI | | | | | +--------------+--------------+--------------+-----------+-----------+ | MBMS Service | \"0F0F0F\" | The selected | | | | ID | | value is | | | | | | randomly | | | | | | chosen - a 6 | | | | | | digit | | | | | | hexadecimal | | | | | | number | | | | | | between | | | | | | 000000 and | | | | | | | | | | | | FFFFFF (see | | | | | | TS 23.003 | | | | | | [X] clause | | | | | | 15.2. | | | | | | | | | | | | The coding | | | | | | of the MBMS | | | | | | Service ID | | | | | | is the | | | | | | re | | | | | | sponsibility | | | | | | of each | | | | | | ad | | | | | | ministration | | | +--------------+--------------+--------------+-----------+-----------+ | MCC | The same | Mobile | | | | | value as for | Country Code | | | | | PLMN1 | | | | | | specified in | | | | | | Table | | | | | | 5.5.8.1-x | | | | +--------------+--------------+--------------+-----------+-----------+ | MNC | The same | Mobile | | | | | value as for | Network Code | | | | | PLMN1 | | | | | | specified in | | | | | | Table | | | | | | 5.5.8.1-x | | | | +--------------+--------------+--------------+-----------+-----------+ | QCI | \"65\" | Mission | | | | | | Critical | | | | | | user plane | | | | | | Push To Talk | | | | | | voice | | | +--------------+--------------+--------------+-----------+-----------+ | mbms-s | not present | | | | | ervice-areas | | | | | +--------------+--------------+--------------+-----------+-----------+ | GPMS | not present | | | | +--------------+--------------+--------------+-----------+-----------+ | version | \"1\" | | | | +--------------+--------------+--------------+-----------+-----------+
Table 6.4.2.3.3-27: SIP MESSAGE (step 34, Table 6.4.2.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1
* * *
Information Element Value/remark Comment Reference Condition **Request-Line**  
Request-URI The value received in the P-Asserted-Identity header field of the
announcement message (px_MBMS_Service_ID)  
**Accept-Contact**  
ac-value \"+g.3gpp.icsi-ref=urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
req-param \"require\"  
explicit-param \"explicit\"  
**P-Preferred-Identity**  
PPreferredID-value px_MCPTT_User_A_ID  
**P-Asserted-Service**  
Service-ID **\"** urn:urn-7:3gpp-service.ims.icsi.mcptt\"  
**Message-body** MIME body not including MCPTT-Affiliation-Command not
including any MIME body part with Content-Type \"application/vnd.3gpp.mcptt-
affiliation-command+xml\"  
MIME body part MCPTT MBMS usage info  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\"  
MIME-part-body **MCPTT-MBMS-Usage-Info as** described in Table 6.4.2.3.3-28
Table 6.4.2.3.3-28: MCPTT-MBMS-Usage-Info in SIP MESSAGE (Table 6.4.2.3.3-27)
Derivation Path: TS 24.379 [9], Clause F.2
* * *
Information Element Value/remark Comment Reference Condition mcptt-mbms-usage-
info  
mbms-listening-status  
mbms-listening-status \"not-listening\"  
session-id not present  
general-purpose \"false\"  
TMGI same value as the announcement in the SIP MESSAGE  
announcement not present  
version \"1\"
# 7 MCPTT Client off-network operation
## 7.1 Off-network Group Calls
### 7.1.1 Off-network / Group Call / Floor Control / Upgrade to Emergency Call
/ Downgrade from Emergency / Upgrade to Imminent Peril / Downgrade from
Imminent Peril / Release Call / Client Originated (CO)
##### 7.1.1.1 Test Purpose (TP) {#test-purpose-tp-74 .H6}
##### (1) {#section-219 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service,
including authorised to initiate/cancel group calls in off-network
environment, and the UE (MCPTT Client) is in an off-network environment }
**ensure that** {
**when** { the MCPTT User requests the establishment of an MCPTT pre-arranged
group call }
**then** { UE (MCPTT Client) requests a pre-arranged group call by sending a
GROUP CALL PROBE message **and,** upon not receiving a response to the GROUP
CALL PROBE, sends a GROUP CALL ANNOUNCEMENT message }
}
##### (2) {#section-220 .H6}
**with** { UE (MCPTT Client) having established an off-network MCPTT Pre-
arranged Group Call }
**ensure that** {
**when** { the MCPTT User (MCPTT Client) engages in communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the floor
control entity/arbitrator (Floor Request during a talk burst, Floor
granting/release, Floor idle, Floor deny, Floor taken/revoked, Floor request
queued and queue handling) }
}
##### (3) {#section-221 .H6}
**with** { UE (MCPTT Client) having established an off-network group call and
the MCPTT User being authorised for initiating an MCPTT emergency group call }
**ensure that** {
**when** { the MCPTT User requests to upgrade the ongoing off-network MCPTT
group call to an MCPTT emergency group call }
**then** { UE (MCPTT Client) sends a GROUP CALL ANNOUNCEMENT message and
enters the T1: in-progress emergency group call state}
}
##### (4) {#section-222 .H6}
**with** { UE (MCPTT Client) having upgraded to an off-network emergency group
call }
**ensure that** {
**when** { the MCPTT User (MCPTT Client) continues communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the floor
control entity/arbitrator }
}
##### (5) {#section-223 .H6}
**with** { UE (MCPTT Client) having upgraded to an off-network emergency group
call and the MCPTT User being authorised for cancelling an MCPTT emergency
state }
**ensure that** {
**when** { the MCPTT User requests to cancel the ongoing MCPTT Emergency state
}
**then** { UE (MCPTT Client) sends a GROUP CALL EMERGENCY END message and
enters the T2: in-progress basic group call state }
}
##### (6) {#section-224 .H6}
**with** { UE (MCPTT Client) having established an off-network group call and
the MCPTT User being authorised for initiating an MCPTT imminent peril group
call }
**ensure that** {
**when** { the MCPTT User requests to upgrade the ongoing off-network MCPTT
group call to an MCPTT imminent peril group call with floor control }
**then** { UE (MCPTT Client) sends a GROUP CALL ANNOUNCEMENT message and
enters the T3: in-progress imminent peril group call state}
}
##### (7) {#section-225 .H6}
**with** { UE (MCPTT Client) having upgraded to an off-network imminent peril
group call }
**ensure that** {
**when** { the MCPTT User (MCPTT Client) continues communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the floor
control entity/arbitrator }
}
##### (8) {#section-226 .H6}
**with** { UE (MCPTT Client) having upgraded to an off-network imminent peril
group call and the MCPTT User being authorised for cancelling an MCPTT
imminent peril state }
**ensure that** {
**when** { the MCPTT User requests to cancel the ongoing MCPTT imminent peril
state }
**then** { UE (MCPTT Client) sends a GROUP CALL IMMINENT PERIL END message and
enters the T2: in-progress basic group call state }
}
##### 7.1.1.2 Conformance requirements {#conformance-requirements-74 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379 clauses 10.2.2.4.2.1, 10.2.2.4.3.1, 10.2.3.4.2,
10.2.3.4.7.1, 10.2.3.4.8.1, 10.2.3.4.8.4, 10.2.2.4.5.1, 10.2.2.4.5.4,
10.2.3.4.10, TS 24.380 clauses 7.2.3.2.2, 7.2.3.5.5, 7.2.3.3.2, 7.2.3.6.7,
7.2.3.5.4, 7.2.3.5.8, 7.2.3.5.6, 7.2.3.7.3, 7.2.3.7.5, 7.2.3.3.4, 7.2.3.4.3,
7.2.3.3.6, 7.2.3.4.2, 7.2.3.6.4, 7.2.3.6.3, 7.2.3.8.11, 7.2.3.8.3, 7.2.3.8.6,
7.2.3.5.7, 7.2.3.6.9, 7.2.3.6.6. Unless otherwise stated these are Rel-13
requirements.
[TS 24.379, clause 10.2.2.4.2.1]
When in the \"S1: start-stop\" state, upon an indication from an MCPTT user to
initiate a group call for an MCPTT group ID, the MCPTT client:
...
3) shall generate a GROUP CALL PROBE message as specified in subclause 15.1.2.
In the GROUP CALL PROBE message, the MCPTT client:
a) shall set the MCPTT group ID IE to the stored MCPTT group ID of the call;
4) shall send the GROUP CALL PROBE message as specified in subclause
10.2.1.1.1;
5) shall start timer TFG3 (call probe retransmission);
6) shall start timer TFG1 (wait for call announcement); and
[TS 24.379, clause 10.2.2.4.3.1]
When in the \"S2: waiting for call announcement\" state, upon expiry of timer
TFG1 (wait for call announcement), the MCPTT client:
1) shall stop timer TFG3 (call probe retransmission), if running;
...
7) shall generate a GROUP CALL ANNOUNCEMENT message as specified in subclause
15.1.3. In the GROUP CALL ANNOUNCEMENT message, the MCPTT client:
a) shall set the Call identifier IE to the stored call identifier of the call;
b) shall set the Call type IE to the stored current call type associated with
the call type control state machine;
c) shall set the Refresh interval IE to the stored refresh interval of the
call;
d) shall set the SDP IE to the stored SDP body of the call;
e) shall set the Originating MCPTT user ID IE to the stored originating MCPTT
user ID of the call;
f) shall set the MCPTT group ID IE to the stored MCPTT group ID of the call;
g) shall set the Call start time IE to the stored call start time of the call;
h) shall set the Last call type change time IE to the stored last call type
change time of the call associated with call type control state machine;
i) shall set the Last user to change call type IE to last user to change call
type associated with call type control state machine; and
j) may include the Confirm mode indication IE;
8) shall send the GROUP CALL ANNOUNCEMENT message as specified in subclause
10.2.1.1.1;
9) shall establish a media session based on the stored SDP body of the call;
10) shall start floor control as originating floor participant as specified in
subclause 7.2 in 3GPP TS 24.380 [5];
[TS 24.379, clause 10.2.3.4.2]
When in the \"T0: waiting for the call to establish \" state, upon an
indication from an MCPTT user to initiate a group call probe for an MCPTT
group, the MCPTT client:
1) if the stored emergency state associated with emergency alert state machine
described in 12.2.2.2 is set to \"true\" and the value of \"/_\
_/\/Common/AllowedEmergencyCall\" leaf node present in group
configuration as specified in 3GPP TS 24.383 [45] is set to \"true\":
a) shall set the stored current call type to \"EMERGENCY GROUP CALL\"; and
b) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network emergency group call as described in 3GPP
TS 24.383 [45];
2) if the stored emergency state associated with emergency alert state machine
described in 12.2.2.2 is set to \"false\", and:
a) if the user initiates an MCPTT emergency call and the values of \"/_\
_/_\ _/Common/MCPTTGroupCall/EmergencyCall/Enabled\" leaf node present
in the user profile and \"/_\ _/\/Common/AllowedEmergencyCall\" leaf
node present in group configuration as specified in 3GPP TS 24.383 [45] are
set to \"true\":
i) shall set the stored current call type to \"EMERGENCY GROUP CALL\"; and
ii) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network emergency group call as described in 3GPP
TS 24.383 [45];
b) if the user initiates an MCPTT imminent peril group call and the values of
\"/_\ _/_\ _/Common/MCPTTGroupCall/ImminentPerilCall/Authorised\" leaf
node present in the user profile \"/_\
_/\/Common/AllowedImminentPerilCall \" leaf node present in group
configuration as specified in 3GPP TS 24.383 [45] are set to \"true\":
i) shall set the stored current call type to \"IMMINENT PERIL GROUP CALL\";
and
ii) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network imminent peril group call as described in
3GPP TS 24.383 [45]; and
c) if the user initiates an MCPTT group call which is not an MCPTT emergency
call and which is not an MCPTT imminent peril group call:
i) shall set the stored current call type to \"BASIC GROUP CALL\"; and
ii) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network basic group call as described in 3GPP TS
24.383 [45];
[TS 24.379, clause 10.2.3.4.7.1]
When in the \"T2: in-progress basic group call\" state, upon receiving an
indication from the user to upgrade the call to \"IMMINENT PERIL GROUP CALL\"
or \"EMERGENCY GROUP CALL\" or when in the \"T3: in-progress imminent peril
group call\" state, upon receiving an indication from the user to upgrade the
call to \"EMERGENCY GROUP CALL\", the MCPTT client:
1) if the user request is to upgrade the call to \"EMERGENCY GROUP CALL\" and
the value of \"/_\ _/_\ _/OffNetwork/EmergencyCallChange\" leaf node
present in the user profile as specified in 3GPP TS 24.383 [45] is set to
\"true\":
a) shall set the stored current call type to \"EMERGENCY GROUP CALL\";
b) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network emergency group call as described in 3GPP
TS 24.383 [45];
c) shall store the current UTC time as last call type change time of the call;
d) shall store own MCPTT user ID as last user to change call type of the call;
e) shall start timer TFG13 (implicit downgrade emergency) with value as
specified in subclause 10.2.3.4.1.1;
f) shall stop timer TFG11 (emergency end retransmission), if running;
g) shall stop timer TFG14 (implicit downgrade imminent peril), if running; and
h) shall enter \"T1: in-progress emergency group call\" state;
2) if the user request is to upgrade the call to \"IMMINENT PERIL GROUP CALL\"
and the value of \"/_\ _/_\ _/OffNetwork/ ImminentPerilCallChange\" leaf
node present in the user profile as specified in 3GPP TS 24.383 [45] set to
\"true\":
a) shall set the stored current call type to \"IMMINENT PERIL GROUP CALL\";
b) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network imminent peril group call as described in
3GPP TS 24.383 [45];
c) shall store the current UTC time as last call type change time of the call;
d) shall store own MCPTT user ID as last user to change call type of the call;
e) shall start timer TFG14 (implicit downgrade imminent peril) with value as
specified in subclause 10.2.3.4.1.2;
f) shall stop timer TFG12 (imminent peril end retransmission), if running; and
g) shall enter \"T3: in-progress imminent peril group call\" state;
3) shall generate a GROUP CALL ANNOUNCEMENT message as specified in subclause
15.1.3. In the GROUP CALL ANNOUNCEMENT message, the MCPTT client:
a) shall set the Call identifier IE to the stored call identifier of the call
associated with the basic call control state machine;
b) shall set the Call type IE to the stored current call type;
c) shall set the Refresh interval IE to the stored refresh interval of the
call associated with the basic call control state machine;
d) shall set the SDP IE to the stored SDP body of the call associated with the
basic call control state machine;
e) shall set the Originating MCPTT user ID IE to the stored originating MCPTT
user ID of the call associated with the basic call control state machine;
f) shall set the MCPTT group ID IE to the stored MCPTT group ID of the call
associated with the basic call control state machine;
g) shall set the call start time IE to the stored call start time of the call;
h) shall set the Last call type change time IE to the stored last call type
change time of the call; and
i) shall set the Last user to change call type IE to the stored last user to
change call type of the call; and
4) shall send the GROUP CALL ANNOUNCEMENT message as specified in subclause
10.2.1.1.1;
[TS 24.379, clause 10.2.3.4.8.1]
When in the \"T1: in-progress emergency group call\" state, upon receiving an
indication from:
1) the MCPTT user who upgraded the MCPTT group call; or
2) an authorized MCPTT user with the value of \"/_\ _/_\
_/Common/MCPTTGroupCall/EmergencyCall/CancelMCPTTGroup\" leaf node present
in the user profile as specified in 3GPP TS 24.383 [45] is set to \"true\",
to downgrade \"EMERGENCY GROUP CALL\", the MCPTT client:
...
5) shall generate a GROUP CALL EMERGENCY END message as specified in subclause
15.1.15. In the GROUP CALL EMERGENCY END message, the MCPTT client:
a) shall set the Call identifier IE to the stored call identifier of the call
associated with the basic call control state machine;
b) shall set the Originating MCPTT user ID IE to the stored originating MCPTT
user ID of the call associated with the basic call control state machine;
c) shall set the MCPTT group ID IE to the stored MCPTT group ID of the call
associated with the basic call control state machine;
d) shall set the Last call type change time IE to the stored last call type
change time of the call; and
e) shall set the Last user to change call type IE to the stored last user to
change call type of the call;
6) shall send the GROUP CALL EMERGENCY END message as specified in subclause
10.2.1.1.1;
[TS 24.379, clause 10.2.3.4.8.4]
When in the \"T3: in-progress imminent peril group call\" state, upon
receiving an indication from:
1) the MCPTT user who upgraded the call; or
2) an authorized with the value of \"/_\ _/_\
_/Common/MCPTTGroupCall/ImminentPerilCall/Cancel\" leaf node present in the
user profile as specified in 3GPP TS 24.383 [45] is set to \"true\",
to downgrade \"IMMINENT PERIL GROUP CALL\", the MCPTT client:
...
5) shall generate a GROUP CALL IMMINENT PERIL END message as specified in
subclause 15.1.14. In the GROUP CALL IMMINENT PERIL END message, the MCPTT
client:
a) shall set the Call identifier IE to the stored call identifier of the call
associated with the basic call control state machine;
b) shall set the Originating MCPTT user ID IE to the stored originating MCPTT
user ID of the call associated with the basic call control state machine;
c) shall set the MCPTT group ID IE to the stored MCPTT group ID of the call
associated with the basic call control state machine;
d) shall set the Last call type change time IE to the stored last call type
change time of the call; and
e) shall set the Last user to change call type IE to the stored last user to
change call type of the call;
6) shall send the GROUP CALL IMMINENT PERIL END message as specified in
subclause 10.2.1.1.1;
[TS 24.379, clause 10.2.2.4.5.1]
When in the \"S3: part of ongoing call\" state, the \"S5: pending user action
with confirm indication\" state, or the \"S4: pending user action without
confirm indication\" state, upon an indication from the MCPTT user to release
the group call, the MCPTT client:
1) shall release the media session, if established;
[TS 24.379, clause 10.2.2.4.5.4]
When in the \"S6: ignoring incoming call announcements\" state, upon
expiration of timer TFG5 (not present incoming call announcements), the MCPTT
client:
1) shall release the stored SDP body of the call;
2) shall release the stored call identifier of the call;
3) shall release the stored originating MCPTT user ID of the call;
4) shall release the stored refresh interval of the call;
5) shall release the stored MCPTT group ID of the call;
6) shall release the call start time of the call;
7) shall destroy the call type control state machine; and
8) shall enter the \"S1: start-stop\" state.
[TS 24.379, clause 10.2.3.4.10]
When in state T1: in-progress emergency group call\" or \"T2: in-progress
basic group call\" or \"T3: in-progress imminent peril group call\" or upon
receiving an indication from MCPTT user to release the call, the MCPTT client:
1) shall release stored current call type;
2) shall release stored ProSe per-packet priority;
3) shall release Last call type change time;
4) shall release Last user to change call type; and
5) shall enter \"T0: waiting for the call to establish\" state.
[TS 24.380, clause 7.2.3.2.2]
When an MCPTT call is established with session announcement including an
explicit floor request, the originating floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. shall send Floor Granted message towards other floor participants. The
Floor Granted message:
a. shall include the granted priority in the Floor priority field;
b. shall include the MCPTT user\'s own MCPTT ID in the User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
3\. shall set the stored SSRC of the current floor arbitrator to its own SSRC;
and
4\. shall enter \'O: has permission\' state.
[TS 24.380, clause 7.2.3.5.5]
Upon receiving an indication from the MCPTT user to release permission to send
RTP media, the floor participant:
1\. shall stop timer T206 (Stop talking warning), if running;
2\. shall stop timer T207 (Stop talking), if running;
3\. shall send a Floor Release message towards other floor participants, if no
queued requests exist: The Floor Release message:
a. shall include the MCPTT ID of the MCPTT user in the User ID field; and
b. if the session is not initiated as a broadcast group call with the B-bit
set to \'1\' (Broadcast group call), shall include a Floor Indicator field set
to \'0\' (normal call);
4\. shall start timer T230 (Inactivity);
5\. shall clear the stored SSRC of the current arbitrator; and
6\. shall enter \'O: silence\' state.
[TS 24.380, clause 7.2.3.3.2]
If the floor participant receives an indication from the MCPTT user to send
media, the floor participant:
1\. shall send the Floor Request message to other floor participants. The
Floor Request message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID of the MCPTT user in the \ value of the
User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall initialize the counter C201 (Floor request) with value set to 1;
3\. shall stop timer T230 (Inactivity);
4\. shall start timer T201 (Floor Request); and
5\. shall enter \'O: pending request\' state.
[TS 24.380, clause 7.2.3.6.7]
Upon receiving Floor Granted message and if the \ value in the User
ID field matches its own MCPTT ID and SSRC of floor participant sending the
Floor Granted message matches the stored SSRC of current arbitrator, the floor
participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall set the stored SSRC of the current floor arbitrator to its own SSRC;
3\. shall stop timer T203 (End of RTP media), if running;
4\. shall stop timer T201 (Floor Request);
5\. may provide a floor granted notification to the MCPTT user;
6\. if the Floor Indicator field is included and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
7\. shall enter \'O: has permission\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and there is no stored SSRC of the current arbitrator, the floor
participant:
1\. shall set the stored SSRC of the current arbitrator to its own SSRC;
2\. shall stop timer T203 (End of RTP media);
3\. shall stop timer T201 (Floor Request);
4\. may provide a floor granted notification to the MCPTT user;
5\. if the Floor Indicator field is included and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
6\. shall enter \'O: has permission\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and SSRC of floor participant sending the Floor Granted message matches the
stored SSRC of candidate arbitrator, the floor participant:
1\. shall set the stored SSRC of the current arbitrator to its own SSRC;
2\. shall stop timer T203 (End of RTP media);
3\. shall stop timer T201 (Floor Request);
4\. may provide a floor granted notification to the MCPTT user;
5\. shall clear the stored SSRC of the candidate arbitrator;
6\. if the Floor Indicator field is included and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
7\. shall enter \'O: has permission\' state.
[TS 24.380, clause 7.2.3.5.4]
Upon receiving a Floor Request message which is not pre-emptive as determined
by subclause 4.1.1.5, in a session where:
1\. the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in the
group configuration as specified in 3GPP TS 24.383 [4] is set to \"false\"; or
2\. the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in the
group configuration as specified in 3GPP TS 24.383 [4] is set to \"true\" but
the F-bit in the Floor Indicator field is set to \'0\' (i.e. indicating that
queuing of floor requests is not supported) or the Floor Indicator field is
not included in the Floor Request message;
then the floor participant:
1\. shall send the Floor Deny message. The Floor Deny message:
a. shall include in the Reject Cause field the \ value cause #1
(Another MCPTT client has permission);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value; and
c. shall include the User ID field received in the Floor Request message; and
2\. shall remain in \'O: has permission\' state.
Upon receiving a Floor Request message which is not pre-emptive as determined
by subclause 4.1.1.5, and the value of \"/\/\/OffNetwork/QueueUsage\"
leaf node present in the group configuration as specified in 3GPP TS 24.383
[4] is set to \"true\" and the F-bit in the Floor Indicator field is set to
\'1\' (i.e. indicating that queuing of the floor requests is supported) in the
Floor Request message, the floor participant:
1\. shall store the received Floor Request messages;
2\. if the pending request queue is not full, shall send the Floor Queue
Position Info message. The Floor Queue Position Info message:
a. shall include in the User ID field the MCPTT ID of the floor participant
sending the Floor Request message;
b. shall include the SSRC of the floor participant in the SSRC of queued floor
participant field;
c. shall include the position in the floor request queue in the Queue Info
field; and
d. shall include the floor priority in the Queue Info field;
3\. if the pending request queue is full, shall send the Floor Deny message.
The Floor Deny message:
a. shall include in the Reject Cause field the \ value cause #7
(Queue full);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value; and
c. shall include the User ID field received in the Floor Request message; and
4\. shall remain in \'O: has permission\' state.
[TS 24.380, clause 7.2.3.5.8]
Upon receiving a Floor Queue Position Request message, the floor participant:
1\. shall send the Floor Queue Position Info message. The Floor Queue Position
Info message:
a. shall include the MCPTT ID of the queued floor participant in the Queued
User ID field;
b. shall include the queue position and floor priority in the Queue Info
field;
c. shall include the SSRC of floor participant sending Floor Queue Position
Request message in SSRC of queue floor participant field; and
d. shall include the User ID of floor participant sending Floor Queue Position
Request message in User ID field; and
2\. remain in the \'O: has permission\' state.
[TS 24.380, clause 7.2.3.5.6]
When no more encoded media is received from the user and if at least one Floor
Request message is stored (i.e. queuing mode is used in the session), the
floor participant:
1\. shall stop timer T206 (Stop talking warning), if running;
2\. shall stop timer T207 (Stop talking), if running;
3\. shall request the MCPTT client to stop sending RTP media packets towards
other MCPTT clients;
4\. shall send the Floor Granted message toward the other floor participants.
The Floor Granted message:
a. shall include the MCPTT ID of the first floor participant in the queue in
the User ID field;
b. shall include the SSRC of the first floor participant in the queue in the
SSRC of the granted floor participant field;
c. shall remove the first floor participant from the queue;
d for the remaining floor participants in the queue:
i. shall include the MCPTT ID of the floor participant in the Queued User ID
field;
ii. shall include the SSRC of the floor participant in the SSRC of queued
floor participant field;
iii. shall include the queue position of the floor participant in the Queue
Info field; and
iv. shall include the priority of the floor participant in the Queue Info
field; and
e. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
5\. shall set the stored SSRC of the current arbitrator to the SSRC of user to
whom the floor was granted in the Floor Granted message;
6\. shall start timer T205 (Floor Granted ) and shall initiate counter C205
(Floor Granted ) to 1; and
7 shall enter the \'O: pending granted\' state.
[TS 24.380, clause 7.2.3.7.3]
On expiry of timer T205 (Floor Granted) and counter C205 (Floor Granted) is
less than the upper limit, the floor participant:
1\. shall send again the Floor Granted message toward the other floor
participants. For each participant in the queue the Floor Granted message:
a. shall include the MCPTT ID of the floor participant in the Queued User ID
field;
b. shall include the SSRC of the floor participant in the SSRC of queued floor
participant field;
c. shall include the queue position of the floor participant in the Queue Info
field; and
d. shall include the priority of the floor participant in the Queue Info
field;
2\. shall restart timer T205 (Floor Granted) and shall increment counter C205
(Floor Granted) by 1; and
3\. shall remain in \'O: pending granted\' state.
[TS 24.380, clause 7.2.3.7.5]
On the expiry of timer T205 (Floor Granted) for the configured upper limit of
counter C205 (Floor Granted) with no request pending in the queue, the floor
participant:
1\. shall reset the value of counter C205 (Floor Granted) to 1;
2\. shall start timer T230 (Inactivity);
3\. shall clear the stored SSRC of the current arbitrator; and
4\. shall enter \'O: silence\' state.
[TS 24.380, clause 7.2.3.3.4]
When a Floor Granted message is received and if the User ID in the Floor
Granted message does not match its own User ID, the floor participant:
1\. may provide a floor taken notification to the MCPTT user;
2\. if the Floor Indicator field is included and the B-bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
that this is a broadcast group call;
3\. shall set the stored SSRC of the candidate arbitrator to the SSRC of user
to whom the floor was granted in the Floor Granted message;
4\. shall stop timer T230 (Inactivity);
5\. shall start timer T203 (End of RTP media); and
6\. shall enter \'O: has no permission\' state.
[TS 24.380, clause 7.2.3.4.3]
When a Floor Release message is received and if the SSRC in the Floor Release
message matches with the stored SSRC of the current arbitrator or with the
stored SSRC of the candidate arbitrator, the floor participant:
1\. may provide floor idle notification to the MCPTT user.
2\. shall request the MCPTT client to stop rendering received RTP media
packets;
3\. shall stop timer T203 (End of RTP media);
4\. shall start timer T230 (Inactivity);
5\. shall clear the stored SSRC of the candidate arbitrator;
6\. shall clear the stored SSRC of the current arbitrator; and
7\. shall enter \'O: silence\' state;
[TS 24.380, clause 7.2.3.3.6]
When a Floor Taken message is received, the floor participant:
1\. may provide a floor taken notification to the MCPTT user;
2\. shall set the stored SSRC of the current arbitrator to the SSRC of granted
floor participant field in the Floor Taken message;
3\. shall stop timer T230 (Inactivity);
4\. shall start timer T203 (End of RTP media); and
5\. shall enter \'O: has no permission\' state.
[TS 24.380, clause 7.2.3.4.2]
If the floor participant receives an indication from the MCPTT user that the
MCPTT user wants to send media, the floor participant:
1\. shall send the Floor Request message to other clients. The Floor Request
message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID of the MCPTT user in the User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall initialize the counter C201 (Floor request) with value set to 1;
3\. shall start timer T201 (Floor Request); and
4\. shall enter \'O: pending request\' state.
[TS 24.380, clause 7.2.3.6.4]
Upon receiving Floor Deny message, if the \ value in the User ID
field matches its own MCPTT ID and SSRC of floor participant sending the Floor
Deny message matches the stored SSRC of current arbitrator, the floor
participant:
1\. shall stop the timer T201 (Floor Request);
2\. shall provide floor deny notification to the user;
3\. shall restart the timer T203 (End of RTP media);
4\. may display the floor deny reason to the user using information in the
Reject Cause field; and
5\. shall enter \'O: has no permission\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and there is no stored SSRC of the current arbitrator, the floor
participant:
1\. shall stop the timer T201 (Floor Request);
2\. shall set the stored SSRC of the current arbitrator to the SSRC of the
floor control server as received in the Floor Deny message;
3\. shall restart the timer T203 (End of RTP media);
4\. shall provide floor deny notification to the user;
5\. may display the floor deny reason to the user using information in the
Reject Cause field; and
6\. shall enter \'O: has no permission\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and SSRC of floor participant sending the Floor Deny message matches the
stored SSRC of candidate arbitrator, the floor participant:
1\. shall stop the timer T201 (Floor Request);
2\. shall set the stored SSRC of the current arbitrator to the SSRC of the
floor control server as received in the Floor Deny message;
3\. shall clear the stored SSRC of the candidate arbitrator;
4\. shall restart the timer T203 (End of RTP media);
5\. shall provide floor deny notification to the user;
6\. may display the floor deny reason to the user using information in the
Reject Cause field; and
7\. shall enter \'O: has no permission\' state.
[TS 24.380, clause 7.2.3.6.3]
Upon receiving Floor Queue Position Info message, if the \ value in
the Queued User ID field matches its own MCPTT ID and the value in the SSRC of
floor control server field as received in the Floor Queue Position Info
message matches the stored SSRC of current arbitrator, the floor participant:
1\. shall update the queue status;
2\. may notify the MCPTT user about the queue position received in the \ value in the Queue Info field;
3\. shall stop timer T201 (Floor Request); and
4\. shall enter \'O: queued\' state.
Otherwise, if the \ value in the Queued User ID field matches its own
MCPTT ID and there is no stored SSRC of the current arbitrator, the floor
participant:
1\. shall update the queue status;
2\. shall set the stored SSRC of the current arbitrator to the SSRC of the
floor control server as received in the Floor Queue Position Info message;
3\. may notify the MCPTT user about the queue position received in the \ value in the Queue Info field;
4\. shall stop timer T201 (Floor Request); and
5\. shall enter \'O: queued\' state.
Otherwise, if the \ value in the Queued User ID field matches its own
MCPTT ID and the value in the SSRC of floor control server field as received
in the Floor Queue Position Info message matches the stored SSRC of candidate
arbitrator, the floor participant:
1\. shall update the queue status;
2\. shall set the stored SSRC of the current arbitrator to the value in the
SSRC of the floor control server field as received in the Floor Queue Position
Info message;
3\. shall clear the stored SSRC of the candidate arbitrator;
4\. may notify the MCPTT user about the queue position received in the \ value in the Queue Info field;
5\. shall stop timer T201 (Floor Request); and
6\. shall enter \'O: queued\' state.
[TS 24.380, clause 7.2.3.8.11]
Upon receipt of an indication from the MCPTT client to request the queue
position information, the floor participant:
1\. shall send the Floor Queue Position Request message; The Floor Queue
Position Request message:
a. shall include the SSRC of sent Floor Request message in SSRC of floor
participant field; and
b. shall include the own MCPTT User ID in User ID field;
2\. shall initialize the counter C204 (Floor Queue Position request) with
value set to 1;
3\. shall start timer T204 (Floor Queue Position request); and
4\. remain in the \'O: queued\' state.
[TS 24.380, clause 7.2.3.8.3]
Upon receiving Floor Queue Position Info message, if the \ value in
the User ID field matches its own MCPTT ID and SSRC of floor participant
sending the Floor Queue Position Info message matches the stored SSRC of
current arbitrator, the floor participant:
1\. shall update the queue position;
2\. shall notify the MCPTT user about the queue position received in the
\ value in the Queue Info field;
3\. shall stop timer T204 (Floor Queue Position request); and
4\. shall remain in \'O: queued\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and SSRC of floor participant sending the Floor Queue Position Info message
matches the stored SSRC of candidate arbitrator, the floor participant:
1\. shall update the queue position;
2\. shall set the stored SSRC of the current arbitrator to the SSRC of the
floor control server as received in the Floor Queue Position Info message;
3\. shall clear the stored SSRC of the candidate arbitrator;
4\. shall notify the MCPTT user about the queue position received in the
\ value in the Queue Info field;
5\. shall stop timer T204 (Floor Queue Position request); and
6\. shall remain in \'O: queued\' state.
[TS 24.380, clause 7.2.3.8.6]
Upon receiving Floor Granted message and if the \ value in the User
ID field matches its own MCPTT ID and SSRC of floor participant sending the
Floor Granted message matches the stored SSRC of current arbitrator, the floor
participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall start timer T233(Pending user action), if not running already;
3\. shall notify the MCPTT user about of the floor grant;
4\. if the Floor Indicator field is included, and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
5\. shall remain in \'O: queued\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and SSRC of floor participant sending the Floor Granted message matches the
stored SSRC of candidate arbitrator, the floor participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall start timer T233(Pending user action), if not running already;
3\. shall notify the MCPTT user about of the floor grant;
4\. shall set the stored SSRC of the current arbitrator to its own SSRC;
5\. shall clear the stored SSRC of the candidate arbitrator;
6\. if the Floor Indicator field is included, and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
7\. shall remain in \'O: queued\' state.
[TS 24.380, clause 7.2.3.8.8]
If the floor participant receives an indication from the user that the user
wants to send media and the timer T233 (pending user action) is running, the
floor participant:
1\. shall stop the timer T233 (Pending user action);
2\. shall set the stored SSRC of the current floor arbitrator to its own SSRC;
and
3\. shall enter \'O: has permission\' state.
[TS 24.380, clause 7.2.3.5.7]
Upon receiving a Floor Request message which is pre-emptive as determined by
subclause 4.1.1.5, the floor participant:
1\. shall stop timer T206 (Stop talking warning), if running;
2\. shall stop timer T207 (Stop talking), if running;
3\. shall request the MCPTT client to stop sending RTP media packets towards
other MCPTT clients;
4\. shall send a Floor Granted message towards the other floor participants.
The Floor Granted message:
a. shall include the MCPTT ID of the Floor Request message received in the
User ID field;
b. shall include the SSRC of floor participant sending the Floor Request
message in the SSRC of floor control server field; and
c. if the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in
the group configuration as specified in 3GPP TS 24.483 [4] is set to \"true\",
for each floor participant in the queue:
i. shall include the MCPTT ID of the floor participant in the Queued User ID
field;
ii. shall include the SSRC of the floor participant in the SSRC of queued
floor participant field;
iii. shall include the queue position of the floor participant in the Queue
Info field; and
iv. shall include the priority of the floor participant in the Queue Info
field;
5\. shall start timer T205 (Floor Granted) and shall initiate counter C205
(Floor Granted) to 1;
6\. shall set the stored SSRC of the current floor arbitrator to the SSRC of
the user to whom the floor was granted in the Floor Granted message; and
7\. shall enter the \'O: pending granted\' state.
[TS 24.380, clause 7.2.3.6.9]
On expiry of timer T201 (Floor Request) if the counter C201 (Floor Request)
has not reached its upper limit, the floor participant:
1\. shall send the Floor Request message to other floor participants. The
Floor Request message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID of the own MCPTT user in the User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall restart the timer T201 (Floor Request) and increment counter C201
(Floor Request) by 1; and
3\. shall remain in the \'O: pending request\' state.
[TS 24.380, clause 7.2.3.6.6]
When timer T201 (Floor Request) expires and counter C201 (Floor Request)
reaches its upper limit, the floor participant:
1\. shall send the Floor Taken message toward the other floor participants.
The Floor Taken message:
a. shall include the floor participant\'s own SSRC in the SSRC of the granted
floor participant field;
b. shall include the floor participant\'s own MCPTT ID in the User ID field;
and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall set the stored SSRC of the current floor arbitrator to its own SSRC;
3\. shall stop timer T203 (End of RTP media), if running; and
4\. shall enter \'O: has permission\' state.
##### 7.1.1.3 Test description {#test-description-74 .H6}
##### 7.1.1.3.1 Pre-test conditions {#pre-test-conditions-74 .H6}
##### System Simulator: {#system-simulator-74 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-74 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-74 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.1.3.2 Test procedure sequence {#test-procedure-sequence-74 .H6}
Table 7.1.1.3.2-1: Main behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Activate | - | - | - | - | | | the MCPTT | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px | | | | | | | _MCPTT_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | px\ | | | | | | | _MCPTT_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | initiate | | | | | | | an | | | | | | | of | | | | | | | f-network | | | | | | | basic | | | | | | | group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | of | | | | | | | f-network | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.11 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Mon | | | | | | | itoring/D | | | | | | | iscoverer | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | Check: | --> | GROUP | 1 | P | | | Does the | | CALL | | | | | UE (MCPTT | | PROBE | | | | | client) | | | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | message | | | | | | | to | | | | | | | determine | | | | | | | the | | | | | | | current | | | | | | | call | | | | | | | status of | | | | | | | the | | | | | | | group? | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step 5 is | | | | | | | executed | | | | | | | a total | | | | | | | of 3 | | | | | | | times | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | Check: At | --> | GROUP | 1 | P | | | the | | CALL | | | | | e | | PROBE | | | | | xpiration | | | | | | | of timer | | | | | | | TFG3 | | | | | | | (call | | | | | | | probe | | | | | | | retrans | | | | | | | mission), | | | | | | | does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | retra | | | | | | | nsmission | | | | | | | of the | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | sent in | | | | | | | step 4? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Check: At | --> | GROUP | 1 | P | | | the | | CALL | | | | | e | | ANN | | | | | xpiration | | OUNCEMENT | | | | | of timer | | | | | | | TFG1 | | | | | | | (wait for | | | | | | | call | | | | | | | annou | | | | | | | ncement), | | | | | | | and after | | | | | | | receiving | | | | | | | no | | | | | | | response | | | | | | | to the | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE, | | | | | | | does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | ANN | | | | | | | OUNCEMENT | | | | | | | message | | | | | | | to | | | | | | | initiate | | | | | | | an | | | | | | | of | | | | | | | f-network | | | | | | | basic | | | | | | | group | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | The | \ | Floor | 2 | P | | | Does the | | Granted | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Granted | | | | | | | message | | | | | | | towards | | | | | | | the other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | release | | | | | | | the floor | | | | | | | | | | | | | | (NOTE 1), | | | | | | | (NOTE 3) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10 | Check: | --> | Floor | 2 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Release | | | | | | | message | | | | | | | to the | | | | | | | other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | request | | | | | | | the floor | | | | | | | | | | | | | | (NOTE 1), | | | | | | | (NOTE 4) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | Check: | --> | Floor | 2 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13 | The | \ | Floor | 2 | P | | | Does the | | Deny | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Deny | | | | | | | message | | | | | | | to the | | | | | | | sender of | | | | | | | the Floor | | | | | | | Request | | | | | | | message | | | | | | | with the | | | | | | | Reject | | | | | | | Cause | | | | | | | field set | | | | | | | to #1 | | | | | | | (Another | | | | | | | MCPTT | | | | | | | client | | | | | | | has | | | | | | | per | | | | | | | mission)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16 | The | \ | Floor | 2 | P | | | Does the | | Queue | | | | | UE (MCPTT | | Position | | | | | Client) | | Info | | | | | add the | | | | | | | requester | | | | | | | to the | | | | | | | queue and | | | | | | | send a | | | | | | | Floor | | | | | | | Queue | | | | | | | Position | | | | | | | Info | | | | | | | message | | | | | | | to the | | | | | | | sender of | | | | | | | the Floor | | | | | | | Request | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 18 | The | \ | Floor | 2 | P | | | Does the | | Queue | | | | | UE (MCPTT | | Position | | | | | Client) | | Info | | | | | respond | | | | | | | to the | | | | | | | Floor | | | | | | | Queue | | | | | | | Position | | | | | | | Request | | | | | | | message | | | | | | | with e a | | | | | | | Floor | | | | | | | Queue | | | | | | | Position | | | | | | | Info | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 20 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | release | | | | | | | the floor | | | | | | | | | | | | | | (NOTE 1), | | | | | | | (NOTE 5) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 21 | Check: | --> | Floor | 2 | P | | | Does the | | Granted | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Granted | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | par | | | | | | | ticipants | | | | | | | i | | | | | | | ndicating | | | | | | | the | | | | | | | queued | | | | | | | pa | | | | | | | rticipant | | | | | | | now has | | | | | | | the | | | | | | | floor? | | | | | | | | | | | | | | (NOTE 6) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step 22 | | | | | | | is | | | | | | | executed | | | | | | | a total | | | | | | | of 3 | | | | | | | times | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 22 | Check: | --> | Floor | 2 | P | | | Upon | | Granted | | | | | expiry of | | | | | | | timer | | | | | | | T205 | | | | | | | (Floor | | | | | | | Granted) | | | | | | | and while | | | | | | | counter | | | | | | | C205 | | | | | | | (Floor | | | | | | | Granted) | | | | | | | is less | | | | | | | than its | | | | | | | maximum | | | | | | | value, | | | | | | | does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | r | | | | | | | etransmit | | | | | | | the Floor | | | | | | | Granted | | | | | | | message | | | | | | | send in | | | | | | | step 21? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 23 | Void | - | - | 2 | P | +-----------+-----------+-----------+-----------+---------+----+ | 24 | The | \ | Floor | 2 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 27 | The | \ | Floor | 2 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 30 | The | \ | Floor | 2 | P | | | Does the | | Queue | | | | | UE (MCPTT | | Position | | | | | Client) | | Request | | | | | send a | | | | | | | Floor | | | | | | | Queue | | | | | | | Position | | | | | | | Request | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 33 | The | \ | Floor | 2 | P | | | Does the | | Granted | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | respond | | | | | | | by | | | | | | | sending a | | | | | | | Floor | | | | | | | Granted | | | | | | | message? | | | | | | | | | | | | | | (NOTE 6) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step 39 | | | | | | | is | | | | | | | executed | | | | | | | a total | | | | | | | of 3 | | | | | | | times | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 39 | Check: | --> | Floor | 2 | P | | | Upon | | Granted | | | | | expiry of | | | | | | | timer | | | | | | | T205 | | | | | | | (Floor | | | | | | | Granted) | | | | | | | and while | | | | | | | counter | | | | | | | C205 | | | | | | | (Floor | | | | | | | Granted) | | | | | | | is less | | | | | | | than its | | | | | | | maximum | | | | | | | value, | | | | | | | does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | r | | | | | | | etransmit | | | | | | | the Floor | | | | | | | Granted | | | | | | | message | | | | | | | send in | | | | | | | step 38? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 40 | Void | - | - | 2 | P | +-----------+-----------+-----------+-----------+---------+----+ | 41 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | request | | | | | | | the floor | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 42 | Check: | --> | Floor | 2 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | | | | | | | | | | (NOTE 7) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step 43 | | | | | | | is | | | | | | | executed | | | | | | | a total | | | | | | | of 2 | | | | | | | times | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 43 | Check: | --> | Floor | 2 | P | | | Upon | | Request | | | | | expiry of | | | | | | | timer | | | | | | | T201 | | | | | | | (Floor | | | | | | | Request) | | | | | | | and while | | | | | | | counter | | | | | | | C201 | | | | | | | (Floor | | | | | | | Request) | | | | | | | is less | | | | | | | than its | | | | | | | maximum | | | | | | | value, | | | | | | | does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | r | | | | | | | etransmit | | | | | | | the Floor | | | | | | | Request | | | | | | | message | | | | | | | send in | | | | | | | step 42? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 44 | Check: | --> | Floor | 2 | P | | | Upon | | Taken | | | | | expiry of | | | | | | | timer | | | | | | | T201 | | | | | | | (Floor | | | | | | | Request) | | | | | | | and with | | | | | | | counter | | | | | | | C201 | | | | | | | (Floor | | | | | | | Request) | | | | | | | equal to | | | | | | | its | | | | | | | maximum | | | | | | | value, | | | | | | | does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Taken | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 45 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | release | | | | | | | the floor | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 46 | Check: | --> | Floor | 2 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Release | | | | | | | message | | | | | | | to the | | | | | | | other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 47 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | upgrade | | | | | | | the | | | | | | | of | | | | | | | f-network | | | | | | | group | | | | | | | call to | | | | | | | an | | | | | | | emergency | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 48 | Check: | --> | GROUP | 3 | P | | | Does the | | CALL | | | | | UE (MCPTT | | ANN | | | | | Client) | | OUNCEMENT | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | ANN | | | | | | | OUNCEMENT | | | | | | | to | | | | | | | upgrade | | | | | | | the call | | | | | | | to an | | | | | | | emergency | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 49 | Check: | --> | Floor | 4 | P | | | Does the | | Granted | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Granted | | | | | | | message | | | | | | | towards | | | | | | | the other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 50 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | release | | | | | | | the floor | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 51 | Check: | --> | Floor | 4 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Release | | | | | | | message | | | | | | | to the | | | | | | | other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 52 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | downgrade | | | | | | | the | | | | | | | of | | | | | | | f-network | | | | | | | group | | | | | | | call from | | | | | | | an | | | | | | | emergency | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 53 | Check: | --> | GROUP | 5 | P | | | Does the | | CALL | | | | | UE (MCPTT | | EMERGENCY | | | | | Client) | | END | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | EMERGENCY | | | | | | | END to | | | | | | | downgrade | | | | | | | the | | | | | | | emergency | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 54 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | upgrade | | | | | | | the | | | | | | | of | | | | | | | f-network | | | | | | | group | | | | | | | call to | | | | | | | an | | | | | | | imminent | | | | | | | peril | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 55 | Check: | --> | GROUP | 6 | P | | | Does the | | CALL | | | | | UE (MCPTT | | ANN | | | | | Client) | | OUNCEMENT | | | | | send a | | | | | | | GROUP CLL | | | | | | | ANN | | | | | | | OUNCEMENT | | | | | | | to | | | | | | | upgrade | | | | | | | the call | | | | | | | to an | | | | | | | imminent | | | | | | | peril | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 56 | Check: | --> | Floor | 7 | P | | | Does the | | Granted | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Granted | | | | | | | message | | | | | | | towards | | | | | | | the other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 57 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | release | | | | | | | the floor | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 58 | Check: | --> | Floor | 7 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Release | | | | | | | message | | | | | | | to the | | | | | | | other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 59 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | downgrade | | | | | | | the | | | | | | | of | | | | | | | f-network | | | | | | | group | | | | | | | call from | | | | | | | an | | | | | | | imminent | | | | | | | peril | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 60 | Check: | --> | GROUP | 8 | P | | | Does the | | CALL | | | | | UE (MCPTT | | IMMINENT | | | | | Client) | | PERIL END | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | IMMINENT | | | | | | | PERIL END | | | | | | | to | | | | | | | downgrade | | | | | | | the | | | | | | | imminent | | | | | | | peril | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 61 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | release | | | | | | | the group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Timer | | | | | | | TFG3 | | | | | | | (call | | | | | | | probe | | | | | | | re | | | | | | | transmiss | | | | | | | ion)=40ms | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5.5.8.1-1 | | | | | | | and TFG1 | | | | | | | (wait for | | | | | | | call | | | | | | | a | | | | | | | nnounceme | | | | | | | nt)=150ms | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5.5.8.1-1 | | | | | | | are | | | | | | | started | | | | | | | upon the | | | | | | | sending | | | | | | | of the | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | message | | | | | | | | | | | | | | NOTE 3: | | | | | | | If the | | | | | | | MCPTT | | | | | | | User does | | | | | | | not | | | | | | | release | | | | | | | the floor | | | | | | | before | | | | | | | timer | | | | | | | T207 | | | | | | | (Stop | | | | | | | talking) | | | | | | | expires, | | | | | | | then the | | | | | | | MCPTT | | | | | | | Client | | | | | | | will | | | | | | | enter the | | | | | | | \'O: | | | | | | | silence\' | | | | | | | state per | | | | | | | TS 24.380 | | | | | | | [10] | | | | | | | and the | | | | | | | remaining | | | | | | | steps | | | | | | | will not | | | | | | | be valid. | | | | | | | Timer | | | | | | | T206 | | | | | | | (Stop | | | | | | | talking | | | | | | | warning) | | | | | | | is | | | | | | | started | | | | | | | upon the | | | | | | | sending | | | | | | | of the | | | | | | | Floor | | | | | | | Granted | | | | | | | message. | | | | | | | Timer | | | | | | | T207 | | | | | | | (Stop | | | | | | | talking) | | | | | | | starts | | | | | | | upon the | | | | | | | e | | | | | | | xpiration | | | | | | | of Timer | | | | | | | T206 | | | | | | | (Stop | | | | | | | talking | | | | | | | warning). | | | | | | | Timer | | | | | | | T206 | | | | | | | (Stop | | | | | | | talking | | | | | | | war | | | | | | | ning)=10s | | | | | | | is set to | | | | | | | Tr | | | | | | | ansmitTim | | | | | | | eout=60s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.4-1, | | | | | | | minus | | | | | | | Transm | | | | | | | issionWar | | | | | | | ning=50s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.4-1. | | | | | | | Timer | | | | | | | T207 | | | | | | | (Stop | | | | | | | tal | | | | | | | king)=50s | | | | | | | is set to | | | | | | | Transm | | | | | | | issionWar | | | | | | | ning=50s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.4-1. | | | | | | | If during | | | | | | | test | | | | | | | execution | | | | | | | it is | | | | | | | found | | | | | | | that the | | | | | | | specified | | | | | | | timer(s) | | | | | | | value(s) | | | | | | | are not | | | | | | | large | | | | | | | enough, | | | | | | | then new | | | | | | | value(s) | | | | | | | need to | | | | | | | be | | | | | | | s | | | | | | | pecified. | | | | | | | | | | | | | | NOTE 4: | | | | | | | If the | | | | | | | MCPTT | | | | | | | User does | | | | | | | not | | | | | | | perform | | | | | | | an action | | | | | | | before | | | | | | | timer | | | | | | | T230 | | | | | | | (In | | | | | | | activity) | | | | | | | expires, | | | | | | | then the | | | | | | | MCPTT | | | | | | | Client | | | | | | | will | | | | | | | enter the | | | | | | | \'O: | | | | | | | \'Start | | | | | | | -stop\'\' | | | | | | | state per | | | | | | | 24.380 | | | | | | | [10] | | | | | | | and the | | | | | | | remaining | | | | | | | steps | | | | | | | will not | | | | | | | be valid. | | | | | | | Timer | | | | | | | T230 | | | | | | | (In | | | | | | | activity) | | | | | | | is | | | | | | | started | | | | | | | upon the | | | | | | | sending | | | | | | | of the | | | | | | | Floor | | | | | | | Release | | | | | | | message. | | | | | | | Timer | | | | | | | T230 | | | | | | | (Inactiv | | | | | | | ity)=10s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.1-1. | | | | | | | If during | | | | | | | test | | | | | | | execution | | | | | | | it is | | | | | | | found | | | | | | | that the | | | | | | | specified | | | | | | | timer | | | | | | | value is | | | | | | | not large | | | | | | | enough, | | | | | | | then a | | | | | | | new value | | | | | | | needs to | | | | | | | be | | | | | | | s | | | | | | | pecified. | | | | | | | | | | | | | | NOTE 5: | | | | | | | If the | | | | | | | MCPTT | | | | | | | User does | | | | | | | not | | | | | | | release | | | | | | | the floor | | | | | | | before | | | | | | | timer | | | | | | | T207 | | | | | | | (Stop | | | | | | | talking) | | | | | | | expires, | | | | | | | then the | | | | | | | MCPTT | | | | | | | Client | | | | | | | will | | | | | | | enter the | | | | | | | \'O: | | | | | | | silence\' | | | | | | | state per | | | | | | | 24.380 | | | | | | | [10] | | | | | | | and the | | | | | | | remaining | | | | | | | steps | | | | | | | will not | | | | | | | be valid. | | | | | | | Timer | | | | | | | T206 | | | | | | | (Stop | | | | | | | talking | | | | | | | warning) | | | | | | | is | | | | | | | started | | | | | | | upon the | | | | | | | receiving | | | | | | | of the | | | | | | | Floor | | | | | | | Granted | | | | | | | message | | | | | | | in step | | | | | | | 13. Timer | | | | | | | T207 | | | | | | | (Stop | | | | | | | talking) | | | | | | | starts | | | | | | | upon the | | | | | | | e | | | | | | | xpiration | | | | | | | of Timer | | | | | | | T206 | | | | | | | (Stop | | | | | | | talking | | | | | | | warning). | | | | | | | Timer | | | | | | | T206 | | | | | | | (Stop | | | | | | | talking | | | | | | | war | | | | | | | ning)=10s | | | | | | | is set to | | | | | | | Tr | | | | | | | ansmitTim | | | | | | | eout=60s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.4-1, | | | | | | | minus | | | | | | | Transm | | | | | | | issionWar | | | | | | | ning=50s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.4-1. | | | | | | | Timer | | | | | | | T207 | | | | | | | (Stop | | | | | | | tal | | | | | | | king)=50s | | | | | | | is set to | | | | | | | Transm | | | | | | | issionWar | | | | | | | ning=50s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.4-1. | | | | | | | If during | | | | | | | test | | | | | | | execution | | | | | | | it is | | | | | | | found | | | | | | | that the | | | | | | | specified | | | | | | | timer(s) | | | | | | | value(s) | | | | | | | are not | | | | | | | large | | | | | | | enough, | | | | | | | then new | | | | | | | value(s) | | | | | | | need to | | | | | | | be | | | | | | | s | | | | | | | pecified. | | | | | | | | | | | | | | NOTE 6: | | | | | | | Timer | | | | | | | T205 | | | | | | | (Floor | | | | | | | Granted) | | | | | | | and | | | | | | | Counter | | | | | | | C205 | | | | | | | (Floor | | | | | | | Granted) | | | | | | | are | | | | | | | started | | | | | | | upon the | | | | | | | sending | | | | | | | of the | | | | | | | Floor | | | | | | | Granted | | | | | | | message. | | | | | | | Timer | | | | | | | T205 | | | | | | | (Floor | | | | | | | Gra | | | | | | | nted)=1s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.1-1. | | | | | | | Counter | | | | | | | C205 | | | | | | | (Floor | | | | | | | Granted) | | | | | | | is set to | | | | | | | 1 and the | | | | | | | maximum | | | | | | | value of | | | | | | | C205 | | | | | | | (Floor | | | | | | | Gr | | | | | | | anted)=4, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.1-1. | | | | | | | | | | | | | | NOTE 7: | | | | | | | Timer | | | | | | | T201 | | | | | | | (Floor | | | | | | | Request) | | | | | | | and | | | | | | | Counter | | | | | | | C201 | | | | | | | (Floor | | | | | | | Request) | | | | | | | are | | | | | | | started | | | | | | | upon the | | | | | | | sending | | | | | | | of the | | | | | | | Floor | | | | | | | Request | | | | | | | message. | | | | | | | Timer | | | | | | | T201 | | | | | | | (Floor | | | | | | | Req | | | | | | | uest)=1s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.1-1. | | | | | | | Counter | | | | | | | 201 | | | | | | | (Floor | | | | | | | Request) | | | | | | | is set to | | | | | | | 1 and the | | | | | | | maximum | | | | | | | value of | | | | | | | Counter | | | | | | | C201 | | | | | | | (Floor | | | | | | | Re | | | | | | | quest)=3, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.1-1. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 7.1.1.3.3 Specific message contents {#specific-message-contents-74 .H6}
Table 7.1.1.3.3-1: GROUP CALL ANNOUNCEMENT (step 48, Table 7.1.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.5.2.1-1
* * *
Information Element Value/remark Comment Condition Call type \"00000011\"
Emergency group call
Table 7.1.1.3.3-2: GROUP CALL ANNOUNCEMENT (step 55, Table 7.1.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.5.2.1-1
* * *
Information Element Value/remark Comment Condition Call type \"00000100\"
Imminent peril group call
Table 7.1.1.3.3-3: Floor Granted (step 8, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | any allowed | | | | | value | | | +-----------------+-----------------+-----------------+-----------+ | Floor priority | \"0\" | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \"100 | bit A=1 (Normal | | | | 00X0000000000\" | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-4: Floor Granted (steps 13, 34, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '10 | bit A=1 (Normal | | | | 00010000000000' | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-5: Floor Granted (steps 21, 22, 38, 39, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | any allowed | 128 sec (an | | | | value | arbitrary | | | | | value) | | +-----------------+-----------------+-----------------+-----------+ | SSRC of granted | \"10000000 | The SSRC of the | | | floor | 11111111 | floor | | | participant | 00000000 | participant | | | | 10000000\" | being granted | | | | | the floor, in | | | | | this case the | | | | | SSRC of | | | | | MCPTT-client-B | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | Px_MCP | | | | | TT_User_B_ID | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \"100 | bit A=1 (Normal | | | | 00X0000000000\" | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-6: Floor Granted (step 49, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | any allowed | 128 sec (an | | | | value | arbitrary | | | | | value) | | +-----------------+-----------------+-----------------+-----------+ | Floor priority | \"0\" | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '00 | bit D=1 | | | | 010X0000000000' | (Emergency | | | | | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-7: Floor Granted (step 56, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | any allowed | 128 sec (an | | | | value | arbitrary | | | | | value) | | +-----------------+-----------------+-----------------+-----------+ | Floor priority | \"0\" | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '00 | bit E=1 | | | | 001X0000000000' | (Imminent Peril | | | | | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-8: Floor Release (steps 10, 46, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.5-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \"100 | bit A=1 (Normal | | | | 00X0000000000\" | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-9: Floor Release (step 51, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.5-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '00 | bit D=1 | | | | 010X0000000000' | (Emergency | | | | | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-10: Floor Release (step 58, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.5-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '00 | bit E=1 | | | | 001X0000000000' | (Imminent Peril | | | | | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-11: Floor Request (steps 12, 26, 29, 42, 43, Table
7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.2-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \"100 | bit A=1 (Normal | | | | 00X0000000000\" | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-12: Floor Request (step 14, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.2-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | Px_MCP | | | | | TT_User_B_ID | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \"1000 | bit A=1 (Normal | | | | 0000000000000\" | call) | | | | | | | | | | bit F=0 | | | | | (Queueing not | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-13: Floor Request (step 16, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.2-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | Px_MCP | | | | | TT_User_B_ID | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \"1000 | bit A=1 (Normal | | | | 0100000000000\" | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-14: Floor Request (step 37, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.2-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Priority | \"12\" | Priority is | | | | | higher than | | | | | mcptt-client-A | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | Px_MCP | | | | | TT_User_B_ID | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \"1000 | bit A=1 (Normal | | | | 0100000000000\" | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-15: Floor Deny (step 15, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.4-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Reject Cause | | | | +-----------------+-----------------+-----------------+-----------+ | Reject Cause | any allowed | | | | | value | | | +-----------------+-----------------+-----------------+-----------+ | Reject Phrase | not present or | | | | | any allowed | | | | | value | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | Px_MCP | | | | | TT_User_B_ID | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \"100 | bit A=1 (Normal | | | | 00X0000000000\" | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-16: Floor Deny (step 27, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.4-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \"1000 | bit A=1 (Normal | | | | 0100000000000\" | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-17: Floor Queue Position Info (steps 17, 19, Table
7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table | | | | | 5.5.6.10-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | Px_MCP | | | | | TT_User_A_ID | | | +-----------------+-----------------+-----------------+-----------+ | Queued User ID | | | | +-----------------+-----------------+-----------------+-----------+ | Queued User ID | Px_MCP | | | | | TT_User_B_ID | | | +-----------------+-----------------+-----------------+-----------+ | Queue Info | | | | +-----------------+-----------------+-----------------+-----------+ | Queue Position | \"1\" | | | | Info | | | | +-----------------+-----------------+-----------------+-----------+ | Queue Priority | any allowed | | | | Level | value | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \"100 | bit A=1 (Normal | | | | 00X0000000000\" | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-18: Floor Queue Position Info (steps 30, 33, Table
7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table | | | | | 5.5.6.10-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | Px_MCP | | | | | TT_User_B_ID | | | +-----------------+-----------------+-----------------+-----------+ | Queued User ID | | | | +-----------------+-----------------+-----------------+-----------+ | Queued User ID | Px_MCP | | | | | TT_User_A_ID | | | +-----------------+-----------------+-----------------+-----------+ | Queue Info | | | | +-----------------+-----------------+-----------------+-----------+ | Queue Position | \"1\" | | | | Info | | | | +-----------------+-----------------+-----------------+-----------+ | Queue Priority | \"0\" | | | | Level | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '10 | bit A=1 (Normal | | | | 00010000000000' | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-19: Floor Queue Position Request (step 18, Table 7.1.1.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.6.9-1 condition OFF-NETWORK
* * *
Information Element Value/remark Comment Condition User ID  
User ID Px_MCPTT_User_B_ID
Table 7.1.1.3.3-20: Floor Taken (step 24, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.7-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | Px_MCP | | | | | TT_User_B_ID | | | +-----------------+-----------------+-----------------+-----------+ | Granted | | | | | Party\'s | | | | | Identity | | | | +-----------------+-----------------+-----------------+-----------+ | Granted | Px_MCP | | | | Party\'s | TT_User_B_ID | | | | Identity | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '10 | bit A=1 (Normal | | | | 00010000000000' | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.1.3.3-21: Floor Taken (step 44, Table 7.1.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.7-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Granted | | | | | Party\'s | | | | | Identity | | | | +-----------------+-----------------+-----------------+-----------+ | Granted | Px_MCP | | | | Party\'s | TT_User_A_ID | | | | Identity | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \"100 | bit A=1 (Normal | | | | 00X0000000000\" | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+ | SSRC of granted | \"10000000 | | | | floor | 11111111 | | | | participant | 00000000 | | | | | 00000001\" | | | +-----------------+-----------------+-----------------+-----------+
### 7.1.2 Off-network / Group Call / Floor Control / Upgrade to Emergency Call
/ Downgrade from Emergency / Upgrade to Imminent Peril / Downgrade from
Imminent Peril / Release Call / Client Terminated (CT)
##### 7.1.2.1 Test Purpose (TP) {#test-purpose-tp-75 .H6}
##### (1) {#section-227 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service,
including authorised to receive group calls in off-network environment, and
the UE configured that user acknowledgement is not required, and the UE (MCPTT
Client) is in an off-network environment }
**ensure that** {
**when** { UE (MCPTT Client) receives a GROUP CALL ANNOUNCEMENT message with
Confirm mode indication present }
**then** { UE (MCPTT Client) enters the \"S3: part of ongoing call\" state and
sends a GROUP CALL ACCEPT message}
}
##### (2) {#section-228 .H6}
**with** { UE (MCPTT Client) being in an off-network MCPTT Pre-arranged Group
Call }
**ensure that** {
**when** { the MCPTT User (MCPTT Client) engages in communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the floor
control entity/arbitrator (Floor Request during a talk burst, Floor
granting/release, Floor idle, Floor deny, Floor taken/revoked, Floor request
queued and queue handling) }
}
##### (3) {#section-229 .H6}
**with** { UE (MCPTT Client) being in an upgraded off-network emergency group
call }
**ensure that** {
**when** { the MCPTT User (MCPTT Client) continues communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the floor
control entity/arbitrator }
}
##### (4) {#section-230 .H6}
**with** { UE (MCPTT Client) being in an upgraded off-network imminent peril
group call }
**ensure that** {
**when** { the MCPTT User (MCPTT Client) continues communication with the
invited MCPTT User(s) }
**then** { UE (MCPTT Client) respects the floor control imposed by the floor
control entity/arbitrator }
}
##### 7.1.2.2 Conformance requirements {#conformance-requirements-75 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379 clauses 10.2.2.4.3.3, 10.2.3.4.5, 10.2.3.4.7.2,
10.2.3.4.8.3, 10.2.3.4.8.6, 10.2.2.4.5.4, TS 24.380 clauses 7.2.3.2.7,
7.2.3.5.5, 7.2.3.3.2, 7.2.3.6.7, 7.2.3.5.4, 7.2.3.5.8, 7.2.3.5.6, 7.2.3.7.3,
7.2.3.7.5, 7.2.3.3.4, 7.2.3.4.3, 7.2.3.3.6, 7.2.3.4.2, 7.2.3.6.4, 7.2.3.6.3,
7.2.3.8.11, 7.2.3.8.3, 7.2.3.8.6, 7.2.3.5.7, 7.2.3.6.9, 7.2.3.6.6. Unless
otherwise stated these are Rel-13 requirements.
[TS 24.379, clause 10.2.2.4.3.3]
When in the \"S1: start-stop\" state, upon receiving a GROUP CALL ANNOUNCEMENT
message with the MCPTT group ID IE not matching MCPTT group ID of the call
stored for other state machines, the MCPTT client:
1) shall store the value of the SDP IE of the GROUP CALL ANNOUNCEMENT message
as the SDP body of the call;
2) shall store the value of the Call identifier IE of the GROUP CALL
ANNOUNCEMENT message as the call identifier of the call;
3) shall store the value of the Originating MCPTT user ID IE of the GROUP CALL
ANNOUNCEMENT message as the originating MCPTT user ID of the call;
4) shall store the value of the Refresh interval IE of the GROUP CALL
ANNOUNCEMENT message as the refresh interval of the call;
5) shall store the value of the MCPTT group ID IE of the GROUP CALL
ANNOUNCEMENT message as the MCPTT group ID of the call;
6) shall store the value of the Call start time IE of the GROUP CALL
ANNOUNCEMENT message as the call start time of the call;
7) shall create a call type control state machine as described in subclause
10.2.3.2;
...
9) if the terminating UE is configured that the terminating MCPTT user
acknowledgement is not required upon a terminating call request reception:
a) shall establish a media session based on the stored SDP body of the call;
b) shall start floor control as terminating floor participant as specified in
subclause 7.2 in 3GPP TS 24.380 [5];
c) if the GROUP CALL ANNOUNCEMENT message contains the Confirm mode indication
IE:
i) shall generate a GROUP CALL ACCEPT message as specified in subclause
15.1.4. In the GROUP CALL ACCEPT message, the MCPTT client:
A) shall set the Call identifier IE to the stored call identifier of the call;
B) shall set the Sending MCPTT user ID IE to own MCPTT user id;
C) shall set the Call type IE to the stored current call type associated with
the call type control state machine; and
D) shall set the MCPTT group ID IE to the stored MCPTT group ID of the call;
and
ii) shall send the GROUP CALL ACCEPT message as specified in subclause
10.2.1.1.1;
d) shall start timer TFG6 (max duration) with value as specified in subclause
10.2.2.4.1.2;
e) shall start timer TFG2 (call announcement) with value as specified in
subclause 10.2.2.4.1.1.1; and
f) shall enter the \"S3: part of ongoing call\" state.
[TS 24.379, clause 10.2.3.4.5]
When in the \"T0: waiting for the call to establish\" state, upon receipt of a
GROUP CALL ANNOUNCEMENT message by an idle MCPTT client when MCPTT user
acknowledgement is not required, the MCPTT client:
1) shall set the stored last call type change time to the Last call type
change time IE of the GROUP CALL ANNOUNCEMENT message;
2) shall set the last user to change call type to the Last user to change call
type IE of the GROUP CALL ANNOUNCEMENT message;
3) if the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set
to \"EMERGENCY GROUP CALL\":
a) shall set the stored current call type to \"EMERGENCY GROUP CALL\";
b) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network emergency group call as described in 3GPP
TS 24.383 [45];
c) shall start timer TFG13 (implicit downgrade emergency) with value as
specified in subclause 10.2.3.4.1.1; and
d) shall enter \"T1: in-progress emergency group call\" state;
4) if the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set
to \"IMMINENT PERIL GROUP CALL\":
a) shall set the stored current call type to \"IMMINENT PERIL GROUP CALL\";
b) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network imminent peril group call as described
in3GPP TS 24.383 [45];
c) shall start timer TFG14 (implicit downgrade imminent peril) with value as
specified in subclause 10.2.3.4.1.2; and
d) shall enter \"T3: in-progress imminent peril group call\" state; and
5) if the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set
to \"BASIC GROUP CALL\":
a) shall set the stored current call type to \"BASIC GROUP CALL\";
b) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network basic group call as described in 3GPP TS
24.383 [45]; and
c) shall enter \"T2: in-progress basic group call\" state.
[TS 24.379, clause 10.2.3.4.7.2]
When in the \"T1: in-progress emergency group call\" state or \"T2: in-
progress basic group call\" state or \"T3: in-progress imminent peril group
call\" state, upon receiving a GROUP CALL ANNOUNCEMENT message with the MCPTT
group ID IE matching with MCPTT group ID of the ongoing call and the Call
Identifier IE being the same as the stored call identifier of the call, the
MCPTT client:
1) if the stored last user to change call type of the call is same as the Last
user to change call type IE of the GROUP CALL ANNOUNCEMENT message and the
stored last call type change time is smaller than Last call type change time
IE of the GROUP CALL ANNOUNCEMENT message:
a) shall set the stored last call type change time of the call to Last call
type change time IE of the GROUP CALL ANNOUNCEMENT message;
b) if the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set
to \"EMERGENCY GROUP CALL\" and the stored call type is other than \"EMERGENCY
GROUP CALL\":
i) shall set the stored current call type to \"EMERGENCY GROUP CALL\";
ii) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network emergency group call as described in 3GPP
TS 24.383 [45];
iii) shall stop timer TFG14 (implicit downgrade imminent peril), if running;
iv) shall start timer TFG13 (implicit downgrade emergency) with value as
specified in subclause 10.2.3.4.1.1; and
v) shall enter \"T1: in-progress emergency group call\" state;
c) if the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set
to \"IMMINENT PERIL GROUP CALL\" and the stored call type is other than
\"IMMINENT PERIL GROUP CALL\":
i) shall set the stored current call type to \"IMMINENT PERIL GROUP CALL\";
ii) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network imminent peril group call as described in
3GPP TS 24.383 [45];
iii) shall stop timer TFG13 (implicit downgrade emergency), if running;
iv) shall start timer TFG14 (implicit downgrade imminent peril) with value as
specified in subclause 10.2.3.4.1.2; and
v) shall enter \"T3: in-progress imminent peril group call\" state; and
d) if the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set
to \"BASIC GROUP CALL\" and the stored call type is other than \"BASIC GROUP
CALL\":
i) shall set the stored current call type to \"BASIC GROUP CALL\";
ii) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network basic group call as described in 3GPP TS
24.383 [45];
iii) shall stop timer TFG13 (implicit downgrade emergency), if running;
iv) shall stop timer TFG14 (implicit downgrade imminent peril), if running;
and
v) shall enter \"T2: in-progress basic group call\" state; and
2) if the stored last user to change call type of the call is different from
the Last user to change call type IE of the GROUP CALL ANNOUNCEMENT message
and:
a) if the stored call type is same as Call type IE in the received GROUP CALL
ANNOUNCEMENT message and the stored last call type change time is smaller than
Last call type change time IE of the GROUP CALL ANNOUNCEMENT message:
i) shall set the stored last call type change time of the call to Last call
type change time IE of the GROUP CALL ANNOUNCEMENT message; and
ii) shall set the stored last user to change call type of the call to Last
user to change call type IE of the GROUP CALL ANNOUNCEMENT message;
b) if the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set
to \"EMERGENCY GROUP CALL\" and the stored call type is other than \"EMERGENCY
GROUP CALL\":
i) shall set the stored last call type change time of the call to Last call
type change time IE of the GROUP CALL ANNOUNCEMENT message;
ii) shall set the stored last user to change call type of the call to Last
user to change call type IE of the GROUP CALL ANNOUNCEMENT message;
iii) shall set the stored current call type to \"EMERGENCY GROUP CALL\";
iv) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network emergency group call as described in 3GPP
TS 24.383 [45];
v) shall stop timer TFG14 (implicit downgrade imminent peril), if running;
vi) shall start timer TFG13 (implicit downgrade emergency) with value as
specified in subclause 10.2.3.4.1.1; and
vii) shall enter \"T1: in-progress emergency group call\" state; and
c) if the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set
to \"IMMINENT PERIL GROUP CALL\" and the stored call type is \"BASIC GROUP
CALL\":
i) shall set the stored last call type change time of the call to Last call
type change time IE of the GROUP CALL ANNOUNCEMENT message;
ii) shall set the stored last user to change call type of the call to Last
user to change call type IE of the GROUP CALL ANNOUNCEMENT message;
iii) shall set the stored current call type to \"IMMINENT PERIL GROUP CALL \";
iv) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network imminent peril group call as described in
3GPP TS 24.383 [45];
v) shall start timer TFG14 (implicit downgrade imminent peril) with value as
specified in subclause 10.2.3.4.1.2; and
vi) shall enter \"T3: in-progress imminent peril group call\" state; and
d) if the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set
to \"BASIC GROUP CALL\" and the stored call type is other than \"BASIC GROUP
CALL\":
i) shall set the stored current call type to \"BASIC GROUP CALL\";
ii) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network basic group call as described in 3GPP TS
24.483 [45];
iii) shall stop timer TFG13 (implicit downgrade emergency), if running;
iv) shall stop timer TFG14 (implicit downgrade imminent peril), if running;
and
v) shall enter \"T2: in-progress basic group call\" state.
[TS 24.379, clause 10.2.3.4.8.3]
When in the \"T1: in-progress emergency group call\" state, upon receiving
GROUP CALL EMERGENCY END message, the MCPTT client:
1) shall set the stored last call type change time to the Last call type
change time IE of the received GROUP CALL EMERGENCY END message;
2) shall set the stored last user to change call type to the Last user to
change call type IE of the received GROUP CALL EMERGENCY END message;
3) shall set the stored current call type to \"BASIC GROUP CALL\";
4) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network basic group call as described in 3GPP TS
24.383 [45];
5) shall stop timer TFG13 (implicit downgrade emergency); and
6) shall enter the \"T2: in-progress basic group call\" state.
[TS 24.379, clause 10.2.3.4.8.6]
When in the \"T3: in-progress imminent peril group call\" state, upon
receiving GROUP CALL IMMINENT PERIL END message, the MCPTT client:
1) shall set the stored last call type change time to the Last call type
change time IE of the received GROUP CALL IMMINENT PERIL END message;
2) shall set the stored last user to change call type to the Last user to
change call type IE of the received GROUP CALL IMMINENT PERIL END message;
3) shall set the stored current call type to \"BASIC GROUP CALL\";
4) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network basic group call as described in 3GPP TS
24.383 [45];
5) shall stop timer TFG14 (implicit downgrade imminent peril); and
6) shall enter the \"T2: in-progress basic group call\" state.
[TS 24.379, clause 10.2.2.4.5.4]
When in the \"S6: ignoring incoming call announcements\" state, upon
expiration of timer TFG5 (not present incoming call announcements), the MCPTT
client:
1) shall release the stored SDP body of the call;
2) shall release the stored call identifier of the call;
3) shall release the stored originating MCPTT user ID of the call;
4) shall release the stored refresh interval of the call;
5) shall release the stored MCPTT group ID of the call;
6) shall release the call start time of the call;
7) shall destroy the call type control state machine as specified in subclause
10.2.3.4.10 or 10.2.3.4.11; and
8) shall enter the \"S1: start-stop\" state.
[TS 24.380, clause 7.2.3.2.7]
When a Floor Granted message is received and if the User ID in the Floor
Granted message does not match its own User ID, the floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. may provide a floor taken notification to the MCPTT user;
3\. shall set the stored SSRC of the candidate arbitrator to the SSRC of user
to whom the floor was granted in the Floor Granted message;
4\. shall start timer T203 (End of RTP media); and
5\. shall enter \'O: has no permission\' state.
[TS 24.380, clause 7.2.3.5.5]
Upon receiving an indication from the MCPTT user to release permission to send
RTP media, the floor participant:
1\. shall stop timer T206 (Stop talking warning), if running;
2\. shall stop timer T207 (Stop talking), if running;
3\. shall send a Floor Release message towards other floor participants, if no
queued requests exist: The Floor Release message:
a. shall include the MCPTT ID of the MCPTT user in the User ID field; and
b. if the session is not initiated as a broadcast group call with the B-bit
set to \'1\' (Broadcast group call), shall include a Floor Indicator field set
to \'0\' (normal call);
4\. shall start timer T230 (Inactivity);
5\. shall clear the stored SSRC of the current arbitrator; and
6\. shall enter \'O: silence\' state.
[TS 24.380, clause 7.2.3.3.2]
If the floor participant receives an indication from the MCPTT user to send
media, the floor participant:
1\. shall send the Floor Request message to other floor participants. The
Floor Request message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID of the MCPTT user in the \ value of the
User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall initialize the counter C201 (Floor request) with value set to 1;
3\. shall stop timer T230 (Inactivity);
4\. shall start timer T201 (Floor Request); and
5\. shall enter \'O: pending request\' state.
[TS 24.380, clause 7.2.3.6.7]
Upon receiving Floor Granted message and if the \ value in the User
ID field matches its own MCPTT ID and SSRC of floor participant sending the
Floor Granted message matches the stored SSRC of current arbitrator, the floor
participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall set the stored SSRC of the current floor arbitrator to its own SSRC;
3\. shall stop timer T203 (End of RTP media), if running;
4\. shall stop timer T201 (Floor Request);
5\. may provide a floor granted notification to the MCPTT user;
6\. if the Floor Indicator field is included and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
7\. shall enter \'O: has permission\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and there is no stored SSRC of the current arbitrator, the floor
participant:
1\. shall set the stored SSRC of the current arbitrator to its own SSRC;
2\. shall stop timer T203 (End of RTP media);
3\. shall stop timer T201 (Floor Request);
4\. may provide a floor granted notification to the MCPTT user;
5\. if the Floor Indicator field is included and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
6\. shall enter \'O: has permission\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and SSRC of floor participant sending the Floor Granted message matches the
stored SSRC of candidate arbitrator, the floor participant:
1\. shall set the stored SSRC of the current arbitrator to its own SSRC;
2\. shall stop timer T203 (End of RTP media);
3\. shall stop timer T201 (Floor Request);
4\. may provide a floor granted notification to the MCPTT user;
5\. shall clear the stored SSRC of the candidate arbitrator;
6\. if the Floor Indicator field is included and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
7\. shall enter \'O: has permission\' state.
[TS 24.380, clause 7.2.3.5.4]
Upon receiving a Floor Request message which is not pre-emptive as determined
by subclause 4.1.1.5, in a session where:
1\. the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in the
group configuration as specified in 3GPP TS 24.383 [4] is set to \"false\"; or
2\. the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in the
group configuration as specified in 3GPP TS 24.383 [4] is set to \"true\" but
the F-bit in the Floor Indicator field is set to \'0\' (i.e. indicating that
queuing of floor requests is not supported) or the Floor Indicator field is
not included in the Floor Request message;
then the floor participant:
1\. shall send the Floor Deny message. The Floor Deny message:
a. shall include in the Reject Cause field the \ value cause #1
(Another MCPTT client has permission);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value; and
c. shall include the User ID field received in the Floor Request message; and
2\. shall remain in \'O: has permission\' state.
Upon receiving a Floor Request message which is not pre-emptive as determined
by subclause 4.1.1.5, and the value of \"/\/\/OffNetwork/QueueUsage\"
leaf node present in the group configuration as specified in 3GPP TS 24.383
[4] is set to \"true\" and the F-bit in the Floor Indicator field is set to
\'1\' (i.e. indicating that queuing of the floor requests is supported) in the
Floor Request message, the floor participant:
1\. shall store the received Floor Request messages;
2\. if the pending request queue is not full, shall send the Floor Queue
Position Info message. The Floor Queue Position Info message:
a. shall include in the User ID field the MCPTT ID of the floor participant
sending the Floor Request message;
b. shall include the SSRC of the floor participant in the SSRC of queued floor
participant field;
c. shall include the position in the floor request queue in the Queue Info
field; and
d. shall include the floor priority in the Queue Info field;
3\. if the pending request queue is full, shall send the Floor Deny message.
The Floor Deny message:
a. shall include in the Reject Cause field the \ value cause #7
(Queue full);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value; and
c. shall include the User ID field received in the Floor Request message; and
4\. shall remain in \'O: has permission\' state.
[TS 24.380, clause 7.2.3.5.8]
Upon receiving a Floor Queue Position Request message, the floor participant:
1\. shall send the Floor Queue Position Info message. The Floor Queue Position
Info message:
a. shall include the MCPTT ID of the queued floor participant in the Queued
User ID field;
b. shall include the queue position and floor priority in the Queue Info
field;
c. shall include the SSRC of floor participant sending Floor Queue Position
Request message in SSRC of queue floor participant field; and
d. shall include the User ID of floor participant sending Floor Queue Position
Request message in User ID field; and
2\. remain in the \'O: has permission\' state.
[TS 24.380, clause 7.2.3.5.6]
When no more encoded media is received from the user and if at least one Floor
Request message is stored (i.e. queuing mode is used in the session), the
floor participant:
1\. shall stop timer T206 (Stop talking warning), if running;
2\. shall stop timer T207 (Stop talking), if running;
3\. shall request the MCPTT client to stop sending RTP media packets towards
other MCPTT clients;
4\. shall send the Floor Granted message toward the other floor participants.
The Floor Granted message:
a. shall include the MCPTT ID of the first floor participant in the queue in
the User ID field;
b. shall include the SSRC of the first floor participant in the queue in the
SSRC of the granted floor participant field;
c. shall remove the first floor participant from the queue;
d for the remaining floor participants in the queue:
i. shall include the MCPTT ID of the floor participant in the Queued User ID
field;
ii. shall include the SSRC of the floor participant in the SSRC of queued
floor participant field;
iii. shall include the queue position of the floor participant in the Queue
Info field; and
iv. shall include the priority of the floor participant in the Queue Info
field; and
e. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
5\. shall set the stored SSRC of the current arbitrator to the SSRC of user to
whom the floor was granted in the Floor Granted message;
6\. shall start timer T205 (Floor Granted ) and shall initiate counter C205
(Floor Granted ) to 1; and
7 shall enter the \'O: pending granted\' state.
[TS 24.380, clause 7.2.3.7.3]
On expiry of timer T205 (Floor Granted) and counter C205 (Floor Granted) is
less than the upper limit, the floor participant:
1\. shall send again the Floor Granted message toward the other floor
participants. For each participant in the queue the Floor Granted message:
a. shall include the MCPTT ID of the floor participant in the Queued User ID
field;
b. shall include the SSRC of the floor participant in the SSRC of queued floor
participant field;
c. shall include the queue position of the floor participant in the Queue Info
field; and
d. shall include the priority of the floor participant in the Queue Info
field;
2\. shall restart timer T205 (Floor Granted) and shall increment counter C205
(Floor Granted) by 1; and
3\. shall remain in \'O: pending granted\' state.
[TS 24.380, clause 7.2.3.7.5]
On the expiry of timer T205 (Floor Granted) for the configured upper limit of
counter C205 (Floor Granted) with no request pending in the queue, the floor
participant:
1\. shall reset the value of counter C205 (Floor Granted) to 1;
2\. shall start timer T230 (Inactivity);
3\. shall clear the stored SSRC of the current arbitrator; and
4\. shall enter \'O: silence\' state.
[TS 24.380, clause 7.2.3.3.4]
When a Floor Granted message is received and if the User ID in the Floor
Granted message does not match its own User ID, the floor participant:
1\. may provide a floor taken notification to the MCPTT user;
2\. if the Floor Indicator field is included and the B-bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
that this is a broadcast group call;
3\. shall set the stored SSRC of the candidate arbitrator to the SSRC of user
to whom the floor was granted in the Floor Granted message;
4\. shall stop timer T230 (Inactivity);
5\. shall start timer T203 (End of RTP media); and
6\. shall enter \'O: has no permission\' state.
[TS 24.380, clause 7.2.3.4.3]
When a Floor Release message is received and if the SSRC in the Floor Release
message matches with the stored SSRC of the current arbitrator or with the
stored SSRC of the candidate arbitrator, the floor participant:
1\. may provide floor idle notification to the MCPTT user.
2\. shall request the MCPTT client to stop rendering received RTP media
packets;
3\. shall stop timer T203 (End of RTP media);
4\. shall start timer T230 (Inactivity);
5\. shall clear the stored SSRC of the candidate arbitrator;
6\. shall clear the stored SSRC of the current arbitrator; and
7\. shall enter \'O: silence\' state;
[TS 24.380, clause 7.2.3.3.6]
When a Floor Taken message is received, the floor participant:
1\. may provide a floor taken notification to the MCPTT user;
2\. shall set the stored SSRC of the current arbitrator to the SSRC of granted
floor participant field in the Floor Taken message;
3\. shall stop timer T230 (Inactivity);
4\. shall start timer T203 (End of RTP media); and
5\. shall enter \'O: has no permission\' state.
[TS 24.380, clause 7.2.3.4.2]
If the floor participant receives an indication from the MCPTT user that the
MCPTT user wants to send media, the floor participant:
1\. shall send the Floor Request message to other clients. The Floor Request
message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID of the MCPTT user in the User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall initialize the counter C201 (Floor request) with value set to 1;
3\. shall start timer T201 (Floor Request); and
4\. shall enter \'O: pending request\' state.
[TS 24.380, clause 7.2.3.6.4]
Upon receiving Floor Deny message, if the \ value in the User ID
field matches its own MCPTT ID and SSRC of floor participant sending the Floor
Deny message matches the stored SSRC of current arbitrator, the floor
participant:
1\. shall stop the timer T201 (Floor Request);
2\. shall provide floor deny notification to the user;
3\. shall restart the timer T203 (End of RTP media);
4\. may display the floor deny reason to the user using information in the
Reject Cause field; and
5\. shall enter \'O: has no permission\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and there is no stored SSRC of the current arbitrator, the floor
participant:
1\. shall stop the timer T201 (Floor Request);
2\. shall set the stored SSRC of the current arbitrator to the SSRC of the
floor control server as received in the Floor Deny message;
3\. shall restart the timer T203 (End of RTP media);
4\. shall provide floor deny notification to the user;
5\. may display the floor deny reason to the user using information in the
Reject Cause field; and
6\. shall enter \'O: has no permission\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and SSRC of floor participant sending the Floor Deny message matches the
stored SSRC of candidate arbitrator, the floor participant:
1\. shall stop the timer T201 (Floor Request);
2\. shall set the stored SSRC of the current arbitrator to the SSRC of the
floor control server as received in the Floor Deny message;
3\. shall clear the stored SSRC of the candidate arbitrator;
4\. shall restart the timer T203 (End of RTP media);
5\. shall provide floor deny notification to the user;
6\. may display the floor deny reason to the user using information in the
Reject Cause field; and
7\. shall enter \'O: has no permission\' state.
[TS 24.380, clause 7.2.3.6.3]
Upon receiving Floor Queue Position Info message, if the \ value in
the Queued User ID field matches its own MCPTT ID and the value in the SSRC of
floor control server field as received in the Floor Queue Position Info
message matches the stored SSRC of current arbitrator, the floor participant:
1\. shall update the queue status;
2\. may notify the MCPTT user about the queue position received in the \ value in the Queue Info field;
3\. shall stop timer T201 (Floor Request); and
4\. shall enter \'O: queued\' state.
Otherwise, if the \ value in the Queued User ID field matches its own
MCPTT ID and there is no stored SSRC of the current arbitrator, the floor
participant:
1\. shall update the queue status;
2\. shall set the stored SSRC of the current arbitrator to the SSRC of the
floor control server as received in the Floor Queue Position Info message;
3\. may notify the MCPTT user about the queue position received in the \ value in the Queue Info field;
4\. shall stop timer T201 (Floor Request); and
5\. shall enter \'O: queued\' state.
Otherwise, if the \ value in the Queued User ID field matches its own
MCPTT ID and the value in the SSRC of floor control server field as received
in the Floor Queue Position Info message matches the stored SSRC of candidate
arbitrator, the floor participant:
1\. shall update the queue status;
2\. shall set the stored SSRC of the current arbitrator to the value in the
SSRC of the floor control server field as received in the Floor Queue Position
Info message;
3\. shall clear the stored SSRC of the candidate arbitrator;
4\. may notify the MCPTT user about the queue position received in the \ value in the Queue Info field;
5\. shall stop timer T201 (Floor Request); and
6\. shall enter \'O: queued\' state.
[TS 24.380, clause 7.2.3.8.11]
Upon receipt of an indication from the MCPTT client to request the queue
position information, the floor participant:
1\. shall send the Floor Queue Position Request message; The Floor Queue
Position Request message:
a. shall include the SSRC of sent Floor Request message in SSRC of floor
participant field; and
b. shall include the own MCPTT User ID in User ID field;
2\. shall initialize the counter C204 (Floor Queue Position request) with
value set to 1;
3\. shall start timer T204 (Floor Queue Position request); and
4\. remain in the \'O: queued\' state.
[TS 24.380, clause 7.2.3.8.3]
Upon receiving Floor Queue Position Info message, if the \ value in
the User ID field matches its own MCPTT ID and SSRC of floor participant
sending the Floor Queue Position Info message matches the stored SSRC of
current arbitrator, the floor participant:
1\. shall update the queue position;
2\. shall notify the MCPTT user about the queue position received in the
\ value in the Queue Info field;
3\. shall stop timer T204 (Floor Queue Position request); and
4\. shall remain in \'O: queued\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and SSRC of floor participant sending the Floor Queue Position Info message
matches the stored SSRC of candidate arbitrator, the floor participant:
1\. shall update the queue position;
2\. shall set the stored SSRC of the current arbitrator to the SSRC of the
floor control server as received in the Floor Queue Position Info message;
3\. shall clear the stored SSRC of the candidate arbitrator;
4\. shall notify the MCPTT user about the queue position received in the
\ value in the Queue Info field;
5\. shall stop timer T204 (Floor Queue Position request); and
6\. shall remain in \'O: queued\' state.
[TS 24.380, clause 7.2.3.8.6]
Upon receiving Floor Granted message and if the \ value in the User
ID field matches its own MCPTT ID and SSRC of floor participant sending the
Floor Granted message matches the stored SSRC of current arbitrator, the floor
participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall start timer T233(Pending user action), if not running already;
3\. shall notify the MCPTT user about of the floor grant;
4\. if the Floor Indicator field is included, and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
5\. shall remain in \'O: queued\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and SSRC of floor participant sending the Floor Granted message matches the
stored SSRC of candidate arbitrator, the floor participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall start timer T233(Pending user action), if not running already;
3\. shall notify the MCPTT user about of the floor grant;
4\. shall set the stored SSRC of the current arbitrator to its own SSRC;
5\. shall clear the stored SSRC of the candidate arbitrator;
6\. if the Floor Indicator field is included, and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
7\. shall remain in \'O: queued\' state.
[TS 24.380, clause 7.2.3.8.8]
If the floor participant receives an indication from the user that the user
wants to send media and the timer T233 (pending user action) is running, the
floor participant:
1\. shall stop the timer T233 (Pending user action);
2\. shall set the stored SSRC of the current floor arbitrator to its own SSRC;
and
3\. shall enter \'O: has permission\' state.
[TS 24.380, clause 7.2.3.5.7]
Upon receiving a Floor Request message which is pre-emptive as determined by
subclause 4.1.1.5, the floor participant:
1\. shall stop timer T206 (Stop talking warning), if running;
2\. shall stop timer T207 (Stop talking), if running;
3\. shall request the MCPTT client to stop sending RTP media packets towards
other MCPTT clients;
4\. shall send a Floor Granted message towards the other floor participants.
The Floor Granted message:
a. shall include the MCPTT ID of the Floor Request message received in the
User ID field;
b. shall include the SSRC of floor participant sending the Floor Request
message in the SSRC of floor control server field; and
c. if the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in
the group configuration as specified in 3GPP TS 24.483 [4] is set to \"true\",
for each floor participant in the queue:
i. shall include the MCPTT ID of the floor participant in the Queued User ID
field;
ii. shall include the SSRC of the floor participant in the SSRC of queued
floor participant field;
iii. shall include the queue position of the floor participant in the Queue
Info field; and
iv. shall include the priority of the floor participant in the Queue Info
field;
5\. shall start timer T205 (Floor Granted) and shall initiate counter C205
(Floor Granted) to 1;
6\. shall set the stored SSRC of the current floor arbitrator to the SSRC of
the user to whom the floor was granted in the Floor Granted message; and
7\. shall enter the \'O: pending granted\' state.
[TS 24.380, clause 7.2.3.6.9]
On expiry of timer T201 (Floor Request) if the counter C201 (Floor Request)
has not reached its upper limit, the floor participant:
1\. shall send the Floor Request message to other floor participants. The
Floor Request message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID of the own MCPTT user in the User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall restart the timer T201 (Floor Request) and increment counter C201
(Floor Request) by 1; and
3\. shall remain in the \'O: pending request\' state.
[TS 24.380, clause 7.2.3.6.6]
When timer T201 (Floor Request) expires and counter C201 (Floor Request)
reaches its upper limit, the floor participant:
1\. shall send the Floor Taken message toward the other floor participants.
The Floor Taken message:
a. shall include the floor participant\'s own SSRC in the SSRC of the granted
floor participant field;
b. shall include the floor participant\'s own MCPTT ID in the User ID field;
and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall set the stored SSRC of the current floor arbitrator to its own SSRC;
3\. shall stop timer T203 (End of RTP media), if running; and
4\. shall enter \'O: has permission\' state.
##### 7.1.2.3 Test description {#test-description-75 .H6}
##### 7.1.2.3.1 Pre-test conditions {#pre-test-conditions-75 .H6}
##### System Simulator: {#system-simulator-75 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server)
\-- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-75 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-75 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.2.3.2 Test procedure sequence {#test-procedure-sequence-75 .H6}
Table 7.1.2.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Activate | - | - | - | - | | | the MCPTT | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px | | | | | | | _MCPTT_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | px\ | | | | | | | _MCPTT_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | SS-UE1 | \ | GROUP | 1 | P | | | Does the | | CALL | | | | | UE (MCPTT | | ACCEPT | | | | | Client) | | | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | ACCEPT | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | SS-UE1 | \ | Floor | 2 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | The | \ | Floor | 2 | P | | | Does the | | Deny | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Deny | | | | | | | message | | | | | | | to the | | | | | | | sender of | | | | | | | the Floor | | | | | | | Request | | | | | | | message | | | | | | | with the | | | | | | | Reject | | | | | | | Cause | | | | | | | field set | | | | | | | to #1 | | | | | | | (Another | | | | | | | MCPTT | | | | | | | client | | | | | | | has | | | | | | | per | | | | | | | mission)? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11 | The | \ | Floor | 2 | P | | | Does the | | Queue | | | | | UE (MCPTT | | Position | | | | | Client) | | Info | | | | | add the | | | | | | | requester | | | | | | | to the | | | | | | | queue and | | | | | | | send a | | | | | | | Floor | | | | | | | Queue | | | | | | | Position | | | | | | | Info | | | | | | | message | | | | | | | to the | | | | | | | sender of | | | | | | | the Floor | | | | | | | Request | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13 | The | \ | Floor | 2 | P | | | Does the | | Queue | | | | | UE (MCPTT | | Position | | | | | Client) | | Info | | | | | respond | | | | | | | to the | | | | | | | Floor | | | | | | | Queue | | | | | | | Position | | | | | | | Request | | | | | | | message | | | | | | | with e a | | | | | | | Floor | | | | | | | Queue | | | | | | | Position | | | | | | | Info | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | release | | | | | | | the | | | | | | | fl | | | | | | | oor.(NOTE | | | | | | | 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16 | Check: | --> | Floor | 2 | P | | | Does the | | Granted | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Granted | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | par | | | | | | | ticipants | | | | | | | i | | | | | | | ndicating | | | | | | | the | | | | | | | queued | | | | | | | pa | | | | | | | rticipant | | | | | | | now has | | | | | | | the | | | | | | | floor? | | | | | | | | | | | | | | (NOTE 4) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step 17 | | | | | | | is | | | | | | | executed | | | | | | | a total | | | | | | | of 3 | | | | | | | times | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 17 | Check: | --> | Floor | 2 | P | | | Upon | | Granted | | | | | expiry of | | | | | | | timer | | | | | | | T205 | | | | | | | (Floor | | | | | | | Granted) | | | | | | | and while | | | | | | | counter | | | | | | | C205 | | | | | | | (Floor | | | | | | | Granted) | | | | | | | is less | | | | | | | than its | | | | | | | maximum | | | | | | | value, | | | | | | | does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | r | | | | | | | etransmit | | | | | | | the Floor | | | | | | | Granted | | | | | | | message | | | | | | | send in | | | | | | | step 16? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 18 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 19 | The | \ | Floor | 2 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 22 | The | \ | Floor | 2 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 25 | The | \ | Floor | 2 | P | | | Does the | | Queue | | | | | UE (MCPTT | | Position | | | | | Client) | | Request | | | | | send a | | | | | | | Floor | | | | | | | Queue | | | | | | | Position | | | | | | | Request | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 28 | The | \ | Floor | 2 | P | | | Does the | | Granted | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | respond | | | | | | | by | | | | | | | sending a | | | | | | | Floor | | | | | | | Granted | | | | | | | message? | | | | | | | | | | | | | | (NOTE 4) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step 34 | | | | | | | is | | | | | | | executed | | | | | | | a total | | | | | | | of 3 | | | | | | | times | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 34 | Check: | --> | Floor | 2 | P | | | Upon | | Granted | | | | | expiry of | | | | | | | timer | | | | | | | T205 | | | | | | | (Floor | | | | | | | Granted) | | | | | | | and while | | | | | | | counter | | | | | | | C205 | | | | | | | (Floor | | | | | | | Granted) | | | | | | | is less | | | | | | | than its | | | | | | | maximum | | | | | | | value, | | | | | | | does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | r | | | | | | | etransmit | | | | | | | the Floor | | | | | | | Granted | | | | | | | message | | | | | | | send in | | | | | | | step 33? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 35 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 36 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | request | | | | | | | the floor | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 37 | Check: | --> | Floor | 2 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | | | | | | | | | | (NOTE 5) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step 38 | | | | | | | is | | | | | | | executed | | | | | | | a total | | | | | | | of 2 | | | | | | | times | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 38 | Check: | --> | Floor | 2 | P | | | Upon | | Request | | | | | expiry of | | | | | | | timer | | | | | | | T201 | | | | | | | (Floor | | | | | | | Request) | | | | | | | and while | | | | | | | counter | | | | | | | C201 | | | | | | | (Floor | | | | | | | Request) | | | | | | | is less | | | | | | | than its | | | | | | | maximum | | | | | | | value, | | | | | | | does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | r | | | | | | | etransmit | | | | | | | the Floor | | | | | | | Request | | | | | | | message | | | | | | | send in | | | | | | | step 37? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 39 | Check: | --> | Floor | 2 | P | | | Upon | | Taken | | | | | expiry of | | | | | | | timer | | | | | | | T201 | | | | | | | (Floor | | | | | | | Request) | | | | | | | and with | | | | | | | counter | | | | | | | C201 | | | | | | | (Floor | | | | | | | Request) | | | | | | | equal to | | | | | | | its | | | | | | | maximum | | | | | | | value, | | | | | | | does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Taken | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 40 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | release | | | | | | | the floor | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 41 | Check: | --> | Floor | 2 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Release | | | | | | | message | | | | | | | to the | | | | | | | other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 42 | The | \ | Floor | 3 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 47 | The | \ | Floor | 4 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 56 | The | \/OffNetwork/Timers/TFG1\" leaf node present in the UE initial
configuration as specified in 3GPP TS 24.483 [13]; related to the D2D Sidelink
period)
\- TFG3 (call probe retransmission) set to 15 seconds (15,000 ms)
(\"/\/OffNetwork/Counters/TFG3\" leaf node present in the UE initial
configuration as specified in 3GPP TS 24.483 [13])
\- TFG5 (not present incoming call announcement) set to 30 seconds
(\"/\/OffNetwork/Timers/TFG5\" leaf node present in the UE initial
configuration as specified in 3GPP TS 24.483 [13].)
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.3.3.2 Test procedure sequence {#test-procedure-sequence-76 .H6}
Table 7.1.3.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Activate | - | - | - | - | | | the MCPTT | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px | | | | | | | _MCPTT_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | px\ | | | | | | | _MCPTT_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | initiate | | | | | | | an | | | | | | | of | | | | | | | f-network | | | | | | | basic | | | | | | | group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | of | | | | | | | f-network | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.11 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Mon | | | | | | | itoring/D | | | | | | | iscoverer | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | The UE | --> | GROUP | - | - | | | (MCPTT | | CALL | | | | | client) | | PROBE | | | | | sends a | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | message | | | | | | | to | | | | | | | determine | | | | | | | the | | | | | | | current | | | | | | | call | | | | | | | status of | | | | | | | the group | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4A | SS starts | - | - | - | - | | | Timer=15s | | | | | | | (TFG3 | | | | | | | (call | | | | | | | probe | | | | | | | retrans | | | | | | | mission)) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | release | | | | | | | the | | | | | | | of | | | | | | | f-network | | | | | | | basic | | | | | | | group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1), | | | | | | | (NOTE 3) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5A | Timer=15s | - | - | - | - | | | expires | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Check: | --> | GROUP | 1 | F | | | Does the | | CALL | | | | | UE (MCPTT | | PROBE | | | | | Client) | | | | | | | in the | | | | | | | next 5 | | | | | | | seconds | | | | | | | send a | | | | | | | retra | | | | | | | nsmission | | | | | | | of the | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | sent in | | | | | | | step 4? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6A | Wait 5 | - | - | - | - | | | seconds | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | message | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | initiate | | | | | | | an | | | | | | | of | | | | | | | f-network | | | | | | | basic | | | | | | | group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1), | | | | | | | (NOTE 4) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Check: | --> | GROUP | 2 | P | | | Does the | | CALL | | | | | UE (MCPTT | | PROBE | | | | | client) | | | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | message | | | | | | | to | | | | | | | determine | | | | | | | the | | | | | | | current | | | | | | | call | | | | | | | status of | | | | | | | the | | | | | | | group? | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | release | | | | | | | the | | | | | | | of | | | | | | | f-network | | | | | | | basic | | | | | | | group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1), | | | | | | | (NOTE 3) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10 | The | \ | GROUP | - | - | | | (MCPTT | | CALL | | | | | client) | | PROBE | | | | | sends a | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | message | | | | | | | to | | | | | | | determine | | | | | | | the | | | | | | | current | | | | | | | call | | | | | | | status of | | | | | | | the group | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15A | SS starts | - | - | - | - | | | Timer=25s | | | | | | | (TFG1 | | | | | | | (wait for | | | | | | | call | | | | | | | annou | | | | | | | ncement)) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | release | | | | | | | the | | | | | | | of | | | | | | | f-network | | | | | | | basic | | | | | | | group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1), | | | | | | | (NOTE 3) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16A | Timer=25s | - | - | - | - | | | expires | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 17 | Void | - | - | 4 | P | +-----------+-----------+-----------+-----------+---------+----+ | 18 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | initiate | | | | | | | an | | | | | | | of | | | | | | | f-network | | | | | | | basic | | | | | | | group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | of | | | | | | | f-network | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.11 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Mon | | | | | | | itoring/D | | | | | | | iscoverer | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 19 | The UE | --> | GROUP | - | - | | | (MCPTT | | CALL | | | | | client) | | PROBE | | | | | sends a | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | message | | | | | | | to | | | | | | | determine | | | | | | | the | | | | | | | current | | | | | | | call | | | | | | | status of | | | | | | | the group | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 20 | The | \ | GROUP | 1 | P | | | Does the | | CALL | | | | | UE (MCPTT | | ACCEPT | | | | | Client) | | | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | ACEEPT | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 13 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | release | | | | | | | the group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | If the | | | | | | | MCPTT | | | | | | | User does | | | | | | | not act | | | | | | | before | | | | | | | the | | | | | | | e | | | | | | | xpiration | | | | | | | of timer | | | | | | | TFG4 | | | | | | | (waiting | | | | | | | for the | | | | | | | user), | | | | | | | then the | | | | | | | MCPTT | | | | | | | Client | | | | | | | will | | | | | | | enter the | | | | | | | \"S6: | | | | | | | ignoring | | | | | | | incoming | | | | | | | call | | | | | | | announ | | | | | | | cements\" | | | | | | | state and | | | | | | | the | | | | | | | remaining | | | | | | | steps | | | | | | | will not | | | | | | | be valid. | | | | | | | Timer | | | | | | | TFG4 | | | | | | | (waiting | | | | | | | for the | | | | | | | user)=20s | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5.5.8.1-1 | | | | | | | and is | | | | | | | started | | | | | | | upon the | | | | | | | receiving | | | | | | | of the | | | | | | | GROUP | | | | | | | CALL | | | | | | | ANN | | | | | | | OUNCEMENT | | | | | | | message. | | | | | | | If during | | | | | | | test | | | | | | | execution | | | | | | | it is | | | | | | | found | | | | | | | that the | | | | | | | specified | | | | | | | timer | | | | | | | value is | | | | | | | not large | | | | | | | enough, | | | | | | | then a | | | | | | | new value | | | | | | | needs to | | | | | | | be | | | | | | | s | | | | | | | pecified. | | | | | | | | | | | | | | NOTE 3: | | | | | | | The UE | | | | | | | (MCPTT | | | | | | | Client) | | | | | | | enters | | | | | | | the \"S5: | | | | | | | pending | | | | | | | user | | | | | | | action | | | | | | | with | | | | | | | confirm | | | | | | | ind | | | | | | | ication\" | | | | | | | state | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 7.1.4.3.3 Specific message contents {#specific-message-contents-77 .H6}
None
### 7.1.5 Off-network / Group Call / MCPTT User Acknowledgement Required /
Without Confirm Indication / MCPTT User Reject / MCPTT User Accept / Client
Terminated (CT)
##### 7.1.5.1 Test Purpose (TP) {#test-purpose-tp-78 .H6}
##### (1) {#section-235 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service,
including authorised to receive group calls in off-network environment,
**and** the UE (MCPTT Client) is configured such that user acknowledgement is
required upon a terminating call request reception, **and** the UE (MCPTT
Client) is in an off-network environment **and** the UE (MCPTT Client)
receives an off-network group call request via a GROUP CALL ANNOUNCEMENT
message that does not contains the Confirm mode indication IE, **and** the
MCPTT User accepts the call }
**ensure that** {\ **when** { the MCPTT User requests the floor }
**then** { the UE (MCPTT Client) sends a Floor Request nessage to the floor
participants and respects the floor control imposed by the floor control
entity/arbitrator }
}
##### 7.1.5.2 Conformance requirements {#conformance-requirements-78 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379 clauses 10.2.2.4.3.3, 10.2.2.4.3.7, 10.2.2.4.3.5.
Unless otherwise stated these are Rel-13 requirements.
[TS 24.379, clause 10.2.2.4.3.3]
When in the \"S1: start-stop\" state, upon receiving a GROUP CALL ANNOUNCEMENT
message with the MCPTT group ID IE not matching MCPTT group ID of the call
stored for other state machines, the MCPTT client:
1) shall store the value of the SDP IE of the GROUP CALL ANNOUNCEMENT message
as the SDP body of the call;
2) shall store the value of the Call identifier IE of the GROUP CALL
ANNOUNCEMENT message as the call identifier of the call;
3) shall store the value of the Originating MCPTT user ID IE of the GROUP CALL
ANNOUNCEMENT message as the originating MCPTT user ID of the call;
4) shall store the value of the Refresh interval IE of the GROUP CALL
ANNOUNCEMENT message as the refresh interval of the call;
5) shall store the value of the MCPTT group ID IE of the GROUP CALL
ANNOUNCEMENT message as the MCPTT group ID of the call;
6) shall store the value of the Call start time IE of the GROUP CALL
ANNOUNCEMENT message as the call start time of the call;
7) shall create a call type control state machine as described in subclause
10.2.3.2;
8) if the terminating UE is configured that the terminating MCPTT user
acknowledgement is required upon a terminating call request reception:
a) shall start timer TFG4 (waiting for the user);
b) if the GROUP CALL ANNOUNCEMENT message contains the Confirm mode indication
IE, shall enter the \"S5: pending user action with confirm indication\" state;
and
c) if the GROUP CALL ANNOUNCEMENT message does not contains the Confirm mode
indication IE, shall enter the \"S4: pending user action without confirm
indication\" state; and
9) if the terminating UE is configured that the terminating MCPTT user
acknowledgement is not required upon a terminating call request reception:
a) shall establish a media session based on the stored SDP body of the call;
b) shall start floor control as terminating floor participant as specified in
subclause 7.2 in 3GPP TS 24.380 [5];
c) if the GROUP CALL ANNOUNCEMENT message contains the Confirm mode indication
IE:
i) shall generate a GROUP CALL ACCEPT message as specified in subclause
15.1.4. In the GROUP CALL ACCEPT message, the MCPTT client:
A) shall set the Call identifier IE to the stored call identifier of the call;
B) shall set the Sending MCPTT user ID IE to own MCPTT user id;
C) shall set the Call type IE to the stored current call type associated with
the call type control state machine; and
D) shall set the MCPTT group ID IE to the stored MCPTT group ID of the call;
and
ii) shall send the GROUP CALL ACCEPT message as specified in subclause
10.2.1.1.1;
d) shall start timer TFG6 (max duration) with value as specified in subclause
10.2.2.4.1.2;
e) shall start timer TFG2 (call announcement) with value as specified in
subclause 10.2.2.4.1.1.1; and
f) shall enter the \"S3: part of ongoing call\" state.
[TS 24.379, clause 10.2.2.4.3.7]
When in the \"S5: pending user action with confirm indication\" state or the
\"S4: pending user action without confirm indication\" state, upon an
indication from the MCPTT user to reject the incoming group call, the MCPTT
client:
1) shall stop timer TFG4 (waiting for the user);
2) shall start timer TFG5 (not present incoming call announcements); and
3) shall enter the \"S6: ignoring incoming call announcements\" state.
[TS 24.379, clause 10.2.2.4.3.5]
When in the \"S4: pending user action without confirm indication\" state, upon
an indication from the MCPTT user to accept the incoming group call, the MCPTT
client:
1) shall establish a media session based on the stored SDP body of the call;
2) shall start floor control as terminating floor participant as specified in
subclause 7.2 in 3GPP TS 24.380 [5];
3) shall start timer TFG6 (max duration) with value as specified in subclause
10.2.2.4.1.2;
4) shall start timer TFG2 (call announcement) with value as specified in
subclause 10.2.2.4.1.1.1; and
5) shall enter the \"S3: part of ongoing call\" state.
##### 7.1.5.3 Test description {#test-description-78 .H6}
##### 7.1.5.3.1 Pre-test conditions {#pre-test-conditions-78 .H6}
##### System Simulator: {#system-simulator-78 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-78 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-78 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- UE (MCPTT Client) is configured such that user acknowledgement is required
upon a terminating call request reception
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.5.3.2 Test procedure sequence {#test-procedure-sequence-78 .H6}
Table 7.1.5.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Activate | - | - | - | - | | | the MCPTT | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px | | | | | | | _MCPTT_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | px\ | | | | | | | _MCPTT_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | SS-UE1 | \ | Floor | - | - | | | UE (MCPTT | | Request | | | | | Client) | | | | | | | request | | | | | | | the floor | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11A | The | \ | GROUP | - | - | | | Does the | | CALL | | | | | UE (MCPTT | | PROBE | | | | | client) | | | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | message | | | | | | | to | | | | | | | determine | | | | | | | the | | | | | | | current | | | | | | | call | | | | | | | status of | | | | | | | the | | | | | | | group? | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step 5 is | | | | | | | executed | | | | | | | a total | | | | | | | of 3 | | | | | | | times | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | At the | --> | GROUP | - | - | | | e | | CALL | | | | | xpiration | | PROBE | | | | | of TFG3 | | | | | | | (call | | | | | | | probe | | | | | | | retrans | | | | | | | mission), | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | Client) | | | | | | | sends a | | | | | | | retra | | | | | | | nsmission | | | | | | | of the | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | sent in | | | | | | | step 4 | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | At the | --> | GROUP | - | - | | | e | | CALL | | | | | xpiration | | ANN | | | | | of TFG1 | | OUNCEMENT | | | | | (wait for | | | | | | | call | | | | | | | annou | | | | | | | ncement), | | | | | | | and after | | | | | | | receiving | | | | | | | no | | | | | | | response | | | | | | | to the | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE, | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | Client) | | | | | | | sends a | | | | | | | GROUP | | | | | | | CALL | | | | | | | ANN | | | | | | | OUNCEMENT | | | | | | | message | | | | | | | to | | | | | | | initiate | | | | | | | an | | | | | | | of | | | | | | | f-network | | | | | | | basic | | | | | | | group | | | | | | | call | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | The | \ | Floor | - | - | | | (MCPTT | | Granted | | | | | Client) | | | | | | | sends a | | | | | | | Floor | | | | | | | Granted | | | | | | | message | | | | | | | towards | | | | | | | the other | | | | | | | floor | | | | | | | par | | | | | | | ticipants | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 10 | The | \ | Floor | 1 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15 | The | \ | Floor | 1 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Release | | | | | | | message | | | | | | | to the | | | | | | | other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 18 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | release | | | | | | | the group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Timer | | | | | | | TFG3 | | | | | | | (call | | | | | | | probe | | | | | | | re | | | | | | | transmiss | | | | | | | ion)=40ms | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5.5.8.1-1 | | | | | | | and TFG1 | | | | | | | (wait for | | | | | | | call | | | | | | | a | | | | | | | nnounceme | | | | | | | nt)=150ms | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5.5.8.1-1 | | | | | | | are | | | | | | | started | | | | | | | upon the | | | | | | | sending | | | | | | | of the | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | message | | | | | | | | | | | | | | NOTE 3: | | | | | | | The UE | | | | | | | (MCPTT | | | | | | | Client) | | | | | | | merges | | | | | | | the 2 | | | | | | | calls and | | | | | | | rel | | | | | | | inquishes | | | | | | | floor | | | | | | | control | | | | | | | to the | | | | | | | sender of | | | | | | | the GROUP | | | | | | | CALL | | | | | | | ANN | | | | | | | OUNCEMENT | | | | | | | in step | | | | | | | 10 | | | | | | | | | | | | | | NOTE 4: | | | | | | | If the | | | | | | | MCPTT | | | | | | | User does | | | | | | | not | | | | | | | perform | | | | | | | an action | | | | | | | before | | | | | | | timer | | | | | | | T230 | | | | | | | (In | | | | | | | activity) | | | | | | | expires, | | | | | | | then the | | | | | | | MCPTT | | | | | | | Client | | | | | | | will | | | | | | | enter the | | | | | | | \'O: | | | | | | | \'Start | | | | | | | -stop\'\' | | | | | | | state per | | | | | | | 24.380 | | | | | | | [10] | | | | | | | and the | | | | | | | remaining | | | | | | | steps | | | | | | | will not | | | | | | | be valid. | | | | | | | Timer | | | | | | | T230 | | | | | | | (In | | | | | | | activity) | | | | | | | is | | | | | | | started | | | | | | | upon the | | | | | | | receiving | | | | | | | of the | | | | | | | Floor | | | | | | | Granted | | | | | | | message. | | | | | | | Timer | | | | | | | T230 | | | | | | | (Inactiv | | | | | | | ity)=10s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.1-1. | | | | | | | If during | | | | | | | test | | | | | | | execution | | | | | | | it is | | | | | | | found | | | | | | | that the | | | | | | | specified | | | | | | | timer | | | | | | | value is | | | | | | | not large | | | | | | | enough, | | | | | | | then a | | | | | | | new value | | | | | | | needs to | | | | | | | be | | | | | | | s | | | | | | | pecified. | | | | | | | | | | | | | | NOTE 5: | | | | | | | If the | | | | | | | MCPTT | | | | | | | User does | | | | | | | not | | | | | | | release | | | | | | | the floor | | | | | | | before | | | | | | | timer | | | | | | | T207 | | | | | | | (Stop | | | | | | | talking) | | | | | | | expires, | | | | | | | then the | | | | | | | MCPTT | | | | | | | Client | | | | | | | will | | | | | | | enter the | | | | | | | \'O: | | | | | | | silence\' | | | | | | | state per | | | | | | | TS 24.380 | | | | | | | [10] | | | | | | | and the | | | | | | | remaining | | | | | | | steps | | | | | | | will not | | | | | | | be valid. | | | | | | | Timer | | | | | | | T206 | | | | | | | (Stop | | | | | | | talking | | | | | | | warning) | | | | | | | is | | | | | | | started | | | | | | | upon the | | | | | | | receiving | | | | | | | of the | | | | | | | Floor | | | | | | | Granted | | | | | | | message. | | | | | | | Timer | | | | | | | T207 | | | | | | | (Stop | | | | | | | talking) | | | | | | | starts | | | | | | | upon the | | | | | | | e | | | | | | | xpiration | | | | | | | of Timer | | | | | | | T206 | | | | | | | (Stop | | | | | | | talking | | | | | | | warning). | | | | | | | Timer | | | | | | | T206 | | | | | | | (Stop | | | | | | | talking | | | | | | | war | | | | | | | ning)=10s | | | | | | | is set to | | | | | | | Tr | | | | | | | ansmitTim | | | | | | | eout=60s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.4-1, | | | | | | | minus | | | | | | | Transm | | | | | | | issionWar | | | | | | | ning=50s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.4-1. | | | | | | | Timer | | | | | | | T207 | | | | | | | (Stop | | | | | | | tal | | | | | | | king)=50s | | | | | | | is set to | | | | | | | Transm | | | | | | | issionWar | | | | | | | ning=50s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.4-1. | | | | | | | If during | | | | | | | test | | | | | | | execution | | | | | | | it is | | | | | | | found | | | | | | | that the | | | | | | | specified | | | | | | | timer(s) | | | | | | | value(s) | | | | | | | are not | | | | | | | large | | | | | | | enough, | | | | | | | then new | | | | | | | value(s) | | | | | | | need to | | | | | | | be | | | | | | | s | | | | | | | pecified. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 7.1.6.3.3 Specific message contents {#specific-message-contents-79 .H6}
Table 7.1.6.3.3-1: GROUP CALL ANNOUNCEMENT (step 10, Table 7.1.6.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.5.2.1-1
* * *
Information Element Value/remark Comment Condition Call identifier A value
less than the Call identifier used in the GROUP CALL ANNOUNCEMENT sent in step
5  
Call start time The same Call start time used in the GROUP CALL ANNOUNCEMENT
sent in step 5
Table 7.1.6.3.3-2: Floor Granted (step 8, Table 7.1.6.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | any allowed | | | | | value | | | +-----------------+-----------------+-----------------+-----------+ | Floor priority | \"0\" | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '10 | bit A=1 (Normal | | | | 000X0000000000' | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.6.3.3-3: Floor Granted (step 10, Table 7.1.6.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | any allowed | | | | | value | | | +-----------------+-----------------+-----------------+-----------+ | Floor priority | \"0\" | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | Px_MCP | | | | | TT_User_B_ID | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '10 | bit A=1 (Normal | | | | 00010000000000' | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.6.3.3-4: Floor Granted (step 14, Table 7.1.6.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | any allowed | | | | | value | | | +-----------------+-----------------+-----------------+-----------+ | Floor priority | \"0\" | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '10 | bit A=1 (Normal | | | | 00010000000000' | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.6.3.3-5: Floor Request (step 13, Table 7.1.6.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.2-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '10 | bit A=1 (Normal | | | | 000X0000000000' | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.6.3.3-6: Floor Release (step 16, Table 7.1.6.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.5-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '10 | bit A=1 (Normal | | | | 000X0000000000' | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
### 7.1.7 Off-network / Group Call / Emergency Call / Imminent Peril Call /
Client Originated (CO)
##### 7.1.7.1 Test Purpose (TP) {#test-purpose-tp-80 .H6}
##### (1) {#section-237 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service,
including authorised to initiate/cancel emergency group calls in off-network
environment, and the UE (MCPTT Client) is in an off-network environment }
**ensure that** {
**when** { the MCPTT User requests the establishment of an MCPTT emergency
group call }
**then** { UE (MCPTT Client) requests an MCPTT emergency group call by sending
a GROUP CALL ANNOUNCEMENT message, **and** respects the floor control imposed
by the floor control entity/arbitrator }
}
##### (2) {#section-238 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service,
including authorised to initiate/cancel imminent peril group calls in off-
network environment, and the UE (MCPTT Client) is in an off-network
environment }
**ensure that** {
**when** { the MCPTT User requests the establishment of an MCPTT imminent
peril group call }
**then** { UE (MCPTT Client) requests an MCPTT imminent peril group call by
sending a GROUP CALL ANNOUNCEMENT message, **and** respects the floor control
imposed by the floor control entity/arbitrator }
}
##### 7.1.7.2 Conformance requirements {#conformance-requirements-80 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379 clauses 10.2.2.4.2.1, 10.2.3.4.2, 10.2.3.4.6,
10.2.2.4.3.1, TS 24.380 clause 7.2.3.2.2. Unless otherwise stated these are
Rel-13 requirements.
[TS 24.379, clause 10.2.2.4.2.1]
When in the \"S1: start-stop\" state, upon an indication from an MCPTT user to
initiate a group call for an MCPTT group ID, the MCPTT client:
1) shall store the MCPTT group ID as the MCPTT group ID of the call;
2) shall create a call type control state machine as described in subclause
10.2.3.2;
3) shall generate a GROUP CALL PROBE message as specified in subclause 15.1.2.
In the GROUP CALL PROBE message, the MCPTT client:
a) shall set the MCPTT group ID IE to the stored MCPTT group ID of the call;
4) shall send the GROUP CALL PROBE message as specified in subclause
10.2.1.1.1;
5) shall start timer TFG3 (call probe retransmission);
6) shall start timer TFG1 (wait for call announcement); and
7) shall enter the \"S2: waiting for call announcement\" state.
[TS 24.379, clause 10.2.3.4.2]
When in the \"T0: waiting for the call to establish \" state, upon an
indication from an MCPTT user to initiate a group call probe for an MCPTT
group, the MCPTT client:
1) if the stored emergency state associated with emergency alert state machine
described in 12.2.2.2 is set to \"true\" and the value of \"/_\
_/\/Common/AllowedEmergencyCall\" leaf node present in group
configuration as specified in 3GPP TS 24.383 [45] is set to \"true\":
a) shall set the stored current call type to \"EMERGENCY GROUP CALL\"; and
b) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network emergency group call as described in 3GPP
TS 24.383 [45];
2) if the stored emergency state associated with emergency alert state machine
described in 12.2.2.2 is set to \"false\", and:
a) if the user initiates an MCPTT emergency call and the values of \"/_\
_/_\ _/Common/MCPTTGroupCall/EmergencyCall/Enabled\" leaf node present
in the user profile and \"/_\ _/\/Common/AllowedEmergencyCall\" leaf
node present in group configuration as specified in 3GPP TS 24.383 [45] are
set to \"true\":
i) shall set the stored current call type to \"EMERGENCY GROUP CALL\"; and
ii) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network emergency group call as described in 3GPP
TS 24.383 [45];
b) if the user initiates an MCPTT imminent peril group call and the values of
\"/_\ _/_\ _/Common/MCPTTGroupCall/ImminentPerilCall/Authorised\" leaf
node present in the user profile \"/_\
_/\/Common/AllowedImminentPerilCall \" leaf node present in group
configuration as specified in 3GPP TS 24.383 [45] are set to \"true\":
i) shall set the stored current call type to \"IMMINENT PERIL GROUP CALL\";
and
ii) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network imminent peril group call as described in
3GPP TS 24.383 [45]; and
c) if the user initiates an MCPTT group call which is not an MCPTT emergency
call and which is not an MCPTT imminent peril group call:
i) shall set the stored current call type to \"BASIC GROUP CALL\"; and
ii) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network basic group call as described in 3GPP TS
24.383 [45];
3) shall set the stored last call type change time to current UTC time;
4) shall set the last user to change call type to own MCPTT user ID; and
5) shall remain in \"T0: waiting for the call to establish\" state.
[TS 24.379, clause 10.2.3.4.6]
When in state \"T0: waiting for the call to establish\", if:
a) the MCPTT user accepts the call when MCPTT user acknowledgement is
required; or
b) the MCPTT client sends a GROUP CALL ANNOUNCEMENT message on expiry of timer
TFG1 (wait for call announcement) associated with the basic call control state
machine;
the MCPTT client:
1) if the stored current call type is set to \"EMERGENCY GROUP CALL\"
a) shall start timer TFG13 (implicit downgrade emergency) with value as
specified in subclause 10.2.3.4.1.1; and
b) shall enter \"T1: in-progress emergency group call\" state;
2) if the stored current call type is set to \"IMMINENT PERIL GROUP CALL\"
a) shall start timer TFG14 (implicit downgrade imminent peril) with value as
specified in subclause 10.2.3.4.1.2; and
b) shall enter \"T3: in-progress imminent peril group call\" state; or
3) if the stored current call type is set to \"BASIC GROUP CALL\"
a) shall enter \"T2: in-progress basic group call\" state.
[TS 24.379, clause 10.2.2.4.3.1]
When in the \"S2: waiting for call announcement\" state, upon expiry of timer
TFG1 (wait for call announcement), the MCPTT client:
1) shall stop timer TFG3 (call probe retransmission), if running;
2) shall generate an SDP body as specified in subclause 10.2.1.1.2 and store
it as the SDP body of the call;
3) shall generate a random number with uniform distribution between 0 and
65535 and store it as the call identifier of the call;
4) shall select refresh interval value and store it as the refresh interval of
the call;
5) shall store own MCPTT user ID as the originating MCPTT user ID of the call;
6) shall store the current UTC time as the call start time of the call;
7) shall generate a GROUP CALL ANNOUNCEMENT message as specified in subclause
15.1.3. In the GROUP CALL ANNOUNCEMENT message, the MCPTT client:
a) shall set the Call identifier IE to the stored call identifier of the call;
b) shall set the Call type IE to the stored current call type associated with
the call type control state machine;
c) shall set the Refresh interval IE to the stored refresh interval of the
call;
d) shall set the SDP IE to the stored SDP body of the call;
e) shall set the Originating MCPTT user ID IE to the stored originating MCPTT
user ID of the call;
f) shall set the MCPTT group ID IE to the stored MCPTT group ID of the call;
g) shall set the Call start time IE to the stored call start time of the call;
h) shall set the Last call type change time IE to the stored last call type
change time of the call associated with call type control state machine;
i) shall set the Last user to change call type IE to last user to change call
type associated with call type control state machine; and
j) may include the Confirm mode indication IE;
8) shall send the GROUP CALL ANNOUNCEMENT message as specified in subclause
10.2.1.1.1;
9) shall establish a media session based on the stored SDP body of the call;
10) shall start floor control as originating floor participant as specified in
subclause 7.2 in 3GPP TS 24.380 [5];
11) shall start timer TFG6 (max duration) with value as specified in subclause
10.2.2.4.1.2;
12) shall start timer TFG2 (call announcement) with value as specified in
subclause 10.2.2.4.1.1.1; and
13) shall enter the \"S3: part of ongoing call\" state.
Note: In this release of the present document, the refresh interval of the
call is fixed to 10 seconds.
[TS 24.380, clause 7.2.3.2.2]
When an MCPTT call is established with session announcement including an
explicit floor request, the originating floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. shall send Floor Granted message towards other floor participants. The
Floor Granted message:
a. shall include the granted priority in the Floor priority field;
b. shall include the MCPTT user\'s own MCPTT ID in the User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
3\. shall set the stored SSRC of the current florr arbitrator to its own SSRC;
and
4\. shall enter \'O: has permission\' state.
##### 7.1.7.3 Test description {#test-description-80 .H6}
##### 7.1.7.3.1 Pre-test conditions {#pre-test-conditions-80 .H6}
##### System Simulator: {#system-simulator-80 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server)
\-- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-80 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-80 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.7.3.2 Test procedure sequence {#test-procedure-sequence-80 .H6}
Table 7.1.7.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Activate | - | - | - | - | | | the MCPTT | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px | | | | | | | _MCPTT_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | px\ | | | | | | | _MCPTT_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | initiate | | | | | | | an | | | | | | | of | | | | | | | f-network | | | | | | | emergency | | | | | | | group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | of | | | | | | | f-network | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.11 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Mon | | | | | | | itoring/D | | | | | | | iscoverer | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | The UE | --> | GROUP | - | - | | | (MCPTT | | CALL | | | | | client) | | PROBE | | | | | sends a | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | message | | | | | | | to | | | | | | | determine | | | | | | | the | | | | | | | current | | | | | | | call | | | | | | | status of | | | | | | | the group | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step 5 is | | | | | | | executed | | | | | | | a total | | | | | | | of 3 | | | | | | | times | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | At the | --> | GROUP | - | - | | | e | | CALL | | | | | xpiration | | PROBE | | | | | of TFG3 | | | | | | | (call | | | | | | | probe | | | | | | | retrans | | | | | | | mission), | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | retra | | | | | | | nsmission | | | | | | | of the | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | sent in | | | | | | | step 4 | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Check: At | --> | GROUP | 1 | P | | | the | | CALL | | | | | e | | ANN | | | | | xpiration | | OUNCEMENT | | | | | of TFG1 | | | | | | | (wait for | | | | | | | call | | | | | | | annou | | | | | | | ncement), | | | | | | | and after | | | | | | | receiving | | | | | | | no | | | | | | | response | | | | | | | to the | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE, | | | | | | | does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | ANN | | | | | | | OUNCEMENT | | | | | | | message | | | | | | | to | | | | | | | initiate | | | | | | | an | | | | | | | of | | | | | | | f-network | | | | | | | emergency | | | | | | | group | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | The | \ | Floor | 1 | P | | | Does the | | Granted | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Granted | | | | | | | message | | | | | | | towards | | | | | | | the other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | release | | | | | | | the floor | | | | | | | | | | | | | | (NOTE 1), | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10 | Check: | --> | Floor | 1 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Release | | | | | | | message | | | | | | | to the | | | | | | | other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | release | | | | | | | the | | | | | | | emergency | | | | | | | group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 13 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 14 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | initiate | | | | | | | an | | | | | | | of | | | | | | | f-network | | | | | | | imminent | | | | | | | peril | | | | | | | group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | of | | | | | | | f-network | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.11 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Mon | | | | | | | itoring/D | | | | | | | iscoverer | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15 | Check: | --> | GROUP | - | - | | | Does the | | CALL | | | | | UE (MCPTT | | PROBE | | | | | client) | | | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | message | | | | | | | to | | | | | | | determine | | | | | | | the | | | | | | | current | | | | | | | call | | | | | | | status of | | | | | | | the | | | | | | | group? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step 16 | | | | | | | is | | | | | | | executed | | | | | | | a total | | | | | | | of 3 | | | | | | | times | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16 | Check: At | --> | GROUP | - | - | | | the | | CALL | | | | | e | | PROBE | | | | | xpiration | | | | | | | of TFG3 | | | | | | | (call | | | | | | | probe | | | | | | | retrans | | | | | | | mission), | | | | | | | does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | retra | | | | | | | nsmission | | | | | | | of the | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE | | | | | | | sent in | | | | | | | step 15? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 17 | Check: At | --> | GROUP | 2 | P | | | the | | CALL | | | | | e | | ANN | | | | | xpiration | | OUNCEMENT | | | | | of TFG1 | | | | | | | (wait for | | | | | | | call | | | | | | | annou | | | | | | | ncement), | | | | | | | and after | | | | | | | receiving | | | | | | | no | | | | | | | response | | | | | | | to the | | | | | | | GROUP | | | | | | | CALL | | | | | | | PROBE, | | | | | | | does the | | | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | ANN | | | | | | | OUNCEMENT | | | | | | | message | | | | | | | to | | | | | | | initiate | | | | | | | an | | | | | | | of | | | | | | | f-network | | | | | | | imminent | | | | | | | peril | | | | | | | group | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 18 | The | \ | Floor | 2 | P | | | Does the | | Granted | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Granted | | | | | | | message | | | | | | | towards | | | | | | | the other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 20 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | release | | | | | | | the floor | | | | | | | | | | | | | | (NOTE 1), | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 21 | Check: | --> | Floor | 2 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Release | | | | | | | message | | | | | | | to the | | | | | | | other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 22 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | release | | | | | | | the | | | | | | | imminent | | | | | | | peril | | | | | | | group | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | If the | | | | | | | MCPTT | | | | | | | User does | | | | | | | not | | | | | | | perform | | | | | | | an action | | | | | | | before | | | | | | | timer | | | | | | | T207 | | | | | | | (Stop | | | | | | | talking) | | | | | | | expires, | | | | | | | then the | | | | | | | MCPTT | | | | | | | Client | | | | | | | will | | | | | | | enter the | | | | | | | \'O: | | | | | | | \' | | | | | | | Silence\' | | | | | | | state per | | | | | | | 24.380 | | | | | | | [10] | | | | | | | and the | | | | | | | remaining | | | | | | | steps | | | | | | | will not | | | | | | | be valid. | | | | | | | Timer | | | | | | | T207 | | | | | | | (Stop | | | | | | | talking) | | | | | | | is | | | | | | | started | | | | | | | upon the | | | | | | | e | | | | | | | xpiration | | | | | | | of time | | | | | | | T206 | | | | | | | (Stop | | | | | | | talking | | | | | | | warning), | | | | | | | which is | | | | | | | started | | | | | | | at the | | | | | | | sending | | | | | | | of the | | | | | | | Floor | | | | | | | Granted | | | | | | | message. | | | | | | | T207 | | | | | | | (Stop | | | | | | | tal | | | | | | | king)=3s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 24.380 | | | | | | | [10], | | | | | | | Table | | | | | | | 11.1.2-1. | | | | | | | And T206 | | | | | | | (Stop | | | | | | | talking | | | | | | | warn | | | | | | | ing)=27s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 24.380 | | | | | | | [10], | | | | | | | Table | | | | | | | 11.1.2-1. | | | | | | | If during | | | | | | | test | | | | | | | execution | | | | | | | it is | | | | | | | found | | | | | | | that the | | | | | | | specified | | | | | | | timer(s) | | | | | | | value(s) | | | | | | | are not | | | | | | | large | | | | | | | enough, | | | | | | | then new | | | | | | | value(s) | | | | | | | need to | | | | | | | be | | | | | | | s | | | | | | | pecified. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 7.1.7.3.3 Specific message contents {#specific-message-contents-80 .H6}
Table 7.1.7.3.3-1: GROUP CALL ANNOUNCEMENT (step 6, Table 7.1.7.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.5.2.1-1
* * *
Information Element Value/remark Comment Condition Call type \"00000011\"
Emergency Group Call
Table 7.1.7.3.3-2: GROUP CALL ANNOUNCEMENT (step 17, Table 7.1.7.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.5.2.1-1
* * *
Information Element Value/remark Comment Condition Call type \"00000100\"
Imminent Peril Group Call
Table 7.1.7.3.3-3: GROUP CALL ACCEPT (step 7, Table 7.1.7.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.5.3.2-1
* * *
Information Element Value/remark Comment Condition Call type \"00000011\"
Emergency Group Call
Table 7.1.7.3.3-4: GROUP CALL ACCEPT (step 18, Table 7.1.7.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.5.3.2-1
* * *
Information Element Value/remark Comment Condition Call type \"00000100\"
Imminent Peril Group Call
Table 7.1.7.3.3-5: Floor Granted (step 8, Table 7.1.7.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | any allowed | | | | | value | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '00 | bit D=1 | | | | 010X0000000000' | (Emergency | | | | | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.7.3.3-6: Floor Granted (step 19, Table 7.1.7.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | | | | +-----------------+-----------------+-----------------+-----------+ | Duration | any allowed | | | | | value | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '00 | bit E=1 | | | | 001X0000000000' | (Imminent peril | | | | | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.7.3.3-7: Floor Release (step 10, Table 7.1.7.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.5-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '00 | bit D=1 | | | | 010X0000000000' | (Emergency | | | | | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.1.7.3.3-8: Floor Release (step 21, Table 7.1.7.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: TS | | | | | 36.579-1 [2], | | | | | Table 5.5.6.5-1 | | | | | condition | | | | | OFF-NETWORK | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | '00 | bit E=1 | | | | 001X0000000000' | (Imminent peril | | | | | call) | | | | | | | | | | bit F=X | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
### 7.1.8 Off-network / Group Call / Emergency Call / Imminent Peril Call /
Client Terminated (CT)
##### 7.1.8.1 Test Purpose (TP) {#test-purpose-tp-81 .H6}
##### (1) {#section-239 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service,
including authorised to receive emergency group calls in off-network
environment, and the UE (MCPTT Client) is in an off-network environment }
**ensure that** {
**when** { the UE (MCPTT Client) receives GROUP CALL ANNOUNCEMENT to initiate
an MCPTT emergency group call }
**then** { UE (MCPTT Client) responds by sending a GROUP CALL ACCEPT message,
**and** respects the floor control imposed by the floor control
entity/arbitrator }
}
##### (2) {#section-240 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service,
including authorised to receive imminent peril group calls in off-network
environment, and the UE (MCPTT Client) is in an off-network environment }
**ensure that** {
**when** { the UE (MCPTT Client) receives GROUP CALL ANNOUNCEMENT to initiate
an MCPTT imminent peril group call }
**then** { UE (MCPTT Client) responds by sending a GROUP CALL ACCEPT message,
**and** respects the floor control imposed by the floor control
entity/arbitrator }
}
##### 7.1.8.2 Conformance requirements {#conformance-requirements-81 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379 clauses 10.2.2.4.3.3, 10.2.3.4.5, 10.2.3.4.6. Unless
otherwise stated these are Rel-13 requirements.
[TS 24.379, clause 10.2.2.4.3.3]
When in the \"S1: start-stop\" state, upon receiving a GROUP CALL ANNOUNCEMENT
message with the MCPTT group ID IE not matching MCPTT group ID of the call
stored for other state machines, the MCPTT client:
1) shall store the value of the SDP IE of the GROUP CALL ANNOUNCEMENT message
as the SDP body of the call;
2) shall store the value of the Call identifier IE of the GROUP CALL
ANNOUNCEMENT message as the call identifier of the call;
3) shall store the value of the Originating MCPTT user ID IE of the GROUP CALL
ANNOUNCEMENT message as the originating MCPTT user ID of the call;
4) shall store the value of the Refresh interval IE of the GROUP CALL
ANNOUNCEMENT message as the refresh interval of the call;
5) shall store the value of the MCPTT group ID IE of the GROUP CALL
ANNOUNCEMENT message as the MCPTT group ID of the call;
6) shall store the value of the Call start time IE of the GROUP CALL
ANNOUNCEMENT message as the call start time of the call;
7) shall create a call type control state machine as described in subclause
10.2.3.2;
8) if the terminating UE is configured that the terminating MCPTT user
acknowledgement is required upon a terminating call request reception:
a) shall start timer TFG4 (waiting for the user);
b) if the GROUP CALL ANNOUNCEMENT message contains the Confirm mode indication
IE, shall enter the \"S5: pending user action with confirm indication\" state;
and
c) if the GROUP CALL ANNOUNCEMENT message does not contains the Confirm mode
indication IE, shall enter the \"S4: pending user action without confirm
indication\" state; and
9) if the terminating UE is configured that the terminating MCPTT user
acknowledgement is not required upon a terminating call request reception:
a) shall establish a media session based on the stored SDP body of the call;
b) shall start floor control as terminating floor participant as specified in
subclause 7.2 in 3GPP TS 24.380 [5];
c) if the GROUP CALL ANNOUNCEMENT message contains the Confirm mode indication
IE:
i) shall generate a GROUP CALL ACCEPT message as specified in subclause
15.1.4. In the GROUP CALL ACCEPT message, the MCPTT client:
A) shall set the Call identifier IE to the stored call identifier of the call;
B) shall set the Sending MCPTT user ID IE to own MCPTT user id;
C) shall set the Call type IE to the stored current call type associated with
the call type control state machine; and
D) shall set the MCPTT group ID IE to the stored MCPTT group ID of the call;
and
ii) shall send the GROUP CALL ACCEPT message as specified in subclause
10.2.1.1.1;
d) shall start timer TFG6 (max duration) with value as specified in subclause
10.2.2.4.1.2;
e) shall start timer TFG2 (call announcement) with value as specified in
subclause 10.2.2.4.1.1.1; and
f) shall enter the \"S3: part of ongoing call\" state.
[TS 24.379, clause 10.2.3.4.5]
When in the \"T0: waiting for the call to establish\" state, upon receipt of a
GROUP CALL ANNOUNCEMENT message by an idle MCPTT client when MCPTT user
acknowledgement is not required, the MCPTT client:
1) shall set the stored last call type change time to the Last call type
change time IE of the GROUP CALL ANNOUNCEMENT message;
2) shall set the last user to change call type to the Last user to change call
type IE of the GROUP CALL ANNOUNCEMENT message;
3) if the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set
to \"EMERGENCY GROUP CALL\":
a) shall set the stored current call type to \"EMERGENCY GROUP CALL\";
b) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network emergency group call as described in 3GPP
TS 24.383 [45];
c) shall start timer TFG13 (implicit downgrade emergency) with value as
specified in subclause 10.2.3.4.1.1; and
d) shall enter \"T1: in-progress emergency group call\" state;
4) if the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set
to \"IMMINENT PERIL GROUP CALL\":
a) shall set the stored current call type to \"IMMINENT PERIL GROUP CALL\";
b) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network imminent peril group call as described
in3GPP TS 24.383 [45];
c) shall start timer TFG14 (implicit downgrade imminent peril) with value as
specified in subclause 10.2.3.4.1.2; and
d) shall enter \"T3: in-progress imminent peril group call\" state; and
5) if the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set
to \"BASIC GROUP CALL\":
a) shall set the stored current call type to \"BASIC GROUP CALL\";
b) shall set the stored current ProSe per-packet priority to value
corresponding to MCPTT off-network basic group call as described in 3GPP TS
24.383 [45]; and
c) shall enter \"T2: in-progress basic group call\" state.
[TS 24.379, clause 10.2.3.4.6]
When in state \"T0: waiting for the call to establish\", if:
a) the MCPTT user accepts the call when MCPTT user acknowledgement is
required; or
b) the MCPTT client sends a GROUP CALL ANNOUNCEMENT message on expiry of timer
TFG1 (wait for call announcement) associated with the basic call control state
machine;
the MCPTT client:
1) if the stored current call type is set to \"EMERGENCY GROUP CALL\"
a) shall start timer TFG13 (implicit downgrade emergency) with value as
specified in subclause 10.2.3.4.1.1; and
b) shall enter \"T1: in-progress emergency group call\" state;
2) if the stored current call type is set to \"IMMINENT PERIL GROUP CALL\"
a) shall start timer TFG14 (implicit downgrade imminent peril) with value as
specified in subclause 10.2.3.4.1.2; and
b) shall enter \"T3: in-progress imminent peril group call\" state; or
3) if the stored current call type is set to \"BASIC GROUP CALL\"
a) shall enter \"T2: in-progress basic group call\" state.
##### 7.1.8.3 Test description {#test-description-81 .H6}
##### 7.1.8.3.1 Pre-test conditions {#pre-test-conditions-81 .H6}
##### System Simulator: {#system-simulator-81 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-81 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-81 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- UE is configured that the terminating MCPTT user acknowledgement is not
required upon a terminating call request reception
\- TFG1 (wait for call announcement) set to 150 ms (default value)
(\"/\/OffNetwork/Counters/TFG1\" leaf node present in the UE initial
configuration as specified in 3GPP TS 24.483 [13])
\- TFG3 (call probe retransmission) set to 40 ms (default value)
(\"/\/OffNetwork/Counters/TFG3\" leaf node present in the UE initial
configuration as specified in 3GPP TS 24.483 [13])
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.8.3.2 Test procedure sequence {#test-procedure-sequence-81 .H6}
Table 7.1.8.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Activate | - | - | - | - | | | the MCPTT | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px | | | | | | | _MCPTT_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | px\ | | | | | | | _MCPTT_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | SS-UE1 | \ | GROUP | 1 | P | | | Does the | | CALL | | | | | UE (MCPTT | | ACCEPT | | | | | Client) | | | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | ACEEPT | | | | | | | message? | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | Void | - | - | 1 | P | +-----------+-----------+-----------+-----------+---------+----+ | 6 | SS-UE1 | \ | Floor | 1 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | SS-UE1 | \ | GROUP | 2 | P | | | Does the | | CALL | | | | | UE (MCPTT | | ACCEPT | | | | | Client) | | | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | ACEEPT | | | | | | | message? | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16 | Void | - | - | 2 | P | +-----------+-----------+-----------+-----------+---------+----+ | 17 | SS-UE1 | \ | Floor | 2 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 20 | SS-UE1 | \_/_\
_/Common/MCPTTGroupCall/EmergencyAlert/Authorised\" leaf node present in
the user profile and \"/_\ _/\/Common/AllowedEmergencyAlert\" present in
group configuration as specified in 3GPP TS 24.383 [45] are set to \"true\",
the MCPTT client:
1) shall set the stored emergency state as \"true\";
2) shall set the stored MCPTT group ID to the indicated MCPTT group ID;
3) shall generate a GROUP EMERGENCY ALERT message as specified in subclause
15.1.16. In the GROUP EMERGENCY ALERT message, the MCPTT client:
a) shall set the MCPTT group ID IE to the stored MCPTT group ID;
b) shall set the Originating MCPTT user ID IE to own MCPTT user ID;
c) shall set the Organization name IE to own organization name; and
d) may set the User location IE with client\'s current location, if requested;
4) shall send the GROUP EMERGENCY ALERT message as specified in subclause
10.2.1.1.1;
> 5) shall start timer TFE2 (emergency alert retransmission); and
>
> 6) shall enter \"E2: Emergency state\" state.
[TS 24.379, clause 12.2.3.2]
When in state \"E2: Emergency state\", upon expiry of timer TFE2 (emergency
alert retransmission), the MCPTT client:
> 1) shall generate a GROUP EMERGENCY ALERT message as specified in subclause
> 15.1.16. In the GROUP EMERGENCY ALERT message, the MCPTT client:
>
> a) shall set the MCPTT group ID IE to the stored MCPTT group ID;
>
> b) shall set the originating MCPTT user ID IE to own MCPTT user ID;
>
> c) shall set the Organization name IE to own organization name; and
>
> d) may set the Location IE with client\'s current location, if requested;
> and
>
> 2) shall send the GROUP EMERGENCY ALERT message as specified in subclause
> 10.2.1.1.1;
>
> 3) shall start the timer TFE2 (emergency alert retransmission); and
>
> 4) shall remain in the current state.
[TS 24.379, clause 12.2.3.5]
When in \"E2: Emergency state\", upon receiving an indication from the MCPTT
user to cancel an emergency alert and the value of \"/_\ _/_\
_/Common/MCPTTGroupCall/EmergencyAlert/Cancel\" leaf node present in the
user profile as specified in 3GPP TS 24.383 [45] set to \"true\", the MCPTT
client:
1) shall set the stored emergency state as \"false\";
2) shall generate a GROUP EMERGENCY ALERT CANCEL message as specified in
subclause 15.1.18. In the GROUP EMERGENCY ALERT CANCEL message, the MCPTT
client:
a) shall set the MCPTT group ID IE to the stored MCPTT group ID;
b) shall set the Originating MCPTT user ID IE to own MCPTT user ID; and
c) shall set the Sending MCPTT user ID IE to own MCPTT user ID;
> 3) shall send the GROUP EMERGENCY ALERT CANCEL message as specified in
> subclause 10.2.1.1.1;
>
> 4) shall stop timer TFE2 (emergency alert retransmission); and
>
> 5) shall enter \"E1: Not in emergency state\" state.
##### 7.1.9.3 Test description {#test-description-82 .H6}
##### 7.1.9.3.1 Pre-test conditions {#pre-test-conditions-82 .H6}
##### System Simulator: {#system-simulator-82 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-82 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-82 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.9.3.2 Test procedure sequence {#test-procedure-sequence-82 .H6}
Table 7.1.9.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Activate | - | - | - | - | | | the MCPTT | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px | | | | | | | _MCPTT_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | px\ | | | | | | | _MCPTT_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | initiate | | | | | | | an | | | | | | | of | | | | | | | f-network | | | | | | | emergency | | | | | | | alert | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | of | | | | | | | f-network | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.11 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Mon | | | | | | | itoring/D | | | | | | | iscoverer | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | Check: | --> | GROUP | 1 | P | | | Does the | | EMERGENCY | | | | | UE (MCPTT | | ALERT | | | | | client) | | | | | | | send a | | | | | | | GROUP | | | | | | | EMERGENCY | | | | | | | ALERT | | | | | | | message? | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4A | SS starts | - | - | - | - | | | Timer=10s | | | | | | | (TFE2 | | | | | | | ( | | | | | | | emergency | | | | | | | alert | | | | | | | retrans | | | | | | | mission)) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | The | \ | GROUP | 2 | P | | | Does the | | EMERGENCY | | | | | UE (MCPTT | | ALERT | | | | | client) | | | | | | | send a | | | | | | | GROUP | | | | | | | EMERGENCY | | | | | | | ALERT | | | | | | | message? | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | cancel | | | | | | | the | | | | | | | emergency | | | | | | | alert | | | | | | | | | | | | | | (NOTE 1), | | | | | | | (NOTE 3) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Check: | --> | GROUP | 3 | P | | | Does the | | EMERGENCY | | | | | UE (MCPTT | | ALERT | | | | | client) | | CANCEL | | | | | send a | | | | | | | GROUP | | | | | | | EMERGENCY | | | | | | | ALERT | | | | | | | CANCEL | | | | | | | message? | | | | | | | | | | | | | | (NOTE | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10 | The | \ 1) shall store the Originating MCPTT user ID IE and location IE in the list
> of users in emergency;
2) shall generate a GROUP EMERGENCY ALERT ACK message as specified in
subclause 15.1.17. In the GROUP EMERGENCY ALERT ACK message, the MCPTT client:
a) shall set the MCPTT group ID IE to the MCPTT group ID IE of the received
GROUP EMERGENCY ALERT message;
b) shall set the Sending MCPTT user ID IE to own MCPTT user ID; and
c) shall set the Originating MCPTT user ID IE to the Originating MCPTT user ID
IE of the received GROUP EMERGENCY ALERT message; and
3) shall send the GROUP EMERGENCY ALERT ACK message as specified in subclause
10.2.1.1.1;
> 4) shall start timer TFE1 (Emergency Alert); and
>
> 5) shall remain in the current state.
NOTE: Each instance of timer TFE1 is per MCPTT user ID.
[TS 24.379, clause 12.2.3.4]
When in state \"E1: Not in emergency state\" or in \"E2: Emergency state\",
upon receiving a GROUP EMERGENCY ALERT message with the Originating MCPTT user
ID IE stored in the list of users in emergency, the MCPTT client:
> 1) may update the stored location of the user with the received Location IE;
>
> 2) shall restart the associated timer TFE1 (Emergency Alert); and
>
> 3) shall remain in the current state.
[TS 24.379, clause 12.2.3.6]
When in state \"E1: Not in emergency state\" or in \"E2: Emergency state\",
upon receiving a GROUP EMERGENCY ALERT CANCEL message with the Originating
MCPTT user ID IE stored in the list of users in emergency, the MCPTT client:
1) shall remove the MCPTT user ID and associated location information from the
stored list of users in emergency;
2) shall generate a GROUP EMERGENCY ALERT CANCEL ACK message as specified in
subclause 15.1.19. In the GROUP EMERGENCY ALERT CANCEL ACK message, the MCPTT
client:
a) shall set the MCPTT group ID IE to the MCPTT group ID IE of the received
GROUP EMERGENCY ALERT CANCEL message; and
> b) shall set the Sending MCPTT user ID IE to own MCPTT user ID; and
c) shall set the Originating MCPTT user ID IE to the Originating MCPTT user ID
IE of the received GROUP EMERGENCY ALERT message;
3) shall send the GROUP EMERGENCY ALERT CANCEL ACK message as specified in
subclause 10.2.1.1.1;
4) shall stop the associated timer TFE1 (Emergency Alert); and5) shall remain
in the current state.
[TS 24.379, clause 12.2.3.7]
When in state \"E1: Not in emergency state\" or in \"E2: Emergency state\",
upon expiry of timer TFE1 (Emergency Alert) associated with a stored MCPTT
user ID, the MCPTT client:
1) shall remove the MCPTT user ID and associated location information from the
stored list of users in emergency; and
2) shall remain in the current state.
##### 7.1.10.3 Test description {#test-description-83 .H6}
##### 7.1.10.3.1 Pre-test conditions {#pre-test-conditions-83 .H6}
##### System Simulator: {#system-simulator-83 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-83 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-83 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- TFE1(emergency alert) set to 15 seconds (\"/\/OffNetwork/Timers/TFE1\"
leaf node present in the UE initial configuration as specified in 3GPP TS
24.483 [13])
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.10.3.2 Test procedure sequence {#test-procedure-sequence-83 .H6}
Table 7.1.10.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Activate | - | - | - | - | | | the MCPTT | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px | | | | | | | _MCPTT_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | px\ | | | | | | | _MCPTT_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | SS-UE1 | \ | GROUP | 1 | P | | | Does the | | EMERGENCY | | | | | UE (MCPTT | | ALERT ACK | | | | | Client) | | | | | | | respond | | | | | | | to the | | | | | | | GROUP | | | | | | | EMERGENCY | | | | | | | ALERT by | | | | | | | sending a | | | | | | | GROUP | | | | | | | EMERGENCY | | | | | | | ALERT | | | | | | | ACK? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5A | Timer=10s | - | - | - | - | | | expires | | | | | | | (TFE2 | | | | | | | ( | | | | | | | emergency | | | | | | | alert | | | | | | | retrans | | | | | | | mission)) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Upon | \ | GROUP | 2 | F | | | Does the | | EMERGENCY | | | | | UE (MCPTT | | ALERT ACK | | | | | Client) | | | | | | | respond | | | | | | | to the | | | | | | | GROUP | | | | | | | EMERGENCY | | | | | | | ALERT by | | | | | | | sending | | | | | | | in the | | | | | | | next 5 | | | | | | | seconds a | | | | | | | GROUP | | | | | | | EMERGENCY | | | | | | | ALERT | | | | | | | ACK? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7A | Wait 5 | - | - | - | - | | | seconds | | | | | | | for GROUP | | | | | | | EMERGENCY | | | | | | | ALERT ACK | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Timer=15s | - | - | - | - | | | expires | | | | | | | (TFE1 | | | | | | | ( | | | | | | | Emergency | | | | | | | Alert)) | | | | | | | | | | | | | | (NOTE 5) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8A | Wait 5 | - | - | - | - | | | seconds | | | | | | | for | | | | | | | e | | | | | | | xpiration | | | | | | | of timer | | | | | | | TFE2 | | | | | | | ( | | | | | | | emergency | | | | | | | alert | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8B | Timer=10s | - | - | - | - | | | expires | | | | | | | (TFE2 | | | | | | | ( | | | | | | | emergency | | | | | | | alert | | | | | | | retrans | | | | | | | mission)) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | SS-UE1 | \ | GROUP | 3 | P | | | Does the | | EMERGENCY | | | | | UE (MCPTT | | ALERT ACK | | | | | Client) | | | | | | | respond | | | | | | | to the | | | | | | | GROUP | | | | | | | EMERGENCY | | | | | | | ALERT by | | | | | | | sending a | | | | | | | GROUP | | | | | | | EMERGENCY | | | | | | | ALERT | | | | | | | ACK? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | SS-UE1 | \ | GROUP | 4 | P | | | Does the | | EMERGENCY | | | | | UE (MCPTT | | ALERT | | | | | Client) | | CANCEL | | | | | respond | | ACK | | | | | to the | | | | | | | GROUP | | | | | | | EMERGENCY | | | | | | | ALERT | | | | | | | CANCEL by | | | | | | | sending a | | | | | | | GROUP | | | | | | | EMERGENCY | | | | | | | ALERT | | | | | | | CANCEL | | | | | | | ACK? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Timer | | | | | | | TFE1( | | | | | | | emergency | | | | | | | alert) is | | | | | | | started | | | | | | | by the | | | | | | | MCPTT | | | | | | | Client | | | | | | | upon the | | | | | | | receiving | | | | | | | of the | | | | | | | GROUP | | | | | | | EMERGENCY | | | | | | | ALERT | | | | | | | message. | | | | | | | Timer | | | | | | | TFE1 | | | | | | | ( | | | | | | | emergency | | | | | | | al | | | | | | | ert)=15s, | | | | | | | as | | | | | | | defined | | | | | | | as | | | | | | | defined | | | | | | | in the | | | | | | | Pre-test | | | | | | | co | | | | | | | nditions. | | | | | | | At the | | | | | | | expire of | | | | | | | TFE1, the | | | | | | | MCPTT | | | | | | | Client | | | | | | | assumes | | | | | | | the end | | | | | | | of the | | | | | | | emergency | | | | | | | state and | | | | | | | removes | | | | | | | the | | | | | | | a | | | | | | | ssociated | | | | | | | user from | | | | | | | the list. | | | | | | | | | | | | | | NOTE 3: | | | | | | | Timer | | | | | | | TFE2 | | | | | | | ( | | | | | | | emergency | | | | | | | alert | | | | | | | retran | | | | | | | smission) | | | | | | | is | | | | | | | started | | | | | | | by the SS | | | | | | | upon the | | | | | | | sending | | | | | | | of the | | | | | | | GROUP | | | | | | | EMERGENCY | | | | | | | ALERT | | | | | | | message. | | | | | | | Timer | | | | | | | TFE2 | | | | | | | ( | | | | | | | emergency | | | | | | | alert | | | | | | | re | | | | | | | transmiss | | | | | | | ion)=10s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.1-1. | | | | | | | At the | | | | | | | expire of | | | | | | | TFE2, the | | | | | | | SS | | | | | | | re | | | | | | | transmits | | | | | | | the GROUP | | | | | | | EMERGENCY | | | | | | | ALERT | | | | | | | message. | | | | | | | | | | | | | | NOTE 4: | | | | | | | The UE | | | | | | | (MCPTT | | | | | | | Client) | | | | | | | stores | | | | | | | the | | | | | | | Or | | | | | | | iginating | | | | | | | MCPTT | | | | | | | user ID | | | | | | | IE in the | | | | | | | list of | | | | | | | users in | | | | | | | e | | | | | | | mergency. | | | | | | | | | | | | | | NOTE 5: | | | | | | | Upon | | | | | | | expiry of | | | | | | | the timer | | | | | | | TFE1 | | | | | | | ( | | | | | | | Emergency | | | | | | | Alert), | | | | | | | the UE | | | | | | | (MCPTT | | | | | | | Client) | | | | | | | removes | | | | | | | the MCPTT | | | | | | | user ID | | | | | | | from the | | | | | | | stored | | | | | | | list of | | | | | | | users in | | | | | | | emergency | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 7.1.10.3.3 Specific message contents {#specific-message-contents-83 .H6}
None
### 7.1.11 Off-network / Group Call / Broadcast Group Call / Broadcast Group
Call Retransmitting / Broadcast Group Call Release / Client Originated (CO)
##### 7.1.11.1 Test Purpose (TP) {#test-purpose-tp-84 .H6}
##### (1) {#section-248 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service,
including authorised to initiate broadcast calls in off-network environment,
and the UE (MCPTT Client) is in an off-network environment }
**ensure that** {
**when** { the MCPTT User requests to initiate an MCPTT broadcast call }
**then** { UE (MCPTT Client) sends a GROUP CALL BROADCAST message and enters
the \"B2: in-progress broadcast group call\" state }
}
##### (2) {#section-249 .H6}
**with** { UE (MCPTT Client) in the \"B2: in-progress broadcast group call\"
state, and the UE (MCPTT Client) is in an off-network environment }
**ensure that** {
**when** { the timer TFB2 (broadcast retransmission) expires }
**then** { UE (MCPTT Client) retransmits the GROUP CALL BROADCAST message }
}
##### (3) {#section-250 .H6}
**with** { UE (MCPTT Client) in the \"B2: in-progress broadcast group call\"
state, and the UE (MCPTT Client) is in an off-network environment }
**ensure that** {
**when** { the MCPTT User requests to end the MCPTT broadcast call }
**then** { UE (MCPTT Client) sends a GROUP CALL BROADCAST END message and
enters the \"B1: start-stop\" state }
}
##### 7.1.11.2 Conformance requirements {#conformance-requirements-84 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379 clauses 10.3.2.4.1, 10.3.2.4.9, 10.3.2.4.7, TS 24.380
clause 7.2.3.2.2. Unless otherwise stated these are Rel-13 requirements.
[TS 24.379, clause 10.3.2.4.1]
When in the \"B1: start-stop\" state, upon the indication from MCPTT user to
initiate the broadcast group call, the MCPTT client:
1) shall generate an SDP body as specified in subclause 10.2.1.1.2 and store
it as the SDP body of the call;
2) shall generate a random number with uniform distribution between 0 and
65535 and store it as the call identifier of the call;
3) shall store own MCPTT user ID as the originating MCPTT user ID of the call;
4) shall store \"BROADCAST GROUP CALL\" as the current call type;
5) shall generate a GROUP CALL BROADCAST message as specified in subclause
15.1.20. In the GROUP CALL BROADCAST message, the MCPTT client:
a) shall set the Call identifier IE to the stored call identifier of the call;
b) shall set the Call type IE to the stored current call type;
c) shall set the Originating MCPTT user ID IE to the stored originating MCPTT
user ID of the call;
d) shall set the MCPTT group ID IE to the stored MCPTT group ID of the call;
and
e) shall set the SDP IE to the stored SDP body of the call;
6) shall set the ProSe per-packet priority to the value corresponding to MCPTT
off-network broadcast callas described in 3GPP TS 24.383 [45];
7) shall start floor control as originating floor participant as described
specified in subclause 7.2 in 3GPP TS 24.380 [5];
8) shall send the GROUP CALL BROADCAST message as specified in subclause
10.2.1.1.1;
9) shall establish a media session based on the stored SDP body of the call;
10) shall start timer TFB2 (broadcast retransmission); and
11) shall enter the \"B2: in-progress broadcast group call\" state.
[TS 24.379, clause 10.3.2.4.9]
When in the \"B2: in-progress broadcast group call\" state, upon expiry of
timer TFB2 (broadcast retransmission), the MCPTT client:
1) shall generate a GROUP CALL BROADCAST message as specified in subclause
15.1.20. In the GROUP CALL BROADCAST message, the MCPTT client:
a) shall set the Call identifier IE to the stored call identifier of the call;
b) shall set the Call type IE to the stored current call type;
c) shall set the Originating MCPTT user ID IE to the stored originating MCPTT
user ID of the call;
d) shall set the MCPTT group ID IE to the stored MCPTT group ID of the call;
and
e) shall set the SDP IE to the stored SDP body of the call;
2) shall send the GROUP CALL BROADCAST message as specified in subclause
10.2.1.1.1;
3) shall restart timer TFB2 (broadcast retransmission); and
4) shall remain in the \"B2: in-progress broadcast group call\" state.
[TS 24.379, clause 10.3.2.4.7]
When in the \"B2: in-progress broadcast group call\" state, upon an indication
from the originating MCPTT user to release the in-progress broadcast group
call, the MCPTT client:
1) shall release the media session;
2) shall generate a GROUP CALL BROADCAST END message as specified in subclause
15.1.21. In the GROUP CALL BROADCAST END message, the MCPTT client:
a) shall set the Call identifier IE to the stored call identifier of the call;
b) shall set the Originating MCPTT user ID IE to the stored originating MCPTT
user ID of the call; and
c) shall set the MCPTT group ID IE to the stored MCPTT group ID of the call;
3) shall send the GROUP CALL BROADCAST END message as specified in subclause
10.2.1.1.1;
4) shall stop timer TFB2 (broadcast retransmission);
5) shall clear the stored call identifier;
6) shall stop floor control; and
7) shall enter the \"B1: start-stop\" state.
[TS 24.380, clause 7.2.3.2.2]
When an MCPTT call is established with session announcement including an
explicit floor request, the originating floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. shall send Floor Granted message towards other floor participants. The
Floor Granted message:
a. shall include the granted priority in the Floor priority field;
b. shall include the MCPTT user\'s own MCPTT ID in the User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
3\. shall set the stored SSRC of the current florr arbitrator to its own SSRC;
and
4\. shall enter \'O: has permission\' state.
##### 7.1.11.3 Test description {#test-description-84 .H6}
##### 7.1.11.3.1 Pre-test conditions {#pre-test-conditions-84 .H6}
##### System Simulator: {#system-simulator-84 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-84 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-84 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.11.3.2 Test procedure sequence {#test-procedure-sequence-84 .H6}
Table 7.1.11.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Activate | - | - | - | - | | | the MCPTT | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px | | | | | | | _MCPTT_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | px\ | | | | | | | _MCPTT_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | initiate | | | | | | | an | | | | | | | of | | | | | | | f-network | | | | | | | broadcast | | | | | | | call | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | of | | | | | | | f-network | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.11 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Mon | | | | | | | itoring/D | | | | | | | iscoverer | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | Check: | --> | GROUP | 1 | P | | | Does the | | CALL | | | | | UE (MCPTT | | BROADCAST | | | | | client) | | | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | BROADCAST | | | | | | | message? | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4A | SS starts | - | - | - | - | | | Timer=10s | | | | | | | (Timer | | | | | | | TFB2 | | | | | | | ( | | | | | | | broadcast | | | | | | | retrans | | | | | | | mission)) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | Check: | --> | Floor | 1 | P | | | Does the | | Granted | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send a | | | | | | | Floor | | | | | | | Granted | | | | | | | message | | | | | | | towards | | | | | | | the other | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Timer=10s | - | - | - | - | | | expires | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Check: | --> | GROUP | 2 | P | | | Does the | | CALL | | | | | UE (MCPTT | | BROADCAST | | | | | client) | | | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | BROADCAST | | | | | | | message | | | | | | | using the | | | | | | | same Call | | | | | | | i | | | | | | | dentifier | | | | | | | IE as | | | | | | | used in | | | | | | | step 4? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | Client) | | | | | | | cancel | | | | | | | the | | | | | | | broadcast | | | | | | | call | | | | | | | | | | | | | | (NOTE 1), | | | | | | | (NOTE 3) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | Check: | --> | GROUP | 3 | P | | | Does the | | CALL | | | | | UE (MCPTT | | BROADCAST | | | | | client) | | END | | | | | send a | | | | | | | GROUP | | | | | | | CALL | | | | | | | BROADCAST | | | | | | | END | | | | | | | message | | | | | | | and enter | | | | | | | the \"B1: | | | | | | | sta | | | | | | | rt-stop\" | | | | | | | state? | | | | | | | | | | | | | | (NOTE 4) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Timer | | | | | | | TFB2 | | | | | | | ( | | | | | | | broadcast | | | | | | | retran | | | | | | | smission) | | | | | | | is | | | | | | | started | | | | | | | by the | | | | | | | MCPTT | | | | | | | Client | | | | | | | upon the | | | | | | | sending | | | | | | | of the | | | | | | | GROUP | | | | | | | CALL | | | | | | | BROADCAST | | | | | | | message. | | | | | | | Timer | | | | | | | TFB2 | | | | | | | ( | | | | | | | broadcast | | | | | | | re | | | | | | | transmiss | | | | | | | ion)=10s, | | | | | | | as | | | | | | | defined | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.1-1. | | | | | | | At the | | | | | | | expire of | | | | | | | timer | | | | | | | TFB2 | | | | | | | ( | | | | | | | broadcast | | | | | | | retrans | | | | | | | mission), | | | | | | | the MCPTT | | | | | | | Client | | | | | | | resends | | | | | | | the GROUP | | | | | | | CALL | | | | | | | BROADCAST | | | | | | | message. | | | | | | | | | | | | | | NOTE 3: | | | | | | | If the | | | | | | | MCPTT | | | | | | | User does | | | | | | | not | | | | | | | cancel | | | | | | | the | | | | | | | broadcast | | | | | | | call | | | | | | | before | | | | | | | timer | | | | | | | TFB2 | | | | | | | ( | | | | | | | broadcast | | | | | | | retran | | | | | | | smission) | | | | | | | expires, | | | | | | | then the | | | | | | | MCPTT | | | | | | | Client | | | | | | | will | | | | | | | resend | | | | | | | the GROUP | | | | | | | CALL | | | | | | | BROADCAST | | | | | | | message | | | | | | | per TS | | | | | | | 24.379 | | | | | | | [9] and | | | | | | | the | | | | | | | remaining | | | | | | | steps | | | | | | | will not | | | | | | | be valid. | | | | | | | If during | | | | | | | test | | | | | | | execution | | | | | | | it is | | | | | | | found | | | | | | | that the | | | | | | | specified | | | | | | | timer | | | | | | | value is | | | | | | | not large | | | | | | | enough, | | | | | | | then a | | | | | | | new value | | | | | | | needs to | | | | | | | be | | | | | | | s | | | | | | | pecified. | | | | | | | | | | | | | | NOTE 4: | | | | | | | Timer | | | | | | | TFB2 | | | | | | | ( | | | | | | | broadcast | | | | | | | retran | | | | | | | smission) | | | | | | | is | | | | | | | stopped | | | | | | | by the | | | | | | | MCPTT | | | | | | | Client | | | | | | | upon the | | | | | | | sending | | | | | | | of the | | | | | | | GROUP | | | | | | | CALL | | | | | | | BROADCAST | | | | | | | END | | | | | | | message. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 7.1.11.3.3 Specific message contents {#specific-message-contents-84 .H6}
Table 7.1.11.3.3-1: GROUP CALL BROADCAST (step 7, Table 7.1.11.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.5.6.1-1
* * *
Information Element Value/remark Comment Condition Call identifier Use the
same Call identifier as used in the GROUP CALL BROADCAST message sent in step
3
### 7.1.12 Off-network / Group Call / Broadcast Group Call / MCPTT User Ack
Not Required / Originator Releases Call / Client Terminated (CT)
##### 7.1.12.1 Test Purpose (TP) {#test-purpose-tp-85 .H6}
##### (1) {#section-251 .H6}
**with** { UE (MCPTT Client) registered and authorised for MCPTT Service,
including authorised to receive broadcast calls in off-network environment,
and the UE (MCPTT Client) is in an off-network environment, and the UE (MCPTT
Client) has received a GROUP CALL BROADCAST message }
**ensure that** {
**when** { MCPTT User requests the floor }
**then** { UE (MCPTT Client) does not send a Floor Request message }
}
##### 7.1.12.2 Conformance requirements {#conformance-requirements-85 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.379 clauses 10.3.2.4.2, 10.3.2.4.8, TS 24.380 clause
7.2.3.2.9. Unless otherwise stated these are Rel-13 requirements.
[TS 24.379, clause 10.3.2.4.2]
When in the \"B1: start-stop\" state, upon receiving a GROUP CALL BROADCAST
message with the Call identifier IE not matching any in-progress broadcast
group call, the MCPTT client:
1) shall store the value of the Call identifier IE of the GROUP CALL BROADCAST
message as the call identifier of the call;
2) shall store the value of the Call type IE of the GROUP CALL BROADCAST
message as the received current call type;
3) shall store the value of the SDP IE of the GROUP CALL BROADCAST message as
the SDP body of the call;
4) shall store the value of the Originating MCPTT user ID IE of the GROUP CALL
BROADCAST message as the originating MCPTT user ID of the call;
5) shall store the value of the MCPTT group ID IE of the GROUP CALL BROADCAST
message as the MCPTT group ID of the call;
6) if the terminating UE is configured that the terminating MCPTT user
acknowledgement is required upon a terminating call request reception:
i) shall start timer TFB3 (waiting for the user); and
ii) shall enter the \"B3: pending user action\" state; and
7) if the terminating UE is configured that the terminating MCPTT user
acknowledgement is not required upon a terminating call request reception:
i) shall establish a media session based on the stored SDP body of the call;
ii) shall start floor control as terminating floor participant as specified in
subclause 7.2 in 3GPP TS 24.380 [5];
iii) shall start timer TFB1 (max duration); and
iv) shall enter the \"B2: in-progress broadcast group call\" state.
[TS 24.379, clause 10.3.2.4.8]
When in the \"B2: in-progress broadcast group call\" state or \"B4: ignoring
same call ID\" state, upon receiving GROUP CALL BROADCAST END message with the
same Call identifier IE as the stored call identifier, the MCPTT client:
1) shall release media session;
2) shall stop timer TFB1 (max duration);
3) shall clear the stored call identifier;
4) shall stop floor control, if running; and
5) shall enter the \"B1: start-stop\" state.
[TS 24.380, clause 7.2.3.2.9]
When an MCPTT broadcast call is established the terminating floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. shall start timer T203 (End of RTP media); and
3\. shall enter \'O: has no permission\' state.
NOTE: In MCPTT broadcast call, only originating MCPTT user is allowed to
request floor and transmit media. A Floor Request message is locally denied to
terminating MCPTT user, if requested.
##### 7.1.12.3 Test description {#test-description-85 .H6}
##### 7.1.12.3.1 Pre-test conditions {#pre-test-conditions-85 .H6}
##### System Simulator: {#system-simulator-85 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-85 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-85 .H6}
\- The UE has performed procedure \'MCPTT UE registration\' as specified in TS
36.579-1 [2] clause 5.4.2.
\- TFG4 (waiting for the user) set to 0 (a value to suit the test case
sequence) (\"/\/OffNetwork/Timers/TFB1\" leaf node present in the UE
initial configuration as specified in 3GPP TS 24.483 [13])
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.12.3.2 Test procedure sequence {#test-procedure-sequence-85 .H6}
Table 7.1.12.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Activate | - | - | - | - | | | the MCPTT | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px | | | | | | | _MCPTT_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | px\ | | | | | | | _MCPTT_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | SS-UE1 | \ | Floor | 1 | F | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | Client) | | | | | | | send in | | | | | | | the next | | | | | | | 5 seconds | | | | | | | a Floor | | | | | | | Request | | | | | | | message | | | | | | | to the | | | | | | | floor | | | | | | | part | | | | | | | icipants? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | Wait 5 | - | - | - | - | | | seconds | | | | | | | for the | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | SS-UE1 | \/OffNetwork/Timers/TFB1\"
leaf node present in the UE initial configuration as specified in 3GPP TS
24.483 [13])
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.13.3.2 Test procedure sequence {#test-procedure-sequence-86 .H6}
Table 7.1.13.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Activate | - | - | - | - | | | the MCPTT | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px | | | | | | | _MCPTT_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | px\ | | | | | | | _MCPTT_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | SS-UE1 | \ portion set to a dash;
b) the \"s=\" field with the \ portion set to a dash; and
c) the \"c=\" field with the \ portion set to \"IN\", the \
portion set to the IP version of the unicast IP address of the MCPTT client
and the \ portion set to the unicast IP address of the
MCPTT client;
2) shall include the media-level section for MCPTT speech consisting of:
a) the \"m=\" field with the \ portion set to \"audio\", the \
portion set to a port number for MCPTT speech of the MCPTT group, the \
field set to \"RTP/AVP\" and \ portion set indicating RTP payload type
numbers;
b) the \"i=\" field with the \ portion set to \"speech\";
c) the \"a=fmtp:\" attribute(s), the \"a=rtpmap:\" attribute(s) or both,
indicating the codec(s) and media parameters of the MCPTT speech; and
d) the \"a=rtcp:\" attribute indicating port number to be used for RTCP at the
MCPTT client selected according to the rules and procedures of IETF RFC 3605
[13], if the media steam uses other than the default IP address;
3) shall include the media-level section for media-floor control entity
consisting of:
a) an \"m=\" line, with the \ portion set to \"application\", the
\ portion set to a port number for media-floor control entity of the
MCPTT group, the \ field set to \"udp\" and \ portion set to
\"MCPTT\"; and
b) the \"a=fmtp:MCPTT\" attribute indicating the parameters of the media-floor
control entity as specified 3GPP TS 24.380 [5]; and
4) shall include the MIKEY-SAKKE I_MESSAGE, if generated by the MCPTT client,
in an \"a=key-mgmt\" attribute as a \"mikey\" attribute value in the SDP offer
as specified in IETF RFC 4567 [47].
[TS 24.379, clause 11.2.2.4.2.1]
When in the \"P0: start-stop\" state or \"P1: ignoring same call id\", upon an
indication from MCPTT User to initiate a private call and the value of
\"/\/\/Common/PrivateCall/Authorised\" leaf node present in the user
profile as specified in 3GPP TS 24.383 [45] is set to \"true\", the MCPTT
client:
1) shall generate and store the call identifier as a random number uniformly
distributed between (0, 65536);
2) shall store own MCPTT user ID as caller ID;
3) shall store MCPTT user ID of the callee as callee ID;
4) shall store \"AUTOMATIC COMMENCEMENT MODE\" as commencement mode, if
requested and the value of \"/\/\/Common/PrivateCall/AutoCommence\" leaf
node present in the user profile as specified in 3GPP TS 24.383 [45] is set to
\"true\". Otherwise if the value of
\"/\/\/Common/PrivateCall/ManualCommence\" leaf node present in the user
profile as specified in 3GPP TS 24.383 [45] is set to \"true\", store \"MANUAL
COMMENCEMENT MODE\" as commencement mode;
5) shall create a call type control state machine as described in subclause
11.2.3.2;
6) if an end-to-end security context needs to be established then:
a) shall use keying material provided by the key management server to generate
a PCK as described in 3GPP TS 33.179 [46];
b) shall use the PCK to generate a PCK-ID with the four most significant bits
set to \"0001\" to indicate that the purpose of the PCK is to protect private
call communications and with the remaining twenty eight bits being randomly
generated as described in 3GPP TS 33.179 [46];
c) shall encrypt the PCK to a UID associated to the MCPTT client using the
MCPTT ID of the invited user and a time related parameter as described in 3GPP
TS 33.179 [46];
d) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-
ID as specified in 3GPP TS 33.179 [46];
e) shall add the MCPTT ID of the originating MCPTT to the initiator field
(IDRi) of the I_MESSAGE as described in 3GPP TS 33.179 [46];
f) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user\'s
signing key provided in the keying material together with a time related
parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
33.179 [46] and;
g) shall store the MIKEY-SAKKE I_MESSAGE for later inclusion in an SDP body;
7) may store current user location as user location;
8) shall generate and store offer SDP, as defined in subclause 11.2.1.1.2;
9) shall generate a PRIVATE CALL SETUP REQUEST message as specified in
subclause 15.1.5. In the PRIVATE CALL SETUP REQUEST message, the MCPTT client:
a) shall set the Call identifier IE with the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller ID;
c) shall set the MCPTT user ID of the callee IE with the stored callee ID;
d) shall set the Commencement mode IE with the stored commencement mode;
e) shall set the Call type IE with the stored current call type associated
with the call type control state machine;
f) shall set the SDP offer IE with the stored offer SDP; and
g) may set the User location IE with the stored user location if the stored
current call type associated with the call type control state machine is
\"EMERGENCY PRIVATE CALL\".
10) shall send the PRIVATE CALL SETUP REQUEST message towards other MCPTT
client according to rules and procedures as specified in subclause 11.2.1.1.1;
11) shall initialize the counter CFP1 (private call request retransmission)
with the value set to 1;
12) shall start timer TFP1 (private call request retransmission); and
13) shall enter the \"P2: waiting for call response\" state.
[TS 24.379, clause 11.2.2.4.2.2]
When in the \"P2: waiting for call response\" state, upon expiry of timer TFP1
(private call request retransmission), the MCPTT client:
1) may update the stored user location with current user location;
2) shall increment the value of counter CFP1 (private call request
retransmission) by 1;
3) shall generate a PRIVATE CALL SETUP REQUEST message as specified in
subclause 15.1.5. In the PRIVATE CALL SETUP REQUEST message, the MCPTT client:
a) shall set the Call identifier IE with the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller ID;
c) shall set the MCPTT user ID of the callee IE with the stored callee ID;
d) shall set the Commencement mode IE with the stored commencement mode;
e) shall set the Call type IE with the stored current call type associated
with the call type control state machine;
f) shall set the SDP offer IE with the stored offer SDP; and
g) may set the User location IE with stored user location if the stored
current call type is \"EMERGENCY PRIVATE CALL\" associated with the call type
control state machine.
4) shall send the PRIVATE CALL SETUP REQUEST message towards other MCPTT
client according to rules and procedures as specified in subclause 11.2.1.1.1;
5) shall start timer TFP1 (private call request retransmission); and
6) shall remain in the \"P2: waiting for call response\" state.
[TS 24.379, clause 11.2.2.4.2.4]
In the \"P2: waiting for call response\" state, when timer TFP1 (private call
request retransmission) expires and the value of the counter CFP1 (private
call request retransmission) is equal to the upper limit and the stored
commencement mode is \"AUTOMATIC COMMENCEMENT MODE\", the MCPTT client:
1) shall start timer TFP7 (waiting for any message with same call identifier);
and
2) shall enter the \"P1: ignoring same call id\" state.
[TS 24.379, clause 11.2.2.4.2.8]
When in the \"P2: waiting for call response\" state, upon receiving a PRIVATE
CALL ACCEPT message response to PRIVATE CALL SETUP REQUEST message with the
same call identifier, the MCPTT client:
1) shall store the SDP answer IE received in the PRIVATE CALL ACCEPT message
as answer SDP;
2) shall generate a PRIVATE CALL ACCEPT ACK message as specified in subclause
15.1.11:
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller ID; and
c) shall set the MCPTT user ID of the callee IE with the stored callee ID.
3) shall send the PRIVATE CALL ACCEPT ACK message in response to the request
message according to rules and procedures as specified in subclause
11.2.1.1.1;
4) shall stop timer TFP1 (call setup retransmission), if running;
5) shall stop timer TFP2 (waiting for call response message), if running;
6) shall establish a media session based on the SDP body of the stored answer
SDP;
7) shall start floor control as terminating floor participant as specified in
subclause 7.2 in 3GPP TS 24.380 [5];
8) shall start timer TFP5 (max duration); and
9) shall enter the \"P4: part of ongoing call\" state.
[TS 24.379, clause 11.2.2.4.5.7]
When in the \"P1: ignoring same call id\" state, upon expiry of timer TFP7
(waiting for any message with same call identifier) the MCPTT client:
1) shall clear the stored call identifier; and
2) shall enter the \"P0: start-stop\" state.
[TS 24.380, clause 7.1]
In off-network, floor control is performed using floor control messages among
the MCPTT clients without a centralized floor arbitrator. When off-network, if
a floor control session is active, the floor arbitrator and the floor
participant are co-located in the MCPTT client (see 3GPP TS 23.179 [5]).
During a floor control session the MCPTT client currently speaking serves as
the temporary floor arbitrator. All other MCPTT clients in the call play the
role of floor participant. When the floor arbitrator grants the floor to
another MCPTT client, that new MCPTT client, when starts to send media,
becomes the new floor arbitrator and the former (the MCPTT client which
granted the floor) becomes a floor participant.
...
It is assumed that the MCPTT user presses the PTT for requesting talk
permission and it keeps it pressed until the request is resolved. If queuing
of floor requests is not supported, this request is either granted or rejected
or no answer is received. If the request is granted the user is notified with
talk permission tone (or equivalent) and the user continues to press the PTT
until it finishes the talk burst. If the request is rejected or no answer is
received the user is notified and releases the PTT button.
[TS 24.380, clause 7.2.3.2.2]
When an MCPTT call is established with session announcement including an
explicit floor request, the originating floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. shall send Floor Granted message towards other floor participants. The
Floor Granted message:
a. shall include the granted priority in the Floor priority field;
b. shall include the MCPTT user\'s own MCPTT ID in the User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
3\. shall set the stored SSRC of the current floor arbitrator to its own SSRC;
and
4\. shall enter \'O: has permission\' state.
[TS 24.380, clause 7.2.3.5.2]
Upon receiving encoded media from the user or if encoded media is already
buffered the floor participant:
1\. shall start timer T206 (Stop talking warning), if not running;
2\. shall request the MCPTT client to start sending RTP media packets towards
other MCPTT clients; and
3\. shall remain in \'O: has permission\' state.
[TS 24.380, clause 7.2.3.4.2]
If the floor participant receives an indication from the MCPTT user that the
MCPTT user wants to send media, the floor participant:
1\. shall send the Floor Request message to other clients. The Floor Request
message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID of the MCPTT user in the User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall initialize the counter C201 (Floor request) with value set to 1;
3\. shall start timer T201 (Floor Request); and
4\. shall enter \'O: pending request\' state.
[TS 24.380, clause 7.2.3.5.4]
Upon receiving a Floor Request message which is not pre-emptive as determined
by subclause 4.1.1.5, in a session where:
1\. the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in the
group configuration as specified in 3GPP TS 24.383 [4] is set to \"false\"; or
2\. the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in the
group configuration as specified in 3GPP TS 24.383 [4] is set to \"true\" but
the F-bit in the Floor Indicator field is set to \'0\' (i.e. indicating that
queuing of floor requests is not supported) or the Floor Indicator field is
not included in the Floor Request message;
then the floor participant:
1\. shall send the Floor Deny message. The Floor Deny message:
a. shall include in the Reject Cause field the \ value cause #1
(Another MCPTT client has permission);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value; and
c. shall include the User ID field received in the Floor Request message; and
2\. shall remain in \'O: has permission\' state.
[TS 24.380, clause 7.2.3.5.5]
Upon receiving an indication from the MCPTT user to release permission to send
RTP media, the floor participant:
1\. shall stop timer T206 (Stop talking warning), if running;
2\. shall stop timer T207 (Stop talking), if running;
3\. shall send a Floor Release message towards other floor participants, if no
queued requests exist: The Floor Release message:
a. shall include the MCPTT ID of the MCPTT user in the User ID field; and
b. if the session is not initiated as a broadcast group call with the B-bit
set to \'1\' (Broadcast group call), shall include a Floor Indicator field set
to \'0\' (normal call);
4\. shall start timer T230 (Inactivity);
5\. shall clear the stored SSRC of the current arbitrator; and
6\. shall enter \'O: silence\' state.
[TS 24.380, clause 7.2.3.4.3]
When a Floor Release message is received and if the SSRC in the Floor Release
message matches with the stored SSRC of the current arbitrator or with the
stored SSRC of the candidate arbitrator, the floor participant:
1\. may provide floor idle notification to the MCPTT user.
2\. shall request the MCPTT client to stop rendering received RTP media
packets;
3\. shall stop timer T203 (End of RTP media);
4\. shall start timer T230 (Inactivity);
5\. shall clear the stored SSRC of the candidate arbitrator;
6\. shall clear the stored SSRC of the current arbitrator; and
7\. shall enter \'O: silence\' state;
[TS 24.380, clause 7.2.3.3.2]
If the floor participant receives an indication from the MCPTT user to send
media, the floor participant:
1\. shall send the Floor Request message to other floor participants. The
Floor Request message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID of the MCPTT user in the \ value of the
User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall initialize the counter C201 (Floor request) with value set to 1;
3\. shall stop timer T230 (Inactivity);
4\. shall start timer T201 (Floor Request); and
5\. shall enter \'O: pending request\' state.
[TS 24.380, clause 7.2.3.3.5]
The transition is used in private call only. When a Floor Request message is
received, the floor participant:
1\. shall send a Floor Granted message toward the other floor participant. The
Floor Granted message:
a. shall include the MCPTT ID of the Floor Request message received in User ID
value of the User ID field;
b. shall include the SSRC of the Floor Request message received in the SSRC of
floor control server field;
c. shall include the max duration as configured in the MCPTT client in the
OffNetwork/MaxDuration parameter in the \ value of the Duration
field; and
d. shall include the priority of the Floor Request message received in the
\ value of the Floor Priority field;
2\. shall stop timer T230 (Inactivity);
3\. shall start timer T205 (Floor Granted ); and
4\. shall enter \'O: pending granted\' state.
[TS 24.380, clause 7.2.3.7.2]
Upon receiving the RTP media and the SSRC of RTP media packet matches with the
stored SSRC of current arbitrator, the floor participant:
1\. shall request the MCPTT client to render the received RTP media packets;
2\. shall stop timer T205 (Floor Granted), if running;
3\. shall stop timer T233 (Pending user action), if running;
4\. shall start timer T203 (End of RTP media); and
5\. shall enter \'O: has no permission\' state.
[TS 24.379, clause 11.2.3.4.5.1]
When in the \"Q1: in-progress private call\" state, upon an indication from
MCPTT User to upgrade the call to emergency and the value of \"/_\ _/_\
_/Common/PrivateCall/EmergencyCall/Authorised\" leaf node present in the
user profile as specified in 3GPP TS 24.383 [45] is set to \"true\", the MCPTT
client:
1) shall generate and store emergency offer SDP as defined in subclause
11.2.1.1.2;
2) shall update caller ID as own MCPTT user ID;
3) shall update callee ID as MCPTT user ID of the other user;
4) shall store current user location as user location;
5) shall set the stored current call type to \"EMERGENCY PRIVATE CALL\";
6) shall generate a PRIVATE CALL SETUP REQUEST message as specified in
subclause 15.1.5. In the PRIVATE SETUP REQUEST message, the MCPTT client:
a) shall set the Call identifier IE with the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with stored caller ID;
c) shall set the MCPTT user ID of the callee IE with the stored callee ID;
d) shall set the Commencement mode IE as \"AUTOMATIC COMMENCEMENT MODE\";
e) shall set the Call type IE to the stored current call type;
f) shall set the SDP offer IE with emergency offer SDP; and
g) may set the User location IE with user location.
7) shall set the ProSe per-packet priority to the value corresponding to MCPTT
off-network emergency private call as described in 3GPP TS 24.383 [45];
8) shall send the PRIVATE CALL SETUP REQUEST message towards other MCPTT
client according to rules and procedures as specified in subclause 11.2.1.1.1;
9) shall initialize the counter CFP1 (private call request retransmission)
with value set to 1;
10) shall start timer TFP1 (private call request retransmission); and
11) shall enter the \"Q2: in-progress emergency private call\" state.
[TS 24.379, clause 11.2.3.4.6.1]
When in the \"Q2: in-progress emergency private call\" state, upon an
indication from:
1) the caller of the emergency private call; or
...
to cancel the emergency private call, the MCPTT client:
1) shall generate a PRIVATE CALL EMERGENCY CANCEL message as specified in
subclause 15.1.12. In the PRIVATE CALL EMERGENCY CANCEL message, the MCPTT
client:
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller; and
c) shall set the MCPTT user ID of the callee IE with the stored callee.
2) shall send the PRIVATE CALL EMERGENCY CANCEL message according to rules and
procedures as specified in subclause 11.2.1.1.1;
3) shall stop TFP8 (implicit downgrade) timer;
4) shall initialize the counter CFP6 (emergency private call cancel
retransmission) with the value set to 1;
5) shall start timer TFP6 (emergency private call cancel retransmission);
6) shall set the stored current call type to \"PRIVATE CALL\"; and
7) shall enter the \"Q1: in-progress private call\" state.
[TS 24.379, clause 11.2.3.4.6.3]
When in the \"Q1: in-progress private call\" state, upon receiving a PRIVATE
CALL EMERGENCY CANCEL ACK message response to PRIVATE CALL EMERGENCY CANCEL
message with the same \"call identifier\", the MCPTT client:
1) shall stop timer TFP6 (emergency private call cancel retransmission), if
running;
2) shall establish a media session based on the SDP body of the stored answer
SDP;
3) shall set the ProSe per-packet priority to the value corresponding to MCPTT
off-network private call as described in 3GPP TS 24.383 [45]; and
4) shall remain in the \"Q1: in-progress private call\" state.
[TS 24.379, clause 11.2.2.4.5.1]
When in the \"P4: part of ongoing call\" state, upon an indication from MCPTT
User to release a private call, the MCPTT client:
1) shall generate a PRIVATE CALL RELEASE message as specified in subclause
15.1.9. In the PRIVATE CALL RELEASE message, the MCPTT client:
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with stored caller ID; and
c) shall set the MCPTT user ID of the callee IE with stored callee ID.
2) shall send the PRIVATE CALL RELEASE message in response to the request
message according to rules and procedures as specified in subclause
11.2.1.1.1;
3) shall initialize the counter CFP3 (private call release retransmission)
with the value set to 1;
4) shall start timer TFP3 (private call release retransmission); and
5) shall enter the \"P3: waiting for release response\" state.
[TS 24.379, clause 11.2.2.4.5.5]
When in the \"P3: waiting for release response\" state, upon receiving a
PRIVATE CALL RELEASE ACK to PRIVATE CALL RELEASE message, the MCPTT client:
1) shall stop timer TFP3 (private call release retransmission), if running;
2) shall terminate the media session;
3) shall start timer TFP7 (waiting for any message with same call identifier);
4) shall release the call type control state machine; and
5) shall enter the \"P1: ignoring same call id\" state.
##### 7.2.1.3 Test description {#test-description-87 .H6}
##### 7.2.1.3.1 Pre-test conditions {#pre-test-conditions-87 .H6}
##### System Simulator: {#system-simulator-87 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server) in the Preamble
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-87 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-87 .H6}
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is Switched OFF (state 1) according to TS 36.508 [24].
##### 7.2.1.3.2 Test procedure sequence {#test-procedure-sequence-87 .H6}
Table 7.2.1.3.2-1: Main behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1A | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Activate | - | - | - | - | | | the MCPTT | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px | | | | | | | _MCPTT_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | px\ | | | | | | | _MCPTT_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of an | | | | | | | MCPTT | | | | | | | private | | | | | | | call, | | | | | | | on-demand | | | | | | | Automatic | | | | | | | Com | | | | | | | mencement | | | | | | | Mode, | | | | | | | with | | | | | | | Floor | | | | | | | Control. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.5 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverag | | | | | | | e-establi | | | | | | | shment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps 4-6 | | | | | | | are | | | | | | | repeated | | | | | | | CFP1=3 | | | | | | | times | | | | | | | (CFP1 | | | | | | | defined | | | | | | | in | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.1-1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | Check: | --> | PRIVATE | 1,2 | P | | | Does the | | CALL | | | | | UE (MCPTT | | SETUP | | | | | client) | | REQUEST | | | | | send a | | | | | | | PRIVATE | | | | | | | CALL | | | | | | | SETUP | | | | | | | REQUEST, | | | | | | | Com | | | | | | | mencement | | | | | | | mode set | | | | | | | to | | | | | | | AUTOMATIC | | | | | | | COM | | | | | | | MENCEMENT | | | | | | | MODE, | | | | | | | Call type | | | | | | | set to | | | | | | | Private | | | | | | | Call? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFP1 | | | | | | | (private | | | | | | | call | | | | | | | request | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 | | | | | | | | | | | | | | on the | | | | | | | first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFP1 | | | | | | | (private | | | | | | | call | | | | | | | request | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | Start | - | - | - | - | | | TFP1 | | | | | | | (private | | | | | | | call | | | | | | | request | | | | | | | retran | | | | | | | smission) | | | | | | | 2000 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | TFP1 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13 | Start | - | - | - | - | | | TFP7 | | | | | | | (waiting | | | | | | | for any | | | | | | | message | | | | | | | with same | | | | | | | call | | | | | | | id | | | | | | | entifier) | | | | | | | 6 sec | | | | | | | (value | | | | | | | chosen to | | | | | | | f | | | | | | | acilitate | | | | | | | the test | | | | | | | sequence | | | | | | | in steps | | | | | | | 14-16) | | | | | | | and | | | | | | | defined | | | | | | | in | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .5.8.1-1. | | | | | | | | | | | | | | NOTE: | | | | | | | TFP7 is | | | | | | | expected | | | | | | | to be | | | | | | | started | | | | | | | after | | | | | | | TFP1 | | | | | | | expires | | | | | | | and CFP1 | | | | | | | is equal | | | | | | | to the | | | | | | | upper | | | | | | | limit. | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | considers | | | | | | | at this | | | | | | | moment of | | | | | | | time the | | | | | | | Private | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | attempt | | | | | | | as failed | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 14 | SS-UE1 | \ | PRIVATE | 2 | F | | | Does the | | CALL | | | | | UE (MCPTT | | ACCEPT | | | | | client) | | ACK | | | | | send a | | | | | | | PRIVATE | | | | | | | CALL | | | | | | | ACCEPT | | | | | | | ACK? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15b1 | Check: | - | - | 2 | P | | | Does the | | | | | | | TFP7 | | | | | | | (waiting | | | | | | | for any | | | | | | | message | | | | | | | with same | | | | | | | call | | | | | | | id | | | | | | | entifier) | | | | | | | expire? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16 | Void. | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverag | | | | | | | e-release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 17 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | request | | | | | | | the | | | | | | | esta | | | | | | | blishment | | | | | | | of an | | | | | | | MCPTT | | | | | | | private | | | | | | | call, | | | | | | | on-demand | | | | | | | Automatic | | | | | | | Com | | | | | | | mencement | | | | | | | Mode, | | | | | | | with | | | | | | | Floor | | | | | | | Control. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCPTT | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.5 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverag | | | | | | | e-establi | | | | | | | shment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 18 | Check: | --> | PRIVATE | 1 | P | | | Does the | | CALL | | | | | UE (MCPTT | | SETUP | | | | | client) | | REQUEST | | | | | send a | | | | | | | PRIVATE | | | | | | | CALL | | | | | | | SETUP | | | | | | | REQUEST, | | | | | | | Com | | | | | | | mencement | | | | | | | mode set | | | | | | | to | | | | | | | AUTOMATIC | | | | | | | COM | | | | | | | MENCEMENT | | | | | | | MODE, | | | | | | | Call type | | | | | | | set to | | | | | | | Private | | | | | | | Call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 19 | SS-UE1 | \ | PRIVATE | 3 | P | | | Does the | | CALL | | | | | UE (MCPTT | | ACCEPT | | | | | client) | | ACK | | | | | send a | | | | | | | PRIVATE | | | | | | | CALL | | | | | | | ACCEPT | | | | | | | ACK? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 21 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | press the | | | | | | | PTT | | | | | | | button | | | | | | | r | | | | | | | equesting | | | | | | | p | | | | | | | ermission | | | | | | | to talk. | | | | | | | | | | | | | | NOTE 1: | | | | | | | Depending | | | | | | | on UE | | | | | | | imple | | | | | | | mentation | | | | | | | the PTT | | | | | | | button | | | | | | | may | | | | | | | already | | | | | | | been | | | | | | | pressed | | | | | | | in step | | | | | | | 17. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The UE | | | | | | | (MCPTT | | | | | | | User) | | | | | | | shall | | | | | | | keep the | | | | | | | button | | | | | | | pressed | | | | | | | until | | | | | | | otherwise | | | | | | | written. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 22 | Check: | --> | Floor | 4 | P | | | Does the | | Granted | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send | | | | | | | Floor | | | | | | | Granted | | | | | | | message, | | | | | | | Floor | | | | | | | Indicator | | | | | | | set to | | | | | | | Normal | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 23 | SS-UE1 | \ | Floor | 4 | P | | | Does the | | Deny | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send | | | | | | | Floor | | | | | | | Deny | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 25 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | release | | | | | | | the PTT | | | | | | | button. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 26 | Check: | --> | Floor | 4 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send | | | | | | | Floor | | | | | | | Release | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 27 | SS-UE1 | \ | Floor | 4 | P | | | Does the | | Granted | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send | | | | | | | Floor | | | | | | | Granted | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 29 | SS | - | - | - | - | | | con | | | | | | | tinuously | | | | | | | sends RTP | | | | | | | media | | | | | | | until | | | | | | | step 34 | | | | | | | below. | | | | | | | | | | | | | | NOTE: The | | | | | | | UE | | | | | | | (Client) | | | | | | | needs to | | | | | | | receive | | | | | | | RTP media | | | | | | | because | | | | | | | otherwise | | | | | | | the | | | | | | | sending | | | | | | | of Floor | | | | | | | Deny in | | | | | | | step 32 | | | | | | | will not | | | | | | | be a | | | | | | | valid | | | | | | | b | | | | | | | ehaviour. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 30 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | press the | | | | | | | PTT | | | | | | | button | | | | | | | r | | | | | | | equesting | | | | | | | p | | | | | | | ermission | | | | | | | to talk. | | | | | | | | | | | | | | NOTE: The | | | | | | | UE (MCPTT | | | | | | | User) | | | | | | | shall | | | | | | | keep the | | | | | | | button | | | | | | | pressed | | | | | | | until | | | | | | | otherwise | | | | | | | written. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 31 | Check: | --> | Floor | 4 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send | | | | | | | Floor | | | | | | | Request | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 32 | SS-UE1 | \ | Floor | 4 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send | | | | | | | Floor | | | | | | | Request | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 37 | SS-UE1 | \ | Floor | 4 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send | | | | | | | Floor | | | | | | | Release | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 40 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | request | | | | | | | upgrade | | | | | | | of the | | | | | | | ongoing | | | | | | | call to | | | | | | | Emergency | | | | | | | call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 41 | Check: | --> | PRIVATE | 5 | P | | | Does the | | CALL | | | | | UE (MCPTT | | SETUP | | | | | client) | | REQUEST | | | | | send | | | | | | | PRIVATE | | | | | | | CALL | | | | | | | SETUP | | | | | | | REQUEST | | | | | | | message, | | | | | | | Call type | | | | | | | set to | | | | | | | EMERGENCY | | | | | | | PRIVATE | | | | | | | CALL? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 42 | SS-UE1 | \ | PRIVATE | 5 | P | | | Does the | | CALL | | | | | UE (MCPTT | | ACCEPT | | | | | client) | | ACK | | | | | send | | | | | | | PRIVATE | | | | | | | CALL | | | | | | | ACCEPT | | | | | | | ACK | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 44 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) to | | | | | | | press the | | | | | | | PTT | | | | | | | button | | | | | | | r | | | | | | | equesting | | | | | | | p | | | | | | | ermission | | | | | | | to talk. | | | | | | | | | | | | | | NOTE 1: | | | | | | | Depending | | | | | | | on UE | | | | | | | imple | | | | | | | mentation | | | | | | | the PTT | | | | | | | button | | | | | | | may | | | | | | | already | | | | | | | been | | | | | | | pressed | | | | | | | in step | | | | | | | 40. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The UE | | | | | | | (MCPTT | | | | | | | User) | | | | | | | shall | | | | | | | keep the | | | | | | | button | | | | | | | pressed | | | | | | | until | | | | | | | otherwise | | | | | | | written. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 45 | Check: | --> | Floor | 5,4 | P | | | Does the | | Granted | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send | | | | | | | Floor | | | | | | | Request | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 46 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 47 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) to | | | | | | | release | | | | | | | the PTT | | | | | | | button. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 48 | Check: | --> | Floor | 5,4 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send | | | | | | | Floor | | | | | | | Release | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 49 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | request | | | | | | | downgrade | | | | | | | of the | | | | | | | ongoing | | | | | | | Emergency | | | | | | | call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 50 | Check: | --> | PRIVATE | 6 | P | | | Does the | | CALL | | | | | UE (MCPTT | | EMERGENCY | | | | | client) | | CANCEL | | | | | send | | | | | | | PRIVATE | | | | | | | CALL | | | | | | | EMERGENCY | | | | | | | CANCEL | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 51 | SS-UE1 | \ | Floor | 6,4 | P | | | Does the | | Request | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send | | | | | | | Floor | | | | | | | Request | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 54 | SS-UE1 | \ | Floor | 6,4 | P | | | Does the | | Release | | | | | UE (MCPTT | | | | | | | client) | | | | | | | send | | | | | | | Floor | | | | | | | Release | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 57 | Make the | - | - | - | - | | | UE (MCPTT | | | | | | | User) | | | | | | | request | | | | | | | te | | | | | | | rmination | | | | | | | of the | | | | | | | MCPTT | | | | | | | private | | | | | | | call. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 58 | Check: | --> | PRIVATE | 7 | P | | | Does the | | CALL | | | | | UE (MCPTT | | RELEASE | | | | | client) | | | | | | | send | | | | | | | PRIVATE | | | | | | | CALL | | | | | | | RELEASE | | | | | | | message? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 59 | SS-UE1 | \ portion set to a dash;
b) the \"s=\" field with the \ portion set to a dash; and
c) the \"c=\" field with the \ portion set to \"IN\", the \
portion set to the IP version of the unicast IP address of the MCPTT client
and the \ portion set to the unicast IP address of the
MCPTT client;
2) shall include the media-level section for MCPTT speech consisting of:
a) the \"m=\" field with the \ portion set to \"audio\", the \
portion set to a port number for MCPTT speech of the MCPTT group, the \
field set to \"RTP/AVP\" and \ portion set indicating RTP payload type
numbers;
b) the \"i=\" field with the \ portion set to \"speech\";
c) the \"a=fmtp:\" attribute(s), the \"a=rtpmap:\" attribute(s) or both,
indicating the codec(s) and media parameters of the MCPTT speech; and
d) the \"a=rtcp:\" attribute indicating port number to be used for RTCP at the
MCPTT client selected according to the rules and procedures of IETF RFC 3605
[13], if the media steam uses other than the default IP address;
3) shall include the media-level section for media-floor control entity
consisting of:
a) an \"m=\" line, with the \ portion set to \"application\", the
\ portion set to a port number for media-floor control entity of the
MCPTT group, the \ field set to \"udp\" and \ portion set to
\"MCPTT\"; and
b) the \"a=fmtp:MCPTT\" attribute indicating the parameters of the media-floor
control entity as specified 3GPP TS 24.380 [5]; and
4) shall include the MIKEY-SAKKE I_MESSAGE, if generated by the MCPTT client,
in an \"a=key-mgmt\" attribute as a \"mikey\" attribute value in the SDP offer
as specified in IETF RFC 4567 [47].
[TS 24.379, clause 11.2.2.4.3.2]
When in the \"P0: start-stop\" or \"P1: ignoring same call id\" state, upon
receiving a PRIVATE CALL SETUP REQUEST message with Commencement mode IE set
to \"AUTOMATIC COMMENCEMENT MODE\" and Call identifier IE different than
stored call identifier and media session declared in SDP body of PRIVATE CALL
SETUP REQUEST message can be established, the MCPTT client:
1) shall store the Call identifier IE in the received message as call
identifier;
2) shall create the call type control state machine as described in subclause
11.2.3.2;
3) shall store the MCPTT user ID of the caller IE in the received PRIVATE CALL
SETUP REQUEST message as caller ID;
4) shall store own MCPTT user ID as callee ID;
5) if the SDP offer contains an \"a=key-mgmt\" attribute field with a
\"mikey\" attribute value containing a MIKEY-SAKKE I_MESSAGE:
a) shall extract the MCPTT ID of the originating MCPTT user from the initiator
field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.179 [46];
b) shall convert the MCPTT ID to a UID as described in 3GPP TS 33.179 [46];
c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as
described in 3GPP TS 33.179 [46];
...
e) if the validation of the signature was successful:
i) shall extract and decrypt the encapsulated PCK using the terminating
user\'s (KMS provisioned) UID key as described in 3GPP TS 33.179 [46];
ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS 33.179
[46];
iii) shall generate and store answer SDP based on received SDP offer IE in
PRIVATE CALL SETUP REQUEST message, as defined in subclause 11.2.1.1.2;
iv) shall generate a PRIVATE CALL ACCEPT message as specified in subclause
15.1.7. In the PRIVATE CALL ACCEPT message, the MCPTT client:
A) shall set the Call identifier IE to the stored call identifier; and
B) shall set the MCPTT user ID of the caller IE with stored caller ID.
C) shall set the MCPTT user ID of the callee IE with stored callee ID; and
D) shall set the SDP answer IE with the stored answer SDP;
v) shall send PRIVATE CALL ACCEPT message in response to the request message
according to rules and procedures as specified in subclause 11.2.1.1.1;
vi) shall establish a media session based on the SDP body of the stored answer
SDP;
vii) shall initialize the counter CFP4 with value set to 1;
viii) shall start timer TFP4 (private call accept retransmission); and
ix) shall enter the \"P5: pending\" state; and
NOTE: With the PCK successfully shared between the originating MCPTT client
and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to
create an end-to-end secure session.
6) if the SDP offer does not contain an \"a=key-mgmt\" attribute, the MCPTT
client:
a) shall generate and store answer SDP based on received SDP offer IE in
PRIVATE CALL SETUP REQUEST message, as defined in subclause 11.2.1.1.2;
b) shall generate a PRIVATE CALL ACCEPT message as specified in subclause
15.1.7:
i) shall set the Call identifier IE to the stored call identifier;
ii) shall set the MCPTT user ID of the caller IE with stored caller ID.
iii) shall set the MCPTT user ID of the callee IE with stored callee ID; and
iv) shall set the SDP answer IE with the stored answer SDP;
c) shall send PRIVATE CALL ACCEPT message in response to the request message
according to rules and procedures as specified in subclause 11.2.1.1.1;
d) shall establish a media session based on the SDP body of the stored answer
SDP;
e) shall initialize the counter CFP4 with value set to 1;
f) shall start timer TFP4 (private call accept retransmission); and
g) shall enter the \"P5: pending\" state.
[TS 24.379, clause 11.2.2.4.3.3]
When in the \"P5: pending\" state, upon expiry of timer TFP4 (private call
accept retransmission), the MCPTT client:
1) shall generate a PRIVATE CALL ACCEPT message as specified in subclause
15.1.7. In the PRIVATE CALL ACCEPT message, the MCPTT client:
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller ID;
c) shall set the MCPTT user ID of the callee IE with the stored callee ID; and
d) shall set the SDP answer IE with the stored answer SDP;
2) shall send PRIVATE CALL ACCEPT message in response to the request message
according to rules and procedures as specified in subclause 11.2.1.1.1;
3) shall increment the value of the counter CFP4 (private call accept
retransmission) by 1;
4) shall start timer TFP4 (private call accept retransmission); and
5) shall remain in the \"P5: pending\" state.
[TS 24.379, clause 11.2.2.4.3.5]
In the \"P5: pending\" state, when timer TFP4 (private call accept
retransmission) expires and the value of the counter CFP4 (private call accept
retransmission) is equal to the upper limit, the MCPTT client:
1) shall start timer TFP7 (waiting for any message with same call identifier);
2) shall release the call type control state machine; and
3) shall enter the \"P1: ignoring same call id\" state.
[TS 24.379, clause 11.2.2.4.3.4]
When in the \"P5: pending\" state, upon receiving a PRIVATE CALL ACCEPT ACK
message or RTP media from originating user, the MCPTT client:
1) shall stop timer TFP4(private call accept retransmission);
2) shall start floor control as terminating MCPTT client as specified in
subclause 7.2 in 3GPP TS 24.380 [5];
3) shall start timer TFP5 (max duration); and
4) shall enter the \"P4: part of ongoing call\" state.
[TS 24.379, clause 11.2.2.4.5.7]
When in the \"P1: ignoring same call id\" state, upon expiry of timer TFP7
(waiting for any message with same call identifier) the MCPTT client:
1) shall clear the stored call identifier; and
2) shall enter the \"P0: start-stop\" state.
[TS 24.380, clause 7.1]
In off-network, floor control is performed using floor control messages among
the MCPTT clients without a centralized floor arbitrator. When off-network, if
a floor control session is active, the floor arbitrator and the floor
participant are co-located in the MCPTT client (see 3GPP TS 23.179 [5]).
During a floor control session the MCPTT client currently speaking serves as
the temporary floor arbitrator. All other MCPTT clients in the call play the
role of floor participant. When the floor arbitrator grants the floor to
another MCPTT client, that new MCPTT client, when starts to send media,
becomes the new floor arbitrator and the former (the MCPTT client which
granted the floor) becomes a floor participant.
...
It is assumed that the MCPTT user presses the PTT for requesting talk
permission and it keeps it pressed until the request is resolved. If queuing
of floor requests is not supported, this request is either granted or rejected
or no answer is received. If the request is granted the user is notified with
talk permission tone (or equivalent) and the user continues to press the PTT
until it finishes the talk burst. If the request is rejected or no answer is
received the user is notified and releases the PTT button.
[TS 24.380, clause 7.2.3.4.2]
If the floor participant receives an indication from the MCPTT user that the
MCPTT user wants to send media, the floor participant:
1\. shall send the Floor Request message to other clients. The Floor Request
message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID of the MCPTT user in the User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall initialize the counter C201 (Floor request) with value set to 1;
3\. shall start timer T201 (Floor Request); and
4\. shall enter \'O: pending request\' state.
[TS 24.380, clause 7.2.3.5.4]
Upon receiving a Floor Request message which is not pre-emptive as determined
by subclause 4.1.1.5, in a session where:
1\. the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in the
group configuration as specified in 3GPP TS 24.383 [4] is set to \"false\"; or
2\. the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in the
group configuration as specified in 3GPP TS 24.383 [4] is set to \"true\" but
the F-bit in the Floor Indicator field is set to \'0\' (i.e. indicating that
queuing of floor requests is not supported) or the Floor Indicator field is
not included in the Floor Request message;
then the floor participant:
1\. shall send the Floor Deny message. The Floor Deny message:
a. shall include in the Reject Cause field the \ value cause #1
(Another MCPTT client has permission);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value; and
c. shall include the User ID field received in the Floor Request message; and
2\. shall remain in \'O: has permission\' state.
[TS 24.380, clause 7.2.3.5.5]
Upon receiving an indication from the MCPTT user to release permission to send
RTP media, the floor participant:
1\. shall stop timer T206 (Stop talking warning), if running;
2\. shall stop timer T207 (Stop talking), if running;
3\. shall send a Floor Release message towards other floor participants, if no
queued requests exist: The Floor Release message:
a. shall include the MCPTT ID of the MCPTT user in the User ID field; and
b. if the session is not initiated as a broadcast group call with the B-bit
set to \'1\' (Broadcast group call), shall include a Floor Indicator field set
to \'0\' (normal call);
4\. shall start timer T230 (Inactivity);
5\. shall clear the stored SSRC of the current arbitrator; and
6\. shall enter \'O: silence\' state.
[TS 24.380, clause 7.2.3.4.3]
When a Floor Release message is received and if the SSRC in the Floor Release
message matches with the stored SSRC of the current arbitrator or with the
stored SSRC of the candidate arbitrator, the floor participant:
1\. may provide floor idle notification to the MCPTT user.
2\. shall request the MCPTT client to stop rendering received RTP media
packets;
3\. shall stop timer T203 (End of RTP media);
4\. shall start timer T230 (Inactivity);
5\. shall clear the stored SSRC of the candidate arbitrator;
6\. shall clear the stored SSRC of the current arbitrator; and
7\. shall enter \'O: silence\' state;
[TS 24.380, clause 7.2.3.3.2]
If the floor participant receives an indication from the MCPTT user to send
media, the floor participant:
1\. shall send the Floor Request message to other floor participants. The
Floor Request message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID of the MCPTT user in the \ value of the
User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall initialize the counter C201 (Floor request) with value set to 1;
3\. shall stop timer T230 (Inactivity);
4\. shall start timer T201 (Floor Request); and
5\. shall enter \'O: pending request\' state.
[TS 24.380, clause 7.2.3.3.5]
The transition is used in private call only. When a Floor Request message is
received, the floor participant:
1\. shall send a Floor Granted message toward the other floor participant. The
Floor Granted message:
a. shall include the MCPTT ID of the Floor Request message received in User ID
value of the User ID field;
b. shall include the SSRC of the Floor Request message received in the SSRC of
floor control server field;
c. shall include the max duration as configured in the MCPTT client in the
OffNetwork/MaxDuration parameter in the \ value of the Duration
field; and
d. shall include the priority of the Floor Request message received in the
\ value of the Floor Priority field;
2\. shall stop timer T230 (Inactivity);
3\. shall start timer T205 (Floor Granted ); and
4\. shall enter \'O: pending granted\' state.
[TS 24.380, clause 7.2.3.5.2]
Upon receiving encoded media from the user or if encoded media is already
buffered the floor participant:
1\. shall start timer T206 (Stop talking warning), if not running;
2\. shall request the MCPTT client to start sending RTP media packets towards
other MCPTT clients; and
3\. shall remain in \'O: has permission\' state.
[TS 24.380, clause 7.2.3.7.2]
Upon receiving the RTP media and the SSRC of RTP media packet matches with the
stored SSRC of current arbitrator, the floor participant:
1\. shall request the MCPTT client to render the received RTP media packets;
2\. shall stop timer T205 (Floor Granted), if running;
3\. shall stop timer T233 (Pending user action), if running;
4\. shall start timer T203 (End of RTP media); and
5\. shall enter \'O: has no permission\' state.
[TS 24.379, clause 11.2.3.4.5.6]
When in the \"Q1: in-progress private call\" state or \"Q2: in-progress
emergency private call\" state, upon receiving a PRIVATE CALL SETUP REQUEST
message with the Call identifier IE same as the stored call identifier of the
call, the Call type IE set as \"EMERGENCY PRIVATE CALL\", the MCPTT client:
1) if the media session declared in SDP body of PRIVATE CALL SETUP REQUEST
message can be established:
a) shall generate and store emergency answer SDP based on received SDP offer
IE in PRIVATE CALL SETUP REQUEST message, as defined in subclause 11.2.1.1.2;
b) shall update the caller ID with the MCPTT user ID of the caller IE as
received in the PRIVATE CALL SETUP REQUEST message;
c) shall update the callee ID with own MCPTT user ID;
d) shall generate a PRIVATE CALL ACCEPT message as specified in subclause
15.1.7:
i) shall set the Call identifier IE to the stored call identifier;
ii) shall set the MCPTT user ID of the callee IE with stored callee ID;
iii) shall set the MCPTT user ID of the caller IE with stored caller ID; and
iv) shall set the SDP answer IE with the stored emergency answer SDP;
e) shall set the ProSe per-packet priority to the value corresponding to MCPTT
off-network emergency private call as described in 3GPP TS 24.383 [45];
f) shall start TFP8 (implicit downgrade) timer;
g) shall send PRIVATE CALL ACCEPT message in response to the request message
according to rules and procedures as specified in subclause 11.2.1.1.1;
h) shall set the stored current call type to \"EMERGENCY PRIVATE CALL\"; and
i) shall enter the \"Q2: in-progress emergency private call\" state;
[TS 24.379, clause 11.2.3.4.6.5]
When in the \"Q1: in-progress private call\" state or \"Q2: in-progress
emergency private call\" state, upon receiving a PRIVATE CALL EMERGENCY CANCEL
message with the same \"call identifier\" IE, the MCPTT client:
1) shall generate a PRIVATE CALL EMERGENCY CANCEL ACK as specified in
subclause 15.1.13:
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the callee IE with own MCPTT user ID; and
c) shall set the MCPTT user ID of the caller IE with MCPTT user ID of the
caller IE in received message;
2) shall send PRIVATE CALL EMERGENCY CANCEL ACK message according to rules and
procedures as specified in subclause 11.2.1.1.1;
3) shall stop TFP8 (implicit downgrade) timer;
4) shall establish a media session based on the SDP body of the stored answer
SDP;
5) shall set the ProSe per-packet priority to the value corresponding to MCPTT
off-network private call as described in 3GPP TS 24.383 [45]; and
6) shall enter the \"Q1: in-progress private call\" state and set the stored
current call type to \"PRIVATE CALL\", if current state is the \"Q2: in-
progress emergency private call\" state.
[TS 24.379, clause 11.2.2.4.5.4]
When in the \"P4: part of ongoing call\" state, upon receiving a PRIVATE CALL
RELEASE message, the MCPTT client:
1) shall generate a PRIVATE CALL RELEASE ACK message as specified in subclause
15.1.10;
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the caller IE the stored caller ID; and
c) shall set the MCPTT user ID of the callee IE with the stored callee ID.
2) shall send the PRIVATE CALL RELEASE ACK message in response to the request
message according to rules and procedures as specified in subclause
11.2.1.1.1;
3) shall terminate the media session for private call;
4) shall start timer TFP7 (waiting for any message with same call identifier);
5) shall release the call type control state machine; and
6) shall enter the \"P1: ignoring same call id\" state.
##### 7.2.2.3 Test description {#test-description-88 .H6}
##### 7.2.2.3.1 Pre-test conditions {#pre-test-conditions-88 .H6}
##### System Simulator: {#system-simulator-88 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server) in the Preamble
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-88 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-88 .H6}
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is Switched OFF (state 1) according to TS 36.508 [24].
##### 7.2.2.3.2 Test procedure sequence {#test-procedure-sequence-88 .H6}
Table 7.2.2.3.2-1: Main behaviour
+-------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=======+=============+=============+=============+=========+====+ | | | U - S | Message | | | +-------+-------------+-------------+-------------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 1A | Trigger the | - | - | - | - | | | UE to reset | | | | | | | UTC time | | | | | | | and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT command | | | | | | | (+CUTCR). | | | | | +-------+-------------+-------------+-------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call | | | | | | | es | | | | | | | tablishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36. | | | | | | | 579-1 [2] | | | | | | | clause | | | | | | | 5.4.6 \'MCX | | | | | | | CT | | | | | | | co | | | | | | | mmunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | co | | | | | | | mmunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | cov | | | | | | | erage-estab | | | | | | | lishment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | exchanged. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 2 | Activate | - | - | - | - | | | the MCPTT | | | | | | | Client | | | | | | | Application | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px_MCP | | | | | | | TT_User_A | | | | | | | _username, | | | | | | | px_MCPT | | | | | | | T_User_A\ | | | | | | | _password). | | | | | | | | | | | | | | NOTE: This | | | | | | | is expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | imp | | | | | | | lementation | | | | | | | dependent | | | | | | | MMI. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 3 | SS-UE1 | \ | PRIVATE | 1,2 | P | | | the UE | | CALL ACCEPT | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | PRIVATE | | | | | | | CALL | | | | | | | ACCEPT? | | | | | | | | | | | | | | NOTE: It is | | | | | | | expected | | | | | | | that the UE | | | | | | | | | | | | | | - shall | | | | | | | initialize | | | | | | | the counter | | | | | | | CFP4 | | | | | | | (private | | | | | | | call accept | | | | | | | retr | | | | | | | ansmission) | | | | | | | with value | | | | | | | set to 1 on | | | | | | | the first | | | | | | | tr | | | | | | | ansmission, | | | | | | | and, | | | | | | | increase it | | | | | | | by 1 with | | | | | | | each | | | | | | | re-t | | | | | | | ransmission | | | | | | | | | | | | | | - shall | | | | | | | start timer | | | | | | | TFP4 | | | | | | | (private | | | | | | | call accept | | | | | | | retra | | | | | | | nsmission). | | | | | +-------+-------------+-------------+-------------+---------+----+ | 5 | Start TFP4 | - | - | - | - | | | (private | | | | | | | call accept | | | | | | | retr | | | | | | | ansmission) | | | | | | | 50 | | | | | | | m | | | | | | | illiseconds | | | | | | | as defined | | | | | | | in 36.579-1 | | | | | | | [2] Table | | | | | | | 5.5.8.1-1. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 6 | TFP4 | - | - | - | - | | | expires. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 10-12 | Void | - | - | - | - | +-------+-------------+-------------+-------------+---------+----+ | 13 | Start TFP7 | - | - | - | - | | | (waiting | | | | | | | for any | | | | | | | message | | | | | | | with same | | | | | | | call | | | | | | | identifier) | | | | | | | 6 sec | | | | | | | (value | | | | | | | chosen to | | | | | | | facilitate | | | | | | | the test | | | | | | | sequence in | | | | | | | steps | | | | | | | 14-17) and | | | | | | | defined in | | | | | | | 36.579-1 | | | | | | | [2] Table | | | | | | | 5.5.8.1-1. | | | | | | | | | | | | | | NOTE: TFP7 | | | | | | | is expected | | | | | | | to be | | | | | | | started | | | | | | | after TFP4 | | | | | | | expires and | | | | | | | CFP4 is | | | | | | | equal to | | | | | | | the upper | | | | | | | limit. | | | | | | | | | | | | | | NOTE: It is | | | | | | | expected | | | | | | | that the UE | | | | | | | considers | | | | | | | at this | | | | | | | moment of | | | | | | | time the | | | | | | | Private | | | | | | | call | | | | | | | es | | | | | | | tablishment | | | | | | | attempt as | | | | | | | failed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 14 | SS-UE1 | \ | Floor | 2 | F | | | the UE | | Request | | | | | (MCPTT | | | | | | | client) | | | | | | | sends a | | | | | | | Floor | | | | | | | Request | | | | | | | message | | | | | +-------+-------------+-------------+-------------+---------+----+ | 16b1 | Check: Does | - | - | 2 | P | | | the TFP7 | | | | | | | (waiting | | | | | | | for any | | | | | | | message | | | | | | | with same | | | | | | | call | | | | | | | identifier) | | | | | | | expire? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 17 | Make the UE | - | - | - | - | | | (MCPTT | | | | | | | User) | | | | | | | release the | | | | | | | PTT button. | | | | | +-------+-------------+-------------+-------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | SS releases | | | | | | | the E-UTRA | | | | | | | connection. | | | | | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call | | | | | | | release are | | | | | | | described | | | | | | | in | | | | | | | TS 36. | | | | | | | 579-1 [2] | | | | | | | clause | | | | | | | 5.4.7 \'MCX | | | | | | | CO | | | | | | | co | | | | | | | mmunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | co | | | | | | | mmunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | cover | | | | | | | age-release | | | | | | | by the | | | | | | | SS\'. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 18 | Wait for 5 | - | - | - | - | | | sec to | | | | | | | ensure the | | | | | | | UE is in | | | | | | | stable | | | | | | | state - | | | | | | | scanning | | | | | | | for | | | | | | | incoming | | | | | | | ProSe | | | | | | | messages. | | | | | +-------+-------------+-------------+-------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call | | | | | | | es | | | | | | | tablishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36. | | | | | | | 579-1 [2] | | | | | | | clause | | | | | | | 5.4.6 \'MCX | | | | | | | CT | | | | | | | co | | | | | | | mmunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | co | | | | | | | mmunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | cov | | | | | | | erage-estab | | | | | | | lishment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | exchanged. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 19 | SS-UE1 | \ | PRIVATE | 1 | P | | | the UE | | CALL ACCEPT | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | PRIVATE | | | | | | | CALL | | | | | | | ACCEPT? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 21 | SS-UE1 | \ | Floor | 3,4 | P | | | the UE | | Request | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 26 | SS-UE1 | \ | Floor | 4 | P | | | the UE | | Request | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 31 | SS-UE1 | \ | Floor Deny | 4 | P | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | send Floor | | | | | | | Deny | | | | | | | message? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 34 | Make the UE | - | - | - | - | | | (MCPTT | | | | | | | User) | | | | | | | release the | | | | | | | PTT button. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 35 | Check: Does | --> | Floor | 4 | P | | | the UE | | Release | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Release | | | | | | | message? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 36 | SS-UE1 | \ | Floor | 4 | P | | | the UE | | Granted | | | | | (MCPTT | | | | | | | client) | | | | | | | send Floor | | | | | | | Granted | | | | | | | message? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 38 | SS-UE1 | \ | PRIVATE | 5 | P | | | the UE | | CALL ACCEPT | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | PRIVATE | | | | | | | CALL | | | | | | | ACCEPT? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 41 | SS-UE1 | \ | Floor | 5,4 | P | | | the UE | | Request | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 46 | SS-UE1 | \ | Floor | 5,4 | P | | | the UE | | Release | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Release | | | | | | | message? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 49 | SS-UE1 | \ | PRIVATE | 6 | P | | | the UE | | CALL | | | | | (MCPTT | | EMERGENCY | | | | | client) | | CANCEL ACK | | | | | send a | | | | | | | PRIVATE | | | | | | | CALL | | | | | | | EMERGENCY | | | | | | | CANCEL ACK | | | | | | | message? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 51 | SS-UE1 | \ | Floor | 6,4 | P | | | the UE | | Request | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Request | | | | | | | message? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 55 | SS-UE1 | \ | Floor | 6,4 | P | | | the UE | | Release | | | | | (MCPTT | | | | | | | client) | | | | | | | send a | | | | | | | Floor | | | | | | | Release | | | | | | | message? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 58 | SS-UE1 | \ | PRIVATE | 7 | P | | | the UE | | CALL | | | | | (MCPTT | | RELEASE ACK | | | | | client) | | | | | | | send a | | | | | | | PRIVATE | | | | | | | CALL | | | | | | | RELEASE ACK | | | | | | | message | | | | | +-------+-------------+-------------+-------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | SS releases | | | | | | | the E-UTRA | | | | | | | connection. | | | | | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call | | | | | | | release are | | | | | | | described | | | | | | | in | | | | | | | TS 36. | | | | | | | 579-1 [2] | | | | | | | clause | | | | | | | 5.4.7 \'MCX | | | | | | | CO | | | | | | | co | | | | | | | mmunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | co | | | | | | | mmunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | cover | | | | | | | age-release | | | | | | | by the | | | | | | | SS\'. | | | | | +-------+-------------+-------------+-------------+---------+----+
##### 7.2.2.3.3 Specific message contents {#specific-message-contents-88 .H6}
Table 7.2.2.3.3-1: PRIVATE CALL SETUP REQUEST (Step 39, Table 7.2.2.3.2-1)
Derivation Path: 36.579-1 [2], Table 5.5.5.8.2-1.
* * *
Information Element Value/remark Comment Condition Call type \'00000110\'B
EMERGENCY PRIVATE CALL
Table 7.2.2.3.3-2: Floor Granted (Step 37, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | SSRC of granted | SS-UE1 (MCPTT | | | | floor | Client) SSRC | | | | participant | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | px_MCP | The MCPTT User | | | | TT_User_B_ID | ID of the one | | | | | simulated by | | | | | the SS | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000x00 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=x | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.3.3-3: Floor Granted (Steps 22, 51, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | SSRC of granted | SS-UE1 (MCPTT | | | | floor | Client) SSRC | | | | participant | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | px_MCP | The MCPTT User | | | | TT_User_B_ID | ID of the one | | | | | simulated by | | | | | the SS | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000100 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.3.3-3A: Floor Granted (Steps 31, 55, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000100 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.3.3-4: Floor Request (Steps 32, 36, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.2-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | px_MCP | The MCPTT User | | | | TT_User_B_ID | ID of the one | | | | | simulated by | | | | | the SS | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000100 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.3.3-5: Floor Request (Steps 25, 30, 54, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.2-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000x00 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=x | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.3.3-6: Floor Deny (Step 33, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.4-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | px_MCP | The MCPTT User | | | | TT_User_B_ID | ID of the one | | | | | simulated by | | | | | the SS | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000x00 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=x | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.3.3-7: Floor Deny (Step 26, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.4-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000100 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.3.3-8: Floor Release (Steps 35, 57, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.5-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000x00 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=x | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.3.3-9: Floor Release (Steps 28, 38, 52, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.5-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | px_MCP | The MCPTT User | | | | TT_User_B_ID | ID of the one | | | | | simulated by | | | | | the SS | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000100 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.3.3-10: Floor Request (Step 45, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.2-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'00010x00 | Bit D=1 | | | | 0000000 | (Emergency | | | | | call) | | | | | | | | | | bit F=x | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.3.3-11: Floor Granted (Step 42, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | SSRC of granted | SS-UE1 (MCPTT | | | | floor | Client) SSRC | | | | participant | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | px_MCP | The MCPTT User | | | | TT_User_B_ID | ID of the one | | | | | simulated by | | | | | the SS | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'00010100 | Bit D=1 | | | | 0000000 | (Emergency | | | | | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.3.3-11A: Floor Granted (Step 46, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'00010100 | Bit D=1 | | | | 0000000 | (Emergency | | | | | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.3.3-12: Floor Release (Step 48, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.5-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'00010x00 | Bit D=1 | | | | 0000000 | (Emergency | | | | | call) | | | | | | | | | | bit F=x | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.3.3-13: Floor Release (Step 43, Table 7.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.5-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | px_MCP | The MCPTT User | | | | TT_User_B_ID | ID of the one | | | | | simulated by | | | | | the SS | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'00010100 | Bit D=1 | | | | 0000000 | (Emergency | | | | | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
### 7.2.3 Off-network / Private Call / On-demand / Automatic Commencement Mode
/ Upgrade to Emergency Call Reject / Downgrade from Emergency Call Failure /
Client Originated (CO)
##### 7.2.3.1 Test Purpose (TP) {#test-purpose-tp-89 .H6}
##### (1) {#section-268 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate/cancel private and private emergency calls
with automatic commencement in off-network environment, and, the UE is in an
off-network environment, **and** , upon User request the UE (MCPTT Client) has
requested upgrade of an established Private Call to an Emergency Private call
}
**ensure that** {
**when** { the called Client rejects the upgrade requests }
**then** { UE (MCPTT Client) continues with the established Private call }
}
##### (2) {#section-269 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate/cancel private and private emergency calls
with automatic commencement in off-network environment, and, the UE is in an
off-network environment, **and** , upon User request the UE (MCPTT Client) has
requested downgrade of an Emergency Private call to a Private call }
**ensure that** {
**when** { the UE (MCPTT Client) does not receive response to the request
until the timer TFP6 (emergency private call cancel retransmission) expires }
**then** { UE (MCPTT Client) retransmits the PRIVATE CALL EMERGENCY CANCEL
message requesting the downgrade of the emergency private call if the counter
CFP6 (emergency private call cancel retransmission) has not reached its max
value and increments the counter CFP6 with one, **and** , stops re-
transmitting if the counter CFP1 (emergency private call cancel
retransmission) has reached its max value and considers the private call as
terminated }
}
##### 7.2.3.2 Conformance requirements {#conformance-requirements-89 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.2.3.4.5.4, 11.2.3.4.6.1, 11.2.3.4.6.2,
11.2.3.4.6.4, 11.2.2.4.5.9, 11.2.2.4.5.9. Unless otherwise stated these are
Rel-13 requirements.
[TS 24.379, clause 11.2.3.4.5.4]
When in the \"Q2: in-progress emergency private call\" state, upon receiving a
PRIVATE CALL REJECT message in response to PRIVATE CALL SETUP REQUEST message
with Call identifier IE same as stored call identifier, the MCPTT client:
1) shall stop timer TFP1 (call setup retransmission), if running;
2) shall set the ProSe per-packet priority to the value corresponding to the
MCPTT off-network private call as described in 3GPP TS 24.383 [45];
3) shall set the stored current call type to \"PRIVATE CALL\"; and
4) shall enter the \"Q1: in-progress private call\" state.
[TS 24.379, clause 11.2.3.4.6.1]
When in the \"Q2: in-progress emergency private call\" state, upon an
indication from:
1) the caller of the emergency private call; or
...
to cancel the emergency private call, the MCPTT client:
1) shall generate a PRIVATE CALL EMERGENCY CANCEL message as specified in
subclause 15.1.12. In the PRIVATE CALL EMERGENCY CANCEL message, the MCPTT
client:
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller; and
c) shall set the MCPTT user ID of the callee IE with the stored callee.
2) shall send the PRIVATE CALL EMERGENCY CANCEL message according to rules and
procedures as specified in subclause 11.2.1.1.1;
3) shall stop TFP8 (implicit downgrade) timer;
4) shall initialize the counter CFP6 (emergency private call cancel
retransmission) with the value set to 1;
5) shall start timer TFP6 (emergency private call cancel retransmission);
6) shall set the stored current call type to \"PRIVATE CALL\"; and
7) shall enter the \"Q1: in-progress private call\" state.
[TS 24.379, clause 11.2.3.4.6.2]
When in the \"Q1: in-progress private call\" state, upon expiry of timer TFP6
(emergency private call cancel retransmission), the MCPTT client:
1) shall generate a PRIVATE CALL EMERGENCY CANCEL message as specified in
subclause 15.1.12. In the PRIVATE CALL EMERGENCY CANCEL message, the MCPTT
client:
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller ID; and
c) shall set the MCPTT user ID of the callee IE with store callee ID.
2) shall send the PRIVATE CALL EMERGENCY CANCEL message according to rules and
procedures as specified in subclause 11.2.1.1.1;
3) shall increment the value of the timer CFP6 (emergency private call cancel
retransmission) by 1;
4) shall start timer TFP6 (emergency private call cancel retransmission); and
5) shall remain in the \"Q1: in-progress private call\" state.
[TS 24.379, clause 11.2.3.4.6.4]
In the \"Q1: in-progress private call\" state, when timer TFP6 (emergency
private call cancel retransmission) expires and the value of the counter CFP6
(emergency private call cancel retransmission) is equal to the upper limit,
the MCPTT client:
1) shall release the stored current call type;
2) shall release the stored Prose per-packet priority; and
3) shall enter \"Q0: waiting for the call to be established\".
[TS 24.379, clause 11.2.2.4.5.9]
In the \"P4: part of ongoing call\" state, when timer TFP6 (emergency private
call cancel retransmission) expires and the value of the counter CFP6
(emergency private call cancel retransmission) is equal to the upper limit,
the MCPTT client:
1) shall start timer TFP7 (waiting for any message with same call identifier);
2) shall release the call type control state machine; and
3) shall enter the \"P1: ignoring same call id\" state.
[TS 24.379, clause 11.2.2.4.5.9]
When in the \"P1: ignoring same call id\" state, upon expiry of timer TFP7
(waiting for any message with same call identifier) the MCPTT client:
1) shall clear the stored call identifier; and
2) shall enter the \"P0: start-stop\" state.
##### 7.2.3.3 Test description {#test-description-89 .H6}
##### 7.2.3.3.1 Pre-test conditions {#pre-test-conditions-89 .H6}
##### System Simulator: {#system-simulator-89 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server) in the Preamble
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-89 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-89 .H6}
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is Switched OFF (state 1) according to TS 36.508 [24].
##### 7.2.3.3.2 Test procedure sequence {#test-procedure-sequence-89 .H6}
Table 7.2.3.3.2-1: Main behaviour
+----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +====+==============+==============+==============+=========+====+ | | | U - S | Message | | | +----+--------------+--------------+--------------+---------+----+ | 1 | Power up the | - | - | - | - | | | UE. | | | | | +----+--------------+--------------+--------------+---------+----+ | 1A | Trigger the | - | - | - | - | | | UE to reset | | | | | | | UTC time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time and | | | | | | | location | | | | | | | reset may be | | | | | | | performed by | | | | | | | MMI or AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +----+--------------+--------------+--------------+---------+----+ | 2 | Activate the | - | - | - | - | | | MCPTT Client | | | | | | | Application | | | | | | | and register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px_M | | | | | | | CPTT_User_ | | | | | | | A_username, | | | | | | | px_MC | | | | | | | PTT_User_A | | | | | | | _password). | | | | | | | | | | | | | | NOTE: This | | | | | | | is expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | im | | | | | | | plementation | | | | | | | dependent | | | | | | | MMI. | | | | | +----+--------------+--------------+--------------+---------+----+ | 3 | Make the UE | - | - | - | - | | | (MCPTT User) | | | | | | | request the | | | | | | | e | | | | | | | stablishment | | | | | | | of an MCPTT | | | | | | | private | | | | | | | call, | | | | | | | on-demand | | | | | | | Automatic | | | | | | | Commencement | | | | | | | Mode, with | | | | | | | Floor | | | | | | | Control. | | | | | | | | | | | | | | NOTE: This | | | | | | | is expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | im | | | | | | | plementation | | | | | | | dependent | | | | | | | MMI. | | | | | +----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call | | | | | | | e | | | | | | | stablishment | | | | | | | are | | | | | | | described in | | | | | | | TS 36 | | | | | | | .579-1 [2] | | | | | | | clause 5.4.5 | | | | | | | \'MCX CO | | | | | | | c | | | | | | | ommunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | c | | | | | | | ommunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | c | | | | | | | overage-esta | | | | | | | blishment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | exchanged. | | | | | +----+--------------+--------------+--------------+---------+----+ | 4 | The UE | --> | PRIVATE CALL | - | - | | | (MCPTT | | SETUP | | | | | client) | | REQUEST | | | | | sends a | | | | | | | PRIVATE CALL | | | | | | | SETUP | | | | | | | REQUEST, | | | | | | | Commencement | | | | | | | mode set to | | | | | | | AUTOMATIC | | | | | | | COMMENCEMENT | | | | | | | MODE, Call | | | | | | | type set to | | | | | | | Private | | | | | | | Call. | | | | | +----+--------------+--------------+--------------+---------+----+ | 5 | SS-UE1 | \ | PRIVATE CALL | - | - | | | (MCPTT | | ACCEPT ACK | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL ACCEPT | | | | | | | ACK. | | | | | +----+--------------+--------------+--------------+---------+----+ | 7 | Make the UE | - | - | - | - | | | (MCPTT User) | | | | | | | press the | | | | | | | PTT button | | | | | | | requesting | | | | | | | permission | | | | | | | to talk. | | | | | | | | | | | | | | NOTE 1: | | | | | | | Depending on | | | | | | | UE | | | | | | | im | | | | | | | plementation | | | | | | | the PTT | | | | | | | button may | | | | | | | already been | | | | | | | pressed in | | | | | | | step 3. | | | | | | | | | | | | | | NOTE 2: The | | | | | | | UE (MCPTT | | | | | | | User) shall | | | | | | | keep the | | | | | | | button | | | | | | | pressed | | | | | | | until | | | | | | | otherwise | | | | | | | written. | | | | | +----+--------------+--------------+--------------+---------+----+ | 8 | The UE | --> | Floor | - | - | | | (MCPTT | | Granted | | | | | client) | | | | | | | sends Floor | | | | | | | Granted | | | | | | | message. | | | | | +----+--------------+--------------+--------------+---------+----+ | 9 | Make the UE | - | - | - | - | | | (MCPTT User) | | | | | | | to release | | | | | | | the PTT | | | | | | | button. | | | | | +----+--------------+--------------+--------------+---------+----+ | 10 | The UE | --> | Floor | - | - | | | (MCPTT | | Release | | | | | client) send | | | | | | | Floor | | | | | | | Release | | | | | | | message. | | | | | +----+--------------+--------------+--------------+---------+----+ | 11 | Make the | - | - | - | - | | | MCPTT UE | | | | | | | (MCPTT User) | | | | | | | request | | | | | | | upgrade of | | | | | | | the ongoing | | | | | | | call to | | | | | | | Emergency | | | | | | | call. | | | | | | | | | | | | | | NOTE: This | | | | | | | is expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | im | | | | | | | plementation | | | | | | | dependent | | | | | | | MMI. | | | | | +----+--------------+--------------+--------------+---------+----+ | 12 | The UE | --> | PRIVATE CALL | 1 | - | | | (MCPTT | | SETUP | | | | | client) | | REQUEST | | | | | sends | | | | | | | PRIVATE CALL | | | | | | | SETUP | | | | | | | REQUEST | | | | | | | message, | | | | | | | Call type | | | | | | | set to | | | | | | | EMERGENCY | | | | | | | PRIVATE | | | | | | | CALL. | | | | | +----+--------------+--------------+--------------+---------+----+ | 13 | SS-UE1 | \ | Floor | 1 | P | | | the UE | | Request | | | | | (MCPTT | | | | | | | client) send | | | | | | | Floor | | | | | | | Request | | | | | | | message, | | | | | | | Floor | | | | | | | Indicator | | | | | | | set to | | | | | | | Normal call? | | | | | | | | | | | | | | NOTE: The UE | | | | | | | continues | | | | | | | operating in | | | | | | | the normal | | | | | | | Private | | | | | | | call. | | | | | +----+--------------+--------------+--------------+---------+----+ | 16 | SS-UE1 | \ | Floor | - | - | | | (MCPTT | | Release | | | | | client) send | | | | | | | Floor | | | | | | | Release | | | | | | | message. | | | | | +----+--------------+--------------+--------------+---------+----+ | 19 | Make the | - | - | - | - | | | MCPTT UE | | | | | | | (MCPTT User) | | | | | | | request | | | | | | | upgrade of | | | | | | | the ongoing | | | | | | | call to | | | | | | | Emergency | | | | | | | call. | | | | | | | | | | | | | | NOTE: This | | | | | | | is expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | im | | | | | | | plementation | | | | | | | dependent | | | | | | | MMI. | | | | | +----+--------------+--------------+--------------+---------+----+ | 20 | The UE | --> | PRIVATE CALL | - | - | | | (MCPTT | | SETUP | | | | | client) send | | REQUEST | | | | | PRIVATE CALL | | | | | | | SETUP | | | | | | | REQUEST | | | | | | | message, | | | | | | | Call type | | | | | | | set to | | | | | | | EMERGENCY | | | | | | | PRIVATE | | | | | | | CALL. | | | | | +----+--------------+--------------+--------------+---------+----+ | 21 | SS-UE1 | \ | PRIVATE CALL | - | - | | | (MCPTT | | ACCEPT ACK | | | | | client) send | | | | | | | PRIVATE CALL | | | | | | | ACCEPT ACK | | | | | | | message. | | | | | +----+--------------+--------------+--------------+---------+----+ | 23 | Make the UE | - | - | - | - | | | (MCPTT User) | | | | | | | to press the | | | | | | | PTT button | | | | | | | requesting | | | | | | | permission | | | | | | | to talk. | | | | | | | | | | | | | | NOTE 1: | | | | | | | Depending on | | | | | | | UE | | | | | | | im | | | | | | | plementation | | | | | | | the PTT | | | | | | | button may | | | | | | | already been | | | | | | | pressed in | | | | | | | step 19. | | | | | | | | | | | | | | NOTE 2: The | | | | | | | UE (MCPTT | | | | | | | User) shall | | | | | | | keep the | | | | | | | button | | | | | | | pressed | | | | | | | until | | | | | | | otherwise | | | | | | | written. | | | | | +----+--------------+--------------+--------------+---------+----+ | 24 | The UE | --> | Floor | - | - | | | (MCPTT | | Granted | | | | | client) send | | | | | | | Floor | | | | | | | Granted | | | | | | | message, | | | | | | | Floor | | | | | | | Indicator | | | | | | | set to | | | | | | | Emergency | | | | | | | call. | | | | | +----+--------------+--------------+--------------+---------+----+ | 25 | Void. | - | - | - | - | +----+--------------+--------------+--------------+---------+----+ | 26 | Make the UE | - | - | - | - | | | (MCPTT User) | | | | | | | to release | | | | | | | the PTT | | | | | | | button. | | | | | +----+--------------+--------------+--------------+---------+----+ | 27 | The UE | --> | Floor | - | - | | | (MCPTT | | Release | | | | | client) send | | | | | | | Floor | | | | | | | Release | | | | | | | message. | | | | | +----+--------------+--------------+--------------+---------+----+ | 28 | Make the UE | - | - | - | - | | | (MCPTT User) | | | | | | | request | | | | | | | downgrade of | | | | | | | the ongoing | | | | | | | Emergency | | | | | | | call. | | | | | | | | | | | | | | NOTE: This | | | | | | | is expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | im | | | | | | | plementation | | | | | | | dependent | | | | | | | MMI. | | | | | +----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | Steps 29-31 | | | | | | | are repeated | | | | | | | CFP6=3 | | | | | | | times. | | | | | +----+--------------+--------------+--------------+---------+----+ | 29 | Check: Does | --> | PRIVATE CALL | 2 | P | | | the UE | | EMERGENCY | | | | | (MCPTT | | CANCEL | | | | | client) send | | | | | | | PRIVATE CALL | | | | | | | EMERGENCY | | | | | | | CANCEL | | | | | | | message? | | | | | | | | | | | | | | NOTE: It is | | | | | | | expected | | | | | | | that the UE | | | | | | | | | | | | | | - shall | | | | | | | initialize | | | | | | | the counter | | | | | | | CFP6 | | | | | | | (emergency | | | | | | | private call | | | | | | | cancel | | | | | | | ret | | | | | | | ransmission) | | | | | | | with the | | | | | | | value set to | | | | | | | 1 | | | | | | | | | | | | | | - shall | | | | | | | start timer | | | | | | | TFP6 | | | | | | | (emergency | | | | | | | private call | | | | | | | cancel | | | | | | | ret | | | | | | | ransmission) | | | | | +----+--------------+--------------+--------------+---------+----+ | 30 | Start TFP6 | - | - | - | - | | | (private | | | | | | | call request | | | | | | | ret | | | | | | | ransmission) | | | | | | | 40 | | | | | | | m | | | | | | | illiseconds. | | | | | +----+--------------+--------------+--------------+---------+----+ | 31 | TFP6 | - | - | - | - | | | expires. | | | | | | | | | | | | | | NOTE: It is | | | | | | | expected | | | | | | | that the UE | | | | | | | considers at | | | | | | | this moment | | | | | | | of time the | | | | | | | Private call | | | | | | | being | | | | | | | terminated. | | | | | +----+--------------+--------------+--------------+---------+----+ | 38 | Start TFP7 | - | - | - | - | | | (waiting for | | | | | | | any message | | | | | | | with same | | | | | | | call | | | | | | | identifier) | | | | | | | 6 sec (value | | | | | | | chosen to | | | | | | | facilitate | | | | | | | the test | | | | | | | sequence in | | | | | | | steps | | | | | | | 39-43). | | | | | | | | | | | | | | NOTE 1: TFP7 | | | | | | | is expected | | | | | | | to be | | | | | | | started | | | | | | | after TFP6 | | | | | | | expires and | | | | | | | CFP6 is | | | | | | | equal to the | | | | | | | upper limit. | | | | | | | | | | | | | | NOTE 2: Step | | | | | | | numbering to | | | | | | | reflect that | | | | | | | steps 29-31 | | | | | | | are repeated | | | | | | | CFP6=3 | | | | | | | times. | | | | | +----+--------------+--------------+--------------+---------+----+ | 39 | SS-UE1 | \ | Floor | 2 | F | | | the UE | | Request | | | | | (MCPTT | | | | | | | client) send | | | | | | | Floor | | | | | | | Request | | | | | | | message in | | | | | | | the next 2/3 | | | | | | | TFP7 sec? | | | | | +----+--------------+--------------+--------------+---------+----+ | 42 | Make the UE | - | - | - | - | | | (MCPTT User) | | | | | | | to release | | | | | | | the PTT | | | | | | | button. | | | | | +----+--------------+--------------+--------------+---------+----+ | 43 | TFP7 | - | - | - | - | | | (waiting for | | | | | | | any message | | | | | | | with same | | | | | | | call | | | | | | | identifier) | | | | | | | expires. | | | | | +----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | SS releases | | | | | | | the E-UTRA | | | | | | | connection. | | | | | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call release | | | | | | | are | | | | | | | described in | | | | | | | TS 36.579-1 | | | | | | | [2] clause | | | | | | | 5.4.8 \'MCX | | | | | | | CO | | | | | | | c | | | | | | | ommunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | c | | | | | | | ommunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | cove | | | | | | | rage-release | | | | | | | by the SS\'. | | | | | | | | | | | | | | NOTE: | | | | | | | Depending on | | | | | | | UE | | | | | | | im | | | | | | | plementation | | | | | | | the UE may | | | | | | | start | | | | | | | i | | | | | | | ndependently | | | | | | | ProSe | | | | | | | release | | | | | | | procedure. | | | | | +----+--------------+--------------+--------------+---------+----+
##### 7.2.3.3.3 Specific message contents {#specific-message-contents-89 .H6}
Table 7.2.3.3.3-1: PRIVATE CALL SETUP REQUEST (Steps 12, 20, Table
7.2.3.3.2-1)
Derivation Path: 36.579-1 [2], Table 5.5.5.8.1-1.
* * *
Information Element Value/remark Comment Condition Call type \'00000110\'B
EMERGENCY PRIVATE CALL  
User location Nor present or Any value
Table 7.2.3.3.3-2: PRIVATE CALL REJECT (Step 13, Table 7.2.3.3.2-1)
Derivation Path: 36.579-1 [2], Table 5.5.5.11.2-1.
* * *
Information Element Value/remark Comment Condition Reason \'00000001\'B MEDIA
FAILURE
Table 7.2.3.3.3-3: Floor Granted (Step 8, Table 7.2.3.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | SSRC of granted | UE (MCPTT | | | | floor | client) SSRC | | | | participant | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000x00 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=x | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.3.3.3-4: Floor Request (Step 15, Table 7.2.3.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.2-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000x00 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=x | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.3.3.3-5: Floor Granted (Step 16, Table 7.2.3.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | SSRC of granted | The UE (MCPTT | | | | floor | client) SSRC | | | | participant | (received in | | | | | the | | | | | corresponding | | | | | Floor Request) | | | +-----------------+-----------------+-----------------+-----------+ | Floor priority | The same as the | | | | | priority | | | | | included in the | | | | | corresponding | | | | | Floor Request, | | | | | Not Present if | | | | | there was no | | | | | priority | | | | | included | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000100 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.3.3.3-6: Floor Release (Steps 10, 18, Table 7.2.3.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.5-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000x00 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=x | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.3.3.3-7: Floor Request (Step 24, Table 7.2.3.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.2-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'00010x00 | Bit D=1 | | | | 0000000 | (Emergency | | | | | call) | | | | | | | | | | bit F=x | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.3.3.3-8: Floor Release (Step 27, Table 7.2.3.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.5-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'00010x00 | Bit D=1 | | | | 0000000 | (Emergency | | | | | call) | | | | | | | | | | bit F=x | | | | | (Queueing | | | | | supported) any | | | | | value | | +-----------------+-----------------+-----------------+-----------+
### 7.2.4 Off-network / Private Call / On-demand / Manual Commencement Mode /
Call Released before establishment completion / Call request Rejected / Call
establishment successful / Client Originated (CO)
##### 7.2.4.1 Test Purpose (TP) {#test-purpose-tp-90 .H6}
##### (1) {#section-270 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate/cancel private calls with manual
commencement, and, the UE is in an off-network environment }
**ensure that** {
**when** { the MCPTT User requests the establishment of an MCPTT private call,
on-demand Manual Commencement Mode }
**then** { UE (MCPTT Client) sends a PRIVATE CALL SETUP REQUEST message
requesting the establishment of an MCPTT private call, on-demand Manual
Commencement Mode }
}
##### (2) {#section-271 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate/cancel private calls with manual
commencement, and, the UE is in an off-network environment, and, UE (MCPTT
Client) having sent a PRIVATE CALL SETUP REQUEST message requesting
establishment of an MCPTT private call, on-demand Manual Commencement Mode }
**ensure that** {
**when** { the User requests termination of the call after a PRIVATE CALL
RINGING message has been received but before the completion of the call
establishment }
**then** { UE (MCPTT Client) sends a PRIVATE CALL RELEASE message and
terminates the call establishment }
}
##### (3) {#section-272 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate/cancel private calls with manual
commencement, and, the UE is in an off-network environment, and, UE (MCPTT
Client) having sent a PRIVATE CALL SETUP REQUEST message requesting
establishment of an MCPTT private call, on-demand Manual Commencement Mode }
**ensure that** {
**when** { the UE (MCPTT Client) receives a PRIVATE CALL REJECT message after
a PRIVATE CALL RINGING message has been received but before the completion of
the call establishment }
**then** { UE (MCPTT Client) terminates the call establishment }
}
##### (4) {#section-273 .H6}
**with** { UE (MCPTT Client) registered and authorized for MCPTT Service,
including authorized to initiate/cancel private calls with manual
commencement, and, the UE is in an off-network environment, and, UE (MCPTT
Client) having sent a PRIVATE CALL SETUP REQUEST message requesting
establishment of an MCPTT private call, on-demand Manual Commencement Mode }
**ensure that** {
**when** { the UE (MCPTT Client) receives a PRIVATE CALL RINGING message
followed by a PRIVATE CALL ACCEPT message }
**then** { UE (MCPTT Client) transmits a PRIVATE CALL ACCEPT ACK message
**and** considers the call as being established }
}
##### 7.2.4.2 Conformance requirements {#conformance-requirements-90 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.379 clauses 11.2.1.1.1, 11.2.1.1.2, 11.2.2.4.4.1,
11.2.2.4.2.7, 11.2.2.4.2.8, 11.2.2.4.4.8. Unless otherwise stated these are
Rel-13 requirements.
[TS 24.379, clause 11.2.1.1.1]
In order to participate in a private call, the MCPTT client:
1) shall send the MONP message as a UDP message to the local IP address of the
MCPTT user, on UDP port TBD, with an IP time-to-live set to 255; and
Editor\'s note [CT1#95, C1-160392]: Port number for the message is FFS.
2) shall treat UDP messages received on the port TBD as received MONP
messages.
NOTE: An MCPTT client that supports IPv6 is supposed to listen to the IPv6
addresses.
[TS 24.379, clause 11.2.1.1.2]
For an off-network MCPTT session, only MCPTT speech is used.
One off-network MCPTT session includes one media-floor control entity.
The MCPTT client shall generate an SDP body for a private call in accordance
with rules and procedures of IETF RFC 4566 [12] and IETF RFC 3264 [44].
The MCPTT client:
1) shall include in the session-level section:
a) the \"o=\" field with the \ portion set to a dash;
b) the \"s=\" field with the \ portion set to a dash; and
c) the \"c=\" field with the \ portion set to \"IN\", the \
portion set to the IP version of the unicast IP address of the MCPTT client
and the \ portion set to the unicast IP address of the
MCPTT client;
2) shall include the media-level section for MCPTT speech consisting of:
a) the \"m=\" field with the \ portion set to \"audio\", the \
portion set to a port number for MCPTT speech of the MCPTT group, the \
field set to \"RTP/AVP\" and \ portion set indicating RTP payload type
numbers;
b) the \"i=\" field with the \ portion set to \"speech\";
c) the \"a=fmtp:\" attribute(s), the \"a=rtpmap:\" attribute(s) or both,
indicating the codec(s) and media parameters of the MCPTT speech; and
d) the \"a=rtcp:\" attribute indicating port number to be used for RTCP at the
MCPTT client selected according to the rules and procedures of IETF RFC 3605
[13], if the media steam uses other than the default IP address;
3) shall include the media-level section for media-floor control entity
consisting of:
a) an \"m=\" line, with the \ portion set to \"application\", the
\ portion set to a port number for media-floor control entity of the
MCPTT group, the \ field set to \"udp\" and \ portion set to
\"MCPTT\"; and
b) the \"a=fmtp:MCPTT\" attribute indicating the parameters of the media-floor
control entity as specified 3GPP TS 24.380 [5]; and
4) shall include the MIKEY-SAKKE I_MESSAGE, if generated by the MCPTT client,
in an \"a=key-mgmt\" attribute as a \"mikey\" attribute value in the SDP offer
as specified in IETF RFC 4567 [47].
[TS 24.379, clause 11.2.2.4.4.1]
When in the \"P0: start-stop\" state or \"P1: ignoring same call id\", upon an
indication from MCPTT User to initiate a private call and the value of
\"/\/\/Common/PrivateCall/Authorised\" leaf node present in the user
profile as specified in 3GPP TS 24.383 [45] is set to \"true\", the MCPTT
client:
1) shall generate and store the call identifier as a random number uniformly
distributed between (0, 65536);
2) shall store own MCPTT user ID as caller ID;
3) shall store MCPTT user ID of the callee as callee ID;
4) shall store \"AUTOMATIC COMMENCEMENT MODE\" as commencement mode, if
requested and the value of \"/\/\/Common/PrivateCall/AutoCommence\" leaf
node present in the user profile as specified in 3GPP TS 24.383 [45] is set to
\"true\". Otherwise if the value of
\"/\/\/Common/PrivateCall/ManualCommence\" leaf node present in the user
profile as specified in 3GPP TS 24.383 [45] is set to \"true\", store \"MANUAL
COMMENCEMENT MODE\" as commencement mode;
5) shall create a call type control state machine as described in subclause
11.2.3.2;
6) if an end-to-end security context needs to be established then:
a) shall use keying material provided by the key management server to generate
a PCK as described in 3GPP TS 33.179 [46];
b) shall use the PCK to generate a PCK-ID with the four most significant bits
set to \"0011\" to indicate that the purpose of the PCK is to protect private
call communications and with the remaining twenty eight bits being randomly
generated as described in 3GPP TS 33.179 [46];
c) shall encrypt the PCK to a UID associated to the MCPTT client using the
MCPTT ID of the invited user and a time related parameter as described in 3GPP
TS 33.179 [46];
d) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-
ID as specified in 3GPP TS 33.179 [46];
e) shall add the MCPTT ID of the originating MCPTT to the initiator field
(IDRi) of the I_MESSAGE as described in 3GPP TS 33.179 [46];
f) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user\'s
signing key provided in the keying material together with a time related
parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
33.179 [46] and;
g) shall store the MIKEY-SAKKE I_MESSAGE for later inclusion in an SDP body;
7) may store current user location as user location;
8) shall generate and store offer SDP, as defined in subclause 11.2.1.1.2;
9) shall generate a PRIVATE CALL SETUP REQUEST message as specified in
subclause 15.1.5. In the PRIVATE CALL SETUP REQUEST message, the MCPTT client:
a) shall set the Call identifier IE with the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller ID;
c) shall set the MCPTT user ID of the callee IE with the stored callee ID;
d) shall set the Commencement mode IE with the stored commencement mode;
e) shall set the Call type IE with the stored current call type associated
with the call type control state machine;
f) shall set the SDP offer IE with the stored offer SDP; and
g) may set the User location IE with the stored user location if the stored
current call type associated with the call type control state machine is
\"EMERGENCY PRIVATE CALL\".
10) shall send the PRIVATE CALL SETUP REQUEST message towards other MCPTT
client according to rules and procedures as specified in subclause 11.2.1.1.1;
11) shall initialize the counter CFP1 (private call request retransmission)
with the value set to 1;
12) shall start timer TFP1 (private call request retransmission); and
13) shall enter the \"P2: waiting for call response\" state.
[TS 24.379, clause 11.2.2.4.2.7]
When in the \"P2: waiting for call response\" state, upon receiving a PRIVATE
CALL REJECT message in response to PRIVATE CALL SETUP REQUEST message with
Call identifier IE same as the stored call identifier, the MCPTT client:
1) shall stop timer TFP1 (call setup retransmission), if running;
2) shall stop timer TFP2 (waiting for call response message), if running;
3) shall start timer TFP7 (waiting for any message with same call identifier);
4) shall release the call control state machine; and
5) shall enter the \"P1: ignoring same call id\" state.
[TS 24.379, clause 11.2.2.4.2.8]
When in the \"P2: waiting for call response\" state, upon receiving a PRIVATE
CALL ACCEPT message response to PRIVATE CALL SETUP REQUEST message with the
same call identifier, the MCPTT client:
1) shall store the SDP answer IE received in the PRIVATE CALL ACCEPT message
as answer SDP;
2) shall generate a PRIVATE CALL ACCEPT ACK message as specified in subclause
15.1.11:
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller ID; and
c) shall set the MCPTT user ID of the callee IE with the stored callee ID.
3) shall send the PRIVATE CALL ACCEPT ACK message in response to the request
message according to rules and procedures as specified in subclause
11.2.1.1.1;
4) shall stop timer TFP1 (call setup retransmission), if running;
5) shall stop timer TFP2 (waiting for call response message), if running;
6) shall establish a media session based on the SDP body of the stored answer
SDP;
7) shall start floor control as terminating floor participant as specified in
subclause 7.2 in 3GPP TS 24.380 [5];
8) shall start timer TFP5 (max duration); and
9) shall enter the \"P4: part of ongoing call\" state.
[TS 24.379, clause 11.2.2.4.4.8]
When in the \"P5: pending\" state or \"P1: ignoring same call id\" state, upon
receiving a PRIVATE CALL RELEASE message, the MCPTT client:
1) shall generate a PRIVATE CALL RELEASE ACK message as specified in subclause
15.1.10. In the PRIVATE CALL RELEASE ACK message, the MCPTT client:
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller ID;
and.
c) shall set the MCPTT user ID of the callee IE with the stored callee ID.
2) shall send the PRIVATE CALL RELEASE ACK message in response to the request
message according to rules and procedures as specified in subclause
11.2.1.1.1;
3) shall start timer TFP7 (waiting for any message with same call identifier);
4) shall stop timer TFP4 (private call accept retransmission) if running;
5) shall release the call type control state machine, if the current state is
\"P5: pending\" state; and
6) shall enter the \"P1: ignoring same call id\" state, if the current state
is \"P5: pending\" state.
##### 7.2.4.3 Test description {#test-description-90 .H6}
##### 7.2.4.3.1 Pre-test conditions {#pre-test-conditions-90 .H6}
##### System Simulator: {#system-simulator-90 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server) in the Preamble
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-90 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-90 .H6}
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is Switched OFF (state 1) according to TS 36.508 [24].
##### 7.2.4.3.2 Test procedure sequence {#test-procedure-sequence-90 .H6}
Table 7.2.4.3.2-1: Main behaviour
+-----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=====+==============+==============+==============+=========+====+ | | | U - S | Message | | | +-----+--------------+--------------+--------------+---------+----+ | 1 | Power up the | - | - | - | - | | | UE. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 1A | Trigger the | - | - | - | - | | | UE to reset | | | | | | | UTC time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time and | | | | | | | location | | | | | | | reset may be | | | | | | | performed by | | | | | | | MMI or AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----+--------------+--------------+--------------+---------+----+ | 2 | Activate the | - | - | - | - | | | MCPTT Client | | | | | | | Application | | | | | | | and register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px_M | | | | | | | CPTT_User_ | | | | | | | A_username, | | | | | | | px_MC | | | | | | | PTT_User_A | | | | | | | _password). | | | | | | | | | | | | | | NOTE: This | | | | | | | is expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | im | | | | | | | plementation | | | | | | | dependent | | | | | | | MMI. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 3 | Make the UE | - | - | - | - | | | (MCPTT User) | | | | | | | request the | | | | | | | e | | | | | | | stablishment | | | | | | | of an MCPTT | | | | | | | private | | | | | | | call, | | | | | | | on-demand | | | | | | | Manual | | | | | | | Commencement | | | | | | | Mode, with | | | | | | | Floor | | | | | | | Control. | | | | | | | | | | | | | | NOTE: This | | | | | | | is expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | im | | | | | | | plementation | | | | | | | dependent | | | | | | | MMI. | | | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call | | | | | | | e | | | | | | | stablishment | | | | | | | are | | | | | | | described in | | | | | | | TS 36 | | | | | | | .579-1 [2] | | | | | | | clause 5.4.5 | | | | | | | \'MCX CO | | | | | | | c | | | | | | | ommunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | c | | | | | | | ommunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | c | | | | | | | overage-esta | | | | | | | blishment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | exchanged. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 4 | Check: Does | --> | PRIVATE CALL | 1 | P | | | the UE | | SETUP | | | | | (MCPTT | | REQUEST | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL SETUP | | | | | | | REQUEST, | | | | | | | Commencement | | | | | | | mode set to | | | | | | | MANUAL | | | | | | | COMMENCEMENT | | | | | | | MODE? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 5 | SS-UE1 | \ | PRIVATE CALL | 2 | P | | | the UE | | RELEASE | | | | | (MCPTT | | | | | | | client) send | | | | | | | PRIVATE CALL | | | | | | | RELEASE | | | | | | | message? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 8 | SS-UE1 | \ | PRIVATE CALL | 1 | P | | | the UE | | SETUP | | | | | (MCPTT | | REQUEST | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL SETUP | | | | | | | REQUEST, | | | | | | | Commencement | | | | | | | mode set to | | | | | | | MANUAL | | | | | | | COMMENCEMENT | | | | | | | MODE? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 12 | SS-UE1 | \ | PRIVATE CALL | 3 | F | | | the UE | | ACCEPT ACK | | | | | (MCPTT | | | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL ACCEPT | | | | | | | ACK in the | | | | | | | next 1 sec? | | | | | | | | | | | | | | NOTE: It is | | | | | | | expected | | | | | | | that upon | | | | | | | receipt of | | | | | | | the message | | | | | | | sent in step | | | | | | | 13 the UE | | | | | | | has entered | | | | | | | the \"P1: | | | | | | | ignoring | | | | | | | same call | | | | | | | id\" state | | | | | | | and | | | | | | | therefore it | | | | | | | shall ignore | | | | | | | the message | | | | | | | sent in step | | | | | | | 14. | | | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | UE releases | | | | | | | the E-UTRA | | | | | | | connection. | | | | | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call release | | | | | | | are | | | | | | | described in | | | | | | | TS 36 | | | | | | | .579-1 [2] | | | | | | | clause 5.4.8 | | | | | | | \'MCX CO | | | | | | | c | | | | | | | ommunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | c | | | | | | | ommunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | cove | | | | | | | rage-release | | | | | | | by the UE\'. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 16 | Wait for 5 | - | - | - | - | | | sec to | | | | | | | ensure the | | | | | | | UE is in | | | | | | | stable state | | | | | | | - scanning | | | | | | | for incoming | | | | | | | ProSe | | | | | | | messages. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 17 | Make the | - | - | - | - | | | MCPTT UE | | | | | | | (MCPTT User) | | | | | | | request the | | | | | | | e | | | | | | | stablishment | | | | | | | of an MCPTT | | | | | | | private | | | | | | | call, | | | | | | | on-demand | | | | | | | Manual | | | | | | | Commencement | | | | | | | Mode, with | | | | | | | Floor | | | | | | | Control. | | | | | | | | | | | | | | NOTE: This | | | | | | | is expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | im | | | | | | | plementation | | | | | | | dependent | | | | | | | MMI. | | | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call | | | | | | | e | | | | | | | stablishment | | | | | | | are | | | | | | | described in | | | | | | | TS 36 | | | | | | | .579-1 [2] | | | | | | | clause 5.4.5 | | | | | | | \'MCX CO | | | | | | | c | | | | | | | ommunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | c | | | | | | | ommunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | c | | | | | | | overage-esta | | | | | | | blishment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | exchanged. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 18 | Check: Does | --> | PRIVATE CALL | 1 | P | | | the UE | | SETUP | | | | | (MCPTT | | REQUEST | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL SETUP | | | | | | | REQUEST, | | | | | | | Commencement | | | | | | | mode set to | | | | | | | MANUAL | | | | | | | COMMENCEMENT | | | | | | | MODE? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 19 | SS-UE1 | \ | PRIVATE CALL | 4 | P | | | the UE | | ACCEPT ACK | | | | | (MCPTT | | | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL ACCEPT | | | | | | | ACK? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 22 | Make the UE | - | - | - | - | | | (MCPTT User) | | | | | | | press the | | | | | | | PTT button | | | | | | | requesting | | | | | | | permission | | | | | | | to talk. | | | | | | | | | | | | | | NOTE 1: | | | | | | | Depending on | | | | | | | UE | | | | | | | im | | | | | | | plementation | | | | | | | the PTT | | | | | | | button may | | | | | | | already been | | | | | | | pressed in | | | | | | | step 17. | | | | | | | | | | | | | | NOTE 2: The | | | | | | | UE (MCPTT | | | | | | | User) shall | | | | | | | keep the | | | | | | | button | | | | | | | pressed | | | | | | | until | | | | | | | otherwise | | | | | | | written. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 23 | Does the UE | --> | Floor | 4 | P | | | (MCPTT | | Granted | | | | | client) send | | | | | | | a Floor | | | | | | | Granted | | | | | | | message? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 24 | Make the UE | - | - | - | - | | | (MCPTT User) | | | | | | | release the | | | | | | | PTT button. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 25 | Check: Does | --> | Floor | 4 | P | | | the UE | | Release | | | | | (MCPTT | | | | | | | client) | | | | | | | sends a | | | | | | | Floor | | | | | | | Release | | | | | | | message? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 26 | Make the | - | - | - | - | | | MCPTT UE | | | | | | | (MCPTT User) | | | | | | | request | | | | | | | termination | | | | | | | of the MCPTT | | | | | | | private | | | | | | | call. | | | | | | | | | | | | | | NOTE: This | | | | | | | is expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | im | | | | | | | plementation | | | | | | | dependent | | | | | | | MMI. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 27 | The UE | --> | PRIVATE CALL | - | - | | | (MCPTT | | RELEASE | | | | | client) send | | | | | | | PRIVATE CALL | | | | | | | RELEASE | | | | | | | message. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 28 | SS-UE1 | \ portion set to a dash;
b) the \"s=\" field with the \ portion set to a dash; and
c) the \"c=\" field with the \ portion set to \"IN\", the \
portion set to the IP version of the unicast IP address of the MCPTT client
and the \ portion set to the unicast IP address of the
MCPTT client;
2) shall include the media-level section for MCPTT speech consisting of:
a) the \"m=\" field with the \ portion set to \"audio\", the \
portion set to a port number for MCPTT speech of the MCPTT group, the \
field set to \"RTP/AVP\" and \ portion set indicating RTP payload type
numbers;
b) the \"i=\" field with the \ portion set to \"speech\";
c) the \"a=fmtp:\" attribute(s), the \"a=rtpmap:\" attribute(s) or both,
indicating the codec(s) and media parameters of the MCPTT speech; and
d) the \"a=rtcp:\" attribute indicating port number to be used for RTCP at the
MCPTT client selected according to the rules and procedures of IETF RFC 3605
[13], if the media steam uses other than the default IP address;
3) shall include the media-level section for media-floor control entity
consisting of:
a) an \"m=\" line, with the \ portion set to \"application\", the
\ portion set to a port number for media-floor control entity of the
MCPTT group, the \ field set to \"udp\" and \ portion set to
\"MCPTT\"; and
b) the \"a=fmtp:MCPTT\" attribute indicating the parameters of the media-floor
control entity as specified 3GPP TS 24.380 [5]; and
4) shall include the MIKEY-SAKKE I_MESSAGE, if generated by the MCPTT client,
in an \"a=key-mgmt\" attribute as a \"mikey\" attribute value in the SDP offer
as specified in IETF RFC 4567 [47].
[TS 24.379, clause 11.2.2.4.4.1]
When in the \"P0: start-stop\" or \"P1: ignoring same call id\" state, upon
receiving a PRIVATE CALL SETUP REQUEST message with Commencement mode IE set
to \"MANUAL COMMENCEMENT MODE\" and Call identifier IE different from stored
call identifier, the MCPTT client:
1) shall store the Call identifier IE in the received message as call
identifier;
2) shall create the call type control state machine as described in subclause
11.2.3.2;
3) shall store the MCPTT user ID of the caller IE as received in the PRIVATE
CALL SETUP REQUEST as caller ID;
4) shall store own MCPTT user ID as callee ID;
5) shall generate a PRIVATE CALL RINGING message as specified in subclause
15.1.6;
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller ID; and
c) shall set the MCPTT user ID of the callee IE with the stored callee ID;
6) shall send PRIVATE CALL RINGING message in response to the request message
according to rules and procedures as specified in subclause 11.2.1.1.1;
7) shall start timer TFP2 (waiting for call response message); and
8) shall enter the \"P5: pending\" state.
[TS 24.379, clause 11.2.2.4.4.2]
When in the \"P5: pending\" state, upon expiry of timer TFP2 (waiting for call
response message), the MCPTT client:
1) shall generate a PRIVATE CALL REJECT message as specified in subclause
15.1.8:
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller ID;
c) shall set the MCPTT user ID of the callee IE with the stored callee ID; and
d) shall set the Reason IE as \"FAILED\".
2) shall send the PRIVATE CALL REJECT message in response to the request
message according to rules and procedures as specified in subclause
11.2.1.1.1;
3) shall start timer TFP7 (waiting for any message with same call identifier);
4) shall release the call type control state machine; and
5) shall enter the \"P1: ignoring same call id\" state.
[TS 24.379, clause 11.2.2.4.4.3]
When in the \"P5: pending\" state, upon an indication from MCPTT User to
accept the incoming private call, the MCPTT client:
1) if the SDP offer contains an \"a=key-mgmt\" attribute field with a
\"mikey\" attribute value containing a MIKEY-SAKKE I_MESSAGE:
a) shall extract the MCPTT ID of the originating MCPTT user from the initiator
field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.179 [46];
b) shall convert the MCPTT ID to a UID as described in 3GPP TS 33.179 [46];
c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as
described in 3GPP TS 33.179 [46];
...
e) if the validation of the signature was successful:
i) shall extract and decrypt the encapsulated PCK using the terminating
user\'s (KMS provisioned) UID key as described in 3GPP TS 33.179 [46];
ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS 33.179
[46];
iii) shall generate and store answer SDP based on received SDP offer IE in
PRIVATE CALL SETUP REQUEST message, as defined in subclause 11.2.1.1.2;
iv) shall generate a PRIVATE CALL ACCEPT message as specified in subclause
15.1.7. In the PRIVATE CALL ACCEPT message, the MCPTT client:
A) shall set the Call identifier IE to the stored call identifier;
B) shall set the MCPTT user ID of the caller IE with the stored caller ID;
C) shall set the MCPTT user ID of the callee IE with the stored callee ID; and
D) shall set the SDP answer IE with the stored answer SDP;
v) shall send the PRIVATE CALL ACCEPT message in response to the request
message according to rules and procedures as specified in subclause
11.2.1.1.1;
vi) shall establish a media session based on the SDP body of the private call;
vii) shall stop timer TFP2 (waiting for call response message);
viii) shall initialize the counter CFP4 with value set to 1;
ix) shall start timer TFP4 (private call accept retransmission); and
x) shall remain in the \"P5: pending\" state; and
NOTE: With the PCK successfully shared between the originating MCPTT client
and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to
create an end-to-end secure session.
2) if the SDP offer does not contain an \"a=key-mgmt\" attribute, the MCPTT
client:
a) shall generate and store answer SDP based on received SDP offer IE in
PRIVATE CALL SETUP REQUEST message, as defined in subclause 11.2.1.1.2;
b) shall generate a PRIVATE CALL ACCEPT message as specified in subclause
15.1.7. In the PRIVATE CALL ACCEPT message, the MCPTT client:
i) shall set the Call identifier IE to the stored call identifier;
ii) shall set the MCPTT user ID of the caller IE with the stored caller ID;
iii) shall set the MCPTT user ID of the callee IE with the stored callee ID;
and
iv) shall set the SDP answer IE with the stored answer SDP;
c) shall send the PRIVATE CALL ACCEPT message in response to the request
message according to rules and procedures as specified in subclause
11.2.1.1.1;
d) shall establish a media session based on the SDP body of the private call;
e) shall stop timer TFP2 (waiting for call response message);
f) shall initialize the counter CFP4 with value set to 1;
g) shall start timer TFP4 (private call accept retransmission); and
h) shall remain in the \"P5: pending\" state.
[TS 24.379, clause 11.2.2.4.4.5]
When in the \"P5: pending\" state, upon receiving a PRIVATE CALL ACCEPT ACK
message or RTP media from originating user, the MCPTT client:
1) shall stop timer TFP4 (private call accept retransmission);
2) shall start floor control as terminating MCPTT client as specified in
subclause 7.2 in 3GPP TS 24.380 [5];
3) shall start timer TFP5 (max duration); and
4) shall enter the \"P4: part of ongoing call\" state.
[TS 24.379, clause 11.2.2.4.4.7]
When in the \"P5: pending\" state, upon an indication from MCPTT User to
reject the incoming private call, the MCPTT client:
1) shall generate a PRIVATE CALL REJECT message as specified in subclause
15.1.8:
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller ID;
c) shall set the MCPTT user ID of the callee IE with stored callee ID; and
d) shall set the Reason IE as \"FAILED\", if requested to restrict
notification of call failure and the value of
\"/\/\/Common/PrivateCall/FailRestrict\" leaf node present in the user
profile as specified in 3GPP TS 24.383 [45] is set to \"true\". Otherwise,
shall set the Reason IE as \"REJECT\";
2) shall send the PRIVATE CALL REJECT message in response to the request
message according to rules and procedures as specified in subclause
11.2.1.1.1;
3) shall start timer TFP7 (waiting for any message with same call identifier);
4) shall release the call type control state machine; and
5) shall enter the \"P1: ignoring same call id\" state.
[TS 24.379, clause 11.2.2.4.4.8]
When in the \"P5: pending\" state or \"P1: ignoring same call id\" state, upon
receiving a PRIVATE CALL RELEASE message, the MCPTT client:
1) shall generate a PRIVATE CALL RELEASE ACK message as specified in subclause
15.1.10. In the PRIVATE CALL RELEASE ACK message, the MCPTT client:
a) shall set the Call identifier IE to the stored call identifier;
b) shall set the MCPTT user ID of the caller IE with the stored caller ID;
and.
c) shall set the MCPTT user ID of the callee IE with the stored callee ID.
2) shall send the PRIVATE CALL RELEASE ACK message in response to the request
message according to rules and procedures as specified in subclause
11.2.1.1.1;
3) shall start timer TFP7 (waiting for any message with same call identifier);
4) shall stop timer TFP4 (private call accept retransmission) if running;
5) shall release the call type control state machine, if the current state is
\"P5: pending\" state; and
6) shall enter the \"P1: ignoring same call id\" state, if the current state
is \"P5: pending\" state.
##### 7.2.5.3 Test description {#test-description-91 .H6}
##### 7.2.5.3.1 Pre-test conditions {#pre-test-conditions-91 .H6}
##### System Simulator: {#system-simulator-91 .H6}
\- SS-UE1 (MCPTT client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCPTT server) in the Preamble
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCPTT operation
in the MCPTT configuration document).
NOTE 2: The SS operation as NW (MCPTT server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-91 .H6}
\- UE (MCPTT client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
##### Preamble: {#preamble-91 .H6}
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is Switched OFF (state 1) according to TS 36.508 [24].
##### 7.2.5.3.2 Test procedure sequence {#test-procedure-sequence-91 .H6}
Table 7.2.5.3.2-1: Main behaviour
+-----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=====+==============+==============+==============+=========+====+ | | | U - S | Message | | | +-----+--------------+--------------+--------------+---------+----+ | 1 | Power up the | - | - | - | - | | | UE. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 1A | Trigger the | - | - | - | - | | | UE to reset | | | | | | | UTC time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time and | | | | | | | location | | | | | | | reset may be | | | | | | | performed by | | | | | | | MMI or AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call | | | | | | | e | | | | | | | stablishment | | | | | | | are | | | | | | | described in | | | | | | | TS 36 | | | | | | | .579-1 [2] | | | | | | | clause 5.4.6 | | | | | | | \'MCX CT | | | | | | | c | | | | | | | ommunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | c | | | | | | | ommunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | c | | | | | | | overage-esta | | | | | | | blishment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | exchanged. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 2 | Activate the | - | - | - | - | | | MCPTT Client | | | | | | | Application | | | | | | | and register | | | | | | | User A as | | | | | | | the MCPTT | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px_M | | | | | | | CPTT_User_ | | | | | | | A_username, | | | | | | | px_MC | | | | | | | PTT_User_A | | | | | | | _password). | | | | | | | | | | | | | | NOTE: This | | | | | | | is expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | im | | | | | | | plementation | | | | | | | dependent | | | | | | | MMI. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 3 | SS-UE1 | \ | PRIVATE CALL | 1 | P | | | the UE | | RINGING | | | | | (MCPTT | | | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL RINGING | | | | | | | message? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 5 | Check: Does | - | - | 1 | P | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | notifies the | | | | | | | User for the | | | | | | | incoming | | | | | | | call | | | | | | | request? | | | | | | | | | | | | | | NOTE: Make | | | | | | | the UE | | | | | | | (MCPTT User) | | | | | | | not to | | | | | | | respond. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 6 | SS-UE1 | \ | PRIVATE CALL | 2 | P | | | the UE | | RELEASE ACK | | | | | (MCPTT | | | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL RELEASE | | | | | | | ACK message? | | | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | SS releases | | | | | | | the E-UTRA | | | | | | | connection. | | | | | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call release | | | | | | | are | | | | | | | described in | | | | | | | TS 36 | | | | | | | .579-1 [2] | | | | | | | clause 5.4.7 | | | | | | | \'MCX CO | | | | | | | c | | | | | | | ommunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | c | | | | | | | ommunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | cove | | | | | | | rage-release | | | | | | | by the SS\'. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 8 | Wait for 5 | - | - | - | - | | | sec to | | | | | | | ensure the | | | | | | | UE is in | | | | | | | stable state | | | | | | | - scanning | | | | | | | for incoming | | | | | | | ProSe | | | | | | | messages. | | | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call | | | | | | | e | | | | | | | stablishment | | | | | | | are | | | | | | | described in | | | | | | | TS 36 | | | | | | | .579-1 [2] | | | | | | | clause 5.4.6 | | | | | | | \'MCX CT | | | | | | | c | | | | | | | ommunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | c | | | | | | | ommunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | c | | | | | | | overage-esta | | | | | | | blishment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | exchanged. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 9 | SS-UE1 | \ | PRIVATE CALL | 1 | P | | | the UE | | RINGING | | | | | (MCPTT | | | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL RINGING | | | | | | | message? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 11 | Check: Does | - | - | 1 | P | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | notifies the | | | | | | | User for the | | | | | | | incoming | | | | | | | call | | | | | | | request? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 12 | Start timer | - | - | - | - | | | TFP2 | | | | | | | (waiting for | | | | | | | call | | | | | | | response | | | | | | | message). | | | | | +-----+--------------+--------------+--------------+---------+----+ | 13 | Make the UE | - | - | - | - | | | (MCPTT User) | | | | | | | not to | | | | | | | respond. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 14 | Timer TFP2 | - | - | - | - | | | (waiting for | | | | | | | call | | | | | | | response | | | | | | | message) | | | | | | | expires. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 15 | Check: Does | --> | PRIVATE CALL | 3 | P | | | the UE | | REJECT | | | | | (MCPTT | | | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL ACCEPT | | | | | | | message? | | | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | SS releases | | | | | | | the E-UTRA | | | | | | | connection. | | | | | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call release | | | | | | | are | | | | | | | described in | | | | | | | TS 36 | | | | | | | .579-1 [2] | | | | | | | clause 5.4.7 | | | | | | | \'MCX CO | | | | | | | c | | | | | | | ommunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | c | | | | | | | ommunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | cove | | | | | | | rage-release | | | | | | | by the SS\'. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 16 | Wait for 5 | - | - | - | - | | | sec to | | | | | | | ensure the | | | | | | | UE is in | | | | | | | stable state | | | | | | | - scanning | | | | | | | for incoming | | | | | | | ProSe | | | | | | | messages. | | | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call | | | | | | | e | | | | | | | stablishment | | | | | | | are | | | | | | | described in | | | | | | | TS 36 | | | | | | | .579-1 [2] | | | | | | | clause 5.4.6 | | | | | | | \'MCX CT | | | | | | | c | | | | | | | ommunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | c | | | | | | | ommunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | c | | | | | | | overage-esta | | | | | | | blishment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | exchanged. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 17 | SS-UE1 | \ | PRIVATE CALL | 1 | P | | | the UE | | RINGING | | | | | (MCPTT | | | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL RINGING | | | | | | | message? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 19 | Check: Does | - | - | 1 | P | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | notifies the | | | | | | | User for the | | | | | | | incoming | | | | | | | call | | | | | | | request? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 20 | Make the UE | - | - | - | - | | | (MCPTT User) | | | | | | | reject the | | | | | | | e | | | | | | | stablishment | | | | | | | of an MCPTT | | | | | | | private | | | | | | | call, | | | | | | | on-demand | | | | | | | Manual | | | | | | | Commencement | | | | | | | Mode. | | | | | | | | | | | | | | NOTE: This | | | | | | | is expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | im | | | | | | | plementation | | | | | | | dependent | | | | | | | MMI. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 21 | Check: Does | --> | PRIVATE CALL | 4 | P | | | the UE | | REJECT | | | | | (MCPTT | | | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL ACCEPT | | | | | | | message? | | | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | SS releases | | | | | | | the E-UTRA | | | | | | | connection. | | | | | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call release | | | | | | | are | | | | | | | described in | | | | | | | TS 36 | | | | | | | .579-1 [2] | | | | | | | clause 5.4.7 | | | | | | | \'MCX CO | | | | | | | c | | | | | | | ommunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | c | | | | | | | ommunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | cove | | | | | | | rage-release | | | | | | | by the SS\'. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 22 | Wait for 5 | - | - | - | - | | | sec to | | | | | | | ensure the | | | | | | | UE is in | | | | | | | stable state | | | | | | | - scanning | | | | | | | for incoming | | | | | | | ProSe | | | | | | | messages. | | | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call | | | | | | | e | | | | | | | stablishment | | | | | | | are | | | | | | | described in | | | | | | | TS 36 | | | | | | | .579-1 [2] | | | | | | | clause 5.4.6 | | | | | | | \'MCX CT | | | | | | | c | | | | | | | ommunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | c | | | | | | | ommunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | c | | | | | | | overage-esta | | | | | | | blishment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below shows | | | | | | | only the | | | | | | | MCPTT | | | | | | | relevant | | | | | | | messages | | | | | | | exchanged. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 23 | SS-UE1 | \ | PRIVATE CALL | 1 | P | | | the UE | | RINGING | | | | | (MCPTT | | | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL RINGING | | | | | | | message? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 25 | Check: Does | - | - | 1 | P | | | the UE | | | | | | | (MCPTT | | | | | | | client) | | | | | | | notifies the | | | | | | | User for the | | | | | | | incoming | | | | | | | call | | | | | | | request? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 26 | Make the UE | - | - | - | - | | | (MCPTT User) | | | | | | | accept the | | | | | | | e | | | | | | | stablishment | | | | | | | of an MCPTT | | | | | | | private | | | | | | | call, | | | | | | | on-demand | | | | | | | Manual | | | | | | | Commencement | | | | | | | Mode. | | | | | | | | | | | | | | NOTE: This | | | | | | | is expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | im | | | | | | | plementation | | | | | | | dependent | | | | | | | MMI. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 27 | Check: Does | --> | PRIVATE CALL | 5 | P | | | the UE | | ACCEPT | | | | | (MCPTT | | | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL ACCEPT | | | | | | | message? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 28 | SS-UE1 | \ | PRIVATE CALL | 6 | P | | | the UE | | RELEASE ACK | | | | | (MCPTT | | | | | | | client) send | | | | | | | a PRIVATE | | | | | | | CALL RELEASE | | | | | | | ACK message? | | | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | SS releases | | | | | | | the E-UTRA | | | | | | | connection. | | | | | | | The | | | | | | | E-UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related to | | | | | | | the MCPTT | | | | | | | call release | | | | | | | are | | | | | | | described in | | | | | | | TS 36 | | | | | | | .579-1 [2] | | | | | | | clause 5.4.7 | | | | | | | \'MCX CO | | | | | | | c | | | | | | | ommunication | | | | | | | over ProSe | | | | | | | direct | | | | | | | one-to-one | | | | | | | c | | | | | | | ommunication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | cove | | | | | | | rage-release | | | | | | | by the SS\'. | | | | | +-----+--------------+--------------+--------------+---------+----+
##### 7.2.5.3.3 Specific message contents {#specific-message-contents-91 .H6}
Table 7.2.5.3.3-1: PRIVATE CALL SETUP REQUEST (Steps 3, 9, 17, 23, Table
7.2.5.3.2-1)
Derivation Path: 36.579-1 [2], Table 5.5.5.8.2-1.
* * *
Information Element Value/remark Comment Condition Commencement mode
\'00000001\'B MANUAL COMMENCEMENT MODE
Table 7.2.5.3.3-2: PRIVATE CALL REJECT (Step 15, Table 7.2.5.3.2-1)
Derivation Path: 36.579-1 [2], Table 5.5.5.11.1-1.
* * *
Information Element Value/remark Comment Condition Reason \'00000100\'B FAILED
Table 7.2.5.3.3-3: PRIVATE CALL REJECT (Step 21, Table 7.2.5.3.2-1)
Derivation Path: 36.579-1 [2], Table 5.5.5.11.1-1.
* * *
Information Element Value/remark Comment Condition Reason \'00000000\'B REJECT
Table 7.2.5.3.3-4: Floor Granted (Step 29, Table 7.2.5.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.3-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | SSRC of granted | SS-UE1 (MCPTT | | | | floor | Client) SSRC | | | | participant | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | px_MCP | The MCPTT User | | | | TT_User_B_ID | ID of the one | | | | | simulated by | | | | | the SS | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000100 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.5.3.3-5: Floor Release (Step 30, Table 7.2.5.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.579-1 | | | | | [2], Table | | | | | 5.5.6.5-1 | | | | | condition | | | | | OFF-NETWORK. | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | | | | +-----------------+-----------------+-----------------+-----------+ | User ID | px_MCP | The MCPTT User | | | | TT_User_B_ID | ID of the one | | | | | simulated by | | | | | the SS | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | | | | +-----------------+-----------------+-----------------+-----------+ | Floor Indicator | \'10000100 | Bit A=1 (Normal | | | | 0000000 | call) | | | | | | | | | | bit F=1 | | | | | (Queueing | | | | | supported) | | +-----------------+-----------------+-----------------+-----------+
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the E-UTRA MAC protocol.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 36.213: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical Layer Procedures\".
[3] 3GPP TS 36.322: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Link Control (RLC) protocol specification\".
[4] 3GPP TS 36.323: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Packet Data Convergence Protocol (PDCP) Specification\".
[5] 3GPP TS 36.212: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Multiplexing and channel coding\".
[6] 3GPP TS 36.214: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical layer; Measurements\".
[7] 3GPP TS 36.211: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical Channels and Modulation\".
[8] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC); Protocol specification\".
[9] 3GPP TS 36.133: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Requirements for support of radio resource management\".
[10] 3GPP TS 36.101: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
User Equipment (UE) radio transmission and reception\".
[11] 3GPP TS 36.216: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical layer for relaying operation\".
[12] 3GPP TS 36.306: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
User Equipment (UE) radio access capabilities\".
[13] 3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".
[14] 3GPP TS 23.285: \"Architecture enhancements for V2X services\".
[15] 3GPP TS 24.386: \"User Equipment (UE) to V2X control function; protocol
aspects; Stage 3\".
[16] 3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia telephony;
Media handling and interaction\".
[17] 3GPP TS 38.323: \"NR; Packet Data Convergence Protocol (PDCP)
specification\".
[18] 3GPP TS 38.213: \"NR; Physical Layer Procedures for control\".
[19] 3GPP TS 38.133: \"NR; Requirements for support of radio resource
management\".
[20] 3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access (E-UTRAN); Overall description;
Stage 2\".
[21] 3GPP TS 38.101‑3: \"NR; User Equipment (UE) radio transmission and
reception; Part 3: Range 1 and Range 2 Interworking operation with other
radios\".
[22] 3GPP TS 38.306: \"NR; User Equipment (UE) radio access capabilities\".
[23] 3GPP TS 23.287: \"Architecture enhancements for 5G System (5GS) to
support Vehicle-to-Everything (V2X) services \".
[24] 3GPP TS 38.321: \"NR; Medium Access Control (MAC) protocol
specification\".
[25] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
specification\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**Active Time:** Time related to DRX operation, as defined in clause 5.7,
during which the MAC entity monitors the PDCCH.
**_mac-ContentionResolutionTimer_** : Specifies the number of consecutive
subframe(s) during which the MAC entity shall monitor the PDCCH after Msg3 is
transmitted.
**DRX Cycle:** Specifies the periodic repetition of the On Duration followed
by a possible period of inactivity (see figure 3.1-1 below).
Figure 3.1-1: DRX Cycle
**_drx-InactivityTimer_** : Except for NB-IoT UEs, BL UEs or UEs in enhanced
coverage, it specifies the number of consecutive PDCCH-subframe(s) after the
subframe in which a PDCCH indicates an initial UL, DL or SL user data
transmission for this MAC entity. For NB-IoT UEs, it specifies the number of
consecutive PDCCH-subframe(s) after the subframe in which the HARQ RTT timer
or UL HARQ RTT timer expires. For BL UEs or UEs in enhanced coverage, it
specifies the number of consecutive PDCCH-subframe(s) following the subframe
containing the last repetition of the PDCCH reception that indicates an
initial UL or DL user data transmission for this MAC entity.
**_drx-RetransmissionTimer_** : Specifies the maximum number of consecutive
PDCCH-subframe(s) until a DL retransmission is received.
**_drx-RetransmissionTimerShortTTI_** : Specifies the maximum number of
consecutive TTI(s) until a DL retransmission is received for HARQ processes
scheduled using short TTI.
**_drxShortCycleTimer_** : Specifies the number of consecutive subframe(s) the
MAC entity shall follow the Short DRX cycle.
**_drxStartOffset_** : Specifies the subframe where the DRX Cycle starts.
**_drx-ULRetransmissionTimer_** : Specifies the maximum number of consecutive
PDCCH-subframe(s) until a grant for UL retransmission or the HARQ feedback is
received.
**_drx-ULRetransmissionTimeShortTTI_** : Specifies the maximum number of
consecutive TTI(s) until a grant for UL retransmission is received for HARQ
processes scheduled using short TTI.
**Early Data Transmission: Allows one uplink data transmission optionally
followed by one downlink data transmission during the random access procedure
as specified in TS 36.300 [20]. The S1 connection is established or resumed
upon reception of the uplink data and may be released or suspended along with
the transmission of the downlink data. Early data transmission refers to both
CP-EDT and UP-EDT.**
**HARQ information** : HARQ information for DL-SCH or for UL-SCH transmissions
consists of New Data Indicator (NDI), Transport Block (TB) size. For DL-SCH
transmissions and for asynchronous UL HARQ and for autonomous UL HARQ, the
HARQ information also includes HARQ process ID, except for UEs in NB-IoT
configured with a single HARQ process for which this information is not
present. For UL-SCH transmission the HARQ information also includes Redundancy
Version (RV). In case of spatial multiplexing on DL-SCH the HARQ information
comprises a set of NDI and TB size for each transport block. HARQ information
for SL-SCH and SL-DCH transmissions consists of TB size only.
**HARQ RTT Timer** : This parameter specifies the minimum amount of
subframe(s) before a DL assignment for HARQ retransmission is expected by the
MAC entity.
**Msg3** : Message transmitted on UL-SCH containing a C-RNTI MAC CE or a CCCH
SDU optionally multiplexed with DTCH for the UP-EDT, submitted from upper
layer and associated with the UE Contention Resolution Identity, as part of a
random access procedure.
**NB-IoT** : NB-IoT allows access to network services via E-UTRA with a
channel bandwidth limited to 200 kHz.
**NB-IoT UE** : A UE that uses NB-IoT.
**NR sidelink communication** : AS functionality enabling at least V2X
Communication as defined in TS 23.287 [23], between two or more nearby UEs,
using NR technology but not traversing any network node.
**_onDurationTimer_** : Specifies the number of consecutive PDCCH-subframe(s)
at the beginning of a DRX Cycle.
**PDCCH:** Refers to the PDCCH (see TS 36.211 [7]), EPDCCH (in subframes when
configured), MPDCCH (see TS 36.213 [2]), for an RN with R-PDCCH configured and
not suspended, to the R-PDCCH, for NB-IoT to the NPDCCH or for short TTI to
SPDCCH.
**PDCCH period (pp):** Refers to the interval between the start of two
consecutive PDCCH occasions and depends on the currently used PDCCH search
space, as specified in TS 36.213 [2]. A PDCCH occasion is the start of a
search space and is defined by subframe k0 as specified in clause 16.6 of TS
36.213 [2]. The calculation of number of PDCCH-subframes for the timer
configured in units of a PDCCH period is done by multiplying the number of
PDCCH periods with _npdcch-NumRepetitions-RA_ when the UE uses the common
search space or by _npdcch-NumRepetitions_ when the UE uses the UE specific
search space. When counting a timer whose length is calculated in PDCCH-
subframes, the UE shall include PDCCH-subframes that will be dropped or not
required to be monitored as specified in clause 16.6 of TS 36.213 [2]. The
calculation of number of subframes for the timer configured in units of a
PDCCH period is done by multiplying the number of PDCCH periods with duration
between two consecutive PDCCH occasions.
**PDCCH-subframe:** Refers to a subframe with PDCCH. This represents the union
over PDCCH-subframes for all serving cells excluding cells configured with
cross carrier scheduling for both uplink and downlink, as specified in TS
36.331 [8]; except if the UE is not capable of simultaneous reception and
transmission in the aggregated cells where this instead represents the PDCCH-
subframes of the SpCell.
\- For FDD serving cells, all subframes represent PDCCH-subframes, unless
specified otherwise in this clause.
\- For TDD serving cells, all downlink subframes and subframes including DwPTS
of the TDD UL/DL configuration indicated by _tdd-Config_ , as specified in TS
36.331 [8] of the cell represent PDCCH-subframes, unless specified otherwise
in this clause.
\- For serving cells operating according to Frame structure Type 3, all
subframes represent PDCCH-subframes.
\- For RNs with an RN subframe configuration configured and not suspended, in
its communication with the E-UTRAN, all downlink subframes configured for RN
communication with the E-UTRAN represent PDCCH-subframes.
\- For SC-PTM reception on an FDD cell, all subframes except MBSFN subframes
represent PDCCH-subframes, unless specified otherwise in this clause.
\- For SC-PTM reception on a TDD cell, all downlink subframes and subframes
including DwPTS of the TDD UL/DL configuration indicated by _tdd-Config_ , as
specified in TS 36.331 [8] of the cell except MBSFN subframes represent PDCCH-
subframes, unless specified otherwise in this clause.
\- For BL UE or UE in enhanced coverage, all subframes in which the UE is
required to monitor MPDCCH represent PDCCH-subframes among all valid subframes
regardless of whether the subframe is dropped, see clause 9.1.5 of TS 36.213
[2].
\- For NB-IoT UE, all subframes that are part of the NPDCCH search space
represent PDCCH-subframes among all NB-IoT downlink subframes, including those
which the UE is not required to monitor as specified in clause 16.6 of TS
36.213 [2].
**PDSCH: Refers to subframe-PDSCH/slot-PDSCH/subslot-PDSCH or for NB-IoT to
NPDSCH.**
**PRACH: Refers to PRACH or for NB-IoT to NPRACH.**
**PRACH Resource Index** : The index of a PRACH within a system frame, see TS
36.211 [7]
**Primary Timing Advance Group:** Timing Advance Group containing the SpCell.
**PUCCH SCell:** An SCell configured with PUCCH/SPUCCH.
**PUSCH: Refers to subframe-PUSCH/slot-PUSCH/subslot-PUSCH or for NB-IoT to
NPUSCH.**
**_ra-PRACH-MaskIndex_ :** Defines in which PRACHs within a system frame the
MAC entity can transmit a Random Access Preamble (see clause 7.3).
**RA-RNTI:** The Random Access RNTI is used on the PDCCH when Random Access
Response messages are transmitted. It unambiguously identifies which time-
frequency resource was utilized by the MAC entity to transmit the Random
Access preamble.
**SC Period:** Sidelink Control period, the time period consisting of
transmission of SCI and its corresponding data.
**SCI:** The Sidelink Control Information contains the sidelink scheduling
information such as resource block assignment, modulation and coding scheme,
Group Destination ID (for sidelink communication) and PPPP (for V2X sidelink
communication), see TS 36.212 [5].
**Secondary Timing Advance Group:** Timing Advance Group not containing the
SpCell. A Secondary Timing Advance Group contains at least one Serving Cell
with an UL configured.
**Serving Cell:** A Primary or a Secondary Cell, see TS 36.331 [8].
**Short Processing Time** : For 1 ms TTI length, the operation with short
processing time in UL data transmission and DL data reception.
**Short TTI** : TTI length based on a slot or a subslot.
**Sidelink:** UE to UE interface for sidelink communication, sidelink
discovery and V2X sidelink communication. The sidelink corresponds to the PC5
interface as defined in TS 23.303 [13] for sidelink communication and sidelink
discovery, and as defined in TS 23.285 [14] for V2X sidelink communication.
**Sidelink communication** : AS functionality enabling ProSe Direct
Communication as defined in TS 23.303 [13], between two or more nearby UEs,
using E-UTRA technology but not traversing any network node.
**Sidelink Discovery Gap for Reception:** Time period during which the UE does
not receive any channels in DL from any serving cell, except during random
access procedure.
**Sidelink Discovery Gap for Transmission:** Time period during which the UE
prioritizes transmission of sidelink discovery and associated procedures
**e.g.** re-tuning and synchronisation over transmission of channels in UL, if
they occur in the same subframe, except during random access procedure.
**Special Cell:** For Dual Connectivity operation the term Special Cell refers
to the PCell of the MCG or the PSCell of the SCG, otherwise the term Special
Cell refers to the PCell.
**Timing Advance Group:** A group of Serving Cells that is configured by RRC
and that, for the cells with an UL configured, using the same timing reference
cell and the same Timing Advance value.
**Transmission using PUR:** Allows one uplink data transmission using
preconfigured uplink resource from RRC_IDLE mode as specified in TS 36.300
[9]. Transmission using PUR refers to both CP transmission using PUR and UP
transmission using PUR.
**UL HARQ RTT Timer** : This parameter specifies the minimum amount of
subframe(s) before a UL HARQ retransmission grant is expected by the MAC
entity.
**V2X sidelink communication** : AS functionality enabling V2X Communication
as defined in TS 23.285 [14], between nearby UEs, using E-UTRA technology but
not traversing any network node.
NOTE: A timer is running once it is started, until it is stopped or until it
expires; otherwise it is not running. A timer can be started if it is not
running or restarted if it is running. A Timer is always started or restarted
from its initial value.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
> AS Access Stratum
>
> AUL Autonomous Uplink
>
> BL Bandwidth reduced Low complexity
>
> BR Bandwidth Reduced
>
> BSR Buffer Status Report
>
> C-RNTI Cell RNTI
>
> CBR Channel Busy Ratio
>
> CC-RNTI Common Control RNTI
>
> CG Cell Group
>
> CQI Channel Quality Indicator
>
> CRI CSI-RS Resource Indicator
>
> CSI Channel State Information
>
> DAPS Dual Active Protocol Stack
>
> DCQR Downlink Channel Quality Report
>
> DRB Data Radio Bearer
>
> EDT Early Data Transmission
>
> eIMTA Enhanced Interference Management and Traffic Adaptation
>
> eIMTA-RNTI Enhanced Interference Management and Traffic Adaptation - RNTI
>
> E-UTRA Evolved UMTS Terrestrial Radio Access
>
> E-UTRAN Evolved UMTS Terrestrial Radio Access Network
>
> G-RNTI Group RNTI
>
> H-SFN Hyper SFN
>
> MAC Medium Access Control
>
> MCG Master Cell Group
>
> M-RNTI MBMS RNTI
>
> MPDCCH MTC Physical Downlink Control Channel
>
> LCG Logical Channel Group
>
> NB-IoT Narrow Band Internet of Things
>
> NPDCCH Narrowband Physical Downlink Control Channel
>
> NPDSCH Narrowband Physical Downlink Shared channel
>
> NPRACH Narrowband Physical Random Access Control Channel
>
> NPUSCH Narrowband Physical Uplink Shared channel
>
> PCell Primary Cell
>
> PSCell Primary Secondary Cell
>
> PHR Power Headroom Report
>
> PMI Precoding Matrix Index
>
> PPPP ProSe Per-Packet Priority
>
> P-RNTI Paging RNTI
>
> ProSe Proximity-based Services
>
> pTAG Primary Timing Advance Group
>
> PTI Precoding Type Indicator
>
> PUR Preconfigured Uplink Resource
>
> RA-RNTI Random Access RNTI
>
> RAI Release Assistance Indication
>
> RI Rank Indicator
>
> RN Relay Node
>
> RNTI Radio Network Temporary Identifier
>
> SCell Secondary Cell
>
> SC-FDM Single-Carrier Frequency Division Multiplexing
>
> SCG Secondary Cell Group
>
> SCI Sidelink Control Information
>
> SC-N-RNTI Single Cell Notification RNTI
>
> SC-PTM Single Cell Point to Multipoint
>
> SC-RNTI Single Cell RNTI
>
> SI-RNTI System Information RNTI
>
> SL Sidelink
>
> SL-RNTI Sidelink RNTI
>
> SL-V-RNTI Sidelink V2X RNTI
>
> SR Scheduling Request
>
> SRS Sounding Reference Symbols
>
> SRS-TPC-RNTI Sounding Reference Symbols-Transmit Power Control-RNTI
>
> SpCell Special Cell
>
> sTAG Secondary Timing Advance Group
>
> sTTI Slot or subslot TTI
>
> TAG Timing Advance Group
>
> TB Transport Block
>
> TPC-PUCCH-RNTI Transmit Power Control-Physical Uplink Control Channel-RNTI
>
> TPC-PUSCH-RNTI Transmit Power Control-Physical Uplink Shared Channel-RNTI
>
> V2X Vehicle-to-Everything
# 4 General
## 4.1 Introduction
The objective is to describe the MAC architecture and the MAC entity from a
functional point of view. Functionality specified for the UE equally applies
to the RN for functionality necessary for the RN. There is also functionality
which is only applicable to the RN, in which case the specification denotes
the RN instead of the UE. RN‑specific behaviour is not applicable to the UE.
For TDD operation, UE behaviour follows the TDD UL/DL configuration indicated
by _tdd-Config_ unless specified otherwise.
The introduction of short TTI allows for more than a single instance of a TTI
to occur within a 1ms subframe and as such the use of the term \"for each
TTI\" shall be read as meaning that the associated actions shall be executed
for all TTIs also in the case of overlapping TTIs (e.g. a UE may read multiple
instances of PDCCH in a downlink subframe).
## 4.2 MAC architecture
The description in this clause is a model and does not specify or restrict
implementations.
RRC is in control of configuration of MAC.
### 4.2.1 MAC Entities
E-UTRA defines two MAC entities; one in the UE and one in the E-UTRAN. These
MAC entities handle the following transport channels:
\- Broadcast Channel (BCH);
\- Downlink Shared Channel(s) (DL-SCH);
\- Paging Channel (PCH);
\- Uplink Shared Channel(s) (UL-SCH);
\- Random Access Channel(s) (RACH);
\- Multicast Channel(s) (MCH);
\- Sidelink Broadcast Channel (SL-BCH);
\- Sidelink Discovery Channel (SL-DCH);
\- Sidelink Shared Channel (SL-SCH).
The exact functions performed by the MAC entities are different in the UE from
those performed in the E-UTRAN.
The RN includes both types of MAC entities; one type for communication with
UEs and one type for communication with the E-UTRAN.
In Dual Connectivity, two MAC entities are configured in the UE: one for the
MCG and one for the SCG. In DAPS handover, two MAC entities are configured in
the UE: one MAC entity for the source cell (source MAC entity) and one MAC
entity for the target cell (target MAC entity). Each MAC entity is configured
by RRC with a serving cell supporting PUCCH transmission and contention based
Random Access. In this specification, the term SpCell refers to such cell,
whereas the term SCell refers to other serving cells. The term SpCell either
refers to the PCell of the MCG or the PSCell of the SCG depending on if the
MAC entity is associated to the MCG or the SCG, respectively. A Timing Advance
Group containing the SpCell of a MAC entity is referred to as pTAG, whereas
the term sTAG refers to other TAGs.
The functions of the different MAC entities in the UE operate independently if
not otherwise indicated. The timers and paramenters used in each MAC entity
are configured independently if not otherwise indicated. The Serving Cells,
C-RNTI, radio bearers, logical channels, upper and lower layer entities, LCGs,
and HARQ entities considered by each MAC entity refer to those mapped to that
MAC entity if not otherwise indicated.
If the MAC entity is configured with one or more SCells, there are multiple
DL-SCH and there may be multiple UL-SCH and RACH per MAC entity; one DL-SCH,
one UL-SCH, and one RACH on the SpCell, one DL-SCH, zero or one UL-SCH and
zero or one RACH for each SCell.
The physical layer may perform a listen-before-talk procedure, according to
which transmissions are not performed if the channel is identified as being
occupied or the physical layer may monitor for PUSCH trigger, as specified in
TS 36.213 [2], according to which transmissions are not performed if PUSCH
trigger B is not received. In both cases a MAC entity considers the
transmission to have been performed anyway, unless stated otherwise.
Figure 4.2.1-1 illustrates one possible structure for the UE side MAC entity
when SCG is not configured and for each MAC entity during DAPS handover, and
it should not restrict implementation.
Figure 4.2.1-1: MAC structure overview, UE side
Figure 4.2.1-2 illustrates one possible structure for the UE side MAC entities
when MCG and SCG are configured, and it should not restrict implementation.
MBMS reception and SC-PTM reception are excluded from this figure for
simplicity.
Figure 4.2.1-2: MAC structure overview with two MAC entities, UE side
Figure 4.2.1-3 illustrates one possible structure for the UE side MAC entity
when sidelink is configured, and it should not restrict implementation.
Figure 4.2.1-3: MAC structure overview for sidelink, UE side
## 4.3 Services
### 4.3.1 Services provided to upper layers
This clause describes the different services provided by MAC sublayer to upper
layers.
\- data transfer
\- radio resource allocation
### 4.3.2 Services expected from physical layer
The physical layer provides the following services to MAC:
\- data transfer services;
\- signalling of HARQ feedback;
\- signalling of Scheduling Request;
\- measurements (e.g. Channel Quality Indication (CQI)).
The access to the data transfer services is through the use of transport
channels. The characteristics of a transport channel are defined by its
transport format (or format set), specifying the physical layer processing to
be applied to the transport channel in question, such as channel coding and
interleaving, and any service-specific rate matching as needed.
## 4.4 Functions
The following functions are supported by MAC sublayer:
\- mapping between logical channels and transport channels;
\- multiplexing of MAC SDUs from one or different logical channels onto
transport blocks (TB) to be delivered to the physical layer on transport
channels;
\- demultiplexing of MAC SDUs from one or different logical channels from
transport blocks (TB) delivered from the physical layer on transport channels;
\- scheduling information reporting;
\- error correction through HARQ;
\- priority handling between UEs by means of dynamic scheduling;
\- priority handling between logical channels of one MAC entity;
\- Logical Channel prioritisation;
\- transport format selection;
\- radio resource selection for SL.
The location of the different functions and their relevance for uplink and
downlink respectively is illustrated in Table 4.4-1.
Table 4.4-1: MAC function location and link direction association.
MAC function UE eNB Downlink Uplink Sidelink tx Sidelink rx
* * *
Mapping between logical channels and transport channels X X X X X X X X  
Multiplexing X X X  
X X  
Demultiplexing X X X X X  
Error correction through HARQ X X X X X X X X  
Transport Format Selection X X X  
X X X  
Priority handling between UEs X X X  
Priority handling between logical channels of one MAC entity X X X  
Logical Channel prioritisation X X X  
Scheduling information reporting X X  
Radio Resource Selection X X
## 4.5 Channel structure
The MAC sublayer operates on the channels defined below; transport channels
are SAPs between MAC and Layer 1, logical channels are SAPs between MAC and
RLC.
### 4.5.1 Transport Channels
The transport channels used by MAC are described in Table 4.5.1-1 below.
Table 4.5.1-1: Transport channels used by MAC
Transport channel name Acronym Downlink Uplink Sidelink tx Sidelink rx
* * *
Broadcast Channel BCH X  
Downlink Shared Channel DL-SCH X  
Paging Channel PCH X  
Multicast Channel MCH X  
Uplink Shared Channel UL-SCH X  
Random Access Channel RACH X  
Sidelink Broadcast Channel SL-BCH X X Sidelink Discovery Channel SL-DCH X X
Sidelink Shared Channel SL-SCH X X
### 4.5.2 Logical Channels
The MAC layer provides data transfer services on logical channels. A set of
logical channel types is defined for different kinds of data transfer services
as offered by MAC.
Each logical channel type is defined by what type of information is
transferred.
MAC provides the control and traffic channels listed in Table 4.5.2-1 below.
Table 4.5.2-1: Logical channels provided by MAC.
Logical channel name Acronym Control channel Traffic channel
* * *
Broadcast Control Channel BCCH X  
Bandwidth Reduced Broadcast Control Channel BR-BCCH X  
Paging Control Channel PCCH X  
Common Control Channel CCCH X  
Dedicated Control Channel DCCH X  
Multicast Control Channel MCCH X  
Single Cell Multicast Control Channel SC-MCCH X  
Dedicated Traffic Channel DTCH X Multicast Traffic Channel MTCH X Single-Cell
Multicast Traffic Channel SC-MTCH X Sidelink Traffic Channel STCH X Sidelink
Broadcast Control Channel SBCCH X
### 4.5.3 Mapping of Transport Channels to Logical Channels
The mapping of logical channels on transport channels depends on the
multiplexing that is configured by RRC.
#### 4.5.3.1 Uplink mapping
The MAC entity is responsible for mapping logical channels for the uplink onto
uplink transport channels. The uplink logical channels can be mapped as
described in Figure 4.5.3.1-1 and Table 4.5.3.1-1.
Figure 4.5.3.1-1
Table 4.5.3.1-1: Uplink channel mapping.
* * *
Transport channel\ UL-SCH RACH Logical channel
* * *
CCCH X
DCCH X
DTCH X
* * *
#### 4.5.3.2 Downlink mapping
The MAC entity is responsible for mapping the downlink logical channels to
downlink transport channels. The downlink logical channels can be mapped as
described in Figure 4.5.3.2-1 and Table 4.5.3.2-1.
Figure 4.5.3.2-1
Table 4.5.3.2-1: Downlink channel mapping.
* * *
Transport channel\ BCH PCH DL-SCH MCH Logical channel
* * *
BCCH X X
BR-BCCH X
PCCH X
CCCH X
DCCH X
DTCH X
MCCH X
MTCH X
SC-MCCH X
SC-MTCH X
* * *
#### 4.5.3.3 Sidelink mapping
The MAC entity is responsible for mapping the sidelink logical channels to
sidelink transport channels. The sidelink logical channels can be mapped as
described in Figure 4.5.3.3-1 and Table 4.5.3.3-1.
Figure 4.5.3.3-1
Table 4.5.3.3-1: Sidelink channel mapping.
* * *
Transport channel\ SL-SCH SL-BCH SL-DCH Logical channel
* * *
STCH X
SBCCH X
* * *
# 5 MAC procedures
## 5.1 Random Access procedure
### 5.1.1 Random Access Procedure initialization
The Random Access procedure described in this clause is initiated by a PDCCH
order, by the MAC sublayer itself or by the RRC sublayer. Random Access
procedure on an SCell shall only be initiated by a PDCCH order. If a MAC
entity receives a PDCCH transmission consistent with a PDCCH order, as
specified inTS 36.212 [5], masked with its C-RNTI, and for a specific Serving
Cell, the MAC entity shall initiate a Random Access procedure on this Serving
Cell. For Random Access on the SpCell a PDCCH order or RRC optionally indicate
the _ra-PreambleIndex_ and the _ra-PRACH-MaskIndex, except for NB-IoT where
the subcarrier index is indicated; and for Random Access on an SCell, the
PDCCH order indicates the ra-PreambleIndex_ with a value different from 000000
and the _ra-PRACH-MaskIndex_. For the pTAG preamble transmission on PRACH and
reception of a PDCCH order are only supported for SpCell. If the UE is an NB-
IoT UE, the Random Access procedure is performed on the anchor carrier or one
of the non-anchor carriers for which PRACH resource has been configured in
system information.
Before the procedure can be initiated, the following information for related
Serving Cell is assumed to be available for UEs other than NB-IoT UEs, BL UEs
or UEs in enhanced coverage, as specified in TS 36.331 [8], unless explicitly
stated otherwise:
\- the available set of PRACH resources for the transmission of the Random
Access Preamble, _prach-ConfigIndex_.
\- the groups of Random Access Preambles and the set of available Random
Access Preambles in each group (SpCell only):
The preambles that are contained in Random Access Preambles group A and Random
Access Preambles group B are calculated from the parameters _numberOfRA-
Preambles_ and _sizeOfRA-PreamblesGroupA_ :
If _sizeOfRA-PreamblesGroupA_ is equal to _numberOfRA-Preambles_ then there is
no Random Access Preambles group B. The preambles in Random Access Preamble
group A are the preambles 0 to _sizeOfRA-PreamblesGroupA_ \-- 1 and, if it
exists, the preambles in Random Access Preamble group B are the preambles
_sizeOfRA-PreamblesGroupA_ to _numberOfRA-Preambles_ \-- 1 from the set of 64
preambles as defined in TS 36.211 [7].
\- if Random Access Preambles group B exists, the thresholds,
_messagePowerOffsetGroupB_ and _messageSizeGroupA_ , the configured UE
transmitted power of the Serving Cell performing the Random Access Procedure,
P~CMAX,\ c~, as specified in TS 36.101 [10], and the offset between the
preamble and Msg3, _deltaPreambleMsg3_ , that are required for selecting one
of the two groups of Random Access Preambles (SpCell only).
\- the RA response window size _ra-ResponseWindowSize_.
\- the power-ramping factor _powerRampingStep_.
\- the maximum number of preamble transmission _preambleTransMax_.
\- the initial preamble power _preambleInitialReceivedTargetPower_.
\- the preamble format based offset DELTA_PREAMBLE (see clause 7.6).
\- the maximum number of Msg3 HARQ transmissions _maxHARQ-Msg3Tx_ (SpCell
only).
\- the Contention Resolution Timer _mac-ContentionResolutionTimer_ (SpCell
only).
NOTE 1: The above parameters may be updated from upper layers before each
Random Access procedure is initiated.
The following information for related Serving Cell is assumed to be available
before the procedure can be initiated for NB-IoT UEs, BL UEs or UEs in
enhanced coverage, as specified in TS 36.331 [8]:
\- if the UE is a BL UE or a UE in enhanced coverage:
\- the available set of PRACH resources associated with each enhanced coverage
level supported in the Serving Cell for the transmission of the Random Access
Preamble, _prach-ConfigIndex_.
\- for EDT, the available set of PRACH resources associated with EDT for each
enhanced coverage level supported in the Serving Cell for the transmission of
the Random Access Preamble, _prach-ConfigIndex_.
\- the groups of Random Access Preambles and the set of available Random
Access Preambles in each group(SpCell only):
\- except for EDT:
\- if _sizeOfRA-PreamblesGroupA_ is not equal to _numberOfRA-Preambles_ :
\- Random Access Preambles group A and B exist and are calculated as above;
\- else:
\- the preambles that are contained in Random Access Preamble groups for each
enhanced coverage level, if it exists, are the preambles _firstPreamble_ to
_lastPreamble_.
\- for EDT, the preambles that are contained in Random Access Preamble groups
for each enhanced coverage level, if it exists, are the preambles
_firstPreamble_ to _edt-LastPreamble_ if PRACH resources configured by _edt-
PRACH-ParametersCE_ are different from the PRACH resources configured by
_PRACH-ParametersCE_ for all enhanced coverage levels and _edt-PRACH-
ParametersCE_ for all other enhanced coverage levels, otherwise the preambles
for EDT are the preambles _lastPreamble_ +1 to _edt-LastPreamble_.
NOTE 2: When a PRACH resource is shared for multiple enhanced coverage levels,
and enhanced coverage levels are differentiated by different preamble indices,
Group A and Group B is not used for this PRACH resource.
\- if the UE is an NB-IoT UE:
\- the available set of PRACH resources supported in the Serving Cell on the
anchor carrier, _nprach-ParametersList_ , and on the non-anchor carriers, in
_ul-ConfigList_.
\- for EDT, the available set of PRACH resources associated with EDT on anchor
carrier, _nprach-ParametersList-EDT_ , and on the non-anchor carriers, in _ul-
ConfigList_.
\- for random access resource selection and preamble transmission:
\- a PRACH resource is mapped into an enhanced coverage level.
\- each PRACH resource contains a set of _nprach-NumSubcarriers_ subcarriers
which can be partitioned into one or two groups for single/multi-tone Msg3
transmission by _nprach-SubcarrierMSG3-RangeStart_ and _nprach-NumCBRA-
StartSubcarriers_ as specified in TS 36.211 [7], clause 10.1.6.1. Each group
is referred to as a Random Access Preamble group below in the procedure text.
\- a subcarrier is identified by the subcarrier index in the range:\ [_nprach-
SubcarrierOffset_ , _nprach-SubcarrierOffset_ \+ _nprach-NumSubcarriers_ -1]
\- each subcarrier of a Random Access Preamble group corresponds to a Random
Access Preamble.
\- when the subcarrier index is explicitly sent from the eNB as part of a
PDCCH order _ra-PreambleIndex_ shall be set to the signalled subcarrier index.
\- the mapping of the PRACH resources into enhanced coverage levels is
determined according to the following:
\- the number of enhanced coverage levels is equal to one plus the number of
RSRP thresholds present in _rsrp-ThresholdsPrachInfoList_.
\- each enhanced coverage level has one anchor carrier PRACH resource present
in _nprach-ParametersList_ and zero or one PRACH resource for each non-anchor
carrier signalled in _ul-ConfigList_.
\- for EDT, each enhanced coverage level has zero or one anchor carrier PRACH
resource present in _nprach-ParametersList-EDT_ and zero or one PRACH resource
for each non-anchor carrier signalled in _ul-ConfigList_.
\- enhanced coverage levels are numbered from 0 and the mapping of PRACH
resources to enhanced coverage levels are done in increasing
_numRepetitionsPerPreambleAttempt_ order.
\- when multiple carriers provide PRACH resources for the same enhanced
coverage level, the UE will randomly select one of them using the following
selection probabilities:
\- the selection probability of the anchor carrier PRACH resource for the
given enhanced coverage level, _nprach-ProbabilityAnchor_ , is given by the
corresponding entry in _nprach-ProbabilityAnchorList_
\- the selection probability is equal for all non-anchor carrier PRACH
resources and the probability of selecting one PRACH resource on a given non-
anchor carrier is (1- _nprach-ProbabilityAnchor_)/(number of non-anchor NPRACH
resources)
\- the criteria to select PRACH resources based on RSRP measurement per
enhanced coverage level supported in the Serving Cell _rsrp-
ThresholdsPrachInfoList_.
\- the maximum number of preamble transmission attempts per enhanced coverage
level supported in the Serving Cell _maxNumPreambleAttemptCE_.
\- the number of repetitions required for preamble transmission per attempt
for each enhanced coverage level supported in the Serving Cell
_numRepetitionPerPreambleAttempt_.
\- the configured UE transmitted power of the Serving Cell performing the
Random Access Procedure, P~CMAX,\ c~, as specified in TS 36.101 [10].
\- the RA response window size _ra-ResponseWindowSize_ and the Contention
Resolution Timer _mac-ContentionResolutionTimer_ (SpCell only) per enhanced
coverage level supported in the Serving Cell.
\- for EDT, the Contention Resolution Timer _mac-ContentionResolutionTimer_
configured for EDT (SpCell only) per enhanced coverage level supported in the
Serving Cell.
\- the power-ramping factor _powerRampingStep_ and optionally
_powerRampingStepCE1_.
\- the maximum number of preamble transmission _preambleTransMax-CE_.
\- the initial preamble power _preambleInitialReceivedTargetPower_ and
optionally _preambleInitialReceivedTargetPowerCE1_.
\- the preamble format based offset DELTA_PREAMBLE (see clause 7.6).
\- for NB-IoT, the use of contention free random access _ra-CFRA-Config_.
The Random Access procedure shall be performed as follows:
\- flush the Msg3 buffer;
\- set the PREAMBLE_TRANSMISSION_COUNTER to 1;
\- if the UE is an NB-IoT UE, a BL UE or a UE in enhanced coverage:
\- set the PREAMBLE_TRANSMISSION_COUNTER_CE to 1;
\- if the starting enhanced coverage level, or for NB-IoT the starting number
of NPRACH repetitions, has been indicated in the PDCCH order which initiated
the Random Access procedure, or if the starting enhanced coverage level has
been provided by upper layers:
\- the MAC entity considers itself to be in that enhanced coverage level
regardless of the measured RSRP;
\- else:
\- if the RSRP threshold of enhanced coverage level 3 is configured by upper
layers in _rsrp-ThresholdsPrachInfoList_ and the measured RSRP is less than
the RSRP threshold of enhanced coverage level 3 and the UE is capable of
enhanced coverage level 3 then:
\- the MAC entity considers to be in enhanced coverage level 3;
\- else if the RSRP threshold of enhanced coverage level 2 configured by upper
layers in _rsrp-ThresholdsPrachInfoList_ and the measured RSRP is less than
the RSRP threshold of enhanced coverage level 2 and the UE is capable of
enhanced coverage level 2 then:
\- the MAC entity considers to be in enhanced coverage level 2;
\- else if the measured RSRP is less than the RSRP threshold of enhanced
coverage level 1 as configured by upper layers in _rsrp-
ThresholdsPrachInfoList_ then:
\- the MAC entity considers to be in enhanced coverage level 1;
\- else:
\- the MAC entity considers to be in enhanced coverage level 0;
\- set the backoff parameter value to 0 ms;
\- for the RN, suspend any RN subframe configuration;
\- proceed to the selection of the Random Access Resource (see clause 5.1.2).
NOTE 3: There is only one Random Access procedure ongoing at any point in time
in a MAC entity. If the MAC entity receives a request for a new Random Access
procedure while another is already ongoing in the MAC entity, it is up to UE
implementation whether to continue with the ongoing procedure or start with
the new procedure.
NOTE 4: An NB-IoT UE measures RSRP on the anchor carrier.
### 5.1.2 Random Access Resource selection
The Random Access Resource selection procedure shall be performed as follows:
\- for BL UEs or UEs in enhanced coverage or NB-IoT UEs, if EDT is initiated
by the upper layers:
\- if the message size (UL data available for transmission plus MAC header
and, where required, MAC control elements) is larger than the TB size
signalled in _edt-TBS_ for the selected enhanced coverage level for EDT; or
\- if the PRACH resource associated with EDT for the selected enhanced
coverage level is not available:
\- indicate to upper layers that EDT is cancelled;
\- for BL UEs or UEs in enhanced coverage, select the PRACH resource set
corresponding to the selected enhanced coverage level. For EDT, the PRACH
resource set shall correspond to the set associated with EDT for the selected
enhanced coverage level.
\- if, except for NB-IoT, _ra-PreambleIndex_ (Random Access Preamble) and _ra-
PRACH-MaskIndex_ (PRACH Mask Index) have been explicitly signalled and _ra-
PreambleIndex_ is not 000000:
\- the Random Access Preamble and the PRACH Mask Index are those explicitly
signalled;
\- else if, for NB-IoT, _ra-PreambleIndex_ (Random Access Preamble) and PRACH
resource have been explicitly signalled:
\- the PRACH resource is that explicitly signalled;
\- if the _ra-PreambleIndex_ signalled is not 000000:
\- if _ra-CFRA-Config_ is configured:
\- the Random Access Preamble is set to _nprach-SubcarrierOffset_ \+ _nprach-
NumCBRA-StartSubcarriers_ \+ (_ra-PreambleIndex_ modulo (_nprach-
NumSubcarriers_ \- _nprach-NumCBRA-StartSubcarriers_)), where _nprach-
SubcarrierOffset_ , _nprach-NumCBRA-StartSubcarriers_ and _nprach-
NumSubcarriers_ are parameters in the currently used PRACH resource.
\- else:
\- the Random Access Preamble is set to _nprach-SubcarrierOffset_ \+ (_ra-
PreambleIndex_ modulo _nprach-NumSubcarriers_), where _nprach-
SubcarrierOffset_ and _nprach-NumSubcarriers_ are parameters in the currently
used PRACH resource.
\- else:
\- select the Random Access Preamble group according to the PRACH resource and
the support for multi-tone Msg3 transmission. A UE supporting multi-tone Msg3
shall only select the single-tone Msg3 Random Access Preambles group if there
is no multi-tone Msg3 Random Access Preambles group.
\- randomly select a Random Access Preamble within the selected group.
\- else the Random Access Preamble shall be selected by the MAC entity as
follows:
\- if the UE is a BL UE or UE in enhanced coverage and EDT is initiated:
\- select the Random Access Preambles group corresponding to PRACH resource
for EDT for the selected enhanced coverage level.
\- else if the UE is a BL UE or UE in enhanced coverage and Random Access
Preamble group B does not exist:
\- select the Random Access Preambles group corresponding to the selected
enhanced coverage level.
\- else if the UE is an NB-IoT UE:
\- if the UE supports carrier specific NRSRP thresholds for NPRACH resource
selection and _rsrp-ThresholdsPrachInfoList-r16_ is signalled for a carrier in
_ul-ConfigList_ :
\- if the measured RSRP is lower than the RSRP threshold corresponding to the
selected enhanced coverage level in _rsrp-ThresholdsPrachInfoList-r16_ :
\- do not consider the PRACH resource on this non-anchor carrier for PRACH
resource selection.
\- randomly select one of the PRACH resources corresponding to the selected
enhanced coverage level according to the configured probability distribution,
and select the Random Access Preambles group corresponding to the PRACH
resource and the support for multi-tone Msg3 transmission. A UE supporting
multi-tone Msg3 shall only select the single-tone Msg3 Random Access Preambles
group if there is no multi-tone Msg3 Random Access Preambles group. For EDT,
the PRACH resource shall correspond to resource associated with EDT for the
selected enhanced coverage level.
\- else if Msg3 has not yet been transmitted, the MAC entity shall:
\- if Random Access Preambles group B exists and any of the following events
occur:
\- the potential message size (UL data available for transmission plus MAC
header and, where required, MAC control elements) is greater than
_messageSizeGroupA_ and the pathloss is less than P~CMAX,c~ (of the Serving
Cell performing the Random Access Procedure) --
_preambleInitialReceivedTargetPower_ \-- _deltaPreambleMsg3_ \--
_messagePowerOffsetGroupB_ ;
\- the Random Access procedure was initiated for the CCCH logical channel and
the CCCH SDU size plus MAC header is greater than _messageSizeGroupA_ ;
\- select the Random Access Preambles group B;
\- else:
\- select the Random Access Preambles group A.
\- else, if Msg3 is being retransmitted, the MAC entity shall:
\- select the same group of Random Access Preambles as was used for the
preamble transmission attempt corresponding to the first transmission of Msg3.
\- randomly select a Random Access Preamble within the selected group. The
random function shall be such that each of the allowed selections can be
chosen with equal probability;
\- except for NB-IoT, set PRACH Mask Index to 0.
\- determine the next available subframe containing PRACH permitted by the
restrictions given by the _prach-ConfigIndex_ (except for NB-IoT)_,_ the PRACH
Mask Index (except for NB-IoT, see clause 7.3), physical layer timing
requirements, as specified in TS 36.213 [2], and in case of NB-IoT, the
subframes occupied by PRACH resources related to a higher enhanced coverage
level (a MAC entity may take into account the possible occurrence of
measurement gaps when determining the next available PRACH subframe);
\- except for NB-IoT:
\- if the transmission mode is TDD and the PRACH Mask Index is equal to zero:
\- if _ra-PreambleIndex_ was explicitly signalled and it was not 000000 (i.e.,
not selected by MAC):
\- randomly select, with equal probability, one PRACH from the PRACHs
available in the determined subframe.
\- else:
\- randomly select, with equal probability, one PRACH from the PRACHs
available in the determined subframe and the next two consecutive subframes.
\- else:
\- determine a PRACH within the determined subframe in accordance with the
requirements of the PRACH Mask Index, if any.
\- for NB-IoT UEs, BL UEs or UEs in enhanced coverage, select the _ra-
ResponseWindowSize_ and _mac-ContentionResolutionTimer_ corresponding to the
selected enhanced coverage level and PRACH.
\- proceed to the transmission of the Random Access Preamble (see clause
5.1.3).
### 5.1.3 Random Access Preamble transmission
The random-access procedure shall be performed as follows:
\- set PREAMBLE_RECEIVED_TARGET_POWER to _preambleInitialReceivedTargetPower_
\+ DELTA_PREAMBLE + (PREAMBLE_TRANSMISSION_COUNTER -- 1) * _powerRampingStep_
;
\- if the UE is a BL UE or a UE in enhanced coverage:
\- the PREAMBLE_RECEIVED_TARGET_POWER is set to:\
PREAMBLE_RECEIVED_TARGET_POWER - 10 *
log10(_numRepetitionPerPreambleAttempt_);
\- if the UE is an NB-IoT UE:
\- for enhanced coverage level 0, the PREAMBLE_RECEIVED_TARGET_POWER is set
to:\ PREAMBLE_RECEIVED_TARGET_POWER - 10 *
log10(_numRepetitionPerPreambleAttempt_)
\- for FDD if the UE supports enhanced random access power control and
_PowerRampingParameters-NB-v1450_ is configured by upper layers, or for TDD:
\- the MSG3_RECEIVED_TARGET_POWER is set to
_preambleInitialReceivedTargetPower_ \+ (PREAMBLE_TRANSMISSION_COUNTER_CE --
1) * _powerRampingStep_ ;
\- for other enhanced coverage levels:
\- for FDD if the UE supports enhanced random access power control and
_PowerRampingParameters-NB-v1450_ is configured by upper layers, or for TDD;
and
\- if the starting enhanced coverage level was enhanced coverage level 0 or
enhanced coverage level 1:
\- if the MAC entity considers itself to be in enhanced coverage level 1 and
if _powerRampingStepCE1_ and _preambleInitialReceivedTargetPowerCE1_ have been
configured by upper layers:
\- the PREAMBLE_RECEIVED_TARGET_POWER is set to
_preambleInitialReceivedTargetPowerCE1_ \+ DELTA_PREAMBLE +
(PREAMBLE_TRANSMISSION_COUNTER_CE -- 1) * _powerRampingStepCE1_ \- 10 *
log10(_numRepetitionPerPreambleAttempt_);
\- the MSG3_RECEIVED_TARGET_POWER is set to
_preambleInitialReceivedTargetPowerCE1_ \+ (PREAMBLE_TRANSMISSION_COUNTER_CE
-- 1) * _powerRampingStepCE1_ ;
\- else:
\- the PREAMBLE_RECEIVED_TARGET_POWER is set to
_preambleInitialReceivedTargetPower_ \+ DELTA_PREAMBLE +
(PREAMBLE_TRANSMISSION_COUNTER_CE -- 1) * _powerRampingStep_ \- 10 *
log10(_numRepetitionPerPreambleAttempt_);
\- the MSG3_RECEIVED_TARGET_POWER is set to
_preambleInitialReceivedTargetPower_ \+ (PREAMBLE_TRANSMISSION_COUNTER_CE --
1) * _powerRampingStep_ ;
\- else:
\- the PREAMBLE_RECEIVED_TARGET_POWER is set corresponding to the max UE
output power;
\- if the UE is an NB-IoT UE, a BL UE or a UE in enhanced coverage:
\- instruct the physical layer to transmit a preamble with the number of
repetitions required for preamble transmission corresponding to the selected
preamble group (i.e., _numRepetitionPerPreambleAttempt_) using the selected
PRACH corresponding to the selected enhanced coverage level, corresponding RA-
RNTI, preamble index or for NB-IoT subcarrier index, and
PREAMBLE_RECEIVED_TARGET_POWER.
\- else:
\- instruct the physical layer to transmit a preamble using the selected
PRACH, corresponding RA-RNTI, preamble index and
PREAMBLE_RECEIVED_TARGET_POWER.
### 5.1.4 Random Access Response reception
Once the Random Access Preamble is transmitted and regardless of the possible
occurrence of a measurement gap or a Sidelink Discovery Gap for Transmission
or a Sidelink Discovery Gap for Reception, and regardless of the
prioritization of V2X sidelink communication described in clause 5.14.1.2.2,
the MAC entity shall monitor the PDCCH of the SpCell for Random Access
Response(s) identified by the RA-RNTI defined below, in the RA Response window
which starts at the subframe that contains the end of the preamble
transmission,as specified in TS 36.211 [7], plus three subframes and has
length _ra-ResponseWindowSize_. If the UE is a BL UE or a UE in enhanced
coverage, RA Response window starts at the subframe that contains the end of
the last preamble repetition plus three subframes and has length _ra-
ResponseWindowSize_ for the corresponding enhanced coverage level. If the UE
is an NB-IoT UE, RA Response window starts at the subframe that contains the
end of the last preamble repetition plus X subframes and has length _ra-
ResponseWindowSize_ for the corresponding enhanced coverage level, where value
X is determined from Table 5.1.4-1 based on the used preamble format and the
number of NPRACH repetitions.
Table 5.1.4-1: Subframes between preamble transmission and RA Response Window
in NB-IoT
TDD/FDD mode Preamble format Number of NPRACH repetitions X
* * *
FDD 0 or 1 >= 64 41 FDD 0 or 1 \= 16 41 FDD 2 \ where CURRENT_TTI = [(SFN * 10 * sTTI_Number_Per_Subframe) + subframe number
> * sTTI_Number_Per_Subframe + sTTI_number]. Refer to 5.10.1 for
> sTTI_Number_Per_Subframe and sTTI_number.
For BL UEs or UEs in enhanced coverage, CURRENT_TTI refers to the TTI where
first transmission of repetition bundle takes place.
When the MAC entity needs to read BCCH or BR-BCCH, the MAC entity may, based
on the scheduling information from RRC:
\- if the UE is a BL UE or a UE in enhanced coverage:
\- the redundancy version of the received downlink assignment for this TTI is
determined by _RV~K~_ = ceiling(3/2*_k_) modulo 4, where _k_ depends on the
type of system information message.
\- for _SystemInformationBlockType1-BR_
\- if number of repetitions for PDSCH carrying
_SystemInformationBlockType1-BR_ is 4, _k_ = floor(SFN/2) modulo 4, where SFN
is the system frame number.
\- else if number of repetitions for PDSCH carrying
_SystemInformationBlockType1-BR_ is 8, _k_ = SFN modulo 4, where SFN is the
system frame number.
\- else if number of repetitions for PDSCH carrying
_SystemInformationBlockType1-BR_ is 16, _k_ = (SFN*10+i) modulo 4, where SFN
is the system frame number, and _i_ denotes the subframe within the SFN.
NOTE: the set of subframes for _SystemInformationBlockType1-BR_ when number of
repetitions for PDSCH is 16 are given by Table 6.4.1-2 in TS 36.211 [7].
\- for _SystemInformation-BR_ messages, _k_ =_i_ modulo 4, _i_ =0,1,...,
_n~s~^w^_ \--1, where _i_ denotes the subframe number within the SI window
_n~s~^w^_ ;
\- indicate a downlink assignment and redundancy version for the dedicated
broadcast HARQ process to the HARQ entity for this TTI.
\- else if a downlink assignment for this TTI has been received on the PDCCH
for the SI-RNTI, except for NB-IoT;
\- if the redundancy version is not defined in the PDCCH format:
\- the redundancy version of the received downlink assignment for this TTI is
determined by _RV~K~_ = ceiling(3/2*_k_) modulo 4, where _k_ depends on the
type of system information message: for _SystemInformationBlockType1_ message,
_k_ = (SFN/2) modulo 4, where SFN is the system frame number; for
_SystemInformation_ messages, _k_ =_i_ modulo 4, _i_ =0,1,..., _n~s~^w^_ \--1,
where _i_ denotes the subframe number within the SI window _n~s~^w^_ ;
\- indicate a downlink assignment and redundancy version for the dedicated
broadcast HARQ process to the HARQ entity for this TTI.
When the MAC entity has SC-RNTI and/or G-RNTI, the MAC entity shall for each
TTI during which it monitors PDCCH for SC-RNTI as specified in TS 36.331 [8]
for UEs other than NB-IoT UEs, BL UEs or UEs in enhanced coverage and in
clause 5.7a for NB-IoT UEs, BL UEs or UEs in enhanced coverage and for G-RNTI
as specified in clause 5.7a and for each Serving Cell and cell that may be
additionally configured as a Serving Cell according to the UE capabilities:
\- if a downlink assignment for this TTI and this Serving Cell has been
received on the PDCCH for the MAC entity\'s SC-RNTI or G-RNTI:
\- attempt to decode the received data.
\- if the data which the MAC entity attempted to decode was successfully
decoded for this TB:
\- deliver the decoded MAC PDU to the disassembly and demultiplexing entity.
### 5.3.2 HARQ operation
#### 5.3.2.1 HARQ Entity
There is one HARQ entity at the MAC entity for each Serving Cell which
maintains a number of parallel HARQ processes. Each HARQ process is associated
with a HARQ process identifier. The HARQ entity directs HARQ information and
associated TBs received on the DL-SCH to the corresponding HARQ processes (see
clause 5.3.2.2).
The number of DL HARQ processes per HARQ entity is specified in TS 36.213 [2],
clause 7.
When the physical layer is configured for downlink spatial multiplexing, as
specified in TS 36.213 [2], one or two TBs are expected per TTI and they are
associated with the same HARQ process. Otherwise, one TB is expected per TTI.
For NB-IoT UEs or BL UEs or UEs in enhanced coverage, the parameter
DL_REPETITION_NUMBER provides the number of transmissions repeated in a
bundle. For each bundle, DL_REPETITION_NUMBER is set to a value provided by
lower layers. Within a bundle, after the initial (re)transmission,
DL_REPETITION_NUMBER-1 HARQ retransmissions follow. The HARQ feedback is
transmitted for the bundle and a downlink assignment corresponding to a new
transmission or a retransmission of the bundle is received after the last
repetition of the bundle. A retransmission of a bundle is also a bundle.
If the MAC entity is configured with _blindSlotSubslotPDSCH-Repetitions_ or
_blindSubframePDSCH-Repetitions_ on a serving cell (TS 36.331 [8]), the
parameter DL_REPETITION_NUMBER provides the number of transmissions repeated
in a bundle for a downlink assignment received on that serving cell. For each
bundle, DL_REPETITION_NUMBER and the redundancy version for each transmission
within a bundle are set to values provided by lower layers. Within a bundle,
after the initial (re-)transmission, DL_REPETITION_NUMBER-1 HARQ
retransmissions follow. The HARQ feedback is sent only one time for the bundle
and after the last transmission of the bundle.
In addition to the broadcast HARQ process, NB-IoT has one or two DL HARQ
processes.
The MAC entity shall:
\- If a downlink assignment has been indicated for this TTI; or
\- If this TTI is for a retransmission within a bundle:
\- allocate the TB(s) received from the physical layer and the associated HARQ
information to the HARQ process indicated by the associated HARQ information.
\- If a downlink assignment has been indicated for the broadcast HARQ process:
\- allocate the received TB to the broadcast HARQ process.
NOTE: In case of BCCH and BR-BCCH a dedicated broadcast HARQ process is used.
#### 5.3.2.2 HARQ process
For each TTI where a transmission takes place for the HARQ process, one or two
(in case of downlink spatial multiplexing) TBs and the associated HARQ
information are received from the HARQ entity.
For each received TB and associated HARQ information, the HARQ process shall:
\- if the NDI, when provided, has been toggled compared to the value of the
previous received transmission corresponding to this TB; or
\- if the HARQ process is equal to the broadcast process and if this is the
first received transmission for the TB according to the system information
schedule indicated by RRC; or
\- if this is the very first received transmission for this TB (i.e. there is
no previous NDI for this TB):
\- consider this transmission to be a new transmission.
\- else:
\- consider this transmission to be a retransmission.
The MAC entity then shall:
\- if this is a new transmission:
\- attempt to decode the received data.
\- else if this is a retransmission:
\- if the data for this TB has not yet been successfully decoded:
\- combine the received data with the data currently in the soft buffer for
this TB and attempt to decode the combined data.
\- if the data which the MAC entity attempted to decode was successfully
decoded for this TB; or
\- if the data for this TB was successfully decoded before:
\- if the HARQ process is equal to the broadcast process:
\- deliver the decoded MAC PDU to upper layers.
\- else if this is the first successful decoding of the data for this TB:
\- deliver the decoded MAC PDU to the disassembly and demultiplexing entity.
\- generate a positive acknowledgement (ACK) of the data in this TB.
\- else:
\- replace the data in the soft buffer for this TB with the data which the MAC
entity attempted to decode.
\- generate a negative acknowledgement (NACK) of the data in this TB.
\- if the HARQ process is associated with a transmission indicated with a
Temporary C-RNTI and the Contention Resolution is not yet successful (see
clause 5.1.5); or
\- if the HARQ process is equal to the broadcast process; or
\- if the HARQ process is not associated with a transmission indicated with a
PUR-RNTI and the _timeAlignmentTimer_ , associated with the TAG containing the
serving cell on which the HARQ feedback is to be transmitted, is stopped or
expired:
\- do not indicate the generated positive or negative acknowledgement to the
physical layer.
\- else:
\- indicate the generated positive or negative acknowledgement for this TB to
the physical layer.
The MAC entity shall ignore NDI received in all downlink assignments on PDCCH
for its Temporary C-RNTI when determining if NDI on PDCCH for its C-RNTI has
been toggled compared to the value in the previous transmission.
NOTE 1: When the MAC entity is configured with more than one serving cell, UE
behaviors for storing data to the soft buffer is specified in TS 36.213 [2].
NOTE 2: If the MAC entity receives a retransmission with a TB size different
from the last valid TB size signalled for this TB, the UE behavior is left up
to UE implementation.
### 5.3.3 Disassembly and demultiplexing
The MAC entity shall disassemble and demultiplex a MAC PDU as defined in
clause 6.1.2.
## 5.4 UL-SCH data transfer
### 5.4.1 UL Grant reception
In order to transmit on the UL-SCH the MAC entity must have a valid uplink
grant (except for non-adaptive HARQ retransmissions) which it may receive
dynamically on the PDCCH or in a Random Access Response or which may be
configured semi-persistently or preallocated by RRC or provided by RRC for
transmission using PUR (see clause 5.4.7). To perform requested transmissions,
the MAC layer receives HARQ information from lower layers. When the physical
layer is configured for uplink spatial multiplexing, the MAC layer can receive
up to two grants (one per HARQ process) for the same TTI from lower layers.
If the MAC entity has a C-RNTI, a Semi-Persistent Scheduling C-RNTI, a UL
Semi-Persistent Scheduling V-RNTI, a AUL C-RNTI, or a Temporary C-RNTI, the
MAC entity shall for each TTI and for each Serving Cell belonging to a TAG
that has a running _timeAlignmentTimer_ and for each grant received for this
TTI and for each SPS configuration that is indicated by the PDCCH addressed to
UL Semi-Persistent Scheduling V-RNTI; or if the MAC entity has Preconfigured
Uplink Resource RNTI, the MAC entity shall for each TTI and for each grant
received for this TTI:
\- if an uplink grant for this TTI and this Serving Cell has been received on
the PDCCH for the MAC entity\'s C-RNTI, Preconfigured Uplink Resource RNTI or
Temporary C-RNTI; or
\- if an uplink grant for this TTI has been received in a Random Access
Response:
\- if the uplink grant is for MAC entity\'s C-RNTI and if the previous uplink
grant delivered to the HARQ entity for the same HARQ process was either an
uplink grant received for the MAC entity\'s Semi-Persistent Scheduling C-RNTI,
for the MAC entity\'s UL Semi-Persistent Scheduling V-RNTI, or a configured
uplink grant for which the UL HARQ operation was not autonomous:
\- consider the NDI to have been toggled for the corresponding HARQ process
regardless of the value of the NDI.
\- deliver the uplink grant and the associated HARQ information to the HARQ
entity for this TTI.
\- else, if an uplink grant for this TTI has been received for this Serving
Cell on the PDCCH for the MAC entity\'s Semi-Persistent Scheduling C-RNTI or
for the MAC entity\'s UL Semi-Persistent Scheduling V-RNTI; or if an uplink
grant for this TTI has been received for this Serving Cell on the PDCCH for
the MAC entity\'s AUL C-RNTI:
\- if the NDI in the received HARQ information is 1:
\- consider the NDI for the corresponding HARQ process not to have been
toggled;
\- deliver the uplink grant and the associated HARQ information to the HARQ
entity for this TTI.
\- else if the NDI in the received HARQ information is 0:
\- if PDCCH contents indicate AUL release:
\- trigger an AUL confirmation;
\- if an uplink grant for this TTI has been configured:
\- consider the NDI bit for the corresponding HARQ process to have been
toggled;
\- deliver the configured uplink grant and the associated HARQ information to
the HARQ entity for this TTI;
\- else if PDCCH contents indicate AUL activation:
\- trigger an AUL confirmation;
\- store the uplink grant and the associated HARQ information as configured
uplink grant;
\- initialise (if not active) or re-initialise (if already active) the
configured uplink grant to start in this TTI and to recur according to rules
in clause 5.23;
\- consider the NDI bit for the corresponding HARQ process to have been
toggled;
\- deliver the configured uplink grant and the associated HARQ information to
the HARQ entity for this TTI.
\- else if PDCCH contents indicate SPS release:
\- if the MAC entity is configured with _skipUplinkTxSPS_ :
\- trigger an SPS confirmation;
\- if an uplink grant for this TTI has been configured:
\- consider the NDI bit for the corresponding HARQ process to have been
toggled;
\- deliver the configured uplink grant and the associated HARQ information to
the HARQ entity for this TTI;
\- else:
\- clear the corresponding configured uplink grant (if any).
\- else:
\- if the MAC entity is configured with _skipUplinkTxSPS_ :
\- trigger an SPS confirmation;
\- store the uplink grant and the associated HARQ information as configured
uplink grant;
\- initialise (if not active) or re-initialise (if already active) the
configured uplink grant to start in this TTI, or in TTI according to N=0 in
clause 5.10.2 for short TTI, and to recur according to rules in clause 5.10.2;
\- if UL HARQ operation is asynchronous, set the HARQ Process ID to the HARQ
Process ID associated with this TTI;
\- consider the NDI bit for the corresponding HARQ process to have been
toggled;
\- deliver the configured uplink grant and the associated HARQ information to
the HARQ entity for this TTI.
\- else, if an uplink grant for this TTI has been configured for the Serving
Cell and if UL HARQ operation is autonomous for the corresponding HARQ
process:
\- if the HARQ_FEEDBACK is set to ACK for the corresponding HARQ process or if
there is no uplink grant previously delivered to the HARQ entity for the same
HARQ process:
\- consider the NDI bit for the corresponding HARQ process to have been
toggled.
\- if the _aul-RetransmissionTimer_ is not running:
\- if there is no uplink grant previously delivered to the HARQ entity for the
same HARQ process; or
\- if the previous uplink grant delivered to the HARQ entity for the same HARQ
process was not an uplink grant received for the MAC entity\'s C-RNTI; or
\- if the HARQ_FEEDBACK is set to ACK for the corresponding HARQ process:
\- deliver the configured uplink grant, and the associated HARQ information to
the HARQ entity for this TTI.
\- else:
\- if this Serving Cell is the SpCell and an uplink grant for this TTI has
been preallocated for the SpCell; or
\- except for preconfigured uplink grant for PUR, if an uplink grant for this
TTI has been configured for this Serving Cell:
\- if UL HARQ operation is asynchronous, set the HARQ Process ID to the HARQ
Process ID associated with this TTI;
\- consider the NDI bit for the corresponding HARQ process to have been
toggled;
\- deliver the configured or preallocated uplink grant, and the associated
HARQ information to the HARQ entity for this TTI.
NOTE 1: The period of configured uplink grants is expressed in TTIs.
NOTE 2: If the MAC entity receives both a grant in a Random Access Response
and a grant for its C-RNTI or Semi persistent scheduling C-RNTI requiring
transmissions on the SpCell in the same UL subframe, the MAC entity may choose
to continue with either the grant for its RA-RNTI or the grant for its C-RNTI
or Semi persistent scheduling C-RNTI.
NOTE 3: When a configured uplink grant is indicated during a measurement gap
and indicates an UL-SCH transmission during a measurement gap, the MAC entity
processes the grant but does not transmit on UL-SCH. When a configured uplink
grant is indicated during a Sidelink Discovery gap for reception and indicates
an UL-SCH transmission during a Sidelink Discovery gap for transmission with a
SL-DCH transmission, the MAC entity processes the grant but does not transmit
on UL-SCH. When a configured uplink grant indicates an UL-SCH transmission
during a V2X sidelink communication transmission and transmission of V2X
sidelink communication is prioritized as described in clause 5.14.1.2.2, the
MAC entity processes the grant but does not transmit on UL-SCH.
NOTE 4: The NDI transmitted in the PDCCH for the MAC entity\'s AUL C-RNTI is
set to \'0\' (TS 36.212 [5]).
Except for NB-IoT, for configured uplink grants without _harq-ProcID-offset_ ,
if UL HARQ operation is not autonomous, the HARQ Process ID associated with
this TTI is derived from the following equation for asynchronous UL HARQ
operation:
\- if the TTI is a subframe TTI:
\- HARQ Process ID = [floor(CURRENT_TTI/semiPersistSchedIntervalUL)] modulo
_numberOfConfUlSPS-Processes,_
> where CURRENT_TTI=[(SFN * 10) + subframe number] and it refers to the
> subframe where the first transmission of a bundle takes place.
\- else:
\- HARQ Process ID = [floor(CURRENT_TTI/_semiPersistSchedIntervalUL-sTTI_)]
modulo _numberOfConfUlSPS-Processes-sTTI_ ,
> where CURRENT_TTI = [(SFN * 10 * sTTI_Number_Per_Subframe) + subframe number
> * sTTI_Number_Per_Subframe + sTTI_number] and it refers to the short TTI
> occasion where the first transmission of a bundle takes place. Refer to
> 5.10.2 for sTTI_Number_Per_Subframe and sTTI_number.
For preallocated uplink grants the HARQ Process ID associated with this TTI is
derived from the following equation for asynchronous UL HARQ operation:
HARQ Process ID = [floor(CURRENT_TTI/_ul-SchedInterval_)] modulo
_numberOfConfUL-Processes,_
where CURRENT_TTI=subframe number and it refers to the subframe where the
first transmission of a bundle takes place.
For configured uplink grants, if UL HARQ operation is autonomous, the HARQ
Process ID associated with this TTI for transmission on this Serving Cell is
selected by the UE implementation from the HARQ process IDs that are
configured for autonomous UL HARQ operation by upper layers in _aul-HARQ-
Processes_ (TS 36.331 [8]).
For configured uplink grants with _harq-ProcID-offset_ , the HARQ Process ID
associated with this TTI is derived from the following equation for
asynchronous UL HARQ operation:
\- if the TTI is a subframe TTI:
\- HARQ Process ID = [floor(CURRENT_TTI/_semiPersistSchedIntervalUL_)] modulo
_numberOfConfUlSPS-Processes_ \+ _harq-ProcID-offset_ ,
> where CURRENT_TTI = [(SFN * 10) + subframe number] and it refers to the
> subframe where the first transmission of a bundle takes place.
\- else:
\- HARQ Process ID = [floor(CURRENT_TTI/_semiPersistSchedIntervalUL-sTTI_)]
modulo _numberOfConfUlSPS-Processes-sTTI_ \+ harq-ProcID-offset,
where CURRENT_TTI = [(SFN * 10 * sTTI_Number_Per_Subframe) + subframe number *
sTTI_Number_Per_Subframe + sTTI_number] and it refers to the short TTI
occasion where the first transmission of a bundle takes place. Refer to 5.10.2
for sTTI_Number_Per_Subframe and sTTI_number. For NB-IoT, for configured
uplink grants for BSR, the HARQ Process ID is set to 0.
If the MAC entity is configured with Short Processing Time or short TTI and if
current_TTI is a subframe TTI, the HARQ Process ID associated with this TTI is
derived from the following equation for synchronous UL HARQ operation:
HARQ Process ID = [SFN * number_of_UL_PUSCH_SFs_per_radio_frame \+
index_of_UL_PUSCH_SF] modulo number_of_UL_HARQ_processes.
where number_of_UL_PUSCH_SFs_per_radio_frame is the number of subframes that
can be used for PUSCH (UL PUSCH subframe) per radio frame:
\- For FDD serving cells and serving cells operating according to Frame
structure Type 3, all 10 subframes in a radio frame represent UL PUSCH
subframes;
\- For TDD serving cells, all uplink subframes of the TDD UL/DL configuration
indicated by _tdd-Config_ , as specified in TS 36.331 [8] of the cell
represent UL PUSCH subframes and additionally the subframes including UpPTS if
the cell is configured with _symPUSCH-UpPts-r14_ ;
and index_of_UL_PUSCH_SF is the index of a subframe that can be used for PUSCH
within the radio frame, and number_of_UL_HARQ_processes is the number of
parallel HARQ processes per HARQ entity for subframe TTI as specified in TS
36.213 [2], clause 8.
### 5.4.2 HARQ operation
#### 5.4.2.1 HARQ entity
There is one HARQ entity at the MAC entity for each Serving Cell with
configured uplink, which maintains a number of parallel HARQ processes
allowing transmissions to take place continuously while waiting for the HARQ
feedback on the successful or unsuccessful reception of previous
transmissions.
The number of parallel HARQ processes per HARQ entity is specified in TS
36.213 [2], clause 8. NB-IoT has one or two UL HARQ processes.
When the physical layer is configured for uplink spatial multiplexing, as
specified in TS 36.213 [2], there are two HARQ processes associated with a
given TTI. Otherwise there is one HARQ process associated with a given TTI.
At a given TTI, if an uplink grant is indicated for the TTI, the HARQ entity
identifies the HARQ process(es) for which a transmission should take place. It
also routes the received HARQ feedback (ACK/NACK information), MCS and
resource, relayed by the physical layer, to the appropriate HARQ process(es).
In asynchronous HARQ operation, a HARQ process is associated with a TTI based
on the received UL grant except for UL grant in RAR. Except for NB-IoT UE
configured with a single HARQ process, each asynchronous HARQ process is
associated with a HARQ process identifier. For UL transmission with UL grant
in RAR and for transmission using PUR, HARQ process identifier 0 is used. HARQ
feedback is not applicable for asynchronous UL HARQ except if _mpdcch-UL-HARQ-
ACK-FeedbackConfig_ is configured.
In autonomous HARQ operation, HARQ feedback is applicable.
When TTI bundling is configured, the parameter TTI_BUNDLE_SIZE provides the
number of TTIs of a TTI bundle. TTI bundling operation relies on the HARQ
entity for invoking the same HARQ process for each transmission that is part
of the same bundle. Within a bundle HARQ retransmissions are non-adaptive and
triggered without waiting for feedback from previous transmissions according
to TTI_BUNDLE_SIZE. The HARQ feedback of a bundle is only received for the
last TTI of the bundle (i.e the TTI corresponding to TTI_BUNDLE_SIZE),
regardless of whether a transmission in that TTI takes place or not (e.g. when
a measurement gap occurs). A retransmission of a TTI bundle is also a TTI
bundle. TTI bundling is not supported when the MAC entity is configured with
one or more SCells with configured uplink.
Uplink HARQ operation is asynchronous for NB-IoT UEs, BL UEs or UEs in
enhanced coverage except for the repetitions within a bundle, in serving cells
configured with _pusch-EnhancementsConfig_ , serving cells operating according
to Frame Structure Type 3, for HARQ processes scheduled using short TTI, for
HARQ processes scheduled using Short Processing Time, and for HARQ processes
associated with an SPS configuration with _totalNumberPUSCH-SPS-STTI-UL-
Repetitions_ or _totalNumberPUSCH-SPS-UL-Repetitions_ except for the
repetitions within a bundle.
For serving cells configured with _pusch-EnhancementsConfig_ , NB-IoT UEs, BL
UEs or UEs in enhanced coverage, the parameter UL_REPETITION_NUMBER provides
the number of transmission repetitions within a bundle. For each bundle,
UL_REPETITION_NUMBER is set to a value provided by lower layers. Bundling
operation relies on the HARQ entity for invoking the same HARQ process for
each transmission that is part of the same bundle. Within a bundle HARQ
retransmissions are non-adaptive and are triggered without waiting for
feedback from previous transmissions according to UL_REPETITION_NUMBER. An
uplink grant corresponding to a new transmission of the bundle is only
received after the last repetiton of the bundle if _mpdcch-UL-HARQ-ACK-
FeedbackConfig_ is not configured. An uplink grant corresponding to a
retransmission of the bundle is only received after the last repetition of the
bundle. For UEs configured with _mpdcch-UL-HARQ-ACK-FeedbackConfig_ ,
repetitions within a bundle are stopped if an UL HARQ-ACK feedback or an
uplink grant corresponding to a new transmission of the bundle is received on
PDCCH during the bundle transmission. A retransmission of a bundle is also a
bundle.
For a SPS configuration with _totalNumberPUSCH-SPS-STTI-UL-Repetitions_ or
_totalNumberPUSCH-SPS-UL-Repetitions_ (TS 36.331 [8]), the parameter
_totalNumberPUSCH-SPS-STTI-UL-Repetitions_ or _totalNumberPUSCH-SPS-UL-
Repetitions_ provides the number of transmission repetitions within a
configured grant bundle. Bundling operation relies on the HARQ entity invoking
the same HARQ process for each transmission that is part of the same bundle.
Within a bundle HARQ retransmissions are non-adaptive and are triggered
without waiting for feedback from previous transmissions.
TTI bundling is not supported for RN communication with the E-UTRAN in
combination with an RN subframe configuration.
For transmission of Msg3 during Random Access (see clause 5.1.5) TTI bundling
does not apply. For UEs configured with _pusch-EnhancementsConfig_ performing
contention free Random Access, NB-IoT UEs, BL UEs or UEs in enhanced coverage,
uplink repetition bundling is used for transmission of Msg3.
For each TTI, the HARQ entity shall:
\- identify the HARQ process(es) associated with this TTI, and for each
identified HARQ process:
\- if an uplink grant has been indicated for this process and this TTI:
\- if the received grant was addressed neither to a Temporary C-RNTI nor to a
PUR-RNTI on PDCCH and if the NDI provided in the associated HARQ information
has been toggled compared to the value in the previous transmission of this
HARQ process; or
\- if the uplink grant was received on PDCCH for the C-RNTI and the HARQ
buffer of the identified process is empty; or
\- if the uplink grant was provided by RRC for transmission using PUR; or
\- if the uplink grant was received in a Random Access Response:
\- if there is a MAC PDU in the Msg3 buffer and the uplink grant was received
in a Random Access Response:
\- if the MAC PDU in the Msg3 buffer contains the Data Volume and Power
Headroom Report MAC control element:
\- the MAC entity shall update the Data Volume and Power Headroom Report MAC
control element in the MAC PDU in the Msg3 buffer.
\- if the UE is an NB-IoT UE and _cqi-Reporting_ is configured by upper
layers:
\- the MAC entity shall update the MAC PDU in the Msg3 buffer in accordance
with the DL channel quality measurement result.
\- obtain the MAC PDU to transmit from the Msg3 buffer.
\- else if the uplink grant is a configured grant with _totalNumberPUSCH-SPS-
STTI-UL-Repetitions_ or _totalNumberPUSCH-SPS-UL-Repetitions_ and if a
retransmission within a bundle is triggered for another configured grant with
_totalNumberPUSCH-SPS-STTI-UL-Repetitions_ or _totalNumberPUSCH-SPS-UL-
Repetitions_ in this TTI:
\- ignore the uplink grant.
\- else if the MAC entity is configured with _semiPersistSchedIntervalUL_
shorter than 10 subframes and if the uplink grant is a configured grant, and
if the HARQ buffer of the identified HARQ process is not empty, and if
HARQ_FEEDBACK of the identified HARQ process is NACK; or if the MAC entity is
configured with _ul-SchedInterval_ shorter than 10 subframes and if the uplink
grant is a preallocated uplink grant, and if the HARQ buffer of the identified
HARQ process is not empty, and if HARQ_FEEDBACK of the identified HARQ process
is NACK:
\- instruct the identified HARQ process to generate a non-adaptive
retransmission.
\- else:
\- if the UL HARQ operation is synchronous, and the uplink grant is a
preallocated uplink grant, and a MAC PDU has previously been obtained from the
\"Multiplexing and assembly\" entity during this handover attempt:
\- ignore the uplink grant;
\- else:
\- obtain the MAC PDU to transmit from the \"Multiplexing and assembly\"
entity, if any;
\- if a MAC PDU to transmit has been obtained:
\- deliver the MAC PDU and the uplink grant and the HARQ information to the
identified HARQ process;
\- instruct the identified HARQ process to trigger a new transmission.
\- else:
\- flush the HARQ buffer of the identified HARQ process.
\- else:
\- if the MAC entity is configured with _skipUplinkTxSPS_ and if the uplink
grant received on PDCCH was addressed to the Semi-Persistent Scheduling C-RNTI
or to the UL Semi-Persistent Scheduling V-RNTI and if the HARQ buffer of the
identified process is empty; or
\- if UL HARQ operation is autonomous for the identified HARQ process and if
the uplink grant is a configured UL grant and if the HARQ buffer of the
identified process is empty; or
\- if the previous uplink grant delivered to the HARQ entity for the same HARQ
process was a configured uplink grant for which the UL HARQ operation was
autonomous, and if the corresponding UL grant size was different from the UL
grant size indicated by the uplink grant for this TTI:
\- ignore the uplink grant;
\- else:
\- deliver the uplink grant and the HARQ information (redundancy version) to
the identified HARQ process;
\- if UL HARQ operation is autonomous for the identified HARQ process and if
the uplink grant is a configured UL grant:
\- instruct the identified HARQ process to generate a non adaptive
retransmission.
\- else:
\- instruct the identified HARQ process to generate an adaptive
retransmission.
\- else, if the HARQ buffer of this HARQ process is not empty:
\- instruct the identified HARQ process to generate a non-adaptive
retransmission;
\- if the non-adaptive retransmission collides with a transmission of another
HARQ process scheduled using Short Processing Time:
\- instruct the identified HARQ process to generate a positive acknowledgement
(ACK) of the data in the corresponding TB.
When determining if NDI has been toggled compared to the value in the previous
transmission the MAC entity shall ignore NDI received in all uplink grants on
PDCCH for its Temporary C-RNTI and PUR-RNTI.
#### 5.4.2.2 HARQ process
Each HARQ process is associated with a HARQ buffer.
For synchronous HARQ, each HARQ process shall maintain a state variable
CURRENT_TX_NB, which indicates the number of transmissions that have taken
place for the MAC PDU currently in the buffer, and a state variable
HARQ_FEEDBACK, which indicates the HARQ feedback for the MAC PDU currently in
the buffer. When the HARQ process is established, CURRENT_TX_NB shall be
initialized to 0.
The sequence of redundancy versions is 0, 2, 3, 1. The variable CURRENT_IRV is
an index into the sequence of redundancy versions. This variable is up-dated
modulo 4. For serving cells configured with _pusch-EnhancementsConfig_ , BL
UEs or UEs in enhanced coverage see clause 8.6.1 in TS 36.213 [2] for the
sequence of redundancy versions and redundancy version determination. For NB-
IoT UEs see clause 16.5.1.2 in TS 36.213 [2] for the sequence of redundancy
versions and redundancy version determination. For an SPS configuration with
_totalNumberPUSCH-SPS-STTI-UL-Repetitions_ or _totalNumberPUSCH-SPS-UL-
Repetitions_ (TS 36.331 [8]), the redundancy version for each transmission
within a bundle are determined by _rv-SPS-STTI-UL-Repetitions_ or _rv-SPS-UL-
Repetitions_ in the SPS configuration (TS 36.331 [8]).
For NB-IoT UEs, BL UEs or UEs in enhanced coverage for UL_REPETITION_NUMBER
for Mode B operation, the same redundancy version is used multiple times
before cycling to the next redundancy version as specified in clauses
16.5.1.2, 8.6.1 and 7.1.7.1 in TS 36.213 [2].
New transmissions are performed on the resource and with the MCS indicated on
PDCCH or Random Access Response. Adaptive retransmissions are performed on the
resource and, if provided, with the MCS indicated on PDCCH. Non-adaptive
retransmission is performed on the same resource and with the same MCS as was
used for the last made transmission attempt.
For synchronous HARQ, the MAC entity is configured with a maximum number of
HARQ transmissions and a maximum number of Msg3 HARQ transmissions by RRC:
_maxHARQ-Tx_ and _maxHARQ-Msg3Tx_ respectively. For transmissions on all HARQ
processes and all logical channels except for transmission of a MAC PDU stored
in the Msg3 buffer, the maximum number of transmissions shall be set to
_maxHARQ-Tx_. For transmission of a MAC PDU stored in the Msg3 buffer, the
maximum number of transmissions shall be set to _maxHARQ-Msg3Tx_.
For autonomous HARQ, each HARQ process shall maintain a state variable
HARQ_FEEDBACK, which indicates the HARQ feedback for the MAC PDU currently in
the buffer, and a timer _aul-RetransmissionTimer_ which prohibits new
transmission or retransmission for the same HARQ process on the configured
autonomous uplink when the timer is running.
When the HARQ feedback is received for this TB, the HARQ process shall:
\- set HARQ_FEEDBACK to the received value;
\- if running, stop the _aul-RetransmissionTimer_.
When an uplink grant addressed to C-RNTI is received for this HARQ process and
if the UL HARQ operation is autonomous, the HARQ process shall:
\- if running, stop the _aul-RetransmissionTimer_.
When PUSCH transmission is performed for this TB and if the uplink grant is a
configured grant for the MAC entity\'s AUL C-RNTI, the HARQ process shall:
\- start or restart the _aul-RetransmissionTimer_.
If the HARQ entity requests a new transmission, the HARQ process shall:
\- if UL HARQ operation is synchronous:
\- set CURRENT_TX_NB to 0;
\- set HARQ_FEEDBACK to NACK;
\- set CURRENT_IRV to 0;
\- else:
\- if UL HARQ operation is autonomous asychronous:
\- set HARQ_FEEDBACK to NACK.
\- if the uplink grant was addressed to the AUL C-RNTI:
\- set CURRENT_IRV to 0.
\- else:
\- set CURRENT_IRV to the index corresponding to the redundancy version value
provided in the HARQ information;
\- store the MAC PDU in the associated HARQ buffer;
\- store the uplink grant received from the HARQ entity;
\- generate a transmission as described below.
If the HARQ entity requests a retransmission, the HARQ process shall:
\- if UL HARQ operation is synchronous:
\- increment CURRENT_TX_NB by 1;
\- if the HARQ entity requests an adaptive retransmission:
\- store the uplink grant received from the HARQ entity;
\- set CURRENT_IRV to the index corresponding to the redundancy version value
provided in the HARQ information;
\- if UL HARQ operation is synchronous; or
\- if UL HARQ operation is autonomous:
\- set HARQ_FEEDBACK to NACK;
\- generate a transmission as described below.
\- else if the HARQ entity requests a non-adaptive retransmission:
\- if UL HARQ operation is asynchronous or HARQ_FEEDBACK = NACK:
\- if both _skipUplinkTxSPS_ and _fixedRV-NonAdaptive_ are configured and the
uplink grant of the initial transmission of this HARQ process was performed on
a configured grant and UL HARQ operation is not autonomous; or
\- if the uplink grant is a preallocated uplink grant:
\- set CURRENT_IRV to 0;
\- else if UL HARQ operation is autonomous:
\- set CURRENT_IRV to the index corresponding to the redundancy version value
selected by the UE implementation.
\- generate a transmission as described below.
NOTE 1: When receiving a HARQ ACK alone, the MAC entity keeps the data in the
HARQ buffer.
NOTE 2: When no UL-SCH transmission can be made due to the occurrence of a
measurement gap or a Sidelink Discovery Gap for Transmission, or
prioritization of V2X sidelink communication transmission described in clause
5.14.1.2.2, no HARQ feedback can be received and a non-adaptive retransmission
follows.
NOTE 3: For asynchronous HARQ operation, UL retransmissions are triggered only
by adaptive retransmission grants, except for retransmissions within a bundle.
To generate a transmission, the HARQ process shall:
\- if the MAC PDU was obtained from the Msg3 buffer; or
\- if Sidelink Discovery Gaps for Transmission are not configured by upper
layers, and there is no measurement gap at the time of the transmission and,
in case of retransmission, the retransmission does not collide with a
transmission for a MAC PDU obtained from the Msg3 buffer in this TTI; or
\- if Sidelink Discovery Gaps for Transmission are configured by upper layers,
and there is no measurement gap at the time of the transmission and, in case
of retransmission, the retransmission does not collide with a transmission for
a MAC PDU obtained from the Msg3 buffer, and there is no Sidelink Discovery
Gap for Transmission in this TTI; or
\- if Sidelink Discovery Gaps for Transmission are configured by upper layers,
and there is no measurement gap at the time of the transmission and, in case
of retransmission, the retransmission does not collide with a transmission for
a MAC PDU obtained from the Msg3 buffer, and there is a Sidelink Discovery Gap
for Transmission, and there is no configured grant for transmission on SL-DCH
in this TTI:
\- if there is neither transmission of V2X sidelink communication on SL-SCH
nor transmission of NR sidelink communication in this TTI; or
\- if the transmission of the MAC PDU is prioritized over sidelink
transmission:
\- instruct the physical layer to generate a transmission according to the
stored uplink grant with the redundancy version corresponding to the
CURRENT_IRV value;
\- increment CURRENT_IRV by 1 if UL HARQ operation is not autonomous;
\- if UL HARQ operation is synchronous and there is a measurement gap or
Sidelink Discovery Gap for Reception at the time of the HARQ feedback
reception for this transmission and if the MAC PDU was not obtained from the
Msg3 buffer:
\- set HARQ_FEEDBACK to ACK at the time of the HARQ feedback reception for
this transmission.
After performing above actions, if UL HARQ operation is synchronous the HARQ
process then shall:
\- if CURRENT_TX_NB = maximum number of transmissions -- 1:
\- flush the HARQ buffer;
The transmission of the MAC PDU is prioritized over sidelink transmission or
can be performed simultaneously with sidelink transmission if one of the
following conditions is met:
\- if there are both a configured grant for transmission of V2X sidelink
communication on SL-SCH in this TTI and a sidelink grant for transmission of
NR sidelink communication as described in clause 5.22.1.1 of TS 38.321 [24] at
the time of the transmission, and neither the transmissions of V2X sidelink
communication is prioritized as described in clause 5.14.1.2.2 nor the
transmission of NR sidelink communication is prioritized as described in
clause 5.22.1.3.1a of TS 38.321 [24]; or
\- if there are both a configured grant for transmission of V2X sidelink
communication on SL-SCH in this TTI and a sidelink grant for transmission of
NR sidelink communication as described in clause 5.22.1.1 of TS 38.321 [24] at
the time of the transmission, and the MAC entity is able to perform this UL
transmission simultaneously with the transmissions of V2X sidelink
communication and/or the transmission of NR sidelink communication; or
\- if there is only configured grant(s) for transmission of V2X sidelink
communication on SL-SCH in this TTI, and either none of the transmissions of
V2X sidelink communication is prioritized or the MAC entity is able to perform
this UL transmission and the transmissions of V2X sidelink communication
simultaneously; or
\- if there is only a sidelink grant for transmission of NR sidelink
communication in this TTI as described in clause 5.22.1.1 of TS 38.321 [24],
and either no transmission of NR sidelink communication is prioritized as
described in clause 5.22.1.3.1a of TS 38.321 [24] or the MAC entity is able to
perform this UL transmission simultaneously with the transmission of NR
sidelink communication; or
\- if there are both a configured grant for transmission of V2X sidelink
communication on SL-SCH in this TTI and a sidelink grant for transmission of
NR sidelink communication as described in clause 5.22.1.1 of TS 38.321 [24] at
the time of the transmission, and either only the transmissions of V2X
sidelink communication is prioritized as described in clause 5.14.1.2.2 or
only the transmission of NR sidelink communication is prioritized as described
in clause 5.22.1.3.1a of TS 38.321 [24] and the MAC entity is able to perform
this UL transmission simultaneously with the prioritized transmission of V2X
sidelink communication or NR sidelink communication.
NOTE 4: Among the UL transmissions where the MAC entity is able to perform all
transmissions of V2X sidelink communication prioritized simultaneously, if
there are more than one UL transmission which the MAC entity is not able to
perform simultaneously, it is up to UE implementation whether this UL
transmission is performed.
NOTE 5: Among the UL transmissions that the MAC entity is able to perform
simultaneously with the transmission of NR sidelink communication prioritized,
if there are more than one UL transmission which the MAC entity is not able to
perform simultaneously, it is up to UE implementation whether this UL
transmission is performed.
NOTE 6: Among the UL transmissions where the MAC entity is able to perform all
transmissions of V2X sidelink communication prioritized simultaneously with
the transmission of NR sidelink communication prioritized, if there are more
than one UL transmission which the MAC entity is not able to perform
simultaneously, it is up to UE implementation whether this UL transmission is
performed.
NOTE 7: If there is a sidelink grant for transmission of NR sidelink
communication in this TTI as described in clause 5.22.1.1 of TS 38.321 [24]
and the MAC entity is not able to perform this UL transmission simultaneously
with the transmission of NR sidelink communication, and prioritization-related
information is not available prior to the time of the transmission due to
processing time restriction, it is up to UE implementation whether this UL
transmission is performed.
### 5.4.3 Multiplexing and assembly
#### 5.4.3.1 Logical channel prioritization
The Logical Channel Prioritization procedure is applied when a new
transmission is performed.
RRC controls the scheduling of uplink data by signalling for each logical
channel: _priority_ where an increasing _priority_ value indicates a lower
priority level, _prioritisedBitRate_ which sets the Prioritized Bit Rate
(PBR), _bucketSizeDuration_ which sets the Bucket Size Duration (BSD), and
optionally _allowedTTI-Lengths_ which sets the allowed TTI lengths. For NB-
IoT, _prioritisedBitRate_ , _bucketSizeDuration_ and the corresponding steps
of the Logical Channel Prioritisation procedure (i.e., Step 1 and Step 2
below) are not applicable.
The MAC entity shall maintain a variable Bj for each logical channel j. Bj
shall be initialized to zero when the related logical channel is established,
and incremented by the product PBR × TTI duration for each TTI, where PBR is
Prioritized Bit Rate of logical channel j. However, the value of Bj can never
exceed the bucket size and if the value of Bj is larger than the bucket size
of logical channel j, it shall be set to the bucket size. The bucket size of a
logical channel is equal to PBR × BSD, where PBR and BSD are configured by
upper layers.
Before the successful completion of the contention based Random Access
procedure initiated for DAPS handover, the target MAC entity shall not select
the logical channel(s) corresponding to non-DAPS DRB(s) for the uplink grant
received in a Random Access Response. The source MAC entity shall select only
the logical channel(s) corresponding to DAPS DRB(s) during DAPS handover.
The MAC entity shall perform the following Logical Channel Prioritization
procedure when a new transmission is performed on an UL grant with a certain
TTI length:
\- The MAC entity shall allocate resources to the logical channels that are
allowed to transmit using the TTI length of the grant, in the following steps:
\- Step 1: All the allowed logical channels with Bj > 0 are allocated
resources in a decreasing priority order. If the PBR of a logical channel is
set to \"infinity\", the MAC entity shall allocate resources for all the data
that is available for transmission on the logical channel before meeting the
PBR of the lower priority logical channel(s);
\- Step 2: the MAC entity shall decrement Bj by the total size of MAC SDUs
served to logical channel j in Step 1;
NOTE 1: The value of Bj can be negative.
\- Step 3: if any resources remain, all the allowed logical channels are
served in a strict decreasing priority order (regardless of the value of Bj)
until either the data for that logical channel or the UL grant is exhausted,
whichever comes first. Logical channels configured with equal priority should
be served equally.
\- The UE shall also follow the rules below during the scheduling procedures
above:
\- the UE should not segment an RLC SDU (or partially transmitted SDU or
retransmitted RLC PDU) if the whole SDU (or partially transmitted SDU or
retransmitted RLC PDU) fits into the remaining resources of the associated MAC
entity;
\- if the UE segments an RLC SDU from the logical channel, it shall maximize
the size of the segment to fill the grant of the associated MAC entity as much
as possible;
\- the UE should maximise the transmission of data.
\- if the MAC entity is given an UL grant size that is equal to or larger than
4 bytes while having data available for transmission, the MAC entity shall not
transmit only padding BSR and/or padding (unless the UL grant size is less
than 7 bytes and an AMD PDU segment needs to be transmitted);
\- for transmissions on serving cells operating according to Frame Structure
Type 3, the MAC entity shall only consider logical channels for which _laa-UL-
Allowed_ has been configured;
\- if a logical channel has been configured with _lch-CellRestriction_ and if
PDCP duplication within the same MAC entity (i.e. CA duplication) is
activated, for this logical channel the MAC entity shall consider the cells
indicated by _lch-CellRestriction_ to be restricted for transmission.
\- for NB-IoT UEs, BL UEs or UEs in enhanced coverage, if _edt-SmallTBS-
Enabled_ is set to _TRUE_ for the corresponding PRACH resource, the UE shall
choose a TB size among the set of possible TB sizes as described in clauses
8.6.2 and 16.3.3 of TS 36.213 [2]
The MAC entity shall not transmit data for a logical channel corresponding to
a radio bearer that is suspended (the conditions for when a radio bearer is
considered suspended are defined in TS 36.331 [8]).
If the MAC PDU includes only the MAC CE for padding BSR or periodic BSR with
zero MAC SDUs and there is no aperiodic CSI requested for this TTI, as
specified in TS 36.213 [2], the MAC entity shall not generate a MAC PDU for
the HARQ entity in the following cases:
\- in case the MAC entity is configured with _skipUplinkTxDynamic_ and the
grant indicated to the HARQ entity was addressed to a C-RNTI; or
\- in case the MAC entity is configured with _skipUplinkTxSPS_ and the grant
indicated to the HARQ entity is a configured uplink grant activated by the MAC
entity\'s Semi-Persistent Scheduling C-RNTI or by the MAC entity\'s UL Semi-
Persistent Scheduling V-RNTI; or
\- in case the grant indicated to the HARQ entity is a configured uplink grant
activated by the MAC entity\'s AUL C-RNTI; or
\- in case the grant indicated to the HARQ entity is a preconfigured uplink
grant.
NOTE 1a: If at least one MAC PDU is to be generated for the HARQ entity for
this TTI, the MAC entity generates MAC PDUs corresponding to all UL grants
indicated to the HARQ entity for this TTI.
For the Logical Channel Prioritization procedure, the MAC entity shall take
into account the following relative priority in decreasing order:
\- MAC control element for C-RNTI or data from UL-CCCH;
\- MAC control element for DPR;
\- MAC control element for SPS confirmation;
\- MAC control element for AUL confirmation;
\- MAC control element for BSR, with exception of BSR included for padding;
\- MAC control element for PHR, Extended PHR, or Dual Connectivity PHR;
\- MAC control element for Sidelink BSR, with exception of Sidelink BSR
included for padding;
\- MAC control element for DCQR and AS RAI, with exception of when DCQR is to
be included in Msg3;
\- data from any Logical Channel, except data from UL-CCCH;
\- MAC control element for DCQR and AS RAI, when DCQR is to be included in
Msg3;
\- MAC control element for Recommended bit rate query;
\- MAC control element for BSR included for padding;
\- MAC control element for Sidelink BSR included for padding.
When AS RAI has been triggered, DCQR and AS RAI MAC control element shall have
higher priority than data from any Logical Channel, except data from UL-CCCH,
only if after logical channel prioritization including AS RAI in the resulting
MAC PDU does not require segmenting RLC SDU. Otherwise data from any Logical
Channel shall have higher priority than DCQR and AS RAI MAC control element.
NOTE 2: When the MAC entity is requested to transmit multiple MAC PDUs in one
TTI, steps 1 to 3 and the associated rules may be applied either to each grant
independently or to the sum of the capacities of the grants. Also the order in
which the grants are processed is left up to UE implementation. It is up to
the UE implementation to decide in which MAC PDU a MAC control element is
included when MAC entity is requested to transmit multiple MAC PDUs in one
TTI. When the UE is requested to generate MAC PDU(s) in two MAC entities in
one TTI, it is up to UE implementation in which order the grants are
processed.
#### 5.4.3.2 Multiplexing of MAC Control Elements and MAC SDUs
The MAC entity shall multiplex MAC control elements and MAC SDUs in a MAC PDU
according to clauses 5.4.3.1 and 6.1.2.
### 5.4.4 Scheduling Request
The Scheduling Request (SR) is used for requesting UL-SCH resources for new
transmission.
When an SR is triggered, it shall be considered as pending until it is
cancelled. All pending SR(s) shall be cancelled and _sr-ProhibitTimer_ and
_ssr-ProhibitTimer_ shall be stopped when a MAC PDU is assembled and this PDU
includes a BSR which contains buffer status up to (and including) the last
event that triggered a BSR (see clause 5.4.5), or, if all pending SR(s) are
triggered by Sidelink BSR, when a MAC PDU is assembled and this PDU includes a
Sidelink BSR which contains buffer status up to (and including) the last event
that triggered a Sidelink BSR (see clause 5.14.1.4), or, if all pending SR(s)
are triggered by Sidelink BSR, when upper layers configure autonomous resource
selection, or when the UL grant(s) can accommodate all pending data available
for transmission.
If the MAC entity has resources for SR configured on only one of SPUCCH and
PUCCH, that SR resource is valid for all logical channels. If the MAC entity
has resources for SR configured on both PUCCH and SPUCCH, MAC entity shall
consider all logical channels that have triggered an SR (and at _retxBSR-
Timer_ expiry, MAC entity shall consider all logical channels, belonging to a
LCG, with data available for transmission):
\- PUCCH resources for SR are valid if _logicalChannelSr-Restriction_ is not
configured, or if _logicalChannelSr-Restriction_ allows SR on PUCCH, for any
of the logical channels;
\- SPUCCH resources for SR are valid if _logicalChannelSr-Restriction_ is not
configured, or if _logicalChannelSr-Restriction_ allows SR on SPUCCH, for any
of the logical channels.
If an SR is triggered and there is no other SR pending, the MAC entity shall
set the SR_COUNTER and the SSR_COUNTER to 0.
As long as one SR is pending, the MAC entity shall for each TTI:
\- if no UL-SCH resources are available for a transmission in this TTI:
\- Except for NB-IoT:
\- if the MAC entity has no valid PUCCH nor valid SPUCCH resource for SR
configured in any TTI:
\- if the MAC entity is a MCG MAC entity and _rach-Skip_ is not configured; or
\- if the MAC entity is a SCG MAC entity and _rach-SkipSCG_ is not configured:
\- initiate a Random Access procedure (see clause 5.1) on the corresponding
SpCell and cancel all pending SRs;
\- else if this TTI is not part of a measurement gap or Sidelink Discovery Gap
for Transmission, and if transmission of V2X sidelink communication is not
prioritized in this TTI as described in clause 5.14.1.2.2:
\- if the MAC entity has at least one valid SPUCCH resource for SR configured
for this TTI and if _ssr-ProhibitTimer_ is not running:
\- if SSR_COUNTER \ \- notify RRC to release PUCCH for all serving cells;
>
> \- notify RRC to release SRS for all serving cells;
>
> \- clear any configured downlink assignments and uplink grants;
>
> \- initiate a Random Access procedure (see clause 5.1) on the SpCell and
> cancel all pending SRs.
\- if the MAC entity has at least one valid PUCCH resource for SR configured
for this TTI and if _sr-ProhibitTimer_ is not running:
\- if SR_COUNTER \ \- else:
\- set Subframe_Offset to 0.
\- consider sequentially that the N^th^ grant occurs in the TTI for which:
\- subframe SPS is used:
\- (10 * SFN + subframe) = [(10 * SFN~start\ time~ + subframe~start\ time~) +
N * _semiPersistSchedIntervalUL_ \+ Subframe_Offset * (N modulo 2)] modulo
10240.
\- slot or subslot SPS is used:
\- (10 * SFN * sTTI_Number_Per_Subframe + subframe * sTTI_Number_Per_Subframe
+ sTTI_number) = [(10 * SFN~start\ time~ * sTTI_Number_Per_Subframe +
subframe~start\ time~ * sTTI_Number_Per_Subframe + _sTTIStartTimeUl_) + N *
_semiPersistSchedIntervalUL-sTTI_ \+ Subframe_Offset * (N modulo 2) *
sTTI_Number_Per_Subframe] modulo (10240 * sTTI_Number_Per_Subframe).
Where SFN~start\ time~, subframe~start\ time~ and _sTTIStartTimeUl_ are the
SFN, subframe and sTTI_number, respectively, at the time the configured uplink
grant were (re-)initialised. The sTTI_Number_Per_Subframe is 6 when subslot
TTI is configued and 2 when slot TTI is configured for short TTI operation.
sTTI_number refers to the index of the short TTI, i.e., index of subslot or
slot within the subframe.
Except for NB-IoT, for TDD, the MAC entity is configured with
_semiPersistSchedIntervalUL_ shorter than 10 subframes, the N^th^ grant shall
be ignored if it occurs in a downlink subframe or a special subframe.
Except for NB-IoT, if the MAC entity is not configured with _skipUplinkTxSPS_
, the MAC entity shall clear the configured uplink grant immediately after
_implicitReleaseAfter_ , as specified in TS 36.331 [8], number of consecutive
new MAC PDUs each containing zero MAC SDUs have been provided by the
Multiplexing and Assembly entity, on the Semi-Persistent Scheduling resource.
If SPS confirmation has been triggered and not cancelled:
\- if the MAC entity has UL resources allocated for new transmission for this
TTI:
\- instruct the Multiplexing and Assembly procedure to generate an SPS
confirmation MAC Control Element as defined in clause 6.1.3.11;
\- cancel the triggered SPS confirmation.
The MAC entity shall clear the configured uplink grant immediately after first
transmission of SPS confirmation MAC Control Element triggered by the SPS
release.
NOTE: Retransmissions for Semi-Persistent Scheduling can continue after
clearing the configured uplink grant.
For NB-IoT UEs, BL UEs or UEs in enhanced coverage SFN~start\ time~ and
subframe~start\ time~ refer to SFN and subframe of the first transmission of
PUSCH where configured uplink grant was (re-)initialized.
In the event of a resource conflict between multiple UL SPS configurations
configured with Uplink Semi-Persistent Scheduling V-RNTI, the UE behaviour is
undefined.
In the event of a resource conflict in the same serving cell between the
initial transmision within a configured grant bundle from multiple different
UL SPS configurations configured with Uplink Semi-Persistent Scheduling
C-RNTI, the UE behaviour is undefined.
For NB-IoT UEs, a configured uplink grant shall be used only for BSR or SPS
confirmation transmission, and _skipUplinkTxSPS_ is implicitly configured.
## 5.11 Handling of unknown, unforeseen and erroneous protocol data
When a MAC entity receives a MAC PDU for the MAC entity\'s C-RNTI or Semi-
Persistent Scheduling C-RNTI, or by the configured downlink assignment,
containing reserved or invalid values, the MAC entity shall:
\- discard the received PDU.
When a MAC entity receives a MAC PDU on MCH containing reserved values, or on
DL-SCH containing reserved values for G-RNTI or SC-RNTI, or on SL-SCH, the MAC
entity shall:
\- ignore the MAC PDU subheaders containing reserved values and the
corresponding MAC SDUs;
\- in the MAC control elements, ignore the fields containing reserved values
and the fields associated with the fields containing reserved values.
## 5.12 MCH reception
MCH transmission may occur in subframes configured by upper layer for MCCH or
MTCH transmission. For each such subframe, upper layer indicates if
_signallingMCS_ or _dataMCS_ applies. The transmission of an MCH occurs in a
set of subframes defined by _PMCH-Config_. An MCH Scheduling Information MAC
control element is included in the first subframe allocated to the MCH within
the MCH scheduling period to indicate the position of each MTCH and unused
subframes on the MCH. If _pmch-InfoListExt_ is configured for an MCH, an
Extended MCH Scheduling Information MAC control element is included in the
first subframe allocated to the corresponding MCH within the MCH scheduling
period to indicate the position of each MTCH and unused subframes on the MCH,
and to indicate whether MTCH transmission is to be suspended. The MAC entity
shall assume that the first scheduled MTCH starts immediately after the MCCH
or the MCH Scheduling Information MAC control element or the Extended MCH
Scheduling Information MAC control element if the MCCH is not present, and the
other scheduled MTCH(s) start immediately after the previous MTCH, at the
earliest in the subframe where the previous MTCH stops. When the MAC entity
needs to receive MCH, the MAC entity shall:
\- attempt to decode the TB on the MCH;
\- if a TB on the MCH has been successfully decoded:
\- demultiplex the MAC PDU and deliver the MAC SDU(s) to upper layers.
When the MAC entity receives the Extended MCH Scheduling Information MAC
control element, the MAC entity shall indicate the MTCH(s) to be suspended to
the upper layers.
NOTE: The MAC entity should continue receiving MCH until the MTCH is removed
from the MCCH.
## 5.13 Activation/Deactivation of SCells
If the MAC entity is configured with one or more SCells, the network may
activate and deactivate the configured SCells. The SpCell is always activated.
The network activates and deactivates the SCell(s) by sending
Activation/Deactivation and/or Hibernation MAC control element(s) described in
clause 6.1.3.8 and 6.1.3.15 respectively. Furthermore, the MAC entity
maintains a _sCellDeactivationTimer_ timer per configured SCell (except the
SCell configured with PUCCH/SPUCCH, if any) and deactivates the associated
SCell upon its expiry. In case the _sCellHibernationTimer_ is configured, it
takes priority over _sCellDeactivationTimer_. The same initial timer value
applies to each instance of the _sCellDeactivationTimer_ and it is configured
by RRC. The configured SCells are initially deactivated upon addition and
after a handover unless the parameter _sCellState_ is set to _activated_ or
_dormant_ for the SCell within RRC configuration. The configured SCG SCells
are initially deactivated after a SCG change unless the parameter _sCellState_
is set to _activated_ or _dormant_ for the SCell within RRC configuration.
The MAC entity shall for each TTI and for each configured SCell:
\- if the MAC entity is configured with an activated SCell upon SCell
configuration or receives MAC control element(s) in this TTI activating the
SCell, the MAC entity shall in the TTI according to the timing defined in TS
36.213 [2]:
\- activate the SCell; i.e. apply normal SCell operation including:
\- SRS transmissions on the SCell;
\- if _cqi-ShortConfigSCell_ is configured:
\- CQI/PMI/RI/PTI/CRI reporting for the SCell using the short period of the
CSI (CQI/PMI/RI/PTI/CRI) reporting resource configured by _cqi-
ShortConfigSCell_ according to the timing defined in TS 36.213 [2].
\- else:
\- CQI/PMI/RI/PTI/CRI reporting for the SCell using the configuration in _cqi-
ReportConfigSCell_.
\- PDCCH monitoring on the SCell;
\- PDCCH monitoring for the SCell;
\- PUCCH/SPUCCH transmissions on the SCell, if configured.
\- start or restart the _sCellDeactivationTimer_ associated with the SCell;
\- if _sCellHibernationTimer_ associated with the SCell is configured;
\- start or restart the _sCellHibernationTimer_ associated with the SCell.
\- trigger PHR according to clause 5.4.6.
\- else, if the MAC entity receives MAC control element(s) in this TTI
deactivating the SCell; or
\- if the _sCellDeactivationTimer_ associated with the activated SCell expires
in this TTI and _sCellHibernationTimer_ is not configured:
\- in the TTI according to the timing defined in TS 36.213 [2]:
\- deactivate the SCell;
\- stop the _sCellDeactivationTimer_ associated with the SCell;
\- clear any configured downlink assignments and uplink grants associated with
the SCell;
\- flush all HARQ buffers associated with the SCell.
\- if PDCCH on the activated SCell indicates an uplink grant or downlink
assignment; or
\- if PDCCH on the Serving Cell scheduling the activated SCell indicates an
uplink grant or a downlink assignment for the activated SCell; or
\- if a MAC PDU is transmitted in a configured uplink grant or received in a
configured downlink assignment:
\- restart the _sCellDeactivationTimer_ associated with the SCell;
\- if _sCellHibernationTimer_ associated with the SCell is configured;
\- restart the _sCellHibernationTimer_ associated with the SCell;
\- if the SCell is activated and the _cqi-ShortConfigSCell_ expires in this
TTI, according to the timing defined in TS 36.213 [2]:
\- apply SCell CQI/PMI/RI/PTI/CRI reporting for the SCell using the
configuration in _cqi-ReportConfigSCell_ ;
\- if the SCell is deactivated:
\- not transmit SRS on the SCell;
\- not report CQI/PMI/RI/PTI/CRI for the SCell;
\- not transmit on UL-SCH on the SCell;
\- not transmit on RACH on the SCell;
\- not monitor the PDCCH on the SCell;
\- not monitor the PDCCH for the SCell;
\- not transmit PUCCH/SPUCCH on the SCell.
HARQ feedback for the MAC PDU containing Activation/Deactivation MAC control
element shall not be impacted by PCell, PSCell and PUCCH SCell interruptions
due to SCell activation/deactivation, as specified in TS 36.133 [9].
NOTE: When SCell is deactivated, the ongoing Random Access procedure on the
SCell, if any, is aborted.
## 5.14 SL-SCH Data transfer
### 5.14.1 SL-SCH Data transmission
#### 5.14.1.1 SL Grant reception and SCI transmission
In order to transmit on the SL-SCH the MAC entity must have at least one
sidelink grant.
Sidelink grants are selected as follows for sidelink communication:
\- if the MAC entity is configured to receive a single sidelink grant
dynamically on the PDCCH and more data is available in STCH than can be
transmitted in the current SC period, the MAC entity shall:
\- using the received sidelink grant determine the set of subframes in which
transmission of SCI and transmission of first transport block occur according
to clause 14.2.1 of TS 36.213 [2];
\- consider the received sidelink grant to be a configured sidelink grant
occurring in those subframes starting at the beginning of the first available
SC Period which starts at least 4 subframes after the subframe in which the
sidelink grant was received, overwriting a previously configured sidelink
grant occurring in the same SC period, if available;
\- clear the configured sidelink grant at the end of the corresponding SC
Period;
\- else, if the MAC entity is configured by upper layers to receive multiple
sidelink grants dynamically on the PDCCH and more data is available in STCH
than can be transmitted in the current SC period, the MAC entity shall for
each received sidelink grant:
\- using the received sidelink grant determine the set of subframes in which
transmission of SCI and transmission of first transport block occur according
to clause 14.2.1 of TS 36.213 [2];
\- consider the received sidelink grant to be a configured sidelink grant
occurring in those subframes starting at the beginning of the first available
SC Period which starts at least 4 subframes after the subframe in which the
sidelink grant was received, overwriting a previously configured sidelink
grant received in the same subframe number but in a different radio frame as
this configured sidelink grant occurring in the same SC period, if available;
\- clear the configured sidelink grant at the end of the corresponding SC
Period;
\- else, if the MAC entity is configured by upper layers to transmit using one
or multiple pool(s) of resources as indicated in clause 5.10.4 of TS 36.331
[8] and more data is available in STCH than can be transmitted in the current
SC period, the MAC entity shall for each sidelink grant to be selected:
\- if configured by upper layers to use a single pool of resources:
\- select that pool of resources for use;
\- else, if configured by upper layers to use multiple pools of resources:
\- select a pool of resources for use from the pools of resources configured
by upper layers whose associated priority list includes the priority of the
highest priority of the sidelink logical channel in the MAC PDU to be
transmitted;
NOTE 1: If more than one pool of resources has an associated priority list
which includes the priority of the sidelink logical channel with the highest
priority in the MAC PDU to be transmitted, it is left for UE implementation
which one of those pools of resources to select.
\- randomly select the time and frequency resources for SL-SCH and SCI of a
sidelink grant from the selected resource pool. The random function shall be
such that each of the allowed selections (see TS 36.213 [2]) can be chosen
with equal probability;
\- use the selected sidelink grant to determine the set of subframes in which
transmission of SCI and transmission of first transport block occur according
to clause 14.2.1 of TS 36.213 [2];
\- consider the selected sidelink grant to be a configured sidelink grant
occurring in those subframes starting at the beginning of the first available
SC Period which starts at least 4 subframes after the subframe in which the
sidelink grant was selected;
\- clear the configured sidelink grant at the end of the corresponding SC
Period;
NOTE 2: Retransmissions on SL-SCH cannot occur after the configured sidelink
grant has been cleared.
NOTE 3: If the MAC entity is configured by upper layers to transmit using one
or multiple pool(s) of resources as indicated in clause 5.10.4 of TS 36.331
[8], it is left for UE implementation how many sidelink grants to select
within one SC period taking the number of sidelink processes into account.
Sidelink grants are selected as follows for V2X sidelink communication:
\- if the MAC entity is configured to receive a sidelink grant dynamically on
the PDCCH and data is available in STCH, the MAC entity shall for each carrier
configured in _sl-V2X-ConfigDedicated_ for which a sidelink grant has been
dynamically received on the PDCCH for this TTI:
\- use the received sidelink grant to determine the number of HARQ
retransmissions and the set of subframes in which transmission of SCI and SL-
SCH occur according to clauses 14.2.1 and 14.1.1.4A of TS 36.213 [2];
\- consider the received sidelink grant to be a configured sidelink grant for
the carrier;
\- if the MAC entity is configured by upper layers to receive a sidelink grant
on the PDCCH addressed to SL Semi-Persistent Scheduling V-RNTI, the MAC entity
shall for each SL SPS configuration and for each carrier configured in
_sl-V2X-ConfigDedicated_ for which a sidelink grant has been received on the
PDCCH addressed to SL Semi-Persistent Scheduling V-RNTI either for this TTI or
for this PDCCH occasion according to clause 3.1 of TS 38.321 [24]:
\- if PDCCH contents indicate SPS activation:
\- use the received sidelink grant to determine the number of HARQ
retransmissions and the set of subframes in which transmission of SCI and SL-
SCH occur according to clauses 14.2.1 and 14.1.1.4A of TS 36.213 [2];
\- consider the received sidelink grant to be a configured sidelink grant for
the carrier.
\- if PDCCH contents indicate SPS release:
\- clear the corresponding configured sidelink grant for the carrier.
\- if the MAC entity is configured by upper layers to transmit using pool(s)
of resources in one or multiple carriers as indicated in either clause
5.10.13.1 of TS 36.331 [8] or TS 38.331 [25] based on sensing, or partial
sensing, or random selection only if upper layers indicates that transmissions
of multiple MAC PDUs are allowed according to either clause 5.10.13.1a of TS
36.331 [8] or TS 38.331 [25], and the MAC entity selects to create a
configured sidelink grant corresponding to transmissions of multiple MAC PDUs,
and data is available in STCH associated with one or multiple carriers, the
MAC entity shall for each Sidelink process configured for multiple
transmissions:
\- if there is no configured sidelink grant associated with the Sidelink
process on any carrier allowed for the STCH as indicated by upper layers, as
specified in TS 24.386 [15]:
\- trigger the TX carrier (re-)selection procedure as specified in clause
5.14.1.5;
\- else if there is a configured sidelink grant associated with the Sidelink
process:
\- if SL_RESOURCE_RESELECTION_COUNTER = 0 and when
SL_RESOURCE_RESELECTION_COUNTER was equal to 1 the MAC entity randomly
selected, with equal probability, a value in the interval [0, 1] which is
above the probability configured by upper layers in _probResourceKeep_ ; or
\- if neither transmission nor retransmission has been performed by the MAC
entity on any resource indicated in the configured sidelink grant during the
last second; or
\- if _sl-ReselectAfter_ is configured and the number of consecutive unused
transmission opportunities on resources indicated in the configured sidelink
grant is equal to _sl-ReselectAfter_ ; or
\- if none of the configured sidelink grant(s) on the carrier(s) allowed for
the STCH have radio resources available in this TTI to accommodate a RLC SDU
according to clause 5.14.1.3.1 by using the maximum allowed MCS configured by
upper layers in _maxMCS-PSSCH_ and the MAC entity selects not to segment the
RLC SDU; or
NOTE 4: If none of the configured sidelink grant(s) on the carrier(s) allowed
for the STCH have radio resources available in this TTI to accommodate the RLC
SDU according to clause 5.14.1.3.1, it is left for UE implementation whether
to perform segmentation or sidelink resource reselection.
\- if none of the configured sidelink grant(s) on the carrier(s) allowed for
the STCH have radio resources available in this TTI, according to clause
5.14.1.3.1 to fulfil the latency requirement of the data in a sidelink logical
channel according to the associated PPPP, and the MAC entity selects not to
perform transmission(s) corresponding to a single MAC PDU; or
NOTE 5: If the latency requirement is not met, it is left for UE
implementation whether to perform transmission(s) corresponding to single MAC
PDU or sidelink resource reselection.
\- if the pool of resources where the sidelink grant is configured for the
Sidelink process, is reconfigured by upper layers:
\- trigger the TX carrier (re-)selection procedure as specified in clause
5.14.1.5;
\- clear the configured sidelink grant associated to the Sidelink process;
\- flush the HARQ buffer associated to the Sidelink process;
\- else if SL_RESOURCE_RESELECTION_COUNTER = 0 and when
SL_RESOURCE_RESELECTION_COUNTER was equal to 1 the MAC entity randomly
selected, with equal probability, a value in the interval [0, 1] which is less
than or equal to the probability configured by upper layers in
_probResourceKeep_ :
\- clear the configured sidelink grant, if available;
\- randomly select, with equal probability, an integer value in the interval
[5, 15] for the resource reservation interval higher than or equal to 100ms,
in the interval [10, 30] for the resource reservation interval equal to 50ms
or in the interval [25, 75] for the resource reservation interval equal to
20ms, and set SL_RESOURCE_RESELECTION_COUNTER to the selected value;
\- use the previously selected sidelink grant for the number of transmissions
of the MAC PDUs determined in clause 14.1.1.4B of TS 36.213 [2] with the
resource reservation interval to determine the set of subframes in which
transmissions of SCI and SL-SCH occur according to clauses 14.2.1 and
14.1.1.4B of TS 36.213 [2];
\- consider the selected sidelink grant to be a configured sidelink grant;
\- if the TX carrier (re-)selection procedure was triggered in above and one
or more carriers have been (re-)selected in the Tx carrier (re-)selection
according to clause 5.14.1.5:
\- determine the order of the (re-)selected carriers, according to the
decreasing order based on the highest priority of logical channels which are
allowed on each (re-)selected carrier, and perform the following for each
Sidelink process on each (re-)selected carrier according to the order:
\- select one of the allowed values configured by upper layers in
_restrictResourceReservationPeriod_ and set the resource reservation interval
by multiplying 100 with the selected value;
NOTE 6: How the UE selects this value is up to UE implementation.
\- randomly select, with equal probability, an integer value in the interval
[5, 15] for the resource reservation interval higher than or equal to 100ms,
in the interval [10, 30] for the resource reservation interval equal to 50ms
or in the interval [25, 75] for the resource reservation interval equal to
20ms, and set SL_RESOURCE_RESELECTION_COUNTER to the selected value;
\- select the number of HARQ retransmissions from the allowed numbers that are
configured by upper layers in _allowedRetxNumberPSSCH_ included in _pssch-
TxConfigList_ and, if configured by upper layers, overlapped in
_allowedRetxNumberPSSCH_ indicated in _cbr-pssch-TxConfigList_ for the highest
priority of the sidelink logical channel(s) allowed on the selected carrier
and the CBR measured by lower layers according to TS 36.214 [6] if CBR
measurement results are available or the corresponding _defaultTxConfigIndex_
configured by upper layers if CBR measurement results are not available;
\- select an amount of frequency resources within the range that is configured
by upper layers between _minSubchannel-NumberPSSCH_ and _maxSubchannel-
NumberPSSCH_ included in _pssch-TxConfigList_ and, if configured by upper
layers, overlapped between _minSubchannel-NumberPSSCH_ and _maxSubchannel-
NumberPSSCH_ indicated in _cbr-pssch-TxConfigList_ for the highest priority of
the sidelink logical channel(s) allowed on the selected carrier and the CBR
measured by lower layers according to TS 36.214 [6] if CBR measurement results
are available or the corresponding _defaultTxConfigIndex_ configured by upper
layers if CBR measurement results are not available;
\- randomly select the time and frequency resources for one transmission
opportunity from the resources indicated by the physical layer according to
clause 14.1.1.6 of TS 36.213 [2], according to the amount of selected
frequency resources. The selected time and frequency resources shall fulfil
the physical layer requirements as specified in TS 36.101 [10], and the random
function shall be such that each of the allowed selections can be chosen with
equal probability;
\- use the randomly selected resource to select a set of periodic resources
spaced by the resource reservation interval for transmission opportunities of
SCI and SL-SCH corresponding to the number of transmission opportunities of
MAC PDUs determined in clause 14.1.1.4B of TS 36.213 [2];
\- if the number of HARQ retransmissions is equal to 1:
\- if there are available resources left in the resources indicated by the
physical layer according to clause 14.1.1.6 of TS 36.213 [2] that meet the
conditions in clause 14.1.1.7 of TS 36.213 [2] for more transmission
opportunities:
\- randomly select the time and frequency resources for one transmission
opportunity from the available resources, according to the amount of selected
frequency resources. The selected time and frequency resources shall fulfil
the physical layer requirements as specified in TS 36.101 [10], and the random
function shall be such that each of the allowed selections can be chosen with
equal probability;
\- use the randomly selected resource to select a set of periodic resources
spaced by the resource reservation interval for the other transmission
opportunities of SCI and SL-SCH corresponding to the number of retransmission
opportunities of the MAC PDUs determined in clause 14.1.1.4B of TS 36.213 [2];
\- consider the first set of transmission opportunities as the new
transmission opportunities and the other set of transmission opportunities as
the retransmission opportunities;
\- consider the set of new transmission opportunities and retransmission
opportunities as the selected sidelink grant.
\- else:
\- consider the set as the selected sidelink grant;
\- use the selected sidelink grant to determine the set of subframes in which
transmissions of SCI and SL-SCH occur according to clause 14.2.1 and 14.1.1.4B
of TS 36.213 [2];
\- consider the selected sidelink grant to be a configured sidelink grant;
\- else, if the MAC entity is configured by upper layers to transmit using
pool(s) of resources in one or multiple carriers as indicated in either clause
5.10.13.1 of TS 36.331 [8] or TS 38.331 [25], the MAC entity selects to create
a configured sidelink grant corresponding to transmission(s) of a single MAC
PDU, and data is available in STCH associated with one or multiple carriers,
the MAC entity shall for a Sidelink process:
\- trigger the TX carrier (re-)selection procedure as specified in clause
5.14.1.5;
\- if one or more carriers have been (re-)selected in the Tx carrier
(re-)selection according to clause 5.14.1.5:
\- determine the order of the (re-)selected carriers, according to the
decreasing order based on the highest priority of logical channels which are
allowed on each (re-)selected carrier, and perform the following for each
Sidelink process on each (re-)selected carrier according to the order:
\- select the number of HARQ retransmissions from the allowed numbers that are
configured by upper layers in _allowedRetxNumberPSSCH_ included in _pssch-
TxConfigList_ and, if configured by upper layers, overlapped in
_allowedRetxNumberPSSCH_ indicated in _cbr-pssch-TxConfigList_ for the highest
priority of the sidelink logical channel(s) allowed on the selected carrier
and the CBR measured by lower layers according to TS 36.214 [6] if CBR
measurement results are available or the corresponding _defaultTxConfigIndex_
configured by upper layers if CBR measurement results are not available;
\- select an amount of frequency resources within the range that is configured
by upper layers between _minSubchannel-NumberPSSCH_ and _maxSubchannel-
NumberPSSCH_ included in _pssch-TxConfigList_ and, if configured by upper
layers, overlapped between _minSubchannel-NumberPSSCH_ and _maxSubchannel-
NumberPSSCH_ indicated in _cbr-pssch-TxConfigList_ for the highest priority of
the sidelink logical channel(s) allowed on the selected carrier and the CBR
measured by lower layers according to TS 36.214 [6] if CBR measurement results
are available or the corresponding _defaultTxConfigIndex_ configured by upper
layers if CBR measurement results are not available;
\- randomly select the time and frequency resources for one transmission
opportunity of SCI and SL-SCH from the resources indicated by the physical
layer according to clause 14.1.1.6 of TS 36.213 [2] , according to the amount
of selected frequency resources. The selected time and frequency resources
shall fulfil the physical layer requirement as specified in TS 36.101 [10],
and the random function shall be such that each of the allowed selections can
be chosen with equal probability;
\- if the number of HARQ retransmissions is equal to 1:
\- if there are available resources left in the resources indicated by the
physical layer according to clause 14.1.1.6 of TS 36.213 [2] that meet the
conditions in subcause 14.1.1.7 of TS 36.213 [2] for one more transmission
opportunity:
\- randomly select the time and frequency resources for the other transmission
opportunity of SCI and SL-SCH corresponding to additional transmission of the
MAC PDU from the available resources, according to the amount of selected
frequency resources. The selected time and frequency resources shall fulfil
the physical layer requirements as specified in TS 36.101 [10], and the random
function shall be such that each of the allowed selections can be chosen with
equal probability;
\- consider a transmission opportunity which comes first in time as the new
transmission opportunity and a transmission opportunity which comes later in
time as the retransmission opportunity;
\- consider both of the transmission opportunities as the selected sidelink
grant;
\- else:
\- consider the transmission opportunity as the selected sidelink grant;
\- use the selected sidelink grant to determine the subframes in which
transmission(s) of SCI and SL-SCH occur according to clause 14.2.1 and
14.1.1.4B of TS 36.213 [2];
\- consider the selected sidelink grant to be a configured sidelink grant.
NOTE 7: For V2X sidelink communication, the UE should ensure the randomly
selected time and frequency resources fulfill the latency requirement.
NOTE 8: For V2X sidelink communication, when there is no overlapping between
the chosen configuration(s) in _pssch-TxConfigList_ and chosen
configuration(s) indicated in _cbr-pssch-TxConfigList_ , it is up to UE
implementation whether the UE transmits and which transmitting parameters the
UE uses between allowed configuration(s) indicated in _pssch-TxConfigList_ and
allowed configuration(s) indicated in _cbr-pssch-TxConfigList_.
The MAC entity shall for each subframe:
\- for each configured sidelink grant occurring in this subframe:
\- if SL_RESOURCE_RESELECTION_COUNTER = 1 for the Sidelink process associated
with the configured sidelink grant and the MAC entity randomly selected, with
equal probability, a value in the interval [0, 1] which is above the
probability configured by upper layers in _probResourceKeep_ :
\- set the resource reservation interval for the configured sidelink grant
equal to 0;
\- if the configured sidelink grant corresponds to transmission of SCI:
\- for V2X sidelink communication in UE autonomous resource selection:
\- consider the selected transmission format to be _SL-V2X-TxProfile_ for the
highest priority of the sidelink logical channel(s) in the MAC PDU (TS 36.331
[8]);
\- select a MCS which is, if configured, within the range that is configured
by upper layers between _minMCS-PSSCH_ and _maxMCS-PSSCH_ included in _pssch-
TxConfigList_ associated with the selected transmission format and, if
configured by upper layers, overlapped between _minMCS-PSSCH_ and _maxMCS-
PSSCH_ indicated in _cbr-pssch-TxConfigList_ associated with the selected
transmission format for the highest priority of the sidelink logical
channel(s) in the MAC PDU and the CBR measured by lower layers according to TS
36.214 [6] if CBR measurement results are available or the corresponding
_defaultTxConfigIndex_ configured by upper layers if CBR measurement results
are not available;
> NOTE 9: MCS selection is up to UE implementation if the MCS or the
> corresponding range is not configured by upper layers.
>
> NOTE 10: For V2X sidelink communication, when there is no overlapping
> between the chosen configuration(s) included in _pssch-TxConfigList_ and
> chosen configuration(s) indicated in _cbr-pssch-TxConfigList_ , it is up to
> UE implementation whether the UE transmits and which transmitting parameters
> the UE uses between allowed configuration(s) indicated in _pssch-
> TxConfigList_ and allowed configuration(s) indicated in _cbr-pssch-
> TxConfigList_.
\- for V2X sidelink communication in scheduled resource allocation:
\- consider the selected transmission format to be _SL-V2X-TxProfile_ for the
highest priority of the sidelink logical channel(s) in the MAC PDU (TS 36.331
[8]);
\- select a MCS which is associated with the selected transmission format
unless it is configured by upper layer;
\- instruct the physical layer to transmit SCI corresponding to the configured
sidelink grant;
\- for V2X sidelink communication, deliver the configured sidelink grant, the
associated HARQ information and the value of the highest priority of the
sidelink logical channel(s) in the MAC PDU to the Sidelink HARQ Entity for
this subframe;
\- else if the configured sidelink grant corresponds to transmission of first
transport block for sidelink communication:
\- deliver the configured sidelink grant and the associated HARQ information
to the Sidelink HARQ Entity for this subframe.
NOTE 11: If the MAC entity has multiple configured sidelink grants occurring
in one subframe and if not all of them can be processed due to the single-
cluster SC-FDM restriction, it is left for UE implementation which one of
these to process according to the procedure above.
#### 5.14.1.2 Sidelink HARQ operation
##### 5.14.1.2.1 Sidelink HARQ Entity
The MAC entity is configured by upper layers to transmit using pool(s) of
resources on one or multiple carriers as indicated in clause 5.10.13.1 of TS
36.331 [8]. For each carrier, there is one Sidelink HARQ Entity at the MAC
entity for transmission on SL-SCH, which maintains a number of parallel
Sidelink processes.
For sidelink communication, the number of transmitting Sidelink processes
associated with the Sidelink HARQ Entity is defined in TS 36.331 [8].
For V2X sidelink communication, the maximum number of transmitting Sidelink
processes associated with each Sidelink HARQ Entity is 8. A sidelink process
may be configured for transmissions of multiple MAC PDUs. For transmissions of
multiple MAC PDUs, the maximum number of transmitting Sidelink processes
associated with each Sidelink HARQ Entity is 2.
A delivered and configured sidelink grant and its associated HARQ information
are associated with a Sidelink process.
For each subframe of the SL-SCH and each Sidelink process, the Sidelink HARQ
Entity shall:
\- if a sidelink grant corresponding to a new transmission opportunity has
been indicated for this Sidelink process and there is SL data, for sidelink
logical channels of ProSe destination associated with this sidelink grant,
available for transmission:
\- obtain the MAC PDU from the \"Multiplexing and assembly\" entity;
\- deliver the MAC PDU and the sidelink grant and the HARQ information to this
Sidelink process;
\- instruct this Sidelink process to trigger a new transmission.
\- else, if this subframe corresponds to retransmission opportunity for this
Sidelink process:
\- instruct this Sidelink process to trigger a retransmission.
NOTE: The resources for retransmission opportunities are specified in clause
14.2.1 of TS 36.213 [2] unless specified in clause 5.14.1.1.
##### 5.14.1.2.2 Sidelink process
The Sidelink process is associated with a HARQ buffer.
The sequence of redundancy versions is 0, 2, 3, 1. The variable CURRENT_IRV is
an index into the sequence of redundancy versions. This variable is updated
modulo 4.
New transmissions and retransmissions either for a given SC period in sidelink
communication or in V2X sidelink communication are performed on the resource
indicated in the sidelink grant as specified in clause 5.14.1.1 and with the
MCS selected as specified in clause 5.14.1.1.
If the sidelink process is configured to perform transmissions of multiple MAC
PDUs for V2X sidelink communication the process maintains a counter
SL_RESOURCE_RESELECTION_COUNTER. For other configurations of the sidelink
process, this counter is not available.
If the Sidelink HARQ Entity requests a new transmission, the Sidelink process
shall:
\- set CURRENT_IRV to 0;
\- store the MAC PDU in the associated HARQ buffer;
\- store the sidelink grant received from the Sidelink HARQ Entity;
\- generate a transmission as described below.
If the Sidelink HARQ Entity requests a retransmission, the Sidelink process
shall:
\- generate a transmission as described below.
To generate a transmission, the Sidelink process shall:
\- if there is no uplink transmission; or if the MAC entity is able to perform
uplink transmissions and transmissions on SL-SCH simultaneously at the time of
the transmission; or if there is a MAC PDU to be transmitted in this TTI in
uplink, except a MAC PDU obtained from the Msg3 buffer, and transmission of
V2X sidelink communication is prioritized over uplink transmission; and
\- if there is no Sidelink Discovery Gap for Transmission or no transmission
on PSDCH at the time of the transmission; or, in case of transmissions of V2X
sidelink communication, if the MAC entity is able to perform transmissions on
SL-SCH and transmissions on PSDCH simultaneously at the time of the
transmission:
\- instruct the physical layer to generate a transmission according to the
stored sidelink grant with the redundancy version corresponding to the
CURRENT_IRV value.
\- increment CURRENT_IRV by 1;
\- if this transmission corresponds to the last transmission of the MAC PDU:
\- decrement SL_RESOURCE_RESELECTION_COUNTER by 1, if available.
The transmission of the MAC PDU for V2X sidelink communication is prioritized
over uplink transmissions if the following conditions are met:
\- if the MAC entity is not able to perform all uplink transmissions and all
transmissions of V2X sidelink communication simultaneously at the time of the
transmission; and
\- if uplink transmission is not prioritized by upper layer according to TS
24.386 [15]; and
\- if _thresSL-TxPrioritization_ is configured and the value of the highest
priority of the sidelink logical channel(s) in the MAC PDU is lower than
_thresSL-TxPrioritization_.
#### 5.14.1.3 Multiplexing and assembly
For PDU(s) associated with one SCI, MAC shall consider only logical channels
with the same Source Layer-2 ID-Destination Layer-2 ID pair.
Multiple transmissions within overlapping SC periods to different ProSe
Destinations are allowed subject to single-cluster SC-FDM constraint.
In V2X sidelink communication, multiple transmissions for different Sidelink
processes are allowed to be independently performed in different subframes.
##### 5.14.1.3.1 Logical channel prioritization
The Logical Channel Prioritization procedure is applied when a new
transmission is performed. Each sidelink logical channel has an associated
priority which is the PPPP and optionally an associated PPPR. Multiple
sidelink logical channels may have the same associated priority. The mapping
between priority and LCID is left for UE implementation. If duplication is
activated as specified in TS 36.323 [4], the MAC entity shall map different
sidelink logical channels which correspond to the same PDCP entity onto
different carriers in accordance with clause 5.14.1.5, or onto different
carriers of different carrier sets (if configured in _allowedCarrierFreqList_
for the corresponding destination). For a given sidelink logical channel, it
is up to UE implementation which carrier set to select among the carrier sets
configured in _allowedCarrierFreqList_ (if configured) for the corresponding
destination.
The MAC entity shall perform the following Logical Channel Prioritization
procedure either for each SCI transmitted in an SC period in sidelink
communication, or for each SCI corresponding to a new transmission in V2X
sidelink communication:
\- The MAC entity shall allocate resources to the sidelink logical channels in
the following steps:
\- Only consider sidelink logical channels not previously selected for this SC
period and the SC periods (if any) which are overlapping with this SC period,
to have data available for transmission in sidelink communication;
\- Only consider sidelink logical channels which meet the following
conditions:
\- allowed on the carrier where the SCI is transmitted for V2X sidelink
communication, if the carrier is configured by upper layers according to TS
36.331 [8] and TS 24.386 [15];
\- having a priority whose associated _threshCBR-FreqReselection_ is no lower
than the CBR of the carrier when the carrier is (re-)selected in accordance
with 5.14.1.5;
\- Only consider one sidelink logical channel among sidelink logical channels
corresponding to same PDCP entity, if duplication is activated as specified in
TS 36.323 [4].
> \- Step 0: Select a ProSe Destination, having the sidelink logical channel
> with the highest priority, among the sidelink logical channels having data
> available for transmission and having the same transmission format as the
> one selected corresponding to the ProSe Destination;
NOTE: The sidelink logical channels belonging to the same ProSe Destination
have the same transmission format.
\- For each MAC PDU associated to the SCI:
\- Step 1: Among the sidelink logical channels belonging to the selected ProSe
Destination and having data available for transmission, allocate resources to
the sidelink logical channel with the highest priority;
\- Step 2: if any resources remain, sidelink logical channels belonging to the
selected ProSe Destination are served in decreasing order of priority until
either the data for the sidelink logical channel(s) or the SL grant is
exhausted, whichever comes first. Sidelink logical channels configured with
equal priority should be served equally.
\- The UE shall also follow the rules below during the scheduling procedures
above:
\- the UE should not segment an RLC SDU (or partially transmitted SDU) if the
whole SDU (or partially transmitted SDU) fits into the remaining resources;
\- if the UE segments an RLC SDU from the sidelink logical channel, it shall
maximize the size of the segment to fill the grant as much as possible;
\- the UE should maximise the transmission of data;
\- if the MAC entity is given a sidelink grant size that is equal to or larger
than 10 bytes (for sidelink communication) or 11 bytes (for V2X sidelink
communication) while having data available for transmission, the MAC entity
shall not transmit only padding.
##### 5.14.1.3.2 Multiplexing of MAC SDUs
The MAC entity shall multiplex MAC SDUs in a MAC PDU according to clauses
5.14.1.3.1 and 6.1.6.
#### 5.14.1.4 Buffer Status Reporting
The sidelink Buffer Status reporting procedure is used to provide the serving
eNB with information about the amount of sidelink data available for
transmission in the SL buffers associated with the MAC entity. RRC controls
BSR reporting for the sidelink by configuring the two timers _periodic-BSR-
TimerSL_ and _retx-BSR-TimerSL_. Each sidelink logical channel belongs to a
ProSe Destination. Each sidelink logical channel is allocated to an LCG
depending on the priority and optionally the PPPR of the sidelink logical
channel, and the mapping between LCG ID and priority and optionally the
mapping between LCG ID and PPPR which are provided by upper layers in
_logicalChGroupInfoList_ , as specified in TS 36.331 [8]. LCG is defined per
ProSe Destination.
A sidelink Buffer Status Report (BSR) shall be triggered if any of the
following events occur:
\- if the MAC entity has a configured SL-RNTI or a configured SL-V-RNTI:
\- SL data, for a sidelink logical channel of a ProSe Destination, becomes
available for transmission in the RLC entity or in the PDCP entity (the
definition of what data shall be considered as available for transmission is
specified in TS 36.322 [3] and TS 36.323 [4] respectively) and either the data
belongs to a sidelink logical channel with higher priority than the priorities
of the sidelink logical channels which belong to any LCG belonging to the same
ProSe Destination and for which data is already available for transmission, or
there is currently no data available for transmission for any of the sidelink
logical channels belonging to the same ProSe Destination, in which case the
Sidelink BSR is referred below to as \"Regular Sidelink BSR\";
\- UL resources are allocated and number of padding bits remaining after a
Padding BSR has been triggered is equal to or larger than the size of the
Sidelink BSR MAC control element containing the buffer status for at least one
LCG of a ProSe Destination plus its subheader, in which case the Sidelink BSR
is referred below to as \"Padding Sidelink BSR\";
\- _retx-BSR-TimerSL_ expires and the MAC entity has data available for
transmission for any of the sidelink logical channels, in which case the
Sidelink BSR is referred below to as \"Regular Sidelink BSR\";
\- _periodic-BSR-TimerSL_ expires, in which case the Sidelink BSR is referred
below to as \"Periodic Sidelink BSR\";
\- else:
\- An SL-RNTI or an SL-V-RNTI is configured by upper layers and SL data is
available for transmission in the RLC entity or in the PDCP entity (the
definition of what data shall be considered as available for transmission is
specified in TS 36.322 [3] and TS 36.323 [4] respectively), in which case the
Sidelink BSR is referred below to as \"Regular Sidelink BSR\".
For Regular and Periodic Sidelink BSR:
\- if the number of bits in the UL grant is equal to or larger than the size
of a Sidelink BSR containing buffer status for all LCGs having data available
for transmission plus its subheader:
\- report Sidelink BSR containing buffer status for all LCGs having data
available for transmission;
\- else report Truncated Sidelink BSR containing buffer status for as many
LCGs having data available for transmission as possible, taking the number of
bits in the UL grant into consideration.
For Padding Sidelink BSR:
\- if the number of padding bits remaining after a Padding BSR has been
triggered is equal to or larger than the size of a Sidelink BSR containing
buffer status for all LCGs having data available for transmission plus its
subheader:
\- report Sidelink BSR containing buffer status for all LCGs having data
available for transmission;
\- else report Truncated Sidelink BSR containing buffer status for as many
LCGs having data available for transmission as possible, taking the number of
bits in the UL grant into consideration.
If the Buffer Status reporting procedure determines that at least one Sidelink
BSR has been triggered and not cancelled:
\- if the MAC entity has UL resources allocated for new transmission for this
TTI and the allocated UL resources can accommodate a Sidelink BSR MAC control
element plus its subheader as a result of logical channel prioritization:
\- instruct the Multiplexing and Assembly procedure to generate the Sidelink
BSR MAC control element(s);
\- start or restart _periodic-BSR-TimerSL_ except when all the generated
Sidelink BSRs are Truncated Sidelink BSRs;
\- start or restart _retx-BSR-TimerSL_ ;
\- else if a Regular Sidelink BSR has been triggered:
\- if an uplink grant is not configured:
\- a Scheduling Request shall be triggered.
A MAC PDU shall contain at most one Sidelink BSR MAC control element, even
when multiple events trigger a Sidelink BSR by the time a Sidelink BSR can be
transmitted in which case the Regular Sidelink BSR and the Periodic Sidelink
BSR shall have precedence over the padding Sidelink BSR.
The MAC entity shall restart _retx-BSR-TimerSL_ upon reception of an SL grant.
All triggered regular Sidelink BSRs shall be cancelled in case the remaining
configured SL grant(s) valid for this SC Period can accommodate all pending
data available for transmission in sidelink communication or in case the
remaining configured SL grant(s) valid can accommodate all pending data
available for transmission in V2X sidelink communication. All triggered
Sidelink BSRs shall be cancelled in case the MAC entity has no data available
for transmission for any of the sidelink logical channels. All triggered
Sidelink BSRs shall be cancelled when a Sidelink BSR (except for Truncated
Sidelink BSR) is included in a MAC PDU for transmission. All triggered
Sidelink BSRs shall be cancelled, and _retx-BSR-TimerSL_ and _periodic-BSR-
TimerSL_ shall be stopped, when upper layers configure autonomous resource
selection.
The MAC entity shall transmit at most one Regular/Periodic Sidelink BSR in a
TTI. If the MAC entity is requested to transmit multiple MAC PDUs in a TTI, it
may include a padding Sidelink BSR in any of the MAC PDUs which do not contain
a Regular/Periodic Sidelink BSR.
All Sidelink BSRs transmitted in a TTI always reflect the buffer status after
all MAC PDUs have been built for this TTI. Each LCG shall report at the most
one buffer status value per TTI and this value shall be reported in all
Sidelink BSRs reporting buffer status for this LCG.
NOTE: A Padding Sidelink BSR is not allowed to cancel a triggered
Regular/Periodic Sidelink BSR. A Padding Sidelink BSR is triggered for a
specific MAC PDU only and the trigger is cancelled when this MAC PDU has been
built.
#### 5.14.1.5 TX carrier (re-)selection for V2X sidelink communication
The MAC entity shall consider a CBR of a carrier to be one measured by lower
layers according to TS 36.214 [6] if CBR measurement results are available, or
the corresponding _defaultTxConfigIndex_ configured by upper layers for the
carrier if CBR measurement results are not available.
If the TX carrier (re-)selection is triggered for a Sidelink process according
to clause 5.14.1.1, the MAC entity shall:
\- if there is no configured sidelink grant on any carrier allowed for the
sidelink logical channel where data is available as indicated by upper layers
(TS 36.331 [8] and TS 24.386 [15]):
\- for each carrier configured by upper layers associated with the concerned
sidelink logical channel:
\- if the CBR of the carrier is below _threshCBR-FreqReselection_ associated
with the priority of the sidelink logical channel:
\- consider the carrier as a candidate carrier for TX carrier (re-)selection
for the concerned sidelink logical channel.
\- else:
\- for each sidelink logical channel, if any, where data is available and that
are allowed on the carrier for which Tx carrier (re-)selection is triggered
according to clause 5.14.1.1:
\- if the CBR of the carrier is below _threshCBR-FreqKeeping_ associated with
priority of the sidelink logical channel:
\- select the carrier and the associated pool of resources.
\- else:
\- for each carrier configured by upper layers on which the sidelink logical
channel is allowed, if the CBR of the carrier is below _threshCBR-
FreqReselection_ associated with the priority of the sidelink logical channel;
\- consider the carrier as a candidate carrier for TX carrier (re-)selection.
The MAC entity shall:
\- if one or more carriers are considered as the candidate carriers for TX
carrier (re-)selection:
\- for each sidelink logical channel allowed on the carrier where data is
available and Tx carrier (re-)selection is triggered:
\- select one or more carrier(s) and associated pool(s) of resources among the
candidate carriers with increasing order of CBR from the lowest CBR.
NOTE 1: It is left to UE implementation how many carriers to select based on
UE capability.
NOTE 2: It is left to UE implementation to determine the sidelink logical
channels among the sidelink logical channels where data is available and that
are allowed on the carrier for which Tx carrier (re-) selection is triggered.
NOTE 3: If the MAC entity is configured by the upper layer to receive a
sidelink grant dynamically on the PDCCH, it is left to UE implementation to
determine which carriers configured by upper layer in _sl-V2X-ConfigDedicated_
, as specified in TS 36.331 [8] are considered as selected carriers for the
sidelink synchronization procedures in clauses 5.10.7, 5.10.8 and 5.10.8a of
TS 36.331 [8].
### 5.14.2 SL-SCH Data reception
#### 5.14.2.1 SCI reception
SCI transmitted on the PSCCH indicate if there is a transmission on SL-SCH and
provide the relevant HARQ information.
The MAC entity shall:
\- for each subframe during which the MAC entity monitors PSCCH:
\- if SCI for this subframe has been received on the PSCCH for sidelink
communication with a Group Destination ID of interest to this MAC entity:
\- determine the set of subframes in which reception of the first transport
blocks occur according to clause 14.2.2 of TS 36.213 [2] using the received
SCI;
\- store the SCI and associated HARQ information as SCI valid for the
subframes corresponding to first transmission of each transport block;
\- else if SCI for this subframe has been received on the PSCCH for V2X
sidelink communication:
\- determine the set of subframes in which reception of the transport block
occur according to clause 14.1.2 of TS 36.213 [2] using the received SCI;
\- store the SCI and associated HARQ information as SCI valid for the
subframes corresponding to transmission(s) of the transport block;
\- for each subframe for which the MAC entity has a valid SCI:
\- deliver the SCI and the associated HARQ information to the Sidelink HARQ
Entity.
#### 5.14.2.2 Sidelink HARQ operation
##### 5.14.2.2.1 Sidelink HARQ Entity
For each carrier, there is one Sidelink HARQ Entity at the MAC entity for
reception of the SL-SCH, which maintains a number of parallel Sidelink
processes.
Each Sidelink process is associated with SCI in which the MAC entity is
interested. If SCI includes the Group Destination ID, this interest is as
determined by the Group Destination ID of the SCI. The Sidelink HARQ Entity
directs HARQ information and associated TBs received on the SL-SCH to the
corresponding Sidelink processes.
The number of Receiving Sidelink processes associated with the Sidelink HARQ
Entity is defined in TS 36.331 [8].
For each subframe of the SL-SCH, the Sidelink HARQ Entity shall:
\- for each SCI valid in this subframe:
\- allocate the TB received from the physical layer and the associated HARQ
information to a Sidelink process, associate this Sidelink process with this
SCI and consider this transmission to be a new transmission.
\- for each Sidelink process:
\- if this subframe corresponds to retransmission opportunity for the Sidelink
process according to its associated SCI:
\- allocate the TB received from the physical layer and the associated HARQ
information to the Sidelink process and consider this transmission to be a
retransmission.
##### 5.14.2.2.2 Sidelink process
For each subframe where a transmission takes place for the Sidelink process,
one TB and the associated HARQ information is received from the Sidelink HARQ
Entity.
The sequence of redundancy versions is 0, 2, 3, 1. The variable CURRENT_IRV is
an index into the sequence of redundancy versions. This variable is updated
modulo 4.
For each received TB and associated HARQ information, the Sidelink process
shall:
\- if this is a new transmission:
\- set CURRENT_IRV to 0;
\- store the received data in the soft buffer and optionally attempt to decode
the received data according to CURRENT_IRV.
\- else if this is a retransmission:
\- if the data for this TB has not yet been successfully decoded:
\- increment CURRENT_IRV by 1;
\- combine the received data with the data currently in the soft buffer for
this TB and optionally attempt to decode the combined data according to the
CURRENT_IRV.
\- if the data which the MAC entity attempted to decode was successfully
decoded for this TB:
\- if this is the first successful decoding of the data for this TB:
\- if the DST field of the decoded MAC PDU subheader is equal to the 16 MSB of
any of the Destination Layer-2 ID(s) of the UE for which the 8 LSB are equal
to the Group Destination ID in the corresponding SCI:
\- deliver the decoded MAC PDU to the disassembly and demultiplexing entity.
\- else if the DST field of the decoded MAC PDU subheader is equal to any of
the Destination Layer-2 ID(s) of the UE:
\- deliver the decoded MAC PDU to the disassembly and demultiplexing entity.
#### 5.14.2.3 Disassembly and demultiplexing
The MAC entity shall disassemble and demultiplex a MAC PDU as defined in
clause 6.1.6.
## 5.15 SL-DCH data transfer
### 5.15.1 SL-DCH data transmission
#### 5.15.1.1 Resource allocation
In order to transmit MAC PDU(s) on SL-DCH, the MAC entity shall for every
discovery period and each MAC PDU:
\- if the MAC entity is configured by upper layers with a specific grant as
specified in TS 36.331 [8]:
\- using the specific grant determine the set of subframes in which a
transmission of new MAC PDU(s) occur according to clause 14.3.1 of TS 36.213
[2];
\- consider the determined set of subframes to be a configured grant for the
corresponding discovery period;
\- for every subframe, if the MAC entity has a configured grant occurring in
that subframe, deliver the configured grant and the MAC PDU to the Sidelink
HARQ Entity;
\- clear the configured grant at the end of the corresponding discovery
period.
NOTE: Mapping between grant and physical resources is specified in clause
9.5.6 of TS 36.211 [7].
\- else if the MAC entity is configured with a single pool of resources by
upper layers:
\- select a random value p1 in the range from 0 to 1, where the random
function shall be such that each of the allowed selections can be chosen with
equal probability;
\- if p1 is less than _txProbability_ :
\- select a random resource from the pool of resources (excluding any
resources which are overlapping with PRACH or resources belonging to the
subframes of resources already selected for transmissions on SL-DCH in this
discovery period), where the random function shall be such that each of the
allowed selections (see clause 14.3.1 of TS 36.213 [2]) can be chosen with
equal probability;
\- using the selected resource determine the set of subframes in which the
transmission of a MAC PDU can occur according to clause 14.3.1 of TS 36.213
[2]
\- consider the determined set of subframes to be a configured grant for the
corresponding discovery period;
\- for every subframe, if the MAC entity has a configured grant occurring in
that subframe, deliver the configured grant and the MAC PDU to the Sidelink
HARQ Entity;
\- clear the configured grant at the end of the corresponding discovery
period.
#### 5.15.1.2 Sidelink HARQ operation
##### 5.15.1.2.1 Sidelink HARQ Entity
There is one Sidelink HARQ Entity at the MAC entity for transmission on SL-
DCH, which maintains one Sidelink process for each MAC PDU.
For each subframe of the SL-DCH the Sidelink HARQ Entity shall:
\- if a grant and a MAC PDU has been delivered for this subframe to the
Sidelink HARQ Entity:
\- deliver the MAC PDU and the grant to the Sidelink process;
\- instruct the Sidelink process to trigger a new transmission.
\- else, if this subframe corresponds to retransmission opportunity for the
Sidelink process:
\- instruct the Sidelink process to trigger a retransmission.
##### 5.15.1.2.2 Sidelink process
The Sidelink process is associated with a HARQ buffer.
The Sidelink process shall maintain a state variable CURRENT_TX_NB, which
indicates the number of transmissions that have taken place for the MAC PDU
currently in the buffer. When the Sidelink process is established,
CURRENT_TX_NB shall be initialized to 0.
The sequence of redundancy versions is 0, 2, 3, 1. The variable CURRENT_IRV is
an index into the sequence of redundancy versions. This variable is up-dated
modulo 4.
The Sidelink process is configured with a maximum number of HARQ
retransmissions by RRC: _numRetx_.
If the Sidelink HARQ Entity requests a new transmission, the Sidelink process
shall:
\- set CURRENT_TX_NB to 0;
\- set CURRENT_IRV to 0;
\- store the MAC PDU in the associated HARQ buffer;
\- store the grant received from the Sidelink HARQ Entity;
\- generate a transmission as described below.
If the Sidelink HARQ Entity requests a retransmission, the Sidelink process
shall:
\- increment CURRENT_TX_NB by 1;
\- generate a transmission as described below.
To generate a transmission, the Sidelink process shall:
\- if there is no uplink transmission, no transmission or reception on PSCCH,
and no transmission or reception on PSSCH at the time of the transmission; or
\- if there is a Sidelink Discovery Gap for Transmission at the time of
transmission and if there is a MAC PDU to be transmitted in this TTI in
uplink, which is not obtained from the Msg3 buffer:
\- instruct the physical layer to generate a transmission according to the
grant with the redundancy version corresponding to the CURRENT_IRV value.
\- increment CURRENT_IRV by 1.
After performing above actions, the Sidelink process then shall:
\- if CURRENT_TX_NB = _numRetx_ :
\- flush the HARQ buffer.
### 5.15.2 SL-DCH data reception
#### 5.15.2.1 Sidelink HARQ operation
##### 5.15.2.1.1 Sidelink HARQ Entity
There is one Sidelink HARQ Entity at the MAC entity for reception on the SL-
DCH which maintains a number of parallel Sidelink processes. The Sidelink HARQ
Entity directs HARQ information and associated TBs received on the SL-DCH to
the corresponding Sidelink processes.
The number of receiving Sidelink processes per Sidelink HARQ Entity is
specified in TS 36.331 [8].
For each subframe of the SL-DCH, the Sidelink HARQ Entity shall:
\- receive the TB and the associated HARQ information from the physical layer;
\- if this subframe corresponds to a new transmission opportunity:
\- allocate the received TB (if any) and the associated HARQ information to a
non-running Sidelink process and consider this transmission to be a new
transmission.
\- else, if this subframe corresponds to a retransmission opportunity:
\- allocate the received TB (if any) and the associated HARQ information to
its Sidelink process and consider this transmission to be a retransmission.
##### 5.15.2.1.2 Sidelink process
For each subframe where a transmission takes place for the Sidelink process,
one TB and the associated HARQ information is received from the Sidelink HARQ
Entity.
The sequence of redundancy versions is 0, 2, 3, 1. The variable CURRENT_IRV is
an index into the sequence of redundancy versions. This variable is updated
modulo 4.
The Sidelink process shall:
\- if this subframe corresponds to a new transmission opportunity:
\- set CURRENT_IRV to 0;
\- else, if this subframe corresponds to a retransmission opportunity:
\- increment CURRENT_IRV by 1.
\- if a TB was allocated to the Sidelink process:
\- if this is a new transmission:
\- optionally store the received data in the soft buffer and attempt to decode
the received data according to the CURRENT_IRV.
\- else if this is a retransmission:
\- if the data for this TB has not yet been successfully decoded:
\- optionally combine the received data with the data currently in the soft
buffer for this TB and attempt to decode the combined data according to the
CURRENT_IRV.
\- if the data which the MAC entity attempted to decode was successfully
decoded for this TB:
\- if this is the first successful decoding of the data for this TB:
\- deliver the decoded MAC PDU to upper layers.
## 5.16 SL-BCH data transfer
### 5.16.1 SL-BCH data transmission
When instructed to send SL-BCH, the MAC entity shall:
\- obtain the MAC PDU to transmit from SBCCH;
\- deliver the MAC PDU to the physical layer and instruct it to generate a
transmission.
### 5.16.2 SL-BCH data reception
When the MAC entity needs to receive SL-BCH, the MAC entity shall:
\- receive and attempt to decode the SL-BCH;
\- if a TB on the SL-BCH has been successfully decoded:
\- deliver the decoded MAC PDU to upper layers.
## 5.17 Data inactivity monitoring
The MAC entity may be configured by RRC with a Data inactivity monitoring
functionality, when in RRC_CONNECTED. RRC controls Data inactivity operation
by configuring the timer _DataInactivityTimer_.
When _DataInactivityTimer_ is configured, the MAC entity shall:
\- if the MAC entity receives the MAC SDU for DTCH logical channel , DCCH
logical channel, or CCCH logical channel; or
\- if the MAC entity transmits the MAC SDU for DTCH logical channel, DCCH
logical channel;
\- start or restart _DataInactivityTimer_.
\- if _DataInactivityTimer_ expires, indicate the expiry of
_DataInactivityTimer_ to upper layers.
## 5.18 Recommended Bit Rate
The recommended bit rate procedure is used to provide the MAC entity with
information about the bit rate which the eNB recommends. The bit rate is the
_recommended_ bit rate of the physical layer. Averaging window of default
value 2000 ms will apply, as specified in TS 26.114 [16].
The eNB may transmit the Recommended bit rate MAC control element to the MAC
entity to indicate the recommended bit rate for the UE for a specific logical
channel and a specific direction (either uplink or downlink). Upon reception
of a Recommended bit rate MAC control element the MAC entity shall:
\- indicate to upper layers the recommended bit rate for the indicated logical
channel and direction
The MAC entity may request the eNB to indicate the recommended bit rate for a
specific logical channel and a specific direction. If the MAC entity is
requested by upper layers to query the eNB for the recommended bit rate for a
logical channel and for a direction (i.e. for uplink or downlink), the MAC
entity shall:
\- if a Recommended bit rate query for this logical channel and this direction
has not been triggered:
\- trigger a Recommended bit rate query for this logical channel, direction,
and desired bit rate.
If the MAC entity has UL resources allocated for new transmission for this TTI
the MAC entity shall:
\- for each Recommended bit rate query that the Recommended Bit Rate procedure
determines has been triggered and not cancelled:
\- if _bitRateQueryProhibitTimer_ for the logical channel and the direction of
this Recommended bit rate query is configured, and it is not running; and
\- if the MAC entity has UL resources allocated for new transmission for this
TTI and the allocated UL resources can accommodate a Recommended bit rate MAC
control element plus its subheader as a result of logical channel
prioritization:
\- instruct the Multiplexing and Assembly procedure to generate the
Recommended bit rate MAC control element for the logical channel and the
direction of this Recommended bit rate query;
\- start the _bitRateQueryProhibitTimer_ for the logical channel and the
direction of this Recommended bit rate query
\- cancel this Recommended bit rate query.
## 5.19 Activation/Deactivation of CSI-RS resources
The network may activate and deactivate the configured CSI-RS resources of a
serving cell by sending the Activation/Deactivation of CSI-RS resources MAC
control element described in clause 6.1.3.14. The configured CSI-RS resources
are initially deactivated upon configuration and after a handover.
The MAC entity shall for each TTI:
\- if the MAC entity receives an Activation/Deactivation of CSI-RS resources
MAC control element in this TTI on a serving cell, the MAC entity shall
indicate to lower layers the information regarding the Activation/Deactivation
of CSI-RS resources MAC control element:
## 5.20 Preallocated uplink grant
When the preallocated uplink grant is configured by RRC, the following
information is provided in _ul-ConfigInfo_ :
\- Uplink Scheduling interval _ul-SchedInterval_ , starting subframe _ul-
StartSubframe_ of the preallocated uplink grant, the uplink grant _ul-Grant_
and the number of HARQ process for the preallocated uplink grant
_numberOfConfUL-Processes_.
When the preallocated uplink grant configuration is released by RRC, the
corresponding preallocated uplink grant shall be discarded.
NOTE 1: When eIMTA is configured for the SpCell, if a preallocated grant
occurs in a subframe that can be reconfigured through eIMTA L1 signalling,
then the UE behaviour is left unspecified.
If _ul-ConfigInfo_ is configured, the MAC entity shall:
\- consider sequentially that the N^th^ grant occurs in the subframe for
which:
\- subframe = [N * _ul-SchedInterval_ \+ _ul-StartSubframe_] modulo 10.
For TDD, the MAC entity is configured with _ul-SchedInterval_ shorter than 10
subframes, the N^th^ grant shall be ignored if it occurs in a downlink
subframe or a special subframe.
NOTE 2: Retransmissions for uplink transmissions using the preallocated uplink
grant can continue after clearing the preallocated uplink grant.
## 5.21 SC-PTM Stop Indication
For NB-IoT UEs, BL UEs or UEs in enhanced coverage, the eNB may transmit the
SC-PTM Stop Indication MAC control element to the MAC entity to indicate that
the transmission of SC-MTCH associated with a G-RNTI is stopped as described
in clause 6.1.3.12.
Upon reception of the SC-PTM Stop Indication MAC control element associated
with a G-RNTI, the MAC entity shall:
\- stop monitoring the PDCCH for this G-RNTI;
\- indicate to upper layers that the associated MBMS session is stopped.
## 5.22 Entering Dormant SCell state
If the MAC entity is configured with one or more SCells, the network may
transition configured SCells into Dormant State. Dormant State is not
applicable for SpCell or PUCCH SCell. The network transitions SCell(s) in and
out of Dormant State by sending Activation/Deactivation and/or Hibernation MAC
control element as described in clause 6.1.3.8 and 6.1.3.15 respectively.
Furthermore, the MAC entity maintains two timers related to the dormant state:
\- If configured, an _sCellHibernationTimer_ timer per configured SCell
(except the SCell configured with PUCCH, if any). Upon the timer expiry, the
MAC entity hibernates the associated SCell if it is in activated state. The
same initial timer value applies to each instance of the
_sCellHibernationTimer_ and it is configured by RRC.
\- If configured, a _dormantSCellDeactivationTimer_ per configured SCell
(except the SCell configured with PUCCH, if any). Upon the timer expiry, the
MAC entity deactivates the associated SCell if it is in dormant state. The
same initial timer value applies to each instance of the
_dormantSCellDeactivationTimer_ and it is configured by RRC.
An SCell will be in Dormant SCell state upon SCell configuration in case the
parameter _sCellState_ is set to _dormant_ for the SCell within RRC
configuration. The configured SCG SCells are dormant after a SCG change in
case the parameter _sCellState_ is set to _dormant_ for the SCell within RRC
configuration.
The MAC entity shall for each TTI and for each configured SCell:
\- if the MAC entity is configured with dormant SCell upon SCell configuration
or receives MAC control element(s) in this TTI for transitioning the SCell
into Dormant State:
\- in the TTI according to the timing defined in TS 36.213 [2]:
\- transition the SCell into Dormant State;
\- stop the _sCellDeactivationTimer_ associated with the SCell;
\- if _sCellHibernationTimer_ associated with the SCell is configured;
\- stop the _sCellHibernationTimer_ associated with the SCell;
\- start or restart the _dormantSCellDeactivationTimer_ associated with the
SCell;
\- clear any configured downlink assignments and uplink grants associated with
the SCell;
\- flush all HARQ buffers associated with the SCell.
\- if the _sCellHibernationTimer_ associated with the activated SCell expires
in this TTI:
\- in the TTI according to the timing defined in TS 36.213 [2]:
\- hibernate the SCell;
\- stop the _sCellDeactivationTimer_ associated with the SCell;
\- stop the _sCellHibernationTimer_ associated with the SCell;
\- start the _dormantSCellDeactivationTimer_ associated with the SCell;
\- clear any configured downlink assignments and uplink grants associated with
the SCell;
\- flush all HARQ buffers associated with the SCell.
\- if the _dormantSCellDeactivationTimer_ associated with the dormant SCell
expires in this TTI:
\- in the TTI according to the timing defined in TS 36.213 [2]:
\- deactivate the SCell;
\- stop the _dormantSCellDeactivationTimer_ associated with the SCell;
\- if the SCell is in Dormant State:
\- not transmit SRS on the SCell;
\- report CQI/PMI/RI/PTI/CRI for the SCell according to the periodicity
indicated by _cqi-ReportPeriodic-SCell-r15_ ;
\- not transmit on UL-SCH on the SCell;
\- not transmit on RACH on the SCell;
\- not monitor the PDCCH on the SCell;
\- not monitor the PDCCH for the SCell;
\- not transmit PUCCH on the SCell.
HARQ feedback for the MAC PDU containing Hibernation MAC control element shall
not be impacted by PCell, PSCell and PUCCH SCell interruptions due to SCell
activation/deactivation or hibernation (TS 36.133 [9]).
NOTE: When SCell is in Dormant State, any ongoing Random Access procedure on
the SCell is aborted.
## 5.23 Autonomous Uplink
Autonomous uplink is supported on the SCells only. At most one autonomous
uplink configuration is supported per SCell. Multiple autonomous uplink
configurations can be activated and be active simultaneously when there is
more than one SCell. Autonomous uplink and Uplink Semi-Persistent Scheduling
cannot be active simultaneously on the same SCell.
When autonomous uplink is configured by RRC, the following information is
provided in _AUL-Config_ (TS 36.331 [8]):
\- AUL C-RNTI;
\- HARQ process IDs _aul-HARQ-Processes_ that are configured for autonomous UL
HARQ operation, the time period _aul-RetransmissionTimer_ before triggering a
new transmission or a retransmission of the same HARQ process using autonomous
uplink;
\- The bitmap _aul-Subframes_ that indicates the subframes that are configured
for autonomous UL HARQ operation.
When the autonomous uplink configuration is released by RRC, the corresponding
configured grant shall be cleared.
If _AUL-Config_ is configured, the MAC entity shall:
\- consider that a configured uplink grant occurs in those subframes for which
_aul-Subframes_ is set to 1 (TS 36.331 [8]).
If AUL confirmation has been triggered and not cancelled:
\- if the MAC entity has UL resources allocated for new transmission for this
TTI:
\- instruct the Multiplexing and Assembly procedure to generate an AUL
confirmation MAC Control Element as defined in clause 6.1.3.16;
\- cancel the triggered AUL confirmation.
The MAC entity shall clear the configured uplink grant for the SCell
immediately after first transmission of AUL confirmation MAC Control Element
triggered by the AUL release for this SCell.
NOTE: Retransmissions for uplink transmissions using autonomous uplink can
continue after clearing the corresponding configured uplink grant.
## 5.24 Activation/Deactivation of PDCP duplication
If one or more DRBs are configured with PDCP duplication, the network may
activate and deactivate the PDCP duplication for the configured DRB(s) by
sending the PDCP Duplication Activation/Deactivation MAC CE described in
clause 6.1.3.17. In addition, PDCP duplication for DRB(s) may be activated
upon configuration by upper layers (TS 36.331 [8]).
Upon reception of a PDCP Duplication Activation/Deactivation MAC CE, the MAC
entity shall for each DRB configured with duplication:
\- if the MAC CE indicates that PDCP duplication for the DRB shall be
activated:
\- indicate the activation of PDCP duplication for the DRB to upper layers.
\- if the MAC CE indicates that PDCP duplication for the DRB shall be
deactivated:
\- indicate the deactivation of PDCP duplication for the DRB to upper layers.
## 5.25 Transmission of Downlink Channel Quality Report
The MAC entity of a BL UE or UE in enhanced coverage may be configured by
upper layers to report DL channel quality in Msg3. DL channel quality in Msg3
in RRC_CONNECTED is not reported.
If the UE is a BL UE or UE in enhanced coverage or an NB-IoT UE, a Downlink
Channel Quality Report (DCQR) shall be triggered if any of the following
events occur:
\- DCQR Command MAC control element is received, in which case the DCQR is
referred below to as \"Regular DCQR\";
\- for BL UE or UE in enhanced coverage, transmission of DCQR in Msg3 is
configured by upper layers in _mpdcch-CQI-Reporting_ , in which case DCQR is
referred below to as \"Msg3 DCQR\".
If any type of DCQR has been triggered:
\- start performing DL channel quality measurements according to TS 36.133
[9].
If \"Regular DCQR\" has been triggered:
\- if an uplink grant has been received on the PDCCH for MAC entity\'s C-RNTI:
\- instruct the Multiplexing and Assembly procedure to generate a DCQR and AS
RAI MAC control element as defined in clause 6.1.3.19;
\- cancel the triggered \"Regular DCQR\".
If \"Msg3 DCQR\" has been triggered:
\- if an uplink grant has been received on the PDCCH for MAC entity\'s RA-
RNTI:
\- if the allocated resources can accommodate a DCQR and AS RAI MAC control
element plus its subheader as a result of logical channel prioritization:
\- instruct the Multiplexing and Assembly procedure to generate a DCQR and AS
RAI MAC control element as defined in clause 6.1.3.19;
\- else if the uplink grant is not for EDT:
\- if configured by upper layers in _mpdcch-CQI-Reporting_ , use R and F2
fields in the MAC PDU subheader, to transmit the measurement outcome, as
defined in clause 6.2.1;
\- cancel the triggered \"Msg3 DCQR\".
# 6 Protocol Data Units, formats and parameters
## 6.1 Protocol Data Units
### 6.1.1 General
A MAC PDU is a bit string that is byte aligned (i.e. multiple of 8 bits) in
length. In the figures in clause 6.1, bit strings are represented by tables in
which the most significant bit is the leftmost bit of the first line of the
table, the least significant bit is the rightmost bit on the last line of the
table, and more generally the bit string is to be read from left to right and
then in the reading order of the lines. The bit order of each parameter field
within a MAC PDU is represented with the first and most significant bit in the
leftmost bit and the last and least significant bit in the rightmost bit.
MAC SDUs are bit strings that are byte aligned (i.e. multiple of 8 bits) in
length. An SDU is included into a MAC PDU from the first bit onward.
The MAC entity shall ignore the value of Reserved bits in downlink MAC PDUs
and in MAC PDUs received in sidelink.
### 6.1.2 MAC PDU (DL-SCH and UL-SCH except transparent MAC and Random Access
Response, MCH)
A MAC PDU consists of a MAC header, zero or more MAC Service Data Units (MAC
SDU), zero, or more MAC control elements, and optionally padding; as described
in Figure 6.1.2-3.
Both the MAC header and the MAC SDUs are of variable sizes.
A MAC PDU header consists of one or more MAC PDU subheaders; each subheader
corresponds to either a MAC SDU, a MAC control element or padding.
A MAC PDU subheader consists of the header fields
R/F2/E/LCID/(R/R/eLCID)/(F)/(L). The L field is present in the MAC PDU
subheader except for the last subheader in the MAC PDU and fixed sized MAC
control elements. The last subheader in the MAC PDU and subheaders for fixed
sized MAC control elements consist of the header fields
R/F2/E/LCID/(R/R/eLCID). A MAC PDU subheader corresponding to padding consists
of the four header fields R/F2/E/LCID.
Figure 6.1.2-1: R/F2/E/LCID/(R/R/eLCID)/F/L MAC subheader with 7-bits and
15-bits L field
Figure 6.1.2-1a: R/F2/E/LCID/(R/R/eLCID)/L MAC subheader with 16-bits L field
Figure 6.1.2-2: R/F2/E/LCID/(R/R/eLCID) MAC subheader
MAC PDU subheaders have the same order as the corresponding MAC SDUs, MAC
control elements and padding.
MAC control elements are always placed before any MAC SDU.
Padding occurs at the end of the MAC PDU, except when single-byte or two-byte
padding is required. Padding may have any value and the MAC entity shall
ignore it. When padding is performed at the end of the MAC PDU, zero or more
padding bytes are allowed.
When single-byte or two-byte padding is required, one or two MAC PDU
subheaders corresponding to padding are placed at the beginning of the MAC PDU
before any other MAC PDU subheader.
A maximum of one MAC PDU can be transmitted per TB per MAC entity. A maximum
of one MCH MAC PDU can be transmitted per TTI.
Figure 6.1.2-3: Example of MAC PDU consisting of MAC header, MAC control
elements, MAC SDUs and padding
### 6.1.3 MAC Control Elements
#### 6.1.3.1 Buffer Status Report MAC Control Elements
Buffer Status Report (BSR) MAC control elements consist of either:
\- Short BSR and Truncated BSR format: one LCG ID field and one corresponding
Buffer Size field (figure 6.1.3.1-1); or
\- Long BSR format: four Buffer Size fields, corresponding to LCG IDs #0
through #3 (figure 6.1.3.1-2).
The BSR formats are identified by MAC PDU subheaders with LCIDs as specified
in table 6.2.1-2.
The fields LCG ID and Buffer Size are defined as follow:
\- LCG ID: The Logical Channel Group ID field identifies the group of logical
channel(s) which buffer status is being reported. The length of the field is 2
bits. For NB-IoT, the LCG ID is set to #0.
\- Buffer Size: The Buffer Size field identifies the total amount of data
available across all logical channels of a logical channel group after all MAC
PDUs for the TTI have been built. The amount of data is indicated in number of
bytes. It shall include all data that is available for transmission in the RLC
layer and in the PDCP layer; the definition of what data shall be considered
as available for transmission is specified in TS 36.322 [3] and TS 36.323 [4]
or TS 38.323 [17] respectively. The size of the RLC and MAC headers are not
considered in the buffer size computation. The length of this field is 6 bits.
If _extendedBSR-Sizes_ is not configured, the values taken by the Buffer Size
field are shown in Table 6.1.3.1-1. If _extendedBSR-Sizes_ is configured, the
values taken by the Buffer Size field are shown in Table 6.1.3.1-2.
Figure 6.1.3.1-1: Short BSR and Truncated BSR MAC control element
Figure 6.1.3.1-2: Long BSR MAC control element
Table 6.1.3.1-1: Buffer size levels for BSR
**Index** **Buffer Size (BS) value [bytes]** **Index** **Buffer Size (BS)
value [bytes]**
* * *
0 BS = 0 32 1132 \ 150000
Table 6.1.3.1-2: Extended Buffer size levels for BSR
**Index** **Buffer Size (BS) value [bytes]** **Index** **Buffer Size (BS)
value [bytes]**
* * *
0 BS = 0 32 4940 \ 3000000
#### 6.1.3.1a Sidelink BSR MAC Control Elements
Sidelink BSR and Truncated Sidelink BSR MAC control elements consist of one
Destination Index field, one LCG ID field and one corresponding Buffer Size
field per reported target group.
The Sidelink BSR MAC control elements are identified by MAC PDU subheaders
with LCIDs as specified in table 6.2.1-2. They have variable sizes.
For each included group, the fields are defined as follows (figures 6.1.3.1a-1
and 6.1.3.1a-2):
\- Destination Index: The Destination Index field identifies the ProSe
Destination or the destination for V2X sidelink communication. The length of
this field is 4 bits. The value is set to the index of the destination
reported in _destinationInfoList_ for sidelink communication or is set to one
index among index(es) associated to same destination reported in
_v2x-DestinationInfoList_ for V2X sidelink communication. If multiple such
lists are reported, the value is indexed sequentially across all the lists in
the same order as specified in TS 36.331 [8];
\- LCG ID: The Logical Channel Group ID field identifies the group of logical
channel(s) which buffer status is being reported. The length of the field is 2
bits;
\- Buffer Size: The Buffer Size field identifies the total amount of data
available across all logical channels of a LCG of a ProSe Destination after
all MAC PDUs for the TTI have been built. The amount of data is indicated in
number of bytes. It shall include all data that is available for transmission
in the RLC layer and in the PDCP layer; the definition of what data shall be
considered as available for transmission is specified in TS 36.322 [3] and TS
36.323 [4] respectively. The size of the RLC and MAC headers are not
considered in the buffer size computation. The length of this field is 6 bits.
The values taken by the Buffer Size field are shown in Table 6.1.3.1-1;
\- R: Reserved bit, set to \"0\".
Buffer Sizes of LCGs are included in decreasing order of the highest priority
of the sidelink logical channel belonging to the LCG irrespective of the value
of the Destination Index field.
Figure 6.1.3.1a-1: Sidelink BSR and Truncated Sidelink BSR MAC control element
for even N
Figure 6.1.3.1a-2: Sidelink BSR and Truncated Sidelink BSR MAC control element
for odd N
#### 6.1.3.2 C-RNTI MAC Control Element
The C-RNTI MAC control element is identified by MAC PDU subheader with LCID as
specified in table 6.2.1-2.
It has a fixed size and consists of a single field defined as follows (figure
6.1.3.2-1):
\- C-RNTI: This field contains the C-RNTI of the MAC entity. The length of the
field is 16 bits.
Figure 6.1.3.2-1: C-RNTI MAC control element
#### 6.1.3.3 DRX Command MAC Control Element
The DRX Command MAC control element is identified by a MAC PDU subheader with
LCID as specified in table 6.2.1-1.
It has a fixed size of zero bits.
#### 6.1.3.4 UE Contention Resolution Identity MAC Control Element
The UE Contention Resolution Identity MAC control element is identified by MAC
PDU subheader with LCID as specified in table 6.2.1-1. This control element
has a fixed 48-bit size and consists of a single field defined as follows
(figure 6.1.3.4-1)
\- UE Contention Resolution Identity: If this MAC control element is included
in response to an uplink CCCH transmission, then this field contains the
uplink CCCH SDU if the uplink CCCH SDU is 48 bits long. If the CCCH SDU is
longer than 48 bits, this field contains the first 48 bits of the uplink CCCH
SDU. If this MAC control element is included in response to an uplink DCCH
transmission (i.e. the MAC entity is configured with _rach-Skip_ or _rach-
SkipSCG_), then the MAC entity shall ignore the contents of this field.
Figure 6.1.3.4-1: UE Contention Resolution Identity MAC control element
#### 6.1.3.5 Timing Advance Command MAC Control Element
The Timing Advance Command MAC control element is identified by MAC PDU
subheader with LCID as specified in table 6.2.1-1.
It has a fixed size and consists of a single octet defined as follows (figure
6.1.3.5-1):
\- TAG Identity (TAG Id): This field indicates the TAG Identity of the
addressed TAG. The TAG containing the SpCell has the TAG Identity 0. The
length of the field is 2 bits;
\- Timing Advance Command: This field indicates the index value _T~A~_ (0, 1,
2... 63) used to control the amount of timing adjustment that MAC entity has
to apply (see clause 4.2.3 of TS 36.213 [2]). The length of the field is 6
bits.
Figure 6.1.3.5-1: Timing Advance Command MAC control element
#### 6.1.3.6 Power Headroom Report MAC Control Element
The Power Headroom Report (PHR) MAC control element is identified by a MAC PDU
subheader with LCID as specified in table 6.2.1-2. It has a fixed size and
consists of a single octet defined as follows (figure 6.1.3.6-1):
\- R: reserved bit, set to \"0\";
\- Power Headroom (PH): this field indicates the power headroom level. The
length of the field is 6 bits. The reported PH and the corresponding power
headroom levels are shown in Table 6.1.3.6-1 below (the corresponding measured
values in dB can be found in clause 9.1.8.4 of TS 36.133 [9]).
Figure 6.1.3.6-1: PHR MAC control element
Table 6.1.3.6-1: Power Headroom levels for PHR
* * *
PH Power Headroom Level 0 POWER_HEADROOM_0 1 POWER_HEADROOM_1 2
POWER_HEADROOM_2 3 POWER_HEADROOM_3 ... ... 60 POWER_HEADROOM_60 61
POWER_HEADROOM_61 62 POWER_HEADROOM_62 63 POWER_HEADROOM_63
* * *
#### 6.1.3.6a Extended Power Headroom Report MAC Control Elements
For _extendedPHR_ , the Extended Power Headroom Report (PHR) MAC control
element is identified by a MAC PDU subheader with LCID as specified in table
6.2.1-2. It has a variable size and is defined in Figure 6.1.3.6a-2. When Type
2 PH is reported, the octet containing the Type 2 PH field is included first
after the octet indicating the presence of PH per SCell and followed by an
octet containing the associated P~CMAX,c~ field (if reported). Then follows an
octet with the Type 1 PH field and an octet with the associated P~CMAX,c~
field (if reported), for the PCell. If _SRS-ConfigAdd-r16_ is configured for
the PCell then follows an octet with the Type 3 PH field and an octet with the
associated P~CMAX,c~ field (if reported), for the PCell. And then follows in
ascending order based on the _ServCellIndex_ , as specified in TS 36.331 [8]
an octet with the Type x PH field, wherein x is equal to 3 when the _ul-
Configuration-r14_ or _SRS-ConfigAdd-r16_ is configured for this SCell, x is
equal to 1 otherwise, and an octet with the associated P~CMAX,c~ field (if
reported), for each SCell indicated in the bitmap.
For _extendedPHR2_ , the Extended Power Headroom Report (PHR) MAC control
elements are identified by a MAC PDU subheader with LCID as specified in table
6.2.1-2. They have variable sizes and are defined in Figure 6.1.3.6a1-3,
Figure 6.1.3.6a2-4 and Figure 6.1.3.6a3-5. One octet with C fields is used for
indicating the presence of PH per SCell when the highest _SCellIndex_ of SCell
with configured uplink is less than 8, otherwise four octets are used. When
Type 2 PH is reported for the PCell, the octet containing the Type 2 PH field
is included first after the octet(s) indicating the presence of PH per SCell
and followed by an octet containing the associated P~CMAX,c~ field (if
reported). Then follows the Type 2 PH field for the PUCCH SCell (if PUCCH on
SCell is configured and Type 2 PH is reported for the PUCCH SCell), followed
by an octet containing the associated P~CMAX,c~ field (if reported). Then
follows an octet with the Type 1 PH field and an octet with the associated
P~CMAX,c~ field (if reported), for the PCell. If _SRS-ConfigAdd-r16_ is
configured for the PCell then follows an octet with the Type 3 PH field and an
octet with the associated P~CMAX,c~ field (if reported), for the PCell. Then
follows in ascending order based on the _ServCellIndex_ , as specified in TS
36.331 [8] an octet with the Type x PH field, wherein, x is equal to 3 when
the _ul-Configuration-r14_ or _SRS-ConfigAdd-r16_ is configured for this
SCell, x is equal to 1 otherwise, and an octet with the associated P~CMAX,c~
field (if reported), for each SCell indicated in the bitmap.
The Extended PHR MAC Control Elements are defined as follows:
\- C~i~: this field indicates the presence of a PH field for the SCell with
_SCellIndex_ i as specified in TS 36.331 [8]. The C~i~ field set to \"1\"
indicates that a PH field for the SCell with _SCellIndex_ i is reported. The
C~i~ field set to \"0\" indicates that a PH field for the SCell with
_SCellIndex_ i is not reported;
\- R: reserved bit, set to \"0\";
\- V: this field indicates if the PH value is based on a real transmission or
a reference format. For Type 1 PH, V=0 indicates real transmission on PUSCH
and V=1 indicates that a PUSCH reference format is used. For Type 2 PH, V=0
indicates real transmission on PUCCH/SPUCCH and V=1 indicates that a
PUCCH/SPUCCH reference format is used. For Type 3 PH, V=0 indicates real
transmission on SRS and V=1 indicates that an SRS reference format is used.
Furthermore, for Type 1, Type 2 and Type 3 PH, V=0 indicates the presence of
the octet containing the associated P~CMAX,c~ field, and V=1 indicates that
the octet containing the associated P~CMAX,c~ field is omitted;
\- Power Headroom (PH): this field indicates the power headroom level. The
length of the field is 6 bits. The reported PH and the corresponding power
headroom levels are shown in Table 6.1.3.6-1 (the corresponding measured
values in dB can be found in clause 9.1.8.4 of TS 36.133 [9]);
\- P: this field indicates whether the MAC entity applies power backoff due to
power management (as allowed by P-MPR~c~, see TS 36.101 [10]). The MAC entity
shall set P=1 if the corresponding P~CMAX,c~ field would have had a different
value if no power backoff due to power management had been applied;
\- P~CMAX,c~: if present, this field indicates the P~CMAX,c~ or , as specified
in TS 36.213 [2] used for calculation of the preceding PH field. The reported
P~CMAX,c~ and the corresponding nominal UE transmit power levels are shown in
Table 6.1.3.6a-1 (the corresponding measured values in dBm can be found in
clause 9.6.1 of TS 36.133 [9]).
Figure 6.1.3.6a-1: Void
Figure 6.1.3.6a-2: Extended PHR MAC Control Element
Figure 6.1.3.6a1-3: Extended PHR MAC Control Element supporting PUCCH on SCell
Figure 6.1.3.6a2-4: Extended PHR MAC Control Element supporting 32 serving
cells with configured uplink
Figure 6.1.3.6a3-5: Extended PHR MAC Control Element supporting 32 serving
cells with configured uplink and PUCCH on SCell
Table 6.1.3.6a-1: Nominal UE transmit power level for Extended PHR and for
Dual Connectivity PHR
+-----------+---------------------------------+ | P~CMAX,c~ | Nominal UE transmit power level | +-----------+---------------------------------+ | 0 | > PCMAX_C_00 | +-----------+---------------------------------+ | 1 | > PCMAX_C_01 | +-----------+---------------------------------+ | 2 | > PCMAX_C_02 | +-----------+---------------------------------+ | ... | ... | +-----------+---------------------------------+ | 61 | > PCMAX_C_61 | +-----------+---------------------------------+ | 62 | > PCMAX_C_62 | +-----------+---------------------------------+ | 63 | > PCMAX_C_63 | +-----------+---------------------------------+
#### 6.1.3.6b Dual Connectivity Power Headroom Report MAC Control Element
The Dual Connectivity Power Headroom Report (PHR) MAC control element is
identified by a MAC PDU subheader with LCID as specified in table 6.2.1-2. It
has a variable size and is defined in Figure 6.1.3.6b-1 and Figure 6.1.3.6b-2.
One octet with C~i~ fields is used for indicating the presence of PH per
serving cell other than PCell, when the highest _SCellIndex_ of SCell with
configured uplink is less than 8, otherwise four octets are used. In case EN-
DC, NE-DC or NGEN-DC is configured, four octets with C~i~ fields is always
used. When Type 2 PH is reported for the PCell, the octet containing the Type
2 PH field is included first after the octet(s) indicating the presence of PH
per cell (PSCell and all SCells of all MAC entities) and followed by an octet
containing the associated P~CMAX,c~ field (if reported). Then after that, when
Type 2 PH is reported for the PSCell, the octet containing the Type 2 PH field
is included followed by an octet containing the associated P~CMAX,c~ field (if
reported). Then follows an octet with the Type 1 PH field and an octet with
the associated P~CMAX,c~ field (if reported), for the PCell. If _SRS-
ConfigAdd-r16_ is configured for the PCell then follows an octet with the Type
3 PH field and an octet with the associated P~CMAX,c~ field (if reported), for
the PCell. And then follows in ascending order based on the _ServCellIndex_ ,
as specified in TS 36.331 [8], an octet with the Type x PH field, wherein x is
either 1 or 3 according to TS 36.213 [2] and TS 38.213 [18] and an octet with
the associated P~CMAX,c~ field (if reported), for all serving cells of all MAC
entities indicated in the bitmap. In case of EN-DC and NGEN-DC, for serving
cells in the other MAC entity in which the UE does not support dynamic power
sharing or dynamic power sharing is not applicable (clause 4.2.7.9, TS 38.306
[22]), the UE may omit the octets containing Power Headroom field and
P~CMAX,c~ field for those serving cells. In case of NE-DC, for serving cells
in the other MAC entity in which the UE does not support dynamic power sharing
or dynamic power sharing is not applicable, the UE may omit the octets
containing Power Headroom field and P~CMAX,f,c~ field for those serving cells
except for the PCell in the other MAC entity and the reported values of Power
Headroom and P~CMAX,f,c~ for the PCell are up to UE implementation.
The Dual Connectivity PHR MAC Control Element is defined as follows:
\- C~i~: this field indicates the presence of a PH field for the serving cell
of any MAC entity, except the PCell, with _ServCellIndex_ (for EN-DC, NE-DC or
NGEN-DC case) or _SCellIndex_ i as specified in TS 36.331 [8]. The C~i~ field
set to \"1\" indicates that a PH field for the serving cell with
_ServCellIndex_ (for EN-DC, NE-DC or NGEN-DC case) or _SCellIndex_ i is
reported. The C~i~ field set to \"0\" indicates that a PH field for the
serving cell with _ServCellIndex_ (for EN-DC, NE-DC or NGEN-DC case) or
_SCellIndex_ i is not reported;
\- R: reserved bit, set to \"0\";
\- V: this field indicates if the PH value is based on a real transmission or
a reference format. For Type 1 PH, V=0 indicates real transmission on PUSCH
and V=1 indicates that a PUSCH reference format is used. For Type 2 PH, V=0
indicates real transmission on PUCCH and V=1 indicates that a PUCCH reference
format is used. For Type 3 PH, V=0 indicates real transmission on SRS and V=1
indicates that an SRS reference format is used. Furthermore, for Type 1 ,Type
2 and Type 3 PH, V=0 indicates the presence of the octet containing the
associated P~CMAX,c~ field, and V=1 indicates that the octet containing the
associated P~CMAX,c~ field is omitted. Whether the reported PH value for an
activated NR Serving Cell is based on real transmission or a reference format
is determined based on UL transmissions that have been scheduled or configured
until 4 ms prior to the TTI in which this PHR MAC CE is transmitted;
\- Power Headroom (PH): this field indicates the power headroom level. The
length of the field is 6 bits. The reported PH and the corresponding power
headroom levels are shown in Table 6.1.3.6-1 (the corresponding measured
values in dB for the E-UTRA Serving Cell are specified in clause 9.1.8.4 of TS
36.133 [9] while the corresponding measured values in dB for the NR Serving
Cell are specified in TS 38.133 [19]);
\- P: this field indicates whether power backoff due to power management is
applied (as allowed by P-MPR~c~, see TS 36.101 [10] and TS 38.101-3 [21]). The
MAC entity shall set P=1 if the corresponding P~CMAX,c~ field would have had a
different value if no power backoff due to power management had been applied;
\- P~CMAX,c~: if present, this field indicates the P~CMAX,c~ or , as specified
in TS 36.213 [2] for the E-UTRA Serving Cell and the P~CMAX,f,c~ or
P̃~CMAX,f,c~, as specified in TS 38.213 [18]) for the NR Serving Cell used for
calculation of the preceding PH field. The reported P~CMAX,c~ and the
corresponding nominal UE transmit power levels are shown in Table 6.1.3.6a-1
(the corresponding measured values in dBm for the E-UTRA Serving Cell can be
found in TS 36.133 [9] while the corresponding measured values in dBm for the
NR Serving Cell can be found in TS 38.133 [19]).
Figure 6.1.3.6b-1: Dual Connectivity PHR MAC Control Element
Figure 6.1.3.6b-2: Dual Connectivity PHR MAC Control Element supporting 32
serving cells with configured uplink
#### 6.1.3.7 MCH Scheduling Information MAC Control Element
The MCH Scheduling Information MAC Control Element illustrated in Figure
6.1.3.7-1 is identified by a MAC PDU subheader with LCID as specified in Table
6.2.1-4. This control element has a variable size. For each MTCH the fields
below are included:
\- LCID: this field indicates the Logical Channel ID of the MTCH. The length
of the field is 5 bits;
\- Stop MTCH: this field indicates the ordinal number of the subframe within
the MCH scheduling period, counting only the subframes allocated to the MCH,
where the corresponding MTCH stops. Value 0 corresponds to the first subframe.
The length of the field is 11 bits. The special Stop MTCH value 2047 indicates
that the corresponding MTCH is not scheduled. The value range 2043 to 2046 is
reserved.
Figure 6.1.3.7-1: MCH Scheduling Information MAC control element
#### 6.1.3.7a Extended MCH Scheduling Information MAC Control Element
The Extended MCH Scheduling Information MAC control element illustrated in
Figure 6.1.3.7-2 is identified by a MAC PDU subheader with LCID as specified
in Table 6.2.1-4. This control element has a variable size.
For each MTCH the fields below are included:
\- LCID: this field indicates the Logical Channel ID of the MTCH. The length
of the field is 5 bits;
\- Stop MTCH: this field indicates the ordinal number of the subframe within
the MCH scheduling period, counting only the subframes allocated to the MCH,
where the corresponding MTCH stops. Value 0 corresponds to the first subframe.
The length of the field is 11 bits. The special Stop MTCH value 2047 indicates
that the corresponding MTCH is not scheduled. The value range 2043 to 2046 is
reserved.
For each MTCH the fields below may be included:
\- LCID: this field indicates the Logical Channel ID of the MTCH. The length
of the field is 5 bits. LCIDs x...x+y shall be equal to or a subset of the
LCIDs 1...n;
\- S: this field indicates that the transmission of the corresponding MTCH is
to be suspended. The S field is set to 000. All other values are reserved.
Figure 6.1.3.7a-1: Extended MCH Scheduling Information MAC control element
#### 6.1.3.8 Activation/Deactivation MAC Control Elements
The Activation/Deactivation MAC control element of one octet is identified by
a MAC PDU subheader with LCID as specified in table 6.2.1-1. It has a fixed
size and consists of a single octet containing seven C-fields and one R-field.
The Activation/Deactivation MAC control element with one octet is defined as
follows (figure 6.1.3.8-1).
The Activation/Deactivation MAC control element of four octets is identified
by a MAC PDU subheader with LCID as specified in table 6.2.1-1. It has a fixed
size and consists of a four octets containing 31 C-fields and one R-field. The
Activation/Deactivation MAC control element of four octets is defined as
follows (figure 6.1.3.8-2).
For the case with no serving cell with a _ServCellIndex_ , as specified in TS
36.331 [8] larger than 7, Activation/Deactivation MAC control element of one
octet is applied, otherwise Activation/Deactivation MAC control element of
four octets is applied.
For the case that Activation/Deactivation MAC control element is received and
Hibernation MAC control element is not received:
\- C~i~: if there is an SCell configured with _SCellIndex_ i as specified in
TS 36.331 [8], this field indicates the activation/deactivation status of the
SCell with _SCellIndex_ i, else the MAC entity shall ignore the C~i~ field.
When the C~i~ field is set to \"1\", SCell with _SCellIndex_ i shall be
activated if it is in already activated state or deactivated state, otherwise
the C~i~ field set to \"1\" shall be ignored. The C~i~ field is set to \"0\"
to indicate that the SCell with _SCellIndex_ i shall be deactivated;
\- R: Reserved bit, set to \"0\".
For the case that both Activation/Deactivation MAC control element and
Hibernation MAC control element are received, see clause 6.1.3.15.
Figure 6.1.3.8-1: Activation/Deactivation MAC control element of one octet
Figure 6.1.3.8-2: Activation/Deactivation MAC control element of four octets
#### 6.1.3.9 Long DRX Command MAC Control Element
The Long DRX Command MAC control element is identified by a MAC PDU subheader
with LCID as specified in table 6.2.1-1.
It has a fixed size of zero bits.
#### 6.1.3.10 Data Volume and Power Headroom Report MAC Control Element
The Data Volume and Power Headroom Report (DPR) MAC control element is
identified by the MAC PDU subheader used for the CCCH MAC SDU, as specified in
table 6.2.1-2. It does not add any additional subheader and is always placed
before the CCCH MAC SDU. DPR MAC control element is not included in the
calculation of the L field in the MAC PDU subheader for the CCCH MAC SDU.
It has a fixed size and consists of a single octet defined as follows (figures
6.1.3.10-1 and 6.1.3.10-1a):
\- Data Volume (DV): The Data Volume field identifies the total amount of data
available across all logical channels and of data not yet associated with a
logical channel after all MAC PDUs for the TTI have been built. The amount of
data is indicated in number of bytes. It shall include all data that is
available for transmission in the RLC layer, in the PDCP layer, and in the RRC
layer; the definition of what data shall be considered as available for
transmission is specified in TS 36.322 [3], TS 36.323 [4] and TS 36.331 [8]
respectively. The size of the RLC and MAC headers are not considered in the
buffer size computation. The length of this field is 4 bits. The values taken
by the Data Volume field are shown in Table 6.1.3.10-1;
\- Power Headroom (PH): This field indicates the power headroom level. The
length of the field is 2 bits or 4 bits. The reported PH and the corresponding
power headroom and extended power headroom levels are shown in Table
6.1.3.10-2 and Table 6.1.3.10-2a, respectively, below (the corresponding
measured values in dB can be found in TS 36.133 [9]);
\- R: reserved bit, set to \"0\".
Figure 6.1.3.10-1: Data Volume and Power Headroom Report MAC control element
Figure 6.1.3.10-1a: Data Volume and Power Headroom Report MAC control element
for Extended Power Headroom level reporting
Table 6.1.3.10-1: Data Volume levels for DV
* * *
**Index** **Data Volume (DV) value [bytes]** **Index** **Data Volume (DV)
value [bytes]** 0 DV = 0 8 67 \ 1500
* * *
Table 6.1.3.10-2: Power Headroom levels for PH
* * *
PH Power Headroom Level 0 POWER_HEADROOM_0 1 POWER_HEADROOM_1 2
POWER_HEADROOM_2 3 POWER_HEADROOM_3
* * *
Table 6.1.3.10-2a: Extended Power Headroom levels for PH
* * *
PH Extended Power Headroom Level 0 EXTENDED_POWER_HEADROOM_0 1
EXTENDED_POWER_HEADROOM_1 2 EXTENDED_POWER_HEADROOM_2 3
EXTENDED_POWER_HEADROOM_3 4 EXTENDED_POWER_HEADROOM_4 5
EXTENDED_POWER_HEADROOM_5 6 EXTENDED_POWER_HEADROOM_6 7
EXTENDED_POWER_HEADROOM_7 8 EXTENDED_POWER_HEADROOM_8 9
EXTENDED_POWER_HEADROOM_9 10 EXTENDED_POWER_HEADROOM_10 11
EXTENDED_POWER_HEADROOM_11 12 EXTENDED_POWER_HEADROOM_12 13
EXTENDED_POWER_HEADROOM_13 14 EXTENDED_POWER_HEADROOM_14 15
EXTENDED_POWER_HEADROOM_15
* * *
#### 6.1.3.11 SPS confirmation MAC Control Element
The SPS confirmation MAC control element is identified by a MAC PDU subheader
with LCID as specified in table 6.2.1-2.
It has a fixed size of zero bits.
#### 6.1.3.12 SC-PTM Stop Indication MAC Control Element
The SC-PTM Stop Indication MAC control element is applicable to NB-IoT UEs and
BL UEs or UEs in enhanced coverage and indicates that the SC-MTCH transmission
for a specific G-RNTI is stopped. It is identified by a MAC PDU subheader with
LCID as specified in table 6.2.1-1.
It has a fixed size of zero bits.
#### 6.1.3.13 Recommended bit rate MAC Control Element
The recommended bit rate MAC control element is identified by a MAC PDU
subheader with LCID as specified in tables 6.2.1-1 and 6.2.1-2 for bit rate
recommendation message from the eNB to the UE and bit rate recommendation
query message from the UE to the eNB, respectively. It has a fixed size and
consists of two octets defined as follows (figure 6.1.3.13-1):
\- LCID: This field indicates the identity of the logical channel (as
described in Table 6.1.3.13-2) for which the recommended bit rate or the
recommended bit rate query is applicable. The length of the field is 4 bits;
\- Uplink/Downlink (UL/DL): This field indicates whether the recommended bit
rate or the recommended bit rate query applies to uplink or downlink. The
length of the field is 1 bit. The UL/DL field set to \"0\" indicates downlink.
The UL/DL field set to \"1\" indicates uplink;
\- Bit Rate: This field indicates an index to Table 6.1.3.13-1. The length of
the field is 6 bits. For bit rate recommendation the value indicates the
recommended bit rate. For bit rate recommendation query the value indicates
the desired bit rate;
\- X: Bit rate multiplier. For UEs supporting recommended bit rate multiplier,
when _bitRateMultiplier_ is configured for the logical channel indicated by
LCID field, X field set to \"1\" indicates the actual value of bit rate is the
value corresponding to the index indicated by the Bit Rate field multiplied by
_bitRateMultiplier_ as specified in TS 36.331 [8];
\- R: reserved bit, set to \"0\".
Figure 6.1.3.13-1: Recommended bit rate MAC control element
Table 6.1.3.13-1: Values (kbit/s) for Bit Rate field
Index Recommended Bit Rate value [kbit/s] Index Recommended Bit Rate value
[kbit/s]
* * *
0 Note 1 32 700 1 0 33 800 2 8 34 900 3 10 35 1000 4 12 36 1100 5 16 37 1200 6
20 38 1300 7 24 39 1400 8 28 40 1500 9 32 41 1750 10 36 42 2000 11 40 43 2250
12 48 44 2500 13 56 45 2750 14 72 46 3000 15 88 47 3500 16 104 48 4000 17 120
49 4500 18 140 50 5000 19 160 51 5500 20 180 52 6000 21 200 53 6500 22 220 54
7000 23 240 55 7500 24 260 56 8000 25 280 57 Reserved 26 300 58 Reserved 27
350 59 Reserved 28 400 60 Reserved 29 450 61 Reserved 30 500 62 Reserved 31
600 63 Reserved Note1: For bit rate recommendation message this index is used
for indicating that no recommendation on bit rate is given.
Table 6.1.3.13-2: Values of identity of the logical channel for LCID field
Codepoint/Index Identity of the logical channel (i.e. _logicalChannelIdentity_
as specified in TS 36.331 [8])
* * *
0000 Reserved 0001 32 0010 33 0011-1010 3-10 1011 34 1100 35 1101 36 1110 37
1111 38
#### 6.1.3.14 Activation/Deactivation of CSI-RS resources MAC Control Element
The Activation/Deactivation of CSI-RS resources MAC control element is
identified by a MAC PDU subheader with LCID as specified in table 6.2.1-1. It
has variable size as the number of CSI process configured with _csi-RS-NZP-
Activation_ by RRC, see TS 36.331 [8], (N) and the N number of octets with A
fields are included in ascending order of CSI process ID, i.e., _CSI-
ProcessId_ , as defined in Figure 6.1.3.14-1. Activation/Deactivation CSI-RS
command is defined in Figure 6.1.3.14-2 and activates or deactivates CSI-RS
resources for a CSI process. For a UE configured with transmission mode 9, N
equals 1. Activation/Deactivation of CSI-RS resources MAC control element
applies to the serving cell on which the UE receives the
Activation/Deactivation of CSI-RS resources MAC control element.
The Activation/Deactivation of CSI-RS resources MAC control elements is
defined as follows:
\- A~i~: this field indicates the activation/deactivation status of the CSI-RS
resources configured by upper layers for the CSI process. A~1~ corresponds to
the 1^st^ entry in the list of CSI-RS specified by _csi-RS-ConfigNZP-ApList_
as configured by upper layers, A~2~ corresponds to the 2^nd^ entry in this
list and so on. The A~i~ field is set to \"1\" to indicate that i^th^ entry in
the list of CSI-RS specified by _csi-RS-ConfigNZP-ApList_ shall be activated.
The A~i~ field is set to \"0\" to indicate that i^th^ entry in the list shall
be deactivated. For each CSI process, the number of A~i~ fields (i=1, 2,...,
8) which are set to \"1\" shall be equal to the value of the higher-layer
parameter _activatedResources_ in TS 36.331 [8].
Figure 6.1.3.14-1: Activation/Deactivation of CSI-RS resources MAC Control
Element
Figure 6.1.3.14-2: Activation/Deactivation CSI-RS command
#### 6.1.3.15 Hibernation MAC Control Elements
The Hibernation MAC control element of one octet is identified by a MAC PDU
subheader with LCID as specified in table 6.2.1-1. It has a fixed size and
consists of a single octet containing seven C-fields and one R-field. The
Hibernation MAC control element with one octet is defined as follows (figure
6.1.3.15-1).
The Hibernation MAC control element of four octets is identified by a MAC PDU
subheader with LCID as specified in table 6.2.1-1. It has a fixed size and
consists of a four octets containing 31 C-fields and one R-field. The
Hibernation MAC control element of four octets is defined as follows (figure
6.1.3.15-2).
For the case with no serving cell with a _ServCellIndex_ (TS 36.331 [8])
larger than 7, Hibernation MAC control element of one octet is applied,
otherwise Hibernation MAC control element of four octets is applied.
For the case that Hibernation MAC control element is received and
Activation/Deactivation MAC control element is not received:
\- C~i~: if there is an SCell configured with _SCellIndex_ i as specified in
TS 36.331 [8], this field indicates the dormant/activated status of the SCell
with _SCellIndex_ i, else the MAC entity shall ignore the C~i~ field. The C~i~
field is set to \"1\" to indicate that the SCell with _SCellIndex i_ shall
enter dormant state. When the C~i~ field is set to \"0\", the SCell with
_SCellIndex i_ shall be activated if it is in already activated state or
dormant state, otherwise the C~i~ field set to \"0\" shall be ignored.
\- R: Reserved bit, set to \"0\".
For the case that both Activation/Deactivation MAC control element and
Hibernation MAC control element are received:
\- R: Reserved bit, set to \"0\".
\- C~i~: if there is an SCell configured with _SCellIndex_ i as specified in
TS 36.331 [8], these fields indicate possible state transitions of the SCell
with _SCellIndex_ i, else the MAC entity shall ignore the C~i~ fields. The
C~i~ fields of the two MAC control elements are interpreted according to Table
6.1.3.15-1.
Figure 6.1.3.15-1: Hibernation MAC control element of one octet
Figure 6.1.3.15-2: Hibernation MAC control element of four octets
Table 6.1.3.15-1: MAC control elements for SCell state transitions
* * *
Hibernation MAC control element C~i~ Activation/Deactivation MAC control
element C~i~ SCell shall be 0 0 Deactivated 0 1 Activated 1 0 Reserved MAC
control element combination 1 1 Dormant
* * *
#### 6.1.3.16 AUL confirmation MAC Control Element
The AUL confirmation MAC control element of one octet is identified by a MAC
PDU subheader with LCID as specified in table 6.2.1-2. It has a fixed size and
consists of a single octet containing seven C-fields and one R-field. The AUL
confirmation MAC control element with one octet is defined as follows (figure
6.1.3.16-1).
The AUL confirmation MAC control element of four octets is identified by a MAC
PDU subheader with LCID as specified in table 6.2.1-2. It has a fixed size and
consists of a four octets containing 31 C-fields and one R-field. The AUL
confirmation MAC control element of four octets is defined as follows (figure
6.1.3.16-2).
For the case with no serving cell with a _ServCellIndex_ (TS 36.331 [8])
larger than 7, AUL confirmation MAC control element of one octet is applied,
otherwise AUL confirmation MAC control element of four octets is applied.
\- C~i~: if there is an SCell configured with _SCellIndex_ i as specified in
TS 36.331 [8], this field indicates whether a PDCCH containing AUL activation
or AUL release of the autonomous uplink configuration in the SCell with
_SCellIndex_ i has been received, else the MAC entity shall ignore the C~i~
field. The C~i~ field is set to \"1\" to indicate that a PDCCH containing AUL
activation or AUL release of the autonomous uplink configuration in the SCell
with _SCellIndex_ i has been received in the TTI in which AUL confirmation has
been triggered. The C~i~ field is set to \"0\" to indicate that a PDCCH
containing AUL activation or AUL release of the autonomous uplink
configuration in the SCell with _SCellIndex_ i has not been received in the
TTI in which AUL confirmation has been triggered;
\- R: Reserved bit, set to \"0\".
Figure 6.1.3.16-1: AUL confirmation MAC Control Element of one octet
Figure 6.1.3.16-2: AUL confirmation MAC Control Element of four octets
#### 6.1.3.17 PDCP Duplication Activation/Deactivation MAC Control Element
PDCP Duplication Activation/Deactivation MAC control element is identified by
a MAC PDU subheader with LCID as specified in table 6.2.1-1. It has a fixed
size, consists of a single octet containing eight D-fields, and is defined,
for a MAC entity, as follows (figure 6.1.3.17-1):
\- D~i~: this field refers to the i-th DRB in the ascending order of the DRB
identity among the established DRB(s) configured with duplication and with RLC
entity(ies) associated with this MAC entity. D~i~ field set to \"1\" indicates
that the duplication shall be activated and D~i~ field set to \"0\" indicates
that the duplication shall be deactivated.
Figure 6.1.3.17-1: PDCP Duplication Activation/Deactivation MAC Control
Element
#### 6.1.3.18 Downlink Channel Quality Report Command MAC Control Element
DCQR Command MAC control element is identified by a MAC PDU subheader with
LCID as specified in Table 6.2.1-1.
It has a fixed size of zero bits.
#### 6.1.3.19 Downlink Channel Quality Report and AS RAI MAC Control Element
DCQR and AS RAI MAC control element is identified by a MAC PDU subheader with
LCID as specified in Table 6.2.1-2. A MAC PDU shall contain at most one DCQR
and AS RAI MAC control element.
It has a fixed size and consists of a single octet defined as follows (Figure
6.1.3.19-1):
\- R: Reserved bit, set to \"0\";
\- AS RAI: The field corresponds to Access Stratum Release Assistance
Indication as shown in Table 6.1.3.19-1. The length of the field is 2 bits;
\- Quality Report: For an NB-IoT UE, the field corresponds to CQI-NPDCCH-NB as
defined in TS 36.331 [8]. For a BL UE or UE in CE, the field corresponds to DL
channel quality report as defined in TS 36.133 [9]. The length of the field is
4 bits.
Figure 6.1.3.19-1: DCQR and AS RAI MAC control element
Table 6.1.3.19-1: Values for AS RAI
Codepoint/Index Value
* * *
00 No RAI information 01 No subsequent DL and UL data transmission is expected
10 A single subsequent DL transmission is expected 11 Reserved
### 6.1.4 MAC PDU (transparent MAC)
A MAC PDU consists solely of a MAC Service Data Unit (MAC SDU) whose size is
aligned to a TB; as described in figure 6.1.4-1. This MAC PDU is used for
transmissions on PCH, BCH, DL-SCH including BCCH, BR-BCCH, SL-DCH and SL-BCH.
Figure 6.1.4-1: Example of MAC PDU (transparent MAC)
### 6.1.5 MAC PDU (Random Access Response)
A MAC PDU consists of a MAC header and zero or more MAC Random Access
Responses (MAC RAR) and optionally padding as described in figure 6.1.5-4.
The MAC header is of variable size.
A MAC PDU header consists of one or more MAC PDU subheaders; each subheader
corresponding to a MAC RAR except for the Backoff Indicator subheader. If
included, the Backoff Indicator subheader is only included once and is the
first subheader included within the MAC PDU header.
A MAC PDU subheader consists of the three header fields E/T/RAPID (as
described in figure 6.1.5-1) but for the Backoff Indicator subheader which
consists of the five header field E/T/R/R/BI (as described in figure 6.1.5-2).
A MAC RAR consists of the following fields R/Timing Advance Command/UL
Grant/(R/ER)/Temporary C-RNTI (as described in figures 6.1.5-3, 6.1.5-3a,
6.1.5-3b and 6.1.5-3c). For BL UEs and UEs in enhanced coverage in enhanced
coverage level 2 or 3 (see clause 6.2 in TS 36.213 [2]) the MAC RAR in figure
6.1.5-3a is used, for NB-IoT UEs (see clause 16.3.3 in TS 36.213 [2]) the MAC
RAR in figure 6.1.5-3b is used, except for NB-IoT UEs using preamble format 2,
the MAC RAR in figure 6.1.5-3c is used. Otherwise the MAC RAR in figure
6.1.5-3 is used.
Padding may occur after the last MAC RAR. Presence and length of padding is
implicit based on TB size, size of MAC header and number of RARs.
Figure 6.1.5-1: E/T/RAPID MAC subheader
Figure 6.1.5-2: E/T/R/R/BI MAC subheader
Figure 6.1.5-3: MAC RAR
Figure 6.1.5-3a: MAC RAR for PRACH enhanced coverage level 2 or 3
Figure 6.1.5-3b: MAC RAR for NB-IoT UEs
Figure 6.1.5-3c: MAC RAR for NB-IoT UEs using PRACH preamble format 2
Figure 6.1.5-4: Example of MAC PDU consisting of a MAC header and MAC RARs
### 6.1.6 MAC PDU (SL-SCH)
A MAC PDU consists of a MAC header, one or more MAC Service Data Units (MAC
SDU), and optionally padding; as described in Figure 6.1.6-4.
Both the MAC header and the MAC SDUs are of variable sizes.
A MAC PDU header consists of one SL-SCH subheader, one or more MAC PDU
subheaders; each subheader except SL-SCH subheader corresponds to either a MAC
SDU or padding.
The SL-SCH subheader consists of the seven header fields V/R/R/R/R/SRC/DST.
A MAC PDU subheader consists of the six header fields R/R/E/LCID/F/L but for
the last subheader in the MAC PDU. The last subheader in the MAC PDU consists
solely of the four header fields R/R/E/LCID. A MAC PDU subheader corresponding
to padding consists of the four header fields R/R/E/LCID.
Figure 6.1.6-1: R/R/E/LCID/F/L MAC subheader
Figure 6.1.6-2: R/R/E/LCID MAC subheader
Figure 6.1.6-3: SL-SCH MAC subheader for V =\"0001\" and \"0010\"
Figure 6.1.6-3a: SL-SCH MAC subheader for V=\"0011\"
MAC PDU subheaders have the same order as the corresponding MAC SDUs and
padding.
Padding occurs at the end of the MAC PDU, except when single-byte or two-byte
padding is required. Padding may have any value and the MAC entity shall
ignore it. When padding is performed at the end of the MAC PDU, zero or more
padding bytes are allowed.
When single-byte or two-byte padding is required, one or two MAC PDU
subheaders corresponding to padding are placed after the SL-SCH subheader and
before any other MAC PDU subheader.
A maximum of one MAC PDU can be transmitted per TB.
Figure 6.1.6-4: Example of MAC PDU consisting of MAC header, MAC SDUs and
padding
## 6.2 Formats and parameters
### 6.2.1 MAC header for DL-SCH, UL-SCH and MCH
The MAC header is of variable size and consists of the following fields:
\- LCID: The Logical Channel ID field identifies the logical channel instance
of the corresponding MAC SDU or the type of the corresponding MAC control
element or padding as described in tables 6.2.1-1, 6.2.1-2 and 6.2.1-4 for the
DL-SCH, UL-SCH and MCH respectively. There is one LCID field for each MAC SDU,
MAC control element or padding included in the MAC PDU. In addition to that,
one or two additional LCID fields are included in the MAC PDU, when single-
byte or two-byte padding is required but cannot be achieved by padding at the
end of the MAC PDU. If the LCID field is set to \"10000\", an additional octet
is present in the MAC PDU subheader containing the eLCID field and this
additional octet follows the octet containing LCID field. A UE of Category 0,
as specified in TS 36.306 [12], except when in enhanced coverage, and
_unicastFreqHoppingInd-r13_ is indicated in the BR version of SI message
carrying _SystemInformationBlockType2_ , and UE supports frequency hopping for
unicast, as specified in TS 36.306 [12], shall indicate CCCH using LCID
\"01011\", a BL UE with support for frequency hopping for unicast, as
specified in TS 36.306 [12], and a UE in enhanced coverage with support for
frequency hopping for unicast, as specified in TS 36.306 [12], shall if
_unicastFreqHoppingInd-r13_ is indicated in the BR version of SI message
carrying _SystemInformationBlockType2_ indicate CCCH using LCID \"01100\",
otherwise the UE shall indicate CCCH using LCID \"00000\". A short DCQR may be
included in the MAC PDU subheader with LCID set to \"00000\", \"01011\",
\"01100\" or \"01101\". The LCID field size is 5 bits;
\- eLCID: The extended Logical Channel ID field identifies the logical channel
instance of the corresponding MAC SDU or the type of the corresponding MAC
control element as described in tables 6.2.1-1a and 6.2.1-2a for the DL-SCH
and UL-SCH respectively. The size of the eLCID field is 6 bits.
\- L: The Length field indicates the length of the corresponding MAC SDU or
variable-sized MAC control element in bytes. There is one L field per MAC PDU
subheader except for the last subheader and subheaders corresponding to fixed-
sized MAC control elements. The size of the L field is indicated by the F
field and F2 field;
\- F: The Format field indicates the size of the Length field as indicated in
table 6.2.1-3. There is one F field per MAC PDU subheader except for the last
subheader and subheaders corresponding to fixed-sized MAC control elements and
except for when F2 is set to 1. The size of the F field is 1 bit. If the F
field is included; if the size of the MAC SDU or variable-sized MAC control
element is less than 128 bytes, the value of the F field is set to 0,
otherwise it is set to 1;
\- F2: Except when this field is used for short DCQR, the Format2 field
indicates the size of the Length field as indicated in table 6.2.1-3. For
short DCQR, the mapping of F2 field to short DCQR value is described in table
6.2.1-5. There is one F2 field per MAC PDU subheader. The size of the F2 field
is 1 bit. Except when this field is used for short DCQR, if the size of the
MAC SDU or variable-sized MAC control element is larger than 32767 bytes, and
if the corresponding subheader is not the last subheader, the value of the F2
field is set to 1, otherwise it is set to 0;
\- E: The Extension field is a flag indicating if more fields are present in
the MAC header or not. The E field is set to \"1\" to indicate another set of
at least R/F2/E/LCID fields. The E field is set to \"0\" to indicate that
either a MAC SDU, a MAC control element or padding starts at the next byte;
\- R: Except when this field is used for short DCQR, reserved bit, set to
\"0\". For short DCQR, the mapping of R field to short DCQR value is described
in table 6.2.1-5.
The MAC header and subheaders are octet aligned.
Table 6.2.1-1 Values of LCID for DL-SCH
Codepoint/Index LCID values
* * *
00000 CCCH 00001-01010 Identity of the logical channel 01011-01111 Reserved
10000 Extended logical channel ID field 10001 DCQR Command 10010
Activation/Deactivation of PDCP Duplication 10011 Hibernation (1 octet) 10100
Hibernation (4 octets) 10101 Activation/Deactivation of CSI-RS 10110
Recommended bit rate 10111 SC-PTM Stop Indication 11000
Activation/Deactivation (4 octets) 11001 SC-MCCH, SC-MTCH (see note) 11010
Long DRX Command 11011 Activation/Deactivation (1 octet) 11100 UE Contention
Resolution Identity 11101 Timing Advance Command 11110 DRX Command 11111
Padding NOTE: Both SC-MCCH and SC-MTCH cannot be multiplexed with other
logical channels in the same MAC PDU except for Padding and SC-PTM Stop
Indication
Table 6.2.1-1a Values of eLCID for DL-SCH
Codepoint Index LCID values
* * *
000000-000110 32-38 Identity of the logical channel 000111-111111 39-95
Reserved
For NB-IoT only the following LCID values for DL-SCH are applicable: CCCH,
Identity of the logical channel, DCQR Command, SC-PTM Stop Indication, SC-
MCCH/SC-MTCH, UE Contention Resolution Identity, Timing Advance Command, DRX
Command and Padding.
Table 6.2.1-2 Values of LCID for UL-SCH
Codepoint/Index LCID values
* * *
00000 CCCH 00001-01010 Identity of the logical channel 01011 CCCH 01100 CCCH
01101 CCCH and Extended Power Headroom Report 01110-01111 Reserved 10000
Extended logical channel ID field 10001 DCQR and AS RAI 10010 AUL confirmation
(4 octets) 10011 AUL confirmation (1 octet) 10100 Recommended bit rate query
10101 SPS confirmation 10110 Truncated Sidelink BSR 10111 Sidelink BSR 11000
Dual Connectivity Power Headroom Report 11001 Extended Power Headroom Report
11010 Power Headroom Report 11011 C-RNTI 11100 Truncated BSR 11101 Short BSR
11110 Long BSR 11111 Padding
Table 6.2.1-2a Values of eLCID for UL-SCH
Codepoint Index LCID values
* * *
000000-000110 32-38 Identity of the logical channel 000111-111111 39-95
Reserved
For NB-IoT only the following LCID values for UL-SCH are applicable: CCCH
(LCID \"00000\"), Identity of the logical channel, CCCH and Extended Power
Headroom Report, DCQR and AS RAI, SPS confirmation, C-RNTI, Short BSR and
Padding.
Table 6.2.1-3 Values of F and F2 fields:
Index of F2 Index of F Size of Length field (in bits)
* * *
0 0 7 1 15 1 - 16
Table 6.2.1-4 Values of LCID for MCH
Index LCID values
* * *
00000 MCCH (see note) 00001-11100 MTCH 11101 Reserved 11110 MCH Scheduling
Information or Extended MCH Scheduling Information 11111 Padding NOTE: If
there is no MCCH on MCH, an MTCH could use this value.
Table 6.2.1-5: Values of R and F2 fields for short DCQR
Index of R Index of F2 Short DCQR value
* * *
0 0 No short DCQR 0 1 Short DCQR 1 1 0 Short DCQR 2 1 1 Short DCQR 3
### 6.2.2 MAC header for Random Access Response
The MAC header is of variable size and consists of the following fields:
\- E: The Extension field is a flag indicating if more fields are present in
the MAC header or not. The E field is set to \"1\" to indicate at least
another set of E/T/RAPID fields follows. The E field is set to \"0\" to
indicate that a MAC RAR or padding starts at the next byte;
\- T: The Type field is a flag indicating whether the MAC subheader contains a
Random Access ID or a Backoff Indicator. The T field is set to \"0\" to
indicate the presence of a Backoff Indicator field in the subheader (BI). The
T field is set to \"1\" to indicate the presence of a Random Access Preamble
ID field in the subheader (RAPID);
\- R: Reserved bit, set to \"0\";
\- BI: The Backoff Indicator field identifies the overload condition in the
cell. The size of the BI field is 4 bits;
\- RAPID: The Random Access Preamble IDentifier field identifies the
transmitted Random Access Preamble (see clause 5.1.3). The size of the RAPID
field is 6 bits.
The MAC header and subheaders are octet aligned.
NOTE: For NB-IoT, the Random Access Preamble IDentifier field corresponds to
the start subcarrier index.
### 6.2.3 MAC payload for Random Access Response
The MAC RAR is of fixed size and consists of the following fields:
\- R: Reserved bit, set to \"0\". For a BL UE or a UE in CE, this bit is set
to \"1\" to indicate that an UL Grant in Random Access Response is for EDT;
\- Timing Advance Command: The Timing Advance Command field indicates the
index value _T~A~_ (0, 1, 2... 1282) used to control the amount of timing
adjustment that the MAC entity has to apply (see clause 4.2.3 of TS 36.213
[2]), except for NB-IoT UEs using preamble format 2, where the Timing Advance
Command field indicates the index value _T~A~_ (0, 1, 2... 1536). The size of
the Timing Advance Command field is 11 bits;
\- UL Grant: The Uplink Grant field indicates the resources to be used on the
uplink (see clause 6.2 of TS 36.213 [2], _or for NB-IoT UEs,_ see clause
16.3.3 of TS 36.213 [2]). The size of the UL Grant field is 20 bits, _except
for NB-IoT UEs, where the size of UL grant field is 15 bits, and except_ for
BL UEs and UEs in enhanced coverage level 2 or 3, where the size of the UL
grant field is 12 bits.
\- ER: Extended RAPID bits, indicating the two least significant bits of
extended RAPID used when PRACH preamble format 2 is transmitted.
\- Temporary C-RNTI: The Temporary C-RNTI field indicates the temporary
identity that is used by the MAC entity during Random Access. The size of the
Temporary C-RNTI field is 16 bits.
The MAC RAR is octet aligned.
### 6.2.4 MAC header for SL-SCH
The MAC header is of variable size and consists of the following fields:
\- V: The MAC PDU format version number field indicates which version of the
SL-SCH subheader is used. In this version of the specification three format
versions are defined, and this field shall therefore be set to \"0001\",
\"0010\", and \"0011\". If the DST field is 24 bits this field shall be set to
\"0011\". The V field size is 4 bits;
\- SRC: The Source Layer-2 ID field carries the identity of the source. It is
set to the ProSe UE ID. The SRC field size is 24 bits;
\- DST: The DST field can be 16 bits or 24 bits. If it is 16 bits, it carries
the 16 most significant bits of the Destination Layer-2 ID. If it is 24 bits,
it is set to the Destination Layer-2 ID. For sidelink communication, the
Destination Layer-2 ID is set to the ProSe Layer-2 Group ID or Prose UE ID.
For V2X sidelink communication, the Destination Layer-2 ID is set to the
identifier provided by upper layers as defined in TS 23.285 [14]. If the V
field is set to \"0001\", this identifier is a groupcast identifier. If the V
field is set to \"0010\", this identifier is a unicast identifier;
\- LCID: The Logical Channel ID field uniquely identifies the logical channel
instance within the scope of one Source Layer-2 ID and Destination Layer-2 ID
pair of the corresponding MAC SDU or padding as described in table 6.2.4-1.
There is one LCID field for each MAC SDU or padding included in the MAC PDU.
In addition to that, one or two additional LCID fields are included in the MAC
PDU, when single-byte or two-byte padding is required but cannot be achieved
by padding at the end of the MAC PDU. The values of LCID from \"01011\" to
\"10100\" identify the logical channels used to send duplicated RLC SDUs from
logical channels of which the values of LCID from \"00001\" to \"01010\"
respectively in sequential order. The LCID field size is 5 bits;
\- L: The Length field indicates the length of the corresponding MAC SDU in
bytes. There is one L field per MAC PDU subheader except for the last
subheader. The size of the L field is indicated by the F field;
\- F: The Format field indicates the size of the Length field as indicated in
table 6.2.4-2. There is one F field per MAC PDU subheader except for the last
subheader. The size of the F field is 1 bit. If the size of the MAC SDU is
less than 128 bytes, the value of the F field is set to 0, otherwise it is set
to 1;
\- E: The Extension field is a flag indicating if more fields are present in
the MAC header or not. The E field is set to \"1\" to indicate another set of
at least R/R/E/LCID fields. The E field is set to \"0\" to indicate that
either a MAC SDU or padding starts at the next byte;
\- R: Reserved bit, set to \"0\".
The MAC header and subheaders are octet aligned.
Table 6.2.4-1 Values of LCID for SL-SCH
Index LCID values
* * *
00000 Reserved 00001-01010 Identity of the logical channel 01011-10100
Identity of the logical channel which is used for duplication 10101-11011
Reserved 11100 PC5-S messages that are not protected 11101 PC5-S messages
\"Direct Security Mode Command\" and \"Direct Security Mode Complete\" 11110
Other PC5-S messages that are protected 11111 Padding
Table 6.2.4-2 Values of F field:
Index Size of Length field (in bits)
* * *
0 7 1 15
# 7 Variables and constants
## 7.1 RNTI values
RNTI values are presented in Table 7.1-1 and their usage and associated
Transport Channels and Logical Channels are presented in Table 7.1-2.
Table 7.1-1: RNTI values.
+----------------------+----------------------------------------------+ | Value (hexa-decimal) | RNTI | +======================+==============================================+ | 0000 | N/A | +----------------------+----------------------------------------------+ | 0001-0960 | RA-RNTI, C-RNTI, Semi-Persistent Scheduling | | | C-RNTI, Temporary C-RNTI, eIMTA-RNTI, | | 0001-1000 (Note 3) | TPC-PUCCH-RNTI, TPC-PUSCH-RNTI, SL-RNTI (see | | | note), G-RNTI, SL-V-RNTI, UL Semi-Persistent | | | Scheduling V-RNTI, SL Semi-Persistent | | | Scheduling V-RNTI, SRS-TPC-RNTI, AUL C-RNTI, | | | and PUR-RNTI | +----------------------+----------------------------------------------+ | 0961-FFF3 | C-RNTI, Semi-Persistent Scheduling C-RNTI, | | | eIMTA-RNTI, Temporary C-RNTI, | | 1001-FFF3 (Note 3) | TPC-PUCCH-RNTI, TPC-PUSCH-RNTI, SL-RNTI, | | | G-RNTI, SL-V-RNTI, UL Semi-Persistent | | | Scheduling V-RNTI, SL Semi-Persistent | | | Scheduling V-RNTI, SRS-TPC-RNTI, AUL C-RNTI, | | | and PUR-RNTI | +----------------------+----------------------------------------------+ | FFF4-FFF8 | Reserved for future use | +----------------------+----------------------------------------------+ | FFF9 | SI-RNTI | +----------------------+----------------------------------------------+ | FFFA | SC-N-RNTI | +----------------------+----------------------------------------------+ | FFFB | SC-RNTI | +----------------------+----------------------------------------------+ | FFFC | CC-RNTI | +----------------------+----------------------------------------------+ | FFFD | M-RNTI | +----------------------+----------------------------------------------+ | FFFE | P-RNTI | +----------------------+----------------------------------------------+ | FFFF | SI-RNTI | +----------------------+----------------------------------------------+
NOTE 1: A MAC entity uses the same C-RNTI on all Serving Cells.
NOTE 2: SI-RNTI value FFFF may be used for MBMS-dedicated carrier. SI-RNTI
value FFF9 is only used for MBMS-dedicated carrier.
NOTE 3: Range applicable for NB-IoT.
Table 7.1-2: RNTI usage.
+----------------+----------------+----------------+----------------+ | RNTI | Usage | Transport | Logical | | | | Channel | Channel | +================+================+================+================+ | P-RNTI | Paging and | PCH | PCCH | | | System | | | | | Information | | | | | change | | | | | notification | | | +----------------+----------------+----------------+----------------+ | SI-RNTI | Broadcast of | DL-SCH | BCCH, BR-BCCH | | | System | | | | | Information | | | +----------------+----------------+----------------+----------------+ | M-RNTI | MCCH | N/A | N/A | | | Information | | | | | change | | | | | notification | | | +----------------+----------------+----------------+----------------+ | RA-RNTI | Random Access | DL-SCH | N/A | | | Response | | | +----------------+----------------+----------------+----------------+ | eIMTA-RNTI | eIMTA TDD | N/A | N/A | | | UL/DL | | | | | configuration | | | | | notification | | | +----------------+----------------+----------------+----------------+ | Temporary | Contention | DL-SCH | CCCH, DCCH | | C-RNTI | Resolution\ | | | | | (when no valid | | | | | C-RNTI is | | | | | available) | | | +----------------+----------------+----------------+----------------+ | Temporary | Msg3 | UL-SCH | CCCH, DCCH, | | C-RNTI | transmission | | DTCH | +----------------+----------------+----------------+----------------+ | C-RNTI | Dynamically | UL-SCH | DCCH, DTCH | | | scheduled | | | | | unicast | | | | | transmission | | | +----------------+----------------+----------------+----------------+ | C-RNTI | Dynamically | DL-SCH | CCCH, DCCH, | | | scheduled | | DTCH | | | unicast | | | | | transmission | | | +----------------+----------------+----------------+----------------+ | C-RNTI | Triggering of | N/A | N/A | | | PDCCH ordered | | | | | random access | | | +----------------+----------------+----------------+----------------+ | S | Sem | DL-SCH, UL-SCH | DCCH, DTCH | | emi-Persistent | i-Persistently | | | | Scheduling | scheduled | | | | C-RNTI | unicast | | | | | transmission | | | | | | | | | | (activation, | | | | | reactivation | | | | | and | | | | | r | | | | | etransmission) | | | +----------------+----------------+----------------+----------------+ | S | Sem | N/A | N/A | | emi-Persistent | i-Persistently | | | | Scheduling | scheduled | | | | C-RNTI | unicast | | | | | transmission | | | | | | | | | | (deactivation) | | | +----------------+----------------+----------------+----------------+ | TPC-PUCCH-RNTI | Physical layer | N/A | N/A | | | Uplink power | | | | | control | | | +----------------+----------------+----------------+----------------+ | TPC-PUSCH-RNTI | Physical layer | N/A | N/A | | | Uplink power | | | | | control | | | +----------------+----------------+----------------+----------------+ | SL-RNTI | Dynamically | SL-SCH | STCH | | | scheduled | | | | | sidelink | | | | | transmission | | | | | for sidelink | | | | | communication | | | +----------------+----------------+----------------+----------------+ | SC-RNTI | Dynamically | DL-SCH | SC-MCCH | | | scheduled | | | | | SC-PTM control | | | | | information | | | +----------------+----------------+----------------+----------------+ | G-RNTI | Dynamically | DL-SCH | SC-MTCH | | | scheduled | | | | | SC-PTM | | | | | transmission | | | +----------------+----------------+----------------+----------------+ | SC-N-RNTI | SC-MCCH | N/A | N/A | | | Information | | | | | change | | | | | notification | | | +----------------+----------------+----------------+----------------+ | CC-RNTI | Providing | N/A | N/A | | | common control | | | | | PDCCH | | | | | information | | | +----------------+----------------+----------------+----------------+ | SL-V-RNTI | Dynamically | SL-SCH | STCH | | | scheduled | | | | | sidelink | | | | | transmission | | | | | for V2X | | | | | sidelink | | | | | communication | | | +----------------+----------------+----------------+----------------+ | UL | Sem | UL-SCH | DCCH, DTCH | | S | i-Persistently | | | | emi-Persistent | scheduled | | | | Scheduling | uplink | | | | V-RNTI | transmission | | | | | for V2X | | | | | communication | | | | | | | | | | (activation, | | | | | reactivation | | | | | and | | | | | r | | | | | etransmission) | | | +----------------+----------------+----------------+----------------+ | UL | Sem | N/A | N/A | | S | i-Persistently | | | | emi-Persistent | scheduled | | | | Scheduling | uplink | | | | V-RNTI | transmission | | | | | for V2X | | | | | communication | | | | | | | | | | (deactivation) | | | +----------------+----------------+----------------+----------------+ | SL | Sem | SL-SCH | STCH | | S | i-Persistently | | | | emi-Persistent | scheduled | | | | Scheduling | sidelink | | | | V-RNTI | transmission | | | | | for V2X | | | | | sidelink | | | | | communication | | | | | | | | | | (activation, | | | | | reactivation | | | | | and | | | | | r | | | | | etransmission) | | | +----------------+----------------+----------------+----------------+ | SL | Sem | N/A | N/A | | S | i-Persistently | | | | emi-Persistent | scheduled | | | | Scheduling | sidelink | | | | V-RNTI | transmission | | | | | for V2X | | | | | sidelink | | | | | communication | | | | | | | | | | (deactivation) | | | +----------------+----------------+----------------+----------------+ | SRS-TPC-RNTI | SRS and TPC | N/A | N/A | | | for the | | | | | PUSCH-less | | | | | SCells | | | +----------------+----------------+----------------+----------------+ | AUL C-RNTI | Autonomous | UL-SCH | DCCH, DTCH | | | Uplink C-RNTI | | | | | unicast | | | | | transmission | | | | | (activation | | | | | and | | | | | reactivation) | | | +----------------+----------------+----------------+----------------+ | AUL C-RNTI | Autonomous | N/A | N/A | | | Uplink C-RNTI | | | | | unicast | | | | | transmission | | | | | (deactivation) | | | +----------------+----------------+----------------+----------------+ | PUR-RNTI | Transmission | DL-SCH, UL-SCH | CCCH, DCCH, | | | using | | DTCH | | | Preconfigured | | | | | Uplink | | | | | Resource | | | +----------------+----------------+----------------+----------------+ | PUR-RNTI | Transmission | N/A | N/A | | | using | | | | | Preconfigured | | | | | Uplink | | | | | Resource (L1 | | | | | ACK or | | | | | fallback | | | | | indication) | | | +----------------+----------------+----------------+----------------+
## 7.2 Backoff Parameter values
Backoff Parameter values are presented in Table 7.2-1 except for NB-IoT where
Table 7.2-2 shall be used.
Table 7.2-1: Backoff Parameter values.
Index Backoff Parameter value (ms)
* * *
0 0 1 10 2 20 3 30 4 40 5 60 6 80 7 120 8 160 9 240 10 320 11 480 12 960 13
Reserved 14 Reserved 15 Reserved
The reserved values of the backoff parameter if received by the current
release version UEs shall be taken as 960 ms.
Table 7.2-2: Backoff Parameter values for NB-IoT.
Index Backoff Parameter value (ms)
* * *
0 0 1 256 2 512 3 1024 4 2048 5 4096 6 8192 7 16384 8 32768 9 65536 10 131072
11 262144 12 524288 13 Reserved 14 Reserved 15 Reserved
The reserved values of the backoff parameter if received by the current
release version NB-IoT UEs shall be taken as 524288 ms.
## 7.3 PRACH Mask Index values
Table 7.3-1: PRACH Mask Index values
+------------------+------------------------+------------------------+ | PRACH Mask Index | Allowed PRACH (FDD) | Allowed PRACH (TDD) | +==================+========================+========================+ | 0 | All | All | +------------------+------------------------+------------------------+ | 1 | PRACH Resource Index 0 | PRACH Resource Index 0 | +------------------+------------------------+------------------------+ | 2 | PRACH Resource Index 1 | PRACH Resource Index 1 | +------------------+------------------------+------------------------+ | 3 | PRACH Resource Index 2 | PRACH Resource Index 2 | +------------------+------------------------+------------------------+ | 4 | PRACH Resource Index 3 | PRACH Resource Index 3 | +------------------+------------------------+------------------------+ | 5 | PRACH Resource Index 4 | PRACH Resource Index 4 | +------------------+------------------------+------------------------+ | 6 | PRACH Resource Index 5 | PRACH Resource Index 5 | +------------------+------------------------+------------------------+ | 7 | PRACH Resource Index 6 | Reserved | +------------------+------------------------+------------------------+ | 8 | PRACH Resource Index 7 | Reserved | +------------------+------------------------+------------------------+ | 9 | PRACH Resource Index 8 | Reserved | +------------------+------------------------+------------------------+ | 10 | PRACH Resource Index 9 | Reserved | +------------------+------------------------+------------------------+ | 11 | Every, in the time | Every, in the time | | | domain, even PRACH | domain, even PRACH | | | opportunity | opportunity | | | | | | | 1^st^ PRACH Resource | 1^st^ PRACH Resource | | | Index in subframe | Index in subframe | +------------------+------------------------+------------------------+ | 12 | Every, in the time | Every, in the time | | | domain, odd PRACH | domain, odd PRACH | | | opportunity | opportunity | | | | | | | 1^st^ PRACH Resource | 1^st^ PRACH Resource | | | Index in subframe | Index in subframe | +------------------+------------------------+------------------------+ | 13 | Reserved | 1^st^ PRACH Resource | | | | Index in subframe | +------------------+------------------------+------------------------+ | 14 | Reserved | 2^nd^ PRACH Resource | | | | Index in subframe | +------------------+------------------------+------------------------+ | 15 | Reserved | 3^rd^ PRACH Resource | | | | Index in subframe | +------------------+------------------------+------------------------+
## 7.4 Subframe_Offset values
Subframe_Offset values are presented in Table 7.4-1.
Table 7.4-1: Subframe_Offset values
TDD UL/DL configuration Position of initial Semi-Persistent grant
Subframe_Offset value (ms)
* * *
0 N/A 0 1 Subframes 2 and 7 1 Subframes 3 and 8 -1 2 Subframe 2 5 Subframe 7
-5 3 Subframes 2 and 3 1 Subframe 4 -2 4 Subframe 2 1 Subframe 3 -1 5 N/A 0 6
N/A 0
## 7.5 TTI_BUNDLE_SIZE value
The parameter TTI_BUNDLE_SIZE is 4.
## 7.6 DELTA_PREAMBLE values
Except for NB-IoT, the DELTA_PREAMBLE preamble format based power offset
values are presented in Table 7.6-1.
Table 7.6-1: DELTA_PREAMBLE values.
Preamble Format DELTA_PREAMBLE value
* * *
0 0 dB 1 0 dB 2 -3 dB 3 -3 dB 4 8 dB
Where the Preamble Format is given by _prach-ConfigIndex_ , as specified in TS
36.211 [7].
For NB-IoT, the DELTA_PREAMBLE preamble format based power offset values are
presented in Table 7.6-2.
Table 7.6-2: DELTA_PREAMBLE values for NB-IoT.
Preamble Format DELTA_PREAMBLE value
* * *
                    Frame Structure Type 1   Frame Structure Type 2
0, 1 0 dB 0dB 0a, 1a - 0dB 2 10*log10(1/3) dB 0dB
Where Preamble Format is specified in TS 36.211 [7].
## 7.7 HARQ RTT Timers
For each serving cell, in case of FDD configuration not configured with
_subframeAssignment-r15_ and in case of Frame Structure Type 3 configuration
on the serving cell which carries the HARQ feedback for this serving cell the
HARQ RTT Timer is set to 8 subframes. For each serving cell, in case of TDD
configuration or FDD with _subframeAssignment-r15_ configured on the serving
cell which carries the HARQ feedback for this serving cell the HARQ RTT Timer
is set to k + 4 subframes, where k is the interval between the downlink
transmission and the transmission of associated HARQ feedback, as indicated in
clauses 10.1 and 10.2 of TS 36.213 [2], and for an RN configured with _rn-
SubframeConfig_ , as specified in TS 36.331 [8] and not suspended, as
indicated in Table 7.5.1-1 of TS 36.216 [11].
For each serving cell, for HARQ processes scheduled using Short Processing
Time (TS 36.331 [8]) the HARQ RTT is set to 6 subframes for FDD and Frame
Structure Type 3 and set to k + 3 subframes for TDD, where k is the interval
between the downlink transmission and the transmission of associated HARQ
feedback, as indicated in clauses 10.1 and 10.2 of TS 36.213 [2].
For each serving cell, for HARQ processes scheduled using short TTI (TS 36.331
[8]) the HARQ RTT is set to 8 TTIs if the TTI length is one slot or if _proc-
Timeline_ is set to n+4 set1, to 12 TTIs if _proc-Timeline_ is set to n+6 set1
or n+6 set2 and to 16 TTIs if _proc-Timeline_ is set to n+8 set2 for FDD and
Frame Structure Type 3.
For TDD short TTI the HARQ RTT is set to k + 4 TTIs, where k is the interval
between the downlink transmission and the transmission of associated HARQ
feedback, as indicated in clauses 10.1 and 10.2 of TS 36.213 [2].
For BL UEs and UEs in enhanced coverage, when single TB is scheduled by PDCCH
the HARQ RTT Timer corresponds to 7 + N where N is the used PUCCH repetition
factor, where only valid (configured) UL subframes as configured by upper
layers in _fdd-UplinkSubframeBitmapBR_ are counted. _In case of TDD, HARQ RTT
Timer corresponds to 3 + k + N, where k is the interval between the last
repetition of downlink transmission and the first repetition of the
transmission of associated HARQ feedback, and N is the used PUCCH repetition
factor, where only valid UL subframes are counted as indicated in clauses 10.1
and 10.2 of TS 36.213 [2]._
_For BL UEs and UEs in enhanced coverage, when multiple TBs are scheduled by
PDCCH and HARQ-ACK bundling is not configured, the HARQ RTT Timer corresponds
to 7 + m * N where N is the used PUCCH repetition factor and m is the number
of scheduled TBs as indicated in PDCCH, where only valid (configured) UL
subframes as configured_ by upper layers in _fdd-UplinkSubframeBitmapBR_ are
counted.
_For BL UEs and UEs in enhanced coverage, when multiple TBs are scheduled by
PDCCH and HARQ-ACK bundling is configured the HARQ RTT Timer corresponds to 7
+ M * N where N is the used PUCCH repetition factor and M is the number of TB
bundles as specified in clause 7.3 of TS 36.213 [2], where only valid
(configured) UL subframes as configured_ by upper layers in _fdd-
UplinkSubframeBitmapBR_ are counted.
For NB-IoT, when single TB is scheduled by PDCCH or when multiple TBs are
scheduled for the interleaved case when HARQ-ACK bundling is configured the
HARQ RTT Timer is set to k+3+N+deltaPDCCH subframes, where k is the interval
between the last subframe of the downlink transmission and the first subframe
of the associated HARQ feedback transmission and N is the transmission
duration in subframes of the associated HARQ feedback, and deltaPDCCH is the
interval starting from the subframe following the last subframe of the
associated HARQ feedback transmission plus 3 subframes to the first subframe
of the next PDCCH occasion.
For NB-IoT, when multiple TBs are scheduled by PDCCH for the non-interleaved
case or for the interleaved case when HARQ-ACK bundling is not configured, the
HARQ RTT Timer is set to k+2*N+1+deltaPDCCH subframes where k is the interval
between the last subframe of the downlink transmission and the first subframe
of the first HARQ feedback transmission and N is the transmission duration in
subframes of the associated HARQ feedback, and deltaPDCCH is the interval
starting from the subframe following the last subframe of the last HARQ
feedback transmission plus 1 subframe to the first subframe of the next PDCCH
occasion.
Except for NB-IoT and for HARQ processes scheduled using Short Processing Time
and for short TTI, UL HARQ RTT Timer length is set to 4 subframes _for FDD and
Frame Structure Type 3, and set to k~ULHARQRTT~ subframes for TDD, where
k~ULHARQRTT~ equals to the k~PHICH~ value indicated in Table 9.1.2-1 of TS
36.213 [2] if the UE is not configured with upper layer parameter symPUSCH-
UpPts for the serving cell, otherwise the k~PHICH~ value is indicated in Table
9.1.2-3_.
For NB-IoT, when single TB is scheduled by PDCCH the UL HARQ RTT timer length
is set to 4+deltaPDCCH subframes, where deltaPDCCH is the interval starting
from the subframe following the last subframe of the PUSCH transmission plus 3
subframes to the first subframe of the next PDCCH occasion.
For NB-IoT, when multiple TBs are scheduled by PDCCH the UL HARQ RTT timer
length is set to 1+deltaPDCCH subframes, where deltaPDCCH is the interval
starting from the subframe following the last subframe of the PUSCH
transmission plus 1 subframe to the first subframe of the next PDCCH occasion.
For HARQ processes scheduled using Short Processing Time (TS 36.331 [8]), the
UL HARQ RTT Timer length is set to 3 subframes for FDD and for Frame Structure
Type 3, _and set to k~ULHARQRTT~ subframes for TDD, where k~ULHARQRTT~ equals
the value indicated in Table 7.7-1_ and Table 7.7-2.
For HARQ processes scheduled using short TTI (TS 36.331 [8]), the UL HARQ RTT
Timer length is set to 8 TTIs if the TTI length is one slot or if _proc-
Timeline_ is set to n+4 set1, to 12 TTIs if _proc-Timeline_ is set to n+6 set1
or n+6 set2 and to 16 TTIs if _proc-Timeline_ is set to n+8 set2 for FDD and
Frame Structure Type 3. For TDD short TTI the UL HARQ RTT is _set to
k~ULHARQRTT~ TTIs, where k~ULHARQRTT~ equals the value indicated in Table
7.7-3_ , Table 7.7-4 and Table 7.7-5.
Table 7.7-1: k~ULHARQRTT~ for TDD Short Processing Time when special subframe
configurations 0\~9 is configured
* * *
**TDD UL/DL\** subframe index _n_**  
Configuration**
* * *
                    **0**                    **1**   **2**   **3**   **4**   **5**   **6**   **7**   **8**   **9**
0 3 3 6 3 3 6
1 3 3 3 3
2 3 3
3 3 3 3
4 3 3
5 3
6 3 3 5 3 3
* * *
Table 7.7-2: k~ULHARQRTT~ for TDD Short Processing Time applied when special
subframe configuration 10 is configured
* * *
**TDD UL/DL\** subframe index n**  
Configuration**
* * *
                    **0**                  **1**   **2**   **3**   **4**   **5**   **6**   **7**   **8**   **9**
0 4 3 3 6 4 3 3 6
1 3 3 3 3 3 3
2 3 3 3 3
3 4 3 3 3
4 3 3 3
5 3 3
6 4 3 3 5 3 3 3
* * *
Table 7.7-3: k~ULHARQRTT~ for TDD short TTI applied when special subframe
configurations 1, 2, 3, 4, 6, 7 and 8 are configured
* * *
**TDD UL/DL\** sTTI index _n_**  
Configuration**
* * *
                    **0**                **1**   **2**   **3**   **4**   **5**   **6**   **7**   **8**   **9**   **10**   **11**   **12**   **13**   **14**   **15**   **16**   **17**   **18**   **19**
0 6 _5_ _4_ 4 4 4 6 5 4 4 4 4
1 _4_ 4 _4_ 4 4 4 4 4
2 4 4 _4_ _4_
3 6 5 _4_ _4_ _4_ 4
4 4 4 4 _4_
5 4 4
6 6 _5_ _4_ 4 4 _4_ 4 4 4 4
* * *
Table 7.7-4: k~ULHARQRTT~ for TDD short TTI applied when special subframe
configurations 0, 5 and 9 are configured
* * *
**TDD UL/DL\** sTTI index _n_**  
Configuration**
* * *
                    **0**                **1**   **2**   **3**   **4**   **5**   **6**   **7**   **8**   **9**   **10**   **11**   **12**   **13**   **14**   **15**   **16**   **17**   **18**   **19**
0 6 _5_ _4_ 4 4 11 6 5 4 4 4 11
1 _4_ 4 _4_ 4 4 4 4 4
2 4 4 _4_ _4_
3 6 5 _4_ _4_ _4_ 4
4 4 4 4 _4_
5 4 4
6 6 _5_ _4_ 4 4 _9_ 4 4 4 4
* * *
Table 7.7-5: _k~ULHARQRTT~ for TDD_ short TTI applied when special subframe
configuration 10 is configured
* * *
**TDD UL/DL\** sTTI index _n_**  
Configuration**
* * *
                    **0**                **1**   **2**   **3**   **4**   **5**   **6**   **7**   **8**   **9**   **10**   **11**   **12**   **13**   **14**   **15**   **16**   **17**   **18**   **19**
0 7 6 _5_ _4_ 4 4 11 7 6 5 4 4 4 11
1 5 _4_ 4 _4_ 4 5 4 4 4 4
2 4 4 4 _4_ _4_ _4_
3 7 6 5 _4_ _4_ _4_ 4
4 5 4 4 _4_ _4_
5 4 4 4
6 7 6 _5_ _4_ 4 4 _9_ 5 4 4 4 4
* * *
## 7.8 DL_REPETITION_NUMBER value
The parameter DL_REPETITION_NUMBER value is received from lower layers and
corresponds to the repetition level as specified in TS 36.213 [2].
## 7.9 UL_REPETITION_NUMBER value
The parameter UL_REPETITION_NUMBER value is received from lower layers and
corresponds to the repetition level as specified in TS 36.213 [2].
###### ## Annex A (normative): Handling of measurement gaps
In this specification, the subframes which cannot be used for transmission
according to clause 8.1.2.1 of TS 36.133 [9] are also considered as part of
measurement gaps in uplink. Measurement gaps are defined in TS 36.133 [9].
In a subframe that is part of a measurement gap, the UE shall not perform the
transmission of HARQ feedback and CQI/PMI/RI/PTI/CRI, and SRS shall not be
reported.
###### ## * *Annex B (normative): Contention resolution for RACH access
When checking whether contention resolution was successful a MAC entity
considers the MAC header structures shown below for the processing of a MAC
PDU containing a UE Contention Resolution Identity MAC control element.
Figure B-1: MAC header structures containing a UE Contention Resolution
Identity MAC control element
NOTE 1: For Case 1 (only Contention Resolution ID is carried), the resulting
MAC PDU content is of fixed size and UE interprets the rest of MAC PDU data
(if any) as padding without MAC subheader for padding.
NOTE 2: For Case 2 to Case 6, LCID of \'00001\' is applicable only when UE
supports the CIoT EPS User Plane optimisation.
NOTE 3: Case 7 and Case 8 are only applicable to EDT when the UE supports the
CIoT EPS User Plane optimisation. For NB-IoT UE, n is 1 or 2\. For BL UE or a
UE in enhanced coverage, n is from 1 to 8.
NOTE 4: In Case 7, if n is 1, there is no L field after the subheader of MAC
SDU for DTCH.
###### ## Annex C (informative): Intended UE behaviour for DRX Timers
When a DRX timer is set to a value of _X_ , and _n_ denotes the subframe in
which the related event is triggered according to the clause 5.7, the intended
behaviours of each DRX timer are presented in the Table C-1 below:
Table C-1: Intended UE behaviour for DRX timers
+----------------------------------+----------------------------------+ | DRX Timers | Intended UE behaviour\ | | | ([x, y] means including | | | subframe x and y) | +==================================+==================================+ | drx-InactivityTimer | The MAC entity monitors PDCCH in | | | PDCCH-subframes during the | | | subframes [n+1, n+m]. | | | | | | The MAC entity starts or | | | restarts drxShortCycleTimer, and | | | uses Short DRX Cycle in the | | | subframe n+m+1, if configured. | +----------------------------------+----------------------------------+ | drx-InactivityTimerSCPTM | The MAC entity monitors PDCCH in | | | PDCCH-subframes during the | | | subframes [n+1, n+m]. | +----------------------------------+----------------------------------+ | mac-ContentionResolutionTimer or | The MAC entity monitors PDCCH in | | mac-ContentionResolutionTimer | PDCCH-subframes during the | | for the corresponding enhanced | subframes [n+1, n+X]. | | coverage level, if it exists | | +----------------------------------+----------------------------------+ | drx-RetransmissionTimer or | The MAC entity monitors PDCCH in | | drx-ULRetransmissionTimer | PDCCH-subframes during the | | | subframes [n, n+m-1]. | +----------------------------------+----------------------------------+ | onDurationTimer or | The MAC entity monitors PDCCH in | | onDurationTimerSCPTM | PDCCH-subframes during the | | | subframes [n, n+m-1]. | +----------------------------------+----------------------------------+ | drxShortCycleTimer | The MAC entity uses the Short | | | DRX Cycle during the subframes | | | [n, n+X-1]. | | | | | | The MAC entity starts to use the | | | Long DRX Cycle in the subframe | | | n+X. | +----------------------------------+----------------------------------+ | HARQ RTT Timer | The MAC entity starts | | | drx-RetransmissionTimer in the | | | subframe n+X, if needed. | +----------------------------------+----------------------------------+ | UL HARQ RTT Timer | The MAC entity starts | | | drx-ULRetransmissionTimer in the | | | subframe n+X, if needed. | +----------------------------------+----------------------------------+ | NOTE 1: For FDD, m is equal to | | | X; for TDD, m is equal to the | | | minimum number of subframes so | | | that X PDCCH-subframes are | | | included during the subframes | | | [x, y]. | | | | | | NOTE 2: A MAC entity configured | | | with eIMTA monitors PDCCH in | | | some subframe(s) in addition to | | | PDCCH-subframes, as specified in | | | clause 5.7. | | | | | | NOTE 3: For BL UE or UE in | | | enhanced coverage, m is equal to | | | the minimum number of subframes | | | so that X PDCCH-subframes are | | | included during the subframes | | | [x, y]. | | +----------------------------------+----------------------------------+
For _drx-InactivityTimerSCPTM, drx-InactivityTimer_ , _drx-RetransmissionTimer
and drx-ULRetransmissionTimer_ , if _X_ =0, the timer does not make the MAC
entity to monitor the PDCCH.
The intended UE behaviours in Table C-1 are not applicable for NB-IoT.
For NB-IoT, the intended UE behaviour regarding setting the HARQ RTT Timer is
shown in Figure C-1 and for the UL HARQ RTT Timer is shown in Figure C-2.
Figure C-1: Setting the HARQ RTT Timer for NB-IoT
Figure C-2: Setting the UL HARQ RTT Timer for NB-IoT
###### ## Annex D (normative): List of CRs Containing Early Implementable
Features and Corrections
This annex lists the Change Requests (CRs) whose changes may be implemented by
a UE of an earlier release than which the CR was approved in (i.e. CRs that
contain on their coversheets the sentence \"Implementation of this CR from
Rel-N will not cause interoperability issues\").
Table D-1: List of CRs Containing Early Implementable Features and Corrections
+-------------+-------------+-------------+-------------+-------------+ | TDoc Number | CR | CR Revision | Earliest | Additional | | ( | Number(s) | Number(s) | Im | Information | | RP-xxxxxx): | | | plementable | | | CR Title | | | Release | | +=============+=============+=============+=============+=============+ | RP-181232: | 1300 | 2 | Release 13 | | | Clarifying | | | | | | PDCCH | | | | | | Period | | | | | | Definition | | | | | +-------------+-------------+-------------+-------------+-------------+ | RP-181961: | 1327 | 1 | Release 13 | | | Defining | | | | | | PDCC | | | | | | H-Subframes | | | | | | for NB-IoT | | | | | | UE | | | | | +-------------+-------------+-------------+-------------+-------------+ | RP-191385: | 1450 | 1 | Release 13 | | | Cl | | | | | | arification | | | | | | of Length | | | | | | field for | | | | | | DPR | | | | | +-------------+-------------+-------------+-------------+-------------+ | RP-192941: | 1459 | 2 | Release 13 | | | Cl | | | | | | arification | | | | | | of PDCCH | | | | | | monitoring | | | | | | when not | | | | | | fully | | | | | | aligned | | | | | | with PDCCH | | | | | | periods | | | | | +-------------+-------------+-------------+-------------+-------------+ | RP-210700: | 1521 | 1 | Release 14 | | | Recommended | | | | | | bit rate | | | | | | query | | | | | | handling at | | | | | | MAC reset | | | | | +-------------+-------------+-------------+-------------+-------------+ | RP-220472: | 1535 | 1 | Release 14 | | | I | | | | | | ntroduction | | | | | | of carrier | | | | | | specific | | | | | | NRSRP | | | | | | thresholds | | | | | | for NPRACH | | | | | | resource | | | | | | selection | | | | | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: In | | | | | | case a CR | | | | | | has mirror | | | | | | CR(s), the | | | | | | mirror | | | | | | CR(s) are | | | | | | not listed. | | | | | | | | | | | | NOTE 2: The | | | | | | Additional | | | | | | Information | | | | | | column | | | | | | briefly | | | | | | describes | | | | | | the content | | | | | | of a CR in | | | | | | cases where | | | | | | the CR | | | | | | title may | | | | | | not be | | | | | | descriptive | | | | | | enough. If | | | | | | the CR is | | | | | | descriptive | | | | | | enough, | | | | | | then the | | | | | | Additional | | | | | | Information | | | | | | column may | | | | | | be left | | | | | | blank. | | | | | +-------------+-------------+-------------+-------------+-------------+
#
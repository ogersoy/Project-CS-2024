# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
User Equipment (UE) Test Loop functionality is a mandatory feature to support
E-UTRA / EPC conformance testing. It forms part of the core requirements and
thus has a direct impact on the design of the UE.
The test methods applied in RF Conformance Test Specification TS 36.521-1 [27]
and the test models used in Protocol Conformance Test Specifications TS
36.523-1 [30] and TS 36.523-3 [32] define the corresponding UE Test Loop
functionality. The present specification describes the location of the data
loop in the protocol stack as well as the procedure and specific messages to
activate/deactivate the Test Loop functionality in the UE.
# 1 Scope
The present document defines for User Equipment (UE) in E-UTRA FDD or TDD mode
those special functions and their activation/deactivation methods that are
required in UE for conformance testing purposes.
This document also describes the operation of these special functions for UEs
supporting E-UTRA FDD or TDD mode, when operating in UTRA FDD and TDD mode, in
GSM/GPRS mode, and in CDMA2000 mode.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or nonâ€‘specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document in the same Release as the present document.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.003: \"Numbering, Addressing and Identification\".
[3] 3GPP TS 23.122: \"Non-Access-Stratum functions related to Mobile Station
(MS) in idle mode\".
[4] 3GPP TS 23.401: \"3GPP System Architecture Evolution; GPRS enhancements
for E-UTRAN access\".
[5] 3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General
aspects\".
[6] 3GPP TS 24.008: \"Mobile Radio Interface Layer 3 specification; Core
Network Protocols; Stage 3\".
[7] 3GPP TR 24.801: \"3GPP System Architecture Evolution; CT WG1 Aspects\".
[8] 3GPP TS 27.007: \"AT command set for User Equipment (UE)\".
[9] 3GPP TS 31.101: \"UICC-Terminal Interface; Physical and Logical
Characteristics\".
[10] 3GPP TS 34.108: \"Common Test Environments for User Equipment (UE)
Conformance Testing\".
[11] 3GPP TS 34.109: \"Terminal logical test interface; Special conformance
testing functions\".
[12] 3GPP TS 34.123-1: \"User Equipment (UE) conformance specification; Part
1: Protocol conformance specification\".
[13] 3GPP TS 34.123-2: \"User Equipment (UE) conformance specification; Part
2: Implementation Conformance Statement (ICS) proforma specification\".
[14] 3GPP TS 34.123-3: \"User Equipment (UE) conformance specification; Part
3: Abstract Test Suites (ATS)\".
[15] 3GPP TS 36.133: \"Requirements for support of Radio Resource
Management\".
[16] 3GPP TS 36.211: \"Physical Channels and Modulation\".
[17] 3GPP TS 36.212: \"Multiplexing and Channel Coding\".
[18] 3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall
description; Stage 2\".
[19] 3GPP TS 36.302: \"Services provided by the physical layer for E-UTRA\".
[20] 3GPP TS 36.304: \"Evolved Universal Terrestrial Radio Access (EUTRA) User
Equipment (UE) Procedures in idle mode \".
[21] 3GPP TS 36.306: \"Evolved Universal Terrestrial Radio Access (EUTRA) User
Equipment (UE) Radio Access capabilities \".
[22] 3GPP TS 36.321: \"Evolved Universal Terrestrial Radio Access (EUTRA)
Medium Access Control (MAC) protocol specification\".
[23] 3GPP TS 36.322: \"Evolved Universal Terrestrial Radio Access (EUTRA)
Radio Link Control (RLC) protocol specification\".
[24] 3GPP TS 36.323: \"Evolved Universal Terrestrial Radio Access (EUTRA)
Packet Data Convergence Protocol (PDCP) specification\".
[25] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (EUTRA)
Radio Resource Control (RRC) Protocol Specification\".
[26] 3GPP TS 36.508: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Packet Core (EPC); Common test environments for User Equipment (UE);
Conformance Testing\".
[27] 3GPP TS 36.521-1: \" Evolved Universal Terrestrial Radio Access (E-UTRA);
User Equipment (UE) conformance specification Radio transmission and
reception; Part 1: Conformance Testing\".
[28] 3GPP TS 36.521-2: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
User Equipment (UE) conformance specification Radio transmission and
reception; Part 2: Implementation Conformance Statement (ICS)\".
[29] 3GPP TS 36.521-3: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
User Equipment (UE) conformance specification Radio transmission and
reception; Part 3: Radio Resource Management Conformance Testing\".
[30] 3GPP TS 36.523-1: \" Evolved Universal Terrestrial Radio Access (E-UTRA)
and Evolved Packet Core (EPC); User Equipment (UE) conformance specification;
Part 1: Protocol conformance specification\".
[31] 3GPP TS 36.523-2: \"Evolved Universal Terrestrial Radio Access (E-UTRA)
and Evolved Packet Core (EPC); User Equipment (UE) conformance specification;
Part 2: Implementation Conformance Statement (ICS) proforma specification\".
[32] 3GPP TS 36.523-3: \" Evolved Universal Terrestrial Radio Access (E-UTRA)
and Evolved Packet Core (EPC)); User Equipment (UE) conformance specification;
Part 3: Abstract Test Suites (ATS)\".
[33] 3GPP TS 44.014: \"Individual equipment type requirements and
interworking; Special conformance testing functions\".
[34] 3GPP TS 51.010-1: \"Mobile Station (MS) conformance specification; Part
1: Conformance specification \".
[35] ISO/IEC 9646 (all parts): \"Information technology - Open Systems
Interconnection - Conformance testing methodology and framework\".
[36] 3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS); Stage 3\".
[37] 3GPP TS 37.355: \"LTE Positioning Protocol (LPP)\".
[38] 3GPP TS 24.334: \"Proximity-services (ProSe) User Equipment (UE) to ProSe
function protocol aspects; Stage 3\".
[39] 3GPP TS 23.060: \" General Packet Radio Service (GPRS); Service
description; Stage 2\".
[40] 3GPP TR 36.978: "User Equipment (UE) antenna test function definition for
two-stage Multiple Input Multiple Output (MIMO) Over The Air (OTA) test
method"
[41] 3GPP TS 36.214: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical layer; Measurements\"
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] apply, unless specified below:
**Uni-directional Data Radio Bearer** : Data radio bearer identified by a data
radio bearer identifier capable to deliver data only in downlink or uplink
**Bi-directional Data Radio Bearer** : Data radio bearer identified by a data
radio bearer identifier capable to deliver data in both downlink and uplink
**Logical Test Interface:** interface which provides the logical service to
interwork and to communicate between UE and System Simulator during the test
of a UE
**SS (System Simulator):** test system (or equipment) that drives the test
process with UE, like eNB (evolved Node B) simulator
**TC (Test Control):** UE protocol entity used by the SS to control the UE
specific testing functions
**UE (User Equipment):** user equipment as defined in [1] that is under test
**User:** test user, who handles the test and measurement process via the
logical test interface
**UE uplink Rate control entity** : The UE entity in a UE supporting Control
Plane CIoT EPS optimization that is handling the UE uplink rate control of
control plane messages carrying user data as specified in [36] TS 24.301
clause 6.3.8 (Serving PLMN rate control) and in [36] TS 24.301 clause 6.3.9
(APN rate control).
**EMM SAP for control plane user data** : The service access point to the EMM
sublayer for control plane user data handling the UE uplink rate control
entity for uplink transmissions of the User data container via ESM DATA
TRANSPORT messages.
**SMR SAP for control plane user data** : The service access point to the SMR
entity for uplink SMS user data handling for uplink transmissions of the RP
User data element in Uplink NAS Transport messages. For details on SMR entity
and SM-RP protocol see [39].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations specified in TR
21.905 [1] apply, with any additional abbreviations specified below:
ATF Antenna Test Function
DRB Data Radio Bearer
EMM EPS Mobility Management
E-MBMS Evolved Multimedia Broadcast Multicast Service
ENB Evolved Node B
EPS Bearer Evolved Packet System Bearer
ESM EPS Session Management
LB Loop Back
MAC Media Access Control
MBMS Multimedia Broadcast Multicast Service
MBS Metropolitan Beacon System
MTC Main Test Component
ProSe Proximity-based Services
RAB Radio Access Bearer
RMC Reference Measurement Channel
ROHC Robust Header Compression
RSAP Reference Signal Antenna Power
RSARP Reference Signal Antenna Relative Phase
SDF Service Data Flow
SMR Short Message Relay (entity)
SS System Simulator
TC Test Control
SC Single-cell
PTM point-to-multipoint
V2X Vehicle-to-Everything
# 4 UE special conformance test functions
## 4.1 General description
The SS performs activation and deactivation of the conformance test functions
in the UE by sending Security Protected NAS Layer 3 messages or AT commands.
Apart from sending the appropriate deactivation command to the UE the
functions shall be deactivated by:
switching off the UE; or
by removing the USIM.
The following special UE conformance testing functions can be activated (and
deactivated):
\- UE test loop function;
\- Electrical Man Machine Interface (EMMI).
The following Test Control (TC) procedures are used to control the UE test
loop function:
\- Close UE test loop;
\- Open UE test loop.
## 4.2 Requirements for UE support of test functions
Whether or not a particular test function should be supported by the UE for
facilitating the UE conformance testing is explicitly indicated throughout the
present specification. The use of the word \"mandatory\" in the present
specification shall be understood as a particular requirement being mandatory
for performing UE conformance testing.
# 5 Test Control (TC) protocol procedures and test loop operation
## 5.1 General description
The UE test loop function provides access to isolated functions of the UE via
the radio interface without introducing wherever possible new physical
interfaces just for the reason of conformance testing.
NOTE 0: One exception from the rule above is the UE test loop mode E and UTC
time reset when used for V2X out-of-coverage test scenarios which require an
additional physical interface for the transmission of AT commands. This has
been based on the assumption that V2X devices will normally provide such
interface for other than testing purposes e.g. for device configuration.
NOTE 1: It should be emphasised that the UE test loop function only describes
the functional behaviour of the UE with respect to its external interfaces;
physical implementation of the UE test loop function is completely left open
to the manufacturer.
The UE test loop function is activated by transmitting the appropriate TC
message to the UE, see clause 6.
The UE test loop function can be operated in different loopback modes:
\- UE test loop mode A;
\- UE test loop mode B;
\- UE test loop mode C;
\- UE test loop mode D;
\- UE test loop mode E;
\- UE test loop mode F;
\- UE test loop mode G;
\- UE test loop mode H;
\- UE test loop mode I.
UE test loop mode A provides loopback of PDCP SDUs for bi-directional data
radio bearers while UE is operating in E-UTRA or NB-IoT mode. The downlink
PDCP SDUs received by the UE on each bi-directional data radio bearer are
returned on the same radio bearer regardless of the PDCP SDU contents and of
the TFT of the associated EPS bearer context [36].
UE test loop mode B provides loopback of PDCP SDUs (E-UTRA and UTRA), SNDCP
PDUs (GSM/GPRS) and RLP PDUs (CDMA2000) for bi-directional EPS bearers while
UE is operated in E-UTRA, NB-IoT, UTRA, GSM/GPRS or CDMA2000 modes. When
operating in E-UTRA, NB-IoT, UTRA or GSM/GPRS then the downlink PDCP SDUs or
SNDCP PDUs received by the UE on all bi-directional data radio bearers are
returned by the UE on the data radio bearer associated with an EPS bearer
context with a TFT matching the TCP/UDP/IP protocol information within the
PDCP SDU or SNDCP SDU [36]. When operating in CDMA2000 modes, the downlink RLP
PDUs received by the UE on all bi-directional data radio bearers are returned
by the UE on the data radio bearer with the smallest identity, regardless of
the RLP PDU content and of the TFT of the associated EPS bearer context.
NOTE 2: When multiple PDN connections are established (or multiple Primary PDP
Contexts are active), it is assumed that different IP addresses are allocated
to the UE by the SS on each PDN.
UE test loop mode C provides counting of successfully received MBMS Packets on
a given MTCH while UE is operating in E-MBMS/E-UTRA mode. For E-MBMS then one
or more MTCHs are multiplexed on a MCH. MBMS packets for a MTCH are delivered
as one RLC SDU per MBMS packet segmented into one or more RLC UMD PDUs.
UE test loop mode D provides means for announcing or monitoring of ProSe
Direct Discovery messages on SL-DCH, as specified by the test loop mode D
setup IE in the CLOSE UE TEST LOOP message. In particular, for discovery
monitor operation, UE test loop mode D provides counting of successfully
received SL-DCH MAC SDUs while the UE is operating in ProSe Direct
Discovery/E-UTRA mode. For discovery announce operation, UE test loop mode D
provides trigger for transmission of ProSe Direct Discovery message on SL-DCH.
NOTE 3: UE test loop mode D is intended for RF/RRM testing purposes.
NOTE 4: ProSe Direct Discovery messages on the PC5 interface are delivered as
one MAC SDU per ProSe Direct Discovery message.
UE test loop mode E provides means for either transmit or receive of ProSe
Direct or V2X Communication packets, as specified by the test loop mode E
setup IE in the CLOSE UE TEST LOOP message. In particular, for communication
receive operation, UE test loop mode E provides counting of successfully
received STCH PDCP SDUs, PSCCH PHY transport blocks and PSSCH PHY transport
blocks while the UE is operating in ProSe Direct or V2X Communication/E-UTRA
mode. For communication transmit operation, UE test loop mode E provides
trigger for transmission of ProSe Direct or V2X Communication packets. For the
V2X out-of-coverage scenarios this trigger utilises AT commands and requires
an appropriate physical interface.
NOTE 5: Void
NOTE 6: The Application trigger required to force the UE to start or stop a
particular ProSe Service is out of the scope of the test loop modes D and E.
UE test loop mode F provides counting of successfully received MBMS Packets on
a given SC-MTCH while UE is operating in SC-PTM/E-UTRA mode. For SC-PTM one
SC-MTCH is transmitted on a DL-SCH. MBMS packets for a SC-MTCH are delivered
as one RLC SDU per MBMS packet segmented into one or more RLC UMD PDUs.
UE test loop mode G provides loopback of the User data container content of
any received downlink ESM DATA TRANSPORT message in uplink. The received data
can be configured to be either returned via the UE EMM entity (before the UE
uplink rate control entity) or as a RLC SDU to the SRB RLC entity (SRB1bis for
NB-IoT UE or to SRB2 for E-UTRA UE). UE test loop mode G may be configured to
delay the uplink loopback of user data. UE test loop mode G may also be
configured to repeat the received user data of the User data container in
uplink to generate higher data rates in uplink.
UE test loop mode H provides loopback of the TP-User-Data field (including the
SMS user data) of any received downlink TPDU (SMS-DELIVER) in uplink. The
received data can be configured to be either returned via the UE SM-TL entity
or as a RLC SDU to the SRB RLC entity (SRB1bis for NB-IoT UE or to SRB2 for
E-UTRA UE). UE test loop mode H may be configured to delay the uplink loopback
of SMS user data. UE test loop mode H may also be configured to repeat the
received SMS user data in uplink to generate higher data rates in uplink.
NOTE 7: UE test loop mode G and H are intended for control plane data testing
for UEs supporting EPS services with Control Plane CIoT EPS optimization.
NOTE 8: The delay timer for UE test loop mode G and H is triggered by the
first reception of user data after the reception of a CLOSE UE TEST LOOP TC
message. While the delay timer is running only the user data received in the
latest ESM DATA TRANSPORT or SMS message is buffered.
NOTE 9: The repetition of uplink transmission of uplink messages carrying data
can be configured as 0 (no data returned), 1 (the same content and size of
user date as received in downlink is returned) or value N > 1 (user data
corresponding to N times repetition of the received user data is returned in
uplink).
UE test loop mode I provides loopback of the IP PDUs received in User data
container content of downlink ESM DATA TRANSPORT message in uplink via the UE
uplink TFT hander and the UE EMM entity (before the UE uplink rate control
entity).
NOTE 10: UE test loop mode I is intended for control plane data testing for
UEs supporting EPS services with Control Plane CIoT EPS optimization.
UE test loop mode A is mandatory to all E-UTRA UEs and all NB-IoT UEs
supporting user plane data transfer.
UE test loop mode B for operation in E-UTRA mode is mandatory to all E-UTRA
UEs and all NB-IoT UEs supporting user plane data transfer.
UE test loop mode B for operation in UTRA mode is mandatory to all E-UTRA UEs
supporting UTRA radio access.
UE test loop mode B for operation in GSM/GPRS mode is mandatory to all E-UTRA
UEs supporting GSM/GPRS radio access.
UE test loop mode B for operation in CDMA2000 mode is mandatory to all E-UTRA
UEs supporting CDMA2000 radio access.
UE test loop mode C is mandatory for E-UTRA UEs supporting E-MBMS.
UE test loop mode D is mandatory for E-UTRA UEs supporting ProSe Direct
Discovery.
UE test loop mode E is mandatory for E-UTRA UEs supporting ProSe Direct or V2X
Communication.
UE test loop mode F is mandatory for E-UTRA UEs supporting SC-PTM.
UE test loop mode G is mandatory for UEs supporting Control Plane CIoT EPS
optimization and control plane data transfer using the ESM DATA TRANSFER
procedure.
UE test loop mode H is mandatory for UEs supporting Control Plane CIoT EPS
optimization and control plane data transfer using SMS.
UE test loop mode I is mandatory for UEs supporting Control Plane CIoT EPS
optimization and control plane data transfer using the ESM DATA TRANSFER
procedure.
Support of UPDATE UE LOCATION INFORMATION is optional for all E-UTRA UEs with
the exception of E-UTRA UEs supporting ProSe Direct Communication for which it
is mandatory.
For E-UTRA UE supporting multiple radio access technologies then UE reception
of Test Control messages is limited to UE operating in E-UTRA mode, while
continuation of loopback of user data is provided over the change to other UE
supported radio access technologies.
UE test loop mode B for operation in UTRA, GSM/GPRS and CDMA2000 mode is only
applicable for loopback of user data in PS domain.
The TC entity may be seen as a L3 or a NAS entity.
Figure 5.1-1 shows a functional block diagram of UE test loop function for TC
entity and UE test loop mode A. The loopback of PDCP SDUs for UE test loop
mode A is specified in sub clause 5.4.3.
Figure 5.1-2 shows a functional block diagram of UE test loop function for TC
entity and UE test loop mode B. The loopback of IP PDUs/PDCP SDUs for UE test
loop mode B and UE in E-UTRA mode is specified in subclauses 5.4.4.2 and
5.4.4.3.
Figure 5.1-3 shows a functional block diagram of UE test loop function for UE
test loop mode B and UE operating in UTRA mode. The loopback of IP PDUs/PDCP
SDUs for UE test loop mode B and UE in UTRA mode is specified in subclauses
5.4.4.4 and 5.4.4.5.
Figure 5.1-4 shows a functional block diagram of UE test loop function for UE
test loop mode B for UE operating in GSM/GPRS mode. The loopback of IP
PDUs/SNDCP SDUs for UE test loop mode B and UE in GSM/GPRS mode is specified
in subclauses 5.4.4.6 and 5.4.4.7.
Figure 5.1-5 shows a functional block diagram of UE test loop function for UE
test loop mode B for UE operating in CDMA2000 mode. The loopback of IP
PDUs/RLP SDUs for UE test loop mode B and UE in CDMA2000 mode is specified in
subclauses 5.4.4.8 and 5.4.4.9.
Figure 5.1-6 shows a functional block diagram of UE test loop function for TC
entity and UE test loop mode C. The MBMS Packet Counter function for UE test
loop mode C is specified in sub clause 5.4.4.a. The MBMS Packet Counter
function is limited to count successfully received MBMS packets on one MTCH
configured by the SS when UE test loop mode C is activated.
Figure 5.1-7 and Figure 5.1-8 show a functional block diagram of the UE test
loop mode for TC entity and UE test loop mode D. The ProSe Direct Discovery
Packet Counter function for UE test loop mode D is specified in clause 5.4.4b.
The ProSe Direct Discovery packet counter function is limited to count
successfully received SL-DCH MAC SDUs when UE test loop mode D is activated.
Figure 5.1-9 and Figure 5.1-10 show a functional block diagram of the UE test
loop mode for TC entity and UE test loop mode E for UE supporting ProSe
Direct, or, V2X when UE is in in-coverage state. Figure 5.1-9a and Figure
5.1-10a show a functional block diagram of the UE test loop mode for TC entity
and UE test loop mode E for UE supporting V2X when UE is in out-of-coverage
state; the Electrical Man Machine Interface (EMMI) required for facilitating
the AT commands transmission is specified in clause 8. The ProSe Direct or V2X
Communication Packet Counter function for UE test loop mode E is specified in
clause 5.4.4c. The ProSe Direct or V2X Communication packet counter function
is limited to count successfully received STCH PDCP SDUs, PSCCH PHY Transport
blocks and PSSCH PHY Transport blocks when the UE test loop mode E is
activated.
Figure 5.1-11 shows a functional block diagram of UE test loop function for TC
entity and UE test loop mode F. The SC-PTM Packet Counter function for UE test
loop mode F is specified in sub clause 5.4.4.d. The SC-PTM Packet Counter
function is limited to count successfully received MBMS packets on one SC-MTCH
configured by the SS when UE test loop mode F is activated.
Figure 5.1-12 shows a functional block diagram of UE test loop function for TC
entity and UE test loop mode G when User data container content received in a
downlink ESM DATA TRANSFER message is configured to be returned in uplink via
the EMM entity. Figure 5.1-13 shows a functional block diagram of UE test loop
function for TC entity and UE test loop mode G when User data container
content received in a downlink ESM DATA TRANSFER message is configured to be
returned in uplink in a RLC SDU via the SRB1bis/SRB2 RLC AM entity. The UE
test loop mode G mode of operation is specified in sub clause 5.4.4e.
Figure 5.1-14 shows a functional block diagram of UE test loop function for TC
entity and UE test loop mode H when TP-User-Data (SMS user data) received in a
downlink TPDU (SMS-DELIVER) is configured to be returned in uplink via the SM-
TL entity (in a TPDU (SMS-SUBMIT)).
Figure 5.1-15 shows a functional block diagram of UE test loop function for TC
entity and UE test loop mode H when TP-User-Data (SMS user data) received in a
downlink TPDU (SMS-DELIVER) is configured to be returned in uplink in a RLC
SDU via the SRB1bis/SRB2 RLC AM entity. The UE test loop mode H mode of
operation is specified in sub clause 5.4.4f.
Figure 5.1-16 shows a functional block diagram of UE test loop function for TC
entity and UE test loop mode I when IP PDU received in User data container
content in a downlink ESM DATA TRANSFER message is returned in uplink via the
EMM entity. The UE test loop mode I mode of operation is specified in sub
clause 5.4.4g.
NOTE 7: ROHC functionality in PDCP Layer 2 is optional for UE implementations.
Figure 5.1-1: Model for Test Control and UE Test Loop Mode A on UE side for
E-UTRA and NB-IoT
Figure 5.1-2: Model for Test Control and UE Test Loop Mode B on UE side for
E-UTRA and NB-IoT
Figure 5.1-3: Model for UE Test Loop Mode B on UE side for UTRA
Figure 5.1-4: Model for UE Test Loop Mode B on UE side for GSM/GPRS
Figure 5.1-5: Model for UE Test Loop Mode B on UE side for CDMA2000
Figure 5.1-6: Model for UE test loop mode C on UE side
Figure 5.1-7: Model for UE test loop mode D on UE side\ (when Discovery
monitor is indicated in the UE test loop mode D setup IE)
Figure 5.1-8: Model for UE test loop mode D on UE side\ (when Discovery
announce is indicated in the UE test loop mode D setup IE)
Figure 5.1-9: Model for UE test loop mode E on UE side ProSe Direct, or, V2X
when UE is in in-coverage state\ (when Communication receive is indicated in
UE test loop mode E setup IE)
Figure 5.1-9a: Model for UE test loop mode E on UE side based on AT commands
V2X when UE is in out-of-coverage state\ (when Communication receive is
indicated in UE test loop mode E setup IE)
Figure 5.1-10: Model for UE test loop mode E on UE side ProSe Direct, or, V2X
when UE is in in-coverage state\ (when Communication transmit is indicated in
the UE test loop mode E setup IE)
Figure 5.1-10a: Model for UE test loop mode E on UE side based on AT commands
V2X when UE is in out-of-coverage state\ (when Communication transmit is
indicated in the UE test loop mode E setup IE)
Figure 5.1-11: Model for UE test loop mode F on UE side
Figure 5.1-12: Model for UE test loop mode G on UE side configured to return
downlink User data container content received in ESM DATA TRANSFER message in
uplink via the EMM entity (before the UE uplink rate control entity)
Figure 5.1-13: Model for UE test loop mode G on UE side configured to return
downlink User data container content received in ESM DATA TRANSFER message in
uplink via the SRB1bis/SRB2 RLC AM entity
Figure 5.1-14: Model for UE test loop mode H on UE side configured to return
the SMS user data received in the TPDU (SMS-DELIVER) received in the downlink
RP-DATA message in uplink via the SM-TL entity
Figure 5.1-15: Model for UE test loop mode H on UE side configured to return
the SMS user data received in the TPDU (SMS-DELIVER) received in the downlink
RP-DATA message in uplink via the SRB1bis/SRB2 RLC AM entity
Figure 5.1-16: Model for UE test loop mode I on UE side configured to return
downlink IP PDUs received in a ESM DATA TRANSFER message in uplink via the UE
UL TFT handler to the EMM entity (before the UE uplink rate control entity)
## 5.2 Security protection of test control messages
The test control messages, i.e. ACTIVATE TEST MODE, DEACTIVATE TEST MODE,
CLOSE UE TEST LOOP, and OPEN UE TEST LOOP, are integrity protected and
ciphered according to TS 24.301 clause 4.4.
## 5.3 UE test mode procedures
### 5.3.1 General
The UE test mode procedures are intended for setting the UE into a test mode
where the SS can set up data radio bearers (UE test loop mode A) or EPS
bearers (UE test loop mode B) or MTCH data radio bearers (UE test loop mode C)
or SL-DCH (UE test loop mode D) or STCH, PSCCH and PSSCH (UE test loop mode E)
or SC-MTCH (UE test loop mode F) to be terminated in the UE test loop
function; as well as, for making UE leave the test mode if it has previously
been set into it and return to normal operation.
### 5.3.2 Activate UE test mode
Figure 5.3.2-1: Activate UE test mode procedure in all but V2X communication
in out-of-coverage scenarios
Figure 5.3.2-2: Activate UE test mode procedure by AT Command for V2X
communication in out-of-coverage scenarios
#### 5.3.2.1 General
The SS uses the activate UE test mode procedure to get the UE into a test mode
where the SS can set up one or more sets of data radio bearers with an
associated EPS bearer context (UE test loop mode A) or EPS bearers (UE test
loop mode B) or MTCH data radio bearers (UE test loop mode C) or SC-MTCH data
radio bearers (UE test loop mode F) before commanding the UE to terminate them
in the UE test loop function. The SS also uses the activate UE test mode
procedure to get the UE into a test mode where SS can perform control plane
data testing (UE test loop mode G and H). The activation of the UE test loop
function in UE test loop mode A, UE test loop mode B, UE Test loop mode C, UE
test loop mode D, or UE test loop mode E, or UE test loop mode F will control
if the UE is terminating the data radio bearers, the EPS bearers or the MTCH
data radio bearer or the SL-DCH or the STCH/PSCCH /PSSCHor the SC-MTCH in the
UE test loop function. The activation of the UE test loop function in UE test
loop mode G will control if the EMM entity of the UE is terminating User data
container content received in ESM DATA TRANSPORT messages in the UE test loop
function. The activation of the UE test loop function in UE test loop mode H
will control if the SM-TL entity of the UE is terminating TP-User-Data fields
received in TPDUs in the UE test loop function. The activation of the UE test
loop function in UE test loop mode I will control if the ESM entity of the UE
is terminating User data container content received in ESM DATA TRANSPORT
messages in the UE test loop function.
#### 5.3.2.2 Initiation
The SS can activate the UE test mode when UE is in E-UTRA or NB-IoT connected
state or when UE capable of V2X communication is in out-of-coverage state.
NOTE: Refer to TS 36.508 [28] subclause 4.5.1 for more details on UE states.
The SS requests the UE to activate the UE test mode by transmitting an
ACTIVATE TEST MODE message when UE is in connected state or by transmitting an
AT Command +CATM=\ in the case of V2X UE in out-of-coverage state.
#### 5.3.2.3 Reception of ACTIVATE TEST MODE message or AT Command +CATM by UE
Upon receiving the ACTIVATE TEST MODE message the UE shall:
1> if the UE test loop mode parameter in the ACTIVATE TEST MODE message is
different from UE test loop mode G and different from UE test loop mode H and
a default EPS bearer context is already activated:
2> the UE behaviour is unspecified.
1> if the UE is in out-of-coverage state during a V2X test scenario:
2> the UE behaviour is unspecified.
> 1> else:
2> activate the UE test mode;
2> send ACTIVATE TEST MODE COMPLETE message.
Upon receiving the AT Command +CATM=\\ the UE
shall:
1> if the UE is in in-coverage state during a V2X test scenario, or, this is
not a V2X test scenario:
2> the UE behaviour is unspecified.
1> else:
2> activate the UE test mode.
When the UE test mode is active, the UE operates normally, except for the
following:
1> the UE shall accept any request to establish a data radio bearer with an
associated EPS bearer context, both included in the same RRC message, and
within the radio access capabilities of the UE;
1> optionally, if the UE supports CSG Proximity Indication;
2> the UE shall ignore any non 3GPP radio signals which are normally used in
determining proximity to a CSG (closed subscriber group) cell and delete any
previously stored cell information for proximity detection.
NOTE 1: The UE may provide other means which would guarantee that the UE
ignores any non 3GPP radio signals which are normally used in determining
proximity to a CSG (closed subscriber group) cell and deletes any previously
stored cell information for proximity detection. For such UEs the above
mentioned CSG requirements in UE test mode may not apply.
1> if neither test loop mode A operation, test loop mode B operation, test
loop mode C operation, test loop mode D operation, test loop mode E, test loop
mode F, test loop mode G, test loop mode H operation, nor test loop mode I
operation is ongoing:
2> if the UE is operating in E-UTRAN or NB-IoT mode, for each PDN connection
requested by the UE:
3> if the UE has not received the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST
message in response to the PDN CONNECTIVITY REQUEST message; or
3> if the UE has received the response message with the PDN type IE set to
\'IPv4\' and an IPv4 address value different from \'0.0.0.0\' and \"IPv4
address allocation via DHCPv4\" was not requested by the UE:
4> the UE shall not transmit any uplink PDCP SDU on any DRB associated with
the requested PDN:
4> the UE may discard any received downlink PDCP SDU on any DRB associated
with the requested PDN.
NOTE 2: If the UE has requested the use of DHCPv4 signalling for allocation of
an IPv4 address, the UE may either accept the IPv4 address provided via NAS
signalling and not transmit any uplink PDCP SDU on any DRB and may discard
downlink PDCP SDUs on any DRB, or the UE may transmit and receive DHCPv4
messages to obtain an IPv4 address, according to the procedure described in TS
36.508 clause 4.5.2A.
3> if the UE has received the response message with the PDN type IE set to
'IPv6' or 'IPv4v6' or \"IPv4 address allocation via DHCPv4\" was requested by
the UE , and the UE has not yet obtained its IP address(es);
4> the UE may transmit uplink PDCP SDUs on any DRB associated with the
requested PDN, for the sole purpose of obtaining its IP address(es).
3> if the UE has obtained its IP address(es):
4> the UE shall not transmit any uplink PDCP SDU on any DRB associated with
the requested PDN:
4> the UE may discard any received downlink PDCP SDU on any DRB associated
with the requested PDN.
### 5.3.3 Deactivate UE test mode
Figure 5.3.3-1: Deactivate UE test mode procedure
Figure 5.3.3-2: Deactivate UE test mode procedure by AT Command V2X
communication in out-of-coverage test scenarios
#### 5.3.3.1 General
The purpose of this procedure is to deactivate the UE test mode and return UE
to normal operation.
NOTE: Deactivation of the UE test loop mode may occur as well as a result of
other events. For further details see e.g. 4.1, 5.4.2.1.
#### 5.3.3.2 Initiation
The SS can deactivate the UE test mode when UE is in E-UTRA or NB-IoT
connected state or when UE capable of V2X communication is in out-of-coverage
state, and the UE test mode is active.
NOTE 1: Refer to TS 36.508 [28] subclause 4.5.1 for more details on UE states.
The SS requests the UE to deactivate the UE test mode by transmitting a
DEACTIVATE TEST MODE message or by transmitting an AT Command
+CATM=\ in the case of V2X UE being in out-of-coverage state.
Deactivation in V2X test scenarios shall be requested using the method
relevant to the UE V2X state at the time the deactivation command needs to be
sent.
NOTE 2: Depending on the test scenario it is possible that a test is started
with the UE being in V2X in-coverage state and in this state the test loop
mode is activate using the ACTIVATE TEST MODE command and then the test
transitions into the UE being in V2X out-of-coverage state where the test loop
mode needs to be deactivated using the AT command.
#### 5.3.3.3 Reception of DEACTIVATE TEST MODE message or AT Command +CATM by
UE
Upon receiving the DEACTIVATE TEST MODE message the UE shall:
1> if the UE is in in-coverage state during a V2X test scenario or this is not
a V2X test scenario, and, the test mode is active:
2> deactivate the UE test mode;
2> send a DEACTIVATE TEST MODE COMPLETE message.
1> else:
2> the UE behaviour is unspecified.
Upon receiving the AT Command +CATM=\ message the UE shall:
1> if the UE is in out-of-coverage state during a V2X test scenario, and, the
test mode is active:
2> deactivate the UE test mode;
1> else:
2> the UE behaviour is unspecified.
## 5.4 UE test loop procedures
### 5.4.1 General
The UE test loop function is intended for:
\- E-UTRA RF receiver and transmitter testing to generate data transfer in
downlink and uplink.
\- E-UTRA layer 2 (MAC, RLC, PDCP) and data radio bearer testing to generate
data transfer in downlink and uplink.
\- EPC and E-UTRA layer 3 testing to verify data transfer continuation over
RRC and EPC procedures.
\- EPC NAS user-plane testing to verify uplink TFT handling.
\- E-UTRA/EPC Inter-system testing to verify data transfer continuation over
Inter-system change procedures to and from UTRA, GSM/GPRS and CDMA2000.
\- E-UTRA/E-MBMS MCH performance testing.
\- E-UTRA/E-MBMS layer 2 (MAC, RLC) and MTCH data radio bearer testing.
\- E-UTRA/ProSe or V2X RF receiver and transmitter testing to generate data
transfer in sidelink.
\- E-UTRA/ProSe Direct Discovery layer 2 (MAC) SL-DCH performance testing.
\- E-UTRA/ProSe Direct or V2X Communication layer 2 (MAC, RLC, PDCP) STCH and
layer 1 (PHY) PSCCH/PSSCH performance testing.
\- NB-IoT user plane testing.
\- Control Plane layer 2 (MAC, RLC), layer 3 and NAS testing for CIoT.
### 5.4.2 Close UE test loop
Figure 5.4.2-1: Close UE test loop procedure in all but V2X communication in
out-of-coverage state scenarios
Figure 5.4.2-2: Close UE test loop procedure by AT Command for V2X
communication in out-of-coverage state scenarios
#### 5.4.2.1 General
The SS uses the close UE test loop procedure to start the UE Test Loop
function in the UE while in E-UTRA or NB-IoT mode or while in V2X out-of-
coverage state.
A prerequisite for UE test loop mode A is that at least one bi-directional
data radio bearer has been established between SS and UE.
A prerequisite for UE test loop mode B is that at least one EPS bearer context
has been established between SS and UE.
A prerequisite for UE test loop mode C is that at least one MTCH data radio
bearer has been established between SS and UE.
A prerequisite for UE test loop mode D is that the UE is pre-authorized for
ProSe Direct Discovery operation.
NOTE 1: No radio bearer setup is required to transmit or receive ProSe Direct
Discovery messages.
A prerequisite for UE test loop mode E is that the UE is pre-authorized for
ProSe Direct or V2X Communication operation and pre-configured parameters are
provided in the USIM.
NOTE 2: Explicit signalling for sidelink radio bearer (SLRB) is not required
to transmit or receive STCH for ProSe Direct Communication.
A prerequisite for UE test loop mode F is that at least one SC-MTCH data radio
bearer has been established between SS and UE.
The UE shall provide for normal layer 1, layer 2, RRC, EMM and ESM
functionality while the UE test loop function is active. This includes (but is
not limited to) handover procedures and normal disconnection of the data radio
bearer.
For UE test loop mode A the loopback shall be maintained across handovers
within E-UTRA and NB-IoT, but after data radio bearer release, the loopback
shall cease to exist.
For UE test loop mode G and UE test loop mode H the loopback shall be
maintained across handovers and cell re-selections within its RAT (e.g. within
E-UTRA at handovers and re-selections for E-UTRA UE and between NB-IoT cells
at cell re-selections for NB-IoT UE).
For UE test loop mode B the loopback shall be maintained across handovers
within E-UTRA and between radio access system (E-UTRA to/from UTRA, E-UTRA
to/from GSM/GPRS and E-UTRA to/from CDMA2000). This means that any buffered IP
PDUs in the UE test loop function at the time of the intra- or inter-system
change shall be kept in the UE test loop function and being scheduled for
transmission transparently to the intra- or inter-system change.
For UE test loop mode A, or B, the UE shall not transmit any uplink U-plane
data other than the data returned by the loopback entity.
For UE test loop mode G or I the UE shall not transmit any uplink ESM DATA
TRANSPORT other than the ones initiated by the loopback entity.
For UE test loop mode D and E for Prose Discovery or Direct Communication, the
UE (and not the test loop) shall provide full normal ProSe functionality as
specified in TS 24.334 [38] and TS 36.331 [25] e.g. ProSe synchronization
signals transmission and/or reception as configured by RRC, while the UE test
loop is active.
For UE test loop mode E for V2X Communication, the UE (and not the test loop)
shall provide full normal V2X communication functionality as specified in TS
24. 386 [38] and TS 36.331 [25] e.g. V2X communication reception and
transmission, while the UE test loop is active.
#### 5.4.2.1a UE test loop mode A PDCP SDU and UE test loop mode B IP PDU
buffer size requirement
The minimum UE loopback buffer size for PDCP SDUs (UE test loop mode A) and IP
PDUs (UE test loop mode B), when UE is operated in RLC AM or UM mode, shall be
according to table 5.4.2.1a-1. The UE behaviour, when the loopback buffer
capacity is exceeded, is unspecified.
Table 5.4.2.1a-1: Minimum loopback buffer size for different UE categories
+--------------------------------------+------------------------------+ | UE Category | Minimum loopback buffer size | | | | | | [bytes] | | | | | | (Note 1,2) | +======================================+==============================+ | Category NB1/NB2 | 4000 | +--------------------------------------+------------------------------+ | Category M1 | 4000 | +--------------------------------------+------------------------------+ | Category M2 | 4000 | +--------------------------------------+------------------------------+ | Category 0 | 4000 | +--------------------------------------+------------------------------+ | Category 1 | 60000 | +--------------------------------------+------------------------------+ | Category 2 | 60000 | +--------------------------------------+------------------------------+ | Category 3 | 60000 | +--------------------------------------+------------------------------+ | Category 4 | 60000 | +--------------------------------------+------------------------------+ | Category 5 | 60000 | +--------------------------------------+------------------------------+ | Note 1: Minimum loopback buffer size | | | has been selected 1) for each UE | | | category such that the UE shall be | | | able to forward all data received in | | | one TTI when the applicable maximum | | | transport block size of the UE is | | | used, and 2) to allow execution of | | | MAC test cases 7.1.4.3 and 7.1.4.3a | | | in TS 36.523-1 [30], which | | | requires a minimum loopback buffer | | | size of 3600 bytes for Category M1, | | | Category M2, Category 0 and Category | | | 1 (7.1.4.3a) and 57280 bytes for all | | | other UE categories(7.1.4.3). | | | | | | Note 2: The minimum loopback buffer | | | size requirement for Category | | | NB1/NB2 is only applicable for | | | NB-IoT UE that supports user plane | | | data. | | +--------------------------------------+------------------------------+
#### 5.4.2.1b UE test loop mode G and UE test loop mode H buffer size, User
data container size and TP-User-Data buffer size requirements
The minimum UE loopback buffer size for user data for UE test loop mode G and
UE test loop mode H shall be according to table 5.4.2.1b-1. The UE behaviour,
when the loopback buffer capacity is exceeded, is unspecified.
The minimum User data container for UE test loop mode G and TP-User-Data
buffer size for UE test loop mode H shall be according to table 5.4.2.1b-1.
The UE behaviour, when the User data container for UE test loop mode G and TP-
User-Data size for UE test loop mode H exceeds the values in table 5.4.2.1b-1,
is unspecified.
Table 5.4.2.1b-1: Minimum loopback buffer size and minimum User data container
size and TP-User-Data buffer size for different UE categories
+----------------+----------------+----------------+----------------+ | UE Category | Minimum | Minimum User | Minimum | | | loopback | data container | TP-User-Data | | | buffer size | size in ESM | buffer size | | | for UE test | DATA TRANSFER | for UE test | | | loop mode G | message for UE | loop mode H | | | and H | test loop mode | | | | | G | [octets] | | | [octets] | | | | | | [octets] | (Note 1,2) | | | (Note 2) | | | | | | (note 2) | | +================+================+================+================+ | Category | 1358 | 1358 | 140 | | NB1/NB2 | | | | +----------------+----------------+----------------+----------------+ | Category M1 | 1358 | 1358 | 140 | +----------------+----------------+----------------+----------------+ | Category M2 | 1358 | 1358 | 140 | +----------------+----------------+----------------+----------------+ | Category 0 | 1358 | 1358 | 140 | +----------------+----------------+----------------+----------------+ | Category 1 | 1358 | 1358 | 140 | +----------------+----------------+----------------+----------------+ | Category 2 | 1358 | 1358 | 140 | +----------------+----------------+----------------+----------------+ | Category 3 | 1358 | 1358 | 140 | +----------------+----------------+----------------+----------------+ | Category 4 | 1358 | 1358 | 140 | +----------------+----------------+----------------+----------------+ | Category 5 | 1358 | 1358 | 140 | +----------------+----------------+----------------+----------------+ | Note 1: The | | | | | minimum | | | | | TP-User-Data | | | | | buffer size is | | | | | set to the | | | | | maximum SMS | | | | | size of 160 | | | | | characters | | | | | (140 octets). | | | | | | | | | | Note 2: The | | | | | minimum | | | | | loopback | | | | | buffer size, | | | | | the minimum | | | | | User data | | | | | container size | | | | | and minimum | | | | | TP-User-Data | | | | | buffer size | | | | | requirements | | | | | for Category 0 | | | | | and higher | | | | | categories are | | | | | only | | | | | applicable for | | | | | UE that | | | | | supports | | | | | control plane | | | | | data. | | | | | | | | | | Note 3: The | | | | | minimum | | | | | loopback | | | | | buffer size | | | | | for UE test | | | | | loop mode G | | | | | and H and | | | | | minimum user | | | | | data container | | | | | size in ESM | | | | | DATA TRANSFER | | | | | message for UE | | | | | test loop mode | | | | | G is set to | | | | | 1358 octets as | | | | | this is the | | | | | maximum link | | | | | MTU value in | | | | | the IP | | | | | configuration | | | | | information | | | | | set from the | | | | | network to a | | | | | UE that will | | | | | prevent the IP | | | | | layer | | | | | fragmentation | | | | | within the | | | | | transport | | | | | network | | | | | between the UE | | | | | and the | | | | | GGSN/P-GW | | | | | ([39] TS | | | | | 23.060 clause | | | | | 9.3). | | | | +----------------+----------------+----------------+----------------+
#### 5.4.2.2 Initiation
The SS can request the UE to close a test loop in mode A if at least one bi-
directional data radio bearer is established and the UE test mode is active.
The SS can request the UE to close a test loop in mode B if at least one EPS
bearer is established and the UE test mode is active. The SS can request the
UE to close a test loop in mode C if at least one MTCH data radio bearer is
established and the UE test mode is active.
The SS requests the UE to close its UE test loop mode A, UE test loop mode B,
UE test loop mode C, UE test loop mode D or UE test loop mode E (when not
utilised in V2X out-of-coverage scenarios) by transmitting a CLOSE UE TEST
LOOP message.
The SS requests the UE to close its UE test loop mode E by transmitting an AT
Command +CCUTLE when test loop mode E is utilised in V2X out-of-coverage
scenarios.
#### 5.4.2.3 Reception of CLOSE UE TEST LOOP message by the UE
Upon receiving the CLOSE UE TEST LOOP message the UE shall:
1> if UE test loop mode A has been selected;
2> if no bi-directional data radio bearers are established or if the UE test
mode is not active; or
2> if UE test loop mode A or UE test loop mode B operation is already closed
on one or more data radio bearers; or
2> if TEST_LOOP_MODE_C_ACTIVE = TRUE or TEST_LOOP_MODE_D_ACTIVE = TRUE or
TEST_LOOP_MODE_E_ACTIVE = TRUE or TEST_LOOP_MODE_F_ACTIVE = TRUE or
TEST_LOOP_MODE_G_ACTIVE = TRUE or TEST_LOOP_MODE_H_ACTIVE = TRUE or
TEST_LOOP_MODE_I_ACTIVE = TRUE:
3> the UE behaviour is unspecified
2> else:
3> for LB_ID=0 MAX_ModeA_LB_entities -1:
4> set DRB_ID(LB_ID) to 0 (indicate no DRB mapped)
4> set UL_PDCP_SDU_scaling(LB_ID) to FALSE
3> set LB_ID to 0
3> for each established bi-directional data radio bearer in ascending order
and starting with the data radio bearer with the lowest configured Data Radio
bearer identity number:
4> if LB_ID is less than MAX_ModeA_LB_entities:
5> set DRB_ID(LB_ID) to the Data Radio bearer identity number
5> increment LB_ID by 1
4> else:
5> the UE behaviour is unspecified
3> if the UE test loop mode A setup IE is included:
4> for each LB Setup DRB IE in the LB setup list of the UE test loop mode A
setup IE:
5> for LB_ID=0 to MAX_ModeA_LB_entities-1:
> 6> if DRB_ID(LB_ID) is equal to the Data Radio bearer identity number
> parameter of the LB Setup DRB IE:
>
> 7> if the LB Setup DRB(LB_ID) IE is included:
>
> 7> set UL_PDCP_SDU_scaling(LB_ID) to TRUE
>
> 7> set UL_PDCP_SDU_size(LB_ID) to UL PDCP SDU size parameter of the LB Setup
> DRB(LB_ID) IE
3> perform the UE actions for UE Test Loop Mode A operation as specified in
subclause 5.4.3; and
3> send CLOSE UE TEST LOOP COMPLETE message (the loopback shall be operational
prior to the sending of the acknowledgement).
1> else if UE test loop mode B has been selected;
2> if no EPS bearer is established or if the UE test mode is not active; or
2> if the test loop is already active on one or more EPS bearers; or
2> if TEST_LOOP_MODE_C_ACTIVE = TRUE or TEST_LOOP_MODE_D_ACTIVE = TRUE or
TEST_LOOP_MODE_E_ACTIVE = TRUE or TEST_LOOP_MODE_F_ACTIVE = TRUE or
TEST_LOOP_MODE_G_ACTIVE = TRUE or TEST_LOOP_MODE_H_ACTIVE = TRUE or
TEST_LOOP_MODE_I_ACTIVE = TRUE:
3> the UE behaviour is unspecified.
2> otherwise:
3> set TEST_LOOP_MODE_B_ACTIVE to TRUE
3> set timer T_delay_modeB to the value of IP PDU delay timer parameter of the
UE test loop mode B IE;
3> if the IP PDU delay timer parameter of the UE test loop mode B IE has a
value larger than zero:
4> set BUFFER_IP_PDUs to TRUE
3> else:
4> set BUFFER_IP_PDUs to FALSE
3> set CDMA2000_INITIATED to FALSE
3> perform the UE actions for UE Test Loop Mode B operation as specified in
subclause 5.4.4 and 5.4.4.1 to 5.4.4.11; and
3> send CLOSE UE TEST LOOP COMPLETE message (the loopback shall be operational
prior to the sending of the acknowledgement).
1> else if UE test loop mode C has been selected;
2> if no MTCH data radio bearer is established or if the UE test mode is not
active; or
2> if UE test loop mode A or UE test loop mode B operation is already closed
on one or more data radio bearers; or
2> if TEST_LOOP_MODE_C_ACTIVE = TRUE or TEST_LOOP_MODE_D_ACTIVE = TRUE or
TEST_LOOP_MODE_E_ACTIVE = TRUE or TEST_LOOP_MODE_F_ACTIVE = TRUE or
TEST_LOOP_MODE_G_ACTIVE = TRUE or TEST_LOOP_MODE_H_ACTIVE = TRUE or
TEST_LOOP_MODE_I_ACTIVE = TRUE:
3> the UE behaviour is unspecified.
2> otherwise:
3> set TEST_LOOP_MODE_C_ACTIVE to TRUE
3> set state variable MBMS_PACKET_COUNTER to zero;
3> perform the UE actions for UE Test Loop Mode C operation as specified in
subclause 5.4.4a; and
3> send CLOSE UE TEST LOOP COMPLETE message (the loopback shall be operational
prior to the sending of the acknowledgement).
1> else if UE test loop mode D has been selected;
2> if UE test loop mode A or UE test loop mode B operation is already closed
on one or more data radio bearers; or
2> if TEST_LOOP_MODE_C_ACTIVE = TRUE or TEST_LOOP_MODE_D_ACTIVE = TRUE or
TEST_LOOP_MODE_E_ACTIVE = TRUE or TEST_LOOP_MODE_F_ACTIVE = TRUE or
TEST_LOOP_MODE_G_ACTIVE = TRUE or TEST_LOOP_MODE_H_ACTIVE = TRUE or
TEST_LOOP_MODE_I_ACTIVE = TRUE:
3> the UE behaviour is unspecified.
2> otherwise:
> 3> set TEST_LOOP_MODE_D_ACTIVE to TRUE
3> if the Discovery Announce or Monitor parameter in UE test loop mode D setup
IE is set as zero;
4> set TEST_LOOP_MODE_D_TRIGGER to MONITOR
4> set state variable PROSE_DISCOVERY_MONITOR_N to the number of entities in
the list of ProSe App Codes to individually monitor included in the UE test
loop mode D setup IE;
4> if PROSE_DISCOVERY_MONITOR_N is greater than MAX_ModeD_Monitor_Entities:
5> the UE behaviour is unspecified.
4> for SL_ID = 0...(PROSE_DISCOVERY_MONITOR_N-1):
5> set state variable PROSE_DISCOVERY_APPCODE(SL_ID) to the parameter ProSe
App Code (LSBs) #(SL_ID) to monitor of the UE test loop mode D setup IE;
5> set state variable PSDCH_PACKET_COUNTER(SL_ID) to zero;
4> set state variable PSDCH_PACKET_COUNTER(PROSE_DISCOVERY_MONITOR_N) to zero;
4> perform the UE actions for UE Test Loop Mode D operation as specified in
subclause 5.4.4b;
3> if the Discovery Announce or Monitor parameter in UE test loop mode D setup
IE is set as one;
4> set TEST_LOOP_MODE_D_TRIGGER to ANNOUNCE
4> perform the UE actions for UE Test Loop Mode D operation as specified in
subclause 5.4.4b;
3> send CLOSE UE TEST LOOP COMPLETE message (the loopback shall be operational
prior to the sending of the acknowledgement).
1> else if UE test loop mode E has been selected;
2> if UE test loop mode A or UE test loop mode B operation is already closed
on one or more data radio bearers; or
2> if TEST_LOOP_MODE_C_ACTIVE = TRUE or TEST_LOOP_MODE_D_ACTIVE = TRUE or
TEST_LOOP_MODE_E_ACTIVE = TRUE or TEST_LOOP_MODE_F_ACTIVE = TRUE or
TEST_LOOP_MODE_G_ACTIVE = TRUE or TEST_LOOP_MODE_H_ACTIVE = TRUE or
TEST_LOOP_MODE_I_ACTIVE = TRUE; or
2> if the UE is unable to read the pre-configured parameters for ProSe Direct
or V2X Communication from the USIM; or
2> when test loop mode E is utilised in V2X out-of-coverage scenarios:
3> the UE behaviour is unspecified.
2> otherwise:
3> set TEST_LOOP_MODE_E_ACTIVE to TRUE
3> if the Communication Transmit or Receive parameter in UE test loop mode E
setup IE is set as zero;
4> set TEST_LOOP_MODE_E_TRIGGER to RECEIVE
4> set state variable PROSE_COMMUNICATION_MONITOR_N to the number of entities
in the list of Group Destination IDs to individually monitor included in the
UE test loop mode E setup IE;
4> if PROSE_COMMUNICATION_MONITOR_N is greater than
MAX_ModeE_Monitor_Entities:
5> the UE behaviour is unspecified.
4> for SL_ID = 0...(PROSE_COMMUNICATION_MONITOR_N-1):
5> set state variable PROSE_COMMUNICATION_DEST_ID(SL_ID) to the parameter
Group Destination ID #(SL_ID) to monitor of the UE test loop mode E setup IE;
5> set state variable STCH_PACKET_COUNTER(SL_ID) to zero;
5> set state variable PSCCH_PACKET_COUNTER(SL_ID) to zero;
5> set state variable PSSCH_PACKET_COUNTER(SL_ID) to zero;
4> set state variable STCH_PACKET_COUNTER(PROSE_COMMUNICATION_MONITOR_N) to
zero;
4> set state variable PSCCH_PACKET_COUNTER(PROSE_COMMUNICATION_MONITOR_N) to
zero;
4> set state variable PSSCH_PACKET_COUNTER(PROSE_COMMUNICATION_MONITOR_N) to
zero;
4> perform the UE actions for UE Test Loop Mode E operation as specified in
subclause 5.4.4c;
3> if the Communication Transmit or Receive parameter in UE test loop mode E
setup IE is set as one;
4> set TEST_LOOP_MODE_E_TRIGGER to TRANSMIT
4> perform the UE actions for UE Test Loop Mode E operation as specified in
subclause 5.4.4c;
3> send CLOSE UE TEST LOOP COMPLETE message (the loopback shall be operational
prior to the sending of the acknowledgement).
1> else if UE test loop mode F has been selected;
2> if no SC-MTCH data radio bearer is established or if the UE test mode is
not active; or
2> if UE test loop mode A or UE test loop mode B operation is already closed
on one or more data radio bearers; or
2> if TEST_LOOP_MODE_C_ACTIVE = TRUE or TEST_LOOP_MODE_D_ACTIVE = TRUE or
TEST_LOOP_MODE_E_ACTIVE = TRUE or TEST_LOOP_MODE_F_ACTIVE = TRUE: or
TEST_LOOP_MODE_G_ACTIVE = TRUE or TEST_LOOP_MODE_H_ACTIVE = TRUE or
TEST_LOOP_MODE_I_ACTIVE = TRUE
3> the UE behaviour is unspecified.
2> otherwise:
3> set TEST_LOOP_MODE_F_ACTIVE to TRUE
3> set state variable SCPTM_PACKET_COUNTER to zero;
3> perform the UE actions for UE Test Loop Mode F operation as specified in
subclause 5.4.4d; and
3> send CLOSE UE TEST LOOP COMPLETE message (the loopback shall be operational
prior to the sending of the acknowledgement).
1> else if UE test loop mode G has been selected;
2> if UE test loop mode A or UE test loop mode B operation is already closed
on one or more data radio bearers; or;
2> if TEST_LOOP_MODE_C_ACTIVE = TRUE or TEST_LOOP_MODE_D_ACTIVE = TRUE or
TEST_LOOP_MODE_E_ACTIVE = TRUE or TEST_LOOP_MODE_F_ACTIVE = TRUE or
TEST_LOOP_MODE_H_ACTIVE = TRUE or TEST_LOOP_MODE_I_ACTIVE = TRUE:
3> the UE behaviour is unspecified;
2> otherwise:
3> set TEST_LOOP_MODE_G_ACTIVE to TRUE;
3> if the uplink loopback operation mode parameter of the UE test loop mode GH
setup IE has a value set to 1:
4> set GH_RLC_SDU_loopback to TRUE;
3> else:
4> set GH_RLC_SDU_loopback to FALSE;
3> set GH_NUMBER_UL_DATA_REPETITIONS to the value of number of repetitions
parameter of the UE test loop mode GH setup IE;
3> set timer T_delay_modeGH to the value of Uplink data delay timer parameter
of the UE test loop mode GH setup IE;
3> if the Uplink data delay timer parameter of the UE test loop mode GH setup
IE has a value larger than zero:
4> set GH_BUFFER_CP_data to TRUE;
3> else:
4> set GH_BUFFER_CP_data to FALSE;
3> perform the UE actions for UE Test Loop Mode G operation in CP data
loopback mode as specified in subclause 5.4.4e;
3> send CLOSE UE TEST LOOP COMPLETE message (the loopback shall be operational
prior to the sending of the acknowledgement);
  1. else if UE test loop mode H has been selected;
2> if UE test loop mode A or UE test loop mode B operation is already closed
on one or more data radio bearers; or;
2> if TEST_LOOP_MODE_C_ACTIVE = TRUE or TEST_LOOP_MODE_D_ACTIVE = TRUE or
TEST_LOOP_MODE_E_ACTIVE = TRUE or TEST_LOOP_MODE_F_ACTIVE = TRUE or
TEST_LOOP_MODE_G_ACTIVE = TRUE or TEST_LOOP_MODE_I_ACTIVE = TRUE:
3> the UE behaviour is unspecified;
2> otherwise:
3> set TEST_LOOP_MODE_H_ACTIVE to TRUE;
3> if the uplink loopback operation mode parameter of the UE test loop mode GH
setup IE has a value set to 1:
4> set GH_RLC_SDU_loopback to TRUE;
3> else:
4> set GH_RLC_SDU_loopback to FALSE;
3> set GH_NUMBER_UL_DATA_REPETITIONS to the value of number of repetitions
parameter of the UE test loop mode GH setup IE;
3> set timer T_delay_modeGH to the value of Uplink data delay timer parameter
of the UE test loop mode GH setup IE;
3> if the Uplink data delay timer parameter of the UE test loop mode GH setup
IE has a value larger than zero:
4> set GH_BUFFER_CP_data to TRUE;
3> else:
4> set GH_BUFFER_CP_data to FALSE;
3> perform the UE actions for UE Test Loop Mode H operation as specified in
subclause 5.4.4f.1; and
3> send CLOSE UE TEST LOOP COMPLETE message (the loopback shall be operational
prior to the sending of the acknowledgement).
1> else if UE test loop mode I has been selected;
2> if UE test loop mode A or UE test loop mode B operation is already closed
on one or more data radio bearers; or;
2> if TEST_LOOP_MODE_C_ACTIVE = TRUE or TEST_LOOP_MODE_D_ACTIVE = TRUE or
TEST_LOOP_MODE_E_ACTIVE = TRUE or TEST_LOOP_MODE_F_ACTIVE = TRUE or
TEST_LOOP_MODE_G_ACTIVE = TRUE or TEST_LOOP_MODE_H_ACTIVE = TRUE:
3> the UE behaviour is unspecified;
2> otherwise:
3> set TEST_LOOP_MODE_I_ACTIVE to TRUE;
3> perform the UE actions for UE Test Loop Mode I operation as specified in
subclause 5.4.4g.1; and
3> send CLOSE UE TEST LOOP COMPLETE message (the loopback shall be operational
prior to the sending of the acknowledgement).
1> else;
2> the UE behaviour is unspecified.
#### 5.4.2.4 Reception of AT Command +CCUTLE by the UE
Upon receiving the AT Command
+CCUTLE=\[,\[,\,\,\]] the
UE shall:
1> if UE test loop mode E has been selected;
2> if TEST_LOOP_MODE_E_ACTIVE = TRUE; or
2> if the UE is unable to read the pre-configured parameters for V2X
Communication from the USIM:
3> the UE behaviour is unspecified.
2> otherwise:
3> set TEST_LOOP_MODE_E_ACTIVE to TRUE
3> if the \ parameter in +CCUTLE set command is set as zero;
4> set TEST_LOOP_MODE_E_TRIGGER to RECEIVE
4> if the \ parameter in +CCUTLE set command is set as 1
> 5> set state variable PROSE_COMMUNICATION_MONITOR_N to the number of
> entities in the list of Destination Layer-2 IDs to individually monitor
> included in the \ parameter of +CCUTLE set command;
>
> 5> if PROSE_COMMUNICATION_MONITOR_N is greater than
> MAX_ModeE_Monitor_Entities:
>
> 6> the UE behaviour is unspecified.
>
> 5> for SL_ID = 0...(PROSE_COMMUNICATION_MONITOR_N-1):
>
> 6> set state variable PROSE_COMMUNICATION_DEST_ID(SL_ID) to the parameter
> Destination Layer-2 ID #(SL_ID) to monitor in the +CCUTLE set command;
>
> 6> set state variable STCH_PACKET_COUNTER(SL_ID) to zero;
>
> 6> set state variable PSCCH_PACKET_COUNTER(SL_ID) to zero;
>
> 6> set state variable PSSCH_PACKET_COUNTER(SL_ID) to zero;
>
> 5> set state variable STCH_PACKET_COUNTER(PROSE_COMMUNICATION_MONITOR_N) to
> zero;
>
> 5> set state variable PSCCH_PACKET_COUNTER(PROSE_COMMUNICATION_MONITOR_N) to
> zero;
>
> 5> set state variable PSSCH_PACKET_COUNTER(PROSE_COMMUNICATION_MONITOR_N) to
> zero;
>
> 5> perform the UE actions for UE Test Loop Mode E operation as specified in
> subclause 5.4.4c;
4> else
> 5> the UE behaviour is unspecified.
3> if the \ parameter in +CCUTLE set command is set as one;
4> set TEST_LOOP_MODE_E_TRIGGER to TRANSMIT
4> perform the UE actions for UE Test Loop Mode E operation as specified in
subclause 5.4.4c;
1> else;
2> the UE behaviour is unspecified.
### 5.4.3 UE test loop mode A operation
Upon receiving a PDCP SDU identified by LB_ID when operating in E-UTRA or NB-
IoT mode with UE Test Loop Mode A active the UE shall:
1> if UL_PDCP_SDU_scaling(LB_ID) is FALSE:
2> take the PDCP SDU from the output of the PDCP Service Access Point (SAP)
and provide it as input to the correspondent PDCP SAP in uplink and transmit,
see Figure 5.4.3-1.
1> else:
2> if UL_PDCP_SDU_size(LB_ID) = 0:
3> discard the PDCP SDU (no data is returned).
2> else:
3> if the size of the received PDCP SDU in downlink is equal to
UL_PDCP_SDU_size(LB_ID):
4> take the PDCP SDU from the output of the PDCP SAP and provide it as input
to the correspondent PDCP SAP in uplink and transmit, see Figure 5.4.3-1.
3> else if the size of the received PDCP SDU in downlink is bigger than
UL_PDCP_SDU_size(LB_ID):
4> create a UL PDCP SDU of size UL_PDCP_SDU_size(LB_ID) by taking the first K
bits of the received PDCP SDU in downlink PDCP SAP, where K is equal to
UL_PDCP_SDU_size(LB_ID) and provide it as input to the correspondent PDCP SAP
in uplink and transmit, see Figure 5.4.3-2.
3> else if the size of the received PDCP SDU in downlink is less than
UL_PDCP_SDU_size(LB_ID):
4> create a UL PDCP SDU of size UL_PDCP_SDU_size(LB_ID) by repeating the data
received in downlink PDCP SDU in downlink to fill the UL PDCP SDU (truncating
the last block if necessary), provide it as input to the correspondent PDCP
SAP in uplink and transmit, see Figure 5.4.3-3.
Note: Size of the received PDCP SDUs in downlink shall be bit strings that are
byte aligned (i.e. multiple of 8 bits) according to TS 36.323 [24] clause
6.2.1.
Figure 5.4.3-1: Loop back of PDCP SDU\ (DL PDCP SDU size = UL PDCP SDU size =
N)
Figure 5.4.3-2: DL > UL PDCP SDU block size\ (DL PDCP SDU size = N, UL PDCP
SDU size = K)
Figure 5.4.3-3: DL \ if T_delay_modeB timer is running:
2> buffer the received PDCP SDU
1> else
2> if BUFFER_IP_PDUs is TRUE
3> buffer the received PDCP SDU
3> Start T_delay_modeB timer
2> else
3> submit the received PDCP SDU without any modification of the IP header to
the UL TFT handling SAP for transmission in uplink. See note.
Note 1: The UL TFT function in the UE is mapping IP PDUs received from SDF to
EPS bearer/radio bearer as configured by SS in the UL TFT IE sent as part of
the EPS bearer establishment procedures. See figure 5.1-2.
Note 2: Size of the received PDCP SDUs in downlink shall be bit strings that
are byte aligned (i.e. multiple of 8 bits) according to TS 36.323 [24] clause
6.2.1. The PDCP SDUs themselves shall contain a valid IPv4 or IPv6 Header in
accordance with the PDN type (Ref. TS 24.301 [36]) accepted by the UE.
#### 5.4.4.3 Expiry of T_delay_modeB timer when UE is in E-UTRA or NB-IoT mode
When timer T_delay_modeB expires when UE is operating in E-UTRA or NB-IoT mode
and has UE Test Loop Mode B active then the UE shall:
1> submit the buffered PDCP SDUs in the same order as received (first-in-
first-out) and without any modification of the IP header to the UL TFT
handling SAP for transmission in uplink. See note 1.
1> set BUFFER_IP_PDUs to FALSE
Note 1: The UL TFT function in the UE is mapping IP PDUs received from SDF to
EPS bearer/radio bearer as configured by SS in the UL TFT IE sent as part of
the EPS bearer establishment procedures. See figure 5.1-2.
NOTE 2: After the PDCP SDU buffer becomes empty the loopback will return any
received PDCP SDU in uplink directly as specified in clause 5.4.4.2. In order
to reactivate the loopback delay and PDCP SDU buffering the SS shall
deactivate UE test loop B function first.
#### 5.4.4.4 Reception of IP PDUs when UE is in UTRA mode
When UE receives a PDCP SDU when UE is operating in UTRA mode and has UE Test
Loop Mode B active then the UE shall:
1> if T_delay_modeB timer is running:
2> buffer the received PDCP SDU
1> else
2> if BUFFER_IP_PDUs is TRUE
3> buffer the received PDCP SDU
3> Start T_delay_modeB timer
2> else
3> submit the received PDCP SDU without any modification of the IP header to
the UL TFT handling SAP for transmission in uplink.
#### 5.4.4.5 Expiry of T_delay_modeB timer when UE is in UTRA mode
When timer T_delay_modeB expires when UE is operating in UTRA mode and has UE
Test Loop Mode B active the then UE shall:
1> submit the buffered IP PDUs in the same order as received (first-in-first-
out) and without any modification of the IP header to the UL TFT handling SAP
for transmission in uplink.
1> set BUFFER_IP_PDUs to FALSE.
NOTE: After the IP PDU buffer becomes empty the loopback will return any
received PDCP SDU in uplink directly as specified in clause 5.4.4.4. In order
to reactivate the loopback delay and PDCP SDU buffering the SS shall
deactivate UE test loop B function and UE shall return to E-UTRA or NB-IoT
mode first.
#### 5.4.4.6 Reception of IP PDUs when UE is in GSM/GPRS mode
When UE receives a SNDCP SDU when UE is operating in GSM/GPRS mode and has UE
Test Loop Mode B active then the UE shall:
1> if T_delay_modeB timer is running:
2> buffer the received SNDCP SDU.
1> else
2> if BUFFER_IP_PDUs is TRUE;
3> buffer the received SNDCP SDU;
3> Start T_delay_modeB timer.
2> else
3> submit the received SNDCP SDU without any modification of the IP header to
the UL TFT handling SAP for transmission in uplink.
#### 5.4.4.7 Expiry of T_delay_modeB timer when UE is in GSM/GPRS mode
When timer T_delay_modeB expires when UE is operating in GSM/GPRS mode and has
UE Test Loop Mode B active then the UE shall:
1> submit the buffered IP PDUs without any modification of the IP header in
the same order as received (first-in-first-out), to the UL TFT handling SAP
for transmission in uplink.
1> set BUFFER_IP_PDUs to FALSE
NOTE: After the IP PDU buffer becomes empty the loopback will return any
received SNDCP SDU in uplink directly as specified in clause 5.4.4.6. In order
to reactivate the loopback delay and SNDCP SDU buffering the SS shall
deactivate UE test loop B function and UE shall return to E-UTRA or NB-IoT
mode first.
#### 5.4.4.8 Reception of IP PDUs when UE is in CDMA2000 mode
When UE receives a RLP SDU when UE is operating in CDMA2000 mode and has UE
Test Loop Mode B active then the UE shall:
1> if CDMA2000_INITIATED is FALSE:
2> if T_delay_modeB is running:
3> restart T_delay_modeB
2> else:
3> start T_delay_modeB
2> set CDMA2000_INITIATED to TRUE;
1> if T_delay_modeB is running;
2> deliver the received RLP SDU to upper layers;
1> else
2> submit the received RLP SDU without any modification of the IP header to
the UL TFT handling SAP for transmission in uplink.
NOTE: When CDMA2000_INITIATED is FALSE or when T_delay_modeB is running, the
UE may send RLP SDUs in uplink upon initiation from upper layers.
#### 5.4.4.9 Expiry of T_delay_modeB timer when UE is in CDMA2000 mode
When timer T_delay_modeB expires when UE is operating in CDMA2000 mode and has
UE Test Loop Mode B active then the UE shall not take any action.
#### 5.4.4.10 Establishment of the RRC/RR connection in E-UTRA, NB-IoT, UTRA,
GSM/GPRS and CDMA2000 mode
When the RRC or the RR connection and one or more EPS bearers are is
established, in E-UTRA, NB-IoT, UTRA, GSM/GPRS and CDMA2000 mode then the UE
shall:
1> if TEST_LOOP_MODE_B_ACTIVE is set to TRUE;
2> perform the UE actions for UE Test Loop Mode B operation as specified in
subclause 5.4.4 and 5.4.4.1 to 5.4.4.11.
#### 5.4.4.11 Release of RRC/RR connection in E-UTRA, NB-IoT, UTRA, GSM/GPRS
and CDMA2000 mode after T_delay_modeB timer has expired
When the RRC or the RR connection is released in E-UTRA, NB-IoT, UTRA,
GSM/GPRS and CDMA2000 mode then the UE shall:
1> if UE test loop mode B is active; and
1> if BUFFER_IP_PDUs is TRUE or T_delay_modeB timer is running:
2> keep UE test loop mode B active
1> else
2> the UE behaviour is unspecified.
### 5.4.4a UE test loop mode C operation
#### 5.4.4a.1 Reception of MBMS packets
Upon receiving a MBMS packet on the MTCH identified by MTCH_ID when operating
in E-UTRA idle or connected mode with UE test loop mode C active the UE shall:
1> if UE test loop mode C is active;
2> increment MBMS_PACKET_COUNTER by 1:
1> else:
2> the UE behaviour is unspecified.
#### 5.4.4a.2 Release of RRC connection
When the RRC connection is released in E-UTRA mode then the UE shall:
1> if UE test loop mode C is active:
2> keep UE test loop mode C active.
### 5.4.4b UE test loop mode D operation
#### 5.4.4b.1 Monitor or Announce ProSe Direct Discovery
When operating in E-UTRA idle or connected mode with UE test loop mode D
active, the UE shall be able to either monitor or announce ProSe Direct
Discovery message(s) based on the TEST_LOOP_MODE_D_TRIGGER being set as either
MONITOR or ANNOUNCE, respectively. The UE shall:
1> if TEST_LOOP_MODE_D_ACTIVE is set to TRUE:
> 2> if TEST_LOOP_MODE_D_TRIGGER is set to MONITOR;
3> upon successful reception of SL-DCH MAC SDU for ProSe Direct Discovery
message:
> 4> set MATCH to zero;
4> if PROSE_DISCOVERY_MONITOR_N > 0
5> for SL_ID = 0...(PROSE_DISCOVERY_MONITOR_N-1):
6> if LSBs (8..0) of ProSe App Code in the received SL-DCH MAC SDU equals
PROSE_DISCOVERY_APPCODE(SL_ID):
> 7> increment PSDCH_PACKET_COUNTER(SL_ID) by 1;
>
> 7> set MATCH to one.
4> if MATCH equal zero:
5> increment PSDCH_PACKET_COUNTER(PROSE_DISCOVERY_MONITOR_N) by 1.
2> else if TEST_LOOP_MODE_D_TRIGGER is set to ANNOUNCE;
3> create the SL-DCH MAC SDU with the payload specified below, see Figure
5.4.4b.1-1 and Table 5.4.4b.1-1, and provide as input to MAC for possible
transmission in each discovery period.
NOTE: The same SL-DCH MAC SDU is transmitted (if permitted by test specific
Layer 1 and Layer 2 configuration) by the UE in every discovery period during
the entire duration test loop mode D is closed.
2> else:
3> the UE behaviour is unspecified.
1> else:
2> the UE behaviour is unspecified.
The SL-DCH MAC SDU payload for ProSe Direct Discovery announce operation when
UE test loop mode D is active shall be as specified in Figure 5.4.4b.1-1 and
Table 5.4.4b.1-1.
Figure 5.4.4b.1-1: ProSe Direct Discovery Announce operation in UE test loop
mode D
Table 5.4.4b.1-1: SL-DCH MAC SDU payload contents for ProSe Direct Discovery
Announce operation in UE test loop mode D
Parameter Size (bits) Value
* * *
Msg Type 8 01000001 ProSe App Code 184 00...00 MIC 32 00...00 Cntr LSB 4 0000
#### 5.4.4b.2 Release of RRC connection
When the RRC connection is released in E-UTRA mode then the UE shall:
1> if UE test loop mode D is active:
2> keep UE test loop mode D active
### 5.4.4c UE test loop mode E operation
#### 5.4.4c.1 Receive or Transmit ProSe Direct or V2X Communication
When operating in E-UTRA idle or connected or any cell selection state or out-
of-coverage state for V2X test scenarios, with UE test loop mode E active, the
UE shall be able to either receive or transmit ProSe Direct or V2X
Communication packets based on the TEST_LOOP_MODE_E_TRIGGER being set as
either RECEIVE or TRANSMIT, respectively. The UE shall:
1> if TEST_LOOP_MODE_E_ACTIVE is set to TRUE:
> 2> if TEST_LOOP_MODE_E_TRIGGER is set to RECEIVE;
3> upon successful reception of a STCH PDCP SDU for ProSe Direct or V2X
Communication data packet:
> 4> set MATCH to zero;
4> if PROSE_ COMMUNICATION_MONITOR_N > 0
5> for SL_ID = 0...(PROSE_COMMUNICATION_MONITOR_N-1):
6> if Group Destination ID in the received PSCCH corresponding to the STCH
PDCP SDU equals PROSE_COMMUNICATION_DEST_ID(SL_ID):
> 7> increment STCH_PACKET_COUNTER(SL_ID) by 1;
>
> 7> set MATCH to one.
4> if MATCH equal zero:
5> increment STCH_PACKET_COUNTER(PROSE_COMMUNICATION_MONITOR_N) by 1.
3> upon successful reception of a PSCCH PHY transport block for ProSe Direct
Communication control packet:
4> set MATCH to zero;
4> for SL_ID = 0...(PROSE_COMMUNICATION_MONITOR_N-1):
5> if, in the received PSCCH PHY transport block, Group Destination ID for
ProSe Direct Communication equals PROSE_COMMUNICATION_DEST_ID(SL_ID):
> 6> increment PSCCH_PACKET_COUNTER(SL_ID) by 1;
>
> 6> set MATCH to one.
4> if MATCH equal zero:
5> increment PSCCH_PACKET_COUNTER (PROSE_COMMUNICATION_MONITOR_N) by 1.
3> upon successful reception of a PSCCH PHY transport block for V2X
Communication control packet:
4> increment PSCCH_PACKET_COUNTER(PROSE_COMMUNICATION_MONITOR_N) by 1.
3> upon successful reception of a PSSCH PHY transport block for ProSe Direct
or V2X Communication data packet:
4> set MATCH to zero;
4> for SL_ID = 0...(PROSE_COMMUNICATION_MONITOR_N-1):
5> if, in the received PSSCH PHY transport block, Group Destination ID for
ProSe Direct Communication or Destination Layer-2 ID for V2X Communication
equals PROSE_COMMUNICATION_DEST_ID(SL_ID):
> 6> increment PSSCH_PACKET_COUNTER(SL_ID) by 1;
>
> 6> set MATCH to one.
4> if MATCH equal zero:
5> increment PSSCH_PACKET_COUNTER (PROSE_COMMUNICATION_MONITOR_N) by 1.
2> else if TEST_LOOP_MODE_E_TRIGGER is set to TRANSMIT;
3> create the STCH PDCP SDU with payload size and contents as specified below,
see Figure 5.4.4c.1-1 and Table 5.4.4c.1-1 or Table 5.4.4c.1-2 and provide as
input PDCP for transmission in every SC period as per TS 36.331 [25] or in the
set of subframes according to subclause 5.14.1.1 of TS 36.321 [22] for V2X
Communication.
NOTE: The same STCH PDCP SDU (1 packet) is transmitted (if permitted by test
specific Layer 1 and Layer 2 configuration) by the UE in every SC period for
ProSe Direct Communication or in the set of subframes for V2X Communication
during the entire duration test loop mode E is closed.
2> else:
3> the UE behaviour is unspecified.
1> else:
2> the UE behaviour is unspecified.
The STCH PDCP SDU payload for ProSe Direct or V2X Communication packet when UE
test loop mode E is active shall be as specified in Figure 5.4.4c.1-1 and
Table 5.4.4c.1-1 or Table 5.4.4c.1-2. The UE shall also transmit the
corresponding SCI control information on PSCCH accordingly in every PSCCH
period for Prose Direct Communication or in the same subframe on which the
STCH PDCP SDU is transmitted for V2X Sidelink Communication.
Figure 5.4.4c.1-1: ProSe Direct or V2X Communication Transmit operation in UE
test loop mode E
Table 5.4.4c.1-1: STCH PDCP SDU payload contents for ProSe Direct operation in
UE test loop mode E
Parameter Value
* * *
Size (N) 40 bytes Payload 00...00
Table 5.4.4c.1-2: STCH PDCP SDU payload contents for V2X Communication
transmit operation in UE test loop mode E
Parameter Value
* * *
Size (N) 300 bytes Payload 00...00
#### 5.4.4c.2 Release of RRC connection
When the RRC connection is released in E-UTRA mode then the UE shall:
1> if UE test loop mode E is active:
2> keep UE test loop mode E active
#### 5.4.4c.3 Transition from RRC Idle/Connected to Any Cell Selection state
When the UE experiences radio link failure and transitions to RRC Any Cell
Selection state in E-UTRA mode, then the UE shall:
1> if UE test loop mode E is active:
2> keep UE test loop mode E active
#### 5.4.4c.4 V2X operation
In V2X test scenarios UE test loop mode E shall be kept active regardless of
the radio environment situation and the UE state until de-activation has been
explicitly requested.
### 5.4.4d UE test loop mode F operation
#### 5.4.4d.1 Reception of MBMS packets
Upon receiving a MBMS packet on the SC-MTCH identified by SC_MTCH_ID when
operating in E-UTRA idle or connected mode with UE test loop mode F active the
UE shall:
1> if UE test loop mode F is active;
2> increment SCPTM_PACKET_COUNTER by 1:
1> else:
2> the UE behaviour is unspecified.
#### 5.4.4d.2 Release of RRC connection
When the RRC connection is released in E-UTRA mode then the UE shall:
1> if UE test loop mode F is active:
2> keep UE test loop mode F active.
### 5.4.4e UE test loop mode G operation
#### 5.4.4e.1 Reception of ESM DATA TRANSPORT message
Upon receiving an ESM DATA TRANSPORT message when operating in UE test loop G
the UE shall:
  1. if GH_NUMBER_UL_DATA_REPETITIONS is 0:
2> discard the received ESM DATA TRANSPORT message (no user data returned in
uplink);
1> else if T_delay_modeGH timer is running:
2> discard any previously buffered user data;
2> buffer the content of the User data container of the received ESM DATA
TRANSPORT message;
1> else:
2> if GH_BUFFER_CP_data is TRUE:
3> discard any previously buffered user data;
3> buffer the content of the User data container of the received ESM DATA
TRANSPORT message;
3> Start T_delay_modeGH timer;
2> else:
3> if GH_NUMBER_UL_DATA_REPETITIONS is 1:
4> if GH_RLC_SDU_loopback is TRUE
5> submit the content of the User data container of each received ESM DATA
TRANSPORT message in a RLC SDU to the RLC AM-SAP of SRB1bis for NB-IoT UE or
to the RLC AM-SAP of SRB2 for E-UTRA UE for transmission in uplink;
4> if GH_RLC_SDU_loopback is FALSE
5> submit the content of the User data container of each received ESM DATA
TRANSPORT message to the EMM SAP for control plane data for transmission in
uplink;
3> else if GH_NUMBER_UL_DATA_REPETITIONS is bigger than 1:
4> if GH_RLC_SDU_loopback is TRUE
5> submit the content of the User data container of each received ESM DATA
TRANSPORT message in a RLC SDU repeated GH_NUMBER_UL_DATA_REPETITIONS of times
to the RLC AM-SAP of SRB1bis for NB-IoT UE or to the RLC AM-SAP of SRB2 for
E-UTRA UE for transmission in uplink;
4> if GH_RLC_SDU_loopback is FALSE
5> submit the content of the User data container of each received ESM DATA
TRANSPORT message repeated GH_NUMBER_UL_DATA_REPETITIONS of times to the EMM
SAP for control plane data for transmission in uplink;
#### 5.4.4e.2 Expiry of T_delay_modeGH timer when UE test loop mode G is
active
When timer T_delay_modeGH expires when UE is operating in UE Test Loop Mode G
is active then the UE shall:
1> if GH_NUMBER_UL_DATA_REPETITIONS is 1:
2> if GH_RLC_SDU_loopback is TRUE
3> submit the content of the User data container of each received ESM DATA
TRANSPORT message in a RLC SDU to the RLC AM-SAP of SRB1bis for NB-IoT UE or
to the RLC AM-SAP of SRB2 for E-UTRA UE for transmission in uplink;
2> if GH_RLC_SDU_loopback is FALSE
3> submit the content of the User data container of each received ESM DATA
TRANSPORT message to the EMM SAP for control plane data for transmission in
uplink;
1> else if GH_NUMBER_UL_DATA_REPETITIONS is bigger than 1:
2> if GH_RLC_SDU_loopback is TRUE
3> submit the content of the User data container of each received ESM DATA
TRANSPORT message in a RLC SDU repeated GH_NUMBER_UL_DATA_REPETITIONS of times
to the RLC AM-SAP of SRB1bis for NB-IoT UE or to the RLC AM-SAP of SRB2 for
E-UTRA UE for transmission in uplink;
2> if GH_RLC_SDU_loopback is FALSE
3> submit the content of the User data container of each received ESM DATA
TRANSPORT message repeated GH_NUMBER_UL_DATA_REPETITIONS of times to the EMM
SAP for control plane user data for transmission in uplink;
1> set GH_BUFFER_CP_data to FALSE:
### 5.4.4f UE test loop mode H operation
#### 5.4.4f.1 Reception of TPDU
Upon receiving a TPDU (SMS-DELIVER) when operating in UE test loop H the UE
shall:
1> if GH_NUMBER_UL_DATA_REPETITIONS is 0:
2> discard the received TPDU (no user data returned in uplink);
1> else if T_delay_modeGH timer is running:
2> discard any previously buffered TP-User-Data;
2> buffer the TP-User-Data received in the TPDU via the Downlink NAS Transport
message;
1> else
2> if GH_BUFFER_CP_data is TRUE:
3> discard any previously buffered TP-User-Data;
3> buffer the TP-User-Data received in the TPDU via the Downlink NAS Transport
message;
3> Start T_delay_modeGH timer;
2> else:
3> if GH_NUMBER_UL_DATA_REPETITIONS is 1:
4> if GH_RLC_SDU_loopback is TRUE
5> submit the TP-User-Data for each received TPDU (SMS-DELIVER) in a RLC SDU
to the RLC AM-SAP of SRB1bis for NB-IoT UE or to the RLC AM-SAP of SRB2 for
E-UTRA UE for transmission in uplink;
4> if GH_RLC_SDU_loopback is FALSE
5> submit the TP-User-Data for each received TPDU (SMS-DELIVER) to the SM-TL
SAP for control plane data for transmission in uplink in TPDU (SMS-SUBMIT);
3> else if GH_NUMBER_UL_DATA_REPETITIONS is bigger than 1:
4> if GH_RLC_SDU_loopback is TRUE
5> submit the TP-User-Data for each received TPDU (SMS-DELIVER) in a RLC SDU
repeated GH_NUMBER_UL_DATA_REPETITIONS of times to the RLC AM-SAP of SRB1bis
for NB-IoT UE or to the RLC AM-SAP of SRB2 for E-UTRA UE for transmission in
uplink;
4> if GH_RLC_SDU_loopback is FALSE
5> submit the TP-User-Data for each received TPDU (SMS-DELIVER) repeated
GH_NUMBER_UL_DATA_REPETITIONS of times to the SM-TL SAP for control plane data
for transmission in uplink in TPDU (SMS-SUBMIT);
#### 5.4.4f.2 Expiry of T_delay_modeGH timer when UE test loop mode H is
active
When timer T_delay_modeGH expires when UE is operating in UE Test Loop Mode H
is active then the UE shall:
1> if GH_NUMBER_UL_DATA_REPETITIONS is 1:
2> if GH_RLC_SDU_loopback is TRUE
3> submit the TP-User-Data for each received TPDU (SMS-DELIVER) in a RLC SDU
to the RLC AM-SAP of SRB1bis for NB-IoT UE or to the RLC AM-SAP of SRB2 for
E-UTRA UE for transmission in uplink;
2> if GH_RLC_SDU_loopback is FALSE
3> submit the TP-User-Data for each received TPDU (SMS-DELIVER) to the SM-TL
SAP for control plane data for transmission in uplink in TPDU (SMS-SUBMIT);
1> else if GH_NUMBER_UL_DATA_REPETITIONS is bigger than 1:
2> if GH_RLC_SDU_loopback is TRUE
3> submit the TP-User-Data for each received TPDU (SMS-DELIVER) in a RLC SDU
repeated GH_NUMBER_UL_DATA_REPETITIONS of times to the RLC AM-SAP of SRB1bis
for NB-IoT UE or to the RLC AM-SAP of SRB2 for E-UTRA UE for transmission in
uplink;
2> if GH_RLC_SDU_loopback is FALSE
3> submit the TP-User-Data for each received TPDU (SMS-DELIVER) repeated
GH_NUMBER_UL_DATA_REPETITIONS of times to the SM-TL SAP for control plane data
for transmission in uplink in TPDU (SMS-SUBMIT);
1> set GH_BUFFER_CP_data to FALSE;
### 5.4.4g UE test loop mode I operation
#### 5.4.4g.1 Reception of ESM DATA TRANSPORT message
Upon receiving an ESM DATA TRANSPORT message when operating in UE test loop I
the UE shall:
1> submit the received IP PDU in the User data container of each received ESM
DATA TRANSPORT without any modification of the IP header to the UL TFT
handling SAP for transmission in uplink. See note.
Note 1: The UL TFT function in the UE is when UE is operated in Control Plane
CIoT EPS optimization controlling uplink transmissions of IP PDUs based on UL
TFT filters as configured by SS in the UL TFT IE sent as part of the EPS
bearer establishment procedures. See figure 5.1-16.
Note 2: The IP PDUs shall contain a valid IPv4 or IPv6 Header in accordance
with the PDN type (Ref. TS 24.301 [36]) accepted by the UE.
### 5.4.5 Open UE test loop
Figure 5.4.5-1: Open UE test loop procedure
Figure 5.4.5-2: Open UE test loop procedure by AT Command
#### 5.4.5.1 General
The SS uses the procedure open UE test loop to deactivate the UE test loop
function in the UE.
#### 5.4.5.2 Initiation
The SS requests the UE to open all closed test loops by transmitting an OPEN
UE TEST LOOP message or by transmitting an AT Command +CCUTLE.
#### 5.4.5.3 Reception of OPEN UE TEST LOOP message or AT Command +CCUTLE by
the UE
When UE receives the OPEN UE TEST LOOP message or AT Command
+CCUTLE=\ then the UE shall:
1> If no test loops are closed:
2> the UE behaviour is unspecified;
1> else if one or more test loops are closed:
2> open all test loops;
2> if TEST_LOOP_MODE_B_ACTIVE is TRUE
3> set TEST_LOOP_MODE_B_ACTIVE to FALSE
2> if TEST_LOOP_MODE_C_ACTIVE is TRUE
3> set TEST_LOOP_MODE_C_ACTIVE to FALSE
2> if TEST_LOOP_MODE_D_ACTIVE is TRUE
3> set TEST_LOOP_MODE_D_ACTIVE to FALSE
2> if TEST_LOOP_MODE_E_ACTIVE is TRUE
3> set TEST_LOOP_MODE_E_ACTIVE to FALSE
2> if TEST_LOOP_MODE_F_ACTIVE is TRUE
3> set TEST_LOOP_MODE_F_ACTIVE to FALSE
2> if TEST_LOOP_MODE_G_ACTIVE is TRUE
3> set TEST_LOOP_MODE_G_ACTIVE to FALSE
2> if TEST_LOOP_MODE_H_ACTIVE is TRUE
3> set TEST_LOOP_MODE_H_ACTIVE to FALSE
2> if TEST_LOOP_MODE_I_ACTIVE is TRUE
3> set TEST_LOOP_MODE_I_ACTIVE to FALSE
2> send OPEN UE TEST LOOP COMPLETE message;
NOTE: The UE test mode is still active so the UE continues behaving as
described in 5.3.2.3
## 5.5 UE Positioning test mode procedures
### 5.5.1 Reset UE Positioning Stored Information
Figure 5.5.1-1: Reset UE Positioning Stored Information procedure
#### 5.5.1.1 General
The SS uses the reset UE positioning stored information procedure to command
the UE to reset the already acquired UE positioning information in preparation
for subsequent test procedures.
#### 5.5.1.2 Initiation
The SS requests the UE to reset the stored UE positioning information by
transmitting a RESET UE POSITIONING STORED INFORMATION message.
#### 5.5.1.3 Reception of RESET UE POSITIONING STORED INFORMATION message by
UE
When UE receives RESET UE POSITIONING STORED INFORMATION message then the UE
shall:
1> if the IE \"UE Positioning Technology\" has the value 'AGNSS':
2> discard any stored GNSS reference time, reference position, and any other
aiding data obtained or derived during the previous test instance (e.g.
expected ranges and Doppler);
2> temporarily disable any sensor data (if applicable) that can aid the
positioning for the duration of the subsequent positioning procedure.
1> if the IE \"UE Positioning Technology\" has the value 'OTDOA':
2> discard any stored OTDOA reference and neighbour cell info assistance data;
2> use the reference cell in the provided OTDOA assistance data as reference
cell for reporting RSTD measurements in the subsequent positioning procedure.
1> if the IE \"UE Positioning Technology\" has the value 'MBS':
2> discard any stored MBS assistance data and information obtained or derived
during the previous test instance (e.g. Beacon PN code and slot information
and code phase measurements);
2> temporarily disable any sensor data (if applicable) that can aid the
positioning for the duration of the subsequent positioning procedure.
1> if the IE \"UE Positioning Technology\" has the value 'WLAN':
2> discard any stored WLAN assistance data and information obtained or derived
during the previous test instance;
1> if the IE \"UE Positioning Technology\" has the value 'Bluetooth':
2> discard any stored Bluetooth data obtained or derived during the previous
test instance;
1> if the IE \"UE Positioning Technology\" has the value 'Sensor':
2> discard any stored Sensor assistance data and information obtained or
derived during the previous test instance;
1> otherwise:
2> ignore the message.
### 5.5.2 Update UE Location Information
Figure 5.5.2-1: Update UE Location Information procedure
#### 5.5.2.1 General
The SS uses the Update UE Location information procedure to send positioning
information to the UE and command it to store positioning information in
preparation for subsequent test procedures.
#### 5.5.2.2 Initiation
The SS requests the UE to store the positioning information contained in the
message by transmitting a UPDATE UE LOCATION INFORMATION message.
#### 5.5.2.3 Reception of UPDATE UE LOCATION INFORMATION message by UE
When UE receives UPDATE UE LOCATION INFORMATION message then the UE shall:
1> if the UE has location information values stored:
2> discard the stored location information:
1> store the received location information (ellipsoidPointWithAltitude,
horizontalVelocity and gnss-TOD-msec) and maintain it until reception of RESET
UE POSITIONING STORED INFORMATION or UPDATE UE LOCATION INFORMATION message.
Information not supported by the UE may be discarded.
### 5.5.3 UTC time reset
Figure 5.5.3-1: UTC time reset procedure
#### 5.5.3.1 General
The SS uses the UTC time reset procedure to command the UE to reset or clear
the current UTC time (and optionally any other relevant information such as
position) that has been calculated from GNSS in the UE in preparation for the
subsequent test procedure. This allows the UE to rapidly reacquire GNSS and
calculate a new value of UTC time which may not be consistent with the
previous value. The UE may optionally retain any other information that may
aid the rapid reacquisition of GNSS and the calculation of a new value of UTC
time. The UE shall also use only GNSS for position calculation in the
subsequent test procedure.
#### 5.5.3.2 Initiation
The SS requests the UE to reset the stored UTC time by transmitting an AT
Command + CUTCR.
#### 5.5.3.3 Reception of AT Command +CUTCR by UE
When UE receives AT Command +CUTCR then the UE shall:
1> discard any stored UTC time previously derived from GNSS;
1> optionally discard any other relevant information that will prevent rapidly
reacquisition of GNSS and calculation of a new value of UTC time which may not
be consistent with the previously stored value;
1> optionally retain any other information that may aid the rapid
reacquisition of GNSS and the calculation of a new value of UTC time;
1> temporarily disable any other non-GNSS positioning sensor data (if
applicable) such that it shall use only GNSS for position calculation in the
subsequent test procedure.
## 5.6 MBMS Packet Counter reporting procedure
### 5.6.1 Request MBMS Packet Counter value
Figure 5.6.1-1: MBMS Packet Counter reporting procedure
#### 5.6.1.1 General
The SS uses the MBMS Packet Counter reporting procedure to request reporting
of current value of the state variable MBMS_PACKET_COUNTER.
#### 5.6.1.2 Initiation
The SS requests the UE to report its current value of the state variable
MBMS_PACKET_COUNTER by transmitting an UE TEST LOOP MODE C MBMS PACKET COUNTER
REQUEST message.
#### 5.6.1.3 Reception of UE TEST LOOP MODE C MBMS PACKET COUNTER REQUEST by
the UE
Upon receiving the UE TEST LOOP MODE C MBMS PACKET COUNTER REQUEST message the
UE shall:
1> if TEST_LOOP_MODE_C_ACTIVE is TRUE:
2> set the IE MBMS Packet Counter Value in the UE TEST LOOP MODE C MBMS PACKET
COUNTER RESPONSE message to the value of the state variable
MBMS_PACKET_COUNTER;
2> send the UE TEST LOOP MODE C MBMS PACKET COUNTER RESPONSE message.
  1. else:
2> the UE behaviour is unspecified.
## 5.7 ProSe Packet Counter reporting procedure
### 5.7.1 Request ProSe Packet Counter value
Figure 5.7.1-1: ProSe Packet Counter reporting procedure
Figure 5.7.1-2: ProSe Packet Counter reporting procedure based on AT Commands
#### 5.7.1.1 General
The SS uses the ProSe Packet Counter reporting procedure to request reporting
of current value ProSe or V2X related state variables depending on the
currently active ProSe or V2X test mode. For mode D the state variable
PSDCH_PACKET_COUNTER is reported. For mode E the state variables
STCH_PACKET_COUNTER, PSCCH_PACKET_COUNTER and PSSCH_PACKET_COUNTER are
reported.
NOTE 1: For backward compatibility, the messages will be maintained and used
for V2X Communication.
NOTE 2: For V2X communication, PSCCH_PACKET_COUNTER(SL_ID) with SL_ID =
0...PROSE_COMMUNICATION_MONITOR_N-1 are zero.
#### 5.7.1.2 Initiation
The SS requests the UE to report its current value of the state variable
PSDCH_PACKET_COUNTER for test loop mode D or STCH_PACKET_COUNTER,
PSCCH_PACKET_COUNTER and PSSCH_PACKET_COUNTER for test loop mode E by
transmitting an UE TEST LOOP PROSE PACKET COUNTER REQUEST message or by
transmitting an AT Command +CUSPCREQ.
#### 5.7.1.3 Reception of UE TEST LOOP PROSE COUNTER REQUEST by the UE
Upon receiving the UE TEST LOOP PROSE PACKET COUNTER REQUEST message the UE
shall:
1> if TEST_LOOP_MODE_D_ACTIVE is TRUE:
2> set the IE ProSe Direct Discovery Packet Counter(s) Value in the UE TEST
LOOP PROSE COUNTER RESPONSE message to the value of the state variable(s)
PSDCH_PACKET_COUNTER(SL_ID) with SL_ID = 0...PROSE_DISCOVERY_MONITOR_N;
2> send the UE TEST LOOP PROSE COUNTER RESPONSE message.
1> else if TEST_LOOP_MODE_E_ACTIVE is TRUE:
2> set the IE ProSe Direct or V2X Communication PSCCH Packet Counter(s) Value
in the UE TEST LOOP PROSE COUNTER RESPONSE message to the value of the state
variable(s) PSCCH_PACKET_COUNTER(SL_ID) with SL_ID =
0...PROSE_COMMUNICATION_MONITOR_N;
2> set the IE ProSe Direct or V2X Communication STCH Packet Counter(s) Value
in the UE TEST LOOP PROSE COUNTER RESPONSE message to the value of the state
variable STCH_PACKET_COUNTER(SL_ID) with SL_ID =
0...PROSE_COMMUNICATION_MONITOR_N;
2> set the IE ProSe Direct or V2X Communication PSSCH Packet Counter(s) Value
in the UE TEST LOOP PROSE COUNTER RESPONSE message to the value of the state
variable(s) PSSCH_PACKET_COUNTER(SL_ID) with SL_ID =
0...PROSE_COMMUNICATION_MONITOR_N;
2> send the UE TEST LOOP PROSE COUNTER RESPONSE message.
  1. else:
2> the UE behaviour is unspecified.
#### 5.7.1.4 Reception of AT Command +CUSPCREQ by the UE
Upon receiving the AT Command +CUSPCREQ the UE shall:
1> if TEST_LOOP_MODE_E_ACTIVE is TRUE:
2> in the response message of command +CUSPCREQ, set the parameter \ to
1; set the parameter \ to 1; set the parameter \ to
4*(PROSE_COMMUNICATION_MONITOR_N+1); set the parameter \ to the
value of the state variable(s) PSCCH_PACKET_COUNTER(SL_ID) with SL_ID =
0...PROSE_COMMUNICATION_MONITOR_N;
2> in the response message of command +CUSPCREQ, set the parameter \ to
1; set the parameter \ to 1; set the parameter \ to
4*(PROSE_COMMUNICATION_MONITOR_N+1); set the parameter \ to the
value of the state variable STCH_PACKET_COUNTER(SL_ID) with SL_ID =
0...PROSE_COMMUNICATION_MONITOR_N;
2> in the response message of command +CUSPCREQ, set the parameter \ to
1; set the parameter \ to 1; set the parameter \ to
4*PROSE_COMMUNICATION_MONITOR_N+1; set the parameter \ to the value
of the state variable(s) PSSCH_PACKET_COUNTER(SL_ID) with SL_ID =
0...PROSE_COMMUNICATION_MONITOR_N;
2> send the response message +CUSPCREQ:
[\,\,\,\],
[\,\,\,\],
[\,\,\,\]..
1> else:
2> the UE behaviour is unspecified.
## 5.8 SC-PTM Packet Counter reporting procedure
### 5.8.1 Request SC-PTM Packet Counter value
Figure 5.8.1-1: SC-PTM Packet Counter reporting procedure
#### 5.8.1.1 General
The SS uses the SC-PTM Packet Counter reporting procedure to request reporting
of current value of the state variable SCPTM_PACKET_COUNTER.
#### 5.8.1.2 Initiation
The SS can activate the UE test mode when UE is in E-UTRA connected state.
NOTE: Refer to TS 36.508 [28] subclause 4.5.1 for more details on UE states.
The SS requests the UE to report its current value of the state variable
SCPTM_PACKET_COUNTER by transmitting an UE TEST LOOP MODE F SCPTM PACKET
COUNTER REQUEST message.
#### 5.8.1.3 Reception of UE TEST LOOP MODE F SCPTM PACKET COUNTER REQUEST by
the UE
Upon receiving the UE TEST LOOP MODE F SCPTM PACKET COUNTER REQUEST message
the UE shall:
1> if TEST_LOOP_MODE_F_ACTIVE is TRUE:
2> set the IE SCPTM Packet Counter Value in the UE TEST LOOP MODE F SCPTM
PACKET COUNTER RESPONSE message to the value of the state variable
SCPTM_PACKET_COUNTER;
2> send the UE TEST LOOP MODE F SCPTM PACKET COUNTER RESPONSE message.
1> else:
2> the UE behaviour is unspecified.
## 5.9 Antenna Test Function measurement procedure
This clause describes the ATF measurement procedure. An alternative client
application procedure is defined in clause 9.1. The procedures described below
are defined for a dual antenna single carrier system although it is the
intention for this design to be easily extended for quad and octo antenna
systems including carrier aggregation (CA) for when these capabilities come
online in the future.
The use case for the measurements is that the conditions defined subclause 5.1
in TR 36.978 [40] would be established. Then, for any arbitrary orientation of
the UE relative to the probe antenna, the test system can request a set of
measurements. After receiving the results the UE can be repositioned and
further sets of measurements requested until the required number of points on
the sphere has been sampled. Typically a 2D cut of the UE will be measured at
both horizontal and vertical polarizations. The complex antenna pattern can
then be derived from the reported RSAP and RSARP values. This derivation
includes calibration procedures not covered in the scope of this document.
Accuracy requirement for RSAP and RSARP are defined in clause 5.9.2.
### 5.9.0 Measurements definition
#### 5.9.0.1 Reference Signal Antenna Power (RSAP) definition
The RSAP measurement is based on RSRP as defined in subclause 5.1.1 of [41].
Since it is the intention to measure UE radiated receiver performance using
fully allocated downlink channels, the RSAP is a measure of the average power
of the CRS resource elements across the entire channel bandwidth.
Table 5.9.0.1-1: Reference Signal Antenna Power (RSAP) definition
+--------------------------+------------------------------------------+ | > **Definition** | > Reference signal antenna power (RSAP) | | | > is defined per receive antenna (Rx~0~ | | | > .. Rx~n~) as the linear average over | | | > the power contributions (in [W]) of | | | > the resource elements that carry | | | > cell-specific reference signals across | | | > the entire LTE channel bandwidth. | | | > | | | > For RSAP determination the | | | > cell-specific reference signals R~0~ | | | > according to TS 36.211 shall be used. | | | > | | | > The reference point for the RSAP shall | | | > be the antenna connector of the UE. | +--------------------------+------------------------------------------+ | > **Measurement period** | > Since the signal is static there is no | | | > minimum measurement period defined but | | | > a figure of one 10 ms subframe is | | | > suggested. | +--------------------------+------------------------------------------+ | > **Applicable for** | > RRC_CONNECTED intra-frequency | +--------------------------+------------------------------------------+
Note 1: The number of resource elements within the measurement period that are
used by the UE to determine RSAP is left up to the UE implementation with the
limitation that corresponding measurement accuracy requirements have to be
fulfilled.
Note 2: The power per resource element is determined from the energy received
during the useful part of the symbol, excluding the CP.
#### 5.9.0.2 Reference Signal Antenna Relative Phase (RSARP) definition
The RSARP is similarly defined as RSAP. The relative phase difference of the
CRS resource elements is the average across the entire channel bandwidth.
Table 5.9.0.2-1: Reference Signal Antenna Relative Phase (RSARP) definition
+--------------------------+------------------------------------------+ | > **Definition** | > Reference signal antenna relative | | | > phase (RSARP), is defined as the | | | > difference between the average phase | | | > of the resource elements that carry | | | > cell-specific reference signals across | | | > the entire LTE channel bandwidth | | | > received by the reference antenna | | | > (chosen here as Rx~0~) and the average | | | > phase of the resource elements that | | | > carry cell-specific reference signals | | | > across the entire LTE channel | | | > bandwidth received by one other | | | > receiver antenna (Rx~1~ .. Rx~n~). | | | > | | | > For RSARP determination, the | | | > cell-specific reference signals R~0~ | | | > according to TS 36.211 [3] shall be | | | > used. | | | > | | | > The reference point for the RSARP | | | > shall be the antenna connector of the | | | > UE. | +--------------------------+------------------------------------------+ | > **Measurement period** | > Since the signal is static there is no | | | > minimum measurement period defined but | | | > a figure of one 10 ms subframe is | | | > suggested. | +--------------------------+------------------------------------------+ | > **Applicable for** | > RRC_CONNECTED intra-frequency | +--------------------------+------------------------------------------+
Note 1: The number of resource elements within the measurement period that are
used by the UE to determine RSARP is left up to the UE implementation with the
limitation that corresponding measurement accuracy requirements have to be
fulfilled.
Note 2: The phase per resource element is determined from the energy received
during the useful part of the symbol, excluding the CP.
### 5.9.1 Request Antenna Information values
Figure 5.9.1-1: Antenna Test Function measurement procedure
#### 5.9.1.1 General
The SS uses the ATF measurement procedure to request reporting of the current
values of RSAP and RSARP according to the requested carrier number. The
response depends on the number of receivers NR supported by the UE for the
requested carrier number.
#### 5.9.1.2 Initiation
The SS can request antenna information when the UE is in E-UTRA connected
state.
NOTE: Refer to TS 36.508 [26] subclause 4.5.1 for more details on UE states.
The SS requests the UE to report its current antenna information values by
sending an ANTENNA INFORMATION REQUEST message which specifies the desired
carrier number (CN). The mapping from CN to carrier is given in subclause
6.17.
#### 5.9.1.3 Reception of ANTENNA INFORMATION REQUEST by the UE
Upon receiving the ANTENNA INFORMATION REQUEST message the UE shall:
1> perform an RSAP measurement on receiver Rx~0~ for the carrier number
indicated in the ANTENNA INFORMATION REQUEST message
1> if the number of supported receivers (NR) is >1 perform an RSAP measurement
on receiver Rx~1~ for the carrier number indicated in the ANTENNA INFORMATION
REQUEST message and perform an RSARP measurement using receivers Rx~0~ and
Rx~1~
1> if the number of supported receivers (NR) is >2 perform an RSAP measurement
on receiver Rx~2~ for the carrier number indicated in the ANTENNA INFORMATION
REQUEST message and perform an RSARP measurement using receivers Rx~0~ and
Rx~2~
1> if the number of supported receivers (NR) is >3 perform an RSAP measurement
on receiver Rx~3~ for the carrier number indicated in the ANTENNA INFORMATION
REQUEST message and perform an RSARP measurement using receivers Rx~0~ and
Rx~3~
1> if the number of supported receivers (NR) is >4 perform an RSAP measurement
on receiver Rx~4~ for the carrier number indicated in the ANTENNA INFORMATION
REQUEST message and perform an RSARP measurement using receivers Rx~0~ and
Rx~4~
1> if the number of supported receivers (NR) is >5 perform an RSAP measurement
on receiver Rx~5~ for the carrier number indicated in the ANTENNA INFORMATION
REQUEST message and perform an RSARP measurement using receivers Rx~0~ and
Rx~5~
1> if the number of supported receivers (NR) is >6 perform an RSAP measurement
on receiver Rx~6~ for the carrier number indicated in the ANTENNA INFORMATION
REQUEST message and perform an RSARP measurement using receivers Rx~0~ and
Rx~6~
1> if the number of supported receivers (NR) is >7 perform an RSAP measurement
on receiver Rx~7~ for the carrier number indicated in the ANTENNA INFORMATION
REQUEST message and perform an RSARP measurement using receivers Rx~0~ and
Rx~7~
1> report the used carrier number CN, the number of supported receivers NR,
the Rx0 RSAP measurement result and the conditional RSAP and RSARP measurement
results to the SS using the ANTENNA INFORMATION RESPONSE message
### 5.9.2 UE ATF requirements
This subclause defines the accuracy requirements for the RSAP and RSARP
measurements.
It should be noted that the two-stage test method includes RSAP and RSARP
validation and if necessary linearization of the results prior to calibration
of the results against known radiated metrology standards, therefore the
requirement for RSAP and RSARP is that they are monotonic over a given range
and resolution. As a consequence their absolute accuracies are not relevant.
However, due to the similarity with RSRP, in order to guide RSAP
implementation, an upper bound limit on accuracy is defined for RSAP. Since
RSAP is measured in much easier conditions than RSRP, the RSRP absolute
requirement will not increase the demands on existing receiver designs.
#### 5.9.2.1 RSAP
The requirements for RSAP accuracy are given in Table 5.9.2.1-1.
Table 5.9.2.1-1: Reference Signal Antenna Power requirements
+-------------------------+-------------------------------------------+ | > **Parameter** | > **Value** | +-------------------------+-------------------------------------------+ | > **Absolute accuracy** | > Â± 6 dB | +-------------------------+-------------------------------------------+ | > **Range** | > RSAP absolute accuracy and monotonicity | | | > to be maintained over the range -60 dBm | | | > to -80 dBm incident power measured at | | | > the orientation of the DUT's maximum | | | > antenna gain. | +-------------------------+-------------------------------------------+ | > **Monotonicity** | > Monotonicity over a 1 dB interval. This | | | > is necessary to enable linearization of | | | > the UE RSAP response as part of the | | | > accuracy requirements for the derived | | | > complex antenna pattern. | +-------------------------+-------------------------------------------+
#### 5.9.2.2 RSARP
The requirements for RSARP accuracy are given in Table 5.9.2.1-2.
Table 5.9.2.1-2: Reference Signal Antenna Relative Phase requirements
+--------------------+------------------------------------------------+ | > **Parameter** | > **Value** | +--------------------+------------------------------------------------+ | > **Range** | > RSARP monotonicity to be maintained over the | | | > range -60 dBm to -80 dBm incident power | | | > measured at the orientation of the DUT's | | | > maximum antenna gain. | +--------------------+------------------------------------------------+ | > **Monotonicity** | > Monotonicity over a 5 degree interval. This | | | > is necessary to enable linearization of the | | | > UE RSARP response as part of the accuracy | | | > requirements for the derived complex antenna | | | > pattern. | +--------------------+------------------------------------------------+
## 5.10 Set UL Message test function
### 5.10.1 General
This test function is mandatory for UEs supporting UL RRC segmentation and
whose maximum UECapabilityInformation message size is less than the allowed
maximum supported size of a PDCP SDU.
The SS uses the Set UL message test procedure to indicate to the UE to use a
preconfigured uplink message, see figure 5.10.1-1.
Figure 5.10.1-1: Set UL Message test procedure
### 5.10.2 Initiation
The SS requests the UE to use the preconfigured UL message by transmitting a
SET UL MESSAGE REQUEST message and the UE confirms by responding with a SET UL
MESSAGE RESPONSE message.
### 5.10.3 Reception of SET UL MESSAGE REQUEST message by UE
When UE receives SET UL MESSAGE REQUEST message then the UE shall:
  1. if the UE is operating in RRC_CONNECTED state:
2> if E0 = 1.
3> use the predefined UE capability as defined in Annex B.1 to create the
subsequent UECapabilityInformation message to be transmitted upon receiving a
UECapabilityEnquiry message.
3> Transmit SET UL MESSAGE RESPONSE message.
2> else
3> the UE behaviour is unspecified.
1> else:
2> the UE behaviour is unspecified.
# 6 Message definitions and contents
In this clause, only TC protocol messages are described. TC messages are
intended to be sent using the _DLInformationTransfer_ and
_ULInformationTransfer_ procedures, see TS 36.331 [25], sub clause 5.6.1 and
5.6.2.
For UE capable of V2X communication and in out-of-coverage state, TC messages
are intended to be sent using AT Command, see TS 27.007[8], chapter 15.
NOTE 1: A message received with skip indicator different from 0 will be
ignored.
NOTE 2: For general definition of Layer 3 message format see TS 24.007 [5],
clause 11.
NOTE 3: E-UTRA, UTRA and GSM/GPRS test control messages use the same protocol
discriminator value (\"1111\"). Following message type value series are
reserved for GSM/GPRS testing commands as specified by TS 44.014 [33]:
0000xxxx, 0001xxxx and 0010xxxx where x represent 0 or 1. Following message
type value series are reserved for UTRA testing commands as specified by TS
34.109 [11]: 0100xxxx where x represent 0 or 1. For E-UTRA and NB-IoT test
commands the message type value series 1000xxxx and 1001xxxx are reserved.
## 6.1 CLOSE UE TEST LOOP
This message is only sent in the direction SS to UE.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], sub clause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], sub
clause 11.2.3.1.2 M V Â½ Message type M V 1 UE test loop mode M V 1 UE test
loop mode A LB setup CV-ModeA LV 1-25 UE test loop mode B LB setup CV-ModeB V
1 UE test loop mode C setup CV-ModeC V 3 UE test loop mode D setup CV-ModeD
LV-E 3-803 UE test loop mode E setup CV-ModeE LV 2-18 UE test loop mode F
setup CV-ModeF V 2 UE test loop mode GH setup CV-ModeGH V 2
* * *
* * *
Condition Explanation CV-ModeA This IE is mandatory present if the IE \"UE
test loop mode\" is set to UE test loop Mode A. Else it shall be absent. CV-
ModeB This IE is mandatory present if the IE \"UE test loop mode\" is set to
UE test loop Mode B. Else it shall be absent. CV-ModeC This IE is mandatory
present if the IE \"UE test loop mode\" is set to UE test loop Mode C. Else it
shall be absent. CV-ModeD This IE is mandatory present if the IE "UE test loop
mode" is set to UE test loop Mode D. Else it shall be absent. CV-ModeE This IE
is mandatory present if the IE "UE test loop mode" is set to UE test loop Mode
E. Else it shall be absent. CV-ModeF This IE is mandatory present if the IE
"UE test loop mode" is set to UE test loop Mode F. Else it shall be absent.
CV-ModeGH This IE is mandatory present if the IE "UE test loop mode" is set to
UE test loop Mode G or UE test loop mode H. Else it shall be absent.
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 0 0 0 0 octet 1
* * *
where UE test loop mode is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 X4 X3 X2 X1 octet 1
* * *
X4=0 and X3=0 and X2=0 and X1=0 then UE test loop mode A is selected.
X4=0 and X3=0 and X2=0 and X1=1 then UE test loop mode B is selected.
X4=0 and X3=0 and X2=1 and X1=0 then UE test loop mode C is selected.
X4=0 and X3=0 and X2=1 and X1=1 then UE test loop mode D is selected.
X4=0 and X3=1 and X2=0 and X1=0 then UE test loop mode E is selected.
X4=0 and X3=1 and X2=0 and X1=1 then UE test loop mode F is selected.
X4=0 and X3=1 and X2=1 and X1=0 then UE test loop mode G is selected.
X4=0 and X3=1 and X2=1 and X1=1 then UE test loop mode H is selected.
X4=1 and X3=0 and X2=0 and X1=0 then UE test loop mode I is selected.
Other combinations of X1 and X2 and X3 and X4 are reserved for future versions
of the protocol.
where UE test loop mode A LB setup is:
+---+------------------------------------------------------+--------------+ | | 8 7 6 5 4 3 2 1 | | +---+------------------------------------------------------+--------------+ | | Length of UE test loop mode A LB setup list in bytes | Octet 1 | +---+------------------------------------------------------+--------------+ | | LB setup list | Octet 2 | | | | | | | | Octet N*3+1 | +---+------------------------------------------------------+--------------+
N is the number of LB entities in the LB setup list and is less than or equal
to MAX_ModeA_LB_entities.
where LB setup list is:
+---+--------------------+--------------+ | | 8 7 6 5 4 3 2 1 | | +---+--------------------+--------------+ | | LB setup DRB IE#1 | Octet 2 | | | | | | | | Octet 3 | | | | | | | | Octet 4 | +---+--------------------+--------------+ | | LB setup DRB IE#2 | Octet 5 | | | | | | | | Octet 6 | | | | | | | | Octet 7 | +---+--------------------+--------------+ | | ... | | +---+--------------------+--------------+ | | LB setup DRB IE#N | Octet N*3-1 | | | | | | | | Octet N*3 | | | | | | | | Octet N*3+1 | +---+--------------------+--------------+
where LB Setup DRB#k IE is:
* * *
8 7 6 5 4 3 2 1 bit no. Z15 Z14 Z13 Z12 Z11 Z10 Z9 Z8 octet 1 Z7 Z6 Z5 Z4 Z3
Z2 Z1 Z0 octet 2 Reserved Q4 Q3 Q2 Q1 Q0 octet 3
* * *
Z15..Z0 = Uplink PDCP SDU size in bits 0.. 12160 (binary coded, Z15 is most
significant bit and Z0 least significant bit). See Note 1.
Q4..Q0 = 0..31 representing DRB-Identity -1, where DRB-Identity identifies the
data radio bearer in accordance to TS 36.331 [25] (binary coded, where Q4 is
most significant bit and Q0 least significant bit).
NOTE 1: The UL PDCP SDU size is limited to 12160 bits (1520 octets).
NOTE 2: A \"LB Setup DRB IE\" is only needed for a DRB if UL PDCP SDU scaling
is needed. If there is no \"LB Setup DRB IE\" associated with a DRB in the
CLOSE UE TEST LOOP message then the same size of the PDCP SDU received in
downlink is returned in uplink.
NOTE 3: The UL PDCP SDU size shall be byte aligned (i.e. multiple of 8 bits)
according to TS 36.323 [24] clause 6.2.1.
And where UE test loop mode B setup is:
* * *
     8 7 6 5 4 3 2 1   
     IP PDU delay      Octet 1
* * *
Where IP PDU delay is:
* * *
8 7 6 5 4 3 2 1 bit no. T7 T6 T5 T4 T3 T2 T1 T0 octet 1
* * *
T7..T0 = value of T_delay_modeB timer 0..255 seconds (binary coded, T7 is most
significant bit and T0 least significant bit).
NOTE: For E-UTRAN to CDMA2000 test cases, the SS should not sent any downlink
U-plane data in E-UTRAN after sending a CLOSE UE TEST LOOP message with an IP
PDU delay parameter set to value different from zero. In CDMA2000, the
T_delay_modeB timer is not used to buffer downlink U-plane data, and at expiry
of this timer, if there are buffered data received while in E-UTRAN, it is not
specified what the UE will do with these data. See clause 7.3 for the
definition of the T_delay_modeB timer.
And where UE test loop mode C setup is:
+---+-----------------+---------+ | | 8 7 6 5 4 3 2 1 | | +---+-----------------+---------+ | | MTCH ID | octet 1 | | | | | | | | octet 2 | | | | | | | | octet 3 | +---+-----------------+---------+
Where MTCH ID is:
* * *
8 7 6 5 4 3 2 1 bit no. A7 A6 A5 A4 A3 A2 A1 A0 Octet 1 Reserved M3 M2 M1 M0
octet 2  
Reserved L4 L3 L2 L1 L0 octet 3
* * *
A7..A0 = MBSFN area identity 0.. 255 (binary coded, A7 is most significant bit
and A0 least significant bit). See Note.
M3..M0 = MCH identity 0.. 14 (binary coded, M3 is most significant bit and M0
least significant bit). See Note.
L4..L0 = Logical channel identity 0..28 (binary coded, L4 is most significant
bit and L0 least significant bit), See Note.
NOTE: A MTCH is identified by the MCH in the _pmch-InfoList-r9_ (0..14) and
the _logicalChannelIdentity-r9_ (0..28) in the _mbms-SessionInfoList-r9_ of
the MCH. The pmch-Info-List-r9 is broadcasted on the MCCH in the
_MBSFNAreaConiguration_ message, see TS 36.331 [25] clause 5.8. The MBSFN area
the UE is to monitor is checked against the _mbsfn-AreaId-r9_ of the cell,
which is broadcasted in the SystemInformationBlockType13-r9 message, see TS
36.331 [25] clause 6.3.1.
And where UE test loop mode D setup is:
+---+-------------------------------------------------------+--------------+ | | 8 7 6 5 4 3 2 1 | | +---+-------------------------------------------------------+--------------+ | | Length of UE test loop mode D setup contents in bytes | Octet 1 | | | | | | | | Octet 2 | +---+-------------------------------------------------------+--------------+ | | Discovery Announce or Monitor | Octet 3 | +---+-------------------------------------------------------+--------------+ | | Monitor list | Octet 4 | | | | | | | | Octet N*2+3 | +---+-------------------------------------------------------+--------------+
where Discovery Announce or Monitor is:
* * *
8 7 6 5 4 3 2 1 bit no. Reserved D0 octet 1
* * *
D0 = 0 is used to trigger the UE to continuously monitor the discovery
messages on the PSDCH, and D0 = 1 is used to trigger the UE to continuously
announce a discovery message on the PSDCH.
And where Monitor list is:
+---+--------------------------------------+--------------+ | | 8 7 6 5 4 3 2 1 | | +---+--------------------------------------+--------------+ | | ProSe App Code (LSBs) #1 to monitor | Octet 4 | | | | | | | | Octet 5 | +---+--------------------------------------+--------------+ | | ProSe App Code (LSBs) #2 to monitor | Octet 6 | | | | | | | | Octet 7 | +---+--------------------------------------+--------------+ | | ... | | +---+--------------------------------------+--------------+ | | ProSe App Code (LSBs) #N to monitor | Octet N*2+2 | | | | | | | | Octet N*2+3 | +---+--------------------------------------+--------------+
N = PROSE_DISCOVERY_MONITOR_N is the number of entities in the list of ProSe
App Codes to individually monitor, and is less than or equal to
MAX_ModeD_Monitor_Entities.
Where ProSe App Code (LSBs) #n to monitor is:
* * *
8 7 6 5 4 3 2 1 bit no. A7 A6 A5 A4 A3 A2 A1 A0 octet 1 Reserved A8 octet 2
* * *
A8...A0 = LSBs of the ProSe App Code 0..512 to monitor individually. The test
system shall ensure that each entity in the list of ProSe App Code (LSBs
A8...A0) to monitor is unique.
And where UE test loop mode E setup is:
+---+-------------------------------------------------+--------------+ | | 8 7 6 5 4 3 2 1 | | +---+-------------------------------------------------+--------------+ | | Length of UE test loop mode E Monitor setup | Octet 1 | | | contents in bytes | | +---+-------------------------------------------------+--------------+ | | Communication Transmit or Receive | Octet 2 | +---+-------------------------------------------------+--------------+ | | Monitor list | Octet 3 | | | | | | | | Octet N+2 | | | | | | | | or | | | | | | | | Octet 3*N+2 | +---+-------------------------------------------------+--------------+
where Communication Transmit or Receive is:
* * *
8 7 6 5 4 3 2 1 bit no. Reserved E1 E0 octet 1
* * *
E0 = 0 is used to trigger the UE to continuously monitor and receive ProSe
Direct or V2X Communication message (on STCH, PSCCH and PSSCH), and E0 = 1 is
used to trigger the UE to start continuous transmitting ProSe Direct or V2X
Communication messages (on STCH).
E1 = 0 is used to indicate the UE is operating ProSe Direct Communication, and
E1 = 1 is used to indicate the UE is operating V2X sidelink communication.
And where Monitor list is if E1 = 0:
* * *
     8 7 6 5 4 3 2 1                                                         
     Group Destination ID \#1 to monitor for ProSe Direct Communication      Octet 3
     Group Destination ID \#2 to monitor for Prose Direct Communication      Octet 4
     ...                                                                     
     Group Destination ID \#N to monitor for ProSe Direction Communication   Octet N+2
* * *
N = PROSE_COMMUNICATION_MONITOR_N is the number of entities in the list of
Group Destination ID to individually monitor, and is less than or equal to
MAX_ModeE_Monitor_Entities.
Where Group Destination ID #n to monitor is:
* * *
8 7 6 5 4 3 2 1 bit no. A7 A6 A5 A4 A3 A2 A1 A0 octet 1
* * *
A7...A0 = Group Destination ID 0..255 to monitor individually. The test system
shall ensure that each entity in the list of Group Destination ID to monitor
is unique.
And where Monitor list is if E1 = 1:
+---+-------------------------------------------------------------+--------------+ | | 8 7 6 5 4 3 2 1 | | +---+-------------------------------------------------------------+--------------+ | | Destination Layer-2 ID #1 to monitor for V2X Communication | Octet 3 | | | | | | | | Octet 4 | | | | | | | | Octet 5 | +---+-------------------------------------------------------------+--------------+ | | Destination Layer-2 ID #2 to monitor for V2X Communication | Octet 6 | | | | | | | | Octet 7 | | | | | | | | Octet 8 | +---+-------------------------------------------------------------+--------------+ | | ... | | +---+-------------------------------------------------------------+--------------+ | | Destination Layer-2 ID #N to monitor for V2X Communication | Octet 3*N | | | | | | | | Octet 3*N+1 | | | | | | | | Octet 3*N+2 | +---+-------------------------------------------------------------+--------------+
N = PROSE_COMMUNICATION_MONITOR_N is the number of entities in the list of
Destination Layer-2 ID to individually monitor, and is less than or equal to
MAX_ModeE_Monitor_Entities.
NOTE: The Destination Layer-2 ID is only used for V2X PSSCH packets counting.
Where Destination Layer-2 ID #n to monitor is:
* * *
8 7 6 5 4 3 2 1 bit no. A7 A6 A5 A4 A3 A2 A1 A0 octet 1 A15 A14 A13 A12 A11
A10 A9 A8 octet 1 A23 A22 A21 A20 A19 A18 A17 A16 octet 1
* * *
A23...A0 = Destination Layer-2 ID 0..16,777,215 to monitor individually. The
test system shall ensure that each entity in the list of Destination Layer-2
ID to monitor is unique.
And where UE test loop mode F setup is:
+---+-----------------+---------+ | | 8 7 6 5 4 3 2 1 | | +---+-----------------+---------+ | | SC-MTCH ID | octet 1 | | | | | | | | octet 2 | +---+-----------------+---------+
Where SC-MTCH ID is:
* * *
8 7 6 5 4 3 2 1 bit no. A7 A6 A5 A4 A3 A2 A1 A0 octet 1 A15 A14 A13 A12 A11
A10 A9 A8 octet 2
* * *
A15..A0 = SC-PTM g-RNTI-r13 (g-RNTI-r14 in NB-IoT) 0..65535 (binary coded, A15
is most significant bit and A0 least significant bit). A SC-MTCH is identified
by the _g-RNTI-r13_ (_g-RNTI-r14_ in NB-IoT) (0..65535) in the _sc-mtch-
Infolist-r13_ (_sc-mtch-InfoList-r14_ in NB-IoT)_._ The _sc-mtch-Infolist-r13_
(_sc-mtch-InfoList-r14_ in NB-IoT) is broadcasted on SC-MCCH in the _SCPTM-
Configuration_ (_SCPTMConfiguration-NB_ in NB-IoT) message, see TS 36.331 [25]
clause 5.8a.
And where UE test loop mode GH setup is:
* * *
     8 7 6 5 4 3 2 1                  
     Operation mode and repetitions   Octet 1
     Uplink data delay                Octet 2
* * *
Where Operation mode and repetitions is:
* * *
8 7 6 5 4 3 2 1 bit no. M1 R6 R5 R4 R3 R2 R1 R0 octet 1
* * *
M1 = Uplink loopback operation mode. Value 0 means that data is returned in
uplink at the EMM entity for UE test loop mode G or the SM-TL SAP for UE test
loop mode H, Value 1 means that data is returned in uplink at the RLC AM-SAP
of SRB1bis for NB-IoT UE or at the RLC AM-SAP of SRB2 for E-UTRA UE.
R6..R0 = Number of repetitions of received content of received user data in
downlink in uplink. Range 0..127 repetitions (binary coded, R6 is most
significant bit and R0 least significant bit). 0 means that no data is
returned in uplink, 1 means that the same user data as received in downlink is
returned in uplink, 2..127 means that the received content of user data in
downlink is repeated up to maximum 127 times in uplink.
Where Uplink data delay is:
* * *
8 7 6 5 4 3 2 1 bit no. T7 T6 T5 T4 T3 T2 T1 T0 octet 1
* * *
T7..T0 = value of T_delay_modeGH timer 0..255 seconds (binary coded, T7 is
most significant bit and T0 least significant bit).
## 6.2 CLOSE UE TEST LOOP COMPLETE
This message is only sent in the direction UE to SS.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], sub clause 11.2.3.1.1 M V 1/2 Skip indicator TS 24.007 [5], sub
clause 11.2.3.1.2 M V 1/2 Message type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 0 0 0 1 octet 1
* * *
## 6.3 OPEN UE TEST LOOP
This message is only sent in the direction SS to UE.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], sub clause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], sub
clause 11.2.3.1.2 M V Â½ Message type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 0 0 1 0 octet 1
* * *
## 6.4 OPEN UE TEST LOOP COMPLETE
This message is only sent in the direction UE to SS.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], sub clause 11.2.3.1.1 M V 1/2 Skip indicator TS 24.007 [5], sub
clause 11.2.3.1.2 M V 1/2 Message type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 0 0 1 1 octet 1
* * *
## 6.5 ACTIVATE TEST MODE
This message is only sent in the direction SS to UE.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], sub clause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], sub
clause 11.2.3.1.2 M V Â½ Message type M V 1 UE test loop mode M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 0 1 0 0 octet 1
* * *
And where UE test loop mode is specified in clause 6.1.
NOTE: No specific UE action is currently specified upon reception of the \"UE
test loop mode\" IE.
## 6.6 ACTIVATE TEST MODE COMPLETE
This message is only sent in the direction UE to SS.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], sub clause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], sub
clause 11.2.3.1.2 M V Â½ Message type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 0 1 0 1 octet 1
* * *
## 6.7 DEACTIVATE TEST MODE
This message is only sent in the direction SS to UE.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], sub clause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], sub
clause 11.2.3.1.2 M V Â½ Message type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 0 1 1 0 octet 1
* * *
## 6.8 DEACTIVATE TEST MODE COMPLETE
This message is only sent in the direction UE to SS.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], sub clause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], sub
clause 11.2.3.1.2 M V Â½ Message type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 0 1 1 1 octet 1
* * *
## 6.9 RESET UE POSITIONING STORED INFORMATION
This message is only sent in the direction SS to UE.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], subclause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], subclause
11.2.3.1.2 M V Â½ Message type M V 1 UE Positioning Technology M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 1 0 0 0 octet 1
* * *
where UE Positioning Technology is a single octet IE:
* * *
8 7 6 5 4 3 2 1 bit no. UE Positioning Technology octet 1
* * *
UE Positioning Technology value
Bits
**8 7 6 5 4 3 2 1**
0 0 0 0 0 0 0 0 AGNSS
0 0 0 0 0 0 0 1 OTDOA
0 0 0 0 0 0 1 0 MBS
0 0 0 0 0 0 1 1 WLAN
0 0 0 0 0 1 0 0 Bluetooth
0 0 0 0 0 1 0 1 Sensor
All other cause values are reserved for future use.
## 6.10 UE TEST LOOP MODE C MBMS PACKET COUNTER REQUEST
This message is only sent in the direction SS to UE.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], subclause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], subclause
11.2.3.1.2 M V Â½ Message type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 1 0 0 1 octet 1
* * *
## 6.11 UE TEST LOOP MODE C MBMS PACKET COUNTER RESPONSE
This message is only sent in the direction UE to SS.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], subclause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], subclause
11.2.3.1.2 M V Â½ Message type M V 1 MBMS Packet Counter Value M V 4
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 1 0 1 0 octet 1
* * *
And where MBMS Packet Counter Value is:
* * *
C31 C30 C29 C28 C27 C26 C25 C24 octet 1 C23 C22 C21 C20 C19 C18 C17 C16 octet
2 C15 C14 C13 C12 C11 C10 C9 C8 octet 3 C7 C6 C5 C4 C3 C2 C1 C0 octet 4
* * *
C31..C0 = MBMS packet counter value 0.. 4294967295 (binary coded, C31 is most
significant bit and C0 least significant bit).
## 6.12 UPDATE UE LOCATION INFORMATION
This message is only sent in the direction SS to UE.
* * *
**Information Element** **Reference** Presence Format Length Protocol
discriminator TS 24.007 [5], subclause 11.2.3.1.1 M V Â½ Skip indicator TS
24.007 [5], subclause 11.2.3.1.2 M V Â½ Message type M V 1
ellipsoidPointWithAltitude TS 37.355 [37], subclause 6.4.1. M V 8
horizontalVelocity TS 37.355 [37], subclause 6.4.1. M V 3 gnss-TOD-msec TS
37.355 [37], subclause 6.5.2.6. M V 3
* * *
where message type is:
8 7 6 5 4 3 2 1 bit no.
* * *
1 0 0 0 1 0 1 1 octet 1
And where ellipsoidPointWithAltitude is:
8 7 6 5 4 3 2 1 bit no.
* * *
L1 DLA22 DLA21 DLA20 DLA19 DLA18 DLA17 DLA16 octet 1 DLA15 DLA14 DLA13 DLA12
DLA11 DLA10 DLA9 DLA8 octet 2 DLA7 DLA6 DLA5 DLA4 DLA3 DLA2 DLA1 DLA0 octet 3
DLO23 DLO22 DLO21 DLO20 DLO19 DLO18 DLO17 DLO16 octet 4 DLO15 DLO14 DLO13
DLO12 DLO11 DLO10 DLO9 DLO8 octet 5 DLO7 DLO6 DLO5 DLO4 DLO3 DLO2 DLO1 DLO0
octet 6 A1 AD14 AD13 AD12 AD11 AD10 AD9 AD8 octet 7 AD7 AD6 AD5 AD4 AD3 AD2
AD1 AD0 octet 8
L1 = "latitudeSign" value 0=north and 1=south
DLA22..DLA0 = "degreesLatitude" value 0..8388607 (binary coded, DLA22 is most
significant bit and DLA0 is least significant bit).
DLO23..DLO0 = "degreesLongitude" value -8388608..8388607 (two's complement
binary coded as per ASN.1 encoding of an integer value, DLO23 is most
significant bit and DLO0 is least significant bit).
A1 = "altitudeDirection" value 0=height and 1=depth
AD14..AD0 = "altitude" value 0..32767 (binary coded, AD14 is most significant
bit and AD0 is least significant bit).
And where horizontalVelocity is:
8 7 6 5 4 3 2 1 bit no.
* * *
B8 B7 B6 B5 B4 B3 B2 B1 Octet 1 B0 HS10 HS9 HS8 HS7 HS6 HS5 HS4 octet 2 HS3
HS2 HS1 HS0 Reserved octet 3
B8..B0 = "bearing" value 0..359 (binary coded, B8 is most significant bit and
B0 is least significant bit).
HS10..HS0 = "horizontalSpeed" value 0..2047 (binary coded, HS10 is most
significant bit and HS0 is least significant bit).
And where nss-TOD-msec is:
8 7 6 5 4 3 2 1 bit no.
* * *
Reserved T21 T20 T19 T18 T17 T16 octet 1  
T15 T14 T13 T12 T11 T10 T9 T8 octet 2 T7 T6 T5 T4 T3 T2 T1 T0 octet 3
T21..T0 = "gnss-TOD-msec" value 0.. 3599999 (binary coded, T21 is most
significant bit and T0 is least significant bit).
## 6.13 UE TEST LOOP PROSE PACKET COUNTER REQUEST
This message is only sent in the direction SS to UE.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], subclause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], subclause
11.2.3.1.2 M V Â½ Message type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 1 1 0 0 octet 1
* * *
## 6.14 UE TEST LOOP PROSE PACKET COUNTER RESPONSE
This message is only sent in the direction UE to SS.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], subclause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], subclause
11.2.3.1.2 M V Â½ Message type M V 1 ProSe Direct Discovery Packet Counter(s)
Value CV-ModeD TLV-E 4*(N^D^+1)+ 3 ProSe Direct or V2X Communication PSCCH
Packet Counter(s) Value CV-ModeE TLV 4*(N^C^+1)+2 ProSe Direct or V2X
Communication STCH Packet Counter(s) Value CV-ModeE TLV 4*(N^C^+1)+2 ProSe
Direct or V2X Communication PSSCH Packet Counter(s) Value CV-ModeE TLV
4*(N^C^+1)+2
* * *
* * *
Condition Explanation CV-ModeD This IE is mandatory present if
TEST_LOOP_MODE_D_ACTIVE is TRUE else it shall be absent. N^D^ =
PROSE_DISCOVERY_MONITOR_N. CV-ModeE This IE is mandatory present if
TEST_LOOP_MODE_E_ACTIVE is TRUE else it shall be absent. N^C^ =
PROSE_COMMUNICATION_MONITOR_N.
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 1 1 0 1 octet 1
* * *
And where ProSe Direct Discovery Packet Counter(s) Value is:
+-------------------------------------------------+-------------------+ | 8 7 6 5 4 3 2 1 | | +-------------------------------------------------+-------------------+ | ProSe Direct Discovery Packet Counter(s) Value | octet 1 | | type | | +-------------------------------------------------+-------------------+ | Length of ProSe Direct Discovery Packet | octets 2-3 | | Counter(s) Value contents in bytes | | +-------------------------------------------------+-------------------+ | ProSe Direct Discovery Packet Counter IE #0 | octet 4 | | | | | | octet 5 | | | | | | octet 6 | | | | | | octet 7 | +-------------------------------------------------+-------------------+ | ... | | +-------------------------------------------------+-------------------+ | ProSe Direct Discovery Packet Counter IE #N^D^ | octet 4+4 * N^D^ | | | | | | octet 5+4 * N^D^ | | | | | | octet 6+4 * N^D^ | | | | | | octet 7+4 * N^D^ | +-------------------------------------------------+-------------------+
And where ProSe Direct Discovery Packet Counter(s) Value type is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 0 0 0 octet 1
* * *
And where ProSe Direct Discovery Packet Counter IE #n is:
* * *
C31 C30 C29 C28 C27 C26 C25 C24 octet 1 C23 C22 C21 C20 C19 C18 C17 C16 octet
2 C15 C14 C13 C12 C11 C10 C9 C8 octet 3 C7 C6 C5 C4 C3 C2 C1 C0 octet 4
* * *
C31..C0 = PSDCH packet counter value 0.. 4294967295 (binary coded, C31 is most
significant bit and C0 least significant bit) corresponding to
PSDCH_PACKET_COUNTER(SL_ID=n).
And where ProSe Direct or V2X Communication PSCCH Packet Counter(s) Value is:
+-------------------------------------------------+-------------------+ | 8 7 6 5 4 3 2 1 | | +-------------------------------------------------+-------------------+ | ProSe Direct or V2X Communication PSCCH Packet | octet 1 | | Counter(s) Value type | | +-------------------------------------------------+-------------------+ | Length of ProSe Direct or V2X Communication | octet 2 | | PSCCH Packet Counter(s) Value contents in bytes | | +-------------------------------------------------+-------------------+ | ProSe Direct or V2X Communication PSCCH Packet | octet 3 | | Counter IE #0 | | | | octet 4 | | | | | | octet 5 | | | | | | octet 6 | +-------------------------------------------------+-------------------+ | ... | | +-------------------------------------------------+-------------------+ | ProSe Direct or V2X Communication PSCCH Packet | octet 3+4 * N^C^ | | Counter IE #N^C^ | | | | octet 4+4 * N^C^ | | | | | | octet 5+4 * N^C^ | | | | | | octet 6+4 * N^C^ | +-------------------------------------------------+-------------------+
And where ProSe Direct or V2X Communication PSCCH Packet Counter(s) Value type
is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 0 0 1 octet 1
* * *
And where ProSe Direct or V2X Communication PSCCH Packet Counter IE #n is:
* * *
D31 D30 D29 D28 D27 D26 D25 D24 octet 1 D23 D22 D21 D20 D19 D18 D17 D16 octet
2 D15 D14 D13 D12 D11 D10 D9 D8 octet 3 D7 D6 D5 D4 D3 D2 D1 D0 octet 4
* * *
D31..D0 = PSCCH packet counter 0.. 4294967295 (binary coded, D31 is most
significant bit and D0 least significant bit) corresponding to
PSCCH_PACKET_COUNTER(SL_ID = n).
NOTE: For V2X communication, the ProSe Direct or V2X Communication PSCCH
Packet Counter IE #SL_ID with SL_ID = 0 ... PROSE_COMMUNICATION_MONITOR_N-1 is
zero.
And where ProSe Direct or V2X Communication STCH Packet Counter(s) Value is:
+-------------------------------------------------+-------------------+ | 8 7 6 5 4 3 2 1 | | +-------------------------------------------------+-------------------+ | ProSe Direct or V2X Communication STCH Packet | octet 1 | | Counter(s) Value type | | +-------------------------------------------------+-------------------+ | Length of ProSe Direct or V2X Communication | octet 2 | | STCH Packet Counter(s) Value in bytes | | +-------------------------------------------------+-------------------+ | ProSe Direct or V2X Communication STCH Packet | octet 3 | | Counter IE #0 | | | | octet 4 | | | | | | octet 5 | | | | | | octet 6 | +-------------------------------------------------+-------------------+ | ... | | +-------------------------------------------------+-------------------+ | ProSe Direct or V2X Communication STCH Packet | octet 3+4 * N^C^ | | Counter IE #N^C^ | | | | octet 4+4 * N^C^ | | | | | | octet 5+4 * N^C^ | | | | | | octet 6+4 * N^C^ | +-------------------------------------------------+-------------------+
where ProSe Direct or V2X Communication STCH Packet Counter(s) Value type is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 0 1 0 octet 1
* * *
And where ProSe Direct or V2X Communication STCH Packet Counter IE #n is:
* * *
E31 E30 E29 E28 E27 E26 E25 E24 octet 1 E23 E22 E21 E20 E19 E18 E17 E16 octet
2 E15 E14 E13 E12 E11 E10 E9 E8 octet 3 E7 E6 E5 E4 E3 E2 E1 E0 octet 4
* * *
E31..E0 = STCH Packet Counter value 0.. 4294967295 (binary coded, E31 is most
significant bit and E0 least significant bit) corresponding to
STCH_PACKET_COUNTER(SL_ID = n).
And where ProSe Direct or V2X Communication PSSCH Packet Counter(s) Value is:
+-------------------------------------------------+-------------------+ | 8 7 6 5 4 3 2 1 | | +-------------------------------------------------+-------------------+ | ProSe Direct or V2X Communication PSSCH Packet | octet 1 | | Counter(s) Value type | | +-------------------------------------------------+-------------------+ | Length of ProSe Direct or V2X Communication | octet 2 | | PSSCH Packet Counter(s) Value contents in bytes | | +-------------------------------------------------+-------------------+ | ProSe Direct or V2X Communication PSSCH Packet | octet 3 | | Counter IE #0 | | | | octet 4 | | | | | | octet 5 | | | | | | octet 6 | +-------------------------------------------------+-------------------+ | ... | | +-------------------------------------------------+-------------------+ | ProSe Direct or V2X Communication PSSCH Packet | octet 3+4 * N^C^ | | Counter IE #N^C^ | | | | octet 4+4 * N^C^ | | | | | | octet 5+4 * N | | | | | | octet 6+4 * N^C^ | +-------------------------------------------------+-------------------+
And where ProSe Direct or V2X Communication PSSCH Packet Counter(s) Value type
is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 0 1 1 octet 1
* * *
And where ProSe Direct or V2X Communication PSSCH Packet Counter IE #n is:
* * *
F31 F30 F29 F28 F27 F26 F25 F24 octet 1 F23 F22 F21 F20 F19 F18 F17 F16 octet
2 F15 F14 F13 F12 F11 F10 F9 F8 octet 3 F7 F6 F5 F4 F3 F2 F1 F0 octet 4
* * *
F31..F0 = PSSCH packet counter 0.. 4294967295 (binary coded, F31 is most
significant bit and F0 least significant bit) corresponding to
PSSCH_PACKET_COUNTER(SL_ID = n).
## 6.15 UE TEST LOOP MODE F SCPTM PACKET COUNTER REQUEST
This message is only sent in the direction SS to UE.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], subclause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], subclause
11.2.3.1.2 M V Â½ Message type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 1 1 1 0 octet 1
* * *
## 6.16 UE TEST LOOP MODE F SCPTM PACKET COUNTER RESPONSE
This message is only sent in the direction UE to SS.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], subclause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], subclause
11.2.3.1.2 M V Â½ Message type M V 1 SCPTM Packet Counter Value M V 4
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 0 1 1 1 1 octet 1
* * *
And where SCPTM Packet Counter Value is:
* * *
F31 F30 F29 F28 F27 F26 F25 F24 octet 1 F23 F22 F21 F20 F19 F18 F17 F16 octet
2 F15 F14 F13 F12 F11 F10 F9 F8 octet 3 F7 F6 F5 F4 F3 F2 F1 F0 octet 4
* * *
F31..F0 = SCPTM packet counter value 0.. 4294967295 (binary coded,F31 is most
significant bit and F0 least significant bit).
## 6.17 ANTENNA INFORMATION REQUEST
This message is only sent in the direction SS to UE.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], subclause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], subclause
11.2.3.1.2 M V Â½ Message type M V 1 Carrier number (CN) M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 1 0 0 0 0 octet 1
* * *
where carrier number is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 C2 C1 C0 octet 1
* * *
C2..C0 = Carrier number (CN) value 0 .. 4 (binary coded, C2 is most
significant bit and C0 least significant bit).
The mappings from CN to carrier are as follows:
CN = 0 Primary serving cell
CN = 1 Secondary serving cell (if present)
CN = 2 Tertiary serving cell (if present)
CN = 3 Quaternary serving cell (if present)
CN = 4 Quinary serving cell (if present)
## 6.18 ANTENNA INFORMATION RESPONSE
This message is only sent in the direction UE to SS.
* * *
Information Element Reference Presence Format Length Protocol discriminator TS
24.007 [5], subclause 11.2.3.1.1 M V Â½ Skip indicator TS 24.007 [5], subclause
11.2.3.1.2 M V Â½ Message type M V 1 Carrier number M V 1 Number of receives
(NR) M V 1 RSAP (for Rx~0~) M V 2 RSAP (for Rx~1~) C if NR > 1 V 2 RSARP (for
Rx~0\ and~ Rx~1~) C if NR > 1 V 2 RSAP (for Rx~2~) C if NR > 2 V 2 RSARP (for
Rx~0\ and~ Rx~2~) C if NR > 2 V 2 RSAP (for Rx~3~) C if NR > 3 V 2 RSARP (for
Rx~0\ and~ Rx~3~) C if NR > 3 V 2 RSAP (for Rx~4~) C if NR > 4 V 2 RSARP (for
Rx~0\ and~ Rx~4~) C if NR > 4 V 2 RSAP (for Rx~5~) C if NR > 5 V 2 RSARP (for
Rx~0\ and~ Rx~5~) C if NR > 5 V 2 RSAP (for Rx~6~) C if NR > 6 V 2 RSARP (for
Rx~0\ and~ Rx~6~) C if NR > 6 V 2 RSAP (for Rx~7~) C if NR > 7 V 2 RSARP (for
Rx~0\ and~ Rx~7~) C if NR > 7 V 2
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 0 1 0 0 0 1 octet 1
* * *
where carrier number is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 C2 C1 C0 octet 1
* * *
C2..C0 = Carrier number value 0 .. 4 (binary coded, C2 is most significant bit
and C0 least significant bit).
The reported carrier number should match the value given in the previous
ANTENNA INFORMATION REQUEST message
where number of receivers is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 N2 N1 N0 octet 1
* * *
N2 .. N0 is the number of receivers (NR) supported by the UE for the indicated
carrier number. The value is binary coded with N2 as the most significant bit
and N0 as the least significant bit. The expected values are in the range 1,
2, 4 or 8.
The reported number of receive antennas determines the presence of the
optional fields for RSAP on Rx~1..7~ and the corresponding RSARP values
where RSAP is:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 R13 R12 R11 R10 R9 R8 octet 1 R7 R6 R5 R4 R3 R2 R1
R0 octet 2
* * *
R13..R0 is the measured RSAP value for the indicated receiver and carrier
number. The RSAP value in -xxx.xx dBm shall be multiplied by -100 and binary
coded with R13 as the most significant bit and R0 as the least significant
bit. The RSAP value shall be in the range of 0.00 to -120.00 dBm
where RSARP is:
* * *
8 7 6 5 4 3 2 1 bit no. P15 P14 P13 P12 P11 P10 P9 P8 octet 1 P7 P6 P5 P4 P3
P2 P1 P0 octet 2
* * *
P15..P0 is the measured RSARP value for the indicated receivers and carrier
number. The RSARP value xxx.xx degrees shall be multiplied by 100 and binary
coded with P15 as the most significant bit and P0 as the least significant
bit. The RSARP value shall be in the range of 0 to 359.99 degrees.
## 6.19 SET UL MESSAGE
### 6.19.1 SET UL MESSAGE REQUEST
This message is only sent in the direction SS to UE.
Information Element Reference Presence Format Length
* * *
Protocol discriminator TS 24.007 [5], sub clause 11.2.3.1.1 M V Â½ Skip
indicator TS 24.007 [5], sub clause 11.2.3.1.2 M V Â½ Message type M V 1 Use
Preconfigured UL Message M V 1
where message type is:
8 7 6 5 4 3 2 1 bit no.
* * *
1 0 1 0 1 1 0 0 octet 1
where Use Preconfigured UL Message is:
8 7 6 5 4 3 2 1 bit no.
* * *
Reserved E0 octet 2
E0=1: Use Preconfigured UE Capability.
### 6.19.2 SET UL MESSAGE RESPONSE
This message is only sent in the direction UE to SS.
Information Element Reference Presence Format Length
* * *
Protocol discriminator TS 24.007 [5], sub clause 11.2.3.1.1 M V Â½ Skip
indicator TS 24.007 [5], sub clause 11.2.3.1.2 M V Â½ Message type M V 1
where message type is:
8 7 6 5 4 3 2 1 bit no.
* * *
1 0 1 0 1 1 0 1 octet 1
# 7 Variables, constants and timers
## 7.1 State variables
BUFFER_IP_PDUs
This boolean state variable is used to control if UE is to buffer IP PDUs or
not.
TEST_LOOP_MODE_B_ACTIVE
This boolean state variable is used to indicate if UE test loop mode B is
active. TEST_LOOP_MODE_B_ACTIVE shall be set to FALSE when UE is switched on.
CDMA2000_INITIATED
This boolean state variable is used to indicate if IP control signalling was
initiated by the network on CDMA2000.
TEST_LOOP_MODE_C_ACTIVE
This boolean state variable is used to indicate if UE test loop mode C is
active. TEST_LOOP_MODE_C_ACTIVE shall be set to FALSE when UE is switched on.
MBMS_PACKET_COUNTER
This 32-bit integer state variable is used to count successful reception of
MBMS packets while UE test loop mode C is activate. MBMS_PACKET_COUNTER shall
be set to zero when UE is switched on.
TEST_LOOP_MODE_D_ACTIVE
This boolean state variable is used to indicate if UE test loop mode D is
active. TEST_LOOP_MODE_D_ACTIVE shall be set to FALSE when UE is switched on.
TEST_LOOP_MODE_E_ACTIVE
This boolean state variable is used to indicate if UE test loop mode E is
active. TEST_LOOP_MODE_E_ACTIVE shall be set to FALSE when UE is switched on.
PROSE_DISCOVERY_MONITOR_N
This 9-bit integer state variable is used to indicate the number of entities
in the list of ProSe App Codes to individually monitor as configured in the
CLOSE_UE_TEST_LOOP message for test loop mode D. The variable shall be set to
0 when UE is switched on.
PSDCH_PACKET_COUNTER(SL_ID)
This 32-bit integer state variable is used to count successful reception of
SL-DCH MAC SDUs while UE test loop mode D is activated and
TEST_LOOP_MODE_D_TRIGGER is set to MONITOR. The counter variable is indexed
with SL_ID = 0...( MAX_ModeD_Monitor_Entities). PSDCH_PACKET_COUNTER(SL_ID)
shall be set to zero when UE is switched on.
If configured value of variable PROSE_DISCOVERY_MONITOR_N is set to 0 then UE
counts all received SL-DCH MAC SDUs as part of just one counter
PSDCH_PACKET_COUNTER(0) irrespective of the application code.
PROSE_COMMUNICATION_MONITOR_N
This 4-bit integer state variable is used to indicate the number of entities
in the list of Group Destination IDs or Destination Layer-2 IDs to
individually monitor as configured in the CLOSE_UE_TEST_LOOP message for test
loop mode E. The variable shall be set to 0 when UE is switched on.
STCH_PACKET_COUNTER(SL_ID)
This 32-bit integer state variable is used to count successful reception of
STCH PDCP SDUs while UE test loop mode E is activated and
TEST_LOOP_MODE_E_TRIGGER is set to RECEIVE. The counter variable is indexed
with SL_ID = 0...( MAX_ModeE_Monitor_Entities). STCH_PACKET_COUNTER(SL_ID)
shall be set to zero when UE is switched on. If configured value of variable
PROSE_COMMUNICATION_MONITOR_N is set to 0 then UE counts all STCH PDCP SDU as
part of one counter STCH_PACKET_COUNTER(0)irrespective of Group Destination
IDs or Destination Layer-2 IDs.
PSCCH_PACKET_COUNTER(SL_ID)
This 32-bit integer state variable is used to count successful reception of
PSCCH transport blocks while UE test loop mode E is activated and
TEST_LOOP_MODE_E_TRIGGER is set to RECEIVE. The counter variable is indexed
with SL_ID = 0...( MAX_ModeE_Monitor_Entities). PSCCH_PACKET_COUNTER(SL_ID)
shall be set to zero when UE is switched on. If configured value of variable
PROSE_COMMUNICATION_MONITOR_N is set to 0 then UE counts all PSCCH PHY
transport blocks as part of one counter PSCCH_PACKET_COUNTER(0) irrespective
of Group Destination IDs or Destination Layer-2 IDs.
PSSCH_PACKET_COUNTER(SL_ID)
This 32-bit integer state variable is used to count successful reception of
PSSCH transport blocks while UE test loop mode E is activated and
TEST_LOOP_MODE_E_TRIGGER is set to RECEIVE. The counter variable is indexed
with SL_ID = 0...( MAX_ModeE_Monitor_Entities). PSSCH_PACKET_COUNTER(SL_ID)
shall be set to zero when UE is switched on. If configured value of variable
PROSE_COMMUNICATION_MONITOR_N is set to 0 then UE counts all PSSCH PHY
transport blocks as part of one counter PSSCH_PACKET_COUNTER(0) irrespective
of Group Destination IDs or Destination Layer-2 IDs.
TEST_LOOP_MODE_F_ACTIVE
This boolean state variable is used to indicate if UE test loop mode F is
active. TEST_LOOP_MODE_F_ACTIVE shall be set to FALSE when UE is switched on.
SCPTM_PACKET_COUNTER
This 32-bit integer state variable is used to count successful reception of
MBMS packets while UE test loop mode F is activate. SCPTM_PACKET_COUNTER shall
be set to zero when UE is switched on.
TEST_LOOP_MODE_G_ACTIVE
This boolean state variable is used to indicate if UE test loop mode G is
active. TEST_LOOP_MODE_G_ACTIVE shall be set to FALSE when UE is switched on.
TEST_LOOP_MODE_H_ACTIVE
This boolean state variable is used to indicate if UE test loop mode H is
active. TEST_LOOP_MODE_H_ACTIVE shall be set to FALSE when UE is switched on.
GH_BUFFER_CP_data
This boolean state variable is used when UE test loop mode G or UE test loop
mode H is active to control if UE is to buffer the user data received in
downlink or not.
GH_RLC_SDU_loopback
This boolean state variable is used when UE test loop mode G or UE test loop
mode H is active to control if UE is to return data as RLC SDUs. If the value
is TRUE then data is returned as RLC SDUs for both UE Test loop mode G and H.
If the value is FALSE then data is returned to the EMM entity for UE test loop
mode G and to the SM-TL entity for UE test loop mode H.
## 7.2 Constants
MAX_ModeA_LB_entities = 8.
MAX_ModeD_Monitor_Entities = 400.
MAX_ModeE_Monitor_Entities = 16.
## 7.3 Timers
T_delay_modeB
When UE is operated in E-UTRA, NB-IoT, UTRA and GERA mode, this timer is used
to delay the transmission of the first IP PDU when UE test loop function is
operated in UE test loop mode B. In CDMA2000, this timer is used to
temporarily interrupt UE test loop mode B operation so as to allow IP control
signalling required before data transmission. The timer value is configured by
the UE test loop mode B setup IE in the CLOSE UE TEST LOOP message.
T_delay_modeGH
When UE test loop function is operated in UE test loop mode G or UE test loop
mode H this timer is used to delay the transmission of uplink user data. The
timer value is configured by the UE test loop mode GH setup IE in the CLOSE UE
TEST LOOP message.
## 7.4 Configurable parameters
DRB_ID(LB_ID)
This parameter is used by the UE when operating in UE test loop mode A to map
a bi-directional Data Radio bearer to a loopback entity. LB_ID = 0..
(MAX_ModeA_LB_entities-1). The value is configured when UE receives the CLOSE
UE TEST LOOP message DRB_ID(LB_ID)=0 indicate that no DRB is mapped to the
loopback identity.
UL_PDCP_SDU_scaling(LB_ID)
This parameter is used to enable/disable scaling of UL PDCP SDU size. If
UL_PDCP_SDU_scaling is set to TRUE then scaling based on
UL_PDCP_SDU_size(LB_ID) parameter is performed, otherwise no scaling is done
(UL PDCP SDU size is equal to received DL PDCP SDU size). The value is
configured by the UE test loop mode A setup IE in the CLOSE UE TEST LOOP
message.
UL_PDCP_SDU_size(LB_ID)
This parameter is used to set the UL PDCP SDU size for returned UL PDCP SDUs
on the data radio bearer with data radio bearer ID equal to DRB_ID(LB_ID).
This parameter is only applicable for UE test loop mode A and when state
variable UL_PDCP_SDU_scaling(LB_ID) is TRUE. The value is configured by the UE
test loop mode A setup IE in the CLOSE UE TEST LOOP message.
PROSE_DISCOVERY_APPCODE(SL_ID)
This parameter is used by the UE when operating in UE test loop mode D and
TEST_LOOP_MODE_D_TRIGGER is set to MONITOR to map the LSBs of the ProSe App
Code to monitor to the entity index SL_ID = 0...(
MAX_ModeD_Monitor_Entities-1). The value is configured in the CLOSE UE TEST
LOOP message.
PROSE_COMMUNICATION_DEST_ID(SL_ID)
This parameter is used by the UE when operating in UE test loop mode E and
TEST_LOOP_MODE_E_TRIGGER is set to RECEIVE to map the Group Destination ID or
Destination Layer-2 ID to monitor to the entity index SL_ID = 0...(
MAX_ModeE_Monitor_Entities-1). The value is configured in the CLOSE UE TEST
LOOP message.
GH_NUMBER_UL_DATA_REPETITIONS
This parameter is used by the UE when operating in UE test loop mode G or UE
test loop mode H to repeat user data received in downlink
GH_NUMBER_UL_DATA_REPETITIONS of times in uplink. The parameter is configured
by UE test loop mode GH IE in CLOSE UE TEST LOOP.
# 8 Electrical Man Machine Interface (EMMI)
The EMMI is used for automation of conformance testing, or, in the case of V2X
testing for facilitating the UE test loop mode E operation and UTC time reset
in out-of-coverage test scenarios.
For test automation, the commands used on the EMMI by the System Simulator,
shall be limited to those specified in TS 36.523-3 [32]. For facilitating the
UE test loop mode E operation and UTC time reset in V2X out-of-coverage test
scenarios the AT commands which are used are indicated wherever appropriate in
the present specification. An illustration is given in figure 8-1 as an
example.
NOTE: A connection diagram for V2X Communication / Intra-band contiguous MCC
operation (common connectors, same UL antenna) is specified in TS 36.508 [26],
figures A.89a and A.92.
At the System Simulator side, the logical EMMI using mandatory AT commands
shall interface with the Main Test Component (MTC) of TTCN test cases which
hosts the Upper Tester. The physical EMMI interface towards the UE may be for
example a standard USB interface. Other interfaces of proprietary or
standardized type shall not be precluded.
At the UE side an adapter needs to be provided by the UE manufacturer for
converting the commands into the UE manufacturer specific interface and
format.
The use of EMMI is optional for the UE.
Figure 8-1: An example of EMMI and its use for automation of signalling
testing or V2X out-of-coverage test scenarios
# 9 Test application definition
## 9.1 Definition of the UE ATF Client Application
This clause defines a client application for access to the ATF as an
alternative to the layer 3 definition provided in clause 5.9.1.
The UE ATF client application (or simply the "ATF test application") to
support LTE over-the-air radiated performance testing allows the UE:
\- to receive the ANTENNA INFORMATION REQUEST from the Test Platform
\- to respond to the Test Platform with the ANTENNA INFORMATION RESPONSE
The application needs to be tailored to the specific device which needs to
support the underlying RSAP and RSARP ATF measurements in the device chipset.
For data-centric devices, the ATF test application is designed to run on a
host laptop, e.g., USB modem plugged into the laptop, or configured by a host
laptop tethered to the UE only for initial configuration as shown in Figure
9.1-1.
Figure 9.1-1: Tethered UE ATF Client Application Connection Diagram
For phones, notebooks, and tablets, the ATF test application is embedded by
the vendor on the devices provided to the test lab for over-the-air radiated
performance testing as shown in Figure 9.1-2.
Figure 9.1-2: Embedded UE ATF Client Application Connection Diagram
On launch of the ATF test application, the DUT listens on the IP address and
UDP port configured on the test platform and wait for the test platform to
initiate communication with the ATF test application.
The ATF test application communicates with the test platform using the
commands detailed in clause 9.1.2 "Message Definitions and Contents".
The ATF test application needs to have a user interface through which the user
can configure the IP address and port number defined for use by the test
platform. This configuration is stored across DUT power cycles.
The ANTENNA INFORMATION RESPONSE is expected to be sent by the UE within 1 s
of the ANTENNA INFORMATION REQUEST.
### 9.1.2 Message Definitions and Contents
The message definition and their contents used to communicate between the UE
and the test platform are outlined below. These message definitions are for
legacy single carrier 2x2 MIMO devices. For the commands detailed below, the
following notation applies:
\- Presence: is either M=Mandatory or O=Optional
\- Format: equivalent to [8], subclause 11.2.3.1.1
\- Length: in octets
##### ANTENNA INFORMATION REQUEST {#antenna-information-request-1 .H6}
This message is only sent in the direction from the Test Platform to the UE.
* * *
Information Element Presence Format Length Message0 type M V 1 Request type M
V 1
* * *
where message0 type is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 0 0 0 octet 1
* * *
where request type is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 1 1 octet 1
* * *
##### ANTENNA INFORMATION RESPONSE {#antenna-information-response-1 .H6}
This message is only sent in the direction from the UE to the Test Platform.
* * *
Information Element Presence Format Length Message0 type M V 1 Date M V 4 Time
M V 4 Message0 type M V 1 Message0 type M V 1 RSAP (for Rx~0~) M V 2 RSARP
(for Rx~0~ and Rx~1~) M V 2 Message1 type M V 1 RSAP (for Rx~1~) M V 2
* * *
where message0 type is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 0 0 0 octet 1
* * *
and where message1 type is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 0 0 1 octet 1
* * *
The date is encoded with
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 Y10 Y9 Y8 octet 1 Y7 Y6 Y5 Y4 Y3 Y2 Y1 Y0
octet 2 0 0 0 0 M3 M2 M1 M0 octet 3 0 0 0 D4 D3 D2 D1 D0 octet 4
* * *
Y10..Y0 is the year and binary coded with Y10 as the most significant bit and
Y0 as the least significant bit. M3..M0 is the month and binary coded with M3
as the most significant bit and M0 as the least significant bit. D4..D0 is the
day and binary coded with D4 as the most significant bit and D0 as the least
significant bit.
The time i encoded with:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 H3 H2 H1 H0 octet 1 0 0 MIN5 MIN4 MIN3 MIN2
MIN1 MIN0 octet 2 S15 S14 S13 S12 S11 S10 S9 S8 octet 3 S7 S6 S5 S4 S3 S2 S1
S0 octet 4
* * *
H3..H0 is the hour and binary coded with H3 as the most significant bit and H0
as the least significant bit. MIN5..MIN0 is the minutes and binary coded with
MIN5 as the most significant bit and MIN0 as the least significant bit.
S15..S0 is the seconds. The seconds value in xx.xxx format is multiplied by
1000 and binary coded with S15 as the most significant bit and S0 as the least
significant bit.
The RSAP is encoded with:
* * *
8 7 6 5 4 3 2 1 bit no. 1 0 R13 R12 R11 R10 R9 R8 octet 1 R7 R6 R5 R4 R3 R2 R1
R0 octet 2
* * *
R13..R0 is the measured RSAP value for the indicated receiver. The RSAP value
in -xxx.xx dBm shall be multiplied by -100 and binary coded with R13 as the
most significant bit and R0 as the least significant bit. The RSAP value shall
be in the range of 0.00 to -120.00 dBm.
while RSARP is encoded with:
* * *
8 7 6 5 4 3 2 1 bit no. P15 P14 P13 P12 P11 P10 P9 P8 octet 1 P7 P6 P5 P4 P3
P2 P1 P0 octet 2
* * *
P15..P0 is the measured RSARP value between receivers Rx~1~ and Rx~0~. The
RSARP value xxx.xx degrees shall be multiplied by 100 and binary coded with
P15 as the most significant bit and P0 as the least significant bit. The RSARP
value shall be in the range of 0 to 359.99 degrees.
Alternatively, the ATF test application can follow the message definition and
contents defined in sections 5.9.1, e.g. to support CA and or UEs with more
than two Rx antennas.
###### ## Annex A (informative): Void
Void.
###### ## Annex B (normative): Pre-defined message containers used for testing
B.1 Predefined UE Capability container
NOTE: For sake of testability, the below container list does not describe the
true capability of the UE and does not rely on UEs support of LTE.
ue-CapabilityRAT-ContainerList
{
{
rat-Type eutra,
ueCapabilityRAT-Container
\'DDB8050705F845A0C5BF5E1E3FFA5FFFFE3FFA5FFFFE3FFA5FFFFE3FFA5FFFFE3FFA5FFFFE3FFA5FFFFE3FFA5FFFFE3FFA5FFFFDFF3FFFFA39000886429D104194E950400250200128971FC1F37E0000000183FEFFFFF68000000183FE7FFFF600000002F1D010830EF800000017FE0060048012006084300304218210C1006080304018200C1006080304018210C10860843003003042082104108208030401821041080104018200904018200C1006080304018210C00908210C2084308210C2084308210C1086084304218210C1086084308200C2080308200C2000308000C2004308010C1006080304018200C2080308200C2000308000C2000308010C1006080308010C2004308010C2004308010C2004308010C2004308200C2080308200C2000308000C2004308010C2000308000C2000308000C2000308010C2004308010C2004308010C1006080304018200C2004308010C2004308210C2084308210C2084304218210C30842186108430C21086184210C2084308210C2084308210C2084308210C208437E708210C2084308210C2084308210C108608430C21006184200C30840186100030C20006184000C30802186100430C20086104018410061040184100610401841006104018410061040186000430C00086100218400860803040186108030C21006184000C30800186100030C20006184000C30802186100430C0000610401841006104018410061040184100610401841006180000C300001840006180000C30000186000430C000861000184000610001840006100218200C1006180210C30042186008430C01086180210C30042184008610021840086180210C30042186008430C01086180210C30042186108030C21006184200C30800186100030C20006184000C30802186100430C20086104018410061040184100610401841006104018410061040186000430C00086180010C30002186000430C01086180210C2004308010C30002186000430C00086180010C30002186000430C00086180010C30002186000430C00086180010C2000308000C200030C01086180210C30042186008430C01086180210C2004308010C2004308010C200430C00086180010C30002186008430C01086180210C30042186008430C01086100218400861002184008610021840086184210C30842184108610421841086084304218210C1086006104208410821040084100208410420821041082084104208410821040084100210400821041082084108010C2004304018200C2084108210420801082004208010420821041082084104208210430842086108410C2100218420042084108210420841082104208410821042084108210420801082004208010820041082084104200840006100018400061000184000484000610001840086100218200C10060803040142000308000C20002840086080308010C2004308000C2000308010C2004304018200C10060802D07D5463D47F0304001040FF0004103100010006D0800618002081960008007F8002001DE000820E080020A08410304001241FF00041410820BF841C10004107100010104208288103040010416D08182000820FF800202084105FC2060800208396000808210414B08182000820E180020A0841050C20E08002083FE00082FE1040FF0004903FC001141FF00041440800BF841C40004007FC00105B42003FE00080FE10417F081FE000820FF80020A584005FC20E580020038800080881000C40004405B42062000200396000808810014B08188000800E20002021841051020618002083FE00080DA10016D08196000800B6840C30004107FC001010C2082FE1030C001041CB00040430820A5840C300041070C001050C208186000920E58002025840032C001102C10004141082821042FF000417F0828210427F082FE10704001042FF00041410828210427F0838200082821041FF00049410820BF849C10004107FC00115042082FE11704001041FF00041410920BF841C1000490BFC0010510202084109FC20E2000202084109FC20A2040C1000410B100010110202084109102022040C1000410B10001010420A08410910206080020A08410710001110420828811304001041C400040410920A2040C1000490BFC00105B4202084109FC20B6840C10004109B42036840C10004109B42062000202084109B42022040C10004109B4206080020A084105B424608002082DA10304001242FF000407F0828210427F081FE000828210427F080FE10704001042FF00040430828210427F08186000828210427F0808610704001042FF00040410828210427F0818200082821042FF000414B0808210427F08396000808210427F08296103040010426D08196000808210426D08096103040010426D08186000828210426D0808610704001042CB000404B0808210424B0809610304001042CB00040440808210424B08188000808210424B0808810304001042CB00040430828210424B08186000828210424B0808610704001042CB00040410828210424B0818200082821041CB00044410820A5844C100041072C001010424829610304001242C40004043082821042440818600082821042440808610704001042C30004143082821042430828610704001042C30004141082821042430838200082821041C300049410820A1849C1000410FFC00105FC20BF841410821BF8417F082FE10704001043FF000417F08282105042086FE105FC20E080020A08410BFC00125FC20A084109FC24FF80020A084109FC24BF841C1000410BFC00115FC20A084109FC22FF80020A084109FC22BF841C1000410BFC00105FC20A0849FF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFF1FFD2FFFFEF9C800011FF0022F17878743C3C5E2F178B804BFCBFC3C3C390F0E097F97F87000000000043C3C38000000001FF80008080000000008300020000A02028080802008028300A0C02008020080280A02020202020A02028080A0202832020A0C80828080A020200008020080200802830080200A0C02830080200800020001001202808120280812020120200A02028080A02028080A02028081202012020120201001001001000802008020120201202010010010010008020120C808120C808120C808120C0120C0120C0120C0120C01202012020120201001001001001001001001001001001001001001000802008020100100100100100100100080201A0280A020680A028081A028080680A0201202808120280812028081202808120280812028081202809F04012003E78C0282085A06168DFA0124108290420E01000498FFE97FFFF00B2080024A0108280420C7FF4BFFFF80490424E01000414021063FFA5FFFFC02C820008A80420A010831FFD2FFFFE0124108B80400105008418FFE97FFFF0072080026A010831FFD2FFFFE00A4109B804001063FFA5FFFFC03C820008290420A0408080420C7FF4BFFFF80690420A4108381000101008418FFE97FFFF00D2084148210502040C02000831FFD2FFFFE01E4100041408101020404021063FFA5FFFFC03482107020002020408080420C7FF4BFFFF80690420A0408081020601000418FFE97FFFF00F2080020A0408080420A010831FFD2FFFFE01A4108381000101008414021063FFA5FFFFC0348210502040C020008280420C7FF4BFFFF80590400125020404021063FFA5FFFFC0248212702000202010831FFD2FFFFE0124109281020601000418FFE97FFFF00B2080022A0408080420C7FF4BFFFF80490422E04000404021063FFA5FFFFC0248211502040C02000831FFD2FFFFE0164100041408111008418FFE97FFFF00920841C080008880420C7FF4BFFFF80490420A04089804001063FFA5FFFFC03C08000808102020108280420C7FF4BFFFF8068102020408180400105008418FFE97FFFF00B020002220108280420C7FF4BFFFF80481022601000414021063FFA5FFFFC01C080008880424C7FF4BFFFF80281022601000498FFE97FFFF00F2080020A410828B4202010831FFD2FFFFE01A4108290420A2D081804001063FFA5FFFFC03C82000828B42022D08080420C7FF4BFFFF80690420A2D0808B420601000418FFE97FFFF00F2080020A2D080810202010831FFD2FFFFE01A410828B420604000404021063FFA5FFFFC03482105168404081030080020C7FF4BFFFF8079040010516840402105008418FFE97FFFF00D2084145A1030080020A010831FFD2FFFFE01A410808B420601000404021063FFA5FFFFC02C82000928B4202010831FFD2FFFFE012410928B420601000418FFE97FFFF00B2080022A2D08080420C7FF4BFFFF80490422A2D081804001063FFA5FFFFC02C82000828B4242010831FFD2FFFFE012410828B424601000418FFE97FFFF00B2080020A2D08080424C7FF4BFFFF80490420A2D081804001263FFA5FFFFC0345A10116840C080008080420C7FF4BFFFF8068B42022D08081020601000418FFE97FFFF0091684845A1030080020C7FF4BFFFF8068B42060400040408101008418FFE97FFFF00D1684040810102040C02000831FFD2FFFFE01A2D08181000101008414021063FFA5FFFFC0345A10102040C020008280420C7FF4BFFFF8048B424604000404021063FFA5FFFFC0245A12102040C02000831FFD2FFFFE0122D08181000111008418FFE97FFFF009168404081130080020C7FF4BFFFF8048B424601000414021063FFA5FFFFC0145A1330080020C7FF4BFFFF8028B424601000498FFE97FFFF00F230002024108290420A010831FFD2FFFFE01A4608190400105208414021063FFA5FFFFC0348C101208414821070080020C7FF4BFFFF8079180010120841402105008418FFE97FFFF00D23040C820008280420A010831FFD2FFFFE01A4608090420E01000414021063FFA5FFFFC02C8C0008090424A010831FFD2FFFFE0124608190400125008418FFE97FFFF009230404821270080020C7FF4BFFFF8079180010101841406105008418FFE97FFFF00D23040C060008280C20A010831FFD2FFFFE01A4608080C20A03083804001063FFA5FFFFC03C8C0008080C20A0108280420C7FF4BFFFF8069182060300041402105008418FFE97FFFF00D230404061070080020A010831FFD2FFFFE01E4100041482105058404021063FFA5FFFFC0348210520841C160008080420C7FF4BFFFF80690420A4108282C20601000418FFE97FFFF00F2080020A0B080810202010831FFD2FFFFE01A4108382C00101020404021063FFA5FFFFC0348210505840C080008080420C7FF4BFFFF80690420A0B08081020601000418FFE97FFFF00F2080020A0B08080420A010831FFD2FFFFE01A4108382C00101008414021063FFA5FFFFC0348210505840C020008280420C7FF4BFFFF80590400125058404021063FFA5FFFFC0248212705800202010831FFD2FFFFE0124109282C20601000418FFE97FFFF00B2080020A0B08880420C7FF4BFFFF80490420E0B000444021063FFA5FFFFC0248210505844C02000831FFD2FFFFE0164100041416101008498FFE97FFFF00920841C160008080424C7FF4BFFFF80490420A0B081804001263FFA5FFFFC0345A10116840C060008280420C7FF4BFFFF8068B42022D08080C20E01000418FFE97FFFF00D16840C080008080C20A010831FFD2FFFFE01A2D08081020603000414021063FFA5FFFFC0345A101020404061070080020C7FF4BFFFF8068B42060300041406105008418FFE97FFFF00D1684040610501841C02000831FFD2FFFFE0122D09180C00105008418FFE97FFFF009168484061070080020C7FF4BFFFF80782C0010105840406105008418FFE97FFFF00D058404161030180020A010831FFD2FFFFE01A0B08082C20203083804001063FFA5FFFFC03C160008082C2020108280420C7FF4BFFFF80682C2020B08180400105008418FFE97FFFF00F058002020408080C20A010831FFD2FFFFE01A0B08181000101018414021063FFA5FFFFC0341610102040C060008280420C7FF4BFFFF80682C2020408080C20E01000418FFE97FFFF00F058002020408080420A010831FFD2FFFFE01A0B08181000101008414021063FFA5FFFFC0341610102040C020008280420C7FF4BFFFF80582C00111020404021063FFA5FFFFC0241611302000202010831FFD2FFFFE0120B08881020601000418FFE97FFFF00F058002020308280C20A010831FFD2FFFFE01A0B08180C00105018414021063FFA5FFFFC03416101018414061070080020C7FF4BFFFF80782C0010101841402105008418FFE97FFFF00D05840C060008280420A010831FFD2FFFFE01A0B08080C20E01000414021063FFA5FFFFC02C160008880C20A010831FFD2FFFFE0120B08980C00105008418FFE97FFFF009058444061070080020C7FF4BFFFF80582C00111008414021063FFA5FFFFC024161130080020A010831FFD2FFFFE01E0400040408101018414021063FFA5FFFFC0340810102040C060008280420C7FF4BFFFF8068102020408080C20E01000418FFE97FFFF00F020002020308280C20A010831FFD2FFFFE01A0408180C00105018414021063FFA5FFFFC03408101018414061070080020C7FF4BFFFF8078100010101841402105008418FFE97FFFF00D02040C060008280420A010831FFD2FFFFE01A0408080C20E01000414021063FFA5FFFFC02C080008880C20A010831FFD2FFFFE0120408980C00105008418FFE97FFFF009020444061070080020C7FF4BFFFF80581000101018494021063FFA5FFFFC024081030180024A010831FFD2FFFFE0120408080C24E01000418FFE97FFFF00F0180020A0308280420A010831FFD2FFFFE01A0308280C20E01000414021063FFA5FFFFC02C060009280420A010831FFD2FFFFE0120309380400105008418FFE97FFFF00B2080020A4108290420C7FF4BFFFF80390400125208418FFE97FFFF00520849C82000831FFD2FFFFE00E41000454821063FFA5FFFFC014821172080020C7FF4BFFFF801904001363FFA5FFFFC02C820008290420A040811FFD2FFFFE0124108290420E04000408FFE97FFFF00B2080020A040808102047FF4BFFFF80490420E04000404081023FFA5FFFFC01C82000928102047FF4BFFFF80290424E04000408FFE97FFFF0072080022A040811FFD2FFFFE00A4108B810001023FFA5FFFFC01C82000828102247FF4BFFFF80290420E04000448FFE97FFFF00B2080020A410828B42047FF4BFFFF805904001051684045A1023FFA5FFFFC02C82000828B4202040811FFD2FFFFE012410828B420604000408FFE97FFFF0072080024A2D0811FFD2FFFFE00E410004545A1023FFA5FFFFC01C82000828B42447FF4BFFFF80591800101208414821063FFA5FFFFC0248C1032080020A410831FFD2FFFFE00E46000404821263FFA5FFFFC0148C1032080024C7FF4BFFFF80590400105208414161023FFA5FFFFC0248210520841C16000811FFD2FFFFE0164100041416101020408FFE97FFFF00920841C16000808102047FF4BFFFF80490420A0B081810001023FFA5FFFFC01C820009282C2047FF4BFFFF80290424E0B000408FFE97FFFF0072080022A0B0811FFD2FFFFE00A4108B82C001023FFA5FFFFC01C820008282C2247FF4BFFFF80290420E0B000448FFE97FFFF00F2080020A4108290420A040811FFD2FFFFE01A4108290420A41083810001023FFA5FFFFC03C820008290420A040808102047FF4BFFFF80690420A4108381000101020408FFE97FFFF00B2080024A410828102047FF4BFFFF80490424E41000414081023FFA5FFFFC0248212520841C08000811FFD2FFFFE0164100045482105020408FFE97FFFF00920845C82000828102047FF4BFFFF80490422A41083810001023FFA5FFFFC02C820008290420A040891FFD2FFFFE0124108290420E04000448FFE97FFFF00B2080024A040808102047FF4BFFFF80490424E04000404081023FFA5FFFFC02C820008A810202040811FFD2FFFFE0124108B81000101020408FFE97FFFF0072080026A040811FFD2FFFFE00A4109B810001023FFA5FFFFC01C82000928102247FF4BFFFF8048B42022D081810001023FFA5FFFFC0245A10302000202040811FFD2FFFFE80A2D091810001003C7FF4BFFFF8028B420604000448FFE97FFFF00916840C080008080C20C7FF4BFFFF8048B42020408180C001063FFA5FFFFC02C1600080810202030831FFD2FFFFE0120B08181000101018418FFE97FFFF009058404081030180020C7FF4BFFFF80382C00111020408FFE97FFFF00505844C08000811FFD2FFFFE0160400040408101018418FFE97FFFF009020404081030180020C7FF4BFFFF80581000101018414061063FFA5FFFFC024081030180020A030831FFD2FFFFE00E04000444061063FFA5FFFFC014081130180020C7FF4BFFFF80381000101018498FFE97FFFF00502040C06000931FFD2FFFFE00E460004045A1223FFA5FFFFC0245A10116840C06000831FFD2FFFFE0122D08182C00101018418FFE97FFFF009168404161030180020C7FF4BFFFF8028B42460B000408FFE97FFFF00916840C060008280C20C7FF4BFFFF8028B424603000418FFE97FFFF00B230002020308280C20C7FF4BFFFF80491820603000414061063FFA5FFFFC02C160008082C202030831FFD2FFFFE0120B08082C20603000418FFE97FFFF00B058002020308280C20C7FF4BFFFF80482C20603000414061063FFA5FFFFC01C160008880C20C7FF4BFFFF80282C22603000418FFE97FFFF00705800202030931FFD2FFFFE00A0B08180C001263FFA5FFFFC04C0200006010000300800019040000C82000047004800000098040000C02000060100003020000181000008E0090000001300800018040000C0200006030000301800011C01200000026010000300800018040000C16000060B00002380240000004C0200006010000300800019180000C8C000047004800000098040000C02000064100003208000190400008E0090000001320800019040000C8200006040000302000011C01200000026410000320800019040000C06000060300002380240000004C82000064100003208000182C0000C16000047004800000098040000C82000060400003018000182C00008E00900000AF34080291FFFFF34A5DE38474003C30C0404006692A4004000979C7F802401200820090048024012028100480A04041202810104808240502020901408082405020209014080240120281010480A04050202090140808240502009010480A0404120281010480A0404120209014080824050202090140802405020090240081200408012048010204080A0404120281010480A0404120480102040810024090020400902400810204050202090140808240900204009020048102040801204081010480824090020408102004812004081020400902400810204090020408102004810204080120408102004812004080120480102040810024090020408102004812004081020281010480A04041204801020408100240900204009024008102040502020903400081800240D00020600810240081020408012048010204081002409003CE040090240081020409002040810140808240D000206008103000481A00040C100206000903400081820040C010204801020408100240900204081020048120040810204009034000818020409002040810140808240D000206000903400081800240D000206008103000481A00040C010206008102400810024090020400902400810024090020400903004081800240801206080103000481820040C0102040810200481020408012040810104808240D000206080103000481A00040C1002060081024008102040801206800103040081800240D000206080103004081A00040C010206000903400081820040C010206000903400081820040C01020480102040810024090020408102004812004081020400903004081800240C100206008103000481820040C0012040810200481A00040C010206000903400081802040D000206080103004081800240D0002060801030040812004081020400903400081820040C001206800103040081802040900204081020048120040810206800103004081800240D000206080103000481A00040C1002060081024008102040801204801020408100240D000206008102400810204090020281010480A040412009024008100240900204081014080824050202090140808240900204801024008100240502028101408120040810202810104812004080120480102040810024050202090140808240502020903400081800240D0002060081024008102040801204801020408100240900204009024008102040900204081014080824050204009020408082404120408102004812004081020400901408082409002040090240081020405020209014080824050204009020408100240412040810104812004081020480102004812004081020281010480A040410432A680E008080C0502088C81A082001100828210000000000000000\'H
},
}
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
Y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document provides the stage 3 specification of the S9 reference
point for the present release. The functional requirements of stage 2
specification for the S9 reference point are contained in 3GPP TS 23.203 [2].
The S9 reference point lies between the PCRF in the home PLMN (also known as
H-PCRF) and the PCRF in the visited PLMN (also known as V-PCRF).
Whenever it is possible the present document specifies the requirements for
the protocols by reference to specifications produced by the IETF within the
scope of Diameter. Where this is not possible extensions to Diameter are
defined within the present document.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TR 21.905: "Vocabulary for 3GPP Specifications".
[2] 3GPP TS 23.203: "Policy and Charging Control Architecture"
[3] 3GPP TS 29.212: "Policy and charging control over Gx reference point"
[4] 3GPP TS 29.213: "Policy and charging control signalling flows and Quality
of Service (QoS) parameter mapping"
[5] 3GPP TS 29.214: "Policy and charging control over Rx reference point"
[6] IETF RFC 3588: "Diameter Base Protocol".
[7] 3GPP TS 29.229: "Cx and Dx interfaces based on the Diameter protocol;
Protocol details"
[8] IETF RFC 4960: "Stream Control Transmission Protocol".
[9] 3GPP TS23.003: "Numbering, addressing and identification".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**Home Routed Access: Roaming scenario where the** PCEF is located in the
HPLMN. In a Home Routed roaming scenario, the UE obtains access to the packet
data network from the HPLMN.
**Visited Access (also known as local breakout):** Roaming scenario where the
PCEF is located in the VPLMN. In a Visited Access Roaming scenario, the UE
obtains access to the packet data network from the VPLMN.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
AF Application Function
AN-Gateway Access Network Gateway
AVP Attribute-Value Pair
BBERF Bearer Binding and Event Reporting Function
H-AF Home AF
H-PCRF Home PCRF
HPLMN Home PLMN
HR Home-Routed
OCS Online charging system
OFCS Offline charging system
PCC Policy and Charging Control
PCEF Policy and Charging Enforcement Function
PCRF Policy and Charging Rule Function
S-GW Serving Gateway
VA Visited Access
V-AF Visited AF
V-PCRF Visited PCRF
VPLMN Visited PLMN
# 4\. S9 Reference Point
## 4.1 Overview
The S9 reference point is used in roaming scenarios involving a HPLMN and a
VPLMN. Two main roaming scenarios are considered: visited access (PCEF in
VPLMN and AF in VPLMN or HPLMN) and home-routed access (PCEF in HPLMN and AF
in the HPLMN).
Two Diameter applications are used over the S9 reference point: S9 and Rx. The
purpose of the S9 Diameter application is to install PCC rules or QoS rules
generated in the HPLMN into the VPLMN and transport the events that may occur
in the VPLMN to the HPLMN. When the AF is in the VPLMN, Rx is used over the S9
reference point to exchange service session information from the V-PCRF to the
H-PCRF.
The AF exchanges session information with the H-PCRF or V-PCRF as specified in
3GPP TS 29.214[5]. The PCRF (H-PCRF and/or V-PCRF) exchanges PCC rules and QoS
rules with the PCEF and BBERF respectively as specified in 3GPP TS 29.212[3].
Signalling flows related to all the PCC reference points (Gx, Gxx, Rx and S9)
are specified in 3GPP TS 29.213[4].
Diameter messages over the S9 reference point shall make use of SCTP [8].
## 4.2 Reference model
The S9 reference point is defined between the V-PCRF and the H-PCRF for home
routed access and visited access.
NOTE 1: AN-Gateway refers to the S-GW when the Gxc applies and to a trusted
non-3GPP access gateway when Gxa applies. Refer to Annexes A.5 and H.2 of 3GPP
TS 23.203[9] for application of AN-Gateways.
The relationships between the different functional entities involved in the
home routed access are depicted in figure 4.2.1.
Figure 4.2.1: S9 reference point at the PCC architecture for roaming with home
routed access
The relationships between the different functional entities involved in the
visited access are depicted in figure 4.2.2.
Figure 4.2.2: S9 reference point at the PCC architecture for roaming with
visited access
NOTE 2: AF can be located in both VPLMN and HPLMN for the visited access.
For a visited access, the VPLMN may use an OCS proxy between the PCEF and the
OCS.
NOTE 3: The H-PCRF can optionally send the addresses of the proxy/OCS to the
V-PCRF.
NOTE 4: PCEF is located in the Gateway node implementing the IP access to the
PDN. Refer to Annexes of 3GPP TS 23.203[9] for application to specific IP-CAN
types.
## 4.3 Functional elements
### 4.3.1 H-PCRF
The H-PCRF (Home Policy and Charging Rules Function) is a functional element
that encompasses policy control decision and flow based charging control
functionalities in the HPLMN.
The H-PCRF provides functions for both home routed access and visited access.
The H-PCRF selects the bearer control mode applicable for the user or IP-CAN
session. Policy decisions based on the bearer control mode are made in the
H-PCRF.
Usage monitoring as defined in 3GPP TS 29.212 [3] is controlled by the H-PCRF.
The H-PCRF shall check whether PCC Rules or QoS Rules have to be provided
based on the information received from the V-PCRF.
NOTE: The H-PCRF can use the Called-Station-Id AVP for that purpose. When this
AVP is absent, the H-PCRF provides QoS rules that are not related to any IP-
CAN session. When it is present, if it identifies a Visited Network, the PCC
rules will be provided. If it is present and identifies a Home Network, the
QoS rules will be provided.
When provisioning PCC/QoS rules over the S9 reference point, the H-PCRF is
responsible for assigning packet filter identifiers for rules provisioned as a
result of UE initiated resource modification. For E-UTRAN access with UE
initiated resource modification procedure, the H-PCRF shall either authorize
the same QoS as requested or reject the request if the requested QoS cannot be
authorized.
##### 4.3.1.1 Home routed access
The H-PCRF shall provision QoS Rules to the V-PCRF via the S9 reference point
and PCC Rules to the PCEF via the Gx reference point. The H-PCRF ensures that
the QoS Rules provisioned are aligned with the PCC Rules.
The H-PCRF PCC Rule decisions may be based on one or more of the following:
\- Information obtained from the AF via the Rx reference point.
\- Information obtained from the V-PCRF via the S9 reference point.
> NOTE: The above may include information obtained from the BBERF via the Gxx
> reference point.
\- Information obtained from the PCEF via the Gx reference point.
\- Information obtained from the SPR via the Sp reference point.
\- PCRF pre-configured information.
The H-PCRF provisions event triggers to the V-PCRF and PCEF.
##### 4.3.1.2 Visited Access
The H-PCRF shall provision PCC Rules to the V-PCRF via the S9 reference point.
The H-PCRF may provision QoS Rules to the V-PCRF via the S9 reference point
for case 2a when the available QoS Rules are not related to any IP-CAN
session.
The H-PCRF PCC/QoS Rule decisions may be based on one or more of the
following:
\- Information obtained from the AF when located in the home network.
\- Information obtained from the V-PCRF via the S9 reference point.
> NOTE 1: The above may include information obtained from the AF when the AF
> is located in the VPLMN and information obtained from the PCEF or BBERF.
>
> NOTE 2: Information obtained from the AF only applies for PCC Rule
> decisions.
\- Information obtained from the SPR via the Sp reference point.
\- PCRF pre-configured information.
The H-PCRF provisions event triggers to the V-PCRF,
### 4.3.2 V-PCRF
The V-PCRF (Visited Policy and Charging Rules Function) is a functional
element that encompasses policy control decision and flow based charging
control functionalities in the VPLMN.
The V-PCRF provides functions for both home routed access and visited access.
For E-UTRAN access with UE initiated resource modification procedure, the
V-PCRF may validate the QoS based on operator policies in the request from the
BBERF/PCEF before interacting with the H-PCRF.
#### 4.3.2.1 Home routed access
The V-PCRF shall request QoS Rules and report events to the H-PCRF via the S9
interface.
The V-PCRF validates the QoS parameters received within the QoS Rules based on
operator policies. The V-PCRF informs the H-PCRF if the QoS validation failed.
The V-PCRF shall provision QoS Rules to the BBERF via the Gxx reference point.
#### 4.3.2.2 Visited access
The V-PCRF shall request PCC Rules from and report events to the H-PCRF using
the S9 reference point.
The V-PCRF may request QoS Rules from the H-PCRF using the S9 reference point
when the available QoS Rules are not related to any IP-CAN session.
If the V-PCRF receives the PCC Rules from the H-PCRF, the V-PCRF extracts the
QoS Rules from the PCC Rules, validates the former, and if QoS validation is
successful, the V-PCRF shall provision the PCC Rules to the PCEF via the Gx
reference point and the QoS Rules to the BBERF via the Gxx reference point. If
the QoS validation fails the V-PCRF shall provide the acceptable QoS to the
H-PCRF. The H-PCRF may provide back an acceptable QoS to the V-PCRF or may
reject the request. Upon reception of the successful response from the H-PCRF,
the V-PCRF shall provision the PCC Rules to the PCEF and the QoS Rules to the
BBERF, if H-PCRF reject the request the V-PCRF shall reject the corresponding
request from the PCEF/BBERF. If the QoS validation applies to the Default
Bearer QoS or APN-AMBR, the procedures described in clauses 4.5.1.5 and
4.5.1.6 shall apply respectively. For case 2a, there may be additional
specific rules to be installed at the BBERF for the sole purpose of allowing
the tunnel between the BBERF and the PCEF not directly related with any
service.
When the AF is located in the VPLMN, the V-PCRF shall exchange Rx messages
with the H-PCRF over the S9 reference point.
## 4.4 PCC Rules and QoS Rules
### 4.4.1 PCC Rule definition
The purpose of the PCC Rule is defined in 3GPP TS 29.212 [3]. PCC Rules are
sent over S9 interface for visited access.
There are two different types of PCC rules as defined in 3GPP TS 29.212 [3]:
\- Dynamic PCC rules. Dynamically provisioned by the H-PCRF to the V-PCRF via
the S9 interface. These PCC rules may be either predefined or dynamically
generated in the H-PCRF. Dynamic PCC rules can be installed, modified and
removed at any time.
\- Predefined PCC rules. Preconfigured in the PCEF. Predefined PCC rules can
be activated or deactivated by the H-PCRF at any time via the V-PCRF using S9
interface. Predefined PCC rules may be grouped allowing the H-PCRF to
dynamically activate a set of PCC rules in the PCEF via the V-PCRF using S9
interface. The H-PCRF should activate the predefined PCC rules based on the
roaming agreement. The V-PCRF may accept or reject the H-PCRF decision
according to visited operator policy.
The content of a PCC Rule is the same as defined in 3GPP TS 29.212 [3]. The
rule name within a PCC Rule shall be used to reference to a PCC Rule in the
communication between the H-PCRF and the V-PCRF.
### 4.4.2 QoS Rule definition
The purpose of the QoS Rule is defined in 3GPP TS 29.212 [3]. QoS Rules are
sent over S9 interface for home routed access and visited access.
The content of a QoS Rule is the same as defined in 3GPP TS 29.212 [3]. The
rule name within a QoS Rule shall be used to reference to a QoS Rule in the
communication between the H-PCRF and the V-PCRF.
### 4.4.3 Operations on PCC rules
PCC Rules operations are defined in 3GPP TS 29.212 [3]. This clause clarifies
how those operations are implemented on the S9 interface.
For dynamic PCC rules, the V-PCRF validates the QoS parameters requested
within the PCC Rules, before accepting the installation or modification of PCC
Rules. If the QoS validation fails the V-PCRF shall provide the acceptable QoS
to the H-PCRF. Upon reception of the successful response from the H-PCRF, the
V-PCRF shall provision the PCC Rules to the PCEF, if H-PCRF reject the request
the V-PCRF shall reject the corresponding request from the PCEF/BBERF.
For the Visited Access case, the H-PCRF may activate predefined PCC rules in
the V-PLMN's PCEF. In that case, the V-PCRF shall validate, based on roaming
agreements, that the H-PCRF is allowed to perform a particular operation on a
particular PCC Rule.
### 4.4.4 Operations on QoS Rules
Dynamic QoS Rules operations are defined in 3GPP TS 29.212 [3].
For QoS rules, the V-PCRF validates the QoS parameters requested within the
QoS Rules, before accepting the installation or modification of QoS Rules. If
the QoS validation fails the V-PCRF shall provide the acceptable QoS to the
H-PCRF. Upon reception of the successful response from the H-PCRF, the V-PCRF
shall provision the QoS Rules to the BBERF, if H-PCRF reject the request the
V-PCRF shall reject the corresponding request from the PCEF/BBERF.
## 4.5 PCC procedures over S9 Reference Point
### 4.5.1 General
In this release, there are two protocols running over the S9 interface: the S9
protocol and the Rx protocol.
\- The Rx protocol is working as specified in 3GPP TS 29.214 [5].
\- The S9 protocol is defined in clause 5 in this document. The S9 protocol
allows establishment, modification and termination of Diameter S9 sessions.
There is an S9 session per UE between each H-PCRF and V-PCRF pair. An S9
session can contain zero, one or several S9 subsessions. The S9 subsession
scope is per PDN connection. An S9 subsession can be established, modified and
terminated.
When the V-PCRF receives a request that should be sent to the HPLMN, the
V-PCRF places the information within a S9 subsession level if it only applies
to a particular PDN connection. Otherwise, the information is placed at S9
session level.
There are three distinct network scenarios for an IP-CAN as defined in 3GPP
TS.29.213 [4]:
1\. No Gateway Control session is needed. GTP is used for S5/S8 reference
points.
2\. Gateway Control session is needed. Two subcases can be distinguished:
> 2a) S2c reference point (and then DSMIPv6 protocol) is used by a trusted
> non-3GPP access to access the EPC.
>
> 2b) Trusted non-3GPP accesses that use S2a reference point (PMIPv6 or MIPv4
> protocol is used) or 3GPP access that uses PMIPv6 over S5/S8 reference
> points.
The S9 reference point is used for case 1 in VA scenario and, for cases 2a and
2b for both HR and VA scenarios.
NOTE: The cases described above are oftenly referred through the document as
cases 1, 2a or 2b.
#### 4.5.1.1 S9 Session Establishment
When the V-PCRF receives a CCR command with CC-Request-type AVP set to the
value "INITIAL_REQUEST" from the PCEF/BBERF that can not be associated with
any existing S9 session to the H-PCRF for that UE (based on the Subscription-
Id AVP), the V-PCRF shall establish a new S9 session according to the
procedures specified in clause 4.5.2.1 or 4.5.3.1 for home-routed and visited
access respectively.
NOTE: In a network scenario that deploys case 1 as defined in clause 4.5.1, S9
session is only needed in the visited access case and the procedures described
in clause 4.5.3 apply.
#### 4.5.1.2 S9 Session Termination
The V-PCRF shall initiate a termination of the S9 session when it receives a
trigger that originates the removal of the last existing S9 subsession
associated with the referred S9 session. The V-PCRF terminates the S9 session
following the procedures described in clause 4.5.2.3 or clause 4.5.3.3.
When the H-PCRF determines that the S9 session shall be terminated, the
procedures described in clause 4.5.2.4 and 4.5.3.4 apply.
NOTE: In a network scenario that deploys case 1 as defined in clause 4.5.1,
only the procedures described in clause 4.5.3 apply.
#### 4.5.1.3 Event Triggers
##### 4.5.1.3.1 Provisioning of Event Triggers
Provisioning of event triggers may be performed by either the V-PCRF or the
H-PCRF. The V-PCRF may receive requests to subscribe to event triggers from
the H-PCRF, from the PCEF (VA case) or due to an internal or other external
event. The H-PCRF may receive subscription request from the PCEF (i.e. In the
HR case, the H-PCRF derives the event triggers from the Event-Report-
Indication AVP from the PCEF), or due to an internal or external event (e.g.
due to an Rx interaction with the AF).
When the H-PCRF wants to subscribe or unsubscribe to event trigger(s) in the
VPLMN, the H-PCRF shall provide to the V-PCRF one or several event triggers by
including them within the Event-Trigger AVP. Event Triggers may apply to a
specific S9 Subsession(s) or to a specific S9 session. Event Triggers provided
for a specific S9 session apply to S9 subsession(s) within the specified S9
session.
\- When Event Triggers are provided for a specific S9 subsession(s), the
H-PCRF includes Subsession-Decision-Info AVP for each of the affected S9
subsession. Each Subsession-Decision-Info AVP includes the Subsession-Id AVP
and the list of event triggers within the Event-Trigger AVP.
\- When Event Triggers are provided for a specific S9 session(s), the H-PCRF
includes the list of event triggers within the Event-Trigger AVP at command
level.
The H-PCRF adds new event triggers or removes previously provided event
triggers to the V-PCRF by providing the new complete list of applicable event
triggers.
The H-PCRF may provision event triggers to the V-PCRF using both a RAR and a
CCA command. However, for the Home Routed case, the H-PCRF shall provision the
IP-CAN_CHANGE event trigger to the V-PCRF in the initial CCA command.
When the V-PCRF receives event triggers from the H-PCRF, the V-PCRF stores
them locally as S9-related and proceeds as follows:
 In both the Home-Routed and Visited Access cases, the V-PCRF shall provision
the event triggers over the associated Gxx session to the BBERF using the
Gateway Control and QoS Rules Provisioning or Gateway Control Session
Establishment procedure described in 3GPP TS 29.212 [3] clauses 4a.5.1 and
4a.5.2.
 Additionally, in the Visited Access case, the V-PCRF may also provision the
event triggers over the associated Gx session to the PCEF using the PCC Rule
Provisioning procedure described in in 3GPP TS 29.212 [3] clause 4.5.3.
For the Visited Access case, the H-PCRF may remove all previously provided
event triggers by providing the Event-Trigger AVP set to the value
NO_EVENT_TRIGGERS. The H-PCRF includes within the Subsession-Decision-Info AVP
the affected Subsession-Id AVP and the list of event triggers within the
Event-Trigger AVP. When an Event-Trigger AVP is provided with this value, no
other Event-Trigger AVP shall be provided in the CCA or RAR command. Upon
reception of an Event-Trigger AVP with this value from the H-PCRF, if there
are no other locally handled event triggers, the V-PCRF shall provide the
Event-Trigger AVP set to the value NO_EVENT_TRIGGERS to the BBERF and PCEF; if
there are locally handled event triggers, the V-PCRF shall update the event
triggers at the BBERF and the PCEF to remove those triggers previously
installed based on requests from the H-PCRF. The V-PCRF shall not inform
H-PCRF of any subsequent event except for those events that are always
subscribed with no provision.
When the PCEF in the Visited Access case subscribes or unsubscribes to one or
several event triggers with the V-PCRF, the V-PCRF stores them locally as Gx-
related events and then provision them over the associated Gxx session
(identified using the Gateway Control Session to IP-CAN session linking
procedure described in 3GPP TS 29.212 [3] clause 4a.5.6) to the BBERF using
the Gateway Control and QoS Rules Provisioning procedure described in 3GPP TS
29.212 [3] clause 4a.5.2.
The V-PCRF may also provision event triggers to the BBERF/PCEF due to an
internal or external trigger or using the Provisioning of Event Triggers
procedure as described in 3GPP TS 29.212 [3] clauses 4a.5.3 and clause 4.5.3.
##### 4.5.1.3.2 Reporting of deployed Event Triggers
The V-PCRF may receive a report of an event trigger that is deployed at the
BBERF or at the PCEF (VA case).
In the VA case, when the event trigger reported by the BBERF corresponds to a
Gx-related event trigger (i.e. a subscription from the PCEF), the V-PCRF
notifies the PCEF as described in 3GPP TS 29.212 [3] clause 4.5.2.1.
When the event trigger reported by the BBERF or the PCEF (in VA case)
corresponds to a S9-related (i.e. a subscription from the H-PCRF) event
trigger or is always reported even though the V-PCRF has not provisioned it
and the value is applicable for the S9 reference point as indicated in clause
5.4, the V-PCRF notifies the H-PCRF using the procedures as described in
clause 4.5.2.1 in home routed case or the PCC Rule Request procedure as
described in clause 4.5.3.1 for visited access case.
When the event trigger reported by the BBERF/PCEF corresponds to a V-AF-
related event trigger, the V-PCRF shall inform the V-AF using the RAR command
including the Specific-Action AVP as described in 3GPP TS 29.214 [5] clauses
4.4.6.1, 4.4.6.2 and 4.4.6.3.
#### 4.5.1.4 Multiple BBERF scenarios
The multiple BBERF scenarios happen when there is a change of BBERF and the
H-PCRF and the V-PCRF needs to handle more than one BBERF related with the
same IP-CAN session.
The V-PCRF shall follow the procedures defined in clauses 4.5.2.5 and 4.5.3.5
respectively for the home routed and visited access cases.
#### 4.5.1.5 Provisioning and validation of Default EPS Bearer authorized QoS
The default EPS Bearer QoS handling only applies to case 2b in HR scenario,
and case 1, case 2a and case 2b in the VA scenario.
For IP-CAN types that support multiple IP-CAN bearers, the V-PCRF may provide
the Default-EPS-Bearer-QoS AVP in the Subsession-Enforcement-Info AVP within
the CCR command to the H-PCRF.
The H-PCRF may provision the authorized QoS for the default EPS bearer within
the corresponding S9 subsession in the CCA command including the Subsession-
Decision-Info AVP for the S9 subsession within the S9 session. The S9
Subsession-Decision-Info AVP contains the Default-EPS-Bearer-QoS AVP.
Besides the H-PCRF may provision the authorized QoS for the default EPS bearer
without receiving a request from the V-PCRF, e.g. in response to an internal
trigger within the H-PCRF or upon interaction with the SPR. The H-PCRF shall
send a RAR command including the Subsession-Decision-Info AVP with the
Default-EPS-Bearer-QoS AVP for the S9 subsession within the S9 session.
The V-PCRF shall validate the Default-EPS-Bearer-QoS AVP in case it is
received in the CCA or RAR command.
If the QoS validation fails and there is a default EPS bearer QoS value
already authorized for that IP-CAN session, the V-PCRF shall retain the
existing default EPS bearer QoS without any modification and reject the
request using a CCR/RAA command respectively to the H-PCRF. The CCR/RAA shall
include the Subsession-Enforcement-Info AVP for the affected S9 subsession
that includes the S9 subsession identifier within the Subsession-Id AVP, the
Default-EPS-Bearer-QoS AVP to indicate the retained value, and the Event
Trigger set to DEFAULT-EPS-BEARER-QOS_MODIFICATION_FAILURE.
If the QoS validation fails as part of the IP-CAN session establishment
procedure, the V-PCRF shall derive the acceptable default EPS bearer QoS based
on operator policies and reject the request using a CCR command to the H-PCRF.
The CCR shall include the Subsession-Enforcement-Info AVP for the affected S9
subsession that includes the S9 subsession identifier within the Subsession-Id
AVP, the Default-EPS-Bearer-QoS AVP to indicate the acceptable value, and the
Event Trigger set to DEFAULT-EPS-BEARER-QOS_MODIFICATION_FAILURE.
The H-PCRF may provide back an acceptable default EPS bearer QoS or may reject
the request. If the H-PCRF rejects the request the V-PCRF shall reject the
corresponding request from the PCEF/BBERF.
Upon reception of the subsequent CCA command, if the procedure was initiated
by the PCEF/BBERF and default EPS bearer QoS is acceptable, the V-PCRF shall
provide the negotiated default EPS bearer QoS in the response to the
PCEF/BBERF.
NOTE: In order to avoid loops in the QoS negotiation process, it is
recommended that the H-PCRF provides a default EPS bearer QoS acceptable by
the Visited Network.
#### 4.5.1.6 Provisioning of Authorized QoS per APN
The Authorized QoS per APN handling only applies to case 2b in HR scenario,
and case 1, case 2a and case 2b in the VA scenario.
At S9 Session/Subsession Establishment/Modification, the V-PCRF may include
the APN-AMBR (if received from the BBERF for case 2b or PCEF for case 1 and
case 2a in VA scenario) in the QoS-Information AVP of the Subsession-
Enforcement-Info AVP, using the APN-Aggregate-Max-Bitrate-UL AVP and/or the
APN-Aggregate-Max-Bitrate-DL AVP within the CCR command to the H-PCRF.
Upon receiving the subscribed APN-AMBR from the V-PCRF, the H-PCRF shall
provision the authorized QoS per APN within the CCA command. The authorized
QoS per APN shall be provisioned in the QoS-Information AVP of Subsession-
Decision-Info AVP, using the APN-Aggregate-Max-Bitrate-UL AVP and/or the APN-
Aggregate-Max-Bitrate-DL AVP. When APN-Aggregate-Max-Bitrate-UL AVP and/or the
APN-Aggregate-Max-Bitrate-DL AVP are provided, the Max-Requested-Bandwidth
values, and the Guaranteed-Bitrate values shall not be included.
Besides the H-PCRF may provision the authorized APN-AMBR without receiving a
request from the V-PCRF, e.g. in response to an internal trigger within the
H-PCRF or upon interaction with the SPR. The H-PCRF shall send a RAR command
including the Subsession-Decision-Info AVP with the QoS-Information AVP for
the S9 subsession.If the APN-AMBR is changed, the H-PCRF shall provision the
authorized APN-AMBR for each IP-CAN session for that APN by including the
Subsession-Decision-Info AVP with the QoS-Information AVP for each affected S9
subsession.
The V-PCRF shall validate the APN-AMBR in case it is received in the CCA or
RAR command. If the QoS validation fails and there is an APN-AMBR value
already authorized for that IP-CAN session, the V-PCRF shall retain the
existing APN-AMBR without any modification and reject the request using a
CCR/RAA command respectively to the H-PCRF. The CCR/RAA shall include the
Subsession-Enforcement-Info AVP for the affected S9 subsession that includes
the S9 subsession identifier within the Subsession-Id AVP, the QoS-Information
AVP to indicate the retained value, and the Event Trigger set to APN-
AMBR_MODIFICATION_FAILURE.
If the QoS validation fails as part of the IP-CAN session establishment
procedure, the V-PCRF shall derive the acceptable APN-AMBR based on operator
policies and reject the request using a CCR command to the H-PCRF. The CCR
shall include the Subsession-Enforcement-Info AVP for the affected S9
subsession that includes the S9 subsession identifier within the Subsession-Id
AVP, the QoS_Information AVP to indicate the acceptable value, and the Event
Trigger set to APN-AMBR_MODIFICATION_FAILURE.
The H-PCRF may provide back an acceptable APN-AMBR or may reject the request.
If the H-PCRF rejects the request the V-PCRF shall reject the corresponding
request from the PCEF/BBERF.
Upon reception of the subsequent CCA command, if the procedure was initiated
by the PCEF/BBERF and the APN-AMBR is acceptable, the V-PCRF shall provide the
negotiated APN-AMBR in the response to the PCEF/BBERF.
NOTE: In order to avoid loops in the QoS negotiation process, it is
recommended that the H-PCRF provides an APN-AMBR acceptable by the Visited
Network.
#### 4.5.1.7 Bearer Control Mode Selection
The H-PCRF derives the selected bearer control mode based on the received
Network-Request-Support AVP, access network information, subscriber
information and operator policy.
\- If the bearer control mode that H-PCRF derives is applicable for the S9
session of the user, the H-PCRF includes the bearer control mode within
Bearer-Control-Mode AVP at the command level.
\- If the bearer control mode that H-PCRF derives is applicable for a specific
IP-CAN session, the H-PCRF includes the Subsession-Decision-Info AVP for the
affected S9 subsession corresponding to the IP-CAN session. The subsession-
Decision-Info AVP includes allocated S9 subsession identifier within the
Subsesssion-Id AVP and the bearer control mode within the Bearer-Control-Mode
AVP.
### 4.5.2 Home-Routed access
#### 4.5.2.1 S9 Session/Subsession establishment/modification
The V-PCRF interacts with the H-PCRF in the following instances:
  1. Upon Gateway Control Session establishment over Gxx:
When the V-PCRF receives a CCR command with a CC-Request-Type AVP set to
"INITIAL_REQUEST" from the BBERF over Gxx, the V-PCRF determines whether case
2a or case 2b applies as defined in 3GPP TS 29.213 [4] and applies the
following procedures apply:
\- If case 2a applies,
\- If there is not an already established S9 session for this roaming user,
the V-PCRF shall send to the H-PCRF a CCR command with the CC-Request-Type AVP
set to the value "INITIAL_REQUEST" to establish a new S9 session. The CCR
command from the V-PCRF to the H-PCRF shall include those attributes provided
by the BBERF to the V-PCRF at the Diameter CCR command level, defined in
clause 4a.5.1 of 3GPP TS 29.212 [3].
\- Otherwise, if there is an already established S9 session for this roaming
user, the procedures in clause 4.5.2.5 shall be applied.
\- If case 2b applies,
\- If there is not an already established S9 session for this roaming user,
the V-PCRF shall send to the H-PCRF a CCR command with the CC-Request-Type AVP
set to the value "INITIAL_REQUEST" to establish a new S9 session. The V-PCRF
shall include the Subsession-Enforcement-Info AVP within the CCR command with
a new S9 subsession identifier assigned by the V-PCRF within the Subsession-Id
AVP, the Subsession-Operation AVP set to the value "ESTABLISHMENT". The V-PCRF
shall map the Gxx session-id(s) to the corresponding subsession-id(s) in the
S9 session. In addition, the V-PCRF shall include those attributes provided by
the BBERF that allows the H-PCRF to identify the Subsession as defined in 3GPP
TS 29.212 [3].
\- If an existing S9 session for the roaming user is already established with
the H-PCRF, the V-PCRF shall update the existing session by sending a CCR with
the CC-Request-Type AVP set to the value "UPDATE_REQUEST" to the H-PCRF.
\- If an S9 subsession does not exist for the PDN connection corresponding to
the gateway control session establishment, the V-PCRF shall include the
Subsession-Enforcement-Info AVP within the CCR command with a new S9
subsession identifier assigned by the V-PCRF within the Subsession-Id AVP, the
Subsession-Operation AVP set to the value "ESTABLISHMENT". The V-PCRF shall
map the Gxx session-id(s) to the corresponding subsession-id(s) in the S9
session.
\- In all cases, the CCR command from the V-PCRF to the H-PCRF shall include,
at subsession level, those attributes provided by the BBERF to the V-PCRF, as
defined in clause 4a.5.1 of 3GPP TS 29.212 [3].
\- If the V-PCRF detects that an S9 subsession already exists for a particular
PDN connection linked to a different gateway control session (i.e. different
Gxx session-id), the V-PCRF shall follow the procedures in clause 4.5.2.5.
2) Upon Gateway Control Session modification over Gxx by receiving a Gateway
Control and QoS rules request
If the V-PCRF receives a CCR command with a CC-Request-Type AVP set to
"UPDATE_REQUEST" from the BBERF over Gxx, the V-PCRF shall send a CCR command
with a CC-Request-Type AVP set to "UPDATE_REQUEST" to the H-PCRF including the
updated information.
In case 2a, the V-PCRF shall include the attributes provided by the BBERF at
the CCR command level.
In case 2b, the V-PCRF shall modify the corresponding S9 subsession by
including the Subsession-Enforcement-Info AVP within the CCR command that
contains the allocated S9 subsession identifier within the Subsession-Id AVP,
the Subsession-Operation AVP set to the value "MODIFICATION". In addition, the
V-PCRF shall provide the Subsession-Id AVP to allow the H-PCRF to identify the
subsession for which QoS Rules are requested. The V-PCRF shall include the
attributes provided by the BBERF within the Subsession-Enforcement-Info AVP.
> If the V-PCRF receives a CCR command with a CC-Request-Type AVP set to
> "UPDATE_REQUEST" and the Event-Trigger AVP set to
> "RESOURCE_MODIFICATION_REQUEST", the V-PCRF may validate the QoS in the
> request. If the QoS validation fails, the V-PCRF shall reply to the BBERF
> over Gxx with a CCA command including the Gx experimental result code
> DIAMETER_ERROR_INITIAL_PARAMETERS.
The QoS rules are provisioned by the H-PCRF as follows:
\- In case 2a, the H-PCRF shall provision QoS Rules in the CCA command by the
QoS-Rule-Install AVP at the command level.
\- In case 2b, the H-PCRF shall provision QoS Rules within the corresponding
S9 subsession by issuing the CCA command and including the Subsession-
Decision-Info AVP for the S9 subsession within the S9 session. Each S9
Subsession-Decision-Info AVP contains the QoS-Rule-Install AVP.
If the H-PCRF is, due to incomplete, erroneous or missing information (e.g.
subscription related information not available or authorized QoS exceeding the
subscribed bandwidth) not able to:
1) Provision a policy decision to a specific subsession as response to the
request sent by the V-PCRF, the H-PCRF shall send a CCA command including the
Experimental-Result AVP at the command level with the Experimental-Result-Code
AVP set to DIAMETER_ERROR_SUBSESSION (5470), including the Subsession-
Decision-Info AVP with the rejected Subsession-Id(s) within the Subsession-Id
AVP and the appropriate error within either the Experimental-Result-Code AVP
or Result-Code AVP.
2) Provision a policy decision to any of the S9 subsession(s) or provision a
policy decision at the command level, the H-PCRF shall reject the request
using a CCA command with the DIAMETER_ERROR_INITIAL_PARAMETERS (5140) within
the Experimental-Result-Code AVP.
When the V-PCRF receives a CCA command where S9 specific subsession(s) contain
a specific Result-Code or Experimental-Result-Code AVP from the H-PCRF, the
V-PCRF shall reply to the BBERF over the respective Gxx with a CCA command
including the same result code.
When the V-PCRF receives a CCA command with an error code within the
Experimental-Result-Code AVP or Result-Code AVP at the command level, the
V-PCRF shall reply to the BBERF over the respective Gxx interface with a CCA
command including the same result code.
The V-PCRF shall validate the QoS Rules contained in the CCA. If the QoS
validation fails the V-PCRF shall perform the following:
1) Send a CCR command to the H-PCRF with the CC-Request-Type AVP set to
"UPDATE_REQEST" and
a) In case 2a, include the QoS-Rule-Report AVP to indicate the QoS Rules that
were not accepted, including Rule-Failure-Code AVP set to
UNSUCCESSFUL_QOS_VALIDATION value and the QoS-Information AVP to indicate the
acceptable QoS.
b) In case 2b, include the QoS-Rule-Report AVP within the Subsession-
Enforcement-Info AVP to indicate the QoS Rules that were not accepted,
including Rule-Failure-Code AVP set to UNSUCCESSFUL_QOS_VALIDATION value and
the QoS-Information AVP to indicate the acceptable QoS. The V-PCRF shall
include the S9 subsession specific information within the CCR command that
includes the S9 subsession identifier within the Subsession-Id AVP.
> 2) Upon reception of the subsequent CCA command from the H-PCRF, the V-PCRF
> shall reply to the BBERF over Gxx with a CCA command. If the validation of
> the answer from the H-PCRF is successful, the V-PCRF shall include the
> acceptable QoS in the QoS rules. Otherwise, the V-PCRF shall reply to the
> BBERF over Gxx with a CCA command including the Gx experimental result code
> DIAMETER_ERROR_INITIAL_PARAMETERS.
NOTE: In order to avoid loops in the QoS negotiation process, it is
recommended that the H-PCRF provides a QoS acceptable by the Visited Network.
#### 4.5.2.2 Provision of QoS Rules by the H-PCRF
The H-PCRF may decide to provision QoS Rules without obtaining a request from
the V-PCRF, e.g. in response to information provided to the H-PCRF via the Rx
reference point, or in response to an internal trigger within the H-PCRF, or
from a trigger by the SPR. The H-PCRF may also decide to provision QoS rules
in response to a request for PCC Rules received by the H-PCRF from the PCEF
that is linked with a former Gateway Control session establishment.
To provision QoS Rules without a request from the V-PCRF, the H-PCRF shall do
the following:
\- In case 2a, send a RAR command including the QoS rules to be provisioned
within the QoS-Rule-Install AVP at the command level.
\- In case 2b, send a RAR command including the Subsession-Decision-Info AVP
for each of the S9 subsessions within the S9 session. Each Subsession-
Decision-Info AVP contains the QoS rules to be provisioned within the QoS-
Rule-Install AVPs.
The V-PCRF shall validate the QoS Rules contained within each S9 subsession
within the RAR command.
If the QoS validation fails the V-PCRF shall send a reject in the RAA command
to the H-PCRF. The V-PCRF includes:
\- In case 2a, a DIAMETER_PCC_RULE_EVENT (5142) experimental result code, the
QoS-Rule-Report AVP to indicate the QoS Rules that were not accepted,
including Rule-Failure-Code AVP set to UNSUCCESSFUL_QOS_VALIDATION value and
the QoS-Information AVP to indicate the acceptable QoS.
\- In case 2b, the Subsession-Enforcement-Info AVP for each rejected S9
subsession. The Subsession-Enforcement-Info AVP with the rejected Subsession-
Id(s) and a DIAMETER_PCC_RULE_EVENT (5142) experimental result code, including
the QoS-Rule-Report AVP to indicate the QoS Rules that were not accepted,
including Rule-Failure-Code AVP set to UNSUCCESSFUL_QOS_VALIDATION value and
the QoS-Information AVP to indicate the acceptable QoS.
If the QoS validation succeeds, the V-PCRF shall initiate the Gateway Control
and QoS Rules Provision procedure over Gxx as defined in 3GPP TS 29.212 [3] by
sending an RAR command to the BBERF including the parameters from the RAR
command received from the H-PCRF. When the V-PCRF receives the RAA from the
BBERF(s), the V-PCRF responds to the H-PCRF as follows:
\- in case 2a, the V-PCRF shall send a corresponding RAA command to the H-PCRF
including the corresponding result code.
\- in case 2b, the V-PCRF shall send a corresponding RAA command to the H-PCRF
including the S9 Subsession-Enforcement-Info AVP for each specific S9
subsession with the corresponding result code.
#### 4.5.2.3 S9 Session/Subsession Termination Initiated by the V-PCRF
This procedure is triggered by a Gateway Control Session Termination procedure
over Gxx interface. When the V-PCRF receives a CCR command with a CC-Request-
Type AVP set to "TERMINATION_REQUEST" from the BBERF over Gxx, it shall
acknowledge this message by sending the CCA command to the BBERF as defined in
3GPP TS 29.212 [3]. If in addition to the Gateway Control Session being
terminated, one or more Gateway Control Sessions corresponding to the PDN
connection for case 2b or to the user for case 2a exist the V-PCRF shall
follow the procedures for Multiple BBERF Handling described in clause 4.5.2.5;
otherwise the V-PCRF shall do the following:
  1. Terminate the S9 session, if as a consequence of the Gateway Control Session Termination over Gxx, the last S9 subsession for that roaming user is terminated. In order to do that, the V-PCRF shall terminate the related S9 session by sending a CCR command with a CC-Request-Type AVP set to "TERMINATE_REQUEST" to the H-PCRF.
> When the H-PCRF receives the CCR, it shall acknowledge this message by
> sending a CCA to the V-PCRF.
2) Update the S9 session, if there are remaining S9 subsessions for the
roaming user. The V-PCRF shall modify the related S9 session by sending a CCR
with a CC-Request-Type AVP set to "UPDATE_REQUEST" to the H-PCRF. The V-PCRF
shall include in the CCR the Subsession-Enforcement-Info and set the
Subsession-Operation AVP to "TERMINATION" for each S9 subsession of a
particular UE that is terminated.
When the H-PCRF receives the CCR, it shall acknowledge this message by sending
a CCA to the V-PCRF. The H-PCRF shall include the Subsession-Decision-Info AVP
within the CCA command with the removed Subsession-Id AVP and the Result-Code
AVP.
On receipt of the CCA command, the V-PCRF shall remove the session information
stored for that Gateway Control Session.
#### 4.5.2.4 S9 Session/Subsession Termination Initiated by the H-PCRF
The H-PCRF may request the termination of a S9 session/subsession to the
V-PCRF.
The H-PCRF decides to terminate a S9 session/subsession due to an internal
trigger or trigger from the SPR. The following cases can be distinguished:
\- If the H-PCRF considers that the S9 session has to be terminated, the
H-PCRF shall send an RAR command to the V-PCRF indicating the termination of
the S9 session by including the Session-Release-Cause AVP at command level.
The V-PCRF shall send a corresponding RAA command to the H-PCRF.
\- If the H-PCRF considers that the S9 subsession has to be terminated, the
H-PCRF shall send an RAR command to the V-PCRF indicating the termination of
the S9 subsession by including the Session-Release-Cause AVP within the
Subsession-Decision-Info AVP. When the V-PCRF receives the RAR command it
shall answer it by issuing the corresponding RAA command.
The V-PCRF shall trigger the termination of the corresponding Gateway Control
session(s) over Gxx interface by applying the Request of Gateway Control
session termination procedures as defined in 3GPP TS 29.212 [3] clause 4a.5.4.
#### 4.5.2.5 Multiple BBERF Handling
The H-PCRF distinguishes two types of BBERFs: primary and non-primary
according to 3GPP TS 29.212 [3]. The V-PCRF interacts with the H-PCRF in the
following instances:
  1. Upon Gateway Control Session establishment over Gxx:
When the V-PCRF has received a CCR for Gateway Control Session Establishment
from a new BBERF that is related with an existing gateway control session, the
V-PCRF modifies the S9 session by sending a CCR command to inform the H-PCRF
of the new Gateway Control Session. The V-PCRF shall include the Multiple-
BBERF-Action AVP set to the value "ESTABLISHMENT" and the AN-GW-Address AVP to
distinguish the information from the new BBERF and to allow the H-PCRF
operating on any of the BBERF separately.
\- If case 2a applies, the Multiple-BBERF-Action AVP and the AN-GW-Address AVP
are included at command level.
\- If case 2b applies, the Multiple-BBERF-Action AVP and the AN-GW-Address AVP
are included in the Subsession-Enforcement-Info AVP that contains the
allocated S9 subsession identifier within the Subsession-Id AVP and the
Subsession-Operation AVP set to the value "MODIFICATION".
When the H-PCRF receives the CCR command, the H-PCRF shall apply the
procedures defined in 3GPP TS 29.212 [3] to detect if the new BBERF is primary
or not and will act accordingly by answering with a CCA command. Within the
CCA command the H-PCRF may include new decisions at either the command level
for case 2a or at the subsession level for case 2b for the affected BBERF.
If the same changes are applied to all BBERFs, the H-PCRF shall not include
AN-GW-Address AVP within the CCA command. If different decisions are applied
to different BBERFs, the H-PCRF shall include, in the CCA command, the AN-GW-
Address AVP that was included in the CCR command and the associated QoS rules
and event triggers for that BBERF. The H-PCRF shall provide the updated QoS
rules and event triggers to the remaining BBERF(s) within RAR command(s) by
initiating the QoS rule provision procedure for each of the remaining
BBERF(s). In each RAR command, the H-PCRF shall include the AN-GW-Address AVP
in order to identify the target BBERF.
2) Upon Gateway Control Session modification over Gxx:
When the V-PCRF receives a CCR command from any of the BBERFs for Gateway
Control Session modification, the V-PCRF shall follow the same procedures as
described above for Gateway Control Session Establishment case and include AN-
GW-Address AVP within the CCR command to the H-PCRF. The H-PCRF also follows
the same procedures in determining whether to include AN-GW-Address AVP or not
in the CCA command.
3) Upon QoS rule provisioning:
When provisioning different QoS rules, the H-PCRF shall include the different
QoS rules within separate RAR commands, and shall also include the AN-GW-
Address AVP with the value set to the BBERF address to indicate the actual
BBERF where the rules are to be applied. The H-PCRF may also include
subscription for any event trigger by including the Event-Trigger AVP with the
corresponding value. For case 2a, the AN-GW-Address AVP is included at the
command level; for case 2b, the AN-GW-Address AVP is included at the
subsession level.
When provisioning the same QoS rules to all the BBERFs, the H-PCRF shall
include the QoS rules within the same RAR command without including the AN-GW-
Address AVP.
> 4) Upon Gateway Control Session termination over Gxx:
>
> When the V-PCRF receives a CCR command from any of the BBERFs for Gateway
> Control Session Termination, the V-PCRF shall modify the S9 session by
> sending CCR command to inform the H-PCRF the Gateway Control Session
> terminated. The V-PCRF shall include the Multiple-BBERF-Action AVP set to
> the value "TERMINATION" and the AN-GW-Address AVP to identify the BBERF
> initiating the termination.
\- For case 2a, the Multiple-BBERF-Action AVP and the AN-GW-Address AVP are
included at the command level.
\- For case 2b, the Multiple-BBERF-Action AVP and the AN-GW-Address AVP are
included in the Subsession-Enforcement-Info AVP that contains the allocated S9
subsession identifier within the Subsession-Id AVP and the Subsession-
Operation AVP set to the value "MODIFICATION".
When the H-PCRF receives the CCR command, the H-PCRF shall delete the QoS
rules related to the BBERF identified by the AN-GW-Address AVP.
NOTE: For case 2b the old BBERF always initiates the termination of the
Gateway Control Session.
> 5) Upon Request of Gateway Control Session Termination:
>
> When the H-PCRF decides to request the termination of a Gateway Control
> Session in the VPLMN for case 2a, the H-PCRF shall send an RAR command to
> request the V-PCRF terminated the Gateway Control session. The H-PCRF shall
> include the Multiple-BBERF-Action AVP set to the value "TERMINATION" and the
> AN-GW-Address AVP to identify the BBERF corresponding to the Gateway Control
> Session at the command level. The V-PCRF acknowledges this request by
> sending the RAA command.
>
> The V-PCRF shall trigger the termination of the corresponding Gateway
> Control session(s) over Gxx interface by applying the Request of Gateway
> Control session termination procedures as defined in 3GPP TS 29.212 [3]
> clause 4a.5.4. Then the V-PCRF shall apply the procedure "Upon Gateway
> Control Session termination over Gxx" in this clause.
#### 4.5.2.6 Deferred Session Linking Handling
This procedure takes place at Initial IP-CAN Session Establishment and during
the inter-system BBERF relocation for case 2b.
NOTE: The deferred leg linking indication assists the PCRF to avoid linking
the Gateway Control Session with an obsolete Gx Session at initial IP-CAN
Session Establishment.
When the V-PCRF receives a CCR for Gateway Control Session Establishment
including Session-Linking-Indicator AVP set to the value
"SESSION_LINKING_DEFERRED" from a new BBERF related with an existing Gateway
Control session (i.e. the new Gateway Control session has the same values in
the Subscription-Id AVP and Called-Station-Id AVP as the existing Gateway
Control session), the V-PCRF shall establish a new S9 subsession by sending a
CCR command including the Subsession-Enforcement-Info AVP with a new S9
subsession identifier assigned by the V-PCRF within the Subsession-Id AVP, the
Subsession-Operation AVP set to the value "ESTABLISHMENT" and the Session-
Linking-Indicator AVP set to the value "SESSION_LINKING_DEFERRED". The V-PCRF
shall keep the mapping between the new Gateway Control session and the new S9
subsession.
After the H-PCRF receives the CCR command as described above from the V-PCRF,
the H-PCRF applies the same deferred session linking procedure as described in
clause 4a.5.6 of 3GPP TS 29.212 except that the Gateway Control Session is
replaced by the S9 subsession.
#### 4.5.2.7 Session Linking Handling When Multiple PDN Connection to a single
APN is supported
This procedure takes place in case 2b.
When the V-PCRF receives a CCR for Gateway Control Session Establishment with
the PDN Connection ID included in the PDN-Connection-ID AVP in addition to the
user identity included in Subscription-Id AVP and the PDN ID included in
Called-Station-Id AVP, the following procedures are applied:
\- If there is not an already established S9 session for this roaming user,
the V-PCRF shall send to the H-PCRF a CCR command with the CC-Request-Type set
to the value "INITIAL_REQUEST" to establish a new S9 session. The V-PCRF shall
include the Subsession-Enforcement-Info AVP within the CCR command with a new
S9 subsession identifier assigned by the V-PCRF within the Subsession-Id AVP,
PDN Connection ID within the PDN-Connection-ID AVP, the user identity within
the Subscription-Id AVP, the PDN ID within the Called-Station-Id AVP and the
Subsession-Operation AVP set to the value "ESTABLISHMENT". The V-PCRF shall
keep the mapping between new Gateway Control Session and the new S9
subsession. When the H-PCRF receives the CCR for IP-CAN Session Establishment
from the PCEF that has the same values in the Subscription-Id AVP, Called-
Station-Id AVP and PDN-Connection-ID AVP as the new S9 subsession, the H-PCRF
shall link the Gx session with the new S9 subsession.
\- If an existing S9 session for the roaming user is already established and
if no Gateway Control Session for the same PDN ID exists or at least one
Gateway Contro Session for same PDN ID exists but the IP-CAN type received in
the the CCR command has not been modified, the V-PCRF sends a CCR command to
the H-PCRF to establish a new S9 subsession by including the Subsession-
Enforcement-Info AVP that contains a new S9 subsession identifier within the
Subsession-Id AVP, PDN Connection ID within the PDN-Connection-ID AVP, the
user identity within the Subscription-Id AVP, the PDN ID within the Called-
Station-Id AVP and the Subession-Operation AVP set to the value
"ESTABLISHMENT". The V-PCRF shall keep the mapping between new Gateway Control
Session and the new S9 subsession. When the H-PCRF receives the CCR for IP-CAN
Session Establishment from the PCEF that has the same values in the
Subscription-Id AVP, Called-Station-Id AVP and PDN-Connection-ID AVP as the
new S9 subsession, the H-PCRF shall link the Gx session with the new S9
subsession.
\- If at least one Gateway Control Session for same PDN ID exists and the IP-
CAN type received in the CCR command has been modified, the V-PCRF assumes
that this constitutes an inter-system BBERF relocation. The V-PCRF sends a CCR
command to the H-PCRF to establish a new S9 subsession by including the
Subsession-Enforcement-Info AVP that contains a new S9 subsession identifier
within the Subsession-Id AVP, PDN Connection ID within the PDN-Connection-ID
AVP, the user identity within the Subscription-Id AVP, the PDN ID within the
Called-Station-Id AVP and the Subession-Operation AVP set to the value
"ESTABLISHMENT". The V-PCRF shall keep the mapping between the new Gateway
Control Session and the new S9 subsession. When the H-PCRF receives the CCR
for IP-CAN Session Modification from the PCEF that has the same values in the
Subscription-Id AVP, Called-Station-Id AVP and PDN-Connection-ID AVP as the
new S9 subsession, the H-PCRF shall link the Gx session with the new S9
subsession.
### 4.5.3 Visited Access
#### 4.5.3.1 Request PCC and QoS Rules
The V-PCRF shall request for PCC or QoS rules from the H-PCRF in the following
instances:
1) A Diameter CCR command as defined in clause 4.5.1 of 3GPP TS 29.212 [3] is
received by the V-PCRF from the PCEF requesting PCC Rules for a roaming user
and/or informing that an installed event trigger has been detected in this
case the affected PCC Rules are included by the PCEF.
2) A Diameter CCR command as defined in clause 4a.5.1 of 3GPP TS 29.212 [3] is
received by the V-PCRF from the BBERF requesting QoS Rules for a roaming user
and/or informing that an installed event trigger has been detected in this
case the affected QoS Rules are included by the BBERF. The procedures within
clause 4.5.3.5 shall be applied if during a multiple BBERF scenario the
request is coming from a non-primary BBERF.
If the CCR command also includes the Event-Trigger AVP set to
"RESOURCE_MODIFICATION_REQUEST", the V-PCRF may validate the QoS in the
request. If the QoS validation fails, the V-PCRF shall reply to the PCEF/BBERF
over Gx/Gxx with a CCA command including the Gx experimental result code
DIAMETER_ERROR_INITIAL_PARAMETERS. Otherwise, the V-PCRF shall store the
information received in the CCR command from the BBERF/PCEF and send a new
request over S9 as follows:
\- If an existing S9 session for the roaming user does not already exist with
the H-PCRF, the V-PCRF shall establish a new S9 session with the H-PCRF by
sending a CCR command with the CC-Request-Type AVP set to the value
"INITIAL_REQUEST", to the H-PCRF.
\- If an existing S9 session for the roaming user is already established with
the H-PCRF, the V-PCRF shall update the existing session by sending a CCR
command with the CC-Request-Type AVP set to the value "UPDATE_REQUEST" to the
H-PCRF.
The V-PCRF shall include within the CCR command those attributes provided by
the BBERF and PCEF as defined in clause 4a.5.1 and 4.5.1 of 3GPP TS 29.212 [3]
respectively.
\- In case 2a if the original CCR command is received from the BBERF, the
V-PCRF shall include the attributes provided by the BBERF at the Diameter CCR
command level. If the original CCR command is received from the PCEF, the
V-PCRF shall include the attributes provided by the PCEF at the S9 subsession
level by including the Subsession-Enforcement-Info AVP with the corresponding
Subsession-Id AVP.
\- In case 1 or case 2b, the V-PCRF shall refer the request to the
corresponding S9 subsession by including, within the CCR command the
Subsession-Enforcement-Info AVP with the corresponding Subsession-Id AVP and
shall also include those attributes provided by the BBERF (for case 2b)/PCEF
(for case 1).
For case 1, case 2a and case 2b,
\- If new subsessions are created the V-PCRF shall include within the
Subsession-Enforcement-Info AVP, the Subsession-Id AVP set to the value of a
new subsession identifier, the Subsession-Operation AVP set to the value
"ESTABLISHMENT". For case 1, the V-PCRF shall map the Gx session-id(s) to the
corresponding subsession-id(s) in the S9 session. For case 2a and case 2b, the
V-PCRF shall map the Gxx and Gx session-id(s) to the corresponding subsession-
id(s) in the S9 session.
NOTE: For case 2a, a new subsession will be created only when the original
received Diameter CCR from the PCEF indicates an establishment request for a
new Gx session. This is applicable also to case 2b although alternatively, the
new subsession might be created upon the reception of the gateway control
session establishment and be further modified when the corresponding IP-CAN
session establishment arrives to the V-PCRF.
\- If already existing subsessions are modified the V-PCRF shall set the
Subsession-Operation AVP value within the Subsession-Enforcement-Info AVP to
"MODIFICATION".
If the H-PCRF is, due to incomplete, erroneous or missing information (e.g.
subscription related information not available or authorized QoS exceeding the
subscribed bandwidth) not able to:
1) Provision a policy decision to one or more of the S9 subsession(s) within
the CCR command sent by the V-PCRF, the H-PCRF shall send a CCA command
including the S9 specific experimental result code DIAMETER_ERROR_SUBSESSION
(5470) at the command level. For each of the rejected subsessions, the H-PCRF
shall include the Subsession-Decision-Info AVP with the rejected Subsession-Id
within the Subsession-Id AVP and the appropriate error code within either the
Experimental-Result-Code AVP or Result-Code AVP. For each of the successful
subsessions, the H-PCRF shall include the Subsession-Decision-Info AVP with
the corresponding Subsession-Id AVP and any PCC rules to be provisioned.
2) Provision a policy decision to a CCR command sent by the V-PCRF with no S9
subsession information, the H-PCRF shall reject the request using a CCA
command with the DIAMETER_ERROR_INITIAL_PARAMETERS (5140) within the
Experimental-Result-Code AVP.
NOTE: CCR command with no subsession information is only used in case 2a.
When the V-PCRF receives a CCA command with an error code within the
Experimental-Result-Code AVP or Result-Code AVP at the command level, the
V-PCRF shall reply to the BBERF over the corresponding gateway control session
with a CCA command including the same result code.
When the V-PCRF receives a CCA command including QoS rules at command level,
with no subsession information and indicating success status at the command
level, the V-PCRF shall validate the QoS rules contained in the CCA. If the
QoS validation fails the V-PCRF shall send a CCR command to the H-PCRF
including the QoS-Rule-Report AVP to indicate the QoS Rules that were not
accepted, the Rule-Failure-Code AVP set to UNSUCCESSFUL_QOS_VALIDATION and the
QoS-Information AVP to indicate the acceptable QoS. Upon reception of the
subsequent CCA command from the H-PCRF, the V-PCRF shall reply to the BBERF
over Gxx with a CCA command. If the validation of the answer from the H-PCRF
is successful, the V-PCRF shall include the acceptable QoS in the QoS rules.
Otherwise, the V-PCRF shall reply to the BBERF over Gxx with a CCA command
including the Gx experimental result code DIAMETER_ERROR_INITIAL_PARAMETERS.
NOTE: In order to avoid loops in the QoS negotiation process, it is
recommended that the H-PCRF provides a QoS acceptable by the Visited Network.
When the V-PCRF receives a CCA command including QoS rules at command level,
with no subsession information and indicating success status at the command
level and if the QoS validation is successful, the V-PCRF shall follow the
procedures described in 3GPP TS 29.212 [3] to provision the QoS rules to the
BBERF. If after provisioning the QoS rules to the BBERF, the V-PCRF receives a
notification from the BBERF informing that an operation on one or more QoS
rule has failed, the V-PCRF shall immediately inform the H-PCRF. The V-PCRF
shall send a CCR command with the CC-Request-Type AVP set to the value
UPDATE_REQUEST to the H-PCRF including the QoS-Rule-Report AVP to indicate the
QoS rules that were affected at the command level. The H-PCRF may decide to
reinstall, modify or remove the affected QoS rules as described in this clause
or terminate the S9 session/subsession as described in clause 4.5.3.4.
When the V-PCRF receives a CCA command where the S9 specific subsession
contains a specific error code within a Result-Code or Experimental-Result-
Code AVP from the H-PCRF, the V-PCRF shall inform the trigger(s) of the
related CCR command (i.e. BBERF and/or PCEF) with a CCA command including the
same result code.
When the V-PCRF receives a CCA command where the S9 specific subsession
indicates success status, the V-PCRF shall validate the PCC rules contained in
the CCA. If the validation fails, the V-PCRF shall send a CCR command to the
H-PCRF including Subsession-Enforcement-Info AVP with the corresponding
Subsession-Id and include the Charging-Rule-Report AVP to indicate the PCC
Rules that were not accepted, the Rule-Failure-Code AVP set to
UNSUCCESSFUL_QOS_VALIDATION, and the QoS-Information AVP to indicate the
acceptable QoS. Upon reception of the subsequent CCA command, if the
validation of the answer is not successful, the V-PCRF shall reply to the PCEF
over Gx and the BBERF if applicable over Gxx with a CCA command including the
Gx experimental result code DIAMETER_ERROR_INITIAL_PARAMETERS. Otherwise, the
V-PCRF shall act as if the QoS validation is successful.
NOTE: In order to avoid loops in the QoS negotiation process, it is
recommended that the H-PCRF provides a QoS acceptable by the Visited Network.
When the V-PCRF receives a CCA command where the S9 specific subsession
indicates success status and if the QoS validation is successful, the V-PCRF
shall derive QoS rules based on the PCC rules received for case 2a and case
2b. The V-PCRF shall map the S9 subsession to the corresponding Gx and Gxx
session and follow the procedures described in 3GPP TS 29.212 [3] to provision
the PCC/QoS rules to the PCEF and BBERF respectively using, if the PCEF/BBERF
sent the original CCR command, CCA command or, if the PCEF/BBERF did not send
the original CCR command, RAR command.
NOTE: Provisioning rules within RAR command can be needed for those cases when
the V-PCRF receives CCR command related with a particular event from only the
BBERF or only the PCEF. For example, an event-trigger such as QOS_CHANGE can
trigger only the BBERF to send the CCR command while an event-trigger such as
OUT_OF_CREDIT can trigger only the PCEF to send the CCR command.
If after provisioning the rules to the PCEF/BBERF, the V-PCRF receives a
notification from the PCEF (case 1, 2a, 2b) or the BBERF (case 2a and 2b) or
both the PCEF and the BBERF informing that an operation on a PCC/QoS rule has
failed, the V-PCRF shall inform the H-PCRF. The V-PCRF shall send a CCR
command with the CC-Request-Type AVP set to the value UPDATE_REQUEST to the
H-PCRF including the Charging-Rule-Report AVP to indicate the PCC rules that
were affected at the subsession level by including the Subsession-Enforcement-
Info AVP identifying the affected S9 subsession within the Subsession-Id AVP,
the Subsession-Operation AVP set to the value "MODIFICATION". The H-PCRF may
decide to reinstall, modify or remove the affected PCC rules as described in
this clause or terminate the S9 session/subsession as described in clause
4.5.3.4.
#### 4.5.3.2 PCC and QoS Rules Provisioning
The H-PCRF shall provision, via the S9 reference point, PCC and QoS rules,
using one of the following procedures:
\- PULL procedure (Provisioning solicited by the V-PCRF): In response to a
request for PCC rules being made by the V-PCRF, as described in the preceding
section, to provide QoS rules for case 2a where no corresponding PCC rules are
sent, the H-PCRF shall provision QoS rules in the CCA by including the QoS-
Rule-Install AVP at the command level; for other cases, the H-PCRF shall
provision PCC rules in the CCA command by including the Charging-Rule-Install
AVP within the Subsession-Decision-Info AVP on the S9 subsession(s) that
requested for PCC rules. Or in response to a request for PCC Rules being made
by the V-PCRF, as described in the preceding section instance
\- PUSH procedure (Unsolicited provisioning from the H-PCRF). The H-PCRF may
decide to provision (install, modify ore remove) PCC Rules without obtaining a
request from the V-PCRF, e.g. in response to information provided to the
H-PCRF from the AF (either in the visited or in the home network), or in
response to an internal trigger within the H-PCRF, or from a trigger by the
SPR. To install or modify QoS Rules without a request from the V-PCRF for case
2a when there are no related PCC rules, the H-PCRF shall provision QoS rules
in the RAR by including the QoS-Rule-Install AVP at the command level; to
provision PCC Rules without a request from the V-PCRF, the H-PCRF shall
include these PCC Rules in an RAR command by including the Charging-Rule-
Install AVP on the related S9 subsessions within the Subsession-Decision-Info
AVP. To remove installed PCC Rules without a request from the V-PCRF, the
H-PCRF shall include these PCC Rules in a RAR command by including the
Charging-Rule-Remove AVP on the related S9 subsessions within the Subsession-
Decision-Info AVP.
The V-PCRF shall validate the QoS information contained within the PCC rules
of the CCA/RAR command. If the QoS validation fails or other error conditions
occur for PCC rules provisioned within the CCA command from the H-PCRF, the
V-PCRF shall follow the procedures specified in clause 4.5.3.1 for error
handling. Otherwise, if the QoS validation fails or other error conditions
occur when provisioning PCC rules using the RAR command, the procedures below
apply.
If the QoS information is provisioned at the command level and the validation
fails, the V-PCRF shall respond back to the H-PCRF by issuing an RAA command
that includes, at the command level, the DIAMETER_PCC_RULE_EVENT (5142)
experimental result code, the QoS-Rule-Report AVP to indicate the QoS Rules
that were not accepted, the Rule-Failure-Code AVP set to
UNSUCCESSFUL_QOS_VALIDATION, and the QoS-Information AVP to indicate the
acceptable QoS.
If the QoS information is provisioned at the command level and the validation
is successful, the V-PCRF shall follow the procedures described in 3GPP TS
29.212 [3] to provision the QoS rules to the BBERF. If after provisioning the
rules to the BBERF, the V-PCRF receives a notification from the BBERF
informing that an operation on a QoS rule has failed, the V-PCRF shall
immediately inform the H-PCRF. The V-PCRF shall send a RAA command to the
H-PCRF including the QoS-Rule-Report AVP to indicate the QoS rules that were
affected at the command level. The H-PCRF may decide to reinstall, modify or
remove the affected Rules as described in this clause or terminate the S9
session/subsession as described in clause 4.5.3.4. If the provisioning of the
rules was successful, the V-PCRF shall inform the H-PCRF by sending a RAA
command containing, at the command level, the information included in the
notification received from the BBERF.
If the QoS information is provisioned at the subsession level and the
validation for all subsession fails, the V-PCRF shall send a RAA command to
the H-PCRF, including the Subsession-Enforcement-Info AVP for each rejected S9
subsession. Each Subsession-Enforcement-Info AVP includes the rejected
Subsession-Id, a DIAMETER_PCC_RULE_EVENT (5142) experimental result code, the
Charging-Rule-Report AVP to indicate the PCC Rules that were not accepted, the
Rule-Failure-Code AVP set to UNSUCCESSFUL_QOS_VALIDATION, and the QoS-
Information AVP to indicate the acceptable QoS.
If the QoS information is provisioned at the subsession level and the
validation for one or more subsession is successful, the V-PCRF shall
provision the validated rules to the PCEF/BBERF first. For all validated PCC
rules, the V-PCRF derives QoS rules based on the PCC rules for case 2a and
case 2b. The V-PCRF follows the procedures specified in 3GPP TS29.212 [3] to
provision the rules to the BBERF/PCEF.
If after provisioning the rules to the PCEF/BBERF, the V-PCRF receives a
notification from either the PCEF (case 1, 2a, 2b) or the BBERF (case 2a and
2b) informing that an operation on a PCC/QoS rule has failed, the V-PCRF shall
inform the H-PCRF.
After obtaining the QoS validation and rules installation (if applicable)
result, the V-PCRF shall send a RAA command to the H-PCRF and for each
subsession, include the Subsession-Enforcement-Info AVP with the Subsession-Id
AVP. In addition, for each subsession, the Subsession-Enforcement-Info shall
include,
\- if the QoS validation failed at the V-PCRF, a DIAMETER_PCC_RULE_EVENT
(5142) experimental result code, the Charging-Rule-Report AVP to indicate the
PCC Rules that were not accepted, the Rule-Failure-Code AVP set to
UNSUCCESSFUL_QOS_VALIDATION, and the QoS-Information AVP to indicate the
acceptable QoS.
\- if the V-PCRF received notification from the BBERF/PCEF indicating failure
in provision, the Experimental-Result-Code AVP or Result-Code AVP received
from the PCEF if available or from the BBERF otherwise, the Charging-Rule-
Report AVP to indicate the failed PCC Rules, and any other additional
information received from the BBERF/PCEF.
\- if the provision was successful, the result-code and other information
received from the PCEF/BBERF.
The result code or the experimental result code at the RAA command level shall
be set to the following value:
\- DIAMETER_SUCCESS (2001), if all subsessions have been provisioned
successfully;
\- DIAMETER_ERROR_SUBSESSION (5470), if one or more S9 subsessions have
failed.
For failed PCC rules, the H-PCRF may decide to reinstall, modify or remove the
affected PCC Rules as described in this clause or terminate the S9
session/subsession as described in clause 4.5.3.4.
#### 4.5.3.3 S9 Session/Subsession Termination Initiated by V-PCRF.
When the V-PCRF receives an indication of an IP-CAN Session Termination from
the PCEF or an indication of Gxx session termination from the BBERF, the
V-PCRF shall acknowledge the received message by sending the CCA command to
the PCEF or the BBERF as defined in 3GPP TS 29.212 [3]. In addition, the
V-PCRF shall indicate to the H-PCRF one of the following actions:
1) Terminate the S9 session, if in case 2a, the Gxx session is removed or in
case 1 or case 2b, the last S9 subsession for the roaming user is removed. The
V-PCRF shall terminate the S9 session with the H-PCRF by sending a CCR with
the CC-Request-Type AVP set to the value 'TERMINATION_REQUEST".
2) Update the S9 session for the roaming user, if there are remaining S9
subsessions for the roaming user. The V-PCRF shall update the existing S9
session with the H-PCRF by sending a CCR command with CC-Request-type AVP set
to value "UPDATE-REQUEST" that includes the Subsession-Enforcement-Info AVP
with the removed S9 subsession identifier within the Subsession-Id AVP, the
Subsession-Operation AVP set to the value "TERMINATION".
NOTE: In case 2b, when the V-PCRF receives a Gxx session termination request
from the BBERF (i.e. a CCR command with CC-Request-Type AVP set to value
"TERMINATION_REQUEST") , it handles it as specified in 3GPP TS 29.212 [3]
without impacting S9.
When receiving the CCR command, the H-PCRF shall perform the following steps:
1) Identify the removed PCC Rules associated to the terminated S9 session or
S9 subsession;
2) If an IP-CAN session is terminated, check whether the H-AF and/or V-AF
shall be informed and if the H-AF and/or V-AF needs to be informed, send an
ASR command as defined in clause 4.4.6.1 of 3GPP TS 29.214 [5]
The H-PCRF answers to the V-PCRF by issuing a CCA command.
#### 4.5.3.4 S9 Session/Subsession Termination Initiated by the H-PCRF.
The H-PCRF may decide to terminate an S9 session or S9 subsession based on an
internal trigger or a trigger from the SPR. When any of these triggers are
met, the H-PCRF shall initiate a S9 session or S9 subsession termination by
sending an RAR command to the V-PCRF as defined in clause 4.5.2.4.
The V-PCRF shall trigger the termination of corresponding IP-CAN session(s) by
applying the PCRF-Initiated IP-CAN session termination procedure for non-
roaming case as defined in 3GPP TS 29.213 [4] clause 4.2.3.1.
#### 4.5.3.5 Multiple BBERF Handling
The V-PCRF distinguishes two types of BBERF: primary and non-primary according
to 3GPP TS 29.212 [3].
The V-PCRF shall ensure that the QoS rules are aligned with the PCC rules on
all BBERFs as specified in TS 29.212 [3] clause 4a.5.7
When the V-PCRF receives a CCR command for Gateway Control Session
Establishment from a new BBERF that is related with an existing Gateway
Control Session, the V-PCRF determines whether case 2a or case 2b applies as
defined in 3GPP TS 29.213 [4] and applies the following procedures:
\- If case 2a applies, the V-PCRF modifies the S9 session by sending a CCR
command including the attributes provided by the new BBERF at the Diameter CCR
command level.
\- If case 2b applies and if the H-PCRF has subscribed to either the
AN_GW_CHANGE or the IP-CAN_CHANGE event trigger, the V-PCRF modifies the S9
session by sending a CCR command including the attributes provided by the new
BBERF in the Subsession-Enforcement-Info AVP that contains the allocated S9
subsession identifier within the Subsession-Id AVP and the Subsession-
Operation AVP set to the value "MODIFICATION"; otherwise, the V-PCRF shall not
contact the H-PCRF.
When, due to handover, the V-PCRF receives an IP CAN session modification from
the PCEF with the event trigger set to AN_GW_CHANGE the V-PCRF shall send a
CCR message to the H-PCRF with the Event-Trigger AVP at subsession level set
to AN_GW_CHANGE, provided the H-PCRF has subscribed to this event-trigger. If
the CCR message from the PCEF also includes the IP-CAN_CHANGE event-trigger,
the V-PCRF shall reclassify the primary/ non-primary BBERFs based on the
received IP-CAN type, and shall include this trigger as well in the CCR
message sent to the H-PCRF, provided the H-PCRF has subscribed to it. If there
is any subsequent request coming from the primary BBERF, the V-PCRF shall act
according to the normal procedures specified in clause 4.5.3 and corresponding
subclauses.
If the H-PCRF has not subscribed to either the AN_GW_CHANGE or the IP-
CAN_CHANGE event, the V-PCRF shall not inform the H-PCRF of this scenario and
should solve it according to local policies and roaming agreements.
#### 4.5.3.6 Rx Over S9
##### 4.5.3.6.1 General
The interaction between the V-AF and the V-PCRF is in accordance with 3GPP TS
29.214 [5]. The V-PCRF may act as a Diameter Proxy or client/server to send
the Rx messages between the V-AF and the H-PCRF except as noted below.
If the Subscription-Id AVP is received in the AAR command and the IMSI can not
be extracted or if the Subscription-ID AVP is not received in the AAR command,
the V-PCRF may alternatively determine the Destination-Realm based on session
binding within the V-PCRF.
NOTE: With the session binding, for Rx over S9 reference point interactions
the V-PCRF can find the UE Identity that is received from Gx/Gxx reference
point and use it to construct the EPC Home Network Realm/Domain, as indicated
in 3GPP TS 23.003 [9], clause 19.2, and use it as Destination-Realm.
The V-PCRF may process the initial or modified Service Information received
from the V-AF according to the operator policy to decide whether the request
is accepted or not. If the service information provided by the V-AF is
rejected, the V-PCRF shall send the AAA to reject the request with the
Experimental-Result-Code AVP set to the value
REQUESTED_SERVICE_NOT_AUTHORIZED. In this case, the V-PCRF shall not forward
the AAR to the H-PCRF.
The V-PCRF shall not forward the AAR message from the V-AF to the H-PCRF if
the processing of the request results in any of the specific values of the "Rx
specific Experimental-Result-Code" per clause. 5.5 of 3GPP TS 29.214 [5].
##### 4.5.3.6.2 Event Handling
###### 4.5.3.6.2.1 V-AF Subscription to Notification of Signalling Path Status
A V-AF may subscribe to notifications of the status of the AF Signalling
transmission path by including the Specific-Action AVP with the corresponding
value as described in section 4.4.5 of 3GPP TS 29.214 [9].
When the V-PCRF receives an AAR command for the establishment of the AF
signalling session from the V-AF, the V-PCRF, depending on operator policy,
may not forward the AAR message to the H-PCRF. In this case, the V-PCRF
handles the AF signalling session locally and shall acknowledge the AAR
command by sending an AAA command to the V-AF and follow the procedures
described in clause 4.4.5 of 3GPP TS 29.212 [9]. Otherwise, the V-PCRF proxies
the AAR to the H-PCRF.
###### 4.5.3.6.2.2 Reporting of Signalling Path Status
If the V-PCRF is handling the AF signalling session locally with the V-AF
(i.e. the V-PCRF is not proxying the AF signalling session to the H-PCRF) and
subscribed to the signalling path status specific actions
("INDICATION_OF_LOSS_OF_BEARER" and/or "INDICATION_OF_RELEASE_OF_BEARER"), and
the V-PCRF is notified of the loss or release of resources associated to the
PCC Rules corresponding with V-AF Signalling IP Flows, the V-PCRF shall inform
the V-AF about the Loss of the Signalling Transmission Path by sending a
Re‑Authorization Request (RAR) command to the V-AF per section 4.4.6.3 of TS
29.214 [9].
The V-PCRF shall send a CCR message to the H-PCRF over the S9 interface
reporting this event trigger only if the H-PCRF has previously subscribed to
the corresponding event trigger.
###### 4.5.3.6.2.3 Reporting IP-CAN Type Change Notification
If the V-PCRF is handling the AF signalling session locally with the V-AF
(i.e. the V-PCRF is not proxying the AF signalling session to the H-PCRF) and
the V-AF has subscribed for change notification in UE's IP-CAN type and RAT
type, then the V-PCRF shall send a RAR command when there is a change in the
UE's IP-CAN type or RAT type (if the IP-CAN type is 3GPP-GPRS) per section
4.4.6.4 of TS 29.214 [9].
The V-PCRF shall send a CCR message to the H-PCRF over the S9 interface
reporting this event trigger only if the H-PCRF has previously subscribed to
the corresponding event trigger.
#### 4.5.3.7 Deferred Session Linking Handling
This procedure takes place at initial IP-CAN Session Establishment and during
the inter-system BBERF relocation for case 2b.
NOTE: The deferred leg linking indication assists the PCRF to avoid linking
the Gateway Control Session with an obsolete Gx Session at initial IP-CAN
Session Establishment.
When the V-PCRF receives a CCR for Gateway Control Session Establishment
including Session-Linking-Indicator AVP set to the value
"SESSION_LINKING_DEFERRED" from a new BBERF related with an existing Gateway
Control session (i.e. the new Gateway Control session has the same values in
the Subscription-Id AVP and Called-Station-Id AVP as the existing Gateway
Control session), the V-PCRF shall acknowledage by sending a CCA to the BBERF
and shall not send the CCR to the H-PCRF to update the S9 session immediately.
If the V-PCRF receives the CCR for IP-CAN session modification that has the
same values in the Subscription-Id AVP and Called-Station-Id AVP as the new
Gateway Control session, the V-PCRF shall link the new Gateway Control session
with the existing Gx session, and then send a CCR to H-PCRF to modify the S9
subsession by including the Subsession-Enforcement-Info AVP within the CCR
command that contains the already allocated S9 subsession identifier within
the Subsession-Id AVP, the Subsession-Operation AVP set to the value
"MODIFICATION". The V-PCRF shall keep the mapping between the new Gateway
Control session, the existing Gx session and the S9 subsession. The Multiple
BBERF handling procedures described in clause 4.5.3.5 are also applicable now.
If the V-PCRF receives the CCR for IP-CAN session establishment that has the
same values in the Subscription-Id AVP and Called-Station-Id AVP as the new
Gateway Control session, the V-PCRF shall link the new Gateway Control session
with the new Gx session, and then send a CCR command to H-PCRF to establish a
new S9 subsession by including the Subsession-Enforcement-Info AVP within the
CCR command that contains a new S9 subsession identifier within the
Subsession-Id AVP, the Subsession-Operation AVP set to the value
"ESTABLISHMENT". The V-PCRF shall keep the mapping between the new Gateway
Control session, the new Gx session and the new S9 subsession.
#### 4.5.3.8 Session Linking Handling When Multiple PDN Connection to a single
APN is supported
This procedure takes place in case 2b.
When the V-PCRF receives a CCR for Gateway Control Session Establishment with
the PDN Connection ID included in the PDN-Connection-ID AVP in addition to the
user identity included in Subscription-Id AVP and the PDN ID included in
Called-Station-Id AVP, the following procedures are applied:
\- If there is not an already established S9 session for this roaming user,
the V-PCRF shall send to the H-PCRF a CCR command with the CC-Request-Type set
to the value "INITIAL_REQUEST" to establish a new S9 session. The V-PCRF shall
include the Subsession-Enforcement-Info AVP within the CCR command with a new
S9 subsession identifier assigned by the V-PCRF within the Subsession-Id AVP
and the Subsession-Operation AVP set to the value "ESTABLISHMENT". The PDN
Connection ID shall not be sent to the H-PCRF. When the V-PCRF receives the
CCR for IP-CAN Session Establishment from the PCEF that has the same values in
the Subscription-Id AVP, Called-Station-Id AVP and PDN-Connection-ID AVP as
the new Gateway Control Session, the V-PCRF shall link the new Gateway Control
Session with the Gx session. The V-PCRF shall keep the mapping between the new
Gateway Control Session, the new Gx session and the new S9 subsession.
\- If an existing S9 session for the roaming user is already established and
if no Gateway Control Session for the same PDN ID exists or at least one
Gateway Control Session for same PDN ID exists but the IP-CAN type received in
the CCR command has not been modified, and the PDN Connection ID received in
the CCR command is different the V-PCRF sends a CCR command to H-PCRF to
establish a new S9 subsession by including the Subsession-Enforcement-Info AVP
within the CCR command that contains a new S9 subsession identifier within the
Subsession-Id AVP and the Subsession-Operation AVP set to the value
"ESTABLISHMENT". The PDN Connection ID shall not be sent to the H-PCRF. When
the V-PCRF receives the CCR for IP-CAN Session Establishment from the PCEF
that has the same values in the Subscription-Id AVP, Called-Station-Id AVP and
PDN-Connection-ID AVP as the new Gateway Control Session, the V-PCRF shall
link the new Gateway Control Session with the Gx session. The V-PCRF shall
keep the mapping between the new Gateway Control Session, the new Gx session
and the new S9 subsession.
\- If at least one Gateway Control Session for same PDN ID exists and the IP-
CAN type received in the CCR command has been modified, the V-PCRF assumes
that this constitutes an inter-system BBERF relocation.
\- If the Framed-IP-Address AVP and/or Framed-Ipv6-Prefix AVP are received,
the V-PCRF link the new Gateway Control session with the existing Gx session
where the Framed-IP-Address AVP and/or Framed-Ipv6-Prefix AVP are equal and
the PDN ID are matched and then shall send a CCR command to H-PCRF to modify
the S9 subsession by including the Subsession-Enforcement-Info AVP within the
CCR command that contains the already allocated S9 subsession identifier
within the Subsession-Id AVP and the Subsession-Operation AVP set to the value
"MODIFICATION". The V-PCRF shall keep the mapping between the new Gateway
Control session, the Gx session and the S9 subsession.
\- If the Framed-IP-Address AVP and/or Framed-Ipv6-Prefix AVP are not
received, the V-PCRF shall not link the new Gateway Control Session with any
Gx session and shall not contact with the H-PCRF immediately. When the V-PCRF
receives a CCR command for IP-CAN Session Modification that has the same
values in the Subscription-Id AVP, Called-Station-Id AVP and PDN-Connection-ID
AVP as the new Gateway Control Session, the V-PCRF shall link the new Gateway
Control Session with the Gx sesssion, and then shall send a CCR command to
H-PCRF to modify the S9 subsession by including the Subsession-Enforcement-
Info AVP within the CCR command that contains the already allocated S9
subsession identifier within the Subsession-Id AVP and the Subsession-
Operation AVP set to the value "MODIFICATION". The V-PCRF shall keep the
mapping between the new Gateway Control session, the Gx session and the S9
subsession.
### 4.5.4 IMS Emergency services
The S9 interface is not applicable for IMS Emergency services.
In case 2a, the V-PCRF upon reception of a CCR command with a CC-Request-Type
AVP set to "INITIAL_REQUEST" from the PCEF over Gx shall check if the Called-
Station-Id AVP includes a PDN identifier that matches one of the Emergency
APNs from the configurable list specified in 3GPP TS 29.212 [3]. If the V-PCRF
identifies that the request for PCC Rules is restricted to Emergency services
then shall send a CCA command to the PCEF to provision PCC Rules and then the
V-PCRF may provision QoS Rules to the BBERF as specified in 3GPP TS 29.212
[3].
NOTE: In case 2a, the V-PCRF detects that an IP-CAN session is for Emergency
Services at reception of the request for PCC Rules for Emergency purposes over
Gx.
# 5\. S9 Protocol
## 5.1 Protocol Support
The S9 application is defined as a vendor specific Diameter application, where
the vendor is 3GPP and the Application-ID for the S9 Application in the
present release is 16777267. The vendor identifier assigned by IANA to 3GPP
(http://www.iana.org/assignments/enterprise-numbers) is 10415.
NOTE: A route entry can have a different destination based on the application
identification AVP of the message. Therefore, Diameter agents (relay, proxy,
redirection, translation agents) must be configured appropriately to identify
the 3GPP S9 application within the Auth-Application-Id AVP in order to create
suitable routeing tables.
Due to the definition of the commands used in the S9 protocol, there is no
possibility to skip the Auth-Application-Id AVP and use the Vendor-Specific-
Application-Id AVP instead. Therefore the S9 application identification shall
be included in the Auth-Application-Id AVP.
With regard to the Diameter protocol defined over the S9 interface, the H-PCRF
acts as a Diameter server, in the sense that it is the network element that
handles PCC/QoS rule requests for a particular realm. The V-PCRF acts as the
Diameter client, in the sense that it is the network element requesting
PCC/QoS rules to the H-PCRF.
A Diameter S9 session used in the S9 protocol shall combine all Gx and Gxx
Diameter sessions for a particular UE.
## 5.2 Initialization, maintenance and termination of connection and session
The initialization and maintenance of the connection between each
V-PCRF/H-PCRF pair is defined by the underlying protocol. Establishment and
maintenance of connections between Diameter nodes is described in IETF RFC
3588 [6].
After establishing the transport connection, the V-PCRF and the H-PCRF shall
advertise the support of the S9 specific Application by including the value of
the application identifier in the Auth-Application-Id AVP and the value of the
3GPP (10415) in the Vendor-Id AVP of the Vendor-Specific-Application-Id AVP
contained in the Capabilities‑Exchange-Request and Capabilities-Exchange-
Answer commands. The Capabilities-Exchange-Request and Capabilities-Exchange-
Answer commands are specified in the Diameter Base Protocol (RFC 3588 [6]).
The termination of the S9 Diameter session can be initiated either by the
V-PCRF or H-PCRF, as specified in subclauses 4.5.2 and 4.5.3.
In case of roaming, when S9 protocol is used for 3GPP accesses, a V-PCRF shall
use, by default, the IMSI (MNC and MCC values) of the user provided over
Gxc/Gx to construct the EPC Home Network Realm/Domain, as indicated in 3GPP TS
23.003 [9], clause 19.2, and use it as Destination-Realm. However the V-PCRF
may alternatively determine the Destination-Realm based on local configuration
within the V-PCRF. This configuration follows specific roaming agreement
between the visited and the home operators.
## 5.3 S9 specific AVPs
Table 5.3.1 describes the Diameter AVPs defined for the S9 reference point,
their AVP Code values, types, possible flag values, whether or not the AVP may
be encrypted and the applicability of the AVPs to charging control, policy
control or both. The Vendor-Id header of all AVPs defined in the present
document shall be set to 3GPP (10415).
Table 5.3.1: S9 specific Diameter AVPs
| AVP Flag rules (note 1) |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---|---  
Attribute Name | AVP Code | Clause defined | Value Type (note 2) | Must | May | Should not | Must not | May Encr. | Acc. Type | Applicability (note 3)  
Multiple-BBERF-Action | 2204 | 5.3.6 | Enumerated | M,V | P |  |  | Y | All | PC  
Subsession-Decision-Info | 2200 | 5.3.1 | Grouped | M,V | P |  |  | Y | All | Both  
Subsession-Enforcement-Info | 2201 | 5.3.2 | Grouped | M,V | P |  |  | Y | All | Both  
Subsession-Id | 2202 | 5.3.3 | Unsigned32 | M,V | P |  |  | Y | All | Both  
Subsession-Operation | 2203 | 5.3.4 | Enumerated | M,V | P |  |  | Y | All | Both  
NOTE 1: The AVP header bit denoted as ‘M’, indicates whether support of the AVP is required. The AVP header bit denoted as ‘V’, indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see RFC 3588 [4]. NOTE 2: The value types are defined in RFC 3588 [4]. NOTE 3: AVPs marked with “CC” are applicable to charging control, AVPs marked with “PC” are applicable to policy control and AVPs marked with “Both” are applicable to both charging control and policy control. |  |  |  |  |  |  |  |  |  |   
### 5.3.1 Subsession-Decision-Info
The Subsession-Decision-Info AVP (AVP code 2204) is of type Grouped, and it is
used to manage PCC/QoS rules and event information within an S9 subsession
from the H-PCRF to the V-PCRF.
The information contained within this grouped AVP pertains only to the
subsession identified by the Subsession-Id AVP.
The Session-Release-Cause AVP is only applicable when the Subsession-Decision-
Info AVP is provided in a RAR.
The Result-Code AVP and Experimental-Result-Code AVP are only applicable when
the Subsession-Decision-Info AVP is provided in a CCA. The Result-Code AVP or
Experimental-Result-Code AVP may be provided to inform the V-PCRF of possible
errors when processing subsession information that was provided in a
corresponding CCR command.
AVP Format:
Subsession-Decision-Info ::= \
{ Subsession-Id }
0*2[ AN-GW-Address ]
[ Result-Code ]
[ Experimental-Result-Code ]
*[ Charging-Rule-Remove ]
*[ Charging-Rule-Install ]
*[ QoS-Rule-Install ]
*[ QoS-Rule-Remove ]
**[ Default-EPS-Bearer-QoS ]**
***[ Usage-Monitoring-Information ]**
[ Session-Release-Cause ]
[ Bearer-Control-Mode ]
**[ Revalidation-Time ]** *[ Event-Trigger ]
[ Online ]
[ Offline ]
*[ QoS-Information ]
*[ AVP ]
### 5.3.2 Subsession-Enforcement-Info
The Subsession-Enforcement-Info AVP (AVP code 2201) is of type Grouped, and it
is used to set up and tear down subsessions, provide information about the
subsession, request PCC/QoS rules and report on PCC/QoS rules and related
events. This information is sent from the V-PCRF to the H-PCRF. The
information contained within this grouped AVP pertains only to the subsession
identified by the Subsession-Id AVP.
The following AVPs are only applicable when the Subsession-Enforcement-Info
AVP is provided within a CCR: Subsession-Operation AVP, Bearer-Identifier AVP,
Bearer-Operation AVP, Packet-Filter-Information AVP, Packet-Filter-Operation
AVP, Framed-IP-Address AVP, Framed-Ipv6-Prefix AVP, Called-Station-ID AVP,
PDN-Connection-ID AVP, Bearer-Usage AVP, TFT-Packet-Filter-Information AVP,
Online AVP and Offline AVP.
The following AVPs are only applicable when the Subsession-Enforcement-Info
AVP is provided within an RAA: Result-Code AVP and Experimental-Result-Code
AVP.
The other AVPs are applicable when the Subsession-Enforcement-Info AVP is
provided in either a CCR or RAA.
The Result-Code AVP or Experimental-Result-Code AVP may be provided to inform
the H-PCRF of possible errors when processing subsession information that was
provided in a corresponding RAR command.
Subsession-Enforcement-Info ::= \
{ Subsession-Id }
[ Subsession-Operation ]
0*2[ AN-GW-Address ]
[ Bearer-Identifier ]
[ Bearer-Operation ]
*[ Packet-Filter-Information ]
**[ Packet-Filter-Operation ]**
[ QoS-Information ]
[ Framed-IP-Address ]
[ Framed-Ipv6-Prefix ]
*[ CoA-Information ]
[ Called-Station-Id ]
**[ PDN-Connection-ID ]**
[ Bearer-Usage ]
*[ TFT-Packet-Filter-Information ]
[ Online ]
[ Offline ]
[ Result-Code ]
[ Experimental-Result-Code ]
*[ Charging-Rule-Report ]
*[ QoS-Rule-Report ]
**[ Default-EPS-Bearer-QoS ]**
**[** Network-Request-Support ]
***[ Usage-Monitoring-Information ]**
[ Multiple-BBERF-Action ]
*[ Event-Trigger ]
[ Access-Network-Charging-Address ]
*[ Access-Network-Charging-Identifier-Gx ]
[ Session-Linking-Indicator ]
*[ AVP ]
### 5.3.3 Subsession-Id
The Subsession-Id AVP (AVP code 2202) is of type Unsigned32, and it is used to
uniquely identify a subsession within the S9 session. The Subsession-Id AVP
shall be selected by the V-PCRF.
### 5.3.4 Subsession-Operation
The Subsession-Operation AVP (AVP code 2203) is of type of Enumerated, and it
indicates the operation to be performed on the subsession.
The following values are defined:
TERMINATION (0)
> This value is used to indicate that a subsession is being terminated.
ESTABLISHMENT (1)
> This value is used to indicate that a new subsession is being established.
MODIFICATION (2)
> This value is used to indicate that an existing subsession is being
> modified.
### 5.3.5 Void
### 5.3.6 Multiple-BBERF-Action
The Multiple-BBERF-Action AVP (AVP code 2204) is of type Enumerated, and it
indicates that the Gateway Control Session in the VPLMN is established or
terminated in the multiple BBERFs scenario.
The following values are defined:
ESTABLISHMENT (0)
This value shall be used to indicate that the Gateway Control Session in the
VPLMN is established in the multiple BBERFs scenario.
TERMINATION (1)
This value shall be used to indicate that the Gateway Control Session in the
VPLMN is terminated in the multiple BBERFs scenario.
## 5.4 S9 re-used AVPs
The S9 reference point re-uses all of the Gx and Gxx AVPs specified in 3GPP TS
29.212 [3], including the AVPs re-used by Gx and Gxx as specified in clauses
5.4 and 5a.4 of 3GPP TS 29.212 [3] with exceptions noted below.
3GPP-RAT-Type AVP, QoS-Rule-Base-Name AVP and Event-Report-Indication AVP are
not applicable for the S9 reference point.
The event trigger value PGW_TRACE_CONTROL is not applicable for the S9
reference point.
Reused AVPs marked with "Rel9" are applicable as described in clause 5.4.1.
### 5.4.1 Use of the Supported-Features AVP on the S9 reference point
The Supported-Features AVP is used during session establishment to inform the
destination host about the required and optional features that the origin host
supports. The client shall, in the first request of a Diameter session
indicate the set of features required for the successul processing of the
session. If there are features supported by the client that are not advertised
as part of the required set of features, the client shall provide in the same
request this set of features that are optional for the successful processing
of the session. The server shall, in the first answer within the Diameter
session indicate the set of features that it has in common with the client and
that the server shall support within the same Diameter session. Any further
command messages shall always be compliant with the list of supported features
indicated in the Supported-Features AVPs during session establishment.
Features that are not advertised as supported shall not be used to construct
command messages for that Diameter session. Unless otherwise stated, the use
of the Supported-Features AVP on the S9 reference point shall be compliant
with the requirements for dynamic discovery of supported features on the Cx
reference point as defined in clause 7.2.1 of 3GPP TS 29.229 [7].
The base functionality for the S9 reference point is the 3GPP Rel-8 standard
and a feature is an extension to that functionality. If the origin host does
not support any features beyond the base functionality, the Supported-Features
AVP shall be absent from the S9 commands. As defined in clause 7.1.1 of 3GPP
TS 29.229 [7], when extending the application by adding new AVPs for a
feature, the new AVPs shall have the 'M' bit cleared and the AVP shall not be
defined mandatory in the command ABNF.
As defined in 3GPP TS 29.229 [7], the Supported-Features AVP is of type
grouped and contains the Vendor-Id, Feature-List-ID and Feature-List AVPs. On
the S9 reference point, the Supported-Features AVP is used to identify
features that have been defined by 3GPP and hence, for features that are
defined in this document, the Vendor-Id AVP shall contain the vendor ID of
3GPP (10415). If there are multiple feature lists defined for the S9 reference
point, the Feature-List-ID AVP shall differentiate those lists from one
another.
On receiving an initial request application message, the destination host
shall act as defined in clause 7.2.1 of 3GPP TS 29.229 [7]. The following
exceptions apply to the initial CCR/CCA command pair:
\- If the V-PCRF supports features that are required for the successful
operation of the session, the CCR shall include these required features within
Supported-Features AVP(s) with the 'M' bit set.
\- If the V-PCRF supports features that are not required for the successful
operation of the session, the CCR shall include these optional features within
Supported-Features AVP(s) with the 'M' bit cleared.
\- If the CCR command does not contain any Supported-Features AVP(s) and the
H-PCRF supports Rel-8 S9 functionality, the CCA command shall not include the
Supported-Features AVP. In this case, both V-PCRF and H-PCRF shall behave as
specified in this document.
\- If the CCR command contains the Supported-Features AVP(s) and the H-PCRF
supports all the features advertised in the CCR command within Supported-
Features AVP(s) with the 'M' bit set, the CCA from the H-PCRF shall include
the Supported-Features AVP(s), with the 'M' bit cleared, indicating only the
features that both the V-PCRF and H-PCRF support.
Once the V-PCRF and H-PCRF have negotiated the set of supported features
during session establishment, the set of common features shall be used during
the lifetime of the Diameter session.
The table below defines the features applicable to the S9 interfaces for the
feature list with a Feature-List-ID of 1.
Table 5.4.1.1: Features of Feature-List-ID 1 used in S9
+-------------------------+---------+-----+-------------------------+ | Feature bit | Feature | M/O | Description | +-------------------------+---------+-----+-------------------------+ | 0 | Rel9 | M | This feature indicates | | | | | the support of base | | | | | 3GPP Rel-9 S9 | | | | | functionality, | | | | | including the AVPs and | | | | | corresponding | | | | | procedures supported by | | | | | the base 3GPP Rel-8 S9 | | | | | standard, but excluding | | | | | those features | | | | | represented by separate | | | | | feature bits. AVPs | | | | | introduced with this | | | | | feature are marked with | | | | | "Rel9" as described in | | | | | clause 5.4. | +-------------------------+---------+-----+-------------------------+ | Feature bit: The order | | | | | number of the bit | | | | | within the | | | | | **Feature-List AVP | | | | | where the least | | | | | significant bit is | | | | | assigned number "0".** | | | | | | | | | | **Feature: A short name | | | | | that can be used to | | | | | refer to the bit and to | | | | | the feature, e.g. | | | | | "EPS".** | | | | | | | | | | **M/O: Defines if the | | | | | implementation of the | | | | | feature is mandatory | | | | | ("M") or optional ("O") | | | | | in this 3GPP Release.** | | | | | | | | | | Description: A clear | | | | | textual description of | | | | | the feature. | | | | +-------------------------+---------+-----+-------------------------+
## 5.5 S9 Messages
### 5.5.1 S9 Application
S9 Messages are carried within the Diameter Application(s) described in clause
5.1.
Existing Diameter command codes from the Diameter base protocol RFC 3588 [5]
and the Diameter Credit Control Application RFC 4006 [9] are used with the S9
specific AVPs specified in clause 5.3. The Diameter Credit Control Application
AVPs and AVPs from other Diameter applications that are re-used are defined in
clause 5.4. Due to the definition of these commands there is no possibility to
skip the Auth-Application-Id AVP and use the Vendor-Specific-Application-Id
AVP instead. Therefore the S9 application identifier shall be included in the
Auth-Application-Id AVP.
NOTE: Some of the AVPs included in the messages formats below are in bold to
highlight that these AVPs are used by this specific protocol and do not belong
to the original message definition in the DCC Application RFC 4006 [9] or
Diameter Base Protocol RFC 3588 [5].
### 5.5.2 CC-Request (CCR) Command
The CCR command, indicated by the Command-Code field set to 272 and the 'R'
bit set in the Command Flags field, is sent by the V-PCRF to the H-PCRF in
order to request PCC or QoS rules. The CCR command is also sent by the V-PCRF
to the H-PCRF in order to indicate bearer or PCC/QoS rule related events.
Message Format:
\ ::= \
\
{ Auth-Application-Id }
{ Origin-Host }
{ Origin-Realm }
{ Destination-Realm }
{ CC-Request-Type }
{ CC-Request-Number }
[ Destination-Host ]
[ Origin-State-Id ]
*[ Subscription-Id ]
[ Framed-IP-Address ]
[ Framed-Ipv6-Prefix ]
***[ Supported-Features ]**
**[ QoS-Information ]**
***[ QoS-Rule-Report ]**
**0*2 [ AN-GW-Address ]**
**[ Network-Request-Support ]**
***[ Packet-Filter-Information ]**
**[ Packet-Filter-Operation ]**
***[ Subsession-Enforcement-Info ]**
**[ IP-CAN-Type ]**
**[ RAT-Type ]**
[ Termination-Cause ]
[ User-Equipment-Info ]
**[ QoS-Negotiation ]**
**[ QoS-Upgrade ]**
**[ 3GPP-SGSN-MCC-MNC ]**
**[ 3GPP-SGSN-Address ]**
**[ 3GPP-SGSN-Ipv6-Address ]**
**[ RAI ]**
**[ 3GPP-User-Location-Info]**
**[ 3GPP-MS-TimeZone ]**
**[ 3GPP2-BSID ]**
***[ Event-Trigger]**
**[ Multiple-BBERF-Action ]**
**[ User-CSG-Information ]**
*[ Proxy-Info ]
*[ Route-Record ]
*[ AVP ]
### 5.5.3 CC-Answer (CCA) Command
The CCA command, indicated by the Command-Code field set to 272 and the 'R'
bit cleared in the Command Flags field, is sent by the H-PCRF to the V-PCRF in
response to the CCR command. It is used to provision PCC/QoS rules and event
triggers for the subsession/session
Message Format:
\ ::= \
\
{ Auth-Application-Id }
{ Origin-Host }
{ Origin-Realm }
[ Result-Code ]
[ Experimental-Result ]
{ CC-Request-Type }
{ CC-Request-Number }
***[ Supported-Features]**
***[ QoS-Rule-Install ]**
***[ QoS-Rule-Remove ]**
***[ QoS-Information ]**
**[ Bearer-Control-Mode ]**
***[ Event-Trigger ]**
**[ Charging-Information ]**
***[ Subsession-Decision-Info ]**
***[ CSG-Information-Reporting ]**
0*2[ AN-GW-Address ]
**[ Origin-State-Id ]**
**[ Error-Message ]**
**[ Error-Reporting-Host ]**
*[ Failed-AVP ]
*[ Proxy-Info ]
*[ Route-Record ]
*[ AVP ]
### 5.5.4 Re-Auth-Request (RAR) Command
The RAR command, indicated by the Command-Code field set to 258 and the 'R'
bit set in the Command Flags field, is sent by the H-PCRF to the V-PCRF in
order to provision QoS/PCC rules and event triggers for the
subsession/session.
Message Format:
\ ::= \
\
{ Auth-Application-Id }
{ Origin-Host }
{ Origin-Realm }
{ Destination-Realm }
{ Destination-Host }
{ Re-Auth-Request-Type }
[ Origin-State-Id ]
***[ QoS-Rule-Install ]**
***[ QoS-Rule-Remove ]**
***[ QoS-Information ]**
***[ Event-Trigger ]**
***[ Subsession-Decision-Info ]**
**0*2[ AN-GW-Address ]**
**[ Session-Release-Cause ]**
*[ Proxy-Info ]
*[ Route-Record ]
*[ AVP]
### 5.5.5 Re-Auth-Answer (RAA) Command
The RAA command, indicated by the Command-Code field set to 258 and the 'R'
bit cleared in the Command Flags field, is sent by the V-PCRF to the H-PCRF in
response to the RAR command.
Message Format:
\ ::= \
\
{ Origin-Host }
{ Origin-Realm }
[ Result-Code ]
[ Experimental-Result ]
[ Origin-State-Id ]
[ Framed-IP-Address ]
[ Framed-Ipv6-Prefix ]
**[ IP-CAN-Type ]**
**[ RAT-Type ]**
**[ 3GPP-SGSN-MCC-MNC ]**
**[ 3GPP-SGSN-Address ]**
**[ 3GPP-SGSN-Ipv6-Address ]**
**[ RAI ]**
**[ 3GPP-User-Location-Info ]**
**[ 3GPP-MS-TimeZone ]**
**[ 3GPP2-BSID ]**
**[ QoS-Information ]**
***[ QoS-Rule-Report ]**
**0*2[ AN-GW-Address ]**
***[ Subsession-Enforcement-Info ]**
**[ User-CSG-Information ]**
[ Error-Message ]
[ Error-Reporting-Host ]
*[ Failed-AVP ]
*[ Proxy-Info ]
*[ AVP ]
## 5.6 S9 specific Experimental-Result-Code AVP values
### 5.6.1 General
RFC 3588 [6] specifies the Experimental-Result AVP containing Vendor-ID AVP
and Experimental-Result-Code AVP. The Experimental-Result-Code AVP (AVP Code
298) is of type Unsigned32 and contains a vendor-assigned value representing
the result of processing a request. The Vendor-ID AVP shall be set to 3GPP
(10415).
### 5.6.2 Success
Result Codes that fall within the Success category are used to inform a peer
that a request has been successfully completed.
The Result-Code AVP values defined in Diameter BASE RFC 3588 [6] shall be
applied.
### 5.6.3 Permanent Failures
Errors that fall within the Permanent Failures category shall be used to
inform the peer that the request failed, and should not be attempted again.
The Result-Code AVP values defined in Diameter BASE RFC 3588 [6] and 3GPP TS
29.212 [3] are applicable. Also the following specific S9 Experimental-Result-
Codes values are defined:
DIAMETER_ERROR_SUBSESSION (5470)
> This error shall be used when one or more S9 subsessions within the answer
> contains an unsuccessful Result-Code or Experimental-Result-Code value. The
> Result Code specific to the request related to the subsession is specified
> within the corresponding Subsession-Decision-Info or Subsession-Enforcement-
> Info AVP.
#
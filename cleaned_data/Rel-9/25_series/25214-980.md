# Foreword
This Technical Specification (TS) has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of this present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies and establishes the characteristics of the
physicals layer procedures in the FDD mode of UTRA.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TS 25.211: \"Physical channels and mapping of transport channels onto
physical channels (FDD)\".
[2] 3GPP TS 25.212: \"Multiplexing and channel coding (FDD)\".
[3] 3GPP TS 25.213: \"Spreading and modulation (FDD)\".
[4] 3GPP TS 25.215: \"Physical layer -- Measurements (FDD)\".
[5] 3GPP TS 25.331: \"RRC Protocol Specification\".
[6] 3GPP TS 25.433: \"UTRAN Iub Interface NBAP Signalling\".
[7] 3GPP TS 25.101: \"UE Radio transmission and Reception (FDD)\".
[8] 3GPP TS 25.133: \"Requirements for Support of Radio Resource Management
(FDD)\".
[9] 3GPP TS 25.321: \"MAC protocol specification\".
[10] 3GPP TS 25.306: \"UE Radio Access Capabilities\".
# 3 Definitions and Abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definitions
apply:
**Activated uplink frequency:** For a specific UE, an uplink frequency is said
to be activated if the UE is allowed to transmit on that frequency. The
primary uplink frequency is always activated when configured while a secondary
uplink frequency has to be activated by means of an HS-SCCH order in order to
become activated. Similarly, for a specific UE, an uplink frequency is said to
be deactivated if it is configured but disallowed by the NodeB to transmit on
that frequency.
**Configured uplink frequency** : For a specific UE, an uplink frequency is
said to be configured if the UE has received all relevant information from
higher layers in order to perform transmission on that frequency.
**L1 combining period** : An interval of contiguous TTIs when S-CCPCHs, each
on different RLs, may be soft combined.
**Primary uplink frequency:** If a single uplink frequency is configured for
the UE, then it is the _primary uplink frequency_. In case more than one
uplink frequency is configured for the UE, then the primary uplink frequency
is the frequency on which the E-DCH corresponding to the serving E-DCH cell
associated with the serving HS-DSCH cell is transmitted. The association
between a pair of uplink and downlink frequencies is indicated by higher
layers.
**Secondary uplink frequency:** A _secondary uplink frequency_ is a frequency
on which an E-DCH corresponding to a serving E-DCH cell associated with a
secondary serving HS-DSCH cell is transmitted. The association between a pair
of uplink and downlink frequencies is indicated by higher layers.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
ACK Acknowledgement
AICH Acquisition Indicator Channel
ASC Access Service Class
BCH Broadcast Channel
CCPCH Common Control Physical Channel
CCTrCH Coded Composite Transport Channel
CPICH Common Pilot Channel
CQI Channel Quality Indicator
CRC Cyclic Redundancy Check
DCH Dedicated Channel
DL Downlink
DPCCH Dedicated Physical Control Channel
DPCH Dedicated Physical Channel
DPDCH Dedicated Physical Data Channel
DTX Discontinuous Transmission
E-DCH Enhanced Dedicated Channel
E-DPCCH E-DCH Dedicated Physical Control Channel
E-DPDCH E-DCH Dedicated Physical Data Channel
E-AGCH E-DCH Absolute Grant Channel
E-HICH E-DCH HARQ Acknowledgement Indicator Channel
E-RGCH E-DCH Relative Grant Channel
F-DPCH Fractional Dedicated Physical Channel
HSDPA High Speed Downlink Packet Access
HS-DSCH High Speed Downlink Shared Channel
HS-PDSCH High Speed Physical Downlink Shared Channel
HS-SCCH High Speed Physical Downlink Shared Control Channel
MBSFN MBMS over a Single Frequency Network
MICH MBMS Indicator Channel
MIMO Multiple Input Multiple Output
NACK Negative Acknowledgement
P-CCPCH Primary Common Control Physical Channel
PCA Power Control Algorithm
PICH Paging Indicator Channel
PRACH Physical Random Access Channel
RACH Random Access Channel
RL Radio Link
RPL Recovery Period Length
RSCP Received Signal Code Power
S-CCPCH Secondary Common Control Physical Channel
SCH Synchronisation Channel
SFN System Frame Number
SIR Signal-to-Interference Ratio
SNIR Signal to Noise Interference Ratio
TFC Transport Format Combination
TFRI Transport Format and Resource Indicator
TPC Transmit Power Control
TrCH Transport Channel
TTI Transmission Time Interval
UE User Equipment
UL Uplink
UTRAN UMTS Terrestrial Radio Access Network
# 4 Synchronisation procedures
## 4.1 Cell search
During the cell search, the UE searches for a cell and determines the downlink
scrambling code and common channel frame synchronisation of that cell. How
cell search is typically done is described in Annex C.
## 4.2 Common physical channel synchronisation
The radio frame timing of all common physical channels can be determined after
cell search.
### 4.2.1 P-CCPCH radio frame timing
The P-CCPCH radio frame timing is found during cell search and the radio frame
timing of all common physical channel are related to that timing as described
in [1].
### 4.2.2 S-CCPCH soft combining timing
Higher layers will provide timing information when S-CCPCHs, each on different
RLs,can be soft combined. The timing information allows the UE to determine
the L1 combining period that applies to each S-CCPCH. The information also
identifies the S-CCPCHs and the RLs that can be soft combined. The set of
S-CCPCHs that can be combined does not change during an L1 combining period.
When S-CCPCHs can be soft combined, all S-CCPCHs shall contain identical bits
in their data fields, although the TFCI fields of the S-CCPCHs may be
different. (TFC detection when S-CCPCHs may be soft combined is discussed in
[2].) The maximum delay between S-CCPCHs that the UE may combine is set by UE
performance requirements. The maximum number of S-CCPCHs that UE may
simultaneously combine is defined by the UE capability in [10].
### 4.2.3 Radio frame timing on the MBSFN layer
MBSFN cluster search and radio frame synchronisation on the MBSFN layer can be
performed via SCH and follow the same principles as described in Annex C.
After the primary scrambling code has been identified, the P-CCPCH can be
detected and MBSFN system information can be read.
### 4.2.4 Secondary serving HS-DSCH cell timing
When the UE is configured with a secondary serving HS-DSCH cell, it shall not
assume the presence of any common physical channel from that cell other than
CPICH. The radio frame timing and timing reference for a secondary serving HS-
DSCH cell are defined in [1].
## 4.3 DPCCH/DPDCH/F-DPCH synchronisation
### 4.3.1 Synchronisation primitives
#### 4.3.1.1 General
For the dedicated channels, synchronisation primitives are used to indicate
the synchronisation status of radio links, both in uplink and downlink. The
definition of the primitives is given in the following subclauses.
#### 4.3.1.2 Downlink synchronisation primitives
If UL_DTX_Active is FALSE (see section 6C), layer 1 in the UE shall every
radio frame check synchronisation status of either the DPCH or the F‑DPCH
depending on which is configured. If UL_DTX_Active is TRUE (see section 6C),
the layer 1 in the UE shall check synchronisation status of the F-DPCH for
each radio frame in which the F-DPCH transmission is known to be present in at
least one slot, and for the other radio frames, the layer 1 will not indicate
any synchronisation status to the higher layers. Synchronisation status is
indicated to higher layers using the CPHY-Sync-IND and CPHY-Out-of-Sync-IND
primitives.
The criteria for reporting synchronisation status are defined in two different
phases. Each phase is performed by the UE for each individual downlink
frequency associated with the activated uplink frequencies. The downlink
synchronization primitives are also reported to higher layers for each
individual downlink frequency associated with the activated uplink
frequencies.
The first phase starts when higher layers initiate physical dedicated channel
establishment (as described in [5]) or whenever the UE initiates
synchronisation procedure A or synchronisation procedure AA (as described in
section 4.3.2.1 and 4.3.2.3A) and lasts until 160 ms after the downlink
dedicated channel is considered established by higher layers (physical channel
establishment is defined in [5]). During this time out-of-sync shall not be
reported and in-sync shall be reported using the CPHY-Sync-IND primitive if
the following criterion is fulfilled:
  * The UE estimates the DPCCH quality or the quality of the TPC fields of the F-DPCH frame received from the associated serving HS-DSCH cell (or secondary serving HS-DSCH cell) over the previous 40 ms period to be better than a threshold Q~in~. This criterion shall be assumed not to be fulfilled before 40 ms of DPCCH quality measurements have been collected. Q~in~ is defined implicitly by the relevant tests in [7].
The second phase starts 160 ms after the downlink dedicated channel is
considered established by higher layers. During this phase both out-of-sync
and in-sync are reported as follows.
Out-of-sync shall be reported using the CPHY-Out-of-Sync-IND primitive if any
of the following criteria is fulfilled:
\- UL_DTX_Active is FALSE (see section 6C) and the UE estimates the DPCCH
quality or the quality of the TPC fields of the F-DPCH frame received from the
associated serving HS-DSCH cell (or secondary serving HS-DSCH cell) over the
previous 160 ms period to be worse than a threshold Q~out~. Q~out~ is defined
implicitly by the relevant tests in [7].
  * UL_DTX_Active is TRUE (see section 6C) and the UE estimates the quality of the TPC fields of the F-DPCH from the associated serving HS-DSCH cell (or secondary serving HS-DSCH cell) over the previous 240 slots in which the TPC symbols are known to be present to be worse than a threshold Q~out~. Q~out~ is defined implicitly by the relevant tests in [7].
\- The 20 most recently received transport blocks with a non-zero length CRC
attached, as observed on all TrCHs using non-zero length CRC mapped to the
DPDCH, have been received with incorrect CRC. In addition, over the previous
160 ms, all transport blocks with a non-zero length CRC attached have been
received with incorrect CRC. In case no TFCI is used this criterion shall not
be considered for the TrCH(s) not using guided detection if they do not use a
non-zero length CRC in all transport formats. If no transport blocks with a
non-zero length CRC attached are received over the previous 160 ms this
criterion shall not be assumed to be fulfilled.
For a DPCH, in-sync shall be reported using the CPHY-Sync-IND primitive if
both of the following criteria are fulfilled:
\- The UE estimates the DPCCH quality over the previous 160 ms period to be
better than a threshold Q~in~. Q~in~ is defined implicitly by the relevant
tests in [7].
\- At least one transport block with a non-zero length CRC attached, as
observed on all TrCHs using non-zero length CRC mapped to the DPDCH, is
received in a TTI ending in the current frame with correct CRC. If no
transport blocks are received, or no transport block has a non-zero length CRC
attached in a TTI ending in the current frame and in addition over the
previous 160 ms at least one transport block with a non-zero length CRC
attached has been received with a correct CRC, this criterion shall be assumed
to be fulfilled. If no transport blocks with a non-zero length CRC attached
are received over the previous 160 ms this criterion shall also be assumed to
be fulfilled. In case no TFCI is used this criterion shall not be considered
for the TrCH(s) not using guided detection if they do not use a non-zero
length CRC in all transport formats.
For a F-DPCH, in-sync shall be reported using the CPHY-Sync-IND primitive if
any of the following criteria is fulfilled:
\- UL_DTX_Active is FALSE (see section 6C) and the UE estimates the quality of
the TPC fields of the F-DPCH frame received from the associated serving HS-
DSCH cell (or secondary serving HS-DSCH cell) over the previous 160 ms period
to be better than a threshold Q~in~. Q~in~ is defined implicitly by the
relevant tests in [7].
  * UL_DTX_Active is TRUE (see section 6C) and the UE estimates the quality of the TPC fields of the F-DPCH from the associated serving HS-DSCH cell (or secondary serving HS-DSCH cell) over the previous 240 slots in which the TPC symbols are known to be present to be better than a threshold Q~in~. Q~in~ is defined implicitly by the relevant tests in [7].
How the primitives are used by higher layers is described in [5]. The above
definitions may lead to radio frames where neither the in-sync nor the out-of-
sync primitives are reported.
#### 4.3.1.3 Uplink synchronisation primitives
Layer 1 in the Node B shall every radio frame check synchronisation status of
all radio link sets. Synchronisation status is indicated to the RL
Failure/Restored triggering function using either the CPHY-Sync-IND or CPHY-
Out-of‑Sync‑IND primitive. Hence, only one synchronisation status indication
shall be given per radio link set.
The exact criteria for indicating in-sync/out-of-sync is not subject to
specification, but could e.g. be based on received DPCCH quality or CRC
checks. One example would be to have the same criteria as for the downlink
synchronisation status primitives.
### 4.3.2 Radio link establishment and physical layer reconfiguration for
dedicated channels
#### 4.3.2.1 General
Three synchronisation procedures are defined in order to obtain physical layer
synchronisation of dedicated channels between UE and UTRAN:
\- Synchronisation procedure A: This procedure shall be used when at least one
downlink dedicated physical channel (i.e. a DPCH or F-DPCH) and one uplink
dedicated physical channel are to be set up on a frequency and none of the
radio links after the establishment/reconfiguration existed on that frequency
prior to the establishment/reconfiguration which also includes the following
cases :
\- the UE was previously on another RAT i.e. inter-RAT handover
\- the UE was previously on another frequency i.e. inter-frequency hard
handover
\- the UE has all its previous radio links removed and replaced by other radio
links i.e. intra-frequency hard-handover
\- after it fails to complete an inter-RAT, intra- or inter-frequency hard-
handover [8], the UE attempts to re-establish [5] all the dedicated physical
channels which were already established immediately before the hard-handover
attempt. In this case only steps c) and d) of synchronisation procedure A are
applicable.
\- the UE receives an HS-SCCH order to activate the secondary uplink frequency
as specified in [2] and the UE is configured with multiple frequencies on the
uplink.
> For transitions from the CELL_FACH state of a cell to the CELL_DCH state of
> the same cell, when synchronisation has already been achieved by a
> synchronisation procedure AA and the UE has not already released its uplink
> common E-DCH resource before the time of transition to CELL_DCH, the
> synchronisation procedure A shall not be executed. Else, the synchronisation
> procedure A shall be executed.
>
> \- Synchronisation procedure AA: This procedure shall be used when one
> downlink F-DPCH and uplink dedicated physical channels are to be set up on a
> frequency as a consequence of an Enhanced Uplink in CELL_FACH procedure.
\- Synchronisation procedure B: This procedure shall be used when one or
several radio links are added to the active set on a frequency and at least
one of the radio links prior to the establishment/reconfiguration still exists
on that frequency after the establishment/reconfiguration.
  * If higher layers indicate that the UE shall not perform any > synchronisation procedure for timing maintained intra- and > inter-frequency hard handover, the UE shall not perform any of the > synchronisation procedures A or B. If higher layers indicate to > the Node B timing maintained intra- or inter-frequency hard > handover where the UE does not perform any of the synchronisation > procedures A, AA or B, the Node B shall perform steps a) and b) of > synchronisation procedure B.
For all physical layer reconfigurations not listed above, the UE and UTRAN
shall not perform any of the synchronisation procedures listed above.
The three synchronisation procedures are described in subclauses 4.3.2.3,
4.3.2.3A and 4.3.2.4 respectively.
#### 4.3.2.2 Node B radio link set state machine
In Node B, each radio link set can be in three different states: initial
state, out-of-sync state and in-sync state. Transitions between the different
states are shown in figure 1 below. The state of the Node B at the start of
radio link establishment is described in the following subclauses. Transitions
between initial state and in-sync state are described in subclauses 4.3.2.3,
4.3.2.3A and 4.3.2.4 and transitions between the in-sync and out-of-sync
states are described in subclause 4.3.3.2.
Figure 1: Node B radio link set states and transitions
#### 4.3.2.3 Synchronisation procedure A
For each configured uplink frequency, the synchronisation establishment
procedure, which begins at the time indicated by higher layers (either
immediately at receipt of upper layer signalling, or at an indicated
activation time), or by an HS-SCCH order to activate the secondary uplink
frequency (in the case multiple frequencies are configured on the uplink) is
as follows:
a) Each Node B involved in the procedure sets all the radio link sets which
are to be set-up for this UE in the initial state.
b) UTRAN shall start the transmission of the downlink DPCCH or F-DPCH
corresponding to the activated uplink frequency and may start the transmission
of DPDCH if any data is to be transmitted. The initial downlink DPCCH or
F-DPCH transmit power is set by higher layers [6]. Downlink TPC commands are
generated as described in 5.1.2.2.1.2.
c) The UE establishes downlink chip and frame synchronisation of DPCCH or
F-DPCH corresponding to the activated uplink frequency, using the P-CCPCH
timing and timing offset information notified from UTRAN. For DPCH, frame
synchronisation can be confirmed using the frame synchronisation word.
Downlink synchronisation status is reported to higher layers every radio frame
according to subclause 4.3.1.2.
d) If higher layers indicate the usage of a post-verification period for the
primary uplink frequency the UE shall start transmission on the primary uplink
frequency immediately when the physical dedicated channel establishment is
initiated by the UE. Post-verification period is always used for the secondary
uplink frequency.
> If higher layers do not indicate the usage of a post-verification period for
> the primary uplink frequency, or if higher layers do indicate the usage of a
> post-verification period (as specified in 5.1.2.2.1.1) and the post-
> verification has failed, the UE shall not transmit on the activated uplink
> frequency until higher layers consider the downlink physical channel
> established;
  * If no activation time for uplink DPCCH has been signalled to the UE or if the UE attempts to re-establish the DPCH after an inter-RAT, intra- or inter-frequency hard-handover failure [5], uplink DPCCH transmission shall start on the activated uplink frequency when higher layers consider the downlink physical channel established;
  * If an activation time has been given, uplink DPCCH transmission shall not start on the activated uplink frequency before the downlink physical channel has been established and the activation time has been reached. Physical channel establishment and activation time are defined in [5].
> The initial uplink DPCCH transmit power is set by higher layers [5]. In case
> the synchronisation procedure A is executed because the UE receives an HS-
> SCCH order to activate the secondary uplink frequency, then the initial
> DPCCH transmit power on the secondary uplink frequency is computed (in dB)
> as
>
> Uplink DPCCH transmit power = P~DPCCH,1~ -- UE_Sec_Tx_Power_Backoff
>
> where P~DPCCH,1~ is the DPCCH transmit power on the primary uplink frequency
> at the start of the transmission on the secondary uplink frequency and
> UE_Sec_Tx_Power_Backoff is set by higher layers.
>
> In case the UE attempts to re-establish the DPCH after an inter-RAT, intra-
> or inter-frequency hard-handover failure [5] the initial uplink DPCCH power
> shall be the same as the one used immediately preceding the inter-RAT,
> intra- or inter-frequency hard-handover attempt. In case of physical layer
> reconfiguration the uplink DPCCH power is kept unchanged between before and
> after the reconfiguration except for inner loop power control adjustments.
>
> A power control preamble shall be applied on the activated uplink frequency
> as indicated by higher layers. The transmission of the uplink DPCCH power
> control preamble shall start N~pcp~ radio frames prior to the radio frame
> where the uplink DPDCH/E-DPCCH/E-DPDCH transmission starts, where N~pcp~ is
> a higher layer parameter set by UTRAN [5]; in case the UE attempts to re-
> establish the DPCH after an inter-RAT, intra- or inter-frequency hard-
> handover failure [5] the UE shall use the value of N~pcp~ as specified in
> [5] for this case. Note that the transmission start delay between DPCCH and
> DPDCH/E-DPCCH/E-DPDCH may be cancelled using a power control preamble of 0
> length. If higher layers indicate the usage of a post-verification period,
> and the start of the uplink DPCCH power control preamble with a length of
> N~pcp~ radio frames would be in a radio frame later than the first uplink
> radio frame after physical dedicated channel establishment is initiated by
> the UE, then the duration of the uplink DPCCH power control preamble shall
> be equal to or longer than N~pcp~ radio frames such that the uplink DPCCH
> power control preamble is transmitted from the first uplink radio frame
> after physical dedicated channel establishment is initiated by the UE.
>
> The starting time for transmission of DPDCHs/E-DPCCH/E-DPDCHs shall also
> satisfy the constraints on adding transport channels to a CCTrCH, as defined
> in [2] sub-clause 4.2.14, independently of whether there are any bits mapped
> to the DPDCHs/E-DPCCH/E-DPDCHs. During the uplink DPCCH power control
> preamble, independently of the selected TFC, no transmission is done on the
> DPDCH/E-DPCCH/E-DPDCH.
e) UTRAN establishes uplink chip and frame synchronisation on the activated
uplink frequency. Frame synchronisation can be confirmed using the frame
synchronisation word. Radio link sets remain in the initial state until
N_INSYNC_IND successive in-sync indications are received from layer 1, when
Node B shall trigger the RL Restore procedure indicating which radio link set
has obtained synchronisation. When RL Restore has been triggered the radio
link set shall be considered to be in the in-sync state. The parameter value
of N_INSYNC_IND is configurable, see [6]. The RL Restore procedure may be
triggered several times, indicating when synchronisation is obtained for
different radio link sets.
Note: The total signalling response delay for the establishment of a new DPCH
shall not exceed the requirements given in [5] sub-clause 13.5.
#### 4.3.2.3A Synchronisation procedure AA {#a-synchronisation-procedure-aa
.list-paragraph}
The synchronisation establishment procedure, which begins at the time defined
in [1] for the Enhanced Uplink in CELL_FACH state and IDLE mode, is as
follows:
a) The Node B involved in the procedure sets the radio link which is to be
set-up for this UE in the initial state.
b) UTRAN shall start the transmission of the downlink F-DPCH at the time
defined for the Enhanced Uplink in CELL_FACH state and IDLE mode in [1].
c) The UE establishes downlink chip and frame synchronisation of F-DPCH, using
the P-CCPCH timing and timing offset information notified from UTRAN and based
on the timing definition for the Enhanced Uplink in CELL_FACH state and IDLE
mode as defined in [1]. Downlink synchronisation status is reported to higher
layers every radio frame according to subclause 4.3.1.2.
d) The UE shall start transmission on uplink at the time defined for the
Enhanced Uplink in CELL_FACH state and IDLE mode in [1] and shall use a post-
verification period for confirming the establishment of the downlink physical
channel as follows: During the first 40 ms period of the first phase of the
downlink synchronisation procedure the UE shall control its transmitter
according to a downlink F-DPCH quality criterion as follows:
> \- When the UE estimates the F-DPCH quality over the first 40 ms period of
> the first phase of the downlink synchronisation status evaluation to be
> worse than a threshold Q~in~, the UE shall shut its transmitter off and
> consider post-verification failed. Q~in~ is defined implicitly by the
> relevant tests in [7].
>
> If the post-verification has failed, the UE shall not transmit on uplink and
> await higher layer orders.
e) UTRAN establishes uplink chip and frame synchronisation. Frame
synchronisation can be confirmed using the frame synchronisation word.
#### 4.3.2.4 Synchronisation procedure B
For each configured uplink frequency, the synchronisation procedure B, which
begins at the time indicated by higher layers (either immediately at receipt
of upper layer signalling, or at an indicated activation time) is as follows:
a) The following applies to each Node B involved in the procedure:
\- New radio link sets are set up to be in initial state.
\- If one or several radio links are added to an existing radio link set, this
radio link set shall be considered to be in the state the radio link set was
prior to the addition of the radio link, i.e. if the radio link set was in the
in-sync state before the addition of the radio link it shall remain in that
state.
b) UTRAN starts the transmission of the downlink DPCCH/DPDCH or F-DPCH for
each new radio link corresponding to the activated uplink frequency at a frame
timing such that the frame timing received at the UE will be within T~0~ ± 148
chips prior to the frame timing of the uplink DPCCH/DPDCH at the UE.
Simultaneously, UTRAN establishes uplink chip and frame synchronisation of
each new radio link. Frame synchronisation can be confirmed using the frame
synchronisation word. Radio link sets considered to be in the initial state
shall remain in the initial state until N_INSYNC_IND successive in-sync
indications are received from layer 1, when Node B shall trigger the RL
Restore procedure indicating which radio link set has obtained
synchronisation. When RL Restore is triggered the radio link set shall be
considered to be in the in-sync state. The parameter value of N_INSYNC_IND is
configurable, see [6]. The RL Restore procedure may be triggered several
times, indicating when synchronisation is obtained for different radio link
sets.
c) The UE establishes chip and frame synchronisation of each new radio link.
Layer 1 in the UE keeps reporting downlink synchronisation status to higher
layers every radio frame according to the second phase of sub-clause 4.3.1.2.
For DPCH, frame synchronisation can be confirmed using the frame
synchronisation word.
### 4.3.3 Radio link monitoring
#### 4.3.3.1 Downlink radio link failure
The downlink radio links shall be monitored by the UE, to trigger radio link
failure procedures. The downlink radio link failure criteria is specified in
[5], and is based on the synchronisation status primitives CPHY-Sync-IND and
CPHY-Out-of-Sync-IND, indicating in-sync and out-of-sync respectively.
#### 4.3.3.2 Uplink radio link failure/restore in CELL_DCH state
The uplink radio link sets are monitored by the Node B, to trigger radio link
failure/restore procedures. Once the radio link sets have been established,
they will be in the in-sync or out-of-sync states as shown in figure 1 in
subclause 4.3.2.1. Transitions between those two states are described below.
The uplink radio link failure/restore criteria is based on the synchronisation
status primitives CPHY-Sync-IND and CPHY-Out-of-Sync-IND, indicating in-sync
and out-of-sync respectively. Note that only one synchronisation status
indication shall be given per radio link set.
When the radio link set is in the in-sync state, Node B shall start timer
T_RLFAILURE after receiving N_OUTSYNC_IND consecutive out-of-sync indications.
Node B shall stop and reset timer T_RLFAILURE upon receiving successive
N_INSYNC_IND in-sync indications. If T_RLFAILURE expires, Node B shall trigger
the RL Failure procedure and indicate which radio link set is out-of-sync.
When the RL Failure procedure is triggered, the state of the radio link set
change to the out-of-sync state.
When the radio link set is in the out-of-sync state, after receiving
N_INSYNC_IND successive in-sync indications Node B shall trigger the RL
Restore procedure and indicate which radio link set has re-established
synchronisation. When the RL Restore procedure is triggered, the state of the
radio link set change to the in-sync state.
The specific parameter settings (values of T_RLFAILURE, N_OUTSYNC_IND, and
N_INSYNC_IND) are configurable, see [6].
#### 4.3.3.2A Uplink radio link failure/restore in CELL_FACH state and IDLE
mode {#a-uplink-radio-link-failurerestore-in-cell_fach-state-and-idle-mode
.list-paragraph}
The uplink radio link failure/restore is under the control of the Node B.
### 4.3.4 Transmission timing adjustments
During a connection the UE may adjust its DPDCH/DPCCH transmission time
instant.
When the UE autonomously adjusts its DPDCH/DPCCH transmission time instant, it
shall simultaneously adjust the HS-DPCCH, E-DPCCH and E-DPDCH transmission
time instant by the same amount so that the relative timing between
DPCCH/DPDCH and HS-DPCCH is kept constant and that DPCCH/DPDCH and
E-DPCCH/E-DPDCH remain time aligned.
If the receive timing for any downlink DPCCH/DPDCH or F-DPCH in the current
active set has drifted, so the time between reception of the downlink
DPCCH/DPDCH in question and transmission of uplink DPCCH/DPDCH lies outside
the valid range, L1 shall inform higher layers of this, so that the network
can be informed of this and downlink timing can be adjusted by the network.
The maximum rate of uplink TX time adjustment, and the valid range for the
time between downlink DPCCH/DPDCH or F-DPCH reception and uplink DPCCH/DPDCH
transmission in the UE are defined by the requirements specified in [8].
# 5 Power control
## 5.1 Uplink power control
### 5.1.1 PRACH
#### 5.1.1.1 General
The power control during the physical random access procedure is described in
clause 6. The setting of power of the message control and data parts is
described in the next subclause.
#### 5.1.1.2 Setting of PRACH control and data part power difference
The message part of the uplink PRACH channel shall employ gain factors to
control the control/data part relative power similar to the uplink dedicated
physical channels. Hence, subclause 5.1.2.5 applies also for the RACH message
part, with the differences that:
\- _β~c~_ is the gain factor for the control part (similar to DPCCH);
\- _β~d~_ is the gain factor for the data part (similar to DPDCH);
\- no inner loop power control is performed.
### 5.1.2 DPCCH/DPDCH
#### 5.1.2.1 General
The initial uplink DPCCH transmit power is set by higher layers. Subsequently
the uplink transmit power control procedure simultaneously and independently
controls the power of a DPCCH on each activated uplink frequency and its
corresponding DPDCHs (if present). The relative transmit power offset between
DPCCH and DPDCHs is determined by the network and is computed according to
subclause 5.1.2.5 using the gain factors signalled to the UE using higher
layer signalling.
The operation of the inner power control loop, described in sub clause
5.1.2.2, adjusts the power of the DPCCH and DPDCHs by the same amount,
provided there are no changes in gain factors. Additional adjustments to the
power of the DPCCH associated with the use of compressed mode are described in
sub clause 5.1.2.3.
Any change in the uplink DPCCH transmit power shall take place immediately
before the start of the pilot field on the DPCCH. The change in DPCCH power
with respect to its previous value is derived by the UE and is denoted by
∆~DPCCH~ (in dB). The previous value of DPCCH power shall be that used in the
previous slot, except in the event of an interruption in transmission due to
the use of compressed mode or discontinuous uplink DPCCH transmission
operation, when the previous value shall be that used in the last slot before
the transmission gap.
During the operation of the uplink power control procedure the UE transmit
power shall not exceed a maximum allowed value which is the lower out of the
maximum output power of the terminal power class and a value which may be set
by higher layer signalling.
Uplink power control shall be performed while the UE transmit power is below
the maximum allowed output power.
The provisions for power control at the maximum allowed value and below the
required minimum output power (as defined in [7]) are described in sub-clause
5.1.2.6.
#### 5.1.2.2 Ordinary transmit power control
##### 5.1.2.2.1 General
For each activated uplink frequency, the uplink inner-loop power control
adjusts the UE transmit power in order to keep the received uplink
signal‑to‑interference ratio (SIR) on that frequency at a given SIR target,
SIR~target~.
The cells in the active set should estimate signal-to-interference ratio
SIR~est~ of the received uplink DPCH. The cells in the active set should then
generate TPC commands and transmit the commands once per slot according to the
following rule: if SIR~est~ > SIR~target~ then the TPC command to transmit is
\"0\", while if SIR~est~ \ 0\text{.}5$.
  * Otherwise, TPC_cmd is set to 0.
#### 5.1.2.3 Transmit power control in compressed mode
NOTE: "Transmission gaps" correspond to transmission gaps created as a result
of compressed mode. Another type of transmission gap may exist if DPCCH
discontinuous transmission is applied (as described in section 6C), however
these gaps are named "uplink DPCCH transmission gaps".
In compressed mode, one or more transmission gap pattern sequences are active.
Therefore some frames are compressed and contain transmission gaps. The uplink
power control procedure is as specified in clause 5.1.2.2, using the same
UTRAN supplied parameters for Power Control Algorithm and step size (∆~TPC~),
but with additional features which aim to recover as rapidly as possible a
signal-to-interference ratio (SIR) close to the target SIR after each
transmission gap.
The cells in the active set should estimate signal-to-interference ratio
SIR~est~ of the received uplink DPCH. The cells in the active set should then
generate TPC commands and transmit the commands once per slot, except during
downlink transmission gaps, according to the following rule: if SIR~est~ >
SIR~cm_target~ then the TPC command to transmit is \"0\", while if SIR~est~ \ If DPCH is configured in the downlink then TPC_cmd~gap~ shall be the value
> of TPC_cmd derived in the first slot of the uplink transmission gap, if a
> downlink TPC_command is transmitted in that slot. Otherwise TPC_cmd~gap~
> shall be zero if no downlink TPC_command is transmitted in that slot.
>
> If F-DPCH is configured in the downlink then TPC_cmd~gap~ shall be equal to
> the sum of the values of TPC_cmd derived from each TPC command combining
> period in which a TPC command is known to be present and is not ignored as
> described below and which cannot be applied before the uplink transmission
> gap. The UE shall ignore any TPC commands received in an F-DPCH slot
> starting during an uplink DPCCH slot which is in an uplink transmission gap.
> In case there are no TPC commands to be summed TPC_cmd~gap~ shall be zero.
δ ~last~ shall be equal to the most recently computed value of δ~i~. δ~i~
shall be updated according to the following recursive relations, which shall
be executed in all slots in which both the uplink DPCCH and a downlink TPC
command are transmitted, and in the first slot of an uplink transmission gap
if a downlink TPC command is transmitted in that slot:
$\begin{matrix} \delta_{i} = 0\text{.}\text{9375}\delta_{i - 1} -
0\text{.}\text{96875}\text{TPC}_{\text{cmd}_{i}}\Delta_{\text{TPC}}k_{\text{sc}}
\ \delta_{i - 1} = \delta_{i} \ \end{matrix}$
where: TPC_cmd~i~ is the power control command derived by the UE in that slot;
> _k~sc~_ = 0 if additional scaling is applied in the current slot and the
> previous slot as described in sub-clause 5.1.2.6, and _k~sc~_ = 1 otherwise.
δ~i-1~ is the value of δ~i~ computed for the previous slot. The value of
δ~i-1~ shall be initialised to zero when the uplink DPCCH is activated, and
also at the end of the first slot after each uplink transmission gap, and also
at the end of the first slot after each downlink transmission gap. The value
of δ~i~ shall be set to zero at the end of the first slot after each uplink
transmission gap.
After a transmission gap in either the uplink or the downlink, the period
following resumption of simultaneous uplink and downlink DPCCH or F-DPCH
transmission is called a recovery period. RPL is the recovery period length
and is expressed as a number of slots. RPL is equal to the minimum value out
of the transmission gap length and 7 slots. If a transmission gap or an Uplink
DPCCH burst pattern gap as defined in subclause 6C.2 is scheduled to start
before RPL slots have elapsed, then the recovery period shall end at the start
of the gap, and the value of RPL shall be reduced accordingly.
During the recovery period, 2 modes are possible for the power control
algorithm. The Recovery Period Power control mode (RPP) is signalled with the
other compressed mode parameters (see [4]). The different modes are summarised
in the table 2:
Table 2: Recovery Period Power control modes during compressed mode
* * *
Recovery Period power control mode Description 0 Transmit power control is
applied using the algorithm determined by the value of PCA, as in subclause
5.1.2.2 with step size ∆~TPC.~ 1 Transmit power control is applied using
algorithm 1 (see subclause 5.1.2.2.2) with step size ∆~RP-TPC~ during RPL
slots after each transmission gap.
* * *
If UE_DTX_DRX_Enabled is TRUE, the UE shall behave as if the RPP mode is 0.
For RPP mode 0, the step size is not changed during the recovery period and
ordinary transmit power control is applied (see subclause 5.1.2.2), using the
algorithm for processing TPC commands determined by the value of PCA (see sub
clauses 5.1.2.2.2 and 5.1.2.2.3).
For RPP mode 1, during RPL slots after each transmission gap, power control
algorithm 1 is applied with a step size ∆~RP-TPC~ instead of ∆~TPC~,
regardless of the value of PCA. Therefore, the change in uplink DPCCH transmit
power at the start of each of the RPL+1 slots immediately following the
transmission gap (except for the first slot after the transmission gap) is
given by:
∆~DPCCH~ = ∆~RP-TPC~ × TPC_cmd + $\Delta$~PILOT~
∆~RP-TPC~ is called the recovery power control step size and is expressed in
dB. If PCA has the value 1, ∆~RP-TPC~ is equal to the minimum value of 3 dB
and 2∆~TPC~. If PCA has the value 2 , ∆~RP-TPC~ is equal to 1 dB.
After the recovery period, ordinary transmit power control resumes using the
algorithm specified by the value of PCA and with step size ∆~TPC~.
If PCA has the value 2 , the sets of slots over which the TPC commands are
processed shall remain aligned to the frame boundaries in the compressed
frame. For both RPP mode 0 and RPP mode 1, if the transmission gap or the
recovery period results in any incomplete sets of TPC commands, TPC_cmd shall
be zero for those sets of slots which are incomplete.
#### 5.1.2.4 Transmit power control in the uplink DPCCH power control preamble
An uplink DPCCH power control preamble is a period of uplink DPCCH
transmission prior to the start of the uplink DPDCH transmission. The downlink
DPCCH or F-DPCH shall also be transmitted during an uplink DPCCH power control
preamble.
The length of the uplink DPCCH power control preamble is a higher layer
parameter signalled by the network as defined in [5]. The uplink DPDCH
transmission shall commence after the end of the uplink DPCCH power control
preamble.
During the uplink DPCCH power control preamble the change in uplink DPCCH
transmit power shall be given by:
∆~DPCCH~ = ∆~TPC~ × TPC_cmd.
During the uplink DPCCH power control preamble TPC_cmd is derived according to
algorithm 1 as described in sub clause 5.1.2.2.1, regardless of the value of
PCA.
Ordinary power control (see subclause 5.1.2.2), with the power control
algorithm determined by the value of PCA and step size ∆~TPC,~ shall be used
after the end of the uplink DPCCH power control preamble.
#### 5.1.2.5 Setting of the uplink DPCCH/DPDCH relative powers
##### 5.1.2.5.1 General
The uplink DPCCH and DPDCH(s) are transmitted on different codes as defined in
subclause 4.2.1 of [3]. In the case that at least one DPDCH is configured, the
gain factors β~c~ and β~d~ may vary for each TFC. There are two ways of
controlling the gain factors of the DPCCH code and the DPDCH codes for
different TFCs in normal (non-compressed) frames:
− _β~c~_ and _β~d~_ are signalled for the TFC, or
− _β~c~_ and _β~d~_ is computed for the TFC, based on the signalled settings
for a reference TFC.
Combinations of the two above methods may be used to associate _β~c~_ and
_β~d~_ values to all TFCs in the TFCS. The two methods are described in
subclauses 5.1.2.5.2 and 5.1.2.5.3 respectively. Several reference TFCs may be
signalled from higher layers.
The gain factors may vary on radio frame basis depending on the current TFC
used. Further, the setting of gain factors is independent of the inner loop
power control.
After applying the gain factors, the UE shall scale the total transmit power
of the DPCCH and DPDCH(s), such that the DPCCH output power follows the
changes required by the power control procedure with power adjustments of
∆~DPCCH~ dB, subject to the provisions of sub-clause 5.1.2.6.
The gain factors during compressed frames are based on the nominal power
relation defined in normal frames, as specified in subclause 5.1.2.5.4.
##### 5.1.2.5.2 Signalled gain factors
When the gain factors _β~c~_ and _β~d~_ are signalled by higher layers for a
certain TFC, the signalled values are used directly for weighting of DPCCH and
DPDCH(s). The variable _A~j~_ , called the nominal power relation is then
computed as:
$A_{j} = \frac{\beta_{d}}{\beta_{c}}$.
##### 5.1.2.5.3 Computed gain factors
The gain factors  _β~c~_ and _β~d~_ may also be computed for certain TFCs,
based on the signalled settings for a reference TFC.
Let _β~c,ref~_ and _β~d,ref~_ denote the signalled gain factors for the
reference TFC. Further, let _β~c,j~_ and _β~d,j~_ denote the gain factors used
for the _j_ :th TFC. Also let _L~ref~_ denote the number of DPDCHs used for
the reference TFC and _L~,j~_ denote the number of DPDCHs used for the _j_ :th
TFC.
[Define the variable]{.underline}
$K_{\text{ref}} = \sum_{i}^{}{\text{RM}_{i} \cdot N_{i}}$;
where _RM_ ~i~ is the semi-static rate matching attribute for transport
channel _i_ (defined in [2] subclause 4.2.7), _N~i~_ is the number of bits
output from the radio frame segmentation block for transport channel _i_
(defined in [2] subclause 4.2.6.1), and the sum is taken over all the
transport channels _i_ in the reference TFC.
[Similarly, define the variable]{.underline}
$K_{j} = \sum_{i}^{}{\text{RM}_{i} \cdot N_{i}}$;
where the sum is taken over all the transport channels _i_ in the _j_ :th TFC.
The variable _A~j~_ , called the nominal power relation is then computed as:
$A_{j} = \frac{\beta_{d,\text{ref}}}{\beta_{c,\text{ref}}} \cdot
\sqrt{\frac{L_{\text{ref}}}{L_{j}}}\sqrt{\frac{K_{j}}{K_{\text{ref}}}}$.
The gain factors for the _j_ :th TFC are then computed as follows:
\- If _A~j~_ > 1, then $\beta_{d,j} = 1\text{.}0$ and$\beta_{c,j}$ is the
largest quantized$\beta$-value, for which the condition $\beta_{c,j}$≤ 1 /
_A~j~_ holds. Since $\beta_{c,j}$ may not be set to zero, if the above
rounding results in a zero value, $\beta_{c,j}$ shall be set to the lowest
quantized amplitude ratio of 1/15 as specified in [3].
\- If _A~j~_ ≤ 1, then $\beta_{d,j}$ is the smallest quantized$\beta$-value,
for which the condition $\beta_{d,j}$≥ _A~j~_ holds and $\beta_{c,j} =
1\text{.}0$.
The quantized β-values are defined in [3] subclause 4.2.1, table 1.
##### 5.1.2.5.4 Setting of the uplink DPCCH/DPDCH relative powers in
compressed mode
The gain factors used during a compressed frame for a certain TFC are
calculated from the nominal power relation used in normal (non-compressed)
frames for that TFC. Let _A~j~_ denote the nominal power relation for the _j_
:th TFC in a normal frame. Further, let _β~c,C,j~_ and _β~d,C,j~_ denote the
gain factors used for the _j_ :th TFC when the frame is compressed. The
variable _A~C,j~_ is computed as:
$A_{C,j} = A_{j} \cdot \sqrt{\frac{\text{15} \cdot
N_{\text{pilot},C}}{N_{\text{slots},C} \cdot N_{\text{pilot},N}}}$;
where _N~pilot,C~_ is the number of pilot bits per slot when in compressed
mode, and _N~pilot,N~_ is the number of pilot bits per slot in normal mode.
_N~slots,C~_ is the number of slots in the compressed frame used for
transmitting the data.
The gain factors for the _j_ :th TFC in a compressed frame are computed as
follows:
If _A~C,j~_ > 1, then $\beta_{d,C,j} = 1\text{.}0$ and $\beta_{c,C,j}$ is the
largest quantized$\beta$-value, for which the condition $\beta_{c,C,j}$≤ 1 /
_A~C,j~_ holds. Since $\beta_{c,C,j}$ may not be set to zero, if the above
rounding results in a zero value, $\beta_{c,C,j}$ shall be set to the lowest
quantized amplitude ratio of 1/15 as specified in [3].
If _A~C,j~_ ≤ 1, then $\beta_{d,C,j}$ is the smallest quantized$\beta$-value,
for which the condition $\beta_{d,C,j}$≥ _A~C,j~_ holds and $\beta_{c,C,j} =
1\text{.}0$.
The quantized β-values are defined in [3] subclause 4.2.1, table 1.
#### 5.1.2.5A Setting of the uplink HS-DPCCH power relative to DPCCH power
When an HS-DPCCH is active, the values for ∆~ACK~, ∆~NACK~ and ∆~CQI~ set by
higher layers are translated to the quantized amplitude ratios _A~hs~_ as
specified in [3] subclause 4.2.1.2, and shall be set for each HS-DPCCH slot as
follows.
If the UE is configured in MIMO mode in only one of the serving HS-DSCH cell
and the secondary serving HS-DSCH cell, then
  * the power setting for HS-DPCCH slots carrying HARQ-ACK shall be the same as if the UE was configured in MIMO mode in both cells;
  * the power setting for HS-DPCCH slots carrying the CQI associated with the cell for which the UE is configured in MIMO mode shall be the same as if the UE was configured in MIMO mode in both cells;
  * the power setting for HS-DPCCH slots carrying the CQI associated with the cell for which the UE is not configured in MIMO mode shall be the same as if the UE was not configured in MIMO mode in any cell and Secondary_Cell_Active is 0.
For HS-DPCCH slots carrying HARQ Acknowledgement:
> If Secondary_Cell_Active is 0,
>
> A~hs~ equals the quantized amplitude ratio translated from the signalled
> value ∆~ACK~ if the corresponding HARQ-ACK message is ACK;
>
> A~hs~ equals the quantized amplitude ratio translated from the signalled
> value ∆~NACK~ if the corresponding HARQ-ACK message is NACK;
>
> A~hs~ equals the quantized amplitude ratio translated from the greatest of
> the signalled values ∆~ACK~ and ∆~NACK~ if the corresponding HARQ-ACK
> message is PRE before a single transport block or POST after a single
> transport block.
>
> A~hs~ equals the quantized amplitude ratio translated from the signalled
> value ∆~ACK~ +1 if the corresponding HARQ-ACK message is ACK/ACK;
>
> A~hs~ equals the quantized amplitude ratio translated from the signalled
> value ∆~NACK~ +1 if the corresponding HARQ-ACK message is NACK/NACK;
>
> A~hs~ equals the quantized amplitude ratio translated from the greatest of
> (∆~ACK~ +1) and (∆~NACK~ +1) if the corresponding HARQ-ACK message is
> ACK/NACK, NACK/ACK, PRE before a dual transport block or POST after a dual
> transport block.
>
> Otherwise, if the UE is not configured in MIMO mode,
>
> A~hs~ equals the quantized amplitude ratio translated from the signalled
> value ∆~ACK~ +1 if the corresponding HARQ-ACK message contains at least one
> ACK but no NACK;
>
> A~hs~ equals the quantized amplitude ratio translated from the signalled
> value ∆~NACK~ +1 if the corresponding HARQ-ACK message contains at least one
> NACK but no ACK;
>
> A~hs~ equals the quantized amplitude ratio translated from the greatest of
> (∆~ACK~ +1) and (∆~NACK~ +1) if the corresponding HARQ-ACK message contains
> both ACK and NACK, or is a PRE or a POST.
Otherwise,
> A~hs~ equals the quantized amplitude ratio translated from the signalled
> value ∆~ACK~ +1 if the corresponding HARQ-ACK message contains at least one
> ACK but no NACK;
>
> A~hs~ equals the quantized amplitude ratio translated from the signalled
> value ∆~NACK~ +1 if the corresponding HARQ-ACK message contains at least one
> NACK but no ACK;
>
> A~hs~ equals the quantized amplitude ratio translated from the greatest of
> (∆~ACK~ +1) and (∆~NACK~ +1) if the corresponding HARQ-ACK message contains
> both ACK and NACK, or is a PRE or a POST.
For HS-DPCCH slots carrying CQI:
> When a CQI of type A is transmitted,
>
> A~hs~ equals the quantized amplitude ratio translated from the signalled
> value ∆~CQI~ +1~.~
>
> Otherwise, if the UE is not configured in MIMO mode and
> Secondary_Cell_Active is not 0,
>
> A~hs~ equals the quantized amplitude ratio translated from the signalled
> value ∆~CQI~ +1~.~
Otherwise,
> A~hs~ equals the quantized amplitude ratio translated from the signaled
> value ∆~CQI~
Then, in non-compressed frames _β~hs~_ , which is the gain factor defined in
[3] subclause 4.2.1.2, is calculated according to
$\beta_{\text{hs}} = \beta_{c} \cdot A_{\text{hs}}$,
where _β~c\ ~_ value is signalled by higher-layer or calculated as described
in subclause 5.1.2.5.2 or 5.1.2.5.3 if at least one DPDCH is configured. In
case no DPDCH is configured, _β~c\ ~_ value is set as described in subclause
5.1.2.5C.
With the exception of the start and end of compressed frames, any DPCCH power
change shall not modify the power ratio between the DPCCH and the HS-DPCCH.
The power ratio between the DPCCH and the HS-DPCCH during compressed DPCCH
frames is described below.
During the period between the start and end of a compressed DPCCH frame, when
HS-DPCCH is transmitted, _β~hs~_ is calculated according to
$\beta_{\text{hs}} = \beta_{c,C,j} \cdot A_{\text{hs}} \cdot
\sqrt{\frac{N_{\text{pilot},C}}{N_{\text{pilot},N}}}$,
where $\beta_{c,C,j}$ is calculated as described in subclause 5.1.2.5.4 if at
least one DPDCH is configured. In case no DPDCH is configured, _β~c,C,j\ ~_
value is set as described in subclause 5.1.2.5C. _N~pilot,C~_ is the number of
pilot bits per slot on the DPCCH in compressed frames, and _N~pilot,N~_ is the
number of pilot bits per slot in non-compressed frames.
Thus the gain factor _β~hs~_ varies depending on the current quantized
amplitude ratio A~hs~ and on whether the UL DPCCH is currently in a compressed
frame.
#### 5.1.2.5B Setting of the uplink E-DPCCH and E-DPDCH powers relative to
DPCCH power
##### 5.1.2.5B.1 E-DPCCH/DPCCH
The E-DPCCH gain factor computation depends on the transmitted E-TFC at a
given TTI.
In non compressed frames, if E-TFCI _~i~_ is smaller than or equal to _E-
TFCI~ec,boost~_ , where _E-TFCI~i~_ denotes the E-TFCI of the _i_ :th E-TFC,
the E-DPCCH gain factor, _β~ec~_ , which is defined in [3] subclause 4.2.1.3,
is calculated according to
where _β~c~_ value is signalled by higher-layers or calculated as described in
subclause 5.1.2.5.2 or 5.1.2.5.3 if at least one DPDCH is configured. In case
no DPDCH is configured, _β~c\ ~_ value is set as described in subclause
5.1.2.5C. _A~ec~_ is defined in [3] subclause 4.2.1.3. The _E-TFCI~ec,boost\
~_ value is signalled by higher layers.
In non compressed frames if _E-TFCI~i~_ is greater than _E-TFCI~ec,boost~_ ,
the unquantized E-DPCCH gain factor for the _i_ :th E-TFC, _β~ec,i,uq~_ ~,,~
is calculated according to
where ∆ _~T2TP~_ is signalled by higher layers and is defined in [3] subclause
4.2.1.3,$\beta_{\text{ed},i,k}$ is the E-DPDCH gain factor for the _i_ :th
E-TFC on the _k_ :th physical channel and _k~max,i~_ is the number of physical
channels used for the _i_ :th E-TFC.
If _β~ec,i,uq~_ is less than the smallest quantized value of Table 1B.0A in
[3] subclause 4.2.1.3, then the E-DPCCH gain factor of _E-TFCI~i~_ , _β~ec,i\
~_ is set such that _β~ec,i~_ /_β~c~_ is the smallest quantized value of Table
1B.0A in [3] subclause 4.2.1.3. Otherwise, _β~ec,i~_ is selected from Table
1B.0A in [3] subclause 4.2.1.3, such that 20*log10(_β~ec,i~_ /_β~c~_) is the
nearest quantized value to 20*log10(_β~ec,i,uq~_ /_β~c~_).
During compressed frames where the E-DCH TTI is 2msec, the E-DPCCH gain
factor, _β~ec~_ , which is defined in [3] subclause 4.2.1.3, is calculated
according to:
> $\beta_{\text{ec}} = \beta_{c,C,j} \cdot A_{\text{ec}} \cdot
> \sqrt{\frac{N_{\text{pilot},C}}{N_{\text{pilot},N}}}$ if _E-TFCI~i~_ is
> smaller than or equal to _E-TFCI~ec,boost.~_
_and according to_
$\beta_{\text{ec},i,\text{uq}} = \beta_{c,C,j} \cdot \sqrt{\text{max}\left(
A_{\text{ec}}^{2},\frac{\sum_{k = 1}^{k_{\text{max,}i}}\left(
\frac{\beta_{\text{ed},i,k}}{\beta_{c}}
\right)^{2}}{\text{10}^{\frac{{}^{\Delta_{T2\text{TP}}}}{\text{10}}}} - 1
\right)} \cdot \sqrt{\frac{N_{\text{pilot},C}}{N_{\text{pilot},N}}}$ if _E-
TFCI~i~_ is greater than _E‑TFCI~ec,boost.~_
where $\beta_{c,C,j}$ is calculated as described in subclause 5.1.2.5.4 if at
least one DPDCH is configured. In case no DPDCH is configured, the
$\beta_{c,C,j}$ value is set as described in subclause 5.1.2.5C.
$\beta_{\text{ed},i,k}$ is the E-DPDCH gain factor for the _i_ :th E-TFC on
the _k_ :th physical channel in non-compressed frames. _N~pilot,C~_ is the
number of pilot bits per slot on the DPCCH in compressed frames, and
_N~pilot,N~_ is the number of pilot bits per slot in non-compressed frames.
_N~slots,C~_ is the number of non DTX slots in the compressed frame.
During compressed frames and where the E-DCH TTI is 10msec, the E-DPCCH gain
factor, _β~ec~_ , which is defined in [3] subclause 4.2.1.3, is calculated
according to:
> $\beta_{\text{ec}} = \beta_{c,C,j} \cdot A_{\text{ec}} \cdot
> \sqrt{\frac{\text{15} \cdot N_{\text{pilot},C}}{N_{\text{slots},C} \cdot
> N_{\text{pilot},N}}}$ if _E-TFCI~i~_ is smaller than or equal to
> _E‑TFCI~ec,boost~_
_and according to_
$\beta_{\text{ec},i,\text{uq}} = \beta_{c,C,j} \cdot \sqrt{\text{max}\left(
A_{\text{ec}}^{2},\frac{\sum_{k = 1}^{k_{\text{max,}i}}\left(
\frac{\beta_{\text{ed},i,k}}{\beta_{c}}
\right)^{2}}{\text{10}^{\frac{{}^{\Delta_{T2\text{TP}}}}{\text{10}}}} - 1
\right)} \cdot \sqrt{\frac{\text{15} \cdot
N_{\text{pilot},C}}{N_{\text{slots},C}N_{\text{pilot},N}}}$ if _E-TFCI~i~_ is
greater than _E‑TFCI~ec,boost~._
where, _N~slots,C~_ is the number of non DTX slots in the compressed frame.
##### 5.1.2.5B.2 E-DPDCH/DPCCH
##### 5.1.2.5B.2.1 General {#b.2.1-general .H6}
The E-DPDCH gain factor, _β~ed~_ , which is defined in [3] subclause 4.2.1.3,
may take a different value for each E-TFC and HARQ offset. The gain factors
for different E-TFCs and HARQ offsets are computed as described in subclause
5.1.2.5B.2.3 based on reference gain factor(s) _β~ed,ref~_ of E-TFC(s)
signalled as reference E-TFC(s). The _β~ed,ref~ are_ computed as described in
subclause 5.1.2.5B.2.2. At least one E-TFC of the set of E-TFCs configured by
the network shall be signalled as a reference E-TFC.
The gain factors may vary on radio frame basis or sub-frame basis depending on
the E-DCH TTI used. Further, the setting of gain factors is independent of the
inner loop power control.
##### 5.1.2.5B.2.2 Computation of reference gain factors {#b.2.2-computation-
of-reference-gain-factors .H6}
Let _E-TFCI~ref,m~_ denote the E-TFCI of the _m_ :th reference E-TFC, where
_m_ =1,2,...,_M_ and _M_ is the number of signalled reference E-TFCs and _E-
TFCI~ref,~_ ~1~ \ if _E-TFCI~i~_ ≥ _E-TFCI~ref,M~,_ the primary and secondary reference E-TFCs
> are the (_M_ -1):th and _M_ :th reference E-TFCs respectively.
>
> if _E-TFCI~i~_ \ E-TFCs are the 1^st^ and 2^nd^ reference E-TFCs respectively.
>
> if _E-TFCI~ref,~_ ~1~ ≤ _E-TFCI~i~_ \ secondary reference E-TFCs are the _m_ :th and (_m_ +1):th reference E-TFCs
> respectively, such that _E‑TFCI~ref,m~_ ≤ _E-TFCI~i~_ \ ~1~.
When E-DPDCH power extrapolation formula is configured, let _β~ed,ref~_ denote
the reference gain factor of the reference E-TFC. Let _L~e,ref~_ denote the
number of E-DPDCHs used for the reference E-TFC and _L~e,i~_ denote the number
of E-DPDCHs used for the _i_ :th E-TFC. If SF2 is used, _L~e,ref~_ and
_L~e,i~_ are the equivalent number of physical channels assuming SF4. Let
_K~e,ref~_ denote the transport block size of the reference E-TFC and _K~e,i~_
denote the transport block size of the _i_ :th E-TFC, where the mapping
between the E-TFCI and the E-DCH transport block size is defined in [9]. For
the _i_ :th E-TFC, the temporary variable _β~ed,i,harq~_ is then computed as:
where the HARQ offset ∆~harq~ is defined in [3] subclause 4.2.1.3.
When E-DPDCH power interpolation formula is configured, let _β~ed,ref,1~ and
β~ed,ref~_ ~,2~ denote the reference gain factors of the primary and secondary
reference E-TFCs respectively. Let _L~e,ref,1~_ and _L~e,ref~,~2~_ denote the
number of E-DPDCHs used for the primary and secondary reference E-TFCs
respectively. Let _L~e,i~_ denotes the number of E-DPDCHs used for the _i_ :th
E-TFC. If SF2 is used, _L~e,ref,1~_ , _L~e,ref,2~_ and _L~e,i~_ are the
equivalent number of physical channels assuming SF4. Let _K~e,ref,1~_ and
_K~e,ref~,~2~_ denote the transport block sizes of the primary and secondary
reference E-TFCs respectively. Let _K~e,i~_ denotes the transport block size
of the _i_ :th E-TFC, where the mapping between the E-TFCI and the E-DCH
transport block size is defined in [9]. For the _i_ :th E-TFC, the temporary
variable _β~ed,i,harq~_ is computed as:
$\beta_{\text{ed},i,\text{harq}} = \sqrt{\frac{L_{e,\text{ref},1}}{L_{e,i}}}
\cdot \sqrt{\left( \left(
\frac{\frac{L_{e,\text{ref},2}}{L_{e,\text{ref},1}}\beta_{\text{ed},\text{ref},2}^{2}
- \beta_{\text{ed},\text{ref},1}^{2}}{K_{e,\text{ref},2} - K_{e,\text{ref},1}}
\right)\left( K_{e,i} - K_{e,\text{ref},1} \right) +
\beta_{\text{ed},\text{ref},1}^{2} \right)} \cdot \text{10}^{\left(
\frac{\Delta\text{harq}}{\text{20}} \right)}$with the exception that
_β~ed,i,harq\ ~_ is set to 0 if $\left(
\frac{\frac{L_{e,\text{ref},2}}{L_{e,\text{ref},1}}\beta_{\text{ed},\text{ref},2}^{2}
- \beta_{\text{ed},\text{ref},1}^{2}}{K_{e,\text{ref},2} - K_{e,\text{ref},1}}
\right)\left( K_{e,i} - K_{e,\text{ref},1} \right) +
\beta_{\text{ed},\text{ref},1}^{2} \leq 0$.
For the _i_ :th E-TFC, the unquantized gain factor _β~ed,k,i,uq~_ for the _k_
:th E-DPDCH (denoted E‑DPDCH~k~ in [3] subclause 4.2.1.3) shall be set to
$\sqrt{2} \times \beta_{\text{ed},i,\text{harq}}$ if the spreading factor for
E-DPDCH~k~ is 2 and to $\beta_{\text{ed},i,\text{harq}}$ otherwise.
The following applies:
\- For E-TFCI smaller than or equal to _E-TFCI~ec,boost~_ ,
> \- If _β~ed,k,i,uq~_ /_β~c~_ is less than the smallest quantized value of
> Table 1B.2 in [3] subclause 4.2.1.3, then the gain factor of E-DPDCH~k~,
> _β~ed,k~_ is set such that _β~ed,k~_ /_β~c~_ is the smallest quantized value
> of Table 1B.2 in [3] subclause 4.2.1.3.
>
> \- Otherwise, _β~ed,k~_ is set such that _β~ed,k~_ /_β~c~_ is the largest
> quantized value of Table 1B.2 in [3] subclause 4.2.1.3, for which the
> condition _β~ed,k~_ ≤ _β~ed,k,i,uq~_ holds.
\- For E-TFCI greater than _E-TFCI~ec,boost~_ ,
> \- If _β~ed,k,i,uq~_ /_β~c~_ is less than the smallest quantized value of
> Table 1B.2B in [3] subclause 4.2.1.3, then the gain factor of E-DPDCH~k~,
> _β~ed,k~_ is set such that _β~ed,k~_ /_β~c~_ is the smallest quantized value
> of Table 1B.2B in [3] subclause 4.2.1.3.
>
> \- Otherwise, _β~ed,k~_ is set such that _β~ed,k~_ /_β~c~_ is the largest
> quantized value of Table 1B.2B in [3] subclause 4.2.1.3, for which the
> condition _β~ed,k~_ ≤ _β~ed,k,i,uq~_ holds.
##### 5.1.2.5B.2.4 E-DPDCH/DPCCH adjustments relating to compressed mode
{#b.2.4-e-dpdchdpcch-adjustments-relating-to-compressed-mode .H6}
The gain factor applied to E-DPDCH is adjusted as a result of compressed mode
operation in the following cases:
• E-DCH transmissions that overlap a compressed frame
• For 10msec E-DCH TTI case, retransmissions that do not themselves overlap a
compressed frame, but for which the corresponding initial transmission
overlapped a compressed frame.
The gain factors used during a compressed frame for a certain E-TFC are
calculated from the nominal power relation used in normal (non-compressed)
frames for that E-TFC. When the frame is compressed, the gain factor used for
the _i_ :th E-TFC is derived from _β~ed,C,i~_ as described below.
When the E-DCH TTI is 2msec, _β~ed,C,i~_ shall be calculated as follows:
If E-DPDCH power extrapolation formula is configured,
$\beta_{\text{ed},C,i} = \beta_{c,C,j} \cdot A_{\text{ed}} \cdot
\sqrt{\frac{L_{e,\text{ref}}}{L_{e,i}}} \cdot
\sqrt{\frac{K_{e,i}}{K_{e,\text{ref}}} \cdot \text{10}^{\left(
\frac{\Delta_{\text{harq}}}{\text{20}} \right)} \cdot
\sqrt{\frac{N_{\text{pilot},C}}{N_{\text{pilot},N}}}}$,
Else if E-DPDCH power interpolation formula is configured _~,~_
with the exception that _β~ed,C,i~_ is set to 0 if $\left(
\frac{\frac{L_{e,\text{ref},2}}{L_{e,\text{ref},1}}A_{\text{ed},2}^{2} -
A_{\text{ed},1}^{2}}{K_{e,\text{ref},2} - K_{e,\text{ref},1}} \right)\left(
K_{e,i} - K_{e,\text{ref},1} \right) + A_{\text{ed},1}^{2} \leq 0$
where $\beta_{c,C,j}$ is calculated for the _j_ :th TFC as described in
subclause 5.1.2.5.4 if at least one DPDCH is configured. In case no DPDCH is
configured, the $\beta_{c,C,j}$ value is set as described in subclause
5.1.2.5C. _A~ed~_  _, A~ed,1\ ~_ and _A~ed,2\ ~_ are as defined in [3]
subclause 4.2.1.3. _A~ed,1\ ~_ and _A~ed,2\ ~_ denote the quantized amplitude
ratios assigned to the primary and secondary reference E-TFCs respectively _._
_L~e,ref~, L~e,i~, K~e,ref~ , K~e,i~ ,L~,e,ref,1~ , L~e,ref,2~ , K~e,ref,1~
and K~e,ref,2~ are as defined in subclause 5.1.2.5B.2.3,_ ∆~harq~ is as
defined in [3] subclause 4.2.1.3, _N~pilot,C~_ is the number of pilot bits per
slot on the DPCCH in compressed frames, and _N~pilot,N~_ is the number of
pilot bits per slot in non-compressed frames.
When the E-DCH TTI is 10msec and the current frame is compressed, _β~ed,C,i~_
shall be calculated as follows:
If E-DPDCH power extrapolation formula is configured
$\beta_{\text{ed},C,i} = \beta_{c,C,j} \cdot A_{\text{ed}} \cdot
\sqrt{\frac{L_{e,\text{ref}}}{L_{e,I,i}}} \cdot
\sqrt{\frac{K_{e,i}}{K_{e,\text{ref}}} \cdot \text{10}^{\left(
\frac{\Delta_{\text{harq}}}{\text{20}} \right)} \cdot \sqrt{\frac{\text{15}
\cdot N_{\text{pilot},C}}{N_{\text{slots},I}N_{\text{pilot},N}}}}$,
Else if E-DPDCH power interpolation formula is configured
with the exception that _β~ed,C,i~_ is set to 0 if $\left(
\frac{\frac{L_{e,\text{ref},2}}{L_{e,\text{ref},1}}A_{\text{ed},2}^{2} -
A_{\text{ed},1}^{2}}{K_{e,\text{ref},2} - K_{e,\text{ref},1}} \right)\left(
K_{e,i} - K_{e,\text{ref},1} \right) + A_{\text{ed},1}^{2} \leq 0$
_where L~e,I,i~ denotes the number of E-DPDCHs used for the i:th E-TFC in the
first frame used for transmitting the data and N~slots,I~_ is the number of
non DTX slots in the first frame used for transmitting the data.
For the _i_ :th E-TFC, the unquantized gain factor _β~ed,\ k,i,uq~_ for the
_k_ :th E-DPDCH (denoted E‑DPDCH~k~ in [3] subclause 4.2.1.3) shall be set to
$\sqrt{2} \times \beta_{\text{ed},C,i}$if the spreading factor for E-DPDCH~k~
is 2 and to $\beta_{\text{ed},C,i}$ otherwise.
Quantization may be applied as follows:
  * For E-TFCI smaller than or equal to _E-TFCI~ec,boost~_ ,
    * If _β~ed\ ,k,i,uq~_ /_β~c,C,j~_ is less than the smallest > quantized value of Table 1B.2 in [3] subclause 4.2.1.3, then > the gain factor of E-DPDCH~k~, _β~ed,k~_ is set such that > _β~ed,k~_ /_β~c,C,j~_ is the smallest quantized value of Table > 1B.2 in [3] subclause 4.2.1.3.
    * Otherwise, _β~ed,k~_ is set such that _β~ed,k~_ /_β~c,C,j~_ is > the largest quantized value of Table 1B.2 in [3] subclause > 4.2.1.3, for which the condition _β~ed,k~_ ≤ _β~ed,\ k,i,uq~_ > holds.
```{=html}
``` \- For E-TFCI greater than _E-TFCI~ec,boost~_ ,
    -   If *β~ed,k,i,uq~*/*β~c,C,j~* is less than the smallest quantized
        > value of Table 1B.2B in \[3\] subclause 4.2.1.3, then the gain
        > factor of E-DPDCH~k~, *β~ed,k~* is set such that
        > *β~ed,k~*/*β~c,C,j~* is the smallest quantized value of Table
        > 1B.2B in \[3\] subclause 4.2.1.3.
    -   Otherwise, *β~ed,k~* is set such that *β~ed,k~*/*β~c,C,j~* is
        > the largest quantized value of Table 1B.2B in \[3\] subclause
        > 4.2.1.3, for which the condition *β~ed,k~* ≤ *β~ed,k,i,uq~*
        > holds.
If quantization is not applied, _β~ed,k~_ shall be set to _β~ed,\ k,i,uq.~_
When the E-DCH TTI is 10msec and the current frame is not compressed, but is a
retransmission for which the corresponding first transmission was compressed,
the gain factor used for the _k_ :th E-DPDCH for the _i_ :th E-TFC is derived
from _β~ed,R,i~_ as follows:
If E-DPDCH power extrapolation formula is configured
Else if E-DPDCH power interpolation formula is configured
with the exception that _β~ed,R,i~_ is set to 0 if $\left(
\frac{\frac{L_{e,\text{ref},2}}{L_{e,\text{ref},1}}\beta_{\text{ed},\text{ref},2}^{2}
- \beta_{\text{ed},\text{ref},1}^{2}}{K_{e,\text{ref},2} - K_{e,\text{ref},1}}
\right)\left( K_{e,i} - K_{e,\text{ref},1} \right) +
\beta_{\text{ed},\text{ref},1}^{2} \leq 0$
where _β~ed,ref~_ ,_β~ed,ref,1,~ , β~ed,ref~_ ~,2~, _L~e,ref~, K~e,ref~,
K~e,i~ ,L~,e,ref,1~ , L~e,ref,2~ , K~e,ref,1~ and K~e,ref,2\ ~_ are as defined
in subclause 5.1.2.5B.2.3 _,_ ∆~harq~ is as defined in [3] subclause 4.2.1.3,
and _L~e,I,i~ and N~slots,I~_ are as defined above.
For the _i_ :th E-TFC, the unquantized gain factor _β~ed,\ k,i,uq~_ for the
_k_ :th E-DPDCH (denoted E‑DPDCH~k~ in [3] subclause 4.2.1.3) shall be set to
$\sqrt{2} \times \beta_{\text{ed},R,i}$ if the spreading factor for E-DPDCH~k~
is 2 and to $\beta_{\text{ed},R,i}$ otherwise.
Quantization may be applied as follows:
  * For E-TFCI smaller than or equal to _E-TFCI~ec,boost~_ ,
    * If _β~ed,\ k,i,uq~_ /_β~c~_ is less than the smallest quantized > value of Table 1B.2 in [3] subclause 4.2.1.3, then the gain > factor of E-DPDCH~k~, _β~ed,k~_ is set such that > _β~ed,k~_ /_β~c~_ is the smallest quantized value of Table 1B.2 > in [3] subclause 4.2.1.3.
    * Otherwise, _β~ed,k~_ is set such that _β~ed,k~_ /_β~c~_ is the > largest quantized value of Table 1B.2 in [3] subclause > 4.2.1.3, for which the condition _β~ed,k~_ ≤ _β~ed,\ k,i,uq~_ > holds.
  * For E-TFCI greater than _E-TFCI~ec,boost~_ ,
    * If _β~ed,k,i,uq~_ /_β~c~_ is less than the smallest quantized > value of Table 1B.2B in [3] subclause 4.2.1.3, then the gain > factor of E-DPDCH~k~, _β~ed,k~_ is set such that > _β~ed,k~_ /_β~c~_ is the smallest quantized value of Table > 1B.2B in [3] subclause 4.2.1.3.
    * Otherwise, _β~ed,k~_ is set such that _β~ed,k~_ /_β~c~_ is the > largest quantized value of Table 1B.2B in [3] subclause > 4.2.1.3, for which the condition _β~ed,k~_ ≤ _β~ed,k,i,uq~_ > holds.
If quantization is not applied, _β~ed,k~_ shall be set to _β~ed,\ k,i,uq~_.
#### 5.1.2.5C Setting of the uplink DPCCH gain factor when no DPDCH is
configured
In the case that no DPDCH is configured, the gain factor _β~c~_ is equal to 1.
During a compressed frame, the gain factor _β~c,C,j~_ is also equal to 1.
#### 5.1.2.6 Maximum and minimum power limits
When E-DCH is not configured, in the case that the total UE transmit power
(after applying DPCCH power adjustments and gain factors) would exceed the
maximum allowed value, the UE shall apply additional scaling to the total
transmit power so that it is equal to the maximum allowed power. This
additional scaling shall be such that the power ratio between DPCCH and DPDCH
and also DPCCH and HS-DPCCH remains as required by sub-clause 5.1.2.5 and
5.1.2.5A.
When E-DCH is configured on a single frequency or E-DCH is configured on
multiple frequencies but Secondary_EDCH_Cell_Active is 0,
\- If the total UE transmit power (after applying DPCCH power adjustments and
gain factors) would exceed the maximum allowed value, the UE shall firstly
reduce all the E-DPDCH gain factors _β~ed,k~_ by an equal scaling factor to
respective values _β~ed,k,reduced~_ so that the total transmit power would be
equal to the maximum allowed power.
\- Also if _E-TFCI~i~_ is greater than _E-TFCI~ec,boost~_ , UE shall reduce
only E-DPDCH gain factors to respective values _β~ed,k,reduced~_ and E-DPCCH
is transmitted using original _β~ec~_ which is not recalculated according to
the reduced E-DPDCH gain factors**.** After calculating the reduced E-DPDCH
gain factors, if _E-TFCI~i~_ is smaller than or equal to _E-TFCI~ec,boost~_ ,
quantization according to table 1B.2 in [3] subclause 4.2.1.3 may be applied,
or if _E-TFCI~i~_ is greater than _E-TFCI~ec,boost~_ , quantization according
to table 1B.2B in [3] subclause 4.2.1.3 may be applied, where each
_β~ed,k,reduced~_ is quantized such that _β~ed,k~/β~c~_ is the largest
quantized value for which the condition _β~ed,k~_ ≤  _β~ed,k,reduced~_ holds.
In case a DPDCH is configured, if any _β~ed,k,reduced~/β~c~_ is less than the
smallest quantized value of Table 1B.2 in [3] subclause 4.2.1.3, DTX may be
used on that E-DPDCH (E-DPCCH is, however still transmitted using _β~ec~_). In
case no DPDCH is configured and regardless of the applied uplink modulation,
if any _β~ed,k,reduced~/β~c~_ is less than _β~ed,k,reduced,min~_ /_β~c~_ ,
that _β~ed,k~_ shall be set to _β~ed,k,min~_ such that _β~ed,k,min~/β~c~_ =
min (_β~ed,k,reduced,min~_ /_β~c~_ , _β~ed,k,original~/β~c~_), where
_β~ed,k,original~_ denotes the E-DPDCH gain factor before reduction and
_β~ed,k,reduced,min~_ is configurable by higher layers.
\- In the following cases, the UE shall then apply additional scaling to the
total transmit power so that it is equal to the maximum allowed power:
  * if a DPDCH is configured and the total UE transmit power would still exceed the maximum allowed value even though DTX is used on all E-DPDCHs;
  * if no DPDCH is configured and the total UE transmit power would still exceed the maximum allowed value even though _β~ed,k~_ is equal to _β~ed,k,min~ for all k_.
\- Any additional scaling of the total transmit power as described above shall
be such that the power ratio between DPCCH and DPDCH, between DPCCH and HS-
DPCCH, and between DPCCH and E-DPCCH, remains as required by sub-clauses
5.1.2.5, 5.1.2.5A and 5.1.2.5B.1, and such that the power ratio between each
E-DPDCH and DPCCH remains as required by _β~ed,k,min~/β~c~_ if DTX is not used
on E-DPDCH. Any slot-level scaling of _β~ed~_ or DTX of E-DPDCH as described
above is applied at layer 1 only and is transparent to higher layers.
When Secondary_EDCH_Cell_Active is 1,
  * If the total UE transmit power (after applying DPCCH power > adjustments and gain factors) would exceed the maximum allowed > value, the UE shall start by reducing all the E-DPDCH gain factors > _β~ed,k~_ on the frequency with highest DPCCH power by an equal > scaling factor to respective values _β~ed,k,reduced~_ so that the > total transmit power would be equal to the maximum allowed power.
  * Also if _E-TFCI~i~_ is greater than _E-TFCI~ec,boost~_ , UE shall > reduce only E-DPDCH gain factors to respective values > _β~ed,k,reduced~_ and E-DPCCH is transmitted using original > _β~ec~_ which is not recalculated according to the reduced E-DPDCH > gain factors. After calculating the reduced E-DPDCH gain factors, > if _E-TFCI~i~_ is smaller than or equal to _E-TFCI~ec,boost~_ , > quantization according to table 1B.2 in [3] subclause 4.2.1.3 > may be applied, or if _E-TFCI~i~_ is greater than > _E-TFCI~ec,boost~_ , quantization according to table 1B.2B in [3] > subclause 4.2.1.3 may be applied, where each _β~ed,k,reduced~_ is > quantized such that _β~ed,k~/β~c~_ is the largest quantized value > for which the condition _β~ed,k~_ ≤  _β~ed,k,reduced~_ holds.
  * If _β~ed,k,reduced~/β~c~_ is less than _β~ed,k,reduced,min~_ /_β~c~_ > then _β~ed,k~_ shall be set to _β~ed,k,min~_ such that > _β~ed,k,min~/β~c~_ = min (_β~ed,k,reduced,min~_ /_β~c~_ , > _β~ed,k,original~/β~c~_), where _β~ed,k,original~_ denotes the > E-DPDCH gain factor before reduction and _β~ed,k,reduced,min~_ is > individually configured by higher layers for each frequency.
  * The UE shall then apply the same procedure on the uplink frequency > with second highest DPCCH power.
  * If _β~ed,k,min~/β~c~_ = min (_β~ed,k,reduced,min~_ /_β~c~_ , > _β~ed,k,original~/β~c~_) for all activated uplink frequencies, any > additional scaling of the total transmit power shall be such that
  * the power ratio between DPCCH and HS-DPCCH, and between DPCCH and > E-DPCCH, for each activated uplink frequency remains as required > by sub-clauses 5.1.2.5, 5.1.2.5A and 5.1.2.5B.1, and such that the > power ratio between each E-DPDCH and DPCCH remains as required by > _β~ed,k,min~/β~c~_ and
  * the power ratio between DPCCH on the activated frequencies remains > unchanged.
Any scaling, and any reduction in the E-DPDCH gain factor as described above,
shall only be applied or changed at a DPCCH slot boundary. In order that the
total UE transmit power does not exceed the maximum allowed value the scaling
or E-DPDCH gain factor reduction shall be computed using the maximum HS-DPCCH
power transmitted in the next DPCCH slot. In the case that either an ACK or a
NACK transmission will start during the next DPCCH slot, the maximum HS-DPCCH
power shall be computed using one of the following:
(a) whichever of ∆~ACK~ and ∆~NACK~ will be used according to whether the
transmission will be ACK or NACK, _or_
(b) whichever of ∆~ACK~ and ∆~NACK~ is the largest.
When transmitting on a DPCH the UE is not required to be capable of reducing
its total transmit power below the minimum level required in [7]. However, it
may do so, provided that the power ratio between DPCCH and DPDCH and also
between DPCCH and HS-DPCCH remains as specified in sub clause 5.1.2.5 and
5.1.2.5A. Some further regulations also apply as follows: In the case that the
total UE transmit power (after applying DPCCH power adjustments and gain
factors) would be at or below the total transmit power in the previously
transmitted slot and also at or below the required minimum power specified in
[7], the UE may apply additional scaling to the total transmit power, subject
to the following restrictions:
\- The total transmit power after applying any additional scaling shall not
exceed the required minimum power, nor the total transmit power in the
previously transmitted slot;
\- The magnitude of any reduction in total transmit power between slots after
applying any additional scaling shall not exceed the magnitude of the
calculated power reduction before the additional scaling.
In the case that the total UE transmit power in the previously transmitted
slot is at or below the required minimum power specfied in [7] and the DPCCH
power adjustment and gain factors for the current slot would result in an
increase in total power, then no additional scaling shall be used (i.e. power
control shall operate as normal).
If the UE applies any additional scaling to the total transmit power as
described above, this scaling shall be included in the computation of any
DPCCH power adjustments to be applied in the next transmitted slot.
### 5.1.3 Void
## 5.2 Downlink power control
The transmit power of the downlink channels is determined by the network. In
general the ratio of the transmit power between different downlink channels is
not specified and may change with time. However, regulations exist as
described in the following subclauses.
Higher layer power settings shall be interpreted as setting of the total
power, i.e. the sum of the power from the two antennas in case of transmit
diversity.
### 5.2.1 DPCCH/DPDCH/F-DPCH
#### 5.2.1.1 General
The downlink transmit power control procedure controls simultaneously the
power of a DPCCH and its corresponding DPDCHs. The power control loop adjusts
the power of the DPCCH and DPDCHs with the same amount, i.e. the relative
power difference between the DPCCH and DPDCHs is not changed. In case of
F-DPCH, the power control loop adjusts the F-DPCH power. If multiple
frequencies are activated in the uplink, then the downlink transmit power
control procedure shall be followed independently for each associated downlink
frequency.
For DPCH, the relative transmit power offset between DPCCH fields and DPDCHs
is determined by the network. The TFCI, TPC and pilot fields of the DPCCH are
offset relative to the DPDCHs power by PO1, PO2 and PO3 dB respectively. The
power offsets may vary in time. The method for controlling the power offsets
within UTRAN is specified in [6]. The power offsets PO1, PO2 and PO3 do not
apply to F-DPCH.
#### 5.2.1.2 Ordinary transmit power control
##### 5.2.1.2.1 UE behaviour
The UE shall generate TPC commands to control the network transmit power and
send them in the TPC field of the uplink DPCCH. An example on how to derive
the TPC commands in given in Annex B.2.
The UE shall check the downlink power control mode (DPC_MODE) before
generating the TPC command:
\- if DPC_MODE = 0 : the UE sends a unique TPC command in each slot and the
TPC command generated is transmitted in the first available TPC field in the
uplink DPCCH. In case uplink DPCCH slot format #4 is used then UE may delay
transmitting generated TPC command to the next available TPC field
\- if DPC_MODE = 1 : the UE repeats the same TPC command over 3 slots and the
new TPC command is transmitted such that there is a new command at the
beginning of the frame, unless UE_DTX_DRX_Enabled is TRUE, in which case the
UE shall behave as for DPC_MODE=0.
The DPC_MODE parameter is a UE specific parameter controlled by the UTRAN.
The UE shall not make any assumptions on how the downlink power is set by
UTRAN, in order to not prohibit usage of other UTRAN power control algorithms
than what is defined in subclause 5.2.1.2.2.
##### 5.2.1.2.1.1 F-DPCH quality target control {#f-dpch-quality-target-
control .H6}
The UTRAN sets a quality target for the F-DPCH. The UE autonomously sets a SIR
target value and adjusts it in order to achieve the same quality as the
quality target set by UTRAN. The quality target is set as a downlink TPC
command error rate target value for the F-DPCH belonging to the radio link
from the HS-DSCH serving cell as signalled by the UTRAN. The UE shall set the
SIR target when the F-DPCH has been setup or reconfigured. It shall not
increase the SIR target value before the power control has converged on the
current value. The UE may estimate whether the power control has converged on
the current value, by comparing the averaged measured SIR to the SIR target
value. When UL_DTX_Active is TRUE, the UE shall ignore in the SIR target value
adjustment any TPC commands received in F-DPCH slot starting during an uplink
DPCCH slot which is in an uplink DPCCH transmission gap.
##### 5.2.1.2.2 UTRAN behaviour
Upon receiving the TPC commands UTRAN shall adjust its downlink DPCCH/DPDCH or
F-DPCH power accordingly. For DPC_MODE = 0, and for DPC_MODE=1 if
UE_DTX_DRX_Enabled is TRUE,UTRAN shall estimate the transmitted TPC command
TPC~est~ to be 0 or 1, and shall update the power every transmitted slot. If
DPC_MODE = 1 and UE_DTX_DRX_Enabled is FALSE, UTRAN shall estimate the
transmitted TPC command TPC~est~ over three slots to be 0 or 1, and shall
update the power every three slots.
After estimating the _k_ :th TPC command, UTRAN shall adjust the current
downlink power _P_(_k_ -1) [dB] to a new power _P_(_k_) [dB] according to the
following formula:
_P_(_k_) = _P_(_k_ \- 1) + _P~TPC~_(_k_) + _P~bal~_(_k_),
where _P~TPC~_(_k_) is the _k_ :th power adjustment due to the inner loop
power control, and _P~bal~_(_k_) [dB] is a correction according to the
downlink power control procedure for balancing radio link powers towards a
common reference power. The power balancing procedure and control of the
procedure is described in [6].
_P~TPC~_(_k_) is calculated according to the following.
If the value of _Limited Power Increase Used_ parameter is \'Not used\', then
$P_{\text{TPC}}(k) = \left{ \begin{matrix} \+ \Delta_{\text{TPC}} & \text{if}\
\text{TPC}_{\text{est}}(k) = 1 \ \- \Delta_{\text{TPC}} & \text{if}\
\text{TPC}_{\text{est}}(k) = 0 \ \end{matrix} \right.\ $ , [dB]. (1)
If the value of _Limited Power Increase Used_ parameter is \'Used\', then the
_k:_ th inner loop power adjustment shall be calculated as:
$P_{\text{TPC}}(k) = \left{ \begin{matrix} \begin{matrix} \+
\Delta_{\text{TPC}} \ 0 \ \- \Delta_{\text{TPC}} \ \end{matrix} &
\begin{matrix} \text{if\ TPC}_{\text{est}}(k) = 1\text{\ \ \ and\ \ \
}\Delta_{\text{sum}}(k) + \Delta_{\text{TPC}}  0].
\- The parameter Preamble Retrans Max [integer > 0].
\- The initial preamble power Preamble_Initial_Power.
\- The Power offset P p-m = P~message-control~ -- P~preamble~, measured in dB,
between the power of the last transmitted preamble and the control part of the
random-access message.
\- The set of Transport Format parameters. This includes the power offset
between the data part and the control part of the random-access message for
each Transport Format.
Note that the above parameters may be updated from higher layers before each
physical random access procedure is initiated.
At each initiation of the physical random access procedure, Layer 1 shall
receive the following information from the higher layers (MAC):
\- The Transport Format to be used for the PRACH message part.
\- The ASC of the PRACH transmission.
\- The data to be transmitted (Transport Block Set).
The physical random-access procedure shall be performed as follows:
1 Derive the available uplink access slots, in the next full access slot set,
for the set of available RACH sub-channels within the given ASC with the help
of subclauses 6.1.1. and 6.1.2. Randomly select one access slot among the ones
previously determined. If there is no access slot available in the selected
set, randomly select one uplink access slot corresponding to the set of
available RACH sub-channels within the given ASC from the next access slot
set. The random function shall be such that each of the allowed selections is
chosen with equal probability.
2 Randomly select a signature from the set of available signatures within the
given ASC. The random function shall be such that each of the allowed
selections is chosen with equal probability.
3 Set the Preamble Retransmission Counter to Preamble Retrans Max.
4 If the Preamble_Initial_Power is below the minimum level required in [7],
set the Commanded Preamble Power to a value, which shall be at or above the
Preamble_Initial_Power and at or below the required minimum power specified in
[7]. Otherwise set the parameter Commanded Preamble Power to
Preamble_Initial_Power.
5 In the case that the Commanded Preamble Power exceeds the maximum allowed
value, set the preamble transmission power to the maximum allowed power. In
the case that the Commanded Preamble Power is below the minimum level required
in [7], set the preamble transmission power to a value, which shall be at or
above the Commanded Preamble Power and at or below the required minimum power
specified in [7]. Otherwise set the preamble transmission power to the
Commanded Preamble Power. Transmit a preamble using the selected uplink access
slot, signature, and preamble transmission power.
6 If no positive or negative acquisition indicator (AI ≠ +1 nor --1)
corresponding to the selected signature is detected in the downlink access
slot corresponding to the selected uplink access slot:
6.1 Select the next available access slot in the set of available RACH sub-
channels within the given ASC.
6.2 Randomly select a new signature from the set of available signatures
within the given ASC. The random function shall be such that each of the
allowed selections is chosen with equal probability.
6.3 Increase the Commanded Preamble Power by ∆P~0~ = Power Ramp Step [dB]. If
the Commanded Preamble Power exceeds the maximum allowed power by 6dB, the UE
may pass L1 status (\"No ack on AICH\") to the higher layers (MAC) and exit
the physical random access procedure.
6.4 Decrease the Preamble Retransmission Counter by one.
6.5 If the Preamble Retransmission Counter > 0 then repeat from step 5.
Otherwise pass L1 status (\"No ack on AICH\") to the higher layers (MAC) and
exit the physical random access procedure.
7 If a negative acquisition indicator corresponding to the selected signature
is detected in the downlink access slot corresponding to the selected uplink
access slot, pass L1 status (\"Nack on AICH received\") to the higher layers
(MAC) and exit the physical random access procedure.
8 Transmit the random access message three or four uplink access slots after
the uplink access slot of the last transmitted preamble depending on the AICH
transmission timing parameter. Transmission power of the control part of the
random access message should be P p-m [dB] higher than the power of the last
transmitted preamble. Transmission power of the data part of the random access
message is set according to subclause 5.1.1.2.
9 Pass L1 status \"RACH message transmitted\" to the higher layers and exit
the physical random access procedure.
### 6.1.1 RACH sub-channels
A RACH sub-channel defines a sub-set of the total set of uplink access slots.
There are a total of 12 RACH sub-channels. RACH sub-channel #i (i = 0, ...,
11) consists of the following uplink access slots:
\- Uplink access slot #i leading by τ~p-a~ chips the downlink access slot #i
contained within the 10 ms interval that is time aligned with P-CCPCH frames
for which SFN mod 8 = 0 or SFN mod 8 = 1.
\- Every 12^th^ access slot relative to this access slot.
The access slots of different RACH sub-channels are also illustrated in Table
7.
Table 7: The available uplink access slots for different RACH sub-channels
* * *
SFN modulo 8 of corresponding P-CCPCH frame Sub-channel number  
0 1 2 3 4 5 6 7 8 9 10 11 0 0 1 2 3 4 5 6 7  
1 12 13 14 8 9 10 11 2 0 1 2 3 4 5 6 7  
3 9 10 11 12 13 14 8 4 6 7 0 1 2 3 4 5 5 8 9 10 11 12 13 14  
6 3 4 5 6 7 0 1 2 7 8 9 10 11 12 13 14
* * *
### 6.1.2 RACH access slot sets
The PRACH contains two sets of access slots as shown in Figure 2. Access slot
set 1 contains PRACH slots 0 -- 7 and starts τ~p-a~ chips before the downlink
P-CCPCH frame for which SFN mod 2 = 0. Access slot set 2 contains PRACH slots
8 - 14 and starts (τ~p-a~ --2560) chips before the downlink P-CCPCH frame for
which SFN mod 2 = 1.
Figure 2: PRACH access slot and downlink AICH relation (τ~p-a~ = 7680 chips)
## 6.1A Physical random access procedure for Enhanced Uplink in CELL_FACH
state and IDLE mode {#a-physical-random-access-procedure-for-enhanced-uplink-
in-cell_fach-state-and-idle-mode .list-paragraph}
The physical random access procedure described in this subclause is initiated
upon request from the MAC sublayer (cf. [9]).
Before the physical random-access procedure can be initiated, Layer 1 shall
receive the following information from the higher layers (RRC):
\- The preamble scrambling code.
\- The AICH_Transmission_Timing parameter [0 or 1].
\- The set of available signatures and the set of available RACH sub-channels
corresponding to E-DCH resources for each Access Service Class (ASC). Sub-
channels are defined in subclause 6.1.1.
\- The total number of E-DCH resources configured in the cell.
\- The power-ramping factor Power Ramp Step [integer > 0].
\- The parameter Preamble Retrans Max [integer > 0].
\- The initial preamble power Preamble_Initial_Power.
\- The Power offset Pp-e = P~dpcch~ -- P~preamble~, measured in dB, between
the power of the last transmitted preamble and the initial DPCCH transmission
power.
\- The number of TTIs in which only the uplink DPCCH is sent before the E-DCH
transmission may start
Note that the above parameters may be updated from higher layers before each
physical random access procedure is initiated.
At each initiation of the physical random access procedure, Layer 1 shall
receive the following information from the higher layers (MAC):
\- The ASC of the PRACH transmission.
The physical random-access procedure shall be performed as follows:
1 Derive the available uplink access slots, in the next full access slot set,
for the set of available RACH sub-channels within the given ASC with the help
of subclauses 6.1.1. and 6.1.2. Randomly select one access slot among the ones
previously determined. If there is no access slot available in the selected
set, randomly select one uplink access slot corresponding to the set of
available RACH sub-channels within the given ASC from the next access slot
set. The random function shall be such that each of the allowed selections is
chosen with equal probability.
2 Randomly select a signature from the set of available signatures within the
given ASC. The random function shall be such that each of the allowed
selections is chosen with equal probability.
3 Set the Preamble Retransmission Counter to Preamble Retrans Max.
4 If the Preamble_Initial_Power is below the minimum level required in [7],
set the Commanded Preamble Power to a value, which shall be at or above the
Preamble_Initial_Power and at or below the required minimum power specified in
[7]. Otherwise set the parameter Commanded Preamble Power to
Preamble_Initial_Power.
5 In the case that the Commanded Preamble Power exceeds the maximum allowed
value, set the preamble transmission power to the maximum allowed power. In
the case that the Commanded Preamble Power is below the minimum level required
in [7], set the preamble transmission power to a value, which shall be at or
above the Commanded Preamble Power and at or below the required minimum power
specified in [7]. Otherwise set the preamble transmission power to the
Commanded Preamble Power. Transmit a preamble using the selected uplink access
slot, signature, and preamble transmission power.
6 If no positive or negative acquisition indicator (AI ≠ +1 nor --1)
corresponding to the selected signature is detected in the downlink access
slot corresponding to the selected uplink access slot:
6.1 Select the next available access slot in the set of available RACH sub-
channels within the given ASC.
6.2 Randomly select a new signature from the set of available signatures
within the given ASC. The random function shall be such that each of the
allowed selections is chosen with equal probability.
6.3 Increase the Commanded Preamble Power by ∆P~0~ = Power Ramp Step [dB]. If
the Commanded Preamble Power exceeds the maximum allowed power by 6dB, the UE
may pass L1 status (\"No ack on AICH\") to the higher layers (MAC) and exit
the physical random access procedure.
6.4 Decrease the Preamble Retransmission Counter by one.
6.5 If the Preamble Retransmission Counter > 0 then repeat from step 5.
Otherwise pass L1 status (\"No ack on AICH\") to the higher layers (MAC) and
exit the physical random access procedure.
7 If a negative acquisition indicator on AICH corresponding to the selected
signature is detected in the downlink access slot corresponding to the
selected uplink access slot.
> 7.1 If no Extended Acquisition Indicator signature set is configured in the
> cell, pass L1 status ("Nack on AICH received") to the higher layers (MAC)
> and exit the physical random access procedure.
>
> 7.2 If an Extended Acquisition Indicator signature set is configured in the
> cell, detect which one of the defined Extended Acquisition Indicator
> signatures is present.
>
> 7.2.1 If the detected Extended Acquisition Indicator signature and
> modulation symbol corresponds to 'NACK' as defined in [1], pass L1 status
> ("Nack on AICH received") to the higher layers (MAC) and exit the physical
> random access procedure.
>
> 7.2.2 If the detected Extended Acquisition Indicator signature and
> modulation symbol do not correspond to 'NACK', pass L1 status ("Ack on AICH
> received") with the corresponding E-DCH resource index as defined in [1] to
> higher layers (MAC) and skip step 8.
>
> 8 If a positive acquisition indicator on AICH corresponding to the selected
> signature is detected in the downlink access slot corresponding to the
> selected uplink access slot, pass L1 status ("Ack on AICH received") with
> the default E-DCH resource index corresponding to the selected signature as
> defined in [1] to higher layers (MAC),
9 Start transmitting DPCCH (timing as specified in [1] and synchronisation
according to synchronisation procedure AA). The initial transmission power of
DPCCH prior to starting the E-DCH transmission should be\ Pp-e [dB] higher
than the power of the last transmitted preamble.
10 Proceed to transmitting E-DPCCH and E-DPDCH as instructed by MAC layer
after the defined number of TTIs of DPCCH only transmission has passed.
## 6.2 Void
# 6A HS-DSCH-related procedures
## 6A.1 General procedure
Scheduling and transport format selection is controlled by the MAC-hs or MAC-
ehs sublayer in the Node B [9].
The following parameters are signalled to the physical layer in the UE and the
Node B from higher layers:
1) HS-SCCH set to be monitored in the serving HS-DSCH cell
2) Repetition factor of ACK/NACK: N_acknack_transmit
3) Channel Quality Indicator (CQI) feedback cycle _k_
4) Repetition factor of CQI: N_cqi_transmit
5) Measurement power offset Γ
6) Status of preamble/postamble transmission: HARQ_preamble_mode
7) Status of 64QAM configuration
8) Set of P-CPICH and/or S-CPICH (which shall be transmitted on the same
scrambling code) that shall be used for HS-PDSCH demodulation in case the UE
is configured in MIMO mode
9) The number _N_ of dynamic single/dual CQI reports out of a sequence of _M_
CQI reports in case the UE is configured in MIMO mode (not applicable when
single-stream restriction is configured): _N_ _cqi_typeA, _M_ _cqi,
respectively
10) Set of transport block sizes configured for HS-SCCH-less operation
11) Set of HS-PDSCHs configured for HS-SCCH-less operation
12) Status variables HS_SCCH_LESS_STATUS and DTX_DRX_STATUS
13) Enabling_Delay
14) RRC protocol state (CELL_DCH, CELL_FACH, CELL_PCH or URA_PCH)
15) H-RNTI values (dedicated H-RNTI, common H-RNTI, BCCH specific H-RNTI) to
be monitored when the UE is configured to receive HS-DSCH in CELL_FACH or
CELL_PCH state
16) HS-DSCH paging system information, which includes the following
information when the UE is configured to receive HS-DSCH in URA_PCH state or
in CELL_PCH state:
    a.  Number of PCCH transmissions: The number of subframes used to
        transmit PAGING TYPE 1 as defined in \[5\].
    b.  HS-PDSCH Channelisation Code configured for HS-SCCH less paging
        operation
    c.  Transport Block Size: List of Transport Block Sizes
17) Status of MIMO configuration
18) HS-SCCH set to be monitored in a secondary serving HS-DSCH cell
19) HS-SCCH set to be monitored in one non-serving cell
20) Status of 'Support for different HS-SCCHs in contiguous TTIs'
If HS_SCCH_LESS_STATUS is TRUE then HS-SCCH_less_mode=1. Otherwise HS-
SCCH_less_mode=0.
HS-SCCH-less_Active shall be set to TRUE while HS-SCCH_less_mode=1 and HS-
SCCH-less operation is activated. Otherwise HS-SCCH_less_Active shall be set
to FALSE. HS-SCCH-less operation shall be activated at the time when HS-
SCCH_less_mode is set to 1, and may be further deactivated or activated by HS-
SCCH orders as specified in [2]. This ordered deactivation or activation of
the HS-SCCH-less operation is applied by the UE 12 slots after the end of the
HS-SCCH subframe delivering the order.
If the higher layers set DTX_DRX_STATUS to TRUE (as described in [5]) then
UE_DTX_DRX_Enabled is FALSE until Enabling_Delay radio frames have passed.
After the higher layers have set DTX_DRX_STATUS to TRUE (as described in [5])
and Enabling_Delay radio frames have passed then UE_DTX_DRX_Enabled is TRUE.
Otherwise UE_DTX_DRX_Enabled is FALSE.
If the UE is configured with a secondary serving HS-DSCH cell, then
Secondary_Cell_Enabled is 1, otherwise Secondary_Cell_Enabled is 0 and
Secondary_Cell_Active is 0. The secondary serving HS-DSCH cell shall be
activated at the time when Secondary_Cell_Enabled is changed from 0 to 1, or
Secondary_Cell_Enabled is 1 and the higher layers indicate a change of the
serving HS-DSCH cell, and may further be deactivated or activated by HS-SCCH
orders as specified in [2]. Secondary_Cell_Active shall be set to 1 while
Secondary_Cell_Enabled is 1 and the secondary serving HS-DSCH cell is
activated, otherwise Secondary_Cell_Active shall be set to 0. If
Secondary_Cell_Active is already equal to 1 when the UE receives an HS-SCCH
order for activation of the secondary serving HS-DSCH cell as specified in
[2], then the UE shall not change the status of Secondary_Cell_Active
regarding the contents of the order, but shall transmit the HARQ-ACK
acknowledging the HS-SCCH order.
If the UE is not configured with multiple uplink frequencies, HS-SCCH ordered
deactivation or activation of the secondary serving HS-DSCH cell is applied by
the UE 12 slots after the end of the HS-SCCH subframe delivering the order,
and any transient behaviour related to this change should take place before
this point in time. The corresponding change of the HS-DPCCH channel coding
scheme as specified in [2] is applied by the UE at the first HS-DPCCH subframe
boundary after the activation or deactivation has been applied. If the
secondary serving HS-DSCH cell is configured in a band that does not contain
the serving HS-DSCH cell, the maximum allowed interruption time for the
primary uplink frequency and serving HS-DSCH cell is 1 slot and the interrupt
shall take place during the next DL HS-SCCH slot after the end of the HS-DPCCH
slot that contains the HARQ-ACK information acknowledging the HS-SCCH order.
If the UE is configured with multiple uplink frequencies, HS-SCCH ordered
deactivation or activation of the secondary serving HS-DSCH cell is applied by
the UE 18 slots after the end of the HS-SCCH subframe delivering the order,
and any transient behaviour related to this change should take place before
this point in time. The corresponding change of the HS-DPCCH channel coding
scheme as specified in [2] is applied by the UE at the first HS-DPCCH subframe
boundary after the activation or deactivation has been applied.
### 6A.1.1 UE procedure for receiving HS-DSCH and HS-SCCH in the CELL_DCH
state
NOTE: The Node B procedure for transmitting the HS-DSCH and the HS-SCCH is
specified in subclause 6A.1.3.
In this sub-clause, sub-frame _n_ on the HS-SCCHs refers to the sub-frame
which is associated with sub-frame _n_ on the HS-PDSCH as defined in [1], and
sub-frame _n_ on the HS-DPCCH refers to the sub-frame which is related to sub-
frame _n_ on the HS-PDSCH as defined in [1].
If the UE did not detect consistent control information intended for this UE
on any of the HS-SCCHs in the HS-SCCH set in the immediately preceding
subframe _n_ \-- 1, the UE shall in sub-frame _n_ monitor all HS-SCCHs in the
HS-SCCH set. The maximum size of the HS-SCCH set in the serving HS-DSCH cell
is 4.
If 64QAM is not configured for the UE and 'Support for different HS-SCCHs in
contiguous TTIs' is false, then if the UE did detect consistent control
information intended for this UE in the immediately preceding subframe _n_ \--
1, it is sufficient in sub-frame _n_ to only monitor the same HS-SCCH used in
the immediately preceding subframe _n_ \-- 1. If 64QAM is configured for the
UE or 'Support for different HS-SCCHs in contiguous TTIs' is true, then if the
UE did detect consistent control information intended for this UE in the
immediately preceding subframe _n_ \-- 1, the UE shall in sub-frame _n_
monitor all HS-SCCHs in the HS-SCCH set. These rules apply regardless of the
value of HS-SCCH_less_mode.
If Secondary_Cell_Active is 1,
> \- The UE shall simultaneously monitor an HS-SCCH set in the secondary
> serving HS-DSCH cell, and receive HS-DSCH if it is scheduled in that cell.
> The maximum size of the HS-SCCH set in a secondary serving HS-DSCH cell is 4
> and the maximum number of HS-SCCHs monitored by the UE across both the
> serving HS-DSCH cell and the secondary serving HS-DSCH cell is 6.
>
> \- From the serving HS-DSCH cell, the UE shall be able to receive up to one
> HS-DSCH if MIMO mode is not configured or two HS-DSCHs if MIMO mode is
> configured or one HS-SCCH order.
>
> \- In addition, from the secondary serving HS-DSCH cell, the UE shall be
> able to simultaneously receive up to one HS-DSCH if MIMO mode is not
> configured or two HS-DSCHs if MIMO mode is configured or one HS-SCCH order.
>
> \- HS-SCCH-less HS-DSCH transmission shall not be used in a secondary
> serving HS-DSCH cell.
>
> \- The UE behaviour is unspecified in case contradictory HS-SCCH orders
> (i.e. orders for activation and deactivation of the same functionality) are
> received from the serving HS-DSCH cell and the secondary serving HS-DSCH
> cell during the same subframe.
The UE can be configured to simultaneously monitor a maximum of 1 HS-SCCH in
one non-serving cell. This HS-SCCH is only used for HS-SCCH orders that
indicate HS-DSCH serving cell change as defined in section 4.6C.2.2.1 in [2].
Upon successfully receiving an HS-SCCH order that indicates HS-DSCH serving
cell change from this non-serving cell, the UE shall be able to start
listening to the full configured HS-SCCH set from this new serving cell and
from the new secondary serving HS-DSCH cell if configured by higher layers, at
the activation time configured by higher layers if the activation time is not
equal to "now", or otherwise within 40 ms from the end of the subframe in
which the HS-SCCH order is received.
When the UE monitors HS-SCCHs, the UE shall only consider the control
information to be consistent if either:
\- the decoded \'channelization-code-set information\' is lower than or equal
to \'maximum number of HS-DSCH codes received\' in its UE capability and the
decoded \'modulation scheme information\' is valid in terms of its UE
capability,
or
\- the decoded \'channelization-code-set information\' and decoded 'modulation
scheme information' correspond to an indication of an HS-SCCH order as defined
in [2].
Control information for one UE shall not be transmitted from the serving cell
on more than one HS-SCCH in a single sub-frame.
If a UE detects that one of the monitored HS-SCCHs in sub-frame _n_ carries
consistent control information intended for this UE, the UE shall perform the
following:
\- If the decoded \'channelization-code-set information\' and decoded
'modulation scheme information' do not correspond to an indication of an HS-
SCCH order, start receiving the HS-PDSCHs indicated by this consistent control
information
> \- If the CRC of the HS-SCCH is OK:
  * If HS-SCCH_less_mode=1 and the TFRI value corresponds to the retransmissions of HS-SCCH-less operation, the transport block size information shall be derived from the signalled transport block size indicator as defined in [5] and [9].
  * Else if UE_DTX_DRX_Enabled is TRUE or HS-SCCH_less_mode=1 or Secondary_Cell_Enabled is not 0, and the 'channelization-code-set information' and 'modulation scheme information' correspond to an HS-SCCH order, the UE shall:
    * if the TFRI value corresponds to an HS-SCCH order
      * If the HS-SCCH order was sent by the serving HS-DSCH cell or the secondary serving HS-DSCH cell, transmit ACK information in the slot allocated to the HARQ-ACK in the corresponding HS-DPCCH sub-frame as defined in [1];
      * Process the HS-SCCH orders as described in subclauses 6A.1, 6B and 6C.4.
    * else, discard the information received on this HS-SCCH.
  * Else, the transport block size information shall be derived from the signalled TFRI value as defined in [9].
    * If the \'Hybrid-ARQ process information\' is not included in the set configured by upper layers, the UE shall discard the information received on this HS-SCCH and on the HS-PDSCHs.
> \- Else, if HS-SCCH_less_Active is TRUE, the UE may start receiving the HS-
> PDSCHs configured for HS-SCCH-less operation and attempt to decode the HS-
> DSCH bits based on the set of possible HS-DSCH transport block sizes
> configured for HS-SCCH-less operation. Otherwise, the UE shall discard the
> information received on this HS-SCCH and HS-PDSCH.
Otherwise, if the UE does not detect consistent control information intended
for this UE on any of the HS-SCCHs in its HS-SCCH sets, the UE shall perform
the following:
> \- the UE shall discard the information received on this HS-SCCH.
\- if HS-SCCH_less_Active is TRUE, the UE shall start receiving the HS-PDSCHs
configured for HS-SCCH-less operation and attempt to decode the HS-DSCH bits
based on the set of possible HS-DSCH transport block sizes configured for HS-
SCCH-less operation.
> \- otherwise, the UE shall discard the information received on the HS-
> PDSCHs.
If UL_DTX_Active is TRUE (see section 6C) and either of the following is true:
\- the UE detects consistent control information intended for this UE and the
TFRI value does not correspond to an HS-SCCH order, or
> \- the UE has successfully decoded HS-PDSCHs intended for this UE;
then, at the HS-DPCCH sub frame that contains or would contain the HARQ-ACK
corresponding to the HS-SCCH or to the HS-PDSCHs that generated the priority
change, the UE shall perform the following:
> \- set CQI_DTX_Priority to 1 and,
>
> \- reset the CQI nominal reporting timer to CQI_DTX_TIMER.
If HARQ_preamble_mode = 1 and the information received on HS-SCCH is not
discarded, the UE shall:
  * transmit a HARQ Preamble (PRE) in the slot allocated to HARQ-ACK in HS-DPCCH sub-frame _n_ \-- 1, unless an ACK or NACK or any combination of ACK and NACK is to be transmitted in sub-frame _n_ \-- 1 as a result of an HS-DSCH transmission earlier than sub-frame _n_ on the HS-PDSCH, and
  * if N_acknack_transmit > 1, the UE shall transmit a HARQ Preamble in the slot allocated to HARQ‑ACK in HS-DPCCH sub-frame _n_ \-- 2, unless an ACK or NACK or any combination of ACK and NACK is to be transmitted in sub-frame _n_ \-- 2 as a result of an HS-DSCH transmission earlier than sub-frame _n_ on the HS-PDSCH.
> The UE shall transmit the ACK/NACK information received from MAC-hs or MAC-
> ehs in the slot allocated to the HARQ-ACK in the corresponding HS-DPCCH sub-
> frame as defined in [1]. When _N_ acknack_transmit_ is greater than one, the
> UE shall:
>
> \- repeat the transmission of the ACK/NACK information over the next (_N_
> acknack_transmit-1_) consecutive HS-DPCCH sub-frames, in the slots allocated
> to the HARQ-ACK as defined in [1] and
>
> \- not attempt to receive any HS-SCCH in HS-SCCH subframes corresponding to
> HS-DPCCH sub-frames in which the ACK/NACK information transmission is
> repeated, nor to receive or decode transport blocks from the HS-PDSCH in HS-
> DSCH sub-frames corresponding to HS-DPCCH sub-frames in which the ACK/NACK
> information transmission is repeated.
>
> If ACK or NACK or any combination of ACK and NACK is transmitted in HS-DPCCH
> sub-frame _n_ , and HARQ_preamble_mode = 1 and UE InterTTI ≤
> _N_acknack_transmit_ , then the UE shall:
  * transmit a HARQ Postamble (POST) in the slot allocated to HARQ-ACK in HS-DPCCH subframe _n_ \+ 2* _N_acknack_transmit_ \-- 1, unless ACK or NACK or PRE or any combination of ACK and NACK is to be transmitted in this subframe, and
  * if _N_acknack_transmit_ > 1, transmit a HARQ Postamble (POST) in the slot allocated to HARQ-ACK in HS-DPCCH subframe _n_ \+ 2*_N_acknack_transmit_ \-- 2, unless an ACK or NACK or PRE or any combination of ACK and NACK is to be transmitted in this subframe.
DTX shall be used on the HS-DPCCH in the slot allocated to HARQ-ACK in the
corresponding HS-DPCCH subframe unless a HARQ-ACK message is to be transmitted
as described above.
### 6A.1.1A UE procedure for receiving HS-DSCH and HS-SCCH in CELL_FACH state
The HS-SCCH reception procedure is as defined in subclause 6A.1.1.
The UE shall perform these actions in the following order:
\- The UE shall monitor the first indexed HS-SCCH of the configured HS-SCCH
set with the BCCH specific H-RNTI.
> \- If the UE is configured with a dedicated H-RNTI, the UE shall monitor the
> HS-SCCHs of the configured HS-SCCH set with the dedicated H-RNTI. If the UE
> is not configured with a dedicated H-RNTI, the UE shall monitor the HS-SCCHs
> of the configured HS-SCCH set with the common H-RNTI as defined in [5].
If the UE detects that one HS-SCCH carries consistent control information
intended for this UE, the UE shall perform the following:
\- Start receiving the HS-PDSCHs indicated by this consistent control
information.
\- If the CRC of the HS-SCCH is OK, the transport block size information shall
be derived from the signalled TFRI value as defined in [9]. If the \'Hybrid-
ARQ process information\' is not included in the set configured by upper
layers, the UE shall discard the information received on this HS-SCCH and on
the HS-PDSCHs.
Unless indicated by higher layers, the UE shall not transmit any HARQ-ACK or
CQI information and DTX shall be used on all the HS-DPCCH subframes.
### 6A.1.1B UE procedure for receiving HS-DSCH and HS-SCCH in the URA_PCH and
CELL_PCH states
The HS-SCCH reception procedure is as defined in subclause 6A.1.1.
If the UE has detected a paging indication intended for this UE, the UE shall
perform the actions below:
In CELL_PCH state, if the UE is configured with a dedicated H-RNTI, the UE
shall perform these actions in the following order:
\- The UE shall monitor the first indexed HS-SCCH of the configured HS-SCCH
set with the BCCH specific H-RNTI.
\- The UE shall monitor the HS-SCCHs of the configured HS-SCCH set with the
dedicated H-RNTI.
If the UE is configured with a dedicated H-RNTI, and if the UE detects that
one HS-SCCH in a set of 5 associated HS-SCCH subframes (as defined in [1])
carries consistent control information intended for this UE, the UE shall
perform the following:
\- Start receiving the HS-PDSCHs indicated by this consistent control
information.
\- If the CRC of the HS-SCCH is OK, the transport block size information shall
be derived from the signalled TFRI value as defined in [9]. If the \'Hybrid-
ARQ process information\' is not included in the set configured by upper
layers, the UE shall discard the information received on this HS-SCCH and on
the HS-PDSCHs.
In CELL_PCH state, when the UE is configured to receive HS-DSCH without a
dedicated H-RNTI, or in URA_PCH state, the UE shall perform the following:
\- the UE shall start receiving the HS-PDSCH configured for HS-SCCH-less
operation and attempt to decode the HS-DSCH bits of the first associated HS-
DSCH sub-frame (as defined in [1]) and the subsequent repetitions in the
(Number of PCCH transmissions-1) next contiguous HS-DSCH subframes based on
the set of possible HS-DSCH Transport Block Sizes configured by higher layers.
The UE shall not transmit any HARQ-ACK or CQI information and DTX shall be
used on all the HS-DPCCH subframes.
### 6A.1.2 UE procedure for reporting channel quality indication (CQI) and
precoding control indication (PCI)
The UE procedure for reporting PCI/CQI is given in sub-clause 6A.1.2.1 for the
case when the UE is not configured in MIMO mode and in sub-clause 6A.1.2.2 for
the case when the UE is configured in MIMO mode.
If the UE is configured in MIMO mode in only one of the serving HS-DSCH cell
and the secondary serving HS-DSCH cell, then the overall PCI/CQI reporting
procedure shall be the same as if the UE was configured in MIMO mode as
specified in subclause 6A.1.2.2 except that a CQI value as defined in
subclause 6A.2.1 is derived and reported for the non-MIMO cell.
#### 6A.1.2.1 CQI reporting procedure in case the UE is not configured in MIMO
mode
With the exception of the provisions of subclause 6A.3, the following shall
apply when the UE is not configured in MIMO mode:
1) The UE derives the CQI value for the serving HS-DSCH cell as defined in
subclause 6A.2.1.
> If Secondary_Cell_Active is 1, the UE also derives a CQI value for the
> secondary serving HS-DSCH cell as defined in subclause 6A.2.1.
>
> The CQI report is constructed from the CQI value(s) as specified in [2].
2) For k = 0, the UE shall not transmit the CQI report.\ For k > 0 when
DTX_DRX_STATUS is not TRUE, the UE shall transmit the CQI report in each
subframe that starts _m_ ×256 chips after the start of the associated uplink
DPCCH frame with _m_ fulfilling:
${\left( 5 \times \text{CFN} + \left\lceil m \times
\text{256}\text{chip}/\text{7680}\text{chip} \right\rceil \right)\text{mod\
{}k}^{'} = 0$ with $k^{'} = k/(2\text{ms})$,
where CFN denotes the connection frame number for the associated DPCH and the
set of five possible values of _m_ is calculated as described in subclause 7.7
in [1].
> For k > 0 when DTX_DRX_STATUS is TRUE, the UE shall transmit the CQI report
> as specified in 6C.2 based on the CQI transmission pattern. The CQI
> transmission pattern is the set of HS-DPCCH subframes whose HS-DPCCH
> discontinuous transmission radio frame number CFN_DRX and subframe number
> S_DRX, both defined in 6C.3, verify:
((5*CFN_DRX - UE_DTX_DRX_Offset + S_DRX ) **MOD** k\') = 0, with $k^{'} =
k/(2\text{ms})$.
3) The UE shall repeat the transmission of the CQI report derived in 1) over
the next _(N_cqi_transmit -- 1)_ consecutive HS-DPCCH sub frames in the slots
respectively allocated to the CQI as defined in [1]. UE does not support the
case of $k^{'} 
number of simultaneously transmitted transport blocks that the UE > prefers
according to the current channel conditions assuming that > the preferred
primary precoding vector as indicated by the PCI > value signalled in the same
HS-DPCCH sub-frame would be applied at > the Node-B for the primary transport
block and in case two > transport blocks are preferred the precoding vector
orthogonal to > the preferred primary precoding vector would be applied for
the > secondary transport block. This type of CQI report contains >
information on either one transport format or a combination of two > transport
formats depending on what is currently the preferred > number of transport
blocks (either 1 or 2).
B. CQI reports that indicate the supported transport format for a > single
transmitted transport block according to the current > channel conditions
assuming that the preferred primary precoding > vector as indicated by the PCI
value signalled in the same > HS-DPCCH sub-frame would be applied at the
Node-B for the primary > transport block and that no secondary transport block
is > transmitted.
When UE is configured in MIMO mode and single-stream restriction is configured
only type B CQI report have to be supported by the UE.
With the exception of the provisions of subclause 6A.3, the following shall
apply when the UE is configured in MIMO mode:
1) The UE derives the PCI value for the serving HS-DSCH cell as defined in
subclause 6A.4 and when single-stream restriction is not configured either a
type A or a type B CQI value and when single-stream restriction is configured
type B CQI value for the serving HS-DSCH cell as defined in subclause 6A.2.2
depending on which type of CQI shall be reported as defined below.
> If Secondary_Cell_Active is 1, the UE also derives a PCI value for the
> secondary serving HS-DSCH cell as defined in subclause 6A.4 and when single-
> stream restriction is not configured either a type A or a type B CQI value
> and when single-stream restriction is configured type B CQI value for the
> secondary serving HS-DSCH cell as defined in subclause 6A.2.2 depending on
> which type of CQI shall be reported as defined below.
2)
a. For k = 0, the UE shall not transmit a composite PCI/CQI value.
b. For k > 0 when DTX_DRX_STATUS is not TRUE (see section 6A.1), the UE shall
transmit a composite PCI/CQI value for the serving HS-DSCH cell in each
subframe that starts _m_ ×256 chips after the start of the associated uplink
DPCCH frame with _m_ fulfilling
${\left( 5 \times \text{CFN} + \left\lceil m \times
\text{256}\text{chip}/\text{7680}\text{chip} \right\rceil \right)\text{mod\
{}k}^{'} = 0$ with $k^{'} = k/(2\text{ms})$, (x1)
> where CFN denotes the connection frame number for the associated DPCH and
> the set of five possible values of _m_ is calculated as described in
> subclause 7.7 in [1].
>
> When single-stream restriction is not configured and the relation
$\left\lfloor \frac{5 \times \text{CFN} + \left\lceil m \times
\text{256}\text{chip}/\text{7680}\text{chip} \right\rceil\ }{k^{'}}
\right\rfloor\text{mod}\ M\text{_cqi\ }\  holds, the UE shall report a type A CQI value. Otherwise the UE shall report
> a type B CQI value.
c. For k > 0 when DTX_DRX_STATUS is TRUE (see section 6A.1), the UE shall
transmit the CQI value for the serving HS-DSCH cell as specified in 6C.2 based
on the CQI transmission pattern. The CQI transmission pattern is the set of
HS-DPCCH subframes whose HS-DPCCH discontinuous transmission radio frame
number CFN_DRX and subframe number S_DRX, both defined in 6C.3, verify:
((5*CFN_DRX - UE_DTX_DRX_Offset + S_DRX ) mod k\') = 0, with $k^{'} =
k/(2\text{ms})$.
> When single-stream restriction is not configured and the relation
>
> holds, the UE shall report a type A CQI value. Otherwise the UE shall report
> a type B CQI value.
d. For k>0, the PCI value derived in 1) shall be transmitted together with the
CQI value as a composite PCI/CQI value. It should be noted that in case that
2560 is not an integer multiple of _M_ _cqi, the sequence of type A and type B
CQI reports might not always be periodic due to CFN roll-over.
3) The UE shall repeat the transmission of the composite PCI/CQI value for the
serving HS-DSCH cell derived above over the next _(N_cqi_transmit -- 1)_
consecutive HS-DPCCH sub frames in the slots respectively allocated to CQI as
defined in [1]. The UE does not support the case of $k^{'}  \- A UE shall decode E-HICH, E-RGCH or E-AGCH transmissions to the UE using
> all the slots which do not overlap a downlink transmission gap.
>
> \- The UE may discard E-HICH, E-RGCH or E-AGCH slots which overlap a
> downlink transmission gap.
# 6C Discontinuous transmission and reception procedures
Whether discontinuous uplink DPCCH transmission operation or discontinuous
downlink reception operation are applied is determined by the settings of
UL_DTX_Active and DL_DRX_Active as follows:
UL_DTX_Active shall be set to TRUE while UE_DTX_DRX_Enabled is TRUE and
discontinuous uplink DPCCH transmission is activated. Otherwise, UL_DTX_Active
shall be set to FALSE.
Discontinuous uplink DPCCH transmission shall be activated at the time when
UE_DTX_DRX_Enabled is set to TRUE, and may be further deactivated or activated
by layer 1 HS-SCCH orders (see section 6C.4).
DL_DRX_Active shall be set to TRUE while UE_DTX_DRX_Enabled is TRUE and
UL_DTX_Active is TRUE and discontinuous downlink reception is activated.
Otherwise, DL_DRX_Active shall be set to FALSE.
Discontinuous downlink reception shall be activated at the time when
UE_DTX_DRX_Enabled is set to TRUE, and may be further deactivated or activated
by layer 1 HS-SCCH orders (see section 6C.4).
The higher layers define the discontinuous transmission and reception
procedures using the following parameters:
For discontinuous UL DPCCH transmission:
**CQI_DTX_TIMER** : Specifies the number of subframes during which the CQI
reports have higher priority than the DTX pattern. This is the initial value
of CQI nominal reporting timer.
**UE_DTX_cycle_1** : Uplink DPCCH burst pattern length in subframes.
**UE_DTX_cycle_2** : Uplink DPCCH burst pattern length in subframes.
**Inactivity_Threshold_for_UE_DTX_cycle_2** : Defines a number of consecutive
E-DCH TTIs without an E-DCH transmission, after which the UE shall immediately
move from UE_DTX_cycle_1 to using UE_DTX_cycle_2.
**UE_DPCCH_burst_1** : Determines the Uplink DPCCH burst length in subframes,
when UE_DTX_cycle_1 is applied.
**UE_DPCCH_burst_2** : Determines the Uplink DPCCH burst length in subframes,
when UE_DTX_cycle_2 is applied.
**UE_DTX_long_preamble_length** : Determines in slots the length of the
preamble associated with the UE_DTX_cycle_2.
For both discontinuous UL DPCCH transmission and discontinuous downlink
reception:
**UE_DTX_DRX Offset** : Uplink DPCCH burst pattern and HS-SCCH reception
pattern offset in subframes.
**Enabling_Delay** : defined in [5], ensures that the uplink DPCCH and
downlink F-DPCH are transmitted continuously for Enabling_Delay radio frames
after DTX_DRX_STATUS is set to TRUE [or ensures]{.underline} that, with
DTX_DRX_STATUS set to TRUE[,]{.underline} the uplink DPCCH on the secondary
uplink frequency is transmitted continuously for Enabling_Delay radio frames
[after application of secondary uplink frequency activation]{.underline}.
For discontinuous downlink reception:
**UE_DRX cycle** : HS-SCCH reception pattern length in subframes.
**Inactivity_Threshold_for_UE_DRX_cycle** : Defines the number of subframes
after an HS-SCCH reception or after the first slot of an HS-PDSCH reception
(as defined in 6C.3) during which the UE is required to monitor the HS-SCCHs
in the UE's HS-SCCH set continuously with the exceptions of
N_acknack_transmit>1 or InterTTI>1.
**UE_DRX_Grant_Monitoring** : A Boolean which determines whether the UE is
required to monitor the E-AGCH transmissions from the serving E-DCH cell and
the E-RGCH from cells in the serving E-DCH radio link set when the conditions
in subclause 6C.3 are met.
## 6C.1 Uplink CQI transmission
When UL_DTX_Active is FALSE (see section 6C), the UE shall always transmit the
Channel-Quality Indication (CQI) in the CQI transmission pattern defined in
6A.1.2.
When UL_DTX_Active is TRUE (see section 6C), the UE shall perform the
following procedures:
  * The UE shall set the initial value of the variable CQI_DTX_Priority to 1.
  * Reset the \"CQI nominal reporting timer\" to CQI_DTX_TIMER **at the first HS-DPCCH subframe boundary.**
Afterwards, when UL_DTX_Active is TRUE, the UE sets the CQI_DTX_Priority based
on the status of a \"CQI nominal reporting timer\" which is counting down to
zero in HS-DPCCH subframes from the value CQI_DTX_TIMER which is configured by
higher layers.
The setting of CQI_DTX_Priority to 1 is described in subclause 6A.1.1.
Upon the expiration of the CQI nominal reporting timer, the UE shall set
CQI_DTX_Priority to 0.
CQI_DTX_Priority=0 indicates that CQI reports have lower priority than the
Uplink DPCCH burst pattern. If CQI_DTX_Priority is set to 0, the UE shall
transmit the Channel-Quality Indication (CQI), and all repeated CQI
transmissions (corresponding to the serving HS-DSCH cell and the secondary
serving HS-DSCH cell) according to the value of N_cqi_transmit, only if the
start of the CQI field corresponding to the serving HS-DSCH cell in the CQI
transmission pattern as defined in 6A.1.2 overlaps with a DPCCH transmission
burst of the Uplink DPCCH burst pattern as indicated in 6C.2.1.
CQI_DTX_Priority=1 indicates that CQI reports have higher priority than the
Uplink DPCCH burst pattern. If CQI_DTX_Priority is set to 1,
  * the UE shall always transmit the Channel-Quality Indication (CQI), in the CQI transmission pattern defined in 6A.1.2.
  * The repeated CQI transmissions according to the value of N_cqi_transmit are transmitted only if the start of the CQI field in the CQI transmission pattern, as defined in 6A.1.2, is transmitted.
## 6C.2 Discontinuous uplink DPCCH transmission operation
When UL_DTX_Active is FALSE (see section 6C) the UE shall transmit the uplink
DPCCH in each slot except in the slots overlapping a compressed mode
transmission gap.
When UL_DTX_Active is TRUE (see section 6C), in addition to the conditions
defined in 6C.5 the UE shall not transmit the uplink DPCCH in a slot on an
activated uplink frequency when all of the following conditions are met for
that uplink frequency:
  1. There is no HARQ-ACK transmission on HS-DPCCH as indicated in 6A.1 overlapping with the UL DPCCH slot,
  2. There is no CQI transmission on HS-DPCCH as indicated in 6C.1 overlapping with the UL DPCCH slot,
  3. There is no E-DCH transmission during the UL DPCCH slot,
  4. The slot is in a gap in the Uplink DPCCH burst pattern defined in 6C.2.1,
  5. The UL DPCCH preamble or postamble defined in 6C.2.2 is not transmitted in the slot.
  6. [Either the uplink frequency is a secondary uplink frequency where at least Enabling_Delay radio frames have passed since the activation of the secondary uplink frequency was applied, or it is a primary uplink frequency.]{.underline}
The procedures for the F-DPCH transmission and reception in case of
discontinuous uplink DPCCH operation are defined in sub-clause 5.1.
### 6C.2.1 Uplink DPCCH burst pattern
The Uplink DPCCH burst pattern and the uplink DPCCH preamble and postamble
(6C.2.2) together define the discontinuous uplink DPCCH operation.
The Uplink DPCCH burst pattern is illustrated in Figure 2A for 2ms E-DCH TTI
and Figure 2B for 10ms E-DCH TTI. The Uplink DPCCH burst pattern defines the
minimum set of slots where the UE shall transmit the UL-DPCCH.
The Uplink DPCCH burst pattern shall be derived as follows.
If there has not been any E-DCH transmission for the last
Inactivity_Threshold_for_UE_DTX_cycle_2 E-DCH TTIs, and at least this many
TTIs have passed since the end of the Enabling_Delay, then:
  * The transmission length in the Uplink DPCCH burst pattern shall be UE_DPCCH_burst_2 subframes.
  * The gap length following the DPCCH transmission burst in the Uplink DPCCH burst pattern shall be
    * (UE_DTX_cycle_2 -- UE_DPCCH_burst_2) subframes,
  * The first subframe in each Uplink DPCCH burst pattern shall be such that
    * the CFN and DPCCH subframe number S verify\ ((5*CFN - UE_DTX_DRX_Offset + S) **MOD** UE_DTX_cycle_2) = 0
Otherwise:
  * The transmission length in the Uplink DPCCH burst pattern shall be UE_DPCCH_burst_1 subframes.
  * The gap length following the DPCCH transmission burst in the Uplink DPCCH burst pattern shall be
    * (UE_DTX_cycle_1 -- UE_DPCCH_burst_1) subframes.
  * The first subframe in each Uplink DPCCH burst pattern shall be such that
    * the CFN and DPCCH subframe number S verify\ ((5*CFN - UE_DTX_DRX_Offset + S) **MOD** UE_DTX_cycle_1) = 0
In case the DTX cycle pattern changes during a transmission of an Uplink DPCCH
burst, the following shall apply:
  * the previously derived length of the Uplink DPCCH burst which has already been started shall not be affected by the change of the DTX cycle pattern.
```{=html}
``` \- if the UL DPCCH burst, which is derived according to the new DTX cycle
pattern, overlaps with the ongoing UL DPCCH burst, the non-overlapping portion
of the burst, if any, shall be transmitted.
```{=html}
``` \- the change in the DTX cycle pattern from UE_DTX_cycle_2 to
UE_DTX_cycle_1 shall occur only at the end of an E-DCH transmission.
NOTE: The E-DCH transmission start time after data transmission inactivity may
be restricted as described in [9] to allow discontinuous reception at Node B.
Figure 2A: Example for Uplink DPCCH burst pattern for 2ms E-DCH TTI beginning
at CFN=1 (with UE_DTX_DRX_Offset = 6)
Figure 2B: Example for Uplink DPCCH burst pattern for 10ms E-DCH TTI beginning
at CFN=1 (with UE_DTX_DRX_Offset = 5)
Note: Figures 2A and 2B do not show the application of preambles and
postambles as described in section 6C.2.2.
### 6C.2.2 Uplink DPCCH preamble and postamble
NOTE: The "uplink DPCCH preamble" specified in this subclause is not the same
as the "uplink DPCCH power control preamble" specified in clauses 4 and 5.
#### 6C.2.2.1 Uplink DPCCH preamble and postamble for the DPCCH only
transmission
If a UE will start a transmission of DPCCH based on the Uplink DPCCH burst
pattern at the start of slot s and finish its DPCCH transmission at the end of
slot t, the UE shall start the DPCCH transmission at the start of slot s-2 and
continue the DPCCH transmission till the end of slot t+1.
#### 6C.2.2.2 Uplink DPCCH preamble and postamble for the E-DCH transmission
If a UE will start a transmission of E-DPCCH and E-DPDCH on a E-DCH TTI, the
UE shall start the DPCCH transmission 2 slots prior to the E-DCH TTI and
continue the DPCCH transmission during the E-DCH TTI and consecutive E-DCH
TTIs and 1 slot after the last consecutive E-DCH TTI.
In addition, if there has not been any E-DCH transmission for the last
Inactivity_Threshold_for_UE_DTX_cycle_2 E-DCH TTIs, and if a UE will start a
transmission of E-DPCCH and E-DPDCH on a E-DCH TTI, the UE shall start the
DPCCH transmission UE_DTX_long_preamble_length slots prior to the E-DCH TTI
and continue the DPCCH transmission during the E-DCH TTI and consecutive E-DCH
TTIs and 1 slot after the last consecutive E-DCH TTI.
#### 6C.2.2.3 Uplink DPCCH preamble and postamble for the HS-DPCCH
transmission
If a UE will start a transmission of HARQ-ACK, the UE shall start the DPCCH
transmission 2 slots prior to the DPCCH slot that coincides with or overlaps
the start of the HARQ-ACK field, unless the HARQ-ACK transmission is an HARQ
Preamble (PRE) in an HS-DPCCH sub-frame _n_ \-- 2 as defined in subclause
6A.1.1. The UE shall continue the DPCCH transmission during the HARQ-ACK field
and until the end of the first full DPCCH slot after the end of the HARQ-ACK
field.
If a UE will start a transmission of CQI, the UE shall start the DPCCH
transmission 3 slots prior to the DPCCH slot that coincides with or overlaps
the start of the CQI field, and continue the DPCCH transmission during the CQI
field and until the end of the first full DPCCH slot after the end of the CQI
field.
In addition, if there has not been any E-DCH transmission for the last
Inactivity_Threshold_for_UE_DTX_cycle_2 E-DCH TTIs, and if a UE will start a
transmission of CQI, the UE shall start the DPCCH transmission
(UE_DTX_long_preamble_length + 1) slots prior to the DPCCH slot that coincides
with or overlaps the start of the CQI field, and continue the DPCCH
transmission during the CQI field and until the end of the first full DPCCH
slot after the end of the CQI field. If the transmission of the CQI is not
known to the UE in advance due to the change of CQI_DTX_Priority from 0 to 1,
or due to the change from UE_DTX_cycle_1 to UE_DTX_cycle_2, the preamble for
the first CQI after the change may start late resulting in a shorter preamble.
## 6C.3 Discontinuous downlink reception
The HS-SCCH reception pattern is derived from a discontinuous reception
subframe numbering as follows.
The discontinuous HS-SCCH reception subframe numbering is such that:
\- A HS-SCCH discontinuous reception radio frame is 10 ms long and is indexed
using CFN_DRX.
\- The start of the HS-SCCH discontinuous reception radio frame of CFN_DRX n
is aligned with the start of the HS-SCCH subframe that starts τ~DRX~ chips
after the start of the associated downlink F-DPCH of CFN n where $-
\text{3840}\text{chips} \leq \tau_{\text{DRX}}\text{\ -}T_{0}  transmission as specified in subclause 6B.
  2. The UE shall monitor the HS-SCCH subframes in the HS-SCCH reception > pattern.
  3. The UE shall receive an HS-PDSCH subframe as specified in sub-clause > 6A.
  4. The UE has received an HS-SCCH or an HS-PDSCH subframe during the > last Inactivity_Threshold_for_UE_DRX_cycle subframes which > was not an HS-SCCH order.
  5. The UE shall monitor E-AGCH transmission from the serving E-DCH cell > in the following cases:
     * If UE_DRX_Grant_Monitoring is TRUE and the E-AGCH subframe (in case of a 2ms TTI) or frame (in case of a 10ms TTI) overlaps with the start of an HS-SCCH reception subframe as defined in the HS-SCCH reception pattern,
     * When conditions defined in subclause 11.8.1.8 of [9] are fulfilled.
  6. The UE shall monitor E-RGCH transmission from a cell in the serving > E-DCH radio link set in the following cases:
     * If UE_DRX_Grant_Monitoring is TRUE and the corresponding subframe (in case of a 2ms TTI) or frame (in case of a 10ms TTI) of the serving cell E-RGCH overlaps with the start of an HS-SCCH reception subframe as defined in the HS-SCCH reception pattern.
     * When conditions defined in subclause 11.8.1.8 of [9] are fulfilled.
  7. The UE shall monitor the E-RGCH(s) from all the other cells in the > E-DCH active set, except from the cells in the serving E-DCH radio > link set, in the following case:
  8. When conditions defined as determined in subclause 11.8.1.8 of [9] > are fulfilled.
The HS-SCCH reception pattern is illustrated by Figure 2C for a 2ms E-DCH TTI.
The grey subframes correspond to the HS-SCCH reception pattern UE_DRX_cycle=4.
{width="6.688888888888889in" height="3.0284722222222222in"}Figure 2C: Example
for HS-SCCH reception pattern, 2ms E-DCH TTI
The HS-SCCH reception pattern is illustrated by Figure 2D for a 10 ms TTI
E-DCH. The grey subframes correspond to the HS-SCCH reception pattern
_UE_DRX_cycle_ =5.
{width="6.686805555555556in" height="3.0506944444444444in"}Figure 2D: Example
for HS-SCCH reception pattern, 10ms E-DCH TTI
## 6C.4 HS-SCCH orders
The Node B may activate and deactivate the discontinuous downlink reception
operation and discontinuous uplink DPCCH transmission operation through
physical layer commands transmitted on one of the HS-SCCH in the HS-SCCH set
as specified in [2] and in subclause 6A.1.1.
  * The activation and deactivation of the discontinuous uplink DPCCH transmission operation is applied by the UE at the earliest E-DCH TTI boundary coinciding with or following the beginning of the HS-DPCCH subframe containing the HARQ-ACK corresponding to the order.
  * The activation and deactivation of the discontinuous downlink reception operation is applied by the UE 12 slots after the ending of the HS-SCCH subframe delivering the order.
  * The activation and deactivation shall affect all frequencies configured to the UE.
## 6C.5 Operation during compressed mode
When in compressed mode, the UE shall behave according to subclauses 6A.3 and
6B.4 including the following rules.
The uplink discontinuous transmission operation is not impacted by the
compressed mode in the radio frames that do not overlap an uplink compressed
mode transmission gap as defined in subclause 6.1.1 of [4].
In radio frames that overlap an uplink compressed mode transmission gap as
defined in subclause 6.1.1 of [4], the uplink DPCCH shall be transmitted in
all slots in the radio frame that do not overlap the uplink compressed mode
transmission gap if either of the following is true:
  * an uplink DPCCH transmission defined by the Uplink DPCCH burst pattern according to subclause 6C.2.1 overlaps an uplink compressed mode transmission gap, or
  * an uplink DPCCH preamble or postamble according to subclause 6C.2.2 corresponding to an uplink DPCCH transmission defined by the Uplink DPCCH burst pattern overlaps an uplink compressed mode transmission gap.
If the 2 bullets above are not true, the following are not affected by
compressed mode:
  * uplink DPCCH transmission according to Uplink DPCCH burst patterns defined in subclause 6C.2.1,
  * uplink DPCCH preamble transmission corresponding to an uplink DPCCH transmission defined by the Uplink DPCCH burst pattern,
  * uplink DPCCH postamble transmission corresponding to an uplink DPCCH transmission defined by the Uplink DPCCH burst pattern.
If part of an uplink DPCCH preamble or postamble corresponding to an E-DCH or
HS-DPCCH transmission overlaps an uplink compressed mode transmission gap,
then that part of the preamble or postamble shall not be transmitted.
If an HS-SCCH subframe in the HS-SCCH reception pattern for downlink
discontinuous reception according to subclause 6C.3 overlaps with a downlink
compressed mode transmission gap, the following is true:
  * the reception of an HS-SCCH subframe is postponed to the first full HS-SCCH subframe after the downlink compressed mode transmission gap.
  * if UE_DRX_Grant_Monitoring is TRUE and the conditions defined in subclause 11.8.1.8 of [9] are not fulfilled, the UE may discard the E-AGCH and E-RGCH subframe (in case of 2ms TTI) or frame (in case of 10ms TTI) that overlaps with the start of the postponed HS-SCCH subframe.
Note that the compressed mode parameters (see [5]) "UL compressed mode
method", "DL compressed mode method" and "scrambling code change" have no
effect on the UE behaviour while DTX_DRX_STATUS is TRUE.
# 7 Closed loop mode 1 transmit diversity
The general transmitter structure to support closed loop mode transmit
diversity for DPCH transmission is shown in figure 3. Channel coding,
interleaving and spreading are done as in non-diversity mode. The spread
complex valued signal is fed to both TX antenna branches, and weighted with
antenna specific weight factors _w~1\ ~_ and _w~2~_. The weight factor _w~1~_
is a constant scalar and the weight factor _w~2~_ is complex valued signal.
The weight factor _w~2~_ (actually the corresponding phase adjustment) is
determined by the UE, and signalled to the UTRAN access point (i.e. cell
transceiver) using the FBI field of uplink DPCCH.
For the closed loop mode 1 different orthogonal dedicated pilot symbols in the
DPCCH are sent on the 2 different antennas.
Figure 3: The generic downlink transmitter structure to support closed loop
mode transmit diversity for DPCH transmission.
Closed loop mode 1 characteristics are summarised in the Table 8. The use of
the closed loop mode 1 is controlled via higher layer signalling.
Table 8: Summary of number of feedback information bits per slot, N~FBD~,
feedback command length in slots, N~W~, feedback command rate, feedback bit
rate, number of phase bits, N~ph~, per signalling word, number of amplitude
bits, N~po,~ per signalling word and amount of constellation rotation at UE
for the closed loop mode 1.
* * *
N~FBD~ N~W~ Update rate Feedback bit rate N~po~ N~ph~ Constellation rotation 1
1 1500 Hz 1500 bps 0 1 π/2
* * *
## 7.1 General procedure
The UE uses the CPICH to separately estimate the channels seen from each
antenna.
Once every slot, the UE computes the phase adjustment, _φ_ , that should be
applied at the UTRAN access point to maximise the UE received power. During
soft handover, the UE computes the phase adjustment to maximise the total UE
received power from the cells in the active set. In the case that a HS-PDSCH
is associated with a DPCH for which closed loop mode 1 is applied, the antenna
weights applied to the HS-PDSCH, are the same as the antenna weights applied
to the associated DPCH. In case a HS-PDSCH is associated with a DPCH during
soft handover, the UE may emphasize the radio link transmitted from HS-DSCH
serving cell, respectively, when calculating the antenna weights. An example
of how the computations can be accomplished is given in Annex A.2.
The UE feeds back to the UTRAN access point the information on which
phase/power settings to use. Feedback Signalling Message (FSM) bits are
transmitted in the FBI field of uplink DPCCH slot(s) (see [1]). Each message
is of length _N~W~_ = _N~po~_ +_N~ph~_ bits and its format is shown in the
figure 4. The transmission order of bits is from MSB to LSB, i.e. MSB is
transmitted first. FSM~po~ and FSM~ph~ subfields are used to transmit the
power and phase settings, respectively.
Figure 4: Format of feedback signalling message. FSM~po~ transmits the power
setting and FSM~ph~ the phase setting.
The adjustments are made by the UTRAN Access Point at the beginning of the
downlink DPCCH pilot field. The downlink slot in which the adjustment is done
is signalled to L1 of UE by higher layers. Two possibilities exist:
1) When feedback command is transmitted in uplink slot _i_ , which is
transmitted approximately 1024 chips in offset from the received downlink slot
_j_ , the adjustment is done at the beginning of the pilot field of the
downlink slot (_j_ +1) mod 15.
2) When feedback command is transmitted in uplink slot _i_ , which is
transmitted approximately 1024 chips in offset from the received downlink slot
_j_ , the adjustment is done at the beginning of the pilot field of the
downlink slot (_j_ +2) mod 15.
Thus, adjustment timing at UTRAN Access Point is either according to 1) or 2)
as controlled by the higher layers.
In case of soft handover, Layer 1 shall support different adjustment timing
values for different radio links in the same active set.
The timing of the weight adjustment of the HS-PDSCH is such that the HS-PDSCH
weight adjustment is done at the HS-PDSCH slot border, respectively, M chips
after the adjustment of the associated DPCH, where 0 ≤ M \
\text{ln}\left( \frac{\overline{p}(\varphi_{\text{Rx}} =
\pi)}{\overline{p}(\varphi_{\text{Rx}} = 0)} \right)$
Then define the variable x~0~ as 0 if the above inequality holds good and x~0~
= π otherwise.
Similarly consider
then define the variable x~1~ as -π/2 if the above inequality holds good and
x~1~ = π/2 oherwise.
Whether x~0~ or x~1~ is to be calculated for each slot is given by the
following table , where the first row contains the UL slot index of the
feedback bit to be verified.
* * *
UL 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 x~0~ x~1~ x~0~ x~1~ x~0~ x~1~ x~0~ x~1~
x~0~ x~1~ x~0~ x~1~ x~0~ x~1~ x~0~
* * *
The estimate for the transmitted phase is now obtained from
$\text{sin}(\varphi_{\text{Tx}}) + j\text{cos}(\varphi_{\text{Tx}}) =
\frac{\sum_{i = 0}^{1}{\text{sin}(x_{i})}}{\sqrt{2}} + j\frac{\sum_{i =
0}^{1}{\text{cos}(x_{i})}}{\sqrt{2}}$
where:
\- the x~i~ ­values are used corresponding to the current slot and the
previous slot taking into account the end-of-frame adjustment and the used CL
timing adjustment delay
\- $h_{2,i}^{(p)}$is the _i_ \'th estimated channel tap of antenna 2 using the
CPICH;
\- $h_{2,i}^{(d)}$is the _i_ \'th estimated channel tap of antenna 2 using the
DPCCH;
− γ _^2^_ is the DPCH Pilot SNIR/ CPICH SNIR;
\- $\sigma_{i}^{2}$is the noise plus interference power on the _i_ \'th path.
In normal operation the _a priori_ probability for selected pilot pattern is
assumed to be 96% (assuming there are 4% of errors in the feedback channel for
power control and antenna selection).
## A.2 Computation of feedback information for closed loop mode 1 transmit
diversity
In non-soft handover case, the computation of feedback information can be
accomplished by e.g. solving for weight vector, _[w,]{.underline}_ that
maximises.
_P=[w]{.underline}^H^H^H^H[w]{.underline}_ (1)
where
H=[_[h]{.underline}~1~_ _[h]{.underline}~2~_] and [w]{.underline} = [ w~1~,
w~2~ ]^T^
and where the column vectors _[h]{.underline}~1~_ and _[h]{.underline}~2~_
represent the estimated channel impulse responses for the transmission
antennas 1 and 2, of length equal to the length of the channel impulse
response. The elements of [w]{.underline} correspond to the adjustments
computed by the UE.
During soft handover, the antenna weight vector, _[w]{.underline}_ can be, for
example, determined so as to maximise the criteria function:
_P_ = [w]{.underline}^H^(H~1~^H^H~1~+ H~2~^H^H~2~+⋅⋅⋅⋅)[w]{.underline} (2)
where _H~i~_ is an estimated channel impulse response for BS#i. In regular
SHO, the set of BS#i corresponds to the active set.
If HS-PDSCH is present, the UE may emphasize the HS-PDSCH serving cell. In
this case the antenna weight vector, _[w]{.underline}_ can be, for example,
determined so as to maximise the criteria function:
_P_ = [w]{.underline}^H^(α(H~1~^H^H~1~)+
(1-α)(H~2~^H^H~2~+⋅⋅⋅⋅))[w]{.underline}
where BS#1 is the HS-PDSCH serving cell and coefficient α is less than or
equal to 1. For example α = 0.7 enhances HS-DSCH performance while ensuring
that there is only a small degradation on the DPCH.
###### ## Annex B (Informative): Power control
# B.1 Downlink power control timing
The power control timing described in this annex should be seen as an example
on how the control bits have to be placed in order to permit a short TPC
delay.
In order to maximise the cell radius distance within which one-slot control
delay is achieved, the frame timing of an uplink DPCH is delayed by 1024 chips
from that of the corresponding downlink DPCH measured at the UE antenna.
Responding to a downlink TPC command, the UE shall change its uplink DPCH
output power at the beginning of the first uplink pilot field after the TPC
command reception. Responding to an uplink TPC command, the UTRAN access point
shall change its DPCH output power at the beginning of the next downlink pilot
field after the reception of the whole TPC command. Note that in soft
handover, the TPC command is sent over one slot when DPC_MODE is 0 and over
three slots when DPC_MODE is 1. Note also that the delay from the uplink TPC
command reception to the power change timing is not specified for UTRAN. The
UE shall decide and send TPC commands on the uplink based on the downlink SIR
measurement. For the DPCH, the TPC command field on the uplink starts, when
measured at the UE antenna, 512 chips after the end of the downlink pilot
field. The UTRAN access point shall decide and send TPC commands based on the
uplink SIR measurement. However, the SIR measurement periods are not specified
either for UE nor UTRAN.
Figure B.1 illustrates an example of transmitter power control timings when a
DPCH is configured on the downlink.
Figure B.1: Transmitter power control timing for DPCH
Figure B.2 illustrates an example of transmitter power control timings when
the F-DPCH is configured on the downlink and the F-DPCH TPC offset N~OFF1~ of
all the radio links in the RLS is 0 or 2(see Table 16C of [1]). Figure B.2a
illustrates an example of transmitter power control timings for the radio link
whose F-DPCH TPC offset N~OFF1~ = 0 or 2, when the F-DPCH is configured on the
downlink, and the F-DPCH TPC offset N~OFF1~ of at least one other radio link
in the RLS is > 2\. Figure B.3 illustrates an example of transmitter power
control timings when the F-DPCH is configured on the downlink and the F-DPCH
TPC offset N~OFF1~ of the radio link is larger than 2. Figure B.4 illustrates
an example of transmitter power control timings when the F-DPCH is configured
on the downlink and the F-DPCH TPC offset N~OFF1~ of the radio link is larger
than 14 when uplink DPCCH slot format #4 is used.
Figure B.2: Transmitter power control timing for F-DPCH with TPC offsets
N~OFF1~ of 0 or 2 when F-DPCH TPC offset N~OFF1~ of all the radio links in the
RLS is 0 or 2
Figure B.2a: Transmitter power control timing for F-DPCH with TPC offsets
N~OFF1~ of 0 or 2 when the F-DPCH TPC offset N~OFF1~ of at least one other
radio link in the RLS is > 2
Figure B.3: Transmitter power control timing for F-DPCH with a TPC offset
N~OFF1~ larger than 2
Figure B.4: Transmitter power control timing for F-DPCH with a TPC offset
N~OFF1~ larger than 14 with uplink DPCCH slot format #4
# B.2 Example of implementation in the UE
The downlink inner-loop power control adjusts the network transmit power in
order to keep the received downlink SIR at a given SIR target, SIR~target~. A
higher layer outer loop adjusts SIR~target~ independently for each connection.
The UE should estimate the received downlink DPCCH/DPDCH power of the
connection to be power controlled. Simultaneously, the UE should estimate the
received interference and calculate the signal-to-interference ratio,
SIR~est~. SIR~est~ can be calculated as RSCP/ISCP, where RSCP refers to the
received signal code power on one code and ISCP refers to the non-orthogonal
interference signal code power of the received signal on one code. Note that
due to the specific SIR target offsets described in [5] that can be applied
during compressed frames, the spreading factor shall not be considered in the
calculation of SIR~est~.
The obtained SIR estimate SIR~est~ is then used by the UE to generate TPC
commands according to the following rule: if SIR~est~ > SIR~target~ then the
TPC command to transmit is \"0\", requesting a transmit power decrease, while
if SIR~est~ \< SIR~target~ then the TPC command to transmit is \"1\",
requesting a transmit power increase.
When the UE is in soft handover, the UE should estimate SIR~est~ from the
downlink signals of all cells in the active set.
# B.3 UL power control when losing UL synchronisation
Each Node B operates the uplink power control independently of the other Node
Bs that may be providing RLS to the same UE. In case of multiple RLS the UE
derives the decision on power adjustment based on all the commands received
according the rules specified in section 5.1.2. In this scenario, transmission
of a down command by one or more of the involved Node Bs will likely result in
the UE decreasing its transmit power.
Consequently, if and when, after successful initial RL synchronisation, the
Node B loses UL synchronisation for a UE and if the current number of RLS
configured for that UE is greater than one and if the Node B reverts to a TPC
pattern in such situation (i.e. generates DL TPC commands independently of
actual RL measurements), the Node B should not use TPC commands "0" in the TPC
pattern.
###### ## Annex C (Informative): Cell search procedure
During the cell search, the UE searches for a cell and determines the downlink
scrambling code and frame synchronisation of that cell. The cell search is
typically carried out in three steps:
##### Step 1: Slot synchronisation {#step-1-slot-synchronisation .H6}
During the first step of the cell search procedure the UE uses the SCH's
primary synchronisation code to acquire slot synchronisation to a cell. This
is typically done with a single matched filter (or any similar device) matched
to the primary synchronisation code which is common to all cells. The slot
timing of the cell can be obtained by detecting peaks in the matched filter
output.
##### Step 2: Frame synchronisation and code-group identification
{#step-2-frame-synchronisation-and-code-group-identification .H6}
During the second step of the cell search procedure, the UE uses the SCH's
secondary synchronisation code to find frame synchronisation and identify the
code group of the cell found in the first step. This is done by correlating
the received signal with all possible secondary synchronisation code
sequences, and identifying the maximum correlation value. Since the cyclic
shifts of the sequences are unique the code group as well as the frame
synchronisation is determined.
##### Step 3: Scrambling-code identification {#step-3-scrambling-code-
identification .H6}
During the third and last step of the cell search procedure, the UE determines
the exact primary scrambling code used by the found cell. The primary
scrambling code is typically identified through symbol-by-symbol correlation
over the CPICH with all codes within the code group identified in the second
step. After the primary scrambling code has been identified, the Primary CCPCH
can be detected. And the system- and cell specific BCH information can be
read.
If the UE has received information about which scrambling codes to search for,
steps 2 and 3 above can be simplified.
#
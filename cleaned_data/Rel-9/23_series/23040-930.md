# Foreword
This Technical Specification (TS) has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
The Short Message Service (SMS) provides a means of sending messages of
limited size to and from GSM/UMTS mobiles. The provision of SMS makes use of a
Service Centre, which acts as a store and forward centre for short messages.
Thus a GSM/UMTS PLMN needs to support the transfer of short messages between
Service Centres and mobiles.
Mobile originated messages shall be transported from an MS to a Service
Centre. These may be destined for other mobile users, or for subscribers on a
fixed network. Mobile terminated messages shall be transported from a Service
Centre to an MS. These may be input to the Service Centre by other mobile
users (via a mobile originated short message) or by a variety of other
sources, e.g. speech, telex, or facsimile.
# 1 Scope
The present document describes the Short Message Service (SMS) for GSM/UMTS
networks. It defines:
\- the services and service elements;
\- the network architecture;
\- the Service Centre functionality;
\- the SMS Router functionality;
\- the MSC functionality (with regard to the SMS);
\- the SGSN functionality (with regard to the SMS);
\- the routing requirements;
\- the protocols and protocol layering;
for the Mobile Originated and Mobile Terminated Short Message Service
Teleservices, as specified in 3GPP TS 22.003 [2] and 3GPP TS 22.105 [32].
The use of radio resources for the transfer of short messages between the MS
and the MSC or the SGSN is described in 3GPP TS 24.011 [13].
The network aspects of Short Message Service provision are outside the scope
of the present document (i.e. the provision of network connectivity between
the PLMN subsystems). There is no technical restriction within the present
document for the transfer of short messages between different PLMNs. Any such
restriction is likely to be subject to commercial arrangements and PLMN
operators must make their own provision for interworking or for preventing
interworking with other PLMNs as they see fit.
The required and assumed network service offered to the higher layers is
defined in the present document.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non-specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] Void
[2] 3GPP TS 22.003: \" Circuit Teleservices supported by a Public Land Mobile
Network (PLMN)\".
[3] 3GPP TS 22.004: \"General on supplementary services\".
[4] 3GPP TS 22.041: \"Operator Determined Barring (ODB)\".
[5] 3GPP TS 23.002: \"Network architecture\".
[6] 3GPP TS 23.008: \"Organization of subscriber data\".
[7] 3GPP TS 23.011: \"Technical realization of supplementary services\".
[8] 3GPP TS 23.015: \"Technical realization of Operator Determined Barring
(ODB)\".
[9] 3GPP TS 23.038: \"Alphabets and language‑specific information\".
[10] 3GPP TS 23.041: \"Technical realization of Cell Broadcast Service
(CBS)\".
[11] Void
[12] 3GPP TS 44.008: \"Mobile radio interface layer 3 specification\".
[13] 3GPP TS 24.011: \"Point-to-Point (PP) Short Message Service (SMS) support
on mobile radio interface\".
[14] 3GPP TS 27.005: \"Use of Data Terminal Equipment ‑ Data Circuit
terminating Equipment (DTE ‑ DCE) interface for Short Message Service (SMS)
and Cell Broadcast Service (CBS)\".
[15] 3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".
[16] 3GPP TS 51.011 Release 4 (version 4.x.x): \"Specification of the
Subscriber Identity Module ‑ Mobile Equipment (SIM‑ ME) interface\".
[17] CCITT Recommendation E.164 (Blue Book): \"The international public
telecommunication numbering plan\".
[18] CCITT Recommendation E.163 (Blue Book): \"Numbering plan for the
international telephone service\".
[19] CCITT Recommendation Q.771: \"Specifications of Signalling System No.7;
Functional description of transaction capabilities\".
[20] CCITT Recommendation T.100 (Blue Book): \"International information
exchange for interactive videotex\".
[21] CCITT Recommendation T.101 (Blue Book): \"International interworking for
videotex services\".
[22] CCITT Recommendation X.121 (Blue Book): \"International numbering plan
for public data networks\".
[23] CCITT Recommendation X.400 (Blue Book): \"Message handling services:
Message handling system and service overview\".
[24] ISO/IEC10646: \"Universal Multiple‑Octet Coded Character Set (USC); UCS2,
16 bit coding\".
[25] 3GPP TS 22.022: \"Personalisation of Mobile Equipment (ME); Mobile
functionality specification\".
[26] 3GPP TS 23.042: \"Compression Algorithm for Text Messaging Services\".
[27] 3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service
description; Stage 2\".
[28] 3GPP TS 31.115: \"Secured packet structure for (U)SIM toolkit
application\".
[29] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[30] 3GPP TS 31.102: \"Characteristics of the USIM application\".
[31] 3GPP TS 31.101: \"UICC -- Terminal interface; Physical and logical
characteristics\".
[32] 3GPP TS 22.105: \"Services and Service Capabilites\".
[33] Infrared Data Association. Specifications for Ir Mobile Communications
(IrMC).\ iMelody.
[34] IETF RFC 822: \"Standard for the format of ARPA Internet text messages\".
[35] Void
> [36] \"vCard - The Electronic Business Card\", version 2.1,The Internet Mail
> Consortium (IMC), September 18, 1996,\
> URL:http://www.imc.org/pdi/vcard-21.doc\".
>
> [37] \"vCalendar - the Electronic Calendaring and Scheduling Format\",
> version 1.0,\ The Internet Mail Consortium (IMC), September 18, 1996,\
> URL:http://www.imc.org/pdi/vcal-10.doc
>
> [38] Scalable Polyphony MIDI Specification, MIDI Manufacturers Association
> (2002); http://www.midi.org
>
> [39] Scalable Polyphony MIDI Device 5-to-24 Note Profile for 3GPP, MIDI
> Manufacturers Association (2002); http://www.midi.org
>
> [40] The Complete MIDI 1.0 Detailed Specification, Incorporating all
> Recommended Practices, MIDI Manufacturers Association, Document version
> 96.1, 1996; http://www.midi.org
>
> [41] 3GPP TS 23.097: Multiple Subscriber Profile (MSP) (Phase 2) - Stage 2
>
> [42] 3GPP TS 23.204: \"Support of SMS over generic 3GPP IP access; Stage
> 2\".
>
> [43] IETF RFC 3261: \"SIP: Session Initiation Protocol\".
>
> [44] IETF RFC 3428: \"Session Initiation Protocol (SIP) Extension for
> Instant Messaging\".
## 2.1 Definitions and abbreviations
### 2.1.1 Definitions
For the purposes of the present document, the following terms and definitions
apply:
NOTE 1: The term \"mobile station\" (MS) in the present document is synonymous
with the term \"user equipment\" (UE) in UMTS terminology as defined in 3GPP
TR 21.905 [29].
**active MS:** switched‑on mobile station with a SIM/UICC see 3GPP TS 31.101
[31] module attached
**alert‑SC:** service element provided by a GSM/UMTS PLMN to inform an SC
which has previously initiated unsuccessful short message delivery attempt(s)
to a specific MS, that the MS is now recognized by the PLMN to have recovered
operation
**status report:** SC informing the originating MS of the outcome of a short
message submitted to an SME
**Gateway MSC For Short Message Service (SMS‑GMSC):** function of an MSC
capable of receiving a short message from an SC, interrogating an HLR for
routing information and SMS info, and delivering the short message to the VMSC
or the SGSN of the recipient MS
**Interworking MSC For Short Message Service (SMS‑IWMSC):** function of an MSC
capable of receiving a short message from within the PLMN and submitting it to
the recipient SC
**IP-Short-Message-Gateway (IP-SM-GW):** function responsible for protocol
interworking between the IP-based UE and the SC
**Loop Prevention (LP):** information element that allows SMS applications to
inhibit forwarding or automatic message generation that could cause infinite
looping.
**Messages‑Waiting (MW):** ervice element that makes a PLMN store information
(Messages‑Waiting‑Indication), listing those SCs that have made unsuccessful
short message delivery attempts to MSs in that PLMN
**Messages‑Waiting‑Indication (MWI):** data to be stored in the HLR and VLR
with which an MS is associated, indicating that there is one or more messages
waiting in a set of SCs to be delivered to the MS (due to unsuccessful
delivery attempt(s))
**Messages‑Waiting‑Data (MWD):** part of the MWI to be stored in the HLR. MWD
consists of an address list of the SCs which have messages waiting to be
delivered to the MS
**Mobile-services Switching Centre (MSC):** exchange which performs switching
functions for mobile stations located in a geographical area designated as the
MSC area
**Mobile‑Station‑Memory‑Capacity‑Exceeded‑Flag (MCEF):** part of the MWI to be
stored in the HLR
NOTE 2: MCEF is a Boolean parameter indicating if the address list of MWD
contains one or more entries because an attempt to deliver a short message to
an MS has failed with a cause of MS Memory Capacity Exceeded
**Mobile‑Station‑Not‑Reachable‑Flag (MNRF):** part of the MWI to be stored in
the VLR and the HLR
NOTE 3: MNRF is a Boolean parameter indicating if the address list of MWD
contains one or more entries because an attempt to deliver a short message to
an MS has failed with a cause of Absent Subscriber.
**Mobile‑station‑Not-Reachable-for-GPRS (MNRG):** part of the MWI to be stored
in the SGSN and the HLR
NOTE 4: MNRG is a Boolean parameter indicating if the address list of MWD
contains one or more entries because an attempt to deliver a short message to
an MS has failed with a cause of Absent Subscriber.
**Mobile‑Station‑Not‑Reachable-via-the-MSC-Reason (MNRR-MSC):** part of the
MWI in the HLR which stores the reason for an MS being absent when an attempt
to deliver a short message to an MS fails at the MSC with a cause of Absent
Subscriber
**Mobile‑Station‑Not‑Reachable-via-the-SGSN-Reason (MNRR-SGSN):** part of the
MWI in the HLR which stores the reason for an MS being absent when an attempt
to deliver a short message to an MS fails at the SGSN with a cause of Absent
Subscriber
**More‑Messages‑To‑Send (MMS):** information element offering an MS receiving
a short message from an SC the information whether there are still more
messages waiting to be sent from that SC to the MS
NOTE 5: The TP‑MMS element (conveyed in the Transfer layer) is copied into the
RP‑MMS element (conveyed in the Relay layer). It is possible with Phase 2 and
later versions of MAP (3GPP TS 29.002 [15]) for the RP‑MMS element to keep an
SM transaction open between the SMS-GMSC and the MS in the case where there
are more‑messages‑to‑send. Earlier versions of MAP support the transport of
the TP‑MMS element.
**priority:** service element enabling the SC or SME to request a short
message delivery attempt to an MS irrespective of whether or not the MS has
been identified as temporarily absent
**protocol‑identifier:** information element by which the originator of a
short message (either an SC or an MS) may refer to a higher layer protocol
**receiving MS:** the mobile station to which an MT SM is destined.
**reply path procedure:** mechanism which allows an SME to request that an SC
should be permitted to handle a reply sent in response to a message previously
sent from that SME to another SME
NOTE 6: This may happen even though the SC may be unknown to the SME which
received the initial message.
**report:** response from either the network or the recipient upon a short
message being sent from either an SC or an MS
NOTE 7: A report may be a delivery report, which confirms the delivery of the
short message to the recipient, or it may be a failure report, which informs
the originator that the short message was never delivered and the reason why.
When issued by the Service Centre, the delivery report confirms the reception
of the Short Message by the SC, and not the delivery of the Short Message to
the SME.
When issued by the Mobile Station, the delivery report confirms the reception
of the Short Message by the Mobile Station, and not the delivery of the Short
Message to the user.
**replace short message type:** range of values in the Protocol Identifier
which allows an indication to be sent with a short message (MT or MO) that the
short message is of a particular type allowing the receiving MS or the SC to
replace an existing message of the same type held in the SC, the ME or on the
SIM/UICC, provided it comes:
‑ in MT cases: from the same SC and originating address;
‑ in MO cases: from the same MS.
**sending MS:** the mobile station from which an MO SM is sourced.
**Service Centre (SC):** function responsible for the relaying and
store‑and‑forwarding of a short message between an SME and an MS
NOTE 8: The SC is not a part of the GSM/UMTS PLMN, however MSC and SC may be
integrated.
**Serving GPRS Support Node (SGSN):** exchange which performs packet switching
functions for mobile stations located in a geographical area designated as the
SGSN area
**short message:** information that may be conveyed by means of the Short
Message Service
NOTE 9: As described in the present document.
**Short Message Entity (SME):** entity which may send or receive Short
Messages
NOTE 10: The SME may be located in a fixed network, an MS, or an SC.
**SMS‑STATUS‑REPORT:** short message transfer protocol data unit informing the
receiving MS of the status of a mobile originated short message previously
submitted by the MS, i.e. whether the SC was able to forward the message or
not, or whether the message was stored in the SC for later delivery
**SMS‑COMMAND:** short message transfer protocol data unit which enables an MS
to invoke an operation at the SC
NOTE 11: An MS may then, for example, delete a short message, cancel a TP-
Status-Report-Request, enquire about the status of a short message or request
another function to be performed by the SC.
NOTE 12: The type of operation is indicated by the TP‑Command‑Type and the
particular SM to operate on is indicated by the TP‑Message‑Number and the
TP‑Destination‑Address. Receipt of an SMS‑COMMAND is confirmed by an RP‑ACK or
RP‑ERROR. In the case of certain SMS‑COMMANDs, an SMS‑STATUS‑REPORT may be
sent, where the outcome of the SMS‑COMMAND is passed in its TP‑Status field.
**SMS‑DELIVER:** short message transfer protocol data unit containing user
data (the short message), being sent from an SC to an MS
**SMS‑SUBMIT:** short message transfer protocol data unit containing user data
(the short message), being sent from an MS to an SC
**Service‑Centre‑Time‑Stamp (SCTS):** information element offering the
recipient of a short message the information of when the message arrived at
the SM‑TL entity of the SC
NOTE 13: The time of arrival comprises the year, month, day, hour, minute,
second and time zone.
**UE‑Not-Reachable-for-IP (UNRI):** part of the MWI to be stored in the IP-SM-
GW and the HSS/HLR
NOTE 14: UNRI is a Boolean parameter indicating if the address list of MWD
contains one or more entries because an attempt to deliver a short message to
an UE has failed with a cause of Absent Subscriber.
**UE‑Not‑Reachable-Reason (UNRR):** part of the MWI in the HSS/HLR which
stores the reason for an UE being absent when an attempt to deliver a short
message to an UE fails at the IP-SM-GW.
**Validity‑Period (VP):** information element enabling the originator MS to
indicate the time period during which the originator considers the short
message to be valid.
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.038 [9] apply:
**National Language Identifier**
**National Language Locking Shift Table**
**National Language Single Shift Table**
### 2.1.2 Abbreviations
For the purposes of the present document, the abbreviations defined in 3GPP TR
21.905 [29] and the following apply:
SM MO Short Message Mobile Originated
SM MT Short Message Mobile Terminated
SM‑AL Short Message Application Layer
SM‑LL Short Message Lower Layers
SM‑RL Short Message Relay Layer
SM‑RP Short Message Relay Layer Protocol
SM‑RS Short Message Relay Service
SM‑TL Short Message Transfer Layer
SM‑TP Short Message Transfer Layer Protocol
SM‑TS Short Message Transfer Service
SSN Sub‑System Number
TPDU Transfer protocol data unit
# 3 Services and service elements
The SMS provides a means to transfer short messages between a GSM/UMTS MS and
an SME via an SC. The SC serves as an interworking and relaying function of
the message transfer between the MS and the SME.
The present document describes only the short message services between the MS
and SC. It may, however, refer to possible higher layer applications.
## 3.1 Basic services
The Short Message Service comprise two basic services:
SM MT (Short Message Mobile Terminated);
SM MO (Short Message Mobile Originated).
SM MT denotes the capability of the GSM/UMTS system to transfer a short
message submitted from the SC to one MS, and to provide information about the
delivery of the short message either by a delivery report or a failure report
with a specific mechanism for later delivery; see figure 1.
SM MO denotes the capability of the GSM/UMTS system to transfer a short
message submitted by the MS to one SME via an SC, and to provide information
about the delivery of the short message either by a delivery report or a
failure report. The message shall include the address of that SME to which the
SC shall eventually attempt to relay the short message; see figure 2.
The text messages to be transferred by means of the SM MT or SM MO contain up
to 140 octets.
Short message delivery
Report
Figure 1: The Short Message Service mobile terminated
Short message submission
Report
Figure 2: The Short Message Service mobile originated
An active MS shall be able to receive a short message TPDU (SMS‑DELIVER) at
any time, independently of whether or not there is a speech or data call in
progress. A report shall always be returned to the SC; either confirming that
the MS has received the short message, or informing the SC that it was
impossible to deliver the short message TPDU to the MS, including the reason
why.
An active MS shall be able to submit a short message TPDU (SMS‑SUBMIT) at any
time, independently of whether or not there is a speech or data call in
progress. A report shall always be returned to the MS; either confirming that
the SC has received the short message TPDU, or informing the MS that it was
impossible to deliver the short message TPDU to the SC, including the reason
why.
NOTE: When the transmission or reception of a short message coincide with a
change of state in the MS, i.e. from busy to idle or from idle to busy, or
during a handover, the short message transfer may be aborted.
It is also possible for two short messages to be received in sequence having
the same originating address and identification, i.e. message reference number
(MO) or SC Timestamp (MT). Such a situation may be due to errors at the RP or
CP layers (e.g. during inter MSC handover) where it may be a duplicated
message or otherwise it may be a valid new message.\ The receiving entity
should therefore make provision to check other parameters contained in the
short message to decide whether the second short message is to be discarded.
## 3.2 Short Message Service elements
### 3.2.0 Introduction
The SMS comprises 8 elements particular to the submission and reception of
messages:
Validity‑Period;\ Service‑Centre‑Time‑Stamp;\ Protocol‑Identifier;\
More‑Messages‑to‑Send;\ Priority;\ Messages‑Waiting;\ Alert‑SC.\ MT
Correlation ID.
### 3.2.1 Validity‑Period
The Validity‑Period is the information element which gives an MS submitting an
SMS‑SUBMIT to the SC the possibility to include a specific time period value
in the short message (TP‑Validity‑Period field, see clause 9). The
TP‑Validity‑Period parameter value indicates the time period for which the
short message is valid, i.e. for how long the SC shall guarantee its existence
in the SC memory before delivery to the recipient has been carried out.
### 3.2.2 Service‑Centre‑Time‑Stamp
The Service‑Centre‑Time‑Stamp is the information element by which the SC
informs the recipient MS about the time of arrival of the short message at the
SM‑TL entity of the SC. The time value is included in every SMS‑DELIVER
(TP‑Service‑Centre‑Time‑Stamp field, see clause 9) being delivered to the MS.
### 3.2.3 Protocol‑Identifier
The Protocol‑Identifier is the information element by which the SM‑TL either
refers to the higher layer protocol being used, or indicates interworking with
a certain type of telematic device.
The Protocol‑Identifier information element makes use of a particular field in
the message types SMS‑SUBMIT, SMS‑SUBMIT-REPORT for RP-ACK, SMS‑DELIVER
DELIVER, SMS-DELIVER-REPORT for RP-ACK, SMS_STATUS_REPORT and SMS‑COMMAND
TP‑Protocol‑Identifier (TP‑PID).
### 3.2.4 More‑Messages‑to‑Send
The More‑Messages‑to‑Send is the information element by which the SC informs
the MS that there is one or more messages waiting in that SC to be delivered
to the MS. The More‑Messages‑to‑Send information element makes use of a
Boolean parameter in the message SMS‑DELIVER, TP‑More‑Messages‑to‑Send
(TP‑MMS).
### 3.2.5 Delivery of Priority and non‑Priority Messages
Priority is the information element provided by an SC or SME to indicate to
the PLMN whether or not a message is a priority message.
Delivery of a non‑priority message shall not be attempted if the MS has been
identified as temporarily absent (see clause 3.2.6).
Delivery of a non‑priority message shall be attempted if the MS has not been
identified as temporarily absent irrespective of whether the MS has been
identified as having no free memory capacity (see clause 3.2.6).
Delivery of a priority message shall be attempted irrespective of whether or
not the MS has been identified as temporarily absent, or having no free memory
capacity.
### 3.2.6 Messages‑Waiting
The Messages‑Waiting is the service element that enables the PLMN to provide
the HLR, SGSN and VLR with which the recipient MS is associated with the
information that there is a message in the originating SC waiting to be
delivered to the MS. The service element is only used in case of previous
unsuccessful delivery attempt(s) due to temporarily absent mobile or MS memory
capacity exceeded. This information, denoted the Messages‑Waiting‑Indication
(MWI), consists of Messages‑Waiting‑Data (MWD), the Mobile-station-Not-
Reachable-for-GPRS (MNRG), the UE-Not-Reachable-for-IP (UNRI), the
Mobile‑Station‑Not‑Reachable‑Flag (MNRF), the Mobile-Not-Reachable-via-the-
MSC-Reason (MNRR-MSC), the Mobile-Not-Reachable-via-the-SGSN-Reason (MNRR-
SGSN), the UE Not Reachable-Reason (UNRR) and the
Mobile‑Station‑Memory‑Capacity‑Exceeded‑Flag (MCEF) located in the HLR; the
Mobile-station-Not Reachable-for-GPRS (MNRG) located in the SGSN, and the
Mobile‑Station‑Not‑Reachable‑Flag (MNRF) located in the VLR. Figure 3 shows an
example.
Figure 3: Example of how information on one MS can be put in relation to
SC(s)\ in order to fulfil the requirement of Alert‑SC mechanism
The MWD shall contain a list of addresses (SC‑Addr) of SCs which have made
previous unsuccessful delivery attempts of a message (see clause 5). In order
to be able to send alert messages to every SC which has made unsuccessful
delivery attempts to an MS, the HLR shall store the MSIsdn‑Alert (see clause
3.2.7) together with references to the SC addresses. The requirements placed
upon the HLR are specified in GSM TS 03.08 [6]. The description of how the HLR
is provided with SC and MS address information is given in 3GPP TS 29.002
[15].
The Mobile‑Station‑Memory‑Capacity‑Exceeded‑Flag (MCEF) within the HLR is a
Boolean parameter with the value TRUE an attempt to deliver a short message to
an MS has failed with a cause of MS Memory Capacity Exceeded, and with the
value FALSE otherwise.
The Mobile‑station‑Not Reachable-for-GPRS (MNRG) within the HLR and the SGSN
is a Boolean parameter with the value TRUE when an attempt to deliver a short
message to an MS has failed with a cause of Absent Subscriber, and with the
value FALSE otherwise (except as described in note 1 below).
The Mobile‑Station‑Not‑Reachable‑Flag (MNRF) within the HLR and the VLR is a
Boolean parameter with the value TRUE when the list MWD contains one or more
list elements because an attempt to deliver a short message to an MS has
failed with a cause of Absent Subscriber, and with the value FALSE otherwise.
The UE‑Not‑Reachable‑for-IP (UNRI) within the HLR/HSS and IP-SM-GW is a
Boolean parameter with the value TRUE when the list MWD contains one or more
list elements because an attempt to deliver a short message to an UE has
failed with a cause of Absent Subscriber, and with the value FALSE otherwise.
The Mobile-Station-Not-Reachable-via-the-MSC-Reason (MNRR-MSC) within the HLR
stores the reason for the MS being absent when an attempt to deliver a short
message to an MS fails at the MSC with the cause Absent Subscriber. The HLR
updates the MNRR-MSC with the reason for absence when an absent subscriber
diagnostic information is received from the SMS-GMSC and the MNRF is set. The
HLR clears the MNRR-MSC when the MNRF is cleared. If the MNRF is set due to a
failure at the MSC with cause Absent Subscriber and information pertaining to
the absence of the MS is not available from the SMS-GMSC, the MNRR-MSC shall
remain in a cleared state. The MNRR-MSC shall either be in a cleared state or
contain one of the following reasons:
No Paging Response via the MSC;
IMSI Detached.
The Mobile-Station-Not-Reachable-via-the-SGSN-Reason (MNRR-SGSN) within the
HLR stores the reason for the MS being absent when an attempt to deliver a
short message to an MS fails at the SGSN with the cause Absent Subscriber. The
HLR updates the MNRR-SGSN with the reason for absence when an absent
subscriber diagnostic information is received from the GMSC and the MNRG is
set. The HLR clears the MNRR-SGSN when the MNRG is cleared. If the MNRG is set
due to a failure at the SGSN with cause Absent Subscriber and information
pertaining to the absence of the MS is not available from the GMSC, the MNRR-
SGSN shall remain in a cleared state. The MNRR-SGSN shall either be in a
cleared state or contain one of the following reasons:
No Paging Response via the SGSN;
GPRS Detached.
NOTE 1: The MNRG can also be set in the HLR and in the SGSN after an
unsuccessful attempt to invoke the network requested PDP-Context Activation
procedure. In this case, no SC address is stored in MWD list (see 3GPP TS
23.060 [27]).
NOTE 2: When a short message delivery attempt fails at the HLR due to Roaming
being Restricted, the MS being deregistered in HLR or the MS being Purged the
absent subscriber diagnostic reason is returned to the SC, however the reason
is not stored in the MNRR-MSC or MNRR-SGSN.
The UE-Station-Not-Reachable-Reason (UNRR) within the HSS/HLR stores the
reason for the UE being absent when an attempt to deliver a short message to
an UE fails at the IP-SM-GW with the cause Absent Subscriber. The HSS/HLR
updates the UNRR with the reason for absence when an absent subscriber
diagnostic information is received from the IP-SM-GW and the UNRI is set. The
HSS/HLR clears the UNRR when the UNRI is cleared. If the UNRI is set due to a
failure at the IP-SM-GW with cause Absent Subscriber, the UNRR shall remain in
a cleared state. The UNRR shall either be in a cleared state or contain one of
the following reasons:
No Response via the IP-SM-GW;
UE deregistered.
The MWD, MCEF, MNRR-MSC, MNRR-SGSN, MNRG, MNRF, UNRI and UNRR are updated in
the following way:
1a) When a mobile terminated short message delivery fails at the MSC due to
the MS being temporarily absent (i.e. either IMSI DETACH flag is set or there
is no response from the MS to a paging request via the MSC), the SC address is
inserted into the MWD list (if it is not already present), the MNRF is set (if
it is not already set) and the MNRR-MSC is updated (if the information is
available), as described in clause 10.
1b) When a mobile terminated short message delivery fails at the SGSN due to
the MS being temporarily absent (i.e. either GPRS DETACH flag is set or there
is no response from the MS to a paging request via the SGSN), the SC address
is inserted into the MWD list (if it is not already present), the MNRG is set
(if it is not already set) and the MNRR-SGSN is updated (if the information is
available), as described in clause 10.
1c) When a mobile terminated short message delivery fails at the MSC due to
the MS memory capacity being exceeded, the SC address is inserted into the MWD
list (if it is not already present),the MCEF is set (if it is not already
set), the MNRF is cleared and the MNRR-MSC is cleared.
1d) When a mobile terminated short message delivery fails at the SGSN due to
the MS memory capacity being exceeded, the SC address is inserted into the MWD
list (if it is not already present), the MCEF is set (if it is not already
set), the MNRG is cleared and the MNRR-SGSN is cleared.
1e) When a mobile terminated short message delivery fails due to the UE memory
capacity via the IP-SM-GW being exceeded, the SC address is inserted into the
MWD list (if it is not already present), the MCEF is set (if it is not already
set), the UNRI is cleared and the UNRR is cleared.
1f) If the MSIsdn used by the SC to address the recipient MS for alerting
purposes is different from the MSIsdn‑Alert of the MS (see clause 3.2.7), the
HLR returns the MSIsdn‑Alert to the SC within the failure report, see \"1c
Failure report\" in figures 15 and 16.
2a) When either the HLR or VLR detects that the MS has recovered operation
(e.g. has responded to a paging request over MSC), the HLR directly or on
request of the VLR shall clear MNRF and MNRR-MSC. Then, if with a non empty
MWD list and the MCEF clear, the HLR shall invoke operations to alert the SCs
within the MWD (see clause 3.2.7 and clause 10). After each SC is alerted by
the HLR, the address for that SC shall be deleted from the MWD. If the MCEF is
set in the HLR, the HLR shall not invoke operations to alert the SCs within
the MWD and data are not cleared from the MWD.
2b) When either the HLR or SGSN detects that the MS has recovered operation
(e.g. has responded to a paging request via the SGSN), the HLR directly or on
request of the SGSN shall clear MNRG and MNRR-SGSN. Then, if with a non empty
MWD list and the MCEF clear, the HLR shall invoke operations to alert the SCs
within the MWD (see clause 3.2.7 and clause 10). After each SC is alerted by
the HLR, the address for that SC is deleted from the MWD. If the MCEF is set
in the HLR, the HLR shall not invoke operations to alert the SCs within the
MWD and data are not cleared from the MWD.
2c) When the IP-SM-GW informs the HLR/HSS that the UE is reachable for SMS
over IP, either due to an IMS registration or due to the UE becoming available
again, the HLR/HSS shall clear the UNRI and UNRR. Then, if with a non empty
MWD list and the MCEF clear, the HLR/HSS shall invoke operations to alert the
SCs within the MWD (see clause 3.2.7 and clause 10). After each SC is alerted
by the HLR/HSS, the address for that SC is deleted from the MWD. If the MCEF
is set in the HLR/HSS, the HLR/HSS shall not invoke operations to alert the
SCs within the MWD and data are not cleared from the MWD.
2d) When the HLR receives (via the MSC and the VLR) a notification that the MS
(with a non‑empty MWD and the MCEF set in the HLR) has memory capacity
available to receive one or more short messages, the HLR shall invoke
operations to alert the SCs within the MWD (see clause 3.2.7 and clause 10).
Once the Alert SC operations have been invoked, the MNRF is cleared in the VLR
and the MCEF, MNRF and MNRR-MSC are cleared in the HLR. After each SC is
alerted by the HLR, the address for that SC is deleted from the MWD.
2e) When the HLR receives (via the SGSN) a notification that the MS (with a
non‑empty MWD and the MCEF set in the HLR) has memory capacity available to
receive one or more short messages, the HLR shall invoke operations to alert
the SCs within the MWD (see clause 3.2.7 and clause 10). Once the Alert SC
operations have been invoked, the MNRG is cleared in the SGSN and the MCEF,
MNRG and MNRR-SGSN are cleared in the HLR. After each SC is alerted by the
HLR, the address for that SC is deleted from the MWD.
2f) When the HLR/HSS receives (via the IP-SM-GW) a notification that the UE
(with a non‑empty MWD and the MCEF set in the HLR/HSS) has memory capacity
available to receive one or more short messages, the HLR/HSS shall invoke
operations to alert the SCs within the MWD (see clause 3.2.7 and clause 10).
Once the Alert SC operations have been invoked, the UNRI and UNRR are cleared
in the HLR/HSS. After each SC is alerted by the HLR/HSS, the address for that
SC is deleted from the MWD.
2g) When the HLR receives from the SMS‑GMSC a notification that a short
message has been successfully delivered from an SC to an MS via the MSC for
which the MCEF is set and the MWD are not empty, the HLR shall invoke
operations to alert other SCs within the MWD (see clause 3.2.7 and clause 10).
Once the Alert SC operations have been invoked, the MCEF, MNRF and MNRR-MSC
are cleared in the HLR. After each SC is alerted by the HLR, the address for
that SC is deleted from the MWD. The SC which successfully delivered the
message is also deleted from the MWD, if present.
2h) When the HLR receives from the SMS‑GMSC a notification that a short
message has been successfully delivered from an SC to an MS via the SGSN for
which the MCEF is set and the MWD are not empty, the HLR shall invoke
operations to alert other SCs within the MWD (see clause 3.2.7 and clause 10).
Once the Alert SC operations have been invoked, the MCEF, MNRG and MNRR-SGSN
are cleared in the HLR. After each SC is alerted by the HLR, the address for
that SC is deleted from the MWD. The SC which successfully delivered the
message is also deleted from the MWD, if present.
2i) When the HLR receives (via the MSC and the VLR, or the SGSN) a
notification that the MS has memory capacity available to receive one or more
short messages but the MCEF is not set and the MWD are empty, the HLR
acknowledges the notification but does not alert any service centre.
NOTE 3: The HLR can be in a situation where the MWD list is empty but where
either MNRF or MNRG (with the related MNRR-MSC or MNRR-SGSN) is still set.
This enables the HLR to return the correct address (MSC or SGSN address) at
the next Send Routing Information Request from the SMS-GMSC.
NOTE 4: If the SMS delivery failed on first attempt via the MSC or the SGSN
(see cases 1a for IMSI Detach and 1b for GPRS Detach), and is successful on
the second attempt (see cases 2e and 2f), the SC address shall not be inserted
into the MWD list
### 3.2.7 Alert‑SC
The Alert‑SC is the service element, which may be provided by some GSM/UMTS
PLMNs, to inform the SC that an MS:
1) to which a delivery attempt has failed because the MS is not reachable or
because the MS memory capacity was exceeded; and
2) which is now recognized by the PLMN:
a) to have resumed operation (e.g. to have responded to a paging request); or
b) to have memory newly available (which implies that the mobile is
reachable).
is again ready to receive one or more short messages. The SC may ‑ on
reception of an Alert‑SC ‑ initiate the delivery attempt procedure for the
queued messages destined for this MS.
To each MS there may be allocated several MSIsdns. When the HLR is to alert an
SC that an MS is again attainable it shall use a specific MSIsdn value for
this purpose; in the present document called MSIsdn‑Alert.
NOTE 5: Repeated delivery attempts from the SC may be of two types:
i) A repeated delivery attempt because the SC has been informed that the MS is
active and available to receive short messages.
ii) An autonomous repeated delivery attempt by the SC.
The application of these two options is defined by the providers of the SC and
the network.
### 3.2.7a MT Correlation ID
The MT Correlation ID is a service element used only when the HPLMN of the
receiving MS is using an SMS Router or an IP-SM-GW. It is used to correlate a
Forward SM operation to a previous Info Retrieval operation.
Use of the MT Correlation ID enhances security. By analysing the Correlation
ID received in a Forward Short message operation, it can be easily checked
from where the associated Info Retrieval operation originated, thus resulting
in detection of \"fake\" and \"spoofed\" SMs.
The MT Correlation ID is used in place of the IMSI in the IMSI IE at the
protocol layer. Hence, its structure is defined to be exactly the same as this
element.
NOTE: Using an MT Correlation ID in place of the real IMSI has the added
benefit of enhancing subscriber privacy in that the full IMSI is not shared
with the HPLMN of the sending MS.
The MT Correlation ID shall be composed as shown in figure 3a below.
Figure 3a: Structure of the MT Correlation ID
The MT Correlation ID is composed of three parts:
1) Mobile Country Code (MCC) of the HPLMN of the receiving MS. It consists of
three decimal digits.
2) Mobile Network Code (MNC) of the HPLMN of the receiving MS. It consists of
three decimal digits. If the MNC of the HPLMN of the receiving MS is 2 digits
only in length, the first digit of the MSIN shall be appended to the
right‑hand side.
3) Sender ID. It consists of nine decimal digits and shall be unique for its
lifetime. For security purposes, its value shall be a number allocated at
random, rather than sequentially.
An example of the MT Correlation ID is:
Sender ID: 569123006
IMSI in use: 234151234567890
Where:
MCC = 234;
MNC = 15;
MSIN = 1234567890,
Which gives the MT Correlation ID: 234151569123006.
### 3.2.8 Options concerning MNRG, MNRF, UNRI, MNRR-MSC, MNRR-SGSN, UNRR, MCEF
and MWD
Setting the Mobile‑Station‑Not‑Reachable‑Flag (MNRF) in the VLR is mandatory.
Setting the Mobile‑station‑Not-Reachable-for-GPRS (MNRG) in the SGSN is
mandatory. It is mandatory for the VLR or the SGSN to send the \"MS
Reachable\" message (see clause 10) to the HLR when the MS has been detected
as becoming active and then to clear MNRF in the VLR or the MNRG in SGSN.
The Messages‑Waiting‑Data (MWD), the Mobile‑Station‑Not‑Reachable‑Flag (MNRF),
the Mobile‑station‑Not-Reachable-for-GPRS (MNRG), the Mobile-Station-Not-
Reachable-via-the-MSC-Reason (MNRR-MSC), the Mobile-Station-Not-Reachable-via-
the-SGSN-Reason (MNRR-SGSN), and the
Mobile‑Station‑Memory‑Capacity‑Exceeded‑Flag (MCEF) within the HLR are
optional, but if one is implemented all must be implemented (except MNRG and
MNRR-SGSN if the HLR does not support GPRS). This is linked to the
transmission of the \"Alert SC\" message.
The following describes what happens when a delivery fails.
Case 1: MWD, MNRF, MNRG, UNRI, MNRR-MSC, MNRR-SGSN, UNRR,and MCEF are
implemented in the HLR.
In the case of a delivery failure (to an MS) with cause Absent Subscriber, the
SMS-GMSC requests the HLR to add, if needed, a new entry in the MWD with cause
Absent Subscriber. This new entry contains the SC address. The HLR sets its
copy of the MNRF, MNRG or both and updates the MNRR-MSC, MNRR-SGSN or both (if
the information is available). The SC is notified of the failure, the reason
for the MS being absent and also of the MWD setting in the HLR within the
Report message (see clause 10).
If a delivery through an IP-SM-GW fails (to an MS) with cause Mobile Station
Memory Capacity Exceeded via the SGSN, IP-SM-GW, or the MSC, the IP-SM-GW
requests the HSS to add, if needed, a new entry in the MWD with cause Mobile
Station Memory Capacity Exceeded. This new entry contains the SC address. The
HLR sets the MCEF and resets MNRF, MNRG, or UNRI. The SC is notified of the
failure and also of the MWD setting in the HLR within the Report message (see
clause 10).
In the case of a delivery failure (to an MS) with cause Mobile Station Memory
Capacity Exceeded via the SGSN or the MSC, the SMS-GMSC or SMS Router requests
the HLR to add, if needed, a new entry in the MWD with cause Mobile Station
Memory Capacity Exceeded. This new entry contains the SC address. The HLR sets
the MCEF and resets MNRF or MNRG. The SC is notified of the failure and also
of the MWD setting in the HLR within the Report message (see clause 10).
If the HLR indicates that it is able to store the SC address, then the SC
shall receive an Alert SC message when the MS becomes active.
If the HLR indicates that it is unable to store the SC address (e.g. because
MWD is full), then the only way to ensure delivery is for the SC to try to
retransmit the message periodically.
When the HLR receives the MS Reachable message, if the MCEF is clear it sends
an Alert SC message to the concerned SC, updates MWD and clears MNRF (if the
MS is reachable via the MSC) or MNRG (if the MS is reachable via the SGSN) or
UNRI (if the MS is reachable via the IP-SM-GW).
When the HLR receives the MS Memory Capacity Available message, it sends an
Alert SC message to the concerned SC, updates MWD, clears the MCEF and clears
MNRF (if the MS is reachable via the MSC), UNRI (if the UE is reachable via
the IP-SM-GW) or MNRG (if the MS is reachable via the SGSN).
Case 2: MWD, MNRF, MNRG, MNRR-MSC, MNRR-SGSN and MCEF are not implemented in
the HLR.
NOTE: HLRs supporting SMSIP and having implemented MWD, MNRF, MNRG, MNRR, MCEF
shall also implement UNRI and UNRR
In the case of a delivery failure, the SC is notified that the HLR is unable
to store its address in the MWD. In case of a delivery failure (to a MS) with
cause Absent Subscriber, the SC is notified of the reason for the MS being
absent (if the information is available). The SC must retransmit the short
message periodically in order to ensure delivery.
The HLR discards the MS Reachable message received from the VLR or SGSN
without any failure or error report.
The HLR discards the MS Memory Capacity Available message received from the MS
via the MSC and the VLR or SGSN without any failure or error report.
### 3.2.9 Status report capabilities
The SMS also offers to the SC the capabilities of informing the MS of the
status of a previously sent mobile originated short message. The status of the
message can be:
‑ Successfully delivered to the SME;
‑ The SC was not able to forward the message to the SME. The reason can be an
error of permanent or temporary nature. Permanent errors can be e.g. validity
period expired, invalid SME address. Errors of temporary nature can be e.g.
SC‑SME connection being down, SME temporarily unavailable.
This is achieved by the SC returning a status report TPDU (SMS‑STATUS‑REPORT)
to the originating MS when the SC has concluded the status of the short
message. The status report may be initiated by a status report request within
the mobile originated short message. The status report TPDU is treated as an
SMS‑DELIVER TPDU by the SC when it comes to delivery procedures e.g. the
alerting mechanism.
The SC may also return to a non‑MS SME the status of a mobile terminated short
message. This is however outside the scope of the present document.
The status report capabilities of the SMS are optional, i.e. the choice of
whether to offer status report or not is left to the SC operator.
For reasons of resilience and/or load sharing architecture of SMSC's by
network operators, the SMSC address (the RP‑OA) used by the SMSC to send the
Status Report to the MS cannot be guaranteed to be the same SMSC address (RP-
DA) used by the MS to submit the SM to which the Status Report refers. Where
an MS wishes to implement a check that these addresses correlate, a means of
disabling the correlation check shall be provided at the MS through MMI.
### 3.2.10 Reply Path
Reply Path specified in the present document provides a way of both requesting
and indicating a service centre\'s commitment to deliver a reply from the
replying MS to the originating SME.
Annex D deals with MS procedures, which in general are outside the scope of
GSM/UMTS specifications. However, for advanced use of the SMS, including both
application level protocols and human responses, it is of vital importance to
guarantee that a reply‑supporting MS is able to reply on every SM, to every
SME capable of receiving such reply short messages.
## 3.3 Unsuccessful short message TPDU transfer SC ‑> MS
Unsuccessful message transfer SC ‑> MS may be caused by a variety of different
errors. The description of the occurrence of the different errors and how to
handle and transfer the error indications is given in GSM 44.008 [12], 3GPP TS
24.011 [13] and 3GPP TS 29.002 [15].
The different error indications which the SMS‑GMSC shall be capable of
returning to the SC following an unsuccessful short message TPDU transfer SC
‑> MS, are given in table 1. In some cases, additional diagnostic information
may be provided.
### 3.3.1 Errors occurring during transfer of TPDU to MS
These errors are generally due to barring or unsupported service in the PLMN
or MS. An error indication is returned to the SC from the SMS‑GMSC, but
further diagnostic information from the MS shall not be available.
### 3.3.2 Errors occurring after TPDU arrives at MS
These errors may occur due to the MS not supporting optional short message
service features, or in connection with a short message application. An error
indication shall be returned to the SC from the SMS‑GMSC. Additionally, a TPDU
(SMS‑DELIVER‑REPORT) containing diagnostic information may be conveyed from
the MS to the originating SC, transparently through the PLMN, by means defined
in 3GPP TS 24.011 [13] and 3GPP TS 29.002 [15]. The sending of the diagnostic
information is optional at the MS, but when it is sent, the PLMN shall convey
the information to the SC, and the SC shall support reception of the
information.
Table 1: Error indications related to mobile terminated short message transfer
which may be transferred to the originating SC
+------------------------------+-----+------------------------------+ | Error indication | S1) | Meaning | +------------------------------+-----+------------------------------+ | Unknown subscriber | P | The PLMN rejects the short | | | | message TPDU because there | | | | is not allocated an IMSI or | | | | a directory number for the | | | | mobile subscriber in the HLR | | | | (see 3GPP TS 29.002 [15]). | +------------------------------+-----+------------------------------+ | Teleservice not provisioned | P | The PLMN rejects the short | | | | message TPDU because the | | | | recipient MS has no SMS | | | | subscription (see 3GPP TS | | | | 29.002 [15]). | +------------------------------+-----+------------------------------+ | Call barred | T | The PLMN rejects the short | | | | message TPDU due to barring | | | | of the MS (see 3GPP TS | | | | 29.002 [15], description | | | | of the Barring supplementary | | | | service, 3GPP TS 22.004 | | | | [3] and 3GPP TS | | | | 23.011[7]), description of | | | | Call barred due to | | | | Unauthorised Message | | | | Originator, 3GPP TS 29.002 | | | | [15], and description of | | | | Operator Determined Barring, | | | | 3GPP TS 22.041 [4] and | | | | 3GPP TS 23.015 [8]). | +------------------------------+-----+------------------------------+ | Facility not supported | T | The VPLMN rejects the short | | | | message TPDU due to no | | | | provision of the SMS in the | | | | VPLMN (see 3GPP TS 29.002 | | | | [15]). | +------------------------------+-----+------------------------------+ | Absent subscriber | T | The PLMN rejects the short | | | | message TPDU because | | | | | | | | - there was no paging | | | | response via the SGSN, MSC | | | | or both~~,~~ (see GSM 44.008 | | | | [12] & 3GPP TS 29.002 | | | | [15]) | | | | | | | | ‑ the IMSI GPRS or both | | | | records are marked detached | | | | (see 3GPP TS 29.002 [15]); | | | | | | | | ‑ the MS is subject to | | | | roaming restrictions (see | | | | \"Roaming not allowed\", | | | | 3GPP TS 29.002 [15]); | | | | | | | | - deregistered in the HLR. | | | | The HLR does not have an | | | | MSC, SGSN or both numbers | | | | stored for the target MS, | | | | (see 3GPP TS 29.002 [15]); | | | | | | | | - Unidentified subscriber | | | | (see 3GPP TS 29.002 [15]); | | | | | | | | - MS purged (see 3GPP TS | | | | 29.002 [15]). | | | | | | | | (The reasons for absence are | | | | assigned integer values in | | | | table 1a. The appropriate | | | | integer value is sent with | | | | the absent subscriber error | | | | indication as defined in | | | | 3GPP TS 29.002 [15]) | +------------------------------+-----+------------------------------+ | MS busy for MT SMS | T | The PLMN rejects the short | | | | message TPDU because of | | | | congestion encountered at | | | | the visited MSC or the SGSN. | | | | Possible reasons include any | | | | of the following events in | | | | progress: | | | | | | | | - short message delivery | | | | from another SC; | | | | | | | | - IMSI or GPRS detach | | | | | | | | - Location Update or Inter | | | | SGSN Routing Area Update; | | | | | | | | - paging; | | | | | | | | - emergency call; | | | | | | | | - call setup. | +------------------------------+-----+------------------------------+ | SMS lower layers\ | T | The PLMN rejects the short | | capabilities not provisioned | | message TPDU due to MS not | | | | being able to support the | | | | Short Message Service. | | | | | | | | The short message transfer | | | | attempt is rejected either | | | | due to information contained | | | | in the class‑mark, or the | | | | MSC not being able to | | | | establish connection at SAPI | | | | = 3 (see GSM 44.008 [12] | | | | and 3GPP TS 29.002 [15]). | +------------------------------+-----+------------------------------+ | Error in MS | T | The PLMN rejects the short | | | | message TPDU due to an error | | | | occurring within the MS at | | | | reception of a short | | | | message, e.g. protocol | | | | error. | +------------------------------+-----+------------------------------+ | Illegal Subscriber | P | The PLMN rejects the short | | | | message TPDU because the MS | | | | failed authentication. | +------------------------------+-----+------------------------------+ | Illegal Equipment | P | The PLMN rejects the short | | | | message TPDU because the | | | | IMEI of the MS was | | | | black‑listed in the EIR. | +------------------------------+-----+------------------------------+ | System failure | T | The PLMN rejects the short | | | | message TPDU due to network | | | | or protocol failure others | | | | than those listed above (see | | | | 3GPP TS 29.002 [15]). | +------------------------------+-----+------------------------------+ | Memory Capacity Exceeded | T | The MS rejects the short | | | | message since it has no | | | | memory capacity available to | | | | store the message. | +------------------------------+-----+------------------------------+
1) : Status ([P]{.underline}ermanent or [T]{.underline}emporary)
The relation between the two sets of error indications is given in the table
1. Each error is classified as either \"Temporary\" or \"Permanent\". This
classification gives an indication of whether or not it is probable that the
MS becomes attainable within a reasonable period, and so provides the
recommended action to be taken by the SC, i.e. either to store the message for
later transfer, or to discard it.
Table 1a: Assignment of values to reasons for absence\ (values must be in the
range of 0 to 255, see 3GPP TS 29.002 [15])
* * *
Values Reason for absence 0 - no paging response via the MSC 1 - IMSI detached
2 - roaming restriction 3 - deregistered in the HLR for non GPRS 4 - MS purged
for non GPRS 5 - no paging response via the SGSN 6 - GPRS detached 7 -
deregistered in the HLR for GPRS 8 - MS purged for GPRS 9 - Unidentified
subscriber via the MSC 10 - Unidentified subscriber via the SGSN 11 -
deregistered in the HSS/HLR for IMS 12 - no response via the IP-SM-GW All
\'non GPRS\' reasons (except for roaming restriction) can be combined with all
\'GPRS\' reasons and vice-versa  
All other integer values are reserved.
* * *
## 3.4 Unsuccessful short message TPDU transfer MS ‑> SC
The error indications related to mobile originated short message transfer
which may be transferred to the originating MS are given in 3GPP TS 24.011
[13]. In some cases, additional diagnostic information may be provided.
### 3.4.1 Errors occurring during transfer of TPDU to SC
These errors are generally due to barring or unsupported service in the PLMN.
An error indication is returned to the MS from the MSC or the SGSN, but
further diagnostic information from the SC shall not be available.
### 3.4.2 Errors occurring after TPDU arrives at SC
These errors may occur due to the SC not supporting optional short message
service features, or in connection with a short message application. An error
indication shall be returned to the MS from the MSC or from the SGSN.
Additionally, a TPDU (SMS‑SUBMIT‑REPORT) containing diagnostic information may
be conveyed from the SC to the originating MS, transparently through the PLMN,
as defined in 3GPP TS 29.002 [15] and 3GPP TS 24.011 [13]. The sending of the
diagnostic information is optional at the SC, but when it is sent, the PLMN
shall convey the information to the MS, and the MS shall support reception of
the information.
Note: The SMS‑SUBMIT‑REPORT is part of the negative acknowledgement to the
mobile originated short message, and is not part of the status report
capabilities described in clause 3.2.9.
## 3.5 Use of Supplementary Services in combination with the Short Message
Service
Only a sub‑set of the Supplementary Services defined in 3GPP TS 22.004 [3]and
3GPP TS 23.011 [7] may be used in combination with the Short Message Service.
This sub‑set comprises the following Supplementary Services:
All the 5 Barring services.
## 3.6 Applicability of Operator Determined Barring to the Short Message
Service
The network feature Operator Determined Barring (see 3GPP TS 22.041 [4])
applies to the Short Message Service.
If a short message fails due to operator determined barring then an
appropriate error cause is returned to the originator.
## 3.7 Multiple short message transfer
To avoid the need for a mobile to be paged, authenticated etc. for each
message waiting in the Service Centre, the SC may indicate to the SMS-GMSC
that there are more messages to send. When this indication is given, MAP
procedures are invoked such that this indication is passed to the VMSC, and
the VMSC does not release the MS until all short messages waiting in the SC
have been transferred.
## 3.8 SMS and Internet Electronic Mail interworking
The interworking between Internet electronic mail and SMS is offered in both
directions which enables new and old mobiles to send/receive Internet
electronic mails via SMS. The interworking is according to the following
procedures:
\- An SMS message which is required to interwork with Internet email may have
its TP‑PID value set for Internet electronic mail;
NOTE: There is an alternative mechanism described in subclause 9.2.3.24
providing full RFC 822 [34] internet electronic mail interworking.
\- Either single or concatenated SMS can be used to transport the email;
\- Concatenation may be achieved by the TPUDH mechanism, in which case the
concatenation is carried out at a lower level to the formats specified in
subclauses 3.8.1 and 3.8.2. Alternatively, concatenation may be achieved using
the text‑based means described below;
\- Email cc fields are not supported;
\- Where multiple fields are present, additional spaces may be inserted by the
sender to improve presentation of the message. Spaces may not be inserted into
the actual email address (e.g. user\@domain1.domain2).
### 3.8.1 Basic Format
The basic format for transferring email in either direction consists of the
following:
MT SMS:
[\\]\
MO SMS:
[\\]\
where [] denote optional fields and \<> delimit fields.
The to‑address or from address may take the form:
user\@domain1.domain2
or
User Name \
In the latter case the angle brackets \<> are part of the address and are
actually transmitted.
Depending on the nature of the gateway, the destination/origination address is
either derived from the content of the SMS TP‑OA or TP‑DA field, or the
TP‑OA/TP‑DA field contains a generic gateway address and the to/from address
is added at the beginning as shown above.
Multiple addresses may be identified in MO messages by separating each address
by a comma like this:
address1,address2,address3\\
It is optional for the receiving gateway to support this. If the receiving
gateway does not support multiple messages then it shall reject the original
message by returning an appropriate error in a text message.
### 3.8.2 Optional Fields
The following further optional fields are supported. An email \ SMS gateway
may insert additional spaces in the MT message for presentation to the user,
and must accept additional spaces in the MO message from the user.
#### 3.8.2.1 Subject
The subject is placed between the address and the message, delimited by round
brackets () or preceded by ##, for example:
[\](\)\
or
[\]##\#\
An MO message may contain either format. An MT message may contain either
format. Developers must ensure that both forms are supported for full
compatibility.
#### 3.8.2.2 Real Name
The Real Name field contains the real name of the sender and is used only in
MO messages. The SC or email gateway shall generate an email message according
to standard email procedures containing Real Name \
(the angle brackets being part of the address and hence transmitted). If a
subject is to be included with the Real Name then only the ## prefix is used.
The syntax is:
[\]#\[##\]#\
#### 3.8.2.3 Optional Control Flag
An optional control flag may be added to the start of the message in MO
messages only. This consists of a single character \ following a # symbol
as follows:
[#\#][\]\\
This may also be used in combination with the above fields. It is intended for
use where a particular SC or email gateway specific function is required to be
invoked. For example, the control flag #A# might add a particular (pre‑stored)
signature to the end of the message or #R# might change the from‑address to a
pre‑stored value or #5# might add the text \"Please phone me at the office\".
All of these functions are open for definition by Service Centre or email
gateway operators.
### 3.8.3 Text concatenation
If the concatenation mechanism described in subclause 9.2.3.24.1 is not
supported by the transmitting or receiving entity, the following textual
concatenation mechanism may be used. The first message is ended with a + sign,
and each subsequent message start and end with + signs until the final message
which starts with a + sign but does not end with a + sign.
\+
+\+
+\
Any header fields placed on the front of an MO or MT message are not added to
the second and subsequent messages.
This provides a simple mechanism which is completely backward compatible.
There is no indication of the number of messages and should a message be lost
by the system or arrive out of sequence then the original message cannot be
reconstructed. Therefore, wherever possible the concatenation mechanism
specified in subclause 9.2.3.24.1 should be used instead.
### 3.8.4 Alternative characters for Internet email addresses in MO SMS.
It is difficult or impossible to generate some characters on a mobile phone
and so the following alternatives may be used:
@ may be replaced by *
_ (underscore) may be replaced by \$
## 3.9 SMS COMPRESSION
Short Messages may be compressed in accordance with the compression algorithm
described in 3GPP TS 23.042 [26].
Compression and Decompression may take place between SME\'s or between an SME
and the SC.
The compression only applies to the TP-User-Data part of the TPDU and excludes
any TP-User-Data-Header which may be present. The Compression Header (see 3GPP
TS 23.042 [26]) must commence at the first octet of the TP‑User‑Data field
immediately following any TP-User-Data-Header field which may be present.
The TP-UDL value must be set in accordance with that value defined for the
compressed TP-User-Data case in clause 9.2.3.16.
The TP-DCS parameter indicates whether or not a short message is compressed.
If the TP-DCS parameter indicates that the short message is compressed then
the alphabet encoding values (bits 2 and 3 in 3GPP TS 23.038 [9]) must be
ignored by the receiving entity.
In the case where a short message after compression is greater than 140 octets
(including the Compression Header and Footer (see 3GPP TS 23.042 [26]) and any
TP-User-Data-Header which may be present) then the sending entity must
concatenate the short message in the normal way as described in clause
9.2.3.24.1 if it wishes to continue to send the short message. Only the first
segment of the concatenated short message must contain the Compression Header
defined in 3GPP TS 23.042 [26]. All segments other than the final segment must
be 140 octets in length. Only the final segment contains the Compression
Footer (see 3GPP TS 23.042 [26]).
For mobile terminated compressed messages, where the MMI or the Message Class
indicated in the TP-DCS requires the message to be stored in the MS then the
MS shall store the compressed message as received. In the case where the MS is
capable of decompression then the MS may display the decompressed message.
Such an MS may optionally store the message in decompressed form subject to
the MS being configured to do this via MMI. However, prior to storing the
message in decompressed form, the MS may have to create a concatenated SM and
carry out component modification on the TP-UDL and TP-DCS values to indicate
the correct length values and that the message is no longer compressed.
Transfer of messages direct from the radio interface or those stored in the MS
to a TE is according to the procedure defined in 3GPP TS 27.005 [14] and is
independent of whether the message is compressed or uncompressed.
For mobile originated compressed messages, an MS capable of compression may
compress a short message generated within the MS itself prior to sending it to
the radio interface. An MS capable of compression may optionally compress an
uncompressed message received from a TE subject to the MS being configured to
do this via MMI. In such a case the MS would have to carry out component
modification on the TP-UDL and TP-DCS values to indicate the correct length
values and that the message is compressed. A TE may send a message (compressed
or uncompressed) to the MS using the procedures defined in 3GPP TS 27.005
[14]. The MS shall store the compressed message as received and/or transfer it
directly to the radio interface.
In addition for the compression method described above, it may be possible to
compress certain Information Elements of the User Data Header of a TPDU. The
compression method is defined in subclause 9.2.3.24.10.1.13.
## 3.10 Enhanced Messaging Service
The Enhanced Messaging Service (EMS) is based upon the standard SMS, but with
formatting added to the text. The formatting may permit the message to contain
animations, pictures, melodies, formatted text, and vCard and vCalendar
objects. Objects may be mixed together into one message. This clause overviews
the supported features. The coding mechanisms and formats are specified in
subclause 9.2.3.24.10.
The following sub clauses describe a number of features of EMS. The data
formats in the features below shall be supported (ie the UE shall behave in a
predictable manner when receiving such data) but the features are supported
subject to the capabilities of the UE. However, it is highly recommended that
all of these features are implemented otherwise interoperability problems at
the application level may result.
### 3.10.1 Text formatting
The following text formatting features are supported:
**Alignment**
\- Left
\- Centre
\- Right
\- Default (Language dependent)
**Font size**
\- Normal
\- Large
\- Small
**Style**
\- Normal
**\- Bold**
_\- Italic_
[- Underlined]{.underline}
~~- Strikethrough~~
\- Text Colour
\- Text Background Colour
### 3.10.2 Pictures
Basic Pictures
It is possible to include either a small (16*16 pixels), large (32*32 pixels)
or pictures of variable size. These pictures have neither animation nor grey
scale; they are plain black and white. All pictures are user defined.
Extended Pictures
It is possible to include extended pictures. These pictures may be black and
white, greyscale or colour bit maps. The picture size is a maximum of 255 x
255 pixels. These pictures may be transmitted in a compressed form.
### 3.10.3 Animations
Predefined
There are number of predefined animations. These animations are not sent as
animation over the air interface, only the identification of them. As soon as
the position of the animation in the SM data is reached, the animation
corresponding to the received number shall be displayed in a manner which is
manufacturer specific.
User Defined
The user-defined animations consist of 4 pictures and there are two different
sizes of these animations. The picture size of the small animations are 8*8
pixels and the large 16*16 pixels. These animations are sent over the air
interface.
Extended Animations
It is possible to include extended animations. These may be black and white,
greyscale or colour bit maps. The maximum size of a single animated frame is
255 x 255 pixels. The repetition of these animations may be controlled by the
originator. These animations may be transmitted in a compressed form.
### 3.10.4 Sound
Predefined
There are a number of predefined sounds. These sounds are not transferred over
the air interface, only the identification of them. There are 10 different
sounds that can be added in the message, and as soon as the sound mark is in
focus (on the display), the sound will be played.
User Defined
The sender can define own melodies according to the iMelody format [33]. These
melodies are transferred in the SM and can take up to 128 bytes.
Extended Sounds
Monophonic melodies may be transferred using the iMelody format [33]. These
may be transmitted in a compressed form.
### 3.10.5 vCard and vCalendar
A message may contain vCard and vCalendar objects as specified in [36][37].
These may be transmitted in a compressed form.
### 3.10.6 WVG (Wireless Vector Graphics) Object
A message may contain one or more WVG objects. A WVG object is a vector
graphics picture or animation and is scalable. Two subtypes of WVG objects are
supported; Standard WVG object and Character Size WVG object. Actual display
size of a Standard WVG object depends on display screen size and MMI
implementation on terminals. A Character Size WVG object has a height that
equals or is similar to the height of message text but with variable width.
Character Size WVG object may be edited in the same way as standard text, e.g.
insertion deletion and text wrapping.
#### 3.10.6.1 Overview of WVG Graphical Primitives
The WVG element is used to describe vector graphics objects. The vector
graphics format is used to allow the creation of small pictures which may
include simple animation or the creation small handwritten sketches. WVG makes
use of the following graphical primitives (full detail is listed in annex G.2)
These primitives can be used to describe a compact drawing.
List of Graphical Primitives:
  * Polylines (G2.1)
```{=html}
``` \- Simple Line Polyline (G.2.1.1)
  * Circular Polyline (G.2.1.2)
  * Bezier lines (G.2.1.3)
```{=html}
``` \- Polygons (G.2.2)
```{=html}
``` \- Arbitrary Polygon (G.2.2)
  * Regular Polygon (G.2.4)
  * Star Shaped Polygon (G.2.4)
  * Regular Grid Element (G.2.4)
```{=html}
``` \- Ellipses (G.2.3.1)
  * Rectangles (G.2.3.2)
  * Text Element (G.2.5)
  * Grouping Element (G.2.6)
  * Reuse Element (G.2.7)
  * Animations Elements (G.2.8)
  * Frame Element (G.2.9)
  * Local Element (G.2.10)
# 4 Network architecture
## 4.1 Basic network structure
The exchange of messages between an MS and an SME involves the entities shown
in figure 4.
The architecture for providing SMS over a generic IP CAN is described in 3GPP
TS 23.204 [42] (see subclause 5).
The basic network structure of the SMS is depicted in figure 5.
{width="6.686805555555556in" height="2.0652777777777778in"}
*): SMS‑GMSC when the short message is transferred from the SC to the MS, SMS‑IWMSC when the short message is transferred from the MS to the SC. The SC may be integrated with the SMS‑GMSC/SMS‑IWMSC.
**): SGSN is used in place of the MSC for SMS transfer over GPRS.
***): The SMS Router is an optional functional entity, and is used only in the
MT case.
Figure 4: Entities involved in the provision of SM MT and SM MO
The reference points of figure 5 support the short message transfer in the
following way:
‑ message transfer on reference point 1 is described in clause 5;
‑ the operations performed on reference points 2 and 4 are described in 3GPP
TS 29.002 [15];
‑ message transfer on reference point 3 is described in subclause 4.2;
‑ message transfer on reference point 5 is supported by the protocol described
in 3GPP TS 24.011 [13].
{width="6.334027777777778in" height="1.7277777777777779in"}
NOTE 1: Reference point 4 is not used for SMS transfer via the SGSN
NOTE 2: The SMS Router is an optional entity that may be present in the MT
case only. If it is not present, reference point 3 extends from the SMS-GMSC
directly to the MSC/SGSN.
Figure 5: The main network structure serving as a basis for the short message
transfer
## 4.2 Transfer on reference point 3
Reference point 3 is used to support communications between:
\- MSC \ SMS‑GMSC / SMS‑IWMSC;
\- SGSN \ SMS-GMSC / SMS-IWMSC;
\- SMS Router \ SMS‑GMSC;
\- SMS Router \ MSC;
\- SMS Router \ SGSN.
If any of the above two end nodes are in the same PLMN, the definition of this
reference point is left to the operators. For example, this reference point
may use:
‑ PSPDN; or
‑ CCITT SS no 7 (according to 3GPP TS 29.002 [15]).
If any of the above two end nodes are in different PLMNs, this reference point
shall use CCITT SS no 7 according to 3GPP TS 29.002 [15], unless otherwise
bilaterally agreed.
# 5 Service Centre and PLMN interconnection
The present document deals with the SC only with regard to the interchange of
messages between SC and MS. Only the requirements put upon the SC by the SMS
functionality are specified in the present document.
## 5.1 Service centre connection
One SC may be connected to several PLMNs, and may be connected to several MSCs
(SMS‑GMSCs or SMS‑IWMSCs) within one and the same PLMN.
The SC is addressed from the mobile by an E.164 [17] number in the numbering
plan of the PLMN to which the SC is connected. This E.164 [17] number shall
uniquely identify the SC to that PLMN.
There may be an intermediate network between the PLMN and the SC; in this case
the PLMN must autonomously make a connection to the SC using the SC address in
this intermediate network.
No mandatory protocol between the SC and the MSC below the transfer layer is
specified by GSM/UMTS; this is a matter for agreement between SC and PLMN
operators. However, annex A provides an example protocol stack which could be
used.
## 5.2 Routing requirements
### 5.2.1 Mobile terminated short message
The SC sends the short message to the SMS‑GMSC. The SMS‑GMSC interrogates the
HLR to retrieve routing information necessary to forward the short message,
and then sends the message to the relevant MSC or SGSN, transiting other
networks if necessary and transiting an SMS Router in the HPLMN of the
receiving MS if this is deployed. The MSC or SGSN then sends the short message
to the MS.
### 5.2.2 Mobile originated short message
The MS sends the short message to the MSC or the SGSN. The MS shall always
address the required SC by an E.164 [17] address. The visited PLMN shall route
the message to the appropriate SMS‑IWMSC in the SC\'s PLMN, transiting other
networks if necessary.
As an operator option, the SMS-IWMSC may interrogate the HLR to retrieve the
recipient's IMSI in order to check that an SMS Interworking agreement exists
between the two networks.
# 6 Service Centre functionality
In the present document, only the SC functionality related to the short
message service between the SC and the MS is specified.
## 6.1 Service Centre capabilities
The SC should be capable of:
‑ submitting a short message to an MS, retaining the responsibility of the
message until
1) the report has been received; or
2) the Validity‑Period expires.
‑ receiving a report from the PLMN;
‑ receiving a short message from an MS;
‑ returning a report to the PLMN for a previously received short message.
## 6.2 SC functional requirements
The detailed functionality of the SC is outside the scope of the present
document, and is for the SC operator to define. However, the following
functional requirements are mandatory for all SCs in order to support the
SM‑TP (see clause 9) towards the PLMN:
1) To identify each SMS‑DELIVER sent to an MS in a unique way, a time stamp
value is included in the field TP‑Service‑Centre‑Time‑Stamp, TP‑SCTS, of the
SMS‑DELIVER. The time stamp gives the time when the message arrived at the SC
with the accuracy of a second. If two or more messages to the same MS arrive
at the SC within one second, the SC shall modify the time stamp of those
messages in such a way that:
a) all messages to the MS contain different time stamps;
b) the modification of the time stamps is kept to a minimum.
2) The SC is only allowed to have one outstanding SMS‑DELIVER (i.e. a message
for which a report has not been received) to a specific MS at a given time.
3) The SC shall be able to initiate overwriting of short messages previously
received by the SC if requested by the same originating address (MS or any
other source) by use of the same message type.
### 6.2.1 Subaddressing support
Support for subaddressing is an optional functional requirement for an SC. If
it is supported, subaddressing information shall be conveyed from SME to SME
according the following rules:
  * A SME may send a SM with '*'s or '#'s included in the TP-DA field. The first '#' encountered in TP-DA indicates where the address for SC routing purposes is terminated. Additional '*'s or '#'s can be present in the following digits, and all these digits including the first '#' are subaddress digits.
  * When the SC receives a SM to convey with such a subaddress information, it should deliver the SM to the destination SME with the same subaddress digits copied in the TP-OA field.
This subaddressing mechanism does not apply when the TON is alphanumeric
Example:
SME with number 987654321 sends a SM with TP-DA = 1234#56#789*
SME with number 1234 will receive the SM with TP-OA = 987654321#56#789*
## 6.3 SC EMS Extended Object Data Request Command Feature
An SME has the ability of determining which data formats within the Extended
Object IE are supported by a specific terminal. The SC has the option of
supporting this feature using an SMS-DELIVER PDU. This SMS-DELIVER PDU shall
contain the EMS Data Format Delivery Request IE, and be marked for automatic
deletion by the mobile station.
# 7 MS functionality
In the present document, only the MS functionality related to the short
message service between the SC and the MS is specified.
## 7.1 MS capabilities
The MS, when equipped for SMS, should be capable of:
‑ submitting a short message TPDU to an SC, retaining the responsibility of
the message until:
1) the report arrives from the network; or
2) a timer expires.
‑ receiving a short message TPDU from an SC;
‑ returning a delivery report to the network for a previously received short
message;
‑ receiving a report from the network;
‑ notifying the network when it has memory capacity available to receive one
or more short messages when it has previously rejected a short message because
its memory capacity was exceeded;
‑ notifying the SC when a short message is intended to replace a short message
the MS has previously submitted to the same destination address.
It is recommended that an MS supporting both replying and automatic SC
selection (as specified in clause D.2 of annex D) follows procedures specified
in annex D when replying to MT short messages with MO short messages.
It is recommended that an MS supporting a capability for requesting a reply
path follows procedures specified in annex D.
## 7.2 MS configuration
The reference configuration is assumed as in figure 6, i.e. only the case
where the terminal is integrated in the MS is considered.
Figure 6: Reference configuration of the MS which apply to the SMS
NOTE: It is foreseen that a terminal interface may be offered, e.g. for higher
layer protocols, memory capacity reasons or to be able to type in mobile
originated messages. This terminal interface is regarded as an implementation
option, although, where offered, it must be based upon an R‑ or S‑reference
point. 3GPP TS 27.005 [14] provides an example based on the R reference point.
# 8 Node functionality
The overall requirements to the MSC, SMS-GMSC, SMS-IWMSC, SGSN and SMS Router
with respect to handling of the Short Message Service is to cater for the
routing and necessary intermediate buffering of the short messages.
## 8.1 Node functionality related to SM MT
### 8.1.1 Functionality of the SMS‑GMSC
When receiving a short message TPDU from the SC, the SMS‑GMSC is responsible
for the following operations:
‑ reception of the short message TPDU;
‑ inspection of the parameters.
NOTE 1: The SMS‑GMSC may be identical to the MSC.
if parameters are incorrect:
‑ returning the appropriate error information to the SC in a failure report
(see clauses 9 and 10);
if errors are not found within parameters:
‑ interrogating the HLR (\"sendRoutingInfoForShortMsg\", see clause 10);
retrieving routing information or possible error information;
if HLR is returning error information:
‑ returning the appropriate error information to the SC in a failure report
(see clauses 9 and 10);
if no errors are indicated by the HLR:
‑ transferring the short message TPDU to the MSC or SGSN using the routing
information obtained from the HLR (\"forwardShortMessage\", see clause 10);
NOTE 2: In case where two addresses (SGSN and MSC) are received from HLR, the
SMS-GMSC may choose (operator dependant) via which nodes (SGSN or MSC) the SMS
is first to be sent. The SMS delivery via the SGSN is normally more radio
resource efficient than the SMS delivery via the MSC.
if one address (SGSN or MSC) is received from HLR:
\- When receiving the report associated with the short message from the MSC or
SGSN (positive or negative outcome of \"forwardShortMessage\", see clause 10),
the SMS‑GMSC is responsible for the following operations;
if the report indicates successful delivery:
‑ notifying the HLR of the successful delivery via the MSC or the SGSN, which
shall cause the HLR to alert any service centres whose addresses are stored in
the MWD for the MS;
‑ creating and sending the successful report to the SC;
if the report is a failure report indicating \"absent subscriber\" via the MSC
or the SGSN (see clause 3.3):
‑ requesting the HLR to insert the address of the originating SC into the MWD
(if implemented) with cause Absent Subscriber (\"SM_DeliveryReportStatus\",
see clauses 9 and 10);
\- informing the HLR of the reason for the MS being absent via the MSC or the
SGSN (if this information is available);
‑ establishing, where necessary, a link with the addressed SC (see clause 5);
‑ creating and sending the negative report to the SC which should include the
reason for the MS being absent (if this information is available) so that the
SC may adjust any retry algorithm appropriately (see clauses 9 and 10);
if the report is a failure report indicating \"MS memory capacity exceeded\"
via the MSC or the SGSN (see clause 3.3):
‑ requesting the HLR to insert the address of the originating SC into the MWD
(if implemented) with cause MS Memory Capacity Exceeded via the MSC or the
SGSN (\"SM_DeliveryReportStatus\" , see clauses 9 and 10);
‑ establishing, where necessary, a link with the addressed SC (see clause 5);
‑ creating and sending the report to the SC (see clauses 9 and 10).
if two addresses (SGSN and MSC) are received from HLR:
\- When receiving the first report associated with the short message from the
MSC or SGSN (positive or negative outcome of \"forwardShortMessage\", see
clause 10), the SMS‑GMSC is responsible for the following operations:
if the first report indicates successful delivery:
‑ notifying the HLR of the successful delivery via the MSC or the SGSN, which
shall cause the HLR to alert any service centres whose addresses are stored in
the MWD for the MS;
‑ creating and sending the successful report to the SC;
if the first report is a failure report indicating:
\- Unidentified subscriber;
\- Facility not supported;
\- Absent subscriber with indication: GPRS or IMSI Detach;
\- System failure;
\- Unexpected data value;
\- Data missing;
  * GPRS connection suspended (see 3GPP TS 29.002 [15]);
  * SM Delivery Failure with indication: equipment Not SM Equipped:
‑ transferring the short message TPDU to the second path using the routing
information obtained from HLR.
if the second report indicates successful delivery:
‑ notifying the HLR of the successful delivery of the second transfer via the
MSC or SGSN, which shall cause the HLR to alert any service centres whose
addresses are stored in the MWD for the MS;
\- notifying the HLR of the unsuccessful delivery at first transfer only with
cause \"absent subscriber\";
\- notifying the HLR of the reason for the MS being absent via the MSC or the
SGSN (if this information is available);
\- establishing, when necessary, a link with the addressed SC (see clause 5);
‑ creating and sending the successful report to the SC;
if the second report is a failure report:
‑ requesting the HLR to insert the address of the originating SC into the MWD
(if implemented) only if at least one of the first or second report failed due
to \"MS Memory Capacity Exceeded\" or \"Absent Subscriber\"
(\"SM_DeliveryReportStatus\", see clauses 9 and 10);
\- notifying the HLR only with the causes \"Absent Subscriber\", \"Memory
Capacity Exceeded\" via the MSC or the SGSN, or both;
\- notifying the HLR of the reason for the MS being absent via the MSC, SGSN
or both (if this information is available);
‑ establishing, where necessary, a link with the addressed SC (see clause 5);
‑ creating and sending the negative report to the SC with errors from first
and second path (see clauses 9 and 10).
### 8.1.2 Functionality of the MSC
When receiving a short message TPDU from the SMS‑GMSC
(\"forwardShortMessage\", see clause 10), the MSC is responsible for the
following operations:
‑ reception of the short message TPDU;
\- the receiving network may verify if the received SM-SC address (contained
in RP-OA IE) and SCCP Calling Party Address are of the same PLMN;
‑ retrieving information from the VLR (\"sendInfoFor‑MT‑SMS\", see clause 10);
location area address and, when appropriate, error information;
if errors are indicated by the VLR:
‑ returning the appropriate error information to the SMS‑GMSC in a failure
report (negative outcome of \"forwardShortMessage\" see clauses 10 and 11);
if no errors are indicated by the VLR:
‑ transferring the short message to the MS (see 3GPP TS 24.011 [13]).
When receiving a confirmation that the message is received by the MS (see 3GPP
TS 24.011 [13]):
‑ relaying the delivery confirmation to the SMS‑GMSC in a delivery report
(positive outcome of \"forwardShortMessage\", see clauses 10 and 11).
When receiving a failure report of the short message transfer to the MS (see
3GPP TS 24.011 [13]):
‑ returning the appropriate error information to the SMS‑GMSC in a failure
report (negative outcome of \"forwardShortMessage\", see clause 10).
When receiving a notification from the MS that it has memory available to
receive one or more short messages (see 3GPP TS 24.011 [13]):
‑ relaying the notification to the VLR (\"mSMemoryCapacityAvailable\", see
clause 10);
if errors are indicated by the VLR:
‑ returning the appropriate error information to the MS in a failure report
(negative outcome of \"ReadyForSM\", see clauses 10 and 11).
When there is an ongoing MT-SMS transfer to the MS (see 3GPP TS 24.011 [13]),
or other busy condition for MT-SMS, the MSC has the option to store the TPDU
in a queue for a short time (which must be shorter than the supervision timer
defined in 3GPP TS 29.002 [15]). The maximum time that a message may be queued
is related to the permitted delay for the MSC to respond to the SMS-GMSC. When
the MS becomes available for MT-SMS transfer, the stored TPDUs are delivered
to the MS on a first-in first-out basis. If a message is not successfully
transferred to the MS within the permitted time, the MSC returns an
appropriate error to the SMS-GMSC.
NOTE: The reaction of MSC when the message verification failed is operator
specific and not specified in 3GPP specifications.
### 8.1.3 Functionality of the SGSN
When receiving a short message TPDU from the SMS‑GMSC
(\"forwardShortMessage\", see clause 10), the SGSN is responsible for the
following operations:
‑ reception of the short message TPDU;
\- the receiving network may verify if the received SM-SC address (contained
in RP-OA IE) and SCCP Calling Party Address are of the same PLMN.
if errors are detected by the SGSN:
‑ returning the appropriate error information to the SMS‑GMSC in a failure
report (negative outcome of \"forwardShortMessage\" see clauses 10 and 11);
if no errors are detected by the SGSN:
‑ transferring the short message to the MS (see 3GPP TS 24.011 [13]).
When receiving a confirmation that the message is received by the MS (see 3GPP
TS 24.011 [13]):
‑ relaying the delivery confirmation to the SMS‑GMSC in a delivery report
(positive outcome of \"forwardShortMessage\", see clauses 10 and 11).
When receiving a failure report of the short message transfer to the MS (see
3GPP TS 24.011 [13]):
‑ returning the appropriate error information to the SMS‑GMSC in a failure
report (negative outcome of \"forwardShortMessage\", see clause 10).
When receiving a notification from the MS that it has memory available to
receive one or more short messages (see 3GPP TS 24.011 [13]):
if errors are detected by the SGSN:
‑ returning the appropriate error information to the MS in a failure report
(negative outcome of \"ReadyForSM\", see clauses 10 and 11).
if no errors are detected by the SGSN:
\- notifying the HLR of memory available in the MS via the SGSN with
\"ReadyForSM\" (see clauses 10 and 11).
When the MS is becoming reachable again (see GSM 44.008 [12]):
\- notifying the HLR of MS being reachable via the SGSN (and via the MSC if
any) with \"ReadyForSM\" (see clauses 10).
When there is an ongoing MT-SMS transfer to the MS (see 3GPP TS 24.011 [13]),
or other busy condition for MT-SMS, the SGSN has the option to store the TPDU
in a queue for a short time (which must be shorter than the supervision timer
defined in 3GPP TS 29.002 [15]). The maximum time that a message may be queued
is related to the permitted delay for the SGSN to respond to the SMS-GMSC.
When the MS becomes available for MT-SMS transfer, the stored TPDUs are
delivered to the MS on a first-in first-out basis. If a message is not
successfully transferred to the MS within the permitted time, the SGSN returns
an appropriate error to the SMS-GMSC.
NOTE: The reaction of SGSN when the message verification failed is operator
specific and not specified in 3GPP specifications.
### 8.1.4 Functionality of the SMS Router
When receiving a routing information retrieval
(\"sendRoutingInfoForShortMsg\", see clause 10), the SMS Router is responsible
for the following operations:
‑ interrogating the HLR (\"sendRoutingInfoForShortMsg\", see clause 10);
retrieving routing information or possible error information. This
interrogation may be omitted if a parameter within the
\"sendRoutingInfoForShortMsg\" explicitly indicates that delivery of a short
message is not intended and only MCC+MNC are requested.
if HLR is returning error information:
‑ forwarding the returned error information transparently to the SMS-GMSC;
if no errors are indicated by the HLR:
‑ creating an MT Correlation ID;
\- storing against the MT Correlation ID: the IMSI, the MSC address and/or the
SGSN address. The address of the SMS‑GMSC and the destination MSISDN may also
be stored. Creating an MT Correlation ID and storing these data against the MT
Correlation ID may be omitted if a parameter within the
\"sendRoutingInfoForShortMsg\" explicitly indicates that delivery of a short
message is not intended;
\- forwarding the returned information to the SMS-GMSC populating the IMSI IE
with the MT Correlation ID and either:
a) the MSC address and/or SGSN address with the address of the SMS Router; or
NOTE 1: In this case if two addresses (SGSN and MSC) are received from HLR,
the SMS-GMSC chooses (operator dependant) via which node (SGSN or MSC) the SM
is first to be sent, not the SMS Router.
b) the address of the SMS Router. In this case the SMS Router delivers the SM
as described in 3GPP TS 23.204 [42] for the IP-SM-GW. This option is mandatory
when the SMS Router is deployed together with an IP-SM-GW.
NOTE 2: In this case if two addresses (SGSN and MSC) are received from HLR,
the SMS Router chooses via which node (SGSN or MSC) the SM is first to be
sent, i.e. the SMS Router delivers the SM as an IP-SM-GW.
If a parameter within the \"sendRoutingInfoForShortMsg\" explicitly indicates
that delivery of a short message is not intended and that only IMSI or only
MCC+MNC are requested, the IMSI IE may be populated with IMSI or MCC+MNC+dummy
MSIN, respectively, and the MSC address and/or SGSN address with a dummy
network node address.
if HLR is returning an Inform-Service-Centre information:
\- fowarding the received information transparently to the SMS-GMSC.
When receiving a short message TPDU from the SMS‑GMSC
(\"forwardShortMessage\", see clause 10), the SMS Router is responsible for
the following operations:
‑ receiving the short message TPDU;
\- checking validity of the MT Correlation ID received in the IMSI field
The MT Correlation ID shall be considered invalid if the MT Correlation ID is
unknown. Optionally, the MT Correlation ID may also be considered invalid if
the CC and NDC of the address of the SMS-GMSC from which the
forwardShortMessage was received is different from the CC and NDC of the
SMS‑GMSC address stored above i.e. the forwardShortMessage has originated from
a different network than that which issued the sendRoutingInfoForShortMsg.
If the received MT Correlation ID is deemed invalid by the SMS Router:
‑ returning the error \"System failure\" to the SMS‑GMSC in a failure report
(negative outcome of \"forwardShortMessage\" see clauses 10 and 11).
If the received MT Correlation ID is deemed valid by the SMS Router:
‑ transferring the short message TPDU to the MSC (if the called party SSN in
the received message is for MSC) or to the SGSN (if the called party SSN in
the received message is for SGSN) using the stored routing information and
replacing the MT Correlation ID with the stored IMSI (obtained from the HLR,
above);
\- support for service execution, lawful interception, and number portability
if required;
\- forwarding the delivery confirmation or failure report from the MSC or SGSN
(which may have originally come from the MS) transparently to the SMS-GMSC;
and
\- if the SMS Router finds that SMS delivery is to be performed towards
serving MSC or SGSN in a different PLMN, the SMS Router may replace the SMS-SC
address in RP OA with an address containing the PLMN ID of the PLMN in which
the SMS-Router is located before the SMS router forwards the request to the
serving MSC or SGSN.
NOTE 3: This option can be used if the PLMN that deploys the SMS-router wants
to ensure the delivery of a MT-SMS to a UE roaming in a different PLMN and
this PLMN is known to deploy PLMN ID check on both RP-OA IE and SCCP Global
Title.
NOTE 4: When using this functionality, the PLMN deploying the SMS-Router must
be aware that reply path functionality offered by the originating SMS-SC
cannot be used.
### 8.1.5 Functionality of the IP-SM-GW
The IP-SM-GW is described in 3GPP TS 23.204 [42], it provides:
\- protocol interworking for delivery of short message between the IP-based UE
and the SMSC;
\- delivery of the SM to the MSC/SGSN if needed as described in 3GPP TS 23.204
[42]; and
\- support for service execution, lawful interception, and number portability
if required.
## 8.2 Node functionality related to SM MO
### 8.2.1 Functionality of the MSC
When receiving a short message TPDU from the MS, the MSC is responsible for
the following operations:
‑ reception of the short message TPDU (see 3GPP TS 24.011 [13]);
‑ retrieving information from the VLR (\"sendInfoForMO‑SMS\", see clause 10);
the MSISDN of the MS and, when appropriate, error information. The retrieval
of information from the VLR is followed by the VLR investigating the MNRF (to
be used in the alerting procedure, see clause 10)
if errors are indicated by the VLR:
‑ returning the appropriate error information to the MS in a failure report
(negative outcome of \"sendInfoForMO‑SMS\" see clauses 10 and 11);
if no errors are indicated by the VLR:
‑ inspection of the RP-DA parameter;
if parameters are incorrect:
‑ returning the appropriate error information to the MS in a failure report
(see 3GPP TS 24.011 [13]);
if no parameter errors are found:
NOTE: The SMS‑IWMSC may be identical to the MSC.
‑ transferring the short message TPDU to the SMS‑IWMSC
(\"forwardShortMessage\", see clause 10).
When receiving the report of the short message from the SMS‑IWMSC (positive or
negative outcome of the \"forwardShortMessage\", see clause 10), the MSC is
responsible for the following operations:
‑ relaying the report to the MS (see 3GPP TS 24.011 [13]).
### 8.2.2 Functionality of the SMS‑IWMSC
When receiving a short message TPDU from the MSC, IP-SM-GW or SGSN
(\"forwardShortMessage\", see clause 10), the SMS‑IWMSC is responsible for the
following operations:
> ‑ reception of the short message TPDU;
>
> ‑ optionally, interrogating the HLR (\"sendRoutingInfoForShortMsg\", see
> clause 10); retrieving the recipient's IMSI in order to check for the
> existence of an SMS Interworking agreement before establishing a link with
> the addressed SC;
if HLR returns error information:
> ‑ returning the appropriate error information to the MSC or SGSN in a
> failure report (negative outcome of \"forwardShortMessage\", see clause 10);
if no errors are indicated by the HLR:
> ‑ inspecting the IMSI parameter and ignoring the other routing information;
if the received parameter is unacceptable to the SMS-IWMSC (due to lack of an
SMS Interworking agreement):
‑ returning SM Delivery Failure with indication: invalid SME-address to the
MSC or SGSN;
if the parameter is acceptable to the SMS-IWMSC (due to the existence of an
SMS Interworking agreement) or the SMS-IWMSC didn't apply the optional HLR
interrogation:
‑ establishing, where necessary, a link with the addressed SC (see clause 5);
‑ transferring the short message TPDU to the SC (if the address is valid);
if a report associated with the short message is received from the SC, the
SMS‑IWMSC is responsible for the following operations:
‑ relaying of the report to the MSC or SGSN (positive or negative outcome of
\"forwardShortMessage\", see clause 10);
if a report associated with the short message is not received from the SC
before a timer expires or if the SC address is invalid, the SMS‑IWMSC is
responsible for the following operations:
‑ returning the appropriate error information to the MSC or SGSN in a failure
report (negative outcome of \"forwardShortMessage\", see clause 10).
The value of the timer is dependent on the protocol between the SC and the
SMS‑IWMSC.
### 8.2.3 Functionality of the SGSN
When receiving a short message TPDU from the MS, the SGSN is responsible for
the following operations:
‑ reception of the short message TPDU (see 3GPP TS 24.011 [13]);
‑ inspection of the RP-DA parameter;
if parameters are incorrect:
‑ returning the appropriate error information to the MS in a failure report
(see 3GPP TS 24.011 [13]);
if no parameter errors are found:
‑ transferring the short message TPDU to the SMS‑IWMSC
(\"forwardShortMessage\", see clause 10).
When receiving the report of the short message from the SMS‑IWMSC (positive or
negative outcome of the \"forwardShortMessage\", see clause 10), the SGSN is
responsible for the following operations:
‑ relaying the report to the MS (see 3GPP TS 24.011 [13]).
### 8.2.4 Functionality of the IP-SM-GW
Successful SM MO delivery procedure with IP-SM-GW is described in 3GPP TS
23.204 [42] (see subclause 6.3).
## 8.3 SMS‑IWMSC functionality related to alerting
When receiving an alert from the HLR (\"alertServiceCentre\", see clause 10),
the SMS‑IWMSC is responsible for the following operations:
‑ inspect the SC address;
‑ generate an RP‑Alert‑SC (see clause 9);
‑ transferring the RP‑Alert‑SC to the SC.
NOTE: If the SC address is not valid, then no further action shall be taken.
# 9 Protocols and protocol architecture
The protocol layers of the SMS are structured as shown in figure 7.
{width="6.252777777777778in" height="2.9875in"}
NOTE: The SMS Router is an optional functional entity, and is used only in the
MT case.
Figure 7: Protocol layer overview for the Short Message Service
The present document specifies the protocol at the SM‑TL, the service offered
by the SM‑TL at the MS and the SC, and the service offered by the SM‑RL at the
SC.
Note that while normally SM-TL terminates at the SC in SM MO, the SMS-IWMSC
may inspect TP-DA in SMS-SUBMIT for the purpose of checking the existence of
an SMS interworking agreement (see clause 8.2.2).
## 9.1 Protocol element features
### 9.1.1 Octet and Bit transmission order
The octets are transmitted according to their individual numbering; the octet
with the lowest number being transmitted first. The bits within each octet are
transmitted according to their individual numbering also; the bits with the
lowest internal number being transmitted first.
### 9.1.2 Numeric and alphanumeric representation
For parameters within the TPDUs, there are four ways of numeric
representation: Integer representation, octet, semi‑octet and alphanumeric
representation.
#### 9.1.2.1 Integer representation
Wherever the bits from a number of octets, complete or in fractions, are to
represent an integer, the interpretation shall be according to the following:
1) Between octets: the octets with the lowest octet numbers shall contain the
most significant bits, i.e. the byte order shall be big endian.
2) Within an octet: the bits with the highest bit numbers shall be the most
significant.
Below is given an example of octet and bit representation and transmission
order of an integer represented field.
Let the 2 rightmost bits of octet no 5, the complete octet no 6 and 7, and the
3 leftmost bits of octet no 8 represent an integer, as shown in figure 8.
*): Bits not representing the integer.
Figure 8: 21 bits from the octets 5, 6, 7, and 8 in a short message α) shall
represent an integer as shown in β), and shall be transmitted in an order as
shown in Γ)
#### 9.1.2.2 Octet representation
A field which is octet represented, shall always consist of a number of
complete octets. Each octet within the field represents one decimal digit. The
octets with the lowest octet numbers shall contain the most significant
decimal digits.
#### 9.1.2.3 Semi‑octet representation
A field which is semi‑octet represented, shall consist of a number of complete
octets and ‑ possibly ‑ one half octet. Each half octet within the field
represents one decimal digit. The octets with the lowest octet numbers shall
contain the most significant decimal digits. Within one octet, the half octet
containing the bits with bit numbers 0 to 3, shall represent the most
significant digit.
In the case where a semi‑octet represented field comprises an odd number of
digits, the bits with bit numbers 4 to 7 within the last octet are fill bits
and shall always be set to \"1111\".
If a mobile receives an address field containing non‑integer information in
the semi‑octets other than \"1111\" (e.g. 1110) it shall display the
semi‑octet as the representation given in GSM 44.008 [12] under \"called BCD
number\", viz 1010=\"*\", 1011=\"#\", 1100=\"a\", 1101=\"b\", 1110=\"c\". In
the event of a discrepancy between the values quoted here and the values
specified in GSM 44.008[12] then GSM 44.008 [12] shall take precedence. If a
mobile receives \"1111\" in a position prior to the last semi‑octet then
processing shall commence with the next semi‑octet and the intervening
semi‑octet shall be ignored.
Within each semi octet, the bits with the highest bit numbers shall be the
most significant.
Below is given an example:
Octet no:
#### 9.1.2.4 Alphanumeric representation
A field which uses alphanumeric representation shall consist of a number of
7‑bit characters represented as the default alphabet defined in 3GPP TS 23.038
[9].
#### 9.1.2.5 Address fields
Address fields used by SM‑RL are specified in 3GPP TS 24.011 [13] and 3GPP TS
29.002 [15].
Each address field of the SM‑TL consists of the following sub‑fields: An
Address‑Length field of one octet, a Type‑of‑Address field of one octet, and
one Address‑Value field of variable length; as shown below:
The Address‑Length field is an integer representation of the number of useful
semi‑octets within the Address‑Value field, i.e. excludes any semi octet
containing only fill bits.
The Type‑of‑Address field format is as follows:
Type‑of‑number:
Bits 6 5 4
0 0 0 Unknown 1)\ 0 0 1 International number 2)\ 0 1 0 National number 3)\ 0 1
1 Network specific number 4)\ 1 0 0 Subscriber number 5)\ 1 0 1 Alphanumeric,
(coded according to 3GPP TS 23.038 [9] GSM 7‑bit default alphabet)\ 1 1 0
Abbreviated number\ 1 1 1 Reserved for extension
The MS shall interpret reserved values as \"Unknown\" but shall store them
exactly as received.
The SC may reject messages with a type of number containing a reserved value
or one which is not supported.
Reserved values shall not be transmitted by an SC conforming to this version
of the specification.
1) \"Unknown\" is used when the user or network has no a priori information
about the numbering plan. In this case, the Address‑Value field is organized
according to the network dialling plan, e.g. prefix or escape digits might be
present.
2) The international format shall be accepted also when the message is
destined to a recipient in the same country as the MSC or as the SGSN.
3) Prefix or escape digits shall not be included.
4) \"Network specific number\" is used to indicate administration/service
number specific to the serving network, e.g. used to access an operator.
5) \"Subscriber number\" is used when a specific short number representation
is stored in one or more SCs as part of a higher layer application. (Note that
\"Subscriber number\" shall only be used in connection with the proper PID
referring to this application).
Numbering‑plan‑identification
Bits 3 2 1 0
0 0 0 0 Unknown\ 0 0 0 1 ISDN/telephone numbering plan (E.164 [17]/E.163[18])\
0 0 1 1 Data numbering plan (X.121)\ 0 1 0 0 Telex numbering plan\ 0 1 0 1
Service Centre Specific plan 1)\ 0 1 1 0 Service Centre Specific plan 1)\ 1 0
0 0 National numbering plan\ 1 0 0 1 Private numbering plan\ 1 0 1 0 ERMES
numbering plan (ETSI DE/PS 3 01‑3)\ 1 1 1 1 Reserved for extension\ All other
values are reserved.
1) \"Service Centre specific number\" is used to indicate a numbering plan
specific to External Short Message Entities attached to the SMSC.
For Type‑of‑number = 101 bits 3,2,1,0 are reserved and shall be transmitted as
0000. Note that for addressing any of the entities SC, MSC, SGSN or MS,
Numbering‑plan‑identification = 0001 shall always be used. However, for
addressing the SME, any specified Numbering‑plan‑identification value may be
used.
The MS shall interpret reserved values as \"Unknown\" but shall store them
exactly as received.
The SC may reject messages with a type of number containing a reserved value
or one which is not supported.
Reserved values shall not be transmitted by an SC conforming to this version
of the specification.
Within the Address‑Value field, either a semi‑octet or an alphanumeric1)
representation applies.
The maximum length of the full address field (Address‑Length, Type‑of‑Address
and Address‑Value) is 12 octets.
1) Applies only to addressing at the SM‑TL.
## 9.2 Service provided by the SM‑TL
### 9.2.1 General
The Short Message Transfer Layer (SM‑TL) provides a service to the Short
Message Application Layer (SM‑AL). This service enables the SM‑AL to transfer
short messages to its peer entity, receive short messages from its peer entity
and receive reports about earlier requests for short messages to be
transferred.
In order to keep track of messages and reports about those messages,
primitives between the SM‑AL and SM‑TL contain a Short Message Identifier
(SMI), which is a reference number for the message associated with the
primitive. This Short Message Identifier is mapped to and from the Short
Message Identifier used between the SM‑TL and the Short Message Relay Layer
(SM‑RL). The Short Message Identifier is not carried between entities and
therefore a given message may have different SMIs at the MS and SC sides (see
clause 9.3.1 below).
The SM‑TL communicates with its peer entity by the protocol described in the
following clauses.
### 9.2.2 PDU Type repertoire at SM‑TL
The SM‑TL comprises the following six PDUs:
SMS‑DELIVER, conveying a short message from the SC to the MS;
SMS‑DELIVER‑REPORT, conveying;
a) a failure cause (if necessary);
b) information as part of a positive or negative acknowledgement to an SMS-
DELIVER or SMS-STATUS-REPORT;
SMS‑SUBMIT, conveying a short message from the MS to the SC;
SMS‑SUBMIT‑REPORT, conveying;
a) a failure cause (if necessary);
b) information as part of a positive or negative acknowledgement to an SMS-
SUBMIT or SMS-COMMAND;
SMS‑STATUS‑REPORT, conveying a status report from the SC to the MS;
SMS‑COMMAND, conveying a command from the MS to the SC.
#### 9.2.2.1 SMS‑DELIVER type
Basic elements of the SMS‑DELIVER type:
* * *
Abbr. Reference P1) R2) Description TP‑MTI TP‑Message‑Type‑Indicator M 2b
Parameter describing the message type. TP‑MMS TP‑More‑Messages‑to‑Send M b
Parameter indicating whether or not there are more messages to send TP-LP TP-
Loop-Prevention O b Parameter indicating that SMS applications should inhibit
forwarding or automatic message generation that could cause infinite looping.
TP‑RP TP‑Reply‑Path M b Parameter indicating that Reply Path exists. TP‑UDHI
TP‑User‑Data‑Header‑Indicator O b Parameter indicating that the TP‑UD field
contains a Header TP‑SRI TP‑Status‑Report‑Indication O b Parameter indicating
if the SME has requested a status report. TP‑OA TP‑Originating‑Address M 2‑12o
Address of the originating SME. TP‑PID TP‑Protocol‑Identifier M o Parameter
identifying the above layer protocol, if any. TP‑DCS TP‑Data‑Coding‑Scheme M o
Parameter identifying the coding scheme within the TP‑User‑Data. TP‑SCTS
TP‑Service‑Centre‑Time‑Stamp M 7o Parameter identifying time when the SC
received the message. TP‑UDL TP‑User‑Data‑Length M I Parameter indicating the
length of the TP‑User‑Data field to follow. TP‑UD TP‑User‑Data O 3)
* * *
1) Provision; Mandatory (M) or Optional (O).
2) Representation; Integer (I), bit (b), 2 bits (2b), Octet (o), 7 octets
(7o), 2‑12 octets (2‑12o).
3) Dependent on the TP‑DCS.
Layout of SMS‑DELIVER:
* * *
              Bit no.       7   6   5   4   3   2   1   0
                        1                                         TP-MTI, TP-MMS, TP-LP, TP-SRI, TP-UDHI, TP-RP
Number of octets 1
                        2
2 to 12 TP-OA
                        1                                         TP-PID
                        1                                         TP-DCS
                                                                  TP-SCTS
                        1                                         TP-UDL
                        1
                                                                  TP-UD
* * *
NOTE: Any unused bits shall be set to zero by the sending entity and shall be
ignored by the receiving entity.
#### 9.2.2.1a SMS‑DELIVER‑REPORT type
An SMS‑DELIVER‑REPORT TPDU is carried as a RP‑User‑Data element within an
RP‑ERROR PDU and is part of the negative acknowledgement to an SMS‑DELIVER or
SMS‑STATUS‑REPORT.
An SMS‑DELIVER‑REPORT TPDU is also carried as a RP‑User‑Data element within an
RP‑ACK PDU and is part of a positive acknowledgement to a SMS‑DELIVER or
SMS‑STATUS REPORT.
**(i) SMS‑DELIVER‑REPORT for RP‑ERROR**
Basic elements of the SMS‑DELIVER‑REPORT type:
* * *
Abbr. Reference P1) P2) Description TP‑MTI TP‑Message‑Type‑Indicator M 2b
Parameter describing the message type TP-UDHI TP-User-Data-Header-Indication O
b Parameter indicating that the TP-UD field contains a Header TP‑FCS
TP‑Failure‑Cause M I Parameter indicating the reason for SMS‑DELIVER failure
TP‑PI TP‑Parameter‑Indicator M o Parameter indicating the presence of any of
the optional parameters which follow TP‑PID TP‑Protocol‑Identifier O o see
clause 9.2.3.9 TP‑DCS TP‑Data‑Coding‑Scheme O o see clause 9.2.3.10 TP‑UDL
TP‑User‑Data‑Length O o see clause 9.2.3.16 TP‑UD TP‑User‑Data O 3) 4) see
clause 9.2.3.24
* * *
1) Provision: Mandatory (M) or Optional (O).
2) Representation: Integer (I), bit (b), 2bits (2b), octet (o).
3) Dependent upon the TP‑DCS.
4) The TP‑User‑Data field in the SMS‑DELIVER‑REPORT is only available for use
by the MT.
Layout of SMS‑DELIVER‑REPORT:
Bit Number
* * *
     Number of Octets   7   6   5   4   3   2   1   0   
     1                                                  TP‑MTI, TP-UDHI
     1                                                  TP-FCS
     1                                                  TP‑PI
     0,1                                                TP‑PID
     0,1                                                TP‑DCS
     0,1                                                TP‑UDL
     0 to 158                                           TP‑UD
* * *
Bits 7 and 5 ‑ 2 in octet 1 are presently unused and the sender shall set them
to zero. If any of these bits is non‑zero, the receiver shall not examine the
other field and shall treat the TP‑Failure‑Cause as \"Unspecified error
cause\".
**(ii) SMS‑DELIVER‑REPORT for RP‑ACK**
Basic elements of the SMS‑DELIVER‑REPORT type:
* * *
Abbr Reference P1) P2) Description TP‑MTI TP‑Message Type Indicator M 2b
Parameter describing the message type TP-UDHI TP-User-Data-Header-Indication O
b Parameter indicating that the TP-UD field contains a Header TP‑PI
TP‑Parameter‑Indicator M o Parameter indicating the presence of any of the
optional parameters which follow TP‑PID TP‑Protocol‑Identifier O o see clause
9.2.3.9 TP‑DCS TP‑Data‑Coding‑Scheme O o see clause 9.2.3.10 TP‑UDL
TP‑User‑Data‑Length O o see clause 9.2.3.16 TP‑UD TP‑User‑Data O 3) 4) see
clause 9.2.3.24
* * *
1) Provision: Mandatory (M) or Optional (O).
2) Representation: Integer (I), Bit (b), 2 bits (2b), octet (o).
3) Dependent upon the TP‑DCS.
4) The TP‑User‑Data field in the SMS‑DELIVER‑REPORT is only available for use
by the MT.
Layout of SMS‑DELIVER‑REPORT:
Bit Number
* * *
     Number of Octets   7   6   5   4   3   2   1   0   
     1                                                  TP‑MTI, TP-UDHI
     1                                                  TP‑PI
     0,1                                                TP‑PID
     0,1                                                TP‑DCS
     0,1                                                TP‑UDL
     0 to 159                                           TP‑UD
* * *
Bits 7 and 5 ‑ 2 in octet 1 are presently unused in the SMS‑DELIVER‑REPORT and
the sender shall set them to zero. If any of these bits is non‑zero, the
receiver shall ignore them.
#### 9.2.2.2 SMS‑SUBMIT type
Basic elements of the SMS‑SUBMIT type:
* * *
Abbr. Reference P1) P2) Description TP‑MTI TP‑Message‑Type‑Indicator M 2b
Parameter describing the message type. TP‑RD TP‑Reject‑Duplicates M b
Parameter indicating whether or not the SC shall accept an SMS‑SUBMIT for an
SM still held in the SC which has the same TP‑MR and the same TP‑DA as a
previously submitted SM from the same OA TP‑VPF TP‑Validity‑Period‑Format M 2b
Parameter indicating whether or not the TP‑VP field is present. TP‑RP
TP‑Reply‑Path M b Parameter indicating the request for Reply Path. TP‑UDHI
TP‑User‑Data‑Header‑Indicator O b Parameter indicating that the TP‑UD field
contains a Header. TP‑SRR TP‑Status‑Report‑Request O b Parameter indicating if
the MS is requesting a status report. TP‑MR TP‑Message‑Reference M I Parameter
identifying the SMS‑SUBMIT. TP‑DA TP‑Destination‑Address M 2‑12o Address of
the destination SME. TP‑PID TP‑Protocol‑Identifier M o Parameter identifying
the above layer protocol, if any. TP‑DCS TP‑Data‑Coding‑Scheme M o Parameter
identifying the coding scheme within the TP‑User‑Data. TP‑VP
TP‑Validity‑Period O o/7o Parameter identifying the time from where the
message is no longer valid. TP‑UDL TP‑User‑Data‑Length M I Parameter
indicating the length of the TP‑User‑Data field to follow. TP‑UD TP‑User‑Data
O 3)
* * *
1) Provision; Mandatory (M) or Optional (O).
2) Representation; Integer (I), bit (b), 2 bits (2b), Octet (o), 7 octets
(7o), 2‑12 octets (2‑12o).
3) Dependent on the TP‑DCS.
Layout of SMS‑SUBMIT:
* * *
              Bit no       7   6   5   4   3   2   1   0
                       1                                         TP-MTI, TP-RD, TP-VPF TP-SRR, TP-UDHI, TP-RP
                       1                                         TP-MR
Number of 1
octets 2
2 to 12 TP-DA
                       1                                         TP-PID
                       1                                         TP-DCS
                       1
0, 1 or 7 TP-VP
                       1                                         TP-UDL
                       1
0 to 140 TP-UD
* * *
NOTE: Any unused bits shall be set to zero by the sending entity and shall be
ignored by the receiving entity.
#### 9.2.2.2a SMS‑SUBMIT‑REPORT type
An SMS‑SUBMIT‑REPORT TPDU is carried as a RP‑User‑Data element within an
RP‑ERROR PDU and is part of the negative acknowledgement to an SMS‑SUBMIT or
SMS‑COMMAND.
An SMS‑SUBMIT‑REPORT TPDU is also carried as a RP‑User‑Data element with an
RP‑ACK PDU and is part of a positive acknowledgement to a SMS‑SUBMIT or
SMS‑COMMAND.
**(i) SMS‑SUBMIT‑REPORT for RP‑ERROR**
Basic elements of the SMS‑SUBMIT‑REPORT type:
+---------+---------------------+-----+--------+---------------------+ | Abbr. | Reference | P1) | P2) | Description | +---------+---------------------+-----+--------+---------------------+ | TP‑MTI | TP‑Mes | M | 2b | Parameter | | | sage‑Type‑Indicator | | | describing the | | | | | | message type | +---------+---------------------+-----+--------+---------------------+ | TP-UDHI | TP-User-Dat | O | b | Parameter | | | a-Header-Indication | | | indicating that the | | | | | | TP-UD field | | | | | | contains a Header | +---------+---------------------+-----+--------+---------------------+ | TP‑FCS | TP‑Failure‑Cause | M | I | Parameter | | | | | | indicating the | | | | | | reason for | | | | | | SMS‑SUBMIT failure | +---------+---------------------+-----+--------+---------------------+ | TP‑PI | TP‑ | M | o | Parameter | | | Parameter‑Indicator | | | indicating the | | | | | | presence of any of | | | | | | the optional | | | | | | parameters which | | | | | | follow | +---------+---------------------+-----+--------+---------------------+ | TP‑SCTS | TP‑Servic | M | 7o | Parameter | | | e‑Centre‑Time‑Stamp | | | identifying the | | | | | 5) | time when the SC | | | | | | received the | | | | | | SMS‑SUBMIT | | | | | | | | | | | | See clause 9.2.3.11 | +---------+---------------------+-----+--------+---------------------+ | TP‑PID | TP‑ | O | o | See clause 9.2.3.9 | | | Protocol‑Identifier | | | | +---------+---------------------+-----+--------+---------------------+ | TP‑DCS | TP | O | o | see clause 9.2.3.10 | | | ‑Data‑Coding‑Scheme | | | | +---------+---------------------+-----+--------+---------------------+ | TP‑UDL | TP‑User‑Data‑Length | O | o | see clause 9.2.3.16 | +---------+---------------------+-----+--------+---------------------+ | TP‑UD | TP‑User‑Data | O | 3) 4) | see clause 9.2.3.24 | +---------+---------------------+-----+--------+---------------------+
1) Provision: Mandatory (M) or Optional (O).
2) Representation: Integer (I), bit (b), 2bits (2b), octet (o).
3) Dependent upon the TP‑DCS.
4) The TP‑User‑Data field in the SMS‑SUBMIT‑REPORT is only available for use
by the SC.
5) This same time value shall also be carried in the SMS‑STATUS‑REPORT
relating to a particular SM. See clause 9.2.2.3. This shall allow the
submitting SME to associate a particular SMS‑SUBMIT with a subsequent
SMS‑STATUS‑REPORT by correlating the TP‑SCTS values.
Layout of SMS‑SUBMIT‑REPORT:
Bit Number
* * *
     Number of Octets   7   6   5   4   3   2   1   0   
     1                                                  TP‑MTI, TP-UDHI
     1                                                  TP-FCS
     1                                                  TP‑PI
     7                                                  TP‑SCTS
     0,1                                                TP‑PID
     0,1                                                TP‑DCS
     0,1                                                TP‑UDL
     0 to 151                                           TP‑UD
* * *
Bits 7 and 5 ‑ 2 in octet 1 are presently unused and the sender shall set them
to zero. If any of these bits is non‑zero, the receiver shall not examine the
other field and shall treat the TP‑Failure‑Cause as \"Unspecified error
cause\".
**(ii) SMS‑SUBMIT‑REPORT for RP‑ACK**
Basic elements of the SMS‑SUBMIT_REPORT type:
+---------+---------------------+-----+--------+---------------------+ | Abbr | Reference | P1) | P2) | Description | +---------+---------------------+-----+--------+---------------------+ | TP‑MTI | TP‑Message | M | 2b | Parameter | | | Type‑Indicator | | | describing the | | | | | | message type | +---------+---------------------+-----+--------+---------------------+ | TP-UDHI | TP-User-Dat | O | b | Parameter | | | a-Header-Indication | | | indicating that the | | | | | | TP-UD field | | | | | | contains a Header | +---------+---------------------+-----+--------+---------------------+ | TP‑PI | TP‑ | M | o | Parameter | | | Parameter‑Indicator | | | indicating the | | | | | | presence of any of | | | | | | the optional | | | | | | parameters which | | | | | | follow | +---------+---------------------+-----+--------+---------------------+ | TP‑SCTS | TP‑Servic | M | 7o | Parameter | | | e‑Centre‑Time‑Stamp | | | identifying the | | | | | 5) | time when the SC | | | | | | received the | | | | | | SMS‑SUBMIT | | | | | | | | | | | | See clause 9.2.3.11 | +---------+---------------------+-----+--------+---------------------+ | TP‑PID | TP‑ | O | o | See clause 9.2.3.9 | | | Protocol‑Identifier | | | | +---------+---------------------+-----+--------+---------------------+ | TP‑DCS | TP | O | o | see clause 9.2.3.10 | | | ‑Data‑Coding‑Scheme | | | | +---------+---------------------+-----+--------+---------------------+ | TP‑UDL | TP‑User‑Data‑Length | O | o | see clause 9.2.3.16 | +---------+---------------------+-----+--------+---------------------+ | TP‑UD | TP‑User‑Data | O | 3) 4) | see clause 9.2.3.24 | +---------+---------------------+-----+--------+---------------------+
1) Provision: Mandatory (M) or Optional (O).
2) Representation: Integer (I), Bit (B), 2bits (2b), octet (o).
3) Dependent upon the TP‑DCS.
4) The TP‑User‑Data field in the SMS‑SUBMIT‑REPORT is only available for use
by the SC.
5) This same time value shall also be carried in the SMS‑STATUS‑REPORT
relating to a particular SM. See clause 9.2.2.3. This shall allow the
submitting SME to associate a particular SMS‑SUBMIT with a subsequent
SMS‑STATUS‑REPORT by correlating the TP‑SCTS values.
Layout of SMS‑SUBMIT REPORT
Bit Number
* * *
     Number of Octets   7   6   5   4   3   2   1   0   
     1                                                  TP‑MTI, TP-UDHI
     1                                                  TP‑PI
     7                                                  TP‑SCTS
     0,1                                                TP‑PID
     0,1                                                TP‑DCS
     0,1                                                TP‑UDL
     0 to 152                                           TP‑UD
* * *
Bits 7 and 5 ‑ 2 in octet 1 are presently unused in the SMS‑SUBMIT‑REPORT and
the sender shall set them to zero. If any of these bits is non‑zero, the
receiver shall ignore them.
#### 9.2.2.3 SMS‑STATUS‑REPORT type
Basic elements of the SMS‑STATUS‑REPORT type:
* * *
Abbr. Reference P1) R2) Description
TP‑MTI TP‑Message‑Type‑Indicator M 2b Parameter describing the message type
TP-UDHI TP-User-Data-Header-Indication O b Parameter indicating that the TP-UD
field contains a Header
TP‑MMS TP‑More‑Messages‑to‑Send M b Parameter indicating whether or not there
are more messages to send
TP-LP TP-Loop-Prevention O b Parameter indicating that SMS applications should
inhibit forwarding or automatic message generation that could cause infinite
looping.
TP‑SRQ TP‑Status‑Report‑Qualifier M b Parameter indicating whether the
previously submitted TPDU was an SMS-SUBMIT or an SMS‑COMMAND
TP‑MR TP‑Message‑Reference 3) M I Parameter identifying the previously
submitted SMS‑SUBMIT or SMS‑COMMAND
TP‑RA TP‑Recipient‑Address M 2‑12o Address of the recipient of the previously
submitted mobile originated short message
TP‑SCTS TP‑Service‑Centre‑Time‑Stamp M 7o Parameter identifying time when the
SC received the previously sent SMS‑SUBMIT
TP‑DT TP‑Discharge‑Time M 7o Parameter identifying the time associated with a
particular TP‑ST outcome
TP‑ST TP‑Status M o Parameter identifying the status of the previously sent
mobile originated short message
TP-PI TP-Parameter-Indicator O\ o Parameter indicating the presence of any of
the optional parameters which follow 4)
TP-PID TP-Protocol-Identifier O o see clause 9.2.3.9. TP-PID of original SMS-
SUBMIT
TP-DCS TP-Data-Coding-Scheme O o see clause 9.2.3.10
TP-UDL TP-User-Data-Length O o see clause 9.2.3.16
TP-UD TP-User-Data O 5) see clause 9.2.3.24
* * *
1) Provision: Mandatory (M) or Optional (O).
2) Representation: Integer (I), bit (b), 2 bits (2b), Octet (o), 7 octets
(7o), 2‑12 octets (2‑12o).
3) Where the SMS‑STATUS‑REPORT is the result of an SMS‑COMMAND and the
TP‑Command‑Type was an Enquiry, the TP‑MR returned in the SMS‑STATUS‑REPORT
shall be the TP‑MN which was sent in the SMS‑COMMAND (i.e. the TP‑MR of the
previously submitted SM to which the Enquiry refers).
4) Mandatory if any of the optional parameters following TP-PI is present,
otherwise optional.
5) TP-UD contains information related to a SMS-DELIVER; can contain
information transported in the TP-UD of SMS-DELIVER-REPORT, and information
inserted by the SMSC. The length of the TP-UD field is limited and might not
be long enough to fit information both from the original receiving terminal
(as included into the SMS-DELIVER-REPORT) and information added by the SMSC.
In these cases the former information has higher priority, and the latter
shall be truncated.
Layout of SMS‑STATUS‑REPORT:
* * *
Bit no. 7 6 5 4 3 2 1 0
Number of octets 1 TP-MTI, TP-MMS, TP-LP, TP-SRQ, TP-UDHI
                       1                                                                 TP-MR
                       1
                       2                                                                 ---TP-RA
2 to 12
                       7                                                                 TP-SCTS
                       7                                                                 ---TP-DT
                       1                                                                 TP-ST
              1                                                                          TP-PI
              1                                                                          TP-PID
              1                                                                          TP-DCS
              1                .   .   .   .   .   .                                     TP-UDL
              1
0 to 143 . . . . . . . . TP-UD
* * *
NOTE: Any unused bits shall be set to zero by the sending entity and shall be
ignored by the receiving entity.
The maximum guaranteed length of TP-UD is 131 octets. In order to achieve the
maximum stated above (143 octets), the TP-RA field must have a length of 2
octets and TP-PID and TP-DCS must not be present.
#### 9.2.2.4 SMS‑COMMAND type
Basic elements of the SMS‑COMMAND type:
* * *
Abbr. Reference P1) R2) Description TP‑MTI TP‑Message‑Type‑Indicator M 2b
Parameter describing the type TP-UDHI TP-User-Data-Header-Indication O b
Parameter indicating that the TP-CD field contains a Header TP‑SRR
TP‑Status‑Report‑ Request O b Parameter indicating if the SMS Command is
requesting a status report. TP‑MR TP‑Message Reference M I Parameter
identifying the SMS‑COMMAND TP‑PID TP‑Protocol‑ Identifier M o Parameter
identifying the above layer protocol, if any TP‑CT TP‑Command‑Type M o
Parameter specifying which operation is to be performed on a SM TP‑MN
TP‑Message‑Number M3) o Parameter indicating which SM in the SC to operate on
TP‑DA TP‑Destination‑Address M4) 2‑12o Parameter indicating the Destination
Address to which the TP‑Command refers TP‑CDL TP‑Command‑Data‑Length M o
Parameter indicating the length of the TP‑CD field in octets TP‑CD
TP‑Command‑Data O o Parameter containing user data
* * *
1) Provision: Mandatory (M) or Optional (O).
2) Representation: Integer (I), bit (b), 2bits (2b), octet (o).
3) For TP‑Command‑Types which are not for a specific SM this field shall be
ignored when received. Its value is of no concern but the field must be
present to maintain the structure.
4) For certain TP‑Command‑Types which operate on a specific SM (e.g. Enquire,
Delete etc.) the full TP‑DA must be specified. For TP‑Command‑Types which do
not operate on a specific SM, the address length must be set to zero
indicating that the Address‑Value fields are not present. The Type‑of‑Address
field must be present (see 9.1.2.5) and shall be set to zero and ignored.
Layout of SMS-COMMAND:
* * *
              Bit no.   7   6   5   4   3   2   1   0
Number 1 TP-MTI, TP-SRR, TP-UDHI of octets 1 TP-MR 1 TP-PID 1 TP-CT 1 TP-MN 2
to 12 TP-DA
* * *
> ......................................
* * *
     1                           TP-CDL
* * *
> ......................................
* * *
     0 to 156                           TP-CD
* * *
NOTE: The maximum guaranteed length of TP-CD is 146 octets. In order to
achieve the maximum stated above (156 octets), the TP-DA field must have a
length of 2 octets.
### 9.2.3 Definition of the TPDU parameters
#### 9.2.3.1 TP‑Message‑Type‑Indicator (TP‑MTI)
The TP-Message-Type-Indicator is a 2-bit field, located within bits no 0 and 1
of the first octet of all PDUs which can be given the following values:
bit1 bit0 Message type
0 0 SMS‑DELIVER (in the direction SC to MS)\ 0 0 SMS‑DELIVER REPORT (in the
direction MS to SC)\ 1 0 SMS‑STATUS‑REPORT (in the direction SC to MS)\ 1 0
SMS‑COMMAND (in the direction MS to SC)\ 0 1 SMS‑SUBMIT (in the direction MS
to SC)\ 0 1 SMS‑SUBMIT‑REPORT (in the direction SC to MS)\ 1 1 Reserved
If an MS receives a TPDU with a \"Reserved\" value in the TP‑MTI it shall
process the message as if it were an \"SMS‑DELIVER\" but store the message
exactly as received.
#### 9.2.3.2 TP‑More‑Messages‑to‑Send (TP‑MMS)
The TP‑More‑Messages‑to‑Send is a 1‑bit field, located within bit no 2 of the
first octet of SMS‑DELIVER and SMS‑STATUS‑REPORT, and to be given the
following values:
Bit no 2: 0 More messages are waiting for the MS in this SC
1 No more messages are waiting for the MS in this SC
Note: In the case of SMS‑STATUS‑REPORT this parameter refers to messages
waiting for the mobile to which the status report is sent. The term message in
this context refers to SMS‑messages or status reports.
#### 9.2.3.3 TP‑Validity‑Period‑Format (TP‑VPF)
The TP‑Validity‑Period‑Format is a 2‑bit field, located within bit no 3 and 4
of the first octet of SMS‑SUBMIT, and to be given the following values:
bit4 bit3
0 0 TP‑VP field not present\ 1 0 TP‑VP field present - relative format\ 0 1
TP-VP field present - enhanced format\ 1 1 TP‑VP field present - absolute
format
Any unsupported value may be rejected by the SC by returning the \"TP-VPF not
supported\" TP-FCS value in the SMS Submit Report for RP-Error.
#### 9.2.3.4 TP‑Status‑Report‑Indication (TP‑SRI)
The TP‑Status‑Report‑Indication is a 1‑bit field, located within bit no. 5 of
the first octet of SMS‑DELIVER, and to be given the following values:
Bit no. 5: 0 A status report shall not be returned to the SME\ 1 A status
report shall be returned to the SME
#### 9.2.3.5 TP‑Status‑Report‑Request (TP‑SRR)
The TP‑Status‑Report‑Request is a 1‑bit field, located within bit no. 5 of the
first octet of SMS‑SUBMIT and SMS‑COMMAND, and to be given the following
values:
Bit no. 5: 0 A status report is not requested\ 1 A status report is requested
#### 9.2.3.6 TP‑Message‑Reference (TP‑MR)
The TP‑Message‑Reference field gives an integer representation of a reference
number of the SMS‑SUBMIT or SMS‑COMMAND submitted to the SC by the MS. The MS
increments TP‑Message‑Reference by 1 for each SMS‑SUBMIT or SMS‑COMMAND being
submitted. The value to be used for each SMS‑SUBMIT is obtained by reading the
Last‑Used‑TP‑MR value from the SMS Status data field in the (U)SIM (see GSM TS
51.011 [16] and 3GPP TS 31.102 [30]) and incrementing this value by 1. After
each SMS‑SUBMIT has been submitted to the network, the Last‑Used‑TP‑MR value
in the (U)SIM is updated with the TP‑MR that was used in the SMS‑SUBMIT
operation. The reference number may possess values in the range 0 to 255. The
value in the TP‑MR assigned by the MS is the same value which is received at
the SC.
In the case where no response or an RP-ERROR with an appropriate cause value
(see 3GPP TS 24.011 [13]) is received in response to an SMS‑SUBMIT, then the
MS shall automatically repeat the SMS‑SUBMIT but must use the same TP‑MR value
and set the TP-RD bit to 1 (see 9.2.3.25). The number of times the MS
automatically repeats the SMS‑SUBMIT shall be in the range 1 to 3 but the
precise number is an implementation matter. The automatic repeat mechanism
should be capable of being disabled through MMI.
If all automatic attempts fail (or in the case of no automatic attempts the
first attempt fails), the user shall be informed. The failed message shall be
stored in the mobile in such a way that the user can request a retransmission
using the same TP‑MR value, without the need to re‑enter any information. Such
storage need only be provided for a single failed message, i.e. the one most
recently attempted.
The SC should discard an SMS‑SUBMIT which has the TP-RD bit set to a 1 and
which has the same TP‑MR value as the previous SMS‑SUBMIT received from the
same originating address. In the case of a discarded SMS-SUBMIT, the SC should
respond with an RP-ERROR, in which case the RP-ERROR shall include a SMS-
SUBMIT-REPORT with TP-FCS indicating "SM Rejected -- Duplicate SM". In some
cases, for backward compatibility with earlier phases and versions of this
specification, the SC may be configured to respond with an RP-ACK.
The SMS‑STATUS‑REPORT also contains a TP‑Message‑Reference field. The value
sent to the MS shall be the same as the TP‑Message‑Reference value generated
by the MS in the earlier SMS‑SUBMIT or SMS‑COMMAND to which the status report
relates.
#### 9.2.3.7 TP‑Originating‑Address (TP‑OA)
The TP‑Originating‑Address field is formatted according to the formatting
rules of address fields.
The first '#' encountered in TP-OA indicates where the address for SMSC
routing purposes is terminated. Additional '*'s or '#'s can be present in the
following digits, and all these digits including the first '#' are subaddress
digits.
#### 9.2.3.8 TP‑Destination‑Address (TP‑DA)
The TP‑Destination‑Address field is formatted according to the formatting
rules of address fields.
The first '#' encountered in TP-DA indicates where the address for SMSC
routing purposes is terminated. Additional '*'s or '#'s can be present in the
following digits, and all these digits including the first '#' are subaddress
digits.
#### 9.2.3.9 TP‑Protocol‑Identifier (TP‑PID)
The TP‑Protocol‑Identifier parameter serves the purposes indicated in clause
3.2.3. It consists of one octet, and the bits in the octet are used as
follows:
The MS shall interpret reserved, obsolete, or unsupported values as the value
00000000 but shall store them exactly as received.
The SC may reject messages with a TP‑Protocol‑Identifier containing a reserved
value or one which is not supported.
bits usage
7 6\ 0 0 Assigns bits 0..5 as defined below\ 0 1 Assigns bits 0..5 as defined
below\ 1 0 reserved\ 1 1 Assigns bits 0‑5 for SC specific use
In the case where bit 7 = 0 and bit 6 = 0,
bit 5 indicates telematic interworking:\ value = 0 : no interworking, but
SME‑to‑SME protocol\ value = 1 : telematic interworking
In the case of telematic interworking, the following five bit patterns in bits
4..0 are used to indicate different types of telematic devices:
4.. .0
00000 implicit ‑ device type is specific to this SC, or can be concluded on
the basis of the address
00001 telex (or teletex reduced to telex format)
00010 group 3 telefax
00011 group 4 telefax
00100 voice telephone (i.e. conversion to speech)
00101 ERMES (European Radio Messaging System)
00110 National Paging system (known to the SC)
00111 Videotex (T.100 [20] /T.101 [21])
01000 teletex, carrier unspecified
01001 teletex, in PSPDN
01010 teletex, in CSPDN
01011 teletex, in analog PSTN
01100 teletex, in digital ISDN
01101 UCI (Universal Computer Interface, ETSI DE/PS 3 01‑3)
01110..01111 (reserved, 2 combinations)
10000 a message handling facility (known to the SC)
10001 any public X.400‑based message handling system
10010 Internet Electronic Mail
10011..10111 (reserved, 5 combinations)
11000..11110 values specific to each SC, usage based on mutual agreement
between the SME and the SC (7 combinations available for each SC)
11111 A GSM/UMTS mobile station. The SC converts the SM from the received
TP‑Data‑Coding‑Scheme to any data coding scheme supported by that MS (e.g. the
default).
If bit 5 has value 1 in an SMS‑SUBMIT PDU, it indicates that the SME is a
telematic device of a type which is indicated in bits 4..0, and requests the
SC to convert the SM into a form suited for that device type. If the
destination network is ISDN, the SC must also select the proper service
indicators for connecting to a device of that type.
If bit 5 has value 1 in an SMS‑DELIVER PDU, it indicates that the SME is a
telematic device of a type which is indicated in bits 4..0.
If bit 5 has value 0 in an SMS‑DELIVER PDU, the value in bits 4..0 identifies
the SM‑AL protocol being used between the SME and the MS.
Note that for the straightforward case of simple MS‑to‑SC short message
transfer the Protocol Identifier is set to the value 0.
In the case where bit 7 = 0, bit 6 = 1, bits 5..0 are used as defined below
5 .. . .0
000000 Short Message Type 0
000001 Replace Short Message Type 1
000010 Replace Short Message Type 2
000011 Replace Short Message Type 3
000100 Replace Short Message Type 4
000101 Replace Short Message Type 5
000110 Replace Short Message Type 6
000111 Replace Short Message Type 7
> 001000..011101 Reserved
011110 Enhanced Message Service (Obsolete)
011111 Return Call Message
100000..111011 Reserved
111100 ANSI-136 R-DATA
111101 ME Data download
111110 ME De‑personalization Short Message
111111 (U)SIM Data download
A short message type 0 indicates that the ME must acknowledge receipt of the
short message but shall discard its contents. This means that
  * the MS shall be able to receive the type 0 short message irrespective of whether there is memory available in the (U)SIM or ME or not,
  * the MS shall not indicate the receipt of the type 0 short message to the user,
  * the short message shall neither be stored in the (U)SIM nor ME.
The Replace Short Message feature is optional for the ME and the (U)SIM but if
implemented it shall be performed as described here.
For MT short messages, on receipt of a short message from the SC, the MS shall
check to see if the associated Protocol Identifier contains a Replace Short
Message Type code.
If such a code is present, then the MS shall check the originating address and
replace any existing stored message having the same Protocol Identifier code
and originating address with the new short message and other parameter values.
If there is no message to be replaced, the MS shall store the message in the
normal way. The MS may also check the SC address as well as the Originating
Address. However, in a network which has multiple SCs, it is possible for a
Replace Message type for a SM to be sent via different SCs and so it is
recommended that the SC address should not be checked by the MS unless the
application specifically requires such a check.
If a Replace Short Message Type code is not present then the MS shall store
the message in the normal way.
In MO short messages the SC reacts similarly but only the address of the
originating MS or any other source is checked.
A Return Call Message indicates to the MS to inform the user that a call (e.g.
a telephone call) can be established to the address specified within the
TP‑OA. The RP‑OA contains the address of the SC as usual. The message content
(if present) gives displayable information (e.g. the number of waiting voice
messages). The message is handled in the same way as all other messages of the
Replace Short Message Types.
The ME De‑personalization Short Message is a ME‑specific message which
instructs the ME to de‑personalities the ME (see 3GPP TS 22.022 [25]). The
TP‑DCS shall be set to Uncompressed, Default Alphabet, and Message Class 1
(ME‑specific), which corresponds to a bit coding of 00010001. The TP‑UD field
contains de‑personalization information coded according to 3GPP TS 22.022
[25]. This information shall not be displayed by an ME which supports the
scheme. The acknowledgement to this message is a SMS‑DELIVER‑REPORT for RP‑ACK
in which the TP‑User‑Data shall be coded according to 3GPP TS 22.022 [25].
(U)SIM Data download is a facility whereby the ME must pass the short message
in its entirety including all SMS elements contained in the SMS deliver to the
(U)SIM using the mechanism described in GSM TS 51.011 [16] and 3GPP TS 31.102
[30]. The DCS shall be set to message class 2\. The entire user data field is
available for (U)SIM Data download. If the DCS is not set to message class 2
then the message shall be handled in the normal way by the ME. However it has
to be noted that MEs based on releases of this specification earlier than
REL-5 may allow only 8 bit message class 2 with bit coding 11110110 or
00010110 for (U)SIM Data download.
ME Data download is a facility whereby the ME shall process the short message
in its entirety including all SMS elements contained in the SMS deliver to the
ME. The DCS should normally be set to message class 1. If the DCS is set to
message class 1 and no application in the ME exists, which is able to process
the short message, the ME may discard the short message. The entire user data
field is available for ME data download. The TPDU parameters required for the
SMS-DELIVER should be passed transparently by all involved SCs, so no TPDU
parameter in the entire short message is modified, other than the changes
required to convert an SMS-SUBMIT into an SMS-DELIVER.
ANSI-136 R-DATA is a facility whereby the ME must pass the short message in
its entirety, including all elements contained in the SMS DELIVER, to the
(U)SIM using the mechanism described in GSM TS 11.14 [16] and 3GPP TS 31.102
[30]. The DCS shall be set to message class 2. If the DCS is not set to
message class 2 then the message shall be handled in the normal way by the ME.
However it has to be noted that MEs based on releases of this specification
earlier than REL-5 may allow only 8 bit message class 2 with bit coding
11110110 or 00010110 for ANSI-136 R-DATA.
#### 9.2.3.10 TP‑Data‑Coding‑Scheme (TP‑DCS)
The TP‑Data‑Coding‑Scheme is defined in 3GPP TS 23.038 [9].
#### 9.2.3.11 TP‑Service‑Centre‑Time‑Stamp (TP‑SCTS)
The TP‑Service‑Centre‑Time‑Stamp field is given in semi‑octet representation,
and represents the local time in the following way:
* * *
                  Year:   Month:   Day:   Hour:   Minute:   Second:   Time Zone
Digits:\ 2 2 2 2 2 2 2 (Semi‑octets)
* * *
The Time Zone indicates the difference, expressed in quarters of an hour,
between the local time and GMT. In the first of the two semi‑octets, the first
bit (bit 3 of the seventh octet of the TP‑Service‑Centre‑Time‑Stamp field)
represents the algebraic sign of this difference (0: positive, 1: negative).
The Service‑Centre‑Time‑Stamp, and any other times coded in this format that
are defined in the present document, represent the time local to the sending
entity.
If the MS has knowledge of the local time zone, then any time received (e.g.
Service‑Centre‑Time‑Stamp) at the MS may be displayed in the local time rather
than the time local to the sending entity. Messages shall be stored as
received without change to any time contained therein.
The Time Zone code enables the receiver to calculate the equivalent time in
GMT from the other semi‑octets in the Service‑Centre‑Time‑Stamp, or indicate
the time zone (GMT, GMT+1H etc.), or perform other similar calculations as
required by the implementation. The value contained in the Time Zone field
must take into account daylight saving time, such that when the sending entity
changes from regular (winter) time to daylight saving (summer) time, there is
a change to the value in the Time Zone field, for example in the UK the winter
setting is 00000000 and the summer setting is 01000000.
If the MS receives a non‑integer value in the SCTS, it shall assume that the
digit is set to 0 but shall store the entire field exactly as received.
#### 9.2.3.12 TP‑Validity‑Period (TP-VP)
##### 9.2.3.12.1 TP-VP (Relative format)
The TP‑Validity‑Period comprises 1 octet in integer representation, giving the
length of the validity period, counted from when the SMS‑SUBMIT is received by
the SC.
The representation of time is as follows:
* * *
TP‑VP value Validity period value 0 to 143 (TP‑VP + 1) x 5 minutes (i.e. 5
minutes intervals up to 12 hours) 144 to 167 12 hours + ((TP‑VP ‑143) x 30
minutes) 168 to 196 (TP‑VP ‑ 166) x 1 day 197 to 255 (TP‑VP ‑ 192) x 1 week
* * *
##### 9.2.3.12.2 TP-VP (Absolute format)
The TP-Validity Period comprises 7 octets in semi octet representation giving
the absolute time of the validity period termination.
The representation of time is identical to the representation of the
TP‑Service‑Centre‑Time‑Stamp.
##### 9.2.3.12.3 TP-VP (Enhanced format)
The TP-Validity Period comprises 7 octets. The presence of all octets is
mandatory although they may not all be used. The first octet indicates the way
in which the following 6 octets are used. Any reserved/unused bits or octets
must be set to zero.
Octet 1 TP-VP functionality indicator
bit 7 Extension bit\ Set to 1 if the TP-VP functionality indicator is to be
extended to another octet. A setting of 0 indicates that there are no more TP-
VP functionality indicator extension octets to follow.\ Any such extension
octet shall immediately follow the previous TP-VP functionality indicator.
bit 6 Single shot SM.\ Set to 1 if the SC is required to make up to one
delivery attempt. The TP-Validity Period, where present, shall be applicable
to the Single shot SM.
bits 5, 4, 3 Reserved
bits 2, 1, 0 Validity Period Format.
* * *
Value bits 2 1 0  
0 0 0 No Validity Period specified 0 0 1 Validity Period is as specified for
the relative case. The following octet contains the TP-VP value as described
in 9.2.3.12.1 0 1 0 Validity period is relative in integer representation and
the following octet contains the TP-VP value in the range 0 to 255
representing 0 to 255 seconds. A TP-VP value of zero is undefined and reserved
for future use. 0 1 1 Validity period is relative in semi-octet
representation. The following 3 octets contain the relative time in Hours,
Minutes and Seconds giving the length of the validity period counted from when
the SMS-SUBMIT is received by the SC. The representation of time uses the same
representation as the Hours, Minutes and Seconds in the
TP‑Service‑Centre‑Time‑Stamp. 1 0 0 Reserved 1 0 1 Reserved 1 1 0 Reserved 1 1
1 Reserved
* * *
The SC shall reject any Unsupported/ Reserved values received by returning the
'TP-VP not supported' TP-FCS value in the Submit SM Report for RP-Error.
#### 9.2.3.13 TP‑Discharge‑Time (TP‑DT)
The TP‑Discharge‑Time field indicates the time at which a previously submitted
SMS‑SUBMIT was successfully delivered to or attempted to deliver to the
recipient SME or disposed of by the SC.
In the case of \"transaction completed\" the time shall be the time of the
completion of the transaction. In the case of \"SC still trying to transfer
SM\" the time shall be the time of the last transfer attempt. In the case of
\"permanent or temporary error ‑ SC not making any more transfer attempts\"
the time shall be the time of either the last transfer attempt or the time at
which the SC disposed of the SM according to the Status outcome in TP‑ST.
The TP‑Discharge‑Time is given in semi‑octet representation in a format
identical to the TP‑SCTS.
#### 9.2.3.14 TP‑Recipient‑Address (TP‑RA)
The TP‑Recipient‑Address field indicates the address of the SME that was the
destination of the previously submitted mobile originated short message being
subject to the status report. The field is formatted according to the
formatting rules of address fields.
#### 9.2.3.15 TP‑Status (TP‑ST)
The TP‑Status field indicates the status of a previously submitted SMS‑SUBMIT
and certain SMS COMMANDS for which a Status ‑Report has been requested. It
consists of one octet and the bits in the octet are used as follows.
The MS shall interpret any reserved values as \"Service Rejected\" (01100011)
but shall store them exactly as received.
bits value/usage
7 0 Bits 0..6 as defined below:
> 6....0 Indicate whether the previously submitted short message was
> successfully forwarded to the SME, or whether an error condition has been
> encountered, as follows:
Short message transaction completed
0000000 Short message received by the SME\ 0000001 Short message forwarded by
the SC to the SME but the SC is\ unable to confirm delivery\ 0000010 Short
message replaced by the SC
0000011..0001111 Reserved\ 0010000..0011111 Values specific to each SC
Temporary error, SC still trying to transfer SM
0100000 Congestion\ 0100001 SME busy\ 0100010 No response from SME\ 0100011
Service rejected\ 0100100 Quality of service not available\ 0100101 Error in
SME
0100110..0101111 Reserved\ 0110000..0111111 Values specific to each SC
Permanent error, SC is not making any more transfer attempts
1000000 Remote procedure error\ 1000001 Incompatible destination\ 1000010
Connection rejected by SME\ 1000011 Not obtainable\ 1000100 Quality of service
not available\ 1000101 No interworking available\ 1000110 SM Validity Period
Expired\ 1000111 SM Deleted by originating SME\ 1001000 SM Deleted by SC
Administration\ 1001001 SM does not exist (The SM may have previously existed
in the SC but the SC no longer has knowledge of it or the SM\ may never have
previously existed in the SC)\ 1001010..1001111 Reserved\ 1010000..1011111
Values specific to each SC
Temporary error, SC is not making any more transfer attempts
1100000 Congestion\ 1100001 SME busy\ 1100010 No response from SME\ 1100011
Service rejected\ 1100100 Quality of service not available\ 1100101 Error in
SME\ 1100110..1101001 Reserved\ 1101010..1101111 Reserved\ 1110000..1111111
Values specific to each SC
bits value/usage
7 1 Bits 0..6 reserved
#### 9.2.3.16 TP‑User‑Data‑Length (TP‑UDL)
If the TP‑User‑Data is coded using the GSM 7 bit default alphabet, the
TP‑User‑Data‑Length field gives an integer representation of the number of
septets within the TP‑User‑Data field to follow. If the 7bit default-alphabet
extension mechanism is used within the TP‑User‑Data (see 3GPP TS 23.038 [9]),
the actual number of characters in the message shall be less than the number
of septets. If a TP‑User‑Data‑Header field is present, then the
TP‑User‑Data‑Length value is the sum of the number of septets in the
TP‑User‑Data‑Header field (including any padding) and the number of septets in
the TP‑User‑Data field which follows. See figure 9.2.3.24 (a). If the
TP‑User‑Data is coded using 8‑bit data, the TP‑User‑Data‑Length field gives an
integer representation of the number of octets within the TP‑User‑Data field
to follow. If a TP‑User‑Data‑Header field is present, then the
TP‑User‑Data‑Length value is the sum of the number of octets in the
TP‑User‑Data‑Header field and the number of octets in the TP‑User‑Data field
which follows. See figure 9.2.3.24 (b).
If the TP‑User‑Data is coded using UCS2 [24] data, the TP‑User‑Data‑Length
field gives an integer representation of the number of octets within the
TP‑User‑Data field to follow. If a TP‑User‑Data‑Header field is present, then
the TP‑User‑Data‑Length value is the sum of the number of octets in the
TP‑User‑Data‑Header field and the number of octets in the TP‑User‑Data field
which follows. See figure 9.2.3.24 (b).
If the TP‑User‑Data is coded using compressed GSM 7 bit default alphabet or
compressed 8 bit data or compressed UCS2 [24] data, the TP‑User‑Data‑Length
field gives an integer representation of the number of octets after
compression within the TP‑User‑Data field to follow. If a TP‑User‑Data‑Header
field is present, then the TP‑User‑Data‑Length value is the sum of the number
of uncompressed octets in the TP‑User‑Data‑Header field and the number of
octets in the compressed TP‑User‑Data field which follows. See figure 9.2.3.24
(c).
For other Data Coding Schemes, see 3GPP TS 23.038 [9]. If this field is zero,
the TP‑User‑Data field shall not be present.
#### 9.2.3.17 TP‑Reply‑Path (TP‑RP)
The TP‑Reply‑Path is a 1‑bit field, located within bit no 7 of the first octet
of both SMS‑DELIVER and SMS‑SUBMIT, and to be given the following values:
Bit no 7: 0 TP‑Reply‑Path parameter is not set in this SMS‑SUBMIT/DELIVER
1 TP‑Reply‑Path parameter is set in this SMS‑SUBMIT/DELIVER
Please refer to annex D for details about the Reply procedures.
#### 9.2.3.18 TP‑Message‑Number (TP‑MN)
The TP‑Message‑Number is an 8‑bit field allowing an MS to refer uniquely to an
SM in the SC which that MS has previously submitted. The TP‑MN value is the
TP‑MR value of a previously submitted SM.
#### 9.2.3.19 TP‑Command‑Type (TP‑CT)
The TP‑Command‑Type is an 8‑bit field specifying the type of operation that
the SC is to perform. It has the following values:
* * *
Value (bit 7 .. 0) Command Description Status Report Request Value 00000000
Enquiry relating to previously submitted short message 1 00000001 Cancel
Status Report Request relating to previously submitted short message 0
00000010 Delete previously submitted Short Message 0 00000011 Enable Status
Report Request relating to previously submitted short message 0
00000100..00011111 Reserved unspecified 11100000..11111111 Values specific for
each SC 1 or 0
* * *
The SC shall return an RP‑Error with an appropriate TP‑Failure‑Cause for any
TP‑Command value which is reserved, unsupported or invalid or the actioning of
the command has failed.
The SC shall return an RP‑ACK if the actioning of the Command has succeeded.
A successful Enquiry shall result in the SC sending a SMS‑STATUS‑REPORT for
the SM to which the Enquiry refers. In the case where the SC has a number of
SMs which have the same TP‑MR, the same TP‑DA and have come from the same
originating address the SC shall send a SMS‑STATUS‑REPORT for each SM.
In the case where a TP‑Command is to Delete a previously submitted short
message, the SC shall send a Status Report indicating that the SM has been
deleted if the original Submit SM request requested a status Report.
#### 9.2.3.20 TP‑Command‑Data‑Length (TP‑CDL)
The TP‑Command‑Data‑Length field is used to indicate the number of octets
contained within the TP‑Command‑Data‑field. If this field is set to zero, the
TP‑Command‑Data field shall not be present.
#### 9.2.3.21 TP‑Command‑Data (TP‑CD)
The TP‑Command‑Data field contains data relating to the operation requested by
the MS which is to be performed at the SC. The maximum length of this field is
157 octets. The usage and provision of the optional TP‑Command‑Data field
shall be determined by the function selected by the TP‑Command‑Type field.
#### 9.2.3.22 TP‑Failure‑Cause (TP‑FCS)
The TP‑Failure‑Cause field is used to report the reason for failure to
transfer or process a short message. It consists of a single octet used as
follows:
+---------+---------------------------------------------+-----------+----+ | TP-FCS | Meaning | When used | | | | | | | | Value | | | | | | | | | | (Hex) | | | | +---------+---------------------------------------------+-----------+----+ | | | MO | MT | +---------+---------------------------------------------+-----------+----+ | 00 - 7F | Reserved | | | +---------+---------------------------------------------+-----------+----+ | | | | | +---------+---------------------------------------------+-----------+----+ | 80 - 8F | TP-PID errors | | | +---------+---------------------------------------------+-----------+----+ | 80 | Telematic interworking not supported | x | | +---------+---------------------------------------------+-----------+----+ | 81 | Short message Type 0 not supported | x | x | +---------+---------------------------------------------+-----------+----+ | 82 | Cannot replace short message | x | x | +---------+---------------------------------------------+-----------+----+ | 83 - 8E | Reserved | | | +---------+---------------------------------------------+-----------+----+ | 8F | Unspecified TP-PID error | x | x | +---------+---------------------------------------------+-----------+----+ | | | | | +---------+---------------------------------------------+-----------+----+ | 90 - 9F | TP-DCS errors | | | +---------+---------------------------------------------+-----------+----+ | 90 | Data coding scheme (alphabet) not supported | x | | +---------+---------------------------------------------+-----------+----+ | 91 | Message class not supported | | x | +---------+---------------------------------------------+-----------+----+ | 92 - 9E | Reserved | | | +---------+---------------------------------------------+-----------+----+ | 9F | Unspecified TP-DCS error | x | x | +---------+---------------------------------------------+-----------+----+ | | | | | +---------+---------------------------------------------+-----------+----+ | A0 - AF | TP-Command Errors | | | +---------+---------------------------------------------+-----------+----+ | A0 | Command cannot be actioned | x | | +---------+---------------------------------------------+-----------+----+ | A1 | Command unsupported | x | | +---------+---------------------------------------------+-----------+----+ | A2 - AE | Reserved | | | +---------+---------------------------------------------+-----------+----+ | AF | Unspecified TP-Command error | x | | +---------+---------------------------------------------+-----------+----+ | | | | | +---------+---------------------------------------------+-----------+----+ | B0 | TPDU not supported | x | x | +---------+---------------------------------------------+-----------+----+ | B1 - BF | Reserved | | | +---------+---------------------------------------------+-----------+----+ | | | | | +---------+---------------------------------------------+-----------+----+ | C0 | SC busy | x | | +---------+---------------------------------------------+-----------+----+ | C1 | No SC subscription | x | | +---------+---------------------------------------------+-----------+----+ | C2 | SC system failure | x | | +---------+---------------------------------------------+-----------+----+ | C3 | Invalid SME address | x | | +---------+---------------------------------------------+-----------+----+ | C4 | Destination SME barred | x | | +---------+---------------------------------------------+-----------+----+ | C5 | SM Rejected-Duplicate SM | x | | +---------+---------------------------------------------+-----------+----+ | C6 | TP-VPF not supported | X | | +---------+---------------------------------------------+-----------+----+ | C7 | TP-VP not supported | X | | +---------+---------------------------------------------+-----------+----+ | C8 - CF | Reserved | | | +---------+---------------------------------------------+-----------+----+ | | | | | +---------+---------------------------------------------+-----------+----+ | D0 | (U)SIM SMS storage full | | x | +---------+---------------------------------------------+-----------+----+ | D1 | No SMS storage capability in (U)SIM | | x | +---------+---------------------------------------------+-----------+----+ | D2 | Error in MS | | x | +---------+---------------------------------------------+-----------+----+ | D3 | Memory Capacity Exceeded | | X | +---------+---------------------------------------------+-----------+----+ | D4 | (U)SIM Application Toolkit Busy | | x | +---------+---------------------------------------------+-----------+----+ | D5 | (U)SIM data download error | | x | +---------+---------------------------------------------+-----------+----+ | D6 - DF | Reserved | | | +---------+---------------------------------------------+-----------+----+ | | | | | +---------+---------------------------------------------+-----------+----+ | E0 - FE | Values specific to an application | x | x | +---------+---------------------------------------------+-----------+----+ | | | | | +---------+---------------------------------------------+-----------+----+ | FF | Unspecified error cause | x | x | +---------+---------------------------------------------+-----------+----+
NOTE: Any reserved codes which are received should be treated as an
unspecified error cause.\ MT and MO refer to the overall mobile terminated and
mobile originated services; not the direction of transmission of TP‑FCS.
#### 9.2.3.23 TP‑User‑Data‑Header‑Indicator (TP‑UDHI)
The TP‑User‑Data‑Header‑Indicator is a 1 bit field within bit 6 of the first
octet of the following six PDUs:
\- SMS‑SUBMIT,
\- SMS-SUBMIT-REPORT,
\- SMS‑DELIVER,
\- SMS-DELIVER-REPORT,
\- SMS-STATUS-REPORT,
\- SMS-COMMAND.
TP-UDHI has the following values.
Bit no. 6 0 The TP‑UD field contains only the short message
1 The beginning of the TP‑UD field contains a Header in addition to the short
message.
#### 9.2.3.24 TP‑User Data (TP‑UD)
The length of the TP-User-Data field is defined in the PDU's of the SM-TL (see
clause 9.2.2).
The TP‑User‑Data field may comprise just the short message itself or a Header
in addition to the short message depending upon the setting of TP‑UDHI.
Where the TP‑UDHI value is set to 0 the TP‑User‑Data field comprises the short
message only, where the user data can be 7 bit (default alphabet) data, 8 bit
data, or 16 bit (UCS2 [24]) data.
Where the TP‑UDHI value is set to 1 the first octets of the TP‑User‑Data field
contains a Header in the following order starting at the first octet of the
TP‑User‑Data field.
Irrespective of whether any part of the User Data Header is ignored or
discarded, the MS shall always store the entire TPDU exactly as received.
FIELD LENGTH
Length of User Data Header 1 octet
Information‑Element‑Identifier \"A\" 1 octet
Length of Information‑Element \"A\" 1 octet
Information‑Element \"A\" Data 0 to \"n\" octets
Information‑Element‑Identifier \"B\" 1 octet
Length of Information‑Element \"B\" 1 octet
Information‑Element \"B\" Data 0 to \"n\" octets
Information‑Element‑Identifier \"X\" 1 octet
Length of Information‑Element \"X\" 1 octet
Information‑Element \"X\" Data 0 to \"n\" octets
The diagram below shows the layout of the TP-User-Data-Length and the TP-User-
Data for uncompressed GSM 7 bit default alphabet data. The UDHL field is the
first octet of the TP-User-Data content of the Short Message.
Figure 9.2.3.24 (a)
The diagram below shows the layout of the TP-User-Data-Length and the TP-User-
Data for uncompressed 8 bit data or uncompressed UCS2 data. The UDHL field is
the first octet of the TP-User-Data content of the Short Message.
Figure 9.2.3.24 (b)
The diagram below shows the layout of the TP-User-Data-Length and the TP-User-
Data for compressed GSM 7 bit default alphabet data, compressed 8 bit data or
compressed UCS2 data. The UDHL field is the first octet of the TP‑User-Data
content of the Short Message.
Figure 9.2.3.24 (c)
The definition of the TP‑User‑Data‑Length field which immediately precedes the
\"Length of User Data Header\" is unchanged and shall therefore be the total
length of the TP‑User‑Data field including the Header, if present. (see
9.2.3.16).
The \"Length‑of‑Information‑Element\" fields shall be the integer
representation of the number of octets within its associated
\"Information‑Element‑Data\" field which follows and shall not include itself
in its count value.
The \"Length‑of‑User‑Data‑Header\" field shall be the integer representation
of the number of octets within the \"User‑Data‑Header\" information fields
which follow and shall not include itself in its count or any fill bits which
may be present (see text below).
Information Elements may appear in any order and need not follow the order
used in the present document. Information Elements are classified into 3
categories as described below.
  * SMS Control -- identifies those IEIs which have the capability of dictating SMS functionality.
  * EMS Control -- identifies those IEIs which manage EMS Content IEIs.
  * EMS Content -- identifies those IEIs containing data of a unique media format.
It is permissible for certain IEs to be repeated within a short message, or
within a concatenated message. There is no restriction on the repeatability of
IEs in the EMS Content classification. The repeatability of SMS Control and
EMS Control IEs is determined on an individual basis. See the IE table below
for the repeatability of each IE.
In the event that IEs determined as not repeatable are duplicated, the last
occurrence of the IE shall be used. In the event that two or more IEs occur
which have mutually exclusive meanings (e.g. an 8bit port address and a 16bit
port address), then the last occurring IE shall be used.
If the length of the User Data Header is such that there are too few or too
many octets in the final Information Element then the whole User Data Header
shall be ignored.
If any reserved values are received within the content of any Information
Element then that part of the Information Element shall be ignored.
The support of any Information Element Identifier is optional unless otherwise
stated.
The Information Element Identifier octet shall be coded as follows:
+----------------+----------------+----------------+---------------+ | VALUE (hex) | MEANING | Classification | Repeatability | +----------------+----------------+----------------+---------------+ | 00 | Concatenated | SMS Control | No | | | short | | | | | messages, | | | | | 8-bit | | | | | reference | | | | | number | | | +----------------+----------------+----------------+---------------+ | 01 | Special SMS | SMS Control | Yes | | | Message | | | | | Indication | | | +----------------+----------------+----------------+---------------+ | 02 | Reserved | N/A | N/A | +----------------+----------------+----------------+---------------+ | 03 | Value not used | N/A | N/A | | | to avoid | | | | | mis | | | | | interpretation | | | | | as \ | | | | | character | | | +----------------+----------------+----------------+---------------+ | 04 | Application | SMS Control | No | | | port | | | | | addressing | | | | | scheme, 8 bit | | | | | address | | | +----------------+----------------+----------------+---------------+ | 05 | Application | SMS Control | No | | | port | | | | | addressing | | | | | scheme, 16 bit | | | | | address | | | +----------------+----------------+----------------+---------------+ | 06 | SMSC Control | SMS Control | No | | | Parameters | | | +----------------+----------------+----------------+---------------+ | 07 | UDH Source | SMS Control | Yes | | | Indicator | | | +----------------+----------------+----------------+---------------+ | 08 | Concatenated | SMS Control | No | | | short message, | | | | | 16-bit | | | | | reference | | | | | number | | | +----------------+----------------+----------------+---------------+ | 09 | Wireless | SMS Control | Note 3 | | | Control | | | | | Message | | | | | Protocol | | | +----------------+----------------+----------------+---------------+ | 0A | Text | EMS Control | Yes | | | Formatting | | | +----------------+----------------+----------------+---------------+ | 0B | Predefined | EMS Content | Yes | | | Sound | | | +----------------+----------------+----------------+---------------+ | 0C | User Defined | EMS Content | Yes | | | Sound (iMelody | | | | | max 128 bytes) | | | +----------------+----------------+----------------+---------------+ | 0D | Predefined | EMS Content | Yes | | | Animation | | | +----------------+----------------+----------------+---------------+ | 0E | Large | EMS Content | Yes | | | Animation | | | | | (16*16 times | | | | | 4 = 32*4 =128 | | | | | bytes) | | | +----------------+----------------+----------------+---------------+ | 0F | Small | EMS Content | Yes | | | Animation | | | | | (8*8 times 4 | | | | | = 8*4 =32 | | | | | bytes) | | | +----------------+----------------+----------------+---------------+ | 10 | Large Picture | EMS Content | Yes | | | (32*32 = 128 | | | | | bytes) | | | +----------------+----------------+----------------+---------------+ | 11 | Small Picture | EMS Content | Yes | | | (16*16 = 32 | | | | | bytes) | | | +----------------+----------------+----------------+---------------+ | 12 | Variable | EMS Content | Yes | | | Picture | | | +----------------+----------------+----------------+---------------+ | 13 | User prompt | EMS Control | Yes | | | indicator | | | +----------------+----------------+----------------+---------------+ | 14 | Extended | EMS Content | Yes | | | Object | | | +----------------+----------------+----------------+---------------+ | 15 | Reused | EMS Control | Yes | | | Extended | | | | | Object | | | +----------------+----------------+----------------+---------------+ | 16 | Compression | EMS Control | No | | | Control | | | +----------------+----------------+----------------+---------------+ | 17 | Object | EMS Control | Yes | | | Distribution | | | | | Indicator | | | +----------------+----------------+----------------+---------------+ | 18 | Standard WVG | EMS Content | Yes | | | object | | | +----------------+----------------+----------------+---------------+ | 19 | Character Size | EMS Content | Yes | | | WVG object | | | +----------------+----------------+----------------+---------------+ | 1A | Extended | EMS Control | No | | | Object Data | | | | | Request | | | | | Command | | | +----------------+----------------+----------------+---------------+ | 1B-1F | Reserved for | N/A | N/A | | | future EMS | | | | | features (see | | | | | subclause | | | | | 3.10) | | | +----------------+----------------+----------------+---------------+ | 20 | RFC 822 E-Mail | SMS Control | No | | | Header | | | +----------------+----------------+----------------+---------------+ | 21 | Hyperlink | SMS Control | Yes | | | format element | | | +----------------+----------------+----------------+---------------+ | 22 | Reply Address | SMS Control | No | | | Element | | | +----------------+----------------+----------------+---------------+ | 23 | Enhanced Voice | SMS Control | No | | | Mail | | | | | Information | | | +----------------+----------------+----------------+---------------+ | 24 | National | SMS Control | No | | | Language | | | | | Single Shift | | | +----------------+----------------+----------------+---------------+ | 25 | National | SMS Control | No | | | Language | | | | | Locking Shift | | | +----------------+----------------+----------------+---------------+ | 26 -- 6F | Reserved for | N/A | N/A | | | future use | | | +----------------+----------------+----------------+---------------+ | 70 -- 7F | (U)SIM Toolkit | SMS Control | Note 1 | | | Security | | | | | Headers | | | +----------------+----------------+----------------+---------------+ | 80 -- 9F | SME to SME | SMS Control | Note 2 | | | specific use | | | +----------------+----------------+----------------+---------------+ | A0 -- BF | Reserved for | N/A | N/A | | | future use | | | +----------------+----------------+----------------+---------------+ | C0 -- DF | SC specific | SMS Control | Note 2 | | | use | | | +----------------+----------------+----------------+---------------+ | E0 -- FF | Reserved for | N/A | N/A | | | future use | | | +----------------+----------------+----------------+---------------+ | Note 1: The | | | | | functionality | | | | | of these IEIs | | | | | is defined in | | | | | 3GPP TSG | | | | | 31.115 [28], | | | | | and therefore, | | | | | the | | | | | repeatability | | | | | is not within | | | | | the scope of | | | | | this document | | | | | and will not | | | | | be determined | | | | | here. | | | | | | | | | | Note 2: The | | | | | functionality | | | | | of these IEIs | | | | | is used in a | | | | | proprietary | | | | | fashion by | | | | | different SMSC | | | | | vendors, and | | | | | therefore, are | | | | | not within the | | | | | scope of this | | | | | technical | | | | | specification. | | | | | | | | | | Note 3: The | | | | | functionality | | | | | of these IEIs | | | | | is defined by | | | | | the WAP Forum | | | | | and therefore | | | | | the | | | | | repeatability | | | | | is not within | | | | | the scope of | | | | | this document | | | | | and will not | | | | | be determined | | | | | here. | | | | +----------------+----------------+----------------+---------------+
A receiving entity shall ignore (i.e. skip over and commence processing at the
next information element) any information element where the IEI is Reserved or
not supported. The receiving entity calculates the start of the next
information element by looking at the length of the current information
element and skipping that number of octets.
The SM itself may be coded as 7, 8 or 16 bit data.
If 7 bit data is used and the TP‑UD‑Header does not finish on a septet
boundary then fill bits are inserted after the last Information Element Data
octet up to the next septet boundary so that there is an integral number of
septets for the entire TP‑UD header. This is to ensure that the SM itself
starts on an septet boundary so that an earlier Phase mobile shall be capable
of displaying the SM itself although the TP‑UD Header in the TP‑UD field may
not be understood.
It is optional to make the first character of the SM itself a Carriage Return
character encoded according to the default 7 bit alphabet so that earlier
Phase mobiles, which do not understand the TP‑UD‑Header, shall over‑write the
displayed TP‑UD‑Header with the SM itself.
If 16 bit (USC2) data is used then padding octets are not necessary. The SM
itself shall start on an octet boundary.
If 8 bit data is used then padding is not necessary. An earlier Phase mobile
shall be able to display the SM itself although the TP‑UD header may not be
understood.
It is also possible for mobiles not wishing to support the TP‑UD header to
check the value of the TP‑UDHI bit in the SMS‑Deliver PDU and the first octet
of the TP‑UD field and skip to the start of the SM and ignore the TP‑UD
header.
##### 9.2.3.24.1 Concatenated Short Messages
This facility allows short messages to be concatenated to form a longer
message.
In the case of uncompressed 8‑bit data, the maximum length of the short
message within the TP‑UD field is 134 (140‑6) octets.
In the case of uncompressed GSM 7 bit default alphabet data, the maximum
length of the short message within the TP‑UD field is 153 (160‑7) characters.
A character represented by an escape-sequence shall not be split in the
middle.
In the case of 16 bit uncompressed USC2 data, the maximum length of the short
message within the TP‑UD field is 67 ((140‑6)/2) characters. A UCS2 character
shall not be split in the middle; if the length of the User Data Header is
odd, the maximum length of the whole TP-UD field is 139 octets.
In the case of compressed GSM 7 bit default alphabet data, 8 bit data or UCS2
the maximum length of the compressed short message within the TP-UD field is
134 (140-6) octets including the Compression Header and Compression Footer,
both or either of which may be present (see clause 3.9).
The maximum length of an uncompressed concatenated short message is 39015
(255*153) default alphabet characters, 34170 (255*134) octets or 17085
(255*67) UCS2 characters.
The maximum length of a compressed concatenated message is 34170 (255*134)
octets including the Compression Header and Compression Footer (see clause 3.9
and figure 9.2.3.24.1(a) below).
Figure 9.2.3.24.1 (a): Concatenation of a Compressed short message
The Information‑Element‑Data field contains information set by the application
in the SMS‑SUBMIT so that the receiving entity is able to re‑assemble the
short messages in the correct order. Each concatenated short message contains
a reference number which together with the originating address and Service
Centre address allows the receiving entity to discriminate between
concatenated short messages sent from different originating SMEs and/or SCs.
In a network which has multiple SCs, it is possible for different segments of
a concatenated SM to be sent via different SCs and so it is recommended that
the SC address should not be checked by the MS unless the application
specifically requires such a check.
The TP elements in the SMS‑SUBMIT PDU, apart from TP‑MR, TP-SRR, TP‑UDL and
TP‑UD, should remain unchanged for each SM which forms part of a concatenated
SM, otherwise this may lead to irrational behaviour. TP-MR must be incremented
for every segment of a concatenated message as defined in clause 9.2.3.6. A SC
shall handle segments of a concatenated message like any other short message.
The relation between segments of a concatenated message is made only at the
originator, where the message is segmented, and at the recipient, where the
message is reassembled. SMS‑COMMANDs identify messages by TP-MR and therefore
apply to only one segment of a concatenated message. It is up to the
originating SME to issue SMS-COMMANDs for all the required segments of a
concatenated message.
The Information‑Element‑Data octets shall be coded as follows.
Octet 1 Concatenated short message reference number.
This octet shall contain a modulo 256 counter indicating the reference number
for a particular concatenated short message. This reference number shall
remain constant for every short message which makes up a particular
concatenated short message.
Octet 2 Maximum number of short messages in the concatenated short message.
This octet shall contain a value in the range 0 to 255 indicating the total
number of short messages within the concatenated short message. The value
shall start at 1 and remain constant for every short message which makes up
the concatenated short message. If the value is zero then the receiving entity
shall ignore the whole Information Element.
Octet 3 Sequence number of the current short message.
This octet shall contain a value in the range 0 to 255 indicating the sequence
number of a particular short message within the concatenated short message.
The value shall start at 1 and increment by one for every short message sent
within the concatenated short message. If the value is zero or the value is
greater than the value in octet 2 then the receiving entity shall ignore the
whole Information Element.
The IEI and associated IEI length and IEI data shall be present in every
segment of the concatenated SM.
##### 9.2.3.24.2 Special SMS Message Indication
There are three levels of \"Message Waiting\" indication provided within the
present document. The first level is to set the Protocol Identifier to
\"Return Call message\", which indicates that a message is waiting and relies
on the text of the message to supply the detail. The second level uses the
Data Coding Scheme with or without Return Call Message (see 3GPP TS 23.038
[9]) to indicate the type of message waiting and whether there are some
messages or no messages. The third level is described here, and provides the
maximum detail level for analysis by the mobile, i.e. an indication of the
number and type of messages waiting in systems connected to the PLMN.
This information shall be stored by the ME in the Message Waiting Indication
Status on the SIM (see 3GPP TS 51.011 [16]) or USIM (see 3GPP TS 31.102 [30])
when present or otherwise should be stored in the ME. In case there are
multiple records of EF~MWIS~ this information shall be stored within the
record according to the profile if available \-- or otherwise within the first
record.
The number of messages shall be stored in Message Waiting Indication Status
and an indicator should be shown if the number of messages is non‑zero or
removed if the number of messages is zero. The ME may also provide some MMI to
indicate and access the actual number of messages waiting. Text may be
included by the SMS Service Centre for backward compatibility with the
earliest Phase mobiles and the Data Coding Scheme may also be used to convey
this information in parallel for backward compatibility with \"middle\" Phase
mobiles (which support the use of Data Coding Scheme for Message Waiting
Indication but not the use of TP‑UDH for Message Waiting Indication).
The information‑Element octets shall be coded as follows:
Octet 1 Message Indication type and Storage.
Bit 7 Indicates whether or not the message shall be stored.
Bit 7
0 Discard message after updating indication
1 Store message after updating indication
In the event of a conflict between this setting and the setting of the Data
Coding Scheme (see 3GPP TS 23.038 [9]) then the message shall be stored if
either the DCS indicates this, or Octet 1 above indicates this.
Bits 0 and 1 indicate the basic message indication type.
00 Voice Message Waiting\ 01 Fax Message Waiting\ 10 Electronic Mail Message
Waiting\ 11 Extended Message Type Waiting (equivalent to \"other\" in 3GPP TS
23.038 [9])
Bits 432 indicate the extended message indication type.
000 No extended message indication type.\ 001 Video Message Waiting
Other values of bits 432 where bits 0 and 1 are '11' are Reserved for future
use in the present document.
Values of bits 432 where bits 0 and 1 are '00', '01' or '10' are Reserved for
future use in the present document.
NOTE: Values using bits 432 where bits 0 and 1 are \'11\' should be exhausted
before using the remaining codespace due to existing early implementations
erroneously using parts of this codespace.
Bits 6 and 5 indicate the profile ID of the Multiple Subscriber Profile (see
3GPP TS 23.097 [41]).
00 profile ID 1\ 01 profile ID 2\ 10 profile ID 3\ 11 profile ID 4
> Terminals should be capable of receiving any values in octet 1, including
> those marked as Reserved. Terminals may add the Message Count of all unknown
> Message Waiting Indication types received within the same TP-UDH and
> indicate this result to the user.
Octet 2 Message Count.
This octet shall contain a value in the range 0 to 255 indicating the number
of messages of the type specified in Octet 1 waiting. The value 255 shall be
taken to mean 255 or greater. In the event of a conflict between this setting
and the setting of the Data Coding Scheme (see 3GPP TS 23.038 [9]) then the
Message Count in the TP‑UDH shall override the indication in the TP‑DCS.
If more than one type of message is required to be indicated within one SMS
message, then further octets must be used, as in the following example:
[00] TP‑UDL [1E] (30 decimal septets)
[01] Length of TP‑UDH [08]
[02] IEI = Special SMS Message Indication [01]
[03] Length = 02
[04] Octet 1 = Voice Mail, do not store [00]
[05] Octet 2 = 04 Messages
[06] IEI = Special SMS Message Indication [01]
[07] Length = 02
[08] Octet 1 = Fax Mail, Store [81]
[09] Octet 2 = 02 Messages
\+ 5 Fill bits
\+ 19 seven‑bit character message text
The Total number of bits is 210.
In the case where this IEI is to be used in a concatenated SM then the IEI,
its associated IEI length and IEI data shall be contained in the first segment
of the concatenated SM. The IEI, its associated IEI length and IEI data should
also be contained in every subsequent segment of the concatenated SM although
this is not mandatory. However, in the case where these elements are not
contained in every subsequent segment of the concatenated SM and where an out
of sequence segment delivery occurs or where the first segment is not
delivered then processing difficulties may arise at the receiving entity which
may result in the concatenated SM being totally or partially discarded.
##### 9.2.3.24.3 Application Port Addressing 8 bit address
This facility allows short messages to be routed to one of multiple
applications, using a method similar to TCP/UDP ports in a TCP/IP network. An
application entity is uniquely identified by the pair of TP-DA/TP-OA and the
port address. The port addressing is transparent to the transport, and also
useful in Status Reports.
The total length of the IE is 2 octets:
octet 1 Destination port.
This octet contains a number indicating the receiving port, i.e. application,
in the receiving device.
octet 2 Originator port.
This octet contains a number indicating the sending port, i.e. application, in
the sending device.
The port range is up to 255 using 8 bit addressing space. The Integer value of
the port number is presented as in 3GPP TS 23.040 clause 9.1.2.1.
VALUE (port number) MEANING
0 ‑ 239 Reserved\ 240 ‑ 255 Available for allocation by applications
A receiving entity shall ignore (i.e. skip over and commence processing at the
next information element) any information element where the value of the
Information-Element-Data is Reserved or not supported.
In the case where this IE is to be used in a concatenated SM then the IEI, its
associated IEI length and IEI data shall be contained in the first segment of
the concatenated SM. The IEI, its associated IEI length and IEI data shall
also be contained in every subsequent segment of the concatenated SM.
##### 9.2.3.24.4 Application Port Addressing 16 bit address
This facility allows short messages to be routed to one of multiple
applications, using a method similar to TCP/UDP ports in a TCP/IP network. An
application entity is uniquely identified by the pair of TP-DA/TP-OA and the
port address. The port addressing is transparent to the transport, and also
useful in Status Reports.
The total length of the IE is 4 octets:
octet 1,2 Destination port.
These octets contain a number indicating the receiving port, i.e. application,
in the receiving device.
octet 3,4 Originator port.
These octets contain a number indicating the sending port, i.e. application,
in the sending device.
The port range is up to 65535 using 16 bit addressing space. The Integer value
of the port number is presented as in 3GPP TS 23.040 clause 9.1.2.1.
VALUE (port number) MEANING
0 ‑ 15999 **UDP/TCP port numbers assigned by IANA without the need to refer to
3GPP. For the procedure, use and assignment of port numbers in this range --
refer to the IANA database _._** (http://www.IANA.com/). See Note 1.
16000 ‑ 16999 Available for allocation by SMS applications without the need to
refer to 3GPP or IANA. See Note 2.
17000 ‑ 49151 **UDP/TCP port numbers assigned by IANA. For the procedure, use
and assignment of port numbers in this range -- refer to the IANA database
_._**(http://www.IANA.com/). See Note 1.
49152 -- 65535 Reserved for future allocation by 3GPP. For a port number in
this range an application must be made to 3GPP.
NOTE 1: The value used for this field by a particular application is the same
value that the application would use when using a UDP or a TCP transport.
Therefore, applications that register a UDP or TCP port with the IANA need to
use the same registered value for this field. UDP and TCP ports are registered
separately. Therefore, it is necessary to check the application since the fact
that a particular TCP port is registered (e.g., for HTTP) does not mean that
its corresponding UDP port will be also registered for the same application.
NOTE 2: There is a risk of port numbers in this range having conflicting
applications. If it is desirable to avoid such a conflict then an application
for a port number in the range 49152 -- 65535 is to be made to 3GPP.
A receiving entity shall ignore (i.e. skip over and commence processing at the
next information element) any information element where the value of the
Information-Element-Data is Reserved or not supported.
In the case where this IE is to be used in a concatenated SM then the IEI, its
associated IEI length and IEI data shall be contained in the first segment of
the concatenated SM. The IEI, its associated IEI length and IEI data shall
also be contained in every subsequent segment of the concatenated SM.
##### 9.2.3.24.5 SMSC Control Parameters
The facility enables the SMS protocol headers to be expanded using a flexible
method. It may be used to control the SMSC, but is also passed transparently
to the receiving mobile. The Information Element must be present in every
short message affected by it, i.e. in every short message in a concatenated
message.
The Information Element data octets shall be coded as follows:
octet 1 Selective Status Report.
This facility is used to control the creation of Status Reports, depending on
the error code of the particular message. It is also used by the sending
entity to request inclusion of the original UDH into the Status Report. In
this case the original UDH must be separated from the rest of the UDH using
the Source Indicator. The TP-SRR must be set in order for the Selective Status
Report to be enabled. The bits are defined as follows:
bit 0
0 No Status Report for short message transaction completed
1 Status Report for short message transaction completed
bit 1
0 No Status Report for permanent error when SC is not making any more transfer
attempts
1 Status Report for permanent error when SC is not making any more transfer
attempts
bit 2
0 No Status Report for temporary error when SC is not making any more transfer
attempts
1 Status Report for temporary error when SC is not making any more transfer
attempts
bit 3
0 No Status Report for temporary error when SC is still trying to transfer SM
1 Status Report for temporary error when SC is still trying to transfer SM
bits 4 and 5
reserved for future use.
bit 6
0 No activation
1 A Status Report generated by this Short Message, due to a permanent error or
last temporary error, cancels the SRR of the rest of the Short Messages in a
concatenated message. This feature can only be used where a SC is aware of the
segmentation of a concatenated SM and is therefore an implementation matter.
bit 7
0 Do not include original UDH into the Status Report
1 Include original UDH into the Status Report
##### 9.2.3.24.6 UDH Source Indicator
The facility is used to separate the UDH of the original message, a UDH
created by the SMSC, and a UDH provided by the original receiving entity. The
Source Indicator is placed in front of the content inserted by the source. The
indicated content (one or more Information-Elements) ends at the next UDH-
Source-Indicator, or at the end of the UDH. The Separator is intended to be
used especially in Status Reports, but can also be used by the SMSC to add
information into Short Message (for example Message waiting). The default
content for a UDH in a SMS-DELIVERY is the headers inserted by the sending
device, and the default content for a UDH in a SMS-STATUS-REPORT is the
headers copied from the SMS-DELIVERY-REPORT.
Values of octet:
01 The following part of the UDH is created by the original sender (valid in
case of Status Report)
02 The following part of the UDH is created by the original receiver (valid in
case of Status Report)
03 The following part of the UDH is created by the SMSC (can occur in any
message or report)
In the case where this IEI is to be used in a concatenated SM then the IEI,
its associated IEI length and IEI data shall be contained in the first segment
of the concatenated SM. The IEI, its associated IEI length and IEI data should
also be contained in every subsequent segment of the concatenated SM although
this is not mandatory. However, in the case where these elements are not
contained in every subsequent segment of the concatenated SM and where an out
of sequence segment delivery occurs or where the first segment is not
delivered then processing difficulties may arise at the receiving entity which
may result in the concatenated SM being totally or partially discarded.
##### 9.2.3.24.7 (U)SIM Toolkit Security Headers
There are no IEI data values associated with these IEI values and so the
associated Length of Information element field is present but set to zero.
These IEI values implicitly define that a Security Header is always present at
the start of the TP-User-Data field which immediately follows the TP-User-
Data-Header. Details of the Security Header will be found in TS 31.115 [28].
In the case where a concatenated message contains a Security Header then the
Security Header will only be present in the first segment of a concatenated
message.
In the case where SMS compression is applied to a TP-User-Data field which
contains a Security Header then the SMS compression header (3GPP TS 23.042
[26]) shall immediately precede the Security Header.
##### 9.2.3.24.8 Concatenated short messages, 16-bit reference number
This facility is an enhanced variant of the Concatenated Short Message
facility (see clause 9.2.3.24.1). The enhancement is a 16-bit reference
number, instead of the short 8-bit reference number. The larger reference
number reduces the probability that two different concatenated messages are
mistakenly sent with identical reference numbers to a receiver. Except for the
size of the reference number this facility is identical to the Concatenated
Short Message facility (see clause 9.2.3.24.1).
In the case of uncompressed 8‑bit data, the maximum length of the short
message within the TP‑UD field is 133 (140‑7) octets.
In the case of uncompressed GSM 7 bit default alphabet data, the maximum
length of the short message within the TP‑UD field is 152 (160‑8) characters.
A character represented by an escape-sequence shall not be split in the
middle.
In the case of 16 bit uncompressed USC2 data, the maximum length of the short
message within the TP‑UD field is 66 ((140‑7)/2) characters. A UCS2 character
shall not be split in the middle; if the length of the User Data Header is
odd, the maximum length of the whole TP-UD field is 139 octets.
In the case of compressed GSM 7 bit default alphabet data, 8 bit data or UCS2
the maximum length of the compressed short message within the TP-UD field is
133 (140‑7) octets including the Compression Header and Compression Footer,
both or either of which may be present (see clause 3.9).
The relation between compression and concatenation is the same as for
Concatenated Short Messages (see clause 9.2.3.24.1).
The Information‑Element‑Data field contains information set by the application
in the SMS‑SUBMIT so that the receiving entity is able to re‑assemble the
short messages in the correct order. Each concatenated short message contains
a reference number which together with the originating address and Service
Centre address allows the receiving entity to discriminate between
concatenated short messages sent from different originating SMEs and/or SCs.
In a network which has multiple SCs, it is possible for different segments of
a concatenated SM to be sent via different SCs and so it is recommended that
the SC address should not be checked by the MS unless the application
specifically requires such a check.
The TP elements in the SMS‑SUBMIT PDU, apart from TP‑MR, TP‑UDL and TP‑UD,
should remain unchanged for each SM which forms part of a concatenated SM,
otherwise this may lead to irrational behaviour. TP-MR must be incremented for
every segment of a concatenated message as defined in clause 9.2.3.6. A SC
shall handle segments of concatenated message like any other short message.
The relation between segments of a concatenated message is made at the
originator, where the message is segmented, and at the recipient, where the
message is reassembled. SMS-COMMANDs identify messages by TP-MR and therefore
apply to only one segment of a concatenated message. It is up to the
originating SME to issue SMS-COMMANDs for all the required segments of a
concatenated message.
The Information‑Element‑Data octets shall be coded as follows:
Octet 1-2 Concatenated short messages, 16-bit reference number.
This octet shall contain a modulo 65536 counter indicating the reference
number for a particular enhanced concatenated short message. This reference
number shall remain constant for every short message which makes up a
particular enhanced concatenated short message.
Octet 3 Maximum number of short messages in the enhanced concatenated short
message.
This octet shall contain a value in the range 0 to 255 indicating the total
number of short messages within the concatenated short message. The value
shall start at 1 and remain constant for every short message which makes up
the enhanced concatenated short message. If the value is zero then the
receiving entity shall ignore the whole Information Element.
Octet 4 Sequence number of the current short message.
This octet shall contain a value in the range 0 to 255 indicating the sequence
number of a particular short message within the concatenated short message.
The value shall start at 1 and increment by one for every short message sent
within the concatenated short message. If the value is zero or the value is
greater than the value in octet 3 then the receiving entity shall ignore the
whole Information Element.
The IEI and associated IEI length and IEI data shall be present in every
segment of the concatenated SM.
##### 9.2.3.24.9 Wireless Control Message Protocol
The Wireless Control Message Protocol (WCMP) is part of the WAP suite of
protocols; an open standard specified by the WAP Forum Ltd.
The protocol specifies a set of messages that can be used by the receiver to
notify the sender if an error occurs. This can be due to routing problems, no
application listening at the destination port number, or due to insufficient
buffer capacity. The error messages can be used by the sender to avoid
retransmitting packets, that can not be properly handled at the receiver. WCMP
can also be used for diagnostics and informational purposes. WCMP messages are
usually generated by a datagram transport layer or a management entity.
The Information‑Element‑Data octet(s) shall be coded as follows:
Octet 1-n Protocol Data Unit of WCMP.
This octet(s) shall contain a WCMP protocol data unit.
In the case where this IE is to be used in a concatenated SM then the IEI, its
associated IEI length and IEI data shall be contained in the first segment of
the concatenated SM. The IEI, its associated IEI length and IEI data shall
also be contained in every subsequent segment of the concatenated SM.
##### 9.2.3.24.10 Enhanced Messaging Service
###### 9.2.3.24.10.1 EMS Coding
Enhanced Messaging is based on standard mechanism in GSM SMS messaging. The
first mechanism is called **user data header** (TP-UDH), which makes it
possible to include binary data in a normal SM prior the text message itself
(clause 9.2.3.24). The binary data is in the TP-UD field (message), which
means that it steels a part of the 140 bytes.\ Each object within the SM shall
be identified by a IE in the TP-UD Header. The IE will contain a **octet**
(refer to\ clause 9.2.3.24.10.1) that identifies the absolute position of the
object within and from the beginning of the SM data. In case of formatting
text, an additional octet will give the number of characters for which the
formatting applies. Next mechanism that is used is **concatenation,** see
clause 9.2.3.24.1. This mechanism permits longer messages than 140 bytes, in
fact 255 messages a 140 bytes each can be concatenated to one message up to
about 38k bytes.
EMS IEs of the same type may occur more than once in a single message or one
segment of a concatenated SM.
###### # 9.2.3.24.10.1.1 Text Formatting
The Information‑Element‑Data octet(s) shall be coded as follows:
Octet 1 Start position of the text formatting. Set to the number of characters
after the formatting shall be applied from the beginning of the SM data.
> This octet shall be coded as an integer value in the range 0 (beginning of
> the SM data) to the maximum number of characters included in the SM data of
> one single SM or one segment of a concatenated SM.
Octet 2 Text formatting length. Gives the number of formatted characters or
sets a default text formatting.
> This octet shall be coded as an integer value in the range 1 to the maximum
> number of characters for which the formatting applies in one single SM or
> one segment of a concatenated SM.
>
> A text formatting length value of 0 indicates that the text format shall be
> used as a default text format for the current SM. The default text format
> shall be used for all text in a concatenated SM unless temporarily
> overridden by a text formatting IE with a non-zero text format length field.
>
> It shall be possible to re-define the default text formatting to be applied
> to all subsequent text in the current SM by sending a new Text Format IE
> with text format length zero.
>
> Conflicting overlapping text formatting instructions shall be resolved by
> applying the formatting instructions in their sequential order.
Octet 3 formatting mode value coded as following:
Octet 3: Bit 7 Bit 6 Bit 5 Bit 4 Bit 3 Bit 2 Bit 1 Bit 0
Bit 1 Bit 0 *Alignment\ 0 0 Left\ 0 1 Center\ 1 0 Right\ 1 1 Language
dependent (default)
*in case formatting text is inserted on the same line as previous non formatting text or with a different mode value, the alignment value shall be set to the same value as the previous formatted predefined object.
Alignment may affect object placement.
Bit 3 Bit 2 Font Size\ 0 0 Normal (default)\ 0 1 Large\ 1 0 Small\ 1 1
_reserved_
Bit 4 Style **bold** \ 1 Bold on\ 0 Bold off
Bit 5 Style _Italic_ \ 1 Italic on\ 0 Italic off
Bit 6 Style [Underlined]{.underline}\ 1 Underlined on\ 0 Underlined off
Bit 7 Style ~~Strikethrough~~\ 1 Strikethrough on\ 0 Strikethrough off
If bit 4,5,6 and 7 are set to 0, it will mean normal style (default).
Octet 4 Text Colour.
This Octet may be omitted by setting the IED length accordingly.
Bits 0..3 define the Text Foreground Colour
> Bits 4..7 define the Text Background Colour
>
> Each colour is defined in a semi octet according to the table below. The
> actual colours displayed may vary between ME's depending on the display
> device used.
>
> The colour values defined are simple primary and secondary colours plus four
> levels of grey. Bright colours have a higher intensity than dark colours.
>
> Nibble Value Colour
>
> (msb...lsb)
>
> 0000 Black
>
> 0001 Dark Grey
>
> 0010 Dark Red
>
> 0011 Dark Yellow
>
> 0100 Dark Green
>
> 0101 Dark Cyan
>
> 0110 Dark Blue
>
> 0111 Dark Magenta
>
> 1000 Grey
>
> 1001 White
>
> 1010 Bright Red
>
> 1011 Bright Yellow
>
> 1100 Bright Green
>
> 1101 Bright Cyan
>
> 1110 Bright Blue
>
> 1111 Bright Magenta
###### # 9.2.3.24.10.1.2 Predefined Sound
The Information‑Element‑Data octet(s) shall be coded as follows.
Octet 1 position indicating in the SM data the instant after which the sound
shall be played. It will be set to the number of characters from the beginning
of the SM data after which the sound shall be played.
This octet shall be coded as an integer value in the range 0 (beginning of the
SM data) to the maximum number of characters included in the SM data of one
single SM or one segment of a concatenated SM.
Octet 2 sound number. Shall be encoded as a integer value.
###### # 9.2.3.24.10.1.3 User Defined Sound
The Information‑Element‑Data octet(s) shall be coded as follows.
Octet 1 position indicating in the SM data the instant the after which the
sound shall be played (refer to clause\ 9.2.3.24.10.1.2).
Octet 2-n Protocol Data Unit as described in clause 9.2.3.24.10.3.1.
This octet(s) shall contain a User Defined Sound.
###### # 9.2.3.24.10.1.4 Predefined Animation
The Information‑Element‑Data octet(s) shall be coded as follows:
Octet 1 position indicating in the SM data the instant the animation shall be
displayed. Set to the number of\ characters from the beginning of the SM data
after which the animation shall be displayed.
This octet shall be coded as an integer value in the range 0 (beginning of the
SM data) to the maximum number of characters included in the SM data of one
single SM or one segment of a concatenated SM.
Octet 2 animation number. Shall be encoded as an integer value.
###### # 9.2.3.24.10.1.5 Large Animation
The Information‑Element‑Data octet(s) shall be coded as follows:
Octet 1 position indicating the instant the animation shall be displayed in
the SM data\ (refer clause 9.2.3.24.10.1.4).
Octet 2-n Protocol Data Unit as described in clause 9.2.3.24.10.3.3.
This octet(s) shall contain a Large Animation.
###### # 9.2.3.24.10.1.6 Small Animation
The Information‑Element‑Data octet(s) shall be coded as follows:
Octet 1 position indicating the instant the animation shall be displayed in
the SM data\ (refer clause 9.2.3.24.10.1.4).
Octet 2-n Protocol Data Unit as described in clause 9.2.3.24.10.3.3.
This octet(s) shall contain a Small Animation.
###### # 9.2.3.24.10.1.7 Large Picture
The Information‑Element‑Data octet(s) shall be coded as follows:
Octet 1 position indicating in the SM data the instant the picture shall be
displayed. Set to the number of\ characters from the beginning of the SM data
after which the picture shall be displayed. This octet shall be coded as an
integer value in the range 0 (beginning of the SM data) to the maximum number
of characters included in the SM data of one single SM or one segment of a
concatenated SM.
Octet 2-n Protocol Data Unit as described in 9.2.3.24.10.3.2.
This octet(s) shall contain a Large Picture.
###### # 9.2.3.24.10.1.8 Small Picture
The Information‑Element‑Data octet(s) shall be coded as follows:
Octet 1 position indicating in the SM data the instant the picture shall be
displayed in the SM data\ (refer clause 9.2.3.24.10.1.7).
Octet 2-n Protocol Data Unit as described in clause 9.2.3.24.10.3.2.
This octet(s) shall contain a Small Picture.
###### # 9.2.3.24.10.1.9 Variable Picture
The Information‑Element‑Data octet(s) shall be coded as follows:
Octet 1 position indicating in the SM data the instant the picture shall be
displayed in the SM data\ (refer clause 9.2.3.24.10.1.7).
Octet 2 Horizontal dimension of the picture.
This octet shall contain the horizontal number of 8 pixels i.e. this value
shall be multiplied by 8 to get the whole number of horizontal pixels.
Octet 3 Vertical dimension of the picture.
This octet shall contain the vertical number of pixels.
Octet 4-n Protocol Data Unit as described in clause 9.2.3.24.10.3.2.
This octet(s) shall contain a Variable Picture line by line from top left to
bottom right.
The values of the horizontal and vertical dimensions must be chosen properly
by the sending entity. If the calculated size of this IE exceeds the limits of
a single SM or segment it shall be discarded by the receiving entity.
##### Examples of EMS coding {#examples-of-ems-coding .H6}
All IE values in the TP-UD are hexadecimal values.
###### # 9.2.3.24.10.1.10 User Prompt Indicator
With the User Prompt Indicator a sending entity is able to indicate to the
receiving entity, that the following object is intended to be handled at the
time of reception, e.g. by means of user interaction. The object may be a
picture, an animation, a User Defined Sound or a combination of these.
For example the User Prompt Indicator may be used when sending an operators
logo to the ME that should be displayed instead of the operators name in
standby mode.
When receiving the object the user shall be prompted to accept or discard the
object. After this user interaction the SM may be discarded.
The User Prompt Indicator IE shall immediately precede the corresponding
object IE(s).
If a User Prompt Indicator IE is not followed by a corresponding object IE it
shall be discarded.
The Information‑Element‑Data octet(s) shall be coded as follows:
Octet 1 Number of corresponding objects.
> This octet shall contain the number of corresponding objects as an integer
> value.
Where Octet 1 indicates that the User Prompt Indicator refers to more than one
object, the ME should check the validity of the objects referenced for
stitching together. The objects should be considered for stitching if they are
either Images (Small, Large, Variable Pictures) or User Defined Sounds, and
all of the objects referenced by the User Prompt Indicator IE are of the same
type. Animations, Text formatting and pre-defined sound IE\'s are not suitable
for stitching.
User defined sounds may be stitched by concatenating the data contained within
each User Defined Sound IE into a single melody object, this may be achieved
by ignoring the iMelody header and footer information of the second and
subsequent User Defined Sound IE\'s referenced from the User Prompt Indicator.
Images may be joined along their vertical edges, to form a single \"wide\"
image, the resulting image will have a width equal to the sum of the widths of
all the images defined in the User Prompt Indicator.
###### # 9.2.3.24.10.1.11 Standard WVG Object
The Standard WVG object as defined by IEI 18 is structured as follows:
Octet 1 position indicating in the SM data the instant the object shall be
displayed in the SM data
Octet 2..n Standard WVG object bit stream
The unused bits in the last octet will be filled with 0
The detailed data format and attributes of Standard WVG object are defined in
Annex G.
The bit order is defined as follows:
The octet with a smaller octet number stores the bits appearing in the front
position in the bit stream; the most significant bit in an octet stores the
first bit in position in a 8-bit segment in the bit stream.
A Standard WVG object may or may not have fixed size. In either case, display
size should be determined by the terminal implementation. Recommended display
size is a largest possible size on terminal screen while aspect ratio shall be
maintained.
###### # 9.2.3.24.10.1.12 Character Size WVG Object
The Character Size WVG object as defined by IEI 19 is structured as follows:
Octet 1 position indicating in the SM data the instant the object shall be
displayed in the SM data
Octet 2..n Character Size WVG bit stream
The unused bits in the last octet will be filled with 0
The detailed data format and attributes of Character Size WVG object are
defined in Annex G.
The bit order is defined as follows:
The octet with a smaller octet number stores the bits appearing in the front
position in the bit stream; the most significant bit in an octet stores the
first bit in position in a 8-bit segment in the bit stream.
A Character Size WVG object is a small graphics similar to the size of a typed
character. The display height for a Character Size WVG object is decided by
the terminal implementation. Recommended Character Size WVG object height is
to be similar to the message text font height. The width of a Character Size
WVG object is variable depending on the aspect ratio defined in the object.
Character Size WVG objects can appear more than one time in one message.
Example:
**Dad, I** {width="0.15555555555555556in" height="0.1451388888888889in"}
**you!**
In the above example, the "heart" is a Character Size WVG object at the
position in between the letter "I" and "y".
{width="0.32013888888888886in"
height="0.3388888888888889in"}{width="0.3298611111111111in"
height="0.3298611111111111in"}{width="0.33958333333333335in"
height="0.32708333333333334in"}{width="0.3194444444444444in"
height="0.33819444444444446in"}
In the above example, there are 4 Character Size WVG objects, each
representing a Chinese character.
###### # 9.2.3.24.10.1.13 Extended Object
The Extended Object allows an extended code range for format types. The
Extended Object may extend across segment boundaries of a concatenated short
message. Octets 1 through 7 of the first Extended Object IE shall be contained
in a single segment. A single segment may include one or more Extended Object
IEs.
If multiple SMs are concatenated and at least one of them contains an Extended
Object information element, then concatenation of the SMs shall be done using
the \'Concatenated short messages, 16-bit reference number\', verses the
\'Concatenated short messages, 8-bit reference number\' information element.
The re-assembly of the Extended Object segments shall be done according to the
sequence number of the associated Concatenation IE.
One or more Extended Objects may be compressed using a compression algorithm
as indicated in the Compression Control IE (see clause 9.2.3.24.10.1.13).
An SME implementing the Extended Object IE shall be capable of interpreting an
uncompressed concatenated message composed of at least **min_eo_msg** short
messages which have been received. According to current content provider
requirements and handset manufacturer constraints, variable **min_eo_msg** is
set to 8.
The first Extended Object IE of an Extended Object contains a reference
number, length, control data, type and position. The subsequent Extended
Object IEs shall only contain Extended Object data as illustrated in Figure
9.2.24.10.11.
The IE length is variable.
Octet 1 Extended Object reference number.\ A modulo 256 counter indicating the
reference number for the Extended Object. Two different Extended Objects in a
single concatenated message shall have different reference numbers.
Octet 2..3 Extended Object length in number of octets (integer representation)
as shown in Figure 9.2.3.24.10.1.11.
Octet 4 Control data.\ \ Bit 0 Object distribution
  1. Object may be forwarded
  2. Object shall not be forwarded by SMS
> Bit 1 User Prompt Indicator
>
> 0 Object shall be handled normally\ 1 Object shall be handled as a User
> Prompt (see 9.2.3.24.10.1.10)
>
> Bit 2..7 reserved
>
> Any reserved values shall be set to 0.
Octet 5 Extended Object Type.\ This octet indicates the format of the Extended
Object from the table below.\ If the value is reserved or if the associated
format is not supported then the receiving entity shall ignore the Extend
Object.
* * *
Format Type Format Description 0x00 Predefined sound as defined in annex E.
0x01 iMelody as defined in annex E. 0x02 Black and white bitmap as defined in
annex E. 0x03 2-bit greyscale bitmap as defined in annex E. 0x04 6-bit colour
bitmap as defined in annex E. 0x05 Predefined animation as defined in annex E.
0x06 Black and white bitmap animation as defined in annex E. 0x07 2-bit
greyscale bitmap animation as defined in annex E. 0x08 6-bit colour bitmap
animation as defined in annex E. 0x09 vCard as defined in annex E. 0x0A
vCalendar as defined in annex E. 0x0B Standard WVG object as defined in annex
E 0x0C Polyphonic melody as defined in annex E. 0x0D.. 0xFE Reserved 0xFF Data
Format Delivery Request as defined in annex E.
* * *
Octet 6..7 Extended Object Position (integer representation).\ The Extended
Object Position indicates the absolute character position within the message
text after which the object shall be played or displayed. The absolute
character position relates to the entire text within the concatenated message,
the first character is numbered character 1.
> NOTE: Although this is an absolute value, for concatenated messages, it is
> suggested the positions used are those that lie within the text of short
> message segments that have the sequence number equal to or higher than the
> one that contains the Extended Object IE.
>
> If more than one Extended Object is located at the same position then they
> may be played or displayed in sequence or simultaneously.
Octet 8..n Extended Object Data.\ This sequence of octets is structured as
illustrated in the figure below and defined annex E. This figure illustrates
the construction of a number of SMs containing a large Extended Object which
crosses a SM boundary and is encoded into 2 SM TPDUs. The figure illustrates
only the User Data field of the SM (TPDUs). For a description of concatenation
of SM refer to Figures 9.2.3.24 (a, b and c)
Figure 9.2.3.24.10.1.13
###### # 9.2.3.24.10.1.14 Reused Extended Object
This facility is used to reuse an Extended Object in a message which has
already been defined in the same message.
Octet 1 Reference number of the Extended Object to be reused.
> NOTE: The suggested reference numbers are those of Extended Objects that are
> contained in short messages that have the sequence number equal to or lower
> than the one that contains the Reused Extended Object IE.
Octet 2..3 indicates in the concatenated message the absolute character
position after which the object shall be played or displayed.
> NOTE: Although this is an absolute value, for concatenated messages, the
> suggested positions that lie within the text of short message segments that
> have the sequence number equal to or higher than the one that contains the
> Extended Object IE.
###### # 9.2.3.24.10.1.15 Compression Control
This information element is used to indicate a compressed octet sequence. The
compression control is only used in association with one or more Extended
Objects and/or Reused Extended Objects. The compressed data may extend across
sequential short messages within a concatenated short message as illustrated
by Figure 9.2.24.10.1.15. The first Compression Control IE of a compressed
data sequence contains one octet of Compression Information and a 2-octet
length field.
The SME shall support decompression if the Extended Object IE is implemented.
An SME implementing the Extending Object IE shall be capable of decompressing
a received stream for which the original uncompressed information fits into 1
to **min_eo_msg** messages. An SME may be capable of decompressing a received
stream for which the original uncompressed information fits into more than
**min_eo_msg** short messages. Variable **min_eo_msg** is defined in clause
9.2.3.24.10.1.11.
The IE length is variable.
Octet 1 Compression information.
> Bits 0..3 represent the compression algorithm and bits 4..7 represent
> compression algorithm specific parameters.
Bit 0..3 Compression algorithm
> 0000 LZSS Compression according to clause 9.2.3.24.10.1.15.1
>
> Bit 4..7 Shall be set 0.
0001..1111 reserved for future use; reserved bits shall be transmitted 0.
> Bit 4..7 reserved
Octets 2..3 Length of the compressed data in octets (integer representation).\
The length indicates the length of the compressed data that may extend across
several compression control IEs.
Octets 4..n Compressed data may contain one or more compressed Extended
Objects. Figure 9.2.3.24.10.1.15 is an example and illustrates the assembly of
a series of SM TPDUs from a sequence of concatenated and compressed extended
objects. Each Extended Object is preceded by its IEI (Extended Object or
Reused Extended Object). A series of Extended Objects is then compressed into
a single buffer and this is split into several SM TPDUs as illustrated.
*E.O Means Extended Object.
*R.E.O means Reused Extended Object.
C.C. means compression.
Figure 9.2.3.24.10.1.15
###### # 9.2.3.24.10.1.15.1 LZSS Implementation for EMS extended object
compression
LZSS compression uses two tokens to identify either literal strings (byte-
sequences) or references to repeated sequences. These tokens (for EMS
extended-object compression) are described in this clause of the document. A
more general introduction to LZSS compression together with an informative
example (based upon the tokens described below) is provided in Annex F
(informative).
The compressed data stream consists of any combination of literal data blocks
and slice descriptor sequences.
The format of the compressed data stream is illustrated as follows: -
* * *
Compressed data stream (initial section) .....  
1 2 3 4 5 . . . . . . . . .  
Literal data block Slice descriptor Literal data block Slice descriptor Slice
descriptor
* * *
Figure 9.2.3.24.10.1.15.1.a LZSS compressed data format
This diagram represents the structure of a compressed byte stream using LZSS.
The stream contains a mixture of literal octets from the input buffer and
slice descriptors representing the re-occurrence of an octet sequence together
with a length and index for the matching octet sequence. The initial octets of
a compressed buffer will always be a sequence of literal octets. The
structures of the literal data blocks and slice descriptors are given below.
* * *
Bit 7 Bit 6 Bit 5 Bit 4 Bit 3 Bit 2 Bit 1 Bit 0 1 Number literal bytes to
follow.
* * *
Figure 9.2.3.24.10.1.15.1.b Literal block identifier
When literal octets are written into the compression buffer (for instance
during the initial phases of compression) they are preceded by a literal block
identifier. The most significant bit (bit 7) of this block shall be set 1.
Bits 6-0 indicate the length of the literal block which follows (up to 127
octets). If no match can be found in an octet sequence of greater that 127
octets then 2 (or more) literal blocks shall be written sequentially.
* * *
Octet 1 Octet 2  
Bit 15 Bit 14 Bit 13 Bit 12 Bit 11 Bit 10 Bit 9 Bit 8 Bit 7 Bit 6 Bit 5 Bit 4
Bit 3 Bit 2 Bit 1 Bit 0 0 Slice Length Slice Offset
* * *
Figure 9.2.3.24.10.1.15.1.c Slice Descriptor
As can be seen from the above table, the slice descriptor sequence length is
two octets, hence only repeating slices of data longer than two octets are
extracted. The "slice length" is contained in the descriptor high octet and
describes a data slice length of up to 63 octets. The "slice offset index" to
the start of the slice is contained in the lower 9 bits and limits the window
to 511 octets. The "slice offset index" gives the start position of the source
slice measured backwards from the current writing position in the output
decoded message data buffer, expressed as a positive number.
###### # 9.2.3.24.10.1.15.2 Data Compression
The compressed data output stream is constructed by repeating the following
process until the end of the input data buffer is reached.
The input data buffer is scanned, from the current reading position (minus 1)
through to a position 511 bytes back from current reading position (the
window) looking for the maximum (but limited to 63 octets) length matching
data slice contained that matches the data starting at the current reading
position (the look ahead buffer).
If no matching data slice, longer than two octets, is found then the input
data octet at the current reading position is written to a literal buffer.
Both the current reading position in the input data buffer and the current
writing position in the output data buffer are incremented by one.
If a matching slice is found then a slice descriptor is written to the output
data buffer at the current writing position in the output data buffer and the
current writing position is incremented by two. The current reading position
in the input data buffer is incremented by the length of the newly found
matching data slice.
If the next read octet results in a matching slice being found then the
literal buffer is written out. The literal block header, containing a count of
the number of literals in the block, is written out first. (If more than 127
literal octets exist in the literal buffer, then it is split into multiple
blocks).
The above sequence is repeated until the current reading position reaches the
end of the input data buffer.
When encoding (compressing), it is the input data buffer, up to the current
reading position, that is used to search for already known matching data
slices, as this represents, and is equal to, the reconstructed output data
buffer of the decoder at the receiving end.
###### # 9.2.3.24.10.1.15.3 Data De-compression
The following sequence is repeated until the end of the input data buffer.
The data octet at the current reading position in the input data buffer is
tested for either 0 or 1 in bit 7.
If the bit is set (bit 7 = 1), then the number of literal octets that follow
is determined from the lower 7 bits of the header octet (this one).
The literal octet block is written to the output data buffer at the current
writing position and both the output data writing position and the input data
reading position pointers are incremented by the block size.
If the bit is clear (bit 7 = 0), then the "slice length" and "slice offset
index" are extracted from the two octet slice descriptor.
The data slice is copied from within the output data buffer to the end of the
output data buffer, where the start of the source slice is at a position
"slice offset index" back from the current output data writing position and
the destination start position of the slice is the current output buffer
writing position. The input data buffer reading position is incremented by two
and the output data writing position is incremented by the "slice length".
###### # 9.2.3.24.10.1.15.4 Test Vectors
In order to assist implementers of the compression algorithm described in this
specification, a suite of test vectors and 'help' information are available in
electronic format. The test vectors are supplied with this specification.
These test vectors provide checks for most of the commonly expected parameter
value variants in this specification and may be updated as the need arises.
In addition Annex F contains an introduction to LZ-type compression algorithms
and also has a brief informative example.
###### # 9.2.3.24.10.1.16 Object Distribution Indicator
This facility allows a level of control to be requested over the distribution
of objects contained within selected information elements in short messages.
If no Object Distribution Indicator is specified for an information element in
which an object is received, then that object may be freely distributed.
If a MS provides facilities to modify an object, then the Distribution
Attributes (see below) shall be maintained; i.e. an object that is not allowed
to be distributed cannot become so after modification.
The use of the Object Distribution Indicator in conjunction with a TE is
beyond the scope of the present document.
Where the Object Distribution Indicator is applied to object IE's that are
also addressed by an IE which affects or controls them in some other way (such
as User Prompt Indicator IE (see clause 9.2.3.24.10.1.10)), then it shall
precede all of the IE's including the other controlling IE's.
Octet 1 Number of Information Elements.
> This octet specifies the number of information elements from 1-255 for which
> the Distribution Attributes in the next octet shall apply. The affected
> objects shall be contained in Information Elements immediately following
> this IE and may be contained in subsequent short message segments within a
> concatenated short message.
>
> If the Object Distribution Indicator is applied to the same object IE's as
> addressed by an IE which affects or controls them in some other way (such as
> the User Prompt Indicator IE), then value of this field shall reflect the
> total number of all the object IE's and all of the controlling IE's.
>
> If set to 0 the Distribution Attributes shall apply to all information
> elements until either the end of the message or another Object Distribution
> Indicator IE is received.
Octet 2 Distribution Attributes.
Bit 0
  1. the associated object(s) may be forwarded
```{=html}
``` 1\. the associated object(s) shall not be forwarded by SMS
> bit 1..7
reserved for future use.
###### # 9.2.3.24.10.1.17 Reply Address Element
Only one alternate Reply Address Element can be integrated in a message. In
the case the Reply Address Element is part of a Concatenated SM this IE shall
occur in its first segment only.
Octet 1..n Alternate Reply Address encoded as specified for address fields in
clause 9.1.2.5
When this IE is received in a message, replies to this message should take
place by default using the address specified in this IE instead of the regular
message TP-OA.
NOTE: Despite the fact that MMI aspects of the ME are out of the scope of the
present document, it must be mentioned that this mechanism might open the door
to potential abuse. It is desirable that the user is made aware in some way
that the reply address of the incoming message is different from the
originator's one, and that the user is presented with the original TP-OA
address to identify the sender of the SM .
###### # 9.2.3.24.10.1.18 Extended Object Data Request Command
There is no data element associated with this IE. The associated Information
Element Length field is present but set to zero.
Upon receiving this IE in an SMS-DELIVER PDU, if an MS supports this request
and the corresponding response, it shall respond with an SMS-DELIVER-REPORT
PDU containing a Data Format Delivery Request as defined in the Extended
Object IE. This SMS-DELIVER PDU may be discarded.
###### # 9.2.3.24.10.2.1 Example of Basic text formatting and predefined EMS
coding
An example of the basic concept of coding is given as follows:
TP-UDHI=1
SMS User Data Header: UDHL=05, IEI=0A, IEDL=03, IED~1~=0F, IED~2~=12,
IED~3~=10
SMS User Data: This is a text with bold option on following with normal text.
Should be displayed as:
* * *
This is a text **with bold option on** following with normal text.
* * *
It is also possible to add predefined sounds in the message.
Example:
TP-UDHI=1
SMS User Data Header: UDHL=08, IEI=0B, IEDL=02, IED~1~=09,\, IEI=0B,
IEDL=2, IED~1~=1C,\ \
SMS User Data: This is a message with two different sounds.
The sound nr5 shall be played after the 9^th^ received character (\"a\") and
sound nr7 shall be played after the 28^th^ received character (\"e\").
###### # 9.2.3.24.10.2.2 Example of User defined Objects EMS coding
Example of a message including one small picture is coded as follows:
TP UDHI=1
SMS User Data Header: UDHL=24, IEI=11, IEIDL=22, IED~1~=08, \
SMS User Data: Hello!\\\\One small picture in here
Should be displayed as:
+---------------------------+ | Hello! | | | |  | | | | One small picture in here | +---------------------------+
If the message starts with \, then the \"unreadable\" data in an old
terminal will be overwritten by the text, and the user will not see any
strange characters. It is possible to insert the same picture several times in
the same message. In that case, the TP-UD header shall contain as many IE as
the number of occurrences contained in the SM or one segment of a concatenated
message. Using defined elements will normally imply that more than one SM is
required and therefore concatenation is required.
###### # 9.2.3.24.10.2.3 Concatenation of SMS messages
Concatenated messages are required in most cases required when using several
types of EMS elements, since it is only possible to send one large
picture/large animation/melody in one single SM. After including either of
these elements, there are only 4 (or 9 if no concatenation is used) characters
left to the text part, and this is usually too little.
If one or more objects are embedded in one segment of a concatenated message,
the IE octet indicating its/their position within the SM data cannot be set to
a value that would refer to a position in the next segment(s) so that received
segments should be processed before all of them have been received. It means
that a formatting text that could not be conveyed in one segment shall be
split in as many segments as necessary. In that case, the IE relating to the
formatting shall be repeated in all the segments in which it will apply.
Example of a message including 2 Large Pictures, 4 Small animations and 2 User
defined Melodies together with some text.
The EMS message: \ \ Hello All, This is
a real Enhanced Message \. I can send \
and receive \ really advanced EMS messages \
Isn't it impressive? /Lars \ \
This EMS message has to use concatenated messages and the SM will typically
contain the following data:
+----+-------------------------------+-------------------------------+ | SM | User Data Header | User Data | +----+-------------------------------+-------------------------------+ | 1 | IEI=10 (Large Picture)\ | [\\] | | | IED~1~=00 (beginning of the | | | | SM)\ | | | | \ | | +----+-------------------------------+-------------------------------+ | 2 | IEI=0C (User Defined Sound)\ | Hello | | | IED~1~=00 (beginning of the | | | | SM)\ | | | | \ | | +----+-------------------------------+-------------------------------+ | 3 | IEI=0F (Small Animation)\ | All, This is a real Enhanced | | | IED~1~=24 (36^th^ position)\ | Message. I can send and | | | \ | | | | | | | | IEI=0F (Small Animation)\ | | | | IED~1~=2F (47^th^ position)\ | | | | \ | | +----+-------------------------------+-------------------------------+ | 4 | IEI=0F (Small Animation)\ | receive really advanced EMS | | | IED~1~=07 (7^th^ position)\ | messages. Isn't it | | | \ | | | | | | | | IEI=0F (Small Animation)\ | | | | IED~1~=25 (37^th^ position)\ | | | | \ | | +----+-------------------------------+-------------------------------+ | 5 | IEI=0C (User Defined Sound)\ | [\\] | | | IED~1~=00 (beginning of the | | | | SM)\ | | | | \ | | +----+-------------------------------+-------------------------------+ | 6 | IEI=10 (Large Picture)\ | | | | IED~1~=00 (beginning of the | | | | SM)\ | | | | \ | | +----+-------------------------------+-------------------------------+
###### # 9.2.3.24.10.3 EMS Formats
###### # 9.2.3.24.10.3.1 Sounds
Predefined Sounds
There are a number of fixed predefined sounds. Each sound nr corresponds to a
specific sound according to the table below. The presentations of these sounds
are manufacturer specific.
* * *
Sound nr Description 0 Chimes high 1 Chimes low 2 Ding 3 TaDa 4 Notify 5 Drum
6 Claps 7 FanFar 8 Chord high 9 Chord low
* * *
User defined sounds
The user defined sounds are coded according to the iMelody format[33]. The
maximum length of a sound is 128 bytes.
###### # 9.2.3.24.10.3.2 Pictures
Pictures are coded from upper left to lower right and in each byte the most
significant bit represent the pixel at the left. The pictures are plain black
and white, no colours or grey scales are supported. The bitvalue \"0\"
represents a white pixel and the bitvalue \"1\" represents a black pixel.
Example 16*16 picture
* * *
Byte 1 Byte 2 Byte 3 Byte 4 ... ... ... ... Byte 31 Byte 32
* * *
###### # 9.2.3.24.10.3.3 Animation
Predefined
There are a number of predefined animations. Each animation nr corresponds to
a specific animation according to the table below. The way of displaying the
animation is manufacturer specific.
* * *
Animation nr Description 0 I am ironic, flirty 1 I am glad 2 I am sceptic 3 I
am sad 4 WOW! 5 I am crying 6 I am winking 7 I am laughing 8 I am indifferent
9 In love/Kissing 10 I am confused 11 Tongue hanging out 12 I am angry 13
Wearing glasses 14 Devil
* * *
User Defined
Animations are coded as 4 sequential pictures, with the first picture sent
first.
##### 9.2.3.24.11 RFC 822 E-Mail Header
This information element is used to indicate the existence of an RFC 822
Internet electronic mail in the data part of the short message. Both, E-Mail
Header and (optional) E-Mail Body shall be parts of the SM's data and shall be
compliant with the syntax specified in RFC 822 [34]. The character set used
for encoding of E-Mail Header and E-Mail body, however, shall be according to
3GPP TS 23.038 [9]. Encoding of E-Mail Header and E-Mail Body shall be done
using the same character set.
In compliance with RFC 822 [34] the E-Mail Header shall always be located at
the very beginning of the SM's data part. It shall always be present in the
\"unfolded\" format as it is specified in RFC 822 [34]. Not the \
character defined in RFC 822 [34] but the \ character according to 3GPP TS
23.038 [9] shall be used for the separation of different E-Mail Header fields.
If an RFC 822 E-Mail Body exists, it shall immediately follow the E-Mail
Header in the SM's data part.
NOTE 1: The null line defined in RFC 822 for the separation of E-Mail Header
and E-Mail Body may be discarded.
NOTE 2: The sending of extended SMTP headers is allowed and the MS should not
reject the message if there are header fields in the email header part that
are not specified in RFC 822.
In case of an RFC 822 E-Mail Header exceeding the data part of a single SM,
concatenation shall be used. In this case the E-Mail Header starts in the
first segment of a concatenated SM and continues in one or several subsequent
segments. The RFC 822 E-Mail Body shall immediately follow the final fraction
of the RFC 822 E-Mail Header and may also be spread over several segments of
the concatenated SM.
In case where this IEI is to be used in a concatenated SM then the IEI, its
associated IEDL, and IED fields shall be contained in the first segment of the
concatenated SM and shall also be contained in every subsequent segment of the
concatenated SM.
The Information‑Element‑Data octet shall be coded as follows:
Octet 1 RFC 822 E-Mail Header length indicator.
> This octet shall indicate the length of the RFC 822 E-Mail Header that is
> located at the beginning of the data part of the SM. In case of an E-Mail
> Header exceeding the data part of a single SM, this octet shall indicate the
> length of that fraction of the RFC 822 E-Mail Header that is located at the
> beginning of the data part of the current segment of the concatenated SM.
>
> If the user data is coded using the GSM 7 bit default alphabet, this IED
> octet shall give an integer representation of the number of septets within
> (that fraction of) the RFC 822 E-Mail Header that is located at the
> beginning of the data part of the current (segment of the concatenated) SM.
> See figure 9.2.3.24.11 (a).
>
> If the user data is coded using 8‑bit data, this IED octet shall give an
> integer representation of the number of octets within (that fraction of) the
> RFC 822 E-Mail Header that is located at the beginning of the data part of
> the current (segment of the concatenated) SM. See figure 9.2.3.24.11 (b).
>
> If the user data is coded using UCS2 [24] data, this IED octet shall give an
> integer representation of the number of UCS2 characters (consisting of 2
> octets) within (that fraction of) the RFC 822 E-Mail Header that is located
> at the beginning of the data part of the current (segment of the
> concatenated) SM. See figure 9.2.3.24.11 (c).
NOTE 3: If the user data is coded using compressed GSM 7 bit default alphabet
or compressed 8 bit data or compressed UCS2 [24] data the RFC 822 E-Mail
Header length indicator's value shall be based on the amount of uncompressed
data, i.e. before compression is performed.
> The diagram below shows the layout of the IED for GSM 7 bit default alphabet
> data.
Figure 9.2.3.24.11 (a)
> The diagram below shows the layout of the IED for 8 bit data.
Figure 9.2.3.24.11 (b)
> The diagram below shows the layout of the IED for UCS2 data.
Figure 9.2.3.24.11 (c)
##### 9.2.3.24.12 Hyperlink format element
A hyperlink format element shall be structured as follows:
Octet 1 and 2 Absolute Element Position (integer representation).
The Absolute Element Position indicates the absolute character position within
the message text. The absolute character position relates to the entire text
within the concatenated message, the first character is numbered character 1.
Octet 3 Hyperlink Title length: an integer representation of the number of
characters in the hyperlink title.
Octet 4 URL length: an integer representation of the number of characters in
the URL.
A space character shall be inserted between the hyperlink title and the URL.
The hyperlink title can be a mixture of text, animations and pictures.
Elements (text, animations and pictures) for which the position is included in
the range [Absolute hyperlink position...Absolute hyperlink position+hyperlink
title length] are part of the hyperlink title. The string of text in the range
[Absolute hyperlink position+hyperlink title length+1...Absolute hyperlink
position+hyperlink title length+1+URL length] is to be interpreted as a URL.
##### 9.2.3.24.13 Enhanced Voice Mail Information
Enhanced Voice Mail Information allows a Voice Mail system to convey to a
mobile subscriber, comprehensive information regarding individual voice mail
messages and mailbox status.
Enhanced Voice Mail Information has two types of Information Element Data
  * Enhanced Voice Mail Notification which conveys to the MS information regarding newly deposited Voice Mail messages and Voice Mailbox Status
  * Enhanced Voice Mail Delete Confirmation which allows an MS to maintain Voice mailbox status information synchronisation between the MS and the Voice Mailbox in the event of Voice Mail Message deletion.
The first 'bit' of the Enhanced Voice Mail Information Element Data is known
as Enhanced Voice Mail PDU Type and discriminates between whether the Enhanced
Voice Mail Information PDU is an Enhanced Voice Mail Notification or an
Enhanced Voice Mail Delete Confirmation.
###### 9.2.3.24.13.1 Enhanced Voice Mail Notification
The Enhanced Voice Mail Notification Information Element Data has the
following format where the parameters are in strict order following the IEDL.
The Enhanced Voice Mail Notification IEI and its associated IEDL and IED shall
be complete within a single UDH.
In the event of a contradiction between Enhanced Voice Mail Notification and
either the DCS (23.038) [9] indicating Voicemail Message Waiting or the
Special SMS Message Indication (9.2.3.24.2) indicating Voice Message Waiting
or both then the Enhanced Voice Mail Notification specified here shall take
precedence.
+----------------------+----------------------+----------------------+ | Parameter | Parameter Length | Mandatory/ | | | | Optional/Conditional | +----------------------+----------------------+----------------------+ | ENHANCED_VO | Bit 0 Octet 1 | M | | ICE_MAIL_PDU_TYPE | | | +----------------------+----------------------+----------------------+ | RESERV | Bit 1 Octet 1 | M | | ED_FOR_FUTURE_USE | | | +----------------------+----------------------+----------------------+ | MULTIPLE\ | Bits 2..3 Octet 1 | M | | _SUBSCRIBER_PROFILE | | | +----------------------+----------------------+----------------------+ | SM_STORAGE | Bit 4 Octet 1 | M | +----------------------+----------------------+----------------------+ | VM_M | Bit 5 Octet 1 | M | | AILBOX_ALMOST_FULL | | | +----------------------+----------------------+----------------------+ | VM_MAILBOX_FULL | Bit 6 Octet 1 | M | +----------------------+----------------------+----------------------+ | V | Bit 7 Octet 1 | M | | M_MAILBOX_STATUS_ | | | | EXTENSION_INDICATOR | | | +----------------------+----------------------+----------------------+ | VM_MAIL | Octets 2... n+2 | M | | BOX_ACCESS_ADDRESS | (NOTE 2) | | +----------------------+----------------------+----------------------+ | NUMBER\ | Bits 0..7 Octet n+3 | M | | _OF_VOICE_MESSAGES | | | +----------------------+----------------------+----------------------+ | NUMBER_O | Bits 0..4 Octet n+4 | M | | F_VM_NOTIFICATIONS | | | +----------------------+----------------------+----------------------+ | RESERV | Bits 5..7 Octet n+4 | M | | ED_FOR_FUTURE_USE | | | +----------------------+----------------------+----------------------+ | VM_MAILBOX_STATU | 1 Octet (NOTE 3) | C | | S_EXTENSION_LENGTH | | | +----------------------+----------------------+----------------------+ | VM_MAILBOX_STA | 1 or more Octets | C | | TUS_EXTENSION_DATA | (NOTE 3) | | +----------------------+----------------------+----------------------+ | VM_MESSAGE_ID | Bits 0..15 Octets | M | | (NOTE 1) | n+5..n+6 | | +----------------------+----------------------+----------------------+ | VM_ MESSAGE_LENGTH | Bits 0..7 Octet n+7 | M | | (NOTE 1) | | | +----------------------+----------------------+----------------------+ | VM_ | Bits 0..4 Octet n+8 | M | | MESS | | | | AGE_RETENTION_DAYS | | | | (NOTE 1) | | | +----------------------+----------------------+----------------------+ | RESERV | Bit 5 Octet n+8 | M | | ED_FOR_FUTURE_USE | | | | (NOTE 1) | | | +----------------------+----------------------+----------------------+ | VM_MESSAGE_ | Bit 6 Octet n+8 | M | | PRIORITY_INDICATION | | | | (NOTE 1) | | | +----------------------+----------------------+----------------------+ | OCTET_VM_MESSAGE_ | Bit 7 Ocet n+8 | M | | EXTENSION_INDICATOR | | | | (NOTE 1) | | | +----------------------+----------------------+----------------------+ | VM_MESSAGE_CAL | Octets n+9.. n+9+m | M | | LING_LINE_IDENTITY | (NOTE 2) | | | (NOTE 1) | | | +----------------------+----------------------+----------------------+ | VM_MESSAG | 1 Octet (NOTE 3) | C | | E_EXTENSION_LENGTH | | | | (NOTE 1) | | | +----------------------+----------------------+----------------------+ | VM_MESS | 1 or more Octets | C | | AGE_EXTENSION_DATA | (NOTE 3) | | | (NOTE 1) | | | +----------------------+----------------------+----------------------+ | NOTE 1: This | | | | sequence of | | | | parameters are | | | | repeated a number of | | | | times according to | | | | the number of Voice | | | | Mail notifications | | | | conveyed in this IE. | | | | | | | | NOTE 2: 'n' and 'm' | | | | denote the number of | | | | octets required for | | | | the | | | | VM_MAIL | | | | BOX_ACCESS_ADDRESS | | | | and the | | | | VM_CAL | | | | LING_LINE_IDENTITY | | | | as appropriate | | | | including the | | | | Address-Length, | | | | Type-of-address and | | | | Address-value (see | | | | 9.1.2.5). | | | | | | | | NOTE 3: The | | | | Conditional Octets | | | | are excluded from | | | | the Octet count in | | | | the table in this | | | | release because no | | | | extensions are | | | | defined in this | | | | release. | | | +----------------------+----------------------+----------------------+
ENHANCED_VOICE_MAIL_PDU_TYPE This parameter shall be set to 0 to specify that
the following Information Element Data Parameters is an Enhanced Voice Mail
Notification.
RESERVED_FOR_FUTURE_USE This parameter is set to 0 and is reserved for future
use.
MULTIPLE_SUBSCRIBER_PROFILE This parameter shall indicate the Multiple
Subscriber Profile (see 3GPP TS 23.097 [41]):
00 profile ID 1
> 10 profile ID 2
>
> 01 profile ID 3
>
> 11 profile ID 4
SM_STORAGE This parameter shall be set to 0 to indicate that this SM shall be
discarded after evaluating its contents; otherwise it shall be set to a 1 to
indicate to the MS that this SM shall be stored in the ME or the USIM.
VM_MAILBOX_ALMOST_FULL This parameter shall be set to 1 if the Voice Mailbox
in the Voice Mail system is almost full; otherwise this field shall be set to
0. The point at which the voice mailbox is considered almost full is Voice
Mail System specific.
VM_MAILBOX_FULL This parameter shall be set to 1 if the Voice Mailbox in the
Voice Mail system is full; otherwise this field shall be set to 0.
VM_MAILBOX_STATUS_EXTENSION_INDICATOR In this release, this parameter shall be
set to 0. This parameter shall be set to 1 to indicate that a
VM_MAILBOX_STATUS_EXTENSION_LENGTH parameter is present in this PDU.
VM_MAILBOX_ACCESS_ADDRESS This parameter shall contain the Voice Mailbox
number. It shall be coded according to section 9.1.2.5. In case of
contradiction between this parameter and the Mailbox Dialing Numbers stored on
(U)SIM this parameter shall take precedence and the MS may try to update
EF~MBDN~ on (U)SIM.
NUMBER_OF_VOICE_MESSAGES This octet shall contain a value in the range 0 to
255 indicating the current number of Voice Mail messages that are unread. The
value 255 shall be taken to mean 255 or greater. The NUMBER_OF_VOICE_MESSAGES
shall be stored on the (U)SIM in accordance with the procedure for storage of
Message Waiting Indication Status described in Special SMS Message Indication
(9.2.3.24.2).
NUMBER_OF_VM_NOTIFICATIONS This parameter has a range 0 to 15. This parameter
shall indicate the number of specific Voice Message notifications to follow
within this IE.
RESERVED_FOR_FUTURE_USE This parameter shall be set to 0 and is reserved for
future use.
VM_MAILBOX_STATUS_EXTENSION_LENGTH This parameter shall be set to the number
of additional octets that immediately follow. This parameter has a value in
the range 0 to 255. The presence of this parameter is conditional on the
setting of VM_MAILBOX_STATUS_EXTENSION_INDICATOR in this PDU.
VM_MAILBOX_STATUS_EXTENSION_DATA This parameter comprises a number of
additional octets allowing additional VM mailbox generic status parameters to
be conveyed in this PDU. Additional octets are not defined in this release but
may be defined later by 3GPP. This parameter is conditional on the presence of
VM_MAILBOX_EXTENSION_LENGTH
VM_MESSAGE_ID This parameter shall be set to the message ID of the Voice Mail
message in this specific Voice Message notification. This parameter is binary
and has a range 0 to 65535, modulus 65536. It is the responsibility of the
Voice Mail system to set this parameter to uniquely identify a Voice Mail
message within the modulus.
VM_ MESSAGE_LENGTH This parameter shall be set to the length of the Voice Mail
message in this notification in seconds. This parameter has a range 0 to 255.
For voice mail messages that are longer than 255 seconds, this parameter shall
be set to its maximum 255.
VM_ MESSAGE_RETENTION_DAYS This parameter shall be set to the number of days
after which the specific Voice Mail message in this notification is
anticipated to be automatically deleted from the Voice Mail system timed from
the GSM Timestamp (TP-SCTS 9.2.3.11) for this Enhanced Voice Mail
Notification. This parameter has a range 0 to 31. For Voice Mail messages that
have a longer retention time than 31 days, this parameter shall be set to its
maximum 31.
NOTE: The GSM Timestamp is the time that the SC received the SM from the Voice
Mail system which is not necessarily the time that the voice message was
deposited into the Voice Mail system.
> RESERVED_FOR_FUTURE_USE This parameter is set to 0 and is reserved for
> future use.
>
> VM_ MESSAGE_PRIORITY_INDICATION This parameter shall be set to 1 to indicate
> that the specific Voice Mail message in this notification held in the Voice
> Mailbox is urgent; otherwise the parameter shall be set to 0.
>
> VM_MESSAGE_EXTENSION_INDICATOR In this release, this parameter shall be set
> to 0. This parameter shall be set to a 1 to indicate that a
> VM_MESSAGE_EXTENSION_LENGTH parameter is present in this PDU.
>
> VM_MESSAGE_CALLING_LINE_IDENTITY This parameter shall contain the address to
> be used by the mobile subscriber to contact the originator of the specific
> Voice Mail message in this notification. Where the CLI is not available then
> the coding of this parameter shall indicate that there is no address. i.e
> The length indicator in this parameter shall be set to 0.
>
> This parameter coding shall comply with the the SM-TL address format
> specified in 9.1.2.5 above.
VM_MESSAGE_EXTENSION_LENGTH This parameter shall be set to the number of
additional octets that immediately follow. This parameter has a value in the
range 0 to 255. The presence of this parameter is conditional on the setting
of VM_MESSAGE_EXTENSION_INDICATOR in this PDU.
VM_MESSAGE_EXTENSION_DATA This parameter comprises a number of additional
octets allowing additional voicemail message specific parameters to be
conveyed in this PDU. Additional octets are not defined in this release but
may be defined later by 3GPP. This parameter is conditional on the presence of
VM_MESSAGE_EXTENSION_LENGTH.
###### 9.2.3.24.13.2 Enhanced Voice Mail Delete Confirmation
The Enhanced Voice Mail Delete Confirmation Information Element Data contains
synchronization information. A Voice Mail system may send an Enhanced Voice
Mail Delete Confirmation in order to indicate to the ME that certain voice
mail messages that have been deleted and to indicate the updated status of the
Voice Mailbox.
The Enhanced Voice Mail Delete Confirmation Information Element Data has the
following format where the parameters are in strict order following the IEDL.
The Enhanced Voice Mail Delete Confirmation IEI and its associated IEDL and
IED shall be complete within a single UDH.
+----------------------+----------------------+----------------------+ | Parameter | Parameter Length | Mandatory/ | | | | Conditional/Optional | +----------------------+----------------------+----------------------+ | ENHANCED_VO | Bit 0 Octet 1 | M | | ICE_MAIL_PDU_TYPE | | | +----------------------+----------------------+----------------------+ | RESERV | Bit 1 Octet 1 | M | | ED_FOR_FUTURE_USE | | | +----------------------+----------------------+----------------------+ | MULTIPLE\ | Bits 3..2 Octet 1 | M | | _SUBSCRIBER_PROFILE | | | +----------------------+----------------------+----------------------+ | SM_STORAGE | Bit 4 Octet 1 | M | +----------------------+----------------------+----------------------+ | VM_M | Bit 5 Octet 1 | M | | AILBOX_ALMOST_FULL | | | +----------------------+----------------------+----------------------+ | VM_MAILBOX_FULL | Bit 6 Octet 1 | M | +----------------------+----------------------+----------------------+ | V | Bit 7 Octet 1 | M | | M_MAILBOX_STATUS_ | | | | EXTENSION_INDICATOR | | | +----------------------+----------------------+----------------------+ | VM_MAIL | Octets 2..n+2 (NOTE | M | | BOX_ACCESS_ADDRESS | 2) | | +----------------------+----------------------+----------------------+ | NUMBER\ | Bits 0..7 Octet n+3 | M | | _OF_VOICE_MESSAGES | | | +----------------------+----------------------+----------------------+ | NUM | Bits 0..4 Octet n+4 | M | | BER_OF_VM_DELETES | | | +----------------------+----------------------+----------------------+ | RESERV | Bits 5..7 Octet n+4 | M | | ED_FOR_FUTURE_USE | | | +----------------------+----------------------+----------------------+ | VM_MAILBOX_STATU | 1 Octet (NOTE 3) | C | | S_EXTENSION_LENGTH | | | +----------------------+----------------------+----------------------+ | VM_MAILBOX_STA | 1 or more Octets | C | | TUS_EXTENSION_DATA | (NOTE 3) | | +----------------------+----------------------+----------------------+ | VM_MESSAGE_ID | Octets n+5..n+6 | M | | (NOTE 1) | | | +----------------------+----------------------+----------------------+ | RESERV | Bits 0..6 Octet n+7 | M | | ED_FOR_FUTURE_USE | | | | (NOTE 1) | | | +----------------------+----------------------+----------------------+ | VM_MESSAGE_ | Bit 7 Octet n+7 | M | | EXTENSION_INDICATOR | | | | (NOTE 1) | | | +----------------------+----------------------+----------------------+ | VM_MESSAG | 1 Octet (NOTE 3) | C | | E_EXTENSION_LENGTH | | | | (NOTE 1) | | | +----------------------+----------------------+----------------------+ | VM_MESS | 1 or more Octets | C | | AGE_EXTENSION_DATA | (NOTE 3) | | | (NOTE 1) | | | +----------------------+----------------------+----------------------+ | NOTE 1: This | | | | sequence of | | | | parameters are | | | | repeated a number of | | | | times according to | | | | the number of Voice | | | | Mail Delete | | | | Confirmations | | | | conveyed in this IE. | | | | | | | | NOTE 2: 'n' denotes | | | | the number of octets | | | | required for the | | | | VM_MAIL | | | | BOX_ACCESS_ADDRESS | | | | including the | | | | Address-Length, | | | | Type-of-address and | | | | Address-value (see | | | | 9.1.2.5). | | | | | | | | NOTE 3: The | | | | Conditional Octets | | | | are excluded from | | | | the Octet count in | | | | the table in this | | | | release because no | | | | extensions are | | | | defined in this | | | | release. | | | +----------------------+----------------------+----------------------+
ENHANCED_VOICE_MAIL_PDU_TYPE This parameter shall be set to 1 to specify that
the following Information Element Data is an Enhanced Voice Mail Delete
Confirmation.
RESERVED_FOR_FUTURE_USE This parameter is set to 0 and is reserved for future
use.
MULTIPLE_SUBSCRIBER_PROFILE See clause 9.2.3.24.13.1
SM_STORAGE See clause 9.2.3.24.13.1
VM_MAILBOX_ALMOST_FULL See clause 9.2.3.24.13.1
VM_MAILBOX_FULL See clause 9.2.3.24.13.1
VM_MAILBOX_STATUS_EXTENSION_INDICATOR In this release, this parameter shall be
set to 0. This parameter shall be set to 1 to indicate that a
VM_MAILBOX_STATUS_EXTENSION_LENGTH parameter is present in this PDU.
VM_MAILBOX_ACCESS_ADDRESS See clause 9.2.3.24.13.1
NUMBER_OF_VOICE_MESSAGES See clause 9.2.3.24.13.1
NUMBER_OF_VM_DELETES This parameter has a range 0 to 63. This parameter shall
indicate the number of VM_MESSAGE_ID's that follow in this IE
RESERVED_FOR_FUTURE_USE This parameter is set to 0 and is reserved for future
use.
VM_MAILBOX_STATUS_EXTENSION_LENGTH This parameter shall be set to the number
of additional octets that immediately follow. This parameter has a value in
the range 0 to 255. The presence of this parameter is conditional on the
setting of VM_MAILBOX_STATUS_EXTENSION_INDICATOR in this PDU.
VM_MAILBOX_STATUS_EXTENSION_DATA This parameter comprises a number of
additional octets allowing additional VM mailbox generic status parameters to
be conveyed in the PDU. Additional octets are not defined in this release but
may be defined later by 3GPP. This parameter is conditional on the presence of
VM_MAILBOX_EXTENSION_LENGTH
VM_MESSAGE_ID This parameter shall be set to the message ID of the specific
voice mail message(s) whose deletion is being confirmed. The range of this
parameter is defined in clause 9.2.3.24.13.1 and for a specific voice mail
message the value of this parameter shall be identical to that used for the VM
Notification. This parameter is repeated according to the number of voice mail
message deletions being confirmed.
RESERVED_FOR_FUTURE_USE This parameter is set to 0 and is reserved for future
use. This parameter is repeated according to the number of voice mail message
deletions being confirmed.
VM_MESSAGE_EXTENSION_INDICATOR In this release, this parameter shall be set to
0.This parameter shall be set to a 1 to indicate that a
VM_MESSAGE_EXTENSION_LENGTH parameter is present in this PDU.
VM_MESSAGE_EXTENSION_LENGTH This parameter shall be set to the number of
additional octets that immediately follow. This parameter has a value in the
range 0 to 255. The presence of this parameter is conditional on the setting
of VM_MESSAGE_EXTENSION_INDICATOR in this PDU
VM_MESSAGE_EXTENSION_DATA This parameter comprises a number of additional
octets allowing additional voicemail message specific parameters to be
conveyed in this PDU. Additional octets are not defined in this release but
may be defined later by 3GPP. This parameter is conditional on the presence of
VM_MESSAGE_EXTENSION_LENGTH
##### 9.2.3.24.14 Identification of a directory number within the User Data
Field
A directory number may, as an optional feature, be identified within the User
Data Field.
This allows, for example, a receiving entity to automatically identify a
string of digits in the User Data Field as being a telephone number in order
to facilitate easy call back by user action.
This shall be implemented by enclosing the directory number in inverted commas
(character 0100010 from the 7 bit default alphabet in 3GPP TS 23.038 [9] or
its equivalent in other character sets).
Unspecified address formats or International address formats (using + symbol)
may be used for the directory number.
Spaces may be included with the directory number inside the inverted commas.
E.g. "+1 234 567 8901"
The User Data Field displayed to the recipient may contain more than one
directory number, in which case it is for the user to select the one required.
##### 9.2.3.24.15 National Language Single Shift
This information element is used to indicate which National Language Single
Shift Table is used instead of the GSM 7 bit default alphabet extension table
specified in 3GPP TS 23.038 [9].
The total length of the IE is 1 octet:
octet 1 National Language Identifier.
The National Language Identifier values and Language tables are defined in
3GPP TS 23.038 [9].
> A receiving entity shall ignore (i.e. skip over and commence processing at
> the next information element) this information element if the value of the
> National Language Identifier is not described in 3GPP TS 23.038 [9].
>
> If this IE is duplicated within different segments of a concatenated message
> then a receiving entity shall process each segment individually.
If this IE is not included within a segment of a concatenated message then the
receiving entity shall use the GSM 7 bit default alphabet extension table for
this segment.
In the event that this IE is duplicated within one segment of a concatenated
message or a single message then a receiving entity shall use the last
occurrence of the IE.
> In the event that this IE is received within a single message or a segment
> of a concatenated message, in which the DCS has indicated UCS-2 encoding,
> then the receiving entity shall ignore this IE.
##### 9.2.3.24.16 National Language Locking Shift
This information element is used to indicate which National Language Locking
Shift Table is used instead of the GSM 7 bit default alphabet specified in
3GPP TS 23.038 [9].
This IE is coded in the same way as the National Language Single Shift IE in
subclause 9.2.3.24.15.
> A receiving entity shall ignore (i.e. skip over and commence processing at
> the next information element) this information element if the value of the
> National Language Identifier is not described in 3GPP TS 23.038 [9].
>
> If this IE is duplicated within different segments of a concatenated message
> then a receiving entity shall process each segment individually.
>
> If this IE is not included within a segment of a concatenated message then
> the receiving entity shall use the GSM 7 bit default alphabet table for this
> segment.
>
> In the event that this IE is duplicated within one segment of a concatenated
> message or a single message then a receiving entity shall use the last
> occurrence of the IE.
>
> In the event that this IE is received within a single message or a segment
> of a concatenated message, in which the DCS has indicated UCS-2 encoding,
> then the receiving entity shall ignore this IE.
#### 9.2.3.25 TP‑Reject‑Duplicates (TP‑RD)
The TP‑Reject‑Duplicates is a 1 bit field located within bit 2 of the first
octet of SMS‑SUBMIT and has the following values.
Bit no. 2: 0 Instruct the SC to accept an SMS‑SUBMIT for an SM still held in
the\ SC which has the same TP‑MR and the same TP‑DA as a previously submitted
SM from the same OA.
1 Instruct the SC to reject an SMS‑SUBMIT for an SM still held in the\ SC
which has the same TP‑MR and the same TP‑DA as the previously submitted SM
from the same OA. In this case the response returned by the SC is as specified
in 9.2.3.6..
#### 9.2.3.26 TP‑Status‑Report‑Qualifier (TP‑SRQ)
The TP‑Status‑Report‑Qualifier is a 1 bit field located within bit 5 of the
first octet of SMS‑STATUS‑REPORT and has the following values
Bit no. 5: 0 The SMS‑STATUS‑REPORT is the result of a SMS‑SUBMIT.
1 The SMS‑STATUS‑REPORT is the result of an SMS‑COMMAND e.g.
an Enquiry.
#### 9.2.3.27 TP‑Parameter‑Indicator (TP‑PI)
The TP‑Parameter‑Indicator comprises a number of octets between 1 and n where
each bit when set to a 1 indicates that a particular optional parameter is
present in the fields which follow. The TP‑PI is present as part of the
RP‑User‑Data in the RP‑ACK or the RP-ERROR as indicated in clauses 9.2.2.1a
and 9.2.2.2a or the RP-DATA as indicated in clause 9.2.2.3.
The structure of the TP‑PI is as follows:
Octet 1:
* * *
bit 7 bit 6 bit 5 bit 4 bit 3 bit 2 bit 1 bit 0 Extension bit Reserved
Reserved Reserved Reserved TP‑UDL TP‑DCS TP‑PID
* * *
The most significant bit in octet 1 and any other TP‑PI octets which may be
added later is reserved as an extension bit which when set to a 1 shall
indicate that another TP‑PI octet follows immediately afterwards.
If the TP‑UDL bit is set to zero then by definition neither the TP‑UDL field
or the TP‑UD field can be present. If the TP-UDL bit is set to "1" but the TP-
DCS bit is set to "0" then the receiving entity shall for TP-DCS assume a
value of 0x00, i.e. the 7bit default alphabet.
If a Reserved bit is set to \"1\" then the receiving entity shall ignore the
setting. The setting of this bit shall mean that additional information will
follow the TP‑User‑Data, so a receiving entity shall discard any octets
following the TP‑User‑Data.
#### 9.2.3.28 TP‑Loop-Prevention (TP‑LP)
The TP‑Loop-Prevention is a 1‑bit field, located within bit no 3 of the first
octet of the SMS‑Deliver and SMS-Status-Report, and to be given the values in
the table below.
In the following description, a \'spawned\' message refers to an application-
generated message (e.g. an auto-reply or a copy to a second subscription)
generated in response to a received SMS-Deliver or SMS-Status-Report. In order
to prevent message loops, only a single off-net forwarding operation shall be
permitted on any SMS-Deliver or SMS-Status-Report, and a spawned message shall
not spawn a further message. To achieve this, spawned messages and forwarded
messages (but not the original message) shall be marked using the TP-LP bit so
that further spawning or further off-net forwarding of these messages is
inhibited.
A network entity (e.g. an SC) that generates or transports SMS-Deliver or SMS-
Status-Report shall set this bit in the forwarded message when forwarding to a
destination other than that specified in the received SMS-Deliver or SMS-
Status-Report.
A network entity (e.g. an SC) that implements SMS forwarding shall inhibit
off-net forwarding of SMS-Deliver or SMS-Status-Report if this bit is already
set in the SMS-Deliver or SMS-Status-Report received from another network.
If an implementation does not prevent on-net message looping by other means, a
network entity (e.g. an SC) that implements SMS forwarding may inhibit on-net
forwarding of SMS-Deliver or SMS-Status-Report if this bit is already set in
the received SMS-Deliver or SMS-Status-Report.
A network entity (e.g. an SC) that spawns an additional message from a
received SMS-Deliver or SMS-Status-Report shall set the TP-LP bit in the
spawned message.
A network entity (e.g. an SC) shall inhibit generation of a spawned message if
this bit is already set in the received SMS-Deliver or SMS-Status-Report from
which the spawned message would otherwise be generated.
* * *
TP-LP Value Description 0 The message has not been forwarded and is not a
spawned message (or the sending network entity (e.g. an SC) does not support
the setting of this bit.) 1 The message has either been forwarded or is a
spawned message.
* * *
## 9.3 Service provided by the SM‑RL
### 9.3.1 General
The Short Message Relay Layer (SM‑RL) provides a service to the Short Message
Transfer Layer (SM‑TL). This service enables the SM‑TL to send Transfer
Protocol Data Units (TPDUs) to its peer entity, receive TPDUs from its peer
entity and receive reports about earlier requests for TPDUs to be transferred.
In order to keep track of TPDUs and reports about those TPDUs, primitives
between the SM‑TL and SM‑RL contain a Short Message Identifier (SMI), which is
a reference number for the TPDU associated with the primitive. This Short
Message Identifier is not carried via the SM‑RL protocol of clause 9.3.2. It
is carried via the relay layer service between the SC and GMSC. It is also
carried by SM‑RL of 3GPP TS 24.011 [13], between the visited MSC and MS. The
parameter is not carried by MAP but is mapped to and from the TCAP dialogue
Identifier (see CCITT Recommendation Q.771, \"Blue Book\" [19]) at the GMSC
and the visited MSC (therefore the Message Identifier at the SC/GMSC interface
is not the same as at the visited MSC/MS interface).
The SM‑RL communicates with its peer entity by the protocol described in the
following clauses.
### 9.3.2 Protocol element repertoire at SM‑RL
Different protocols are required between different pairs of SM‑RL entities.
Those are described in other GSM/UMTS specifications. This clause gives a
survey of the different information elements which have to be conveyed between
those entities. (Note that the notation of the protocol and information
elements may vary between different GSM/UMTS specifications).
The SM‑RL comprises the following 6 protocol elements:
RP‑MO‑DATA for transferring a TPDU from MS to SC
RP‑MT‑DATA for transferring a TPDU from SC to MS
RP‑ACK for acknowledging an RP‑MO‑DATA, an RP‑MT‑DATA or an\
RP‑SM‑MEMORY‑AVAILABLE
RP‑ERROR for informing of an unsuccessful RP‑MO‑DATA or an RP‑MT‑DATA transfer
attempt
RP‑ALERT‑SC for alerting the SC that the MS has recovered operation
(information
sent from the HLR to the SC)
RP‑SM‑MEMORY‑AVAILABLE for notifying the network that the MS has memory
available to
accept one or more short messages (information sent from the MS to
the HLR)
#### 9.3.2.1 RP‑MO‑DATA
Basic elements of the RP‑MO‑DATA type.
* * *
Abbr. Reference P1) Description RP‑OA RP‑Originating‑Address ++‑ Address of
the originating MS. RP‑DA RP‑Destination‑Address ‑++ Address of the
destination SC. RP‑UD RP‑User‑Data +++ Parameter containing the TPDU
* * *
1) Provision on the links SC\MSC, MSC\MSC or MSC\SGSN, and MSC\MS
or SGSN\MS indicated by \"xxx\", where x may be either \"+\" or \"‑\",
dependent on whether the parameter is mandatory or not on the respective link.
#### 9.3.2.2 RP‑MT‑DATA
Basic elements of the RP‑MT‑DATA type.
* * *
Abbr. Reference P1) Description RP‑PRI RP‑Priority‑Request +‑‑ Parameter
indicating whether or not the short message transfer should be stopped if the
originator SC address is already contained in the MWD. RP‑MMS
RP‑More‑Messages‑To‑Send OO‑ Parameter indicating that there are more messages
waiting in the SC RP‑OA RP‑Originating‑Address +++ Address of the originating
SC. RP‑DA RP‑Destination‑Address ++‑ Address of the destination MS. RP‑UD
RP‑User‑Data +++ Parameter containing the TPDU RP-MTI RP-Message Type
Indicator O-- Parameter indicating if the TPDU is a SMS Deliver or a SMS
Status Report 2) RP-SMEA RP-originating SME-Address O-- Address of the
originating SME 2)
* * *
1) Provision on the links SC\MSC, MSC\MSC or MSC\SGSN, and MSC\MS
or SGSN\MS indicated by \"xxx\", where x may be \"+\", \"‑\" or \"O\",
dependent on whether the parameter is mandatory, not present or optional on
the respective link.
2) These information elements may be included in the \"Send Routing
Information for SM\" sent by the SMS-GMSC to the HLR.
When transmitted, the RP-SMEA shall take the TP-OA value.
When transmitted, the RP-MTI shall be given the following values:
0 SMS Deliver.
1 SMS Status Report.
This may be used by the HLR to distinguish the two cases in order not to apply
any filtering mechanism based on the RP-SMEA value in case of a SMS-Status
Report transmission.
#### 9.3.2.3 RP‑ACK
The RP‑ACK contains the RP‑User‑Data which is a parameter containing the TPDU
(see subclauses 9.2.2.1a and 9.2.2.2a).
#### 9.3.2.4 RP‑ERROR
Basic elements of the RP‑ERROR type.
* * *
Abbr. Reference P1) Description RP‑MSI RP‑MW‑Set‑Indication +‑‑ Parameter
indicating whether or not the MWI has been up‑dated. 2) RP‑CS RP‑Cause +++
Parameter identifying the error type. The RP‑Cause parameter gives the reason
why a short message transfer attempt fails. In practice three relay layer
protocols are used ‑ SC to GMSC/IWMSC (see Annex A), MAP (see 3GPP TS 29.002
[15]) and via the radio interface (see 3GPP TS 24.011 [13]) RP‑MSIsdn
RP‑international‑‑MS‑ISDN‑number +‑‑ MSIsdn‑Alert of the MS, see clause 3.2.7
3) RP-UD RP-User-Data OO O Parameter containing a TPDU
* * *
1) Provision on the links SC\MSC, MSC\MSC or MSC\SGSN, and MSC\MS
or SGSN\MS indicated by \"xxx\", where x may be \"+\", \"-\" or \"O\"
dependent on whether the parameter is mandatory, not present or optional on
the respective link.
2) Only present when the RP‑ERROR is transferred from the SMS‑GMSC to the SC.
3) Only present when the RP‑MT‑DATA transfer attempt failed because the MS is
not reachable or because the MS memory capacity was exceeded and the
MSIsdn‑Alert is different from the MSIsdn used by the SC to address the
recipient MS.
#### 9.3.2.5 RP‑ALERT‑SC
Basic elements of the RP‑ALERT‑SC type:
* * *
Abbr. Reference P1) Description RP‑MSIsdn RP‑International‑MS‑ISDN‑Number M
MSIsdn of the MS.
* * *
1) Provision; Mandatory (M).
#### 9.3.2.6 RP‑SM‑MEMORY‑AVAILABLE
Basic elements of the RP‑SM‑MEMORY‑AVAILABLE type:
* * *
Abbr. Reference P1) Description RP‑IMSI
RP‑International‑Mobile‑Subscriber‑Identity ++‑ IMSI of the MS.
* * *
1) Provision on the links HLR\VLR or HLR\SGSN, VLR\MSC and MSC\MS
or SGSN\MS indicated by \"xxx\", where x may be either \"+\" or \"‑\",
dependent on whether the parameter is mandatory or not present on the
respective link.
# 10 Fundamental procedures within SMS
The procedures for providing SMS over a generic IP CAN is described in 3GPP TS
23.204 [42] (see subclause 6).
The SMS comprises 3 fundamental procedures:
1) Short message mobile terminated. This procedure consists of all necessary
operations to:
a) transfer a short message or status report from the SC to the MS;
b) return a report to the SC, containing the result of the message transfer
attempt.
2) Short message mobile originated. This procedure consists of all necessary
operations to:
a) transfer a short message from the MS to the SC;
b) return a report to the MS, containing the result of the message transfer
attempt.
3) Transfer of an Alert. This procedure consists of all necessary operations
for an HLR or a VLR to initiate a transfer of an Alert to a specific SC,
informing the SC that the MS has recovered operation.
3GPP TS 29.002 [15] defines operations necessary for the provision of the
Short Message Service. The operations defined in clause 10 describe the
requirement that the Short Message Service puts upon the network
functionality. If discrepancies exist in nomenclature, it is the 3GPP TS
29.002 [15] that shall be the reference.
Annex C indicates the flow of primitives and parameters during the short
message transfer between the SC and the MS. Both the Mobile terminated and the
Mobile originated cases are covered.
## 10.1 Short message mobile terminated
The entities involved in this procedure are depicted in figure 14.
{width="5.940277777777778in" height="1.80625in"}
NOTE 1: The SMS Router is an optional entity. If it is not present, the two
interfaces extending from the right side of the SMS‑GMSC extend directly to
the SGSN and MSC, respectively.
NOTE 2: Since the short message mobile terminated procedure covers the
functionality required at SM‑RL for transferring TPDUs from SC to MS, the
procedure described covers both short message (SMS‑DELIVER) and status report
(SMS‑STATUS‑REPORT) transfer. The term \"short message transfer\" therefore,
in this clause, covers both cases.
Figure 14: Interfaces involved in the Short message mobile terminated
procedure. GSM TS 43.002 [5]. X is the interface between an MSC and an SC as
defined in clause 5
In figure 15, sequence diagrams are shown for the following basic situations
of short message mobile terminated transfer attempt:
‑ Successful short message transfer via the MSC or the SGSN;
\- Successful short message transfer via the SMS Router, and the MSC or SGSN;
‑ Short message transfer attempt failing due to error at the SMS‑GMSC;
‑ Short message transfer attempt failing due to negative outcome of HLR
information retrieval;
\- Short message transfer attempt via the SMS Router failing due to negative
outcome of HLR information retrieval;
‑ Short message transfer attempt failing due to error at the MSC or SGSN;
‑ Short message transfer attempt failing due to negative outcome of VLR
information retrieval;
‑ Short message transfer attempt failing due to erroneous message transfer on
the radio path;
‑ Short message transfer attempt failing over the first path (e.g. SGSN) and
succeeding over the second path (e.g. MSC);
\- Short message transfer attempt via the SMS Router failing over the first
path (e.g. SGSN) and succeeding over the second path (e.g. MSC);
‑ Short message transfer attempt failing over the first path (e.g. SGSN) and
over the second path (e.g. MSC).
References to the relevant specifications of the different operations are
given in clause 4.
NOTE 1): This operation is not used by the SGSN.
Figure 15a): Successful short message transfer attempt via the MSC or the SGSN
{width="6.686805555555556in" height="4.720833333333333in"}
NOTE 1: Operation 5 is not used by the SGSN.
Figure 15aa): Successful short message transfer attempt via the SMS Router,
and the MSC or SGSN
Figure 15b): Short message transfer attempt failing due to error at the
SMS‑GMSC
Figure 15c): Short message transfer attempt failing due to negative outcome
of\ HLR information retrieval
{width="6.686805555555556in" height="4.159722222222222in"}
Figure 15ca) Short message transfer attempt via the SMS Router failing due to
negative outcome of HLR information retrieval
NOTE: If an SMS Router is present, the message flow in 15aa is used, except
that a 4c Failure Report message is transparently transferred to the SMS‑GMSC
from the MSC or SGSN by the SMS Router instead of a 4b Delivery Report.
Figure 15d): Short message transfer attempt failing due to error at the MSC or
SGSN
NOTE: If an SMS Router is present, the message flow in 15aa is used, except
that a 4c Failure Report message is transparently transferred to the SMS‑GMSC
from the MSC or SGSN by the SMS Router instead of a 4b Delivery Report.
Figure 15e): Short message transfer attempt failing due to negative outcome
of\ VLR information retrieval
NOTE 1: This operation is not used by the SGSN.
NOTE 2: If an SMS Router is present, the message flow in 15aa is used, except
that a 4c Failure Report message is transparently transferred to the SMS‑GMSC
from the MSC or SGSN by the SMS Router instead of a 4b Delivery Report.
Figure 15f): Short message transfer attempt failing due to erroneous message
transfer\ on the radio path
NOTE 1: This operation is not used by the SGSN.
NOTE 2: Two addresses (SGSN and MSC) are received from HLR.
NOTE 3: Both successful transfer over second path and unsuccessful transfer
over first path (e.g. Absent subscriber) are sent to HLR.
NOTE 4: The SMS transfer towards the second path is only triggered by the
reception of some MAP errors on the first path as described in sub-clause
8.1.1.
Figure 15g): Short message transfer attempt failing over the first path (e.g.
SGSN) and\ succeeding over the second path (e.g. MSC)
{width="6.686805555555556in" height="7.117361111111111in"}
NOTE 1: Operation 5 is not used by the SGSN.
NOTE 2: In Operation 2b, two addresses are received from the SMS Router by the
SMS‑GMSC. Both contain the address of the SMS Router, however, each address
identifies delivery to the MS via the MSC or via the SGSN.
NOTE 3: In Operation 3, both successful transfer over second path and
unsuccessful transfer over first path (e.g. Absent subscriber) are sent to the
HLR.
NOTE 4: The SMS transfer towards the second path is only triggered by the
reception of some MAP errors on the first path as described in sub‑clause
8.1.1.
Figure 15ga): Short message transfer attempt via the SMS Router failing over
the first path (e.g. SGSN) and succeeding over the second path (e.g. MSC)
NOTE 1: This operation is not used by the SGSN.
NOTE 2: Two addresses (SGSN and MSC) are received from HLR.
NOTE 3: Unsuccessful transfer over the second path (e.g.
MemoryCapacityExceeded) and over the first path (e.g. Absent subscriber) are
sent to HLR.
NOTE 4: The SMS transfer towards the second path is only triggered by the
reception of some MAP errors on the first path as described in clause 8.1.1.
NOTE 5: If an SMS Router is present, the message flow in 15ga is used, except
that a 4c Failure Report message is transparently transferred to the SMS‑GMSC
from the MSC or SGSN by the SMS Router instead of a 4b Delivery Report.
Figure 15h): Short message transfer attempt failing over the first path (e.g.
SGSN) and\ over the second path (e.g. MSC)
Operation 1: Message transfer SC ‑> SMS‑GMSC.
This operation is used to transfer a short message from an SC to an SMS‑GMSC.
The operation consists of:
‑ the transfer of a message containing the TPDU from the SC to the SMS‑GMSC
(see \"1a. Message transfer\" in figure 15); and
‑ the return of either a \"Failure report\" (see 1c. in figure 15) or a
\"Delivery report\" (see 1b. in figure 15).
\"Failure report\" is returned to the SC when the SMS‑GMSC has received
indication from another entity (MSC, SGSN or HLR) the procedure was
unsuccessful. The error indications which the SMS‑GMSC may receive from the
MSC, SGSN, HLR, VLR or MS enable the SMS‑GMSC to return one of the error
indications given in clause 3.3 back to the SC.
Operation 2: sendRoutingInfoForShortMsg.
The operation is an interrogation of the HLR by the SMS‑GMSC or the SMS Router
to retrieve information necessary to deliver the short message.
The result may contain the MSC, SGSN, both MSC and SGSN addresses, or the
address of the SMS Router. It shall also indicate which address belongs to the
MSC and the SGSN, however, it shall not indicate if the address belongs to an
SMS Router (as the SMS Router poses as either an MSC or an SGSN or both to the
SMS-GMSC).
Operation 3: SM-DeliveryReportStatus.
The operation provides a means for the SMS‑GMSC to request the HLR to add an
SC address to the MWD, and is activated when the SMS‑GMSC receives an absent
subscriber indication from the MSC, SGSN or both, and/or when the SMS‑GMSC
receives a failure report for a short message transfer with cause MS Memory
Capacity Exceeded via the MSC or SGSN. The Return Result optionally contains
the MSIsdn‑Alert.
This operation is also activated at successful delivery short message when the
MNRF, MNRG or both are set in HLR.
The operation consists of:
‑ the transfer of a message, containing the MSISDN of the MS to which the
short message was addressed, the SC‑address, the successful outcome and/or the
causes (Absent Subscriber, MS memory capacity exceeded or both) for updating
the MWD, from the SMS‑GMSC to the HLR (see 3. in figure 15).
Operation 4: forwardShortMessage.
The operation provides a means for the SMS‑GMSC to transfer a short message to
the MSC or to the SGSN at which the MS is currently located, via an SMS Router
if deployed by the HPLMN of the receiving MS.
The operation works in tandem with the forwarding of the short message from
the MSC or from the SGSN to the MS. Thus, the outcome of the operation
comprises either success, i.e. that the message has been delivered to the MS;
or a failure that may be caused by several reasons, e.g. failure in the
transfer SMS‑GMSC ‑> MSC or SMS-GMSC -> SGSN, MS being detached, or no paging
response.
It should be noted that the MNRG setting is implicitly carried out in the SGSN
when the message transfer is denied due to GPRS DETACH.
Operation 5: sendInfoForMT‑SMS.
The operation provides a means for the MSC to retrieve subscriber information
from VLR for mobile terminated short message transfer. The operation may be
associated with an authentication procedure, as shown in figure 16.
Unsuccessful retrieval (e.g. absent subscriber) is indicated by a cause
indication to the SMS‑GMSC.
An overall depiction of how operation 5 interacts with signalling on the radio
path is given in figure 16.
It should be noted that the MNRF setting is implicitly carried out when the
message transfer is denied due to IMSI DETACH.
NOTE: This operation is not used by the SGSN.
Operation 6: Message transfer MSC ‑> MS.
The operation is used to transfer a short message from the MSC to the MS.
If the transfer is not successful, e.g. due to the MS losing radio coverage
after having successfully authenticated, a failure report (RP‑ERROR) is
returned to the SMS‑GMSC. In this case, MWD and MCEF in the HLR shall be
updated only for the case where the transfer fails with cause MS Memory
Capacity Exceeded.
If the MS notifies the network that the MS has been unable to accept a short
message because its memory capacity has been exceeded, then the ME shall set
the memory capacity Exceeded Notification flag if present.
Operation 7: InformSC.
The operation is used to transfer the MSIsdn‑Alert from the HLR to the
SMS‑GMSC if the error Absent Subscriber or a positive result is given as an
answer to the operation SendRoutingInfoForSM.
{width="6.690972222222222in" height="4.451388888888889in"}
* * *
{width="0.7118055555555556in" height="0.2673611111111111in"} : Operation
invocation or message transfer : Successful operation invocation or message
transfer incl. report
* * *
NOTE 1: Described in GSM 44.008 [12] and 3GPP TS 29.002 [15].
If the SGSN is used, Paging and Authentication are performed from SGSN.
NOTE 2: This operation is not used by the SGSN.
NOTE 3: If an SMS Router is present, the message 4a forwardShortMessage and 4b
Delivery report are transparently transferred from/to the SMS‑GMSC to/from the
MSC or SGSN by the SMS Router.
Figure 16a): \"Send information for MT SMS\" procedure; error free case
{width="6.688888888888889in" height="3.357638888888889in"}
* * *
{width="0.7118055555555556in" height="0.2673611111111111in"} : Operation
invocation or message transfer : Error report
* * *
NOTE 1: The GPRS DETACH information is in the SGSN.
This operation is not used by the SGSN.
NOTE 2: If an SMS Router is present, the message 4a forwardShortMessage and 4c
Failure report are transparently transferred from/to the SMS‑GMSC to/from the
MSC or SGSN by the SMS Router.
Figure 16b): \"Send information for MT SMS\" procedure;\ erroneous case:
absent subscriber (e.g. IMSI DETACH or GPRS DETACH)
{width="6.689583333333333in" height="3.6819444444444445in"}
* * *
{width="0.7118055555555556in" height="0.2673611111111111in"} : Operation
invocation or message transfer : Error report
* * *
NOTE 1: Described in GSM 44.008 [12] and 3GPP TS 29.002 [15].
If the SGSN is used, Paging is performed from SGSN.
NOTE 2: This operation is not used by the SGSN.
NOTE 3: If an SMS Router is present, the message 4a forwardShortMessage and 4c
Failure report are transparently transferred from/to the SMS‑GMSC to/from the
MSC or SGSN by the SMS Router.
Figure 16c): \"Send information for MT SMS\" procedure;\ erroneous case:
Absent subscriber (e.g. no paging response)
{width="6.688888888888889in" height="3.783333333333333in"}
+----------------------------------+----------------------------------+ | {width="0.7118055555555556in" | message transfer | | height="0.41597222222222224in"} | | +----------------------------------+----------------------------------+ | | : Error report | +----------------------------------+----------------------------------+ | | : Unsuccessful operation | | | invocation or message transfer | | | including error report | | | | | | (or with missing confirmation) | +----------------------------------+----------------------------------+
NOTE 1: Described in GSM 44.008 [12] and 3GPP TS 29.002 [15].
If the SGSN is used, Paging and Authentication are performed from SGSN.
NOTE 2: This operation is not used by the SGSN.
NOTE 3: If an SMS Router is present, the message 4a forwardShortMessage and 4c
Failure report are transparently transferred from/to the SMS‑GMSC to/from the
MSC or SGSN by the SMS Router.
Figure 16d): \"Send information for MT SMS\" procedure; incorrect
authentication
## 10.2 Short message mobile originated
The entities involved in this procedure is depicted in figure 17.
Figure 17: Interfaces involved in the Short message mobile originated
procedure
GSM TS 43.002 [5]. X is the interface between an MSC or an SGSN and an SC as
defined in clause 5.
Note that since the short message mobile originated procedure covers the
functionality required at SM‑RL for transferring TPDUs from SC to MS, the
procedure described covers both short message (SMS‑SUBMIT) and command
(SMS‑COMMAND) transfer. The term \"short message transfer\" therefore in this
clause, covers both cases.
In figure 18, sequence diagrams for the following basic situations of short
message mobile terminated transfer attempt:
‑ Successful short message transfer;
‑ Short message transfer attempt failing due to error at the MSC or SGSN;
‑ Short message transfer attempt failing due to negative outcome of VLR
information retrieval;
‑ Short message transfer attempt failing due to error at the SMS‑IWMSC;
  * Short message transfer attempt failing due to error at the SC;
\- Short Message transfer attempt successful due to the existence of an SMS
Interworking agreement;
\- Short Message transfer attempt failing due to non-existence of an SMS
Interworking agreement;
\- Short Message transfer attempt failing due to negative outcome of HLR
information retrieval.
References to the relevant specifications of the different operations are
given in clause 4.
{width="6.71875in" height="5.28125in"}
* * *
{width="0.7118055555555556in" height="0.2673611111111111in"} : Operation
invocation or message transfer : Successful operation invocation or message
transfer including report
* * *
NOTE 1): Described in [12] and 3GPP TS 29.002 [15].
NOTE 2): This operation is not used by the SGSN.
Figure 18a): Successful short message transfer attempt
{width="6.688194444444444in" height="2.526388888888889in"}
* * *
{width="0.7131944444444445in" height="0.46041666666666664in"} : Operation
invocation or message transfer : Successful operation invocation or message
transfer including report : Error report
* * *
NOTE 1): Described in GSM 44.008 [12] and 3GPP TS 29.002 [15].
Figure 18b): Short message transfer attempt failing due to error at the MSC or
SGSN
{width="6.708333333333333in" height="3.2083333333333335in"}
+----------------------------------+----------------------------------+ | {width="0.7131944444444445in" | message transfer | | height="0.5819444444444445in"} | | +----------------------------------+----------------------------------+ | | : Successful operation | | | invocation or message transfer | | | including report | +----------------------------------+----------------------------------+ | | : Error report | +----------------------------------+----------------------------------+ | | : Unsuccessful operation | | | invocation or message transfer | | | incl. error report | | | | | | (or with missing confirmation) | +----------------------------------+----------------------------------+
NOTE 1): Described in GSM 44.008 [12] and 3GPP TS 29.002 [15].
NOTE 2): This operation is not used by the SGSN.
Figure 18c): Short message transfer attempt failing due to negative outcome
of\ VLR information retrieval
{width="6.708333333333333in" height="4.208333333333333in"}
* * *
{width="0.7131944444444445in" height="0.46041666666666664in"} : Operation
invocation or message transfer : Successful operation invocation or message
transfer including report : Error report
* * *
NOTE 1): Described in GSM 44.008 [12] and 3GPP TS 29.002 [15].
NOTE 2): This operation is not used by the SGSN.
Figure 18d): Short message transfer attempt failing due to error at the
SMS‑IWMSC
{width="6.6875in" height="5.208333333333333in"}
* * *
{width="0.7131944444444445in" height="0.46041666666666664in"} : Operation
invocation or message transfer : Successful operation invocation or message
transfer including report : Error report
* * *
NOTE 1): Described in GSM 44.008 [12] and 3GPP TS 29.002 [15].
NOTE 2): This operation is not used by the SGSN.
Figure 18e): Short message transfer attempt failing due to error at the SC
* * *
     : Operation invocation or message transfer
     : Successful operation invocation or message transfer including report
* * *
NOTE 1: Described in 3GPP TS 44.008 [12] and 3GPP TS 29.002 [15].
NOTE 2: This operation is not used by the SGSN.
NOTE 3: HLR that terminated user belongs to.
> After completing operation 2, SMS-IWMSC could check whether SMS interworking
> agreement exists or not based on IMSI. In this figure 18f case, there is an
> SMS interworking agreement between operators.
Figure 18f): Short Message transfer Successful due to the existence\ of an SMS
Interworking agreement
* * *
     : Operation invocation or message transfer
     : Successful operation invocation or message transfer including report
     : Error report
* * *
NOTE 1: Described in 3GPP TS 44.008 [12] and 3GPP TS 29.002 [15].
NOTE 2: This operation is not used by the SGSN.
NOTE 3: HLR that terminated user belongs to.
NOTE 4: The lack of an SMS interworking agreement can not be conveyed in the
Failure Report as a specific indication.
> After completing operation 2, SMS-IWMSC could check whether SMS interworking
> agreement exists or not based on IMSI. In this figure18g case, there is no
> SMS Interworking agreement between operators.
Figure 18g): Short Message transfer attempt failing due to non-existence\ of
an SMS Interworking agreement
* * *
     : Operation invocation or message transfer
     : Successful operation invocation or message transfer including report
     : Error report
* * *
NOTE 1: Described in 3GPP TS 44.008 [12] and 3GPP TS 29.002 [15].
NOTE 2: This operation is not used by the SGSN.
NOTE 3: HLR that terminated user belongs to.
NOTE 4: The lack of an SMS interworking agreement can not be conveyed in the
Failure Report as a specific indication.
> If SMS-IWMSC receives an informSC Message, then this message shall be
> ignored by the SMS-IWMSC.
Figure 18h: Short Message transfer attempt failing due to negative outcome\ of
HLR information retrieval
If a failure report is indicated by the HLR after invocation of the
\"sendRoutingInfoForShortMsg\" operation, the SMS‑IWMSC shall return the
appropriate error information to the MSC/SGSN with the error cause coded as
follows:
+----------------------------------+----------------------------------+ | Return error from | Error mapping to | | SendRoutingInfoForSM | ForwardShortMessage | +----------------------------------+----------------------------------+ | system Failure | system Failure | +----------------------------------+----------------------------------+ | data Missing | system Failure | +----------------------------------+----------------------------------+ | Unexpected Data Value | system Failure | +----------------------------------+----------------------------------+ | facility Not supported | SM Delivery Failure | | | | | | cause: invalid SME-address | +----------------------------------+----------------------------------+ | unknown Subscriber | SM Delivery Failure | | | | | | cause: invalid SME-address | +----------------------------------+----------------------------------+ | teleservice Not provisioned | SM Delivery Failure | | | | | | cause: invalid SME-address | +----------------------------------+----------------------------------+ | Call barred | SM Delivery Failure | | | | | | cause: invalid SME-address | +----------------------------------+----------------------------------+ | Absent Subscriber SM | SM Delivery Failure | | | | | | cause: invalid SME-address | +----------------------------------+----------------------------------+
Operation 2: sendRoutingInfoForShortMsg.
The operation is an interrogation of the HLR by the SMS-IWMSC to retrieve
information necessary to forward the short message.
The outcome of the operation comprises either success, where the result
contains the IMSI for terminated UE, or failure, which may be caused by
several reasons.
Operation 7: Message transfer MS ‑> MSC or MS -> SGSN.
The operation is used to transfer a short message from the MS to the MSC or to
the SGSN.
Operation 8: sendInfoForMO‑SMS.
The operation provides a means for the MSC to verify from the VLR that the
mobile originated short message transfer does not violate supplementary
services invoked or restrictions imposed using the network feature Operator
Determined Barring.
A successful VLR response carries the MSIsdn of the originating MS being
transferred to the SC at SM‑RL.
NOTE: This operation is not used by SGSN.
Operation 9: forwardShortMessage.
The operation provides a means for the MSC or for the SGSN to transfer a short
message to the SMS‑IWMSC.
The procedure is required if the serving MSC or SGSN cannot access the SC
directly, e.g. because it has no connection to SC (see clause 5).
The procedure works in tandem with the forwarding of the short message from
the SMS‑IWMSC to the SC. Thus, the outcome of the operation comprises either
success, i.e. that the message has been delivered to the SC; or a failure that
may be caused by several reasons, e.g. failure in the transfer MSC ‑‑>
SMS‑IWMSC or SGSN ‑‑> SMS‑IWMSC, SC does not comply.
Operation 10: Message transfer SMS‑IWMSC ‑> SC.
The operation is used to transfer a short message from an SMS‑IWMSC to an SC,
and consists of:
‑ the transfer of a message containing the TPDU from the SMS‑IWMSC to the SC
(see \"10a. Message transfer\" in figure 18); and
‑ the return of either a \"Failure report\" (see 10c. in figure 18) or a
\"Delivery report\" (see 10b. in figure 18).
\"Failure report\" is returned to the MS when the SMS‑IWMSC has received
indication from the network or the SC that the procedure was unsuccessful.
## 10.3 Alert transfer
The entities involved in this procedure are depicted in figure 19.
Figure 19: Interfaces involved in the Alert procedure. X is the interface
between an SC and\ an MSC as defined in clause 5
This procedure consists of the operations shown in figure 20.
Three cases are distinguished:
‑ the MS becomes reachable when the MNRF, MNRG or both are set but the MCEF is
not set (figure 20a);
‑ the MS becomes reachable when the MNRF, MNRG or both, and the MCEF are set
(figure 20b);
‑ the MS notifies the network that it has memory available to receive one or
more short messages when the MCEF is set (figure 20c).
The operations between MSC and VLR, between HLR and VLR or SGSN and between
HLR and SMS‑IWMSC are specified in 3GPP TS 29.002 [15]. The operation between
MS and MSC or SGSN is specified in 3GPP TS 24.011 [13]. References to
specifications of other operations are given in clause 4.
{width="6.6930555555555555in" height="2.6in"}
* * *
{width="0.7125in" height="0.15in"} : Operation invocation or message transfer
* * *
NOTE 1): In case ReadyForSM is sent by the SGSN, the reason may be MS
reachable via the SGSN, or MS reachable via the SGSN and the MSC (see3GPP TS
23.060 [27]).
Figure 20a: The alert procedure when the MS becomes reachable,\ MNRF, MNRG or
both are set and MCEF is not set
{width="6.686805555555556in" height="1.0958333333333334in"}
* * *
{width="0.7125in" height="0.15in"} : Operation invocation or message transfer
* * *
NOTE 1): In case ReadyForSM is sent by the SGSN, the reason may be MS
reachable via the SGSN, or MS reachable via the SGSN and the MSC (see 3GPP TS
23.060 [27]).
Figure 20b: The alert procedure when the MS becomes reachable,\ MNRF, MNRG or
both are set and MCEF is set
{width="6.689583333333333in" height="2.661111111111111in"}
* * *
{width="0.7118055555555556in" height="0.2673611111111111in"} : Operation
invocation or message transfer : Successful operation invocation or message
transfer including report
* * *
NOTE 1): Described in 3GPP TS 24.011 [13] and 3GPP TS 29.002 [15].
Figure 20c: The alert procedure when the MS notifies the network that it has\
memory available to receive one or more short messages and MCEF is set
Operation 11: ReadyForSM (MS reachable).
The operation provides a means to transfer alert information from VLR or SGSN
to HLR.
The procedure is activated when the VLR or the SGSN detects that the MS is
active, i.e. when the MS responds to a paging request.
Operation 12: alertServiceCentre.
The operation provides a means to transfer alert information from HLR to MSC.
Operation 13: ServiceCentrealert.
The operation provides a means to transfer alert information from an SMS‑IWMSC
to an SC.
The operation consists of transfer of a message (\"RP‑ALERT‑SC\") from the
SMS‑IWMSC to the SC.
Operation 14: ReadyForSM (smMemoryCapacityAvailable).
The operation provides a means for the MS to notify the network that it has
memory available to receive one or more short messages.
The following applies if the memory capacity available notification flag is
implemented in the (U)SIM.
The operation consists of transfer of a message (\"RP‑SM‑MEMORY‑AVAILABLE\")
from the MS to the HLR, and the return of an acknowledgement to the MS. When
the MS rejects a short message due to lack of available memory capacity the
need to transfer notification shall be stored in the (U)SIM. After a attempt
to transfer the RP‑SM‑Memory‑Available message the following applies:
If the MS receives a positive acknowledgement it shall unset the memory
capacity exceeded notification flag in the (U)SIM and exit this procedure.
If the MS receives a negative acknowledgement indicating a permanent failure
condition (as specified in 3GPP TS 24.011 [13]) it shall unset the memory
capacity exceeded notification flag in the (U)SIM and exit the procedure.
If the MS receives a negative acknowledgement indicating a temporary failure
condition (as specified in 3GPP TS 24.011 [13]) or receives no acknowledgement
or an indication of failure by lower layers, it shall repeat the attempt to
transfer the message in accordance with procedures defined in 3GPP TS 24.011
[13]. If these repeat procedures fail, the mobile shall unset the memory
capacity exceeded notification flag in the (U)SIM and exit this procedure.
If memory capacity has become available because memory is cleared, the value
of the memory capacity exceeded notification flag is read. If the flag is set,
the MS notifies the network that memory capacity is now available as described
above.
When the mobile is powered up or the SIM/UICC is inserted, the mobile shall
check the memory capacity exceeded notification flag in the (U)SIM; if the
flag is set and the (U)SIM has memory available to receive a short message the
mobile shall attempt to notify the network that it has memory available, as
described above.
# 11 Mapping of error causes between RP layers
This clause describes the interworking between the relay layers on the radio
interface (i.e. between the servicing MSC/SGSN and the mobile station), and
within the network (i.e. between servicing MSC/SGSN, VLR, HLR, or GMSC).
## 11.1 Mobile Terminated short message transfer
If errors are indicated by the VLR after invocation of the
\"sendInfoFor‑MT‑SMS\" operation, the appropriate error information is
returned to the SMS‑GMSC in a failure report as specified in 3GPP TS 29.002
[15] (negative outcome of \"forwardShortMessage\" see clause 10).
If errors are detected by the MSC or by the SGSN during the transfer on the
radio interface, or by the IP-SM-GW, the error cause returned in the return
error of the MAP procedure ForwardShortMessage shall be set as follows:
+----------------------------------+----------------------------------+ | **Failure at the MSC , SGSN or |** Return error to be included in | | IP-SM-GW**| the MAP‑proc** | +----------------------------------+----------------------------------+ | RP‑ERROR message with error | | | cause: | | +----------------------------------+----------------------------------+ | 22 Memory capacity exceeded | SM_DeliveryFailure with | | | | | | cause | | | \"MemoryCapacityExceeded\"1) | +----------------------------------+----------------------------------+ | Other error causes | SM_DeliveryFailure with | | | | | | cause | | | \"equipmentProtocolError\"1) | +----------------------------------+----------------------------------+ | CP or lower layer error | SM_DeliveryFailure with | | | | | (e.g. RR, layer 2 failure)2) | cause | | | \"equipmentProtocolError\"1) | +----------------------------------+----------------------------------+ | Mobile has no SM capability | SM_DeliveryFailure with | | | | | | cause | | | \"equipmentNotSM‑Equipped\"1)0 | +----------------------------------+----------------------------------+ | TR1N timeout 2) | SM_DeliveryFailure with | | | | | MNSMS‑error‑ind (No SAPI 3) | cause | | | \"equipmentProtocolError\"1) | +----------------------------------+----------------------------------+ | SIP transport error (e.g. SIP | SM_DeliveryFailure with | | failure response message or | | | transaction timeout) | cause | | | \"equipmentProtocolError\"1) | +----------------------------------+----------------------------------+ | 1) For definition of MAP error | | | SM_DeliveryFailure and its | | | parameter \"cause\" see 3GPP TS | | | 29.002 [15]. | | | | | | 2) The error causes of the | | | RP‑ERROR message, the CP layer | | | and timer TR1N are defined in\ | | | 3GPP TS 24.011 [13]. | | | | | | 3) The failure response codes | | | for the SIP MESSAGE request are | | | defined in IETF RFC 3428 [44], | | | and the failure response codes | | | for SIP transaction timeout in | | | IETF RFC 3261 [43]. | | +----------------------------------+----------------------------------+
## 11.2 Memory available notification
If errors are indicated by the HLR (via the VLR, the IP-SM-GW, or the SGSN)
after invocation of the \"ReadyForSM\" operation, the MSC, the IP-SM-GW, or
the SGSN shall return the appropriate error information to the MS in a failure
report (i.e. a RP‑ERROR message) containing the following error cause:
+----------------------------------+----------------------------------+ | Return error from ReadyForSM | Cause value in the RP‑ERROR | | | message | | (Alert Reason is \"memory | | | available\") | | +----------------------------------+----------------------------------+ | DataMissing | 38 Network out of order | | | | | UnexpectedDataValue | 38 Network out of order | | | | | UnknownSubscriber | 30 Unknown Subscriber | | | | | FacilityNotSupported | 69 Requested facility not | | | implemented | | System Failure | | | | 38 Network out of order | +----------------------------------+----------------------------------+ | Local or lower layer failure | 38 Network out of order | | | | | (e.g. reject condition, timer | | | expired or transaction abort) | | +----------------------------------+----------------------------------+
NOTE: The coding and the use of the RP‑ERROR message is specified in 3GPP TS
24.011 [13].
## 11.3 Mobile Originated short message transfer
If errors are indicated by the VLR after invocation of the
\"sendInfoForMO‑SMS\" operation.(see clause 10), the MSC shall return the
appropriate error information to the MS in a failure report (i.e. a RP‑ERROR
message) containing the following error cause:
* * *
Return error from SendInfoForMO‑SMS Cause value in the RP‑ERROR message
DataMissing 38 Network out of order UnexpectedDataValue 38 Network out of
order TeleserviceNotProvisioned 50 Requested facility not subscribed
[]{.underline}  
CallBarred  
‑ barringServiceActive 10 Call barred ‑ operatorBarring 8 Operator determined
barring
* * *
NOTE: The coding and the use of the RP‑ERROR message is specified in 3GPP TS
24.011 [13]. The operation SendInfoForMO-SMS is not used by the SGSN.
If errors are indicated by the SMS‑IWMSC (negative outcome of the
\"forwardShortMessage),) the MSC, the IP-SM-GW, or the SGSN shall send a
failure report (i.e. a RP‑ERROR message) to the MS, with the error cause coded
as follows:
+----------------------------------+----------------------------------+ | Return error from | Cause value in the RP‑ERROR | | ForwardShortMessage | message | +----------------------------------+----------------------------------+ | System Failure | 38 Network out of order | +----------------------------------+----------------------------------+ | FacilityNotSupported | 69 Requested facility not | | | implemented | +----------------------------------+----------------------------------+ | []{.underline} | | +----------------------------------+----------------------------------+ | UnexpectedDataValue | 38 Network out of order | +----------------------------------+----------------------------------+ | []{.underline} | | +----------------------------------+----------------------------------+ | SM‑DeliveryFailure | 1 Unassigned number | | | | | cause: unknownSC | | +----------------------------------+----------------------------------+ | []{.underline} | | +----------------------------------+----------------------------------+ | SM‑DeliveryFailure | 42 Congestion | | | | | cause: SC‑Congestion | | +----------------------------------+----------------------------------+ | []{.underline} | | +----------------------------------+----------------------------------+ | SM‑DeliveryFailure | 21 Short message transfer | | | rejected | | cause: invalidSME‑Addr (NOTE 1) | | +----------------------------------+----------------------------------+ | []{.underline} | | +----------------------------------+----------------------------------+ | SM‑DeliveryFailure | 28 Unidentified subscriber | | | | | cause: | | | subscriberNotSC‑Subscriber | | +----------------------------------+----------------------------------+ | Local or lower layer failure | 38 Network out of order | | | | | (e.g. reject condition, | | | | | | timer expired or transaction | | | abort) | | +----------------------------------+----------------------------------+ | NOTE 1: This cause includes the | | | case when the outcome of | | | optional HLR interrogation is | | | unacceptable (see clause 8.2.2) | | +----------------------------------+----------------------------------+
NOTE: The coding and the use of the RP‑ERROR message is specified in 3GPP TS
24.011 [13].
###### ## Annex A (informative): Protocol stacks for interconnecting SCs and
MSCs
No mandatory protocol between the Service Centre (SC) and the Mobile Switching
Centre (MSC) below the transfer layer is specified by GSM/UMTS specifications;
this is a matter of agreement between SC and PLMN operators. However, SC and
PLMN operators can base these protocols on the following principles:
a) provide the service defined for SM‑RL (see subclause 9.3);
b) be based on widely accepted telecommunications protocols in the public
domain;
c) permit open interconnection.
###### ## Annex B (informative): Information now contained in 3GPP TS 23.038
[9]
Annex B held information that is now contained in 3GPP TS 23.038 [9].
###### ## Annex C (informative): Short message information flow
The diagrams in this annex describe the flow of primitives and parameters
during the short message transfer. These diagrams refer to specifications 3GPP
TS 23.040, 3GPP TS 24.011 [13] and 3GPP TS 29.002 [15]. The parameters in
dotted lines are optional. The abbreviations used in diagrams are listed
below. The relevant specifications are given in parentheses. (*) stands for a
common GSM/UMTS abbreviations and (‑) for a general abbreviation.
CM Call Management (*)
CS CauSe (‑)
DA Destination Address (‑)
DCS Data Coding Scheme (3GPP TS 23.040)
DI Dialogue Identifier TCAP
GMSCA Gateway MSC Address
GPRS General Packet Radio Services 3GPP TS 23.060 [27])
HLR Home Location Register (*)
IMSI International Mobile Subscriber Identity (*)
MAL MSIsdn‑Alert (3GPP TS 23.040)
MMS More Messages to Send (3GPP TS 23.040)
MR Message Reference (3GPP TS 23.040)
MS Mobile Station (*)
MSC Mobile services Switching Centre (*)
MSCA MSC Address
MSI Mobile waiting Set Indication (3GPP TS 23.040)
MSIsdn Mobile Station ISDN number (*)
MSM More Short Messages (3GPP TS 29.002 [15])
MSRN Mobile Station Roaming Number (*)
MT Message Type (3GPP TS 24.011[13])
MTI Message Type Indicator (3GPP TS 24.011[13])
MWS Message Waiting Set (3GPP TS 23.040)
OA Originating Address (‑)
OC Operation Code (3GPP TS 29.002 [15])
PCI Protocol Control Information (‑)
PDI Protocol DIscriminator (*)
PRI PRIority (3GPP TS 23.040)
RCT ReCeption Time (3GPP TS 23.040)
REA REcipient Address (3GPP TS 23.040)
RL ReLay function (3GPP TS 24.011[13])
RP Reply Path (3GPP TS 23.040)
SC Service Centre (3GPP TS 23.040)
SCA Service Centre Address (3GPP TS 23.040)
SCTS Service Centre Time Stamp (3GPP TS 23.040)
SGSN Serving GPRS Support Node (3GPP TS 23.060 [27]
SM Short Message (3GPP TS 23.040)
SM‑AL Short Message Application Layer (3GPP TS 23.040)
SME Short Message Entity (3GPP TS 23.040)
SMI Short Message Identifier (3GPP TS 23.040)
SM‑RL Short Message Relay Layer (3GPP TS 23.040, 24.011[13])
SMS‑GMSC Short Message Service Gateway MSC (3GPP TS 23.040)
SMS‑IWMSC Short Message Service Interworking MSC (3GPP TS 23.040)
SoR Status of Report (3GPP TS 23.040)
SM‑TL Short Message Transfer Layer (3GPP TS 23.040)
SRI Status Report Indication (3GPP TS 23.040)
SRR Status Report Request (3GPP TS 23.040)
TCAP Transaction Capabilities Application Part (‑)
TID Transaction Identifier (*)
UD User Data (‑)
UDL User Data Length (3GPP TS 23.040)
VLR Visitor Location Register (*)
VP Validity Period (3GPP TS 23.040)
VPF Validity Period Format (3GPP TS 23.040)
NOTE: SMI is not carried via SM-RL of clause 9.3.5 but is carried via the
relay service between the SC and GMSC (see clause 9.3.4.1).
Figure C.1: Mobile terminated short message
NOTE: A sequence of short messages shall have MMS set to 1 in each RP-MT-DATA
except the last (last shall have MMS set to 0). Each RP-MT-DATA shall be
carried via FORWARD SHORT MESSAGE via TCAP and shall be assigned the same
Dialogue Identifier as previous RP-MT-DATAS in the sequence.
Figure C.2: Mobile terminated short message
NOTE: MR is of local significance to the MSC/MS interface and is not the value
supplied to the MSC.
Figure C.3: Mobile terminated short message
Figure C.4: Mobile terminated short message
Figure C.5: Acknowledgement in the MT case
NOTE: The cause carried via UD of TCAP is not the cause supplied via RP-ERROR
but is the cause resulting from application of the mapping specified by table
8.5 of 24.011[13].
Figure C.6: Acknowledgement in the MT case
NOTE 1: The MAP operation \"SetMessageWaitingData\" is invoked only if a cause
\"Absent Subscriber\" is carried in TCAP UD.
NOTE 2: The cause delivered to the SC is not necessarily the cause carried via
TCAP but is one of the set specified by table 03.40/1.
Figure C.7: Acknowledgement in the MT case
Figure C.8: Acknowledgement in the MT case
NOTE: The mapping of SMI to MR by the MS is a local matter.
Figure C.9: Mobile originated short message
Figure C.10: Mobile originated short message
NOTE: MR is of local significance to the IWMSC/SC interface and is not the
value supplied by the MS via the MS/MSC interface.
Figure C.11: Mobile originated short message
Figure C.12: Mobile originated short message
Figure C.13: Acknowledgement in the MO case
Figure C.14: Acknowledgement in the MO case
Figure C.15: Acknowledgement in the MO case
Figure C.16: Acknowledgement in the MO case
###### ## Annex D (informative): Mobile Station reply procedures
# D.1 Introduction
The reply procedures specified in this annex should be followed by a mobile
station when replying to a short message, i.e. when generating a MO SM in
response to a received MT SM, addressed to the originator of that MT SM. The
main purpose of this annex is to specify how the MS selects the service centre
for delivering that MO SM: an arbitrary SME may only be reached by submitting
the reply SM to a specific SC, known to be able of delivering to that SME.
# D.2 The scope of applicability
The reply procedures in clauses 5 and 6 of this annex should be followed by
every MS which fulfils the following criteria:
1) The MS automatically selects the value for the RP‑Destination‑Address
parameter in RP‑MO‑DATA, or the MS has the SC address within the SM‑RL entity.
(That is to say: the human user is not obliged to manually key in the SC
address for every MO short message).
2) The MS or an application within it supports some form of replying to a MT
SM with a MO SM. (That is to say: in the process of generating the reply MO
SM, any reference whatsoever, implicit or explicit, is made to the original MT
SM).
3) The replying support of (2) is to be equally available towards every SME.
When an SME submits an SM to an SC for delivery, it may request that the SC
sets the TP‑Reply‑Path parameter in the SM to be delivered. If the submitting
SME is an MS, the reply path requesting procedure; in clause 4 of this annex
may be applied. However, an SC may support the reply procedures without
supporting the reply path requesting procedure; in that case, the SC sets the
TP‑Reply‑Path parameter on another basis, which must be the case if the SM
originates from an SME which is not an MS.
# D.3 Terminology
An originating SME submits an original SM to an original SC, which delivers
the original MT SM to a replying MS. The replying MS sends back a reply MO SM,
a MO SM which is generated (automatically or by human operations) in response
to the original MT SM, and which is addressed to the originating SME.
If the originating SME is an MS, the original MT SM is submitted within an
SMS‑SUBMIT PDU; we say that reply path is requested if the TP‑Reply‑Path
parameter is set in the SMS‑SUBMIT PDU of the original MT SM.
We say that reply path exists if the TP‑Reply‑Path parameter was set in the
SMS‑DELIVER PDU of the original MT SM; we say that reply path does not exist
otherwise.
The replying MS may have a default SC which is normally used for delivering
all the MO short messages originated from the replying MS. Alternatively, a
human user or automatic application may specify a selected SC for delivering a
particular SM (thus the term selected SC refers to an SC address selected for
one short message only).
# D.4 The reply path requesting procedure
The discussion in this clause applies to cases when the originating SME is a
mobile station only. The reply procedures discussed in the clauses to follow
this one are independent of the type of the originating SME.
The reply path is requested by the originating SME (an MS) by setting the
TP‑Reply‑Path parameter in the SMS SUBMIT PDU of the original SM. If the
original SC supports reply path requesting for the originating SME (an MS), it
shall take notice of the TP‑Reply‑Path parameter in the SMS‑SUBMIT PDU and set
the TP‑Reply‑Path parameter in the SMS‑DELIVER PDU of the original MT SM
towards the replying MS. Hence, reply path exists for the replying MS towards
the originating SME (an MS).
# D.5 The reception of an original MT SM
When a replying MS receives an original MT SM, it then has:
1) originating SME = TP‑Originating‑Address in the SMS‑DELIVER PDU,
2) original SC = RP‑Originating‑Address in RPS‑MT‑DATA, and
3) reply path exists/reply path does not exist = TP‑Reply‑Path in SMS‑DELIVER
PDU (set/not set).
# D.6 The submission of the reply MO SM
According to clause 5, the replying MS knows if:
a) reply path exists; or
b) reply path does not exist.
We then specify that when submitting the reply MO SM, the replying MS should
use parameters as follows:
1) TP‑Destination‑Address in SMS‑SUBMIT PDU = originating SME,
2a) If reply path exists:
RP‑Destination‑Address in RP‑MO‑DATA = original SC,
2b) If reply path does not exist:
RP‑Destination‑Address in RS‑MO‑DATA = selected SC or default SC or original
SC,
3a) If reply path exists:
after submitting one reply MO SM, the reply path does not exist any more.
In case (2b), it is allowed to use the original SC or the default SC, but then
there is no guarantee that the original/default SC shall deliver the reply MO
SM. (The original SC may refuse to deliver, if the replying MS is not its
subscriber; the default SC may be unable to deliver, if it has no access path
to the originating SME.)
Requirement (3a) states that the case (a), reply path exists, holds for one
reply MO SM only (per original MT SM).
# D.7 Usage of SCs for replying
The specification in this annex supports the following way of replying.
The original MT SM and the reply MO SM are delivered by the same SC, the
original SC. This principle maximizes the probability that the SC can e.g.
route the reply MO SM to the proper data network for reaching the originating
SME; this principle is a must, if the originating SME is integrated within the
original SC.
If the original SC by any means whatsoever knows that it is both willing and
able to deliver one (potential) reply MO SM, it may indicate this fact by
setting the TP‑Reply‑Path parameter in the original MT SM. The original SC
thus commits itself to delivering one reply MO SM; let us call this reply
delivery commitment.
One reason for the SC to make the reply delivery commitment may be the reply
path requesting procedure specified in clause 4 on this annex.
The reply path commitment is not valid forever, but the original SC may have
e.g. a time limit for maintaining this commitment.
# D.8 Replying possibilities for Phase 1 mobile stations
The Phase 2 mobile stations should support the procedures in this annex (if
they fulfil the criteria in clause 2 of it). Yet, Phase 1 mobile stations,
too, may apply steps (1) and (2a) in clause 6 of this annex, i.e. reply via
the original SC, automatically or manually (by choosing selected SC = original
SC), despite the fact that the TP‑Reply‑Path parameter shall be ignored by
them. The delivery of the reply MO SM cannot be guarantied in this case, yet
the possibility of delivery may be improved (especially if the originating SME
is not an MS).
# D.9 The resulting service for originating SMEs
As the consequence of the replying procedures specified in this annex, all
SMEs and applications within them may assume that replying from all mobile
stations is always possible, provided that the mobile stations do support the
proper replying mechanism itself (human response in context with the original
MT SM, automatic replying by an application, application level protocols,
etc.).
###### ## Annex E (normative): Extended Object Format Type
# E.1 Predefined Sound
The predefined sound as integrated in the Extended Object IE is structured as
follows:
Octet 8 Sound number as defined in table of subclause 9.2.3.24.10.3.1.
# E.2 iMelody
An iMelody object [33] can be integrated in an Extended Object IE with the
following structure:
Octet 8..n iMelody object coded according to the iMelody format [33].
# E.3 Black and white bitmap
The user-defined black and white bitmap as integrated in the Extended Object
IE is structured as follows:
Octet 8 Horizontal dimension of picture.\ This octet shall contain the
horizontal number of pixels
Octet 9 Vertical dimension of picture.\ This octet shall contain the vertical
number of pixels.
Octet 10..n Picture data, pixel by pixel from top left to bottom right. The
picture data is encoded as a continuous sequence of bits. There shall be no
fill bits at the end of each row of data, Fill bits may only be used in the
last octet of the picture data if needed. The fill bits in the last octet
shall be ignored. Within each octet the MSB represents the leftmost pixel.
> The colour values are encoded as follows:
>
> Bit Value Colour\ 0 White\ 1 Black
# E.4 2-bit greyscale bitmap
The user-defined 2-bit greyscale bitmap as integrated in the Extended Object
IE is structured as follows:
Octet 8 Horizontal dimension of picture.\ This octet shall contain the
horizontal number of pixels
Octet 9 Vertical dimension of picture.\ This octet shall contain the vertical
number of pixels.
Octet 10..n Picture data, pixel by pixel from top left to bottom right. The
picture data is encoded as a continuous sequence of bits. There shall be no
fill bits at the end of each row of data, Fill bits may only be used in the
last octet of the picture data. The fill bits in the last octet shall be
ignored.The pair of bits at the MSB represents the leftmost pixel of the four
defined in an octet.
> The colour values are encoded as follows:
>
> Bit Value Colour\ 00 Black\ 01 Dark Grey\ 10 Light Grey\ 11 White
# E.5 6-bit colour bitmap
The user-defined 6-bit colour bitmap as integrated in the Extended Object IE
is structured as follows:
Octet 8 Horizontal dimension of picture.\ This octet shall contain the
horizontal number of pixels
Octet 9 Vertical dimension of picture.\ This octet shall contain the vertical
number of pixels.
Octet 10..n.
> Picture data, pixel by pixel from top left to bottom right. The picture data
> is encoded as a continuous sequence of bits. There shall be no fill bits at
> the end of each row of data, Fill bits may only be used in the last octet of
> the picture data. The fill bits in the last octet shall be ignored.
>
> Each pixel colour is represented by 6-bits of data, giving a total of 64
> colours. (2 bits of data define the levels of each red, green and blue). The
> overall pixel colour is a composite of the three RGB values.
>
> The first pair of bits of picture data define the level of red of the
> topmost, leftmost pixel, the next pair of bits the level of green for this
> pixel, and the third pair the level of blue for the pixel. The first bit of
> a pair defining a colour level is the MSB. This is illustrated below.
+---------+----------+-----------+-----------+-----------+-----------+----------+---------+ | Octet 1 | | | | | | | | +---------+----------+-----------+-----------+-----------+-----------+----------+---------+ | Bit 7 | Bit 6 | Bit 5 | Bit 4 | Bit 3 | Bit 2 | Bit 1 | Bit 0 | +---------+----------+-----------+-----------+-----------+-----------+----------+---------+ | MSB Red | LSB Red\ | MSB Green | LSB Green | MSB Blue\ | LSB Blue\ | MSB Red\ | LSB Red | | | Pixel 1 | | | Pixel 1 | Pixel 1 | Pixel 2 | | | Pixel 1 | | Pixel 1 | Pixel 1 | | | | Pixel 2 | +---------+----------+-----------+-----------+-----------+-----------+----------+---------+
+-----------+-----------+-----------+-----------+----------+---------+-----------+-----------+ | Octet 2 | | | | | | | | +-----------+-----------+-----------+-----------+----------+---------+-----------+-----------+ | Bit 7 | Bit 6 | Bit 5 | Bit 4 | Bit 3 | Bit 2 | Bit 1 | Bit 0 | +-----------+-----------+-----------+-----------+----------+---------+-----------+-----------+ | MSB Green | LSB Green | MSB Blue\ | LSB Blue\ | MSB Red\ | LSB Red | MSB Green | LSB Green | | | | Pixel 2 | Pixel 2 | Pixel 3 | | | | | Pixel 2 | Pixel 2 | | | | Pixel 3 | Pixel 3 | Pixel 3 | +-----------+-----------+-----------+-----------+----------+---------+-----------+-----------+
# E.6 Predefined animation
The predefined animation as integrated in the Extended Object IE is structured
as follows:
Octet 8 Animation number as defined in table of subclause 9.2.3.24.10.3.3.
# E.7 Black and white bitmap animation
The user-black and white animation is integrated in the Extended Object IE is
structured as follows:
Octet 8 Horizontal dimension of picture.\ This octet shall contain the
horizontal number of pixels.
Octet 9 Vertical dimension of picture.\ This octet shall contain the vertical
number of pixels.
Octet 10 The number of frames in the animation.
Octet 11 Animation control byte.
* * *
Bits Meaning 7 -- 4 Frame display. The value (in tenths of a second) that is
requested between each frame: 0000 1 tenth (i.e. 0.1s) 1111 16 tenths (i.e.
1.6 s) 3 -- 0 Repeat value. The requested number of repetitions of the
animation: 0000 Unlimited repetition 0001 1 repetition 1111 15 repetitions
* * *
Octet 12..n Contains a series of bitstreams encoding 1 bit pixel depth bitmaps
as defined in F.3. If a frame in the animation would require fill bits (as
described in F.3) these shall be contained at the end of the frame such that
the bit-stream for the next frame begins on an octet boundary.
# E.8 2-bit greyscale bitmap animation
The user-black and white animation is integrated in the Extended Object IE is
structured as follows:
Octet 8 Horizontal dimension of picture.\ This octet shall contain the
horizontal number of pixels.
Octet 9 Vertical dimension of picture.\ This octet shall contain the vertical
number of pixels.
Octet 10 The number of frames in the animation.
Octet 11 Animation control byte.
* * *
Bits Meaning 7 -- 4 Frame display. The value (in tenths of a second) that is
requested between each frame: 0000 1 tenth (i.e. 0.1s) 1111 16 tenths (i.e.
1.6 s) 3 -- 0 Repeat value. The requested number of repetitions of the
animation: 0000 Unlimited repetition 0001 1 repetition 1111 15 repetitions
* * *
Octet 12..n Contains a series of bitstreams encoding 2 bit pixel depth bitmaps
as defined in F.4. If a frame in the animation would require fill bits (as
described in F.4) these shall be contained at the end of the frame such that
the bit-stream for the next frame begins on an octet boundary.
# E.9 6-bit colour bitmap animation
The user-black and white animation is integrated in the Extended Object IE is
structured as follows:
Octet 8 Horizontal dimension of picture.\ This octet shall contain the
horizontal number of pixels.
Octet 9 Vertical dimension of picture.\ This octet shall contain the vertical
number of pixels.
Octet 10 The number of frames in the animation.
Octet 11 Animation control byte.
* * *
Bits Meaning 7 -- 4 Frame display. The value (in tenths of a second) that is
requested between each frame: 0000 1 tenth (i.e. 0.1s) 1111 16 tenths (i.e.
1.6 s) 3 -- 0 Repeat value. The requested number of repetitions of the
animation: 0000 Unlimited repetition 0001 1 repetition 1111 15 repetitions
* * *
Octet 12.n Contains a series of bitstreams encoding 6 bit pixel depth bitmaps
as defined in F.5. If a frame in the animation would require fill bits (as
described in F.5) these shall be contained at the end of the frame such that
the bit-stream for the next frame begins on an octet boundary.
# E.10 vCard
A vCard object [36] can be integrated in a Extended Object IE with the
following structure:
Octet 8.n vCard object as defined in [36]. The UTF-8 encoding is used instead
of the default 7-bit ASCII. For certain vCard properties, other encoding can
be used by setting the CHARSET property parameter to the appropriate character
set.
# E.11 vCalendar
A vCalendar object [37] can be integrated in a Extended Object IE with the
following structure:
Octet 8..n vCalendar object as defined in [37]. The UTF-8 encoding is used
instead of the default 7-bit ASCII. For certain vCalendar properties, other
encoding can be used by setting the CHARSET property parameter to the
appropriate character set.
# E.12 Data Format Delivery Request
This Data Format Delivery Request is an optional feature used by an SME to
indicate which Extended Object data formats, listed in subclause
9.2.3.24.10.1.11, it is requesting for delivery. This Data Format Delivery
Request may be included by an SME in a MO SM containing other EMS related
data, or in a MO SM independently. Processing of this data format is optional
in a MT short message.
The information in this data format represents an extensible bit field with
the first bit being mapped to the first Extended Object (EO) data format
defined in the table in subclause 9.2.3.24.10.1.11.
Octet 8
> Bit 0: If set to 1 indicates support for EO data format 00
>
> Bit 1: If set to 1 indicates support for EO data format 01
>
> Bit 2: If set to 1 indicates support for EO data format 02
>
> ......
>
> ......
Octet n
Bit 0: If set indicates support for EO data format ((n -- 8) * 8)
> Bit 1: If set indicates support for EO data format ((n -- 8) * 8) + 1
>
> Bit 2: If set indicates support for EO data format ((n -- 8) * 8) + 2
.......
Any unused bits in the last octet shall be set to zero.
# E.13 Standard WVG Object
The Standard WVG object as defined by Format Type 0x0B in the Extended Object
IE is as follows.
Octet 8..n Standard WVG object bit stream
The unused bits in the last octet will be filled with 0
The detailed data format and attributes of Standard WVG object are defined in
Annex G.
The bit order is defined as follows:
The octet with a smaller octet number stores the bits appearing in the front
position in the bit stream; the most significant bit in an octet stores the
first bit in position in a 8-bit segment in the bit stream.
A Standard WVG object may or may not have fixed size. In either case, display
size should be determined by the terminal implementation. Recommended display
size is a largest possible size on terminal screen while aspect ratio shall be
maintained.
# E.14 Polyphonic melody
A Polyphonic melody can be integrated as an extended object in one or more
short messages. Informative guidelines for the creation of polyphony content
using SP-MIDI [38] are listed in Annex H.
However, in order to guarantee the interoperability with legacy mobile devices
which are not able to interpret specific SP-MIDI content, the following
considerations shall be taken into account for content creation:
  * When content is not provided in SP-MIDI format the presence of the MIP table in polyphonic extended objects is not mandatory. Since a receiving SME supporting polyphonic extended objects may decide to ignore and skip the content of a MIP message by implementing its own note stealing or channel masking strategy when played. However, when SP-MIDI format data is present and the message is stored and subject to potential forwarding, the specific SP-MIDI content shall be kept as received by the SME.
  * the additional rhythm channel as specified in subclause 3.2 in [38] might not be supported by the receiving SME.
Octet 8..n SMF as defined in [38], [40]
###### ## Annex F (informative) : Compression methods for EMS
# F.1 LZSS compression
## F.1.1 Introduction
The LZSS compression algorithm is one of a number of compression algorithms
generally referred to as "Dictionary Methods". These algorithms rely upon the
fact that (in general) an input data buffer will contain repeating "patterns"
or matching sequences of bytes.
The algorithms fall into 2 groups. Systems like LZ78 and LZW scan an input
buffer and construct a "dictionary" of the most commonly occurring byte
sequences or "phrases". This dictionary is pre-pended with the compressed data
and the compressed data comprises an array of indices into the dictionary.
A second set is a modification of this in that the data dictionary is implicit
in the uncompressed data buffer. All are based upon an algorithm developed and
published in 1977 by Abraham Lempel and Jakob Ziv LZ77. A refinement of this
algorithm, which is the basis for practically all the later methods in this
group, is the LZSS algorithm developed in 1982 by Storer and Szymanski. These
methods try to find if the character sequence currently being compressed has
already occurred earlier in the input data and then, instead of repeating it,
output only a pointer to the earlier occurrence. This is illustrated in the
following diagram:
Figure F.1 Illustration of "Implicit Dictionary" compression methods
## F.1.2 LZSS Basic Algorithm
The algorithm searches the window (a buffer moving back from the current
position in the input data). It searches for the longest match with the
beginning of the look-ahead buffer (a buffer moving forward from the current
position in the input data) and outputs a pointer to that match. This pointer
indicates a position and length of that data match. It is referred to here as
a "Slice Descriptor".
Since it is possible that not even a one-character match can be found, the
output cannot contain just pointers. Accordingly at times it is necessary to
write literal octets into the output buffer. A block of literal octets is
preceded by a "Literal Block Identifier" which indicates the length of the
literal octet sequence that follows.
## F 1.3 Informative Example.
**The following is provided as an informative example using the input buffer
shown below.**
* * *
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 0x01 0x02 0x03 0x01 0x02 0x03 0x04 0x01
0x02 0x03 0x01 0x02 0x03 0x01 0x02 0x03
* * *
Figure F.2 Sample input buffer (16 octets long)
**Step 1:**
Starting position is byte 1 in the input buffer. For octets 1 to 3 there are
no octet matches in the window for the look-ahead buffer. So write a literal
octet sequence of 3 octets following a literal block header.
* * *
1 2 3 4 0x83 0x01 0x02 0x03
* * *
Figure F.3 Output buffer after initial literal block is written
**Step 2:**
Current position is octet 4. Examining the look-ahead buffer and the window a
3 octet match is found beginning 3 octets before (octet 1) and of 3 octets in
length. A 2 octet slice descriptor is added to the output buffer. The current
position moves to octet 7 of the input buffer.
* * *
1 2 3 4 5 6 0x83 0x01 0x02 0x03 0x06 0x03
* * *
Figure F.4 Output buffer after the first slice descriptor is written
**Step 3:**
Current position is octet 7 in the input buffer (0x04). There are no matches
in the window for this value so a 2 octet literal sequence is written to the
end of the output buffer. The current position moves to octet 8 of the input
buffer.
* * *
1 2 3 4 5 6 7 8 0x83 0x01 0x02 0x03 0x06 0x03 0x81 0x04
* * *
Figure F.5 Second literal block is written into output buffer
**Step 4:**
Current position is octet 8 of the input buffer. Comparing the window with the
look-ahead buffer reveals a octet match from the current position with octets
1 to 6 of the input buffer. That is a 6 octet sequence beginning 7 octets back
from the current position.. A two-octet slice descriptor for this match is
added to the output buffer. The current position moves to octet 14 of the
input buffer (6 octets further on).
* * *
1 2 3 4 5 6 7 8 9 10 0x83 0x01 0x02 0x03 0x06 0x03 0x81 0x04 0x0C 0x07
* * *
Figure F.6 Octet match slice descriptor is written into output buffer
**Step 5:**
Current position is octet 14 of the input buffer. Comparing the window with
the look-ahead buffer reveals another 3 octet sequence match (0x01, 0x02,
0x03). This octet sequence occurs several times in the window within the 511
octets that the slice descriptor allows. Therefore several different (but
valid) slice descriptors could be written (this would be implementation
dependent). However in this example we will reference the initial 3 octets of
the input buffer and write a slice descriptor indicating a 3 octet match
beginning 13 octets behind the current position.
* * *
1 2 3 4 5 6 7 8 9 10 11 12 0x83 0x01 0x02 0x03 0x06 0x03 0x81 0x04 0x0C 0x07
0x06 0x0D
* * *
Figure F.7 Octet match slice descriptor is written into output buffer: the
final output buffer
###### ## Annex G (normative): WVG (Wireless Vector Graphics) data format
WVG (Wireless Vector Graphics) is a compact binary data format for vector
graphics. WVG data is represented by a bit stream, composed of a header, codec
parameters and graphical elements. The bit representation of the drawing and
contained graphical elements is designed such that the bit stream can be
optimized for smallest possible size.
# G.1 Introduction
## G.1.1 Standard and Character Size WVG elements
A Standard WVG element is defined by the complete WVG specification. Using a
set of the WVG specification with a set of default values, a simplified vector
graphics can be used to represent a simple and small vector graphics or glyph.
Character Size WVG elements can be included in normal text to represent a
handwritten character or symbols that are not supported by character coding
system and the font library.
## G.1.2 Compression methods
A combination of compression methods is used in the WVG to achieve the best
compression ratio for simple vector graphics and animations. They include:
  * **switchable linear or non-linear coordination system** : when graphical elements in a drawing are not evenly distributed, the representation of coordinates can be optimized using a non-linear coordinate system (uneven coordinates)
  * **bit packing** : variable number of bits to represent a number. The number of bits used in WVG can vary from 1 bit to 16 bits.
  * **local envelope** : use a dedicated coordinate system to describe elements in a small area using relatively small coordinate numbers
  * **variable resolution** : in coordinates, sizes, angles, scale and etc, different resolutions can be used for a graphical element to save the number of bits needed for representing a value.
  * **palettes** : color and element ID can be mapped using a palette defined in the drawing header. This also saves the number of bits for representing a color value and an element ID.
  * **default values** : many values can be omitted to use default values. E.g. when no color scheme is defined, the data describes a mono drawing
  * **default animation timing** : in addition to standard time based animation, WVG uses a simplified animation model. In Simple Animation mode, no timing is needed for describing animations. Instead, a cycle is defined to describe the timing for these animations.
## G.1.3 Coordinate Systems
There are two coordinate systems used in WVG, namely Compact Coordinate System
and Flat Coordinate System.
### G.1.3.1 Compact Coordinate System
In compact coordinate system, a drawing area is defined as rectangle area
called envelope. There are two types of envelopes, global envelope and local
envelope. The global envelope is a base area in which the drawing is
contained. There is only one global envelope. A local envelope is a square
area completely or partially within the global envelope. There is no specific
global envelope size specified in the data format. The physical display size
is decided at rendering time.
The aspect ratio and orientation are defined in the data header and should be
maintained when the drawing is displayed.
Aspect ratios include 1:1, 4:3, 16:9 up to 1024: 729 (height:width), in both
portrait and landscape orientation. Aspect ratio for Characters Size WVG
elements only has landscape orientation.
In Compact Coordinate System, coordinates are restricted to certain positions
which are the cross points of a grid. The grid is defined in the WVG data
header, set by a group of parameters. The grid lines along with x axis or y
axis may be unevenly distributed.
The global grid can be described using a curve shown above.
There are one peak and two valleys in the curve. The definition of the curve
is:
\- peak position: the central position of a peak;
\- peak value: a value equal or larger than 1,0;
\- peak width: a value less than 1,0.
All valleys should have the same value.
The total area enclosed by the curve and the x-axis from 0,0 to 1,0 is always
equating to 1,0.
The curve can be uniquely defined by peak position, peak value and peak width.
Once the parameters are determined, other values such as valley value can be
calculated. Once a curve is given, grid line positions can be calculated
according to the following function:
> $\int_{}^{}{d(x)\text{dx}}$= $\frac{k}{n - 1}$
Where X~k~ is the position of the k^th^ grid line, where n is total number of
grid lines. d(x) is the curve function described in the present document.
In standard WVG, the curve parameters are preset as follows.
**Variable parameters:**
\- number of grid lines: 15, 31, 63 or 127;
\- peak value: 1,0, 1,5, 2,0 and 2,5;
\- peak position: 13 options from 0,0 (0/12), 0,083333 (1/12), 0,166667 (2/12)
to 1,0 (12/12);
\- peak width: 0,3, 0,4, 0.5 and 0,6.
When a portion of a peak exceeds the global envelope only the part within the
global envelope is valid.
For Character Size WVG or glyph, the parameters are set as follows.
**Predefined parameters:**
\- peak width: 0,4.
**Variable parameters:**
\- number of grid lines: 7, 15, 31 or 63;
\- peak value: 1,0 or 1,5;
\- peak position: 0,3333 (1/3), 0,5, 0,6667 (2/3).
When using relative coordinates in Compact Coordinate System (refer to clause
G 1.3.3), some elements may be specified with specific resolution, which is
independent of the global resolution. There are 8 predefined resolutions
available for \"re-definition resolution\", there are 1/27, 1/38, 1/48, 1/64,
1/85, 1/128 and 1/160 of the length of the shorter global envelope edge. Re-
definition of resolution only applies to elements in global scope.
### G.1.3.2 Flat Coordinate System
The Flat Coordinate System is a 16 bit signed coordinate system with the top
left coordinate of the screen being defined as (x=0,y=0) and the bottom right
coordinate being described as (x=2\^15, y = 2\^15). Note that this expresses
the dynamic range of the coordinate system, however it does not mean that all
drawings are of this size.
### G.1.3.3 Coordinate values
Coordinate values may be represented using two methods: absolute coordinate
and relative coordinate.
**Absolute Coordinate:** an absolute coordinate is a pair of x and y
coordinate number. In WVG Compact Coordinate System, absolute coordinate
values are the coordinate grid line numbers and are always positive.
**Relative Coordinate:** the relative coordinate is used only in lines and
transform. If the start point is defined by an absolute coordinate, subsequent
points can be described by relative coordinates, which are relative grid units
from the previous point. A relative coordinate is signed, and it may be
positive or negative. A relative coordinate may be used in both global and
local coordinate systems. A relative coordinate may exceed the scope of the
local envelope that defines the start point of the line.
## G.1.4 Color schemes
WVG supports the following color schemes.
  * Black and white (2 Colors): black and white color.
  * 2-bit grayscales: four grayscales are defined as (0,0,0), (85,85,85), (170,170,170) and (255,255,255) in 24-bit RGB color format.
  * 4 default colors.
  * 6-bit RGB color: it is similar to 24-bit RGB color definition but uses only 2 bits to represent a single color, in which value 0, 1, 2 and 3 represent 8-bit color value 0, 85, 170 and 255 respectively.
  * 6-bit RGB color using 2^nd^ palette.
  * 8-bit websafe color.
  * 12-bit and 24-bit RGB color.
There are 2 optional drawing pens in WVG, stroke pen and fill pen. Stroke pen
and fill pen can be specified with one of the colors defined using the scheme.
When the stroke pen is not defined, BLACK should be used for strokes. When the
fill pen is not defined, no fill should be applied.
## G.1.5 Rendering model
WVG uses painter model. The elements appears in the later position in the WVG
bit stream will overrides the overlapped portion of the elements which appear
in the front in the bit stream.
# G.2 Graphical elements
WVG defines a set of graphical and animation elements. Among them, line, shape
and text elements are the building blocks to form a drawing. These elements
can be transformed, grouped and animated. There are also special elements that
are auxiliary.
## G.2.1 Line elements
There are 3 types of lines: polyline, circular polyline and bezier polyline. A
polyline can represent a dot when there is only a start point defined.
A line element has its reference point at the starting point. A reference
point of an element specifies the location of the element.
### G.2.1.1 Polyline
Polyline is a set of straight lines connecting a sequence of points. When
there is only one point, it is defined as a dot.
### G.2.1.2 Circular Polyline
Circular Polyline is a line that contains at least one circular curve segment.
The curve segment connects two adjacent points by a circular arc. The curve
segment is determined by the two adjacent points and a curve offset (the
perpendicular distance from the center of the line connecting the adjacent
points to the circular arc).
Curve offset values are within the range -- 0,5 to 0,5, inclusive. A value of
0,5 or -- 0,5 identifies that the curve offset equals half of length of the
connecting line. The value indicates that the curve is close to a half circle.
A positive value indicates that the curve is at the left side of the base line
viewed from the curve direction. A negative value indicates that the curve is
at the right side of the base line viewed from the curve direction.
### G.2.1.3 Bezier Polyline
A Bezier Polyline contains one or more off curve control points in between on
curve points. Bezier curves can be filled to create curved shapes and are
common in generalized font representations.
All line elements have direction from the start point to the end point.
Color fill may apply to a line. Refer to clause G.2.1.4.
### G.2.1.4 Auto-closure of a line
When a line is specified with the fill attribute, the line is considered as a
closed line, which connects the start point and the end point using a straight
line. The enclosed area of a closed line can be used for color fill.
The enclosed area is based on nonzero fill rule. Following are two examples in
which the light color indicates the enclosed area.
## G.2.2 Polygon elements
Polygon elements are closed representations of polyline, circular polyline and
Bezier polyline elements. Polygons may have separate line and fill colors or
may not be filled at all.
Polygon elements use the nonzero fill rule for enclosed areas and can be used
for color file.
A polygon element has its reference point at the starting point.
## G.2.3 Simple shape elements
Simple Shapes are rectangles and ellipses. A simple shape is defined by width,
height, center point, and angle of rotation. The angle parameter defines how
much the shape should be rotated about its center from a horizontal axis drawn
through its center. Note that angle units are specified in the main header.
### G.2.3.1 Ellipse
Ellipses are defined by their major axis, minor axis, center and angle of
rotation. Circles are considered a special case of ellipse in which the major
and minor axis are the same length.
### G.2.3.2 Rectangle
Rectangles are represented by their center, width, height, and rotation angle.
Squares are considered special rectangles in which the width and height are
identical.
When the \"round corner\" indicator is set, the corner of the rectangle should
be rounded. There is no specific radius of the round corner is defined. The
recommended radius of the rounded corner should be 20% of the length of the
shorter edge of the rectangle or the square.
{width="1.5618055555555554in" height="1.0625in"}
A simple shape element has its reference point at its center.
## G.2.4 Special shape elements
There are 3 types of special shapes. These shapes are Regular Polygons, Stars,
and Grids. Each shape has a reference point that determines its position for
the purpose of transformations such as detailed in G2,8,1 and G,4. Shapes may
have other parameters. These shapes include:
  * **Regular polygon:** a regular polygon has equal length of all its edges. In its original position, the bottom edge of the regular polygon should be aligned horizontally. A rotate angle can be optionally specified. Regular polygon parameters include the number of vertex, the diameter of the reference circle and angle of rotation.
  * **Star:** a star is defined by the number of corner vertex, the diameter of the reference circle, vertex angle and angle of rotation. In its original position, the bottom edge, which formed by two vertexes of the star, should be aligned horizontally. A rotate angle can be optionally specified. Vertex angles are predefined as 0, 36, 60, 90 degrees.
If the vertex angle is 0, a single line from center to vertex shall be drawn.
  * **Grid:** a grid is a number of evenly distributed perpendicular lines. Its parameters include height, width, angle and number of rows and columns (up to 16).
A special shape element has its reference point at its center.
## G.2.5 Text element
WVG supports text display inside the drawing. However it supports only the
default font. To avoid inconsistency on different terminals, it is recommended
to use vector based font. Text can be placed in a drawing with position, font
size and rotate angle. Like other elements, text has attributes of line style,
line color, line width. It can also be animated.
Control characters are ignored when the text is rendered except for the CR
(Carriage Return). The CR indicates the text followed by should be displayed
at the next line position. Multi-line text should be left aligned. There is no
character spacing and line spacing defined. Recommended character spacing is
10% of the text height. Recommended line spacing is 20% of the text height.
A text element has its reference point at top-left corner.
## G.2.6 Group elements
A set of elements can be grouped together.
The Group element is used to mark the start and end of grouped elements. A
group of elements starts with a _Group_ element which has the end-group
indicator off, followed by a list of elements in the group, and ends with an
Group element which has the end-group indicator on. Groups can be nested.
Implementation must support at least 2 levels of nested group.
[Group (start)]{.underline}
Element 1
Element 2
......
[Group (start)]{.underline}
Element a
Element b
> ......
[Group (end)]{.underline}
Element n
Element n+1
.....
[Group (end)]{.underline}
[]{.underline}
## G.2.7 Reuse element
Reuse element can be used to display an element or a group of elements with a
transform and/or changed attributes and/or display an array. Whether a reuse
element references a group or a basic element depends on the element type that
the element_index in the reuse element points to. When reuse array is
specified, the referenced element or group of elements is duplicated in rows
and columns. The reference point of a reused array is at the reference point
of the top-left element in the array.
## G.2.8 Animation elements
There are two types of animation elements, Simple Animation Element and
Standard Animation Element. In the data format, a simple animation element is
followed by another element or a group element that the animation applies to.
A standard animation element has pointer or index that points to another
element or a group element.
### G.2.8.1 Simple animation elements
Simple animation is defined for WVG. All animation timing is based on an
\"Animation Cycle\". WVG animation is repetitive. After completion of playing
one cycle, a subsequent cycle play commences immediately.
There are two types of animation cycles defined, short cycle and long cycle.
The time length of animation cycles are not defined. The time length of a long
cycle should be twice the length of a short cycle. Recommended short cycle
should collapses for 1 second and long cycle pay for 2 seconds.
There are two types of animations.
**Visibility** : an element can be visible or invisible during a specific
cycle segments. A short cycle is divided into 4 time segments equally and a
long cycle is divided into 8 time segments equally.
In the following example, a visibility for short cycle animation is defined.
The element to be animated will blink following the pattern defined in the
Visibility field below. Bit 1 indicates the element should be displayed during
the time segment. Bit 0 indicates it should not be displayed during the time
segment.
* * *
0 1 0 1
* * *
In the following example, a visibility for long cycle animation is defined.
The element to be animated will blink following the pattern defined in the
visibility field below.
* * *
1 0 1 0 1 1 1 1
* * *
**Round Rotation:** an element can be rotated at clockwise or counter-
clockwise directions.
**Transform** : a start and an end transform can be applied to an element to
describe the start and end position of a rotate, a scale, a translate
animation or any combination of these action. When a transform element is
omitted, it defaults to use the element\'s original position. An animation
element must include at least one transform element. The animated element can
also be a group to allow the animation action applied to a group of elements.
In simple animation, a transform from start position to end position should be
completed in one cycle. A bounced flag can be turned on to allow \"bouncing\"
animation. A bounced transform transforms the element from start position to
end position in one cycle.
Transform in a short cycle:
\-- \--
start status end status
Bounced Transform in a short cycle:
* * *
* * *
start end start
status status status
Transform in a long cycle:
\-- \--
start status end status
Bounced Transform in a long cycle:
* * *
* * *
start end start
status status status
Visibility and transform animation can be applied to the same element.
### G.2.8.2 Standard Animation Element
A Standard Animation Element contains animation information such as begin
transform position, end transform position, begin color, end color, begin
time, end time, etc. This allows one animation element to represent a series
of related images, which results in significant compression of the data
stream. The WVG player interpolates between the beginning state and end state
to achieve animation.
Animation elements are not allowed inside groups. Animation rotation ranges
from 0 to 360 degrees in both clockwise and counter-clockwise directions.
## G.2.9 Frame Element
Frame Element is as a marker of the start of a new frame. All elements before
a frame element belong to previous frame. The delay between two frames is
defined as an infinite time interval. This means says that once a frame marker
is reached, the elements that have been displayed on the screen at this time
will stay on the screen until the user requests that the next frame should be
displayed. The idea is that one can have multiple \"pages\" of graphics, such
as a multi-page cartoon. The user can then study the first page and when
finish can press a button (or trigger some other event) to see the next page
of the cartoon. The mechanism of the user event is not defined and is left up
to the application developer.
Here are parameters of a frame element:
\- keep last frame contents (or not). Zero means not keeping last frame
contents, otherwise all the contents of previous frame will be kept.
\- fill in a new background color (or not). Zero means no new fill color is
needed for this frame, otherwise a new background color will be used.
\- new background color.
A frame element cannot appear in an element group. Reuse and animation
elements can not apply to a frame element.
## G.2.10 Local Element
This element defines the size and position of a local envelope.
The local envelope is a square area whose top-left corner is defined as the
origin for its x and y-axis. The number of grid lines are pre-defined to 7,
15, 31 and 63. The resolution is constant in a local grid which is pre-defined
at 1/27, 1/32, 1/48, 1/64, 1/85, 1/128, and 1/160 of the local envelope width.
Actual envelope size can be determined by number of grid lines and grid
resolution. The position of the local envelope is determined by the local
envelope origin that falls at a coordinate within the global envelope.
A local element cannot appear in between another local start and local end
element.
## G.2.11 Extended Element
The Extended Element is defined to create objects which are not part of the
base parsing level of defined objects in the present document and as a future
proof method of expansion as defined by 3GPP technical committees. The
extended element is intended for resolving problems in the current release. It
may also be possible to use the extended element for potential enhancements in
future releases. If the decoder encounters an extended element and the
extended element type is unrecognized, it can gracefully skip this element by
seeking past it in the bitstream, and continuing decoding at the next element
in the bitstream.
An extended element contains the size of the extended element, the extended
element type, and a series of bytes representing the payload data. The size
field represents the payload data size in bytes. Note that when reading the
payload data, bit alignment should be assumed (not byte alignment).
# G.3 **Element attributes**
Each element has a number of attributes such as pen color, fill color and line
width used for stroking. The following elements Line, polygon, shape and text
elements have the listed attributes.
  * Line width: 3 levels (fine, medium, thick). Default is fine.
  * Line style: 4 types (solid, dash, dot and reserved). Default is solid.
  * Pencolor and fill color.
Line Width:
There are 4 line width settings defined, namely \"No Line\", \"Fine\",
\"Medium\" and \"Thick\". No specific width is defined for \"Fine\",
\"Medium\" and \"Thick\". Recommended line widths are 1% or one pixel, 2% and
4% of the shorter dimension of the drawing. Line width for \"Fine\",
\"Medium\" and \"Thick\" should be at least 1 pixel. E.g., in a 120 x 80 pixel
screen, the line width may appear as 1 pixel, 2 pixels and 3 pixels.
Line Type:
Dash Line: a dash line should start with a solid segment of the line. The
length of the solid segments is recommended to be 4 to 6 times of the line
width. The space between two solid segments is recommended to be 3-4 times of
the line width.
{width="1.6256944444444446in" height="0.2111111111111111in"}
Dotted Line: a dotted line is a string of circular dot on the path of a line.
It is recommended that the diameter of rounded dot is same as the line width.
The space between two dots shall be between 1 to 2 dot diameters.
{width="1.0298611111111111in" height="0.11388888888888889in"}
Line Cap:
Line cap is Circular.
Line Joint:
Line joint is Round for line joint.
# G.4 Element Transform
The Transform element is used to scale, rotate, or translate any single
element or group of elements. Multiple transforms may be applied in succession
to any element by standard matrix concatenation. The transform element may be
included in Group, Reuse and Animation elements and applied to line, polygon,
shape, text and group elements. The sequence of applying transform operations
is scale->rotate->translate.
# G.5 Character Size WVG Element
The character size WVG, or glyph is a subset variation of WVG. Character Size
WVG uses a compact coordinate system with a half resolution global grid (7,
15, 31 and 63 grid lines), default color (monochrome), line elements
(polyline, circular polyline and Bezier polyline) and a simplified drawing
header.
# G.6 Data Format BNF
The following notation is used in the present document for BNF syntax:
* * *
\ Enclose term names \| Separates alternatives (exclusive OR) [ ] Square
brackets enclose optional items in syntax descriptions. { } {} Term enclosed
is used zero or more times () () Enclose groups of alternative terms ... From
... to ; Start with comments 0 Bit value 0 in bit stream 1 Bit value 1 in bit
stream ' ' Terminator described by enclosed text
* * *
Notes for reading the BNF:
NOTE 1: The bit value appearing at the left in the BNF indicates it is
arranged in the front in the bit stream.
NOTE 2: Notation 00...11 is equivalent to ( 00 \| 01 \| 10 \| 11).
NOTE 3: Notation ( 0 \| 1 \ ) is used in the BNF in many occurrences for
optionally omitting a value. In this example, it indicates either a specific
value \ can be used, or it can be omitted when default value can be used.
The bit value 0 or 1 indicates if \ is specified.
NOTE 4: Signed integers use Two\'s Complement representation.
**WVG (Wireless Vector Graphics)**
\ ::= ( 0 \) \| ( 1 \ )
\ ::= \ \
\ ::= \ \
**Common**
\ ::= 0 \| 1 _; 0 for 7-bit GSM character set. 1 for 16-bit
UCS-2_
\ ::= 'unsigned 8-bit integer' _; number of GSM or UCS-2
characters_
_; GSM extension characters are counted as one character_
_; \  = 0 means null string_
\ ::= 'unsigned 7 bit integer' _; 7-bit GSM character value_
> _; Extension table are supported but the Another Extension; and the_
>
> _; Page Break are not supported._
>
> \| unsigned 16 bit integer' _; 16-bit UCS-2 value_
>
> _; CR is supported but other control characters are not supported_
>
> _; (ignored when processed)._
\ := 0 \| 1 _; 0 for false, 1 for true_
\ := 0 \| 1 _; 0 for false, 1 for true_
**Character Size WVG Header**
\ ::= ( 0 ( \ \
\
> \ \ ) )
_; standard header_
> \| ( 1 ( \ \ \ ) )
>
> _; compact header. In this case, x and y grid are same,_
>
> _; default peak value 1.0, default aspect ratio1:1._
_; Note: character size WVG always use compact coordinate mode_
\ ::= \ _; true for at least one polyline element in
the drawing_
> \ _; true for at least one circular polyline element in the drawing_
>
> \ _; true for at least one Bezier polyline element in the drawing_
\ ::= 0 \| 1 _; 0 for all points use absolute coordinates,_
_; 1 for at least one point uses relative coordinate (offset mode)_
\ ::= \ \
\ ::= \ \
\ ::= \
\ ::= \
\ ::= \
\ ::= 00...11 _; 00 for 3 bits (max value 7), 01 for 4 bits
(max value 15)_
> _;10 for 5 bits (max value 31), 11 for 6 bits (max value 63)_
\ ::= 00...11 _; 00: peak value 1.0, no peak position
required_
> _; 01: peak value 1.5, peak position 0.5_
>
> _; 10: peak value 1.5, peak position 0.3333_
>
> _; 11: peak value 1.5, peak position 0.6667_
**Character Size WVG Elements**
\ ::= \ \ { \ }
\ ::= 'unsigned 7-bit integer' _; maximum 127
elements_
\ ::= \
> ( \ \| \ \|\ element> )
\ ::= \ [ \ ] _; appear when \
 = 1_
\ ::= _; empty, when \  = 100, 010 or
100_
> 0 \| 1 _; when \  = 011, 110, 110 or 101_
>
> _; 0 for the firstelement with mask value 1 in the \ _
>
> _; 1 for the second element with mask value 1 in \ _
>
> 00..11 _; 00 for polyline, 01 for circular polyline, 10 for Bezier polyline_
>
> ; _( when \  = 111>)_
\ ::= 0 \| (1 \) _; 0 for use of absolute
coordinate for \ _
_; 1 for using relative coordinate (offset mode) for \ _
**Standard WVG Header**
\ ::= \ \ \ \
\ ::= \ 0 \| ( 1 \ \
\ \ )
\ ::= 0000...1111
\ ::= 0 \| (1 \ \ { \ } )
\ := 0 \| (1 \ \ { \ } )
\ ::= 0 \| (1 \ \ \ \ \ \
)
\ ::=\'signed_13_bit_integer\'
\ ::=\'unsigned_4_bit_integer\' ; range 1-12
\ ::= \'unsigned_5_bit_integer\' ; range 1-31
\ ::= \'unsigned_5_bit_integer\' ; range 0-23
\ ::= \'unsigned_6_bit_integer\' ; range 0-59
\ ::= \'unsigned_6_bit_integer\' ; range 0-59>
**Color**
\ ::= \ \
\ ::= 00 _; black and white_
\| 010 ; 2-bit gray scale
\| 011 ; 2-bit predefined color. 4 color value 00, 01, 10, 11 are
; mapped to RGB color (255,255,255), (255,0,0),
; (0,255,0) and (0,0,255) respectively
\| 100 ; 6-bit RGB color
\| 101 ; websafe color
\| 1100 \ ; 6-bit RGB color using 2nd color palette
\| 1101 \ ; websafe color using 2nd palette
\| 1110 ; for 12 bits color mode
\| 1111 ; for 24 bits color mode
\ ::= 00000...11111 _; A value equal to "number of color"
- 1._
_;_
> _Maximum 32 color entries_
>
> {\} ; _specify color value from 0 to "number of color"-1_
\ ::= 0000000...1111111 _; A value equal to "number of
color" - 1._
> _; Maximum 128 color entries_
>
> { \ } _;specify color value from 0 to "number of
> color"-1_
>
> _; Note: the decoder will decide number of bits used by \ 
> _; RGB/websafe color > \ use 1 to 7 bits if \
> _; color > is 2, 3...4, 5...8, 9...16, 17...32, 33...64, 65...128._
\ ::= \ _; when color scheme is 00_
> \| \ _; when color scheme is 010_
>
> \| \ _; when color scheme is 011_
>
> \| \ _; when color scheme is 100_
>
> \| \ ; _when color scheme is 101_
>
> \| \ _; when color scheme is 1100_
>
> \| \ _; when color scheme is 1101_
>
> \| \ _; when color scheme is 1110_
>
> \| \ _; when color scheme is 1111_
\ ::= 0 \| _; white_
1 _; black_
\ ::= 00...11 _; 00 for 24-bit RGB color (0,0,0), 01 for 24-bit RGB
color (85,85,85)_
_; 10 for 24-bit RGB color (170,170,170), 11 for 24-bit RGB color
(255,255,255)_
\ ::= 00...11 _;00 for 24-bit RGB color (255,255,255),
01 for 24-bit RGB color (255,0,0)_
_;10 for 24-bit RGB color (0,255,0), 11 for 24-bit RGB color (0,0,255)_
\ ::= \ \ \
\ ::= (0 \| 1) \| 00...11 \| 000...111 \| 0000...1111 \|
00000...11111
_; map to 6-bit RGB color value defined in \ _
\ ::= 00000000...11111111
_; See G.7 for websafe color palette definition_
\ ::= (0 \| 1) \| 00...11 \| 000...111 \| 0000...1111
\|
> 00000...11111 \| 000000...111111 \| 0000000...1111111
_; map to 8-bit websafe color value defined in \ _
\ ::= \ _; Red color value_
\ ::= \ _; green color value_
\ ::= \ _; blue color value_
\ ::= 00...11 _; 00, 01, 10 and 11 for color value 0, 85,
170 and 255_
> _; defined in 0-255 color range respectively_
\ ::= \ \ \ ;
\ ::= \ _; Red color value_
\ ::= \ _; green color value_
\ ::= \ _; blue color value_
\ ::= 0000...1111 _; multiply by 17 to convert to 8 bit
color value_
\ ::= \ \ \ ;
\ ::= \ _; Red color value_
\ ::= \ _; green color value_
\ ::= \ _; blue color value_
\ ::= 00000000...1111111 _; intensity value of color value_
\ := ( 0 \| (1 \)) _; use black when first
bit is 0_
> ( 0 \| (1 \)) _; use black when first bit is 0_
>
> ( 0 \| (1 \)) _; use white when first bit is 0_
>
> _; If above color(s) are not_
>
> _; specified, use BLACK as \  and \,
> and use_
>
> _; WHITE as \ ._
\ ::= \
\ ::= \
\ ::= \
**Codec Parameters**
\ ::= \ \ \
\
\ ::= ( 0 \ ) _; flat
coordinate mode_
> \| (1 \ ) _; compact coordinate mode_
\ ::= \ _; true for at least one local envelope element in
the drawing_
> \ _; true for at least one polyline element in the drawing_
>
> \ _; true for at least one circular polyline element in the drawing_
>
> \ _; true for at least one Bezier polyline element in the drawing_
>
> \ _; true for at least one simple shape element in the drawing_
>
> \ _; true for at least one reuse element in the drawing_
>
> \ _; true for at least one group element in the drawing_
>
> \ _; true for at least one animation element in the drawing_
>
> (0 \| (1 _; extension bit. 1 for rare masks are followed by_
>
> \ _; true for at least one polygon element in the drawing_
>
> \ _; true for at least one special shape element in the drawing_
>
> \ _; true for at least one frame element in the drawing_
>
> \ _; true for at least one text element in the drawing_
>
> \ _; true for at least one extended element in the drawing_
>
> ) _;The decoder should decide how many bits to be used by \ _
>
> ) _; according to number of "1"s in the \ . Number of bits_
>
> _; used by \  can be 0 (if only one "1" in \),_
>
> _; 1 (if 2 "1"s), 2 (if 3 or 4 "1"s), 3 (if 5-8 "1"s) or 4(if more than 8_
>
> _; "1"s). Value of \  that is to represent a specific element_
>
> _; type is same as the order of the specific mask in the \ _
>
> _; that represents this type of element. For example, if \ 
> is_
>
> _; 011000010, \  will use 2 bits and value 00, 01, 10_
>
> _; (11 is not used) represent polyline, circular polyline and animation_
>
> _; elements respectively._
>
> _; Note that \  for local envelope has no meanings when in flat_
>
> _; coordinate mode but still_
>
> _; exists_
\ ::= \ \ \
\
\ ::= \ ; _true when at least one element uses line type
attribute_
\ ::= \ ; _true when at least one element uses line
width attribute_
\ ::= \ ; _true when at least one element uses fill
attribute_
\ ::= \ ; _true when at least one element uses line
color_
**Generic Parameters**
\ ::= (0 \| (1 \ \ ) _; 0
for default (22.5 degree, 3 bits)_
> (0 \| (1 \ \ ) _; 0 for default (1/4, 3
> bits)_
>
> (0 \| (1 \ ) _; 0 for default (both 3 bits)_
>
> [\ ]
>
> _; \  appear when \ for \ element>_
>
> _; or \  is true_
\ ::= 00...11 _; 00 for angle unit is 1.40625 degree; 01 for
angle unit is 5.625 degree_
> _; 10 for angle unit is 11.25 degree; 11 for angle unit is 22.5 degree_
\ ::= 000...111 _; number of bits used by \  is
from 1 to 8 bits_
\ ::= 'signed angleInBits+1-bit integer'
> _; angle unit is decided by \ _
>
> _;0 degree is defined as positive direction of the X axis and_
>
> _; positive angle value is clockwise._
>
> _; -180 degree is represented by maximum negative digit_
\ ::= 00..11 _; 00 for 1/4 as scale unit. 01 for 1/16 as
scale unit_
> _; 10 for 1/64 as scale unit; 11 for 1/256 as scale unit_
\ ::= 0000...1111 ; _number of bits used by \  is
from 1 to 16 bits_
\ ::= 'signed scaleInBits+1-bits integer'
_; scale unit is decided by \ _
> _; negative scale value means scaling at_
_; opposite direction_
\ ::= 0000...1111 _; number of bits used by \  are from
1 to 16 bits_
\ ::= \
\ ::= 'unsigned IndexInBits+1-bit integer'
\ ::= 0 \| 1 _; 0 for using 4 bits (15 levels)_
> _; 1 for using 5 bits (31 levels)_
**Compact Coordinate Parameters**
\ ::= \ \
\ \ \
\ ::= 00 \| _; aspect ratio = 1:1_
> ( ( 01 _; aspect ratio = 4:3_
>
> \| 10 _; aspect ratio = 16:9_
>
> \| 1100 _; aspect ratio = 64:27_
>
> \| 1101 _; aspect ration = 256:81_
>
> \| 1110 _; aspect ration = 1024:243_
>
> \| 1111 _; aspect ration = 4096:729_
>
> ) [ \ ] _; \  appears in standard
> WVG_
>
> ) _; character size WVG uses landscape only_
\ ::= 0 \| 1 _; 0 for landscape, 1 for portrait_
\ ::= \ \
\ ::= \ \
\ ::= 00 \| ( \ \ \ )
_; peak value default to 1.0 when 00 is defined_
\ ::= 00...11 _; Number of bits used by \ ._
> _; This determines the number of grid lines in the X direction._
\ ::= 00...11 _; Number of bits used by \ ._
> _; This determines the number of grid lines in the Y direction._
>
> _; 00 for 15, 01 for 31,10 for 63, 11 for 127_
\ ::= 01...11 ; _01 for 1.5, 10 for 2.0, 11 for 2.5_
\ ::= 0000...1100 _; 0-12. Peak position = value/12 from
envelope left._
\| 1101 _; reserved_
\| 1110 _; reserved_
\| 1111 _; reserved_
\ ::= 00...11 _; 00 for 0.3, 01 for 0.4, 10 for 0.5, 11 for 0.6_
> _;\  value are to the scale of total global envelope width._
>
> _; 10 (0.5) and 11 (0.6) are not allowed when \  is 11 (2.5)_
>
> _; 11 (0.6) is not allowed when \  is 10 (2.0)_
\ ::= \ ; _true when at least one element uses
'redefine resolution'attribute_
\ ::= 00..11 _; number of bits to encode translation and
center of transform_
_; 00 for 5 bits, 01 for 6 bits, 10 for 7 bits, 11 for 8 bits_
_; In global scope and at X axis, it uses unit of (global envelope width/
(number of X grid lines --1 ))_
_; In global scope and at Y axis, it uses unit of (global envelope height/
(number of Y grid lines --1 )) ; In local scope, its unit is same as local
coordinate unit._
**Flat Coordinate Parameters**
\ ::= \ ( 0 \| 1 (\)) _; 0 means height = width_
\\ \
> \ \
>
> \ \
>
> \ \
\ ::= 'unsigned 16-bit integer'
\ ::= 'unsigned 16-bit integer'
\ ::= 'unsigned_4_bit_integer'
> _; number of bits to encode X coordination_
\ ::= 'unsigned_4_bit_integer'
> _; number of bits to encode Y coordination_
\ ::= "unsigned_1_bit_integer'
> _; 0 means not all x/y are positive_
>
> _; 1 means all x/y are positive_
\ ::= 'unsigned_4_bit_integer' _; number of bits to encode
translation and center of transform_
\ ::= 'unsigned_4_bit_integer'
\ ::= 'unsigned_4_bit_integer'
\ ::= 'unsigned_4_bit_integer'
\ ::= 'unsigned_4_bit_integer'
\ ::= 'unsigned_4_bit_integer'
**Animation Settings**
\ ::= [ \ ] _;appear when \  exist_
\ ::= 0 \| 1 _; 0 for simple animation; 1 for standard
animation_
**Element**
\ := \ \ { \ }
\ ::= (0 'unsigned 7-bit integer')
\| (1 'unsigned 15-bit integer')
\ := \ ( \ \|
\ \| \ \| \ \|
\ \| \ \| \ )
\ ::= \| 0...1 \| 00..11 \| 000...111 \| 0000...1111 _; empty is
allowed_
> _; decided by \ . Please refer to \_
\ := \ \| \
_; if \  is 0, all animation elements in the drawing are
\_
_; if \  is 1, all animation elements in the drawing are
\_
\::= \ ( \ \|
\
\| \ \| \ \| \
> \| \ \| \ )
**Basic Element Header**
\ ::= ( \ _; when in flat coordinate
mode_
\| \ ) _; when in compact coordinate mode_
> [ 0 \| (1\ ) ] _; appears when \  does not
> equal_
_; to 0000_
> ; 0 for _using default attributes defined in \ _
>
> ; 1 for u _sing the following specific attributes_
\ ::= \\
\ ::= 0 \| 1
_; when in compact coordinate mode, 0 means offset X will use 3 bits.,_
_; 1 means use 4 bits_
_; when in flat coordinate mode, 0 means offset X will use \
,_
_; 1 means use \ _
\ ::= 0 \| 1
_; when in compact coordinate mode, 0 means offset X will use 3 bits,_
_; 1 means use 4 bits_
_; when in flat coordinate mode, 0 means offset X will use \
,_
> _; 1 means use \ _
\::= (0 \| (1\ )
> _; only when \  is false or in local scope_
>
> _; 0 for absolute coordinate, 1 for relative coordinates_
\| (0 (0 \| (1\ ))
> _; when \  is true and in global scope_
>
> _; 0 for absolute coordinate, 1 for relative coordinates_
>
> \| ( 1 \ \ )
>
> ; _when \  is true and in global scope_
>
> _; redefine resolution, always use relative coordinates_
\ ::= 000...111 _; decide the grid line interval by a
scale of width_
> _; or height of the global envelope whichever is short._
>
> _; 0-7 for 1/27, 1/32, 1/38, 1/48, 1/64,_
>
> _; 1/85, 1/128 and 1/160 respectively_
**Element Attributes**
\ ::= [ \ ] _; appear when \  is
true_
[ \ ] _; appear when \  is true_
[ 0 \| (1 \) ] _; appear when \  is true and_
> _; \  is not zero_
>
> _; 0 for \ , 1 for specified color_
[ 0 \| (1 _; 0 for no fill; 1 for with fill_
> (0 \| (1 \)) _; 0 for \ , 1 for specified
> color_
>
> ) _; appear when \  is true_
] _; Note: line type and line width are not used by \  but_
> _; still exist here. If not filled, then background of text output will_
>
> _; be transparent. If filled, then fill color will be used as text
> background._
\ ::= 00...11 _; 00 for no line, 01 for Fine, 10 for medium, 11
for thick_
> _; 00 is only valid with fill_
\ ::= 00...11 _; 0 for solid, 1 for dash line, 2 for dotted line_
\ ::= \
\ ::= \
\ ::= 0 \| (1 \)
0 \| (1 \)
0 \| (1 \)
0 \| (1 \ )
0 \| (1 \)
; _0 for no overriding, 1 for overriding with specified attribute_
\ ::= 0 \| 1 _; 0 means no fill, 1 means fill_
**Transform**
\ ::= \\
> 0 \| (1 \ \\ \\) _; optional other
> transforms_
\ ::= 0 \| (1 \ ) _; 0 means angle will use default value
which is 0_
\ ::= 0 \| (1 \ ) _; 0 means translate x will
use default value which is 0_
\ ::= 'signed_TransXYInBits2_bit integer' _; when in flat
coordinate mode_
\| 'signed TransXYInBits1+5 bit integer' _; when in compact coordinate mode_
\ ::= 0 \| (1 \ ) _; 0 means translate y will
use default value which is 0_
\ ::= 'signed_TransXYInBits2_bit integer' _; when in flat
coordinate mode_
\| 'signed TransXYInBits1+5-bit integer' _; when in compact coordinate mode_
\ ::= 0 \| (1\ ) _; 0 means scale will use default value
which is 1.0_
\::= 0 \| (1 \ ) _; 0 means scale will use default value
which is same as_
_; absolute value of \ _
\ ::= 0 \| (1 \ ) _; translation of rotation and scale center; 0
means it will use default_
> _; value which is at the left border of the drawing (x=0 in the flat_
>
> _; coordinate system or the global envelope)_
\ ::= 'signed_TransXYInBits2_bit integer' _; when in flat coordinate
mode_
\| \ _; when in compact coordinate mode_
\ ::= 0 \| (1 \ ) _; 0 means it will use default value which is_
_; (y=0 in the flat coordinate system or the global envelope)_
\ ::= 'signed_TransXYInBits2_bit integer' _; when in flat coordinate
mode_
\| \ _; when in compact coordinate mode_
**Polyline Element**
\ ::= [ \ ] \ { \ }
[ \ ]
> _; specifies a start point, zero or many intermediate points and an end
> point._
>
> _; \  appears only when in flat coordinate mode_
>
> _; \  appears only when in compact coordinate mode_
\ ::= 111...111111 _; Absolute mode in character size WVG.
Same number of_
> _; bits of \  or \_
>
> \| 1111...1111111 _; Absolute mode in standard WVG. Same number of bits of_
>
> ; _\ or \
\| ( 100 \| 1000 ) _; Offset mode (relative)._
_; use 100 when \  = 0_
_; use 1000 when \  = 1_
**Circular Polyline Element**
\ ::= \ [ \ ]
\ \ \
> { \ \ } [ \ ]
>
> _; \  appears only when use_
>
> _; flat coordinate mode_
>
> _; \  appears only when use_
>
> _; compact coordinate mode_
\ ::= \
\ ::= ( 0 \| (1 \) ) _; when \ 
is true_
\| \ _; when \  is false_
\ ::= 'signed 4-bit integer' _; when \  =
0_
_; or in character size WVG_
\| 'signed 5-bit integer' _; when \  = 1_
> _; Curve offset ratio r = e/L_
>
> _; Where e is actual curve offset(can be positive or negative),_
>
> _; L is distance between adjacent nodes_
>
> _; We use a signed integer value v to represent. v = round(r*k);_
>
> _; Where k = 2\^n - 2 (n is number of bits used for \ )_
\ ::= ( 1 \) _; when \  is
true_
\| \ _; when \  is false_
\ ::= 1000 _; when \  = 0_
\| 10000 _; when \  = 1_
**Bezier Polyline Element**
\ ::= [ \ ]
> \ {\ \} [ 1 \]
>
> _; Same data format for PolyBezCurve, and PolygonBezCurve_
>
> _; \  appears only when in flat coordinate moed_
>
> _; "1 \ " appears only when in compact coordinate mode_
\ ::= 'unsigned_NumberOfPointsInBits_bit integer'
\ ::= 0 \| 1
_; 0 -- off curve_
_; 1 -- on curve_
NOTE: Only cubic and quadratic Bezier curves are supported. It means only one
or two successive off-curve points are allowed. The first point of a curve
must be on-curve. The last point must also be on-curve if it is Bezier
polyline but is not necessary for Bezier polygon.
**Polygon Element**
_Polygon element is actually a closed polyline (including circular and Bezier
polyline)_
\ ::= ( 00 \ ) \| (01 \ )
> \| (10 \ )
**Simple Shape Element**
\ ::= (0 \ ) \| (1 \
)
\::=\\\\ \
\::=\\\ \
\ ::= \ \| \ _; \  is used when \ exists in the \_
_; if the element is in global scope in compact coordinate mode, use unit of_
_; (global envelope width/ (number of X grid lines --1 ))_
\::= 0 \| (1 \ ) _; 0 means the height is same as width,
height will not be encoded_
\ ::= \ \| \
_; \  is used when \ exists in the \_
_; if the element is in global scope in compact coordinate mode, use unit of_
> _; (global envelope height/ (number of Y grid lines --1 ))_
\ ::= 0 \| 1 _; 0 for straight corner, 1 for rounded corner_
**Special Shape Element**
\ ::= \ \
00 ( \ \ _; regular polygon_
\| 01 ( \ \ \ _; star_
\| 10 ( \ \ \ ) _; grid_
\| 11 _; not used_
\ ::= \ \| \ _; diameter of circle or vertex_
_; \  is used when \ exists in the \_
_; if the element is in global scope in compact coordinate mode, use unit of_
_; (global envelope width/ (number of X grid lines --1 ))_
\::= \ \
\ ::= 000...111 _; number of vertex = \  \+ 3_
\ ::= 00...11 _; 00 for 0 degree, 01 for 36 degree_
> _; 10 for 60 degree, 11 for 90 degree_
\ ::= 0000...1111 _; rows = \  \+ 1_
\ ::= 0000...1111 _; columns = \  \+ 1_
**Text Element**
\ ::= \ \ \ \ \ { \ }
> _; \  is top-left corner of the text._
\ ::= \ \| \ _; \  is used when \ exists in the \_
_; if the element is in global scope in compact coordinate mode, use unit of_
_; (global envelope height/ (number of Y grid lines --1 ))_
**Local Envelope Element**
\ ::= ( 0 \ \ )
_; local start_
> _; \  is top- left corner of the local envelope in global
> coordinates._
>
> _; Elements in the local envelope scope use local coordinates and
> measurements_
>
> \| 1 _; local end_
\ ::= \ \
\ ::= 00...11 _; 00 for 3 bits(max value 7), 01 for 4 bits
(max value 15),_
> _; 10 for 5 bits (max value 31), 11 for 6 bits (max value 63)_
**Group Element**
\ ::= (0 (0 \| (1 \) ) \ ) _; start of
group. Transform is optional_
> \| 1 _; end of group_
\ ::= 0 \| 1 _; 0 -- no display when render; 1 -- display when
render_
**Re-use Element**
\ ::= \ _; point to the element to be re-used_
_; only \ ,\ and_
> _; \  can be reused_
>
> \ _; re-use with transformation_
>
> 0 \| (1 \) _; array. It should be performed as the last
> step_
0 \| (1 \ )
\ ::= \ _; the element sequence number in whole
drawing. Start from 0._
\ ::= \ [ \ ] \ [ \ ]
_; \  indicates whole height of the array, appears when \
is non-zero_
_; element interval at X direction equals to \ /\_
_; \  indicates whole width of the array, appears when \
is non-zero_
_; element interval at Y direction equals to \ /\_
_; The top left element in the array is at the position specified in \
_
\ ::= \ _; if the element is in globale scope in compact
coordinate mode, use unit of_
_; (global envelope width/ (number of X grid lines --1 ))_
\::= 0 \| (1 \ ) _; 0 means the height is same as width,
height will not be encoded_
_; if the element is in globale scope in compact coordinate mode, use unit of_
_; (global envelope height/ (number of Y grid lines --1 ))_
**Frame Element**
\ ::= \\[\]
_; \  is new background color for the frame_
\::=\'unsigned 1-bit integer\'
> _; keep the image of the last frame on the screen, or clear it_
>
> _; value 0 - Do not keep last frame content._
>
> _; value 1 - Keep last frame content._
\ ::=\'unsigned 1-bit integer\'
> _; value 0 - no filled color_
>
> _; value 1 - has filled color_
**Simple Animation Element**
\ ::= \
> ( 0 \| ( 1 \ )
>
> ( 0 \| ( 1 \ ) _; begin transform_
>
> ( 0 \| ( 1 \ ) _; end transform_
>
> ( 0 \| 1 ) _; 0 for no bouncing. 1 for bouncing_
\
> \
\ ::= 0 \| 1 ; _0 for no round rotation._
> _; 1 for round rotation and will override angles defined in \ _
\ ::= 0 \| 1 _; 0 indicates short animation cycle; 1 indicates
long animation cycle_
\ ::= \
\ ::= 0000...1111 \| 00000000...11111111
> _; One blinking cycle is divided into four equal time steps for short_
>
> _; animation cycle or eight steps for long animation cycle. \  timing> is a map of time steps in_
>
> _; which 0 represents invisible and 1 represents visible. Note that in above
> map, consequence time steps_
_; is from left to right, or from first order to later order in bit stream._
\ ::= 0 \| 1 _; 1 for clockwise rotating. 0 for counter-
clockwise rotating_
NOTE: For all individual values in the transform, linear interpolation is
used.
**Standard Animation Element**
\::= \
\\\
\ 0 \| (1 \\ )
\\\
\ ::= 0 \| (1\ ) _; begin position_
> _;0 -- means use (start from) default transform:\ ; Angle=0, TranslateX=0,
> TranslateY=0, ScaleX=256, ScaleY=256, Cx=0, Cy=0_
_;1 -- means Transform follows_
\ ::= 0 \| (1 \ ) _; end position_
_;0 -- means use (end at) default transform\ ; Angle=0, TranslateX=0,
TranslateY=0, ScaleX=256, ScaleY=256, Cx=0, Cy=0_
_;1 -- means Transform follows_
\ ::= 0 \| 1 _;0 -- counter clockwise_
_;1 -- clockwise_
\ ::= 0 \| 1 _;0 -- no rotation_
_;1 -- rotate 360 degrees_
\ ::= ( 0 \| (1 \ ) ) ( 0 \| (1 \ ) )
_;0 -- use default colors_
_;1 -- use specified colors_
\ ::= ( 0 \| (1 \ ) ) ( 0 \| (1 \ ) )
_;0 -- use default colors_
_;1 -- use specified colors_
\ ::= 'unsigned 12-bit integer' _;\  is in units of
10ms_
\ ::= 'unsigned 12-bit integer' _; \  is in units of 10ms_
\ :: = 0 \| ( 1 \) _; 0 -- animation element will
disappear after the animation is finished_
_; 1 -- animation element will persist after the animation is finished_
**\ ::= 0 \| ( 1 \ ) _; 0 -- no repeat, animated
element will stay_**
**_; at \ _**
**_; 1 -- animation will repeat, duration will be \ _**
**\ := 0 \| 1 _; 0 -- no bouncing, animation will repeat as from
begin_**
**_; position to end position_**
**_; 1 -- repeat with bouncing. Animation will be_**
**_; repeated as end position - >_**
**_; begin position, then begin position- >end position,_**
**_; then end position- >begin position ..._**
NOTE: For all individual values in the transform, linear interpolation is
used. Similarity, color interpolation uses linear RGB color space. Out of
range color values are allowed.
**Extended Element**
\ ::= \\\{\}
\::='unsigned_5_bit integer'
_; the bit size of the Size field_
\::='unsigned-\-bit integer'
_; size of extended element data after ExtendedElementType, in bytes_
\::='unsigned_8_bit integer'
_; element type of extended element_
\::='unsigned_8_bit integer'
> _; encoded extended element data. The size should be the same as the Size
> field of Extended, above._
**Position and Measurement**
\::=\ _; first point of a polyline or polygon (including
circular and_
> _; Bezier polygons)_
\ ::= \ \| _; when use absolute mode_
> \ _; when use offset mode_
>
> _; in flat coordinate system, only offset mode is used._
\ ::= \ \
\ ::= 'signed MaxXInBits2-bit integer' _; when in flat coordinate mode and
\  = 0_
\| 'unsigned MaxXInBits2-bit integer' _; when in flat coordinate mode and \
 = 1_
\| 'unsigned MaxXInBits1+4-bit integer' _; when in compact coordinate mode and
in global scope_
\| 'unsigned MaxLocalXYInBits+3-bit integer' _; when in compact coordinate
mode and in local scope_
\| 'unsigned MaxXInBits0+3-bit integer' _; when in character size WVG (use
standard header)_
\| 'unsigned MaxXYBits0+3-bit integer' _; when in character size WVG (use
compact header)_
\ ::= 'signed MaxYInBits2-bit integer' _; when in flat coordinate mode and
\  = 0_
\| 'unsigned MaxYInBits2-bit integer' _; when in flat coordinate mode and \
 = 1_
\| 'unsigned MaxYInBits1+4-bit integer' _; when in compact coordinate mode and
in global scope_
\| 'unsigned MaxLocalXYInBits+3-bit integer' _; when in compact coordinate
mode and in local scope_
\| 'unsigned MaxYInBits0+3-bit integer' _; when in character size WVG (use
standard header)_
\| 'unsigned MaxXYBits0+3-bit integer' _; when in character size WVG (use
compact header)_
_; Note: in compact coordinate mode,\  and \ do not use the maximum
number of the unsigned integer_
\ ::= \ \
\ ::= \ _; when used by \ _
> \| \ _; when used in other cases_
\ ::= \ _; when used by \ _
\| \ _; when used in other cases_
\ = 'signed OffsetXInBitsLevel1-bit integer'
_;when in flat coordinate mode and \  = 0_
> \| 'signed OffsetXInBitsLevel2-bit integer'
_;when in flat coordinate mode and \  = 1_
\| 'signed 3-bit integer' _;when in compact coordinate mode and \  = 0_
> \| 'signed 4-bit integer' _;when in compact coordinate mode and \  bit use> = 0_
\ = 'signed OffsetYInBitsLevel1-bit integer'
> _;when in flat coordinate mode and \  = 0_
>
> \| 'signed OffsetYInBitsLevel2-bit integer'
>
> _;when in flat coordinate mode and \  = 1_
\| 'signed 3-bit integer' _;when in compact coordinate mode and \  = 0_
> \| 'signed 4-bit integer' _;when in compact coordinate mode and \  bit use> = 0_
\ ::= 'unsigned OffsetXInBitsLevel1-bit integer'
> _;when in flat coordinate mode and \  = 0_
\| 'unsigned OffsetXInBitsLevel2-bit integer'
> _;when in flat coordinate mode and \  = 1_
\| 'unsigned 3-bit integer' _;when in compact coordinate mode and \  = 0_
> \| 'unsigned 4-bit integer' _;when in compact coordinate mode and \  bit use> = 1_
\ ::= 'unsigned OffsetYInBitsLevel1-bit integer'
_;when in flat coordinate mode and \  = 0_
\| 'unsigned OffsetYInBitsLevel2-bit integer'
_;when in flat coordinate mode and \  = 1_
\| 'unsigned 3-bit integer' _;when in compact coordinate mode and \  = 0_
\| 'unsigned 4-bit integer' _;when in compact coordinate mode and \  = 1_
# G.7 Web Safe Color Palette
_Websafe color palette can be defined as in following C syntax using 24-bit
RGB color (in form of {red, blue, green} ). The first index of the array
indicates value of \ _
_int websafePalette[256][3] =_
_{_
_{ 255, 255, 255 }, { 255, 204, 255 }, { 255, 153, 255 }, { 255, 102, 255 },_
_{ 255, 51, 255 }, { 255, 0, 255 }, { 255, 255, 204 }, { 255, 204, 204 },_
_{ 255, 153, 204 }, { 255, 102, 204 }, { 255, 51, 204 }, { 255, 0, 204 },_
_{ 255, 255, 153 }, { 255, 204, 153 }, { 255, 153, 153 }, { 255, 102, 153 },_
_{ 255, 51, 153 }, { 255, 0, 153 }, { 204, 255, 255 }, { 204, 204, 255 },_
_{ 204, 153, 255 }, { 204, 102, 255 }, { 204, 51, 255 }, { 204, 0, 255 },_
_{ 204, 255, 204 }, { 204, 204, 204 }, { 204, 153, 204 }, { 204, 102, 204 },_
_{ 204, 51, 204 }, { 204, 0, 204 }, { 204, 255, 153 }, { 204, 204, 153 },_
_{ 204, 153, 153 }, { 204, 102, 153 }, { 204, 51, 153 }, { 204, 0, 153 },_
_{ 153, 255, 255 }, { 153, 204, 255 }, { 153, 153, 255 }, { 153, 102, 255 },_
_{ 153, 51, 255 }, { 153, 0, 255 }, { 153, 255, 204 }, { 153, 204, 204 },_
_{ 153, 153, 204 }, { 153, 102, 204 }, { 153, 51, 204 }, { 153, 0, 204 },_
_{ 153, 255, 153 }, { 153, 204, 153 }, { 153, 153, 153 }, { 153, 102, 153 },_
_{ 153, 51, 153 }, { 153, 0, 153 }, { 102, 255, 255 }, { 102, 204, 255 },_
_{ 102, 153, 255 }, { 102, 102, 255 }, { 102, 51, 255 }, { 102, 0, 255 },_
_{ 102, 255, 204 }, { 102, 204, 204 }, { 102, 153, 204 }, { 102, 102, 204 },_
_{ 102, 51, 204 }, { 102, 0, 204 }, { 102, 255, 153 }, { 102, 204, 153 },_
_{ 102, 153, 153 }, { 102, 102, 153 }, { 102, 51, 153 }, { 102, 0, 153 },_
_{ 51, 255, 255 }, { 51, 204, 255 }, { 51, 153, 255 }, { 51, 102, 255 },_
_{ 51, 51, 255 }, { 51, 0, 255 }, { 51, 255, 204 }, { 51, 204, 204 },_
_{ 51, 153, 204 }, { 51, 102, 204 }, { 51, 51, 204 }, { 51, 0, 204 },_
_{ 51, 255, 153 }, { 51, 204, 153 }, { 51, 153, 153 }, { 51, 102, 153 },_
_{ 51, 51, 153 }, { 51, 0, 153 }, { 0, 255, 255 }, { 0, 204, 255 },_
_{ 0, 153, 255 }, { 0, 102, 255 }, { 0, 51, 255 }, { 0, 0, 255 },_
_{ 0, 255, 204 }, { 0, 204, 204 }, { 0, 153, 204 }, { 0, 102, 204 },_
_{ 0, 51, 204 }, { 0, 0, 204 }, { 0, 255, 153 }, { 0, 204, 153 },_
_{ 0, 153, 153 }, { 0, 102, 153 }, { 0, 51, 153 }, { 0, 0, 153 },_
_{ 255, 255, 102 }, { 255, 204, 102 }, { 255, 153, 102 }, { 255, 102, 102 },_
_{ 255, 51, 102 }, { 255, 0, 102 }, { 255, 255, 51 }, { 255, 204, 51 },_
_{ 255, 153, 51 }, { 255, 102, 51 }, { 255, 51, 51 }, { 255, 0, 51 },_
_{ 255, 255, 0 }, { 255, 204, 0 }, { 255, 153, 0 }, { 255, 102, 0 },_
_{ 255, 51, 0 }, { 255, 0, 0 }, { 204, 255, 102 }, { 204, 204, 102 },_
_{ 204, 153, 102 }, { 204, 102, 102 }, { 204, 51, 102 }, { 204, 0, 102 },_
_{ 204, 255, 51 }, { 204, 204, 51 }, { 204, 153, 51 }, { 204, 102, 51 },_
_{ 204, 51, 51 }, { 204, 0, 51 }, { 204, 255, 0 }, { 204, 204, 0 },_
_{ 204, 153, 0 }, { 204, 102, 0 }, { 204, 51, 0 }, { 204, 0, 0 },_
_{ 153, 255, 102 }, { 153, 204, 102 }, { 153, 153, 102 }, { 153, 102, 102 },_
_{ 153, 51, 102 }, { 153, 0, 102 }, { 153, 255, 51 }, { 153, 204, 51 },_
_{ 153, 153, 51 }, { 153, 102, 51 }, { 153, 51, 51 }, { 153, 0, 51 },_
_{ 153, 255, 0 }, { 153, 204, 0 }, { 153, 153, 0 }, { 153, 102, 0 },_
_{ 153, 51, 0 }, { 153, 0, 0 }, { 102, 255, 102 }, { 102, 204, 102 },_
_{ 102, 153, 102 }, { 102, 102, 102 }, { 102, 51, 102 }, { 102, 0, 102 },_
_{ 102, 255, 51 }, { 102, 204, 51 }, { 102, 153, 51 }, { 102, 102, 51 },_
_{ 102, 51, 51 }, { 102, 0, 51 }, { 102, 255, 0 }, { 102, 204, 0 },_
_{ 102, 153, 0 }, { 102, 102, 0 }, { 102, 51, 0 }, { 102, 0, 0 },_
_{ 51, 255, 102 }, { 51, 204, 102 }, { 51, 153, 102 }, { 51, 102, 102 },_
_{ 51, 51, 102 }, { 51, 0, 102 }, { 51, 255, 51 }, { 51, 204, 51 },_
_{ 51, 153, 51 }, { 51, 102, 51 }, { 51, 51, 51 }, { 51, 0, 51 },_
_{ 51, 255, 0 }, { 51, 204, 0 }, { 51, 153, 0 }, { 51, 102, 0 },_
_{ 51, 51, 0 }, { 51, 0, 0 }, { 0, 255, 102 }, { 0, 204, 102 },_
_{ 0, 153, 102 }, { 0, 102, 102 }, { 0, 51, 102 }, { 0, 0, 102 },_
_{ 0, 255, 51 }, { 0, 204, 51 }, { 0, 153, 51 }, { 0, 102, 51 },_
_{ 0, 51, 51 }, { 0, 0, 51 }, { 0, 255, 0 }, { 0, 204, 0 },_
_{ 0, 153, 0 }, { 0, 102, 0 }, { 0, 51, 0 }, { 17, 17, 17 },_
_{ 34, 34, 34 }, { 68, 68, 68 }, { 85, 85, 85 }, { 119, 119, 119 },_
_{ 136, 136, 136 }, { 170, 170, 170 }, { 187, 187, 187 }, { 221, 221, 221 },_
_{ 238, 238, 238 }, { 192, 192, 192 }, { 128, 0, 0 }, { 128, 0, 128 },_
_{ 0, 128, 0 }, { 0, 128, 128 }, { 0, 0, 0 }, { 0, 0, 0 },_
_{ 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 },_
_{ 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 },_
_{ 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 },_
_{ 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 },_
_{ 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 },_
_{ 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }_
_};_
###### ## Annex H (informative): Development Guidelines for Creation of
Polyhony Using SP-MIDI
While Scalable Polyphony-MIDI (SP-MIDI) [38] is a full-featured standard for
synthesizing music, using a few guidelines SP-MIDI [38, 39] can be optimized
for wireless devices. These guidelines can be grouped as optimizing individual
notes, and to minimize the overall size of a melody.
# H.1. Running status
In the Musical Instrument Digital Interface (MIDI) standard, a key-on or a
key-off event will use at most three bytes each, cf. [40], However, in case
several key events occur on the same MIDI-channel, running status can be used.
In principle running status means that the first byte of, e.g. key-on is
omitted. In addition, the key-on event having a velocity of zero is equivalent
to the key-off event. Thus, combining running status and using key-on with
zero velocity, as the key-off event will reduce the number of bytes needed to
encode key events.
EXAMPLE: Without running status, the sequence
91 2E 23 8E, 91 2B 50 8E, 81 2E 64 00, 81 2B 64 00
means "Key 2E ON" Velocity 23 MIDI Ch 1", "Key 2B ON Velocity 50 MIDI Ch 1",
"Key 2E OFF Velocity 64 MIDI Ch 1", "Key 2B OFF Velocity 64 MIDI Ch 1". Using
running status will reduce the sequence into
91 2E 23 8E, 2B 50 8E, 2E 00 00, 2B 00 00,
That is, the command byte is omitted and velocity zero is used for key off.
# H.2 File type considerations
The SP-MIDI content can be stored in, a Standard MIDI File (SMF) of type 0 or
type 1 [40]. In a type 0 SMF, one header chunk and one track chunk is used. In
a type 1 SMF one header chunk and several track chunks are used. SMF type 2
should not be used
# H.3 File size reduction
In general it is more efficient to store the MIDI data as a type 1 file. The
increased efficiency is reached if each track contains one MIDI channel and
one instrument (This is often the case). Evidently, running status can be
applied on each individual track reducing the track size. To further reduce
the size of the file use one track per used MIDI channel. That is, if a
temple/conductor track exists merge it with the first instrument track.
Remove, all meta events which are not necessary, e.g. \"track name\",
\"lyric\". To summarize, the following measures can be taken in order to
reduce the SMF:
1) use SMF type 1 (or check if type 1 is smaller than type 0 and use the
smallest);
2) use running status;
3) one and only one instrument per track. Try not to change channels;
4) do not change tempo in the middle of the music, i.e., only set tempo once;
5) use beat, instead of SMPTE, to set tempo;
6) copyright is on automatically;
7) remove controller messages, which are optional according to [39];
8) turn off the options below:
  * sequence Number - MIDI sequence ids;
  * text - embedded text for anything;
  * sequence / track name;
  * instrument name;
  * lyric;
  * marker - for synchronization purposes;
  * cue point;
  * midi channel presix - associate channels with all events following;
  * sequencer-specific settings.
Items 1 to 3 above optimize the notes, while items 4 to 8 optimize the overall
melody. The above measures will provide an SMF, which is ready for
compression. However, prior to compression the composer/content author can
consider to use few values for key velocity and thereby increasing the
redundancy of the file.
# H.4 Restrictions
Content creators should not expect the full support for the following
features:
  * MIDI message channel pressure;
  * MIDI message pitch bend;
  * individual stereophonic panoramic (pan) as expressed in table 5 in [39];
  * MIDI message master volume.
Content creators should not expect a time granularity better than 5ms to be
supported by the SME.
To ensure interoperability, the first value of the MIP table should be no more
than 6 voices.
#
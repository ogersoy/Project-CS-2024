# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
This Technical Report describes an IMS capable HNB SubSystem (the HNB and the
HNB Gateway) as an optional capability of HNB that allows e.g. an operator to
offload CS traffic to the IMS. The HNB and HNB Gateway are described in TR
23.830 [5], and the capabilities of these network elements are assumed by this
TR.
To achieve this and to satisfy the related requirements and use cases captured
in TS 22.220 [2], the objective is to investigate the following:
  * an architecture to enable IMS capable HNB Subsystem to use the IMS for CS terminals using a corresponding equivalent IMS services (voice service in IMS Multimedia Telephony);
  * the impacts of the IMS capable HNB Subsystem to idle mode mobility for all supported UE types (e.g. IMS registration/de-registration);
  * service continuity at least in the direction from IMS capable HNB Subsystem to macro network;
  * support for pre-Rel‑9 CS and IMS UEs when using IMS capable HNB Subsystem.
The TR will analyze solutions for the related architectural issues and capture
the conclusions.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, edition number, version number, etc.) or non‑specific.
```{=html}
``` \- For a specific reference, subsequent revisions do not apply.
```{=html}
``` \- For a non-specific reference, the latest version applies. In the case
of a reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.220: \"Service requirements for Home NodeBs and Home eNodeBs\".
[3] 3GPP TS 22.173: \"IP Multimedia Core Network Subsystem (IMS) Multimedia
Telephony Service and supplementary services Stage 1\".
[4] 3GPP TS 24.008: \"Mobile radio interface Layer 3 specification; Core
network protocols; Stage 3\".
[5] 3GPP TR 23.830: \"Architecture aspects of Home NodeB and Home eNodeB\".
[6] 3GPP TS 23.292: \"IP Multimedia Subsystem (IMS) centralized services;
Stage 2\".
[7] 3GPP TS 29.292: \"Interworking between the IP Multimedia (IM) Core Network
(CN) subsystem and MSC Server for IMS Centralized Services (ICS)\".
[8] 3GPP TS 25.467: \"UTRAN architecture for 3G Home Node B; Stage 2\".
[9] 3GPP TS 23.002: \"Network Architecture\".
[10] 3GPP TS 23.216: \"Single Radio Voice Call Continuity (SRVCC); Stage 2\".
[11] 3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".
[12] 3GPP TS 24.229: \"IP Multimedia Call Control Protocol Based on SIP and
SDP; Stage 3\".
[13] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[14] 3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service
description; Stage 2\".
[15] 3GPP TS 23.009: \"Handover Procedures\".
[16] 3GPP TS 24.173: \"IMS multimedia telephony communication service and
supplementary services; Stage 3\".
[17] 3GPP TS 23.237: \"IP Multimedia Subsystem (IMS) Service Continuity; Stage
2\".
[18] 3GPP TS 24.010: \"Mobile radio interface layer 3 Supplementary services
specification; General aspects\".
[19] 3GPP TS 23.236: \"Intra-domain connection of Radio Access Network (RAN)
nodes to multiple Core Network (CN) nodes\".
[20] 3GPP TS 23.007: \"Restoration procedures\".
[21] 3GPP TS 33.203: \"3G security; Access security for IP-based services\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] apply.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
IM-IWF IMS Interworking Function
# 4 Service Scenarios
Editor\'s note: The relevant service scenarios for IMS aspects of architecture
for Home NodeB will be based on the related service requirements from TS
22.220 [2].
The architecture shall permit the following service scenarios to be supported:
\- UE using CS procedures for voice originates a voice session through 3G HNB
and the IMS Core network.
\- UE using CS procedures for voice terminates a voice session through the IMS
Core network and 3G HNB.
\- UE performs idle mode mobility between 3G HNB and CS macro network.
\- Service Continuity performed from HNB to CS macro network of a UE which
uses CS procedures for voice.
Editor\'s note: Support of Service Continuity from CS macro network to HNB is
to be confirmed based on requirements from SA1.
\- IMS supplementary services executed, see TS 22.173 [3], for UE which uses
CS procedures (TS 24.008 [4]) for voice.
\- UE which uses CS procedures for voice originates emergency call through 3G
HNB and, based upon operator policy, either the CS Core network or IMS Core
network.
\- CS services executed which do not have an equivalent in IMS, e.g. CS-
Data/Fax, for UE by the CS Core network. In this case the services shall be
provided by the CS domain or rejected in case the operator has decided not to
support it.
\- User performs configuration of supplementary services through 3G HNB from
UE using CS procedures.
# 5 Architectural Requirements
Editor\'s note: The relevant requirements for IMS aspects of architecture for
Home NodeB will be based on the related service requirements from TS 22.220
[2] and above service characteristics.
The architecture of an IMS capable HNB subsystem shall be based on the
architecture of a non-IMS capable HNB subsystem as defined in TR 23.830 [5]
with the following clarifications and additions:
\- It shall be possible to support access to the CS domain based on the
architecture specified in TR 23.830 [5]. However, it is not mandated for a
deployment to support access to the CS domain (as defined in TS 22.220 [2]).
\- An IMS capable HNB subsystem shall support access to the PS domain based on
the architecture specified in TR 23.830 [5]. Access to PS domain makes it
possible to support the same PS access mobility mechanisms between different
CSG cells and between CSG and non-CSG cells as that supported by a non-IMS-
capable HNB subsystem.
\- The architecture shall enable originated services requested by UEs with CS-
specific NAS signalling (i.e. using TS 24.008 [4]) to be interworked with and
provided by the IP multimedia core network subsystem (IMS). Similarly, the
architecture shall enable terminated services in IMS to be delivered to UEs
with CS-specific NAS signalling.
\- If an IMS capable HNB subsystem provides access to the CS domain, then it
shall route user-originated service requests to either CS domain or IMS based
on operator policies. The domain selected to service a particular user-
originated request shall be transparent to the UE and the user.
\- The CS/IMS interworking functionality shall be transparent to UE.
Therefore, the UE is not required to know if a HNB is IMS capable or not.
\- When a new UE successfully enters into an IMS capable HNB (e.g. it is
successfully authenticated and authorized to use this IMS capable HNB), the
IMS capable HNB subsystem shall register this UE to IMS. This allows the IMS
capable HNB subsystem to provide subsequent UE originated and terminated
services (using CS-specific NAS signalling) over IMS.
\- For support of CS UEs:
i. The architecture shall permit a complete offload of the CS Core for
services supported in IMS, e.g., basic voice call; other legacy CS services
such as Circuit Switched Data/Fax, etc., may still be supported in CS core.
ii. The architecture shall support seamless handover from IMS Capable Home
NodeB to macro cellular.
iii. The architecture shall provide protocol interworking between 3GPP SIP
(from/toward the IMS Core) and TS 24.008 [4] Call Control (from/toward the
UE).
iv. The architecture shall permit service to be provided to inbound roamers.
v. The architecture should build on the Iu-h approach; that is, it should be
possible to migrate from 3G Home NodeB to IMS Capable Home NodeB.
\- The architecture shall have minimal impact upon the pre-Rel‑9 Core Network.
\- The architecture shall satisfy the constraint that IMS is access
independent.
\- The architecture shall offer the same level of security to the network and
to the UE as 3G Home NodeB.
\- The architecture shall support the generation of appropriate accounting
information for all subscribers served by 3G Home NodeB including the case
when the UE moves between macro cellular and 3G Home NodeB.
# 6 Architecture Alternatives
Editor\'s Note: This section will discuss solution alternatives for IMS
Aspects of Architecture for Home NodeBs arising from (a) the service
characteristics and (b) architectural requirements listed in section 5 of this
document.
## 6.1 Alternative 1
### 6.1.1 Reference architecture
IMS capable Home Node -B system provides IMS based services to CS UEs and IMS
UEs.
The following figure shows reference architecture for the IMS capable Home
Node-B system.
Figure 6.1.1-1: Reference Architecture
NOTE 1: Iuh User Plane is terminated on the HNB-UP-IWF when IMS is used as the
serving domain and on if HNB-GW for CS domain services.
NOTE 2: The IMS bearers may be connected via the Mb to various network
entities, such as a UE (e.g. via a GTP Tunnel to a GGSN) or a MRFP etc.
NOTE 3: Iuh Control Plane is terminated on the HNB-IM-IWF for serving domain
selection (CS or IMS).
Editor\'s Note: It is FFS how the IM-IWF receives the CS security context that
is required to intercept NAS messages from the UE
The following general principles are noted:
\- HNB-IM-IWF interfaces to HNB over Iuh reference point as specified in TS
25.467 [8].
\- HNB-IM-IWF interworks NAS to SIP signalling using the H2 reference point
that builds on the I2 interface as specified in TS 23.292 [6] and TS 29.292
[7]. HNB-IM-IWF has a service domain selection function (S-DSF) that selects
either the IMS or the CS domain for originating service requests from a UE.
Preference is given to anchor the session in IMS whenever possible. Service
Domain selection decisions are controlled by Operator policies.
Editor\'s Note: S-DSF operation is FFS
\- HNB-IM-IWF is also responsible for registering the CS UE in IMS.
\- HNB-UP-IWF is responsible for User Plane interworking when IMS is selected
as a serving domain by the HNB-IM-IWF
\- HNB-IM-IWF controls interworking of user plane bearers of Iu-UP to Mb by
using media gateway control protocol over H4 reference point. H4 reference
point is similar to Mc reference point i.e. H.248 based media gateway control.
\- Serving Domain selection influences the termination of Iuh-UP. When the
serving domain is IMS the Iuh-UP terminates at the HNB-UP-IWF. If the serving
domain is CS then the Iuh-UP terminates at HNB-GW. Iuh-UP termination is a
result of the completion of standard call setup procedures.
\- HNB-IM-IWF and HNB-UP-IWF are in the network domain.
A sample deployment scenario is shown below in figure 6.1.1-2:
Figure 6.1.1-2: Sample deployment scenario
### 6.1.2 Functional Entities
#### 6.1.2.1 HNB-IM-IWF
The HNB-IM-IWF is a logical function that terminates NAS control plane from
the UE. It incorporates one or more of the following functions:
\- **Serving Domain Selection Function (S-DSF):** S-DSF decides if chosen
service domain is IMS or CS for a particular type of service. If CS domain is
chosen the service request is routed to CS domain on H3 interface to a MSC
server that is R-99 or later.
\- **NAS/SIP IWF:** If S-DSF chooses IMS as a serving domain, NAS/SIP-IWF
interworks NAS signalling to SIP as specified in TS 29.292 [7].
\- **HNB-UP-IWF controller:** HNB-UP-IWF controller controls setup and
teardown on UP bearers over Iuh interface and IMS bearers towards IMS. This
function is only required when IMS is chosen as the serving domain.
#### 6.1.2.2 HNB-UP-IWF
The HNB-UP-IWF interworks Iu-h user plane to Mb. HNB-UP-IWF gets bearer set
up, interworking and teardown commands from HNB-IM-IWF over H4 reference
point.
### 6.1.3 Reference Points
#### 6.1.3.1 Reference point between HNB-IM-IWF - IMS CN (H2)
H2 reference point builds upon I2 reference point as specified in TS 23.292
[6]
#### 6.1.3.2 Reference point between HNB-IM-IWF - HNB-UP-IWF (H4)
H4 reference point is used for media control to interwork Iuh user plane with
IMS bearers. It is expected that a Mc like interface be used for this
reference point
### 6.1.4 Protocol Stacks
#### 6.1.4.1 Control Plane (Serving domain -- CS)
The figure shows the protocol stack when CS domain is selected as a serving
domain for a service request.
Editor\'s Note: The figure must be updated to show that the HNB-IM-IWF shows
back-to-back protocol stacks at every layer.
Figure 6.1.4.1-1: Control Plane (Serving domain -- CS)
#### 6.1.4.2 Control Plane (Serving domain -- IMS)
Figure 6.1.4.2-1: Control Plane (Serving domain -- IMS)
#### 6.1.4.3 User Plane (Serving domain -- CS)
The figure shows the User Plane protocol stack when CS domain is selected as a
serving domain for a service request.
Figure 6.1.4.4-1: User Plane (Serving domain -- CS)
#### 6.1.4.4 User Plane (Serving domain -- IMS)
The figure shows the User Plane protocol stack when IMS CN is selected as a
serving domain for a service request.
Figure 6.1.4.4-1: User Plane (Serving domain -- IMS)
### 6.1.5 Mobility Management
#### 6.1.5.1 UE Attach procedure
The attach procedure for the UE is shown:
Figure 6.1.5.1-1: UE attach procedure
1\. The UE initiates the attach procedure by the sending the Location Update
NAS message.
Editor\'s Note: It is FFS as to how IMS registration is triggered if the UE
does not send a LAU when it enters a CSG cell that shares the same LA as the
macro cell.
2\. HNB-IM-IWF derives a VLR number based on the allocated LAI and on an IMSI
hash function defined in TS 23.236 [19]. MSC/VLR selected is the same that
serves the LA in the macro network where the HNB is located.
3\~5. Update Location procedure is performed by the MSC server towards the
HSS. and UE authentication is performed.
6\. HNB-IM-IWF registers the UE towards IMS as specified in TS 23.292 [6].
7\. IMS registration is accepted.
8\. Location Accept is sent to the UE. At this point the UE is registered in
the CS domain as well as IMS CN.
#### 6.1.5.2 Idle mode mobility (HNB to macro RNS)
##### 6.1.5.2.1 Legacy macro MSC (non ICS capable)
Idle mode mobility is shown in figure 6.1.5.2.1-1, for the scenario for a
legacy UE (pre release 8). As a pre-requisite the UE is in MM Idle state
having previously attached with in the HNB system as shown in figure 6.1.4.1-1
Figure 6.1.5.2.1-1: Idle mode mobility (legacy MSC)
1.\~1a. The UE moves out of the HNB cell and on SIB monitoring it initiates
RRC connection to send a Lu Req to the RNC that results in a Iu connection
setup. Subsequently the UE sends a NAS Location Area Update message to the
MSC. The MSC notes the change in the RNC-id and LAC.
2\. HNB-IM-IWF de-registers the UE in IMS when the T3211or T3212 timer expires
or a call termination paging request fails.
NOTE 1: Failure of the paging for call termination (during the time when the
UE has relocated to the macro RNS) leads to de-registration of the UE in IMS
which then leads to deregistration information propagated to the HSS. HSS then
removes the CAMEL triggers that lead to call termination retry via the MSC/VLR
using normal termination procedures specified in TS 23.007 [20].
NOTE 2: Any call termination caused by dual registration between the time
between steps 1a and 4 leads the HNB-IM-IWF to step 2.
Editor\'s Note: If de-registration occurs due to a temporary loss of radio
coverage in the HNB, the UE will be unreachable. A solution is FFS.
3\~4. IMS (S-CSCF) sends a SAR to HSS to inform that the UE is no longer
registered in IMS.
5\. MSC sends a Location Update Accept to the UE
6\~7. Iu connections are released.
##### 6.1.5.2.2 Release 8 MSC (ICS capable)
Idle mode mobility is shown in figure 6.1.5.2.2-1, for the scenario for a
legacy UE (pre release 8). As a pre-requisite the UE is in MM Idle state
having previously attached with in the HNB system as shown in figure
6.1.5.1-1.
Figure 6.1.5.2.2-1: Idle mode mobility (ICS MSC)
1.\~1a. The UE moves out of the HNB cell and on SIB monitoring it initiates
RRC connection to send a Lu Req to the RNC that results in a Iu connection
setup. Subsequently the UE sends a NAS Location Area Update message to the ICS
MSC. The ICS MSC notes the change in the RNC-id and LAC.
2\~3. The ICS MSC sends an IMS registration for the new contact for the UE.
This procedure is described in detail in TS 23.292.
4\~5. IMS notifies HNB-IM-IWF about the UE being re-registered from the ICS
capable MSC server. HNB-IM-IWF de-registers the UE locally.
6\. MSC sends a Location Update Accept to the UE
7\~8. Iu connections are released.
#### 6.1.5.3 Idle mode mobility (macro RNS to HNB)
##### 6.1.5.3.1 Legacy macro MSC (non ICS capable)
Idle mode mobility is shown in figure 6.1.5.3.1-1, for the scenario for a
legacy UE (pre release 8). As a pre-requisite the UE is in MM Idle state
having previously attached in the macro RNS.
Figure 6.1.5.3.1-1: Idle mode mobility (legacy MSC)
1.\~1c. The UE moves into of the HNB cell and on SIB monitoring it initiates
RRC connection to send a Lu Req to the HNB that results in a Iu connection
setup. Subsequently the UE sends a NAS Location Area Update message to the
HNB-IM-IWF. HNB-IM-IWF sends the LAU to the MSC via HNB-GW. The MSC notes the
change in the RNC-id and LAC.
2\. HNB-IM-IWF Registers the UE in IMS with the new contact informtion.
3\~4. IMS (S-CSCF) sends a SAR to HSS to inform that the UE is now registered
in IMS.
5\. IMS sends 200 OK for a successful UE registration.
6\. MSC sends a Location Update Accept to the UE
7\~8. Iu connections are released.
##### 6.1.5.3.2 Release 8 MSC (ICS capable)
Idle mode mobility is shown in figure 6.1.5.3.2-1, for the scenario for a
legacy UE (pre release 8). As a pre-requisite the UE is in MM Idle state
having previously attached in the macro RNS.
Figure 6.1.5.3.2-1: Idle mode mobility (ICS MSC)
1.\~1c. The UE moves into of the HNB cell and on SIB monitoring it initiates
RRC connection to send a Lu Req to the HNB that results in a Iu connection
setup. Subsequently the UE sends a NAS Location Area Update message to the
HNB-IM-IWF. HNB-IM-IWF sends the LAU to the MSC via HNB-GW. The MSC notes the
change in the RNC-id and LAC.
2\~3. HNB-IM-IWF Registers the UE towards IMS with the new contact
information.
4\~5. ICS MSC de-registers the UE from IMS. TS 23.292 has this procedure
described in detail.
Editor\'s Note: It is FFS how the MSC determines that it must deregister from
IMS during a location update procedure.
6\. MSC sends a Location Update Accept to the UE
7\~8. Iu connections are released.
### 6.1.6 Connection Management
#### 6.1.6.1 Mobile originated call (IMS CN)
A mobile originated call is shown in figure 6.1.6.1-1, for the scenario for a
legacy UE (pre release 8) that is camped on a HNB. As a pre-requisite the UE
is in MM Idle state having previously attached with in the HNB system and IMS
registered as shown in figure 6.1.6.1-1.
Figure 6.1.6.1-1: Mobile Originated call (IMS CN)
1\. The UE initiates a RRC connection request to transition from IDLE mode to
Connected mode to get ready to make a CS call.
2\~3. The UE initiates sends a Connection Management service request and the
HNB-IM-IWF responds back with a Connection Management Service accept..
4\. The UE sends a CC setup.
5\. HNB-IM-IWF interworks the CC setup into a SIP INVITE. TS 29.292 specifies
the interworking procedures in detail. HNB-IM-IWF sends the INVITE towards
IMS.
6\~7. IMS responds with 183 session progress that is interworked by HNB-IM-IWF
to a call proceeding and sent to the UE.
8\~9. If the called party is ringing, IMS sends 180 ringing to the HNB-IM-IWF.
HNB-IM-IWF interworks it to an ALERT and sends it to the UE.
10\~11. If the called party answers, IMS responds with a 200 OK. The 200 OK
also contains a STN that is allocated by IMS/SCC AS to be used for any future
session continuity (connected mode mobility from HNB cell to macro RNS) with a
legacy MSC, if needed.
NOTE: This dynamically allocated STN from IMS/SCC AS is not needed if the MSC
is ICS capable.
12\~13 HNB-IM-IWF sends a Connect to the UE to inform that the call is
established.
14\. To tear down the call/session, the UE sends a Disconnect to the HNB-IM-
IWF.
15\~16. HNB-IM-IWF interworks it to BYE towards IMS/SCC AS to tear down the
session.
17\. HNB-IM-IWF sends Release Complete to the UE.
#### 6.1.6.2 Mobile originated call (CS domain)
A mobile originated call is shown in figure 6.1.6.2-1, for the scenario for a
legacy UE (pre release 8) that is camped on a HNB. As a pre-requisite the UE
is in MM Idle state having previously attached with in the HNB system and
registered in the CS domain as shown in figure 6.1.5.1-1. This applies to
calls/services that are not provided by IMS CN.
Figure 6.1.6.2-1: Mobile Originated call (CS Domain)
1.\~1c. The UE initiates a RRC connection request to transition from IDLE mode
to Connected mode to get ready to make a CS call. An Iu connection is setup
between HNB, HNB-IM-IWF, HNB-GW and the MSC.
Editor\'s Note: This call flow is inconsistent with the IMS domain origination
in figure 6.1.6.1-1. It is not possible to know which domain should service
the request until receipt of the CM Service Request message in some cases, or
until receipt of the Setup request in other cases. Resolution of this
inconsistency is FFS.
2\~5. The UE initiates sends a Connection Management service request and the
HNB-IM-IWF. HNB-IM-IWF sends it to the MSC. The MSC responds back with a
Connection Management Service accept..
6\~7. The UE sends a CC setup. HNB-IM-IWF sends the Setup to the MSC.
8\~9. MSC responds with a Call Proceeding. HNB-IM-IWF forwards the call
proceeding to the UE.
10\~11. If the called party is ringing the MSC sends Alert to the HNB-IM-IWF.
HNB-IM-IWF sends it to the UE.
12\~14. If the called party answers, IMS responds with a Connect to the HNB-
IM-IWF. HNB-IM-IWF sends the Connect to the UE to inform that the call is
established.
15\~16. To tear down the call/session, the UE sends a Disconnect to the HNB-
IM-IWF. HNB-IM-IWF sends the Disconnect to the MSC to tear down the call.
17\~18. MSC sends the Release complete to the HNB-IM-IWF. HNB-IM-IWF forwards
the Release Complete to the UE.
19\~19c. Iu connection is released as well as the RRC connection.
#### 6.1.6.3 Mobile terminated call (IMS CN)
A mobile terminated call is shown in figure 6.1.6.3-1, for the scenario for a
legacy UE (pre release 8) that is camped on a HNB. As a pre-requisite the UE
is in MM Idle state having previously attached with in the HNB system and IMS
registered as shown in figure 6.1.5.1-1.
Editor\'s Note: It is FFS how to handle termination during periods of dual IMS
registration in the HNB and MSC.
Figure 6.1.6.3-1: Mobile terminated call (IMS CN)
1\. IMS sends an INVITE towards the HNB-IM-IWF to terminate an incoming IMS
session for a CS UE.
2\~2a.. HNB-IM-IWF sends a Paging request to the HNB that results in a RRC
page.
3.. The UE responds to the Page by initiating a RRC Connection request to
transition to Connected mode.
4\. Initial UE message from the HNB to the HNB-IM-IWF creates a Iu connection
for the UE.
5\~8. The UE sends an Alert and an Answer to the HNB-IM-IWF. HNB-IM-IWF
interworks it to 18x and 200 OK responses as specified in TS29.292 and sends
it IMS CN.
9 .IMS sends an ACK back. The ACK may include a STN that was allocated by the
SCC AS for any future session continuity (connected mode mobility from HNB to
macro RNS) if the MSC is not ICS capable.
> NOTE: This dynamically allocated STN from IMS/SCC AS is not needed if the
> MSC is ICS capable.
10\~11. HNB-IM-IWF sends a Connect to the UE and the UE sends back a Connect
Ack. The call is successfully established at this point.
12\. To tear down the call/session, the UE sends a Disconnect to the HNB-IM-
IWF.
13\~14. HNB-IM-IWF interworks it to BYE towards IMS/SCC AS to tear down the
session.
15\. HNB-IM-IWF sends Release Complete to the UE.
#### 6.1.6.4 Mobile terminated call (CS domain)
A mobile terminated call is shown in figure 6.1.6.4-1, for the scenario for a
legacy UE (pre release 8) that is camped on a HNB. As a pre-requisite the UE
is in MM Idle state having previously attached with in the HNB system and MSC
registered as shown in figure 6.1.5.1-1. This applies to calls/services that
are not provided by IMS CN.
Figure 6.1.6.4-1: Mobile terminated call (CS Domain)
1\. The MSC receives an call for the CS UE.
NOTE: The terminating call is for a service that is not available in IMS.
2\~2b. The MSC sends a Page for the UE via the HNB-GW and the HNB-IM-IWF.
3\. The UE responds to the Page by initiating a RRC Connection request to
transition to Connected mode.
4\~4a. Initial UE message from the HNB to the HNB-IM-IWF creates a Iu
connection for the UE.
5\~7a. The UE sends an Alert and an Answer to the HNB-IM-IWF. HNB-IM-IWF sends
it to the MSC.
8\~8c. The MSC sends a Connect to the HNB-IM-IWF. HNB-IM-IWF sends a Connect
to the UE and the UE sends back a Connect Ack. The call is successfully
established at this point.
9\~9b. To tear down the call/session, the UE sends a Disconnect to the HNB-IM-
IWF. HNB-IM-IWF sends it to the MSC.
10\~10b. The MSC sends a Release complete to the HNB-IM-IWF. HNB-IM-IWF sends
it to the UE.
### 6.1.7 Connected mode mobility (HNB to macro RNS)
#### 6.1.7.1 Legacy (Pre Rel 8) MSC
Connected mode mobility is shown in figure 6.1.7.1-1, for the scenario for a
legacy UE (pre release 8). As a pre-requisite the UE has a call anchored in
IMS CN as shown in figure 6.1.6.1-1.
Figure 6.1.7.1-1: Connected mode mobility (Legacy MSC)
1\. The UE has a session anchored in IMS. Based on radio measurement reports
the HNB sends a Relocation required request to the HNB-IM-IWF to trigger SRNS
relocation to macro RNS..
2\. HNB-IM-IWF initiates a CS call on behalf of the UE towards the MSC, by
sending a CM Service request / Setup. The called party number is the STN that
was allocated by the IMS/SCC AS during session setup. STN is E.164 number that
maps to a PSI DN. IMS has configured iFC to route this PSI DN to the SCC AS as
defined in TS 23.228.
3.. The MSC sends the IAM out with the STN as the called party number. The
call gets routed to the IMS CN.
4\~4a. IMS/S-SCSF routes .the INVITE to the S-CSCF based on the iFC trigger.
5\~5c. SCC AS correlated the call with the original UE session, updates the
remote leg and sends the response back.
6\. HNB-IM-IWF sends the Relocation required request to the MSC.
7\~8. The MSC sends the Relocation Request to the macro RNS and Relocation
Command to the HNB-IM-IWF.
9\. HNB-IM-IWF forwards the Relocation Command to the HNB.
10\. The HNB initiates RRC handover for the UE.
11\. Macro RNS reports Relocation Complete to the MSC.
12\. MSC releases the Iu connection with the HNB-IM-IWF
At this point, the call has successfully migrated to the macro RNS.
Editor\'s Note: What CS call states are recoverable is FFS? What happens if
the UE is not in one of the recoverable states is FFS? How to assure that the
UE and MSC are always in compatible states during each stage of the mobility
procedure is FFS?
#### 6.1.7.2 ICS capable MSC
Connected mode mobility is shown in figure 6.1.7.2-1, for the scenario for a
legacy UE (pre release 8). As a pre-requisite the UE has a call anchored in
IMS CN as shown in figure 6.1.6.1-1.
Figure 6.1.7.2-1: Connected mode mobility (Legacy MSC)
1\. The UE has a session anchored in IMS. Based on radio measurement reports
the HNB sends a Relocation required request to the HNB-IM-IWF to trigger SRNS
relocation to macro RNS..
2\. HNB-IM-IWF sends the Relocation required request to the ICS MSC.
3\~4. The ICS MSC Registers the UE in IMS with the new Contact address.
5\~6. The ICS MSC sends .the INVITE with the STI towards the IMS CN. This STI
is used to correlate the IMS sessions that need to be replaced at the SCC AS.
iFC triggers in the S-CSCF help route this INVITE to the SCC AS. Detailed
procedures are specified in TS 23.292..
7\. The MSC sends the Relocation Request to the macro RNS and Relocation
Command to the HNB-IM-IWF.
8\~9. The ICS MSC sends the Relocation Command to the HNB-IM-IWF. HNB-IM-IWF
forwards the Relocation Command to the HNB.
10\. The HNB initiates RRC handover for the UE.
11\. Macro RNS reports Relocation Complete to the MSC.
12\. ICS MSC sends the ACK back to the IMS. SCC AS updates the remote leg with
the new media flow update.
13\. MSC releases the Iu connection with the HNB-IM-IWF
Editor\'s Note: Whether the registration procedure in step 3 increases the
time to complete the mobility procedure and why this is or is not acceptable
is FFS.
At this point, the call has successfully migrated to the macro RNS.
## 6.2 Alternative 2: IMS capable HNB Subsystem using IMS centralised services
IWF
### 6.2.1 Logical architecture
This alternative enhances the HNB Subsystem with IMS functionality by re-using
the IMS centralised service approach (ICS) already defined in Rel‑8 TS 23.292
[6].
The IMS functionality (i.e. SIP UA) is provided by the IWF which contains the
functions equivalent to MSC Server enhanced for ICS. Neither the UE, or the
HNB or the HNB GW needs to be enhanced by IMS specific functions. The ICS IWF
is connected via Iu-cs reference point to the HNB GW and reuses I2 and I3 from
TS 23.292 [6] for interworking to IMS. The Figure 6.1-1 shows the general
architecture.
Figure 6.2.1-1: IMS capable HNB Subsystem using ICS
The ICS IWF processes the user-network signalling received over the Iu-cs and
performs inter-working towards IMS and vice versa:
\- Call control signalling to setup originating and terminating bi-directional
voice and video calls are inter-worked between Iu-cs and I2.
\- Service control signalling to manage supplementary services provided and
controlled by the TAS in the IMS are inter-worked between Iu-cs and I3.
To support handover between the HNB and Macro 2/3G, the ICS IWF behaves as
either MSC-A (source) or MSC-B (target) as defined in TS 23.009 [15] for the
Handover procedure. The ICS IWF may also control a dedicate CS-MGW close to
the HNB GW using Mc reference point to offload the CS user plane traffic.
## 6.3 Void
## 6.4 Alternative 4 - IMS HNB GW as SIP UA and HO anchor
### 6.4.1 Introduction
The key characteristic of this IMS HNB solution is that all new capabilities
are enabled via enhancements to the HNB GW, renamed IMS HNB GW, with no
changes to HNB, a few optional small changes to the CS core network, and small
changes to the T-ADS function in the SCC AS.
This solution assumes all of the functionality of the HNB and HNB Gateway
defined in TS 25.467 [8], with extensions to the HNB GW to enable IMS
centralized services (ICS), per TS 23.292 [6], for CS UEs using HNB access,
and without the direct involvement of the CS core network. Note that the HNB
GW extensions may be physically realized as a functional component of the HNB
GW or as a stand-alone entity.
The architecture also supports the addition of local/intercom services within
the HNB in the same manner as supported by the HNB in Release 8.
Local/intercom services within the HNB can be interworked with TS 24.008 [4]
signalling and merged with TS 24.008 [4] signalling received via the Iuh
reference point. The HNB can route TS 24.008 [4] signalling received from the
UE to either the local/intercom services interworking function within the HNB
or to the Iuh reference point, based on the service instance identifier.
### 6.4.2 Reference architecture
Figure 6.4.1-1 provides the reference architecture for the IMS HNB subsystem.
Thinner connecting lines represent control plane reference points. Thicker
connecting lines represent user plane reference points. Commas \",\" separate
reference point names concurrently represented by a single line. Forward slash
\"/\" separates alternatives for entity and reference point names. Note that
in some use cases, there may exist entities on the corresponding user plane
path that perform no user plane functions other than forwarding. The
corresponding procedures may optionally bypass some of these entities to avoid
unnecessary anchoring of the media. The figure only shows interfaces needed to
support HNBs receiving IMS HNB service.
Figure 6.4.1-1: IMS HNB Subsystem Reference Architecture
The architecture introduces a single modified network element, the IMS HNB GW,
which in addition to the functions assigned to the HNB GW in TS 25.467 [8],
allows ICS for CS UEs and supports CS handover procedures with the macro
network for CS UEs accessing IMS services. The architecture builds on network
elements and reference points defined in TS 23.002 [9] and TS 25.467 [8].
### 6.4.3 Functional Entities
Entities of the architecture not listed below are defined in TS 23.002 [9] and
are not impacted, including BSS, RNS, PS core network and CS-MGW.
#### 6.4.3.1 UE
The UE may be any R99 or later UMTS CS capable UE.
#### 6.4.3.2 HNB
The HNB complies to TS 25.467 [8].
#### 6.4.3.3 IMS HNB GW
The HNB GW defined in TS 25.467 [8] is enhanced to support ICS, and here named
the IMS HNB GW. The IMS HNB GW includes two primary sub-functions -- the
existing HNB GW and the IMS HNB adaptation function (IHAF).
The HNB GW sub-function of the IMS HNB GW provides the standard HNB GW
functions for all UEs. The HNB GW may be provisioned to select those HNBs for
which it will invoke the IHAF and receive IMS HNB service, and those HNBs for
which it will not.
The IHAF sub-function of the IMS HNB GW provides the following functions for
an identified ICS user:
\- It performs IMS registration upon receipt of the first message from the UE
in the HNB, using the same procedures as defined for the IMS Server enhanced
for ICS in TS 23.292 [6]. The IHAF uses a different identity during IMS
registration to allow simultaneous registration of the IHAF and MSC server
enhanced for ICS. Note that the VLR for the UE remains in the MSC Server and
does not reside in the IHAF.
\- It processes the user-network signalling received over the CS access (i.e.
via Iuh and E reference points) for interworking with IMS SIP and vice versa.
\- If necessary, it processes the user plane media received over the CS access
(i.e. via Iuh and Nb reference points) for interworking with IMS RTP bearers
and vice versa.
\- It assures that the MSC is invoked to perform initial and periodic CS
authentication and CSG authorization of each UE as required by local policy.
Frequency of CSG authorization is determined by local policy rather than being
required for each UE access to allow trade-off between extra signalling needed
and the probability of unauthorized access.
Editor\'s Note: The CSG procedures for Alternative 4 do not support the forced
release or relocation of an active IMS session via the IHAF for a UE whose CSG
membership expires during the session. It is FFS whether this capability needs
to be provided by enhancing RANAP to provide notification of expiration of CSG
membership from the MSC to the IHAF for each UE that is CS attached in the
location area of a HNB.
When receiving a request to handover to the macro network for a call being
interworked with IMS, it begins CS intersystem handover procedures with the CS
core network via the E interface, as defined in TS 23.009 [15], performing the
MSC-A intersystem handover role (a.k.a., anchor MSC).
\- It supports handover from the macro network to the HNB for calls being
interworked with IMS.
\- It satisfies requests for services that do not have an equivalent in IMS or
are not otherwise implemented within the IHAF (e.g., Circuit Switched
Data/Fax, SMS, emergency) by routing such requests to the CS core network via
Iu-cs. The IHAF determines the appropriate domain to handle each UE service
request.
The IHAF requires no other MSC functions such as most VLR management, CAMEL,
supplementary services, emergency services, SMS delivery, CS data
interworking, intrasystem handover procedures, etc.
For subscribers not identified as ICS users, the IMS HNB GW provides all
services according to existing procedures.
#### 6.4.3.4 IMS
IMS conforms to TS 23.228 [11]. IMS includes the CSCF, the anchoring and
terminating access domain selection functions of the SCC AS, as defined in TS
23.292 [6], and the TAS required for MMTEL services defined in TS 24.173 [16].
The T-ADS function of the SCC AS is enhanced to recognize IMS registration
from the IHAF. SCC AS support for service continuity procedures according to
TS 23.237 [17] is optional and not applicable to UEs that can access telephony
services only in CS mode.
#### 6.4.3.5 MSC Server
The MSC Server supports the Iu-cs interface from the IHAF and supports
existing CS intersystem handover (MSC-B) functions for IMS sessions handed out
from the IHAF.
The MSC Server provides the following services for a CS UE receiving IMS
services via an IHAF:
\- It performs CS Location Updates with CS authentication. If the MSC server
is enhanced for ICS, it may also register with IMS on behalf of the UE.
\- While hosting the VLR for a UE receiving IMS services via an IHAF, it also
supports the CS intersystem handover role of MSC-B for the UE, as defined in
TS 23.009 [15] (a.k.a., target or drift MSC). The MSC server is able to
perform the Serving MSC and MSC-B roles independently and simultaneously for
the UE.
\- It satisfies requests for services that the IHAF does not obtain from IMS,
e.g., Circuit Switched Data/Fax, SMS, emergency.
\- It may optionally support cancel location notification to the IHAF when a
IU leaves the LA of the HNB.
\- When the MSC initially authorizes access to the HNB for a UE, if the
HSS/HLR is provisioned with an ICS flag for the UE, the MSC server may
optionally notify the IHAF of the flag to aid the IHAF to determine whether to
register with IMS on behalf of the UE.
### 6.4.4 Interfaces and Reference points
Reference points not listed below are defined in TS 23.002 [9] or TS 25.467
[8] and are not impacted, including Uu, Um, Iuh, A, Gb, Iu-ps, Mc and Mb.
#### 6.4.4.1 Reference Point MSC Server -- CSCF (I2)
TS 23.002 [9] and TS 23.292 [6] define the I2 reference point between the MSC
Server and CSCF. The I2 reference point is reused between the IHAF and CSCF
(in IMS) to route session control signalling between the IHAF and the home
IMS. The IHAF uses all procedures associated with the I2 reference point
except that the private identity of the IHAF is distinct from the MSC server
enhanced for ICS to allow simultaneous registration of the two entities.
#### 6.4.4.2 Interface between the MSC and HNB GW (Iu_CS interface)
TS 23.002 [9] and TS 25.467 [8] define the Iu-cs interface between the MSC and
HNB GW, which also applies to the IHAF.
#### 6.4.4.3 Interface between MSC servers or MSC server and IP-SM-GW
(E-interface)
TS 23.002 [9] and TS 23.009 [15] define the E-interface between MSC servers.
The E-interface is reused without change between the IHAF acting in the role
of MSC-A and another MSC acting in the role of MSC-B. TS 23.009 [15] defines
the MSC-A and MSC-B roles within the context of CS intersystem handover
procedures.
#### 6.4.4.4 Reference Point MSC Server -- GMSC Server (Nc Reference Point)
The Nc reference point is used for Network-Network call control signalling, as
described in TS 23.002 [9]. It is only required between an IHAF and an MSC
server to establish intersystem user plane connections in support of CS
intersystem handover scenarios associated with the E-interface. Nc may be
realized, for example, using SIP.
#### 6.4.4.5 Reference Point CS-MGW -- CS-MGW (Nb Reference Point)
The Nb reference point, as defined in TS 23.002 [9], provides the user plane
transport between the IHAF and the CS-MGW for connections established via the
Nc reference point. Nb may be realized, for example, using RTP/UDP/IP.
### 6.4.5 Registration
#### 6.4.5.1 Overview
The MSC server enhanced for ICS performs IMS registration whenever location
area change is associated with a change in Visited-MSC, thus updating the
target information for the UE. Ideally, the IHAF would participate in this
procedure so that only one MSC or IHAF is registered with the SCC AS at a
time. This would require that the HNB be assigned a separate location area
from the surrounding macro cells, which may not be desirable in some cases.
Thus the IHAF and MSC server enhanced for ICS may be registered simultaneously
with IMS for certain periods and the T-ADS function must use other means to
select the initial target for terminating sessions.
The IHAF and SCC AS require the following changes to existing registration
procedures associated with the MSC server enhanced for ICS:
\- The IHAF uses a different private identity during IMS registration to
register in addition to rather than instead of the MSC server enhanced for
ICS.
\- The IHAF registers with IMS upon receipt of the first message from an
unregistered UE in the HNB. This first message may not be a location update
message if the location area does not change at the HNB boundary.
\- Upon receipt of a terminating session request, the T-ADS function of the
SCC AS uses unspecified means to make the initial target selection and retry
as necessary.
\- The SCC AS T-ADS function may change the sequence in which it attempts to
reach registered contacts. For example, it may not initially attempt to reach
a registered IHAF if the UE is unlikely to be in the location area of the HNB.
\- The MSC server may forward a cancel location indication to the IHAF when
the UE exits the location area of the HNB. This optional indication requires a
small enhancement to RANAP and the MSC. The indication helps provide more
accurate location information to the T-ADS function but is not essential.
#### 6.4.5.2 CS attach and location update
IMSI attach, location update and periodic update signalling are performed
according to the procedures defined in TS 25.467 [8]. These procedures apply
for all types of UE initiating this signalling within the HNB, whether or not
ICS procedures apply to the UE. The HSS associates all CS-attached UEs,
whether or not ICS applies, with a Visited-MSC/VLR in the CS CN.
#### 6.4.5.3 IMS registration via IHAF
Figure 6.4.5.3-1 describes how IMS registration is performed by the IHAF upon
receipt of the first message from an unregistered UE in the HNB. The IHAF
shall conform to the I2 reference point registration procedures defined in
clause 7.2 of TS 23.292 [6] with a different private identity and different
trigger conditions.
This procedure also applies to a sufficient fraction of the periodic location
updates within the HNB to assure that IMS registration does not expire as long
as the UE is within the HNB service area.
The IMS HNB GW behaves exactly as a HNB GW for HNBs not provisioned for IMS
HNB procedures. When invoked, the IHAF does not significantly alter existing
HNB GW procedures for UEs that do not successfully register in IMS.
Figure 6.4.5.3-1: Initial IMS Registration via IHAF
1\. The UE sends a first UE message within the HNB toward the CS network while
the IHAF is unregistered in IMS for the UE or the ciphering key sequence
number in the UE message does not match the value stored in the IHAF. The IHAF
shall modify the ciphering key sequence number in the UE message to the value
\"No key is available\" before forwarding the message to the MSC server in 1b.
This triggers re-authentication of the UE by the MSC server.
2\. The CS network initiates the authentication and security mode control MM
procedures for the UE. During the procedures, the MSC server informs the IHAF
of the validated IMSI of the UE using the Iu Common Identity message. The MSC
performs CSG authorization if necessary. The MSC may forward the ICS flag to
the IHAF if available.
3\. The IHAF monitors the MM procedures and detects their successful
completion. The IHAF decides to initiate IMS registration for this subscriber
according to either the optional ICS flag received from the MSC or ACL data
provisioned for the associated IMSI, as advised by local policy. If the
subscriber is already registered via this IHAF, no IMS registration is sent.
4\. The IHAF derives a domain name from the subscriber\'s identity (e.g. IMSI)
and discovers the address of the appropriate I‑CSCF/IBCF.
5\. The IHAF sends a SIP REGISTER to the IMS with a private and temporary
public user identity derived from the subscriber\'s IMSI as well as an
InstanceID. The REGISTER also contains information indicating the capabilities
and characteristics of the IHAF as a SIP User Agent Client. The I‑CSCF
verifies that the incoming REGISTER originates from a trusted IHAF (in the
same way it would check that a normal REGISTER originates from a trusted
P‑CSCF).
6\. The I‑CSCF initiates standard procedures for S‑CSCF location/allocation.
7\. The I‑CSCF forwards the REGISTER to the S‑CSCF.
8\. The S‑CSCF identifies the REGISTER as being from the trusted IHAF. The
S‑CSCF skips any further authentication procedures and performs registration
procedures with the HSS.
9\. The S‑CSCF performs standard service control execution procedures. Filter
criteria directs the S‑CSCF to send a REGISTER to the SCC AS.
10\. IMS registration procedures are completed.
11\. If the first UE message initiated a CM service, it is completed according
to the corresponding procedures. If the CM service is not a candidate for
handling by IMS, step 11 occurs in parallel with steps 3-10. For example, an
emergency call proceeds without waiting for IMS registration.
#### 6.4.5.4 IMS de-registration via IHAF
The IHAF shall de-register from IMS if it receives a cancel location
indication from the MSC server indicating that the UE has just left the
location area of the HNB. Support of this indication is optional for the MSC
server.
In the absence of UE signalling activity in the HNB, the IHAF will cease to
perform periodic IMS registration and the registration will expire in IMS.
### 6.4.6 Origination
#### 6.4.6.1 CS origination via MSC
##### 6.4.6.1.1 IHAF not registered, authentication required or CSG
authorization required
Figure 6.4.6.1.1-1 describes CS origination via MSC for a UE in an HNB
receiving IMS HNB services where the UE is not IMS registered in the IHAF or
where the UE requires periodic re-authentication or CSG authorization. Local
policy shall determine how often UE accesses are to be subject to CSG
authorization. The IHAF determines registration, authentication and CSG
authorization status prior to forwarding any UE messages to the MSC to enable
efficient interworking with IMS for IMS originations.
Figure 6.4.6.1.1-1: CS origination via MSC when IHAF not registered or
authentication required
1\. The UE sends a CM_Service_Request to the IHAF to initiate CS service. The
UE does not send this message if it is already MM connected for another
service.
2\. The IHAF determines that the UE is not IMS registered, the ciphering key
sequence number in the CM_Service_Request is unknown, that periodic re-
authentication of the UE is required or that CSG authorization is required.
3\. The IHAF forwards the CM_Service_Request to the MSC. If re-authentication
is required, the IHAF shall modify the ciphering key sequence number in the UE
message to the value \"No key is available\" before forwarding the message to
the MSC server. This triggers re-authentication of the UE by the MSC server.
4\. The MSC server may initiate authentication of the UE.
5\. The MSC server initiates the security mode control procedure. The IHAF
remembers the IMSI, TMSI, ciphering key sequence number and keys for
subsequent transactions.
6\. If the IHAF is not currently registered in IMS on behalf of the UE, the
IHAF initiates IMS registration. Steps 1-6 of this procedure correspond to
steps 1-10 of figure 6.4.5.3-1.
7\. The UE sends the CS_Setup with sufficient details to categorize the
request.
8\. The IHAF determines according to local policy that the CS CN is to handle
the request.
9\. The IHAF forwards the CS_Setup to the Visited-MSC via Iu-cs. The IHAF does
not wait for completion of IMS registration in step 6 before forwarding the
request to the Visited-MSC.
10\. Call setup procedures are completed.
##### 6.4.6.1.2 IHAF registered, authentication not required and CSG
authorization not required
Figure 6.4.6.1.2-1 describes CS origination via MSC for a UE in an HNB
receiving IMS HNB services where the UE is IMS registered in the IHAF and does
not require periodic re-authentication or CSG authorization.
When the UE is IMS registered, the Iu connection state between the HNB and the
IHAF must be handled independently from the Iu connection state between the
IHAF and the Visited-MSC. The IHAF may need to buffer TS 24.008 [4] messages
from the UE until it receives sufficient information to decide to which domain
to forward the request.
Figure 6.4.6.1.2-1: CS origination via MSC when IHAF registered and
authentication not required
1\. The UE sends a CM_Service_Request to the IHAF to initiate CS service. The
UE does not send this message if it is already MM connected for another
service.
2\. The IHAF determines that the UE is IMS registered, the ciphering key
sequence number in the UE message matches the stored number, and the UE does
not require periodic re-authentication or CSG authorization. The IHAF begins
to buffer messages from the UE until it can determine which domain is to
service the request.
3\. The IHAF initiates the Security Mode command sequence if step 1 occurs.
The IHAF stores the information from the most recent Security Mode Command
received from the MSC and repeats the command here.
4\. The UE sends the CS_Setup with sufficient details to categorize the
request.
5\. The IHAF determines according to local policy that the CS CN is to handle
the request.
6\. If an Iu connection is not already established with the Visited-MSC, the
IHAF sends a CS_Service_Request to the Visited-MSC via Iu-cs to establish the
Iu connection.
7\. The Visited-MSC optionally initiates Authentication challenge or other MM
procedures via Iu-cs.
8\. The Visited-MSC initiates the Security Mode command sequence if the Iu
connection was just established in step 6. The IHAF may respond positively to
the Visited-MSC without contacting the UE if a security mode is already
established with the UE using the same keys.
9\. The IHAF forwards the CS_Setup to the Visited-MSC via Iu-cs.
10\. Call setup procedures are completed.
#### 6.4.6.2 IMS origination via IHAF
##### 6.4.6.2.1 IHAF not registered, authentication required or CSG
authorization required
Figure 6.4.6.2.1-1 describes IMS origination via IHAF for a non-ICS UE that is
not IMS registered in the IHAF or requires periodic re-authentication or CSG
authorization. This procedure is based on clause 7.3.2.1.2 of TS 23.292 [6].
Other I2 based origination procedures from clause 7.3.2 of TS 23.292 [6] also
apply with the role of the MSC server replaced by the IHAF.
Figure 6.4.6.2.1-1: IMS origination via IHAF when IHAF not registered or
authentication required
1\. The UE sends a CM_Service_Request to the IHAF to initiate CS service. The
UE does not send this message if it is already MM connected for another
service.
2\. The IHAF determines that the UE is not IMS registered, the ciphering key
sequence number in the CM_Service_Request is unknown, that periodic re-
authentication of the UE is required or that CSG authorization is required.
3\. The IHAF forwards the CM_Service_Request to the MSC. The IHAF shall modify
the ciphering key sequence number in the UE message to the value \"No key is
available\" before forwarding the message to the MSC server. This triggers re-
authentication of the UE by the MSC server.
4\. The MSC server may initiate authentication of the UE.
5\. The MSC server initiates the security mode control procedure. The IHAF
remembers the IMSI, TMSI, ciphering key sequence number and keys for
subsequent transactions.
6\. If the IHAF is not currently registered in IMS on behalf of the UE, the
IHAF initiates IMS registration. Steps 1-6 of this procedure correspond to
steps 1-10 of figure 6.4.5.3-1.
7\. The UE A sends a CS call setup message containing the B-party number to
the IHAF according to standard CS originating procedures.
8\. The IHAF determines according to local policy that IMS is to handle the
request.
9\. The IHAF requests release of the Iu connection with the MSC server.
10\. The IHAF sends an INVITE to the S‑CSCF according to the I2 procedure
defined in step 2 of clause 7.3.2.1.2 of TS 23.292 [6]. The INVITE contains
SDP for the user plane connection associated with UE A.
11\. The S‑CSCF performs standard service control execution procedures. Filter
criteria direct the S‑CSCF to send the INVITE to the SCC AS.
12\. The SCC AS invokes a B2BUA, terminating the UE A Leg and originating the
Remote Leg for presentation of an IMS session towards the B-party on behalf of
UE A. The SCC AS includes the SDP from the UE A Leg in the INVITE sent towards
the B-party. The INVITE request is routed from the SCC AS to the S‑CSCF.
13\. The S‑CSCF continues with standard IMS originated session processing and
routes the request onwards to the B-party.
14\. The session and bearer control setup procedures are completed.
##### 6.4.6.2.2 IHAF registered, authentication not required and CSG
authorization not required
Figure 6.4.6.2.2-1 describes IMS origination via IHAF for a non-ICS UE that is
IMS registered in the IHAF and does not require periodic re-authentication or
CSG authorization. This procedure is based on clause 7.3.2.1.2 of TS 23.292
[6]. Other I2 based origination procedures from clause 7.3.2 of TS 23.292 [6]
also apply with the role of the MSC server replaced by the IHAF.
Figure 6.4.6.2.2-1: IMS origination via IHAF when IHAF registered and
authentication not required
1\. The UE sends a CM_Service_Request to the IHAF to initiate CS service. The
UE does not send this message if it is already MM connected for another
service.
2\. The IHAF determines that the UE is IMS registered, the ciphering key
sequence number in the UE message matches the stored number, and the UE does
not require periodic re-authentication or CSG authorization. The IHAF begins
to buffer messages from the UE until it can determine which domain is to
service the request.
3\. The IHAF initiates the Security Mode command sequence if step 1 occurs.
The IHAF stores the information from the most recent Security Mode Command
received from the MSC and repeats the command here.
4\. The UE A sends a CS call setup message containing the B-party number to
the IHAF according to standard CS originating procedures.
5\. The IHAF determines according to local policy that IMS is to handle the
request.
6\. The IHAF sends an INVITE to the S‑CSCF according to the I2 procedure
defined in step 2 of clause 7.3.2.1.2 of TS 23.292 [6]. The INVITE contains
SDP for the user plane connection associated with UE A.
7\. The S‑CSCF performs standard service control execution procedures. Filter
criteria direct the S‑CSCF to send the INVITE to the SCC AS.
8\. The SCC AS invokes a B2BUA, terminating the UE A Leg and originating the
Remote Leg for presentation of an IMS session towards the B-party on behalf of
UE A. The SCC AS includes the SDP from the UE A Leg in the INVITE sent towards
the B-party. The INVITE request is routed from the SCC AS to the S‑CSCF.
9\. The S‑CSCF continues with standard IMS originated session processing and
routes the request onwards to the B-party.
10\. The session and bearer control setup procedures are completed.
### 6.4.7 Termination
#### 6.4.7.1 CS termination via MSC
If there is no IMS session in progress for a UE via the IHAF and the Visited-
MSC receives a CS termination request, e.g., for terminating SMS delivery, the
IMS HNB GW follows standard HNB GW procedures for CS termination. This may
also occur if a terminating call appears for a UE in a HNB without IHAF
registration, for example, when a UE first moves into a HNB area with the same
location area as the surrounding macro network.
#### 6.4.7.2 IMS termination via IHAF
Figure 6.4.7.2-1 describes how IMS terminations are performed via IHAF for non
ICS UE registered in IMS. This procedure is based on clause 7.4.2.1.2 of TS
23.292 [6]. Other I2 based termination procedures from clause 7.4.2 of TS
23.292 [6] also apply with the role of the MSC server replaced by the IHAF.
The T-ADS function in the SCC AS should be enhanced to keep track of the
likely location of the UE when multiple registrations are active, to pick the
most likely target for successful delivery of terminating service, and to
retry delivery via an alternate target if an initial attempt fails. Alternate
T-ADS strategies may be investigated during normative specification.
Figure 6.4.7.2-1: IMS Termination via IHAF
1\. An incoming INVITE is received at the S‑CSCF of the B-party via the
I‑CSCF.
2\. The S‑CSCF performs standard service control execution procedures. Filter
criteria direct the S‑CSCF to send the INVITE to the SCC AS.
3\. The SCC AS performs terminating access domain selection. The SCC AS
chooses the CS access network and the IHAF contact address, amongst the
registered contact addresses for the UE B, for the setup of the media.
4\. The SCC AS establishes a new session by sending an INVITE to the UE B via
the S‑CSCF.
5\. The S‑CSCF forwards the INVITE to the IHAF based on the contact address
stored during registration, using standard IMS procedures.
6\. If the UE is not already MM connected for another service, the IHAF pages
the UE.
7\. The HNB receives the page response from the UE and forwards it to the
IHAF.
8\. If the IHAF determines that the ciphering key sequence number in the page
response is unknown or that periodic re-authentication or CSG authorization is
required, it proceeds with steps 9-12. Otherwise the IHAF initiates the
Security Mode command sequence (not shown) with the information stored from
the most recent Security Mode Command received from the MSC and proceeds with
step 13.
9\. If the MSC is required to re-authenticate the UE or to authorize the CSG
for the UE, the IHAF creates a CM_Service_Request message as if from the UE,
and forwards the message to the MSC server. If re-authentication is required,
the IHAF modifies the ciphering key sequence number in the message to the
value \"No key is available\", before forwarding the message to the MSC
server. This triggers re-authentication of the UE by the MSC server.
10\. The MSC server may initiate authentication of the UE.
11\. The MSC server initiates the security mode control procedure. The IHAF
remembers the IMSI, TMSI, ciphering key sequence number and keys for
subsequent transactions.
12\. The IHAF requests release of the Iu connection with the MSC server.
13\. The IHAF sends a Setup message to the UE B.
14\. The session and bearer control setup procedures are completed.
#### 6.4.7.3 CS termination during IMS session
Figure 6.4.7.3-1 describes how a CS termination is performed via the Visited-
MSC if an IMS session is in progress for the UE via the IHAF. This procedure
differs from clause 6.4.7.1 because there is already an Iu connection
established on Iuh whereas there is no Iu connection on Iu-cs between the IHAF
and the MSC server. The figure shows a terminating SMS delivery since call
deliveries should all occur via IMS.
Figure 6.4.7.3-1: CS Termination during IMS session
1\. The Visited-MSC receives a terminating SMS request for the UE while an IMS
session is in progress for the UE via the IHAF.
2\. If no Iu connection is established for the UE between the MSC server and
the IHAF, the Visited-MSC sends an Iu paging request to the IHAF. If an Iu
connection is already established for the UE to support another service or a
mobility management procedure, then paging is not necessary.
3\. Since an Iu connection is already established between the IHAF and the HNB
in support of the IMS session, the IHAF responds to the page from the Visited-
MSC with a paging response formatted as if from the UE. This establishes the
Iu connection between the IHAF and the Visited-MSC.
4\. The Visited-MSC optionally initiates Authentication challenge or other MM
procedures via Iu-cs if messages 2 and 3 are required.
5\. The Visited-MSC initiates the Security Mode command sequence if the Iu
connection was just established in step 3. The IHAF may respond positively to
the Visited-MSC without contacting the UE if a security mode is already
established with the UE using the same keys.
6\. The Visited-MSC forwards the terminating SMS to the IHAF.
7\. The IHAF forwards the terminating SMS to the UE.
### 6.4.8 Control and user plane paths before and after handover
The following sub-clauses describe the control plane and user plane paths
initially established for CS UEs receiving CS services and IMS services, and
also the control and user plane paths established after successful handover
scenarios. Note that references to handover from the macro network to the IMS
HNB subsystem are contingent on the Rel‑9 extensions being developed to
support handover from macro to HNB in the non-IMS HNB subsystem. Note that
handover may occur prior to allocation of a user plane to the call; these
cases are not shown anywhere in the description of Alternative 4, since the
procedures are the same as the corresponding handover procedures that occur
after user plane establishment but without the user plane procedures.
#### 6.4.8.1 Control and user plane paths at call establishment
Figure 6.4.8.1-1 shows the control plane and user plane paths established for
1\. An IMS session initiated on behalf of a CS UE served within the IMS HNB
subsystem;
2\. A CS call initiated while the CS UE is served within the IMS HNB subsystem
for a service to be provided by the CS core network rather than IMS, e.g.,
emergency or CS data/fax; and
3\. A CS call initiated while the UE is served within the macro network.
Each heavy double-arrowed curve represents both the control plane and user
plane paths for one of the cases. The dashed lines between the MSCs in the
figure indicate that the scenario may be realized with either two separate
MSCs or a single MSC.
Figure 6.4.8.1-1: Control and user plane paths at call establishment
#### 6.4.8.2 Control and user plane paths after handover of CS only calls
Figure 6.4.8.2-1 shows the control plane and user plane paths established for:
1\. A CS UE receiving CS services for a call that initiated in the IMS HNB
subsystem without any concurrent IMS services via the I2 reference point on
the IHAF and after handover to the macro network using existing handover
procedures; and
2\. A call beginning in the macro network after handover to the IMS HNB
subsystem using existing handover procedures.
The procedures needed to realize these handover scenarios are described in
subsequent clauses.
Each heavy double-arrowed curve represents both the control plane and user
plane paths for one of the cases. The dashed lines between the MSCs in the
figure indicate that the scenario may be realized with either two separate
MSCs or a single MSC.
Figure 6.4.8.2-1: Control and user plane paths after handover of CS only calls
#### 6.4.8.3 Control and user plane paths after handover of IMS session
Figure 6.4.8.3-1 shows the control plane and user plane paths established for
1\. A CS UE being served in a HNB and receiving IMS services via the I2
reference point on the IHAF after handover to the macro network; and
2\. A CS UE being served in a HNB and receiving CS services while concurrently
receiving IMS services via the I2 reference point on the IHAF, after handover
to the macro network. As described in TS 23.009 [15], to maintain continuity
of location reporting in this case, the IHAF re-issues towards the target MSC
and RNS any Location Reporting Control messages previously issued to the HNB
from the Visited MSC.
The procedures needed to realize these handover scenarios are described in
subsequent clauses. Note that both of these configurations also apply after
subsequent handover to another macro MSC.
Each heavy double-arrowed curve represents both the control plane and user
plane paths for one of the cases. The dashed lines between the MSCs in the
figure indicate that the scenario may be realized with either two separate
MSCs or a single MSC.
A user plane path may bypass a network element if the network element is not
required to perform any user plane function for the media flow.
For example, in use case 1 of figure 6.4.8.3-1, the IMS HNB GW is not required
to perform any user plane interworking or anchoring function if the user plane
on Nb uses a PS media transport protocol option that is compatible with Mb. In
this case, the user plane flow is identical on the Mb and Nb interfaces and
the IHAF is completely transparent to the flow.
In use case 2 of figure 6.4.8.3-1, the IHAF must anchor the user plane since
it cannot initiate changes to the Iu-cs user plane with the MSC.
Figure 6.4.8.3-1: Control and user plane paths after handover of IMS session
### 6.4.9 Handover to macro
#### 6.4.9.1 Handover to macro of CS call
If a handover from HNB to macro is required for a CS UE with a CS call in
progress, and the UE is receiving no concurrent IMS services via the I2
reference point on the IHAF, the HNB sends a relocation required message to
the IHAF, which follows standard HNB GW procedures to forward the message
transparently to the Visited-MSC via Iu-cs. The IHAF and Visited-MSC follow
the RNS-A and 3G_MSC-A roles, respectively, in Figure 11 of TS 23.009 [15] for
handover to UMTS. Handover to GSM follows a similar procedure based on TS
23.009 [15], not described here or in the remaining sub-clauses on handover.
#### 6.4.9.2 Handover to macro of IMS session
Figure 6.4.9.2-1 shows the successful procedure for intersystem handover from
the HNB-A access network to the RNS-B access network for a UE receiving IMS
services via the I2 reference point on the IHAF-A. The same procedure also
applies if there is a concurrent CS call in progress via the Visited-MSC
(which may be identical with MSC-B in the figure). This procedure avoids
anchoring of the user plane in the IHAF-A for IMS sessions.
This figure is based on the successful Inter-3G_MSC SRNS relocation procedure
shown in Figure 30 of TS 23.009 [15] with the addition of the handover
messaging with the UE derived from Figure 11 of TS 23.009 [15] and optional
SIP 3pcc messaging with the remote UE-C to avoid media anchoring. The
procedure is adapted from the procedure in Figure 30 of TS 23.009 [15], with
the HNB-A and IHAF-A playing the roles of the RNS-A and 3G_MSC-A,
respectively. Messages 8, 9, 19 and 20 show SIP messages on Nc that are
equivalent in function to the ISUP messages in Figure 30. MAP messages (e.g.
messages 2 and 6) use the E interface between the IHAF-A and MSC-B. Refer to
the corresponding text in TS 23.009 [15] for a detailed explanation of the
procedure, except for optional messages 3, 7 and 12, which are described below
the figure.
If after completion of this relocation procedure, the UE or network initiates
a CS service for the UE that requires service differentiation based on
location area, the Visited MSC may receive location area information via the
Iu-cs interface that is normally associated with the E interface rather than
the Iu-cs interface. The Visited MSC is expected to correctly perform any
service differentiation irrespective of which interface is used to provide the
location area information.
Figure 6.4.9.2-1: HNB to RNS Relocation with hard handover for UE in an IMS
session via IHAF
3\. When IHAF-A receives the Iu relocation required message from the HNB, if
all existing concurrent CS calls are on hold, the IHAF-A sends an empty SIP
re-INVITE request towards the remote party of the IMS session. The purpose of
the re-INVITE request is to avoid anchoring of the media in the IHAF-A and to
initiate the movement of the local RTP endpoint of the media from IHAF-A to
MSC-B. Steps 3, 7 and 12 do not apply if a concurrent CS call is in the active
state and all SIP sessions are on hold.
7\. Upon receipt of the empty SIP re-INVITE request, the remote UE-C responds
with SIP 200 OK response that includes an SDP offer.
8\. When the IHAF-A receives both the MAP prepare handover response from MSC-B
and the SIP 200 OK response from remote UE-C, it sends the SIP INVITE request
to MSC-B to establish the handover trunk. Instead of including SDP for the
media anchor associated with IHAF-A, this SIP INVITE request includes the SIP
offer received from remote UE-C. If Steps 3, 7 and 12 do not apply to the
procedure, the IHAF-A does not wait for the SIP 200 OK response from remote
UE-C, and includes SDP for its media anchor in the SIP INVITE request to
MSC-B.
9\. MSC-B responds with a SIP 183 Session Progress response including an SDP
answer from MSC-B.
12\. The IHAF-A sends a SIP Ack request including the SDP answer from MSC-B
towards the remote UE-C at the same time that it sends an Iu relocation
command towards the UE-A/B. Upon receipt of the SIP Ack request, the media
path is re-established between the remote UE-C and MSC-B. This occurs roughly
simultaneously with the retuning of the UE to RNS-B upon receipt of the
handover command in step 11, effectively synchronizing the media switching in
the network with the retuning of the UE.
#### 6.4.9.3 Subsequent SRNS relocation of session anchored in IHAF
Figure 6.4.9.3-1 shows the successful procedure for subsequent intersystem
handover from the RNS-B access network associated with MSC-B to the RNS-B\'
access network associated with MSC-B\' for a UE with handover signalling
anchored in IHAF-A. This procedure applies whether or not the user plane is
anchored in IHAF-A.
This figure is based on the successful procedure for subsequent SRNS
relocation from 3G_MSC-B to 3G_MSC-B\' shown in Figure 33 of TS 23.009 [15],
with the IHAF-A playing the role of 3G_MSC-A, and with the addition of
optional SIP 3pcc messages to connect remote media to MSC-B\' if it is not
anchored in IHAF-A. Refer to the corresponding text in TS 23.009 [15] for a
detailed explanation of the procedure, except for optional messages 5, 6 and
11, which are described below the figure.
Figure 6.4.9.3-1: Subsequent SRNS relocation from MSC-B to MSC-B\' for UE in
an IMS session via IHAF
5\. When IHAF-A receives the MAP prepare subsequent handover request message
from MSC-B, if the user plane is not anchored in IHAF-A, the IHAF-A sends an
empty SIP re-INVITE request towards the remote party of the IMS session. The
purpose of the re-INVITE request is to initiate the movement of the local RTP
endpoint of the media from MSC-B to MSC-B\'. Steps 5, 6 and 11 do not apply if
the user plane is anchored in IHAF-A.
6\. Upon receipt of the empty SIP re-INVITE request, the remote UE-C responds
with SIP 200 OK response that includes an SDP offer.
9\. When the IHAF-A receives both the MAP prepare handover response from
MSC-B\' and the SIP 200 OK response from remote UE-C, it sends the SIP INVITE
request to MSC-B\' to establish the handover trunk. Instead of including SDP
for the media anchor associated with IHAF-A, this SIP INVITE request includes
the SIP offer received from remote UE-C. If Steps 5, 6 and 11 do not apply to
the procedure, the IHAF-A does not wait for the SIP 200 OK response from
remote UE-C, and includes SDP for its media anchor in the SIP INVITE request
to MSC-B\'.
10\. MSC-B\' responds with a SIP 183 Session Progress response including an
SDP answer from MSC-B\'.
11\. The IHAF-A sends a SIP Ack request including the SDP answer from MSC-B\'
towards the remote UE-C at the same time that it sends the MAP prepare
subsequent handover response message to MSC-B. Upon receipt of the SIP Ack
request, the media path is established between the remote UE-C and MSC-B\'.
This occurs roughly simultaneously with the SRNS relocation to RNS-B\',
effectively synchronizing the media switching in the network with the SRNS
relocation.
### 6.4.10 Handover to HNB
#### 6.4.10.1 Handover to HNB of CS call
If a handover from a macro RNS to HNB is required for a UE with a CS call in
progress and no IMS session is in progress via the I2 reference point on the
IHAF for the UE, the MSC sends the relocation command to the IHAF via Iu-cs,
which then follows standard HNB GW procedures (to be specified in 3GPP Release
9) to forward the command to the HNB and UE. The Visited-MSC and IHAF follow
the 3G_MSC-A and RNS-B roles, respectively, in Figure 11 of TS 23.009 [15] for
handover from UMTS. Handover from GSM follows a similar procedure based on TS
23.009 [15], not described here or in the other sub-clauses on handover.
#### 6.4.10.2 Handover to HNB of session anchored in IHAF
##### 6.4.10.2.1 MSC recognizes intersystem handover scenario
Figure 6.4.10.2.1-1 shows the successful procedure for subsequent intersystem
handover from the RNS-B access network associated with MSC-B to the HNB-A
access network associated with IHAF-A for a CS UE with handover signalling
anchored in IHAF-A. This procedure applies whether or not the user plane is
anchored in IHAF-A. In this procedure, MSC-B recognizes that the target access
network HNB-A is associated with a previous intersystem relocation request.
This figure is based on the successful procedure for subsequent relocation
from 3G_MSC-B to 3G_MSC-A shown in Figure 32 of TS 23.009 [15], with the
IHAF-A playing the role of 3G_MSC-A, and with the addition of optional SIP
3pcc messages to reconnect remote media to IHAF-A if it is not already
anchored in IHAF-A. Refer to the corresponding text in TS 23.009 [15] for a
detailed explanation of the procedure, except for optional messages 3, 4 and
7, which are described below the figure. Note that this procedure requires the
Release 9 extensions being developed to support handover from macro to HNB in
the non-IMS HNB subsystem.
Figure 6.4.10.2.1-1: Subsequent relocation from MSC-B to IHAF-A for UE in an
IMS session via IHAF
3\. When IHAF-A receives the MAP prepare subsequent handover request message
from MSC-B, if the user plane is not anchored in IHAF-A, the IHAF-A sends an
empty SIP re-INVITE request towards the remote party of the IMS session. The
purpose of the re-INVITE request is to initiate the movement of the local RTP
endpoint of the media from MSC-B to IHAF-A. Steps 3, 4 and 7 do not apply if
the user plane is already anchored in IHAF-A.
4\. Upon receipt of the empty SIP re-INVITE request, the remote UE-C responds
with SIP 200 OK response that includes an SDP offer.
5\. When the IHAF-A receives the SIP 200 OK response from remote UE-C, it
sends the Iu relocation request message to the HNB-A to establish the user
plane on Iuh. If Steps 3, 4 and 7 do not apply to the procedure, the IHAF-A
does not wait for the SIP 200 OK response from remote UE-C.
6\. HNB-A responds with a Iu relocation request acknowledgment message.
7\. The IHAF-A sends a SIP Ack request including an SDP answer towards the
remote UE-C at the same time that it sends the MAP prepare subsequent handover
response message to MSC-B. The SDP answer in the SIP Ack request includes the
IHAF-A address for the user plane. Upon receipt of the SIP Ack request, the
media path is re-established between the remote UE-C and HNB-A. This occurs
roughly simultaneously with the retuning of the UE to HNB-A upon receipt of
the handover command in step 10, effectively synchronizing the media switching
in the network with the retuning of the UE.
##### 6.4.10.2.2 MSC recognizes intrasystem handover scenario
Figure 6.4.10.2.2-1 shows the successful procedure for intrasystem handover
from the RNS-B access network to the HNB-A access network associated with
IHAF-A for a CS UE with handover signalling anchored in IHAF-A. This procedure
applies whether or not the user plane is anchored in IHAF-A. In this
procedure, MSC-B recognizes that the target access network HNB-A is a directly
reachable access network via Iu-cs and performs an intrasystem handover
procedure rather than the intersystem procedure of the previous sub-clause.
This figure is based on the successful procedure for basic intra-3G_MSC SRNS
relocation combined with hard handover shown in Figure 11 of TS 23.009 [15],
with the RNS-B, MSC-B and IHAF-A playing the roles of RNS-A, 3G_MSC-A, and
RNS-B, respectively, with the addition of optional SIP 3pcc messages to
reconnect remote media to IHAF-A if it is not already anchored in IHAF-A, and
with the addition of messages 17, 18 and 19, which remove an extraneous user
plane loop between IHAF-A and MSC-B. Refer to the corresponding text in TS
23.009 [15] for a detailed explanation of the procedure, except for optional
messages 5, 6 and 11, and required messages 17, 18 and 19, which are all
described below the figure.
NOTE: This procedure requires the Rel‑9 extensions being developed to support
handover from macro to HNB in the non-IMS HNB subsystem.
Since this procedure must follow the handover to macro scenario of clause
6.4.8.2, there is an Nb user plane connection established with MSC-B by the
previous procedure, and then there is an Iu user plane connection established
between the MSC-B and IHAF-A by messages 2 and 8 of this procedure. There is
no need to maintain this user plane \"loop\" between the IHAF-A and MSC-B or
the corresponding control plane \"loop\" after the procedure completes.
Messages 17-19 serve to remove the unnecessary control and user plane
connections on Iu-cs, E, Nc and Nb.
Figure 6.4.10.2.2-1: Intrasystem relocation from RNS-B to HNB-A for UE in an
IMS session via IHAF
3\. When IHAF-A receives the Iu relocation request message from MSC-B, if the
user plane is not anchored in IHAF-A, the IHAF-A sends an empty SIP re-INVITE
request towards the remote party of the IMS session. The purpose of the re-
INVITE request is to initiate the movement of the local RTP endpoint of the
media from MSC-B to IHAF-A. Steps 3, 4 and 7 do not apply if the user plane is
already anchored in IHAF-A.
4\. Upon receipt of the empty SIP re-INVITE request, the remote UE-C responds
with SIP 200 OK response that includes an SDP offer.
5\. When the IHAF-A receives the SIP 200 OK response from remote UE-C, it
sends the Iu relocation request message to the HNB-A to establish the user
plane on Iuh. If Steps 3, 4 and 7 do not apply to the procedure, the IHAF-A
does not wait for the SIP 200 OK response from remote UE-C.
6\. HNB-A responds with a Iu relocation request acknowledgment message.
7\. The IHAF-A sends a SIP Ack request including an SDP answer towards the
remote UE-C at the same time that it sends the Iu relocation request
acknowledgment message to MSC-B. The SDP answer in the SIP Ack request
includes the IHAF-A address for the user plane. Upon receipt of the SIP Ack
request, the media path is re-established between the remote UE-C and HNB-A.
This occurs roughly simultaneously with the retuning of the UE to HNB-A upon
receipt of the handover command in step 10, effectively synchronizing the
media switching in the network with the retuning of the UE.
17\. When IHAF-A receives the Iu relocation complete message from HNB-A, it
sends the MAP send end signal response message to MSC-B to initiate removal of
the signalling plane connection for UE-A/B between the IHAF-A and MSC-B and to
initiate removal of the corresponding resources in MSC-B. MSC-B no longer has
a role in support of the UE.
18\. MSC-B initiates release of the Iu connection between MSC-B and IHAF-A.
19\. IHAF-A initiates release of the Nc/Nb session between IHAF-A and MSC-B.
### 6.4.11 Supplementary services
#### 6.4.11.1 Overview
Except for Call Waiting and Call HOLD services described in the following sub-
clauses, all MMTEL supplementary services are provided to a UE in IMS
session(s) via the IHAF according to I2 procedures defined in TS 23.292 [6].
#### 6.4.11.2 Call Waiting
As long as there are no concurrent CS calls being handled by the CS CN, the
IHAF provides Call Waiting service to a UE according to I2 procedures defined
in TS 23.292 [6]. In the presence of CS calls handled by the CS CN, IMS must
rely on busy or release indications from the UE, HNB and/or IHAF, as guided by
local policy, since IMS cannot have a full view of the user busy condition to
apply network-determined user busy (NDUB).
#### 6.4.11.3 Call HOLD
##### 6.4.11.3.1 CS call
Call HOLD service for a CS call follows existing procedures.
##### 6.4.11.3.2 IMS session via IHAF for UE in HNB
Call HOLD service for a UE in HNB with an IMS session via IHAF is provided via
the IHAF according to I2 procedures defined in TS 23.292 [6]. The IHAF
manipulates the SDP offer to assure that no RTP or RTCP packets are exchanged
between the endpoints while the call is on hold.
##### 6.4.11.3.3 IMS session via IHAF for UE in macro
Call HOLD service for a UE served in a macro cell with an IMS session via IHAF
is provided via the IHAF according to I2 procedures defined in TS 23.292 [6].
The IHAF manipulates the SDP offer to assure that no RTP or RTCP packets are
exchanged between the endpoints while the call is on hold. Figure 6.4.11.3.3-1
shows additional interworking required at the IHAF between I2 and Nc. The
figure applies to both HOLD and RESUME signalling.
Figure 6.4.11.3.3-1: HOLD/RESUME signalling for IMS session via IHAF for UE in
macro
1\. When the IHAF-A receives indication of a HOLD or RESUME request from the
CS UE-A/B, the IHAF-A sends a SIP re-INVITE request without SDP to MSC-B. The
message solicits an SDP offer from MSC-B for forwarding to remote UE-C.
2\. MSC-B sends a SIP 200 OK with SDP offer to IHAF-A. The SDP offer includes
information about the user plane endpoint for UE-A/B in MSC-B.
3\. IHAF-A sends a SIP re-INVITE request with SDP offer from MSC-B towards the
remote UE-C. IHAF-A modifies the SDP offer as necessary to signal call HOLD or
call RESUME and to set the appropriate bandwidth for the media stream.
4\. Remote UE-C responds with a SIP 200 OK response including the SDP answer.
5\. IHAF-A forwards the SDP answer from remote UE-C to MSC-B in the SIP Ack
request.
6\. IHAF-A completes the SIP re-INVITE transaction with the remote UE-C by
sending it a SIP Ack request without SDP.
#### 6.4.11.4 User configuration of communication service settings
Options for user configuration of supplementary services are described in TS
23.292 [6]. If the MSCs in the network support the communication setting
conversion function option using the I3 reference point for a UE in the macro
network, then the Visited MSC also provides the I3 reference point while the
UE is served in the HNB subsystem.
## 6.5 Void
## 6.6 Alternative 6: Consolidated Architecture with SIP UA in HNB
### 6.6.1 Reference Architecture
Figure 6.6.1-1 shows the reference architecture that supports IMS HNBs.
Figure 6.6.1-1: Reference Architecture
The IMS capable HNB subsystem provides direct access to IMS through the Hm
reference point and provides also access to IMS through the Gi/SGi reference
point (not shown in Figure 6.6.1-1). Access to IMS through Gi/SGi is provided
for supporting UEs with IMS capabilities. On the other hand, access to IMS
through Hm is provided for supporting UEs that use typical CS signalling
(based on TS 24.008 [4]) for originating/terminating CS services. The IMS HNB
provides the necessary interworking functionality that interworks the UE CS
signalling (TS 24.008 [4]) over Uu with the IMS signalling over Hm. This
interworking functionality is similar to the interworking functionality
provided by an MSC Server enhanced for ICS, as specified in TS 23.292 [7].
NOTE 1: The Hm reference point encompasses only the IMS specific control plane
functionality and assumes an underlying IP connectivity between the IMS HNB
and IMS. This IP connectivity is provided by the Iuh interface (the lower
layers of the protocol stack) between the IMS HNB and IMS HNB GW and by the IP
transport between the IMS HNB GW and IMS. Details of this are provided in
clause 6.6.4.
Editor\'s Note: Whether or not the IMS HNB-GW should also support a direct Iu-
cs interface with MSCs not enhanced for IMS HNBs to improve deployment
flexibility is FFS.
### 6.6.2 Functional Elements
#### 6.6.2.1 IMS HNB
For the IMS Capable HNB Subsystem, the HNB, as defined in TR 23.830 [5], is
further enhanced to contain a Home User Agent (HUA) function.
The Home User Agent (HUA) function includes a SIP User Agent that operates as
per the procedures specified in TS 23.228 [11] and TS 24.229 [12]. The HUA
acts as a CS-to-IMS interworking function providing IMS SIP UA behaviour on
behalf of a UE that uses CS procedures for voice/video service. Specifically,
the HUA does the following:
\- Performs IMS registration upon CS Attach.
\- Interworks CS session/service control with IMS session/service control over
the Hm reference point. This involves protocol interworking between TS 24.008
[4] Call Control (from/towards the UE) and 3GPP SIP (from/toward the IMS
core). Procedures for such interworking are analogous to those defined in TS
23.292 [6] for the MSC Server Enhanced for ICS.
\- Interworks CS user plane data with packet media over the IP transport
provided by the Iuh reference point. This involves protocol interworking
between CS radio interface data frames and RTP.
\- Initiates procedures for handover from IMS HNB to the macro CS network over
the Iuh reference point.
\- Routes requests for services that do not have an equivalent in IMS or are
not otherwise implemented within HUA (e.g., Circuit Switched Data/Fax) to the
MSC Server Enhanced for IMS HNB. This assumes the capability within the HUA to
determine the appropriate domain to handle the service request that is
incoming from the UE; such capability may be informed by operator policy.
\- Implements a communication service setting conversion function between CS
signalling (e.g. as described in TS 24.010 [18] for systems based on TS 24.008
[4]) and communication service setting procedures (as defined in TS 24.173
[16]). This assumes the capability within the HUA to configure through
operator policies which communication services settings to be interwork with
IMS.
#### 6.6.2.2 IMS HNB-GW
The IMS HNB-GW is based on the HNB-GW according to TR 23.830 [5]. For the IMS
Capable HNB Subsystem, the IMS HNB-GW provides in addition packet data gateway
functionality that supports the Hi reference point. The functionality provided
by the IMS HNB-GW for accessing IMS (via Hi) is similar to the functionality
provided by a PDG for accessing IMS (via Wi). In other words, the IMS HNB-GW
terminates the IPsec tunnel with the IMS HNB (as per TR 23.830 [5]) and
provides a simple relay/routing function to route IP datagrams between the IMS
HNB and IMS.
#### 6.6.2.3 MSC Server Enhanced for IMS HNB
This entity is an MSC Server that has been enhanced to support Single Radio
Voice Call Continuity (SRVCC) per TS 23.216 [10] and functions as needed from
IMS Centralized Services per TS 23.292 [6]. In addition, this architecture
assumes that the MSC Server is further enhanced to support some IMS HNB
related functionality. More specifically, the key functions of the MSC Server
Enhanced for IMS HNB are to:
\- Perform CS Location Updates with CS authentication.
\- Assist the IMS Capable HNB Subsystem in execution of handover to the macro
CS network; and interwork CS session/service control with IMS session/service
control over the I2 reference point after the session has been transferred to
macro CS.
\- Satisfy requests for services that do not have an equivalent in IMS (e.g.,
Circuit Switched Data/Fax) or are not otherwise implemented within HUA.
\- As an option, implements a communication service setting conversion
function between CS signalling (e.g. as described in TS 24.010 [18] for
systems based on TS 24.008 [4]) and communication service setting procedures
(as defined in TS 24.173 [16]).
### 6.6.3 Reference Points
#### 6.6.3.1 Hm reference point
This is the reference point between the HUA and the Proxy-CSCF element that is
defined in TS 23.228 [11]. The Hm reference point is based on the Gm reference
point as defined in TS 23.002 [9], but without the need of a dedicated IPsec
tunnel per HUA, and I2 as defined in TS 23.292 [6]. Signalling messages
communicated on the Hm reference point utilize the Iuh and the Hi interface
for transport.
IMS authentication of the HUA is achieved inline with the principles of early
IMS security according to TS 33.203 [21], whereby a secure binding in the HSS
between the IMS HNB identity, IMSI, and the HUA IP address is created and
verified before access to IMS from an IMS HNB is authorized. Further details
are provided in clause 1.5.1.
The Hm reference point supports also functionality based on the I3 reference
point described in TS 23.292 [6] and it is used to interwork CS signalling
(e.g. as described in TS 24.010 [18] for systems based on TS 24.008 [4]) and
communication service setting procedures (as defined in TS 24.173 [16]).
#### 6.6.3.2 Hi reference point
This is the reference point between the IMS HNB GW and a packet data network,
e.g. the entry point of IMS, RADIUS Accounting or Authentication, DHCP. The Hi
reference point is similar to the Gi reference points provided by the PS
domain.
It is used to provide IP access for control plane and user plane of IMS
sessions established by the IMS HNB on behalf of the CS UE. Use of the Hi on
behalf of a UE that uses CS procedures for voice service obviates the need to
establish on behalf of the UE a standard PS domain user context over the Iu-ps
reference point.
IMS services offered by the IMS HNB via the Hi reference point are addressable
through the operator\'s public addressing scheme or through the use of a
private addressing scheme.
#### 6.6.3.3 Iuh reference point
This is the reference point between the (IMS) HNB and the (IMS) HNB-GW as
defined in TR 23.830 [5]. The Iuh reference point supports the establishment
of an IP-based security association between the (IMS) HNB and the (IMS) HNB-
GW, and is also used to transport Hm messages to the IMS.
#### 6.6.3.4 Iu-cs reference point
This is the reference point between the (IMS) HNB-GW and the MSC Server.
Enhanced procedures (e.g., for handover to macro cellular) are specified for
the HNB and the MSC Server Enhanced for IMS HNB using standard protocols.
Editor\'s Note: It is FFS whether Iu-cs has to be enhanced to support the
handover procedures.
#### 6.6.4 Protocol Architecture
Figure 1.4-1 presents the user plane protocol stack for CS services (e.g.
voice calls) handled in IMS.
Figure 6.6.4-1: User Plane Protocol Architecture
The CS user plane is translated in the IMS HNB into RTP traffic (e.g. VoIP)
and is securely transported over the Iuh user plane interface to the IMS HNB
GW, which provides direct IP access to IMS via the Hi interface.
NOTE: This solution avoids unnecessary tunnelling overhead and PS bearers
between the IMS Capable HNB subsystem and SGSN/GGSN or (S-GW/P-GW).
The remote IP layer is used by the HUA to be addressable in the external
packet data networks, i.e. it represents the HUA IP address. The IMS HNB GW
routes the remote IP packets without modifying them.
The tunnelling layer (IPSec) is used for secure communication between the
(IMS) HNB and (IMS) HNB GW.
Figure 1.4-2 presents the control plane protocol stack for CS services handled
in IMS.
Figure 6.64-2: Control Plane Protocol Architecture
The CS control messages for which equivalent IMS functionality exists are
translated into IMS/SIP signalling and also transported over the Iuh user
plane interface. The IMS signalling is transported transparently through the
HNB GW.
Figure 6.6.4-3 shows the control plane protocol stack for CS
services/procedures for which no equivalent IMS services/procedures exist.
Figure 6.6.4-3: Control Plane Protocol Architecture for Mobility and legacy CS
services
This protocol stack is identical to the control plane stack for the general
(non-IMS) HNB as described in TS 25.467 [8].
For the IMS HNB, it is only used for the control of legacy CS services, for
which no equivalent IMS service exists, and for CS
registration/authentication, mobility management and handover procedures.
Further details are provided in the individual information flows in clause
1.5.
### 6.6.4a Signalling and Bearer Paths
#### 6.6.4a.1 Paths for CS Attach/IMS Registration
The following figure illustrates the signalling paths for the following
situations:
\- CS Location Update with authentication upon network attach of a CS UE
through IMS-HNB (dashed line)
\- IMS registration of a CS UE through the IMS-HNB (solid line)
Figure 6.6.4a.1-1: Interworking of IMS at HNB -- Paths for CS Attach and IMS
registration
#### 6.6.4a.2 Paths for UE in CS Call
The following figure illustrates the signalling and bearer paths when an IMS-
HNB-attached UE, which uses CS procedures for voice service, is involved in a
voice call.
Figure 6.6.4a.2-1: Interworking of IMS at HNB -- Paths for UE in CS voice call
### 6.6.5 Information Flows
#### 6.6.5.1 Registration of CS UE in IMS
In order to use IMS to provide the services for the CS UE within the IMS HNB
coverage, the IMS HNB shall register the CS UE in IMS when the UE camps on the
IMS HNB and attaches to the CS network.
Figure 6.6.5.1-1 Registration of CS UE in IMS
NOTE: The assumption in this flow is that IMS registration is triggered by the
initial UE NAS message. The above figure shows an example when the initial NAS
message is a LAU request.successful.
1\. The IMS HNB performs the HNB registration procedure to the HNB-GW
according to TS 25.467 [8].
2\. When the UE attempts to access the HNB via an initial NAS message (e.g.,
LAU or RAU Request) and there is no context in the HNB allocated for that UE,
the HNB performs the UE Registration to the HNB-GW according to TS 25.467 [8]
and the CS update location procedures are executed via the MSC Server enhanced
for HNB and HSS (including HLR) and/or previous VLR with standard procedures.
In this step, the IMS HNB creates and stores a security context for the UE so
that it can later perform NAS signalling with the UE without the MSC
intervention.
3\. Upon successful CS Attach, the IMS HNB requests IMS Access Authorization
by providing necessary identifying information for the IMS HNB and UE, e.g.,
HNB Identity, IMSI, etc. to a RADIUS server associated with HSS.
This will be based on equivalent procedures as defined for GIBA in TS 33.203
[21] between the GGSN and a RADIUS server associated with the HSS for early
IMS security. For this purpose the IMS HNB behaves as a RADIUS/Diameter
client.
4-5. The HSS grants the IMS access authorization and stores the HUA IP address
after verifying one or more of the following criteria, as established by
operator policy:
\- access is granted to the user via this IMS based HNB subsystem;
\- the user has been authenticated by the CS Core Network;
\- the CS Attach has been performed through the HNB requesting the IMS Access
Authorization.
NOTE: The HSS behaviour described above is new functionality. It is used to
support IMS access authentication with an approach similar to \"early IMS\"
security.
6\. HNB initiates IMS Registration including HUA IP address as the contact
address and IMSI derived IMPU. It does not include the authorization header.
The IMS Register request is processed according to the already defined early
IMS security procedures defined in TS 33.203 [21]. In case the UE was already
IMS registered via another IMS HNB, IMS will de-register the UE from the
previous IMS HNB.
NOTE: The HNB-GW implements measures to prevent IMS SIP signalling from an HNB
that has not performed a successful IMS Authorization Request procedure.
7\. Completion of standard IMS registration procedures. Execution of IMS AKA
is bypassed for this registration event.
#### 6.6.5.2 Voice call origination from an IMS HNB
The figure below shows the signalling flow that takes place when a voice call
is originated from a UE that camps on an IMS HNB. The UE is already registered
to IMS from the IMS HNB, e.g. because it has previously performed a LAU
procedure.
Figure 6.6.5.2-1: Message flow for voice call origination from an IMS HNB
1\. The UE decides to initiate a voice call by using the normal 24.008 CC
procedures. The UE establishes a normal RRC connection with the IMS HNB.
2\. The UE sends a CM Service Request as per TS 23.060 [14] The IMS HNB
receives the CM Service Request and decides to forward this message to the MSC
Server, e.g. in order to have the MSC Server perform access control and
confirm that the UE is allowed to use the selected CSG cell.
As per normal procedures, the MSC Server may decide to authenticate the UE. If
the UE is also a CSG capable Rel‑8 UE, the MSC performs access control as
specified in TR 23.830 [5] in order to confirm that the UE is allowed to use
services in the selected CSG cell.
NOTE: It is FFS under what circumstances the IMS HNB can buffer the CM Service
Request and not forward it immediately to the MSC Server Enhanced for HNB. If
the CM Service Request in not forwarded to the MSC Server Enhanced for HNB,
then access control cannot be done in the core network, as required for CSG-
capable Rel-8 UEs.
3\. In case the UE is correctly authenticated and authorized to use the
selected CSG cell, the normal Security Mode procedure is executed and a
security context for this UE is created/updated in the IMS HNB.
4\. The UE sends a Setup message that contains the Bearer Capabilities of the
impeding voice call and the MSISDN of the called party, as per TS 24.008 [4].
5\. The IMS HNB decides if the requested service can be provided by IMS. If
the requested service can be provided by IMS and if an IMS Registration exists
for this UE, the IMS HNB decides to take over the control of this call.
6\. The IMS HNB sends an Iu Release Request and the Iu-cs signalling
connection is released.
7\. The IMS HNB maps the received Setup message to an IMS Invite message and
sends this message to IMS. The media transport information in the SDP payload
includes the _HUA_ IP address of the IMS HNB. Security procedures similar to
the \"early IMS\" security procedures are used to authenticate the Invite
message.
NOTE: All SIP messages go through the IMS HNB GW because the IMS HNB GW is the
endpoint of the IPsec tunnel. The IMS HNB GW does not process these messages
however; it only serves as a normal IP transport element.
8\. The call is connected with normal interworking procedures between SIP and
24.008. The alerting tone can be generated by the IMS HNB if necessary.
9\. The user plane is established. The IMS HNB GW does not act as an RTP relay
and does not provide RTP functionality. User-plane traffic goes through the
IMS HNB GW since the IMS HNB GW terminates the IPsec tunnel.
NOTE: LI for VoIMS user plane traffic can take place on HNB GW in the same way
this is handled on PDG/GGSN.
#### 6.6.5.3 Voice call termination to an IMS HNB
This section specifies the procedures that take place when a MT voice call
request arrives for a UE that is registered to IMS through an IMS HNB.
It is assumed that:
\- the MT voice call request arrives via IMS (see Note 1);
\- the UE is in Idle mode when the MT voice call request arrives;
\- when the MT voice call request arrives, the UE may still be in the coverage
of IMS HNB or may have moved to a macro cell controlled by the MSC Server
Enhanced for IMS HNB (see Note 2).
NOTE 1: When a MT voice call request arrives through the CS domain, then,
either the call can be delivered to UE by using the normal CS call control
procedures (via Iu-cs), or the call can be redirected to IMS by using e.g.
CAMEL triggers. The UE can be provisioned with Terminating CAMEL Subscription
Information in the HSS so that, when a MT call arrives at the MSC, a
forwarding number is obtained from gsmSCF and the MSC forwards the call to
this number, which points to an IMS network element. The details are FFS.
NOTE 2: The UE does not perform a Location Area Update when it reselects a
macro cell that is controlled by the MSC Server Enhanced for IMS HNB. This is
particularly important for minimizing the MM signalling pertaining to mobility
to/from CSG cells. However, if the UE reselects a macro cell that is
controlled by an MSC Server other than the MSC Server Enhanced for IMS HNB,
then the UE must do a LAU in order to attach to this MSC Server.
Figure 6.6.5.3-1 shows the main steps involved when a MT voice call arrives
for the UE via IMS.
Figure 6.6.5.3-1: Voice call termination for a UE registered to IMS by an IMS
HNB
1\. A new MT voice call request is received by SCC AS. After invoking the
terminating access-domain selection (T-ADS) function, the SCC AS decides to
route the request to the IMS HNB contact address. Since the UE is in Idle
mode, the IMS HNB starts paging the UE with the normal CS paging procedures.
At the same time, the IMS HNB triggers a paging procedure at the MSC Server
Enhanced for IMS HNB as described in step 2.
2\. The IMS HNB sends a new INVITE request to the MSC Server Enhanced for IMS
HNB in order to start paging the UE also in the neighbour macro cells. This is
required because the IMS HNB does not know if the UE is still in the coverage
area of the IMS HNB or if it has reselected to a neighbour macro cell that
belongs to the same LA. Therefore, the UE is paged in parallel in the entire
LA including the CSG cell.
NOTE: If the CSG cell is deployed in a separate/different LA from the macro CS
cells, then this parallel paging by the MSC Server Enhanced for HNB is not
required.
Editor\'s Note: The relationship between the SDP is message 2 and the SDP in
message 1 needs further study.
3\. If the UE is still in the IMS HNB coverage, it establishes an RRC
connection with the IMS HNB and responds to the paging sent in step 1.
Subsequently, the normal call control messages (as per TS 24.008) are
exchanged between the UE and the IMS HNB, in order to setup the voice call.
4\. After the IMS HNB finds out that the UE is still in the IMS HNB coverage
(e.g. after establishing the RRC connection or after receiving the paging
response from the UE), the IMS HNB cancels the INVITE request sent to MSC
Server Enhanced for HNB in step 2. As a result, the MSC Server Enhanced for
HNB stops paging the UE in the macro cell.
5\. After the IMS HNB receives the CONNECTED message from the UE (i.e. the
user has answered the call), the IMS HNB responds with a 200 OK to the INVITE
received in step 1.
6\. The user plane is setup as normally and voice communication between the UE
and the remote party is established.
7\. If the UE has reselected a macro cell, it establishes an RRC connection
with the UTRAN/GERAN radio access network and responds to the paging sent in
step 2. Subsequently, the normal call control messages (as per TS 24.008) are
exchanged between the UE and the MSC Server Enhanced for HNB in order to setup
the voice call.
8\. When the MSC Server Enhanced for HNB finds out that the UE is in a macro
cell (e.g. when receiving the paging response or when the call is connected),
it responds to the IMS HNB with a message that stops paging in the IMS HNB.
For example, the MSC Server Enhanced for HNB responds with a 200 OK after the
call is connected.
9\. The IMS HNB responds to the INVITE received in step 1 with a 200 OK
message. The session description protocol (SDP) in this message contains the
media address of the CS domain media gateway (CS MGW), so that subsequent
voice traffic flows between the remote party and the CS MGW.
10\. The IMS HNB may trigger IMS deregistration (e.g. based on local
configuration) to deregister the UE from IMS. Before deregistration however,
the session leg between the MSC Server Enhanced for HNB and the SCC AS
(established in step 8) should be bind to the remote leg, between the remote
party and the SCC AS. The IMS deregistration however is optional in this step
and can be skipped according to operator policy.
11\. The user plane is setup as normally and voice communication between the
UE and the remote party is established through the CS domain.
Editor\'s note: Is it FFS if the IMS HNB needs to be removed from the
signalling path when the UE camps on the macro cell (case 2).
#### 6.6.5.4 Idle-Mode Mobility Procedures
##### 6.6.5.4.1 Idle-mode mobility from IMS HNB to Macro CS
When the UE moves from an IMS HNB to a macro-cell, the HUA registration will
be removed from IMS as the re-registration timer expires in the S-CSCF. The
IMS HUA will then be informed about the deregistration via a reg-event package
notification.
**If the MSC that covers the macro-cell towards which the UE has moved is
enhanced for ICS, both the HUA registration and the ICS MSC registration will
coexist in IMS, until the IMS HUA deregistration has occurred in IMS.**
##### 6.6.5.4.2 Idle-mode mobility from Macro CS to IMS HNB
When the UE enters the IMS HNB coverage and the LA of the IMS HNB is different
from the LA of the macro cell, the UE performs a Location Area Update, which
triggers, the UE Registration procedure as defined in clause 5.1 of TS 25.467
[8] and the IMS Registration of the HUA according to clause 6.6.5.1.
In case the IMS HNB is configured to be part of the same LA as the
neighbouring macro cells, the IMS Registration of the HUA according to clause
6.6.5.1 takes place subsequently to the UE Registration procedure defined in
TS 25.467 [8].
If the MSC that covers the macro-cell towards which the UE has moved is
enhanced for ICS, both the HUA registration and the ICS MSC registration will
coexist in IMS, until the IMS HUA deregistration has occurred in IMS.
##### 6.6.5.4.3 Idle-mode mobility from IMS HNB to IMS HNB
When the UE enters the IMS HNB coverage and the LA of the target IMS HNB is
different from the LA of the source IMS HNB, the UE performs a Location Area
Update, which triggers the UE Registration procedure as defined in clause 5.1
of TS 25.467 [8] and the IMS Registration of the HUA according to clause
6.6.5.1.
In case the target IMS HNB is configured to be part of the same LA as the
source IMS HNB, the IMS Registration of the HUA according to clause 6.6.5.1
takes place subsequently to the UE Registration procedure defined in TS 25.467
[8].
As the IMS HNB does not apply the mechanism for simultaneous registrations for
the identities it uses, the registration of the target IMS HNB will overwrite
the one of the source IMS HNB in the S-CSCF.
#### 6.6.5.5 Handover from IMS HNB to Macro CS
This section proposes two alternative flows for handover from IMS HNB to macro
CS: one that requires changes to Iu‑cs reference point and another that does
not require changes to Iu-cs but uses direct SIP signalling between the IMS
HNB and the MSC Server Enhanced for HNB to perform the handover.
The decision of whether both alternatives can be used or one should be
selected as a way forward, is expected to be taken at a later stage.
Editor\'s Note: Handling of handover scenarios in which session control in IMS
takes place simultaneously with services control in CS domain (e.g. voice
session in IMS and data in CS domain) is FFS.
##### 6.6.5.5.1 Handover from IMS HNB to Macro CS Network with Iu-cs changes
Service continuity is provided when the UE session is handed over from the IMS
HNB coverage to Macro CS coverage.
The MSC Server enhanced for IMS HNB initiates the Session Transfer towards the
SCC AS upon receiving a handover request from the IMS HNB.
From the UE perspective, the call is handed over to the macro cell by use of
the standard CS handover procedure.
Figure 6.6.5.5.1.1-1: Handover of single IMS session from IMS HNB to macro CS
with Iu-cs changes
1\. UE-A sends measurement reports to IMS HNB.
2\. The IMS HNB decides to transfer the session to macro CS based on the
measurement reports.
3\. The IMS HNB sends a Handover Request (STN,TI, ...) message to the MSC
Server enhanced for IMS HNB.
NOTE: Step 3 may consist of one or more signaling messages on the Iu-CS
interface.
4\. The MSC Server enhanced for IMS HNB determines that this handover request
is a transfer from IMS HNB to macro CS and establishes the contexts for the
session based on the information received in the request.
NOTE: The details of how the session context is established at the MSC Server
are to be provided after the conclusion of mid call service continuity studies
in TR 23.838. The session context is to be established such that the UE-A
shall be able to use the same TI as allocated within the IMS HNB coverage to
perform service control after the call is handed over to macro CS.
The MSC Server then initiates a CS inter‑MSC handover request by sending a
Prepare Handover Request message to the target MSC.
5\. The Target MSC performs resource allocation with the target BSS.
6\. The Target MSC sends a Prepare Handover Response message to the MSC
Server.
7\. Establishment of circuit connection between the target MSC and the MGW
associated with the MSC Server, e.g. using ISUP IAM and ACM messages.
8\. The target MSC Server enhanced for IMS HNB sends a session transfer
request to IMS to initiate a session transfer according to procedures
specified in TS 23.237 [17]. For this, the MSC Server sends an INVITE (STN)
message to the I/S‑CSCF. The MSC Server includes the Instance ID into the
session transfer request if the IMS Registration of the MSC Server via I2 took
already place.
NOTE: This step can be started after step 6.
Editor\'s Note: Whether and when the IMS Registration of the MSC Server
enhanced for IMS HNB via I2 takes place is FFS and shall be aligned with the
resolution of this general issue for SR-VCC.
9\. Standard procedures are used at I/S-CSCF for routing of the INVITE to the
SCC AS.
10\. The SCC completes the establishment of the Access Leg to the MSC Server
enhanced for IMS HNB and triggers the completion of the IMS Session transfer
as according to TS 23.237 [17]. This step includes the update of the Remote
Leg and the release of the Source Access Leg towards the IMS HNB.
11\. The MSC Server enhanced for IMS HNB sends the Handover Command message to
the IMS HNB.
12\. The IMS HNB indicates to the UE to perform the handover by sending the
Handover Command.
13\. The UE tunes to the macro cell.
##### 6.6.5.5.2 Handover from IMS HNB to Macro CS Network with SIP signalling
Mobility of voice calls to macro cellular can also be supported by using
direct SIP signalling between the IMS HNB and the MSC Server Enhanced for IMS
HNB, as shown in the figure below. By using such direct SIP signalling, there
is no impact on the Iu-cs interface.
Figure 6.6.5.5.2-1 shows the main steps involved when a voice call is handed
over from an IMS HNB to a UTRAN/GERAN cell supporting voice on CS domain.
Similar steps are used when the UE has a voice call and a non-voice component
concurrently. This is further explained in the steps below.
Figure 6.6.5.5.2-1: Handover of single IMS session from IMS HNB to macro CS
with SIP signalling
1\. The UE has an ongoing voice call established with a Remote UE through the
IMS HNB. The IMS HNB is configured with a list of neighbour macro cells (as
specified in TS 25.467 [8]) and instructs the UE to measure the neighbour
cells and transmit measurement reports as per the normal procedures specified
in TS 25.331. Based on the measurement reports and on other implementation-
based criteria, the IMS HNB decides to handover the ongoing call to a
neighbour macro cell (either UTRAN or GERAN).
2\. The IMS HNB sends a SIP REFER request message to the MSC Server Enhanced
for IMS HNB. This message includes the STN-SR for this UE (which can be
received by IMS HNB during the IMS registration), as well as Session State
Info and other handover parameters (e.g the target UTRAN/GERAN cell identity),
required to complete the impeding handover. The Session State Info includes
information that is required in order to synchronize the call state machine in
the UE and in the CS domain. The REFER request message is routed to the MSC
Server Enhanced for IMS HNB with normal IMS routing procedures.
The REFER request creates an implicit subscription to the refer event and the
MSC Server Enhanced for IMS HNB is subsequently expected to send NOTIFY
requests to IMS HNB and order to report the progress of the refer procedure
(see RFC 3515).
3\. Based on the target cell identity the MSC Server Enhanced for IMS HNB
determines that the target cell is controlled by another MSC, referred to as
the Target MSC. This Target MSC does not implement any enhancements specific
to the IMS HNB. When the target cell is controlled by the MSC Server Enhanced
for IMS HNB, there is no need for a target MSC to be involved (i.e. the MSC
Server Enhanced for IMS HNB performs also the role of the Target MSC).
The MSC Server Enhanced for IMS HNB starts a normal inter-MSC handover
procedure (as per TS 23.009 [15]) by sending a Prepare HO Request message to
the Target MSC. The Target MSC prepares the appropriate resources in the
target cell and responds with a Prepare HO Response including a HO number.
Subsequently, a call is setup towards the HO number with the IAM / ACM
messages.
4\. The MSC Server Enhanced for IMS HNB responds to the REFER request with a
202 Accepted, as normally. This is an indication to the IMS HNB that the
handover request has been accepted and is being processed.
5\. The MSC Server Enhanced for IMS HNB starts the normal IMS session transfer
procedure (as per TS 23.237 [17]) by sending an INVITE request to the STN-SR
received from the IMS HNB. This request is routed to the SCC AS.
6\. The SCC AS starts updating the IMS leg with the Remote UE, as per TS
23.237 [17]. In parallel, the 100 Trying response from the SCC AS triggers the
MSC Server Enhanced for IMS HNB to send a NOTIFY (Trying) message to the IMS
HNB. This triggers the IMS HNB to send a HO Command to UE that contains the
target cell identity.
7\. The UE moves to the target call.
8\. The updating of the IMS leg with the Remote UE is completed and the SCC AS
responds with a 200 OK. Optionally, the SCC AS may send Session State Info to
the MSC Server Enhanced for IMS HNB, as per TS 23.838.
NOTE: Session State Info may be sent to the MSC Server Enhanced for IMS HNB
either in step 2 by the IMS HNB, or in step 8 by the SCC AS.
In addition, the MSC Server Enhanced for IMS HNB sends a NOTIFY (200 OK)
message to the IMS HNB to report that the session transfer initiated by the
REFER request in step 2 is completed.
9\. When the handover is completed the Target MSC sends an Answer message to
MSC Server Enhanced for IMS HNB, which triggers the user plane redirection.
10\. The new user plane path is established.
11\. The IMS HNB may start the IMS Deregistration after receiving the NOTIFY
(200 OK).
## 6.7 Alternative 7: Architecture for IMS-capable HNB subsystem with the SIP
UA in the HNB GW
### 6.7.1 Reference architecture
The IMS capable HNB subsystem provides direct access to IMS through the Hm
reference point. Access to IMS through Hm is provided for supporting UEs that
use typical CS signalling (based on TS 24.008 [4]) for originating/terminating
CS services. The IMS HNB GW provides the necessary interworking functionality
that interworks the UE CS signalling (TS 24.008 [4]) with the IMS signalling
over Hm. This interworking functionality is similar to the interworking
functionality provided by an MSC Server enhanced for ICS, as specified in TS
23.292 [6].
The MSC Server (e.g. as described in TS 23.002 [9]) may be enhanced for the
support of IMS capable HNB subsystem. In addition to the standard MSC Server
behaviour, an MSC Server which has been enhanced for to support functions as
needed from Single Radio Voice Call Continuity (SRVCC) per TS 23.216 [10] and
IMS Centralized Services per TS 23.292 [6].
Figure 6.7.1-1: Reference Architecture of IMS HNB
NOTE 1: The main difference with alternative 4 is the IMS HNB GW behaviour. In
Alternative 4, the IMS HNB GW performs Inter-MSC handover with Target MSC; In
this alternative, the MSC Server enhanced for IMS HNB performs the Inter-MSC
handover with Target MSC. The IMS HNB GW sends the handover request to MCS
server enhanced for IMS HNB via Iu-cs.
NOTE 2: The main difference with alternative 6 is the SIP UA location. In this
alternative, the SIP UA is inside the HNB GW. In alternative 6, the SIP UA is
in the HNB.
Editor\'s Note: Hm/Hi and associated security procedures are FFS.
### 6.7.2 Registration
#### 6.7.2.1 Registration of CS UE in IMS
In order to use IMS to provide the services for the CS UE within the IMS HNB
coverage, the IMS HNB shall attaches to the CS network when the UE camps on
the IMS HNB and registers the CS UE in IMS.
Figure 6.7.2.1-1: Registration of CS UE in IMS
1\. The HNB performs standard HNB registration as in 3GPP TS 25.467 [8].
2\. The CS network performs standard CS location update, authentication and
obtains subscriber data.
3\. As the Location Update Accept is returned to the UE, the IMS HNB GW
decides to initiate IMS registration for this subscriber. If the subscriber is
already registered via this IMS HNB GW, no IMS registration is sent.
NOTE 1: If the HNB and macro belongs to different LAC , the UE will sends a
NAS Location Area Update message to the MSC. The MSC notes the change in the
RNC-id and LAC. Otherwise, the MSC has no information about whether the UE is
under the HNB cover area. The distribution of LAC depends on the operators.
4\. The IMS HNB GW derives a domain name from the subscriber\'s identity (e.g.
IMSI) and discovers the address of the appropriate I‑CSCF/IBCF.
5\. The IMS HNB GW sends a SIP REGISTER to the IMS with a private and
temporary public user identity derived from the subscriber\'s IMSI as well as
an InstanceID. The REGISTER also contains information indicating the
capabilities and characteristics of the HNB GW as a SIP User Agent Client. The
I‑CSCF verifies that the incoming REGISTER origins from a trusted HNB GW (in
the same way it would check that a normal REGISTER origins from a trusted
P‑CSCF).
Editor\'s Note: It is FFS how the I2-based registration procedure applies to
Hm/Hi, which implies a connection to a P-CSCF, which is not in the figure.
6\. The I‑CSCF initiates standard procedures for S‑CSCF location/allocation.
7\. The I‑CSCF forwards the REGISTER to the S‑CSCF.
8\. The S‑CSCF identifies the REGISTER as being from the HNB GW. The S‑CSCF
skips any further authentication procedures and performs registration
procedures with the HSS.
9\. The S‑CSCF performs standard service control execution procedures. Filter
criteria directs the S‑CSCF to send a REGISTER to the SCC AS.
10\. IMS registration procedures are completed.
Editor\'s Note: It is FFS how to avoid and/or manage potentially simultaneous
IMS registrations from the HNB GW and the enhanced MSC server.
### 6.7.3 MO
#### 6.7.3.1 Voice call origination route to IMS
{width="5.759027777777778in" height="3.209722222222222in"}
Figure 6.7.3.1-1: Message flow for voice call origination from an IMS HNB
Pre-condition, the UE is already Registered at the HNB according to TS 25.467
[8].
1\. The UE decides to initiate a voice call by using the normal 24.008 CC
procedures. The UE establishes a normal RRC connection with the IMS HNB.
2\. The UE sends a CM Service Request as per TS 23.060 [14], which triggers
the establishment of an Iu-cs signalling connection. The IMS HNB GW receives
the CM Service Request and decides to forward this message to the Enhanced MSC
Server, e.g. in order to perform access control. As per normal procedures, the
MSC may decide to authenticate the UE. If the UE is also a CSG capable Rel-8
UE, the MSC performs access control as specified in TR 23.830 [5] in order to
confirm that the UE is allowed to use services in the selected CSG cell.
3\. In case the UE is correctly authenticated and authorized to use the
selected CSG cell, the normal Security Mode procedure is executed and a
security context for this UE is created in the IMS HNB.
4\. The UE sends a Setup message that contains the Bearer Capabilities of the
impeding voice call and the MSISDN of the called party, as per TS 24.008 [4].
5\. The IMS HNB GW decides if the requested service can be provided by IMS. If
the requested service can be provided by IMS and if an IMS Registration exists
for this UE, the IMS HNB GW decides to take over the control of this call.
6\. The IMS HNB GW sends an Iu Release Request and the Iu-cs signalling
connection is released.
7\. The IMS HNB GW maps the received Setup message to an IMS Invite message
and sends this message to IMS. The media transport information in the SDP
payload includes the IP address of the IMS HNB GW. Security procedures similar
to the \"early IMS\" security procedures are used to authenticate the Invite
message.
8\. The call is connected with normal interworking procedures between SIP and
24.008. The alerting tone can be generated by the IMS HNB GW if necessary.
9\. The user plane is established. IMS HNB GW processes the user plane media
received over the CS access for interworking with IMS RTP bearers and vice
versa.
Editor\'s Note: Application of early IMS security to MO is FFS.
### 6.7.4 Handover to macro
#### 6.7.4.1 handover to macro
When the VoIMS UE session is handovered from the HNB to Macro CS coverage,
service continuity is provided. The MSC Server enhanced for IMS-HNB subsystem
establishes a new session towards SCC AS upon receiving a handover request
from the HNB via modified Iu interface.The MSC Server initiates the Session
Transfer by using the STN.
{width="5.761111111111111in" height="3.859722222222222in"}
Figure 6.7.4.1-1: Handover to macro of CS UE from IMS HNB
1\. There\'s one active session between the UE A within the HNB coverage and
UE-B, which is anchored in the SCC AS as part of session set up. After the
measurement report from UE, the HNB decides to transfer the session to macro
CS.
2\. HNB GW sends a handover request to the MSC server enhanced for IMS-HNB
subsystem.
Editor\'s Note: Iu-cs has to be enhanced to trigger the specific handover
procedures from HNB to macro cell. The details are FFS.
3\~6. The call flow is similar with the SRVCC as TS23.216 [10] except that it
is not via Sv interface.
7\. The MSC Server enhanced for HNB sends a transfer request to SCC AS to
initiate a session transfer with the STN.
NOTE: The STN would be downloaded to Enhanced MSC Server from HSS during
E-UTRAN attach procedure or from HNB, but not from the UE as procedures
specified in TS 23.237 [17].
8\. During the execution of the Session Transfer procedure the remote end is
updated with the SDP of the CS access leg according to TS 23.237 [17].
9\. The source IMS access leg is released according to TS 23.237 [17].
10\. MSC Server enhanced for HNB completes the relocation procedure using the
TS 23.009 [15] procedures.
## 6.8 Alternative 8: Interworking of IMS at HNB and HNB-CAS
### 6.8.1 Reference Architecture
Figure 6.8.1-1 provides the reference architecture for the IMS HNB subsystem.
Thinner connecting lines represent control plane reference points; thicker
connecting lines represent user plane reference points. Changes beyond the
Release 8 HNB architecture are highlighted with shading and dotted lines.
Figure 6.8.1-1: IMS HNB Reference Architecture with HNB-CAS
The reference architecture allows seamless upgrade from the pre-IMS HNB
architecture described in TR 23.830 [5]. Since this architecture supports
coexistence of both Rel-8 HNBs and HNBs with an IMS UA, the upgrade can be
accomplished incrementally with minimal disruption.
### 6.8.2 Functional Entities
Entities of the architecture not listed below are defined in TS 23.002 [9] and
are not affected, including BSS, RNS, CS and PS core network.
#### 6.8.2.1 HNB
The HNB is described in TR 23.830 [5]. An IMS-capable HNB is enhanced with an
IMS User Agent (IMS UA), which operates as per the procedures specified in TS
23.228 [11] and TS 24.229 [12].
The IMS UA has the following functions:
\- Performs IMS registration on behalf of the HNB.
\- Initiates SIP messages to the IMS core to trigger CS core registration on
behalf of the UE.
\- Encapsulates information from relevant mobile radio interface messages
received from the UE (via the Uu/Um reference points), as defined in TS 24.008
[4] and TS 24.010 [18], into headers or content of SIP messages destined for
the IMS core / HNB-CAS in support of registration, authentication, basic call,
supplemental service and handover procedures implemented by the HNB-CAS. It
parses and processes incoming SIP messages containing radio interface message
information received from the IMS core and sends radio interface messages to
the UE as required (via the Uu/Um reference points).
Editor\'s Note: How the operator\'s network is protected against the operation
of misbehaving IMS UAs is FFS. \'Misbehaving\' IMS UAs could have unauthorized
modifications to mount certain threats (e.g. UE identity spoofing).
#### 6.8.2.2 HNB-GW
The HNB-GW is described in TR 23.830 [5]. For the IMS-capable HNB, the HNB-GW
assumes packet data functions in support of the IMS UA.
#### 6.8.2.3 HNB-CAS
The Home NodeB Convergence Application Server (HNB-CAS) functions as an
Application Server in the IMS network and provides interworking for voice and
supplementary services between an IMS UA in the HNB, the IMS core network and
the legacy CS network. The HNB-CAS appears as an MSC/VLR to the CS core
network and implements the MAP messages necessary to interface to key legacy
elements such as the HLR, MSC and SMSC in 3G networks. The HNB-CAS provides CS
domain services to a served UE utilizing the IMS core network infrastructure
by emulating most V-MSC functions driven by CS domain subscriber data in the
HLR.
The HNB-CAS provides the following key functions:
\- Voice convergence: calls are routed to/from the UE connected to the IMS-
capable HNB using the mobile number;
\- Messaging convergence: messages are routed to/from the UE connected to the
IMS-capable HNB using the mobile number;
\- Supplementary Services support: Call Barring, Call Hold, Call Forwarding,
Message Waiting, etc.;
Editor\'s note: Support for CS services not available from the HNB-CAS, e.g.,
CS Data and CS Fax is FFS.
\- Handover between the HNB and a neighbouring macrocell;
\- Emergency Services utilizing existing emergency service infrastructure:
\- detects the emergency call setup by analyzing the dialled number in the SIP
INVITE;
\- provides the geographic coordinates for the HNB (that were previously
retrieved and stored -- in case no HNB and or location information is
available the HNB-CAS falls back to Cell ID based Emergency Call support);
\- interfaces with the GMLC to obtain the ESRD of the appropriate PSAP;
\- routes the emergency call to the relevant call centre (based on ESRD);
\- User and service authentication using SIM/AKA authentication.
### 6.8.3 Reference Points
Reference points not listed below are defined in TS 23.002 [9] or TS 25.467
[8] and are not affected, including Uu, Um, Iu-CS, Iu-PS, Iuh, D, E and ISC.
#### 6.8.3.1 HGm
This reference point is for SIP signalling between the HNB and the IMS P-CSCF
as defined in TS 23.228 [11]. The HGm reference point is based on the IMS Gm
reference point defined in TS 23.002 [9] with extensions for HNB. Whether HGm
traffic utilizes the Iu-PS interface through the PS CN is FFS.
#### 6.8.3.2 Mb
This reference point is for RTP bearer traffic between the HNB and the IMS
P-CSCF as defined in TS 23.228 [11]. Whether Mb traffic utilizes the Iu-PS
interface through the PS CN is FFS.
### 6.8.4 Information Flows
#### 6.8.4.1 Registration and Authentication
##### 6.8.4.1.1 HNB IMS Registration
In this scenario the IMS UA in the HNB registers with the IMS network.
Following this procedure, the IMS UA is fully registered with IMS and can act
on behalf of UEs that attach to the HNB
Figure 6.8.4.1.1-1: HNB IMS Registration
Preconditions: The IMS HSS is provisioned with the HNB subscription, including
authentication data.
1\. Upon power-up, the HNB sends REGISTER to the P‑CSCF.
2\. The P-CSCF sends REGISTER to the I‑CSCF.
3\. The I-CSCF sends Cx: UAR to the HSS to obtain an S-CSCF address.
4\. The HSS replies with Cx: UAA to the I-CSCF indicating an S-CSCF address.
5\. The I-CSCF forwards the REGISTER to the S-CSCF.
6\. The S-CSCF sends Cx: MAR to the HSS to retrieve authentication parameters.
7\. The HSS replies with Cx:MAA to the S-CSCF indicating authentication
parameters.
8\. The S-CSCF sends \"401 -- Unauthorized\" to the I-CSCF including the
authentication parameters.
9\. The I-CSCF forwards \"401 -- Unauthorized\" to the P-CSCF.
10\. The P-CSCF forwards \"401 -- Unauthorized\" to the HNB.
11\. The HNB calculates a response value using the parameters received in step
10 and sends REGISTER to the P-CSCF including the authentication response.
12\. The P-CSCF forwards REGISTER to the I‑CSCF.
13\. The I-CSCF sends Cx: UAR to the HSS. to obtain an S-CSCF address.
14\. The HSS replies with Cx: UAA to the I-CSCF indicating an S-CSCF address.
15\. The I-CSCF sends REGISTER to the S‑CSCF including the authentication
response.
16\. The S-CSCF verifies the HNB credentials and sends Cx: SAR to the HSS to
retrieve the user profile including Initial Filter Criteria.
17\. The HSS replies with Cx:SAA to the S-CSCF providing the user profile.
18\. The S-CSCF sends 200 OK to the I-CSCF.
19\. The I-CSCF sends 200 OK to the P-CSCF.
20\. The P-CSCF sends 200 OK to the HNB.
21\. The S-CSCF sends REGISTER (3^rd^ Party) to the HNB-CAS.
22\. The HNB-CAS replies with 200 OK to the S-CSCF.
##### 6.8.4.1.2 UE Registration and Authentication
In this scenario the UE is a standard GSM/UMTS mobile and the HNB acts as an
IMS client on behalf of the UE. Figure 6.8.4.1.1-1 illustrates the role of the
HNB-CAS in registering the UE in the CS core.
Figure 6.8.4.1.2-1: UE Registration and Authentication
Preconditions: The HNB has previously connected to the network and completed
IMS registration. A UE attempts a connection with the HNB.
1\. The UE initiates the registration procedure through an MM: LOCATION
UPDATING REQUEST.
2\. The HNB sends a LOCATION_UPDATING_REQUEST encapsulated in a SIP MESSAGE.
This is routed to the HNB-CAS via the X-CSCF. Relevant headers of the SIP
MESSAGE received by the HNB-CAS are:
* * *
Header Value From IMSI_UE To IMSI_UE P-Access-Network-Info IMSI_AP;Macro 3G
Cell ID (optional depending on whether the SIP or IMS network accepts this
field) Contact UE Natted IP
* * *
3\. The HNB-CAS responds with 200 OK, which is received by the HNB via the
X-CSCF.
4\. The HNB-CAS sends MAP_UPDATE_LOCATION_REQ to the HLR. This message will
contain the UE IMSI, HNB-CAS-MSC-Address and the HNB-CAS-VLR-Number.
5\. The HLR sends MAP_INSERT_SUBSCRIBER_DATA_IND to the HNB-CAS in response,
which will include the subscriber profile associated to the UE (e.g., MSISDN,
SS settings).
6\. The HNB-CAS returns a MAP_INSERT_SUBSCRIBER_DATA_CNF message to the HLR.
7\. To complete the HLR interaction, the HLR returns a MAP_UPDATE_LOCATION_CNF
message.
8\. In the success case, the HNB-CAS sends a LOCATION UPDATING RESPONSE
encapsulated in a SIP MESSAGE. This gets routed to the HNB via the X-CSCF. The
P-Associated-URI will be set to the MSISDN provided by the HLR in tel: format.
9\. The HNB responds with 200 OK.
10\. At anytime, the HNB-CAS initiates an authentication request via SIP
MESSAGE. RAND is passed in this message. The SIP MESSAGE is received by the
HNB via the X-CSCF.
11\. The HNB responds with 200 OK.
12\. The HNB sends an MM: AUTHENTICATION REQUEST to the UE with the RAND
value.
13\. The UE computes the SRES and passes it in a response back to the HNB.
14\. The HNB sends an AUTHENTICATION RESPONSE encapsulated in a SIP MESSAGE
with the SRES value. This is routed back to the HNB-CAS via the X-CSCF.
15\. The HNB-CAS responds with 200 OK.
##### 6.8.4.1.3 Deregistration due to Location Updating
In this scenario the UE is deregistered with the HNB-CAS. This scenario
illustrates the awareness of the HNB-CAS and HNB of a handover from an HNB to
the CS core (idle or in-call).
Figure 6.8.4.1.3-1: UE Deregistration on Handover to CS Core
Preconditions: UE performs handover from an HNB to the CS core.
1\. The HNB-CAS receives MAP_CANCEL_LOCATION_IND from the HLR.
2\. In response, the HNB-CAS returns MAP_CANCEL_LOCATION_CNF.
3\. The HNB-CAS sends a SIP MESSAGE and to notify the HNB.
4\. The SIP MESSAGE goes through the CSCF, which forwards the message to the
HNB.
5\. The HNB responds with 200 OK.
6\. Upon receiving the 200 OK, the CSCF forwards the 200 OK to the HNB-CAS.
#### 6.8.4.2 Voice Call Processing
The following sections describe voice call processing. A general requirement
for voice call processing is to maintain a count of the number of calls in
progress to and from the UE and compare it to the number of bearer channels
configured for the subscriber in the HLR to determine whether or not to
generate a network busy condition on an incoming call or to allow call
waiting.
##### 6.8.4.2.1 Mobile Originated Call -- Success Scenario
The scenario illustrates a successful Mobile Originated voice call flow.
Figure 6.8.4.2.1-1: Mobile Originated Voice Call
Preconditions: UE is fully registered through an HNB.
NOTE: The X-CSCF has been removed to simplify the diagram.
1\. The UE initiates a voice call.
2\. The HNB sends a SIP INVITE to the HNB-CAS. Relevant headers are as
follows:
* * *
Header Value R-URI tel:E.164_B From \ To \ Via UE
Natted IP@ P-Preferred-Identity tel:+MSISDN_UE Contact UE Natted IP@
* * *
> 3\. In response, the HNB-CAS returns a SIP 100 Trying response to the HNB.
4\. The HNB-CAS queries the HLR user profile data to determine if any
supplementary services are active. It forwards the INVITE destined for the
MGCF if the user profile settings allow it (otherwise, it responds to the HNB
with 603 Declined).
Relevant headers of the outgoing INVITE are as follows:
* * *
Header Value R-URI tel:E.164_B From tel:\ To
\;isub=\ P-Asserted-ID UE_MSISDN
* * *
5-24. Standard SIP signalling is used to connect the two endpoints.
##### 6.8.4.2.2 Mobile Terminated Call -- Success Scenario
The scenario illustrates a successful Mobile Terminated voice call flow.
There are two phases in a Mobile Terminated call. First, the CS core will
request a roaming number from the HNB-CAS as a function of the MSISDN. The
second phase is initiated by a SIP INVITE from the MGCF addressed to the
roaming number.
Figure 6.8.4.2.2-1: Mobile Terminated Voice Call
Preconditions: UE in the CS network initiates a call to a UE registered
through an IMS HNB.
NOTE: The X-CSCF has been removed to simplify the diagram.
1\. The CS core sends a MAP_SEND_ROUTING_INFORMATION request to the HLR. The
MSISDN of the called party is passed as an argument.
2\. The HLR forwards the MAP_PROVIDE_ROAMING_NUMBER_IND to the HNB-CAS.
3\. The HNB-CAS returns MAP_PROVIDE_ROAMING_NUMBER_RSP to the HLR with a
temporary roaming number (msrn).
4\. The HLR sends a MAP_SEND_ROUTING_INFORMATION response back to the CS core
with the msrn.
5\. The MGCF receives ISUP:IAM with the msrn from the CS core.
6\. The MGCF translates the IAM message to a SIP INVITE that is sent to the
IMS core. Relevant headers are as follows:
* * *
Header Value R-URI tel:+msrn@ From tel:\ To tel:+msrn@ P-Asserted-
ID tel = \
* * *
7-31. Standard SIP signalling is used to connect the two endpoints.
#### 6.8.4.3 Handover
##### 6.8.4.3.1 HNB-to-CS Network Handover -- Success Scenario
This scenario shows the handover flow for a UE in a call that moves from an
HNB to a macro BS.
Figure 6.8.4.3.1-1: HNB to CS Network Handover
Preconditions: UE1 (registered with the HNB) initiates a call to UE2. The HNB-
CAS has established a B2BUA with a leg to the HNB (for UE1) and a leg to the
MGCF (for UE2).
NOTE: The X-CSCF has been removed to simplify the diagram.
1\. During the call, UE1 moves into the macrocell coverage area and the HNB
determines that handover is needed. The HNB sends a SIP MESSAGE to the HNB-CAS
containing the A/Iu Handover Required message in the content.
2\. The HNB-CAS responds with 200 OK.
3\. From the Handover Required message, the HNB-CAS identifies the target MSC.
It then sends a MAP Prepare Handover request to that MSC.
4\. The Target MSC sends a Handover Request to the BSS/RNS.
5\. In response, the BSS/RNS returns a Handover Request ACK to the Target MSC.
6\. The Target MSC allocates a Handover Number (routable E.164 address) and
returns it to the HNB-CAS in a MAP Prepare Handoff response message.
7\. The HNB-CAS sets up a new call leg by sending a SIP INVITE (with
\"sendonly\" attribute) to the IMS core. This gets routed to the MGCF.
8\. The MGCF sends an ISUP IAM (Initial Address Message) addressed to the
Handover Number. This gets routed to the Target MSC.
9\. The Target MSC returns an ISUP ACM (Address Complete Message) to the MGCF.
10\. The MGCF responds to the INVITE with a 18x message that gets routed to
the HNB-CAS by the IMS core.
11\. The HNB-CAS sends a SIP MESSAGE encapsulating an A/Iu Handoff Command.
This message, upon being routed to UE1 via the IMS core and the HNB, instructs
UE1 to switch to the new cell.
12\. The HNB returns 200 OK.
13\. The Target BSS/RNS, upon seeing data from UE1, sends the A/Iu Handover
Detected message to the Target MSC.
14\. The Target MSC sends a MAP Access Signalling Request to the IMS core,
which subsequently routes the message to the HNB-CAS.
15\. The Target BSS/RNS sends the A/Iu Handover Complete message to the Target
MSC.
16\. The Target MSC sends a MAP Send End Signal to the IMS core, which
subsequently routes the message to the HNB-CAS.
17\. The Target MSC sends an ISUP ANS (Answer) message to the MGCF to indicate
that the call should be accepted.
18-24. Standard SIP signalling is used to reconnect UE1 (via the Target
BSS/RNS) to UE2.
#### 6.8.4.4 SMS
The HNB-CAS allows messages (SMS and MMS) to be routed to/from the mobile
device connected to the HNB using the subscriber\'s mobile identity. The HNB-
CAS allows messaging services (both SMS origination and termination) to be
delivered or redirected over the IP broadband network to a HNB. The transport
mechanism for SMS/MMS between the HNB device and the HNB-CAS is SIP using a
SIP MESSAGE mechanism.
##### 6.8.4.4.1 Mobile Originated SMS Message Delivery
This scenario illustrates the call flow for successful Mobile Originated SMS
delivery.
Figure 6.8.4.4.1-1: Mobile Originated SMS
Preconditions: UE is fully registered through an HNB.
NOTE: The X-CSCF has been removed to simplify the diagram.
1\. The UE sends an SMS-SUBMIT message to originate SMS to another endpoint.
2\. In response, the HNB translates the SMS-SUBMIT into a SIP MESSAGE that it
then sends to the IMS core. Relevant SIP headers are as follows:
* * *
Header Value R-URI \ From tel:\
To Same as R-URI P-Asserted-ID Inserted by the CSCF, it contains the same
value as the From header but is considered trusted information. Content-Type
application/vnd.3gpp.sms
* * *
NOTE: The RP-DATA message encapsulated in the body of the SIP MESSAGE is
encoded as binary.
3\. The HNB-CAS responds to the SIP MESSAGE with 202 Accepted to the HNB.
Additionally, the HNB-CAS processes the SIP MESSAGE as follows:
\- extracts and validates the SC address (RP-DA -- E.164 number) from the
payload;
\- extracts and validates the RPDU type (RP-Message-Type) from the payload;
\- extracts the MSISDN (RP-OA -- E.164 number) from the payload;
\- evaluates activated SMS barring supplementary services;
\- evaluates operator determined barring for the Short Message.
4\. The HNB-CAS generates a MAP-MO-FORWARD-SHORT-MESSAGE to the SMS-IWMSC with
the following parameters from the received SIP:MESSAGE:
\- SM RP DA -- SC address from above;
\- SM RP OA -- MSISDN from above;
\- SM RP UI -- the Short Message TPDU extracted from the SIP MESSAGE payload;
\- IMSI -- from internal data associated with the UE at time of registration.
5\. The SMS-IWMSC processes and sends the SM to the SMSC.
6-10. The various requests are acknowledged.
##### 6.8.4.4.2 Mobile Terminated SMS Message Delivery
This scenario illustrates the call flow for successful Mobile Originated SMS
delivery. The UE subscriber lookup is performed using the IMSI set as the SM
RP DA of the MAP-MT-FORWARD-SHORT-MESSAGE.
Figure 6.8.4.4.2-1: Mobile Terminated SMS
Preconditions: UE is fully registered through an HNB.
NOTE: The X-CSCF has been removed to simplify the diagram.
1\. An SMS-DELIVER message is sent between the SMSC and SMS-GMSC.
2\. In response the SMS-GMSC forwards a MAP_SEND_ROUTING_INFO_FOR_SM message
to the HLR
3\. The HLR acknowledges the MAP_SEND_ROUTING_INFO_FOR_SM message.
4\. The HLR forwards a MAP_MT_FORWARD_SHORT_MESSAGE to the HNB-CAS. The HNB-
CAS evaluates barring supplementary services against the user profile.
5\. If the SMS is not barred, the HNB-CAS sends a SIP MESSAGE with the SMS
data stored in the content. Relevant headers are as follows:
* * *
Header Value R-URI The contact address received during UE registration. From
HNB-CAS address To \ P-Asserted-ID HNB-CAS address Content-
Type application/vnd.3gpp.sms
* * *
6\. Upon receiving the SIP MESSAGE, the HNB forwards the contents to the UE in
an SMS-DELIVER message. The HNB-CAS evaluates operator-determined barring for
the Short Message.
7\. The HNB responds to the SIPMESSAGE with 202 Accepted.
8-12. SMS-DELIVER-REPORT is sent from the UE to the SMSC via the HNB, HNB-CAS
and SMS-GMSC.
# 7 Assessment
The following table represents an assessment of architecture Alternative 2 and
Alternative 4 in greater detail.
+----------------------+----------------------+----------------------+ | Criteria | Alternative 2 | Alternative 4 | +----------------------+----------------------+----------------------+ | **Anticipated | None. | 1. Several RANAP | | Standards Impacts** | | changes are required | | | | (e.g. passage of the | | | | \'register the UE in | | | | IMS\' flag from the | | | | MSC to the IHAF) to | | | | duplicate | | | | TS 23.292 [6] | | | | procedures if | | | | required by local | | | | policy. | | | | | | | | 2. Minor | | | | enhancements to the | | | | T-ADS procedure are | | | | needed. | +----------------------+----------------------+----------------------+ | **CS Core Network | 1. HNB user plane | 1. HNB user plane | | Offload** | traffic is offloaded | traffic is offloaded | | | from the legacy CS | from the legacy CS | | | core network if a | core network, but at | | | dedicated CS-MGW is | the cost of | | | deployed for HNB | integrating a subset | | | access. | of CS-MGW | | | | functionality within | | | 2. HNB control | the IMS HNB-GW. | | | plane (signalling) | | | | traffic is offloaded | 2. HNB control | | | from the legacy CS | plane (signalling) | | | core network if a | traffic is offloaded | | | dedicated MSC Server | from the legacy CS | | | is deployed for HNB | core network to some | | | access. | degree, but at the | | | | cost of integrating | | | | a subset of MSC | | | | Server functionality | | | | within the IMS | | | | HNB-GW. | | | | Additionally, | | | | IHAF-MSC Server | | | | interaction is still | | | | required for | | | | mobility management | | | | signalling and for | | | | certain signalling | | | | events associated | | | | with IMS sessions | | | | (e.g. MSC-based CSG | | | | access control). | +----------------------+----------------------+----------------------+
# 8 Conclusion
Alternatives 1 and 7 are not recommended for standardization. Additional
alternative proposals are not expected.
Alternatives 6 and 8 are not recommended for standardization since network-
centric solutions are preferred in Rel‑10.
Based upon the assessment analysis of network-centric solutions in clause 7,
Alternative 2 is selected as the solution for IMS HNB over Alternative 4 in
Rel‑10, and no further 3GPP standardization work is required.
#
# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document is part of a series of documents that specify charging
functionality and charging management in GSM/UMTS and EPS networks. The
GSM/UMTS and EPS core network charging architecture and principles are
specified in the present document, which thus provides an umbrella for other
charging management TSs that specify:
  * the content of the CDRs per domain / subsystem /service (offline > charging);
  * the content of real-time charging events per domain / subsystem > /service (online charging);
  * the functionality of online and offline charging for those domains / > subsystems / services;
  * the interfaces that are used in the charging framework to transfer > the charging information (i.e. CDRs or charging events).
The purposes of the present document are:
  * to lay down common principles of charging in the network; and
  * to specify a logical common charging architecture that applies to > all 3GPP domains, subsystems and services.
A set of domain/subsystem/service specific TSs covers the bearer (CS, PS, WLAN
domains), subsystem (IMS) and service (MMS, LCS, etc.) levels, respectively,
in the 32.25x, 32.26x and 32.27x TS number range. These TSs describe the
mapping of the common architecture specified in the present document onto the
specific domain/subsystem/service and the scenarios and information for online
and offline charging that are specific to the domain/subsystem/service. They
are commonly referred to as the "middle tier (charging) TSs".
A set of TSs in the 32.280 and the 32.29x range cover common aspects such as
the Advice of Charge service. CDR parameter and syntax descriptions, online
and offline charging applications, and the charging interactions within the
network (CDR transfer) as well as between the network and the Billing Domain
(CDR file transfer).
The complete document structure for these TSs is outlined in the following
figure.
Figure 1: Charging specifications structure
All terms, definitions and abbreviations used in the present document, that
are common across 3GPP TSs, are defined in the 3GPP Vocabulary, 3GPP TR 21.905
[100]. Those that are common across charging management in GSM/UMTS domains,
services or subsystems are provided in the present document (umbrella TS), and
are copied into clause 3 of the other TSs depicted in the figure, for ease of
reading. Finally, those items that are specific to the present document are
defined exclusively in the present document.
Furthermore, requirements that govern the charging work are specified in 3GPP
TS 22.115 [101].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1]- [9] Void.
[10] 3GPP TS 32.250: \"Telecommunication management; Charging management;
Circuit Switched (CS) domain charging\".
[11] 3GPP TS 32.251: \"Telecommunication management; Charging management;
Packet Switched (PS) domain charging\".
[12]- [29] Void.
[30] 3GPP TS 32.270: \"Telecommunication management; Charging management;
Multimedia Messaging Service (MMS) charging\".
[31]- [49] Void.
[50] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging application\".
[51] 3GPP TS 32.298: \"Telecommunication management; Charging management;
Charging Data Record (CDR) parameter description\".
[52] 3GPP TS 32.297: \"Telecommunication management; Charging management;
Charging Data Record (CDR) file format and transfer\".
[53] 3GPP TS 32.296: \"Telecommunication management; Charging management;
Online Charging System (OCS) applications and interfaces\".
[54] 3GPP TS 32.295: \"Telecommunication management; Charging management;
Charging Data Record (CDR) transfer\".
[55]- [68] Void.
[69] 3GPP TS 32.280: \"Telecommunication management; Charging management;
Advice of Charge (AoC) service\".
[70] Void.
[71] 3GPP TS 23.203: \"**Policy and charging control architecture** \".
[72]- [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] 3GPP TS 22.115 \"Service aspects; Charging and billing\".
[102]- [206] Void.
[207] 3GPP TS 23.078: \"Customized Applications for Mobile network Enhanced
Logic (CAMEL); Stage 2\".
[208]- [209] Void.
[210] 3GPP TS 23.234: \"3GPP system to Wireless Local Area Network (WLAN)
interworking; System description\".
[211]- [299] Void.
[300] ITU-T Recommendation D.93: \"Charging and accounting in the
international land mobile telephone service (provided via cellular radio
systems)\".
[301]- [401] Void.
[402] IETF RFC 4006: \"Diameter Credit Control Application\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions defined in
3GPP TR 21.905 [100] and the following apply:
**2G‑ / 3G‑:** prefixes 2G‑ and 3G‑ refer to functionality that supports only
GSM or UMTS, respectively, e.g. 2G‑SGSN refers only to the GSM functionality
of an SGSN.
**accounting:** process of apportioning charges between the Home Environment,
Serving Network and Subscriber.
**accounting meter record:** record containing one or more counters employed
to register the usage of resources en masse. Includes simple event counters
and/ or cumulative call second counters.
**Advice of Charge (AoC):** real-time display of the network utilization
charges incurred by the Mobile Station\ The charges are displayed in the form
of charging units. If a unit price is stored by the MS then the display may
also include the equivalent charge in the home currency.
**AoC service:** combination of one or more services, both basic and
supplementary, together with a number of other charging relevant parameters to
define a customized service for the purpose of advice of charge.
**billing:** function whereby CDRs generated by the charging function(s) are
transformed into bills requiring payment.
**Billing Domain:** part of the operator network, which is outside the core
network, which receives and processes CDR files from the core network charging
functions. It includes functions that can provide billing mediation and
billing or other (e.g. statistical) end applications. It is only applicable to
offline charging (see "Online Charging System" for equivalent functionality in
online charging).
**CAMEL:** network feature that provides the mechanisms to support operator
specific services even when roaming outside HPLMN.
**CAMEL subscription information:** identifies a subscriber as having CAMEL
services.
**chargeable event:** activity utilizing telecommunications network resources
and related services for:
  * user to user communication (e.g. a single call, a data communication > session or a short message); or
  * user to network communication (e.g. service profile administration); > or
  * inter-network communication (e.g. transferring calls, signalling, or > short messages); or
  * mobility (e.g. roaming or inter-system handover); and
  * that the network operator may want to charge for.
As a minimum, a chargeable event characterises the resource / service usage
and indicates the identity of the involved end user(s).
**charged party:** user involved in a chargeable event that has to pay parts
or the whole charges of the chargeable event, or a third party paying the
charges caused by one or all users involved in the chargeable event, or a
network operator.
**charging:** function within the telecommunications network and the
associated OCS/BD components whereby information related to a chargeable event
is collected, formatted, transferred and evaluated in order to make it
possible to determine usage for which the charged party may be billed (offline
charging) or the subscriber's account balance may be debited (online
charging).
**Charging Data Record (CDR):** formatted collection of information about a
chargeable event (e.g. time of call set-up, duration of the call, amount of
data transferred, etc) for use in billing and accounting. For each party to be
charged for parts of or all charges of a chargeable event a separate CDR shall
be generated, i.e. more than one CDR may be generated for a single chargeable
event, e.g. because of its long duration, or because more than one charged
party is to be charged.
**charging event:** set of charging information forwarded by the CTF towards
the CDF (offline charging) or towards the OCS (online charging). Each charging
event matches exactly one chargeable event.
**circuit switched domain:** domain within GSM / UMTS in which information is
transferred in circuit switched mode.
**credit control:** mechanism which directly interacts in real-time with an
account and controls or monitors the charges, related to the service usage.
Credit control is a process of: checking if credit is available, credit
reservation, deduction of credit from the end user account when service is
completed and refunding of reserved credit not used.
**domain:** part of a communication network that provides resources using a
certain bearer technology.
**Fully qualified Partial CDR (FQPC):** partial CDR that contains a complete
set of the fields specified for the CDR type in the respective middle tier TS.
This includes all the mandatory and conditional fields as well as those fields
that the PLMN operator has provisioned to be included in the CDR. The first
Partial CDR shall be a Fully Qualified Partial CDR.
**GPRS:** packet switched bearer and radio services for GSM and UMTS systems.
**(GSM only):** qualifier indicating that this clause or paragraph applies
only to a GSM system. For multi-system cases this is determined by the current
serving radio access network.
**in GSM,...:** qualifier indicating that this paragraph applies only to GSM
Systems
**in UMTS,...:** qualifier indicating that this paragraph applies only to UMTS
Systems
**inter-system change:** change of radio access between different radio access
technologies such as GSM and UMTS
**middle tier (charging) TS:** term used for the 3GPP charging TSs that
specify the domain / subsystem / service specific, online and offline,
charging functionality. These are all the TSs in the numbering range from 3GPP
TS 32.250 to 3GPP TS 32.279, e.g. 3GPP TS 32.250 [10] for the CS domain, or
3GPP TS 32.270 [30] for the MMS service. Currently, there is only one \"tier
1\" TS in 3GPP, which is the present document that specifies the charging
architecture and principles. Finally, there are a number of top tier TSs in
the 32.29x numbering range ([50] ff) that specify common charging aspects such
as parameter definitions, encoding rules, the common billing domain interface
or common charging applications.
**near real-time:** near real-time charging and billing information is to be
generated, processed, and transported to a desired conclusion in less than 1
minute.
**observed IMEI ticket:** record used to describe an EIR relevant event e.g. a
blacklisted IMEI.
**offline charging:** charging mechanism where charging information **does
not** affect, in real-time, the service rendered.
**online charging:** charging mechanism where charging information can affect,
in real-time, the service rendered and therefore a direct interaction of the
charging mechanism with bearer/session/service control is required.
**Online Charging System:** the entity that performs real-time credit control.
Its functionality includes transaction handling, rating, online correlation
and management of subscriber accounts/balances.
**packet switched domain:** domain in which data is transferred between core
network elements.
**partial CDR:** CDR that provides charging information on part of a user
session. A long session may be covered by several partial CDRs. Two formats
are considered for Partial CDRs. One that contains all of the necessary fields
(FQPC); the second has a reduced format (RPC).
**real-time:** real-time charging and billing information is to be generated,
processed, and transported to a desired conclusion in less than 1 second.
**Reduced Partial CDR (RPC):** partial CDRs that only provide mandatory fields
and information regarding changes in the session parameters relative to the
previous partial CDR. For example, location information is not repeated in
these CDRs if the subscriber did not change its location.
**settlement:** payment of amounts resulting from the accounting process.
**subscriber:** entity (associated with one or more users) that is engaged in
a Subscription with a service provider. The subscriber is allowed to subscribe
and unsubscribe services, to register a user or a list of users authorised to
enjoy these services, and also to set the limits relative to the use that
associated users make of these services.
**successful call:** connection that reaches the communication or data
transfer phase e.g. the \"answered\" state for speech connections. All other
connection attempts are regarded as unsuccessful.
**tariff period:** part of one (calendar) day during which a particular tariff
is applied. Defined by the time at which the period commences (the switch-over
time) and the tariff to be applied after switch-over
**tariff:** set of parameters defining the network utilization charges for the
use of a particular bearer / session / service.
**UMTS only:** qualifier indicating that this clause or paragraph applies only
to a UMTS system. For multi-system cases this is determined by the current
serving radio access network.
**user:** entity, not part of the 3GPP System, which uses network resources by
means of a subscription. The user may or may not be identical to the
subscriber holding that subscription.
**User Equipment (UE):** device allowing a user access to network services.
For the purpose of 3GPP specifications the interface between the UE and the
network is the radio interface. A User Equipment can be subdivided into a
number of domains, the domains being separated by reference points. Currently
defined domains are the USIM and ME Domains. The ME Domain can further be
subdivided into several components showing the connectivity between multiple
functional groups. These groups can be implemented in one or more hardware
devices. An example of such connectivity is the TE -- MT interface. Further,
an occurrence of a User Equipment is an MS for GSM as defined in GSM TS 04.02
(GSM Public Land Mobile Network (PLMN) Access Reference Configuration).\ From
3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\" [100].
## 3.2 Symbols
For the purposes of the present document the following symbols apply:
A Interface between an MSC and a BSC.
Bc Reference point for the CDR file transfer from the Circuit Switched CGF to
the BD.
Bi Reference point for the CDR file transfer from the IMS CGF to the BD.
Bl Reference point for the CDR file transfer from the GMLC CGF to the BD.
Bm Reference point for the CDR file transfer from the MMS CGF to the BD.
Bo Reference point for the CDR file transfer from the OCF CGF to the BD.
Bp Reference point for the CDR file transfer from the Packet Switched CGF to
the BD.
Bs Reference point for the CDR file transfer for CAMEL services to the BD,
i.e. from the SCF CGF to the BD.
Bt Reference point for the CDR file transfer from the PoC CGF to the BD.
Bw Reference point for the CDR file transfer from the WLAN CGF to the BD.
Bx Reference point for CDR file transfer between any (generic) 3G domain,
subsystem or service CGF and a BD.
CAP Reference point for CAMEL between a network element with integrated SSF
and the OCS.
Ga Reference point for CDR transfer between a CDF and the CGF.
Gb Interface between an SGSN and a BSC.
Gc Interface between an GGSN and an HLR.
Gd Interface between an SMS-GMSC and an SGSN, and between a SMS-IWMSC and an
SGSN.
Gf Interface between an SGSN and an EIR.
Gi Interface between the Packet-Switched domain and an external packet data
network.
Gn Interface between two GSNs within the same PLMN.
Gp Interface between two GSNs in different PLMNs.
Gr Interface between an SGSN and an HLR.
Gs Interface between an SGSN and an MSC/VLR.
Gx Reference point between a PCRF and a PCEF.
Gy Online charging reference point between a PCEF and an OCS.
Gz Offline charging reference point between a PCEF and a CGF.
Iu Interface between the RNS and the core network.
kbit/s Kilobits per second. 1 kbit/s = 210 bits per second.
Lr Interface between Gateway MLCs.
Mbit/s Megabits per second. 1 Mbit/s = 220 bits per second.
Mc Interface between the MGW and (G)MSC server.
Rf Offline charging reference point between a 3G network element and the CDF.
Ro Online charging reference point between a 3G network element and the OCS.
Rx Reference point between the PCRF and an AF.
Um Interface between the Mobile Station (MS) and the GSM fixed network part.
Uu Interface between the User Equipment (UE) and the UMTS fixed network part.
Wf Offline charging reference point between a 3GPP WLAN CTF and the CDF.
Wo Online charging reference point between a 3GPP WLAN CTF and the OCS.
## 3.3 Abbreviations
For the purposes of the present document, the following abbreviations apply:
3G 3rd Generation
3GPP 3^rd^ Generation Partnership Project
AF Application Function
AMF Account Balance Management Function
AoC Advice of Charge
APN Access Point Name
AS Application Server
BD Billing Domain
BGCF Breakout Gateway Control Function
BS Bearer Services
BSC Base Station Controller
BSS Base Station Subsystem
BTS Base Transceiver Station
CAMEL Customized Applications for Mobile network Enhanced Logic
CAP CAMEL Application Part
CDF Charging Data Function
CDR Charging Data Record
CG Charging Gateway
CGF Charging Gateway Function
CS Circuit Switched
CSCF Call Session Control Function (I-Interrogating; E-Emergency; P-Proxy; and
S-Serving)
CTF Charging Trigger Function
EATF Emergency Access Transfer Function
EBCF Event Based Charging Function
ECUR Event Charging with Unit Reservation
EIR Equipment Identity Register
EPC Evolved Packet Core
EPS Evolved Packet System
E-UTRAN Evolved Universal Terrestrial Radio Access Network
FQPC Fully Qualified Partial CDR
GGSN Gateway GPRS Support Node
GMLC Gateway MLC
GMSC Gateway MSC
GPRS General Packet Radio Service
GSM Global System for Mobile communication
gsmSCF GSM Service Control Function
gsmSSF GSM Service Switching Function
GSN GPRS Support Node (either SGSN or GGSN)
HLR Home Location Register
HPLMN Home PLMN
HSCSD High Speed Circuit Switched Data
IBCF Interconnect Border Control Function
ICS IMS Centralized Services
IEC Immediate Event Charging
IETF Internet Engineering Task Force
IMEI International Mobile Equipment Identity
IMS GWF IMS GateWay Function
IMS IP Multimedia Subsystem
IMSI International Mobile Subscriber Identity
IP Internet Protocol
ISC IMS Service Control
ISDN Integrated Services Digital Network
ITU-T International Telecommunication Union - Telecommunications
standardization sector
LAC Location Area Code
LAN Local Area Network
LCS Location Services
LRF Location Retrieval Function
MAP Mobile Application Part
ME Mobile Equipment
MGCF Media Gateway Control Function
MGW Media GateWay
MLC Mobile Location Center
MMI Man-Machine Interface
MMS Multimedia Messaging Service
MMSE Multimedia Messaging Service Environment
MO Mobile Originated
MOC MO Call
MRF Media Resource Function
MRFC MRF Controller
MS Mobile Station
MSC Mobile Services Switching Centre
MSISDN Mobile Station ISDN number
MT Mobile Terminated
MTC MT Call
NE Network Element
OCF Online Charging Function
OCS Online Charging System
PCEF Policy and Charging Enforcement Function
PCRF Policy and Charging Rules Function
PDG Packet Data Gateway
PDN Packet Data Network
PDP Packet Data Protocol, e.g. IP
PLMN Public Land Mobile Network
PoC Push-to-talk over Cellular
PS Packet-Switched
PSPDN Packet-Switched Public Data Network
QoS Quality of Service
RF Rating Function
RNC Radio Network Controller
RNS Radio Network Subsystem
RPC Reduced Partial CDR
SBCF Session Based Charging Function
SCCP Signalling Connection Control Part
SCF Service Control Function
SCUR Session Charging with Unit Reservation
SGSN Serving GPRS Support Node
SIM Subscriber Identity Module
SMS Short Message Service
SSF Service Switching Function
TAP Transferred Account Procedure
TR Technical Report
TS Technical Specification
UE User Equipment
UMTS Universal Mobile Telecommunications System
USIM Universal SIM
VAS Value Added Service
VLR Visitor Location Register
VMSC Visited MSC
VPLMN Visited PLMN
WLAN Wireless LAN
# 4 Common charging architecture and framework
The main requirements and high-level principles for charging and billing
across the domains, subsystems and services that comprise a GSM or UMTS PLMN
are established in the 3GPP TS 22.115 [101]. In order to fulfil these
requirements, appropriate charging information needs to be generated and
collected by the network elements of the PLMN and forwarded to appropriate
charging and billing systems.
Several logical charging functions are needed in the network in order to
provide the functionality described above for online and offline charging,
respectively. These charging functions are specified in detail in this clause,
together with the reference points that are used to transfer charging
information between those functions. While the overall possibilities that
exist within the 3GPP standards for the physical mapping of these logical
functions are described in the present document, the exact situation that
applies to the various domains, subsystems and services of the network is
specified in the middle tier charging TS that is specific to that
domain/subsystem/service (i.e. TS 32.25x - TS 32.27x).
In offline charging, the charging information is transferred from the network
to the Billing Domain (BD), where it is processed for billing and/or
statistical purposes, at the discretion of the PLMN operator. While the
internal functions of the BD are outside the scope of 3GPP standardisation,
the reference point for the charging information transfer from the network to
the BD does form a part of the 3GPP standards and is therefore also specified
in the present clause.
In online charging, the charging information is transferred from the network
to the Online Charging System (OCS). The OCS, in turn, may have an offline
charging reference point used to forward charging information to the BD that
is similar in scope and intent to the offline charging case described in the
previous paragraph. Those areas of the OCS that form part of the 3GPP
standards (functions and reference points) are also described in the present
clause. All other aspects of the OCS are outside the scope of 3GPP standards.
## 4.1 Charging mechanisms
GSM/UMTS/EPC networks provide functions that implement offline and/or online
charging mechanisms on the bearer (e.g. EPC), subsystem (e.g. IMS) and service
(e.g. MMS) levels. In order to support these charging mechanisms, the network
performs real-time monitoring of resource usage on the above three levels in
order to detect the relevant chargeable events. The charging levels are
further described in clause 5.3.
In offline charging, the resource usage is reported from the network to the
Billing Domain after the resource usage has occurred. In online charging, a
subscriber account, located in an online charging system, is queried prior to
granting permission to use the requested network resource(s).
Typical examples of network resource usage are a voice call of certain
duration, the transport of a certain volume of data, or the submission of a MM
of a certain size. The network resource usage requests may be initiated by the
UE (MO case) or by the network (MT case).
Offline and online charging may be performed simultaneously and independently
for the same chargeable event. Clause 5.5 provides further insight into
potential utilisation of the charging information produced by the offline and
online charging mechanisms.
### 4.1.1 Offline charging
Offline charging is a process where charging information for network resource
usage is collected concurrently with that resource usage. The charging
information is then passed through a chain of logical charging functions that
are further explained in clause 4.3.1. At the end of this process, CDR files
are generated by the network, which are then transferred to the network
operator\'s Billing Domain for the purpose of subscriber billing and/or inter-
operator accounting (or additional functions, e.g. statistics, at the
operator's discretion). The BD typically comprises post-processing systems
such as the operator\'s billing system or billing mediation device.
**In conclusion, offline charging is a** mechanism where charging information
**does not** affect, in real-time, the service rendered.
### 4.1.2 Online charging
Online charging is a process where charging information for network resource
usage is collected concurrently with that resource usage in the same fashion
as in offline charging. However, authorization for the network resource usage
must be obtained by the network prior to the actual resource usage to occur.
This authorization is granted by the Online Charging System upon request from
the network.
When receiving a network resource usage request, the network assembles the
relevant charging information and generates a charging event towards the OCS
in real-time. The OCS then returns an appropriate resource usage
authorization. The resource usage authorization may be limited in its scope
(e.g. volume of data or duration), therefore the authorization may have to be
renewed from time to time as long as the user's network resource usage
persists.
Note that the charging information utilized in online charging is not
necessarily identical to the charging information employed in offline
charging.
In conclusion, **online charging is a** mechanism where charging information
can affect, in real-time, the service rendered and therefore a direct
interaction of the charging mechanism with the control of network resource
usage is required.
## 4.2 High level common architecture
The architectural differences between the domains (e.g. PS), services (e.g.
MMS) and subsystems (e.g. the IMS) affect the way in which the charging
functions are embedded within the different domains, services and subsystems.
However, the functional requirements for charging are always the same across
all domains, services and subsystems. This clause describes a common approach
for the definition of the logical charging functions, which provides a
ubiquitous logical charging architecture for all GSM and UMTS network domains,
subsystems and services that are relevant for charging standardisation.
It should be noted that this common charging architecture provides only a
common logical view and the actual domain / service / subsystem specific
charging architecture depends on the domain / service / subsystem in question.
The physical mapping of the common logical architecture onto each domain,
subsystem or service is described in the respective middle tier charging TS,
i.e. the TSs 32.25x, 32.26x and 32.27x number range.
Figure 4.2 provides an overview of the logical ubiquitous charging
architecture and the information flows for offline and online charging. The
common charging functions are detailed further in clauses 4.3.1 for offline
charging and 4.3.2 for online charging. The reference points are further
specified in clause 4.4.
NOTE: The Service-NE are defined in the 3GPP specification range of TS 32.27x.
Figure 4.2: Logical ubiquitous charging architecture and information flows
Figure 4.2 includes all network elements / systems (top to bottom: CS-NE all
the way through to the PCEF) for which charging is defined within 3GPP
standards. The arrows indicate logical information flows on the Rf, Wf, Ga,
Bx, ISC, Ro, Wo, CAP, and Gy reference points. No inference should be drawn
from the figure with respect to the physical implementation of interfaces and
charging functions.
NOTE 1: On the PCEF, 3GPP TS 23.203 [71] specifies the Gy reference point for
online flow based bearer charging and the Gz reference point for offline flow
based bearer charging. However, from the charging architecture perspective, Gy
is functionally equivalent to the Ro reference point, Gz is functionally
equivalent to the Ga reference point for Legacy PS domain, and to the Ga or
the Rf reference point for Evolved PS domain. . Therefore, Ga or Rf and Ro are
used throughout the present document also in conjunction with PCEF charging.
This simplification ensures a consistent architectural view, as specified
below, for all online and offline charging architectural aspects. Refer to
clause 5.3.1.2 for a description of flow based bearer charging.
NOTE 2: On WLAN, 3GPP TS 23.234 [210] specifies the Wo reference point for
WLAN online charging and the Wf reference point for WLAN offline charging.
However, from the charging architecture perspective, these reference points
are functionally equivalent to the Ro and Rf reference points, respectively.
Therefore, Rf and Ro are used throughout the present document also in
conjunction with WLAN charging. This simplification ensures a consistent
architectural view, as specified below, for all online and offline charging
architectural aspects.
## 4.3 Charging functions
### 4.3.1 Offline charging functions
Figure 4.3.1 provides an overview of the offline part of the common charging
architecture. The figure depicts the logical charging functions as well as the
reference points between these functions and to the Billing Domain.
**CTF:** **C** harging **T** rigger **F** unction
**CDF:** **C** harging **D** ata **F** unction
**CGF:** **C** harging **G** ateway **F** unction
**BD:** **B** illing **D** omain. This may also be a billing system/ billing
mediation device.
Figure 4.3.1: Logical ubiquitous offline charging architecture
NOTE: Although not visualised in this figure, the OCS can also produce CDRs,
i.e. act as a domain / service / subsystem element with embedded CTF, see
clause 4.3.2.3.
#### 4.3.1.1 Charging Trigger Function
The Charging Trigger Function (CTF) generates charging events based on the
observation of network resource usage as described in clause 4.1.1. In every
network and service element that provides charging information, the CTF is the
focal point for collecting the information pertaining to chargeable events
within the network element, assembling this information into matching charging
events, and sending these charging events towards the Charging Data Function.
The CTF is therefore a mandatory, integrated component in all network elements
that provide offline charging functionality, as depicted in figure 4.2. It is
made up of two functional blocks:
  * Accounting Metrics Collection
> The process that monitors signalling functions for calls, service events or
> sessions established by the network users, or the handling of user traffic
> for these calls, service events or sessions, or service delivery to the user
> via these calls, service events or sessions. It is required to provide
> metrics that identify the user and the user\'s consumption of network
> resources and/or services in real-time. The exact behaviour and
> functionality of this process e.g.:
  * trigger conditions for collection of charging information,
  * information elements to collect,
  * which service events, signalling or user traffic to monitor,
  * relationship to services / bearers / sessions,
> depends on functions / services that the NE provides. The Account Metrics
> Collection can therefore be considered as the network element dependent part
> of the CTF.
>
> Depending on implementation choice, NE functions (e.g. the handling of
> service events or signalling / user traffic) may be distributed among
> multiple physical "devices" within the NE. In order to be able to capture
> the required charging information from the service events or signalling /
> user traffic, the design of the Accounting Metrics Collection has to match
> the physical design / distribution of these functions within the NE. This
> implies that in case of such distributed NE functionality, the Accounting
> Metrics Collection becomes a distributed functionality itself.
  * Accounting Data Forwarding
> This process receives the collected accounting metrics and determines the
> occurrence of chargeable events from a set of one or more of these metrics.
> It then assembles charging events that match the detected chargeable events,
> and forwards the charging events towards the Charging Data Function via the
> Rf reference point. The charging events provide information pertinent to the
> chargeable event, i.e. characterising the network resource usage together
> with an identification of the involved user(s). There is no assumption of
> any synchronisation between the reception of individual accounting metrics,
> however, it must be possible for the Accounting Data Forwarding to complete
> its overall functionality per charging event in real-time.
>
> While the exact information received by the Account Data Forwarding from the
> Account Metrics Collection, and the relevant chargeable events, are specific
> to each type of network element, the overall functionality of receiving,
> assembling and forwarding the charging information can be considered
> generic. Hence the Accounting Data Forwarding is considered the NE
> independent part of the CTF.
The behaviour of the CTF with respect to the definition of the chargeable
events, the matching charging events and the information elements to collect
is specified per domain, subsystem and service in the respective middle tier
charging 3GPP TS ([10] -- [49]).
#### 4.3.1.2 Charging Data Function
The Charging Data Function (CDF) receives charging events from the Charging
Trigger Function via the Rf reference point. It then uses the information
contained in the charging events to construct CDRs. This procedure is
characterised by the following conditions:
  * CDRs may be constructed from single charging events, i.e. a 1:1 relation between event and CDR.
  * CDRs may be constructed from a set of several charging events, i.e. a n:1 relation between event and CDR.
  * Each charging event is used for exactly one CDR, i.e. a 1:n relation between event and CDR (with n>1) is not possible.
  * Multiple charging events that are used to create a single CDR may not necessarily be of the same type.
  * There is no requirement or assumption of any synchronisation between the reception of the charging event(s) and the creation of the resulting CDR. However, the CDF shall be capable of receiving and processing charging events and generating the resulting CDR in near real-time.
  * The relationship between CDF and CTF may be 1:1 (integrated CDF) or 1:n (separated CDF) (refer to clause 4.5 for possible physical configurations of the logical charging functions). This includes the possibility of NEs of different types feeding charging events into the same CDF.
  * All charging events used to build a CDR must originate from the same NE, i.e. there is no cross-NE or cross-NE-type correlation of charging events in the CDF.
The results of the CDF tasks are charging data records (CDRs) with a well-
defined content and format. The content and format of these CDRs are specified
per domain / subsystem / service in the related middle tier charging
specification (e.g. 3GPP TS 32.250 [10] for the CS domain and 3GPP TS 32.251
[11] for the PS domain, etc,).
#### 4.3.1.3 Charging Gateway Function
The CDRs produced by the CDF are transferred immediately to the Charging
Gateway Function (CGF) via the Ga reference point. The CGF acts as a gateway
between the 3GPP network and the Billing Domain. It uses the Bx reference
point for the transfer of CDR files to the BD. The entity relationship between
the CDF and the CGF is m:1, i.e. one or more CDFs may feed CDRs into a single
CGF. The CGF comprises the following main functions:
  * CDR reception from the CDF via the Ga reference point in near real-time. The protocols that may cross the Ga reference point are specified in 3GPP TS 32.295 [54].
  * CDR pre-processing:
\- Validation, Consolidation and (Re-) Formatting of CDRs.
\- CDR error handling.
\- Persistent CDR storage.
  * CDR routing and filtering, i.e. storing CDRs on separate files based on filtering criteria such as CDR type, CDR parameters, originating CDF, etc.
  * CDR File Management, e.g. file creation, file opening / closure triggers, file deletion.
  * CDR file transfer to the BD.
For further details of those functions see 3GPP TS 32.297 [52].
### 4.3.2 Online Charging Functions
Figure 4.3.2 provides an overview of the online part of the common charging
architecture. The figure depicts the logical charging functions in the network
and the OCS and the reference points between these functions.
**CTF:** **C** harging **T** rigger **F** unction
**OCF:** **O** nline **C** harging **F** unction
**ABMF** : **A** ccount **B** alance **M** anagement **F** unction
**RF:** **R** ating **F** unction
Figure 4.3.2: Logical ubiquitous online charging architecture
#### 4.3.2.1 Charging Trigger Function
As outlined in clause 4.1.2, online charging is a process where charging
information is collected in the network element in the same fashion as in
offline charging. This implies that, from the functional perspective, the CTF
defined in clause 4.3.1.1, also creates the charging events used for online
charging. While the accounting metrics used in online charging are generally
the same as in offline charging (i.e. the charging mechanism is transparent to
the Accounting Metrics Collection), the following functional enhancements
concerning the Accounting Data Forwarding are required in the CTF in order to
support online charging:
  * The information collected for, and included in, the online charging events is not necessarily identical to the offline charging case (i.e. the chargeable events may not necessarily be identical to those observed in offline charging);
  * The charging events are forwarded to the Online Charging Function (OCF) in order to obtain authorisation for the chargeable event / network resource usage requested by the user;
  * The CTF must be able to delay the actual resource usage until permission by the OCS has been granted;
  * The CTF must be able to track the availability of resource usage permission ("quota supervision") during the network resource usage;
  * The CTF must be able to enforce termination of the end user's network resource usage when permission by the OCS is not granted or expires.
The underlying principles for requesting, granting and managing resource usage
permissions are described in detail in clause 5.1.
Note that the S-CSCF, although involved in online charging, does not create
any online charging events, therefore clauses 4.3.2.1 and 4.3.2.2 are not
completely applicable to the S-CSCF. Clause 4.3.2.2.2 describes online
charging specifically for the S-CSCF.
The charging events for online charging are transferred to the OCS using the
CAP or Ro reference points. Refer to figure 4.1 for information on the
applicability of CAP or Ro per NE type.
#### 4.3.2.2 Online Charging System
The following subclauses summarise the tasks of the functions comprising the
Online Charging System. Details of the OCS, and the role of each of its
functional components, are described in 3GPP TS 32.296 [53].
##### 4.3.2.2.1 Online Charging Function
The Online Charging Function (OCF) consists of two distinct modules, namely
the Session Based Charging Function (SBCF) and the Event Based Charging
Function (EBCF).
The Session Based Charging Function is responsible for online charging of
network / user sessions, e.g. voice calls, IP CAN bearers, IP CAN session or
IMS sessions.
The Event Based Charging Function performs event-based online charging (also
referred to as "content charging") in conjunction with any application server
or service NE, including SIP application servers.
Online charging in the CS and PS domains may be performed using the CAP
reference point from the MSC and SGSN, respectively, to the Online Charging
Function (refer to 3GPP TS 23.078 [207] for details on CAP). Online charging
communication between the S-CSCF and the SBCF is described in clause
4.3.2.2.2. All other network elements employ the Ro reference point for online
charging (refer to 3GPP TS 32.299 [50]). Refer to 3GPP TS 32.296 [53] for
details on the relation between the network elements (i.e. the embedded online
enhanced CTF) and the SBCF or EBCF, respectively.
##### 4.3.2.2.2 S-CSCF online charging / IMS Gateway Function
As stated above, the S-CSCF does not trigger any online charging events and
thus does not include the CTF online charging enhancements described in clause
4.3.2.1 (in contrast, it does have a CTF for offline charging, as described in
clause 4.3.1.1). Instead, the ISC interface is employed by the S-CSCF online
charging, implying that online charging is transparent to the S-CSCF and
appears like any other service logic controlled by a SIP application server.
Therefore, if support for Ro based online charging is required instead of / or
in addition to application server or MRFC, a special CTF is needed in order to
mediate between the Ro based SBCF and the SIP based service control. This role
is taken by the IMS Gateway Function (IMS GWF), which translates between SIP
service control towards the S-CSCF and Ro credit control on the OCS side.
From the perspective of the online charging architecture, the IMS GWF is an
online charging capable CTF; from the perspective of the S-CSCF, the IMS GWF
is a SIP application server and is triggered the same way. It is out of scope
of the 3GPP standards whether the IMS GWF is embedded in the S-CSCF, embedded
in the OCS/SBCF, or exists as a stand-alone component.
##### 4.3.2.2.3 Rating Function
The Rating Function (RF) determines the value of the network resource usage
(described in the charging event received by the OCF from the network) on
behalf of the OCF. To this end, the OCF furnishes the necessary information,
obtained from the charging event, to the RF and receives in return the rating
output (monetary or non-monetary units), via the Re reference point. The RF
may handle a wide variety of rateable instances, such as:
  * Rating of data volume (e.g. based on charging initiated by an access network entity, i.e. on the bearer level);
  * Rating of session / connection time (e.g. based on charging initiated by a SIP application, i.e. on the subsystem level);
  * Rating of service events (e.g. based on charging of web content or MMS, i.e. on the service level).
##### 4.3.2.2.4 Account Balance Management Function
The Account Balance Management Function (ABMF) is the location of the
subscriber's account balance within the OCS. The ABMF is not specified in
detail in this Release, however, it is put into functional context within 3GPP
TS 32.296 [53].
#### 4.3.2.3 CDR generation for online charged subscribers
In offline charging, CDRs are generated in the network and forwarded to the BD
for further processing, e.g. generating subscriber bills. In online charging,
network resource usage is granted by the OCS based on a subscriber account on
the OCS. If required by the operator, CDRs may additionally be generated for
online charged subscribers. One way of achieving this is by performing online
charging and offline charging simultaneously for these subscribers.
Alternatively, the OCS can accomplish this by the use of the appropriate
offline charging functions as follows:
  * A CDF, as specified in clause 4.3.1.2, is employed by each of the OCFs that are required to generate CDRs from the charging events they receive from the CTF;
  * A CGF, as specified in clause 4.3.1.3, is employed by the OCS in order to generate / manage CDR files and provide these files to the BD.
## 4.4 Reference points
### 4.4.1 Offline charging reference points
#### 4.4.1.1 Rf
The Rf reference point supports interaction between a Charging Trigger
Function and a Charging Data Function. The following information may flow
across this reference point in real-time:
  * Charging events for offline charging from the CTF to the CDF;
  * Acknowledgements for these events from the CDF to the CTF.
The protocol(s) crossing this reference point shall support the following
capabilities:
```{=html}
``` \- Real-time transactions;
  * Stateless mode ("event based charging") and statefull mode ("session based charging") of operation;
  * Provide its own reliability mechanisms, e.g. retransmission of charging events, to run also on unreliable transport.
In addition, the protocol should support changeover to a secondary destination
(alternate CDF(s)) in case of the primary CDF not being reachable.
This interface application is defined in 3GPP TS 32.299 [50]. The information
contained in the charging events and the relevant chargeable events are
specific to the domain / subsystem / service and are detailed in the
respective middle tier TSs.
#### 4.4.1.2 Gz
The Gz reference point is functionally equivalent to Ga for Legacy PS domain
and to Ga or Rf for Evolved PS domain, and hence is replaced by Ga or Rf
within the common charging architecture. See also clause 4.2.
#### 4.4.1.3 Ga
The Ga reference point supports interaction between a Charging Data Function
and a Charging Gateway Function. The following information may flow across
this reference point:
  * CDRs are sent from the CDF to the CGF;
  * Acknowledgements for these CDRs are returned from the CGF to the CDF.
The protocol(s) crossing this reference point shall support the following
capabilities:
```{=html}
``` \- Near real-time transactions;
  * Send one or more CDRs in a single request message;
  * Changeover to secondary destinations (alternate CGFs) in case of the primary CGF not being reachable;
  * Provide its own reliability mechanisms, e.g. retransmission of charging events, to run also on unreliable transport.
This interface application is defined in 3GPP TS 32.295 [54]. The content of
the CDRs, and the CDR trigger conditions, are specific to the domain /
subsystem / service and are detailed in the middle tier charging TSs.
#### 4.4.1.4 Bx
The Bx reference point supports interaction between a Charging Gateway
Function and the Billing Domain. The information crossing this reference point
is comprised of CDR files. A common, standard file transfer protocol (e.g.
FTAM, FTP) shall be used, including the transport mechanisms specified for the
selected protocol.
This interface application is defined in 3GPP TS 32.297 [52]. The information
contained in the files corresponds to the CDRs defined per
domain/subsystem/service, as stated in clause 4.4.1.3.
#### 4.4.1.5 Wf
The Wf reference point is functionally equivalent to Rf, and hence is replaced
by Rf within the common charging architecture. See also clause 4.2.
### 4.4.2 Online charging reference points
#### 4.4.2.1 Ro
The Ro reference point supports interaction between a Charging Trigger
Function and an Online Charging Function. The following information may flow
across this reference point:
  * Charging events for online charging from the CTF to the OCF.
  * Receive Acknowledgements for these charging events from the OCF to the CTF. The acknowledgement grants or rejects the network resource usage requested in the charging event, according to the decision taken by the OCS.
The protocol(s) crossing this reference point shall support the following
capabilities:
  * Real-time transactions;
  * Stateless mode ("event based charging") and statefull mode ("session based charging") of operation;
NOTE: For \"event based charging\", the protocol may be stateless, however
Internal implementation of the Charging Trigger Function and Online Charging
Function may be stateful across the different charging events.
  * Provide its own reliability mechanisms, e.g. retransmission of charging events, to run also on unreliable transport.
In addition, the protocol should support changeover to a secondary destination
(alternate OCF(s)) in case of the primary OCF not being reachable.
This interface application is defined in 3GPP TS 32.299 [50]. The information
contained in the charging events and the relevant chargeable events are
specific to the domain / subsystem / service and are detailed in the
respective middle tier TSs.
#### 4.4.2.2 CAP
The CAP reference point provides similar functionality for online charging as
Ro, however, it is based on CAMEL techniques. It is kept within the overall
charging architecture as CAMEL may be used in the CS and PS domains. See 3GPP
TS 23.078 [207] for details on CAMEL.
#### 4.4.2.3 Gy
The Gy reference point is functionally equivalent to Ro, and hence is replaced
by Ro within the common charging architecture. See also clause 4.2.
#### 4.4.2.4 Re
The Re reference point supports interaction between the OCF and a Rating
Function (RF) in order to determine the value of chargeable events in terms of
monetary or non-monetary units. This interface application is defined in 3GPP
TS 32.296 [53].
#### 4.4.2.5 Rc
The Rc reference point allows the interaction between the OCF and an Account
Balance Management Function (ABMF) in order to access the account of the
subscriber on the OCS. This reference point is FFS for future releases. See
3GPP TS 32.296 [53] for further information.
#### 4.4.2.6 Wo
The Wo reference point is functionally equivalent to Ro, and hence is replaced
by Ro within the common charging architecture. See also clause 4.2.
## 4.5 Architecture mapping
The following subclauses describe how the logical ubiquitous charging
architecture can be mapped onto physical components and interfaces within the
scope of 3GPP standards.
### 4.5.1 Offline mapping
The figures below depict the mappings of the ubiquitous offline charging
architecture onto physical implementations that are identified within the 3GPP
standards. As stated previously in the present document, the CTF is a
mandatory component of all NEs that have offline charging capabilities. In
contrast, the CDF and the CGF may be implemented in any of the following ways:
(1) CDF and CGF integrated in the NE. In this implementation, all network
charging functions are embedded in the NE, i.e. the NE is fully self-contained
in terms of offline charging. The (physical) NE itself produces the CDR files
that are then transferred to the BD. Consequently, only the Bx reference point
needs to be implemented as a physical interface.
Figure 4.5.1.1 : CDF and CGF integrated in the NE
(2) CDF integrated in the NE, CGF in a separate physical element. In this
implementation, the (physical) NE generates CDRs and sends them to an external
CGF. Hence the Ga reference point must be implemented in the NE as a physical
interface. If the CGF is a stand-alone entity, it must implement both the Ga
and the Bx reference point as physical interface. As a variation of this
construct, the CGF may be integrated in the BD, in which case the Bx reference
point is internal to the BD.
Figure 4.5.1.2 : CDF integrated in the NE, CGF in a separate physical element
(3) CDF and CGF in two separate physical elements. This scenario represents
the fully distributed implementation where all reference points must be
implemented as physical interfaces on the NE, CDF and CGF, respectively.
Again, as a variation of this approach, the CGF may be an integral component
of the BD, in which case the Bx reference point becomes internal to the BD.
Figure 4.5.1.3 : CDF and CGF in two separate physical elements
(4) CDF and CGF in the same separate physical element. In contrast to scenario
3, there is no physical Ga interface, whereas the Rf and Bx reference points
must exist as distinct interfaces in the same fashion as in scenario 3. The
variation of the combined CDF/CGF being embedded in the BD is again possible,
resulting in the Rf reference point being the only one that appears as a
physical interface.
Figure 4.5.1.4 : CDF and CGF in the same separate physical element
Details of the possible implementation options per domain / subsystem /
service (usually a subset of the overall possible variants described above)
are specified in the respective middle tier TS.
### 4.5.2 Online mapping
The CTF is a mandatory integrated component of all network elements that are
involved in online charging as depicted in figure 4.1, with the exception of
the S-CSCF (see clause 4.3.2.2.2). If CDR generation by the OCS is required,
as described in clause 4.3.2.3, then a CDF is integrated in each OCF that is
required to produce the CDRs. All other possibilities for physical mapping,
including e.g.:
  * integrated versus distributed CGF in the OCS,
  * use of another CGF by the OCS,
  * IMS GWF integrated in S-CSCF or OCS, or a stand-alone entity,
are not specified within the 3GPP standards and are therefore implementation
specific. The same is true for the composition of the OCS and its logical
functions.
# 5 Charging principles
The high-level requirements for charging are specified in 3GPP TS 22.115
[101]. The following subclauses detail the charging principles on the basis of
the architecture and framework defined in clause 4, in respect of:
  * Charging data generation and quota supervision;
  * Aspects of charging information transfer;
  * Charging levels and charging data correlation;
  * Charging information utilisation.
## 5.1 Charging data generation and quota supervision
The CTF embedded in all charging relevant network elements collects charging
information within the NE concerning the use of network resources by the
mobile end users. These network resources may pertain to bearer (e.g. CS, PS,
WLAN), subsystem (e.g. IMS sessions) or service (e.g. MMS) usage /
consumption. The various charging levels are further described in clause 5.3.
The purpose of offline charging is to transform the charging information into
CDRs that are post-processed within the Billing Domain, e.g. for the purpose
of generating bills. While the collection of charging information used for the
CDRs occurs during the network resource usage, there is no impact of offline
charging on the use of the resources. All activities involved in the
transformation of the charging information into end user bills, and the
collection of the end user charges incurred in these bills, occur _offline_
to, or after, the network resource usage.
The purpose of online charging is to furnish charging information to the OCS
in order to perform credit control before the network resource usage is
permitted. To this end, a prepaid subscriber account has to exist in the OCS,
against which the resource usage can be billed. Hence all activities to assess
the requested resource usage, to determine its value in monetary or other
units, and to debit these units from the subscriber account, must occur prior
to or at least, during the resource usage, i.e. _online_ with respect to
resource usage. Depending on the circumstances, a final evaluation must occur
when resource usage ends. Hence, two cases must be distinguished:
  * Direct Debiting: the requested resource can be determined and billed in a one-off procedure. In that case, the resource usage is debited from the subscriber account immediately when processing the charging event, and the permission for the resource usage is returned to the network. An example of this may be the forwarding of a terminating short message from the MSC to the end user. In this scenario, it is generally required that the network can guarantee resource usage execution in order to avoid over-billing the user.
  * Unit Reservation: the OCS cannot a priori know the amount of resources that the end user may eventually consume, or it cannot be assumed a priori that the resource usage request can be (completely) fulfilled. In this case, a certain amount of (monetary or non-monetary) units is blocked, or reserved, on the subscriber's account on the OCS, and permission to use an amount of resources that matches the unit reservation is returned to the network. When the granted units have been used or a new, not yet authorised chargeable event occurs, the network must send a new request for unit allocation to the OCS. When resource usage has been executed, the actual amount of resource usage (i.e. the used units) must be returned by the NE to the OCS so that eventually over-reserved amounts can be re-credited to the subscriber account, assuring that the correct amount gets debited.
Charging information is collected by the CTF based on chargeable events that
describe the user(s) and their requested network resource usage. The
chargeable events are specific to each domain / service / subsystem and
specified in the respective middle tier charging TS. For each chargeable
event, a matching charging event is formed and immediately sent to its
destination, i.e. the CDF in offline charging or the OCF in online charging.
Again, the event information is specific to the domain / service / subsystem
and defined in the respective middle tier charging TS. While the accounting
metrics (provided by the Accounting Metrics Collection part of the CTF) used
in online and offline charging are generally identical, the information
comprising chargeable events (determined by the Accounting Data Forwarding
part of the CTF) may be different between online and offline charging. Note
also that online and offline charging may occur simultaneously, i.e. for the
same resource usage the CTF may send an offline charging event to the CDF and
an online charging event to the OCF. In that particular case, credit control
occurs for that resource usage but at the same time, CDRs are created in
offline charging. Alternatively, if CDRs are required for online charged
resource usage, this can be achieved by generating these CDRs in the OCS, as
depicted in clause 4.3.2.3.
Both online and offline charging can be categorised into two distinct classes,
namely event based charging and session based charging. Event based charging
implies that a chargeable event is defined as a single end-user-to-network
transaction, e.g. the sending of a multimedia message. This chargeable event
is then mapped to an appropriate charging event, resulting in a single CDR or
in a single credit control and resource usage authorisation procedure. In
contrast, session based charging is characterised by the existence of a user
session, such as a circuit call, an IP CAN bearer, or an IMS session. This
user session is then matched by a charging session, resulting in the
generation of multiple chargeable/charging events and the creation of one or
more CDRs in offline charging or the performance of a credit control session
in online charging. The following paragraphs describe the event versus session
based charging in more detail for both online and offline charging.
**\- Event based charging**. The (chargeable) event is recognised in the NE
that handles it, based on e.g. signalling exchange between the user equipment
and the NE. The event is then mapped onto a single charging event as specified
in the middle tier charging TS that applies to that NE.
\- In _online_ charging, the charging event is transferred to the EBCF via the
Ro or CAP reference point, and the chargeable event is authorised after
successfully performing credit control on the subscriber account. The complete
procedure must occur in real-time. If the chargeable event is not authorised
by the OCS (e.g. when the subscriber account does not contain sufficient
credit), the NE rejects the resource usage pertaining to that chargeable
event.
\- The event charging procedure may occur with or without reservation of units
from the subscriber's account ("Event Charging with Unit Reservation" (ECUR)
or "Immediate Event Charging" (IEC), respectively), as described above.
Furthermore, if the procedure does include reservation, the OCS may choose to
authorise one or more occurrences of the chargeable event (i.e. allot one or
more "service" units). For example, multiple short messages may be authorised
upon the first SMS request from the user.
\- In _offline_ charging, the charging event is transferred to the CDF via the
Rf reference point. The CDF produces a matching CDR, which is then sent to the
CGF via the Ga reference point. The CDR will eventually be transferred to the
BD in a CDR file, together with other CDRs of the same or different types,
according to file transfer configuration by the operator. While there is no
real-time requirement on any particular part of this procedure, the system
should be capable of completing the process from the detection of the
chargeable event up to, and including, CDR transfer to the CGF, in near real-
time.
**\- Session based charging**. The start of the user session is recognised by
the NE that handles the session, based on e.g. signalling exchange between the
user equipment and the NE. This chargeable event is then mapped onto a
charging event as specified in the middle tier charging TS that applies to
that NE.
\- In _online_ charging, an "initial" charging event (session start) is
transferred to the SBCF via the Ro or CAP reference point and the start of the
user session is authorised after successfully performing credit control on the
subscriber account. The NE may delay the actual start of the user session
until authorisation has been obtained (cf. 4.3.2.1). As there is no
information available at this time concerning the overall evaluation of the
session (e.g. complete duration or data volume of the session), session based
charging always involves reservation of units from the subscriber's account
("Session based Charging with Unit Reservation" (SCUR)): the OCS reserves
credit from the subscriber account and returns the corresponding quota (e.g.
units specifying the number of minutes or bytes allowed) to the NE. The NE, in
turn, uses the provided quota to supervise the actual network resource
consumption. In the case that another chargeable event occurs for the session,
the network element issues an "interim" charging event in order to also
authorise this new chargeable event. When the quota is used up, the network
element either issues another interim charging event, requesting further units
to be allotted, or terminates the session if previously instructed to do so by
the OCS. Once the session is terminated in the network element, the consumed
units are reported back to the OCS with a "final" charging event. The credit
control session is then terminated, and the OCS returns the value of any
unused quota (as reported by the NE) to the subscriber's account. The complete
procedure of receiving, processing and responding to an online charging event,
must occur in real-time. Note that this procedure can occur in parallel for
several concurrent services running on the same user session.
> For each charging event received during the session, the OCS decides whether
> to authorise the resource usage or whether to decline the request (e.g. when
> the subscriber account does not contain sufficient credit). If, at any time
> within the session, the OCS determines not to authorise the chargeable
> event, it rejects the request sent by the network element, causing the NE to
> disallow the resource usage pertaining to that chargeable event. It must be
> noted that this does not necessarily terminate the user session. E.g. in the
> case of credit exhaustion, the session could be redirected to a credit
> recharging site.
\- In _offline_ charging, the "initial" charging event is transferred to the
CDF via the Rf reference point. Upon termination of the subscriber session, or
when a new chargeable event occurs (as specified in the respective middle tier
charging TS), further charging events ("final" or "interim" events,
respectively) are sent for the session from the NE to the CDF. The CDF formats
one or more of these events into CDRs according to CDR formats specified in
the middle tier TSs, and in accordance with CDR generation triggers configured
by the operator. Upon its completion, the CDR will be sent forward to the CGF
via the Ga reference point, and a new CDR will be opened by the CDF for the
same session. Finally, the CDRs will eventually be transferred to the BD in a
CDR file, together with other CDRs of the same or different types, according
to file transfer configuration by the operator.
> The system should be capable of completing the process of chargeable event
> detection and charging event forwarding, CDR generation / closure and CDR
> forwarding as closely as possible in real-time. However, a significant time
> may pass between the reception of the first charging event for a CDR and the
> time the CDR is closed, depending on the CDR generation triggers configured
> by the operator.
For both event and session based charging, it has been specified above that
the NE shall disallow the requested resource usage when the associated
chargeable event is not authorised by the OCS. The most typical case for the
OCS to refuse authorisation is the expiry of the subscriber account. However,
depending on operator policy, even in the case of account expiry the OCS may
determine to allow the resource usage to occur / to continue. For example, if
the interruption of the user session renders the complete session useless to
the end user, it would be unfair to debit the user's account for the portion
of the session that was executed. While the decision making procedures and the
special treatment of this situation are internal to the OCS, the important
aspect to note is that the OCS _must grant authorisation_ towards the network
in order to allow the event to occur or the session to continue, effectively
making the event or (remainder of the) session free of charge.
Clause 5.2 provides a detailed analysis of the possible relationships between
charging events, credit control processes, CDRs and CDR files as well as their
triggers.
Both Charging Data Record and online charging data generation and contents
should be flexible and unnecessary redundancy in data should be avoided.
Clause 5.4 describes how the generation of charging data can be configured by
the network operator in order to support the above requirement.
Charging data are collected for successful and selected unsuccessful resource
usage attempts. The resource usage attempt is seen as being successful in the
network element (where the chargeable event is detected) when the user event
is successfully completed, or the user session has started. Further details,
such as the indication of failure and failure reasons in charging events and
CDRs, are specified in the middle tier charging TSs.
NOTE: Some of the terminology used in this clause differs from IETF RFC 4006
[402] that forms the basis for the online charging application. For example,
the DCCA uses "session" and "event" more in terms of the credit control
protocol rather than in terms of user activity, as the present document does.
The mapping of the concepts and terminology used to describe the concepts, is
described in 3GPP TS 32.299 [50].
## 5.2 Charging data transfer
Clause 5.1 describes the generation of charging information, events and
records and quota supervision across the various logical functions. In the
present clause, the relation between the events, records, credit control
sessions and CDR files is explained.
### 5.2.1 Charging data transfer in offline charging
In offline charging, charging events mirroring the resource usage request of
the user are transferred from the CTF to the CDF via the Rf reference point.
The CTF determines whether the request corresponds to an event (event based
charging) or whether a session shall be started (session based charging).
Generally, this property is built into the network capability, or service,
that the NE provides, and described in the middle tier charging TSs.
#### 5.2.1.1 Transfer of charging events via Rf
In event based charging, a network / user event (e.g. MM submission)
corresponds to a single chargeable event. In session based charging, at least
two chargeable events are needed, one each to describe the start and the end
of the session, respectively. Multiple interim events are possible in order to
describe changes to session characteristics (generally termed "change of
charging condition", e.g. tariff time switch, change of PDP context QoS or
change of IMS session media types), or when certain limits, e.g. time or
volume, are exceeded. The CTF transforms each chargeable event into a charging
event and forwards these charging events to the CDF in real-time.
The relation between chargeable events and charging events is 1:1. For event
based charging, the relation between charging events and CDRs is 1:1. For
session based charging, the relation between charging events and CDRs is m:n
with m >=n. The middle tier TSs specify the chargeable events per domain /
service / subsystem even if Rf does not exist as an open interface in the
respective domain / service / subsystem, as it is always required to identify
the connection between chargeable events and triggers for CDR generation and
information addition.
If charging events are generated for unsuccessful resource usage attempts, the
charging event must describe the reason and the circumstances of the failure.
Details, including if and when those events are generated, are specified in
the middle tier TSs.
Details on the protocol application for the open Rf interface, including the
message types and the domain / subsystem /service independent contents of the
messages, can be found in 3GPP TS 32.299 [50].
#### 5.2.1.2 Transfer of CDRs via Ga
Upon receiving a charging event, the CDF uses the event to create/open a CDR
(both event and session based charging), or to add information to an existing
open CDR. As there is a 1:1 mapping between charging events and CDRs in event
based charging, CDRs are created promptly after receiving and processing the
event, and are then ready for transfer on to the CGF via the Ga reference
point.
In session based charging, a CDR is opened when the initial charging event,
specifying the start of a user session, is received. Information is added to
the CDR upon receiving interim charging events. The CDR may be closed due to a
number of reasons configured on the CDF or dependent on implementation,
including but not limited to:
\- CDR time limit;
\- CDR volume limit;
\- limit of change of charging conditions;
\- end of user session, e.g. reception of the final charging event describing
the session termination;
\- limits (e.g. memory size) imposed by implementation.
When a CDR is closed and the session is still active, a subsequent CDR is
opened. Hence multiple "partial CDRs" may be needed to completely describe the
session. This implies that opening and closure of CDRs may occur completely
asynchronously to the reception of the charging events.
The size of partial CDRs could be optionally reduced by allowing a reduced
format for partial CDRs, implying that some information can be eliminated
rather than repeated in all the partial CDRs. This means that only changes
from one CDR to the next, in addition to mandatory information, is reported.
All the missing information can be reconstructed from fields in previous
partial CDRs. For example, if location information is captured in CDRs but the
user did not change location, the corresponding partial CDR would not include
any location information.
Therefore, two formats are considered for Partial CDRs:
\- a _Fully Qualified Partial CDR_ that contains the complete set of CDR
Fields, and
\- a _Reduced Partial CDR_ that contains all the Mandatory fields (**M**) and
ONLY the changes that occurred in any other field relative to the previous
partial CDR.
The first CDR generated when a session is opened shall be a Fully Qualified
Partial CDR. Subsequent partial CDRs may be Reduced Partial CDRs. Thus, the
convention is that when any non-mandatory field is missing from a Reduced
Partial CDR, it should be interpreted that the same field as in the previous
partial CDR could be used. Refer to clause 5.4 for the definition of
"mandatory" and other CDR field categories.
All CDFs and CGFs from all vendors shall be able to generate or receive Fully
Qualified Partial CDRs. Generation and reception of Reduced Partial CDRs on
the Ga interface is optional. However, if Reduced Partial CDRs are transmitted
on the Ga interface they must comply with the rules specified in this clause.
If the CDFs are generating Reduced Partial CDRs on the Ga interface, the CGF
must be able to convert the CDRs into Fully Qualified Partial CDRs. However,
if according to operator choice, the BD can support Reduced Partial CDRs, no
conversion to the Fully Qualified Partial CDR format is required.
The possible charging configurations that can be supported on both the Ga and
the Bx interfaces are illustrated in figure 5.2.1.2. Configuration a) is the
default arrangement that MUST be supported by all systems. The other
configurations are optional and may be supported IN ADDITION to configuration
a). Configuration b) illustrates the case where the CGF is converting Reduced
to Fully Qualified Partial CDRs. Configuration c) depicts the case were
Reduced Partial CDRs can be received in the billing domain and no conversion
is needed.
Figure 5.2.1.2 : Possible Configurations of Ga and Bx CDR Formats
When a CDR is closed, it is immediately transferred to the CGF. The exact
timing may be determined by configuration parameters of the protocol used on
Ga. The CDF shall be capable of receiving and processing charging events and
generating and forwarding the resulting CDRs in near real-time.
Details on the protocol application for the open Ga interface can be found in
3GPP TS 32.295 [54]. The semantics and formal description of the CDR
parameters are specified in 3GPP TS 32.298 [51].
#### 5.2.1.3 Transfer of CDR files via Bx
The CGF is responsible for persistent CDR storage, for preparing CDR files and
transferring them to the BD via the Bx reference point. To this end, the CGF
provides one or more files on which to store the CDRs after potential
reformatting to comply with the Bx file format specified in 3GPP TS 32.297
[52].
The CDRs may be routed to one of several simultaneously open files inside the
CGF depending on certain CDR parameters, such as CDR type, or on other
criteria such as the originating CDF. CDR files are closed on the CGF based on
certain operator configured parameters, for example:
\- file size limit,
\- file duration (time) limit,
\- time of day,
\- maximum number of CDRs.
This implies that the closure of a CDR file occurs asynchronously to the
reception of CDRs on the CGF. When a CDR file is closed, the CGF must assure
that a new CDR file is available to store incoming CDRs in line with the CDR
routing facility described above.
Once CDR files are closed, they are ready for transfer to the BD. The CGF
shall support both "push" transfer mode (i.e. CGF triggers and controls file
transfer to BD) and "pull" transfer mode (i.e. BD triggers and controls file
transfer). In push mode, the CGF uploads the files to the BD according to
operator specified parameters, such as time of day, number of available files,
etc. In pull mode, the BD may request the files from the CGF at any point in
time at the discretion of the BD.
For all procedures involved in CDR reception, processing and storing, the CGF
shall be capable of complying with near real-time requirements. Details on the
protocol application for the open Bx interface and the functionality of the
CGF can be found in 3GPP TS 32.297 [52]. The semantics and formal description
of the CDR parameters are specified in 3GPP TS 32.298 [51].
### 5.2.2 Charging Data Transfer in Online Charging
In online charging, charging events mirroring the resource usage request of
the user are transferred from the CTF to the OCF via the Ro reference point.
The CTF determines whether the request corresponds to an user / network event
(event based charging, e.g. MMS) or whether a session shall be started
(session based charging, e.g. IP CAN bearer). Generally, this property is
built into the network capability, or service, that the NE provides, and
described in the middle tier charging TSs.
Note that 3GPP TS 23.078 [207] also specifies online charging capability in
the SGSN and MSC based on CAMEL, i.e. using the CAP reference point towards
the OCS. This functionality is outside the scope of the present document.
In event based charging, a network / user event (e.g. MM submission)
corresponds to a single chargeable event. In session based charging, at least
two chargeable events are needed, one each to describe the start and the end
of the session, respectively. Multiple interim events are possible in order to
describe changes of session characteristics (e.g. change of IP CAN bearer QoS
or change of IMS session media types), or when certain limits, e.g. time or
volume, are exceeded. The CTF transforms each chargeable event into a charging
event and forwards these charging events to the OCF in real-time.
For event based charging, the credit control procedure in the OCS may or may
not involve reservation of units from the subscriber account, as described in
clause 5.1. In the case of event based charging without reservation (IEC):
\- The CTF forwards the charging event to the OCS;
\- The OCS determines the value of the requested resource usage and debits
this value from the subscriber account;
\- The OCS returns the resource usage authorisation to the network element;
\- The network element executes the resource usage according to the user
request and the OCS authorisation.
> The following exceptions and abnormal cases are defined for the IEC
> scenario:
1) The OCS rejects the resource usage request. In this case, the NE disallows
the resource usage.
2) Subsequent to resource usage authorisation and execution of the resource
usage, the resource usage fails and the CTF may return the failure to the OCS
to initiate a refund for the original resource usage.
NOTE 1: The triggering of the refund action is implementation and service
dependent.
If the credit control procedure does involve reservation (ECUR):
\- The CTF forwards the charging event to the OCS;
\- The OCS determines the value of the requested resource usage and reserves
this value from the subscriber account;
\- The OCS returns the resource usage authorisation to the network element;
\- The network element executes the resource usage according to the user
request and the OCS authorisation.
\- After completion (or failure) of the resource usage, the NE informs the OCS
accordingly about the completion or failure;
\- In line with the result report from the network element, the OCS either
debits the reserved amount from the subscriber account (success), or it
returns the reserved amount back to the subscriber account (failure).
The following exceptions and abnormal cases are defined for the ECUR scenario:
1) The OCS rejects the resource usage request. In this case, the NE disallows
the resource usage.
2) The resource usage execution fails, e.g. due to network failure or user
abort. In this case, the network element informs the OCS of the failure, and
the previously reserved amounts are returned onto the subscriber account.
NOTE 2: Returning previously reserved amounts of units to the user's account
is up to operator policy in the OCS. The authorization of multiple chargeable
events as per the "event based charging" description in clause 5.1 is not yet
covered in the above scenario.
Session based online charging always involves reservation within the credit
control procedure (SCUR), as there is no way for the OCS to predict the amount
of resource usage that occurs during the user session. To begin with, the CTF
forward generates a charging chargeable event that corresponds to the resource
usage request and maps onto the user session, and forwards it to the OCF. In
the OCS, the online charging session is started and a certain amount reserved
from the user subscriber account. This amount is determined by the OCS based
on the information in the charging event and on local configuration, i.e.
operator policy. A resource usage quota, matching the reserved amount, is then
returned by the OCS, at which point the user session starts in the NE. Further
charging events are sent from the NE to the OCS upon the detection of further
chargeable events within the session .e.g. the expiry of in intervals
configured on the NE or instructed by the OCS, or when the authorised quota
expires, or when session characteristics change (e.g. change of QoS of an IP
CAN bearer). The OCS then furnishes a new quota to the NE as required, or
rejects the charging event, e.g. due to expiry of credit on the subscriber
account. The OCS also furnishes the NE's behaviour on quota expiry
(termination action). When the user session terminates normally in the NE, a
final statement on the actually used network resources is returned to the OCS,
enabling the OCS to calculate the final value of the actual resource usage
session and to properly debit the corresponding final amount from the
subscriber account (possibly resulting in a re-crediting of previously
reserved amounts). This also terminates the credit control session for the
particular user session. The following exceptions and abnormal cases are
defined for the SCUR scenario:
1) For optimisation purposes, the network element may allow the user session
to start prior to receiving the initial authorisation from the OCS, i.e. prior
to the start of the credit control session.
2) The OCS rejects the initial resource usage request at session start, i.e.
no credit control session is started. In this case, the NE disallows the start
of the session or, if the session was already allowed to start as described in
item 1 above, enforces the termination of the user session.
3) The OCS rejects the resource usage request in mid session. In this case,
the NE's behaviour conforms to the instruction returned by the OCS, e.g.:
\- terminate the user session;
\- limit the characteristics of the user session, e.g. allow only Web/WAP
pages that are free of charge;
\- direct the session to a special notification site or an account recharging
server
4) The OCS may send unsolicited termination commands with the same effect as
described in item 3 above.
5) Unexpected termination of user session, e.g. due to network failure or due
to user abort. In this case, the behaviour of the network is as specified
above for session termination, but all available information of the failure is
returned to the OCS in the final statement. Further action of the OCS in
regard of calculating the session value and debiting or crediting the user's
account depends on the exact circumstances and operator policy.
In any of the above cases, the termination of the user session coincides with
the termination of the credit control session, e.g. even when a user session
is allowed to continue upon account expiry, the credit control session will
also continue, but "zero" rated.
NOTE 3: the intention of the above clause is not to enforce closing the user
session when the credit control session breaks down.
It is important for operators to carefully consider the reservation policy on
the OCS. On the one hand, if small amounts are reserved, the NE must renew the
authorisation very frequently, creating high signalling and processing loads.
Additionally, this policy has a comparatively high likelihood of longer, or
higher-value, user sessions being forcefully terminated due to expiry of the
subscriber account after many small quotas have been used for small chunks of
the subscriber session. In contrast, assigning high reservations avoids the
above problems, but may interdict the user from the execution of additional,
parallel resource usages: due to the high previous reservation, there is no
credit left on the account for another resource usage request. The situation
described in this paragraph is particularly complex when correlation between
multiple charging levels is necessary, see clause 5.3.4. A potential method of
relieving this problem is the pooling of credit quotas as described in clause
5.5.2 below.
The middle tier charging TSs specify the chargeable events and the content of
the associated charging events and responses. 3GPP TS 32.299 [50] specifies
the interface application for the Ro reference point, including the message
types and the domain / subsystem / service independent contents of the
messages. In addition to the credit control functions, the OCS may also be
capable of producing CDRs based on the execution of the above credit control
procedures. To this end, the OCS must implement a CDF, and it uses the Ga and
Bo reference points to forward its CDRs to a CGF and the CDR files to the BD.
These functions of the OCS, however, are outside the scope of 3GPP
standardisation.
## 5.3 Charging levels and correlation
Editor's note: To be completed. The use of EBCF and SBCF in the subclauses for
all the three charging levels shall also be described here.
### 5.3.1 Bearer level charging
#### 5.3.1.1 Bearer charging based on bearer / tele- / supplementary service
Editor's note: To be completed.
Charging data are also collected for supplementary service activity.
#### 5.3.1.2 Flow based bearer charging
Editor's note: To be completed.
### 5.3.2 Subsystem level charging
Editor's note: To be completed.
### 5.3.3 Service level charging
Editor's note: To be completed.
### 5.3.4 Charging data correlation
The charging data correlation combines charging events generated by CTF while
they are belong to the same bearer / session / service resource usage. The
correlation provides an association of charging information for the mobile
subscriber's resource usage.
The correlation is based on specific access network charging identifier:
  * Circuit Switched domain: MSC address and Call Reference Number;
  * Packet Switched domain: P-GW address and EPC Charging ID;
  * WLAN Access: PDG address and WLAN Charging ID;
  * Fixed Broadband Access: Multimedia Charging ID;
  * IM Subsystem: IMS Charging Identifier.
The charging information has to be aggregate for the same charging session and
correlate for the same service.
#### 5.3.4.1 Intra-level correlation
The intra-level correlation aggregates the charging events belonging to the
same charging session, e.g. over a time period, and implies the generation of
interim charging records.
#### 5.3.4.2 Inter-level correlation
The inter-level correlation combines the charging events belonging to the same
service but generated by different CTFs e.g. for PS access control via IM
Subsystem.
#### 5.3.4.3 Inter-network correlation
To enable the different operators involved in IMS sessions to identify each
other, the Inter Operator Identification concept (IOI) is introduced. IOI
allows operators involved with session signalling to identify each other by
exchanging operator identification information within the SIP signalling. The
IOI is composed of one pair of originating IOI and terminating IOI. The IOI
concept may help to support inter operator charging.
The following requirements relate to the IOI concept:
a) The IOI concept shall allow operators to uniquely identify each other for
the SIP based requests; for example between A\'s HPLMN and B\'s HPLMN or
between an A\'s HPLMN and a A\'s VPLMN.
b) The IOI concept can be used for inter operator accounting identification
purposes.
c) It shall be possible to prevent the information used for IOI from being
passed to the UE.
d) It shall be possible to apply the IOI concept on a peer to peer basis
between operators. It shall be possible to use different identity values for
operator identification between operators involved in IMS session related
procedures and session unrelated procedures.
e) IOI identities shall be included within SIP signalling:\ \ 1) When a SIP
request is passed out of a network the IOI identity of that network (referred
as originating IOI) shall be included in the SIP signalling.\ \ 2) When a SIP
response is returned the IOI identity of that responding network (referred as
terminating IOI) shall be included in the SIP signalling.
f) Each network is responsible for including its own unique IOI Identity into
the SIP signalling. The IOI Identity shall be unique for each operator (for
example the IOI Identity of Home Operator A is different from Home Operator
B).
g) Three types of IOI shall be defined:
1) Type 1 IOI: between the home network operator and a visited network
operator for an end user in roaming situation (case when the P-CSCF is located
in a visited network);
2) Type 2 IOI: between the network operator which holds the subscription of
the originating end user and the network operator which holds the subscription
of the terminating end user. In case of redirection, Type 2 IOI can be used
between network operators which hold a subscription of the terminating end
user, i.e. between the terminating party\'s network operator from which the
session is redirected to the terminating party\'s network operator to which
the session is redirected.
3) Type 3 IOI: between the home network operator and a service provider;
h) For Type 1 IOI, the P-CSCF is responsible for generating the originating
IOI and the S-CSCF in the home network is responsible for generating the
terminating IOI; For Type 1 IOI, the "enhanced MSC for ISC" is responsible for
generating the originating IOI.
i) For Type 2 IOI, the S-CSCF in the originating party\'s home network, the
E-CSCF in the originating party\'s local network or the originating MGCF is
responsible for generating the originating IOI and the S-CSCF in the
terminating party\'s home network or the terminating MGCF is responsible for
generating the terminating IOI. In case of redirection by the S-CSCF, the
S-CSCF-in the terminating party\'s network operator from which the session is
redirected- is responsible for generating the originating IOI and the S-CSCF
in the terminating party\'s network operator or the terminating MGCF- to which
the session is redirected- is responsible for generating the terminating IOI.
j) For Type 3 IOI, when forwarding a request to an AS, the S-CSCF in the home
network is responsible for generating the originating IOI and the AS contacted
by this S-CSCF is responsible for generating the terminating IOI. For a Type 3
IOI, when an AS initiates a request, the AS is responsible for generating the
originating IOI and the S-CSCF or I-CSCF contacted by this AS is responsible
for generating the terminating IOI. For Type 3 IOI, when the E-CSCF forwards a
request to the EATF or to the LRF, the E-CSCF is responsible for generating
the originating IOI, and the EATF and LRF are responsible for generating the
terminating IOI. For Type 3 IOI, when the LRF initiates a request to the
E-CSCF, the LRF is responsible for generating the originating IOI, and the
E-CSCF is responsible for generating the terminating IOI.
k) IOI Identities received in the session signalling shall be incorporated
into the CDRs produced by the IMS network elements. The operator
identification information may be used for inter operator accounting purposes.
l) The allocation of the IOI values for the operators is outside the scope of
3GPP standardization.
NOTE: The relationship of the IOI concept with security aspects between
operators is For Further Study (FFS).
## 5.4 Charging data configuration
Charging interface applications are specified for Rf and Ro in 3GPP TS 32.299
[50], for Ga in 3GPP TS 32.295 [54], and for Bx in 3GPP TS 32.297 [52]. The
middle tier charging TSs determine per domain / service /subsystem which of
the reference points exist as open interfaces and which of them are internal
to integrated NEs (see charging architecture mapping discussion in clause
4.5). In accordance with these prerequisites, the content of charging events
and CDRs is also specified in the middle tier charging TSs on all the open
network interfaces that exist in the respective domain / subsystem / service.
The rules governing the presence of charging event or CDR parameters on these
interfaces are summarized in this clause. A logical diagram illustrating the
possible presence requirements for charging event / CDR parameters ("field
categories") is shown in Figure 5.4.
Figure 5.4 : Logical diagram illustrating the different CDR field categories
The charging event and CDR description tables in the middle tier charging TSs
specify the Mandatory (M), Conditional (C) and Operator provisionable (Oc or
Om) designations. The category of a charging event or CDR parameter can have
one of two primary values:
> **M** This parameter is **M** andatory and shall always be present in the
> event / CDR.
>
> **C** This parameter shall be present in the event / CDR only when certain
> Conditions are met. These Conditions are specified as part of the parameter
> definition.
All other parameters are designated as Operator provisionable **(O)**. Using
network management functions or specific tools provided by an equipment
vendor, operators may choose if they wish to include or omit the parameter
from the charging event / CDR. Once omitted, this parameter is not generated
in an event / a CDR. To avoid any potential ambiguity, the CTF / CDF / CGF
MUST be able to provide all these parameters. Only an operator can choose
whether or not these parameters should be generated in their system, i.e.
included in the charging event / CDR.
Those parameters that the operator configures to be present are further
divided into mandatory and conditional categories:
> **Om** This is a parameter that, if provisioned by the operator to be
> present, shall always be included in the events / CDRs. In other words, an
> Om parameter that is provisioned to be present is a mandatory parameter.
>
> **Oc** This is a parameter that, if provisioned by the operator to be
> present, shall be included in the events / CDRs when the specified
> conditions are met. In other words, an Oc parameter that is configured to be
> present is a conditional parameter.
The charging event and CDR tables provide a brief description of each event /
CDR parameter in the corresponding 'middle \'tier\' TSs. The full definitions
of the parameters, sorted by the parameter name in alphabetical order, are
provided in 3GPP TS 32.298 [51].
## 5.5 Charging information utilisation
To be completed. This clause should be separated between offline charging /
CDRs / billing and online charging / credit control. OCS aspects will also be
included (e.g. OCS CDRs), e.g. the following text: "It is important to note
that also in the online charging case, operators may wish to apply similar
billing analyses (e.g. statistics) and, obviously, inter-operator accounting,
as in the offline charging case. If this is required, the OCS is responsible
to generate CDRs similar in scope to the ones described in offline charging
above."
The MSC server and Gateway MSC server are responsible for the collection of
all charging relevant information for each MS and PSTN connection and for the
storage of this information in the form of CDRs.
Circuit switched calls can be charged in one MSC server (the anchor MSC
server) where all relevant data is available. That is guaranteed by routing
all signalling information though the anchor MSC server even if the traffic
channel of a call is routed through another MSC server due to handover.
The Gateway MSC server acts as a gateway into other PLMN or fixed networks.
Within the PLMN, the GMSC server is responsible for the generation of CDRs for
calls routed from or into other networks.
If subscribed CAMEL services apply to MS, the (G)MSC servers contain CAMEL
subscription data providing the information required for invocation of the
CAMEL dialogues for controlling the MS terminating and MS originating calls.
Charging data record parameters resulting from the CAMEL treatment applying to
MS calls is derived from the CAMEL subscription data.
In addition to user subscribed services, specific dialled CAMEL services might
be invoked which also influence existing records or even trigger the
generation of separate records steered by service logic.
In addition to the information collected from these network elements, network
management functions are required for the administration of on-line charging
data stored in the network nodes. This data is employed to drive the charge
display on the User Equipment (UE) as required by the Advice of Charge (AoC)
service in TS 21.115 [101] and charging perspective of AoC is defined by 3GPP
TS 32.280 [69].
### 5.5.1 Subscriber charging
The charging data collected from the HPLMN, interrogating PLMN, and/or VPLMN
network elements is employed to determine the network utilization charges for
the basic and supplementary services utilized by the home subscribers of the
PLMN. The charges calculated are then combined with the network access
(subscription) charges and billed to those customers directly serviced by the
PLMN.
For those subscribers handled by Service Providers, the billing information is
employed for both wholesale (Network Operator to Service Provider) and retail
(Service Provider to Subscriber) billing. Consequently, having been processed
by the PLMN Billing System, the charging data collected from the network
elements may also be sent to the Service Provider for further processing.
#### 5.5.1.1 Calling Party Charging
This applies to calling party pays in Charged Party principals defined in 3GPP
TS 22.115 [101].
For subscription related chargeable events the charging information shall
indicate the charged party is normally the calling party. It should be
possible for multiple leg calls (e.g. forwarded, conference or roamed) to be
charged to each party as if each leg was separately initiated. However, in
certain types of call, the originating party may wish/be obliged to pay for
other legs (e.g. SMS MO may also pay for the MT leg.).
It shall be possible to change the chargeable party at the call set-up.
#### 5.5.1.2 Alternate Party Charging for IMS
This applies to the alternate charged party in Charged Party principles
defined in 3GPP TS 22.115 [101].
In IMS Offline and Online Charging as an alternative it is possible that
neither calling nor called party can be charged for the IMS session. The
alternate charged party need not be registered at the time that the charges
are made. It is required however, that the alternate charged party be a
verifiable charged party. Selection and verification is done through internal
actions in the SIP-AS. The Subscription Identification contains the identity
of alternate charged party. The IMS session is then processed in the normal
manner.
NOTE: The method for verifying the alternate charged party is not covered in
the current release.
### 5.5.2 Credit control and balance management
Editor's note: There may be more issues to consider in this clause, e.g.
consideration of proper amounts for reservation.
#### 5.5.2.1 Use of credit pooling
Credit fragmentation can occur when it is necessary to grant separate quotas.
Granting each quota causes some of the user\'s credit to be reserved at the
Server. It is then possible that all the user\'s credit may be reserved when
the user wishes to start using a new service. The new service may then be
denied, despite the fact that there remains unused credit in the user\'s
account.
To avoid such credit fragmentation and unnecessary load on the server, it is
possible for multiple quotas provided to be linked into a credit pool. The
client may then consider the quotas to form a single pool of credit, from
which all services draw units.
The reference to a credit pool includes a translation factor derived from the
rating parameter, which translates from units of a specific type (time/volume)
to the abstract units in the pool.
The use of credit pooling is described in IETF RFC 4006 [402].
### 5.5.3 Inter-operator settlement of Charges
#### 5.5.3.1 Inter-PLMN accounting
Inter-PLMN accounts for roaming traffic are determined in accordance with
ITU-T principles (see ITU-T Recommendation D.93 [300]) and are settled by
means of the GSM Association\'s Transferred Account Procedure (TAP).
#### 5.5.3.2 \'Visitors\' from other PLMNs
The CDRs collected from the network also include details of the services
employed by visiting (roaming) subscribers. The charges for Mobile Originated
Calls (MOCs) and for supplementary services used are calculated as for home
subscribers, converted to an agreed accounting currency and included in the
CDRs for the TAP. Even if Mobile Terminated Calls (MTCs) are zero-priced in
the visited network (VPLMN), in the absence of \'optimized routing\' the MTC
TAP records are still required by the home network (HPLMN) in order to
determine the re-routing charges from the HPLMN to the VPLMN.
The TAP records generated are exchanged with each HPLMN on a regular basis.
These TAP records form the basis of the invoice submitted by the VPLMN for the
traffic carried.
#### 5.5.3.4 \'Home\' subscribers roaming in other PLMNs
The HPLMN receives TAP records from each VPLMN for services employed by home
subscribers whilst roaming. These records are employed to verify the invoices
from the VPLMN and to bill the home subscribers for the services used. The
charges contained in the TAP records are converted from the accounting
currency to the local currency and a handling surcharge (mark-up) is added if
required. The TAP records are subsequently passed to the subscriber billing
process described in clause 5.1.2.1.
#### 5.5.3.5 Fixed network operators and other service providers
The settlement of accounts with the operators of fixed networks for traffic
carried, is generally performed on a bulk basis according to the principles
outlined in the ITU-T D-series recommendations.
The traffic accounted for in this manner may include:
\- outgoing (Mobile to Land) traffic;
\- incoming (Land to Mobile) traffic;
\- transit traffic, carried by intermediate networks;
\- signalling (MAP/SCCP, CAP/SCCP) traffic such as location updates.
Accounting information may also be required for the use of services provided
by other operators such as short message service centres and other Value Added
Service (VAS) providers.
The charges for the various traffic shares may be determined on the basis of
the CDRs generated by the network elements or on the basis of bulk counters
(accounting meter records) in the gateway MSC servers (GMSC servers). For the
purpose of the present document, the management information required is
assumed to be derived from CDRs. The management of accounting meters is
outside the scope of the present document.
### 5.5.4 Advice of Charge
The charging data collected from the network elements may be used to provide
tariff information concerning the use of services, by both home and visiting
subscribers, within the network. The appropriate tariff information to the
network elements is distributed by the Advice of Charge supplementary service.
The function is specified in TS 32.280 [69].
An alternative mode of AoC can also be used to indicate the occurrence of new
charges to the user, e.g. when a monthly allowance is being exceeded, or when
a service is requested that is not included in the subscription fees, while
others are. This topic is for further study.
###### ## Annex A (informative): Bibliography
**a) The 3GPP charging specifications**
\- 3GPP TS 32.252: \"Telecommunication management; Charging management;
Wireless Local Area Network (WLAN) charging\".
\- 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Subsystem (IMS) charging\".
\- 3GPP TS 32.271: \"Telecommunication management; Charging management;
Location Services (LCS) charging\".
\- 3GPP TS 32.272: \"Telecommunication management; Charging management; Push-
to-talk over Cellular (PoC) charging\".
\- 3GPP TS 32.273: \"Telecommunication management; Charging management;
Multimedia Broadcast and Multicast Service (MBMS) charging\".
\- 3GPP TS 32.274: \"Telecommunication management; Charging management; Short
Message Service (SMS) charging\".
\- 3GPP TS 32.275: "Telecommunication management; Charging management;
MultiMedia Telephony (MMTel) charging".
**b) Common 3GPP specifications**
\- 3GPP TS 23.002: \"Network architecture\".
**c) other Domain and Service specific 3GPP / ETSI specifications**
\- 3GPP TS 22.002: \"Circuit Bearer Services (BS) supported by a Public Land
Mobile Network
\- 3GPP TS 22.003: \"Circuit Teleservices Supported by a Public Land Mobile
Network (PLMN)\".
\- 3GPP TS 22.004: \"General on Supplementary Services\".
\- 3GPP TS 23.009: \"Handover procedures"
\- 3GPP TS 23.040: \"Technical realization of the Short Message Service
(SMS)\".
\- 3GPP TS 23.140: \"Multimedia Messaging Service (MMS); Functional
description; Stage 2\".
\- 3GPP TS 23.271: \"Location Services (LCS); Functional description; Stage
2\".
**d) Relevant ITU Recommendations**
\- ITU-T Recommendation E.164: \"The international public telecommunication
numbering plan\".
\- ITU-T Recommendation Q.767: \"Application of the ISDN user part of CCITT
signalling System No.7 for international ISDN interconnections\".
\- ITU-T Recommendation X.25: \"Interface between Data Terminal Equipment
(DTE) and Data Circuit-terminating Equipment (DCE) for terminals operating in
the packet mode and connected to public data networks by dedicated circuit\".
\- ITU-T Recommendation X.121: \"International numbering plan for public data
networks\".
**e) Relevant IETF RFCs**
\- IETF RFC 959 (1985): \"File Transfer Protocol\".
\- IETF RFC 3588 (2003): \"Diameter base protocol\".
\- IETF RFC1350: \"The TFTP Protocol (Revision 2)\".
#
# Foreword
This Technical Specification (TS) has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the mapping of the AMR generic frame format
(3GPP TS 26.101) to the Iu Interface (3GPP TS 25.415 [7]), the Uu Interface
and the Nb Interface (3GPP TS 29.415). It further specifies the mapping of
Enhanced Full Rate (GSM_EFR) coded speech and of PCM 64 kBit/s (ITU-T G.711
[9]) coded speech to the Nb Interface in a BICC-based circuit switched core
network.
The present document also specifies the mapping of Full Rate (GSM_FR) coded
speech and of Half Rate (GSM_HR) coded speech to the Nb Interface in a BICC-
based circuit switched core network.
The present document also specifies the transport of the AMR Codec Types, the
AMR-WB Codec Types, the GSM_EFR Codec, the GSM_FR Codec, the GSM_HR Codec and
the ITU-T G.711 Codec over the A-Interface over IP (3GPP TS 48.002 [11]) and
the Nb-Interface in a SIP-I -based circuit switched core network (3GPP TS
23.231 [12]).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or nonâ€‘specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TS 25.415: \"Iu Interface CN-UTRAN User plane Protocols\".
[2] 3GPP TS 26.101: \"AMR Speech Codec, Frame structure\".
[3] 3GPP TS 23.107: \"QoS Concept and Architecture\".
[4] 3GPP TS 46.051: \"Enhanced Full Rate (EFR) speech processing functions;
General Description\"
[5] 3GPP TS 28.062: \"Inband Tandem Free Operation (TFO) of speech codecs;
Service description; Stage 3\".
[6] 3GPP TS 23.153: \"Out of band transcoder control, Stage 2\".
[7] 3GPP TS 29.415: \"Core Network Nb Interface User Plane Protocols\".
[8] ITU-T I.366.2: \"AAL type 2 service specific convergence sublayer for
trunking\".
[9] ITU-T Recommendation G.711: \"Pulse code modulation (PCM) of voice
frequencies\".
[10] 3GPP TS 29.414: \"Core Network Nb data transport and transport
signalling\".
[11] 3GPP TS 48.002: \"Base Station System - Mobile-services Switching Centre
(BSS - MSC) interface; Interface principles\".
[12] 3GPP TS 23.231: \"SIP-I based circuit-switched core network; Stage 2\".
[13] 3GPP TS 29.007: \"General requirements on interworking between the Public
Land Mobile Network (PLMN) and the Integrated Services Digital Network (ISDN)
or Public Switched Telephone Network (PSTN)\".
[14] 3GPP TS 26.103: \"Speech codec list for GSM and UMTS \".
[15] IETF RFC 3264 (2002): \"An Offer/Answer Model with the Session
Description Protocol (SDP)\", J. Rosenberg and H. Schulzrinne.
[16] IETF RFC 3550 (2003): \"RTP: A Transport Protocol for Real-Time
Applications\", H. Schulzrinne, S. Casner, R. Frederick and V. Jacobson.
[17] IETF RFC 3551 (2003): \"RTP Profile for Audio and Video Conferences with
Minimal Control\", H. Schulzrinne and S. Casner.
[18] void
[19] IETF RFC 4566 (2006): \"SDP: Session Description Protocol\", M. Handley,
V. Jacobson and C. Perkins.
[20] IETF RFC 4733 (2006): \"RTP Payload for DTMF Digits, Telephony Tones, and
Telephony Signals\", H. Schulzrinne and T. Taylor.
[21] IETF RFC 4867 (2007): \"RTP Payload Format and File Storage Format for
the Adaptive Multi-Rate (AMR) and Adaptive Multi-Rate Wideband (AMR-WB) Audio
Codecs\", J. Sjoberg, M. Westerlund, A. Lakaniemi and Q. Xie.
[22] IETF RFC 5993 (2010) \"RTP Payload Format for Global System for Mobile
Communications Half Rate (GSM-HR)\".
[23] 3GPP TS 46.010: \"Full rate speech; Transcoding\".
[24] 3GPP TS 46.020: \"Half rate speech; Half rate speech transcoding\".
[25] 3GPP TS 46.041: \"Half rate speech; Discontinuous Transmission (DTX) for
half rate speech traffic channels\".
> [26] 3GPP TS 48.060: \"In-band control of remote transcoders and rate
> adaptors for full rate traffic channels\".
>
> [27] 3GPP TS 48.061: \"In band control of remote transcoders and rate
> adaptors for half rate traffic channels\".
>
> [28] 3GPP TS 46.012: \"Full rate speech; Comfort noise aspect for full rate
> speech traffic channels\".
>
> [29] 3GPP TS 46.022: \"Half rate speech; Comfort noise aspects for half rate
> speech traffic channels\".
>
> [30] 3GPP TS 46.062: \"Comfort noise aspects for Enhanced Full Rate (EFR)
> speech traffic channels\".
>
> [31] 3GPP TS 26.093: \"Adaptive Multi-Rate (AMR) speech codec; Source
> controlled rate operation\".
>
> [32] 3GPP TS 26.193: \"Adaptive Multi-Rate - Wideband (AMR-WB) speech codec;
> Source controlled rate operation\".
>
> [33] 3GPP TS 48.008: \"Mobile Switching Centre - Base Station System (MSC-
> BSS) interface\".
>
> [34] 3GPP TS 48.103: \"Base Station System -- Media GateWay (BSS-MGW)
> interface; User Plane transport mechanism\".
>
> [35] 3GPP TS 45.009: \"Radio Access Network; Link adaptation\"
[36] 3GPP TS 46.060: \"EFR Speech Codec; Speech Transcoding Functions\"
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document the following terms and definitions
apply:
**AMR Generic Frame Interface:** this interface transports the AMR IF1 generic
frame as defined in 3GPP TS 26.101
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
AAL2 ATM Adaptation Layer 2
ACS Active Codec Set
AMR Adaptive Multi-Rate
AoIP A-Interface user plane transport over RTP/UDP/IP
AS Access Stratum
ATM Asynchronous Transfer Mode
BFH Bad Frame Handling
CDMA Code Division Multiple Access
CMI Codec Mode Indication
CMR/CMC Codec Mode Request or Codec Mode Command
CN Core Network
DRC Downlink Rate Command
FDD Frequency Duplex Division
FQC Frame Quality Classification (Iu Interface)
FQI Frame Quality Indication (AMR IF1)
GSM Global System for Mobile communications
ITU-T International Telecommunication Union -- Telecommunication
standardisation sector
MGW Media GateWay
NboIP Nb-Interface user plane transport over RTP/UDP/IP when SIP-I is used on
Nc
PCM Pulse Code Modulation, synonym for 64 kBit/s coded speech (see ITU-T G.711
[9])
PDC Personal Digital Communication
PLMN Public Land Mobile Network
QoS Quality of Service
RAB Radio Access Bearer
RAN Radio Access Network
RF Radio Frequency
RFC RAB sub-flow Combination
RFCI RFC Indicator
RFCS RFC Set
RX Receive
SCR Source Controlled Rate
SDU Source Data Unit
SID Silence Insertion Descriptor
SMpSDU Support Mode for Predefined SDU sizes
SPD SPeech Decoder
SPE SPeech Encoder
TC Transcoder
TDD Time Duplex Division
TDMA Time Division Multiple Access
TFO Tandem Free Operation
TrFO Transcoder Free Operation
TX Transmit
UE User Equipment (terminal)
URC Uplink Rate Command
# 4 General
The Iu-Interface is defined in two different variants for speech telephony,\
a) for the ATM bearer with Iu-framing and\ b) for the IP bearer with Iu-
framing.
The Nb-Interface is defined in three different variants for speech telephony,\
a) for the ATM bearer with Nb-framing in a BICC-based Core Network,\ b) for
the IP bearer with Nb-framing in a BICC-based Core Network and\ c) for the IP
bearer with RTP packetization in a SIP-I -based Core Network, also called
NboIP.
The mapping of the AMR Speech Codec parameters to the Iu interface specifies
the frame structure of the speech data exchanged between the RNC and the TC
inside the MGW in case of normal operation. This mapping is independent from
the radio interface in the sense that it has the same structure for both FDD
and TDD modes of the UTRAN.
The mapping between the Speech Codec and the Radio Access Network within the
UE is not an open interface and need not to be detailed.
The mapping on the Nb Interface in a BICC based Core Network is identical to
the one on the Iu Interface in case of Transcoder Free Operation, with the MGW
relaying the SDUs unaltered between Iu and Nb Interfaces.
PCM coded speech is mapped onto the Nb-Interface in packets of 40 octets (5ms
packetization time) or 160 octets (20ms packetization time). With Nb-framing
(i.e. in a BICC-based Circuit Switched Core Network, IP or ATM) the default
packetization time for PCM-coded speech is 5ms; 20ms is an additional option.
For NboIP (i.e. RTP packetization in a SIP-I -based Circuit Switched Core
Network) the default packetization time for PCM-coded speech is 20ms; 5ms is
an additional option.
The packetization time of PCM-coded speech for AoIP is 20ms without any other
option.
For the 3GPP Codec Types (GSM_FR, GSM_HR, GSM_EFR, AMR and AMR-WB) the framing
is always 20ms and also the packetization time is 20ms in all versions of the
Nb-Interface and the A-Interface over IP. The mapping of GSM_FR, GSM_HR and
GSM_EFR Speech Codec parameters is defined on the A Interface over IP and all
versions of the Nb-Interface, but not on the Iu Interface.
# 5 RAB aspects
During the RAB Assignment procedure initiated by the CN to establish the RAB
for AMR, the RAB parameters are defined. The AMR RAB is established with one
or more RAB co-ordinated sub-flows with predefined sizes and QoS parameters.
In this way, each RAB sub-flow Combination corresponds to one AMR frame type.
For AMR, the first RAB sub-flow (sub-flow 1) corresponds with the Class A
bits. In case there are three RAB sub-flows, the third RAB sub-flow (sub-flow
3) corresponds with the Class C bits. On the Iu interface, these RAB
parameters define the corresponding parameters regarding the transport of AMR
frames.
Some of the QoS parameters in the RAB assignment procedure are determined from
the Bearer Capability Information Element used at call set up. These QoS
parameters as defined in [3], can be set as follows:
Table 5-1: Example of mapping of BC IE into QoS parameters for UMTS AMR
+----------+----------+----------+----------+----------+----------+---+ | RAB | RAB | Comments | | | | | | service | service | | | | | | | a | a | | | | | | | ttribute | ttribute | | | | | | | | value | | | | | | +----------+----------+----------+----------+----------+----------+---+ | Traffic | Conver | | | | | | | Class | sational | | | | | | +----------+----------+----------+----------+----------+----------+---+ | RAB | Sy | S | | | | | | A | mmetric, | ymmetric | | | | | | symmetry | bidir | RABs are | | | | | | I | ectional | used for | | | | | | ndicator | | uplink | | | | | | | | and | | | | | | | | downlink | | | | | +----------+----------+----------+----------+----------+----------+---+ | Maximum | 12.2 / | This | | | | | | bit rate | 10.2 / | value | | | | | | | 7.95 / | depends | | | | | | | 7.4 / | on the | | | | | | | 6.7 / | highest | | | | | | | 5.9 / | mode | | | | | | | 5.15 / | rate in | | | | | | | 4.75 | the RFCS | | | | | | | kbit/s | | | | | | +----------+----------+----------+----------+----------+----------+---+ | Gu | 12.2 / | One of | | | | | | aranteed | 10.2 / | the | | | | | | bit rate | 7.95 / | values | | | | | | | 7.4 / | is | | | | | | | 6.7 / | chosen, | | | | | | | 5.9 / | d | | | | | | | 5.15 / | epending | | | | | | | 4.75 | on the | | | | | | | kbit/s | lowest | | | | | | | | rate | | | | | | | | cont | | | | | | | | rollable | | | | | | | | SDU | | | | | | | | format | | | | | | | | (note 2) | | | | | +----------+----------+----------+----------+----------+----------+---+ | Delivery | Yes | (note 1) | | | | | | Order | | | | | | | +----------+----------+----------+----------+----------+----------+---+ | Maximum | 244 / | Maximum | | | | | | SDU size | 204 / | size of | | | | | | | 159 / | payload | | | | | | | 148 / | field in | | | | | | | 134 / | Iu UP, | | | | | | | 118 / | a | | | | | | | 103 / 95 | ccording | | | | | | | | to the | | | | | | | bits | highest | | | | | | | | mode | | | | | | | | rate in | | | | | | | | the RFCS | | | | | +----------+----------+----------+----------+----------+----------+---+ | Traffic | Not | P | | | | | | Handling | ap | arameter | | | | | | Priority | plicable | not | | | | | | | | ap | | | | | | | | plicable | | | | | | | | for the | | | | | | | | conver | | | | | | | | sational | | | | | | | | traffic | | | | | | | | class. | | | | | | | | (note 1) | | | | | +----------+----------+----------+----------+----------+----------+---+ | Source | Speech | (note 1) | | | | | | st | | | | | | | | atistics | | | | | | | | de | | | | | | | | scriptor | | | | | | | +----------+----------+----------+----------+----------+----------+---+ | SDU | RAB | RAB | RAB | The | | | | Pa | sub-flow | sub-flow | sub-flow | number | | | | rameters | 1 | 2 (Class | 3 (Class | of SDU, | | | | | (Class A | B bits) | C bits) | their | | | | | bits) | | | number | | | | | | | | of RAB | | | | | | | | sub-flow | | | | | | | | and | | | | | | | | their | | | | | | | | relative | | | | | | | | sub-flow | | | | | | | | size is | | | | | | | | subject | | | | | | | | to | | | | | | | | operator | | | | | | | | tuning | | | | | | | | (note 3) | | | +----------+----------+----------+----------+----------+----------+---+ | | SDU | 7 * | - | - | (note 3) | | | | error | 10^-3^ | | | | | | | ratio | | | | | | +----------+----------+----------+----------+----------+----------+---+ | | Residual | 10^-6^ | 10^-3^ | 5 * | (note 3 | | | | bit | | | 10^-3^ | -- | | | | error | | | | ap | | | | ratio | | | | plicable | | | | | | | | for | | | | | | | | every | | | | | | | | s | | | | | | | | ub-flow) | | +----------+----------+----------+----------+----------+----------+---+ | | Delivery | yes | - | - | Class A | | | | of | | | | bits are | | | | e | | | | d | | | | rroneous | | | | elivered | | | | SDUs | | | | with | | | | | | | | error | | | | | | | | indi | | | | | | | | cation;\ | | | | | | | | Class B | | | | | | | | and C | | | | | | | | bits are | | | | | | | | d | | | | | | | | elivered | | | | | | | | without | | | | | | | | any | | | | | | | | error | | | | | | | | ind | | | | | | | | ication. | | +----------+----------+----------+----------+----------+----------+---+ | | SDU | | | | (note 4) | | | | format | | | | | | | | inf | | | | | | | | ormation | | | | | | | | 1-9 | | | | | | +----------+----------+----------+----------+----------+----------+---+ | | | Sub-flow | (note 5) | (note 5) | (note 5) | | | | | SDU size | | | | | | | | 1-9 | | | | | +----------+----------+----------+----------+----------+----------+---+ | NOTE 1: | | | | | | | | These | | | | | | | | pa | | | | | | | | rameters | | | | | | | | apply to | | | | | | | | all UMTS | | | | | | | | speech | | | | | | | | codec | | | | | | | | types. | | | | | | | | | | | | | | | | NOTE 2: | | | | | | | | The | | | | | | | | gu | | | | | | | | aranteed | | | | | | | | bit rate | | | | | | | | depends | | | | | | | | on the | | | | | | | | per | | | | | | | | iodicity | | | | | | | | and the | | | | | | | | lowest | | | | | | | | rate | | | | | | | | cont | | | | | | | | rollable | | | | | | | | SDU | | | | | | | | size. | | | | | | | | | | | | | | | | NOTE 3: | | | | | | | | These | | | | | | | | pa | | | | | | | | rameters | | | | | | | | are | | | | | | | | subject | | | | | | | | to | | | | | | | | operator | | | | | | | | tuning. | | | | | | | | | | | | | | | | NOTE 4: | | | | | | | | SDU | | | | | | | | format | | | | | | | | inf | | | | | | | | ormation | | | | | | | | has to | | | | | | | | be | | | | | | | | s | | | | | | | | pecified | | | | | | | | for each | | | | | | | | AMR core | | | | | | | | frame | | | | | | | | type | | | | | | | | (i.e. | | | | | | | | with | | | | | | | | speech | | | | | | | | bits and | | | | | | | | comfort | | | | | | | | noise | | | | | | | | bits) | | | | | | | | included | | | | | | | | in the | | | | | | | | RFCS as | | | | | | | | defined | | | | | | | | in | | | | | | | | [2]. | | | | | | | | | | | | | | | | NOTE 5: | | | | | | | | The | | | | | | | | sub-flow | | | | | | | | SDU size | | | | | | | | corre | | | | | | | | sponding | | | | | | | | to an | | | | | | | | AMR core | | | | | | | | frame | | | | | | | | type | | | | | | | | i | | | | | | | | ndicates | | | | | | | | the | | | | | | | | number | | | | | | | | of bits | | | | | | | | in the | | | | | | | | class A, | | | | | | | | class B | | | | | | | | and | | | | | | | | class C | | | | | | | | fields. | | | | | | | | The | | | | | | | | assigned | | | | | | | | SDU | | | | | | | | sizes | | | | | | | | shall be | | | | | | | | set so | | | | | | | | that the | | | | | | | | SCR | | | | | | | | o | | | | | | | | peration | | | | | | | | is | | | | | | | | always | | | | | | | | p | | | | | | | | ossible. | | | | | | | +----------+----------+----------+----------+----------+----------+---+
The RAB parameters shall be set so that the SCR operation is always possible.
The conversational traffic class shall be used for the speech service, which
is identified by the ITC parameter of the bearer capability information
element in the SETUP message. This shall apply for all UMTS speech codec
types.\ The parameters traffic class, transfer delay, traffic handling
priority and source statistics descriptor shall be the same for all speech
codec types applicable for UMTS.
# 6 Iu Interface User Plane (RAN)
The data structure exchanged on the Iu interface are symmetrical, i.e. the
structure of the uplink data frames is identical to that of the downlink data
frames.
## 6.1 Frame structure on the Iu UP transport protocol
### 6.1.1 Initialisation
At the initialisation of the SMpSDU mode of operation, several parameters are
set by the CN. The initialisation procedure is described in [1].
\- RFCS:
In the case of AMR, the RFCS corresponds to the Active Codec Set (ACS) plus
potentially SCR authorised in the communication. Annex A of [1] gives an
illustration of the usage of RFCI for AMR speech RAB. RFCS used in downlink
may differ from that in uplink.
\- Delivery of erroneous SDUs:
This parameter shall be set to YES. Erroneous speech frames may be used to
assist the error concealment procedures. Therefore, according to [1], PDU type
0 (containing a payload CRC) shall be used for transport of AMR data.
### 6.1.2 Time Alignment Procedure
The TC should adjust the timing of the speech data transmission in downlink
direction according to the time alignment frames sent by the RNC.
Time alignment procedure shall be dismissed in case of TFO and TrFO.
## 6.2 Mapping of the bits
The mapping of the bits between the generic AMR frames and the PDU is the same
for both uplink and downlink frames.
The following table gives the correspondence of the bit fields between the
generic AMR frames at the TC interface and the PDU exchanged with the Iu
transport layer.
Table 6-1: Mapping of generic AMR frames onto Iu PDUs
+---------------------------+---------------------------+-----------+ | **PDU field** | Corresponding field | Comment | | | within the\ | | | | generic AMR frame | | +---------------------------+---------------------------+-----------+ | **PDU Type** | N/A | Type 0 | +---------------------------+---------------------------+-----------+ | **Frame Number** | N/A | | +---------------------------+---------------------------+-----------+ | **FQC** | Frame Quality Indicator | | +---------------------------+---------------------------+-----------+ | **RFCI** | Frame Type | | +---------------------------+---------------------------+-----------+ | **Payload CRC** | N/A | | +---------------------------+---------------------------+-----------+ | **Header CRC** | N/A | | +---------------------------+---------------------------+-----------+ | | | | +---------------------------+---------------------------+-----------+ | **Payload Fields (N | Class A or SID payload | | | Sub-flows)** | | | | | Class B | | | | | | | | Class C | | +---------------------------+---------------------------+-----------+ | **SDU #1** | Most important speech | Mandatory | | | bits come first | | +---------------------------+---------------------------+-----------+ | **SDU #2** | Next bits follow | Optional | +---------------------------+---------------------------+-----------+ | | | | +---------------------------+---------------------------+-----------+ | **...** | ... | Optional | +---------------------------+---------------------------+-----------+ | **SDU #N** | Least important speech | Optional | | | bits | | +---------------------------+---------------------------+-----------+
The number of RAB sub-flows, their corresponding sizes, and their attributes
such as \"Delivery of erroneous SDUs\" shall be defined at the RAB
establishment and signalled in the RANAP RAB establishment request, as
proposed in clause 5. The number of RAB sub-flows is corresponding to the
desired bit protection classes. The total number of bits in all sub-flows for
one RFC shall correspond to the total number given in 3GPP TS 26.101, generic
AMR frame, format IF1, for the corresponding Codec Mode, respectively Frame
Type.
Guidance for setting the number of bits in each RAB sub-flow according to
their relative subjective importance is given in 3GPP TS 26.101.
The following two tables are examples of mapping of RAB sub-flows.
Table 6-2 gives three examples of sub-flow mapping.\ The RFCI definition is
given in order of increasing SDU sizes.
\- Example 1 describes Codec Type UMTS_AMR, with all eight codec modes
foreseen in the Active Codec Set (ACS) and provision for Source Controlled
Rate operation (SCR). In this example, Blind Transport Format Detection is
supported and the sub-flow mapping follows the 26.101 class division guidance.
\- Example 2 describes Codec Type GSM_EFR, with one codec mode, including SCR.
\- Example 3 describes Codec Type FR_AMR, including AMR SCR
Table 6-2: Example for AMR with SCR and three sub-flows, according to
subjective class division indication of 3GPP TS 26.101
+-------+-------+-------+-------+-------+-------+-----+-------+ | UMTS | GSM | FR | RAB | Total | S | | | | _AMR | _EFR | _AMR | sub- | size | ource | | | | | | | flows | of | rate | | | | | | | | | | | | | | | | | bit | | | | | | | | | s/RAB | | | | | | | | | sub- | | | | | | | | | flows | | | | | | | | | c | | | | | | | | | ombin | | | | | | | | | ation | | | | | | | | | | | | | | | | | | ( | | | | | | | | | Manda | | | | | | | | | tory) | | | | +-------+-------+-------+-------+-------+-------+-----+-------+ | RFCI\ | RFCI\ | RFCI\ | RAB | RAB | RAB | | | | Ex | Ex | Ex | sub- | sub- | sub- | | | | ample | ample | ample | | | | | | | 1 | 2 | 3 | flow | flow | flow | | | | | | | 1 | 2 | 3 | | | | | | | | | | | | | | | | (Opti | (Opti | (Opti | | | | | | | onal) | onal) | onal) | | | +-------+-------+-------+-------+-------+-------+-----+-------+ | **2** | | **2** | * | * | **0** | 95 | AMR | | | | | _42_ _|_ 53**| | | 4,75 | | | | | | | | | kbps | +-------+-------+-------+-------+-------+-------+-----+-------+ |** 3**| | | * | * |** 0**| 103 | AMR | | | | | *49** | _54_ _| | | 5,15 | | | | | | | | | kbps | +-------+-------+-------+-------+-------+-------+-----+-------+ |__4_ _| |__3_ _| * | * |__0_ _| 118 | AMR | | | | |_ 55**| *63** | | | 5,9 | | | | | | | | | kbps | +-------+-------+-------+-------+-------+-------+-----+-------+ | **5** | | **4** | * | * | **0** | 134 | AMR | | | | | _58_ _|_ 76**| | | 6,7 | | | | | | | | | kbps | +-------+-------+-------+-------+-------+-------+-----+-------+ |** 6**| | | * | * |** 0**| 148 | AMR | | | | | *61** | _87_ _| | | 7,4 | | | | | | | | | kbps | +-------+-------+-------+-------+-------+-------+-----+-------+ |__7_ _| | | * | * |__0_ _| 159 | AMR | | | | |_ 75**| *84** | | | 7,95 | | | | | | | | | kbps | +-------+-------+-------+-------+-------+-------+-----+-------+ | **8** | | **5** | * | * | * | 204 | AMR | | | | | _65_ _|_ 99**| *40** | | 10,2 | | | | | | | | | kbps | +-------+-------+-------+-------+-------+-------+-----+-------+ | **9** | **2** | | * | ** | * | 244 | AMR | | | | | _81_ _| 103_ _|_ 60**| | 12,2 | | | | | | | | | kbps | +-------+-------+-------+-------+-------+-------+-----+-------+ |** 1**| |** 1**| * |** 0**|** 0**| 39 | AMR | | | | | *39** | | | | SID | +-------+-------+-------+-------+-------+-------+-----+-------+ | | **1** | | * | **0** | **0** | 43 | GS | | | | | _43_ * | | | | M-EFR | | | | | | | | | SID | +-------+-------+-------+-------+-------+-------+-----+-------+
Table 6-3 gives one example of sub-flow mapping that supports Equal Error
Protection.\ The RFCI definition is given in order of increasing SDU sizes.
\- Example 4 describes Codec Type PDC_EFR and the corresponding Source
Controlled Rate operation (SCR).
Table 6-3: Example of SDU sizes for PDC_EFR with SCR and Equal Error
Protection
+-----------+--------------+--------------------------------+--------------+ | PDC_EFR | RAB sub-flow | Total size of | Source rate | | | | | | | | | bits/RAB sub-flows combination | | | | | | | | | | (Mandatory) | | +-----------+--------------+--------------------------------+--------------+ | RFCI\ | RAB sub- | | | | Example 4 | | | | | | Flow 1 | | | | | | | | | | (Mandatory) | | | +-----------+--------------+--------------------------------+--------------+ | | **95** | 95 | AMR 4,75kbps | +-----------+--------------+--------------------------------+--------------+ | | **103** | 103 | AMR 5,15kbps | +-----------+--------------+--------------------------------+--------------+ | | **118** | 118 | AMR 5,9kbps | +-----------+--------------+--------------------------------+--------------+ | **2** | **134** | 134 | AMR 6,7kbps | +-----------+--------------+--------------------------------+--------------+ | | **148** | 148 | AMR 7,4kbps | +-----------+--------------+--------------------------------+--------------+ | | **159** | 159 | AMR 7,95kbps | +-----------+--------------+--------------------------------+--------------+ | | **204** | 204 | AMR 10,2kbps | +-----------+--------------+--------------------------------+--------------+ | | **244** | 244 | AMR 12,2kbps | +-----------+--------------+--------------------------------+--------------+ | | **39** | 39 | AMR SID | +-----------+--------------+--------------------------------+--------------+ | | **43** | 43 | GSM-EFR SID | +-----------+--------------+--------------------------------+--------------+ | | **38** | 38 | TDMA-EFR SID | +-----------+--------------+--------------------------------+--------------+ | **1** | **37** | 37 | PDC-EFR SID | +-----------+--------------+--------------------------------+--------------+
## 6.3 Frame handlers
Iu PDU Frame handling functions are described in 3GPP TS 25.415 [1]. This
sections describe the mandatory frame handling functions at the AMR Generic
frame interface.
### 6.3.1 Handling of frames from TC to Iu interface (downlink)
The frames from the TC in generic AMR frame format IF1 are mapped onto the Iu
PDU as follows.
#### 6.3.1.1 Frame Quality Indicator
The Frame Quality Indicator (FQI) from the TC is directly mapped to the Frame
Quality Classification (FQC) of the Iu frame according to Table 6-4.
Table 6-4: FQI AMR to FQC Iu PDU mapping
* * *
FQI AMR FQI value\ FQC PDU FQC value\ (1 bit) (2 bit)
GOOD 1 GOOD 00
BAD 0 BAD 01
* * *
#### 6.3.1.2 Frame Type
The received Frame Type Index l is mapped onto the RFCI j thanks to the
assigned RFCS table: the correspondence between Codec Mode, Frame Type Index l
and RFCI j is defined at RAB assignment.
#### 6.3.1.3 Codec Mode Indication
The Codec Mode Indication is not used.
#### 6.3.1.4 Codec Mode Request
Codec Mode Request (CMR) in downlink direction is forwarded to the rate
control procedure when it changes, or when it is commanded so by the TC in
case of TFO, see 3G TS 28.062.
#### 6.3.1.5 Optional internal 8 bits CRC
The internal AMR Codec CRC is not used on the Iu interface.
#### 6.3.1.6 Mapping of Speech or Comfort Noise parameter bits
Let us define the N payload fields of the N sub-flows for RFCI j as follows:
U~i~(k) shall be the bits in sub-flow i, for k =1 to Mi
M~i~ shall be the size of sub-flow i, for i = 1 to N
d(k) shall be the bits of the speech or comfort noise parameters of the
corresponding Frame Type l in decreasing subjective importance, as defined in
the generic AMR frame format IF1, see TS 26.101 [2].
Then the following mapping in pseudo code applies:
U~1~(k) = d(k-1) with k = 1, ... M~1~
U~2~(k) = d(k -1+ M~1~) with k = 1, ... M~2~
U~3~(k) = d(k-1 + M~2~) with k = 1, ... M~3~
...
U~N~(k) = d(k-1 + M~N-1~) with k = 1 ... M~N~
### 6.3.2 Handling of frames from Iu interface to TC (uplink)
The uplink Iu frames are mapped onto generic AMR frames, format IF1, as
follows.
#### 6.3.2.1 Frame Quality Indicator
At reception of Iu PDU the Iu frame handler function set the Frame Quality
Classification according to the received FQC, Header-CRC check, and Payload-
CRC check (see 25.415). AMR Frame Type and Frame Quality Indicator are
determined according to the following table:
Table 6-5: FQC Iu PDU type 0 to AMR FQI and AMR Frame Type mapping
* * *
FQC FQC value\ Resulting\ FQI value\ resulting\ (2 bits) FQI (1 bit) Frame
Type
GOOD 00 GOOD 1 from RFCI
BAD 01 BAD 0 NO_DATA
BAD Radio 10 BAD 0 from RFCI
Reserved 11 BAD 0 Reserved
* * *
#### 6.3.2.2 Frame Type
The received RFCI j is mapped onto the Frame Type Index l thanks to the RFCS
table.
#### 6.3.2.3 Codec Mode Indication
The Codec Mode Indication is not used.
#### 6.3.2.4 Codec Mode Request
The received Downlink Rate Control command (DRC) is mapped onto the Codec Mode
Request (CMR) towards the AMR Codec. In case a new DRC is received it is
mapped into the corresponding CMR of the generic AMR frame format. It is
remembered by the TC until the next DRC is received. In each new frame that is
sent to the AMR Codec, the stored CMR is resent, in order to control the Codec
Mode for the downlink direction.
#### 6.3.2.5 Optional internal 8 bits CRC
The internal AMR Codec CRC is not used on the Iu interface.
#### 6.3.2.6 Speech and Comfort noise parameter bits
The speech and Comfort noise parameter bits are mapped from the sub-flows to
the payload of the generic AMR frames with the reverse function of clause
6.3.1.6.
# 7 Uu Interface User Plane (UE)
The interface between the UE AMR speech codec (see 3GPP TS 26.101) and the
Radio Access Network is an internal UE interface and is not detailed. The
mapping is corresponding to the mapping described in clause 6 for the Iu
interface.
Even though the details of Uu interface are not detailed, there are some
functional requirements for the UE that need to be considered, when an AMR
codec type (i.e. UMTS AMR2) is being used in a conversational speech call.
These requirements are related to the mapping of AMR Generic frame format
handling functions. The requirements are
  1. The set of available codec modes (bitrates) that the UE may use are configured by UTRAN. The UE shall select, from the configured set of codec modes, a mode that is supported by the current TX power conditions as defined in 3GPP TS25.133. The highest available mode should be used for best speech quality.
  2. The lowest configured codec mode is always to be considered supported.
  3. When the codec mode is being adapted during a call, the used mode should be changed in a step-by-step fashion within the configured set of codec modes, i.e. by stepping one mode up or down within the configured set. This avoids disruptions on AMR decoding in GSM side, if TFO or TrFO operation is ongoing.
# 8 Nb Interface User Plane (CN) of a BICC-based Circuit Switched Core Network
The data structures exchanged on the Nb interface are symmetrical, i.e. the
structures of the sent and received data frames are identical.
The Nb-Interface is defined in a BICC-based Core Network in two different
variants, a) for the ATM bearer with Nb-framing, b) for the IP bearer with Nb-
framing. The Nb-framing and the use of PDU Type 0 for the speech payload and
PDU Type 14 [7] for AMR Rate Control is common for both versions of the Nb-
Interface here. These two versions also share the principle of \"Nb_Init\",
where the Nb-Interface is initialized on User Plane level and where the
Initial Codec Mode for AMR and/or AMR-WB is signalled.
## 8.1 Frame structure on the Nb UP transport protocol
Delivery of erroneous SDUs for AMR- and AMR-WB-coded speech, as well as for
GSM_FR-, GSM_HR-, GSM_EFR-coded speech and for PCM-coded speech on the Nb-
Interface shall be set to: \"YES\" in a BICC-based Circuit Switched Core
Network. Erroneous speech frames may be used to assist the error concealment
procedures. Therefore, according to [1] and [7], PDU Type 0 (with payload CRC)
shall be used for the transport of AMR, AMR-WB, GSM_FR, GSM_HR and GSM_EFR
coded speech on the Nb interface.\ PDU Type 0 (with payload CRC) shall be used
for the transport of PCM coded speech on the Nb interface, too.
### 8.1.1 Initialisation
The initialisation procedure is used for support mode. At the initialisation
several parameters are set by the CN. The initialisation procedure for the Nb
Interface is described in [7].
### 8.1.2 Time Alignment Procedure
The handling of Time Alignment on the Nb Interface is described in [7].
The Time alignment procedure shall be dismissed in case of TFO and TrFO.
### 8.1.3 SID Frame Generation
All 3GPP Codec Types include a standardized Discontinuous Transmission (DTX)
with Voice Activity Detection, Silence Description (by SID frames) and Comfort
Noise Generation to fill the speech pauses. If speech inactivity is detected
by the Encoder, then (speech) frames are not transmitted, but the transmission
is suspended in order to save battery life time in the mobile station, reduce
interference on the radio interface and reduce load on all links. The
receiving Decoder fills these transmission pauses with Comfort Noise to
minimize the contrast between pauses and active speech. Silence Descriptor
(SID) frames need to be send during speech inactivity to keep the Comfort
Noise decently well aligned with the background noise at sender side. This is
especially important at the onset of the next talkspurt and therefore SID
frames should not be too old, when speech starts again.
The generation of SID frames for the AMR and AMR-WB families of Codecs is
determined by the Speech Encoder as specified in TS 26.093 [31], respectively
TS 26.193 [32]. The radio subsystem does not influence this timing! SID frames
come during speech pauses in uplink and downlink about every 160ms. Also an
AMR Encoder in the Media Gateway generates and sends SID frames about every
160ms.
The generation of SID frames for GSM_FR, GSM_HR and GSM_EFR in the GSM radio
network is determined by the GSM mobile station and the GSM radio subsystem,
not primarily by the Speech Encoder! SID frames come during speech pauses in
uplink from the mobile station about every 480ms. In downlink to the mobile
station, when they are generated by the Speech Encoder of the GSM radio
subsystem, SID frames are sent every 20ms to the GSM base station, which then
picks only one every 480ms for downlink radio transmission. For other
applications, like transport over Nb, it is more appropriate to send the SID
frames less often than every 20ms, but 480ms may be too sparse. As a
compromise it is recommended that an Encoder in the Media Gateway should
generate and send SID frames every 160ms.
## 8.2 Mapping of the bits
### 8.2.1 Mapping for AMR frames
The mapping of the bits between the generic AMR frames and the PDU for the Nb
Interface is identical to the mapping on the Iu Interface. In case of TrFO the
MGW relays the AMR frames from the Iu Interface unaltered to the Nb Interface
and vice versa, as described in [7].
### 8.2.2 Mapping for PCM Coded Speech
The mapping for the PCM coded speech in 5ms frames on the Nb Interface shall
be as defined in Table 8-1.
Table 8-1: Mapping of PCM Coded Speech in 5 ms frames onto Nb PDU, Type 0
* * *
**PDU field** Comment
PDU Type Type 0 (with Payload CRC)
Frame Number as defined in [7]
FQC set to \"good\", i.e. value 0
RFCI initialise by MGW, see [7],\ one value required
Header CRC as defined in [7]
Payload CRC as defined in [7]
Payload Field 320 bits of PCM coded speech,\ in accordance with [8].
* * *
The mapping for the PCM coded speech in 20ms frames on the Nb Interface shall
be as defined in Table 8-2.
Table 8-2: Mapping of PCM Coded Speech in 20ms frames onto Nb PDU, Type 0
* * *
**PDU field** Comment
PDU Type Type 0 (with Payload CRC)
Frame Number as defined in [7]
FQC set to \"good\", i.e. value 0
RFCI initialised by MGW, see [7],\ one value required
Header CRC as defined in [7]
Payload CRC as defined in [7]
Payload Field 4x320 bits of PCM coded speech,\ in accordance with [8].
* * *
**5ms is the default packetization time to be supported for PCM encoded speech
over Nb in a BICC based Core Network. 20ms is an additional optional
packetization time for PCM encoded speech in a BICC based Core Network over IP
Nb bearer that may be negotiated during bearer establishment as specified in
[10].**
NOTE: the use of 20ms packetization time will result in some call scenarios in
higher delays over the speech path compared to the 5ms packetization time.
This potentially higher delay should be taken into account in the overall end
to end (ear to mouth) delay budget.
### 8.2.3 Mapping for GSM_EFR frames
The mapping of the bits between the generic GSM_EFR frames and the PDUs for
the Nb Interface follows the same principles as the mapping of AMR frames. The
PDU for the GSM_EFR speech frame is identical to the PDU for AMR Mode 12.2
kbps.
The PDU for the GSM_EFR SID frame is similar to the PDU for AMR SID, with 43
instead of 39 bits in the payload field. The contents of GSM_EFR SID is the
Comfort Noise Parameter set (s(i)) as defined in [36]. The Comfort noise
parameters are computed as described in [30] by the GSM_EFR speech encoder and
are denoted as s(i) = {_s_(1),_s_(2),...,_s(38), s(87),s(88),...,s(91)_}. The
notation _s_(_i_) follows that of [36] (Table 6). The notation _d_(_j_) =
{d(1) ... d(43)} of the SID frame is local to the present document and is
formed as defined by the pseudo code below.
for _j_ = 1 to 38\ _d_(_j_) := _s_(_j_); /* LSP parameters in _s_(1) to
_s_(38) */;
> for _j_ = 39 to 43\ _d_(_j_) := _s_(_j_ +48); /* fixed codebook gain
> parameter in _s_(87)-_s_(91) */
The payload within the PDU shall be the vector _d(j)_ constructed above. The
first bit in the vector _d(j)_ shall be supplied first in the payload within
the PDU.
NOTE: The Payload field for Nb frames for GSM_EFR in a BICC-based Circuit
Switched Core Network is filled differently to the RTP payload according to
RFC3551 [17], used in AoIP and NboIP.
### 8.2.4 Mapping for GSM_FR frames
The mapping of GSM_FR-coded speech in 20ms frames on the Nb Interface shall be
as defined in Table 8.2.4.1.
Table 8.2.4.1: Mapping of GSM_FR-coded speech in 20ms frames onto Nb PDU, Type
0
+---------------+-----------------------------------------------------+ | **PDU field** | Comment | +---------------+-----------------------------------------------------+ | PDU Type | Type 0 (with Payload CRC) | +---------------+-----------------------------------------------------+ | Frame Number | as defined in [7] | +---------------+-----------------------------------------------------+ | FQC | see below | +---------------+-----------------------------------------------------+ | RFCI | initialise by MGW, see [7], two values required | | | (Speech and SID) | +---------------+-----------------------------------------------------+ | Header CRC | as defined in [7] | +---------------+-----------------------------------------------------+ | Payload CRC | as defined in [7] | +---------------+-----------------------------------------------------+ | | | +---------------+-----------------------------------------------------+ | Payload Field | 264 bits if Nb PDU contains a speech frame, see | | | below. | | | | | | 42 bits if Nb PDU contains a SID frame, see below. | +---------------+-----------------------------------------------------+
**Payload field with speech frame:\** The 260 bits of GSM_FR-coded speech
(b1...b260) are defined in TS 46.010, chapter 1.7. They and a \"signature\"
are copied into the 33 octets of the Payload field as follows. The four most
significant bits (bit 8....5) of the first octet (octet 1) of the Nb Payload
field are set to a \"signature\" of 0b1101 = 0xD. Then the four most
significant bits (b6...b3) of the first GSM_FR parameter (LAR 1) are copied
into the next bits (bit 4...1) of the first octet. The two least significant
bits of the first GSM_FR parameter (LAR 1) are copied into the next octet
(octet 2) into the 2 MSBs (bit 8...7), and so on. Each GSM_FR parameter is
copied bit by bit with its most significant bit first. The least significant
bit of the last GSM_FR parameter (b258 of RPE-pulse no.13) is placed in the
LSB (bit 1) of octet 33.
**Payload field with SID frame:\** The GSM_FR SID frames are defined in
chapter 5.2 of [28] and in chapter 1.7 of [23] and are denoted as\ b(i) =
{b(1),b(2),...,b _(36), b(48),b(49),_..._,b(53)_}. Each GSM_FR SID parameter
is copied bit by bit with its most significant bit first. The notation
_d_(_j_) = {d(1) ... d(42)} of the SID frame is local to the present document
and is formed by the pseudo code below.
for _j_ = 1 to 36\ _d_(_j_) := _b_(_j_); /* averaged log area coefficients in
_b_(1) to _b_(36) */;
for _j_ = 37 to 42\ _d_(_j_) := _b_(_j_ +11); /* averaged block amplitude
values in _b_(48)-_b_(53) */
The payload within the PDU shall be the vector _d(j)_ constructed above. The
first bit in the vector _d(j)_ shall be supplied first in the payload within
the PDU.
NOTE: The Payload field for Nb frames for GSM_FR containing SID frame in a
BICC-based Circuit Switched Core Network is filled differently to the Payload
field in RTP Packets according to RFC3551 [17], used in AoIP and NboIP.
**FQC:** \ The F**QC** (see Nb UP [7]) is set by the MGW depending on the call
case:
  1. FQC is set to \"good\", i.e. value 0, if the GSM_FR-compression and coding is performed within the MGW
  2. FQC is set to \"good\", i.e. value 0, if GSM_FR-coded speech is received without frame quality indication
  3. FQC is derived from the input frame, if FQC or a similar frame quality indication is specified there.\ In case of GSM_FR-coded speech received via TFO frames (see TS 28.062 [5]) the FQC is derived from the \"Bad Frame Indication\" (BFI) of these TFO frames. Speech frames and SID frames marked with BFI set to \"good\" shall be sent with FQC set to \"good\", i.e. value 0. Speech frames and SID frames marked with BFI set to \"bad\" shall not be sent in order to save bandwidth on Nb.
### 8.2.5 Mapping for GSM_HR frames
The mapping of GSM_HR-coded speech in 20ms frames on the Nb Interface shall be
as defined in Table 8.2.5.1.
Table 8.2.5.1: Mapping of GSM_HR-coded speech in 20ms frames onto Nb PDU, Type
0
+---------------+-----------------------------------------------------+ | **PDU field** | Comment | +---------------+-----------------------------------------------------+ | PDU Type | Type 0 (with Payload CRC) | +---------------+-----------------------------------------------------+ | Frame Number | as defined in [7] | +---------------+-----------------------------------------------------+ | FQC | see below | +---------------+-----------------------------------------------------+ | RFCI | initialise by MGW, see [7], two values required | | | (Speech and SID) | +---------------+-----------------------------------------------------+ | Header CRC | as defined in [7] | +---------------+-----------------------------------------------------+ | Payload CRC | as defined in [7] | +---------------+-----------------------------------------------------+ | | | +---------------+-----------------------------------------------------+ | Payload Field | 112 bits if Nb PDU contains a Speech frame, see | | | below. | | | | | | 33 bits if Nb PDU contains a SID frame, see below. | +---------------+-----------------------------------------------------+
**Payload field with speech frame:** \ The 112 bits of GSM_HR-coded speech
(b1...b112) are defined in TS 46.020, Annex B, in the order of occurrence. The
first bit (b1) of the first parameter is placed in bit 8 (the MSB) of the
first octet (octet 1) of the Nb Payload field; the second bit is placed in bit
7 of the first octet and so on. The last bit (b112) is placed in the LSB (bit
1) of octet 14.
NOTE 1: The Payload field for Nb frames for GSM_HR with speech frame in a
BICC-based Circuit Switched Core Network is identical to the "speech data
section" of the RTP payload. It is done according to [22], used in AoIP and
NboIP.
**Payload field with SID frame:\** The GSM_HR SID frames are defined in [24]
and [29] and are denoted as b(i) = {b(1),b(2),...,b _(33)_}. The notation
_d_(_j_) = {d(1) ... d(33)} of the SID frame is local to the present document
and is formed by the pseudo code as follows.
for _j_ = 1 to 5\ _d_(_j_) := _b_(_j_); /* R0 parameter in _b_(1) to _b_(5)
*/;
for _j_ = 6 to 16\ _d_(_j_) := _b_(_j_); /* LPC1 parameter in _b_(6)-_b_(16)
*/
for _j_ = 17 to 25\ _d_(_j_) := _b_(_j_); /* LPC2 parameter in _b_(17)-_b_(25)
*/
for _j_ = 26 to 33\ _d_(_j_) := _b_(_j_); /* LPC3 parameter in _b_(26)-_b_(33)
*/
The payload within the PDU shall be the vector _d(j)_ constructed above. The
first bit in the vector _d(j)_ shall be supplied first in the payload within
the PDU.
NOTE 2: The Payload field for Nb frames for GSM_HR with SID frame in a BICC-
based Circuit Switched Core Network is not filled in the same way as the
"speech data section" of the RTP payload used in AoIP and NboIP. For both AoIP
and NboIP packing is according to [22].
**FQC:** \ The FQC (see Nb UP [7]) is set by the MGW depending on the call
case:
  1. FQC is set to \"good\", i.e. value 0, if the GSM_HR-compression and coding is performed within the MGW.
  2. FQC is set to \"good\", i.e. value 0, if GSM_HR-coded speech is received without frame quality indication.
  3. FQC is derived from the input frame, if FQC or a similar frame quality indication is specified there.\ In case of GSM_HR-coded speech received via TFO frames (see TS 28.062 [5]) the FQC is derived from the \"Extended control bits\" (XC1 to XC5) for 8kbps submultiplexing (specified in TS 48.061, chapter 5.2.4.1.1 and partly reprinted here for ease of reading) as defined in table 8.2.5.2.
Table 8.2.5.2: The FQC for GSM_HR-coded Nb frames derived from TFO frames
* * *
**FQC** **XC1** **XC2** **XC3** **XC4** **XC5** **Meaning** (in Abis frames
with 8kbps submultiplexing)
good 0 0 0 0 0 Good speech frame with UFI = 0\ (BFI=0, SID=0, TAF=1)\ (BFI=0,
SID=0, TAF=0)
bad* 0 0 0 0 1 Unreliable speech frame (if speech decoder is in speech
decoding mode)\ or unusable frame (if speech decoder is in comfort noise
insertion mode) with UFI = 1\ (BFI=0, SID=0, TAF=1)\ (BFI=0, SID=0, TAF=0)
good 0 0 0 1 0 Valid SID frame with UFI = 0\ (BFI=0, SID=2, TAF=1)\ (BFI=0,
SID=2, TAF=0)
bad 0 0 0 1 1 Invalid SID frame with UFI = 1\ (BFI=0, SID=2, TAF=1)\ (BFI=0,
SID=2, TAF=0)
bad 0 1 0 0 0 Invalid SID frame at TAF=0 with UFI = 0\ (BFI=0, SID=1, TAF=0)\
(BFI=1, SID=1, TAF=0)\ (BFI=1, SID=2, TAF=0)
bad 0 1 0 0 1 Invalid SID frame at TAF=0 with UFI = 1\ (BFI=0, SID=1, TAF=0)\
(BFI=1, SID=1, TAF=0)\ (BFI=1, SID=2, TAF=0)
bad 0 1 0 1 0 Invalid SID frame at TAF=1 with UFI = 0\ (BFI=0, SID=1, TAF=1)\
(BFI=1, SID=1, TAF=1)\ (BFI=1, SID=2, TAF=1)
bad 0 1 0 1 1 Invalid SID frame at TAF=1 with UFI = 1\ (BFI=0, SID=1, TAF=1)\
(BFI=1, SID=1, TAF=1)\ (BFI=1, SID=2, TAF=1)
bad* 0 1 1 0 0 Bad speech frame or unusable frame at TAF = 0 with UFI = 0\
(BFI=1, SID=0, TAF=0)
bad* 0 1 1 0 1 Bad speech frame or unusable frame at TAF = 0 with UFI = 1\
(BFI=1, SID=0, TAF=0)
bad* 0 1 1 1 0 Bad speech frame or unusable frame at TAF = 1 with UFI = 0\
(BFI=1, SID=0, TAF=1)
bad* 0 1 1 1 1 Bad speech frame or unusable frame at TAF = 1 with UFI = 1\
(BFI=1, SID=0, TAF=1)
* * *
Speech frames and SID frames marked in Table 8.2.5.2 with FQC set to \"good\",
i.e. value 0, shall be sent.\ Frames marked in Table 8.2.5.2 with FQC set to
\"bad*\" or \"bad\" shall not be sent in order to save bandwidth on Nb.
**NOTE 3:** the abbreviations \"UFI\" (unreliable frame indication), \"BFI\"
(bad frame indication), \"SID\" (Silence Descriptor) and \"TAF\" (Time
Alignment Flag) are defined in 3GPP TS 46.041 [25].
## 8.3 Frame handlers
Nb PDU Frame handling functions are described in [7].
# 9 Nb Interface User Plane (CN) of a SIP-I -based Circuit Switched Core
Network
## 9.1 Overview
The SIP-I -based Circuit Switched Core Network is specified in 3GPP TS 23.231
[12]. The User Plane in this Core Network is further specified in 3GPP TS
29.414 [10]. RTP is specified in IETF RFC 3550 [16].
RTP is used in a SIP-I -based Circuit Switched Core Network as framing
protocol at the Nb-Interface (without Nb-framing protocol). The rules for the
usage of RTP and RTCP in 3GPP TS 29.414 [10] are applicable in combination
with further Codec-specific rules provided in the present specification.
Table 9.1.1 lists the applicable 3GPP Codec Types for a SIP-I -based Circuit
Switched Core Network. Codecs for data transport are described in 3GPP TS
29.007 [13].
Table 9.1.1 Supported Codec Types in a SIP-I -based Circuit Switched Core
Network
+----------------+----------------+----------------+----------------+ | **Payload Type |** References**|** Remarks**|** Support**| | Name** | | | | +----------------+----------------+----------------+----------------+ | audio/AMR | IETF RFC 4867 | Applicable for | Mandatory. | | | [21] | FR_AMR, | | | | | HR_AMR, | Not all AMR | | | | OHR_AMR, | Configurations | | | | UMTS_AMR and | are mandatory. | | | | UMTS_AMR2 | Some | | | | | Configurations | | | | | are preferred, | | | | | see below. | +----------------+----------------+----------------+----------------+ | audio/AMR-WB | IETF RFC 4867 | Applicable for | Optional.\ | | | [21] | FR_AMR-WB, | AMR-WB is | | | | OHR_AMR-WB, | mandatory, if | | | | OFR_AMR-WB, | WB speech is | | | | UMTS_AMR-WB | supported. | | | | | | | | | | Not all WB | | | | | Configurations | | | | | are mandatory, | | | | | see below | +----------------+----------------+----------------+----------------+ | audio/GSM_EFR | IETF RFC 3551 | Useful if an | Optional | | | [17] | A-interface | | | | | over IP is | | | | | attached or | | | | | TFO is used. | | +----------------+----------------+----------------+----------------+ | audio/GSM_FR | IETF RFC 3551 | Useful if an | Optional | | | [17] | A-interface | | | | | over IP is | | | | | attached or | | | | | TFO is used. | | +----------------+----------------+----------------+----------------+ | audio/GSM_HR | IETF RFC 5993 | Useful if an | Optional | | | [22] | A-interface | | | | | over IP is | | | | | attached or | | | | | TFO is used. | | +----------------+----------------+----------------+----------------+ | audio/PCMA | IETF RFC 3551 | ITU-T G.711 | Mandatory | | | [17] | Alaw | | +----------------+----------------+----------------+----------------+ | audio/PCMU | IETF RFC 3551 | ITU-T G.711 | Mandatory | | | [17] | ulaw | | +----------------+----------------+----------------+----------------+ | audio/t | IETF RFC 4733 | Used to | Mandatory | | elephone-event | [20] | transport DTMF | | +----------------+----------------+----------------+----------------+
The RTP \"Payload Type\" number for the Nb-Interface is either static (for
PCMA, PCMU and GSM_FR) or determined by the MSC-S (dynamic Payload Type).
### 9.1.1 Time Alignment Procedure
Time Alignment (and AMR Phase Alignment) is not specified in a SIP-I -based
Circuit Switched Core Network.
### 9.1.2 SID Frame Generation
All 3GPP Codec Types include standardized Discontinuous Transmission (DTX)
with Voice Activity Detection, Silence Description (by SID frames) and Comfort
Noise Generation to fill the speech pauses. If speech inactivity is detected
by the Encoder, then (speech) frames are not transmitted, but the transmission
is suspended in order to save battery life time in the mobile station, reduce
interference on the radio interface and reduce load on all links. The
receiving Decoder fills these transmission pauses with Comfort Noise to
minimize the contrast between pauses and active speech. Silence Descriptor
frames need to be send during speech inactivity to keep the Comfort Noise
decently well aligned with the background noise at sender side. This is
especially important at the onset of the next talkspurt and therefore SID
frames should not be too old, when speech starts again.
The generation of SID frames for the AMR and AMR-WB families of Codecs is
determined by the Speech Encoder as specified in TS 26.093 [31], respectively
TS 26.193 [32]. The radio subsystem does not influence this timing! SID frames
come during speech pauses in uplink and downlink about every 160ms. Also an
AMR Encoder in the Media Gateway generates and sends SID frames about every
160ms.
The generation of SID frames for GSM_FR, GSM_HR and GSM_EFR in the GSM radio
network is determined by the GSM mobile station and the GSM radio subsystem,
not primarily by the Speech Encoder! SID frames come during speech pauses in
uplink from the mobile station about every 480ms. In downlink to the mobile
station, when they are generated by the Speech Encoder of the GSM radio
subsystem, SID frames are sent every 20ms to the GSM base station, which then
picks only one every 480ms for downlink radio transmission. For other
applications, like transport over Nb, it is more appropriate to send the SID
frames less often than every 20ms, but 480ms may be too sparse. As a
compromise it is recommended that an Encoder in the Media Gateway should
generate and send SID frames every 160ms.
### 9.1.3 Initial Codec Mode
NOTE: At the Nb-Interface in a SIP-I -based Core Network, direct RTP
packetization without Nb-framing is applied. Therefore the use of PDU Type 0
for the speech payload and PDU Type 14 [7] for AMR Rate Control is here not
applicable. Also the principle of \"Nb_Init\" is not applicable for a SIP-I
-based Core Network.
The Initial Codec Mode for AMR and AMR-WB shall be derived by pre-defined
rules from the AMR Configuration (Active Codec Set), see TS 45.009 [35],
chapter 3.4.3 \"Initial Codec Mode Selection at Call Setup and Handover\".
Start of extract from TS 45.009 [35] for information and ease of reading:
> \"If the Initial Codec Mode is not signalled, then the default Initial Codec
> Mode is given by the following implicit rule. If the Active Codec Set
> contains:
>
> 1 mode, then this shall be the Initial Codec Mode;
>
> 2 or 3 modes, then the Initial Codec Mode shall be the most robust mode of
> the set (with lowest bit rate);
>
> 4 modes, then the Initial Codec Mode shall be the second most robust mode of
> the set (with second lowest bit rate.\"
End of extract from TS 45.009 [35].
In case of FR_AMR (Set 1), i.e. Config-NB-Code 1, see below, this is the AMR
Mode with 5.90kbps.
## 9.2 AMR
AMR (FR_AMR, HR_AMR, OHR_AMR, UMTS_AMR and UMTS_AMR2) shall be packed
according to IETF RFC 4867 [21].
The AMR Codec Types can be used in conversational speech telephony services in
a number of different Codec Configurations. The set of preferred AMR Codec
Configurations is defined in TS 28.062 [5], Table 7.11.3.1.3-2. One of these
preferred Configurations, **Config-NB-Code 1** , is recommended for TFO-TrFO
harmonisation between GSM and UMTS networks. This Configuration shall be
supported in a SIP-I based circuit switched core network to ensure
interoperability with an AoIP-based BSS. However, it is recommended that nodes
in the core network support all AMR modes for maximum interoperability.
The bandwidth efficient mode of RFC 4867 shall be used. CRC and robust sorting
shall not be applied.
To avoid delay, a single frame (Speech or SID_FIRST or SID_UPDATE or ONSET)
shall be included in one RTP packet, Interleaving (redundancy) shall not be
used, and a packetization time of 20ms shall be applied. No_Data frames should
not be sent, except when needed for urgent Rate Control.
Nodes in the core network (e.g. MGWs) transcoding between AMR and some other
Codec shall observe the following rules:
  * An AMR [Encoder]{.underline} (sender) in the core network shall obey an AMR Codec Mode change period of 40ms, i.e. Codec Mode changes by the AMR [Encoder]{.underline} (sender) in this core network node are only permissible at every second frame. This ensures maximum interoperability with any AMR receiver.
  * An AMR [Decoder]{.underline} (receiver) shall, however, be able to accept Codec Mode changes at any time.\ Variations of the Codec Mode period in receive direction may happen due to handover or other events during a conversation. The UMTS_AMR Codec Type (only allowed in R99 UTRAN-only terminals) may change its Codec Mode any time. Other application of the AMR Codec Types (e.g. MTSI) may perform Codec Mode changes any time. This ensures maximum interoperability with any AMR sender.
  * An AMR Encoder shall only change the Codec Mode to a neighbouring mode of the defined AMR Configuration (one step up or one step down), regardless which Rate Control command it receives. If necessary the AMR Encoder shall apply several Codec Mode changes in a row, if the received Rate Control command requests a change of more than one step. This ensures maximum interoperability with any AMR receiver, especially within GSM terminals.
  * An AMR [Decoder]{.underline} (receiver) shall, however, be able to accept Codec Mode changes in any step size. Variations of the Codec Mode in receive direction may happen due to handover or other events during a conversation. Other application of the AMR Codec Types (e.g. MTSI) may perform any Codec Mode changes. This ensures maximum interoperability with any AMR sender.
  * DTX (SCR) shall be supported in send and receive direction.
AMR Rate Control shall use the CMR bits inside the RTP payload, both, in send
and receive direction. RTCP shall not be used for AMR Rate Control in a CS
core network.
Rate Control Commands coming from an Nb-Interface of a BICC-based Core
Network, or an Iu-Interface, or an IMS-Interface, or an general VoIP-
Interface, shall be converted to CMR and shall be send continuously inside RTP
packets together with the next Speech or SID_FIRST or SID_UPDATE or ONSET
frame.
NOTE: In a SIP-I -based Circuit Switched Core Network no Nb-framing is applied
and so also no \"PDU Type 14\" [7] exists for Rate Control Commands.
It is allowed to send an artificially inserted No_Data frame to transport an
urgent CMR in RTP. Please note that a GSM radio subsystem connected via AoIP
can not send No_Data frames across the radio interface and will typically
ignore such No_Data frames. The use of No_Data frames for CMR is especially
helpful inside the Core Network at call setup to control the downlink mode for
the Encoder inside the terminating MGW for the compression of the ringback
tone or an announcement, when the originating MGW still blocks the speech path
in forward direction to prevent fraud.
## 9.3 AMR-WB
AMR-WB (FR_AMR-WB, OHR_AMR-WB, OFR_AMR-WB, UMTS_AMR-WB) shall be packed
according to IETF RFC 4867 [21].
The AMR-WB Codec Types can be used in conversational speech telephony services
in a number of different Codec Configurations. The set of AMR-WB Codec
Configurations is defined in TS 26.103 [14], Table 5.7-1. One of these
Configurations, **Config-WB-Code** 0, shall be supported by all nodes
supporting the AMR-WB codec in a SIP-I based circuit switched core network to
ensure interoperability. However, it is recommended that nodes in the core
network support all AMR-WB modes for maximum interoperability.
The bandwidth efficient mode of RFC 4867 [21] shall be used. CRC and robust
sorting shall not be applied.
To avoid delay, a single frame (Speech or SID_FIRST or SID_UPDATE or ONSET)
shall be included in one RTP packet, Interleaving (redundancy) shall not be
used, and a packetization time of 20ms shall be applied. No_Data frames should
not be sent, except when needed for urgent Rate Control.
Nodes in the core network (e.g. MGWs) transcoding between AMR-WB and some
other Codec shall observe the following rules:
  * An AMR-WB [Encoder]{.underline} (sender) in the core network shall obey an AMR-WB Codec Mode change period of 40ms, i.e. Codec Mode changes by the AMR-WB [Encoder]{.underline} (sender) in this core network node are only permissible at every second frame. This ensures maximum interoperability with any AMR-WB receiver.
  * An AMR-WB [Decoder]{.underline} (receiver) shall, however, be able to accept Codec Mode changes at any time.\ Variations of the Codec Mode period in receive direction may happen due to handover or other events during a conversation. Other application of the AMR-WB Codec Types (e.g. MTSI) may perform Codec Mode changes any time. This ensures maximum interoperability with any AMR-WB sender.
  * An AMR-WB Encoder shall only change the Codec Mode to a neighbouring mode of the defined AMR-WB Configuration (one step up or one step down), regardless which Rate Control command it receives. If necessary the AMR-WB Encoder shall apply several Codec Mode changes in a row, if the received Rate Control command requests a change of more than one step. This ensures maximum interoperability with any AMR-WB receiver, especially within GSM terminals.
  * An AMR-WB [Decoder]{.underline} (receiver) shall, however, be able to accept Codec Mode changes in any step size. Variations of the Codec Mode in receive direction may happen due to handover or other events during a conversation. Other application of the AMR-WB Codec Types (e.g. MTSI) may perform any Codec Mode changes. This ensures maximum interoperability with any AMR-WB sender.
  * DTX (SCR) shall be supported in send and receive direction.
AMR-WB Rate Control shall use the CMR bits inside the RTP payload, both, in
send and receive direction. RTCP shall not be used for AMR-WB Rate Control in
a CS core network.
Rate Control Commands coming from an Nb-Interface of a BICC-based Core
Network, or an Iu-Interface, or an IMS-Interface, or an general VoIP-
Interface, shall be converted to CMR and shall be send continuously inside RTP
packets together with the next Speech or SID_FIRST or SID_UPDATE or ONSET
frame.
NOTE: In a SIP-I -based Circuit Switched Core Network no Nb-framing is applied
and so also no \"PDU Type 14\" [7] exists for Rate Control Commands.
It is allowed to send an artificially inserted No_Data frame to transport an
urgent CMR in RTP. Please note that a GSM radio subsystem connected via AoIP
can not send No_Data frames across the radio interface and will typically
ignore such No_Data frames. The use of No_Data frames for CMR is especially
helpful on the AoIP-Interface in uplink and inside the Core Network at call
setup to control the downlink mode for the Encoder inside the terminating MGW
for the compression of the ringback tone or an announcement, when the
originating MGW still blocks the speech path in forward direction to prevent
fraud.
## 9.4 GSM_EFR
GSM_EFR shall be packed according to IETF RFC 3551 [17].
The coding of SID frames is based on the coding of Speech frames by setting
the 95 bits of the so called \"SID-Codeword\" all to \"1\", see TS 46.062
[30].
To avoid delay, a single frame (Speech or SID) shall be included in one RTP
packet, Interleaving (redundancy) shall not be used, and a packetization time
of 20 ms shall be applied. No_Data frames shall not be sent.
DTX shall be supported in send and receive direction.
GSM_EFR frames received from some interface (e.g. a GSM radio interface via
TFO) with a bad frame indication set to \"bad\" shall not be forwarded on the
Nb-Interface in a SIP-I -based Circuit Switched Core Network, but silently
discarded.
NOTE: RFC 3551 [17] does not support the concept of Bad Frame Indication.
## 9.5 GSM_FR
GSM_FR shall be packed according to IETF RFC 3551 [17].
The coding of SID frames is based on the coding of Speech frames by setting
the 95 bits of the so called \"SID-Codeword\" all to \"0\", see TS 46.012
[28].
To avoid delay, a single frame (Speech or SID) shall be included in one RTP
packet, Interleaving (redundancy) shall not be used, and a packetization time
of 20ms shall be applied. No_Date frames shall not be sent.
DTX shall be supported in send and receive direction.
GSM_FR frames received from some interface (e.g. a GSM radio interface via
TFO) with a bad frame indication set to \"bad\" shall not be forwarded on the
Nb-Interface in a SIP-I based Circuit Switched Core Network, but silently
discarded.
NOTE: RFC 3551 [17] does not support the concept of Bad Frame Indication.
## 9.6 GSM_HR
GSM_HR shall be packed according to [22].
The options specified in [22] are not applied inside the Circuit Switched Core
Network, but set to pre-defined values as follows:\ A single frame (Speech or
SID) shall be included in one RTP packet, FEC and Interleaving (redundancy)
shall not be used, Encryption shall not be used, a packetization time of 20ms
shall be applied. No_Data frames shall not be sent.
DTX shall be supported in send and receive direction.
GSM_HR frames received from some interface (e.g. a GSM radio interface via
TFO) with a bad frame indication set to \"bad\" shall not be forwarded on the
Nb-Interface in a SIP-I -based Circuit Switched Core Network, but silently
discarded.
NOTE: [22] does not support the concept of Bad Frame Indication.
## 9.7 PCM
PCMU and PCMA shall be packed according to IETF RFC 3551 [17].
The PCM packetization time for a SIP-I -based Core Network is negotiated via
SDP. The mandatory, default value is 20ms; 5ms is one other, optional value;
no other packetization time shall be used. To avoid delay, a single frame of
length equal to the packetization time shall be included in one RTP packet,
Interleaving (redundancy) shall not be used.
The usage of DTX for PCM-coded speech is not recommended for NboIP.
## 9.8 Telephone-Event
Telephony-Event (DTMF) shall be encoded according to IETF RFC 4733 [20].
The audio/telephone-event payload type in IETF RFC 4733 [20] with default
events and default rate shall be used to encode DTMF, if compressed speech is
used in a SIP-I -based Core Network. Only in case of PCM-coded speech on NboIP
the Telephone-Event is optional, i.e. also inband DTMF tones may be used (see
TS 23.231 [12]).
# 10 A-Interface User Plane over IP
## 10.1 Overview
The A interface User Plane over IP (AoIP) is standardised in the 3GPP TS
48-series (mainly in TS 48.008) [33] for the Control Plane and in TS 48.103
[34] for the User Plane).
For AoIP the same Codecs as described in Clause 9 are applicable, except
telephone-event, see table 10.1.1. Those Codecs shall also be applied in the
same manner as described in Clause 9, unless otherwise specified in the
present Clause 10.
Table 10.1.1 Supported Codec Types for the A interface User Plane over IP
+----------------+----------------+----------------+----------------+ | **Payload Type |** References**|** Remarks**|** Support**| | Name** | | | | +----------------+----------------+----------------+----------------+ | audio/AMR | IETF RFC 4867 | Applicable for | Optional. | | | [21] | FR_AMR, | | | | | HR_AMR, | Not all AMR | | | | OHR_AMR | Configurations | | | | | are mandatory. | | | | | Some | | | | | Configurations | | | | | are preferred, | | | | | see chapter 9. | +----------------+----------------+----------------+----------------+ | audio/AMR-WB | IETF RFC 4867 | Applicable for | Optional.\ | | | [21] | FR_AMR-WB, | AMR-WB is | | | | OHR_AMR-WB, | mandatory, if | | | | OFR_AMR-WB | WB speech is | | | | | supported. | | | | | | | | | | Not all AMR-WB | | | | | Configurations | | | | | are mandatory, | | | | | see chapter 9 | +----------------+----------------+----------------+----------------+ | audio/GSM_EFR | IETF RFC 3551 | | Optional | | | [17] | | | +----------------+----------------+----------------+----------------+ | audio/GSM_FR | IETF RFC 3551 | | Mandatory | | | [17] | | | +----------------+----------------+----------------+----------------+ | audio/GSM_HR | IETF RFC 5993 | | Optional | | | [22] | | | +----------------+----------------+----------------+----------------+ | audio/PCMA | IETF RFC 3551 | ITU-T G.711 | Optional | | | [17] | Alaw | | +----------------+----------------+----------------+----------------+ | audio/PCMU | IETF RFC 3551 | ITU-T G.711 | Optional | | | [17] | ulaw | | +----------------+----------------+----------------+----------------+
The RTP \"Payload Type\" for AoIP is pre-determined by 3GPP TS 48.103 [34] for
all Codec Types (static payload type).
### 10.1.1 Time Alignment Procedure
Time Alignment (and AMR Phase Alignment) is not specified for AoIP.
### 10.1.2 SID Frame Generation
All 3GPP Codec Types include standardized Discontinuous Transmission (DTX)
with Voice Activity Detection, Silence Description (by SID frames) and Comfort
Noise Generation to fill the speech pauses. If speech inactivity is detected
by the Encoder, then (speech) frames are not transmitted, but the transmission
is suspended in order to save battery life time in the mobile station, reduce
interference on the radio interface and reduce load on all links. The
receiving Decoder fills these transmission pauses with Comfort Noise to
minimize the contrast between pauses and active speech. Silence Descriptor
frames need to be send during speech inactivity to keep the Comfort Noise
decently well aligned with the background noise at sender side. This is
especially important at the onset of the next talk spurt and therefore SID
frames should not be too old, when speech starts again.
The generation of SID frames for the AMR and AMR-WB families of Codecs is
determined by the Speech Encoder as specified in TS 26.093 [31], respectively
TS 26.193 [32]. The radio subsystem does not influence this timing! SID frames
come during speech pauses in uplink and downlink about every 160ms. Also an
AMR Encoder in the Media Gateway generates and sends SID frames about every
160ms.
The generation of SID frames for GSM_FR, GSM_HR and GSM_EFR in the GSM radio
network is determined by the GSM mobile station and the GSM radio subsystem,
not primarily by the Speech Encoder! SID frames come during speech pauses in
uplink from the mobile station about every 480ms. In downlink to the mobile
station, when they are generated by the Speech Encoder of the GSM radio
subsystem, SID frames are sent every 20ms to the GSM base station, which then
picks only one every 480ms for downlink radio transmission. For other
applications, like transport over the A-Interface, it is more appropriate to
send the SID frames less often than every 20ms, but 480ms may be too sparse.
As a compromise it is recommended that an Encoder in the Media Gateway should
generate and send SID frames every 160ms.
### 10.1.3 Initial Codec Mode
The Initial Codec Mode for AMR and AMR-WB shall be derived by pre-defined
rules from the AMR Configuration (Active Codec Set), see TS 45.009 [35],
chapter 3.4.3 \"Initial Codec Mode Selection at Call Setup and Handover\".
Start of extract from TS 45.009 [35] for information and ease of reading:
> \"If the Initial Codec Mode is not signalled, then the default Initial Codec
> Mode is given by the following implicit rule. If the Active Codec Set
> contains:
>
> 1 mode, then this shall be the Initial Codec Mode;
>
> 2 or 3 modes, then the Initial Codec Mode shall be the most robust mode of
> the set (with lowest bit rate);
>
> 4 modes, then the Initial Codec Mode shall be the second most robust mode of
> the set (with second lowest bit rate.\"
End of extract from TS 45.009 [35].
In case of FR_AMR (Set 1), i.e. Config-NB-Code 1, see below, this is the AMR
Mode with 5.90 kbps.
## 10.2 AMR
AMR (FR_AMR, HR_AMR, OHR_AMR) shall be packed according to IETF RFC 4867 [21].
The AMR Codec Types can be used in conversational speech telephony services in
a number of different Codec Configurations. The set of preferred AMR Codec
Configurations is defined in TS 28.062 [5], Table 7.11.3.1.3-2. One of these
preferred Configurations, **Config-NB-Code 1** , is recommended for TFO-TrFO
harmonisation between GSM and UMTS networks. This Configuration shall be
supported in an AoIP supporting BSS and an AoIP supporting Circuit Switched
Core Network to ensure interoperability. However, it is recommended that a BSS
and Circuit Switched Core Network supports all AMR modes for maximum
interoperability.
The bandwidth efficient mode of RFC 4867 [21] shall be used. CRC and robust
sorting shall not be applied.
To avoid delay, a single frame (Speech or SID_FIRST or SID_UPDATE or ONSET)
shall be included in one RTP packet, Interleaving (redundancy) shall not be
used, and a packetization time of 20ms shall be applied. No_Data frames should
not be sent downlink across AoIP, except to transport an urgent CMR in RTP.
The use of No_Data frames for CMR is especially helpful on the AoIP-Interface
in uplink and inside the Core Network at call setup to control the downlink
mode for the Encoder inside the terminating MGW for the compression of the
ringback tone or an announcement, when the originating MGW still blocks the
speech path in forward direction to prevent fraud.
Please note that a GSM radio subsystem can not send No_Data frames across the
radio interface and will typically ignore such No_Data frames in downlink
direction.
DTX (SCR) shall be supported in send and receive direction.
AMR Rate Control shall use the CMR bits inside the RTP payload, both, in send
and receive direction. RTCP shall not be used for AMR Rate Control in a CS
network.
## 10.3 AMR-WB
AMR-WB (FR_AMR-WB, OHR_AMR-WB, OFR_AMR-WB) shall be packed according to IETF
RFC 4867 [21].
The AMR-WB Codec Types can be used in conversational speech telephony services
in a number of different Codec Configurations. The set of AMR-WB Codec
Configurations is defined in TS 26.103 [14], Table 5.7-1. One of these
Configurations, **Config-WB-Code** **0,** shall be supported by all nodes
supporting the AMR-WB codec in an AoIP-supporting BSS and an AoIP-supporting
Circuit Switched Core Network to ensure interoperability. However, it is
recommended that nodes in the Core Network support all AMR-WB modes for
maximum interoperability.
The bandwidth efficient mode of RFC 4867 [21] shall be used. CRC and robust
sorting shall not be applied.
To avoid delay, a single frame (Speech or SID_FIRST or SID_UPDATE or ONSET)
shall be included in one RTP packet, Interleaving (redundancy) shall not be
used, and a packetization time of 20ms shall be applied. No_Data frames should
not be sent downlink across AoIP, except to transport an urgent CMR in RTP.
The use of No_Data frames for CMR is especially helpful on the AoIP-Interface
in uplink and inside the Core Network at call setup to control the downlink
mode for the Encoder inside the terminating MGW for the compression of the
ringback tone or an announcement, when the originating MGW still blocks the
speech path in forward direction to prevent fraud.
Please note that a GSM radio subsystem can not send No_Data frames across the
radio interface and will typically ignore such No_Data frames in downlink
direction.
DTX (SCR) shall be supported in send and receive direction.
AMR-WB Rate Control shall use the CMR bits inside the RTP payload, both, in
send and receive direction. RTCP shall not be used for AMR-WB Rate Control in
a Circuit Switched Core Network.
## 10.4 GSM_EFR
GSM_EFR shall be packed according to IETF RFC 3551 [17].
The coding of SID frames is based on the coding of Speech frames by setting
the 95 bits of the so called \"SID-Codeword\" all to \"1\", see TS 46.062
[30].
To avoid delay, a single frame (Speech or SID) shall be included in one RTP
packet, Interleaving (redundancy) shall not be used, and a packetization time
of 20 ms shall be applied. No_Data frames shall not be sent.
DTX shall be supported in send and receive direction.
NOTE: RFC 3551 [17] does not support the concept of Bad Frame Indication.
Therefore missing GSM_EFR frames in the AoIP downlink direction (e.g.
discarded by a network node due to the missing bad frame indication) need to
be properly treated within the BSS before sending downlink on the radio
interface. Details are not specified.
## 10.5 GSM_FR
GSM_FR shall be packed according to IETF RFC 3551 [17].
The coding of SID frames is based on the coding of Speech frames by setting
the 95 bits of the so called \"SID-Codeword\" all to \"0\", see TS 46.012
[28].
To avoid delay, a single frame (Speech or SID) shall be included in one RTP
packet, Interleaving (redundancy)shall not be used, and a packetization time
of 20 ms shall be applied. No_Data frames shall not be sent.
DTX shall be supported in send and receive direction.
NOTE: RFC 3551 [17] does not support the concept of Bad Frame Indication.
Therefore missing GSM_EFR frames in the AoIP downlink direction (e.g.
discarded by a network node due to the missing bad frame indication) need to
be properly treated within the BSS before sending downlink on the radio
interface. Details are not specified.
## 10.6 GSM_HR
GSM_HR shall be packed according to [22].
The options specified in [22] are not applied on AoIP, but set to pre-defined
values as follows:\ A single frame (Speech or SID) shall be included in one
RTP packet, FEC and Interleaving (redundancy) shall not be used, Encryption
shall not be used, a packetization time of 20ms shall be applied. No_Data
frames shall not be sent.
DTX shall be supported in send and receive direction.
NOTE: [22] does not support the concept of Bad Frame Indication. Therefore
missing GSM_HR frames in the AoIP downlink direction (e.g. discarded by a
network node due to the missing bad frame indication) need to be properly
treated within the BSS before sending downlink on the radio interface. Details
are not specified.
## 10.7 PCM
PCMU and PCMA shall be packed according to IETF RFC 3551 [17].
A packetization time of 20ms shall be applied for PCM on AoIP. The
packetization time is not negotiated for AoIP. To avoid delay, a single frame
of 20ms shall be included in one RTP packet, Interleaving (redundancy) shall
not be used.
The usage of DTX for PCM-coded speech is not allowed on AoIP.
#
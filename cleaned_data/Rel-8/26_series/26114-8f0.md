# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
Multimedia Telephony Service for IMS (MTSI), here also referred to as
Multimedia Telephony, is a standardized IMS telephony service in 3GPP Release
7 that builds on the IMS capabilities already provided in 3GPP Releases 5 and
6. The objective of defining a service is to specify the minimum set of
capabilities required in the IP Multimedia Subsystem to secure multi-vendor
and multi‑operator inter-operability for Multimedia Telephony and related
Supplementary Services.
The user experience of multimedia telephony is expected to be equivalent to or
better than corresponding circuit-switched telephony services. Multimedia
telephony also exploits the richer capabilities of IMS. In particular,
multiple media components can be used and dynamically added or dropped during
a session.
# 1 Scope
The present document specifies a client for the Multimedia Telephony Service
for IMS (MTSI) supporting conversational speech (including DTMF), video and
text transported over RTP with the scope to deliver a user experience
equivalent to or better than that of Circuit Switched (CS) conversational
services using the same amount of network resources. It defines media handling
(e.g. signalling, transport, jitter buffer management, packet-loss handling,
adaptation), as well as interactivity (e.g. adding or dropping media during a
call). The focus is to ensure a reliable and interoperable service with a
predictable media quality, while allowing for flexibility in the service
offerings.
The scope includes maintaining backward compatibility in order to ensure
seamless inter-working with existing services available in the CS domain, such
as CS speech and video telephony, as well as with terminals of earlier 3GPP
releases. In addition, inter-working with traditional PSTN and emerging TISPAN
network is covered.
The client may also support the IMS Messaging service. The scope therefore
also includes media handling for non-conversational media using MSRP.
The specification is written in a forward-compatible way in order to allow
additions of media components and functionality in releases after Release 7.
NOTE 1: MTSI clients can support more than conversational speech, video and
text, which is the scope of the present document. See 3GPP TS 22.173 [2] for
the definition of the Multimedia Telephony Service for IMS.
NOTE 2: 3GPP TS 26.235 [3] and 3GPP TS 26.236 [4] do not include the
specification of an MTSI client, although they include conversational
multimedia applications. Only those parts of 3GPP TS 26.235 [3] and 3GPP TS
26.236 [4] that are specifically referenced by the present document apply to
Multimedia Telephony Service for IMS.
NOTE 3: The present document was started as a conclusion from the study in
3GPP TR 26.914 [5] on optimization opportunities in Multimedia Telephony for
IMS (3GPP TR 22.973 [6]).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
> \- References are either specific (identified by date of publication,
> edition number, version number, etc.) or non‑specific.
>
> \- For a specific reference, subsequent revisions do not apply.
>
> \- For a non-specific reference, the latest version applies. In the case of
> a reference to a 3GPP document (including a GSM document), a non-specific
> reference implicitly refers to the latest version of that document _in the
> same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.173: \"IP Multimedia Core Network Subsystem (IMS) Multimedia
Telephony Service and supplementary services; Stage 1\".
[3] 3GPP TS 26.235: \"Packet switched conversational multimedia applications;
Default codecs\".
[4] 3GPP TS 26.236: \"Packet switched conversational multimedia applications;
Transport protocols\".
[5] 3GPP TR 26.914: \"Multimedia telephony over IP Multimedia Subsystem (IMS);
Optimization opportunities\".
[6] 3GPP TR 22.973: \"IMS Multimedia Telephony service; and supplementary
services\".
[7] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[8] IETF RFC 4566 (2006): \"SDP: Session Description Protocol\", M. Handley,
V. Jacobson and C. Perkins.
[9] IETF RFC 3550 (2003): \"RTP: A Transport Protocol for Real-Time
Applications\", H. Schulzrinne, S. Casner, R. Frederick and V. Jacobson.
[10] IETF RFC 3551 (2003): \"RTP Profile for Audio and Video Conferences with
Minimal Control\", H. Schulzrinne and S. Casner.
[11] 3GPP TS 26.071: \"Mandatory Speech Codec speech processing functions; AMR
Speech CODEC; General description\".
[12] 3GPP TS 26.090: \"Mandatory Speech Codec speech processing functions;
Adaptive Multi-Rate (AMR) speech codec; Transcoding functions\".
[13] 3GPP TS 26.073: \"ANSI C code for the Adaptive Multi Rate (AMR) speech
codec\".
[14] 3GPP TS 26.104: \"ANSI‑C code for the floating-point Adaptive Multi Rate
(AMR) speech codec\".
[15] 3GPP TS 26.093: \"Mandatory speech codec speech processing functions;
Adaptive Multi-Rate (AMR) speech codec; Source controlled rate operation\".
[16] 3GPP TS 26.103: \"Speech codec list for GSM and UMTS\".
[17] 3GPP TS 26.171: \"Speech codec speech processing functions; Adaptive
Multi-Rate - Wideband (AMR-WB) speech codec; General description\".
[18] 3GPP TS 26.190: \"Speech codec speech processing functions; Adaptive
Multi-Rate - Wideband (AMR-WB) speech codec; Transcoding functions\".
[19] 3GPP TS 26.173: \"ANCI-C code for the Adaptive Multi Rate - Wideband
(AMR-WB) speech codec\".
[20] 3GPP TS 26.204: \"Speech codec speech processing functions; Adaptive
Multi-Rate - Wideband (AMR-WB) speech codec; ANSI-C code\".
[21] 3GPP TS 26.193: \"Speech codec speech processing functions; Adaptive
Multi-Rate - Wideband (AMR-WB) speech codec; Source controlled rate
operation\".
[22] ITU-T Recommendation H.263 (2005): \"Video coding for low bit rate
communication\".
[23] ISO/IEC 14496-2:2004: \"Information technology - Coding of audio-visual
objects - Part 2: Visual\".
[24] ITU-T Recommendation H.264 (2005): \"Advanced video coding for generic
audiovisual services\" \| ISO/IEC 14496-10:2005: \"Information technology -
Coding of audio-visual objects - Part 10: Advanced Video Coding\".
[25] IETF RFC 6184 (2011): \"RTP Payload Format for H.264 Video\", Y.-K. Wang,
R. Even, T. Kristensen, R. Jesup.
[26] ITU-T Recommendation T.140 (1998): \"Protocol for multimedia application
text conversation\".
[27] ITU-T Recommendation T.140 (2000): \"Protocol for multimedia application
text conversation - Addendum 1\".
[28] IETF RFC 4867 (2007): \"RTP Payload Format and File Storage Format for
the Adaptive Multi-Rate (AMR) and Adaptive Multi-Rate Wideband (AMR-WB) Audio
Codecs\", J. Sjoberg, M. Westerlund, A. Lakaniemi and Q. Xie.
[29] IETF RFC 4629 (2007): \"RTP Payload Format for ITU-T Rec. H.263 Video\",
J. Ott, C. Bormann, G. Sullivan, S. Wenger and R. Even.
[30] IETF RFC 3016 (2000): \"RTP Payload Format for MPEG-4 Audio/Visual
Streams\", Y. Kikuchi, T. Nomura, S. Fukunaga, Y. Matsui and H. Kimata.
[31] IETF RFC 4103 (2005): \"RTP Payload for Text Conversation\", G. Hellstrom
and P. Jones.
[32] IETF RFC 3555 (2003): \"MIME Type Registration of RTP Payload Formats\",
S. Casner and P. Hoschka.
[33] 3GPP TR 25.993: \"Typical examples of Radio Access Bearers (RABs) and
Radio Bearers (RBs) supported by Universal Terrestrial Radio Access (UTRA)\".
[34] 3GPP TS 22.105: \"Services and service capabilities\".
[35] 3GPP TS 26.131: \"Terminal acoustic characteristics for telephony;
Requirements\".
[36] 3GPP TS 26.132: \"Speech and video telephony terminal acoustic test
specification\".
[37] 3GPP TS 28.062: \"Inband Tandem Free Operation (TFO) of speech codecs;
Service description; Stage 3\".
[38] 3GPP TS 23.153: \"Out of band transcoder control; Stage 2\".
[39] IETF RFC 0768 (1980): \"User Datagram Protocol\", J. Postel.
[40] IETF RFC 4585 (2006): \"Extended RTP Profile for Real-time Transport
Control Protocol (RTCP) - Based Feedback (RTP/AVPF)\", J. Ott, S. Wenger, N.
Sato, C. Burmeister and J. Rey.
[41] RTP Tools: http://www.cs.columbia.edu/IRT/software/rtptools/.
[42] IETF RFC 3556 (2003): \"Session Description Protocol (SDP) Bandwidth
Modifiers for RTP Control Protocol (RTCP) Bandwidth\", S. Casner.
[43] IETF RFC 5104 (2008): \"Codec Control Messages in the RTP Audio-Visual
Profile with Feedback (AVPF)\", S. Wenger, U. Chandra, M. Westerlund and B.
Burman.
[44] Void.
[45] 3GPP TS 26.111: \"Codec for circuit switched multimedia telephony
service; Modifications to H.324\".
[46] 3GPP TS 23.172: \"Technical realization of Circuit Switched (CS)
multimedia service; UDI/RDI fallback and service modification; Stage 2\".
[47] 3GPP TS 23.002: \"Network Architecture\".
[48] IETF RFC 3388 (2002): \"Grouping of Media Lines in the Session
Description Protocol (SDP)\", G. Camarillo, G. Eriksson, J. Holler and H.
Schulzrinne.
[49] IETF RFC 4102 (2005): \"Registration of the text/red MIME Sub-Type\", P.
Jones.
[50] ITU-T H.248: \"Packages for text conversation, fax and call
discrimination\".
[51] ETSI EG 202 320: \"Duplex Universal Text and Voice\".
[52] 3GPP TS 26.226: \"Cellular text telephone modem; General description\".
[53] IETF RFC 4504 (2006): \"SIP Telephony Device Requirements and
Configuration\", H. Sinnreich, Ed., S. Lass and C. Stredicke.
[54] ITU-T Recommendation V.151: \"Procedures for end-to-end connection of
analogue PSTN text telephones over an IP network utilizing text relay\".
[55] ITU-T Recommendation V.152: \"Procedures for supporting Voice Band Data
over IP networks\".
[56] IETF RFC 3448 (2003): \"TCP Friendly Rate Control (TFRC): Protocol
Specification\", M. Handley, S. Floyd, J. Padhye and J. Widmer.
[57] 3GPP TS 24.173: \"IMS Multimedia Telephony Communication Service and
Supplementary Services\".
[58] IETF RFC 3264 (2002): \"An Offer/Answer Model with the Session
Description Protocol (SDP)\", J. Rosenberg and H. Schulzrinne.
[59] 3GPP TS 26.141: \"IP Multimedia System (IMS) Messaging and Presence;
Media formats and codecs\".
[60] 3GPP TS 26.234: \"Transparent end-to-end Packet-switched Streaming
Service; Protocols and codecs\".
[61] IETF RFC 4733 (2006): \"RTP Payload for DTMF Digits, Telephony Tones, and
Telephony Signals\", H. Schulzrinne and T.Taylor.
[62] 3GPP TS 23.014. \"Support of Dual Tone Multi-Frequency (DTMF)
signalling\",
[63] ETSI ES 201 235-2, v1.2.1: \"Specification of Dual Tone Multi-Frequency
(DTMF); Transmitters and Receivers; Part 2: Transmitters\".
[64] 3GPP TS 23.107: \"Quality of Service (QoS) concept and architecture\".
[65] 3GPP TS 29.163: \"Interworking between the IP Multimedia (IM) Core
Network (CN) subsystem and Circuit Switched (CS) networks\".
[66] Void.
[67] OMA-ERELD-DM-V1_2-20070209-A: \"Enabler Release Definition for OMA Device
Management, Approved Version 1.2\".
[68] Void.
> [69] IETF RFC 5939 (2010): "Session Description Protocol (SDP) Capability
> Negotiation", F. Andreasen.
[70] 3GPP TS 22.042: \"Network Identity and Time Zone (NITZ), Stage 1\".
[71] IETF RFC 1952 (May 1996): \"GZIP file format specification version 4.3\",
P. Deutsch.
[72] IETF RFC 2326: \"**Real Time Streaming Protocol (RTSP)** \".
[73] IETF RFC 2616 (June 1999): \"Hypertext Transfer Protocol -- HTTP/1.1\".
[74] 3GPP TS 26.346 "Multimedia Broadcast/Multicast Service (MBMS); Protocols
and codecs".
[75] 3GPP TS 23.040: \"Technical realization of Short Message Service (SMS)\".
[76] IETF RFC 6236 (2011): "Negotiation of Generic Image Attributes in the
Session Description Protocol (SDP)", I. Johansson and K. Jung.
[77] ITU-T G.711: \"Pulse code modulation (PCM) of voice frequencies\".
[78] ITU-T G.722: \"7 kHz audio-coding within 64 kbit/s\".
[79] IETF RFC 4821 (2007), \"Packetization Layer Path MTU Discovery\".
[80] 3GPP TS 23.003 \"Numbering, addressing and identification\".
[81] IETF RFC 4796 \"The session description protocol (SDP) content
attribute\", J. Hautakorpi and G. Camarillo.
[82] 3GPP TS 24.247 \"Messaging service using the IP Multimedia (IM) Core
Network (CN) subsystem\".
[83] IETF RFC 5506 (2009) \"Support for Reduced-Size Real-Time Transport
Control Protocol (RTCP): Opportunities and Consequences\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply:
NOTE: A term defined in the present document takes precedence over the
definition of the same term, if any, in 3GPP TR 21.905 [1].
**example:** text used to clarify abstract rules by applying them literally.
**Evolved UTRAN:** Evolved UTRAN is an evolution of the 3G UMTS radio-access
network towards a high-data-rate, low-latency and packet-optimized radio-
access network.
**MTSI client:** A function in a terminal or in a network entity (e.g. a MRFP)
that supports MTSI.
**MTSI client in terminal:** An MTSI client that is implemented in a terminal
or UE. The term "MTSI client in terminal" is used in this document when
entities such as MRFP, MRFC or media gateways are excluded.
**MTSI media gateway (or MTSI MGW):** A media gateway that provides
interworking between an MTSI client and a non MTSI client, e.g. a CS UE. The
term MTSI media gateway is used in a broad sense, as it is outside the scope
of the current specification to make the distinction whether certain
functionality should be implemented in the MGW or in the MGCF.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply:
NOTE: An abbreviation defined in the present document takes precedence over
the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].
AC Alternating Current
AL-SDU Application Layer - Service Data Unit
AMR Adaptive Multi-Rate
AMR-NB Adaptive Multi-Rate - NarrowBand
AMR-WB Adaptive Multi-Rate - WideBand
APP APPlication-defined RTCP packet
ARQ Automatic repeat ReQuest
AS Application Server
AVC Advanced Video Coding
CCM Codec Control Messages
CDF Cumulative Distribution Function
CMR Codec Mode Request
cps characters per second
CS Circuit Switched
CSCF Call Session Control Function
CTM Cellular Text telephone Modem
DTMF Dual Tone Multi-Frequency
DTX Discontinuous Transmission
E-UTRAN Evolved UTRAN
FIR Full Intra Request
GIP Generic IP access
GOB Group Of Blocks
H-ARQ Hybrid - ARQ
HSPA High Speed Packet Access
ICM Initial Codec Mode
IDR Instantaneous Decoding Refresh
IMS IP Multimedia Subsystem
IP Internet Protocol
IPv4 Internet Protocol version 4
ITU-T International Telecommunications Union - Telecommunications
JBM Jitter Buffer Management
MGCF Media Gateway Control Function
MGW Media GateWay
MIME Multipurpose Internet Mail Extensions
MO Management Object
MPEG Moving Picture Experts Group
MRFC Media Resource Function Controller
MRFP Media Resource Function Processor
MSRP Message Session Relay Protocol
MTSI Multimedia Telephony Service for IMS
MTU Maximum Transfer Unit
NACK Negative ACKnowledgment
NNI Network-to-Network Interface
NTP Network Time Protocol
PCM Pulse Code Modulation
PDP Packet Data Protocol
PLI Picture Loss Indication
POI Point Of Interconnect
PSTN Public Switched Telephone Network
QoE Quality of Experience
QoS Quality of Service
QP Quantization Parameter
RoHC Robust HeaderCompression
RR Receiver Report
RTCP RTP Control Protocol
RTP Real-time Transport Protocol
SB-ADPCM Sub-Band Adaptive Differential PCM
SDP Session Description Protocol
SDPCapNeg SDP Capability Negotiation
SID SIlence Descriptor
SIP Session Initiation Protocol
SR Sender Report
TFO Tandem-Free Operation
TISPAN Telecoms and Internet converged Services and Protocols for Advanced
Network
TMMBN Temporary Maximum Media Bit-rate Notification
TMMBR Temporary Maximum Media Bit-rate Request
TrFO Transcoder-Free Operation
UDP User Datagram Protocol
UE User Equipment
VoIP Voice over IP
VOP Video Object Plane
# 4 System description
## 4.1 System
A Multimedia Telephony Service for IMS call uses the Call Session Control
Function (CSCF) mechanisms to route control‑plane signalling between the UEs
involved in the call (see figure 4.1). In the control plane, Application
Servers (AS) should be present and may provide supplementary services such as
call hold/resume, call forwarding and multi‑party calls, etc.
The scope of the present document is to specify the media path. In the example
in figure 4.1, it is routed directly between the GGSNs outside the IMS.
{width="4.324305555555555in" height="3.7527777777777778in"}
Figure 4.1: High-level architecture figure showing the nodes involved in an
MTSI call set-up
## 4.2 Client
The functional components of a terminal including an MTSI client are shown in
figure 4.2.
NOTE: The grey box marks the scope of the present document.
Figure 4.2: Functional components of a terminal including an MTSI client
The scope of the present document is to specify media handling and
interaction, which includes media control, media codecs, as well as transport
of media and control data. General control-related elements of an MTSI client,
such as SIP signalling (3GPP TS 24.229 [7]), fall outside this scope, albeit
parts of the session setup handling and session control for conversational
media are defined here:
\- usage of SDP (RFC 4566 [8]) and SDP capability negotiation (SDPCapNeg [69])
in SIP invitations for capability negotiation and media stream setup.
\- set-up and control of the individual media streams between clients. It also
includes interactivity, such as adding and dropping of media components.
Transport of media consists of the encapsulation of the coded media in a
transport protocol as well as handling of coded media received from the
network. This is shown in figure 4.2 as the \"packet based network interface\"
and is displayed, for conversational media, in more detail in the user-plane
protocol stack in figure 4.3. The basic MTSI client defined here specifies
media codecs for speech, video and text (see clause 5). All conversational
media components are transported over RTP with each respective payload format
mapped onto the RTP (RFC 3550 [9]) streams.
Figure 4.3: User plane protocol stack for a basic MTSI client
An MTSI client may also support non-conversational media, for example IMS
messaging. The functional entities and the protocols used for IMS messaging
are described in 3GPP TS 24.247 [82].
## 4.3 MRFP and MGW
A Media Resource Function Processor (MRFP), see 3GPP TS.23.002 [47], may be
inserted in the media path for certain supplementary services (e.g.
conference) and/or to provide transcoding and may therefore act as a MTSI
client together with other network functions, such as a MRFC.
A Media Gateway (MGW), see 3GPP TS 23.002 [47], may be used to provide inter-
working between different networks and services. For example, a MTSI MGW may
provide inter-working between MTSI and 3G-324M services. The MTSI MGW may have
more limited functionality than other MTSI clients, e.g. when it comes to the
supported bitrates of media. The inter-working aspects are described in more
detail in clause 12.
# 5 Media codecs
## 5.1 Media components
The Multimedia Telephony Service for IMS supports simultaneous transfer of
multiple media components with real-time characteristics. Media components
denote the actual components that the end-user experiences.
The following media components are considered as core components. Multiple
media components (including media components of the same media type) may be
present in a session. At least one of these components is present in all
conversational multimedia telephony sessions.
**\- Speech:** The sound that is picked up by a microphone and transferred
from terminal A to terminal B and played out in an earphone/loudspeaker.
Speech includes detection and generation of DTMF signals.
**\- Video:** The moving image that is, for example, captured by a camera of
terminal A, transmitted to terminal B and, for example, rendered on the
display of terminal B.
**\- Text:** The characters typed on a keyboard or drawn on a screen on
terminal A and rendered in real time on the display of terminal B. The flow is
time-sampled so that no specific action is needed from the user to request
transmission.
The above core media components are transported in real time from one MTSI
client to the other using RTP (RFC 3550 [9]). All media components can be
added or dropped during an ongoing session as required either by the end-user
or by controlling nodes in the network, assuming that when adding components,
the capabilities of the MTSI client support the additional component.
NOTE: The terms voice and speech are synonyms. The present document uses the
term speech.
## 5.2 Codecs for MTSI clients in terminals
### 5.2.1 Speech
MTSI clients in terminals offering speech communication shall support:
\- AMR speech codec (3GPP TS 26.071 [11], 3GPP TS 26.090 [12], 3GPP TS 26.073
[13] and 3GPP TS 26.104 [14]) including all 8 modes and source controlled rate
operation ‎3GPP TS 26.093 [15]. The MTSI client in terminal shall be capable
of operating with any subset of these 8 codec modes.
When transmitting, the MTSI client in terminal shall be capable of aligning
codec mode changes to every frame border, and shall also be capable of
restricting codec mode changes to be aligned to every other frame border, e.g.
like UMTS_AMR_2 (3GPP TS 26.103 [16]). The MTSI client in terminal shall also
be capable of restricting codec mode changes to neighbouring codec modes
within the negotiated codec mode set. When receiving, the MTSI client in
terminal shall allow codec mode changes at any frame border and to any codec
mode within the negotiated codec mode set.
The codec modes and the other codec parameters (mode-change-capability, mode-
change-period, mode-change-neighbor, etc), applicable for each session, are
negotiated as described in clauses 6.2.2.2 and 6.2.2.3.
MTSI clients in terminals offering wideband speech communication at 16 kHz
sampling frequency shall support:
\- AMR wideband codec (3GPP TS 26.171 ‎‎[17], 3GPP TS 26.190 ‎[18], 3GPP TS
26.173 ‎[19] and 3GPP TS 26.204 [20]) including all 9 modes and source
controlled rate operation ‎3GPP TS 26.193 [21]. The MTSI client in terminal
shall be capable of operating with any subset of these 9 codec modes.
When transmitting, the MTSI client in terminal shall be capable of aligning
codec mode changes to every frame border, and shall also be capable of
restricting codec mode changes to be aligned to every other frame border, e.g.
like UMTS_AMR_WB‎ (3GPP TS 26.103 [16]). The MTSI client in terminal shall
also be capable of restricting codec mode changes to neighbouring codec modes
within the negotiated codec mode set. When receiving, the MTSI client in
terminal shall allow codec mode changes at any frame border and to any codec
mode within the negotiated codec mode set.
The codec modes and the other codec parameters (mode-change-capability, mode-
change-period, mode-change-neighbor, etc), applicable for each session, are
negotiated as described in clauses 6.2.2.2 and 6.2.2.3.
MTSI clients in terminals offering wideband speech communication shall also
offer narrowband speech communications. When offering both wideband speech and
narrowband speech communication, wideband shall be listed as the first payload
type in the m line of the SDP offer (RFC 4566 [8]).
Encoding of DTMF is described in Annex G.
### 5.2.2 Video
MTSI clients in terminals offering video communication shall support:
\- ITU-T Recommendation H.263 [22] Profile 0 Level 45.
In addition they should support:
\- ITU-T Recommendation H.263 [22] Profile 3 Level 45;
\- MPEG-4 (Part 2) Visual [23] Simple Profile Level 3with the following
constraints:
\- Number of Visual Objects supported shall be limited to 1.
\- The maximum frame rate shall be 30 frames per second.
\- The maximum f_code shall be 2.
\- The intra_dc_vlc_threshold shall be 0.
\- The maximum horizontal luminance pixel resolution shall be 352 pels/line.
\- The maximum vertical luminance pixel resolution shall be 288 pels/VOP.
\- If AC prediction is used, the following restriction applies: QP value shall
not be changed within a VOP (or within a video packet if video packets are
used in a VOP). If AC prediction is not used, there are no restrictions to
changing QP value.
\- ITU-T Recommendation H.264 / MPEG-4 (Part 10) AVC [24] Baseline Profile
Level 1.1 with constraint_set1_flag=1 and without requirements on output
timing conformance (annex C of [24]). Each sequence parameter set of H.264
(AVC) shall contain the vui_parameters syntax structure including the
num_reorder_frames syntax element set equal to 0.
When H.264 (AVC) is used it is recommended to transmit H.264 (AVC) parameter
sets within the SDP description of a stream (using sprop-parameter-sets
MIME/SDP parameter -- RFC6184 [25]). Moreover, it is not recommended to reuse
any parameter set identifier value that appeared previously in the SDP
description or in the RTP stream.
The H.264 (AVC) decoder in a multimedia MTSI client in terminal shall either
start decoding immediately when it receives data (even if the stream does not
start with an IDR access unit) or alternatively no later than it receives the
next IDR access unit or the next recovery point SEI message, whichever is
earlier in decoding order. The decoding process for a stream not starting with
an IDR access unit shall be the same as for a valid H.264 (AVC) bit stream.
However, the MTSI client in terminal shall be aware that such a stream may
contain references to pictures not available in the decoded picture buffer.
The display behaviour of the MTSI client in terminal is out of scope of the
present document.
MTSI terminals offering video support other than H.263 Profile 0 Level 45
shall also offer H.263 Profile 0 Level 45 video.
NOTE 1: If a codec is supported at a certain level, then all (hierarchically)
lower levels shall be supported as well. Examples of lower levels include
Level 10 for H.263 Profile 0 and 3, Level 0 for MPEG-4 Visual Simple Profile
and Level 1 for H.264 (AVC) Baseline Profile. However, as for instance Level
20 is not hierarchically lower than Level 45 of H.263 Profile 0 and 3, support
for Level 45 does not imply support for Level 20.
NOTE 2: All levels are minimum requirements. Higher levels may be supported
and used for negotiation.
NOTE 3: MTSI clients in terminals may use full-frame freeze and full-frame
freeze release SEI messages of H.264 (AVC) to control the display process.
NOTE 4: An H.264 (AVC) encoder should code redundant slices only if it knows
that the far-end decoder makes use of this feature (which is signalled with
the redundant-pic-cap MIME/SDP parameter as specified in RFC 6184 [25]). H.264
(AVC) encoders should also pay attention to the potential implications on
end‑to‑end delay.
NOTE 5: If a codec is supported at a certain level, it implies that on the
receiving side, the decoder is required to support the decoding of bitstreams
up to the maximum capability of this level. On the sending side, the support
of a particular level does not imply that the encoder may produce a bitstream
up to the maximum capability of the level.
NOTE 6: If video is used in a session, an MTSI client in terminal should offer
at least one video stream with a picture aspect ratio in the range from 0.7 to
1.4. For all offered video streams, the width and height of the picture should
be integer multiples of 16 pixels. For example, 224x176, 272x224, and 320x240
are image sizes that satisfy these conditions.
### 5.2.3 Real-time text
MTSI clients in terminals offering real time text conversation shall support:
\- ITU-T Recommendation T.140 [26] and [27].
T.140 specifies coding and presentation features of real-time text usage. Text
characters are coded according to the UTF-8 transform of ISO 10646-1
(Unicode).
A minimal subset of the Unicode character set, corresponding to the Latin-1
part shall be supported, while the languages in the regions where the MTSI
client in terminal is intended to be used should be supported.
Presentation control functions from ISO 6429 are allowed in the T.140 media
stream. A mechanism for extending control functions is included in ITU-T
Recommendation T.140 [26] and [27]. Any received non-implemented control code
must not influence presentation.
A MTSI client in terminal shall store the conversation in a presentation
buffer during a call for possible scrolling, saving, display re-arranging,
erasure, etc. At least 800 characters shall be kept in the presentation buffer
during a call.
Note that erasure (backspace) of characters is included in the T.140 editing
control functions. It shall be possible to erase all characters in the
presentation buffer. The display of the characters in the buffer shall also be
impacted by the erasure.
# 6 Media configuration
## 6.1 General
MTSI uses SIP, SDP and SDPCapNeg for media negotiation and configuration.
General SIP signalling and session setup for IMS are defined in 3GPP TS 24.229
[7], whereas this clause specifies SDP and SDPCapNeg usage and media handling
specifically for MTSI, including offer/answer considerations in the capability
negotiation. The MTSI client in the terminal may use the OMA-DM solution
specified in Clause 15 for enhancing SDP negotiation and PDP context
activation process.
## 6.2 Session setup procedures
### 6.2.1 General
The session setup for RTP transported media shall determine for each media: IP
address(es), RTP profile, UDP port number(s); codec(s); RTP Payload Type
number(s), RTP Payload Format(s) and any additional session parameters.
An MTSI client shall offer at least one RTP profile for each RTP media stream.
Multiple RTP profiles may be offered using SDPCapNeg as described in Clause
6.2.1a. For voice and real-time text, the first SDP offer for a media type
shall include at least the AVP profile. For video, the first SDP offer for a
media type shall include at least the AVPF profile. Subsequent SDP offers may
include only other RTP profiles if it is known from a preceding offer that
this RTP profile is supported by the answerer. The MTSI client shall be
capable of receiving an SDP offer containing both AVP and AVPF offers in order
to support interworking.
### 6.2.1a RTP profile negotiation
#### 6.2.1a.1 General
MTSI clients should support SDPCapNeg to be able to negotiate RTP profiles for
all media types where AVPF is supported. MTSI clients supporting SDPCapNeg
shall support the complete SDPCapNeg framework.
SDPCapNeg is described in [69]. This clause only describes the SDPCapNeg
attributes that are directly applicable for the RTP profile negotiation, i.e.
the tcap, pcfg and acfg attributes. TS 24.229 [7] may outline further
requirements needed for supporting SDPCapNeg in SDP messages.
NOTE: This clause describes only how to use the SDPCapNeg framework for RTP
profile negotiation using the tcap, pcfg and acfg attributes. Implementers may
therefore (incorrectly) assume that it is sufficient to implement only those
specific parts of the framework that are needed for RTP profile negotiation.
Doing so would however not be future proof since future versions may use other
parts of the framework and there are currently no mechanisms for declaring
that only a subset of the framework is supported. Hence, MTSI clients are
required to support the complete framework.
#### 6.2.1a.2 Using SDPCapNeg in SDP offer
For voice and real-time text, SDPCapNeg shall be used when offering AVPF the
first time for a new media type in the session since the support for AVPF in
the answering client is not known at this stage. For video, an MTSI client
shall either offer AVPF and AVP together using SDPCapNeg, or the MTSI client
shall offer only AVPF, without using SDPCapNeg. If an MTSI client has offered
only AVPF for video, and then receives as response either an SDP answer where
the video media component has been rejected, or an SIP 488 or 606 failure
response with an SDP body indicating that only AVP is supported for video
media, the MTSI client should send a new SDP offer with AVP as transport for
video. Subsequent SDP offers, in a re-INVITE or UPDATE, may offer AVPF without
SDPCapNeg if it is known from an earlier re-INVITE or UPDATE that the
answering client supports this RTP profile. If the offer includes only AVP
then SDPCapNeg does not need to be used, which can occur for: text; speech if
RTCP is not used; and in re-INVITEs or UPDATEs where the RTP profile has
already been negotiated for the session in a preceding INVITE or UPDATE.
When offering AVP and AVPF using SDPCapNeg, the MTSI client shall offer AVP on
the media (m=) line and shall offer AVPF using SDPCapNeg mechanisms. The
SDPCapNeg mechanisms are used as follows:
\- The support for AVPF is indicated in an attribute (a=) line using the
transport capability attribute 'tcap'. AVPF shall be preferred over AVP.
\- At least one configuration using AVPF shall be listed using the attribute
for potential configurations 'pcfg'.
#### 6.2.1a.3 Answering to an SDP offer using SDPCapNeg
An invited MTSI client should accept using AVPF whenever supported. If AVPF
has been offered using SDPCapNeg and is to be used in the session then the
MTSI client shall:
\- select one configuration out of the potential configurations defined in the
SDP offer for using AVPF;
\- indicate in the media (m=) line of the SDP answer that the profile to use
is AVPF; and
\- indicate the selected configuration for using AVPF in the attribute for
actual configurations 'acfg'.
If AVP is to be used then the MTSI shall not indicate any SDPCapNeg attributes
for using AVPF in the SDP answer.
### 6.2.2 Speech
#### 6.2.2.1 General
For AMR or AMR-WB encoded media, the session setup shall determine what RTP
profile to use; if all codec modes can be used or if the operation needs to be
restricted to a subset; if the bandwidth-efficient payload format can be used
or if the octet-aligned payload format must be used; if codec mode changes
shall be restricted to be aligned to only every other frame border or if codec
mode changes can occur at any frame border; if codec mode changes must be
restricted to only neighbouring modes within the negotiated codec mode set or
if codec mode changes can be performed to any mode within the codec mode set;
the number of speech frames that should be encapsulated in each RTP packet and
the maximum number of speech frames that may be encapsulated in each RTP
packet.
If the session setup negotiation concludes that multiple configuration
variants are possible in the session then the default operation should be used
as far as the agreed parameters allow, see clause 7.5.2.1. It should be noted
that the default configurations are slightly different for different access
types.
An MTSI client offering a speech media session for narrow-band speech and/or
wide-band speech should offer SDP according to the examples in clauses A.1 to
A.3.
An MTSI client shall at least offer AVP for speech media streams. An MTSI
client should also offer AVPF for speech media streams. RTP profile
negotiation shall be done as described in clause 6.2.1a.
Session setup for sessions including speech and DTMF events is described in
Annex G.
#### 6.2.2.2 Generating SDP offers for AMR-NB and AMR-WB
When speech is offered, an MTSI client in terminal sending a first SDP offer
in the initial offer-answer negotiation shall include at least one RTP payload
type for AMR-NB and the MTSI client in terminal shall support a configuration
where the MTSI client in terminal includes the parameter settings as defined
in Table 6.1 and in Table 6.2. If wideband speech is also offered then the SDP
offer shall also include at least one RTP payload type for AMR-WB and the MTSI
client in terminal shall support a configuration where the MTSI client in
terminal includes the parameter settings as defined in Table 6.1 and in Table
6.2.
NOTE: While it is required that the MTSI client in terminal supports the
configurations of the SDP parameters as specified, other configurations may be
used due to terminal resources, network resources or operator specified
settings.
Table 6.1: SDP parameters for AMR-NB or AMR-WB when the MTSI client in
terminal offers the bandwidth-efficient payload format
* * *
Parameter Usage octet-align Shall not be included mode-set Shall not be
included mode-change-period Shall not be included mode-change-capability Shall
be set to 2 mode-change-neighbor Shall not be included maxptime Shall be set
to 240, see also Table 7.1 crc Shall not be included robust-sorting Shall not
be included interleaving Shall not be included ptime Shall be set according to
Table 7.1 channels Shall either be set to 1 or be omitted max-red Shall be
included and shall be set to 220 or less
* * *
Table 6.2: SDP parameters for AMR-NB or AMR-WB when the MTSI client in
terminal offers the octet-aligned payload format
* * *
Parameter Usage octet-align Shall be set to 1 mode-set Shall not be included
mode-change-period Shall not be included mode-change-capability Shall be set
to 2 mode-change-neighbor Shall not be included maxptime Shall be set to 240,
see also Table 7.1 crc Shall not be included robust-sorting Shall not be
included interleaving Shall not be included ptime Shall be set according to
Table 7.1 channels Shall either be set to 1 or be omitted max-red Shall be
included and shall be set to 220 or less
* * *
When the channels parameter is omitted then this means that one channel is
being offered.
An example of an SDP offer for AMR-NB is shown in Table A.1.1. An example of
an SDP offer for both AMR-NB and AMR-WB is shown in Table A.1.2.
An MTSI client in terminal may divide the offer-answer negotiation into
several phases and offer different configurations in different SDP offers. If
this is done then the first SDP offer in the initial offer-answer negotiation
shall include the most preferable configurations. For AMR, this means that the
first SDP offer in the initial offer-answer negotiation shall include at least
one RTP payload type for AMR-NB with the parameters as defined in Table 6.1.
If wideband speech is offered then the first SDP offer in the initial offer-
answer negotiation shall include also at least one RTP payload type for AMR-WB
with the parameters as defined in Table 6.1. This also means that offers for
octet-aligned payload format do not need to be included in the first SDP
offer. One example of dividing the offer-answer negotiation into two phases,
and the corresponding SDP offers, is shown in clause A.1.1.2.2.
NOTE: Dividing the offer-answer negotiation into several phases may lead to
never offering the less preferred configurations if the other end-points
accepts to use at least one of the configurations offered in the initial SDP
offer.
If the speech media is re-negotiated during the session then the knowledge
from earlier offer-answer negotiations should be used in order to shorten the
session re-negotiation time. I.e., failed offer-answer transactions shall not
be repeated.
#### 6.2.2.3 Generating the SDP answer
An MTSI client in terminal must understand all the payload format options that
are defined in RFC 4867 [28]. It does not have to support operating according
to all these options but must be capable to properly accepting or rejecting
all options.
The SDP answer depends on many factors, for example:
\- what is included in the SDP offer and in what preference order that is
defined. The SDP offer will probably be different if it is generated by
another MTSI client in terminal, by an MTSI MGW, a TISPAN client or some other
VoIP client that does not follow this specification;
\- if terminal and/or network resources are available; and:
\- if there are other configurations, for example defined with OMA-DM, that
mandate, recommend or prevent some configurations.
Table 6.3 describes requirements and recommendations for handling of the AMR
payload format parameters and for how to generate the SDP answer.
NOTE: An MTSI client in terminal may support more features than what is
required by this specification, e.g. crc, robust sorting and interleaving.
Table 6.3 describes the handling of the AMR payload format parameters when the
MTSI client implementation supports only those features that are required by
this specification.
Table 6.3: Handling of the AMR-NB and AMR-WB SDP parameters in the received
SDP offer and in the SDP answer
+----------------------+----------------------+----------------------+ | Parameter in the | Comments | Handling | | received SDP offer | | | +----------------------+----------------------+----------------------+ | Codec | Wide-band speech is | If both AMR-WB and | | | preferable over | AMR-NB are offered | | | narrow-band speech | and if AMR-WB is | | | | supported by the | | | | answering MTSI | | | | client in terminal | | | | then it shall select | | | | to use the AMR-WB | | | | codec and include | | | | this codec in the | | | | SDP answer, unless | | | | another preference | | | | order is indicated | | | | in the SDP offer. If | | | | the MTSI client in | | | | terminal only | | | | supports AMR-NB then | | | | this codec shall be | | | | selected to be used | | | | and shall be | | | | included in the SDP | | | | answer. | | | | | | | | The SDP answer shall | | | | only include one RTP | | | | Payload Type for | | | | speech, see NOTE 1. | +----------------------+----------------------+----------------------+ | octet-align | Both the | The offer shall not | | | bandwidth-efficient | be rejected purely | | | and the | based on the offered | | | octet-aligned | payload format | | | payload formats are | variant. | | | supported by the | | | | MTSI client in | If both | | | terminal. | bandwidth-efficient | | | | and octet-aligned | | | MTSI MGWs for GERAN | are included in the | | | or UTRAN are likely | received SDP offer | | | to either not | then the MTSI client | | | include the | in terminal shall | | | octet-align | select the | | | parameter or to | bandwidth-efficient | | | offer octet-align=0. | payload format and | | | | include it in the | | | The | configuration in the | | | bandwidth-efficient | SDP answer. | | | payload format is | | | | preferable over the | | | | octet-aligned | | | | payload format. | | +----------------------+----------------------+----------------------+ | mode-set | The MTSI client in | The offer shall not | | | terminal can | be rejected purely | | | interoperate | based on the offered | | | properly with | mode-set. | | | whatever mode-set | | | | the other end-point | If only one mode-set | | | offers or if no | is offered MTSI | | | mode-set is offered. | client in terminal | | | | shall select to use | | | The possibilities to | this and include the | | | use the higher bit | same mode-set as in | | | rate codec modes | the SDP answer. | | | also depend on the | | | | offered bandwidth. | If several different | | | | mode-sets are | | | MTSI MGWs for GERAN | included in the | | | or UTRAN | received SDP offer | | | inter-working are | or if some RTP | | | likely to include | Payload Types do not | | | the mode-set in the | specify any mode-set | | | offer if in case the | then the MTSI client | | | intention is to use | in terminal should | | | TFO or TrFO. | select in the first | | | | hand the mode-set | | | Mode sets that gives | that provides the | | | more adaptation | largest degrees of | | | possibilities are | freedom for codec | | | preferable over | mode adaptation and | | | mode-sets with fewer | in the second hand | | | or no adaptation | the mode-set that is | | | possibilities. | closest to the | | | | preferred mode sets. | | | If the mode-set must | | | | be restricted to | | | | include only a few | | | | codec modes then the | | | | preferred mode-set | | | | for AMR-NB is {12.2, | | | | 7.4, 5.9, 4.75} and | | | | for AMR-WB it is | | | | {12.65, 8.85 and | | | | 6.60}. | | +----------------------+----------------------+----------------------+ | mode-change-period | **The MTSI client in | The offer shall not | | | terminal can | be rejected purely | | | interoperate | based on the offered | | | properly with |** m | | | whatever | ode-change-period.**| | | mode-change-period | | | | the other end-point |** If the received | | | offers.**| SDP offer defines | | | | mode-change-period=2 | | |** MTSI MGWs for | then this | | | GERAN or UTRAN | information shall be | | | inter-working are | used to determine | | | likely to include | the mode changes for | | | mode-change-period=2 | AMR-NB or AMR-WB | | | in the offer**if in | encoded media that | | | case the intention | the MTSI client in | | | is to use TFO or | terminal sends.** | | | TrFO**.** | | | | | **The MTSI client in | | | | terminal should not | | | | include the | | | | mode-change-period | | | | parameter in the SDP | | | | answer since it has | | | | no corresponding | | | | limitations.** | +----------------------+----------------------+----------------------+ | mo | The MTSI client in | The offer shall not | | de-change-capability | terminal can | be rejected purely | | | interoperate with | based on the offered | | | whatever | mod | | | capabilities the | e-change-capability. | | | other end-point | | | | declares. | The | | | | mo | | | | de-change-capability | | | | information should | | | | be used to determine | | | | a proper value, or | | | | prevent using an | | | | improper value, for | | | | mode-change-period | | | | in the SDP answer, | | | | see above. If the | | | | offer includes | | | | mode- | | | | change-capability=1, | | | | then the MTSI client | | | | in terminal shall | | | | not offer | | | | mode-change-period=2 | | | | in the answer. | | | | | | | | The MTSI client in | | | | terminal shall | | | | include | | | | mode | | | | -change-capability=2 | | | | in the SDP answer | | | | since it is required | | | | to support | | | | restricting mode | | | | changes to every | | | | other frame. | +----------------------+----------------------+----------------------+ | mode-change-neighbor | The MTSI client in | The offer shall not | | | terminal can | be rejected purely | | | interoperate with | based on the offered | | | whatever limitations | m | | | the other end-point | ode-change-neighbor. | | | offers. | | | | | The MTSI client in | | | | terminal shall use | | | | this information to | | | | determine how mode | | | | changes can be | | | | performed for AMR-NB | | | | or AMR-WB encoded | | | | media that the MTSI | | | | client in terminal | | | | sends. | | | | | | | | The MTSI client in | | | | terminal shall not | | | | include the | | | | mode-change-neighbor | | | | parameter in the SDP | | | | answer since it has | | | | no corresponding | | | | limitations. | +----------------------+----------------------+----------------------+ | maxptime | The MTSI client in | The offer shall not | | | terminal can | be rejected purely | | | interoperate with | based on the offered | | | whatever value that | maxptime. | | | is offered. | | | | | The MTSI client in | | | The MTSI client in | terminal shall use | | | terminal may also | this information to | | | use this information | control the | | | to determine a | packetization when | | | suitable value for | sending RTP packets | | | max-red in the SDP | to the other | | | answer. | end-point, see also | | | | clause 7.4.2. | | | | | | | | The maxptime | | | | parameter shall be | | | | included in the SDP | | | | answer and shall be | | | | an integer multiple | | | | of 20. | | | | | | | | If the received SDP | | | | offer includes both | | | | the max-red and | | | | ptime parameter then | | | | the MTSI client in | | | | terminal may choose | | | | to use this | | | | information to | | | | define a suitable | | | | value for maxptime | | | | in the SDP answer, | | | | see NOTE 2. The MTSI | | | | client in terminal | | | | may also choose to | | | | set the maxptime | | | | value to 240, | | | | regardless of the | | | | ptime and/or max-red | | | | parameters in the | | | | SDP offer. | | | | | | | | The maxptime value | | | | in the SDP answer | | | | shall not be smaller | | | | than ptime value in | | | | the SDP answer. The | | | | maxptime value | | | | should be selected | | | | to give at least | | | | some room for | | | | adaptation. | +----------------------+----------------------+----------------------+ | crc | The MTSI client in | The MTSI client in | | | terminal is not | terminal may have to | | | required to support | reject offered RTP | | | this option. | payload types | | | | including this | | | | option. | +----------------------+----------------------+----------------------+ | robust-sorting | The MTSI client in | The MTSI client in | | | terminal is not | terminal may have to | | | required to support | reject offered RTP | | | this option. | payload types | | | | including this | | | | option. | +----------------------+----------------------+----------------------+ | interleaving | The MTSI client in | The MTSI client in | | | terminal is not | terminal may have to | | | required to support | reject offered RTP | | | this option. | payload types | | | | including this | | | | option. | +----------------------+----------------------+----------------------+ | ptime | The MTSI client in | The offer shall not | | | terminal can | be rejected purely | | | interoperate with | based on the offered | | | whatever value that | ptime. | | | is offered. | | | | | The MTSI client in | | | | terminal should use | | | | this information and | | | | should use the | | | | requested | | | | packetization when | | | | sending RTP packets | | | | to the other | | | | end-point. The MTSI | | | | client should use | | | | the ptime value to | | | | determine how many | | | | non-redundant speech | | | | frames that can be | | | | packed into the RTP | | | | packets. The | | | | requirements in | | | | clause 7.4.2 shall | | | | be followed even if | | | | ptime in the SDP | | | | offer is larger than | | | | 80. | | | | | | | | The ptime parameter | | | | shall be included in | | | | the SDP answer and | | | | shall be an integer | | | | multiple of 20. | | | | | | | | If the received SDP | | | | offer includes the | | | | ptime parameters | | | | then the MTSI client | | | | in terminal may | | | | choose to use this | | | | information to | | | | define a suitable | | | | value for ptime in | | | | the SDP answer, see | | | | NOTE 3. The MTSI | | | | client in terminal | | | | may also choose to | | | | set the ptime value | | | | in the SDP answer | | | | according to Table | | | | 7.1, regardless of | | | | the ptime parameter | | | | in the SDP offer. | | | | | | | | The ptime value in | | | | the SDP answer shall | | | | not be larger than | | | | the maxptime value | | | | in the SDP answer. | +----------------------+----------------------+----------------------+ | Channels | The number of | When the MTSI client | | | channels may either | in terminal accepts | | | be explicitly | an offer for | | | indicated in the SDP | single-channel audio | | | by including \'/1\', | then the SDP answer | | | \'/2\', etc. on the | shall either | | | a=rtpmap line, but | explicitly indicate | | | the number of | \'/1\' or omit the | | | channels may also be | channels parameter. | | | omitted. When the | | | | number of channels | When the MTSI client | | | is omitted then the | in terminal accepts | | | default rule is that | an offer for | | | one channel is being | multi-channel audio | | | offered. | then the number of | | | | channels shall be | | | The MTSI client in | included in the SDP | | | terminal is only | answer. | | | required to support | | | | audio media using | | | | one channel. Offered | | | | RTP payload types | | | | with more than one | | | | channel may | | | | therefore have to be | | | | rejected. | | +----------------------+----------------------+----------------------+ | max-red | The MTSI client in | The max-red | | | terminal may use | parameter shall be | | | this information to | included in the SDP | | | bound the delay for | answer and shall be | | | receiving redundant | an integer multiple | | | frames. | of 20. | | | | | | | The MTSI client in | If the received SDP | | | terminal may also | offer includes both | | | use this information | the ptime and | | | to determine a | maxptime parameters | | | suitable value for | then the MTSI client | | | maxptime in the SDP | in terminal may | | | answer. | choose to use this | | | | information to | | | | define a suitable | | | | value for max-red in | | | | the SDP answer, see | | | | NOTE 2. The MTSI | | | | client in terminal | | | | may also choose to | | | | set the max-red | | | | value to 220. | | | | | | | | The max-red value in | | | | the SDP answer | | | | should be selected | | | | to give at least | | | | some room for | | | | adaptation. | +----------------------+----------------------+----------------------+ | NOTE 1: An MTSI | | | | client may include | | | | both a speech coded, | | | | e.g. AMR-NB or | | | | AMR-WB, and | | | | 'telephone-events' | | | | for DTMF in the SDP | | | | answer, see 3GPP TS | | | | 24.229 Clause 6.1, | | | | [7]. | | | | | | | | NOTE 2: It is | | | | possible to use the | | | | following | | | | relationship between | | | | maxptime, ptime and | | | | max-red:\ | | | | maxptime = ptime + | | | | max-red.\ | | | | There is however no | | | | mandatory | | | | requirement that | | | | these parameters | | | | must be aligned in | | | | this way. | | | | | | | | NOTE 3: It may be | | | | wise to use the same | | | | ptime value in the | | | | SDP answer as was | | | | given in the SDP | | | | offer, especially if | | | | the ptime in the SDP | | | | offer is larger than | | | | 20, since a value | | | | larger than the | | | | frame length | | | | indicates that the | | | | other end-point is | | | | somehow packet rate | | | | limited. | | | +----------------------+----------------------+----------------------+
If an SDP offer is received from another MTSI client in terminal then the SDP
offer will include configurations as described in Table 6.1 and Table 6.2. If
the MTSI client in terminal chooses to accept the offer for using the AMR-NB
or AMR-WB codec, as configured in Table 6.1 or Table 6.2 then the MTSI client
in terminal shall support a configuration where the MTSI client in terminal
creates an SDP answer containing an RTP payload type for the AMR-NB and AMR-WB
codec as shown in Table 6.4.
Table 6.4: SDP parameters for AMR-NB or AMR-WB for SDP answer when the SDP
offer is received from another MTSI client in terminal
* * *
Parameter Usage octet-align Shall not be included mode-set Shall not be
included or shall be set to the preferred mode-set, see Table 6.3 mode-change-
period Shall not be included mode-change-capability May be included. If it is
included then it shall be set to 2 mode-change-neighbor Shall not be included
maxptime Shall be set to 240, see also Table 7.1 crc Shall not be included
robust-sorting Shall not be included interleaving Shall not be included ptime
Shall be set according to Table 7.1 channels Shall either be set to 1 or be
omitted max-red Shall be included and shall be set to 220 or less
* * *
If an SDP offer is received from a MTSI MGW inter-working with CS GERAN/UTRAN
then it is likely to be configured as shown in Table 6.5 if the MTSI MGW does
not support redundancy.
Table 6.5: Expected configuration of SDP parameters for AMR-NB or AMR-WB in an
SDP offer from an MTSI MGW inter-working with CS GERAN/UTRAN
* * *
Parameter Usage octet-align Either not included or set to 0 mode-set Included
and indicates the codec modes that are allowed in the CS network mode-change-
period Set to 2 mode-change-capability Set to 2 mode-change-neighbor Set to 1
if the CS network is GERAN maxptime Set to 80, see also Table 12.1 crc Not
included robust-sorting Not included interleaving Not included ptime Set
according to Table 12.1 channels Set to 1 or parameter is omitted max-red Set
to 0
* * *
If the MTSI client in terminal accepts the offer included in Table 6.5 then
the MTSI client in terminal shall support a configuration where the MTSI
client in terminal creates an SDP answer containing an RTP payload type for
the AMR-NB and AMR-WB codecs as shown in Table 6.6.
Table 6.6: SDP parameters for AMR-NB or AMR-WB for SDP answer when the SDP
offer is received from another MTSI MGW
* * *
Parameter Usage octet-align Shall be the according to the offer mode-set Shall
be the according to the offer mode-change-period Shall not be included mode-
change-capability May be included. If it is included then it shall be set to 2
mode-change-neighbor Shall not be included maxptime Shall be set to 240, see
also Table 7.1 crc Shall not be included robust-sorting Shall not be included
interleaving Shall not be included ptime Shall be set according to Table 7.1
channels Shall be set according to the offer max-red Shall be included and
shall be set to 220 or less
* * *
### 6.2.3 Video
If video is used in a session, the session setup shall determine the
bandwidth, RTP profile, video codec, profile and level. The \"imageattr\"
attribute as specified in [76] should be supported.
An MTSI client shall offer AVPF for all media streams containing video. RTP
profile negotiation shall be done as described in clause 6.2.1a.
An MTSI client is required to support the AVPF feedback messages trr-int, NAC
and PLI [40] and the CCM feedback messages FIR, TMMBR and TMMBN [43], see
Clauses 7.3.3 and 10.3. These feedback messages can only be used together with
AVPF and shall be negotiated in SDP offer/answer before they can be used in
the session [40]. An MTSI client sending an SDP offer for AVPF shall also
include these AVPF and CCM feedback messages in the offer. An MTSI client
accepting an SDP offer for AVPF for video shall also accept these AVPF and CCM
feedback messages if they are offered.
Examples of SDP offers and answers for video can be found in clause A.4.
NOTE: For H.264 / MPEG-4 (Part 10) AVC, the optional max-rcmd-nalu-size
receiver-capability parameter of RFC 6184 [25] should be set to the smaller of
the MTU size (if known) minus header size or 1 400 bytes (otherwise).
### 6.2.4 Text
An MTSI client should offer AVP for all media streams containing text. Only in
cases where there is an explicit demand for the AVPF RTCP reporting timing or
feedback messages AVPF shall be used. If AVPF is offered then RTP profile
negotiation shall be done as described in clause 6.2.1a.
Examples of SDP offers for text can be found in clause A.5.
### 6.2.5 Bandwidth negotiation
The SDP shall include bandwidth information for each media stream and also for
the session in total. The bandwidth information for each media stream and for
the session is defined by the Application Specific (AS) bandwidth modifier as
defined in RFC 4566 [8].
SDP examples incorporating bandwidth modifiers are shown in annex A.
### 6.2.6 The Synchronization Info attribute \"3gpp_sync_info\"
_Synchronization jitter_ (also known as synchronization or inter-media skew)
is defined as the amount of synchronization delay between media streams that
needs to be maintained during the synchronization process (at the receiver
side), which is acceptable to a session (or the sender of the multimedia
streams) for a good user experience.
Tight synchronization between the constituent streams is not necessary for all
types of MTSI sessions. For instance, during a VoIP call, one of the call
participants may wish to share a video clip or share his/her camera view. In
this situation, the sender may want to relax the requirement on the receiver
to synchronize the audio and the video streams in order to maintain a good
video quality without stressing on tight audio/video synchronization. The
Synchronization Info attribute defined in the present document is not just
limited to lip-sync between audio/video streams, but is also applicable to any
two media streams that need to be synchronized during an MTSI session. This
attribute allows an MTSI client to specify whether or not media streams should
be synchronized. In case the choice is to have synchronization between
different streams, it is up to the implementation, use case and application to
decide the exact amount of synchronization jitter allowed between the streams
to synchronize.
The ABNF for the synchronization info attribute is described as follows:
Synchronization-Info = \"a\" \"=\" \"3gpp_sync_info\" \":\" sync-value
sync-value = \"Sync\" / \"No Sync\"
The value \"Sync\" indicates that synchronization between media shall be
maintained. The value \"No Sync\" indicates that No Synchronization is
required between the media.
The parameter \"3gpp_sync_info\" should be included in the SDP at the session
level and/or at the media level. Its usage is governed by the following rules:
1\. At the session level, the \"3gpp_sync_info\" attribute shall be used with
the group attribute defined in RFC 3388 [48]. The group attribute indicates to
the receiver which streams (identified by their mid attributes) that are to be
synchronized. The \"3gpp_sync_info\" attribute shall follow the \"group: LS\"
line in the SDP.
2\. At the media level, the \"3gpp_sync_info\" attribute shall assume a value
of \"No Sync\" only. It indicates to the receiver that this particular media
stream is not required to be synchronized with any other media stream in the
session. The use of the \"mid\" attribute of RFC 3388 [48] is optional in this
case. If the \"mid\" attribute is used for any other media in the session,
then \"mid\" with this media line shall be used also according to RFC 3388
[48]. Otherwise, it is not necessary to tie the \"3gpp_sync_info\" attribute
with the \"mid\" attribute.
3\. When the \"3gpp_sync_info\" attribute is defined at both session level
(with the \"group\" attribute) and media level, then the media level attribute
shall override the session level attribute. Thus if the \"3gpp_sync_info\"
attribute is defined at the media level, then that particular media stream is
not to be synchronized with any other media stream in the session (even if the
\"3gpp_sync_info\" is defined at the session level for this media stream).
The calling party (or the initiator or offerer of the multimedia stream)
should include the \"3gpp_sync_info\" attribute in the SDP which is carried in
the initial INVITE message. Upon reception of the INVITE message that includes
the \"3gpp_sync_info\" attribute, the other party in the session should
include its own \"3gpp_sync_info\" attribute (with its own wish for
synchronization or no synchronization) in the 200/OK response message.
There are no offer/answer implications on the \"3gpp_sync_info\" attribute; it
provides synchronization requirement between the specified media streams to
the receiver. The \"3gpp_sync_info\" attribute in the calling party SDP is
only an indication to the called party of the synchronization requirement that
should be maintained between the specified media streams that it receives.
Similarly the \"3gpp_sync_info\" attribute value from the called party is an
indication to the calling party of the synchronization requirements between
specified media streams. The \"3gpp_sync_info\" attribute value can be
different for the calling and the called parties.
SDP examples using the \"3gpp_sync_info\" attribute are given in clause A.7.
NOTE: Default operation in the absence of the \"3gpp_sync_info\" attribute in
SDP is to maintain synchronization between media streams.
### 6.2.7 Negotiated QoS parameters
The term \"negotiated\" in the present document describes the end result of a
QoS negotiation between an MTSI client in terminal and the network (or the end
result of what the network grants to the MTSI client in terminal even if no
negotiation takes place).
In case an MTSI client in terminal is made aware that the value of the
negotiated Guaranteed Bit Rate and if this value (taking into account the RTCP
bandwidth usage) is not approximately equal to the b=AS bandwidth modifier
attribute during the initial session setup in an MTSI client in terminal
(sender or receiver), the MTSI client in terminal shall send to the other
party the negotiated Guaranteed Bit Rate (taking into account the RTCP
bandwidth usage) via the SIP UPDATE (or in a SIP re-INVITE) method using the
b=AS bandwidth modifier attribute. If an MTSI client in a terminal (receiver
or sender) receives a new bandwidth value in a SIP UPDATE (or in a SIP re-
INVITE) then it shall respond by sending its known negotiated Guaranteed Bit
Rate (taking into account the RTCP bandwidth usage) via the SIP 200/OK
response to the UPDATE (or re-INVITE) message.
NOTE: The b=AS bandwidth and the GBR bandwidth are not directly comparable
since the b=AS bandwidth does not include the RTCP bandwidth while the GBR
bandwidth allocation must include some headroom for RTCP. The bandwidths will
therefore almost always be different. The GBR bandwidth may also differ from
the b=AS bandwidth because of other reasons, for example: bearer allocation
and header compression. It is an implementation consideration to handle such
impacts and how to judge whether the bandwidth values differ and what
bandwidth value to send in the UPDATE message.
Any subsequent QoS changes indicated to the MTSI client in terminal during an
MTSI session (including the cases described in Clause 10.3) shall be signalled
by the MTSI client in terminal (subject to the QoS update procedure) to the
other party using the same signalling described above.
Examples of SDP using negotiated QoS are given in clause A.8.
## 6.3 Session control procedures
During session renegotiation for adding or removing media components, the SDP
offerer should continue to use the same media (m=) line(s) from the previously
negotiated SDP for the media components that are not being added or removed.
An MTSI client in terminal may support multiple media components including
media components of the same media type. An MTSI client in terminal may
support adding one or more media components to an on-going session which
already contains a media component of the same media type. If an MTSI client
in terminal needs to have multiple media components of the same media type in
a single MTSI session, then the MTSI client in terminal should use the SDP
content attributes as defined in [81] for identifying different media
components. An SDP example for adding a second video stream to an ongoing
video telephony session is given in Annex A.11.
The content attribute can be used in combination with the group attributes
defined in RFC 3388 [48] and also in combination with the synchronization
attributes defined in Clause 6.2.6, for example to identify two (or more)
media components are related to each other and if synchronization is needed.
# 7 Data transport
## 7.1 General
MTSI clients shall support an IP-based network interface for the transport of
session control and media data. Control-plane signalling is sent using SIP;
see 3GPP TS 24.229 [7] for further details. User plane media data is sent over
RTP/UDP/IP. An overview of the user plane protocol stack can be found in
figure 4.3 of the present document.
## 7.2 RTP profiles
MTSI clients shall transport speech, video and real-time text using RTP (RFC
3550 [9]) over UDP (RFC 0768 [39]). The following profiles of RTP shall be
supported for all media types:
\- RTP Profile for Audio and Video Conferences with Minimal Control (RFC 3551
[10]), also called RTP/AVP.
The following profiles of RTP shall be supported for video and should be
supported for all other media types:
\- Extended RTP Profile for RTCP-based Feedback (RTP/AVPF) (RFC 4585 [40]),
also called RTP/AVPF.
The support of AVPF requires an MTSI client in terminal to implement the RTCP
transmission rules, the signalling mechanism for SDP and the feedback messages
explicitly mentioned in the present document.
For a given RTP based media stream, the MTSI client in terminal shall use the
same port number for sending and receiving RTP packets. This facilitates
interworking with fixed/broadband access. However, the MTSI client shall
accept RTP packets that are not received from the same remote port where RTP
packets are sent by the MTSI client.
## 7.3 RTCP usage
### 7.3.1 General
The RTP implementation shall include an RTCP implementation.
For a given RTP based media stream, the MTSI client in terminal shall use the
same port number for sending and receiving RTCP packets. This facilitates
interworking with fixed/broadband access. However, the MTSI client shall
accept RTCP packets that are not received from the same remote port where RTCP
packets are sent by the MTSI client.
The bandwidth for RTCP traffic shall be described using the \"RS\" and \"RR\"
SDP bandwidth modifiers at media level, as specified by RFC 3556 [42].
Therefore, an MTSI client shall include the \"b=RS:\" and \"b=RR:\" fields in
SDP, and shall be able to interpret them. There shall be an upper limit on the
allowed RTCP bandwidth for each RTP session signalled by the MTSI client. This
limit is defined as follows:
\- 8 000 bps for the RS field (at media level);
\- 6 000 bps for the RR field (at media level).
The RS and RR values included in the SDP answer should be treated as the
negotiated values for the session and should be used to calculate the total
RTCP bandwidth for all terminals in the session.
If the session described in the SDP is a point-to-point speech only session,
the MTSI client may request the deactivation of RTCP by setting its RTCP
bandwidth modifiers to zero.
If a MTSI client receives SDP bandwidth modifiers for RTCP equal to zero from
the originating MTSI client, it should reply (via the SIP protocol) by setting
its RTCP bandwidth using SDP bandwidth modifiers with values equal to zero.
RTCP packets should be sent for all types of multimedia sessions to enable
synchronization with other RTP transported media, remote end-point aliveness
information, monitoring of the transmission quality, and carriage of feedback
messages such as TMMBR for video and RTCP APP for speech. The RR value should
be set greater than zero to enable RTCP packets to be sent when media is put
on hold and during active RTP media transmission, including real-time text
sessions which may have infrequent RTP media transmissions.
Point-to-point speech only sessions may not require the above functionalities
and may therefore turn off RTCP by setting the SDP bandwidth modifiers (RR and
RS) to zero. When RTCP is turned off (for point-to-point speech only sessions)
and the media is put on hold, the MTSI client should re-negotiate the RTCP
bandwidth with the SDP bandwidth modifier RR value set greater than zero, and
send RTCP packets (i.e., Receiver Reports) to the other end. This allows the
remote end to detect link aliveness during hold. When media is resumed, the
resuming MTSI client should request to turn off the RTCP sending again through
a re-negotiation of the RTCP bandwidth with SDP bandwidth modifiers equal to
zero.
When RTCP is turned off (for point-to-point speech only sessions) and if
sending of an additional associated RTP stream becomes required and both RTP
streams need to be synchronized, or if transport feedback due to lack of end-
to-end QoS guarantees is needed, a MTSI client should re-negotiate the
bandwidth for RTCP by sending an SDP with the RR bandwidth modifier greater
than zero. Setting the RR bandwidth modifier greater than zero allows sending
of RTCP Receiver Reports even when the session is put on hold and neither
terminal is actively sending RTP media.
NOTE 1: Deactivating RTCP will disable the adaptation mechanism for speech
defined in clause 10.2.
### 7.3.2 Speech
MTSI clients in terminals offering speech should support AVPF (RFC 4585 [40]).
When allocating RTCP bandwidth, it is recommended to allocate RTCP bandwidth
and set the values for the \"b=RR:\" and the \"b=RS:\" parameters such that a
good compromise between the RTCP reporting needs for the application and
bandwidth utilization is achieved, see also Annex A.6. The value of \"trr-
int\" should be set to zero or not transmitted at all (in which case the
default \"trr‑int\" value of zero will be assumed) when Reduced-Size RTCP (see
clause 7.3.6) is not used.
For speech sessions it is beneficial to keep the size of RTCP packets as small
as possible in order to reduce the potential disruption of RTCP onto the RTP
stream in bandwidth-limited channels. RTCP packet sizes can be minimized by
using Reduced-Size RTCP packets or using the parts of RTCP compound packets
(according to RFC 3550 [9]) which are required by the application. RTCP
compound packet sizes should be at most as large as 1 time and, at the same
time, shall be at most as large as 4 times the size of the RTP packets
(including UDP/IP headers) corresponding to the highest bit rate of the speech
codec modes used in the session. Reduced-Size RTCP and semi-compound RTCP
packet sizes should be at most as large as 1 time and, at the same time, shall
be at most as large as 2 times the size of the RTP packets (including UDP/IP
headers) corresponding to the highest bit rate of the speech codec modes used
in the session.
For speech, RTCP APP packets are used for adaptation (see clause 10.2).
### 7.3.3 Video
MTSI clients offering video shall support AVPF (RFC 4585 [40]). The behaviour
can be controlled by allocating enough RTCP bandwidth using \"b=RR:\" and
\"b=RS:\" (see section 7.3.1) and setting the value of \"trr-int\".
MTSI clients offering video shall support transmission and reception of AVPF
NACK messages, as an indication of non-received media packets. MTSI terminals
offering video shall also support reception of AVPF Picture Loss Indication
(PLI). An MTSI client receiving NACK or PLI should take appropriate action to
improve the situation for the MTSI client that sent NACK or PLI, although no
action is mandated nor specified. Note that by setting the bitmask of
following lost packets (BLP) the frequency of transmitting NACK can be
reduced, but the repairing action by the MTSI client receiving the message can
be delayed correspondingly.
The Temporary Maximum Media Bit-rate Request (TMMBR) and Temporary Maximum
Media Bit-rate Notification (TMMBN) messages of Codec-Control Messages (CCM)
[43] shall be supported by MTSI clients in terminals supporting video. The
TMMBR notification messages along with RTCP sender reports and receiver
reports are used for dynamic video rate adaptation. See clause 10.3 for usage
and Annexes B and C for examples of bitrate adaptation.
MTSI clients supporting video shall support Full Intra Request (FIR) of CCM
[43].
The usage of the AVPF and CCM feedback messages is negotiated in SDP
offer/answer, see Clause 6.2.3. Any AVPF or CCM feedback messages that have
not been agreed in the SDP offer/answer negotiation shall not be used in the
session, [40].
### 7.3.4 Real-time text
For real-time text, RTCP reporting should be used according to general
recommendations for RTCP.
### 7.3.5 Void
### 7.3.6 Reduced-Size RTCP
MTSI clients should support the use of Reduced-Size RTCP reports [83]. A
Reduced-Size RTCP packet is an RTCP packet that does not follow the sending
rules outlined in RFC 3550 [9] in the aspect that it does not necessarily
contain the mandated RR/SR report blocks and SDES CNAME items.
As specified in RFC5506 [83], a client that support Reduced-Size RTCP shall
also support AVPF, see clause 7.2 An SDP offer to use Reduced-Size RTCP shall
also offer using AVPF.
When Reduced-Size RTCP is used, the following requirements apply on the RTCP
receiver:
\- The RTCP receiver shall be capable of parsing and decoding report blocks of
the RTCP packet correctly even though some of the items mandated by RFC3550
[9] are missing.
\- An SDP attribute "a=rtcp-rsize" is used to enable Reduced-Size RTCP. A
receiver that accepts the use of Reduced-Size RTCP shall include the attribute
in the SDP answer. If this attribute is not set in offer/answer, then Reduced-
Size RTCP shall not be used in any direction.
When Reduced-Size RTCP is used, an RTCP sender transmitting Reduced-Size RTCP
packets shall follow the requirements listed below:
\- AVPF early or immediate mode shall be used according to RFC4585 [40].
\- The "a=rtcp-rsize" attribute shall be included in the SDP offer, see Annex
A.9a.
\- Reduced-Size RTCP packets should be used for transmission of adaptation
feedback messages, for example APP packets as defined in Clause 10.2 and TMMBR
as defined in Clause 10.3. When regular feedback packets are transmitted, the
individual packets that would belong to a compound RTCP packet shall be
transmitted in a serial fashion, although adaptation feedback packets shall
take precedence.
\- Two or more RTCP packets should be stacked together, within the limits
allowed by the maximum size of Reduced-Size RTCP packets (see clause 7.3.2)
(i.e., to form a semi-compound RTCP packet which is smaller than a compound
RTCP packet). The RTCP sender should not send Reduced-Size RTCP packets that
are larger than the regularly scheduled compound RTCP packets.
\- Compound RTCP packets with an SR/RR report block and CNAME SDES item should
be transmitted on a regular basis as outlined in RFC 3550 [9] and RFC 4585
[40]. In order to control the allocation of bandwidth between Reduced-Size
RTCP and compound RTCP, the AVPF "trr-int" parameter should be used to set the
minimum report interval for compound RTCP packets.
\- The first transmitted RTCP packet shall be a compound RTCP packet as
defined in RFC3550 [9] without the size restrictions defined in clause 7.3.2.
The application should verify that the Reduced-Size RTCP packets are
successfully received by the other end-point. Verification can be done by
implicit means, for instance the RTCP sender that sends an adaptation feedback
requests is expected to detect some kind of a response to the requests in the
media stream. If verification fails then the RTCP sender shall switch to the
use of compound RTCP packets according to the rules outlined in RFC3550 [9].
Examples of SDP negotiation for Reduced-Size RTCP given in Clause A.9a.
## 7.4 RTP payload formats for MTSI clients
### 7.4.1 General
This clause specifies RTP payload formats for MTSI clients, except for MTSI
media gateways that is specified in clause 12.3.2, for all codecs supported by
MTSI in clause 5.2. Note that each RTP payload format also specifies media
type signalling for usage in SDP.
### 7.4.2 Speech
When transmitting AMR or AMR-WB encoded media in RTP
\- the AMR (and AMR-WB) payload format shall be used ‎[28].
MTSI clients (except MTSI MGW) shall support both the bandwidth-efficient and
the octet-aligned payload format. The bandwidth‑efficient payload format shall
be preferred over the octet-aligned payload format.
The MTSI clients (except MTSI MGW) should use the SDP parameters defined in
table 7.1 for the session. For all access technologies, and for normal
operating conditions, the MTSI client should encapsulate the number of non-
redundant (a.k.a. primary) speech frames in the RTP packets that corresponds
to the ptime value received in SDP from the other MTSI client, or if no ptime
value has been received then according to \"Recommended encapsulation\"
defined in table 7.1. The MTSI client may encapsulate more non-redundant
speech frames in the RTP packet but shall not encapsulate more than 4 non-
redundant speech frames in the RTP packets. The MTSI client may encapsulate
any number of redundant speech frames in an RTP packet but the length of an
RTP packet, measured in ms, shall never exceed the maxptime value.
NOTE: The terminology \"non-redundant speech frames\" refers to speech frames
that have not been transmitted in any preceding packet.
Table 7.1: Encapsulation parameters (to be used as defined above)
+------------------+------------------+------------------+----------+ | Radio access | Recommended | ptime | maxptime | | bearer | encapsulation | | | | technology | (if no ptime and | | | | | no | | | | | RTC | | | | | P_APP_REQ_AGG | | | | | has been | | | | | received) | | | +------------------+------------------+------------------+----------+ | Default | 1 non-redundant | 20 | 240 | | | speech frame per | | | | | RTP packet | | | | | | | | | | Max 12 speech | | | | | frames in total | | | | | but not more | | | | | than a received | | | | | maxptime value | | | | | requires | | | +------------------+------------------+------------------+----------+ | HSPA | 1 non-redundant | 20 | 240 | | | speech frame per | | | | E-UTRAN | RTP packet | | | | | | | | | | Max 12 speech | | | | | frames in total | | | | | but not more | | | | | than a received | | | | | maxptime value | | | | | requires | | | +------------------+------------------+------------------+----------+ | EGPRS | 2 non-redundant | 40 | 240 | | | speech frames | | | | | per RTP packet, | | | | | but not more | | | | | than a received | | | | | maxptime value | | | | | requires | | | | | | | | | | Max 12 speech | | | | | frames in total | | | | | but not more | | | | | than a received | | | | | maxptime value | | | | | requires | | | +------------------+------------------+------------------+----------+ | GIP | 1 to 4 | 20, 40, 60 or 80 | 240 | | | non-redundant | | | | | speech frames | | | | | per RTP packet | | | | | but not more | | | | | than a received | | | | | maxptime value | | | | | requires. | | | | | | | | | | Max 12 speech | | | | | frames in total | | | | | but not more | | | | | than a received | | | | | maxptime | | | +------------------+------------------+------------------+----------+
NOTE: It is possible to send only redundant speech frames in one RTP packet.
When the radio access bearer technology is not known to the MTSI client, the
default encapsulation parameters defined in Table 7.1 shall be used.
For all radio access bearer technologies, the bandwidth-efficient payload
format should be used unless the session setup concludes that the octet-
aligned payload format is the only payload format that all parties support.
The SDP offer shall include an RTP payload type where octet-align=0 is defined
or where octet-align is not specified and should include another RTP payload
type with octet-align=1. MTSI client offering wide-band speech shall offer
these parameters and parameter settings also for the RTP payload types used
for wide-band speech.
For examples of SDP offers and answers, see annex A.
The RTP payload format for DTMF events ís described in Annex G.
### 7.4.3 Video
The following RTP payload formats shall be used:
\- H.263 video codec RTP payload format according to RFC 4629 [29];
\- MPEG-4 video codec RTP payload format according to RFC 3016 [30];
\- H.264 (AVC) video codec RTP payload format according to RFC 6184 [25],
where the interleaved packetization mode shall not be used. Receivers shall
support both the single NAL unit packetization mode and the non‑interleaved
packetization mode of RFC 6184 [25], and transmitters may use either one of
these packetization modes.
### 7.4.4 Real-time text
The following RTP payload format shall be used:
\- T.140 text conversation RTP payload format according to RFC 4103 [31].
Real-time text shall be the only payload type in its RTP stream because the
RTP sequence numbers are used for loss detection and recovery. The redundant
transmission format shall be used for keeping the effect of packet loss low.
Media type signalling for usage in SDP is specified in section 10 of RFC 4103
[31] and section 3 of RFC 4102 [49].
## 7.5 Media flow
### 7.5.1 General
This clause contains considerations on how to use media in RTP, packetization
guidelines, and other transport considerations.
### 7.5.2 Media specific
#### 7.5.2.1 Speech
##### 7.5.2.1.1 General
This clause describes how the speech media should be packetized during a
session. It includes definitions both for the cases where the access type is
known and one default operation for the case when the access type is not
known.
Requirements for transmission of DTMF events are described in Annex G.
##### 7.5.2.1.2 Default operation
When the radio access bearer technology is not known to the MTSI client, the
default encapsulation parameters defined in Table 7.1 shall be used.
The codec modes and the other codec parameters (mode-change-capability, mode-
change-period, mode-change-neighbor, etc), applicable for each session, are
negotiated as described in clauses 6.2.2.2 and 6.2.2.3.
In the transmitted media, codec mode changes should be aligned to every other
frame border and should be performed to one of the neighbouring codec modes in
the negotiated mode set, except for a MTSI media gateway, see clause 12.3.1.1.
In the transmitted media, the highest codec mode of the negotiated mode-set
(or of all modes, if no mode-set was included in the SDP answer) should be
used, unless it is restricted by the most recently received CMR. In the
received media, codec mode changes shall be accepted at any frame border and
to any codec mode within the negotiated mode set.
The adaptation of codec mode, aggregation and redundancy is defined in clause
10.2. The MTSI client in terminal should indicate that no mode request is
present (i.e. value 15) in the CMR bits in the AMR payload format [28]. It
shall however accept requests signalled with the CMR bits in the AMR payload
format.
The AMR bandwidth-efficient payload format should be used unless the session
setup determines that the octet-aligned payload format must be used.
The MTSI client should send one speech frame encapsulated in each RTP packet
unless the session setup or adaptation request defines that the other MTSI
client wants to receive another encapsulation variant.
The MTSI client should request to receive one speech frame encapsulated in
each RTP packet but shall accept any number of frames per RTP packet up to the
maximum limit of 12 speech frames per RTP packet.
For application-layer redundancy, see clause 9.2.
##### 7.5.2.1.3 HSPA
Use default operation as defined in clause 7.5.2.1.2.
NOTE: The RLC PDU sizes defined in 3GPP TR 25.993 [33] have been optimized for
the codec modes, payload formats and frame encapsulations defined in the
default operation in clause 7.5.2.1.2.
##### 7.5.2.1.4 EGPRS
Use default operation as defined in clause 7.5.2.1.2, except that the MTSI
client in terminal
\- should send two speech frames encapsulated in each RTP packet unless the
session setup or adaptation request defines that the other PS end-point want
to receive another encapsulation variant;
\- should request receiving two speech frames encapsulated in each RTP packet
but shall accept any number of frames per RTP packet up to the maximum limit
of 12 speech frames per RTP packet.
##### 7.5.2.1.5 GIP
Use default operation as defined in clause 7.5.2.1.2, except that the MTSI
client in terminal:
\- should send 0, 1, 2, 3 or 4 non-redundant speech frames encapsulated in
each RTP packet unless the session setup or adaptation request defines that
other PS end-point want to receive another encapsulation variant;
\- should request receiving 1 to 4 speech frames in each RTP packet but shall
accept any number of frames per RTP packet up to the maximum limit of 12
speech frames per RTP packet;
\- may use application layer redundancy, in which case the MTSI client in
terminal may encapsulate up to 12 speech frames in each RTP packet, with a
maximum of four non-redundant speech frames.
##### 7.5.2.1.6 Initial codec mode for AMR and AMR-WB
To avoid congestion on the link and to improve inter-working with CS GERAN
when AMR or AMR-WB is used and when more than one codec mode is allowed in the
session, the MTSI client in terminal should limit the initial codec mode (ICM)
to one of the lowest codec modes for an Initial Waiting Time of 600 ms from
the beginning of the RTP stream, or until it receives one of the following:
\- a one frame-block with rate control information; or;
\- an RTCP message with rate control information; or:
\- reception quality feedback information, e.g. PLR or jitter in RTCP Sender
Reports or Receiver Reports, indicating that the currently used codec mode is
too high for the current operating condition.
The rate control information can either be: a CMR with a value other than '15'
in the RTP payload; or a CMR with a value other than '15' in an RTCP_APP
message (see Clause 10.2.1).
NOTE: A CMR with a value of '15' means that no mode request is present [28].
If no rate control information is received within the Initial Waiting Time,
then the sending MTSI client in terminal should gradually increase the codec
mode from the ICM towards the highest codec mode allowed in the session. While
not detecting poor transmission performance or not receiving rate control
information, the sending MTSI client in terminal should use step-wise up-
switch to avoid introducing congestion during the upwards adaptation. The
step-wise up-switch should be performed by switching to the next higher codec
mode in the allowed mode set and then waiting for an Initial Up-switch Waiting
Time of 600 ms before each subsequent up-switch until the first down-switch
occurs.
The following rules can be used for determining the ICM:
> \- If 1 codec mode is included in the mode-set then this should be the ICM.
>
> \- If 2 or 3 codec modes are included in the mode-set then the ICM should be
> the codec mode with the lowest rate.
>
> \- If 4 or more codec modes are included in the mode-set then the ICM should
> be the codec mode with the 2^nd^ lowest rate.
##### 7.5.2.1.7 E-UTRAN
Use the default operation as defined in Clause 7.5.2.1.2.
#### 7.5.2.2 Video
An MTSI client should follow general strategies for error-resilient coding
(segmentation) and packetization as specified by each codec [22], [23], [24]
and RTP payload format [25], [29], [39] specification. Further guidelines on
how the video media data should be packetized during a session are provided in
this clause.
Coded pictures should be encoded into individual segments:
\- For H.263 Profile 0, a Picture Start Code (PSC) or non-empty Group of Block
(GOB) header indicates the beginning of such a segment.
\- For H.263 Profile 3, MPEG-4 (Part 2) Visual, and H.264 / MPEG-4 (Part 10)
AVC, a slice corresponds to such a segment.
Each individual segment should be encapsulated in one RTP packet. Each RTP
packet should be smaller than the Maximum Transfer Unit (MTU) size.
NOTE 1: Unnecessary video segmentation, e.g. within RTP packets, may reduce
coding efficiency.
NOTE 2: RTP packet fragmentation, e.g. across UDP boundaries, may decrease
transport overhead and reduce error robustness. Hence, packet size granularity
is a trade-off between error robustness and overhead that may be tuned
according to bearer access characteristics if available.
NOTE 3: In most cases, the MTU-size has a direct relationship with the bearer
of the radio network.
#### 7.5.2.3 Text
Real-time text is intended for human conversation applications. Text shall not
be transferred with higher rate than 30 characters per second (as defined for
cps in section 6 of RFC 4103 [31]). A text-capable MTSI client shall be able
to receive text with cps set up to 30.
### 7.5.3 Media synchronization
#### 7.5.3.1 General
RTCP SR shall be used for media synchronization by setting the NTP and RTP
timestamps according to RFC 3550 [9]. To enable quick media synchronization
when a new media component is added, or an MTSI session is initiated, the RTP
sender should send RTCP Sender Reports for all newly started media components
as early as possible.
NOTE: An MTSI sender can signal in SDP that no synchronization between media
components is required. See clause 6.2.6 and clause A.7.
#### 7.5.3.2 Text
The media synchronization requirements for real-time text are relaxed. A
synchronization error between text and other media of a maximum of 3 seconds
is accepted. Since this is longer than the maximum accepted latency, no
specific methods need to be applied to assure to meet the requirement
# 8 Jitter buffer management in MTSI clients in terminals
## 8.1 General
This clause specifies mechanisms to handle delay jitter in MTSI clients in
terminals.
## 8.2 Speech
### 8.2.1 Terminology
In the following paragraph(s), Jitter Buffer Management (JBM) denotes the
actual buffer as well as any control, adaptation and media processing
algorithm (excluding speech decoder) used in the management of the jitter
induced in the transport channel. An illustration of an exemplary structure of
an MTSI speech receiver with adaptive jitter buffer is shown in figure 8.1 to
clarify the terminology and the relation between different functional
components.
Figure 8.1: Example structure of an MTSI speech receiver
The blocks \"network analyzer\" and \"adaptation control logic\" together with
the information on buffer status form the actual buffer control functionality,
whereas \"speech decoder\" and \"adaptation unit\" provide the media
processing functionality. Note that the external playback device control
driving the media processing is not shown in figure 8.1.
The grey dashed lines indicate the measurement points for the jitter buffer
delay, i.e. the difference between the decoder consumption time and the
arrival time of the speech frame to the JBM.
The functional processing blocks are as follows:
**\- Buffer:** The jitter buffer unpacks the incoming RTP payloads and stores
the received speech frames. The buffer status may be used as input to the
adaptation decision logic. Furthermore, the buffer is also linked to the
speech decoder to provide frames for decoding when they are requested for
decoding.
**\- Network analyser:** The network analysis functionality is used to monitor
the incoming packet stream and to collect reception statistics (e.g. jitter,
packet loss) that are needed for jitter buffer adaptation. Note that this
block can also include e.g. the functionality needed to maintain statistics
required by the RTCP if it is being used.
**\- Adaptation control logic:** The control logic adjusting playback delay
and operating the adaptation functionality makes decisions on the buffering
delay adjustments and required media adaptation actions based on the buffer
status (e.g. average buffering delay, buffer occupancy, etc.) and input from
the network analyser. Furthermore, external control input can be used e.g. to
enable inter-media synchronisation or other external scaling requests. The
control logic may utilize different adaptation strategies such as fixed jitter
buffer (without adaptation and time scaling), simple adaptation during comfort
noise periods or buffer adaptation also during active speech. The general
operation is controlled with desired proportion of frames arriving late,
adaptation strategy and adaptation rate.
**\- Speech decoder:** The standard AMR or AMR-WB speech decoder. Note that
the speech decoder is also assumed to include error concealment / bad frame
handling functionality. Speech decoder may be used with or without the
adaptation unit.
**\- Adaptation unit:** The adaptation unit shortens or extends the output
signal length according to requests given by the adaptation control logic to
enable buffer delay adjustment in a transparent manner. The adaptation is
performed using the frame based or sample based time scaling on the decoder
output signal during comfort noise periods only or during active speech and
comfort noise. The buffer control logic should have a mechanism to limit the
maximum scaling ratio. Providing a scaling window in which the targeted time
scale modifications are performed improves the situation in certain scenarios
- e.g. when reacting to the clock drift or to a request of inter-media
(re)synchronization - by allowing flexibility in allocating the scaling
request on several frames and performing the scaling on a content-aware
manner. The adaptation unit may be implemented either in a separate entity
from the speech decoder or embedded within the decoder.
### 8.2.2 Functional requirements for jitter-buffer management
The functional requirements for the speech JBM guarantee appropriate
management of jitter which shall be the same for all speech JBM
implementations used in MTSI clients in terminals. A JBM implementation used
in MTSI shall support the following requirements, but is not limited in
functionality to these requirements. They are to be seen as a minimum set of
functional requirements supported by every speech JBM used in MTSI.
Speech JBM used in MTSI shall:
\- support all the codecs as defined in clause 5.2.1;
\- support source-controlled rate operation as well as non-source-controlled
rate operation;
\- be able to receive the de-packetized frames out of order and present them
in order for decoder consumption;
\- be able to receive duplicate speech frames and only present unique speech
frames for decoder consumption;
\- be able to handle clock drift between the encoding and decoding end-points.
### 8.2.3 Minimum performance requirements for jitter-buffer management
#### 8.2.3.1 General
The jitter buffering time is the time spent by a speech frame in the JBM. It
is measured as the difference between the decoding start time and the arrival
time of the speech frame to the JBM. The frames that are discarded by the JBM
are not counted in the measure.
The minimum performance requirements consist of objective criteria for delay
and jitter-induced concealment operations. In order for a JBM implementation
to pass the minimum performance requirements all objective criteria shall be
met.
A JBM implementation used in MTSI shall comply with the following design
guidelines:
1\. The overall design of the JBM shall be to minimize the buffering time at
all times while still conforming to the minimum performance requirements of
jitter induced concealment operations and the design guidelines for sample-
based timescaling (as set in bullet point 3);
2\. If the limit of jitter induced concealment operations cannot be met, it is
always preferred to increase the buffering time in order to avoid growing
jitter induced concealment operations going beyond the stated limit above.
This guideline applies even if that means that end-to-end delay requirement
given in 3GPP TS **22.105** [34] can no longer be met;
3\. If sample-based time scaling is used (after speech decoder), then
artefacts caused by time scaling operation shall be kept to a minimum. **Time
scaling means the modification of the signal by stretching and/or compressing
it over the time axis. The following guidelines on time scaling apply:**
\- Use of a high-quality time scaling algorithm is recommended;
\- The amount of scaling should be as low as possible;
\- Scaling should be applied as infrequently as possible;
\- Oscillating behaviour is not allowed.
NOTE: If the end-to-end delay for the ongoing session is known to the MTSI
client in terminal and measured to be less than 150 ms (as defined in 3GPP TS
22.105 [34]), the JBM may relax its buffering time minimization criteria in
favour of reduced JBM adaptation artefacts if such a relaxation will improve
the media quality. Note that a relaxation is not allowed when testing for
compliance with the minimum performance requirements specified in clauses
8.2.3.2.2 and 8.2.3.2.3.
#### 8.2.3.2 Objective performance requirements
##### 8.2.3.2.1 General
The objective performance requirements consist of criteria for delay, time
scaling and jitter-induced concealment operations.
The objective minimum performance requirements are divided into three parts:
1\. Limiting the jitter buffering time to provide as low end-to-end delay as
possible.
2\. Limiting the jitter induced concealment operations, i.e. setting limits on
the allowed induced losses in the jitter buffer due to late losses, re-
bufferings, and buffer overflows.
3\. Limiting the use of time scaling to adapt the buffering depth in order to
avoid introducing time scaling artefacts on the speech media.
In order to fulfil the objective performance requirements, the JBM under test
needs to pass the respective criteria using the six channels as defined in
clause 8.2.3.3. Note that in order to pass the criteria for a specific
channel, all three requirements must be fulfilled.
##### 8.2.3.2.2 Jitter buffer delay criteria
**The reference delay computation algorithm in Annex D defines the performance
requirements for the set of delay and error profiles described in clause
8.2.3.3. The JBM algorithm under test shall meet these performance
requirements. The performance requirements shall be a threshold for the
Cumulative Distribution Function (CDF) of the speech-frame delay introduced by
the reference delay computation algorithm. A CDF threshold is set by shifting
the reference delay computation algorithm CDF 60 ms. The speech-frame delay
CDF is defined as:**
_P(x) = Probability (delay_compensation_by_JBM ≤ x)_
The relation between the reference delay computation algorithm and the CDF
threshold is outlined in figure 8.2.
{width="5.843055555555556in" height="4.374305555555556in"}
Figure 8.2: Example showing the relation between the reference delay
algorithm\ and the CDF threshold - the delay and error profile 4 in table 8.1
has been used
The JBM algorithm under test shall achieve lower or same delay than that set
by the CDF threshold for at least 90 % of the speech frames. The values for
the CDF shall be collected for the full length of each delay and error
profile. The delay measure in the criteria is measured as the time each speech
frame spends in the JBM; i.e. the difference between the decoder consumption
time and the arrival time of the speech frame to the JBM.
The parameter settings for the reference delay computation algorithm are:
\- adaptation_lookback = 200;
\- delay_delta_max = 20;
\- target_loss= 0.5.
##### 8.2.3.2.3 Jitter induced concealment operations
The jitter induced concealment operations include:
\- JBM induced removal of a speech frame, i.e. buffer overflow or intentional
frame dropping when reducing the buffer depth during adaptation.
\- Deletion of a speech frame because it arrived at the JBM too late.
\- Modification of the output timeline due to link loss.
\- Jitter-induced insertion of a speech frame controlled by the JBM (e.g.
buffer underflow).
Link losses handled as error concealment and not changing the output timeline
shall not be counted in the jitter induced concealment operations.
_Jitter loss rate = JBM triggered concealed frames / Number of transmitted
frames_
The jitter loss rate shall be calculated for active speech frames only.
NOTE: SID_FIRST and SID_UPDATE frames belong to the non-active speech period,
hence concealment for losses of such frames should not be included in the
statistics.
The jitter loss rate shall be below 1% for every channel measured over the
full length of the respective channel. The value of 1 % was chosen because
such a loss rate will usually not significantly reduce the speech quality.
#### 8.2.3.3 Delay and error profiles
Six different delay and error profiles are used to check the tested JBM for
compliance with the minimum performance requirements. The profiles span a
large range of operating conditions in which the JBM shall provide sufficient
performance for the MTSI service. All profiles are 7 500 IP packets long.
Table 8.1: Delay and error profile overview - The channels are attached
electronically
* * *
Profile Characteristics Packet loss rate (%) Filename 1 Low-amplitude, static
jitter characteristics, 1 frame/packet 0 dly_error_profile_1.dat 2 Hi-
amplitude, semi-static jitter characteristics, 1 frame/packet 0.24
dly_error_profile_2.dat 3 Low/high/low amplitude, changing jitter, 1
frame/packet 0.51 dly_error_profile_3.dat 4 Low/high/low/high, changing
jitter, 1 frame/packet 2.4 dly_error_profile_4.dat 5 Moderate jitter with
occasional delay spikes, 2 frames/packet (7 500 IP packets, 15 000 speech
frames) 5.9 dly_error_profile_5.dat 6 Moderate jitter with severe delay
spikes, 1 frame/packet 0.1 dly_error_profile_6.dat
* * *
The attached profiles in the zip-archive \"delay_and_error_profiles.zip\" are
formatted as raw text files with one delay entry per line. The delay entries
are written in milliseconds and packet losses are entered as \"-1\". Note that
when testing for compliance, the starting point in the delay and error profile
shall be randomized.
#### 8.2.3.4 Speech material for JBM minimum performance evaluation
The files described in table 8.2 and attached to the present document in the
zip-archive \"JBM_evaluation_files.zip\" shall be used for evaluation of a JBM
against the minimum performance requirements. The data is stored as RTP
packets, formatted according to \"RTP dump\" format [41]. The input to these
files is AMR or AMR-WB encoded frames, encapsulated into RTP packets using the
octet-aligned mode of the AMR RTP payload format [28].
Table 8.2: Input files for JBM performance evaluation - The files are attached
electronically
* * *
Codec Frames per RTP packet Filename AMR (12.2 kbps) 1 test_amr122_fpp1.rtp
AMR (12.2 kbps) 2 test_amr122_fpp2.rtp AMR-WB (12.65 kbps) 1
test_amrwb1265_fpp1.rtp AMR-WB (12.65 kbps) 2 test_amrwb1265_fpp2.rtp
* * *
## 8.3 Video
Video receivers should implement an adaptive video de-jitter buffer. The
overall design of the buffer should aim to minimize delay, maintain
synchronization with speech, and minimize dropping of late packets. The exact
implementation is left to the implementer.
## 8.4 Text
Conversational quality of real-time text is experienced as being good, even
with up to one second end-to-end text delay. Strict jitter buffer management
is therefore not needed for text. Basic jitter buffer management for text is
described in section 5 of RFC 4103 [31] where a calculation is described for
the time allowed before an extra delayed text packet may be regarded to be
lost.
# 9 Packet-loss handling
## 9.1 General
This clause specifies some methods to handle conditions with packet losses.
Packet losses in general will also trigger adaptation, which is specified in
clause 10.
## 9.2 Speech
### 9.2.1 General
This clause provides a recommendation for a simple application layer
redundancy scheme that is useful in order to handle operational conditions
with severe packet loss rates. Simple application layer redundancy is
generated by encapsulating one or more previously transmitted speech frames
into the same RTP packet as the current previously not transmitted frame(s).
An RTP packet may thus contain zero, one or several redundant speech frames
and zero, one or several non-redundant speech frames.
When transmitting redundancy, the MTSI client should switch to a lower codec
mode. The MTSI client shall utilize the codec mode rates within the negotiated
codec mode set with the negotiated adaptation steps and limitations as defined
by mode-change-neighbor and mode-change-period. It is recommended to not send
redundant speech frames before the targeted codec mode is reached. Table 9.1
defines the recommended codec modes for different redundancy level
combinations.
When application layer redundancy is used for AMR or AMR-WB encoded speech
media, the transmitting application may use up to 300 % redundancy, i.e. a
speech frame transported in one RTP packet may be repeated in 3 other RTP
packets.
Table 9.1: Recommended codec modes and redundancy level combinations\ when
redundancy is supported
* * *
Redundancy level No redundancy 100 % redundancy Narrow-band speech AMR 12.2
AMR 5.9 Wide-band speech (when wide-band is supported) AMR12.65 AMR 6.60
* * *
### 9.2.2 Transmitting redundant frames
When transmitting redundant frames, the redundant frames should be
encapsulated together with non-redundant media data as shown in figure 9.1.
The frames shall be consecutive with the oldest frame placed first in the
packet and the most recent frame placed last in the packet. The RTP Timestamp
shall represent the sampling time of the first sample in the oldest frame
transmitted in the packet.
NOTE: When switching from no redundancy to using redundancy, the RTP Timestamp
may be the same for consecutive RTP packets.
Figure 9.1: Redundant and non-redundant frames in the case of 100 %
redundancy,\ when the original packing is 1 frame per packet
Figure 9.1 shows only one non-redundant frame encapsulated together with one
redundant frame. It is allowed to encapsulate several non-redundant frames
with one or several redundant frames. The following combinations of non-
redundant frames and redundant frames can be used.
Table 9.2: Example frame encapsulation with different redundancy levels and
when maxptime is 240
+----------------+----------------+----------------+----------------+ | Original | Encapsulation | Encapsulation | Encapsulation | | encapsulation | with 100 % | with 200 % | with 300 % | | (without | redundancy | redundancy | redundancy | | redundancy) | | | | +----------------+----------------+----------------+----------------+ | 1 frame per | ≤ 1 | ≤ 1 | ≤ 1 | | packet | non-redundant | non-redundant | non-redundant | | | frame and | frame and | frame and | | | | | | | | ≤ 1 redundant | ≤ 2 redundant | ≤ 3 redundant | | | frame | frames | frames | +----------------+----------------+----------------+----------------+ | 2 frames per | ≤ 2 | ≤ 2 | ≤ 2 | | packet | non-redundant | non-redundant | non-redundant | | | frames and | frames and | frames and | | | | | | | | ≤ 2 redundant | ≤ 4 redundant | ≤ 6 redundant | | | frames | frames | frames | +----------------+----------------+----------------+----------------+ | 3 frames per | ≤ 3 | ≤ 3 | ≤ 3 | | packet | non-redundant | non-redundant | non-redundant | | | frames and | frames and | frames and | | | | | | | | ≤ 3 redundant | ≤ 6 redundant | ≤ 9 redundant | | | frames | frames | frames | +----------------+----------------+----------------+----------------+ | 4 frames per | ≤ 4 | ≤ 4 | Not allowed | | packet | non-redundant | non-redundant | since maxptime | | | frames and | frames and | does not allow | | | | | more than | | | ≤ 4 redundant | ≤ 8 redundant | 12 frames per | | | frames | frames | RTP packet in | | | | | this example | +----------------+----------------+----------------+----------------+
With a maxptime value of 240, it is possible to encapsulate up to 12 frames
per packet. It is therefore not allowed to use 300 % when the original
encapsulation is 4 frames per packet, as shown in table 9.2. If the
receiver\'s maxptime value is lower than 240 then even more combinations of
original encapsulation and redundancy level will be prohibited.
Figure 9.2 shows an example where the frame aggregation is 2 frames per packet
and when 100 % redundancy added.
Figure 9.2: Redundant and non-redundant frames in the case of 100 %
redundancy,\ when the original packing is 2 frames per packet
A redundant frame may be replaced by a NO_DATA frame. If the transmitter wants
to encapsulate non-consecutive frames into one RTP packet, then NO_DATA frames
shall be inserted for the frames that are not transmitted in order to create
frames that are consecutive within the packet. This method is used when
sending redundancy with an offset, see figure 9.3.
Figure 9.3: Redundant and non-redundant frames in the case of 100 %
redundancy, when the original\ packing is 1 frame per packet and when the
redundancy is transmitted with an offset of 20 ms
Note that with this scheme, the receiver may receive a frame 3 times: first
the non-redundant encoding; then as a NO_DATA frame; and finally the redundant
frame. Other combinations of redundancy and offset may result in receiving
even more copies of a frame. The proper receiver behaviour is described in the
AMR payload format [28].
For any combinations of frame aggregation, redundancy and redundancy offset,
the transmitter shall not exceed the frame encapsulation limit indicated by
the receiver\'s maxptime value when constructing the RTP packet.
When source controlled rate operation is used, it is allowed to send redundant
media data without any non-redundant media, if no non-redundant media is
available.
NOTE 1: When going from active speech to DTX, there may be no non-redundant
frames in the end of the talk spurt while there still are redundant frames
that need to be transmitted.
In the end of a talk spurt, when there are no more non-redundant frames to
transmit, it is allowed to drop the redundant frames that are in the queue for
transmission.
NOTE 2: This ensures that it is possible to use redundancy without increasing
the packet rate. The quality degradation by having less redundancy for the
last frames should be negligible since these last frames typically contain
only background noise.
NOTE 3: The RTP Marker Bit shall be set according to Section 4.1 of the AMR
payload format [28].
### 9.2.3 Receiving redundant frames
In order to receive and decode redundant media properly, the receiving
application shall sort the received frames based on the RTP Timestamp and
shall remove duplicated frames. If multiple versions of a frame are received,
i.e. encoded with different bitrates, then the frame encoded with the highest
bitrate should be used for decoding.
## 9.3 Video
AVPF NACK messages are used by MTSI clients to indicate non-received RTP
packets for video (see clause 7.3.3). An MTSI client transmitting video can
use this information, as well as the AVPF Picture Loss Indication (PLI), to at
its earliest opportunity take appropriate action such that the situation for
the MTSI client that sent the NACK or PLI is improved. It is recommended that
an MTSI client considers whether such action could improve the situation
better than ignoring the received message and maintaining the current video
encoding process. In other words the client should take action only when it is
deemed necessary,
## 9.4 Text
Redundant transmission provided by the RTP payload format as described in RFC
4103 [31] shall be supported. The transmitting application may use up to 200 %
redundancy, i.e. a T140block transported in one RTP packet may be repeated
once or twice in subsequent RTP packets. 200 % redundancy shall be used when
the conditions along the call path are not known to be free of loss. However,
the result of media negotiation shall be followed, and transmission without
redundancy used if one of the parties does not show capability for redundancy.
The sampling time shall be 300 ms as a minimum (in order to keep the bandwidth
down) and should not be longer than 500 ms. New text after an idle period
shall be sent as soon as possible. The first packet after an idle-period shall
have the M-bit set.
The procedure described in section 5 of RFC 4103 [31], or a procedure with
equivalent or better performance, shall be used for packet-loss handling in
the receiving MTSI client in terminal.
# 10 Adaptation
## 10.1 General
Adaptive mechanisms are used to optimize the session quality given the current
transport characteristics. The mechanisms provided in MTSI are bit-rate,
packet-rate and error resilience adaptation. These mechanisms can be used in
different ways; however, they should only be used when the result of the
adaptation is assumed to increase the session quality even if e.g. the source
bit-rate is reduced.
Adaptive mechanisms that act upon measured or signalled changes in the
transport channel characteristics may be used in a conservative manner. A
conservative use of adaptation is characterized by a fast response to
degrading conditions, and a slower, careful upwards adaptation intended to
return the session media settings to the original default state of the
session. The long-term goal of any adaptive mechanism is assumed to be a
restoration of the session quality to the originally negotiated quality. The
short-term goal is to maximize the session quality given the current transport
characteristics, even if that means than the adapted state of the session will
give a lower session quality compared to the session default state if
transported on an undisturbed channel.
## 10.2 Speech
### 10.2.1 RTCP-APP with codec control requests
When signalling adaptation requests for speech in MTSI, an RTCP-APP packet
should be used. This application-specific packet format supports three
different adaptation requests; bit-rate requests, packet rate requests and
redundancy requests. The RTCP-APP packet is put in a compound RTCP packets
according to the rules outlined in RFC 3550 [9] and RFC 4585 [40]. In order to
keep the size of the RTCP packets as small as possible it is strongly
recommended that the RTCP packets are transmitted as minimal compound RTCP
packets, meaning that they contain only the items:
\- SR or RR;
\- SDES CNAME item;
\- APP (when applicable).
The recommended RTCP mode is RTCP-AVPF early mode since it will enable
transmission of RTCP reports when needed and still comply with RTCP bandwidth
rules. The RTCP-APP packets should not be transmitted in each RTCP packet, but
rather as a result in the transport characteristics which require end-point
adaptation.
The signalling allows for a request that the other endpoint modifies the
packet stream to better fit the characteristics of the current transport link.
Note that the media sender can, if having good reasons, choose to not comply
with the request received from the media receiver. One such reason could be
knowledge of that the local conditions do not allow the requested format.
The RTCP-APP packet defined to be used for adaptation signalling for speech in
MTSI is constructed as shown in figure 10.1.
Figure 10.1: RTCP-APP formatting
The RTCP-APP specific fields are defined as follows:
\- Subtype - the subtype value shall be set to \"0\".
\- Name - the name shall be set to \"3GM7\", meaning 3GPP MTSI Release 7.
The application-dependent data field contains the requests listed below. The
length of the application-dependent data shall be a multiple of 32 bits. The
unused bytes shall be set to zero.
Figure 10.2: Basic syntax of the application-dependent data fields
The length of the messages is 1 or 2 bytes depending on request type.
The ID field identifies the request type. ID Code points [0000], [0001],
[0010] and [0011] are specified in the present document, whereas the other ID
code points are reserved for future use.
The signalling for three different adaptation requests is defined.
**RTCP_APP_REQ_RED** : Request for redundancy level and offset of redundant
data.
Figure 10.3: Redundancy request
The Bit field is a 12 bit bitmask that signals a request on how non-redundant
payloads chunks are to be repeated in subsequent packets.
The position of the bit set indicates which earlier non-redundant payload
chunks is requested to be added as redundant payload chunks to the current
packet.
\- If the LSB (rightmost bit) is set equal to 1 it indicates that the last
previous payload chunk is requested to be repeated as redundant payload in the
current packet.
\- If the MSB (leftmost bit) is set equal to 1 it indicates that the payload
chunk that was transmitted 12 packets ago is requested to be repeated as
redundant payload chunk in the current packet. Note that it is not guaranteed
that the sender has access to such old payload chunks.
The maximum amount of redundancy is 300 %, i.e., at maximum three bits can be
set in the Bit field.
See clause 10.2.1 for example use cases.
**RTCP_APP_REQ_AGG** : Request for a change of frame aggregation.
Figure 10.4: Frame aggregation request
The DATA field is a 4 bit value field:
\- 0000 - 1 frame / packet.
\- 0001 - 2 frames / packet.
\- 0010 - 3 frames / packet.
\- 0011 - 4 frames / packet.
The values 0100...1111 are reserved for future use.
The maximum allowed frame aggregation is also limited by the maxptime
parameter in the session SDP since the sender is not allowed to send more
frames in an RTP packet than what the maxptime parameter defines.
The default aggregation is governed by the ptime parameter in the session SDP.
It is allowed to send fewer frames in an RTP packet, for example if there are
no more frames available at the end of a talk spurt. It is also allowed to
send more frames in an RTP packet, but such behaviour is not recommended.
See clauses 7.4.2 and 12.3.2.1 for further information.
**RTCP_APP_CMR** : Codec Mode Request
Figure 10.5: Codec mode request
The definition of the CMR bits in the RTCP_APP_CMR message is identical to the
definition of the CMR bits defined in [28].
For an MTSI client in terminal the CMR should be transmitted in an
RTCP_APP_CMR.
When the MTSI MGW has an interworking session with a circuit-switched (CS)
system using transcoding, the CMR should be transmitted in an RTCP_APP_CMR to
the MTSI client in terminal and the CMR in the AMR payload should be set to 15
(no mode request present [28]).
When the MTSI MGW has an interworking session with a circuit-switched (CS)
system using TFO/TrFO, then the MTSI media gateway should translate the CMR
bits (in GERAN case) or the Iu/Nb rate control messages (in UTRAN case) from
the CS client into the CMR bits in the AMR payload. If the MTSI media gateway
prefers to receive a lower codec mode rate from the MTSI client in terminal
than what the CMR from the CS side indicates, then the MTSI media gateway may
replace the CMR from the CS side with the CMR that the MTSI media gateway
prefers. The value 15 (no mode request present [28]) shall be used in the CMR
bits in the AMR payload towards the PS side if on the CS side no mode request
has been received and if the MTSI media gateway has no preference on the used
codec mode. The RTCP_APP_CMR should not be used in the direction from the MTSI
media gateway towards the MTSI client when TFO/TrFO is used.
If an MTSI client receives CMR bits both in the AMR payload and in an
RTCP_APP_CMR message, the mode with the lowest bit rate of the two indicated
modes should be used. A codec mode request received in a RTCP_APP_CMR is valid
until the next received RTCP_APP_CMR.
Figure 10.6 below illustrates how the three requests are used by the
transmitter. In this case, RTCP_APP_REQ_RED is equal to \"000000000101\".
\- The speech encoder generates frames every 20 ms.
\- The speech frames are buffered in the aggregation buffer until it is
possible to generate a payload chunk with the number of frames requested by
either ptime at session setup or by RTCP_APP_REQ_AGG during a session.
\- The current payload chunk is used when constructing the current RTP packet.
\- The history buffer contains previously transmitted payload chunks. The
length of this buffer needs to be dimensioned to store the maximum number of
payload chunks that are possible. This value is based on the max-red value,
the maxptime values and from the minimum number of frames that the transmitter
will encapsulate in the RTP packets. In this case, the buffer length is
selected to 11 payload chunks since this corresponds to the worst case of max-
red=220, maxptime=240 and one frame per payload chunk.
\- After transmitting the current RTP packet, the content of the history
buffer is shifted, the current payload chunk is shifted in to the history
buffer as P(n-1) and the oldest payload chunk P(n-11) is shifted out.
\- When constructing the (provisional) RTP payload, the selected preceding
payload chunks are selected from the history buffer and added to the current
payload chunk. In order to form a valid RTP payload, the transmitter needs to
verify that the maxptime value is not exceeded. If the provisional RTP payload
is longer than what maxptime allows, then the oldest speech frames shall be
removed until the length (in time) of the payload no longer violates the
maxptime value. NO_DATA frames in the beginning or at the end of the payload
does not need to be transmitted and are therefore removed. The RTP Time Stamp
needs to be incremented when a NO_DATA frames are removed from the beginning
of the payload. A (provisional) RTP packet containing only NO_DATA frames does
not need to be transmitted.
Note also that the transmitter is not allowed to send frames that are older
than the max-red value that the transmitter has indicated in the SDP.
Figure 10.6: Visualization of how the different adaptation requests\ affect
the encoding and the payload packetization
It should be noted that RTCP_APP_REQ_AGG and RTCP_APP_REQ_RED are independent.
Furthermore, it should also be noted that different redundant payload chunks
may contain different number of speech frames.
### 10.2.2 Example use cases
The following examples demonstrate how requests for redundancy and frame
aggregation are realised in the RTP stream.
All examples assume that the speech codec generates frames numbered N-10...N
in a continuous flow.
Figure 10.7: Flow of parameter sets for encoded frames\ Each increment
corresponds to a time difference of 20 ms
In the examples below, P-1...P denote the sequence numbers of the packets.
EXAMPLE 1:
An RTCP_APP_REQ_RED request with bit field 000000000000 (no redundancy) and
RTCP_APP_REQ_AGG request with value = 0 (no frame aggregation) will yield
packets as shown in figure 10.8.
Figure 10.8: Default frame aggregation with one frame per packet
EXAMPLE 2:
An RTCP_APP_REQ_RED request with bit field 000000000001 (100% redundancy and
no offset) and an RTCP_APP_REQ_AGG request with value = 0 (no frame
aggregation) will yield packets as shown in figure 10.9.
Figure 10.9: Payload packetization with 100 % redundancy and an offset of one
packet
EXAMPLE 3:
An RTCP_APP_REQ_RED request with bit field 000000000010 (100% redundancy with
offset 1 extra packet) and an RTCP_APP_REQ_AGG request with value = 0 (no
frame aggregation) will yield packets as shown in figure 10.10.
Figure 10.10: Payload packetization with 100 % redundancy and an extra offset
of one packet
NO_DATA frames must be inserted to fill the gaps between two non-consecutive
frames, e.g. between N-2 and N.
EXAMPLE 4:
An RTCP_APP_REQ_RED request with bit field 000000000000 (no redundancy) and
RTCP_APP_REQ_AGG request with value = 1 (frame aggregation 2 frames/packet)
will yield packets as shown in figure 10.11.
Figure 10.11: Payload packetization with 2 frames aggregated per packet
EXAMPLE 5:
An RTCP_APP_REQ_RED request with bit field 000000000001 (100% redundancy) and
an RTCP_APP_REQ_AGG request with value = 1 (frame aggregation 2 frames/packet)
will yield packets as shown in figure 10.12.
Figure 10.12: Payload packetization with 100 % redundancy and 2 frames
aggregated per packet
EXAMPLE 6:
An RTCP_APP_REQ_RED request with bit field 000000000010 (100% redundancy with
offset 1 extra packet) and an RTCP_APP_REQ_AGG request with value = 1 (frame
aggregation 2 frames/packet) will yield packets as shown in figure 10.13.
Figure 10.13: Payload packetization with 100 % redundancy,\ one extra offset
and 2 frames aggregated per packet
## 10.3 Video
MTSI clients receiving RTCP Receiver Reports (RR) indicating nonzero packet
loss should adjust their outgoing bitrate accordingly (see RFC 3550 [9]). Note
that for IMS networks, which normally have nonzero packet loss and fairly long
round-trip delay, the amount of bitrate reduction specified in RFC 3448 [56]
is generally too restrictive for video and may, if used as specified, result
in very low video bitrates already at (for IMS) moderate packet loss rates.
It is recommended that a video sender adapts its video output rate based on
RTCP reports and TMMBR messages. Some examples are given in Annex B.
The use of TMMBR and TMMBN depends on the outcome of the SDP offer/answer
negotiation, see Clause 6.2.3.
If TMMBR andTMMBN is allowed to be used in the session and if the receiving
MTSI client in terminal is made aware of a reduction in downlink bandwidth
allocation through an explicit indication of the available bandwidth from the
network (e.g. due to QoS renegotiation or handoff to another radio access
technology), or from measurements such as increased delay at the receiver it
shall notify the sender of the new current maximum bitrate using TMMBR. In
this context the TMMBR message is used to quickly signal to the other party a
reduction in available bitrate. The sending MTSI client, receiving TMMBR,
shall respond by sending TMMBN, as described in CCM [43]. To determine TMMBR
and TMMBN content, both sending MTSI client and receiving MTSI client in
terminal shall use their best estimates of packet measured overhead size when
measured overhead values are not available. If the TMMBR message was sent due
to an explicit indication of available bandwidth, the MTSI client in terminal
that sent the TMMBR message shall, after receiving the TMMBN, send a SIP
UPDATE to the other party to establish the new rate as specified in clause
6.2.7.
If TMMBR and TMMBN is not allowed to be used in the session and if the MTSI
client in terminal is made aware of a reduction in downlink bandwidth
allocation (e.g. due to QoS renegotiation or handoff to another radio access
technology) is shall send a SIP UPDATE to the other party to establish the new
rate as specified in clause 6.2.7.
If the receiving MTSI client in terminal is made aware of an increase in
downlink bandwidth allocation (determined via separate negotiation) through an
explicit indication from the network (e.g. due to QoS renegotiation or handoff
to another radio access technology) then, if this has not yet occurred, it
shall send a SIP UPDATE to the other party to establish the new rate as
specified in clause 6.2.7.
## 10.4 Text
Rate adaptation (downgrade of used bandwidth) of text shall follow the
recommendation in clause 9 of RFC 4103 [31]. RTCP reports are used as
indicator of loss rate over the channel.
When the transmission interval has been increased in order to handle a
congestion situation, return to normal interval shall be done when RTCP
reports low loss.
# 11 Front-end handling
## 11.1 General
Terminals used for MTSI shall conform to the minimum performance requirements
on the acoustic characteristics of 3G terminals specified in 3GPP TS 26.131
[35]. The codec modes and source control rate operation (DTX) settings shall
be as specified in 3GPP TS 26.132 [36].
Furthermore, the test point (Point-of-Interconnect (POI)) specified in [35]
shall be a reference terminal capable of receiving digital speech data at the
send side and producing a digital output of the received signal (see figure
11.1). During the testing, the radio conditions should be error free and the
jitter and packet loss in the IP transport shall be kept to a minimum.
Figure 11.1: **Interface for testing acoustic properties of a terminal used
for MTSI**
# 12 Inter-working
## 12.1 General
In order to support inter-working between different networks it is good if
common codecs for the connection can be found. Requirements for different
networks are described in this clause. In some cases functionality is also
needed in the network to make the inter-working possible (e.g. MGCF and MGW).
NOTE: The term MTSI MGW (or MTSI Media gateway) is used in a broad sense, as
it is outside the scope of the current specification to make the distinction
whether certain functionality should be implemented in the MGW or in the MGCF.
## 12.2 3G-324M
### 12.2.1 General
Inter-working functions are required between IMS and CS. There are separate
functions, in e.g. a MGCF, for control-plane inter-working (see 3GPP TS 29.163
[65]) and, in e.g. a IM-MGW, for user-plane inter-working. Control-plane
inter-working includes for instance SIP  BICC and SIP  H.245 protocol
translations, whereas user-plane inter-working requires transport protocol
translations and possibly transcoding.
### 12.2.2 Codec usage
#### 12.2.2.1 General
An interoperable set of speech, video and real-time text codecs is specified
for 3G-324M and MTSI. For video there is a difference in levels, which mainly
affects the maximum bitrate. Both video codec level and maximum bitrate can be
specified as part of the call setup negotiation (see clause 12.2.5). Thus, it
is very likely that the MTSI client in terminal and a CS UE can agree on a
common codec end-to-end without the need for MGW transcoding.
If a common codec is not found and the MTSI MGW does not support transcoding
between any of the supported codecs, then the controlling MGCF may drop the
unsupported media component. If the speech part cannot be supported, then the
connection should not be set up.
#### 12.2.2.2 Text
A channel for real-time text is specified in ITU-T H.324. Presentation and
coding is specified according to ITU-T Recommendation T.140, which is also
used for MTSI clients (see clause 7.4.4). Inter-working is a matter of
establishing the text transport channels and moving the text contents between
the two transport levels.
### 12.2.3 Payload format
See clause 7.4 of the present document.
### 12.2.4 MTSI media gateway trans-packetization
#### 12.2.4.1 General
The MTSI MGW shall offer conversion between H.223 as used in 3G-324M on the CS
side and RTP as used in IMS. This clause contains a list inter-working
functionalities that should be included.
#### 12.2.4.2 Speech de-jitter buffer
The MTSI MGW should use a speech de-jitter buffer in the direction IMS to CS
with sufficient performance to meet the 10 milliseconds maximum jitter
requirement in clause 6.7.2 of ITU-T Recommendation H.324. H.324 specifies
that transmission of each speech AL-SDU at the H.223 multiplex shall commence
no later than 10 milliseconds after a whole multiple of the speech frame
interval, measured from transmission of the first speech frame.
#### 12.2.4.3 Video bitrate equalization
Temporary video rate variations can occur on the IMS side for example due to
congestion. The video rate on the CS side, in contrast, is under full control
of the CS side UE and the MGCF.
During session setup, the MGCF shall negotiate a video bitrate on the IMS side
that allows all video bits to be conveyed to/from the CS link.
A buffer shall be maintained at the IM-MGW in the direction from the IMS to
the CS side. The size of the buffer should be kept small enough to allow for a
low end-to-end delay, yet large enough to conceal most network jitter on the
IMS side. Temporary uneven traffic on the IMS side, beyond the handling
capability of the buffer, should be handled as follows: if the buffer
overflows, RTP packets should be dropped and the resulting loss and observed
jitter should be reported by the means of an RTCP RR at the earliest possible
sending time. The drop strategy may preferably be implemented media aware
(i.e. favouring dropping predicted information over non-predicted information
and similar techniques), or may be drop-head. If the buffer runs empty, the CS
side should insert appropriate flag stuffing.
A buffer shall be maintained in the direction from the CS to the IMS side. The
size of the buffer should be kept small enough to allow for a low end-to-end
delay, but large enough to conceal most network jitter on the CS side. If the
buffer overflows, then video bits must be dropped, preferably in a media-aware
fashion, i.e. at GOB/slice/picture boundaries. IM-MGWs may also take into
account the type of media data, i.e. coded with or without prediction. When
the buffer runs empty, no activity is required on the IMS side.
If the CS video call is changed to a speech-only call [46], the video
component on the IMS side shall be dropped.
#### 12.2.4.4 Data loss detection
If RTP packet loss is detected on input to the MTSI MGW at the IMS side,
including losses caused by buffer-full condition as described above,
corresponding H.223 AL-SDU sequence number increments should be made on the CS
side to enable loss detection and proper concealment in the receiving CS UE.
If packet loss is detected on the CS side, e.g. through H.223 AL-SDU sequence
numbers, those losses should be indicated towards the IMS side through
corresponding RTP packet sequence number increments. The deliberate increments
made for this reason will be visible in the RTCP RR from the MTSI client and
the MTSI MGW should take that into account when acting on RTCP RR from the
MTSI client, as the CS side losses are not related to the IMS network
conditions.
#### 12.2.4.5 Data integrity indication
This is mainly relevant in the direction from CS to IMS. The H.223 AL-SDUs
include a CRC that forms an unreliable indication of data corruption. On the
IMS side, no generic protocol mechanisms are available to convey this CRC
and/or the result of a CRC check. The MTSI MGW shall discard any AL-SDUs which
fail a CRC check and are not of a payload type that supports the indication of
possible bit errors in the RTP payload header or data. If such payload type is
in use, the MTSI MGW may forward corrupted packets, but in this case shall
indicate the possible corruption by the means available in the payload header
or data. One example is setting the Q bit of RFC 3267 [28] to 0 for AMR speech
data that was carried in an H.223 AL-SDU with CRC indicating errors. Another
example is setting the F bit of RFC 6184 [25] for H.264 NAL units that may
contain bit errors.
The H.223 AL-SDU CRC is not fully fail-safe and it is therefore recommended
that a MTSI client is designed to be robust and make concealment of corrupt
media data, similar to the CS UE.
#### 12.2.4.6 Packet size considerations
##### 12.2.4.6.0 General
The same packet size and alignment requirements and considerations as defined
in clause 7.5.2 of the present document and in 3GPP TS 26.111 [45] apply to
the MTSI MGW and controlling MGCF, as it in that sense acts both as a MTSI
client towards the IMS and as a CS UE towards the CS side. Maximum available
buffer size for packetization of media data may differ between IMS and CS UE.
To avoid non-favourable segmentation of data (especially video) by the MTSI
MGW, the controlling MGCF should indicate the SDP 'a' attribute
"3gpp_MaxRecvSDUSize" to the MTSI client in terminal. This attribute indicates
the maximum SDU size of the application data (excluding RTP/UDP/IP headers)
that can be transmitted to the receiver without segmentation. The specific
maximum SDU size limit is determined by the MGCF from the H.245 bearer
capability exchange between the CS UE and the MGCF. For example, the MTSI MGW
determines this through the maximumAl2SDUSize and maximumAl3SDUSize fields of
the H223Capability member in H.245 TerminalCapabilitySet message.
##### 12.2.4.6.1 The Maximum Receive SDU Size attribute "3gpp_MaxRecvSDUSize"
The ABNF for the maximum receive SDU size attribute is described as follows:
Max-receive-SDU-size-def = \"a\" \"=\" \"3gpp_MaxRecvSDUSize\" \":\" size-
value CRLF
size-value = 1*5DIGIT; 0 to 65535 in octets
> The value \"size-value\" indicates the maximum SDU size of application data,
> excluding RTP/UDP/IP headers, that can be transmitted to the other end point
> without segmentation.
The parameter \"3gpp_MaxRecvSDUSize\" should be included in the SDP at the
session level and/or at the media level. Its usage is governed by the
following rules:
1\. At the session level, the \"3gpp_MaxRecvSDUSize\" attribute shall apply to
the combination of the data from all the media streams in the session.
2\. At the media level, the \"3gpp_MaxRecvSDUSize\" attribute indicates to the
MTSI client in terminal that this particular media stream in the session has a
specific maximum SDU size limit beyond which received SDUs will be segmented
before delivery to the CS UE.
3\. If the \"3gpp_MaxRecvSDUSize\" attribute is included at the session and
media levels, then the particular media streams have specific maximum SDU size
limits for their own data while the session has an overall maximum SDU size
limit for all the media data in the session.
The MGCF includes the \"3gpp_MaxRecvSDUSize\" attribute in the SDP offer or
answer sent to the MTSI client in terminal after the MGCF determines the
bearer capability of the CS UE (see Annex E of [65]). Upon reception of the
SDP offer or answer that includes the \"3gpp_MaxRecvSDUSize\" attribute, the
MTSI client in terminal need not include this attribute in its subsequent
exchange of messages with the MTSI MGW.
There are no offer/answer implications on the \"3gpp_MaxRecvSDUSize\"
attribute. The \"3gpp_MaxRecvSDUSize\" attribute in the SDP from the MTSI MGW
is only an indication to the MTSI client in terminal of the maximum SDU size
that avoids segmentation for the specified media streams and/or session.
NOTE: Default operation in the absence of the \"3gpp_MaxRecvSDUSize\"
attribute in SDP is to not have any SDU size limits for any of the media
streams or session.
#### 12.2.4.7 Setting RTP timestamps
In general, no explicit timestamps exist at the CS side. Even without
transcoding functionality, the MTSI MGW may have to inspect and be able to
interpret media data to set correct RTP timestamps.
#### 12.2.4.8 Protocol termination
The MTSI MGW shall terminate the H.223 protocol at the CS side. Similarly, the
MTSI MGW shall terminate RTP and RTCP at the IMS side.
#### 12.2.4.9 Media synchronization
The IM-MGW and controlling MGCF should forward and translate the timing
information between the IMS side (RTP timestamps, RTCP sender reports) and the
CS side (H.245 message H223SkewIndication) to allow for media synchronization
in the MTSI client in terminal and the CS UE. The MTSI MGW shall account for
its own contribution to the skew in both directions. Note that transmission
timing of H223SkewIndication and RTCP SR must be decoupled. H223SkewIndication
has no timing restrictions, but is typically sent only once in the beginning
of the session. RTCP SR timing is strictly regulated in RFC 3550 [9], RFC
4585[40], and clause 7.3. To decouple send timings, the time shift information
conveyed in H223SkewIndication and RTCP SR must be kept as part of the MTSI
MGW/MGCF session state. H223SkewIndication should be sent at least once, and
may be sent again when RTCP SR indicates a synchronization change. A
synchronization change of less than 50 ms (value to be confirmed) should be
considered insignificant and need not be signalled.
NOTE: This procedure is not supported in the present Release in a decomposed
MGCF and IM-MGW, as H.245 is treated on the MGCF and RTCP is sent at the IM-
MGW, and no means are defined to forward information from the
H223SkewIndication over the Mn interface.
### 12.2.5 Session control
The MGCF shall offer translation between H.245 and SIP/SDP signalling
according to 3GPP TS 29.163 [65] to allow for end-to-end capability
negotiation.
## 12.3 GERAN/UTRAN CS inter-working
This clause defines requirements only for the PS side of the MGW, i.e. for the
PS session in-between the MTSI client in a terminal and the MGW. The CS side
of the MGW, i.e. in-between the MGW and the CS terminal, is out of scope of
this clause.
### 12.3.0 3G-324M
If 3G-324M is supported in the GERAN/UTRAN CS, then the inter-working can be
made as specified in clause 12.2.
### 12.3.1 Codecs for MTSI media gateways
#### 12.3.1.1 Speech
MTSI media gateways supporting speech communication between MTSI clients and
non-MTSI networks and terminals operating in the CS domain in GERAN and UTRAN
should support Tandem-Free Operation (TFO) according to 3GPP TS 28.062 [37],
and Transcoder-Free Operation (TrFO), see 3GPP TS 23.153 [38].
MTSI media gateways supporting speech communication and supporting TFO and/or
TrFO shall support:
\- AMR speech codec modes 12.2, 7.4, 5.9 and 4.75 [11], [12], [13], [14] and
source-controlled rate operation [15].
MTSI media gateways should also support the other codec types and
configurations as defined in Clause 5.4 in [16].
In the receiving direction, from the MTSI client in the terminal, the MTSI
media gateway shall be capable of restricting codec mode changes to be aligned
to every other frame border and shall be capable of restricting codec mode
changes to neighbouring codec modes within the negotiated codec mode set.
NOTE: This means that the MTSI client in a terminal will apply and accept mode
changes according to UMTS AMR2 [16]. An example of an SDP offer for how the
MTSI MGW can restrict AMR mode changes in the MTSI client in a terminal is
shown in Table A.2.1. An example of an SDP answer from the MTSI MGW for
restricting the mode changes in the MTSI client in a terminal is shown in
Table A.3.4a.
MTSI media gateways supporting wideband speech communication at 16 kHz
sampling frequency and supporting TFO and/or TrFO for wideband speech shall
support:
\- AMR wideband codec 12.65, 8.85 and 6.60 [17], ‎[18], ‎[19], [20] and source
controlled rate operation ‎[21].
MTSI media gateways supporting wideband speech communication at 16 kHz
sampling frequency should also support the other codec types and
configurations as defined in [16].
In the receiving direction, from the MTSI client in the terminal, the MTSI
media gateway shall be capable of restricting codec mode changes to be aligned
to every other frame border and shall be capable of restricting codec mode
changes to neighbouring codec modes within the negotiated codec mode set.
NOTE: This means that the MTSI client in a terminal will apply and accept mode
changes according to UMTS AMR-WB [16]. An example of an SDP offer for how the
MTSI MGW can restrict AMR and AMR-WB mode changes in the MTSI client in a
terminal is shown in Table A.2.4. An example of an SDP answer from the MTSI
MGW for restricting the mode changes in the MTSI client in a terminal is shown
in Table A.3.4.
MTSI clients supporting wideband speech communication shall also support
narrowband speech communications. When offering both wideband speech and
narrowband speech communication, wideband shall be listed as the first payload
type in the m line of the SDP offer (RFC 4566 [8]).
Requirements applicable to MTSI media gateways for DTMF events are described
in Annex G.
#### 12.3.1.2 Text
The CTM coding format defined in 3GPP TS 26.226 [52] is used for real time
text in CS calls. In order to arrange inter‑working, a transcoding function
between CTM and RFC 4103 is required in the MTSI media gateway. A buffer shall
be used for rate adaptation between receiving text from a real-time text
transmitter according to the present document and transmitting to a CTM
receiver. A gateway buffer of 2K characters is considered sufficient according
to clause 13.2.4 in EG 202 320 [51].
### 12.3.2 RTP payload formats for MTSI media gateways
#### 12.3.2.1 Speech
MTSI media gateways shall support the bandwidth-efficient payload format and
should support the octet-aligned payload format. When offering both payload
formats, the bandwidth-efficient payload format shall be listed before the
octet-aligned payload format in the preference order defined in the SDP.
The MTSI media gateway should use the SDP parameters defined in table 12.1 for
the session.
For all access technologies and for normal operating conditions, the MTSI
media gateway should encapsulate the number of non-redundant speech frames in
the RTP packets that corresponds to the ptime value received in SDP from the
other MTSI client, or if no ptime value has been received then according to
\"Recommended encapsulation\" defined in table 12.1. The MTSI media gateway
may encapsulate more non-redundant speech frames in the RTP packet but shall
not encapsulate more than 4 non-redundant speech frames in the RTP packets.
The MTSI media gateway may encapsulate any number of redundant speech frames
in an RTP packet but the length of an RTP packet, measured in ms, shall never
exceed the maxptime value.
Table 12.1: Recommended encapsulation parameters
+-------------+-------------+-------------+-------------+-------------+ | Access | Recommended | ptime | maxptime | maxptime | | technology | en | | **when |** when | | | capsulation | | redundancy | redundancy | | | (if no | | is not | is | | | ptime and | | supported**| supported** | | | no | | | | | | RTCP_AP | | | | | | P_REQ_AGG | | | | | | has been | | | | | | received) | | | | +-------------+-------------+-------------+-------------+-------------+ | Default | 1 | 20 | 80 | 240 | | | no | | | | | | n-redundant | | | | | | speech | | | | | | frame per | | | | | | RTP packet | | | | | | | | | | | | Max 4 or 12 | | | | | | speech | | | | | | frames in | | | | | | total | | | | | | depending | | | | | | on whether | | | | | | redundancy | | | | | | is | | | | | | supported | | | | | | but not | | | | | | more than a | | | | | | received | | | | | | maxptime | | | | | | value | | | | | | requires | | | | +-------------+-------------+-------------+-------------+-------------+ | HSPA | 1 | 20 | 80 | 240 | | | no | | | | | E-UTRAN | n-redundant | | | | | | speech | | | | | | frame per | | | | | | RTP packet | | | | | | | | | | | | Max 4 or 12 | | | | | | speech | | | | | | frames in | | | | | | total | | | | | | depending | | | | | | on whether | | | | | | redundancy | | | | | | is | | | | | | supported | | | | | | but not | | | | | | more than a | | | | | | received | | | | | | maxptime | | | | | | value | | | | | | requires | | | | +-------------+-------------+-------------+-------------+-------------+ | EGPRS | 2 | 40 | 80 | 240 | | | no | | | | | | n-redundant | | | | | | speech | | | | | | frames per | | | | | | RTP packet | | | | | | but not | | | | | | more than a | | | | | | received | | | | | | maxptime | | | | | | value | | | | | | requires | | | | | | | | | | | | Max 4 or 12 | | | | | | speech | | | | | | frames in | | | | | | total | | | | | | depending | | | | | | on whether | | | | | | redundancy | | | | | | is | | | | | | supported | | | | | | but not | | | | | | more than a | | | | | | received | | | | | | maxptime | | | | | | value | | | | | | requires | | | | +-------------+-------------+-------------+-------------+-------------+ | GIP | 1 to 4 | 20, 40, 60 | N/A | 240 | | | no | or 80 | | | | | n-redundant | | | | | | speech | | | | | | frames per | | | | | | RTP packet | | | | | | but not | | | | | | more than a | | | | | | received | | | | | | maxptime | | | | | | value | | | | | | requires | | | | | | | | | | | | Max 12 | | | | | | speech | | | | | | frames in | | | | | | total but | | | | | | not more | | | | | | than a | | | | | | received | | | | | | maxptime | | | | | | value | | | | | | requires | | | | +-------------+-------------+-------------+-------------+-------------+
When the access technology is not known to the MTSI media gateway, the default
encapsulation parameters defined in Table 12.1 shall be used.
The SDP offer shall include an RTP payload type where octet-align=0 is defined
or where octet-align is not specified and should include another RTP payload
type with octet-align=1. MTSI media gateways offering wide-band speech shall
offer these parameters and parameter settings also for the RTP payload types
used for wide-band speech.
MTSI media gateways should support redundancy according to clause 9.
NOTE: Support of transmitting redundancy may be especially useful in the case
an MTSI media gateway is aware of the used access technology and knows that
the Generic Access technology is used.
#### 12.3.2.2 Text
Both CTM according to TS 26.226 [52] and RFC 4103 make use of ITU-T
Recommendation T.140 presentation and character coding. Therefore inter-
working is a matter of payload packetization and CTM modulation/demodulation.
## 12.4 PSTN
### 12.4.1 3G-324M
If 3G-324M is supported in the PSTN, then the inter-working can be made as
specified in clause 12.2.
### 12.4.2 Text
PSTN text telephony inter-working with PS environments is described in ITU-T
Recommendation H.248.2 [50]and further elaborated in EG 202 320 [51].
Text telephony modem tones are sensitive to packet loss, jitter and echo
canceller behaviour. Therefore, conversion of modem based transmission of
real-time text is best done at the border of the PSTN. If PSTN text telephone
tones need to be carried audio coded in a PS network, considerations must be
taken to carry them reliably as for example specified in ITU-T Recommendations
V.151 [54] and V.152 [55].
When inter-working with PSTN text telephones, it must be considered that in
PSTN most text telephone communication methods do not allow simultaneous
speech and text transmission. An MTSI client in terminal indicating text
capability shall not automatically initiate text connection efforts on the
PSTN circuit. Instead, either a requirement for text support should be
required from the MTSI client in terminal, active transmission of text from
the MTSI client in terminal, or active transmission of text telephone tones
from the PSTN terminal. See clause 13 of EG 202 320 [51].
Note that the primary goal of real-time text support in MTSI is not to offer a
replica of PSTN text telephony functionality. On the contrary, real-time text
in MTSI is aiming at being a generally useful mainstream feature,
complementing the general usability of the Multimedia Telephony Service for
IMS.
## 12.5 GIP inter-working
### 12.5.1 Text
RFC 4103 [31] and T.140 are specified as default real-time text codec in SIP
telephony devices in RFC 4504 [53]. When GIP implements this codec, the media
stream contents are identical for the two environments. Packetization will
also in many cases be equal, while consideration must be taken to cope with
different levels of redundancy and possible use of different media security
and integrity measures.
### 12.5.2 Speech
See Clause 12.7.
## 12.6 TISPAN/NGN inter-working
### 12.6.1 Text
The codec and other considerations for real-time text described in the present
document apply also to TISPAN/NGN. There are thus no inter-working
considerations on the media level.
### 12.6.2 Speech
See Clause 12.7.
## 12.7 Inter-working with other IMS and non-IMS IP networks
### 12.7.1 General
IMS and MTSI services are required to support inter-working with similar
services operating on other IP networks, both IMS based and non-IMS based,
[2]. It is an operator option to provide transcoding when the end-to-end codec
negotiation fails to agree on a codec to be used for the session. The
requirements herein applies to MTSI MGWs when such transcoding is provided.
These requirements were designed for sessions carried with IP end-to-end,
possibly inter-connected through one or more other IP networks.
A main objective is to harmonize the requirements for this inter-working case
with the requirements for GERAN/UTRAN CS inter-working defined in Clause 12.3.
There is however one major difference as the MGW requirements in Clause 12.3
apply only to the PS side of the MTSI MGW, i.e. between the MTSI MGW and the
MTSI client in the terminal, while here there are requirements for the MTSI
MGW both towards the MTSI client in the terminal and towards the remote
network.
Most requirements included here apply only to the PS access towards the remote
network but there are also requirements that target both the local MTSI client
in terminal and the remote network or even only the local MTSI client.
### 12.7.2 Speech
#### 12.7.2.1 General
This clause defines how speech media should be handled in MTSI MGWs in inter-
working scenarios between an MTSI client in terminal operating within a 3GPP
IMS network and a non-3GPP IP network. This clause therefore define
requirements for what the MTSI MGW needs to support and how it should behave
during session setup and session modification. A few SDP examples are included
in Annex A.10.
#### 12.7.2.2 Speech codecs and formats
MTSI MGWs offering speech communication between an MTSI client in a terminal
and a client in another IP network through a Network-to-Network Interface
(NNI) shall support:
  * AMR speech codec modes 12.2, 7.4, 5.9 and 4.75 [11], [12], > [13], [14] and source-controlled rate operation [15], both > towards the local MTSI client in terminal and towards the remote > network;
  * G.711, both A-law and μ-law PCM, [77], towards the remote network.
and should support:
  * linear 16 bit PCM (L16) at 8 kHz sampling frequency, towards the > remote network.
When such MTSI MGWs also offer wideband speech communication they shall
support:
  * AMR wideband codec 12.65, 8.85 and 6.60 [17], ‎[18], ‎[19], > [20] and source controlled rate operation ‎[21] , both towards > the local MTSI client in terminal and towards the remote network;
and should support:
  * G.722 (SB-ADPCM) at 64 kbps, [78], towards the remote network; > and:
  * linear 16 bit PCM (L16) at 16 kHz sampling frequency, towards the > remote network.
If the remote network supports AMR for narrowband speech and/or AMR-WB for
wideband speech, then transcoding shall be avoided whenever possible. In this
case, the MTSI MGW should not be included in the RTP path. If the MTSI MGW is
included in the RTP path then it shall support forwarding the RTP payload
regardless of codec mode and packetization.
NOTE: An example of where transcoding may be required when AMR and/or AMR-WB
are supported by the remote network is when the remote terminal is limited to
modes that are not supported by the local MTSI client in terminal due to
operator configuration.
If the MTSI MGW is performing transcoding of AMR or AMR-WB then it shall be
capable of restricting mode changes, both mode change period and mode changes
to neighboring mode, if this is required by the remote network.
Requirements applicable to MTSI MGW for DTMF events are described in Annex G.
#### 12.7.2.3 Codec preference order for session negotiation
It is important to optimize the quality-bandwidth compromise, even though the
NNI uses a fixed IP network. For this reason, the following preference order
should be used by MTSI MGWs unless another preference order is defined in
bilateral agreements between the operators or configured otherwise by the
operator:
  * The best option is if a codec can be used end-to-end. For example, > using AMR or AMR-WB end-to-end is preferable over transcoding > through G.711 or G.722 respectively.
  * The second best solution is to use G.711 or G.722 as > inter-connection codecs, for narrow-band and wide-band speech > respectively, since these codecs offer a good quality while > keeping a reasonable bit rate.
  * The linear 16 bit PCM format should only be used as the last resort, > when none of the above solutions are possible.
If a wide-band speech session is possible, then fall-back to narrow-band
speech should be avoided whenever possible, unless another preference order is
indicated in the SDP.
NOTE: There may be circumstances, for example bit rate constraints, when a
fall-back to narrow-band speech is acceptable since the alternative would be a
session setup failure.
#### 12.7.2.4 RTP profiles
MTSI MGWs offering speech communication over the NNI shall support the RTP/AVP
profile and should support the RTP/AVPF profile, [40]. If the RTP/AVPF profile
is supported then the SDP Capability Negotiation (SDPCapNeg) framework shall
also be supported, [69].
#### 12.7.2.5 RTP payload formats
The payload format to be used for AMR and AMR-WB encoded media is defined in
Clause 12.3.2.1. The MTSI MGW shall support the following payload SDP
parameters for AMR and AMR-WB: octet-align, mode-set, mode-change-period,
mode-change-capability, mode-change-neighbor, maxptime, ptime, channels and
max-red.
The payload format to be used for G.711 encoded media is defined in RFC 3551,
[10], for both μ-law (PCMU) and Α-law (PCMA).
The payload format to be used for G.722 encoded media is defined in RFC 3551,
[10].
NOTE: The sampling frequency for G.722 is 16 kHz but is set to 8000 Hz in SDP
since it was (erroneously) defined this way in the original version of the RTP
A/V profile, see [10].
The payload format to be used for linear 16 bit PCM is the L16 format defined
in RFC 3551, [10]. When this format is used for narrow-band speech then the
rate (sampling frequency) indicated on the a=rtpmap line shall be 8000. When
this format is used for wide-band speech then the rate (sampling frequency)
indicated on the a=rtpmap line shall be 16000.
#### 12.7.2.6 Packetization
For the G.711, G.722 and linear 16 bit PCM formats, the frame length shall be
20 ms, i.e. 160 and 320 speech samples in each frame for narrow-band and wide-
band speech respectively.
MTSI MGWs offering speech communication over the NNI shall support
encapsulating up to 4 non-redundant speech frames into the RTP packets.
MTSI MGWs may support application layer redundancy. If redundancy is supported
then the MTSI MGW should support encapsulating up to 8 redundant speech frames
in the RTP packets. Thereby, an RTP packet may contain up to 12 frames, up to
4 non-redundant and up to 8 redundant frames.
The MGW should use the packetization schemes indicated by the ptime value in
the SDP offer and answer. If no ptime value is present in the SDP then the MGW
should encapsulate 1 frame per packet or the packetization used by the end-
point clients.
The MTSI MGW should preserve the packetization used by the end-point clients.
The packet size can become quite large for some combinations of formats and
packetization. If the packet size exceeds the Maximum Transfer Unit (MTU) of
the network then the MTSI MGW should encapsulate fewer frames per packet.
NOTE: It is an implementation consideration to determine the MTU of the
network. RFC 4821 [79] describes one method that can be used to discover the
path MTU.
When the MTSI MGW does not perform any transcoding then it shall be
transparent to the packetization schemes used by the end-point clients.
#### 12.7.2.7 RTCP usage and adaptation
The RTP implementation shall include an RTCP implementation.
MTSI MGWs offering speech should support AVPF (RFC 4585 [40]) configured to
operate in early mode. When allocating RTCP bandwidth, it is recommended to
allocate RTCP bandwidth and set the values for the \"b=RR:\" and the \"b=RS:\"
parameters such that a good compromise between the RTCP reporting needs for
the application and bandwidth utilization is achieved, see also SDP examples
in Annex A.10. The value of \"trr-int\" should be set to zero or not
transmitted at all (in which case the default \"trr‑int\" value of zero will
be assumed) when Reduced-Size RTCP (see clause 7.3.5) is not used.
For speech sessions, between the MTSI client in terminal and the MTSI MGW, it
is beneficial to keep the size of RTCP packets as small as possible in order
to reduce the potential disruption of RTCP onto the RTP stream in bandwidth-
limited channels. RTCP packet sizes can be minimized by using Reduced-Size
RTCP packets or using the parts of RTCP compound packets (according to RFC
3550 [9]) which are required by the application.
The MTSI MGW shall be capable of adapting the session to handle possible
congestion. For AMR and AMR-WB encoded media, the MTSI MGW shall support the
adaptation signalling method using RTCP APP packets as defined in clause 10.2,
both towards the MTSI client in terminal and towards the remote network. As
the codec in the remote network may or may not support the RTCP APP signalling
method, the MTSI MGW shall also be capable of using the inband CMR in the AMR
payload. The MTSI MGW shall be capable of detecting whether the remote network
is capable of using the RTCP APP signalling method. If this method is not
supported then the MTSI MGW shall be capable of moving the AMR rate control
signalling (CMR) from RTCP APP packets received, from the MTSI client in
terminal, to the inband CMR in the payload that is sent to the remote network.
When receiving inband CMR in the payload from the remote network, the MTSI MGW
does not need to move the adaptation signalling to RTCP APP packets before
sending it to the MTSI client in terminal.
For PCM, G.722 and linear 16 bit PCM encoded media, the MTSI MGW shall support
RFC 3550 for signalling the experienced quality using RTCP Sender Reports and
Receiver Reports.
For a given RTP based media stream to/from the MTSI client in terminal, the
MTSI MGW shall transmit RTCP packets from and receive RTCP packets to the same
port number.
For a given RTP based media stream to/from the remote network, the MTSI MGW
shall transmit RTCP packets from and receive RTCP packets on the same port
number, not necessarily the same port number as used to/from the MTSI client
in terminal.
This facilitates inter-working with fixed/broadband access. However, the MTSI
MGW may, based on configuration or local policy, accept RTCP packets that are
not received from the same remote port where RTCP packets are sent by either
the MTSI client in terminal or the remote network.
#### 12.7.2.8 RTP usage
For AMR and AMR-WB encoded media, the MTSI MGW shall follow the same
requirements when inter-working with other IP network as when inter-working
with GERAN/UTRAN CS, see clause 12.3.2.1.
For a given RTP based media stream to/from the MTSI client in terminal, the
MTSI MGW shall transmit RTP packets from and receive RTP packets to the same
port number.
For a given RTP based media stream to/from the remote network, the MTSI MGW
shall transmit RTP packets from and receive RTP packets on the same port
number, not necessarily the same port number as used to/from the MTSI client
in terminal.
This facilitates inter-working with fixed/broadband access. However, the MTSI
MGW may, based on configuration or local policy, accept RTP packets that are
not received from the same remote port where RTP packets are sent by either
the MTSI client in terminal or the remote network.
#### 12.7.2.9 Session setup and session modification
The MTSI MGW is a "middle-man" between the MTSI client in terminal inside the
3GPP IMS network and a non-3GPP IP network.
The MTSI MGW shall be capable of dynamically adding and dropping speech media
during the session.
The MTSI MGW may use the original SDP offer received from the MTSI client in
terminal when creating an SDP offer that is to be sent outbound to the remote
network.
If the MTSI MGW adds codecs to the SDP offer then it shall follow the
recommendations of Clause 12.7.2.3 when creating the outbound SDP offer and
when selecting which codec to include in the outbound SDP answer.
If the MTSI MGW generates an SDP offer based on the offer received from the
MTSI client in terminal, it should maintain the ptime and maxptime values as
indicated by the MTSI client in terminal. If the MTSI MGW generates an SDP
offer without using the SDP offer from the MTSI client in terminal then it
should define the ptime and maxptime values in accordance in Clause 12.7.2.6,
i.e. the preferred values for ptime and maxptime are 20 and 80 respectively.
If the MTSI MGW does not support AVPF (nor SDPCapNeg) then it shall not
include the corresponding lines in the SDP offer that is sent to the remote
network.
# 13 Void
# 13a Media types, codecs and formats used for MSRP transport
## 13a.1 General
The IMS messaging service is described in TS 26.141 [59]. The description of
IMS messaging in clauses 1-6 of 3GPP TS 26.141 [59] is applicable for MSRP-
transported media in MTSI. The MSRP transport itself is described in 3GPP TS
24.247 [82].
All statements in TS 26.141 regarding IMS messaging are valid for MSRP
transported media in MTSI including the status of the statement (shall,
should, may).
Any differences between IMS messaging in 3GPP TS 26.141 [59] and MSRP
transported media in MTSI are described in clause 13a.2.
## 13a.2 Difference relative to 3GPP TS 26.141
### 13a.2.1 Video
**For MSRP transported Media in MTSI, clause 5.3 in 3GPP TS 26.141 [59] is
void and instead the following shall be used.**
If an MSRP client supports video, ITU-T Recommendation H.263 profile 0 Level
45 decoder [22] shall be supported. In addition, an MSRP client should
support:
\- H.263 Profile 3 Level 45 decoder [22];
\- MPEG-4 Visual Simple Profile Level 3 decoder [23] with the following
constraints:
\- Number of Visual Objects supported shall be limited to 1.
\- The maximum frame rate shall be 30 frames per second.
\- The maximum f_code shall be 2.
\- The intra_dc_vlc_threshold shall be 0.
\- The maximum horizontal luminance pixel resolution shall be 352 pels/line.
\- The maximum vertical luminance pixel resolution shall be 288 pels/VOP.
\- If AC prediction is used, the following restriction applies: QP value shall
not be changed within a VOP (or within a video packet if video packets are
used in a VOP). If AC prediction is not used, there are no restrictions to
changing QP value.
\- H.264 (AVC) Baseline Profile Level 1.1 decoder [24] with
constraint_set1_flag=1.1 and without requirements on output timing conformance
(Annex C of [24]).
The video buffer model given in Annex G of document [60] should be supported
if H.263 or MPEG-4 Visual is supported. It shall not be used with H.264 (AVC).
NOTE: ITU-T Recommendation H.263 profile 0 has been mandated to ensure that
video-enabled MSRP clients support a minimum baseline video capability. Both
H.263 and MPEG-4 Visual decoders can decode an H.263 profile 0 bitstream. It
is strongly recommended, though, that an H.263 profile 0 bitstream is
transported and stored as H.263 and not as MPEG-4 Visual (short header), as
MPEG-4 Visual is not mandated by MTSI.
# 14 Supplementary services
## 14.1 General
In this section media layer behaviour is specified for relevant supplementary
services. The supplementary services included in MTSI are described in 3GPP TS
24.173 [57]. The requirements on the codec support and the data transport are
identical to those listed in clauses 5.2 and 7. These requirements are listed
here due to the fact that there might be other media‑influencing nodes in MTSI
whose behaviour is not explicitly covered by other parts of the present
document.
The recommended behaviour described in the following sections is valid for
MTSI clients, i.e. all session IP end-points; terminals, MTSI media gateways
and other 3GPP network nodes acting as IP endpoints in MTSI sessions.
## 14.2 Media formats and transport
Any implementation of a supplementary service which affects media or media
handling, e.g. such as media creation, media rendering and media manipulation,
shall meet the same requirements as a MTSI client in terminal regarding codec
support and codec usage. Where applicable,, speech codecs shall be supported
according to clause 5.2.1, video according to clause 5.2.2 and text according
to clause 5.2.3.
Similarly, the configuration and the transport of the media in any
implementation of a supplementary service which affects media or media
handling shall be done according to clause 7.
## 14.3 Media handling in hold procedures
Whenever a supplementary service includes a hold procedure according to RFC
3264 [58], e.g. when using the HOLD supplementary service, the media flow is
changed in terms of the session flow attribute (e.g. changing the session
attribute \"sendrecv\" into \"sendonly\" or \"recvonly\" or \"inactive\" and
then back again). When this occurs, any involved media-originating or media-
terminating node should take measures to ensure that the transitions between
the different media flow states in the session occur with minimal impact on
the media quality.
When a full-duplex session has put the media flow on hold (see section 8.4 in
RFC 3264 [58]), the media flow has been changed into a unidirectional flow
through changing the session attribute into either \"sendonly\" or
\"recvonly\". When resuming the session, it is restored to full duplex by
changing the flow attributes back into \"sendrecv\" from \"sendonly\" and
\"recvonly\". In this case, the encoder and decoder states in the MTSI clients
may not be aligned and a state mismatch could occur. This would result in
media quality degradation. Therefore, the following actions are recommended
whenever the media session is not being put on hold anymore and the session is
restored to full duplex:
\- for speech media, the speech decoders should be reset;
\- for video media, the video encoders should start the updated session with a
full infra refresh even if the previously allocated encoders are still active
and no infra refresh is scheduled to be sent.
# 15 Network preference management object
The MTSI client in the terminal may use the OMA-DM solution specified in this
clause for enhancing the SDP negotiation and PDP context activation process.
If a MTSI client in the terminal uses this feature, it is mandatory for the
MTSI client in the terminal to implement the Management Object (MO) as
described in this clause.
The 3GPP MTSINP (MTSI Network Preference) MO defined in this clause may be
used to manage the QoS profile settings which express the network preference
for the MTSI client in the terminal. The MO covers parameters that the MTSI
client in the terminal could make use of in SDP negotiation and PDP context
activation process. If a MTSI client in the terminal supports the feature, the
usage of the MO includes:
1\. During SDP negotiation process, MTSI client in the terminal should start
SDP negotiation based on the MO parameters.
2\. During PDP context activation process, MTSI client in the terminal should
start QoS negotiation based on the MO parameters.
The following parameters in MTSI should be included in the Management Object
(MO):
Speech codec (AMR, AMR-WB) and bearer QoS parameters
Video codec (H.263, MP4, H.264) and bearer QoS parameters
Real Time text bearer QoS parameters
Indication of the priority when there are more than one alternative for a
media type is included. Version numbering is included for possible extending
of MO.
The Management Object Identifier shall be: urn:oma:mo:ext-3gpp-mtsinp:1.0.
Protocol compatibility: The MO is compatible with OMA Device Management
protocol specifications, version 1.2 and upwards, and is defined using the OMA
DM Device Description Framework as described in the Enabler Release Definition
OMA-ERELD _DM-V1_2[67].
The following nodes and leaf objects in figure 15.1 shall be contained under
the 3GPP_MTSINP node if a MTSI client in the terminal support the feature
described in this clause (information of DDF for this MO is given in Annex H):
{width="5.997222222222222in" height="7.070833333333334in"}
Figure 15.1: MTSI network preference management object tree
## Node: /_\ _ {#node-x .list-paragraph}
This interior node specifies the unique object id of a MTSI network
preferences management object. The purpose of this interior node is to group
together the parameters of a single object.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
The following interior nodes shall be contained if the MTSI client in the
terminal supports the "MTSI network preferences Management Object".
## /_\ _/Speech {#xspeech .list-paragraph}
The Speech node is the starting point of the speech codec definitions (if any
speech codec are available)
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Speech/\ {#xspeechx .list-paragraph}
This interior node is used to allow a reference to a list of speech codec
objects.
\- Occurrence: OneOrMore
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Speech/\/Priority {#xspeechxpriority .list-paragraph}
This leaf represents the priority of the codec. Lower value means higher
priority and the codec with highest priority is the preferred codec in the
network. The value is used in the terminal for client initiated QoS handling.
The priority use a 16 bit unsigned integer.
\- Occurrence: One
\- Format: int
\- Minimum Access Types: Get
\- Values: Zero or higher
## /_\ _/Speech/\/Codec {#xspeechxcodec .list-paragraph}
This leaf gives the codec name/reference. This leaf is preferable pre-
configured by the device.
\- Occurrence: One
\- Format: chr
\- Minimum Access Types: Get,
\- Values: "AMR", "AMR-WB".
The value "AMR" refers to the AMR speech codec as defined in 3GPP. The value
"AMR-WB" refers to the AMR-WB speech codec as defined in 3GPP.
## /_\ _/Speech/\/Bandwidth {#xspeechxbandwidth .list-paragraph}
This leaf gives the preferred speech codec bandwidth by the network for the
bearer set-up. It provides the value for "b=AS" line for audio part used in
the end-to-end SDP negotiation process. The value is represented by a 16 bit
unsigned integer and represents the bit rate in kbit/sec.
\- Occurrence: One
\- Format: int
\- Minimum Access Types: Get
\- Values: positive integer
## /_\ _/Speech/\/ModeSet {#xspeechxmodeset .list-paragraph}
This node specifies the list of mode set used by the speech codec (AMR) and
this value is only used when network want to limit the mode set to a limited
set of value. The value is a string such as "0, 2, 4, 7" which means only mode
set (0,2,4,7) is preferred by network.
\- Occurrence: One
\- Format: chr
\- Minimum Access Types: Get
## /_\ _/Speech/\/ConRef {#xspeechxconref .list-paragraph}
This node specifies a reference to QoS parameters Management Object. The
interior node's leaf nodes specify the network preferred QoS parameters as
defined in 3GPP TS 24.008 and they should be used in the bearer request when
client initiated QoS happen. Implementation specific MO may be referenced.
\- Occurrence: One
\- Format: chr
\- Minimum Access Types: Get
## /_\ _/Speech/\/Ext {#xspeechxext .list-paragraph}
The Ext is an interior node where the vendor specific information can be
placed (vendor meaning application vendor, device vendor etc.). Usually the
vendor extension is identified by vendor specific name under the ext node. The
tree structure under the vendor identified is not defined and can therefore
include one or more un-standardized sub-trees.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Video {#xvideo .list-paragraph}
The Video node is the starting point of the video codec definitions (if any
video codec are available)
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Video/\ {#xvideox .list-paragraph}
This interior node is used to allow a reference to a list of video codec
objects.
\- Occurrence: OneOrMore
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Video/\/Priority {#xvideoxpriority .list-paragraph}
This leaf represents the priority of the codec. Lower value means higher
priority and the codec with highest priority is the preferred codec in the
network. The value is used in the terminal for client initiated QoS handling.
The priority use a 16 bit unsigned integer.
\- Occurrence: One
\- Format: int
\- Minimum Access Types: Get
\- Values: Zero or higher
## /_\ _/Video/\/Codec {#xvideoxcodec .list-paragraph}
This leaf gives the codec name/reference. This leaf is preferable pre-
configured by the device.
\- Occurrence: One
\- Format: chr
\- Minimum Access Types: Get,
\- Values: "H.263", "MPEG4", "H.264".
The value "H.263" refers to the H.263 video codec defined in ITU. The value
"MPEG4" refers to the MPEG4 video codec as defined in MPEG. The value "H.264"
refers to the H.264 codec as defined by MPEG and ITU. The usage of the codecs
(profiles, levels etc) is described in the document TS 26.114 Chapter 5.5.2.
## /_\ _/Video/\/Bandwidth {#xvideoxbandwidth .list-paragraph}
This leaf gives the preferred video codec bandwidth by the network for the
bearer set-up. It provides the value for "b=AS" line for video part used in
the end-to-end SDP negotiation process. The value is represented by a 16 bit
unsigned integer and represents the bit rate in kbit/sec.
\- Occurrence: One
\- Format: int
\- Minimum Access Types: Get
\- Values: positive integer
## /_\ _/Video/\/ConRef {#xvideoxconref .list-paragraph}
This node specifies a reference to QoS parameters Management Object. The
interior node's leaf nodes specify the network preferred QoS parameters as
defined in 3GPP TS 24.008 and they should be used in the bearer request when
client initiated QoS happen. Implementation specific MO may be referenced.
\- Occurrence: One
\- Format: chr
\- Minimum Access Types: Get
## /_\ _/Video/\/Ext {#xvideoxext .list-paragraph}
The Ext is an interior node where the vendor specific information can be
placed (vendor meaning application vendor, device vendor etc.). Usually the
vendor extension is identified by vendor specific name under the ext node. The
tree structure under the vendor identified is not defined and can therefore
include one or more un-standardized sub-trees.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Text {#xtext .list-paragraph}
The Text node is the starting point of the real time text codec definitions
(if the real time text codec is available). There is only one real time text
codec defined in release 7 and the sub-tree thus looks different from the
speech and video sub-tree.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Text/\ {#xtextx .list-paragraph}
This interior node is used to allow a reference to the real time text codec
objects.
\- Occurrence: one
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Text/\/Bandwidth {#xtextxbandwidth .list-paragraph}
This leaf gives the preferred text bandwidth by the network for the bearer
set-up. It provides the value for "b=AS" line for text part used in the end-
to-end SDP negotiation process. The value is represented by a 16 bit unsigned
integer and represents the bit rate in kbit/sec.
\- Occurrence: One
\- Format: int
\- Minimum Access Types: Get
\- Values: positive integer
## /_\ _/Text/\/ConRef {#xtextxconref .list-paragraph}
This node specifies a reference to QoS parameters Management Object. The
interior node's leaf nodes specify the network preferred QoS parameters as
defined in 3GPP TS 24.008 and they should be used in the bearer request when
client initiated QoS happen. Implementation specific MO may be referenced.
\- Occurrence: One
\- Format: chr
\- Minimum Access Types: Get
## /_\ _/Text/\/Ext {#xtextxext .list-paragraph}
The Ext is an interior node where the vendor specific information can be
placed (vendor meaning application vendor, device vendor etc.). Usually the
vendor extension is identified by vendor specific name under the ext node. The
tree structure under the vendor identified is not defined and can therefore
include one or more un-standardized sub-trees.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Ext {#xext .list-paragraph}
The Ext is an interior node where the vendor specific information can be
placed (vendor meaning application vendor, device vendor etc.). Usually the
vendor extension is identified by vendor specific name under the ext node. The
tree structure under the vendor identified is not defined and can therefore
include one or more un-standardized sub-trees.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
# 16 Quality of Experience
## 16.1 General
The MTSI Quality of Experience (QoE) metrics feature is optional for an MTSI
client in a terminal and shall not disturb the MTSI service. Non-terminal MTSI
clients (such as gateways) should not implement MTSI QoE reporting. An MTSI
client that supports the QoE metrics feature shall support OMA-DM. The OMA-DM
configuration server can configure the activation/deactivation and gathering
of QoE metrics in the MTSI client. An MTSI client supporting the feature shall
perform the quality measurements in accordance to the measurement definitions,
aggregate them into client QoE metrics and report the metrics to the QoE
server using the HTTP transport protocol. The MTSI client may send QoE metrics
reports to a receiving QoE server during the session and at the end of the
session. The way how the QoE metrics are processed and made available is out
of the scope of this specification.
## 16.2 Metrics Definition
An MTSI client supporting the QoE metrics feature shall support the reporting
of the metrics in this clause. The metrics are valid for speech, video and
text media, and are calculated for each measurement resolution interval
\"Measure-Resolution\" (sub-clause 16.3.2). They are reported to the server
according to the measurement reporting interval \"Sending-Rate\" (sub-clause
16.3.2) and after the end of the session (sub-clause 16.4).
### 16.2.1 Corruption duration metric
Corruption duration, M, is the time period from the NPT time of the last good
frame (since the NPT time for the first corrupted frame cannot always be
determined) before the corruption, to the NPT time of the first subsequent
good frame. A corrupted frame may either be an entirely lost frame, or a media
frame that has quality degradation and the decoded frame is not the same as in
error-free decoding.
A good frame is a completely received frame:
\- where all parts of the image are guaranteed to contain the correct content;
or
\- that is a refresh frame, that is, does not reference any previously decoded
frames; or
\- which only references previously decoded good frames
Completely received means that all the bits are received and no bit error has
occurred.
Corruption duration, M, in milliseconds can be calculated as below:
a) M can be derived by the client using the codec layer, in which case the
codec layer signals the decoding of a good frame to the client. A good frame
could also be derived by error tracking methods, but decoding quality
evaluation methods shall not be used.
b) Alternatively, the corruption is considered as ended after N milliseconds
with consecutively completely received frames, or when a refresh frame has
been completely received, whichever comes first..\ \ The optional
configuration parameter N can be set to define the average characteristics of
the codec. If N has not been configured it shall default to the length of one
measurement interval for video media, and to one frame duration for non-video
media.
The syntax for the metrics \"Corruption_Duration\" is as defined in sub-clause
16.3.2.
The N parameter is specified in milliseconds and is used with the
\"Corruption_Duration\" parameter in the \"3GPP-QoE-Metrics\" definition. The
value of N may be set by the server. The syntax for N to be included in the
\"att-measure-spec\" (sub-clause 16.3.2) is as follows:
\- N = \"N\" \"=\" 1*DIGIT
All the occurred corruption durations within each resolution period are summed
and stored in the vector _TotalCorruptionDuration_. The unit of this metrics
is expressed in milliseconds. Within each resolution period the number of
individual corruption events are summed up and stored in the vector
_NumberOfCorruptionEvents._ These two vectors are reported by the MTSI client
as part of the reception report (sub-clause 16.4).
The parameter _CorruptionAlternative_ indicates how the metric has been
calculated, and shall be sent by the client via reception reporting (sub-
clause 16.3.2) as \"a\", or \"b\".
### 16.2.2 Successive loss of RTP packets
The metric \"Successive_Loss\" indicates the number of RTP packets lost in
succession per media channel.
The syntax for the metrics \"Successive_Loss\" is as defined in sub-clause
16.3.2.
All the number of successively lost RTP packets are summed up within each
measurement resolution period of the stream and stored in the vector
_TotalNumberofSuccessivePacketLoss_. The unit of this metric is expressed as
an integer equal to or larger than 0. The number of individual successive
packet loss events within each measurement resolution period are summed up and
stored in the vector _NumberOfSuccessiveLossEvents. The number of received
packets are also summed up within each measurement resolution period and
stored in the vector NumberOfReceivedPackets._ These three vectors are
reported by the MTSI client as part of the QoE report (sub-clause 16.4)
### 16.2.3 Frame rate
Frame rate indicates the playback frame rate. The playback frame rate is equal
to the number of frames displayed during the measurement resolution period
divided by the time duration, in seconds, of the measurement resolution
period.
The syntax for the metric \"Frame_Rate\" is defined in sub-clause 16.3.2.
For the Metrics-Name \"Frame_Rate\", the value field indicates the frame rate
value. This metric is expressed in frames per second, and can be a fractional
value. The frame rates for each resolution period are stored in the vector
_FrameRate_ and reported by the MTSI client as part of the QoE report (sub-
clause 16.4).
### 16.2.4 Jitter duration
Jitter happens when the absolute difference between the actual playback time
and the expected playback time is larger than _JitterThreshold_ milliseconds.
The expected time of a frame is equal to the actual playback time of the last
played frame plus the difference between the NPT time of the frame and the NPT
time of the last played frame.
The syntax for the metric \"Jitter_Duration\" is defined in sub-clause 16.3.2.
The optional configuration parameter JT can be set to control the amount of
allowed jitter. If the parameter has not been set, it defaults to 100 ms. _The
JT parameter is specified in ms and_ is used with the \"Jitter_Duration\"
parameter in the \"3GPP-QoE-Metrics\" definition. The value of JT may be set
by the server. The syntax for _JT_ to be included in the \"att-measure-spec\"
(sub-clause 16.3.2) is as follows:
\- JT = \"JT\" \"=\" 1*DIGIT
All the jitter durations are summed up within each measurement resolution
period and stored in the vector _TotalJitterDuration_. The unit of this metric
is expressed in seconds, and can be a fractional value. The number of
individual events within the measurement resolution period are summed up and
stored in the vector _NumberOfJitterEvents._ These two vectors are reported by
the MTSI client as part of the QoE report (sub-clause 16.4).
### 16.2.4 Sync loss duration
Sync loss happens when the absolute difference between value A and value B is
larger than _SyncThreshold_ milliseconds. Value A represents the difference
between the playback time of the last played frame of the video stream and the
playback time of the last played frame of the speech/audio stream. Value B
represents the difference between the expected playback time of the last
played frame of the video stream and the expected playback time of the last
played frame of the speech/audio stream.
The syntax for the metric \"SyncLoss_Duration\" is defined in sub-clause
16.3.2.
The optional configuration parameter ST can be set to control the amount of
allowed sync mismatch. If the parameter has not been set, it defaults to 100
ms. _The ST parameter is specified in ms and_ is used with the
\"SyncLoss_Duration\" parameter in the \"3GPP-QoE-Metrics\" definition. The
value of ST may be set by the server. The syntax for _ST_ to be included in
the \"att-measure-spec\" (sub-clause 16.3.2) is as follows:
\- ST = \"ST\" \"=\" 1*DIGIT
All the sync loss durations are summed up within each measurement resolution
period and stored in the vector _TotalSyncLossDuration_. The unit of this
metric is expressed in seconds, and can be a fractional value. The number of
individual events within the measurement resolution period are summed up and
stored in the vector _NumberOfSyncLossEvents._ These two vectors are reported
by the MTSI client as part of the QoE report (sub-clause 16.4).
### 16.2.5 Round-trip time
The round-trip time (RTT) consists of the RTP-level round-trip time, plus the
additional two-way delay (RTP level->loudspeaker->microphone->RTP level) due
to buffering and other processing in each client.
The syntax for the metric \"Round_Trip_Time\" is defined in sub-clause 16.3.2.
The last RTCP round-trip time value estimated during each measurement
resolution period shall be stored in the vector _NetworkRTT_. The unit of this
metrics is expressed in milliseconds.
The two-way additional internal client delay valid at the end of each
measurement resolution period shall be stored in the vector _InternalRTT_. The
unit of this metrics is expressed in milliseconds.
The two vectors are reported by the MTSI client as part of the QoE report
(sub-clause 16.4).
Note that if the RTP and the RTCP packets for a media are not sent in the same
RTP stream the estimated media round-trip time might be unreliable.
### 16.2.6 Average codec bitrate
The average codec bitrate is the bitrate used for coding "active" media
information during the measurement resolution period.
For speech media "active" information is defined by frames containing speech,
i.e. silence frames (SID-frames) and DTX periods are excluded from the
calculation. Thus for speech media the average codec bitrate can be calculated
as the number of speech bits received for "active" frames , divided by the
total time, in seconds, covered by these frames. The total time covered is
calculated as the number of "active" frames times the length of each speech
frame.
For non-speech media the average codec bitrate is the total number of RTP
payload bits received, divided by the length of the measurement resolution
period.
The syntax for the metric \"Average_Codec_Bitrate\" is defined in sub-clause
16.3.2.
The average codec bitrate value for each measurement resolution period shall
be stored in the vector _AverageCodecBitrate_. The unit of this metrics is
expressed in kbit/s and can be a fractional value. The vector is reported by
the MTSI client as part of the QoE report (sub-clause 16.4).
### 16.2.7 Codec information
The codec information metrics contain details of the media codec used during
the measurement resolution period. If the codec information is changed during
the measurement resolution period, the codec information valid when each
measurement resolution period ends shall be reported. The unit of this metric
is a string value. No \"white space\" characters are allowed in the string
values, and shall be removed if necessary.
For speech media the codec information contains the speech codec type,
represented as in an SDP offer, for instance \"AMR-WB/1600/1\".
For video media, the codec information contains the video codec type,
represented as in an SDP offer, for instance "H263-2000/90000". Furthermore,
the video profile and level used, as well as the image size used shall be
reported. For instance \"profile=0;level=45\" for the profile and level
information and "176x144" for the image size. In some cases the profile and
level is reported together, for instance \"profile-level-id=42e00a\". Note
that the image size reported for each measurement resolution period shall be
the one actually used, not the maximum size allowed by the SDP negotiation.
For real-time text media, the codec information contains the text encoding,
represented as in an SDP offer, for instance \"t140/1000/1\".
The syntax for the metric \"Codec_Info\", "Codec_ProfileLevel" and
"Codec_ImageSize" are defined in sub-clause 16.3.2.
The codec info, profile / level and codec image size value for each
measurement resolution period shall be stored in the vectors C _odecInfo_ ,
_CodecProfileLevel_ and _CodecImageSize_ respectively. If the metric values in
these vectors for a measurement resolution period are unchanged from the
previous values in the respective vector, it is allowed to put the value "="
in the vector to indicate this. The C _odecInfo, CodecProfileLevel_ and
_CodecImageSize_ vectors are reported by the MTSI client as part of the QoE
report (sub-clause 16.4).
## 16.3 Metric Configuration
An MTSI client supporting the QoE metrics feature shall use the OMA-DM
solution specified in this clause for configuration of QoE metrics and their
activation. If an MTSI client uses this feature, it is mandatory for the MTSI
client to implement the Management Object (MO) as described in this clause.
The 3GPP MTSIQOE (MTSI QoE metrics) MO defined in this clause may be used to
configure the QoE metrics and reporting settings.
The metrics specified in the MO may be derived by the MTSI client. Version
numbering is included for possible extension of the MO.
The Management Object Identifier shall be: urn:oma:mo:ext-3gpp-mtsiqoe:1.0.
Protocol compatibility: The MO is compatible with OMA Device Management
protocol specifications, version 1.2 and upwards, and is defined using the OMA
DM Device Description Framework as described in the Enabler Release Definition
OMA-ERELD _DM-V1_2 [67].
### 16.3.1 QoE metrics reporting management object
The following nodes and leaf objects in figure 16.1 shall be contained under
the 3GPP_MTSIQOE node if an MTSI client supports the feature described in this
clause (information of DDF for this MO is given in Annex I):
{width="2.790277777777778in" height="4.5625in"}
Figure 16.1: MTSI QoE metrics management object tree
## Node: /_\ _
This interior node specifies the unique object id of a MTSI QoE metrics
management object. The purpose of this interior node is to group together the
parameters of a single object.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
The following interior nodes shall be contained if the MTSI client supports
the "MTSI QoE metrics Management Object".
## /_\ _/Enabled
## This leaf indicates if QoE reporting is requested by the provider.
\- Occurrence: One
\- Format: bool
\- Minimum Access Types: Get
## /_\ _/Servers
This leaf contains a space-separated list of URL of servers to which the QoE
reports can be transmitted. It is URI addresses, e.g.
http://qoeserver.operator.com. In case of multiple servers, the MTSI client
randomly selects one of the servers from the list, with uniform distribution.
\- Occurrence: One
\- Format: chr
\- Minimum Access Types: Get
\- Values: URI of the servers to receive the QoE report.
## /\/APN {#xapn .list-paragraph}
This leaf contains the Access Point Name that should be used for establishing
the PDP context on which the QoE metric reports will be transmitted. This may
be used to ensure that no costs are charged for QoE metrics reporting.
\- Occurrence: ZeroOrOne
\- Format: chr
\- Minimum Access Types: Get
\- Values: the Access Point Name
## /_\ _/Format
This leaf specifies the format of the report and if compression (Gzip XML)
[71] is used.
\- Occurrence: ZeroOrOne
\- Format: chr
\- Minimum Access Types: Get
\- Values: "XML", "GZIPXML".
## /_\ _/Rules {#xrules .list-paragraph}
This leaf provides in textual format the rules used to decide whether metrics
are to be reported to the QoE metrics report server. The syntax and semantics
of this leaf are defined in clause 16.3.3.
\- Occurrence: ZeroOrOne
\- Format: chr
\- Minimum Access Types: Get
\- Values: See clause 16.3.3.
## /_\ _/Ext
The Ext node is an interior node where the vendor specific information can be
placed (vendor includes application vendor, device vendor etc.). Usually the
vendor extension is identified by vendor specific name under the ext node. The
tree structure under the vendor identified is not defined and can therefore
include one or more un-standardized sub-trees.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Speech
The Speech node is the starting point of the speech media level QoE metrics
definitions.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Speech/Metrics
This leaf provides in textual format the QoE metrics that need to be reported,
the measurement frequency, the reporting interval and the reporting range. The
syntax and semantics of this leaf are defined in clause 16.3.2.
\- Occurrence: ZeroOrOne
\- Format: chr
\- Minimum Access Types: Get
\- Values: see clause 16.3.2.
## /_\ _/Speech/Ext
The Ext node is an interior node where the vendor specific information can be
placed (vendor meaning application vendor, device vendor etc.). Usually the
vendor extension is identified by vendor specific name under the ext node. The
tree structure under the vendor identified is not defined and can therefore
include one or more un-standardized sub-trees.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Video
The Video node is the starting point of the video media level QoE metrics
definitions.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Video/Metrics
This leaf provides in textual format the QoE metrics that need to be reported,
the measurement frequency, the reporting interval and the reporting range. The
syntax and semantics of this leaf are defined in clause 16.3.2.
\- Occurrence: ZeroOrOne
\- Format: chr
\- Access Types: Get
\- Values: see clause 16.3.2.
## /_\ _/Video/Ext
The Ext is an interior node where the vendor specific information can be
placed (vendor meaning application vendor, device vendor etc.). Usually the
vendor extension is identified by vendor specific name under the Ext node. The
tree structure under the vendor identified is not defined and can therefore
include one or more un-standardized sub-trees.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
## /_\ _/Text
The Text node is the starting point of the real-time text media level QoE
metrics definitions.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
\- Values: see clause 16.3.2.
## /_\ _/Text/Metrics
This leaf provides in textual format the QoE metrics that need to be reported,
the measurement frequency, the reporting interval and the reporting range. The
syntax and semantics of this leaf are defined in clause 16.3.2.
\- Occurrence: ZeroOrOne
\- Format: chr
\- Minimum Access Types: Get
\- Values: see clause 16.3.2.
## /_\ _/Text/Ext
The Ext is an interior node where the vendor specific information can be
placed (vendor meaning application vendor, device vendor etc.). Usually the
vendor extension is identified by vendor specific name under the ext node. The
tree structure under the vendor identified is not defined and can therefore
include one or more un-standardized sub-trees.
\- Occurrence: ZeroOrOne
\- Format: node
\- Minimum Access Types: Get
### 16.3.2 QoE metric reporting configuration
The syntax of the text contained in the Metrics leaf is similar to the "3GPP-
QoE-Metrics" attribute syntax specified in 3GPP TS 26.234 [60] and 3GPP TS
26.346 [74]:
\- QoE-Metrics = \"3GPP-QoE-Metrics:\" att-measure-spec *(\",\" att-measure-
spec)) CRLF
\- att-measure-spec = Metrics \";\" Sending-rate [\";\" Measure-Range]\ [\";\"
Measure-Resolution] *([\";\" Parameter-Ext])
\- Metrics = \"metrics\" \"=\" \"{\"Metrics-Name *(\"\|\" Metrics-Name) \" }\"
\- Metrics-Name = 1*((0x21..0x2b) / (0x2d..0x3a) / (0x3c..0x7a) / 0x7e) ;VCHAR
except \";\", \",\", \"{\" or \"}\"
\- Sending-Rate = \"rate\" \"=\" 1*DIGIT / \"End\"
\- Measure-Resolution = \"resolution\" \"=\" 1*DIGIT ; in seconds
\- Measure-Range = \"range\" \":\" Ranges-Specifier
\- Parameter-Ext = (1*DIGIT [\".\" 1*DIGIT]) / (1*((0x21..0x2b) / (0x2d..0x3a)
/ (0x3c..0x7a) / 0x7c / 0x7e))
\- Ranges-Specifier = as defined in RFC 2326 [72].
This attribute is used to indicate which QoE metrics are supported, the
reporting interval, the measurement interval and reporting range.
The \"Metrics\" field contains the list of names that describes the
metrics/measurements that are required to be reported in a MTSI call, provided
that the MTSI client supports these measurements and the reporting rule
conditions are met (see clause 16.3.3). The names that are not included in the
\"Metrics\" field shall not be reported during the session.
The \"Sending-Rate\" shall be set, and it expresses the maximum time period in
seconds between two successive QoE reports. If the \"Sending-Rate\" value is
0, then the client shall decide the sending time of the reports depending on
the events occurred in the client. Values ≥ 1 indicate a precise reporting
interval. The shortest interval is one second and the longest interval is
undefined. The reporting interval can be different for different media, but it
is recommended to maintain a degree of synchronization in order to avoid extra
traffic in the uplink direction. The value \"End\" indicates that only one
report is sent at the end of the session.
The optional \"Measure-Resolution\" field, if used, shall define a time over
which each metrics value is calculated. The \"Measure-Resolution\" field
splits the session duration into a number of equally sized periods where each
period is of the length specified by the \"Measure-Resolution\" field. The
\"Measure-Resolution\" field is thus defining the time before the calculation
of a QoE parameter starts over. If the \"Measure-Resolution\" field is not
present, the metrics resolution shall cover the period specified by the
\"Measure-Range\" field. If the \"Measure-Range\" field is not present the
metrics resolution shall be the whole session duration.
The optional \"Measure-Range\" field, if used, shall define the time range in
the stream for which the QoE metrics will be reported. There shall be only one
range per measurement specification. The range format shall be any of the
formats allowed by the media. If the \"Measure-Range\" field is not present,
the metrics range shall be the whole call duration.
### 16.3.3 QoE reporting rule definition
This clause defines the syntax and semantics of a set of rules which are used
to reduce the amount of reporting to the QoE metrics report server. The syntax
of the metrics reporting rules is defined below:
> \- QoE-Rule = \"3GPP-QoE-Rule\" \":\" rule-spec *(\",\" rule-spec)
>
> \- rule-spec = rule-name [\";\" parameters]
>
> \- rule-name = \"OnlyCallerReports\" / \"LimitSessionInterval\" /
> \"SamplePercentage\"
>
> \- parameters = parameter *(\";\" parameter)
>
> \- parameter = Param-Name [\"=\" Param-Value ]
\- Param-Name = 1*((0x21..0x2b) / (0x2d..0x3a) / (0x3c..0x7a) / 0x7e) ;VCHAR
except \";\", \",\", \"{\" or \"}\"
\- Param-Value = (1*DIGIT [\".\" 1*DIGIT]) / (1*((0x21..0x2b) / (0x2d..0x3a) /
(0x3c..0x7a) / 0x7c / 0x7e))
The semantics of the rules and the syntax of its parameters is defined below:
The _OnlyCallerReports_ rule is used to determine the metrics reporting
sources. When this rule is present, only the initiator of the call, i.e.,
caller, will report metrics to the QoE report server. When absent all parties
report metrics.
The _SamplePercentage_ rule can be used to set a percentage sample of calls
which should report reception. This can be useful for statistical data
analysis of large populations while increasing scalability due to reduced
total uplink signalling. The _sample_percentage parameter_ takes on a value
between 0 and 100, including the use of decimals. It is recommended that no
more than 3 digits follow a decimal point (e.g. 67.323 is sufficient
precision).
When the _SamplePercentage_ rule is not present or its _sample_percentage
parameter_ value is 100 each MTSI client shall send metric report(s). If the
_sample_percentage_ value is less than 100, the UE generates a random number
which is uniformly distributed in the range of 0 to 100. The UE sends the
reception report when the generated random number is of a lower value than the
_sample_percentage_ value.
The _LimitSessionInterval_ rule is used to limit the time interval between
consecutive calls that report metrics. The _min_interval_ parameter for this
rule indicates the minimum time distance between the start of two calls that
are allowed to report metrics. When this rule is absent there is no limitation
on the minimum time interval.
In case multiple rules are defined in the Management Object, the MTSI client
should only report metrics when all individual rules evaluate to true (i.e.
the rules are logically ANDed). In case no rules are present the MTSI client
should always report metrics (see also clause 16.4 for metrics reporting
procedures).
An example for a QoE metric reporting rule is shown below:
3GPP-QoE-Rule:OnlyCallerReports,SamplePercentage;sample_percentage=10.0,\
LimitSessionInterval;min_interval=300,
This example rule defines that only the caller shall report, and only for 10%
of the sessions, with the minimum time interval between the start times of two
consecutive calls that report metrics to be 5 minutes.
## 16.4 Metrics Reporting
When a session is started, the MTSI client must determine whether QoE
reporting is required for the session. If the MO parameter \"Enabled\" is set
to false, no QoE reporting shall be done. If the \"Enabled\" parameter is set
to true the optional MO \"Rule\" parameters are checked (sub-clause 16.3.3) to
define if QoE reporting shall be done.
Once the need for QoE reporting has been established, the client shall
continuously compute all specified metrics for each measurement interval
period, according to the \"Measure-Resolution\" parameter (sub-clause 16.3.2).
In order to bound the resources used by metrics reporting, the minimum values
for the Measure-Resolution and Sending-Rate are specified to be 5 seconds and
30 seconds respectively. The computed metrics are represented in a vector
format, adding an additional metric value to each metric vector after each new
measurement interval period.
Note that the calculated metrics shall only cover one measurement interval.
For instance, if the corruption duration extends longer than to the end of the
current measurement interval, only the portion which fits into the current
measurement interval shall be reported. The remaining portion of the
corruption duration shall be reported as belonging to the next measurement
interval.
The end of the session will normally not correspond to the end of a
measurement interval period, so the metrics for the last measurement interval
period will typically be calculated over a time shorter than the configured
measurement interval. Note, however, that these last metrics shall still be
added to the metrics vectors and reported to the server.
It is possible for the server to use the start and stop timestamps, together
with the knowledge of the configured measurement interval, to derive the
actual length of the last measurement interval period, but any specific action
or interpretation of these last shorter measurements is out of scope of this
specification.
The MTSI client shall send QoE report messages to the server in accordance
with the specified reporting interval \"Sending-Rate\" (sub-clause 16.3.2).
All stored metrics data shall then be sent to the server, and then deleted
from the metrics storage.
Note that if the reporting interval is not an integer multiple of the
measurement interval, only the measurement interval periods which have been
fully passed shall be included in the report. The ongoing not-passed
measurement interval period shall be included in the next report. The only
exception is at the end of the session, where also the last ongoing
measurement interval period shall be directly calculated and included in the
report.
The client shall send QoE reports using the HTTP (RFC 2616 [73]) POST request
carrying XML formatted metadata. If the optional \"APN\" parameter is defined
in the OMA managed object, that APN shall be used for establishing the PDP
context on which the QoE metric reports will be transmitted. The MTSI client
randomly selects one of the URIs from the MO \"Server\" parameter, with
uniform distribution.
Each QoE report is formatted in XML according the following XML schema (sub-
clause 16.4.1). An informative example of a single reception report XML object
is also given (sub-clause 16.4.2). The reports should be compressed using GZIP
only if the MO parameter \"Format\" specifies this.
Each QoE Metrics element has a set of attributes and any number of media level
QoE Metrics elements. All attributes are defined in sub-clause 16.4.1 and
correspond to the QoE metrics listed in sub-clause 16.2. Individual metrics
can be selected as described in sub-clause 16.3.2.
Except for the media level QoE metrics, the following parameters shall be
reported for each report:
\- The _callId_ attribute identifies the call identity of the SIP session.
\- The _clientId_ attribute is unique identifier for the receiver, e.g. an
MSISDN of the UE as defined in [80].
\- The _startTime_ and _stopTime_ attributes identifies the client NTP time
when the measurements included in the report were started and stopped. The
time is based on the local real-time clock in the client, and might not be
consistent with the true NTP time. However, assuming that the reporting is
done without any extra delay the server can use the _stopTime_ attribute to
correct the timestamps if necessary.
\- The _mediaId_ attribute shall be reported for each media level QoE report,
and identifies the port number for the media.
### 16.4.1 XML schema for QoE report message
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
### 16.4.2 Example XML for QoE report message
Below is one example of QoE report message, in this example the measurement
interval is 20 seconds, the reporting interval is 5 minutes, but the call ends
after 55 seconds.
\
\
\
\
\
\
\
###### ## Annex A (informative): Examples of SDP offers and answers
# A.0 General
Most SDP examples shown in this Annex show usage of the AVPF RTP profile and
SDPCapNeg even though these features are optional.
# A.1 SDP offers for speech sessions initiated by MTSI client in terminal
This Annex includes several SDP examples for session setup for speech. SDP
examples for sessions with speech and DTMF are shown in Annex G. These SDP
offer and answer examples are designed to highlight the respective area that
is being described and should therefore not be considered as complete SDP
offers and answers. See TS 24.229 [7] for a complete description of the SDPs.
Some of the SDP examples contain a=fmtp lines that are too long to meet the
column width constraints of this document and are therefore folded into
several lines using the backslash ("\") character. In a real SDP, long lines
would appear as one single line and not as such folded lines.
Some of the examples included in this Annex outline configurations that have
been optimized for HSPA. These configurations are equally applicable to
E-UTRAN access since the packetization recommendations for HSPA and E-UTRAN in
Clauses 7.4.2 and 7.5.2.1 for MTSI clients and Clause 12.3.2 for MTSI media
gateways are identical.
## A.1.1 HSPA or unknown access technology
When the access technology is unknown to the MTSI client in terminal, the
client uses the encapsulation parameters of default operation as defined in
clause 7.5.2.1.2. The SDP examples below apply to HSPA as well as the default
operation since the encapsulation parameters are the same.
### A.1.1.1 Only AMR-NB supported by MTSI client in terminal
In this example , the MTSI client in terminal wishes to establish an AMR
speech-only session with RTCP turned off. One RTP Payload Type (97) is defined
for the bandwidth-efficient payload format. In this case, the MTSI client in
terminal supports mode changes at any time, mode changes to any mode and mode
change restrictions.
Table A.1.1: SDP example
+-------------------------------------------------+ | SDP offer | +-------------------------------------------------+ | m=audio 49152 RTP/AVP 97 | | | | b=AS:29 | | | | b=RS:0 | | | | b=RR:0 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | +-------------------------------------------------+
**Comments:**
The UDP port number (49152) and the payload type numbers (97) are examples and
the offerer is free to select other numbers within the restrictions of the UDP
and RTP specifications. It is recommended to use the dynamic port numbers in
the 49152 to 65535 range. RTP should use even numbers for RTP media and the
next higher odd number for RTCP. It is however allowed to use any number
within the registered port range 1 024 to 49 151. The receiver must be capable
of using any combination of even and odd numbers for RTP and RTCP.
It is important that the MTSI client in terminal does not define any mode-set
because then the answerer is free to respond with any mode-set that it can
support. If the MTSI client in terminal would define mode-set to any value,
then the answer only has the option to either accept it or reject it. The
latter case might require several ping-pong between the MTSI clients before
they can reach an agreement on what mode set to use in the session. This would
increase the setup time significantly. This is also one important reason for
why the MTSI clients in terminals must support the complete codec mode set of
the AMR and AMR-WB codecs, because then a media gateway interfacing GERAN or
UTRAN can immediately define the mode-set that it supports on the GERAN or
UTRAN circuit switched access.
Since the MTSI client in terminal is required to support mode changes at any
frame border and also to any mode in the received media stream, it does not
set the mode-change-period and mode-change-neighbor parameters.
The mode-change-capability and max-red parameter are new in the updated AMR
payload format [28]. With mode-change-capability=2, the MTSI client in
terminal shows that it does support aligning mode changes every other frame
and the answerer then knows that requesting mode-change-period=2 in the SDP
answer will work properly. The max-red parameter indicates the maximum
interval between a non-redundant frame and a redundant frame. Note that the
maxptime and max-red parameters do not need to be synchronized.
With the combination of ptime:20 and maxptime:240, the MTSI client in terminal
shows that it desires to receive one speech frame per packet but can handle up
to 12 speech frames per packet. However, no more than 4 original speech frames
can be encapsulated in one packet.
A suitable SDP answer from another MTSI client in terminal is shown in Table
A.3.0.
### A.1.1.2 AMR and AMR-WB are supported by MTSI client in terminal
#### A.1.1.2.1 One-phase approach
The size of the SDP may become quite big, depending on how many configurations
the MTSI client in terminal supports for different media. Therefore, the
session setup may be divided into phases where the most desirable
configurations are offered in the first phase. If the first phase fails, then
the remaining configurations can be offered in a second phase.
In table A.1.2 an example is shown where a one-phase approach is used and
where the SDP includes both AMR and AMR-WB and both the bandwidth-efficient
and octet-aligned payload formats.
Table A.1.2: SDP example: one-phase approach
+-----------------------------------------------------------------+ | SDP offer | +-----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 99 100 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR-WB/16000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=rtpmap:99 AMR/8000/1 | | | | a=fmtp:99 mode-change-capability=2; max-red=220 | | | | a=rtpmap:100 AMR/8000/1 | | | | a=fmtp:100 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | +-----------------------------------------------------------------+
**Comments:**
It is easy to imagine that the SDP offer can become quite large if the client
supports many different configurations for one or several media. A solution to
this problem is shown in Clause A.1.1.2.2.
A few possible SDP answers are outlined in Tables A.3.1, A.3.1a, A.3.2, A.3.3
and A.3.4.
#### A.1.1.2.2 Two-phase approach
Tables A.1.3 and A.1.4 show the same configurations as in table A.1.2 but when
the SDP has been divided into 2 phases.
Table A.1.3: SDP example: 1^st^ phase SDP offer
+-------------------------------------------------+ | SDP offer | +-------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR/8000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | +-------------------------------------------------+
Table A.1.4: SDP example: 2^nd^ phase SDP offer
+----------------------------------------------------------------+ | SDP offer | +----------------------------------------------------------------+ | m=audio 49152 RTP/AVPF 97 98 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=rtpmap:98 AMR/8000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | +----------------------------------------------------------------+
**Comments:**
Many types of media and maybe even many different configurations for some or
all media types, may give quite large SIP messages. When constructing the
offer, the access type and the radio bearer(s) for the answerer are not yet
known. To maintain a reasonable setup time, a 2-phase approach may be useful
where the most desirable configurations are included in the 1^st^ phase and
the 2^nd^ phase is entered only if all payload types for one media type are
rejected.
There is however a drawback with the two-phase approach. If the 2^nd^ phase is
not entered, then a cell change that would require configurations from the
2^nd^ phase SDP is likely to give long interruption times, several seconds,
while the session parameters are re-negotiated.
The SDPCapNeg framework is only used in the 1^st^ SDP offer because when
generating the 2^nd^ SDP offer the profile is already agreed. In this example,
it is assumed that AVPF was accepted in the first round.
If the 1^st^ SDP offer, shown in Table A.1.3, is accepted by the answerer then
a few possible example SDP answers are shown in: Table A.3.1 if the answerer
is an MTSI client in terminal and supports AMR-WB; Table A.3.2 if the answerer
is an MTSI client in terminal but does not support AMR-WB; Table A.3.3 if the
answerer is an MTSI client in terminal, supports AMR-WB and is using EGPRS
access; Table A.3.4 if the answerer is a CS terminal, supports AMR-WB and an
MTSI MGW is therefore needed.
## A.1.2 EGPRS
In this example one RTP Payload Type (97) is defined for the bandwidth-
efficient payload format and another RTP Payload Type (98) is defined for the
octet-aligned payload format.
Table A.1.5: SDP example
+----------------------------------------------------------------+ | SDP offer | +----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=200 | | | | a=rtpmap:98 AMR/8000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=200; octet-align=1 | | | | a=ptime:40 | | | | a=maxptime:240 | +----------------------------------------------------------------+
**Comments:**
The only difference compared with the SDP offer for HSPA is ptime: 40. This
definition is used to optimize capacity by reducing the amount of overhead
that lower layers introduce. Defining ptime:20 will also work, but will be
less optimal. Thus, when performing a cell change from HSPA to EGPRS, it is
not an absolute necessity to update the session parameters immediately. It can
be done after a while, which would also reduce the amount of SIP signalling if
a MTSI client in terminal is switching frequently between HSPA and EGPRS or
some other access type.
It is recommended to set the max-red parameter to an integer multiple of the
ptime.
An example of a suitable SDP answer to this SDP offer is shown in Table
A.3.3a.
## A.1.3 Generic Access
In this example one RTP Payload Type (97) is defined for the bandwidth-
efficient payload format and another RTP Payload Type (98) is defined for the
octet-aligned payload format.
Table A.1.6: SDP example
+----------------------------------------------------------------+ | SDP offer | +----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=160 | | | | a=rtpmap:98 AMR/8000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=160; octet-align=1 | | | | a=ptime:80 | | | | a=maxptime:240 | +----------------------------------------------------------------+
**Comments:**
In this case the MTSI client in terminal has detected that the load on the
WLAN network is quite high and therefore ptime is set to 80. For other
operating conditions, it could set ptime to 20, 40 or 60. This parameter may
be updated during the session if the load of the WLAN network changes.
An example of a suitable SDP answer to this SDP offer is shown in Table
A.3.3b.
# A.2 SDP offers for speech sessions initiated by media gateway
## A.2.1 General
These examples show only SDP offers when the MTSI media gateway does not
support the same configurations as for the MTSI terminal in clause A.1. A
media gateway supporting the same configurations as for the examples in clause
A.1 should create the same SDP offers.
## A.2.2 MGW between GERAN UE and MTSI
This example shows the SDP offer when the call is initiated from GSM CS using
the AMR with the {12.2, 7.4, 5.9 and 4.75} codec mode set. In this example, it
is also assumed that only the bandwidth-efficient payload format is supported
and that it will not send any redundant speech frames.
Table A.2.1: SDP example
+-------------------------------------------------------------+ | SDP offer | +-------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-set=0,2,4,7; mode-change-period=2, \ | | | | mode-change-neighbor=1; mode-change-capability=2; max-red=0 | | | | a=ptime:20 | | | | a=maxptime:80 | +-------------------------------------------------------------+
**Comments:**
Since the MGW only supports a subset of the AMR codec modes, it needs to
indicate this in the SDP. The same applies for the mode change restrictions.
An example of a suitable SDP answer to this SDP offer is shown in Table A.3.5.
## A.2.3 MGW between legacy UTRAN UE and MTSI
This example shows the SDP offer when the call is initiated from legacy UTRAN
CS mobile that only the AMR 12.2 mode. In this example, it is also assumed
that only the bandwidth-efficient payload format is supported.
Table A.2.2: SDP example
+---------------------------------+ | SDP offer | +---------------------------------+ | m=audio 49152 RTP/AVP 97 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-set=7; max-red=0 | | | | a=ptime:20 | | | | a=maxptime:20 | +---------------------------------+
**Comments:**
Since only one mode is supported, the mode-change-period, mode-change-neighbor
and mode-change-capability parameters do not apply.
In this case it is advisable to not allow redundancy since the legacy UTRAN CS
mobile does not support any lower rate codec modes and then redundancy would
almost double the bitrate on the PS access side. Therefore, maxptime is set to
20 and max-red is set to 0.
If a mode-set with several codec modes was defined and if max-red and maxptime
are set to larger values than what Table A.1.8 shows, then redundancy is
possible on the PS access side but not together with TFO.
An example of a suitable SDP answer to this SDP offer is shown in Table A.3.6.
## A.2.4 MGW between CS UE and MTSI
This example shows the SDP offer when two mode sets are supported by the MGW.
Table A.2.3: SDP example
+--------------------------------------------------------------+ | SDP offer | +--------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-set=0,2,4,7; mode-change-period=2, \ | | | | mode-change-neighbor=1; mode-change-capability=2; max-red=20 | | | | a=rtpmap:98 AMR/8000/1 | | | | a=fmtp:98 mode-set=0,3,5,6; mode-change-period=2, \ | | | | mode-change-neighbor=1; mode-change-capability=2; max-red=20 | | | | a=ptime:20 | | | | a=maxptime:80 | +--------------------------------------------------------------+
**Comments:**
Redundancy up to 100 % is supported in this case since max-red is set to 20.
An example of a suitable SDP answer to this SDP offer is shown in Table A.3.6.
## A.2.5 MGW between GERAN UE and MTSI when wideband speech is supported
This example shows the SDP offer when the call is initiated from GSM CS when
AMR is supported with the {12.2, 7.4, 5.9 and 4.75} codec mode set and when
AMR-WB is supported with the {12.65, 8.85 and 6.60} mode set. In this example,
it is also assumed that only the bandwidth-efficient payload format is
supported and that the MTSI MGW will not send any redundant speech frames.
Table A.2.4: SDP example
+-------------------------------------------------------------+ | SDP offer | +-------------------------------------------------------------+ | m=audio 49152 RTP/AVP 98 97 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-set=0,2,4,7; mode-change-period=2, \ | | | | mode-change-neighbor=1; mode-change-capability=2; max-red=0 | | | | a=rtpmap:98 AMR-WB/16000/1 | | | | a=fmtp:98 mode-set=0,1,2; mode-change-period=2, \ | | | | mode-change-neighbor=1; mode-change-capability=2; max-red=0 | | | | a=ptime:20 | | | | a=maxptime:80 | +-------------------------------------------------------------+
**Comments:**
Since the MGW only supports a subset of the AMR codec modes and of the AMR-WB
codec modes, it needs to indicate this in the SDP. The same applies for the
mode change restrictions.
# A.3 SDP answers to SDP speech session offers
## A.3.1 General
This clause gives a few examples of possible SDP answers. The likelihood that
these SDP answers will be used may vary from case to case since the SDP answer
depends on circumstances outside the scope of this specification for example:
availability of resources, radio bearer assignment and policy control. It is
impossible to cover all the possible variants and hence these examples should
be regarded as just a few examples of many possible alternatives. They were
however selected because they span the range of possible SDP answers quite
well.
The SDP offers are included to clarify what is being answered.
## A.3.1a SDP answer from an MTSI client in terminal when only narrowband
speech was offered
These SDP offers and answer are likely when the offering MTSI client in
terminal (or other client) only supports narrowband speech (AMR) and wishes to
establish a speech-only session with RTCP turned off.
The SDP offer included in this example is identical to the SDP offer shown in
Table A.1.1.
Table A.3.0: SDP example
+-------------------------------------------------+ | **SDP offer** | +-------------------------------------------------+ | m=audio 49152 RTP/AVP 97 | | | | b=AS:29 | | | | b=RS:0 | | | | b=RR:0 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | +-------------------------------------------------+ | **SDP answer** | +-------------------------------------------------+ | m=audio 49152 RTP/AVPF 97 | | | | b=AS:29 | | | | b=RS:0 | | | | b=RR:0 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | +-------------------------------------------------+
**Comments:**
The SDP answer contains only one encoding format since 3GPP TS 24.229 [7]
requires that the answerer shall select exactly one codec for the answer.
Since both MTSI clients in terminals support the same configurations for
narrowband speech, it is likely that the selected configuration included in
the answer is identical to the configuration in the offer and that no mode-set
is defined by the terminating client.
The conclusion from this offer-answer procedure is that the offerer can only
send AMR encoded speech to the answerer using the bandwidth-efficient payload
type with RTP Payload Type 97, since this was the only configuration included
in the answer. The answerer sends AMR encoded speech to the offerer using the
bandwidth-efficient payload format, in this case RTP Payload Type 97.
Even though both MTSI clients in terminals support all codec modes, it is
desirable to mainly use the codec modes from the AMR {12.2, 7.4, 5.9 and 4.75}
mode set because the transport layer functions are optimized for these codec
modes.
For similar reasons it is also desirable to encapsulate only 1 speech frame
per packet, even though both MTSI clients in terminals support receiving
several frames per packet.
## A.3.2 SDP answer from an MTSI client in terminal
These SDP offers and answers are likely when both MTSI clients in terminals
support AMR and AMR-WB and also both the bandwidth-efficient and the octet-
aligned payload formats.
The SDP offer included in this example is identical to the SDP offer shown in
Table A.1.2, with the exception that the number of channels is omitted for
each of the codecs. This implies that the terminal is offering one channel for
each codec.
Table A.3.1: SDP example
+-----------------------------------------------------------------+ | SDP offer | +-----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 99 100 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR-WB/16000 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR-WB/16000 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=rtpmap:99 AMR/8000 | | | | a=fmtp:99 mode-change-capability=2; max-red=220 | | | | a=rtpmap:100 AMR/8000 | | | | a=fmtp:100 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | +-----------------------------------------------------------------+ | SDP answer if AVPF is accepted | +-----------------------------------------------------------------+ | m=audio 49152 RTP/AVPF 97 | | | | a=acfg:1 t=1 | | | | a=rtpmap:97 AMR-WB/16000 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | +-----------------------------------------------------------------+
**Comments:**
The SDP answer contains only one encoding format since 3GPP TS 24.229 [7]
requires that the answerer shall select exactly one codec for the answer.
Since both MTSI clients in terminals support the same configurations, it is
likely that the selected configuration included in the answer is identical to
the configuration in the offer and that no mode-set is defined by the
terminating client. The conclusion from this offer-answer process is that AMR-
WB will be used during the session with RTP Payload Type 97. The SDP answer
does not include the number of audio channels, implying that one channel has
been accepted.
Even though both MTSI clients in terminals support all codec modes, it is
desirable to mainly use the codec modes from the AMR-WB {12.65, 8.85 and 6.60}
mode set because the transport layer functions are optimized for these modes.
For similar reasons it is also desirable to encapsulate only 1 speech frame
per packet, even though both MTSI clients in terminals support receiving
several frames per packet.
In the above example it is assumed that AVPF will be accepted since the MTSI
client is required to support this RTP profile.
This SDP answer is also a possible answer to the SDP offer shown in Table
A.1.3.
## A.3.2a SDP answer from a non-MTSI UE with AVP
The MTSI client must be prepared to receive an SDP answer with AVP. This is
likely to occur for legacy clients that do not support AVPF or SDPCapNeg. The
example in Table A.3.1a shows a possible SDP answer with AVP to an SDP offer
as shown in Table A.1.2.
Table A.3.1a: SDP answer example with AVP
+-------------------------------------------------+ | **SDP answer with AVP** | +-------------------------------------------------+ | m=audio 49152 RTP/AVP 97 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | +-------------------------------------------------+
**Comments:**
A client that does not support SDPCapNeg would not understand the attributes
defined by the SDPCapNeg framework and would therefore ignore the lines with
'a=tcap' and 'a=pcfg'.
## A.3.2b SDP answer from an MTSI client supporting only AVP
An MTSI client supporting only AVP must be capable of receiving an SDP offer
with AVPF. The example in Table A.3.1b shows a possible SDP answer with AVP
and RTCP turned off. The SDP offer shown in Table A.3.1b is identical to the
SDP offer in Table A.1.2, with the exception that bandwidth information has
been added.
Table A.3.1b: SDP answer example with AVP
+-----------------------------------------------------------------+ | **SDP offer** | +-----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 99 100 | | | | b=AS:41 | | | | b=RS:0 | | | | b=RR:2000 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR-WB/16000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=rtpmap:99 AMR/8000/1 | | | | a=fmtp:99 mode-change-capability=2; max-red=220 | | | | a=rtpmap:100 AMR/8000/1 | | | | a=fmtp:100 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | +-----------------------------------------------------------------+ | **SDP answer with AVP** | +-----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 99 | | | | b=AS:29 | | | | b=RS:0 | | | | b=RR:0 | | | | a=rtpmap:99 AMR/8000/1 | | | | a=fmtp:99 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | +-----------------------------------------------------------------+
**Comments:**
When creating the SDP answer, RTP Payload Types 97 and 98 are removed since
AMR-WB is not supported. RTP Payload Type 100 is also removed since the
answerer is required to include only one encoding format in the SDP answer.
This also means that the media bandwidth attribute in the SDP answer is set to
29 kbps instead of 41 kbps as declared in the SDP offer. The MTSI client in
terminal also sets the RTCP bandwidth attributes to 0 to indicate that it will
not use RTCP in the session.
Even though both MTSI clients in terminals support all codec modes, it is
desirable to mainly use the codec modes from the AMR [12.2, 7.4, 5.9 and 4.75]
mode set because the transport layer functions are optimized for these modes.
## A.3.3 SDP answer from an MTSI client in terminal supporting only AMR
These SDP offers and answers are likely when the answering MTSI client in
terminal supports only AMR.
The SDP offer included in this example is identical to the SDP offer shown in
Table A.1.2.
Table A.3.2: SDP example
+-----------------------------------------------------------------+ | SDP offer | +-----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 99 100 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR-WB/16000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=rtpmap:99 AMR/8000/1 | | | | a=fmtp:99 mode-change-capability=2; max-red=220 | | | | a=rtpmap:100 AMR/8000/1 | | | | a=fmtp:100 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | +-----------------------------------------------------------------+ | SDP answer | +-----------------------------------------------------------------+ | m=audio 49152 RTP/AVPF 99 | | | | a=acfg:1 t=1 | | | | a=rtpmap:99 AMR/8000/1 | | | | a=fmtp:99 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | +-----------------------------------------------------------------+
**Comments:**
In the answer, RTP Payload Types 97 and 98 have been removed since AMR-WB is
not supported and RTP Payload Type 100 is removed since the answerer is
required to answer with only one encoding format.
Even though both MTSI clients in terminals support all codec modes, it is
desirable to mainly use the codec modes from the AMR [12.2, 7.4 5.9 and 4.75]
mode set because the transport layer functions are optimized for these modes.
This SDP answer is also a possible answer to the SDP offer shown in Table
A.1.3.
## A.3.4 SDP answer from an MTSI client in terminal using EGPRS access when
both AMR and AMR-WB are supported
In this case the answering MTSI client in terminal is using EGPRS access and
supports both narrowband and wideband speech, i.e. both AMR and AMR-WB.
The SDP offer is identical to the SDP offer shown in Table A.1.2.
Table A.3.3: SDP example
+-----------------------------------------------------------------+ | SDP offer | +-----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 99 100 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR-WB/16000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=rtpmap:99 AMR/8000/1 | | | | a=fmtp:99 mode-change-capability=2; max-red=220 | | | | a=rtpmap:100 AMR/8000/1 | | | | a=fmtp:100 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | +-----------------------------------------------------------------+ | SDP answer | +-----------------------------------------------------------------+ | m=audio 49152 RTP/AVPF 97 | | | | a=acfg:1 t=1 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=200 | | | | a=ptime:40 | | | | a=maxptime:240 | +-----------------------------------------------------------------+
**Comments:**
The answering MTSI client in terminal responds that it desires to receive 2
frames encapsulated in each packet. It will however send with 1 frame per
packet since the offering MTSI client in terminal desires to receive this
format. A future SIP UPDATE may change this so that 2 frames per packet are
used in both directions.
The answering MTSI client in terminal also responds with max-red defined to
200 ms since this is the closes multiple of the desired frame aggregation. It
should however be noted that it is not a requirement to define max-red to be a
multiple of ptime, but it is recommended to do so.
This SDP answer is also a possible answer to the SDP offer shown in Table
A.1.3.
## A.3.4a SDP answer from an MTSI client in terminal using EGPRS access when
only AMR is supported
In this case the answering MTSI client in terminal is using EGPRS access but
supports only narroband speech, i.e. only AMR.
The SDP offer is identical to the SDP offer shown in Table A.1.2 although the
SDP answer here would also work nicely as a response to the SDP offer shown in
Table A.1.5.
Table A.3.3a: SDP example
+-----------------------------------------------------------------+ | **SDP offer** | +-----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 99 100 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR-WB/16000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=rtpmap:99 AMR/8000/1 | | | | a=fmtp:99 mode-change-capability=2; max-red=220 | | | | a=rtpmap:100 AMR/8000/1 | | | | a=fmtp:100 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | +-----------------------------------------------------------------+ | **SDP answer** | +-----------------------------------------------------------------+ | m=audio 49152 RTP/AVPF 97 | | | | a=acfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=200 | | | | a=ptime:40 | | | | a=maxptime:240 | +-----------------------------------------------------------------+
**Comments:**
The answering MTSI client in terminal responds that it desires to receive 2
frames encapsulated in each packet. It will however send with 1 frame per
packet since the offering MTSI client in terminal desires to receive this
format. A future SIP UPDATE may change this so that 2 frames per packet are
used in both directions.
The answering MTSI client in terminal also responds with max-red defined to
200 ms since this is the closes multiple of the desired frame aggregation. It
should however be noted that it is not a requirement to define max-red to be a
multiple of ptime, but it is recommended to do so.
This SDP answer is also a suitable response to an SDP offer as shown in Table
A.1.5, even if the answering MTSI client in a terminal is using HSPA access.
This is because it is wise to harmonize the packetization, and the ptime in
the SDP answer, with the ptime in the SDP offer so that 2 frames per packet
will be used in both directions when one of the end-points is using EGPRS
access.
## A.3.4b SDP answer from an MTSI client in terminal using WLAN
In this example, the MTSI client in terminal is using a WLAN network.
The SDP offer shown here is identical to the SDP offer shown in Table A.1.1.
Table A.3.3b: SDP example
+----------------------------------------------------------------+ | **SDP offer** | +----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR/8000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | +----------------------------------------------------------------+ | **SDP answer** | +----------------------------------------------------------------+ | m=audio 49152 RTP/AVPF 97 | | | | a=acfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=160 | | | | a=ptime:80 | | | | a=maxptime:240 | +----------------------------------------------------------------+
**Comments:**
This SDP answer, with ptime=80, is suitable if the MTSI client in terminal can
measure the load in the WLAN network and has detected that the load is high.
If, on the other hand, the load is low then the MTSI client in terminal may
very well choose to use a lower value for the ptime attribute, for example 20
or 40.
This SDP answer is also suitable when the answering MTSI client in terminal is
using HSPA access but when the offerer is using WLAN and indicates ptime=80,
e.g. as shown in the SDP offer in Table A.1.6. In such a case, it is wise to
harmonize the ptime values in both directions to increase the likelihood that
several frames will be encapsulated in the RTP packets.
This SDP answer is also a possible answer to the SDP offer shown in Table
A.1.3.
## A.3.5 SDP answer from MTSI MGW supporting only one codec mode set for AMR
and AMR-WB each
In this case the MTSI MGW supports only one codec mode set for AMR, {12.2,
7.4, 5.9 and 4.75}, and one codec mode set for AMR-WB, {12.65, 8.85 and 6.60},
since the CS terminal only supports these mode sets. The MTSI MGW also only
supports the bandwidth-efficient payload format.
The SDP offer included in this example is identical to the SDP offer shown in
Table A.1.2.
Table A.3.4: SDP example
+----------------------------------------------------------------------+ | SDP offer (from MTSI client in terminal on HSPA) | +----------------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 99 100 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR-WB/16000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=rtpmap:99 AMR/8000/1 | | | | a=fmtp:99 mode-change-capability=2; max-red=220 | | | | a=rtpmap:100 AMR/8000/1 | | | | a=fmtp:100 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | +----------------------------------------------------------------------+ | SDP answer (from MTSI MGW) | +----------------------------------------------------------------------+ | m=audio 49152 RTP/AVPF 97 | | | | a=acfg:1 t=1 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-set=0,1,2; mode-change-period=2, | | mode-change-neighbor=1; \ | | | | mode-change-capability=2; max-red=0 | | | | a=ptime:20 | | | | a=maxptime:80 | +----------------------------------------------------------------------+
**Comments:**
The MTSI MGW is allowed to define the mode-set parameter since the MTSI client
in terminal did not define it. Thereby, it is possible to avoid several SDP
offers and answers.
The SDP answer contains only one encoding format since 3GPP TS 24.229 [7]
requires that the answerer shall select exactly one codec for the answer. In
this case, the CS terminal supports wideband speech and the MTSI MGW therefore
chooses to establish a wideband speech session.
Since the MTSI client in terminal has defined that it does support
restrictions in mode changes, the MTSI MGW can safely set the mode-change-
period and mode-change-neighbor parameters.
In this example, the MTSI MGW also does not support redundancy so it sets max-
red to zero.
This SDP answer is also a possible answer to the SDP offer shown in Table
A.1.3.
## A.3.5a SDP answer from MTSI MGW supporting only one codec mode set for AMR
In this case the MTSI MGW supports only one codec mode set for AMR, {12.2,
7.4, 5.9 and 4.75}, since the CS terminal supports only this mode set. The
MTSI MGW also only supports the bandwidth-efficient payload format.
Table A.3.4a: SDP example
+----------------------------------------------------------------------+ | SDP offer (from MTSI client in terminal on HSPA) | +----------------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 99 100 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR-WB/16000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=rtpmap:99 AMR/8000/1 | | | | a=fmtp:99 mode-change-capability=2; max-red=220 | | | | a=rtpmap:100 AMR/8000/1 | | | | a=fmtp:100 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | +----------------------------------------------------------------------+ | SDP answer (from MTSI MGW) | +----------------------------------------------------------------------+ | m=audio 49152 RTP/AVPF 97 | | | | a=acfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-set=0,2,4,7; mode-change-period=2, | | mode-change-neighbor=1; \ | | | | mode-change-capability=2; max-red=0 | | | | a=ptime:20 | | | | a=maxptime:80 | +----------------------------------------------------------------------+
**Comments:**
The MTSI MGW is allowed to define the mode-set parameter since the MTSI client
in terminal did not define it. Thereby, it is possible to avoid several SDP
offers and answers.
The SDP answer contains only one encoding format since 3GPP TS 24.229 [7]
requires that the answerer shall select exactly one codec for the answer. In
this case, the CS terminal does not supports wideband speech and the MTSI MGW
therefore selects to establish a narrowband speech session.
Since the MTSI client in terminal has defined that it does support
restrictions in mode changes, the MTSI MGW can safely set the mode-change-
period and mode-change-neighbor parameters.
In this example, the MTSI MGW also does not support redundancy so it sets max-
red to zero.
## A.3.6 SDP answer from MTSI client in terminal on HSPA for session initiated
from MTSI MGW interfacing UE on GERAN
This example shows the offers and answers for a session between a GERAN CS UE,
through a MTSI media gateway, and a MTSI client in terminal.
The SDP offer shown here is very similar to the SDP offer shown in Table
A.2.1. The only difference is that maxptime is set to 20.
Table A.3.5: SDP example
+-------------------------------------------------------------+ | SDP offer (from MTSI MGW) | +-------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-set=0,2,4,7; mode-change-period=2, \ | | | | mode-change-neighbor=1; mode-change-capability=2; max-red=0 | | | | a=ptime:20 | | | | a=maxptime:20 | +-------------------------------------------------------------+ | SDP answer (from MTSI client in terminal) | +-------------------------------------------------------------+ | m=audio 49152 RTP/AVPF 97 | | | | a=acfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-set=0,2,4,7; mode-change-period=2, \ | | | | mode-change-neighbor=1; mode-change-capability=2; max-red=0 | | | | a=ptime:20 | | | | a=maxptime:240 | +-------------------------------------------------------------+
**Comments:**
The MTSI media gateway offers only a restricted mode set sincethe CS terminal
does not support anything else. The MTSI client in terminal has to accept
this, if it wants to continue with the session setup.
This example also shows that the MTSI media gateway want to receive only 1
frame per packet. The maxptime parameter is therefore set to 20. With max-red
set to 0 the MTSI media gateway also shows that it will not send redundancy.
The MTSI terminal can support receiving up to 12 frames per packet. It
therefore set the maxptime parameter to 240.
The MTSI client in terminal detects that the MTSI media gateway does not want
to receive redundancy and therefore sets max-red to 0.
The SDP answer shown in this example is also a suitable answer to the SDP
offer shown in Table A.2.1. This SDP answer is also suitable for the SDP offer
shown Table A.2.3 since the transport layer functions are optimized for the
AMR {12.2, 7.4, 5.9 and 4.7} codec modes.
## A.3.7 SDP answer from MTSI client in terminal on HSPA for session initiated
from MTSI MGW interfacing legacy UE on UTRAN
This example shows the offers and answers for a session between a legacy UTRAN
CS UE that only supports AMR 12.2, through a MTSI media gateway, and a MTSI
client in terminal.
The SDP offer shown here is identical to the SDP offer shown in Table A.2.2.
Table A.3.6: SDP example
+-----------------------------------------------+ | **SDP offer (from MTSI MGW)** | +-----------------------------------------------+ | m=audio 49152 RTP/AVP 97 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-set=7; max-red=0 | | | | a=ptime:20 | | | | a=maxptime:20 | +-----------------------------------------------+ | **SDP answer (from MTSI client in terminal)** | +-----------------------------------------------+ | m=audio 49152 RTP/AVPF 97 | | | | a=acfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-set=7; max-red=0 | | | | a=ptime:20 | | | | a=maxptime:240 | +-----------------------------------------------+
**Comments:**
The MTSI media gateway offers only one codec mode set since the CS terminal
does not support anything else. The MTSI client in terminal has to accept
this, if it wants to continue with the session setup.
This example also shows that the MTSI media gateway want to receive only 1
frame per packet. The maxptime parameter is therefore set to 20. With max-red
set to 0 the MTSI media gateway also shows that it will not send redundancy.
The MTSI terminal can support receiving up to 12 frames per packet. It
therefore set the maxptime parameter to 240.
The MTSI client in terminal detects that the MTSI media gateway does not want
to receive redundancy and therefore sets max-red to 0.
# A.4 SDP offers and answers for video sessions
## A.4.0 General
Clause 6.2.1a2 defines two ways of negotiating the RTP profile to be used for
video sessions: either using SDPCapNeg [69] to negotiate the use of AVP or
AVPF in a single SDP offer; or by offering AVPF in a first SDP offer and then
sending a second SDP offer with AVP in case the terminating client did not
support AVPF. See Clause 6.2.1a.2 for more details on what can be expected
from the terminating client if it does not support AVPF for video.
Annex A.4.1 to A.4.4 show SDP examples for video when SDPCapNeg is used. Annex
A.4.5 show SDP examples when SDPCapNeg is not used.
## A.4.1 H.263 and MPEG-4 Visual
In the following example the SDP offer includes two video codec options:
Table A.4.1: Example SDP offer for H.263 and MPEG-4 Part 2 video
+-----------------------------------------------------------------+ | SDP offer | +-----------------------------------------------------------------+ | m=video 49154 RTP/AVP 99 100 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | b=AS:92 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 H263-2000/90000 | | | | a=fmtp:99 profile=0;level=45 | | | | a=rtpmap:100 MP4V-ES/90000 | | | | a=fmtp:100 profile-level-id=9; \ | | | | config=000001b009000001b509000001000000012000845d4c282c2090a28f | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +-----------------------------------------------------------------+
The two options in table 4.1 are associated with the RTP Payload Type numbers
99 and 100. The first offer includes ITU-T Recommendation H.263 Profile 0
(Baseline) at level 45, which supports bitrates up to 128 kbps and maximum
QCIF picture formats at 15 Hz. The second offer is MPEG-4 Visual (Part 2)
Simple profile at level 0b, which also supports bitrates up to 128 kbps and
QCIF at 15 Hz. Here profile-level-id=9 represents Simple profile at level 0b
and may be used for negotiation, whereas the config parameter gives the
configuration of the MPEG-4 Visual bit stream and is not used for negotiation.
The bandwidth (including IP, UDP and RTP overhead) for video is 92 kbps.
The negotiation of AVPF features is also shown. By setting 'trr-int' to 5000
the MTSI client indicates that the minimum interval between two regular RTCP
packets needs to be 5 seconds, [40]. The 'nack' and 'nack pli' parameters
indicate that the MTSI client supports NACK (Generic NACK) and PLI (Picture
Loss Indication) as defined by AVPF, [40]. The 'ccm fir' and 'ccm tmmbr'
parameters indicate that the MTSI client supports the FIR (Full Intra Request)
and TMMBR (Temporary Maximum Media Stream Bit Rate Request), [43]. The
wildcard ('*') indicates that at it is possible to use these features for all
RTP payload types for the video stream.
An example SDP answer to the offer is given below.
Annex A.6 describes the b=RS and b=RR bandwidth modifiers and the values
included here.
Table A.4.2: Example SDP answer
+------------------------------+ | SDP answer | +------------------------------+ | m=video 49154 RTP/AVPF 99 | | | | a=acfg:1 t=1 | | | | b=AS:57 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 H263-2000/90000 | | | | a=fmtp:99 profile=0;level=10 | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +------------------------------+
The answer includes only the H.263 codec. The responding MTSI client has
restricted the video bandwidth to 57 kbps and restricted the H.263 level to 10
which supports bitrates up to 64 kbps. The offerer must be able to comply with
a reduced bitrate and lower level since support for level 45 implies the
support of level 10 as well.
## A.4.2 H.264/AVC with H.263 as fallback
In this example the SDP offer includes H.264/AVC with H.263 as fallback.
Table A.4.3: Example SDP offer for H.264/AVC with H.263 as fallback
+------------------------------------------------------------+ | SDP offer | +------------------------------------------------------------+ | m=video 49154 RTP/AVP 99 100 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | b=AS:57 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 H264/90000 | | | | a=fmtp:99 packetization-mode=0;profile-level-id=42e00a; \ | | | | sprop-parameter-sets=J0LgCpWgsToB/UA=,KM4Gag== | | | | a=rtpmap:100 H263-2000/90000 | | | | a=fmtp:100 profile=0;level=10 | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +------------------------------------------------------------+
The first (preferred) offer is H.264/AVC. The packetization-mode parameter
indicates single NAL unit mode. This is the default mode and it is therefore
not necessary to include this parameter (see RFC 6184 [25]). The profile-
level-id parameter indicates Baseline profile at level 1, which supports
bitrates up to 64 kbps. It also indicates, by using so‑called constraint-set
flags, that the bit stream can be decoded by any Baseline, Main or Extended
profile decoder. The third parameter, sprop-parameter-sets, includes base-64
encoded sequence and picture parameter set NAL units that are referred by the
video bit stream. The sequence parameter set used here includes syntax that
specifies the number of re‑ordered frames to be zero so that latency can be
minimized. The second offer in the SDP is H.263 Profile 0 (Baseline) at level
10. It is used here as a fallback in case the other MTSI client does not
support H.264/AVC. The bandwidth (including IP, UDP and RTP overhead) for
video is restricted to 57 kbps.
An example SDP answer to the offer is given below.
Table A.4.4: Example SDP answer
+------------------------------------------------------------+ | SDP answer | +------------------------------------------------------------+ | m=video 49154 RTP/AVPF 99 | | | | a=acfg:1 t=1 | | | | b=AS:57 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 H264/90000 | | | | a=fmtp:99 packetization-mode=0;profile-level-id=42e00a; \ | | | | sprop-parameter-sets=J0LgCpWgsToB/UA=,KM4Gag== | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +------------------------------------------------------------+
The responding MTSI client is capable of using H.264/AVC and has therefore
removed the fallback offer H.263. As the offer already indicated the lowest
level (level 1) of H.264/AVC as well as the minimum constraint set, there is
no room for further negotiation of profiles and levels. However, the bandwidth
could be constrained further by reducing the bandwidth in b=AS.
## A.4.3 MPEG-4 Visual and H.263 with \"imageattr\" attribute
In the following example the SDP offer includes two video codec options.
Table A.4.5: Example SDP offer for MPEG-4 Part 2 and H.263 video
+----------------------------------------------------------------------+ | SDP offer | +----------------------------------------------------------------------+ | a=tcap:1 RTP/AVPF | | | | m=video 49154 RTP/AVP 99 | | | | a=pcfg:1 t=1 | | | | b=AS:213 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 MP4V-ES/90000 | | | | a=fmtp:99 profile-level-id=3; \ | | | | config=000001B003000001B509000001000000012000845D4C285020F0A21F | | | | a=imageattr:99 send [x=176,y=144] [x=224,y=176] [x=272,y=224] | | [x=320,y=240] recv [x=176,y=144] [x=224,y=176] | | [x=272,y=224,q=0.6] [x=320,y=240] | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | | | | m=video 49158 RTP/AVP 100 | | | | a=pcfg:1 t=1 | | | | b=AS:92 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:100 H263-2000/90000 | | | | a=fmtp:100 profile=0;level=45 | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +----------------------------------------------------------------------+
The two options in Table A.4.5 are associated with the RTP Payload Type
numbers 99 and 100. The first offer is MPEG-4 Visual (Part 2) Simple profile
at level 3, which also supports bitrates up to 384 kbps and CIF at 30 Hz. Here
profile-level-id=3 represents Simple profile at level 3 and may be used for
negotiation, whereas the config parameter gives the configuration of the
MPEG-4 Visual bit stream and is not used for negotiation. The config parameter
is constructed assuming the offered conditions and image size of 320x240,
which is the largest of all offered sizes for send direction. The offering
MTSI client offers four image sizes for both send and receive directions but
prefers 272x224 for receive direction, which might fit the available space on
its display better than the other image sizes. The bandwidth (including IP,
UDP and RTP overhead) for video is 213 kbps. The second offer includes ITU-T
Recommendation H.263 Profile 0 (Baseline) at level 45, which supports bitrates
up to 128 kbps and maximum QCIF picture formats at 15 Hz. The bandwidth
(including IP, UDP and RTP overhead) for video is 92 kbps.
An example SDP answer to the offer is given below.
Table A.4.6: Example SDP answer
+-------------------------------+ | SDP answer | +-------------------------------+ | m=video 0 RTP/AVP 99 | | | | m=video 49158 RTP/AVPF 100 | | | | a=acfg:1 t=1 | | | | b=AS:57 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:100 H263-2000/90000 | | | | a=fmtp:100 profile=0;level=10 | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +-------------------------------+
The port number in the first m-line is set to zero and all related a-lines are
omitted. The answer includes the H.263 codec. The responding MTSI client has
restricted the video bandwidth to 57 kbps and restricted the H.263 level to 10
which supports bitrates up to 64 kbps. The offerer must be able to comply with
a reduced bitrate and lower level since support for level 45 implies the
support of level 10 as well.
Table A.4.7: Example SDP answer
+----------------------------------------------------------------------+ | SDP answer | +----------------------------------------------------------------------+ | m=video 49154 RTP/AVPF 99 | | | | a=acfg:1 t=1 | | | | b=AS:107 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 MP4V-ES/90000 | | | | a=fmtp:99 profile-level-id=2; \ | | | | config=000001B002000001B509000001000000012000845D4C284420E0A21F | | | | a=imageattr:99 send [x=272,y=224] recv [x=320,y=240,q=0.6] | | [x=272,y=224] | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | | | | m=video 0 RTP/AVP 100 | +----------------------------------------------------------------------+
In this alternative answer, the port number in the second m-line is set to
zero and the answer includes the MPEG-4 codec. The responding MTSI client has
restricted the video bandwidth to 107 kbps and restricted the MPEG-4 level to
2 which supports bitrates up to 128 kbps. The restricted MPEG-4 level should
be high enough to enable the image sizes for both send and receive directions.
From the four image sizes offered, the responding MTSI client included 272x224
for send direction, which was preferred by the offering MTSI client. For
receive direction, the responding MTSI client included 320x240 as preferred
and 272x224 as fallback. The responding MTSI client has yet to confirm whether
the offering MTSI client can encode and decode video of different image sizes
simultaneously. The responding MTSI client sent new config parameter for the
video decoder of the offering MTSI client, which was constructed assuming the
restricted conditions and image size of 272x224.
Table A.4.8: Example Second SDP offer
+-----------------------------------------------------------------+ | Second SDP Offer | +-----------------------------------------------------------------+ | m=video 49154 RTP/AVP 99 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | b=AS:107 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 MP4V-ES/90000 | | | | a=fmtp:99 profile-level-id=2; \ | | | | config=000001B002000001B509000001000000012000845D4C285020F0A21F | | | | a=imageattr:99 send [x=320,y=240] recv [x=272,y=224] | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +-----------------------------------------------------------------+
In this second offer, the offering MTSI client accepted the restricted
conditions in the SDP answer in Table A.4.7 and included 320x240 for send
direction. The offering MTSI client sent new config parameter for the video
decoder of the responding MTSI client, which was constructed assuming the
restricted conditions and image size of 320x240.
## A.4.4 H.264/AVC with H.263 as fallback with \"imageattr\" attribute
In this example the SDP offer includes H.264/AVC with H.263 as fallback.
Table A.4.9: Example SDP offer for H.264/AVC with H.263 as fallback
+----------------------------------------------------------------------+ | SDP offer | +----------------------------------------------------------------------+ | a=tcap:1 RTP/AVPF | | | | m=video 49154 RTP/AVP 99 | | | | a=pcfg:1 t=1 | | | | b=AS:107 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 H264/90000 | | | | a=fmtp:99 packetization-mode=0;profile-level-id=42e011; \ | | | | sprop-parameter-sets=Z0LgC5ZUCg/I,aM4BrFSAa | | | | a=imageattr:99 send [x=176,y=144] [x=224,y=176] [x=272,y=224] | | [x=320,y=240] recv [x=176,y=144] [x=224,y=176] | | [x=272,y=224,q=0.6] [x=320,y=240] | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | | | | m=video 49158 RTP/AVP 100 | | | | a=pcfg:1 t=1 | | | | b=AS:57 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:100 H263-2000/90000 | | | | a=fmtp:100 profile=0;level=10 | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +----------------------------------------------------------------------+
The first (preferred) offer is H.264/AVC. The packetization-mode parameter
indicates single NAL unit mode. This is the default mode and it is therefore
not necessary to include this parameter (see RFC 6184 [25]). The profile-
level-id parameter indicates Baseline profile at level 1.1, which supports
bitrates up to 192 kbps. It also indicates, by using so‑called constraint-set
flags, that the bit stream can be decoded by any Baseline, Main or Extended
profile decoder. The bandwidth (including IP, UDP and RTP overhead) for video
is 107 kbps. The third parameter, sprop-parameter-sets, includes base-64
encoded sequence and picture parameter set NAL units that are referred by the
video bit stream. The sequence parameter set used here includes syntax that
specifies the number of re‑ordered frames to be zero so that latency can be
minimized. sprop-parameter-sets is constructed assuming the offered conditions
and image size of 320x240, which is the largest of all offered sizes for send
direction. The offering MTSI client offers four image sizes for both send and
receive directions but prefers 272x224 for receive direction, which might fit
the available space on its display better than the other image sizes. The
second offer in the SDP is H.263 Profile 0 (Baseline) at level 10. It is used
here as a fallback in case the other MTSI client does not support H.264/AVC.
The bandwidth (including IP, UDP and RTP overhead) for video is 57 kbps.
An example SDP answer to the offer is given below.
Table A.4.10: Example SDP answer
+------------------------------------------------------------+ | SDP answer | +------------------------------------------------------------+ | m=video 49154 RTP/AVPF 99 | | | | a=acfg:1 t=1 | | | | b=AS:107 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 H264/90000 | | | | a=fmtp:99 packetization-mode=0;profile-level-id=42e011; \ | | | | sprop-parameter-sets=Z0LgC5ZUCg/I,aM4BrFSAa | | | | a=imageattr:99 send [x=320,y=240] recv [x=320,y=240] | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | | | | m=video 0 RTP/AVP 100 | +------------------------------------------------------------+
The responding MTSI client is capable of using H.264/AVC and has therefore set
the port number in the second m-line to zero. The responding MTSI client
agreed with the offered bandwidth of 107 kbps and Baseline profile at level
1.1. From the four image sizes offered, the responding MTSI client included
320x240 for both send and receive directions. Although the offering MTSI
client preferred 272x224 for receive direction, the responding MTSI client
might not be able to offer 272x224 or not allow encoding and decoding of video
of different image sizes simultaneously. The responding MTSI client sent new
sprop-parameter-sets for the video decoder of the offering MTSI client, which
was constructed assuming the agreed conditions and image size of 320x240.
## A.4.5 H.264 and H.263 without SDPCapNeg
In these examples, the SDP offer includes both H.264 and H.263 where H.264 is
preferred. It is here assumed that the originating MTSI client in terminal
does not support SDPCapNeg, [69], for the AVP-AVPF negotiation. Instead, the
first SDP offer proposes to use AVPF. A second SDP offer for AVP is sent if
the terminating client does not accept using AVPF.
NOTE: These examples show an offer for H.264 Level 1.2, which is beyond the
recommended level in Clause 5.2.2. An SDP offer for Level 1.2 is also an
(implicit) offer for any of the lower levels (1, 1b and 1.1).
Table A.4.11 shows an example of an SDP offer for video sent by an MTSI client
at session setup, or when adding video to an ongoing speech-only session. Only
the video part is shown here.
Table A.4.11: Example first SDP offer for AVPF with H.264 and H.263 as
fallback
+------------------------------------------------------------+ | First SDP offer | +------------------------------------------------------------+ | m=video 49154 RTP/AVPF 99 100 | | | | b=AS:315 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 H264/90000 | | | | a=fmtp:99 packetization-mode=0;profile-level-id=42e00c; \ | | | | sprop-parameter-sets=J0LgDJWgUH6Af1A=,KM46gA== | | | | a=rtpmap:100 H263-2000/90000 | | | | a=fmtp:100 profile=0;level=10 | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +------------------------------------------------------------+
If the terminating client is an MTSI client in terminal, or some other client
that supports AVPF, then it will understand the offer for AVPF on the m= line.
In this case, it is likely that the terminating client responds with an SDP
answer as shown in Table A.4.12 below.
Table A.4.12: Example SDP answer for AVPF and H.264 when the SDP offer is
accepted
+------------------------------------------------------------+ | First SDP answer | +------------------------------------------------------------+ | m=video 49154 RTP/AVPF 99 | | | | b=AS:315 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 H264/90000 | | | | a=fmtp:99 packetization-mode=0;profile-level-id=42e00c; \ | | | | sprop-parameter-sets=J0LgDJWgUH6Af1A=,KM46gA== | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +------------------------------------------------------------+
If the terminating client does not support AVPF, and therefore does not
understand the m= line, then this can be indicated in a few different ways,
see Clause 6.2.1a.2.
When the originating MTSI client in terminal detects that the terminating
client did not support video with AVPF then the originating MTSI client in
terminal can send a second SDP offer proposing to use AVP for video, as shown
in Table A.4.13 below. The a=rtcp-fb attributes are not included in this
second SDP offer since RFC 4585 [40], defines that these attributes can only
be offered for sessions using AVPF.
Table A.4.13: Example second SDP offer for AVP with H.264 and H.263 as
fallback if the terminating client did not support AVPF
+------------------------------------------------------------+ | Second SDP offer | +------------------------------------------------------------+ | m=video 49154 RTP/AVP 99 100 | | | | b=AS:315 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 H264/90000 | | | | a=fmtp:99 packetization-mode=0;profile-level-id=42e00c; \ | | | | sprop-parameter-sets=J0LgDJWgUH6Af1A=,KM46gA== | | | | a=rtpmap:100 H263-2000/90000 | | | | a=fmtp:100 profile=0;level=10 | +------------------------------------------------------------+
It is expected that terminating client understands the m= line, since it
offers using AVP. If the remote client accepts using video with the H.264
codec and the defined configurations then an SDP answer as shown in Table
A.4.14 below can be expected.
Table A.4.14: Example SDP answer for AVP and H.264 if the second SDP offer is
accepted
+------------------------------------------------------------+ | SDP answer | +------------------------------------------------------------+ | m=video 49154 RTP/AVP 99 | | | | b=AS:315 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 H264/90000 | | | | a=fmtp:99 packetization-mode=0;profile-level-id=42e00c; \ | | | | sprop-parameter-sets=J0LgDJWgUH6Af1A=,KM46gA== | +------------------------------------------------------------+
# A.5 SDP offers for text
## A.5.1 T.140 with and without redundancy
An offer to use T.140 real-time text may be realized by using SDP according to
the following example in session setup or for addition of real-time text
during a session.
Table A.5.1: Example SDP offer for T.140 real-time text
+-----------------------------+ | SDP offer | +-----------------------------+ | m=text 53490 RTP/AVP 100 98 | | | | a=rtpmap:100 red/1000/1 | | | | a=rtpmap:98 t140/1000/1 | | | | a=fmtp:100 98/98/98 | +-----------------------------+
The example in table A.5.1 shows that RTP payload type 98 is used for sending
text without redundancy, whereas RTP payload type 100 is used for sending text
with 200 % redundancy.
# A.6 SDP example with bandwidth information
## A.6.0 General
This clause gives an example where the bandwidth modifiers have been included
in the SDP offer.
## A.6.1 SDP offer for AMR and MPEG4 using SDPCapNeg
This example shows an SDP offer for speech and video where SDPCapNeg is used
for the AVP-AVPF negotiation.
Table A.6.1: SDP example with bandwidth information
+-----------------------------------------------------------------+ | SDP offer | +-----------------------------------------------------------------+ | v=0 | | | | o=Example_SERVER 3413526809 0 IN IP4 server.example.com | | | | s=Example of using AS in MTSI | | | | c=IN IP4 aaa.bbb.ccc.ddd | | | | b=AS:78 | | | | t=0 0 | | | | a=tcap:1 RTP/AVPF | | | | m=audio 49152 RTP/AVP 97 98 | | | | a=pcfg:1 t=1 | | | | b=AS:30 | | | | b=RS:0 | | | | b=RR:4000 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR/8000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | | | | m=video 49154 RTP/AVP 99 | | | | a=pcfg:1 t=1 | | | | b=AS:48 | | | | b=RS:0 | | | | b=RR:5000 | | | | a=rtpmap:99 MP4V-ES/90000 | | | | a=fmtp:99 profile-level-id=8; \ | | | | config=000001B008000001B509000001010000012000884006682C2090A21F | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +-----------------------------------------------------------------+
The b=AS value indicates the media bandwidth, excluding RTCP, see RFC 3550,
section 6.2. On session level, the b=AS value indicates the sum of the media
bandwidths, excluding RTCP.
In this example, the bandwidth for RTCP is allocated such that it allows for
sending at least 2 compound RTCP packets per second when AVPF immediate mode
is used. The size of a RTCP Sender Report is estimated to 110 bytes, given
IPv4 and point-to-point sessions. The corresponding bandwidth then becomes
1760 bps which means that compound RTCP packets can be sent a little more
frequently than twice per second.
For speech sessions, the total RTCP bandwidth is set to 4000 bps (2000 bps for
each terminal) to give room for adaptation requests with APP packets according
to clause 10.2 in at least some of the RTCP messages. This adds 16 bytes to
the RTCP packet.
For video, the total RTCP bandwidth is set to 5000 bps (2500 bps for each
terminal) to give room for slightly more frequent reporting and also to give
room for codec-control messages (CCM) [43].
Setting the RS value to 0 does not mean that senders are not allowed to send
RTCP packets. It instead means that sending clients are treated in the same
way as receive-only clients, see also RFC 3556 [42].
The tcap attribute is in this example given on the session level to avoid
repeating it for each media type.
## A.6.2 SDP offer for AMR, H.264 and H.263 without SDPCapNeg
This example shows an initial SDP offer for speech and video. For speech, it
is offered to use AMR with the AVP profile. For video, it is offered to use
either H.264 or H.263 with AVPF.
NOTE: This example shows an offer for H.264 Level 1.2, which is beyond the
recommended level in Clause 5.2.2. An SDP offer for Level 1.2 is also an
(implicit) offer for any of the lower levels (1, 1b and 1.1).
Table A.6.2: Example of initial SDP offer with bandwidth information
+----------------------------------------------------------------+ | First SDP offer | +----------------------------------------------------------------+ | v=0 | | | | o=Example_SERVER 3413526809 0 IN IP4 server.example.com | | | | s=Example of using AS in MTSI | | | | c=IN IP4 aaa.bbb.ccc.ddd | | | | b=AS:345 | | | | t=0 0 | | | | m=audio 49152 RTP/AVP 97 98 | | | | b=AS:30 | | | | b=RS:0 | | | | b=RR:2000 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR/8000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | | | | m=video 49154 RTP/AVPF 99 100 | | | | b=AS:315 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 H264/90000 | | | | a=fmtp:99 packetization-mode=0;profile-level-id=42e00c; \ | | | | sprop-parameter-sets=J0LgDJWgUH6Af1A=,KM46gA== | | | | a=rtpmap:100 H263-2000/90000 | | | | a=fmtp:100 profile=0;level=10 | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +----------------------------------------------------------------+
If the terminating client did not support AVPF, see discussion in Clause
6.2.1a.2, then the originating MTSI client in terminal can send a second offer
with AVP for video as shown below. The a=rtcp-fb attributes are not included
in this second SDP offer since RFC 4585, [40] defines that these attributes
can only be offered for sessions using AVPF.
In this case, it is assumed that the remote client accepted speech using AMR
with the bandwidth-efficient payload format. It is therefore not necessary to
include an RTP payload type for AMR with the octet-aligned payload format in
the second SDP offer. The bandwidths offered for speech on media level and in
total on session level are therefore also changed.
Table A.6.3: Example of second SDP offer with bandwidth information
+------------------------------------------------------------+ | Second SDP offer | +------------------------------------------------------------+ | v=0 | | | | o=Example_SERVER 3413526809 0 IN IP4 server.example.com | | | | s=Example of using AS in MTSI | | | | c=IN IP4 aaa.bbb.ccc.ddd | | | | b=AS:344 | | | | t=0 0 | | | | m=audio 49152 RTP/AVP 97 | | | | b=AS:29 | | | | b=RS:0 | | | | b=RR:2000 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | | | | m=video 49154 RTP/AVP 99 100 | | | | b=AS:315 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 H264/90000 | | | | a=fmtp:99 packetization-mode=0;profile-level-id=42e00c; \ | | | | sprop-parameter-sets=J0LgDJWgUH6Af1A=,KM46gA== | | | | a=rtpmap:100 H263-2000/90000 | | | | a=fmtp:100 profile=0;level=10 | +------------------------------------------------------------+
# A.7 SDP examples with \"3gpp_sync_info\" attribute
## A.7.1 Synchronized streams
In the example given below in table A.7.1, streams identified with \"mid\"
attribute 1 and 2 are to be synchronized (default operation if the
\"3gpp_sync_info\" attribute is absent).
Table A.7.1: SDP example with requirement on synchronization
+------------------------------------------------------+ | SDP offer | +------------------------------------------------------+ | v=0 | | | | o=Laura 289083124 289083124 IN IP4 one.example.com | | | | s=Demo | | | | c=IN IP4 224.2.17.12/127 | | | | t=0 0 | | | | a=group:LS 1 2 | | | | a=3gpp_sync_info:Sync | | | | a=tcap:1 RTP/AVPF | | | | m=audio 30000 RTP/AVP 0 | | | | a=pcfg:1 t=1 | | | | a=mid:1 | | | | m=video 30002 RTP/AVP 31 | | | | a=pcfg:1 t=1 | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | | | | a=mid:2 | | | | m=audio 30004 RTP/AVP 2 | | | | a=pcfg:1 t=1 | | | | i=This media stream contains the Spanish translation | | | | a=mid:3 | +------------------------------------------------------+
## A.7.2 Nonsynchronized streams
The SDP in table A.7.2 gives an example of the usage of \"3gpp_sync_info\"
attribute at media level. In this example, the MPEG-4 video stream should not
be synchronized with any other media stream in the session.
Table A.7.2: SDP example with no requirement on synchronization
+---------------------------------------------------+ | SDP offer | +---------------------------------------------------+ | v=0 | | | | o=Laura 289084412 2890841235 IN IP4 123.124.125.1 | | | | s=Demo | | | | c=IN IP4 123.124.125.1 | | | | t=0 0 | | | | a=tcap:1 RTP/AVPF | | | | m=video 6000 RTP/AVP 98 | | | | a=pcfg:1 t=1 | | | | a=rtpmap:98 MP4V-ES/90000 | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | | | | a=3gpp_sync_info:No Sync | | | | m=video 5000 RTP/AVP 99 | | | | a=pcfg:1 t=1 | | | | a=rtpmap 99 H263-2000/90000 | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | | | | m=audio 7000 RTP/AVP 100 | | | | a=pcfg:1 t=1 | | | | a=rtpmap:100 AMR | +---------------------------------------------------+
# A.8 SDP example with QoS negotiation
This clause gives an example of an SDP interchange with negotiated QoS
parameters.
Table A.8.1: SDP example with QoS negotiation
+----------------------------------------------------------------------+ | SDP offer from MTSI client in terminal A to B in SIP INVITE message | +----------------------------------------------------------------------+ | v=0 | | | | o=Example_SERVER 3413526809 0 IN IP4 server.example.com | | | | s=Example of using AS to indicate negotiated QoS in MTSI | | | | c=IN IP4 aaa.bbb.ccc.ddd | | | | b=AS:78 | | | | t=0 0 | | | | a=tcap:1 RTP/AVPF | | | | m=audio 49152 RTP/AVP 97 98 | | | | a=pcfg:1 t=1 | | | | b=AS:30 | | | | b=RS:0 | | | | b=RR:2000 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR/8000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | | | | m=video 49154 RTP/AVP 99 | | | | a=pcfg:1 t=1 | | | | b=AS:48 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 MP4V-ES/90000 | | | | a=fmtp:99 profile-level-id=8; \ | | | | config=000001B008000001B509000001010000012000884006682C2090A21F | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +----------------------------------------------------------------------+ | SDP answer from UE B to A in 200/OK message | +----------------------------------------------------------------------+ | v=0 | | | | o=Example_SERVER2 34135268010 IN IP4 server2.example.com | | | | s=Example of using AS to indicate negotiated QoS in MTSI | | | | c=IN IP4 aaa.bbb.ccc.ddd | | | | b=AS:78 | | | | t=0 0 | | | | m=audio 49152 RTP/AVPF 97 | | | | a=pcfg:1 t=1 | | | | b=AS:30 | | | | b=RS:0 | | | | b=RR:2000 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | | | | m=video 49154 RTP/AVPF 99 | | | | a=acfg:1 t=1 | | | | b=AS:48 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 MP4V-ES/90000 | | | | a=fmtp:99 profile-level-id=8; \ | | | | config=000001B008000001B509000001010000012000884006682C2090A21F | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +----------------------------------------------------------------------+ | SDP offer from MTSI client in terminal B to A in SIP UPDATE message | +----------------------------------------------------------------------+ | v=0 | | | | o=Example_SERVER2 34135268010 IN IP4 server2.example.com | | | | s=Example of using AS to indicate negotiated QoS in MTSI | | | | c=IN IP4 aaa.bbb.ccc.ddd | | | | b=AS:60 | | | | t=0 0 | | | | m=audio 49252 RTP/AVPF 97 | | | | b=AS:30 | | | | b=RS:0 | | | | b=RR:2000 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | | | | m=video 49254 RTP/AVPF 99 | | | | b=AS:30 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 MP4V-ES/90000 | | | | a=fmtp:99 profile-level-id=8; \ | | | | config=000001B008000001B509000001010000012000884006682C2090A21F | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +----------------------------------------------------------------------+ | SDP answer from MTSI client in terminal A to B in 200/OK RESPONSE to | | UPDATE message | +----------------------------------------------------------------------+ | v=0 | | | | o=Example_SERVER 3413526809 0 IN IP4 server.example.com | | | | s=Example of using AS to indicate negotiated QoS in MTSI | | | | c=IN IP4 aaa.bbb.ccc.ddd | | | | b=AS:78 | | | | t=0 0 | | | | m=audio 49152 RTP/AVPF 97 | | | | b=AS:30 | | | | b=RS:0 | | | | b=RR:2000 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | | | | m=video 49154 RTP/AVPF 99 | | | | b=AS:48 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 MP4V-ES/90000 | | | | a=fmtp:99 profile-level-id=8; \ | | | | config=000001B008000001B509000001010000012000884006682C2090A21F | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +----------------------------------------------------------------------+
The example in table A.8.1 shows an SDP exchange that reflects the signalling
of negotiated QoS during initial session setup when there is only one PDP
context for the whole session. The first offer-answer procedure is initiated
by the MTSI client in terminal A at session setup. The second offer-answer
procedure is initiated by the MTSI client in terminal B when it receives a
different negotiated QoS, only 30 kbps for video, than what was indicated in
the first SDP offer from A. To notify A, B sends a new SDP offer, in this case
embedded in an UPDATE message, to A indicating the lower negotiated QoS bit
rate. The MTSI client in terminal A responds with its negotiated QoS value to
B.
NOTE: The bit rate in the second SDP answer, 48 kbps, was deliberately chosen
to show that this is a fully valid SDP answer even though the second SDP offer
only defines 30 kbps. It is however recommended that the UEs choose the same
bandwidths whenever possible.
The SDP offer in the SIP UPDATE message contains only one encoding format
since the answerer has already removed all but one encoding format in the SDP
answer to the initial SDP offer.
In this example it is assumed that the SDPCapNeg framework is not needed in
the UPDATE since the RTP profile has already been chosen in the initial
invitation.
# A.9 Void
# A.9a SDP offer/answer regarding the use of Reduced-Size RTCP
This example shows the offers and answers for a session between two MTSI
clients controlling the use of Reduced-Size RTCP.
Table A.9a.1: SDP example for Reduced-Size RTCP
+----------------------------------------------------------------+ | **SDP offer** | +----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-rsize | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR/8000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | +----------------------------------------------------------------+ | **SDP answer** | +----------------------------------------------------------------+ | m=audio 49152 RTP/AVPF 97 | | | | a=acfg:1 t=1 | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-rsize | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | +----------------------------------------------------------------+
Comments:
This example allows the use of Reduced-Size RTCP (attribute rtcp-rsize) for
the adaptation feedback. Moreover the minimum interval between two regular
compound RTCP packets is set to 5000 milliseconds.
# A.10 Examples of SDP offers and answers for inter-working with other IMS or
non-IMS IP networks
## A.10.1 General
The session between an MTSI client in a terminal and a client in a remote (IMS
or non-IMS) network can be established in many ways, especially when the
session is initiated by the remote network and when the remote network does
not use the MTSI service.
The SDP will also depend on how and when the MTSI MGW chooses to add
information about what formats (other than AMR and AMR-WB) that can be used
for inter-working. There are, in general, two methods for MTSI MGWs to add
information about the alternative formats. The first method is to add the
alternative formats to the original SDP offer from the initiating client as a
pre-emptive action. The second method is to leave the original SDP offer
unchanged, forward it to the remote network and wait for the answerer to
respond and only add the alternative formats if/when the SDP offer was
rejected. A further complication is that there might be multiple MGWs in the
path for this kind of inter-working and different MGWs might work differently.
The SDP examples included below should therefore be regarded as a few samples
of possible SDPs and should not be regarded as a complete description of what
might occur in a real implementation.
## A.10.2 Session initiated by MTSI client in terminal
### A.10.2.1 SDP offers from an MTSI client in terminal
The MTSI client in terminal could send an SDP offer as shown in Table A.10.1
(narrow-band speech only) or Table A.10.2 (wide-band and narrow-band speech).
Table A.10.1: Original SDP offer from an MTSI client in terminal for narrow-
band speech
+----------------------------------------------------------------+ | SDP offer | +----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR/8000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | +----------------------------------------------------------------+
**Comments:**
This SDP offer is identical to the SDP offer in Table A.1.1.
Table A.10.2: Original SDP offer from an MTSI client in terminal for narrow-
band and wide-band speech
+-----------------------------------------------------------------+ | SDP offer | +-----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 99 100 | | | | a=tcap:1 RTP/AVPF | | | | a=pcfg:1 t=1 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR-WB/16000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=rtpmap:99 AMR/8000/1 | | | | a=fmtp:99 mode-change-capability=2; max-red=220 | | | | a=rtpmap:100 AMR/8000/1 | | | | a=fmtp:100 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=ptime:20 | | | | a=maxptime:240 | +-----------------------------------------------------------------+
**Comments:**
This SDP offer is identical to the SDP offer in Table A.1.2.
### A.10.2.2 SDP offers modified by MTSI MGW when pre-emptively adding inter-
working formats
In this example, the MTSI MGW intercepts the SIP INVITE with the original SDP
offer from the MTSI client in terminal and adds the codecs and formats that
are supported for inter-working before forwarding the SDP offer to the remote
network.
When an MTSI MGW pre-emptively adds codecs and formats for inter-working it
will also remove lines that it does not support. These examples show an MTSI
MGW that does not support AVPF nor SDPCapNeg and it will therefore remove the
corresponding lines. The SDP offers could look like the examples included in
Table A.10.3 (narrow-band speech only) and Table A.10.4 (wide-band and narrow-
band speech).
Table A.10.3: SDP offer for narrow-band speech which has been modified by the
MTSI MGW before it is sent to the remote network
+----------------------------------------------------------------+ | Modified SDP offer | +----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 99 100 101 | | | | a=rtpmap:97 AMR/8000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR/8000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=rtpmap:99 PCMA/8000/1 | | | | a=rtpmap:100 PCMU/8000/1 | | | | a=rtpmap:101 L16/8000/1 | | | | a=ptime:20 | | | | a=maxptime:240 | +----------------------------------------------------------------+
**Comments:**
The SDP offer from Table A.10.1 has been modified by adding RTP Payload Types
99 (A-law PCM), 100 (μ-law PCM) and 101 (linear 16 bit PCM with 8 kHz sampling
frequency).
The lines "a=tcap:1 RTP/AVPF" and "a=pcfg:1 t=1" are removed because the MTSI
MGW does not support AVPF nor SDPCapNeg in this example.
To allow for end-to-end adaptation for AMR and AMR-WB, the MTSI MGW keeps
a=maxptime:240.
If the remote network supports AMR, then the received SDP answer should
contain at least one RTP Payload Type for AMR but there may also be one or
more RTP Payload types for non-AMR codecs. In this case, the MTSI MGW does not
need to perform transcoding and may forward the SDP offer to the MTSI client
in terminal unchanged.
If the SDP answer contains no AMR RTP Payload Type then the MTSI MGW needs to
perform transcoding to and from the format indicated by the remote network. In
this case, the MTSI MGW needs to add AMR to the SDP answer that is sent back
to the MTSI client in terminal.
Table A.10.4: SDP offer for wide-band and narrow-band speech which has been
modified by the MTSI MGW before it is sent to the remote network
+-----------------------------------------------------------------+ | Modified SDP offer | +-----------------------------------------------------------------+ | m=audio 49152 RTP/AVP 97 98 101 102 99 100 103 104 105 | | | | a=rtpmap:97 AMR-WB/16000/1 | | | | a=fmtp:97 mode-change-capability=2; max-red=220 | | | | a=rtpmap:98 AMR-WB/16000/1 | | | | a=fmtp:98 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=rtpmap:101 G722/8000/1 | | | | a=rtpmap:102 L16/16000/1 | | | | a=rtpmap:99 AMR/8000/1 | | | | a=fmtp:99 mode-change-capability=2; max-red=220 | | | | a=rtpmap:100 AMR/8000/1 | | | | a=fmtp:100 mode-change-capability=2; max-red=220; octet-align=1 | | | | a=rtpmap:103 PCMA/8000/1 | | | | a=rtpmap:104 PCMU/8000/1 | | | | a=rtpmap:105 L16/8000/1 | | | | a=ptime:20 | | | | a=maxptime:240 | +-----------------------------------------------------------------+
**Comments:**
The SDP offer from Table A.10.2 has been modified by adding RTP Payload Types
101 (G.722), 102 (linear 16 bit PCM with 16 kHz sampling frequency), 103
(A-law PCM), 104 (μ-law PCM) and 105 (linear 16 bit PCM with 8 kHz sampling
frequency).
NOTE: The sampling frequency for G.722 is 16 kHz but has been set to 8 kHz in
the SDP because G.722 was (erroneously) assigned this value in the original
version of the RTP A/V profile. Hence, one need to use "8000" for backwards
compatibility reasons, see also [10].
The lines "a=tcap:1 RTP/AVPF" and "a=pcfg:1 t=1" are removed because the MTSI
MGW does not support SDPCapNeg (in this example).
To allow for end-to-end adaptation for AMR and AMR-WB, the MTSI MGW keeps
a=maxptime:240.
If the remote network supports AMR-WB or AMR, then the received SDP answer
should contain at least one RTP Payload Type for AMR-WB or AMR but there may
also be one or more RTP Payload Types for non-AMR codecs. In this case, the
MTSI MGW does not need to perform transcoding and can remove the non-AMR RTP
Payload Types before forwarding the SDP answer to the MTSI client in terminal.
If the SDP answer contains no AMR-WB or AMR RTP Payload Type then the MTSI MGW
needs to perform transcoding to and from the format indicated by the remote
network.
### A.10.2.3 SDP modified by MGW when adding inter-working formats only when
the original SDP offer was rejected
In this example, the MTSI MGW either forwards the original SDP offer that was
received from the MTSI client in terminal to the remote network or it is not
involved in the session setup at all until it is concluded that the same
codecs are not supported in the different networks. In this latter case, the
MTSI MGW is invoked only if the remote network rejects the SDP offer.
In this case, when the MTSI MGW sends the (new) SDP offer to the remote
network it knows that the AMR (and AMR-WB) codecs are not supported by the
remote network because the original SDP offer was rejected. It is therefore
unnecessary to include these codecs in the (new) SDP offer. The SDP offers
could look like the examples included in Table A.10.5 (narrow-band speech
only) and Table A.10.6 (wide-band and narrow-band speech).
The remote client may also suggest codecs and configurations when it rejects
the SDP offer. Existence of such information can, of course, be used to
increase the likelihood that the session setup will be successful. These SDP
examples are however designed for the case when no such information is
available from the remote network.
Table A.10.5: New SDP offer for narrow-band speech sent by the MTSI MGW to the
remote network
+----------------------------------+ | New SDP offer | +----------------------------------+ | m=audio 49152 RTP/AVP 99 100 101 | | | | a=rtpmap:99 PCMA/8000/1 | | | | a=rtpmap:100 PCMU/8000/1 | | | | a=rtpmap:101 L16/8000/1 | | | | a=ptime:20 | | | | a=maxptime:80 | +----------------------------------+
**Comments:**
The new SDP offer includes RTP Payload Types 99 (A-law PCM), 100 (μ-law PCM)
and 101 (linear 16 bit PCM with 8 kHz sampling frequency).
In this case, the maxptime is set to 80, if the MTSI MGW does not support
redundancy.
Table A.10.6: New SDP offer for narrow-band and wide-band speech sent by the
MTSI MGW to the remote network
+-------------------------------------------+ | New SDP offer | +-------------------------------------------+ | m=audio 49152 RTP/AVP 101 102 103 104 105 | | | | a=rtpmap:101 G722/8000/1 | | | | a=rtpmap:102 L16/16000/1 | | | | a=rtpmap:103 PCMA/8000/1 | | | | a=rtpmap:104 PCMU/8000/1 | | | | a=rtpmap:105 L16/8000/1 | | | | a=ptime:20 | | | | a=maxptime:80 | +-------------------------------------------+
Comments:
The new SDP offer includes RTP Payload Types 101 (G.722), 102 (linear 16 bit
PCM with 16 kHz sampling frequency), 103 (A-law PCM), 104 (μ-law PCM) and 105
(linear 16 bit PCM with 8 kHz sampling frequency).
NOTE: The sampling frequency for G.722 is 16 kHz but has been set to 8 kHz in
the SDP because G.722 was (erroneously) assigned this value in the original
version of the RTP A/V profile. Hence, one need to use "8000" for backwards
compatibility reasons, see also [10].
In this case, the maxptime is set to 80, if the MTSI MGW does not support
redundancy.
# A.11 Adding a video component to an on-going video call session
The MTSI client in a terminal can add, remove and modify the media components
during an ongoing MTSI session. This clause describes the SDP offer in the
initial SIP INVITE message, see Table A.11.1, and the SDP in the subsequent
re-INVITE or UPDATE message for adding a video stream to the ongoing MTSI
video call session, see Table A.11.2. Corresponding SDP answers in the SIP
200/OK responses are also described.
The initial video call session contains one video component and one speech
component. During the session, the MTSI client in terminal A adds a uni-
directional video component (such as one video clip) to the ongoing video call
session. The SDP content attribute "a=content:main" and "a=content:alt" are
used to label the main and alternative video components respectively [81].
This example does not show how to use the content attribute in combination
with the grouping attribute, nor does it show how to use the content attribute
in combination with the synchronization attribute defined in Clause 6.2.6.
Table A.11.1: SDP offer/answer for setting up a video telephony session
+----------------------------------------------------------------------+ | SDP offer from MTSI client in terminal A to B in SIP INVITE message | +----------------------------------------------------------------------+ | a=tcap:1 RTP/AVPF | | | | m=audio 49150 RTP/AVP 96 | | | | a=pcfg:1 t=1 | | | | b=AS:30 | | | | b=RS:0 | | | | b=RR:2000 | | | | a=rtpmap:96 AMR/8000/1 | | | | a=fmtp:96 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | | | | m=video 54320 RTP/AVP 99 | | | | a=pcfg:1 t=1 | | | | b=AS:57 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 MP4V-ES/90000 | | | | a=fmtp:99 profile-level-id=8; \ | | | | config=000001B008000001B509000001010000012000884006682C2090A21F | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +----------------------------------------------------------------------+ | SDP answer from MTSI client in terminal B to A in 200/OK RESPONSE | | message | +----------------------------------------------------------------------+ | m=audio 49152 RTP/AVPF 96 | | | | a=acfg:1 t=1 | | | | b=AS:30 | | | | b=RS:0 | | | | b=RR:2000 | | | | a=rtpmap:96 AMR/8000/1 | | | | a=fmtp:96 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | | | | m=video 54320 RTP/AVPF 99 | | | | a=acfg:1 t=1 | | | | b=AS:57 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 MP4V-ES/90000 | | | | a=fmtp:99 profile-level-id=8; \ | | | | config=000001B008000001B509000001010000012000884006682C2090A21F | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | +----------------------------------------------------------------------+
Table A.11.2: Second SDP offer/answer for adding one more video component
+----------------------------------------------------------------------+ | SDP offer from MTSI client in terminal A to B in SIP | | UPDATE/Re-INVITE message | +----------------------------------------------------------------------+ | a=tcap:1 RTP/AVPF | | | | m=audio 49150 RTP/AVP 96 | | | | a=pcfg:1 t=1 | | | | b=AS:30 | | | | b=RS:0 | | | | b=RR:2000 | | | | a=rtpmap:96 AMR/8000/1 | | | | a=fmtp:96 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | | | | m=video 54320 RTP/AVP 99 | | | | i=Main video | | | | a=pcfg:1 t=1 | | | | b=AS:57 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 MP4V-ES/90000 | | | | a=fmtp:99 profile-level-id=8; \ | | | | config=000001B008000001B509000001010000012000884006682C2090A21F | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | | | | a=content:main | | | | m=video 43200 RTP/AVP 100 | | | | i=Alternative video | | | | a=pcfg:1 t=1 | | | | b=AS:128 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:100 H263-2000/90000 | | | | a=fmtp:100 profile=0;level=45; | | | | a=content:alt | | | | a=sendonly | +----------------------------------------------------------------------+ | SDP answer from MTSI client in terminal B to A in 200/OK RESPONSE to | | UPDATE/Re-INVITE message | +----------------------------------------------------------------------+ | m=audio 49152 RTP/AVPF 96 | | | | a=acfg:1 t=1 | | | | b=AS:30 | | | | b=RS:0 | | | | b=RR:2000 | | | | a=rtpmap:96 AMR/8000/1 | | | | a=fmtp:96 mode-change-capability=2; max-red=220 | | | | a=ptime:20 | | | | a=maxptime:240 | | | | m=video 54320 RTP/AVPF 99 | | | | a=acfg:1 t=1 | | | | b=AS:57 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:99 MP4V-ES/90000 | | | | a=fmtp:99 profile-level-id=8; \ | | | | config=000001B008000001B509000001010000012000884006682C2090A21F | | | | a=rtcp-fb:* trr-int 5000 | | | | a=rtcp-fb:* nack | | | | a=rtcp-fb:* nack pli | | | | a=rtcp-fb:* ccm fir | | | | a=rtcp-fb:* ccm tmmbr | | | | a=content:main | | | | m=video 43200 RTP/AVPF 100 | | | | a=acfg:1 t=1 | | | | b=AS:128 | | | | b=RS:0 | | | | b=RR:2500 | | | | a=rtpmap:100 H263-2000/90000 | | | | a=fmtp:100 profile=0;level=45; | | | | a=content:alt | | | | a=recvonly | +----------------------------------------------------------------------+
###### ## Annex B (informative): Examples of adaptation scenarios
# B.1 Video bitrate adaptation
It is recommended in clauses 7.3.3 and 10.3 that a video sender adapts its
video output rate based on RTCP reports and TMMBR messages. The following
examples illustrate the usage:
EXAMPLE 1 -- Handover to a different cell:
1\. A video session is established at 100kbps. 5kbps is allocated for RTCP and
trr-int is set to 500 ms. This allows an MTSI client in terminal to send
regular RTCP reports with an average 500 ms interval consuming less than 5
kbps for RTCP. At the same time it allows the MTSI client in terminal to send
an early RTCP packet and then send the next one already after 800 ms instead
of after 1 000 ms.
2\. The receiver is now subject to a reduced bandwidth, e.g. 60 kbps, due to
handover to a different cell. The network indicates the reduced bandwidth to
the receiver. The receiver generates a TMMBR message to inform the sender of
the new maximum bitrate, 60 kbps.
3\. The sender receives the TMMBR message, adjusts its output bitrate and
sends a TMMBN message back.
4\. The receiver sends a SIP UPDATE message to the sender indicating 60 kbps
5\. The receiver travels into an area with full radio coverage. A new
bandwidth of 100 kbps is negotiated with the network. It sends a SIP UPDATE
message for 100 kbps.
6\. The sender receives the SIP UPDATE message, and adjusts its output
bitrate.
EXAMPLE 2 -- Bad coverage or congestion:
1\. A video session is established at 100kbps. 5kbps is allocated for RTCP and
trr-int is set to 500 ms. This allows an MTSI client in terminal to send
regular RTCP reports with an average 500 ms interval consuming less than 5
kbps for RTCP. At the same time it allows the MTSI client in terminal to send
an early RTCP packet and then send the next one already after 800 ms instead
of after 1 000 ms.
2\. The receiver detects congestion and estimates a preferred video
transmission rate of e.g. 60 kbps. The receiver generates a TMMBR message to
inform the sender of the new maximum bitrate, 60 kbps.
3\. The sender receives the TMMBR message, adjusts its output bitrate and
sends a TMMBN message back.
###### ## Annex C (informative): Example adaptation mechanisms for speech
# C.1 Example of feedback and adaptation for speech and video
## C.1.1 Introduction
This annex gives the outline of possible example adaptation implementations
that make use of adaptation signalling for speech as described in section
10.2. Several different adaptation implementations are possible and the
examples shown in this section are not to be seen as a set of different
adaptive schemes excluding other designs. Implementers are free to use these
examples or to use any other adaptation algorithms. The examples are only
based on measured packet losses whereas a real implementation is free to use
other adaptation triggers. The purpose of the section is to show a few
different examples of how receiver state machines can be used both to control
the signalling but also to control the signalling requests. Notice that the
MTSI clients can have different implementations of the adaptation state
machines.
The annex is divided into three sections:
\- Signalling considerations - Implementation considerations on the signalling
mechanism; the signalling state machine.
\- Adaptation state machines - Three different examples of adaptation state
machines either using the full set of adaptation dimensions or a subset
thereof.
\- Other issues and solutions - Default actions and lower layer triggers.
In this annex, a _media receiver_ is the receiving end of the media flow,
hence the _request sender_ of any adaptation request. A _media sender_ is the
sending entity of the media, hence the _request receiver_ of the adaptation
request. The three different adaptation mechanisms available; bit-rate,
packet-rate and error resilience, represents different ways to adapt to
current transport characteristics:
\- Bit-rate adaptation. Reducing the bit-rate is in all examples shown in this
section the first action done whenever a measurement indicating that action is
needed to further optimize the session quality. A bit-rate reduction will
reduce the utilization of the network resources to transmit the data. In the
radio case, this would reduce the required transmission power and free
resources either for more data or added channel coding. It is reasonable to
assume, also consistent with a proper behaviour on IP networks, that a
reduction of bit-rate is a valid first measure to take whenever the transport
characteristics indicate that the current settings of the session do not
provide an optimized session quality.
\- Packet-rate adaptation. In some of the examples, packet-rate adaptation is
a second measure available to further adapt to the transport characteristics.
A reduction of packet rate will in some cases improve the session quality,
e.g. in transmission channels including WLAN. Further, a reduction of packet
rate will also reduce the protocol overhead since more data is encapsulated
into each RTP packet. Although robust header compression (RoHC) can reduce the
protocol overhead over the wireless link, the core network will still see the
full header and for speech data, it consists of a considerable part of the
data transmitted. Hence, packet-rate adaptation serves as a second step in
reducing the total bit-rate needed for the session.
\- Error resilience. The last adaptive measure in these examples is the use of
error resilience measures, or explicitly, application level redundancy.
Application level redundancy does not reduce the amount of bits needed to be
transmitted but instead transmit the data in a more robust way. Application
level redundancy should only be seen as a last measure when no other
adaptation action has succeeded in optimizing the session quality sufficiently
well. For most normal use cases, application level redundancy is not foreseen
to be used, rather it serves as the last resort when the session quality is
severely jeopardized.
## C.1.2 Signalling state considerations
The control of the adaptation signalling can by itself be characterized as a
state machine. The implementation of the state machine is in the decoder and
each MTSI client has its own implementation. The decoder sends requests as
described in clause 10.2 to the encoder in the other end.
The requests that are transmitted can be queued up in a send buffer to be
transmitted the next time an RTCP-APP packet is to be sent. Hence, a sender
might receive one, two or all three receiver requests at the same time. It
should not expect any specific order of the requests. A receiver shall not
send multiple requests of the same type in the same RTCP-APP packet.
Transmission of the requests should preferably be done immediately using the
AVPF early mode but in some cases it may be justified to delay the
transmission a limited time or until the next DTX period in order to minimize
disturbance on the RTP stream, in the latter case monitoring of the RTP stream
described below must take the additional delay into account.
To summarize:
\- A request can be sent immediately (alone in one RTCP-APP packet) but the
subsequent RTCP-APP packet must follow the transmission rules for RTCP.
\- RTCP-APP packets may be delayed until the next DTX period.
Reception of the transmitted RTCP-APP packets is not guaranteed. Similar to
the RTP packets, the RTCP packets might be lost due to link losses. Monitoring
that the adaptation requests are followed can to be done by means of
inspection of the received RTP stream.
For various reasons the requests might not be followed even though they
received successfully by the other end. This behaviour can be seen in the
following ways:
\- Request completely ignored: An example is a request for 1 frame/packet
which might be rejected as the MTSI client decides that the default mode of
operation 2 frames/packet or more and a frame aggregation reduction compared
to the default state is not allowed.
\- Request partially followed: An example here is when no redundancy is
received and a request for 100 % redundancy with 1 extra frame offset is made
which may be realized by the media sender as 100 % redundancy with no extra
offset. Another example is when a request for 5.9 kbps codec rate is sent and
it is realized as e.g. 6.7 kbps codec rate. Table C.1 displays how the
requests and realizations are grouped. E.g. it can be seen (if Ninit =1) that
a request for 3 frames per packets realized as 2 frames per packet is
considered to be fulfilled.
Table C.1: Distinction of different settings for frame aggregation,\
redundancy and codec mode settings
* * *
Codec rate Frame aggregation Redundancy Highest rate in mode set N~init~ frame
per packet No redundancy All other codec rates ≥ N~init~+1 frames per packet ≥
100 % redundancy , arbitrary offset
* * *
In table C.1 above N~init~ is 1 in most cases which corresponds to 1 frame per
packet. In certain cases N~init~ might have another value, one such example is
E-GPRS access where N~init~ may be 2. N~init~ is given by the ptime SDP
attribute.
Note that special care in the monitoring should be taken when DTX is used as
DTX SID update packets are normally not aggregated or transmitted redundant.
Important is also that it takes at least one roundtrip before the effect of a
request is seen in the RTP flow, if transmission of RTCP is delayed due to
e.g. bandwidth requirements this extra delay must also be taken into account
in the monitoring.
If the requests are not followed as requested, the request should not be
repeated infinitely as it will increase the total bit-rate without clear
benefit. In order to avoid such behaviour the following recommendations apply:
\- Partially fulfilled requests should be considered as obeyed.
\- If a new request is not fulfilled within T_RESPONSE ms, the request is
repeated again with a delay between trials of 2*T_RESPONSE ms. If the three
attempts have been made without sender action, it should be assumed that the
request cannot be fulfilled. In this case, the adaptation state machine will
stay in the previous state or in a state that matches the current properties
(codec mode, redundancy, frame aggregation). Any potential mismatch between
define states in the adaptation state machine and the current properties of
the media stream should resolved by the request sender.
\- The default mode of operation for a MTSI client if the RTCP bandwidth for
the session is greater than zero is that the requests received should be
followed. Ignoring requests should be avoided as much as possible. However, it
is required that any signalling requests are aligned with the agreed session
parameters in the SDP.
In some cases the adaptation state machine may go out-of-synch with the
received RTP stream. Such cases may occur if e.g. the other MTSI client makes
a reset. These special cases can be sensed, e.g. through a detection of a
large gap in timestamp and/or sequence number. The state machine should then
reset to the default state and start over again.
The signalling state machine has three states according to table C.2.
Table C.2: Signalling state machine states
* * *
State Description T1 Idle state: This is the default state of the signalling
state machine. The signalling state should always return here after a state
transition and when it has been detected that the media sender has followed
the request, either completely or partially. The signalling state machine
remains in this state as long as the selected adaptation is \"stable\", i.e.
as long as the adaptation measures are appropriate for the current operating
conditions. When it has been detected that the operating conditions has
changed so much that the current adaptation measures are no longer appropriate
then the adaptation function triggers a request signalling and the signalling
state machine goes to state T2. T2 In this state, the received RTP stream is
monitored to verify that the properties of a given adaptation state
(redundancy, frame aggregation and codec mode) are detected in the received
RTP stream. If necessary, some of the requests are repeated maximum 3 times.
If any of the properties is considered to be not fulfilled, the signalling
state machine enters state T3. T3 In this state, the properties of the RTP
stream (redundancy, frame aggregation and codec rate) is reverted back to the
properties of the last successful state and a new state transition is tested
in T2, or alternatively the adaptation state is set to the state that matches
the current properties (codec mode, redundancy, frame aggregation).
* * *
Figure C.1: Signalling state machine, implemented in order\ to ensure safe
adaptation state transitions
## C.1.3 Adaptation state machine implementations
### C.1.3.1 General
The example adaptation state machines shown in this section are different
realizations of the control algorithm for the adaptation requests. Note that
this does not include how the actual signalling should be done but how various
triggers will result in the transmission of different requests.
The example adaptation state machines make use of the signalling state machine
outlined in clause B.2. Common to all adaptation state machines is that it is
possible to implement all versions in the same code and just exclude
appropriate states depending on desired mode of operation. All examples can
transit between a number of states (denoted S1...S4). In these examples, it is
assumed that the codec is AMR-NB and that it uses two coding rates (AMR 12.2
and AMR 5.9). However, this is not a limitation of the adaptation mechanism by
itself. It is only the scenario used in these examples.
Since the purpose of the adaptation mechanism is to improve the quality of the
session, any adaptation signalling is based upon some trigger; either a
received indication or a measurement. In the case of a measurement trigger, it
is important to gather reliable statistics. This requires a measurement period
which is sufficiently long to give a reliable estimation of the channel
quality but also sufficiently short to enable fast adaptation. For typical
MTSI scenarios on 3GPP accesses, a measurement period in the order of 100
packets is recommended. Further, in order to have an adaptation control which
is reliable and stable, a hangover period is needed after a new state has been
entered (typically 100 to 200 packets). An even longer hangover period is
suitable when transiting from an error resilient state or a reduced rate into
the default, normal state. In the below examples, it is assumed that the
metric used in the adaptation is the packet loss rate measured on the
application layer. It is possible to use other metrics such as lower layer
channel quality metrics.
Note that mode change requests must follow the rules outlined in clause 5.2.1.
The example solution is designed based on the following assumptions:
\- When the packet loss rate increases, the adaptation should:
\- First try with a lower codec mode rate, i.e. bit-rate back off.
\- If this does not improve the situation, then one should try with packet
rate back-off by increasing the frame aggregation.
\- If none of these methods help, then application layer redundancy should be
added to save the session.
\- When the packet loss rate increases, one should try to increase the bit
rate in a \"safe\" manner. This is done by probing for higher bit rates by
adding redundancy.
\- The downwards adaptation, towards lower rates and redundancy, should be
fast while the upwards adaptation should be slow.
\- Hysteresis should be used to avoid oscillating behaviour between two
states.
A description of the different states and what trigger the transition into the
respective state is given in table C.3.
Table C.3: Adaptation state machine states and their meaning
+-------+-------------------------------------------------------------+ | State | Description | +-------+-------------------------------------------------------------+ | S1 | Default/normal state: Good channel conditions. | | | | | | This state has the properties: | | | | | | - Codec rate: Highest mode in mode set. | | | | | | - Frame aggregation: Equal to the ptime value in the | | | agreed session parameters. | | | | | | - Redundancy: 0%. | +-------+-------------------------------------------------------------+ | S2 | In this state the encoding bit-rate and the packet rate is | | | reduced. The state is divided into 2 sub states (S2a and | | | S2b). In state S2a the codec rate is reduced and in state | | | S2b the packet rate is also reduced (the frame aggregation | | | is increased). State S2a may also involve a gradual | | | decrease of the codec-rate in order to be in agreement with | | | the session parameters. If no restrictions are in place | | | regarding mode changes (i.e. such as only allowing changing | | | to a neighbouring mode), it changes bit-rate to the target | | | reduced bit-rate directly. If restrictions are in place, | | | several mode changes might be needed. | | | | | | This state has the properties: | | | | | | - Codec rate: Any codec rate except the highest rate in | | | mode set, preferably a codec rate that is roughly half | | | the highest rate. | | | | | | - Frame aggregation: | | | | | | - S2a: Equal to the ptime value in the agreed session | | | parameters. | | | | | | - S2b: ptime+N*20ms where N > 1, limited by | | | max-ptime. | | | | | | - Redundancy: 0%. | +-------+-------------------------------------------------------------+ | S3 | This is an interim state where the total bit-rate and | | | packet rate is roughly equal to state S1. 100% redundancy | | | is used with a lower codec mode than S1. This is done to | | | probe the channel band-width with a higher tolerance to | | | packet loss to determine if it is possible to revert back | | | to S1 without significantly increase the packet loss rate. | | | | | | This state has the properties: | | | | | | - Codec rate: Any codec rate except the highest rate in | | | mode set, preferably a codec rate that is roughly half | | | the highest rate, target total rate (with redundancy) | | | should be roughly the same as in S1. | | | | | | - Frame aggregation: Equal to the ptime value in the | | | agreed session parameters. | | | | | | - Redundancy: 100%. | +-------+-------------------------------------------------------------+ | S4 | In this state the encoding bit-rate is reduced (the same | | | bit-rate as in S2) and redundancy is turned on. Optionally | | | also the packet rate is kept the same as in state S2. | | | | | | This state has the properties: | | | | | | - Codec rate: Any codec rate except the highest rate in | | | mode set, preferably a codec rate that is roughly half | | | the highest rate. | | | | | | - Frame aggregation: Equal to the ptime value in the | | | agreed session parameters. | | | | | | - Redundancy: 100%, possibly with offset. | +-------+-------------------------------------------------------------+
The parameters and other definitions controlling the behaviour of the
adaptation state machine are described in table C.4. Example values are also
shown, values which give good performance on a wide range of different channel
conditions.
Table C.4: State transition definitions, thresholds and temporal adaptation
control parameters
* * *
Parameter Value/meaning Comment PLR_1 3 %  
PLR_2 1 %  
PLR_3 2 %  
PLR_4 10 %  
N_INHIBIT 1 000 frames A random value may be used to avoid large scale
oscillation problems. N_HOLD 5 measurement periods  
T_RESPONSE 500 ms Estimated response time for a request to be fulfilled.
Packet loss burst 2 or more packet losses in the last 20 packets.
* * *
### C.1.3.2 Adaptation state machine with four states
The first example utilizes all adaptation possibilities, both in terms of
possible states and transitions between the states. Figure C.2 shows the
layout of the adaptation state machine and the signalling used in the
transitions between the states.
Figure C.2: State diagram for four-state adaptation state machine
**State transitions:**
Below are listed the possible state transitions and signalling that is
involved. Note that the state can go from S1 to either S2 or state S4, this is
explained below:
Table C.5: State transitions for four-state adaptation state machine
+------------------+--------------------------------------------------+ | State transition | Conditions and actions | +------------------+--------------------------------------------------+ | S1  S2a | Condition: Packet loss ≥ PLR_1 or packet loss | | | burst detected.\ | | | A request to reduce the encoding bit-rate is | | | sent using RTCP_APP_CMR, e.g. change mode from | | | AMR 12.2 to AMR 5.9. | +------------------+--------------------------------------------------+ | S2a  S2b | Condition: Packet loss ≥ PLR_1. | | | | | | This state transition occurs if the packet loss | | | is still high despite the reduction in codec | | | rate. A request is sent to reduce the packet | | | rate is reduced by means of an | | | RTCP_APP_REQ_AGG message. | +------------------+--------------------------------------------------+ | S2b  S2a | Condition: Packet loss ≤ PLR_ 2 for N_HOLD | | | consecutive measurement periods. | | | | | | This state transition involves an increase of | | | the packet rate restoring it to the same value | | | as in S1. The request transmitted is | | | RTCP_APP_REQ_AGG. If the state transition | | | S2bS2aS2b occurs in sequence, the state will | | | be locked to S2b for N_INHIBIT frames to avoid | | | state oscillation. | +------------------+--------------------------------------------------+ | S2a  S3 | Condition: Packet loss ≤ PLR_2 for N_HOLD | | | consecutive measurement periods. | | | | | | A request to turn on 100% redundancy is | | | transmitted by means of request | | | RTCP_APP_REQ_RED. | +------------------+--------------------------------------------------+ | S3  S2a | Condition: Packet loss ≥ PLR_3. | | | | | | Same actions as in transition from, S1S2a. If | | | the transition S2aS3S2aS3S2a occurs, the S3 | | | is disabled for N_INHIBIT frames. | +------------------+--------------------------------------------------+ | S3  S1 | Condition: Packet loss ≤ PLR_2 for N_HOLD | | | consecutive measurement periods. | | | | | | A request to turn off redundancy is transmitted | | | as RTCP_APP _REQ_RED. Encoding bit-rate is | | | increased by means of RTCP_APP_CMR. | +------------------+--------------------------------------------------+ | S2b  S4 | Condition: Packet loss ≥ PLR_3. | | | | | | A request to turn on 100% redundancy is | | | transmitted by means of request | | | RTCP_APP_REQ_RED. The packet rate is restored | | | to same value as in S1 using RTCP_APP | | | _REQ_AGG. | +------------------+--------------------------------------------------+ | S4  S2b | Condition: | | | | | | 1. If the previous transition was S2bS4 and | | | packet loss ≥ to 4*PLR@ S2bS4 (packet loss | | | considerably increased since transition to state | | | S4).\ | | | This is indicative of that the total bit-rate is | | | too high and that it is probably better to | | | transmit with a lower packet rate/bit-rate | | | instead. This case might occur if the packet | | | loss is high in S2a due to a congested link, a | | | switch to redundant mode S4 will then increase | | | the packet loss even more | | | | | | 2. If previous transition was S1S4 and packet | | | loss >= PLR_4.\ | | | This transition is made to test if a | | | bitrate/packet rate reduction is better. | +------------------+--------------------------------------------------+ | S4  S1 | Condition: Packet loss \ 0);
x(1:ix(1)-1) = x(ix(1));
\% remove packet losses (replace with nearby delay values)
ix = find(x \ 1)
x(ix(n)) = x(ix(n)-1);
end;
end;
\% convert timescale to ms
x = x*tscale;
L = length(x);
T = 1:L;
\% estimate min and max TX delay, estimate a delta_delay
for n=1:L
ix = [max(1,n-jitter_est_window):n];
max_delay(n) = max(x(ix));
min_delay(n) = min(x(ix));
delta_delay(n) = max_delay(n)-min_delay(n);
end
\% compute the target max jitter buffer level with some slow adaptation
\% downwards, just to mimick how a jitter buffer might behave
for n=1:L
ix = [max(1,n-jb_adaptation_lookback):n];
jb(n) = max(delta_delay(ix));
\% The timescaling is not allowed to adjust the jitterbuffer target max level
\% too fast.
if n == 1
jb_ = jb(n);
end
delta = abs(jb_-jb(n));
if delta \ 0
\% decrease the max jitter buffer leve until a target late loss has been
\% reached.
late_loss = length(find(del \ target
one
\% must be able to revert back to the previous data
while late_loss \
**\ **
**\ **
**\ 1.2\**
**\ \--The device manufacturer--\**
**\ \--The device model--\**
**\ **
**\ **3GPP_MTSINP \**
**\ **
**\ **
**\ **
**\ **
**\ 3GPP MTSI service network profile setting\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ The 3GPP MTSI Service Network Profile Management
Object.\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ Speech\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ Speech Node.\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ speech subnodes\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ Priority\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ priority of codec\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ Codec\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\  Speech Codec name\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ Bandwidth\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\  bandwidth\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ ModeSet\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\  AMR codec mode set\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ ConRef\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\  QoS reference\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ Ext\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\  A collection of all extension objects\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ Video\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ Video Node.\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ Video subnodes\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ Priority\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ priority of codec\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ Codec\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\  Video Codec name\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ Bandwidth\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\  bandwidth\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ ConRef\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\  QoS reference\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ Ext\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\  A collection of all extension objects\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ Text\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ Text Node.\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ Text subnodes\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ Bandwidth\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\  bandwidth\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ ConRef\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\  QoS reference\**
**\ **
**\ text/plain\**
**\ **
**\ **
**\ **
**\ **
**\ Ext\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\  A collection of all extension objects\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ Ext\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
**\  A collection of all extension objects\**
**\ **
**\ **
**\ **
**\ **
**\ **
**\ **
\
###### ## Annex I (informative): QoE Reporting Management Object Device
Description Framework
This Device Description Framework (DDF) is the standardized minimal set. A
vendor can define its own DDF for the complete device. This DDF can include
more features than this minimal standardized version.
\
\
\
\1.2\
\\--The device manufacturer--\
\\--The device model--\
\
\3GPP_MTSIQOE\
\
\
\
\
\
\
\
\
\
\
\
\
\
\The interior node holding all 3GPP MTSI QoE Metrics Reporting
objects\
\
\
\
\
\
\Enabled\
\
\
\
\
\
\
\
\
\
\
\
\
\
\The QoE reporting requested indicator\
\
\
\
\
\
\
\Servers\
\
\
\
\
\
\
\
\
\
\
\The URL of the QoE report server\
\
\
\
\
\
\
\APN\
\
\
\
\
\
\
\
\
\
\
\The Access Point Name for QoE reporting\
\
\
\
\
\
\
\Format\
\
\
\
\
\
\
\
\
\
\
\The QoE metrics report format\
\
\
\
\
\
\
\Rules\
\
\
\
\
\
\
\
\
\
\
\A QoE metrics rule\
\
\
\
\
\
\
\Speech\
\
\
\
\
\
\
\
\
\
\
\The QoE speech metrics node\
\
\
\
\
\
\Metrics\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\Ext\
\
\
\
\
\
\
\
\
\
\
\
\
\
\ A collection of all extension objects\
\
\
\
\
\
\
\
\Video\
\
\
\
\
\
\
\
\
\
\
\The QoE video metrics node\
\
\
\
\
\
\Metrics\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\Ext\
\
\
\
\
\
\
\
\
\
\
\
\
\
\A collection of all extension objects\
\
\
\
\
\
\
\
\Text\
\
\
\
\
\
\
\
\
\
\
\The QoE text metrics node\
\
\
\
\
\
\Metrics\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\Ext\
\
\
\
\
\
\
\
\
\
\
\
\
\
\A collection of all extension objects\
\
\
\
\
\
\
\
\Ext\
\
\
\
\
\
\
\
\
\
\
\
\
\
\A collection of all extension objects\
\
\
\
\
\
\
\
#
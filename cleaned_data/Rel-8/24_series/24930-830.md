# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document gives examples of the session setup in the IM CN
subsystem based on SIP and SDP.
These signalling flows provide detailed signalling flows, which expand on the
overview information flows provided in 3GPP TS 23.228 [2]. The flows focus on
a basic session setup, i.e. no flows will be provided for topology hiding, for
sessions with IBCF involved or for sessions having certain features.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TS 24.229: \"IP Multimedia Call Control Protocol based on SIP and
SDP; Stage 3\".
[2] 3GPP TS 24.228 Release 5: \"Signalling flows for the IP multimedia call
control based on Session Initiation Protocol (SIP) and Session Description
Protocol (SDP) - Stage 3\".
[3] 3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".
[4] IETF RFC 3261: \"SIP: Session Initiation Protocol\".
[5] IETF RFC 3312: \"Integration of Resource Management and **Session
Initiation Protocol** (SIP)\".
[6] IETF RFC 3262: \"Reliability of Provisional Responses in **Session
Initiation Protocol** (SIP)\".
[7] IETF RFC 3311: \"The Session Initiation Protocol (SIP) UPDATE Method\".
[8] IETF RFC 3264: \"An Offer/Answer Model with **Session Description
Protocol** (SDP)\".
[9] RFC 4032 (March 2005): \"Update to the Session Initiation Protocol (SIP)
Preconditions Framework\".
[10] draft-ietf-mmusic-sdp-capability-negotiation-08 (December 2007): \"SDP
Capability Negotiation\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the [following] terms and
definitions [given in ... and the following] apply.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
## 3.3 Abbreviations
For the purposes of the present document, the following abbreviations apply:
AMR Adaptive Multi-Rate
AS Application Server
CN Core Network
CSCF Call Session Control Function
DSL Digital Subscriber Line
FQDN Fully Qualified Domain Name
HSS Home Subscriber Server
HTTP Hyper Text Transfer Protocol
I-CSCF Interrogating CSCF
IM IP Multimedia
IMS IP Multimedia CN subsystem
IP Internet Protocol
IP-CAN IP-Connectivity Access Network
MGCF Media Gateway Control Function
MRFC Multimedia Resource Function Controller
MRFP Multimedia Resource Function Processor
NGN Next Generation Network
PCRF Policy and Charging Rules Function
P-CSCF Proxy CSCF
PSI Public Service Identity
S-CSCF Serving CSCF
SDP Session Description Protocol
SIP Session Initiation Protocol
UE User Equipment
# 4 Methodology
## 4.1 General
The signalling flows provided in this document follow the methodology
developed in 3GPP TS 24.228 [2]. The following additional considerations
apply:
a) 3GPP TS 24.228 [2] shows separate signalling flows with no configuration
hiding between networks, and with configuration hiding between networks.
Separate signalling flows are not shown in the present document;
b) 3GPP TS 24.228 [2] breaks down the functionality of the various CSCFs. The
functionality of the S-CSCF and I-CSCF is not relevant for the session setup
procedure. Therefore S-CSCFs and I-CSCFs are collapsed into a single entity
labelled \"Intermediate IM CN subsystem entities\".
## 4.2 Key required to interpret signalling flows
The key to interpret signalling flows specified in 3GPP TS 24.228 [2]
subclauses 4.1 and 4.2 applies.
Each signalling flow table contains descriptions for headers where the content
of the header is new to that signalling flow, as is already performed in 3GPP
TS 24.228 [2].
However, 3GPP TS 24.228 [3] includes extensive descriptions for the contents
of various headers following each of the tables representing the contents of
the signalling flows. Where the operation of the header is identical to that
shown in 3GPP TS 24.228 [2], then such text is not reproduced in the present
document.
Additional text may also be found on the contents of headers within 3GPP TS
24.228 [2] in addition to the material shown in the present document.
In order to differentiate between messages for SIP and media, the notation in
figure 4.1-1 is used.
Figure 4.1-1: Signalling flow notation
# 5 Signalling flows for session initiation
## 5.1 Establishing a session when UE#1 and UE#2 do not have required
resources available
### 5.1.1 Introduction
The following flows show the establishment of a session where UE#1 and UE#2 do
not yet have the required local resources available and need to perform
resource reservation. In subclause 5.1.2 both UEs will initiate the IP-CAN
bearer setup. In subclause 5.1.3 the network will initiate the IP-CAN bearer
setup for UE#1.
It is assumed that both the originating UE and terminating UE are using a
dedicated IP-CAN bearer for SIP signalling and a dedicated IP-CAN bearer for
media.
The box \"Intermediate IM CN subsystem entities\" stands for the combination
of I-CSCF/S-CSCF on the originating and on the terminating side. Routing of
messages between those nodes is not described in the flow below.
### 5.1.2 UE initiated IP-CAN bearer setup
#### 5.1.2.1 Introduction
This subclause shows the establishment of a session where UE#1 and UE#2 need
to reserve local resources. In subclause 5.1.2.3 the SDP capability
negotiations [10] mechanism is used and supported by both UE#1 and UE#2. In
sublcause 5.1.2.4 only UE#1 supports the mechanism.
#### 5.1.2.2 SDP capability negotiation not supported by UE#1
Figure 5.1.2.2-1: IMS session setup, resource reservation on both sides
The details of the signalling flows are as follows:
1\. **INVITE request (UE#1 to P-CSCF#1) see example in table 5.1.2.2-1**
For this example, it is assumed that UE#1 is willing to establish a multimedia
session comprising a video stream and an audio stream. The video stream
supports two codecs, either H.263 or MPEG-4 Visual. The audio stream supports
the AMR codec. For the video stream AVPF is offered and for the audio stream
AVP is offered.
UE#1indicates that it supports precondition and it indicates that it supports
reliable provisional responses. However, it does not use the \"Require" header
for these capabilities.
UE#1 does not have available the resources that are necessary to transport the
media.
UE#2 supports both AVP and AVPF and supports SDP capability negotiation and
since only AVPF is being offered for video and only AVP is offered for audio
UE#2 therefore accepts AVPF for video and AVP for audio.
For this example it is assumed, that signalling encryption was negotiated
between UE and P‑CSCF in the security mode set-up procedure during the last
successful authentication. This option will only be shown in this example.
Table 5.1.2.2-1: INVITE request (UE#1 to P-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98 99
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=rtpmap:99 MP4V-ES
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for the "precondition" mechanism, the
support for reliable provisional responses and the support for the 199 (Early
Dialog Terminated) response code.
**SDP** The SDP contains a set of codecs supported by UE#1 and desired by the
user at UE#1 for this session. As the local preconditions are not fulfilled,
both media are set to \"inactive\".
**Security-Verify:** The Security-Verify contains the content of the Security-
Server header as received during last successful authentication. It indicates
that integrity protection and encryption are in use for this session.
2\. **100 (Trying) response (P-CSCF#1 to UE#1)**
The P-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
  1. **INVITE request (P-CSCF#1 to S-CSCF#1) - see example in table 5.1.2.2-2**
Table 5.1.2.2-2: INVITE request (P-CSCF#1 to S-CSCF#1)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> P-Asserted-Identity: \"John Doe\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
4\. **100 (Trying) response (S-CSCF#1 to P-CSCF#1)**
The S-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
5\. **INVITE request (S-CSCF#2 to P-CSCF#2) see example in table 5.1.2.2-3**
Table 5.1.2.2-3: INVITE request (S-CSCF#2 to P-CSCF#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> Record-Route: \, \,
> \
>
> P-Asserted-Identity:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> P-Called-Party-ID: \
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
6\. **100 (Trying) response (P-CSCF#2 to S-CSCF#2)**
The P-CSCF#2 responds to the INVITE request with a 100 (Trying) provisional
response.
7\. **INVITE request (P-CSCF#2 to UE #2) - see example in table 5.1.2.2-4**
P-CSCF#2 forwards the INVITE request to UE#2.
Table 5.1.2.2-4: INVITE request (P-CSCF#2 to UE#2)
> INVITE sip:user2_public1\@home2.net SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 65
>
> Route: \
>
> Record-Route: \,
> \, \,
> \
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
8**. 100 (Trying) response (UE#2 to P-CSCF)**
The UE responds to the INVITE request with a 100 (Trying) provisional
response.
9**. 183 (Session Progress) response (UE#2 to P-CSCF) - - see example in table
5.1.2.2-5**
UE#2 determines the complete set of codecs that it is capable of supporting
for this session. It determines the intersection with those appearing in the
SDP in the INVITE request. UE#2 makes the final codec selection and chooses
H.263 and AMR.
UE#2 responds with a 183 (Session Progress) response containing SDP back to
the originator. This response is sent to P-CSCF. UE#2 uses a conf line in the
SDP to request a confirmation from UE#1 when the local resources are available
at UE#1.
Table 5.1.2.2-5: 183 (Session Progress) response (UE#2 to P-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> CSeq:
>
> Require: 100rel, precondition
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933623 2987933623 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 10001 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 6544 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
10\. **Reserve IP-CAN bearer for media**
The terminating UA sets up the bearer in accordance with the media description
received SDP.
11\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
  1. **183 (session progress) response (P-CSCF#" to S-CSCF#2) -- see example in table 5.1.2.2-6**
Table 5.1.2.2-6: 183 (Session Progress) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity: \"John Smith\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> **13\. 183 (session progress) response (S-CSCF#1 to P-CSCF#1) -- see example
> in table 5.1.2.2-7**
Table 5.1.2.2-7: 183 (Session Progress) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7)
>
> Record-Route:
>
> P-Asserted-Identity:
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
14\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
  1. **183 (Session Progress) response (P-CSCF to UE) -- see example in table 5.1.2.2-8**
Table 5.1.2.2-8: 183 (Session Progress) response (P-CSCF#1 to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
16\. **Reserve IP-CAN bearer for media**
The originating UE sets up the bearer in accordance with the media description
received SDP.
17 -24. **PRACK request / 200(OK) response exchange**
The PRACK request does not carry SDP as the final codec decision is already
made as part of the initial offer/answer exchange.
25\. **UPDATE request (UE#1 to P-CSCF#1) - see example in table 5.1.2.2-9**
UE#1 indicates that it can send and receive media as the necessary resources
are available.
Table 5.1.2.2-9: UPDATE request (UE#1 to P-CSCF#1)
> UPDATE \
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> From: \; tag=171828
>
> To: \ tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 129 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrececv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
  1. **UPDATE request (P-CSCF#1 to S-CSCF#1 ) - see example in table 5.1.2.2-10**
Table 5.1.2.2-10: UPDATE request (P-CSCF#1 to S-CSCF#1)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";
> ggsn=[5555::4b4:3c3:2d2:1e1]; pdp-sig=no; gcid=723084371; auth-
> token=43876559; flow-id=3
>
> Route: \, \,
> \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
27\. **UPDATE request (S-CSCF#2 to P-CSCF#2 ) - see example in table
5.1.2.2-11**
Table 5.1.2.2-11: UPDATE request (S-CSCF#2 to P-CSCF#2)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 67
>
> Route: \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Contact:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **28\. UPDATE request (P-CSCF#2 to UE#2 ) - see example in table
> 5.1.2.2-12**
Table 5.1.2.2-12: UPDATE request (S-CSCF#2 to P-CSCF#2)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **29\. 200 (OK) response (UE#2 to P-CSCF#1) - see example in table
> 5.1.2.2-13**
UE acknowledges the UPDATE request with a 200 (OK) response.
UE indicates that the local resources are available
Table 5.1.2.2-13: 200(OK) response (UE to P-CSCF)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From: \;tag=171828
>
> To: \;tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 129 UPDATE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrececv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> **30\. 200 (OK) response (P-CSCF#2 to S-CSCF#2 ) - see example in table
> 5.1.2.2-14**
Table 5.1.2.2-14: 200(OK) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **31\. 200 (OK) response (S-CSCF#1 to P-CSCF#21) - see example in table
> 5.1.2.2-15**
Table 5.1.2.2-15: 200(OK) response (S-CSCF#1 to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **32\. 200 (OK) response (P-CSCF#1 to UE#1) - see example in table
> 5.1.2.2-16**
Table 5.1.2.2-16: 200(OK) response (P-CSCF#1 to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
33 -36 . **180 (Ringing) response**
> UE#2 indicates that it is ringing. The UE#2 does not use Require "100rel" as
> the 180 (Ringing) does not have a SDP and therefore need not to be sent
> reliable.
37 --40 .**200 (OK) response**
When the called party answers the UE sends a 200 (OK) response final response
to the INVITE request (6) to P-CSCF, and starts the media flow(s) for this
session.
> 40-44 **ACK request**
>
> The calling party responds to the 200 (OK) response with an ACK request.
#### 5.1.2.3 SDP capability negotiation supported by UE#1 and UE#2
NOTE: Service specific information is not shown in the messages.
Figure 5.1.2.3-1: IMS session setup, resource reservation on both sides
The details of the signalling flows are as follows:
1\. **INVITE request (UE#1 to P-CSCF#1) see example in table 5.1.2.3-1**
For this example, it is assumed that UE#1 is willing to establish a multimedia
session comprising a video stream and an audio stream. The video stream
supports two codecs, either H.263 or MPEG-4 Visual. The audio stream supports
the AMR codec.
UE#1 indicates, using the SDP capability negotiation mechanism, that it
supports and is willing to use AVPF transport for the video stream and the
audio stream while offering AVP in the media line.
UE#1indicates that it supports precondition and it indicates that it supports
reliable provisional responses. However, it does not use the \"Require" header
for these capabilities.
UE#1 does not have available the resources that are necessary to transport the
media.
UE#2 supports both AVP and AVPF and also supports SDP capability negotiation
and since AVPF is being offered for both video and audio using the SDP
capability negotiation mechanism UE#2 therefore accepts AVPF for both video
and audio.
For this example it is assumed, that signalling encryption was negotiated
between UE and P‑CSCF in the security mode set-up procedure during the last
successful authentication. This option will only be shown in this example.
Table 5.1.2.3-1: INVITE request (UE#1 to P-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98 99
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=rtpmap:99 MP4V-ES
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for the "precondition" mechanism, the
support for reliable provisional responses and the support for the 199 (Early
Dialog Terminated) response code.
**SDP** The SDP contains a set of codecs supported by UE#1 and desired by the
user at UE#1 for this session. As the local preconditions are not fulfilled,
both media are set to \"inactive\".
**Security-Verify:** The Security-Verify contains the content of the Security-
Server header as received during last successful authentication. It indicates
that integrity protection and encryption are in use for this session.
2\. **100 (Trying) response (P-CSCF#1 to UE#1)**
The P-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
> 3\. **INVITE request (P-CSCF#1 to S-CSCF#1) - see example in table
> 5.1.2.3-2**
Table 5.1.2.3-2: INVITE request (P-CSCF#1 to S-CSCF#1)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> P-Asserted-Identity: \"John Doe\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
4\. **100 (Trying) response (S-CSCF#1 to P-CSCF#1)**
The S-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
5\. **INVITE request (S-CSCF#2 to P-CSCF#2) see example in table 5.1.2.3-3**
Table 5.1.2.3-3: INVITE request (S-CSCF#2 to P-CSCF#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> Record-Route: \, \,
> \
>
> P-Asserted-Identity:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> P-Called-Party-ID: \
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
6\. **100 (Trying) response (P-CSCF#2 to S-CSCF#2)**
The P-CSCF#2 responds to the INVITE request with a 100 (Trying) provisional
response.
7\. **INVITE request (P-CSCF#2 to UE #2) - see example in table 5.1.2.3-4**
P-CSCF#2 forwards the INVITE request to UE#2.
Table 5.1.2.3-4: INVITE request (P-CSCF#2 to UE#2)
> INVITE sip:user2_public1\@home2.net SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 65
>
> Route: \
>
> Record-Route: \,
> \, \,
> \
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
8**. 100 (Trying) response (UE#2 to P-CSCF)**
The UE responds to the INVITE request with a 100 (Trying) provisional
response.
9**. 183 (Session Progress) response (UE#2 to P-CSCF) - - see example in table
5.1.2.3-5**
UE#2 determines the complete set of codecs that it is capable of supporting
for this session. It determines the intersection with those appearing in the
SDP in the INVITE request. UE#2 makes the final codec selection and chooses
H.263 and AMR.
UE#2 supports the SDP capability negotiation mechanism, and is willing to use
AVPF transport. It indicates the selection of AVPF in the SDP answer.
UE#2 responds with a 183 (Session Progress) response containing SDP back to
the originator. This response is sent to P-CSCF. UE#2 uses a conf line in the
SDP to request a confirmation from UE#1 when the local resources are available
at UE#1.
Table 5.1.2.3-5: 183 (Session Progress) response (UE#2 to P-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> CSeq:
>
> Require: 100rel, precondition
>
> Contact: \ 2ad8950e-48a5-4a74-8d99-ad76cc7fc74c;comp=sigcomp>
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933623 2987933623 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 10001 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 6544 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
10\. **Reserve IP-CAN bearer for media**
The terminating UA sets up the bearer in accordance with the media description
received SDP.
11\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
> **12 183 (session progress) response (P-CSCF#" to S-CSCF#2) -- see example
> in table 5.1.2.3-6**
Table 5.1.2.3-6: 183 (Session Progress) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity: \"John Smith\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> **13\. 183 (session progress) response (S-CSCF#1 to P-CSCF#1) -- see example
> in table 5.1.2.3-7**
Table 5.1.2.3-7: 183 (Session Progress) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity:
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
14\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
> 15 **183 (Session Progress) response (P-CSCF to UE) -- see example in table
> 5.1.2.3-8**
Table 5.1.2.3-8: 183 (Session Progress) response (P-CSCF#1 to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
16\. **Reserve IP-CAN bearer for media**
The originating UE sets up the bearer in accordance with the media description
received SDP.
17 -24. **PRACK request / 200(OK) response exchange**
The PRACK request does not carry SDP as the final codec decision is already
made as part of the initial offer/answer exchange.
25\. **UPDATE request (UE#1 to P-CSCF#1) - see example in table 5.1.2.3-9**
UE#1 indicates that it can send and receive media as the necessary resources
are available.
UE#1 indicates that AVPF transport is used for the video stream and the audio
stream.
Table 5.1.2.3-9: UPDATE request (UE#1 to P-CSCF#1)
> UPDATE \
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> From: \; tag=171828
>
> To: \ tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 129 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrececv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> **26 UPDATE request (P-CSCF#1 to S-CSCF#1 ) - see example in table
> 5.1.2.3-10**
Table 5.1.2.3-10: UPDATE request (P-CSCF#1 to S-CSCF#1)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";
> ggsn=[5555::4b4:3c3:2d2:1e1]; pdp-sig=no; gcid=723084371; auth-
> token=43876559; flow-id=3
>
> Route: \, \,
> \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
27\. **UPDATE request (S-CSCF#2 to P-CSCF#2 ) - see example in table
5.1.2.3-11**
Table 5.1.2.3-11: UPDATE request (S-CSCF#2 to P-CSCF#2)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 67
>
> Route: \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Contact:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **28\. UPDATE request (P-CSCF#2 to UE#2 ) - see example in table
> 5.1.2.3-12**
Table 5.1.2.3-12: UPDATE request (S-CSCF#2 to P-CSCF#2)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **29\. 200 (OK) response (UE#2 to P-CSCF#1) - see example in table
> 5.1.2.3-13**
UE#2 acknowledges the UPDATE request with a 200 (OK) response.
UE#2 indicates that the local resources are available.
UE#2 indicates that AVPF transport is used for the video stream and the audio
stream.
Table 5.1.2.3-13: 200(OK) response (UE to P-CSCF)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From: \;tag=171828
>
> To: \;tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 129 UPDATE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrececv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> **30\. 200 (OK) response (P-CSCF#2 to S-CSCF#2 ) - see example in table
> 5.1.2.3-14**
Table 5.1.2.3-14: 200(OK) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **31\. 200 (OK) response (S-CSCF#1 to P-CSCF#21) - see example in table
> 5.1.2.3-15**
Table 5.1.2.3-15: 200(OK) response (S-CSCF#1 to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **32\. 200 (OK) response (P-CSCF#1 to UE#1) - see example in table
> 5.1.2.3-16**
Table 5.1.2.3-16: 200(OK) response (P-CSCF#1 to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
33 -36 . **180 (Ringing) response**
> UE#2 indicates that it is ringing. The UE#2 does not use Require "100rel" as
> the 180 (Ringing) does not have a SDP and therefore need not to be sent
> reliable.
37 --40 .**200 (OK) response**
When the called party answers the UE sends a 200 (OK) response final response
to the INVITE request (6) to P-CSCF, and starts the media flow(s) for this
session.
> 40-44 **ACK request**
>
> The calling party responds to the 200 (OK) response with an ACK request.
#### 5.1.2.4 SDP capability negotiation only supported by UE#1
NOTE: Service specific information is not shown in the messages.
Figure 5.1.2.4-1: IMS session setup, resource reservation on both sides
The details of the signalling flows are as follows:
1\. **INVITE request (UE#1 to P-CSCF#1) see example in table 5.1.2.4-1**
For this example, it is assumed that UE#1 is willing to establish a multimedia
session comprising a video stream and an audio stream. The video stream
supports two codecs, either H.263 or MPEG-4 Visual. The audio stream supports
the AMR codec.
UE#1 indicates, using the SDP capability negotiation mechanism, that it
supports and is willing to use AVPF transport for the video stream and the
audio stream while offering AVP in the media line.
UE#1indicates that it supports precondition and it indicates that it supports
reliable provisional responses. However, it does not use the \"Require" header
for these capabilities.
UE#1 does not have available the resources that are necessary to transport the
media.
UE#2 supports both AVP and AVPF but since it does not support SDP capability
negotiation it cannot understand that AVPF is also being offered for video and
therefore accepts AVP for video.
For this example it is assumed, that signalling encryption was negotiated
between UE and P‑CSCF in the security mode set-up procedure during the last
successful authentication. This option will only be shown in this example.
Table 5.1.2.4-1: INVITE request (UE#1 to P-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98 99
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=rtpmap:99 MP4V-ES
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for the "precondition" mechanism, the
support for reliable provisional responses and the support for the 199 (Early
Dialog Terminated) response code.
**SDP** The SDP contains a set of codecs supported by UE#1 and desired by the
user at UE#1 for this session. As the local preconditions are not fulfilled,
both media are set to \"inactive\".
**Security-Verify:** The Security-Verify contains the content of the Security-
Server header as received during last successful authentication. It indicates
that integrity protection and encryption are in use for this session.
2\. **100 (Trying) response (P-CSCF#1 to UE#1)**
The P-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
  1. **INVITE request (P-CSCF#1 to S-CSCF#1) - see example in table 5.1.2.4-2**
Table 5.1.2.4-2: INVITE request (P-CSCF#1 to S-CSCF#1)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> P-Asserted-Identity: \"John Doe\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
4\. **100 (Trying) response (S-CSCF#1 to P-CSCF#1)**
The S-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
5\. **INVITE request (S-CSCF#2 to P-CSCF#2) see example in table 5.1.2.4-3**
Table 5.1.2.4-3: INVITE request (S-CSCF#2 to P-CSCF#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> Record-Route: \, \,
> \
>
> P-Asserted-Identity:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> P-Called-Party-ID: \
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
6\. **100 (Trying) response (P-CSCF#2 to S-CSCF#2)**
The P-CSCF#2 responds to the INVITE request with a 100 (Trying) provisional
response.
7\. **INVITE request (P-CSCF#2 to UE #2) - see example in table 5.1.2.4-4**
P-CSCF#2 forwards the INVITE request to UE#2.
Table 5.1.2.4-4: INVITE request (P-CSCF#2 to UE#2)
> INVITE sip:user2_public1\@home2.net SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 65
>
> Route: \
>
> Record-Route: \,
> \, \,
> \
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
8**. 100 (Trying) response (UE#2 to P-CSCF)**
The UE responds to the INVITE request with a 100 (Trying) provisional
response.
9**. 183 (Session Progress) response (UE#2 to P-CSCF) - - see example in table
5.1.2.4-5**
UE#2 determines the complete set of codecs that it is capable of supporting
for this session. It determines the intersection with those appearing in the
SDP in the INVITE request. UE#2 makes the final codec selection and chooses
H.263 and AMR.
UE#2 does not support the SDP capability negotiation mechanism, and is not
aware that UE#1 is willing to use AVPF transport. It indicates the selection
of AVP in the SDP answer.
UE#2 responds with a 183 (Session Progress) response containing SDP back to
the originator. This response is sent to P-CSCF. UE#2 uses a conf line in the
SDP to request a confirmation from UE#1 when the local resources are available
at UE#1.
Table 5.1.2.4-5: 183 (Session Progress) response (UE#2 to P-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> CSeq:
>
> Require: 100rel, precondition
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933623 2987933623 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 10001 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 6544 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
10\. **Reserve IP-CAN bearer for media**
The terminating UA sets up the bearer in accordance with the media description
received SDP.
11\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
> **12 183 (session progress) response (P-CSCF#" to S-CSCF#2) -- see example
> in table 5.1.2.4-6**
Table 5.1.2.4-6: 183 (Session Progress) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity: \"John Smith\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> **13\. 183 (session progress) response (S-CSCF#1 to P-CSCF#1) -- see example
> in table 5.1.2.4-7**
Table 5.1.2.4-7: 183 (Session Progress) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity:
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
14\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
> 15 **183 (Session Progress) response (P-CSCF to UE) -- see example in table
> 5.1.2.4-8**
Table 5.1.2.4-8: 183 (Session Progress) response (P-CSCF#1 to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
16\. **Reserve IP-CAN bearer for media**
The originating UE sets up the bearer in accordance with the media description
received SDP.
17 -24. **PRACK request / 200(OK) response exchange**
The PRACK request does not carry SDP as the final codec decision is already
made as part of the initial offer/answer exchange.
25\. **UPDATE request (UE#1 to P-CSCF#1) - see example in table 5.1.2.4-9**
UE#1 indicates that it can send and receive media as the necessary resources
are available.
Table 5.1.2.4-9: UPDATE request (UE#1 to P-CSCF#1)
> UPDATE \
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> From: \; tag=171828
>
> To: \ tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 129 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrececv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> **26 UPDATE request (P-CSCF#1 to S-CSCF#1 ) - see example in table
> 5.1.2.4-10**
Table 5.1.2.4-10: UPDATE request (P-CSCF#1 to S-CSCF#1)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";
> ggsn=[5555::4b4:3c3:2d2:1e1]; pdp-sig=no; gcid=723084371; auth-
> token=43876559; flow-id=3
>
> Route: \, \,
> \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
27\. **UPDATE request (S-CSCF#2 to P-CSCF#2 ) - see example in table
5.1.2.4-11**
Table 5.1.2.4-11: UPDATE request (S-CSCF#2 to P-CSCF#2)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 67
>
> Route: \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Contact:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **28\. UPDATE request (P-CSCF#2 to UE#2 ) - see example in table
> 5.1.2.4-12**
Table 5.1.2.4-12: UPDATE request (S-CSCF#2 to P-CSCF#2)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **29\. 200 (OK) response (UE#2 to P-CSCF#1) - see example in table
> 5.1.2.4-13**
UE#2 acknowledges the UPDATE request with a 200 (OK) response.
UE#2 indicates that the local resources are available.
Table 5.1.2.4-13: 200(OK) response (UE to P-CSCF)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From: \;tag=171828
>
> To: \;tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 129 UPDATE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrececv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> **30\. 200 (OK) response (P-CSCF#2 to S-CSCF#2 ) - see example in table
> 5.1.2.4-14**
Table 5.1.2.4-14: 200(OK) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **31\. 200 (OK) response (S-CSCF#1 to P-CSCF#21) - see example in table
> 5.1.2.4-15**
Table 5.1.2.4-15: 200(OK) response (S-CSCF#1 to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **32\. 200 (OK) response (P-CSCF#1 to UE#1) - see example in table
> 5.1.2.4-16**
Table 5.1.2.4-16: 200(OK) response (P-CSCF#1 to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
33 -36 . **180 (Ringing) response**
> UE#2 indicates that it is ringing. The UE#2 does not use Require "100rel" as
> the 180 (Ringing) does not have a SDP and therefore need not to be sent
> reliable.
37 --40 .**200 (OK) response**
When the called party answers the UE sends a 200 (OK) response final response
to the INVITE request (6) to P-CSCF, and starts the media flow(s) for this
session.
> 40-44 **ACK request**
>
> The calling party responds to the 200 (OK) response with an ACK request.
### 5.1.3 Network initiated IP-CAN bearer setup
{width="6.006944444444445in" height="7.413888888888889in"}
**Figure** 5.1.3-1: IMS session setup, resource reservation on both sides
The details of the signalling flows are as follows:
1\. **INVITE request (UE#1 to P-CSCF#1) see example in table 5.1.3-1**
For this example, it is assumed that UE#1 is willing to establish a multimedia
session comprising a video stream and an audio stream. The video stream
supports two codecs, either H.263 or MPEG-4 Visual. The audio stream supports
the AMR codec.
UE#1indicates that it supports precondition and it indicates that it supports
reliable provisional responses. However, it does not use the \"Require" header
for these capabilities.
UE#1 does not have available the resources that are necessary to transport the
media.
For this example it is assumed, that signalling encryption was negotiated
between UE and P‑CSCF in the security mode set-up procedure during the last
successful authentication. This option will only be shown in this example.
Table 5.1.3-1: INVITE request (UE#1 to P-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98 99
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=rtpmap:99 MP4V-ES
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for the "precondition" mechanism,the
support for reliable provisional responses and the support for the 199 (Early
Dialog Terminated) response code.
**SDP** The SDP contains a set of codecs supported by UE#1 and desired by the
user at UE#1 for this session. As the local preconditions are not fulfilled,
both media are set to \"inactive\".
**Security-Verify:** The Security-Verify contains the content of the Security-
Server header as received during last successful authentication. It indicates
that integrity protection and encryption are in use for this session.
2\. **100 (Trying) response (P-CSCF#1 to UE#1)**
The P-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
  1. **INVITE request (P-CSCF#1 to S-CSCF#1) - see example in table 5.1.3-2**
Table 5.1.3-2: INVITE request (P-CSCF#1 to S-CSCF#1)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> P-Asserted-Identity: \"John Doe\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
4\. **100 (Trying) response (S-CSCF#1 to P-CSCF#1)**
The S-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
5\. **INVITE request (S-CSCF#2 to P-CSCF#2) see example in table 5.1.3-3**
Table 5.1.3-3: INVITE request (S-CSCF#2 to P-CSCF#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> Record-Route: \, \,
> \
>
> P-Asserted-Identity:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> P-Called-Party-ID: \
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
6\. **100 (Trying) response (P-CSCF#2 to S-CSCF#2)**
The P-CSCF#2 responds to the INVITE request with a 100 (Trying) provisional
response.
7\. **INVITE request (P-CSCF#2 to UE #2) - see example in table 5.1.3-4**
P-CSCF#2 forwards the INVITE request to UE#2.
Table 5.1.3-4: INVITE request (P-CSCF#2 to UE#2)
> INVITE sip:user2_public1\@home2.net SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 65
>
> Route: \
>
> Record-Route: \,
> \, \,
> \
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
8**. 100 (Trying) response (UE#2 to P-CSCF)**
The UE responds to the INVITE request with a 100 (Trying) provisional
response.
9**. 183 (Session Progress) response (UE#2 to P-CSCF) - - see example in table
5.1.3-5**
UE#2 determines the complete set of codecs that it is capable of supporting
for this session. It determines the intersection with those appearing in the
SDP in the INVITE request. UE#2 makes the final codec selection and chooses
H.263 and AMR.
UE#2 responds with a 183 (Session Progress) response containing SDP back to
the originator. This response is sent to P-CSCF. UE#2 uses a conf line in the
SDP to request a confirmation from UE#1 when the local resources are available
at UE#1.
Table 5.1.3-5: 183 (Session Progress) response (UE#2 to P-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> CSeq:
>
> Require: 100rel, precondition
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933623 2987933623 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 10001 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 6544 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
10\. **Reserve IP-CAN bearer for media**
The terminating UA sets up the bearer in accordance with the media description
received SDP.
11\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
> **12 (session progress) response (P-CSCF#" to S-CSCF#2) -- see example in
> table 5.1.3-6**
Table 5.1.3-6: 183 (Session Progress) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity: \"John Smith\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> **13\. 183 (session progress) response (S-CSCF#1 to P-CSCF#1) -- see example
> in table 5.1.3-7**
Table 5.1.3-7: 183 (Session Progress) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity:
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
14-15. **Authorize QoS and initiate IP-CAN bearer**
P-CSCF authorises the respective IP flows and provides the QoS requirements
for the resources necessary for this session.
In this case, this triggers the IP-CAN to initiate the reservation of required
resources, including the initiation of an IP-CAN bearer setup or the
modification of an existing one.
  1. **183 (Session Progress) response (P-CSCF to UE) -- see example in table 5.1.3-8**
Table 5.1.3-8: 183 (Session Progress) response (P-CSCF#1 to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
17 -24. **PRACK request / 200(OK) response exchange**
The PRACK request does not carry SDP as the final codec decision is already
made as part of the initial offer/answer exchange.
25\. **UPDATE request (UE#1 to P-CSCF#1) - see example in table 5.1.3-9**
UE#1 indicates, when it has received from the network an indication that an
IP-CAN with necessary quality of service has been established, that it can
send and receive media as the necessary resources are available.
Table 5.1.3-9: UPDATE request (UE#1 to P-CSCF#1)
> UPDATE \
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> From: \; tag=171828
>
> To: \ tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 129 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrececv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> **26 UPDATE request (P-CSCF#1 to S-CSCF#1 ) - see example in table
> 5.1.3-10**
Table 5.1.3-10: UPDATE request (P-CSCF#1 to S-CSCF#1)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";
> ggsn=[5555::4b4:3c3:2d2:1e1]; pdp-sig=no; gcid=723084371; auth-
> token=43876559; flow-id=3
>
> Route: \, \,
> \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
27\. **UPDATE request (S-CSCF#2 to P-CSCF#2 ) - see example in table
5.1.3-11**
Table 5.1.3-11: UPDATE request (S-CSCF#2 to P-CSCF#2)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 67
>
> Route: \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Contact:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **28\. UPDATE request (P-CSCF#2 to UE#2) - see example in table 5.1.3-12**
Table 5.1.3-12: UPDATE request (S-CSCF#2 to P-CSCF#2)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **29\. 200 (OK) response (UE#2 to P-CSCF#1) - see example in table
> 5.1.3-13**
UE acknowledges the UPDATE request with a 200 (OK) response.
UE indicates that the local resources are available
Table 5.1.3-13: 200(OK) response (UE to P-CSCF)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From: \;tag=171828
>
> To: \;tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 129 UPDATE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrececv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> **30\. 200 (OK) response (P-CSCF#2 to S-CSCF#2) - see example in table
> 5.1.3-14**
Table 5.1.3-14: 200(OK) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **31\. 200 (OK) response (S-CSCF#1 to P-CSCF#21) - see example in table
> 5.1.3-15**
Table 5.1.3-15: 200(OK) response (S-CSCF#1 to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **32\. 200 (OK) response (P-CSCF#1 to UE#1) - see example in table
> 5.1.3-16**
Table 5.1.3-16: 200(OK) response (P-CSCF#1 to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
33 -36. **180 (Ringing) response**
> UE#2 indicates that it is ringing. The UE#2 does not use Require "100rel" as
> the 180 (Ringing) response does not have a SDP and therefore need not to be
> sent reliable.
37 --40. **200 (OK) response**
When the called party answers the UE sends a 200 (OK) response final response
to the INVITE request (6) to P-CSCF, and starts the media flow(s) for this
session.
> 40-44. **ACK request**
>
> The calling party responds to the 200 (OK) response with an ACK request.
## 5.2 Establishing a session when UE#1 does not have required resources
available while UE#2 has resources already available
### 5.2.1 Introduction
The flow in subclause 5.2.2 shows the establishment of a session where does
not yet have the required local resources available and UE#1 needs perform to
resource reservation (e.g. using a GRPS IP-CAN) while UE#2 already has the
required local resources available and does not need to perform resource
reservation (e.g. connected via IWLAN IP-CAN). This call flow assumes that
UE#1 does not have resource ready before sending the PRACK request to the
first reliable provisional response.
The flow in subclause 5.2.3 shows the establishment of a session where UE#1
needs to reserve local resources while UE#2 does not need to perform resource
reservation (e.g. connected via IWLAN IP-CAN). This call flow assumes that the
UE#1 has resources ready before sending the PRACK request to the first
reliable provisional response.
The box \"Intermediate IM CN subsystem entities\" stands for the combination
of I-CSCF/S-CSCF on the originating and on the terminating side. Routing of
messages between those nodes is not described in the flow below.
### 5.2.2 Signalling flow with UPDATE request
Figure 5.1-1: IMS session setup, resource reservation on originating side only
The details of the signalling flows are as follows:
1\. **INVITE request (UE#1 to P-CSCF#1) see example in table 5.2-1**
For this example, it is assumed that UE#1 is willing to establish a multimedia
session comprising a video stream and an audio stream. The video stream
supports H.263 codec. The audio stream supports the AMR codec.
UE#1indicates that it supports precondition and it indicates that it supports
reliable provisional responses. However, it does not use the \"Require" header
for these capabilities.
UE#1 does not have available the resources that are necessary to transport the
media.
Table 5.2-1: INVITE request (UE#1 to P-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Supported: 100rel
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for the "precondition" mechanism,the
support for reliable provisional responses and the support for the 199 (Early
Dialog Terminated) response code.
**SDP** The SDP contains a set of codecs supported by UE#1 and desired by the
user at UE#1 for this session. As the local preconditions are not fulfilled,
both media are set to \"inactive\".
2\. **100 (Trying) response (P-CSCF#1 to UE#1)**
The P-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
> 3**. INVITE request (P-CSCF#1 to S-CSCF#1) - see example in table 5.2-2**
Table 5.2-2: INVITE request (P-CSCF#1 to S-CSCF#1)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> P-Asserted-Identity: \"John Doe\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require: precondition
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
4\. **100 (Trying) response (S-CSCF#1 to P-CSCF#1)**
The S-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
5\. **INVITE request (S-CSCF#2 to P-CSCF#2) see example in table 5.2-3**
Table 5.2-3: INVITE request (S-CSCF#2 to P-CSCF#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> Record-Route: \, \,
> \
>
> P-Asserted-Identity:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> P-Called-Party-ID: \
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
6\. **100 (Trying) response (P-CSCF#2 to S-CSCF#2)**
The P-CSCF#2 responds to the INVITE request with a 100 (Trying) provisional
response.
7\. **INVITE request (P-CSCF#2 to UE #2) - see example in table 5.2-4**
P-CSCF#2 forwards the INVITE request to UE#2.
Table 5.2-4: INVITE request (P-CSCF#2 to UE#2
> INVITE sip:user2_public1\@home2.net SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 65
>
> Route: \
>
> Record-Route: \,
> \, \,
> \
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
8\. **100 (Trying) response (UE#2 to P-CSCF)**
The UE responds to the INVITE request with a 100 (Trying) provisional
response.
9\. **183 (Session Progress) response (UE#2 to P-CSCF) - - see example in
table 5.2-5**
UE#2 determines the complete set of codecs that it is capable of supporting
for this session. It determines the intersection with those appearing in the
SDP in the INVITE request. UE#2 supports both offered media streams
UE#2 responds with a 183 (Session Progress) response containing SDP back to
the originator. This response is sent to P-CSCF. UE#2 uses a conf line in the
SDP to request a confirmation from UE#1 when the local resources are available
at UE#1.
UE#2 has all necessary resources available and indicates that in the SDP
Table 5.2-5: 183 (Session Progress) response (UE#2 to P-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> P-Access-Network-Info: IEEE-802.11a
>
> Privacy: none
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> CSeq:
>
> Require: 100rel, precondition
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933623 2987933623 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 10001 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 6544 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> **10\. 183 (session progress) response (P-CSCF#2 to S-CSCF#2) -- see example
> in table 5.2-6**
Table 5.2-6: 183 (Session Progress) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity: \"John Smith\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **11\. 183 (session progress) response (S-CSCF#1 to P-CSCF#1) -- see example
> in table 5.2-7**
Table 5.2-7: 183 (Session Progress) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity:
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
12\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
> 13**. 183 (Session Progress) response (P-CSCF to UE) -- see example in table
> 5.2-8**
Table 5.2-8: 183 (Session Progress) response (P-CSCF#1 to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
14\. **Reserve IP-CAN bearer for media**
The originating UE sets up the bearer in accordance with the media description
received SDP.
15 -22. **PRACK request / 200(OK) response exchange**
The PRACK request does not carry SDP as the final codec decision is already
made as part of the initial offer/answer exchange.
23\. **UPDATE request (UE#1 to P-CSCF#1 ) - see example in table 5.2-9**
UE#1 indicates that it can send and receive media as the necessary resources
are available.
Table 5.2-9: UPDATE request (UE#1 to P-CSCF#1)
> UPDATE \
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> From: \; tag=171828
>
> To: \ tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 129 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi=87654321;
> port1=7531
>
> Contact:
> \
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrececv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> **24\. UPDATE request (P-CSCF#1 to S-CSCF#1 ) - see example in table
> 5.2-10**
Table 5.2-10: UPDATE request (P-CSCF#1 to S-CSCF#1)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";
> ggsn=[5555::4b4:3c3:2d2:1e1]; pdp-sig=no; gcid=723084371; auth-
> token=43876559; flow-id=3
>
> Route: \, \,
> \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
25\. **UPDATE request (S-CSCF#2 to P-CSCF#2 ) - see example in table 5.2-11**
Table 5.2-11: UPDATE request (S-CSCF#2 to P-CSCF#2)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 67
>
> Route: \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Contact:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **26\. UPDATE request (P-CSCF#2 to UE#2 ) - see example in table 5.2-12**
Table 5.2-12: UPDATE request (S-CSCF#2 to P-CSCF#2)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **27\. 200 (OK) response (UE#1 to P-CSCF#1) - see example in table 5.2-13**
UE acknowledges the UPDATE request with a 200 (OK) response.
UE indicates that the local resources are available
Table 5.2-13: 200(OK) response (UE to P-CSCF)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From: \; tag=171828
>
> To: \;tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 129 UPDATE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555:: eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrececv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> **28\. 200 (OK) response (P-CSCF#2 to S-CSCF#2 ) - see example in table
> 5.2-14**
Table 5.2-14: 200(OK) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **29\. 200 (OK) response (S-CSCF#1 to P-CSCF#21) - see example in table
> 5.2-15**
Table 5.2-15: 200(OK) response (S-CSCF#1 to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **30\. 200 (OK) response (P-CSCF#1 to UE#1) - see example in table 5.2-16**
Table 5.2-16: 200(OK) response (P-CSCF#1 to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
31 -34 . **180 (Ringing) response**
> UE#2 indicates that it is ringing. The UE#2 does not use Require "100rel" as
> the 180 (Ringing) response does not have a SDP and therefore need not to be
> sent reliable.
35 --38 .**200 (OK) response**
When the called party answers the UE sends a 200 (OK) response final response
to the INVITE request (6) to P-CSCF, and starts the media flow(s) for this
session.
> 39-42 **ACK request**
>
> The calling party responds to the 200 (OK) response with an ACK request.
### 5.2.3 Signalling flow without UPDATE request
Figure 5.2.3-1: IMS session setup, resource reservation on originating side
only
The details of the signalling flows are as follows:
1\. **INVITE request (UE#1 to P-CSCF#1) see example in table 5.2.3-1**
For this example, it is assumed that UE#1 is willing to establish a multimedia
session comprising a video stream and an audio stream. The video stream
supports H.263 codec. The audio stream supports the EVRC codec.
UE#1indicates that it supports precondition and it indicates that it supports
reliable provisional responses. However, it does not use the \"Require" header
for these capabilities.
UE#1 does not have available the resources that are necessary to transport the
media.
Table 5.2.3-1: INVITE request (UE#1 to P-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP2-1X-HRPD;
> ci-3gpp2=1234123412341234123412341234123411
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Supported: 100rel
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 EVRC/8000
>
> a=ptime:20
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for the "precondition" mechanism,the
support for reliable provisional responses and the support for the 199 (Early
Dialog Terminated) response code.
**SDP** The SDP contains a set of codecs supported by UE#1 and desired by the
user at UE#1 for this session. As the local preconditions are not fulfilled,
both media are set to \"inactive\".
2\. **100 (Trying) response (P-CSCF#1 to UE#1)**
The P-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
> 3**. INVITE request (P-CSCF#1 to S-CSCF#1) - see example in table 5.2.3-2**
Table 5.2.3-2: INVITE request (P-CSCF#1 to S-CSCF#1)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> P-Asserted-Identity: \"John Doe\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require: precondition
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
4\. **100 (Trying) response (S-CSCF#1 to P-CSCF#1)**
The S-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
5\. **INVITE request (S-CSCF#2 to P-CSCF#2) see example in table 5.2.3-3**
Table 5.2.3-3: INVITE request (S-CSCF#2 to P-CSCF#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> Record-Route: \, \,
> \
>
> P-Asserted-Identity:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> P-Called-Party-ID: \
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
6\. **100 (Trying) response (P-CSCF#2 to S-CSCF#2)**
The P-CSCF#2 responds to the INVITE request with a 100 (Trying) provisional
response.
7\. **INVITE request (P-CSCF#2 to UE #2) - see example in table 5.2.3-4**
P-CSCF#2 forwards the INVITE request to UE#2.
Table 5.2.3-4: INVITE request (P-CSCF#2 to UE#2)
> INVITE sip:user2_public1\@home2.net SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 65
>
> Route: \
>
> Record-Route: \,
> \, \,
> \
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
8\. **100 (Trying) response (UE#2 to P-CSCF#2)**
The UE responds to the INVITE request with a 100 (Trying) provisional
response.
9\. **183 (Session Progress) response (UE#2 to P-CSCF#2) - - see example in
table 5.2.3-5**
UE#2 determines the complete set of codecs that it is capable of supporting
for this session. It determines the intersection with those appearing in the
SDP in the INVITE request. UE#2 supports both offered media streams
UE#2 responds with a 183 (Session Progress) response containing SDP back to
the originator. This response is sent to P-CSCF. UE#2 uses a conf line in the
SDP to request a confirmation from UE#1 when the local resources are available
at UE#1.
UE#2 has all necessary resources available and indicates that in the SDP
Table 5.2.3-5: 183 (Session Progress) response (UE#2 to P-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> P-Access-Network-Info: IEEE-802.11a
>
> Privacy: none
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> CSeq:
>
> Require: 100rel, precondition
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933623 2987933623 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 10001 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 6544 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:97 EVRC/8000
>
> a=ptime:20
>
> a=rtpmap:96 telephone-event
>
> **10\. 183 (session progress) response (P-CSCF#2 to S-CSCF#2) -- see example
> in table 5.2.3-6**
Table 5.2.3-6: 183 (Session Progress) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity: \"John Smith\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **11\. 183 (session progress) response (S-CSCF#1 to P-CSCF#1) -- see example
> in table 5.2.3-7**
Table 5.2.3-7: 183 (Session Progress) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity:
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> 12**. 183 (Session Progress) response (P-CSCF#1 to UE#1) -- see example in
> table 5.2.3-8**
Table 5.2.3-8: 183 (Session Progress) response (P-CSCF#1 to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
13\. **Resource Reservation Completed**
The originating UE has finished setting up resources in accordance with the
media description required for the session.
14\. **PRACK request (UE#1 to P-CSCF#1) - see example in table 5.2.3-9**
UE#1 indicates that it can send and receive media as the necessary resources
are available.
Table 5.2.3-9: PRACK request (UE#1 to P-CSCF#1)
> PRACK \
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> From: \; tag=171828
>
> To: \ tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 128 PRACK
>
> Require: sec-agree, precondition
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi=87654321;
> port1=7531
>
> RAck: 9021 127 INVITE
>
> Contact:
> \
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrececv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:97 EVRC/8000
>
> a=ptime:20
>
> **15\. PRACK request (P-CSCF#1 to S-CSCF#1) - see example in table
> 5.2.3-10**
Table 5.2.3-10: PRACK request (P-CSCF#1 to S-CSCF#1)
> PRACK sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";
> ggsn=[5555::4b4:3c3:2d2:1e1]; pdp-sig=no; gcid=723084371; auth-
> token=43876559; flow-id=3
>
> Route: \, \,
> \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require: Precondition
>
> RAck:
>
> Contact:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
16\. PRACK **request (S-CSCF#2 to P-CSCF#2) - see example in table 5.2.3-11**
Table 5.2.3-11: PRACK request (S-CSCF#2 to P-CSCF#2)
> PRACK sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 67
>
> Route: \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> RAck:
>
> Contact:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **17\. PRACK request (P-CSCF#2 to UE#2) - see example in table 5.2-12**
Table 5.2.3-12: PRACK request (S-CSCF#2 to P-CSCF#2)
> PRACK sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> RAck:
>
> Contact:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **18\. 200 (OK) response (UE#2 to P-CSCF#2) - see example in table
> 5.2.3-13**
UE#2 acknowledges the PRACK request with a 200 (OK) response.
UE#2 indicates that the local resources are available.
Table 5.2.3-13: 200(OK) response (UE#2 to P-CSCF#2)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: IEEE-802.11a
>
> From: \; tag=171828
>
> To: \;tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 128 PRACK
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555:: eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrececv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:97 EVRC/8000
>
> a=ptime:20
>
> **19\. 200 (OK) response (P-CSCF#2 to S-CSCF#2) - see example in table
> 5.2.3-14**
Table 5.2.3-14: 200(OK) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **20\. 200 (OK) response (S-CSCF#1 to P-CSCF#1) - see example in table
> 5.2.3-15**
Table 5.2.3-15: 200(OK) response (S-CSCF#1 to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **21\. 200 (OK) response (P-CSCF#1 to UE#1) - see example in table
> 5.2.3-16**
Table 5.2.3-16: 200(OK) response (P-CSCF#1 to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
22 - 25 . **180 (Ringing) response**
> UE#2 sends the 180 (Ringing) response.
26 - 29 .**200 (OK) response**
When the called party answers, the UE#2 sends a 200 (OK) response final
response to the INVITE request and starts the media flow(s) for this session.
> 30 - 33 .**ACK request**
>
> The calling party responds to the 200 (OK) response with an ACK request.
## 5.3 Establishing a session when UE#1 has resources available while UE#2
does not have required resources available
### 5.3.1 Introduction
The following flows show the establishment of a session where UE#1 already has
all necessary local resources available (e.g. having an appropriate PDP
context for the desired media available) and does not need to perform resource
reservation while UE#2 does not yet have the required resources available and
has to perform resource reservation.
Flow 5.3.2 shows the case where UE#2 performs resource reservation and uses a
200 (OK) response to the INVITE Request to send the SDP Answer. Flow 5.3.3
shows the case where UE#2 performs resource reservation and uses a 180 Ringing
response to the INVITE Request to send the SDP Answer. Finally, Flow 5.3.4
shows the case where the IP-CAN performs the resource reservation for UE#2 and
UE#2 uses a 183 Session Progress response to the INVITE Request to send the
SDP Answer.
The box \"Intermediate IM CN subsystem entities\" stands for the combination
of I-CSCF/S-CSCF on the originating and on the terminating side. Routing of
messages between those nodes is not described in the flow below.
### 5.3.2 Signalling Flow (with SDP answer in 200 (OK) response for INVITE
request)
Figure 5.3-1: IMS session setup, resource reservation only on terminating side
The details of the signalling flows are as follows:
1\. **INVITE request (UE#1 to P-CSCF#1) see example in table 5.3-1**
For this example, it is assumed that UE#1 is willing to establish a multimedia
session comprising a video stream and an audio stream. The video stream
supports H.263 codec. The audio stream supports the AMR codec.
UE#1indicates that it supports precondition and it indicates that it supports
reliable provisional responses. However, it does not use the \"Require" header
for these capabilities.
UE#1 does have available the resources that are necessary to transport the
media.
Table 5.3-1: INVITE request (UE#1 to P-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel,gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for the "precondition" mechanism,the
support for reliable provisional responses and the support for the 199 (Early
Dialog Terminated) response code.
**SDP** The SDP contains a set of codecs supported by UE#1 and desired by the
user at UE#1 for this session.
2\. **100 (Trying) response (P-CSCF#1 to UE#1)**
The P-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
3\. **INVITE request (P-CSCF#1 to S-CSCF#1) - see example in table 5.3-2**
Table 5.3-2: INVITE request (P-CSCF#1 to S-CSCF#1)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> P-Asserted-Identity: \"John Doe\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
4\. **100 (Trying) response (S-CSCF#1 to P-CSCF#1)**
The S-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
5\. **INVITE request (S-CSCF#2 to P-CSCF#2) see example in table 5.3-3**
Table 5.3-3: INVITE request (S-CSCF#2 to P-CSCF#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> Record-Route: \, \,
> \
>
> P-Asserted-Identity:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> P-Called-Party-ID: \
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
6\. **100 (Trying) response (P-CSCF#2 to S-CSCF#2)**
The P-CSCF#2 responds to the INVITE request with a 100 (Trying) provisional
response.
7\. **INVITE request (P-CSCF#2 to UE #2) - see example in table 5.3-4**
P-CSCF#2 forwards the INVITE request to UE#2.
Table 5.3-4: INVITE request (P-CSCF#2 to UE#2)
> INVITE sip:user2_public1\@home2.net SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 65
>
> Route: \
>
> Record-Route: \,
> \, \,
> \
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
8**. 100 (Trying) response (UE#2 to P-CSCF)**
The UE responds to the INVITE request with a 100 (Trying) provisional
response.
9**. Reserve IP-CAN bearer for media**
The terminating UE sets up the bearer in accordance with the media
description.
10\. -- 13. **180 (Ringing) response**
> UE#2 indicates that it is ringing. The UE#2 does not use Require "100rel" as
> the 180 (Ringing) response does not have a SDP and therefore need not to be
> sent reliable.
  1. **200 (OK) response (UE#2 to P-CSCF#2) - see example in table 5.3-5**
UE indicates that the local resources are available
Table 5.3-5: 200(OK) response (UE to P-CSCF)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555:: eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrececv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
  1. **200 (OK) response (P-CSCF#2 to S-CSCF#2) - see example in table 5.3-6**
Table 5.3-6: 200(OK) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
  1. **200 (OK) response (S-CSCF#1 to P-CSCF#1) - see example in table 5.3-7**
Table 5.3-7: 200(OK) response (S-CSCF#1 to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
  1. **200 (OK) response (P-CSCF#1 to UE#1) - see example in table 5.3-8**
Table 5.3-8: 200(OK) response (P-CSCF#1 to UE#1)
> SIP/2.0 200 OK
>
> Via: [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> 18\. --21**.** . **ACK request**
>
> The calling party responds to the 200 (OK) response with an ACK request.
### 5.3.3 Signalling Flow (with SDP answer in reliable 180 Ringing) response
In the call flow shown in subclause 5.3.2, the SDP answer is returned to UE#1
in the final 200 (OK) response. An alternative call flow is shown in this
section where SDP answer is returned to UE#1 in a reliable 180 (Ringing)
response message.
Figure 5.3-2: IMS session setup, resource reservation only on terminating side
The details of the signalling flows are as follows:
1\. **INVITE request (UE#1 to P-CSCF#1) see example in table 5.3-9**
For this example, it is assumed that UE#1 is willing to establish a multimedia
session comprising a video stream and an audio stream. The video stream
supports H.263 codec. The audio stream supports the AMR codec.
UE#1indicates that it supports precondition and it indicates that it supports
reliable provisional responses. However, it does not use the \"Require" header
for these capabilities.
UE#1 does have available the resources that are necessary to transport the
media.
Table 5.3-9: INVITE request (UE#1 to P-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for the "precondition" mechanism, the
support for reliable provisional responses and the support for the 199 (Early
Dialog Terminated) response code.
**SDP** The SDP contains a set of codecs supported by UE#1 and desired by the
user at UE#1 for this session.
2\. **100 (Trying) response (P-CSCF#1 to UE#1)**
The P-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
3\. **INVITE request (P-CSCF#1 to S-CSCF#1) - see example in table 5.3-10**
Table 5.3-10: INVITE request (P-CSCF#1 to S-CSCF#1)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> P-Asserted-Identity: \"John Doe\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
4\. **100 (Trying) response (S-CSCF#1 to P-CSCF#1)**
The S-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
5\. **INVITE request (S-CSCF#2 to P-CSCF#2) see example in table 5.3-11**
Table 5.3-11: INVITE request (S-CSCF#2 to P-CSCF#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> Record-Route: \, \,
> \
>
> P-Asserted-Identity:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> P-Called-Party-ID: \
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
6\. **100 (Trying) response (P-CSCF#2 to S-CSCF#2)**
The P-CSCF#2 responds to the INVITE request with a 100 (Trying) provisional
response.
7\. **INVITE request (P-CSCF#2 to UE #2) - see example in table 5.3-12**
P-CSCF#2 forwards the INVITE request to UE#2.
Table 5.3-12: INVITE request (P-CSCF#2 to UE#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 65
>
> Record-Route: \,
> \, \,
> \
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
8**. 100 (Trying) response (UE#2 to P-CSCF)**
The UE responds to the INVITE request with a 100 (Trying) provisional
response.
9**. Reserve IP-CAN bearer for media**
The terminating UE sets up the bearer in accordance with the media
description.
10\. -- 13. **180 (Ringing) response - see example in table 5.3-13**
> After the resources have been reserved, UE#2 indicates that it is ringing.
> Since the message includes the SDP answer, this message is sent reliably.
Table 5.3-13: 180 (Ringing) response (UE2 to P-CSCF2)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555:: eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
14\. - 17. **PRACK request - see example in table 5.3-14**
> UE#1 acknowledges the receipt of the 180 (Ringing). It does not contain SDP
> as the final codec decision is already made as part of the initial
> offer/answer exchange
Table 5.3-14: PRACK request (UE1 to P-CSCF1)
> PRACK sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Route: \,
> \, \,
> \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 128 PRACK
>
> Require: precondition, sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> RAck: 9021 127 INVITE
>
> Content-Length: 0
18 - 21. **200 (OK) response to (PRACK request)**
> UE#2 acknowledges the receipt of the PRACK request with the 200 (OK)
> response
22\. **200 (OK) response (UE#2 to P-CSCF#2) - see example in table 5.3-15**
User #2 answers the phone and this triggers UE #2 to send the 200 (OK)
response.
Table 5.3-15: 200(OK) response (UE to P-CSCF)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 127 INVITE
>
> Content-Length: 0
23\. **200 (OK) response (P-CSCF#2 to S-CSCF#2) - see example in table
5.3-16**
Table 5.3-16: 200(OK) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Length: 0
24\. **200 (OK) response (S-CSCF#1 to P-CSCF#1) - see example in table
5.3-17**
Table 5.3-17: 200(OK) response (S-CSCF#1 to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Length: 0
25\. **200 (OK) response (P-CSCF#1 to UE#1) - see example in table 5.3-18**
Table 5.3-18: 200(OK) response (P-CSCF#1 to UE#1)
> SIP/2.0 200 OK
>
> Via: [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Length: 0
26 - 29. **ACK request**
> The calling party responds to the 200 (OK) response with an ACK request.
### 5.3.4 Signalling Flow with SDP answer in reliable 183 Session Progress
response for INVITE request when the IP-CAN performs resource reservation for
UE#2
When the IP-CAN performs the resource reservation for UE#2, UE#2 uses a 183
Session Progress response to the INVITE Request to send the SDP Answer.
> NOTE 1: It will be possible for UE#2 to execute this signalling flow even if
> UE#2 is responsible to perform resource reservation.
Figure 5.3-3: IMS session setup, resource reservation only on terminating side
(NW-initiated)
The details of the signalling flows are as follows:
1\. **INVITE request (UE#1 to P-CSCF#1) see example in table 5.3-19**
For this example, it is assumed that UE#1 is willing to establish a multimedia
session comprising a video stream and an audio stream. The video stream
supports H.263 codec. The audio stream supports the AMR codec.
UE#1indicates that it supports precondition and it indicates that it supports
reliable provisional responses. However, it does not use the \"Require" header
for these capabilities.
UE#1 does have available the resources that are necessary to transport the
media.
Table 5.3-19: INVITE request (UE#1 to P-CSCF#1)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for the "precondition" mechanism, the
support for reliable provisional responses and the support for the 199 (Early
Dialog Terminated) response code.
**SDP** The SDP contains a set of codecs supported by UE#1 and desired by the
user at UE#1 for this session.
2\. **100 (Trying) response (P-CSCF#1 to UE#1)**
The P-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
3\. **INVITE request (P-CSCF#1 to S-CSCF#1) - see example in table 5.3-20**
Table 5.3-20: INVITE request (P-CSCF#1 to S-CSCF#1)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> P-Asserted-Identity: \"John Doe\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
4\. **100 (Trying) response (S-CSCF#1 to P-CSCF#1)**
The S-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
5\. **INVITE request (S-CSCF#2 to P-CSCF#2) see example in table 5.3-21**
Table 5.3-21: INVITE request (S-CSCF#2 to P-CSCF#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> Record-Route: \, \,
> \
>
> P-Asserted-Identity:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> P-Called-Party-ID: \
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
6\. **100 (Trying) response (P-CSCF#2 to S-CSCF#2)**
The P-CSCF#2 responds to the INVITE request with a 100 (Trying) provisional
response.
7\. **INVITE request (P-CSCF#2 to UE #2) - see example in table 5.3-22**
Table 5.3-22: INVITE request (P-CSCF#2 to UE#2)
> INVITE sip:user2_public1\@home2.net SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 65
>
> Route: \
>
> Record-Route: \,
> \, \,
> \
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
8**. 100 (Trying) response (UE#2 to P-CSCF)**
The UE responds to the INVITE request with a 100 (Trying) provisional
response.
9**. 183 (Session Progress) response (UE#2 to P-CSCF#2) - - see example in
table 5.3-23**
UE#2 determines the complete set of codecs that it is capable of supporting
for this session. It determines the intersection with those appearing in the
SDP in the INVITE request. UE#2 makes the final codec selection and chooses
H.263 and AMR.
> UE#2 responds with a 183 (Session Progress) response containing SDP back to
> the originator. This response is sent to P-CSCF.
Table 5.3-23: 183 (Session Progress) response (UE#2 to P-CSCF#2)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> CSeq:
>
> Require: 100rel, precondition
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933623 2987933623 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 10001 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 6544 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
10.-11. **Authorize QoS and reserve IP-CAN bearer for media**
P-CSCF authorizes the resources necessary for this session.
NOTE 2: In the case where IP-CAN bearers are managed by the IP-CAN, this
triggers the IP-CAN to initiate the reservation of required resources,
including the initiation of an IP-CAN bearer setup or the modification of an
existing one.
> 12-13. **183 (session progress) response**
14\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
> **15.183 (Session Progress) response (P-CSCF#1 to UE#1) --**
16.-23. **PRACK request / 200(OK) response exchange**
The PRACK request does not carry SDP as the final codec decision is already
made as part of the initial offer/answer exchange.
24\. **180 (Ringing) response UE#2 to P-CSCF#2) - - see example in table
5.3-24** -
> The UE#2 indicates that it is ringing. The UE#2 does not use Require
> "100rel" as the 180 (Ringing) does not have a SDP and therefore need not to
> be sent reliable.
NOTE 3: According to RFC 4032 [9] there is no need to send a new offer from
the terminating UE to indicate that resources are available since 180
(Ringing) will implicit indicate that resources are available.
Table 5.3-24: 180 (Ringing) response (UE#2 to P-CSCF#2)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> CSeq:
>
> Require: 100rel, precondition
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
25-27. **180 (Ringing) response**
**28 200 (OK) response UE#2 to P-CSCF#2) - - see example in table 5.3-25**
When the called party answers the UE#2 sends a 200 (OK) response final
response to the INVITE request (7) to P-CSCF#2, and starts the media flow(s)
for this session.
Table 5.3-25: 200 (OK) response (UE#2 to P-CSCF#2)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> CSeq:
>
> Require: 100rel, precondition
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933623 2987933623 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 10001 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 6544 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
29\. --31. **200 (OK) response**
> 32.-35. **ACK request**
>
> The calling party responds to the 200 (OK) response with an ACK request.
## 5.4 Establishing a session when UE#1 does not have required resources
available and UE#2 is non-IMS
### 5.4.1 Introduction
The following flows show the establishment of a session where UE#1, connected
to the IM CN subsystem, does not yet have the required local resources
available and needs to perform resource reservation while SIP UA#2 is a non-
IMS UE.
It is assumed that the originating UE uses a dedicated IP-CAN bearer for SIP
signalling and dedicated IP-CAN bearer for media.
The box \"Intermediate IM CN subsystem entities\" stands for the combination
of I-CSCF/S-CSCF on the originating Routing of messages between those nodes is
not described in the flow below.
As the topology on the non-IMS, terminating side is not known, only a UE is
shown on the terminating side. However, this does not rule out the possibility
that there are proxies in the terminating signalling path.
In subclause 5.4.2 the UE#1 establish a multimedia session comprising a video
stream and an audio stream. The AVP transport is offered for the audio stream
and the video stream in initial INVITE request. SIP UA#2 does not support the
preconditions framework.
In subclause 5.4.3 the UE#1 establish a multimedia session comprising a video
stream and an audio stream. The AVP transport is offered for the audio stream
and the AVPF transport is offered for the video stream in initial INVITE
request. SIP UA#2 supports the preconditions framework.
In subclause 5.4.4 the UE#1 establish a multimedia session comprising a video
stream and an audio stream. The AVP transport is offered for the audio stream
and the AVPF transport is offered for the video stream in initial INVITE
request. SIP UA#2 does not support the preconditions framework.
### 5.4.2 Signalling Flow
Figure 5.4-1: IMS session setup, resource reservation on both sides
The details of the signalling flows are as follows:
**1\. INVITE request (UE#1 to P-CSCF#1) see example in table 5.4-1**
For this example, it is assumed that UE#1 is willing to establish a multimedia
session comprising a video stream and an audio stream. The video stream
supports the H.263 coded. The audio stream supports the AMR codec.
UE#1indicates that it supports precondition and it indicates that it supports
reliable provisional responses. However, it does not use the \"Require" header
for these capabilities.
UE#1 does not have available the resources that are necessary to transport the
media.
Table 5.4-1: INVITE request (UE#1 to P-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for the \"precondition\" mechanism,
the support for reliable provisional responses and the support for the 199
(Early Dialog Terminated) response code.
**SDP** The SDP contains a set of codecs supported by UE#1 and desired by the
user at UE#1 for this session. As the local preconditions are not fulfilled,
both media are set to \"inactive\".
**2\. 100 (Trying) response (P-CSCF#1 to UE#1)**
The P-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
**3\. INVITE request (P-CSCF#1 to S-CSCF#1) - see example in table 5.4-2**
Table 5.4-2: INVITE request (P-CSCF#1 to S-CSCF#1)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> P-Asserted-Identity: \"John Doe\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
**4\. 100 (Trying) response (S-CSCF#1 to P-CSCF#1)**
The S-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
**5\. INVITE request (S-CSCF#1 to UE#2) see example in table 5.4-3**
Table 5.4-3: INVITE request(S-CSCF#1 to UE#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> Record-Route: \, \
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> P-Called-Party-ID: \
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
**6\. UE#2 assumes itself on hold**
UE#2 assumes itself on hold as media are set to inactive, i.e. UE#2 does not
await or send media.
Resources are available.
**7 -9 . 180 (Ringing) response**
> UE#2 indicates that it is ringing. It is assumed that UE#2 does not support
> the \"100rel\" extension and therefore the 180 (Ringing) response is not
> sent reliable, i.e. no SDP is sent in the 180 (Ringing) response.
**10\. 200 (OK) response (UE#2 to S-CSCF) - see example in table 5.4-5**
User on the terminating side goes off hook. It is assumed that UE#2 plays some
announcement to indicate to the user that the call is on hold.
UE#2 ignores the precondition that it received in the INVITE request as it
does not support them. No preconditions are included in the SDP answer. Both
media streams are set to \"inactive\".
Table 5.4-5: 200(OK) response (UE#2 to S-CSCF)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:ggg:hhh
>
> s=-
>
> c=IN IP6 5555::eee:fff:ggg:hhh
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**11\. 200 (OK) response (S-CSCF#1 to P-CSCF#1) - see example in table 5.4-6**
Table 5.4-6: 200(OK) response (S-CSCF#1 to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**12\. 200 (OK) response (P-CSCF#1 to UE#1) - see example in table 5.4-7**
Table 5.4-7: 200(OK) response (P-CSCF to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**13 . Reserve IPCAN bearer for media**
The originating UE sets up the bearer in accordance with the media description
received SDP.
**14.-16. .ACK request**
> The calling party responds to the 200 (OK) response with an ACK request.
**17\. INVITE request (UE#1 to P-CSCF#1) see example in table 5.4-8**
UE#1 sets the media streams to active using a re-INVITE request
As UE#2 does not support preconditions, UE#1 does not include preconditions in
the SDP.
Table 5.4-8: INVITE request (UE#1 to P-CSCF)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> From: \;tag=171828
>
> To: \; tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 128 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=rtpmap:98 H263
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**18\. INVITE request (P-CSCF#1 to S-CSCF#1) see example in table 5.4-9**
Table 5.4-9: INVITE request (P-CSCF#1 to S-CSCF)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**19\. INVITE request (S-CSCF#1 to UE#2) see example in table 5.4-10**
Table 5.4-10: INVITE request (S-CSCF#1 to UE#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards:
>
> Record-Route: \, \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**20\. 200 (OK) response (UE#2 to S-CSCF) - see example in table 5.4-11**
UE#2 confirms the new SDP offer. Media is set to active
Table 5.4-11: 200(OK) response (UE#2 to S-CSCF)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To: \
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:ggg:hhh
>
> s=-
>
> c=IN IP6 5555::eee:fff:ggg:hhh
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**21\. 200 (OK) response (S-CSCF#1 to P-CSCF#1) - see example in table
5.4-12**
Table 5.4-12: 200(OK) response (S-CSCF#1 to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:(...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**22\. 200 (OK) response (P-CSCF#1 to UE#1) - see example in table 5.4-12**
Table 5.4-7: 200(OK) response (P-CSCF to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**23.-25. .ACK request**
> The calling party responds to the 200 (OK) response with an ACK request.
### 5.4.3 Signalling flow (preconditions used, SDP capability negotiation not
supported by UE#1, 2nd SDP offer offering AVP transport for video)
Figure 5.4.3-1: IMS session setup, resource reservation on both sides
The details of the signalling flows are as follows:
1\. **INVITE request (UE#1 to P-CSCF#1) see example in table 5.4.3-1**
For this example, it is assumed that UE#1 is willing to establish a multimedia
session comprising a video stream and an audio stream. The video stream
supports two codecs, either H.263 or MPEG-4 Visual. The audio stream supports
the AMR codec. The UE#1 is willing to establish the video stream using AVPF or
AVP transport and the audio stream using AVP transport. The UE#1 does not
support SDP capability negotiation.
UE#1 indicates that it supports and is willing to use AVPF transport for the
video stream and AVP transport for the audio stream.
UE#1 indicates that it supports precondition and it indicates that it supports
reliable provisional responses. However, it does not use the \"Require\"
header for these capabilities.
UE#1 does not have available the resources that are necessary to transport the
media.
For this example it is assumed, that signalling encryption was negotiated
between UE and P‑CSCF in the security mode set-up procedure during the last
successful authentication. This option will only be shown in this example.
Table 5.4.3-1: INVITE request (UE#1 to P-CSCF#1)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98 99
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=rtpmap:99 MP4V-ES
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for the "precondition" mechanism, the
support for reliable provisional responses and the support for the 199 (Early
Dialog Terminated) response code.
**SDP** The SDP contains a set of codecs supported by UE#1 and desired by the
user at UE#1 for this session. As the local preconditions are not fulfilled,
both media are set to \"inactive\".
**Security-Verify:** The Security-Verify contains the content of the Security-
Server header as received during last successful authentication. It indicates
that integrity protection and encryption are in use for this session.
2\. **100 (Trying) response (P-CSCF#1 to UE#1)**
The P-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
3\. **INVITE request (P-CSCF#1 to intermediate IM CN subsystem entities) - see
example in table 5.4.3-3**
Table 5.4.3-3: INVITE request (P-CSCF#1 to intermediate IM CN subsystem
entities)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> P-Asserted-Identity: \"John Doe\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
4\. **100 (Trying) response (intermediate IM CN subsystem entities to
P-CSCF#1)**
The intermediate IM CN subsystem entities respond to the INVITE request with a
100 (Trying) provisional response.
5\. **INVITE request (intermediate IM CN subsystem entities to SIP UA#2) - see
example in table 5.4.3-5**
Intermediate IM CN subsystem entities forward the INVITE request to SIP UA#2.
Table 5.4.3-5: INVITE request (intermediate IM CN subsystem entities to SIP
UA#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 65
>
> Record-Route: \, \
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
**6\. 100 (Trying) response (SIP UA#2 to intermediate IM CN subsystem
entities)**
The UE responds to the INVITE request with a 100 (Trying) provisional
response.
7**. 183 (Session Progress) response (SIP UA#2 to intermediate IM CN subsystem
entities) - - see example in table 5.4.3-7**
As SIP UA#2 does not support AVPF transport, the SIP UA#2 does not accept the
video stream. For audio stream, the SIP UA#2 determines the complete set of
codecs that it is capable of supporting for this session. It determines the
intersection with those appearing in the SDP in the INVITE request. SIP UA#2
makes the codec selection and chooses AMR.
SIP UA#2 responds with a 183 (Session Progress) response containing SDP back
to the originator. This response is sent to P-CSCF. SIP UA#2 uses a conf line
in the SDP to request a confirmation from UE#1 when the local resources are
available at UE#1.
Table 5.4.3-7: 183 (Session Progress) response (SIP UA#2 to intermediate IM CN
subsystem entities)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> CSeq:
>
> Require: 100rel, precondition
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933623 2987933623 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 0 RTP/AVPF 98
>
> m=audio 6544 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
8\. **Reserve IP-CAN bearer for audio stream**
The terminating UA sets up the bearer for the audio stream in accordance with
the media description received SDP.
> **9\. 183 (session progress) response (intermediate IM CN subsystem entities
> to P-CSCF#1) -- see example in table 5.4.3-13**
Table 5.4.3-9: 183 (Session Progress) response (intermediate IM CN subsystem
entities to P-CSCF#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity:
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
10\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
11\. **183 (Session Progress) response (P-CSCF#1 to UE#1) -- see example in
table 5.4.3-11**
Table 5.4.3-11: 183 (Session Progress) response (P-CSCF#1 to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
12\. **Reserve IP-CAN bearer for audio stream**
The originating UE sets up the bearer for audio stream in accordance with the
media description received SDP.
13\. **PRACK request (UE#1 to P-CSCF#1) - see example in table 5.4.3-13**
Since SIP UA#2 did not accept the video stream UE#1 includes a new SDP offer
in the PRACK request.
UE#1 indicates that it supports and is willing to use AVP transport for the
video stream and AVP transport for the audio stream. The video stream supports
two codecs, either H.263 or MPEG-4 Visual. The audio stream supports the AMR
codec.
UE#1 does not have available the resources that are necessary to transport the
media.
Table 5.4.3-13: PRACK request (UE#1 to P-CSCF#1)
> PRACK sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \; tag=171828
>
> To: \ tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 128 PRACK
>
> RAck: 9021 127 INVITE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**SDP** The SDP contains an offer of AVP for video and a set of codecs
supported by UE#1 for video and desired by the user at UE#1 for this session.
For audio media the SDP is the same as what was accepted in the initial SDP
answer. As the local preconditions are not yet fulfilled, both media are set
to \"inactive\".
14\. **PRACK request (P-CSCF#1 to intermediate IM CN subsystem entities) - see
example in table 5.4.3-14**
Table 5.4.3-14: PRACK request (**P-CSCF** #1 to intermediate IM CN subsystem
entities)
> PRACK sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240g34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> RAck:
>
> Require:
>
> Proxy-Require:
>
> Security-Verify:
>
> Contact:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
15\. **PRACK request (intermediate IM CN subsystem entities to SIP UA#2) - see
example in table 5.4.3-15**
Table 5.4.3-15: PRACK request (**intermediate IM CN subsystem entities to SIP
UA#2**)
> PRACK sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 67
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> RAck:
>
> Require:
>
> Proxy-Require:
>
> Security-Verify:
>
> Contact:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
**16\. 200 (OK) response to PRACK request (SIP UA#2 to intermediate IM CN
subsystem entities) - - see example in table 5.4.3-16**
SIP UA#2 support AVP so it can accept the offered video stream.
The SIP UA#2 determines the complete set of codecs that it is capable of
supporting for this session. It determines the intersection with those
appearing in the SDP in the PRACK request. SIP UA#2 makes the codec selection
and chooses AMR and H.263.
SIP UA#2 responds with a 200 (OK) response to PRACK containing SDP back to the
originator. This response is sent to P-CSCF. SIP UA#2 uses a conf line in the
SDP to request a confirmation from UE#1 when the local resources are available
at UE#1.
Table 5.4.3-16: 200 (OK) response to PRACK request (SIP UA#2 to intermediate
IM CN subsystem entities)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require: precondition
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933623 2987933623 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 10001 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 6544 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
17\. **Reserve IP-CAN bearer for video stream**
The terminating UA sets up the bearer for video stream in accordance with the
media description received SDP.
18**. 200 (OK) response to PRACK request (intermediate IM CN subsystem
entities to P-CSCF#1) - - see example in table 5.4.3-18**
Table 5.4.3-18: 200 (OK) response to PRACK request (intermediate IM CN
subsystem entities to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
19\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
20**. 200 (OK) response to PRACK request (P-CSCF#1 to UE#1) - - see example in
table 5.4.3-20**
Table 5.4.3-20: 200 (OK) response to PRACK request (intermediate IM CN
subsystem entities to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info:
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Require:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
21\. **Reserve IP-CAN bearer for video stream**
The originating UE sets up the bearer for video stream in accordance with the
media description received SDP.
22\. **UPDATE request (UE#1 to P-CSCF#1) - see example in table 5.4.3-22**
> UE#1 indicates that it can send and receive media once the necessary
> resources for both audio and video are available.
Table 5.4.3-22: UPDATE request (UE#1 to P-CSCF#1)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \; tag=171828
>
> To: \ tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 129 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
23\. **UPDATE request (P-CSCF#1 to intermediate IM CN subsystem entities) -
see example in table 5.4.3-23**
Table 5.4.3-23: UPDATE request (P-CSCF#1 to intermediate IM CN subsystem
entities)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";
> ggsn=[5555::4b4:3c3:2d2:1e1]; pdp-sig=no; gcid=723084371; auth-
> token=43876559; flow-id=3
>
> Route: \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **24\. UPDATE request (intermediate IM CN subsystem entities to SIP UA#2 ) -
> see example in table 5.4.3-24**
Table 5.4.3-24: UPDATE request (intermediate IM CN subsystem entities to SIP
UA#2)
> UPDATE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> **25\. 200 (OK) response (SIP UA#2 to intermediate IM CN subsystem entities)
> - see example in table 5.4.3-25**
UE acknowledges the UPDATE request with a 200 (OK) response.
UE indicates that the local resources are available
Table 5.4.3-25: 200(OK) response (SIP UA#2 to intermediate IM CN subsystem
entities)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From: \;tag=171828
>
> To: \;tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 129 UPDATE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> **26\. 200 (OK) response (intermediate IM CN subsystem entities to S-CSCF#2
> ) - see example in table 5.4.3-26**
Table 5.4.3-26: 200(OK) response (intermediate IM CN subsystem entities to
P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
27\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
> **28\. 200 (OK) response (P-CSCF#1 to UE#1) - see example in table
> 5.4.3-28**
Table 5.4.3-28: 200(OK) response (P-CSCF#1 to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
29 -31. **180 (Ringing) response**
> SIP UA#2 indicates that it is ringing. The SIP UA#2 does not use Require
> "100rel" as the 180 (Ringing) does not have a SDP and therefore need not to
> be sent reliable.
32 --34. **200 (OK) response**
When the called party answers the SIP UA#2 sends a 200 (OK) response to the
INVITE request and starts the media flow(s) for this session.
> 35-37. **ACK request**
>
> The calling party responds to the 200 (OK) response with an ACK request.
### 5.4.4 Signalling Flow (preconditions not supported by SIP UA#2, SDP
capability negotiation not supported by UE#1, 2nd SDP offer offering AVP
transport for video)
Figure 5.4.4-1: IMS session setup, resource reservation on both sides
The details of the signalling flows are as follows:
**1\. INVITE request (UE#1 to P-CSCF#1) see example in table 5.4.4-1**
For this example, it is assumed that UE#1 is willing to establish a multimedia
session comprising a video stream and an audio stream. The video stream
supports the H.263 codec. The audio stream supports the AMR codec. The UE#1 is
willing to establish the video stream using AVPF or AVP transport and the
audio stream using AVP transport. In the initial SDP offer only AVPF is
offered for the video stream since the UE#1 does not support SDP capability
negotiation.
UE#1 indicates that it supports and is willing to use AVPF transport for the
video stream and AVP transport for the audio stream.
UE#1indicates that it supports precondition and it indicates that it supports
reliable provisional responses. However, it does not use the \"Require" header
for these capabilities.
UE#1 does not have available the resources that are necessary to transport the
media.
Table 5.4.4-1: INVITE request (UE#1 to P-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact: \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for the \"precondition\" mechanism and
the support for reliable provisional responses
**SDP** The SDP contains a set of codecs supported by UE#1 and desired by the
user at UE#1 for this session. As the local preconditions are not fulfilled,
both media are set to \"inactive\".
**2\. 100 (Trying) response (P-CSCF#1 to UE#1)**
The P-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
**3\. INVITE request (P-CSCF#1 to intermediate IM CN subsystem entities) \-
see example in table 5.4.4-3**
Table 5.4.4-3: INVITE request (P-CSCF#1 to intermediate IM CN subsystem
entities)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> P-Asserted-Identity: \"John Doe\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
**4\. 100 (Trying) response (intermediate IM CN subsystem entities to
P-CSCF#1)**
The S-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
**5\. INVITE request (intermediate IM CN subsystem entities to SIP UA#2) see
example in table 5.4.4-5**
Table 5.4.4-5: INVITE request (intermediate IM CN subsystem entities to SIP
UA#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Record-Route: \, \
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require:
>
> Supported:
>
> Contact:
>
> Allow:
>
> P-Called-Party-ID: \
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
**6\. SIP UA#2 assumes itself on hold**
SIP UA#2 assumes itself on hold as media are set to inactive, i.e. SIP UA#2
does not await or send media.
Resources are available.
**7 -9 . 180 (Ringing) response**
> SIP UA#2 indicates that it is ringing. It is assumed that SIP UA#2 does not
> support the "100rel" extension and therefore the 180 (Ringing) response is
> not sent reliable, i.e. no SDP is sent in the 180 (Ringing) response.
**10\. 200 (OK) response (SIP UA#2 to S-CSCF) - see example in table
5.4.4-10**
User on the terminating side accepts the call. It is assumed that SIP UA#2
plays some announcement to indicate to the user that the call is on hold.
As SIP UA#2 does not support AVPF transport, the SIP UA#2 does not accept the
video stream.
SIP UA#2 ignores the precondition that it received in the INVITE request as it
does not support them. No preconditions are included in the SDP answer. Both
media streams are set to \"inactive\".
Table 5.4.4-10: 200(OK) response (SIP UA#2 to intermediate IM CN subsystem
entities)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:ggg:hhh
>
> s=-
>
> c=IN IP6 5555::eee:fff:ggg:hhh
>
> t=0 0
>
> m=video 0 RTP/AVPF 98
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**11\. 200 (OK) response (intermediate IM CN subsystem entities to P-CSCF#1) -
see example in table 5.4.4-11**
Table 5.4.4-11: 200(OK) response (intermediate IM CN subsystem entities to
P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
12\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
**13\. 200 (OK) response (P-CSCF#1 to UE#1) - see example in table 5.4.4-13**
Table 5.4.4-13: 200(OK) response (P-CSCF#1 to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**14 . Reserve IPCAN bearer for audio stream**
The originating UE sets up the bearer for audio stream in accordance with the
media description received SDP.
**15.-17. ACK request**
> The calling party responds to the 200 (OK) response with an ACK request.
**18\. INVITE request (UE#1 to P-CSCF#1) - see example in table 5.4.4-18**
UE#1 sets the audio stream to active using a re-INVITE request and indicates
that it supports and is willing to use AVP transport for the video stream and
AVP transport for the audio stream.
As SIP UA#2 does not support preconditions, UE#1 does not include
preconditions in the SDP.
As SIP UA#2 does not have resources for video stream, the video stream is
indicated as \"inactive\".
Table 5.4.4-18: INVITE request (UE#1 to P-CSCF#1)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> From: \;tag=171828
>
> To: \; tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 128 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=rtpmap:98 H263
>
> a=inactive
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**19\. INVITE request (P-CSCF#1 to intermediate IM CN subsystem entities) see
example in table 5.4.4-19**
Table 5.4.4-19: INVITE request (P-CSCF#1 to **intermediate IM CN subsystem
entities**)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**20\. INVITE request (intermediate IM CN subsystem entities to SIP UA#2) see
example in table 5.4.4-20**
Table 5.4.4-20: INVITE request (S-CSCF#1 to SIP UA#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332x23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards:
>
> Record-Route: \, \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**21\. SIP UA#2 assumes itself on hold for video stream and off hold of audio
stream**
SIP UA#2 assumes itself on hold for video as media are set to inactive, i.e.
SIP UA#2 does not await or send media for video stream. SIP UA#2 assumes
itself off hold for audio and awaits and sends media for audio stream.
Resources are available.
**22\. 200 (OK) response (SIP UA#2 to intermediate IM CN subsystem entities) -
see example in table 5.4.4-22**
SIP UA#2 confirms the new SDP offer. Audio stream is set to active, video
stream is set to inactive.
Table 5.4.4-22: 200(OK) response (SIP UA#2 to intermediate IM CN subsystem
entities)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332x23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:ggg:hhh
>
> s=-
>
> c=IN IP6 5555::eee:fff:ggg:hhh
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=inactive
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**23\. 200 (OK) response (intermediate IM CN subsystem entities to P-CSCF#1) -
see example in table 5.4.4-23**
Table 5.4.4-23: 200(OK) response (intermediate IM CN subsystem entities to
P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:(...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
24\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
**25\. 200 (OK) response (P-CSCF#1 to UE#1) - see example in table 5.4.4-25**
Table 5.4.4-25: 200(OK) response (P-CSCF#1 to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**26 . Reserve IPCAN bearer for video stream**
The originating UE sets up the bearer for video stream in accordance with the
media description received SDP.
**27.-29. ACK request**
> The calling party responds to the 200 (OK) response with an ACK request.
**30\. INVITE request (UE#1 to P-CSCF#1) see example in table 5.4.4-30**
UE#1 sets the audio stream to active using a re-INVITE request and indicates
that it supports and is willing to use AVP transport for the video stream and
AVP transport for the audio stream.
As SIP UA#2 does not support preconditions, UE#1 does not include
preconditions in the SDP.
As SIP UA#2 does not have resources for video stream, the video stream is
indicated as \"inactive\".
Table 5.4.4-30: INVITE request (UE#1 to P-CSCF)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> From: \;tag=171828
>
> To: \; tag=314159
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 129 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933617 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=rtpmap:98 H263
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**31\. INVITE request (P-CSCF#1 to intermediate IM CN subsystem entities) see
example in table 5.4.4-31**
Table 5.4.4-31: INVITE request (P-CSCF#1 to intermediate IM CN subsystem
entities)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**32\. INVITE request (intermediate IM CN subsystem entities to SIP UA#2) see
example in table 5.4.4-32**
Table 5.4.4-32: INVITE request (intermediate IM CN subsystem entities to SIP
UA#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards:
>
> Record-Route: \, \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length:
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**33\. 200 (OK) response (SIP UA#2 to intermediate IM CN subsystem entities) -
see example in table 5.4.4-33**
SIP UA#2 confirms the new SDP offer. Audio stream is set to active, video
stream is set to active.
Table 5.4.4-33: 200(OK) response (SIP UA#2 to intermediate IM CN subsystem
entities)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933617 IN IP6 5555::eee:fff:ggg:hhh
>
> s=-
>
> c=IN IP6 5555::eee:fff:ggg:hhh
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**34\. 200 (OK) response (intermediate IM CN subsystem entities to P-CSCF#1) -
see example in table 5.4.4-34**
Table 5.4.4-34: 200(OK) response (S-CSCF#1 to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type:
>
> Content-Length:(...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
35\. **Authorize QoS**
P-CSCF authorizes the resources necessary for this session.
**36\. 200 (OK) response (P-CSCF#1 to UE#1) - see example in table 5.4.4-36**
Table 5.4.4-36: 200(OK) response (P-CSCF to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**37.-39. ACK request**
> The calling party responds to the 200 (OK) response with an ACK request.
## 5.5 Establishing a session when UE#1 is non-IMS and UE#2 does not have
required resources available
### 5.5.1 Introduction
The following flow shows the establishment of a session where UE#1 is a non-
IMS UE. i.e. is plain SIP while UE#2 is connected to the IM CN subsystem, does
not yet have the required local resources available and needs to perform
resource reservation.
It is assumed that the terminating UE uses a dedicated IP-CAN bearer for SIP
signalling and dedicated IP-CAN bearer for media.
The box \"Intermediate IM CN subsystem entities\" stands for the combination
of I-CSCF/S-CSCF on the terminating side Routing of messages between those
nodes is not described in the flow below.
As the topology on the non-IMS, originating side is not known, only a UE is
shown on the terminating side. However, this does not rule out the possibility
that there are proxies in the originating signalling path.
### 5.5.2 Signalling Flow
Figure 5.5-1: IMS session setup, resource reservation on terminating side
The details of the signalling flows are as follows:
**1\. INVITE request (UE#1 to P-CSCF#1) see example in table 5.5-1**
> For this example, it is assumed that UE#1 is willing to establish a
> multimedia session comprising a video stream and an audio stream. The video
> stream supports the H.263 coded. The audio stream supports the AMR codec.
>
> UE# does not indicate that it supports precondition and does not indicate
> support for the 100rel extension.
Table 5.5-1: INVITE request (UE#1 to IM CN Subsystem entities)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=rtpmap:98 H263
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> **SDP** The SDP contains a set of codecs supported by UE#1 and desired by
> the user at UE#1 for this session.
**2\. 100 (Trying) response**
> The IM CN subsystem respond to the INVITE request with a 100 (Trying)
> provisional response.
**3\. INVITE request (S-CSCF to P-CSCF) - see example in table 5.5-2**
Table 5.5-2: INVITE request (S-CSCF to P-CSCF)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> Record-Route: \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
**4\. 100 (Trying) response (S-CSCF#1 to P-CSCF#1)**
> The S-CSCF responds to the INVITE request with a 100 (Trying) provisional
> response.
**5\. INVITE request (P-CSCF to UE) see example in table 5.5-3**
Table 5.5-3: INVITE request (P-CSCF to UE)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 65
>
> Record-Route: \,
> \, \
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Accept:
>
> Require:
>
> Contact:
>
> Allow:
>
> P-Called-Party-ID: \
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
**6\. . Reserve IPCAN bearer for media**
> The IMS UE sets up the bearer in accordance with the media description
> received SDP and if necessary its codec decision.
**7 -9 . 180 (Ringing) response**
> **UE#2 indicates that it is ringing..**
**10\. 200 (OK) response (UE#2 to P-CSCF) - see example in table 5.5-4**
> UE#2 does not use preconditions as they are not supported by the originating
> side.
Table 5.5-4: 200(OK) response (UE#2 to P-CSCF)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> Cseq:
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:ggg:hhh
>
> s=-
>
> c=IN IP6 5555::eee:fff:ggg:hhh
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**11\. 200 (OK) response (P-CSCF to S-CSCF) - see example in table 5.5-5**
Table 5.5-5: 200(OK) response (P-CSCF to S-CSCF)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> P-Access-Network-Info:
>
> Privacy:
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> Cseq:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**12\. 200 (OK) response (P-CSCF#1 to UE#1) - see example in table 5.5-6**
Table 5.5-6: 200(OK) response (S-CSCF to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
>
> Privacy:
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> Cseq:
>
> Contact:
>
> Allow:
>
> RSeq:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
**13.-15. ACK request**
> The calling party responds to the 200 (OK) response with an ACK request.
## 5.6 Establishing a session when UE#1 and UE#2 have resources already
available
### 5.6.1 Introduction
The following flows show the establishment of a session where both UE#1 and
UE#2 are connected to the IM CN subsystem and already have the required local
resources available so they do not need to perform resource reservation. The
example that does not use preconditions is based on the Push to Talk over
Cellular (PoC) on demand session establishment automatic answer scenario from
OMA PoC 1.0 enabler but with a confirmed indication (no media buffering
performed by the PoC Server). The example in subclause 5.6.3 shows the
scenario where UE#1 has resources already reserved but supports the
precondition mechanism and initiates session establishment following the
procedures defined in 3GPP TS 24.229 [1] for when the originating UE supports
preconditions. During session establishment the originating UE is unaware if
the other endpoint requires the use of the preconditions mechanism or whether
the other endpoint is required to reserve resources. In this example, the
other endpoint, UE#2, also has its resources ready before answering the INVITE
request with the first provisional response.
It is assumed that the both UEs uses a dedicated IP-CAN bearer for SIP
signalling and dedicated IP-CAN bearer for media.
The box \"Intermediate IM CN subsystem entities\" stands for the combination
of P-CSCF/I-CSCF/S-CSCF nodes in the network. Routing of messages between
those nodes is not described in the flow below.
### 5.6.2 Signalling Flow (preconditions are not used)
Figure 5.6-1: IMS session setup, no resource reservation, no preconditions
The details of the signalling flows are as follows:
**1\. INVITE request (UE#1 to P-CSCF#1) see example in table 5.6-1**
> For this example, it is assumed that UE#1 is willing to establish a
> multimedia session comprising an audio stream. The audio stream supports the
> AMR codec.
>
> UE# does not indicate that it supports precondition and does not indicate
> support for the 100rel extension.
>
> Within the Intermediate IM CN subsystem entities are two PoC Servers that
> acts as B2BUAs
Table 5.6-1: INVITE request (UE#1 to IM CN Subsytem entities)
> INVITE sip:PoCConferenceFactoryURI.home1.net SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Require: sec-agree,recipient-list-invite
>
> Supported: timer, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.poc.talkburst
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE, SUBSCRIBE,
> NOTIFY, PUBLISH
>
> Accept-Contact: *;+g.poc.talkburst;require;explicit
>
> User-Agent: PoC-client/OMA1.0 Acme-Talk5000/v1.01
>
> Session-Expires: 1800;refresher=uac
>
> Content-Type: multipart/mixed
>
> Content-Length: (...)
>
> \--boundary1
>
> Content-Type: application/sdp
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97
>
> b=AS:25.4
>
> a=rtpmap:97 AMR
>
> a=rtcp:5560
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> m=application 2000 udp TBCP
>
> a=fmtp:TBCP queuing=1; tb_priority=2; timestamp=1
>
> \--boundary1
>
> Content-Type: application/resource-lists+xml
>
> Content-Disposition: recipient-list
>
> \
>
> \
>
> \
>
> \
>
> \
>
> \
>
> \--boundary1--
>
> **SDP** The SDP contains a set of codecs supported by UE#1 and desired by
> the user at UE#1 for this session.
>
> **Resource List** The Resource List contains the URI of UE#2 being invited
> by the user at UE#1 for this session.
**2\. 100 (Trying) response**
> The IM CN subsystem respond to the INVITE request with a 100 (Trying)
> provisional response.
**3\. INVITE request (P-CSCF to UE) see example in table 5.6-2**
Table 5.6-2: INVITE request (IM CN Subsytem entities to UE)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP PoC-
> SessionABCDEF\@pocserver2.home2.net;session=1-1
>
> Max-Forwards: 68
>
> Record-Route: \,
> \
>
> From: \;tag=487651
>
> To:
>
> Call-ID: 03a0sdcglkj433s09a290bf3
>
> Cseq: 10227 INVITE
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Supported: norefersub,timer, 199
>
> Contact: \ SessionABCDEF\@pocserver2.home2.net;session=1-1>;+g.poc.talkburst
>
> Allow:
>
> P-Called-Party-ID: \
>
> Accept-Contact: *;+g.poc.talkburst; require;explicit
>
> User-Agent: PoC-serv/OMA1.0
>
> Session-Expires: 1800;refresher=uas
>
> Answer-Mode: Auto
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=
>
> o=- 3361529879 3361529879 IN IP6 60333::ddd:ccc:aaa:bbb
>
> s=
>
> c=IN IP6 5555::ddd:ccc:aaa:bbb
>
> t=
>
> m=audio audio 63776 RTP/AVP 97
>
> b=AS:25.4
>
> a=rtpmap:97 AMR
>
> a=rtcp:6390
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> m=application 60000 udp TBCP
>
> a=fmtp:TBCP queuing=1; tb_priority=2; timestamp=1
**4\. 200 (OK) response (UE#2 to IM CN Subsytem entities) - see example in
table 5.6-3**
> UE#2 does not use preconditions as they are not supported by the originating
> side.
Table 5.6-3: 200(OK) response (UE#2 to IM CN Subsytem entities)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> SessionABCDEF\@pocserver2.home2.net;session=1-1
>
> Record-Route: \,
> \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To: \;tag=314159
>
> Call-ID:
>
> Cseq:
>
> Require:timer
>
> Contact: \;+g.poc.talkburst
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Server: PoC-client/OMA1.0 Acme-Talk5000/v1.01
>
> Session-Expires: 1800;refresher=uas
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97
>
> b=AS:25.4
>
> a=rtpmap:97 AMR
>
> a=rtcp:75000
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> m=application 75590 udp TBCP
>
> a=fmtp:TBCP queuing=1; tb_priority=2; timestamp=1
**5\. 200 (OK) response (IM CN Subsytem entities** **to UE#1) - see example in
table 5.6-4**
Table 5.6-4: 200(OK) response (IM CN Subsytem entities to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route:
> \,\
>
> Privacy:
>
> From: \;tag=171828
>
> To: \;tag=257645
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Contact: \ ServerA.home1.net;session=1-1>;+g.poc.talkburst
>
> Allow:
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 3362987915 3362987915 IN IP6 57777::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 57777::eee:fff:aaa:bbb
>
> t=0 0
>
> m=audio 57787 RTP/AVP 97
>
> b=AS:25.4
>
> a=rtpmap:97 AMR
>
> a=rtcp:57000
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> m=application 57790 udp TBCP
>
> a=fmtp:TBCP queuing=1; tb_priority=2; timestamp=1
**6.-7. .ACK request**
> The calling party responds to the 200 (OK) response with an ACK request.
### 5.6.3 Signalling Flow (preconditions are used)
Figure 5.6-2: IMS session setup, no resource reservation, preconditions are
used
The details of the signalling flows are as follows:
1\. **INVITE request (UE#1 to P-CSCF#1) see example in table 5.6-5**
For this example, it is assumed that UE#1 is willing to establish a multimedia
session comprising a video stream and an audio stream. The video stream
supports H.263 codec. The audio stream supports the AMR codec.
UE#1indicates that it supports precondition and it indicates that it supports
reliable provisional responses. However, it does not use the \"Require" header
for these capabilities.
UE#1 does have available the resources that are necessary to transport the
media.
Table 5.6-5: INVITE request (UE#1 to P-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Accept: application/sdp,application/3gpp-ims+xml
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for the "precondition" mechanism, the
support for reliable provisional responses and the support for the 199 (Early
Dialog Terminated) response code.
**SDP** The SDP contains a set of codecs supported by UE#1 and desired by the
user at UE#1 for this session.
2\. **100 (Trying) response (P-CSCF#1 to UE#1)**
The P-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
3\. **INVITE request (P-CSCF#1 to S-CSCF#1) - see example in table 5.6-7**
Table 5.6-7: INVITE request (P-CSCF#1 to S-CSCF#1)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 69
>
> Route: \
>
> Record-Route: \
>
> P-Asserted-Identity: \"John Doe\" \
>
> P-Access-Network-Info:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
4\. **100 (Trying) response (S-CSCF#1 to P-CSCF#1)**
The S-CSCF responds to the INVITE request with a 100 (Trying) provisional
response.
5\. **INVITE request (S-CSCF#2 to P-CSCF#2) see example in table 5.6-8**
Table 5.6-8: INVITE request (S-CSCF#2 to P-CSCF#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> Record-Route: \, \,
> \
>
> P-Asserted-Identity:
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> P-Called-Party-ID: \
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
6\. **100 (Trying) response (P-CSCF#2 to S-CSCF#2)**
The P-CSCF#2 responds to the INVITE request with a 100 (Trying) provisional
response.
7\. **INVITE request (P-CSCF#2 to UE #2) - see example in table 5.6-9**
P-CSCF#2 forwards the INVITE request to UE#2.
Table 5.6-9: INVITE request (P-CSCF#2 to UE#2)
> INVITE sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 65
>
> Record-Route: \,
> \, \,
> \
>
> P-Asserted-Identity:
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Supported:
>
> Accept:
>
> Contact:
>
> Allow:
>
> Content-Type:
>
> Content-Length: (...)
>
> v=
>
> o=
>
> s=
>
> c=
>
> t=
>
> m=
>
> b=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
>
> a=
8**. 100 (Trying) response (UE#2 to P-CSCF)**
The UE responds to the INVITE request with a 100 (Trying) provisional
response.
9\. -- 12. **180 (Ringing) response - see example in table 5.6-10**
UE#2 determines the complete set of codecs that it is capable of supporting
for this session. It determines the intersection with those appearing in the
SDP in the INVITE request. UE#2 makes the final codec selection and chooses
H.263 and AMR.
UE#2 responds with a 180 (Ringing) response containing SDP sent reliably back
to the originator. This response is sent to P-CSCF. The SDP answer indicates
that resources are reserved at both endpoints.
Table 5.6-10: 180 (Ringing) response (UE#2 to P-CSCF#2)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555:: eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
13\. - 16. **PRACK request - see example in table 5.6-11**
> UE#1 acknowledges the receipt of the 180 (Ringing) response with a PRACK
> request sent to UE#2. If UE#1 determines to make any further change in the
> media flows, it may include a new SDP answer in the PRACK request. In this
> example, the PRACK request does not contain SDP as the final codec decision
> is already made as part of the initial offer/answer exchange.
Table 5.6-11: PRACK request (UE#1 to P-CSCF#1)
> PRACK sip:[5555::eee:fff:aaa:bbb]:8805;comp=sigcomp SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Route: \,
> \, \,
> \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 128 PRACK
>
> Require: precondition, sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> RAck: 9021 127 INVITE
>
> Content-Length: 0
17 - 20. **200 (OK) response (PRACK request)**
> UE#2 acknowledges the receipt of the PRACK request with the 200 (OK)
> response
21\. **200 (OK) response (UE#2 to P-CSCF#2) - see example in table 5.6-12**
User #2 answers the phone and this triggers UE #2 to send the 200 (OK)
response to answer the INVITE request.
Table 5.6-12: 200(OK) response (UE#2 to P-CSCF#2)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 127 INVITE
>
> Content-Length: 0
22\. **200 (OK) response (P-CSCF#2 to S-CSCF#2) - see example in table
5.6-13**
Table 5.6-13: 200 (OK) response (P-CSCF#2 to S-CSCF#2)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Length: 0
23\. **200 (OK) response (S-CSCF#1 to P-CSCF#1) - see example in table
5.6-14**
Table 5.6-14: 200 (OK) response (S-CSCF#1 to P-CSCF#1)
> SIP/2.0 200 OK
>
> Via: pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Length: 0
24\. **200 (OK) response (P-CSCF#1 to UE#1) - see example in table 5.6-15**
Table 5.6-15: 200 (OK) response (P-CSCF#1 to UE#1)
> SIP/2.0 200 OK
>
> Via: [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Content-Length: 0
25 - 28. **ACK request**
The calling party responds to the 200 (OK) response with an ACK request.
#
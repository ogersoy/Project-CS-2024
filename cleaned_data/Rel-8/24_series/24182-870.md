# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document provides the protocol details for the Customized Alerting
Tones (CAT) service in the IP Multimedia (IM) Core Network (CN) subsystem
based on the requirements from 3GPP TS 22.182 [2].
The CAT service is an operator specific service by which an operator enables
the subscriber to customize the media which is played to the calling party
during alerting of the called party.
The present document is applicable to User Equipment (UE) and Application
Servers (AS) which are intended to support the CAT service.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or nonâ€‘specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.182: \"Customized Alerting Tones (CAT) Requirements; Stage 1\".
[3] 3GPP TS 24.238: \"Session Initiation Protocol (SIP) based user
configuration; Stage 3\".
[4] 3GPP TS 24.229: \"Internet Protocol (IP) multimedia call control protocol
based on Session Initiation Protocol (SIP) and Session Description Protocol
(SDP); Stage 3\".
[5] RFC 3262: \"Reliability of Provisional Responses in the Session Initiation
Protocol (SIP)\".
[6] 3GPP TS 24.623: \"Extensible Markup Language (XML) Configuration Access
Protocol (XCAP) over the Ut interface for Manipulating Supplementary
Services\".
[7] RFC 3959: \"The Early Session Disposition Type for the Session Initiation
Protocol (SIP)\".
[8] RFC 3960: \"Early Media and Ringing Tone Generation in the Session
Initiation Protocol (SIP)\".
[9] RFC 5009 (September 2007): \"Private Header (P-Header) Extension to the
Session Initiation Protocol (SIP) for Authorization of Early Media\".
[10] 3GPP TS 24.607: \"Originating Identification Presentation (OIP) and
Originating Identification Restriction (OIR) using IP Multimedia (IM) Core
Network (CN) subsystem; Protocol specification\".
[11] RFC 3311: \"The Session Initiation Protocol (SIP) UPDATE Method\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
CAT Customized Alerting Tones
MRF Media Resource Function
# 4 Customized Alerting Tones (CAT)
## 4.1 Introduction
The CAT service is an operator specific service by which an operator enables
the subscriber to customize the media which is played to the calling party
during alerting of the called party. The media can consist of favourable
songs, multi-media clips or other customized alerting tones. CAT service
should not negatively affect the conversation between calling and called
parties.
## 4.2 Description
### 4.2.1 General description
The service user is able to subscribe to the CAT service, activate (or de-
activate) the service, and update the settings, e.g., to change by
configuration the active CAT media. The media can consist of favourable songs,
multimedia clips or other customized alerting tones. The CAT subscriber is
able to refine the CAT media selection behaviour with configured rules, e.g.
time, calling party's location, called party's location, the identity of the
calling and called party. The CAT service is able to select the appropriate
CAT media according to the rules.
CAT is a terminating network service which enables subscriber configured CAT
media to be selected on behalf of the called subscriber for playback to the
calling party.
The start of playback of the selected CAT media toward the calling party
occurs some time following the initiation of a session, but prior to session
answer. When the called party answers, playback of the CAT media either stops
or continues to play during the conversation, depending on operator or user
preferences. When the CAT media is playing, the calling party is able to stop
(e.g. mute) it.
## 4.3 Operational requirements
### 4.3.1 Provision/withdrawal
#### 4.3.1.1 CAT provision/withdrawal
The CAT service may be provided after prior arrangement with the service
provider.
The CAT service may be withdrawn at the subscriber's request or for
administrative reasons.
#### 4.3.1.2 Requirements on the originating network side
The originating network side may support the \"early-session\" extension as
described in RFC 3959 [7].
NOTE: the CAT service implementing the early-session model needs the early-
session extension to be supported by intermediate entities and the originating
UE, else CAT media cannot not be provided to the caller.
The CAT service implementing the forking model and gateway model add no
additional requirements on the originating network side.
#### 4.3.1.3 Requirements on the terminating network side
An MRF in the terminating network is required to be controlled by the CAT AS
that is acting on behalf of a called subscriber who has activated CAT.
## 4.4 Syntax requirements
There are no special SIP syntax requirements for the CAT service.
## 4.5 Signalling procedures
### 4.5.1 General
Configuration of supplementary services by the user should:
\- take place over the Ut interface using XCAP as enabling protocol as
described in 3GPP TS 24.623 [6]; or
\- use SIP based user configuration as described in 3GPP TS 24.238 [3];
NOTE: Other possibilities for user configuration, such as web-based
provisioning or pre-provisioning by the operator are outside the scope of the
present document, but are not precluded.
The details of the Ut interface based user configuration of CAT service are
not specified in this version of the document.
### 4.5.2 Activation/deactivation
The CAT service is activated at provisioning and deactivated at withdrawal.
When a CAT service is activated a subscriber can specify which CAT a calling
user should experience, or use the operator's default setting.
After a subscriber has activated their CAT service a calling user experiences
the CAT that was chosen by the subscriber.
### 4.5.3 Registration/erasure
The CAT service requires no registration. Erasure is not applicable.
### 4.5.4 Interrogation
For CAT, interrogation is not applicable.
### 4.5.5 Invocation and operation
#### 4.5.5.1 Actions at the originating UE
The UE shall follow the procedures specified in 3GPP TS 24.229 [4] for session
initiation and termination.
If the originating UE supports the early session mechanism then the UE shall
make use of the procedures as specified in RFC 3959 [7].
#### 4.5.5.2 Actions at the AS serving the originating UE
No requirements at the AS serving the originating UE are specified in this
version of the document.
#### 4.5.5.3 Actions at the AS serving the terminating UE
##### 4.5.5.3.1 General
The procedures specified in 3GPP TS 24.229 [4] for an AS acting as a routing
B2BUA apply with additions described in the subclauses below.
If the initial INVITE destined to served user includes a Supported header with
\"early-session\" option-tag and the AS supports the \"early-session\"
extension as described in RFC 3959 [7], the AS shall based on operator policy
follow the procedures in subclause 4.5.5.3.3 to provide CAT service. The
procedures in subclause 4.5.5.3.3 shall not be used if there are intermediates
in the network that do not understand the procedures.
Depending on the operator policy, it shall also be possible for the AS to
perform the actions specifed as Gateway model in RFC 3960 [8].
The AS shall follow procedures specified in subclause 4.6 for any services
where interaction shall be considered.
##### 4.5.5.3.2 AS actions for forking model
Upon receiving an initial SIP INVITE request destined to the served user, the
AS shall:
\- if the AS supports the P-Early-Media header [9], based on local policy
remove the P-Early-Media header, if present;
\- forward the initial SIP INVITE request to the served user;
\- contact the MRF to request CAT resource;
\- send a reliable SIP 183 (Session Progress) response to the originating UE.
The SIP 183 (Session Progress) provisional response shall:
\- include a P-Asserted-Identity header containing the public user identity of
the served user unless privacy policy or restriction services prevent
providing any public user identity of the terminating party;
\- include a To header with a To tag locally generated by the AS;
\- if the AS supports the P-Early-Media header, include a P-Early-Media header
with a \"sendrecv\" value or a \"sendonly value\";
\- include an SDP answer, based on information received from the MRF; and
\- if preconditions are used, indicate in the SDP answer that the local
preconditions are fulfilled.
If preconditions are used, the AS shall not instruct the MRF to start
applicable media for the CAT service before the originating UE has indicated
that preconditions are fulfilled. The point when the AS instructs the MRF to
start applicable media for the CAT service is based on local policy.
NOTE 1: The AS can, based on local policy, wait to send the SIP 183 (Session
Progress) response to the originating UE until the AS has received a SIP 180
(Ringing) provisional response from the served UE.
NOTE 2: The AS can, based on local policy, wait to instruct the MRF to start
CAT media until the AS has received a SIP 180 (Ringing) provisional response
from the served UE.
NOTE 3: The interaction between the AS and MRF is not specified for the CAT
service but can use the Cr reference point as described in 3GPP TS 24.229 [4].
NOTE 4: If the AS does not want to remain in the signalling path between the
originating UE and the terminating UE, the AS does not need to add its own
SIP-URI to the SIP Record-Route header.
NOTE 5: The AS can, if it supports the P-Early-Media header, based on local
policy choose to not provide the CAT service to the originating UE if the
initial INVITE request does not contain a P-Early-Media header with a
\"supported\" value.
Upon receiving a reliable provisional response from a served UE containing an
SDP answer to the original SIP INVITE request, the AS:
\- may forward the provisional response to the originating UE reliably and,
unless the provisional response contained a 199 response code, after changing
the Status-Line to SIP 183 (Session Progress) response;
\- if the AS supports the P-Early-Media header, the AS shall insert a P-Early-
Media header with an \"inactive\" value before forwarding the provisional
response;
\- shall, if the reliable provisional response is not forwarded to the
originating UE, acknowledge the received provisional response by sending a SIP
PRACK request as defined in RFC 3262 [5] to the served UE; and
\- shall, if the reliable provisional response contained an SDP answer and the
provisional response is not forwarded to the originating UE, save the SDP
answer contained in the reliable provisional response for that particular
early dialog. If forking has occurred toward the served user, the AS may save
SDP answers from several different UEs;
If precondition procedures are used between the originating UE and the served
UE, the AS shall forward reliable provisional responses which contain SDP to
the originating UE, in order to allow the UEs to exchange additional SDP
offers and answers associated with the precondition procedures.
Upon receiving an unreliable provisional response from a served UE to the
original SIP INVITE request, the AS may forward the provisional response to
the originating UE after changing the Status-Line to SIP 183 (Session
Progress) response.
If the AS supports the P-Early-Media header, the AS shall insert a P-Early-
Media header with an \"inactive\" value before forwarding the provisional
response.
Upon receiving a SIP 200 (OK) response to the initial SIP INVITE request from
a served UE indicating that the served user has answered the call, the AS
shall:
\- instruct the MRF to stop the media for the CAT service;
\- forward the SIP 200 (OK) response to the originating UE; and
\- if the AS has saved the SDP answer associated with the dialog confirmed by
the SIP 200 (OK) response and if the AS has not forwarded the SDP answer to
the originating UE, the AS shall include the saved SDP answer in the SIP 200
(OK) response.
Upon receiving a SIP 4xx, 5xx or 6xx response from a served UE the AS shall:
\- instruct the MRF to stop the media for the CAT service; and
\- forward the final response to the originating UE.
##### 4.5.5.3.3 AS Actions for early session model
Upon receiving an initial INVITE request destined to the served user including
a Supported header with \"early-session\" tag, as described in RFC 3959 [7],
the AS:
\- may contact the MRF to request CAT resource if session SDP preconditions
are not used, or local preconditions are fulfilled;
\- shall forward the initial INVITE request to the served user.
Upon receiving the first SIP 18x response to the initial INVITE request, the
AS shall:
\- if session SDP preconditions are not used in the initial INVITE request, or
local preconditions in the initial INVITE request are fulfilled, then contact
the MRF to request CAT resource if it has not been requested;
\- send a reliable SIP 18x response to the originating UE. The SIP 18x
response shall:
\- include a P-Asserted-Identity header containing the public user identity of
the served user unless privacy policy or restriction services prevent
providing any public user identity of the terminating party;
\- include a Require header with option tag \"early-session\";
\- include the SDP content for CAT as early-session SDP offer and if
preconditions are used, and CAT resource has been requested, indicate the
local preconditions are fulfilled;
Upon receiving additional SIP 18x response to the initial INVITE request, the
AS shall forward it to the originating UE.
Upon receiving a SIP request containing an early-session SDP offer that
indicates the local preconditions are fulfilled, the AS shall:
\- contact the MRF to request CAT resource;
\- generate an early-session SDP answer based on the information from the MRF
and, if preconditions are used, indicate that the local preconditions are
fulfilled; and
\- after receiving a SIP 200 (OK) response to the request, include the early-
session SDP answer in the SIP 200 (OK) response, and forwards it to the
originator.
If preconditions are used, the AS should not instruct the MRF to start
applicable media for the CAT service before the originating UE indicates that
early-session SDP local preconditions are fulfilled. Wheter to start
applicable media for the CAT service before or after receiving the SIP 180
(Ringing) response from the served UE is based on local policy.
If a SIP message from served UE containing an SDP offer related to an early
session is received, the AS shall send an SDP answer to the SDP offer related
to the early-session sent by the served UE and set all port numbers of the
media types to \"0\".
Upon receiving a SIP 200 (OK) response form the served UE to the initial
INVITE request, the AS shall instruct the MRF to stop media for the CAT
service and forward the SIP 200 (OK) response to the originating UE.
NOTE 1: The interaction between the AS and MRF is not specified for the CAT
service but can use the Cr reference point as described in 3GPP TS 24.229 [4].
Upon receiving a SIP 4xx, 5xx or 6xx response from a served UE the AS shall:
\- instruct the MRF to stop the media for the CAT service; and
\- forward the final response to the originating UE.
##### 4.5.5.3.4 AS Actions for Gateway model
The AS performing the Gateway model shall follow the procedure as specified in
RFC 3960 [8] with the additional procedures described in this subclause.
Upon receiving an SIP 180 (Ringing) response or SIP 183 (Session Progress)
response to the initial SIP INVITE request sent to the terminating UE, before
forwarding the response towards the originating UE, the AS shall:
a) if the SIP 180 (Ringing) response or the SIP 183 (Session Progress)
response to the initial SIP INVITE request includes an SDP answer, store the
SDP answer received from the terminating UE; and
b) generate an SDP answer, either:
1) based on the SDP answer as received from the terminating UE, if:
\- the originating UE requires the use of precondition mechanism; and
\- the resources required between the originating UE and the terminating UE
are more than the resources required between originating UE and MRF associated
with the AS for CAT; or
2) based on the information received from the MRF associated with AS for CAT,
for all other cases.
NOTE: The procedures for handling multiple early dialogs, due to forking, is
not specified in the current release of this specification.
If the originating UE requires the use of precondition mechanism, upon
receiving an SIP 200 (OK) response for SIP UPDATE request from terminating UE
which corresponds to UPDATE request sent by the originating UE to indicate
that resources at the originating UE is available, the AS shall:
a) store the SDP of the terminating UE; and
b) forward the SDP of the terminating UE to the originating UE.
If the originating UE requires the use of precondition mechanism, upon
receiving an SIP 180 (Ringing) response for SIP INVITE request from
terminating UE used to indicate that resources are available on the
terminating UE and user is being alerted, the AS shall forward the SDP of the
CAT to the originating UE in UPDATE method as specified in RFC 3311 [11];
Upon receiving an SIP 200 (OK) (INVITE) from terminating UE, the AS shall
generate an UPDATE request as specified in RFC 3311 [11] to update the media
with the originating UE using either:
a) if the AS has previously stored the SDP answer sent from the terminating
UE, the SDP answer of the terminating UE as previously stored; or
b) if the AS has not previously stored SDP answer sent from the terminating
UE, the SDP answer received in the immediate 200 (OK) response to the SIP
INVITE request.
## 4.6 Interaction with other services
### 4.6.1 Communication session Hold (HOLD)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.2 Termination Identification Presentation (TIP)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.3 Termination Identification Restriction (TIR)
The TIR service takes precedence over the CAT service subscribed by the called
party. If the TIR service prevents CAT media from being played to the calling
party, then the AS providing CAT service shall not apply the CAT service to
the session.
### 4.6.4 Originating Identification Presentation (OIP)
The order of the services in the filter criteria list should be configured so
that CAT service appears before OIP service, in order for the CAT service to
provide CAT media associated with the calling party\'s identity (i.e., the
called party may play one type of CAT media to a particular caller and other
types of CAT media to other callers depending on the called party\'s
subscription).
NOTE: If the called party does not subscribe to OIP service, the AS providing
OIP service will remove P-Asserted-Identity according to 3GPP TS 24.607 [10],
and it will not be possible to provide CAT service based on calling party\'s
identity if the OIP service was applied prior to CAT service in this given
case. Unless the network operator can assure that such scenario do not occur
based on their service configuration, as CAT service cannot be aware of
whether OIP service is subscribed by the user, and OIP service cannot be aware
of how CAT service is to be performed, CAT service will always need to be
performed prior to OIP service.
### 4.6.5 Originating Identification Restriction (OIR)
The OIR service takes precedence over the CAT service subscribed by the called
party. The behaviour of the CAT service is dependent on whether if the called
party has a CAT service associated with the calling party\'s identity (i.e.,
the called party may play one type of CAT media to a particular caller and
other types of CAT media to other callers depending on the called party\'s
subscription) and whether OIR service is requested.
The AS providing CAT service shall:
1) if the called party has CAT service associated with that specific calling
party\'s identity, the AS shall:
\- inspect the priv-value set in the Privacy header field in the request; and
\- if the Privacy header field is set to either \"id\", \"header\", or
\"user\", i.e. OIR service is requested, then the AS shall not apply CAT
service to the session.
2) in all other cases (i.e. except for the case if the called party has CAT
service associated with that specific calling party\'s identity, and OIR
service is requested), the AS shall process CAT service based on the called
party\'s subscription.
NOTE: OIR service itself is independent from CAT service, as the identities
that need to be restricted towards the terminating user will be handled, i.e.
restricted, appropriately by other functional entities as specified in 3GPP TS
24.229 [4], e.g. at the boundary of trust domain which may be the terminating
P-CSCF.
### 4.6.6 Conference (CONF)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.7 Communication DIVersion services (CDIV)
#### 4.6.7.1 General
If the diverting party has both CAT service and CDIV active, and the diverted-
to party has CAT service active, based on operator policy, either:
1) the CAT service of the diverted-to party shall be applied to the session by
the AS providing the CAT service of diverted-to party, except in the case of
CFNR. The interaction of CAT service with CFNR is described in subclause
4.6.7.2; or
2) the CAT service of the diverting party shall be applied to the session by
the AS providing CAT service for the diverting party, without the CAT service
for the diverted-to party applied to the session.
NOTE 1: the above network operator option can be deployed in cases where
diversion of the call is hidden from the calling party.
If the diverting party has both CAT service and CDIV active, and the diverted-
to party does not have an active service, based on operator policy, either:
1) no CAT service shall be applied to the session when CDIV is invoked; or
2) the CAT service of the diverting party shall be applied to the session by
the AS providing CAT service for the diverting party, without the CAT service
for the diverted-to party applied to the session.
NOTE 2: the above network operator option can be deployed in cases where
diversion of the call is hidden from the calling party.
#### 4.6.7.2 CFNR
If the diverting party has both CAT service and CFNR active, and the diverted-
to party has CAT service active, based on operator policy, either:
1) the CAT service of the diverting party shall be applied to the session by
the AS providing CAT service for the diverting party until the CFNR timer
expires. Upon the CFNR timer expiring, the AS providing CAT service for the
diverting party shall stop applying the CAT for the diverting user and the AS
providing CAT service for the diverted-to party shall apply the CAT service of
the diverted-to party; or
2) the CAT service of the diverting party shall be applied to the session by
the AS providing CAT service for the diverting party, without the CAT service
for the diverted-to party applied to the session.
NOTE 1: the above network operator option can be deployed in cases where
diversion of the call is hidden from the calling party.
If the diverting party has CAT service and CFNR active, and the diverted-to
party does not have an active service, based on operator policy, either:
1) the CAT service of the diverting party shall be applied to the session by
the AS providing CAT service for the diverting party until the CFNR timer
expires; or
2) the CAT service of the diverting party shall be applied to the session by
the AS providing CAT service for the diverting party, without the CAT service
for the diverted-to party applied to the session, until reception of a final
SIP response to the INVITE.
NOTE 2: the above network operator option can be deployed in cases where
diversion of the call is hidden from the calling party.
### 4.6.8 Message Waiting Indication (MWI)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.9 Communication Barring (CB)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.10 Explicit Call Transfer (ECT)
If the transfer target has CAT service active, the AS providing CAT service
shall apply the transfer target's CAT in the case of blind transfer. The AS
providing CAT service shall not apply the transfer target's CAT in the case of
consultative transfer while the call is transferring to the transfer target.
The CAT service of the transferor shall not be applied when ECT is invoked.
### 4.6.11 Communication Wait
In the case that the called party has Communication Waiting and CAT services
active, the AS providing the CAT service for the called party shall apply the
called party's CAT to the session if the called party is considered
\'approaching network determined user busy\' as a network operator option.
Alternatively, the AS providing the call party's CAT shall not apply the CAT
service and the Communication Waiting alert shall be applied.
### 4.6.12 Completion of Communications to Busy Subscriber
No impact, i.e. neither service shall affect the operation of the other
service.
## 4.7 Parameter values (timers)
No timers for CAT service are defined
## 4.8 Service configuration
User configuration of CAT service is not specified in this version of the
document.
###### ## Annex A (informative): Signalling flows
# A.1 Scope of signalling flows
This annex gives examples of signalling flows for the CAT service within the
IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation
Protocol (SIP).
# A.2 Introduction
# A.3 CAT forking model signalling flows
## A.3.1 Introduction
The following flows show establishment of a session between UE#1 and UE#2,
using the forking model described in subclause 4.5.5.3.2 to provide CAT to
UE#1. The following flows are included:
\- subclause A.3.2 shows CAT, using the forking, model, when UE#1 and UE#2
have resources available;
\- subclause A.3.3 shows CAT, using the forking, model, when UE#1 does not
have resources available;
\- subclause A.3.4 shows CAT, using the forking, model, when UE#2 does not
have resources available;
## A.3.2 CAT when UE#1 and UE#2 have resources available
Figure A.3.2-1: CAT, no resource reservation
> **1 INVITE request (UE#1 to S-CSCF) see example in table A.3.2-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.3.2-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: IEEE-802.11a
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
>
> Contact:\;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 6666::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, gruu and the 199 provisional response.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**SDP:** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
  1. **180 (Ringing) provisional response (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.3.2-2**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#1.
An early dialog (D1) is established between UE#1 and the CAT-AS.
NOTE: As an alternative, the CAT-AS can send the SIP 183 (Session Progress)
provisional response when the initial SIP INVITE request is received from
UE#1.
Table A.3.2-2: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1pcscf1.visited1.net;branch=z9hG4bK240f34.1,
> SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:bbb:aaa
>
> s=-
>
> c=IN IP6 6666::eee:fff:bbb:aaa
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP:** The SDP answer (SDP_A) contains a set of codecs supported to be used
for CAT. The SDP content is based on information received from the MRF. The
local preconditions are indicated as fulfilled.
> **9-10 PRACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to play CAT media.
> **11-12 200 (OK) response to PRACK (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **13-14 200 (OK) response to INVITE (UE#2 to CAT-AS) see example in table
> A.3.2-3**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.3.2-3: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> From:
>
> To: \;tag=6322
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**SDP:** The SDP answer (SDP_A) contains a set of codecs to be used for the
session. If preconditions are used, they are indicated as fulfilled.
> **15-16 200 (OK) response to INVITE (CAT-AS to UE#1)**
The CAT-AS forwards the SIP 200 (OK) response to UE#1.
A dialog (D2) is established between UE#1 and UE#2.
The early dialog (D1) between UE#1 and the CAT-AS is terminated.
  1. **ACK request (UE#1 to UE#2)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
## A.3.3 CAT when UE#1 does not have required resources available while UE#2
has resources available
Figure A.3.3-1: CAT, UE#1 does not have required resources available
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.3.3-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.3.3-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Accept: application/sdp, application/3gpp-ims+xml
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 6666::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, gruu and the 199 provisional response.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**SDP:** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the user at UE#1 for this session. The local preconditions are
indicated as not fulfilled, and media are set to \"inactive\".
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the SIP INVITE request to UE#2.
> **5-6 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.3.3-2**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#2.
An early dialog (D1) is established between UE#1 and the CAT-AS.
NOTE: As an alternative, the CAT-AS can send the SIP 183 (Session Progress)
provisional response when a SIP 180 (Ringing) provisional response is received
from UE#2.
Table A.3.3-2: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1pcscf1.visited1.net;branch=z9hG4bK240f34.1,
> SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \ service.ims.icsi.mmtel\">
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:bbb:aaa
>
> s=-
>
> c=IN IP6 6666::eee:fff:bbb:aaa
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP:** The SDP answer (SDP_A) contains a set of codecs supported to be used
for CAT. The SDP content is based on information received from the MRF. The
local preconditions are indicated as fulfilled.
> **7-8 PRACK request (UE#1 to CAT-AS) see example in table A.1.3-4**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
Table A.3.3-3: PRACK request (UE#1 to CAT-AS)
> PRACK sip:cat-as.home1.net
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> From:
>
> To: \ tag=314159
>
> Call-ID:
>
> Cseq: 129 PRACK
>
> Rack: 9022
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933669 IN IP6 6666::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 6666::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**SDP:** The local preconditions are indicated as fulfilled, and media are set
to \"sendrecv\".
> **9-10 200 (OK) response to PRACK (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **11-12 180 (Ringing) provisional response (UE#2 to CAT-AS) see example in
> table A.3.3-4**
The called party is alerted. UE#2 sends an unreliable SIP 180 (Ringing)
provisional response for the INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to start CAT media.
Table A.3.3-4: 180 (Ringing) response (UE#2 to CAT-AS)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> From:
>
> To: \;tag=6322
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel, precondition
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote none
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**SDP:** The SDP answer (SDP_A) contains a set of codecs to be used for the
session. The local preconditions are indicated as fulfilled.
> **13-14 183 (Session Progress) provisional response (CAT-AS to UE#1)**
The CAT-AS changes the response code to SIP 183 (Session Progress) and
forwards the SIP provisional response to UE#1.
An early dialog (D2) is established between UE#1 and UE#2.
> **15-16 PRACK request (UE#1 to UE#2)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to UE#2.
**SDP:** The local preconditions are indicated as fulfilled, and media are set
to \"sendrecv\".
> **17-18 200 (OK) response to PRACK (UE#2 to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **19-20 200 (OK) response to INVITE (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
> **21-22 200 (OK) response to INVITE (CAT-AS to UE#1)**
The CAT-AS forwards the SIP 200 (OK) response to UE#1.
The CAT-AS instructs the MRF to stop CAT media.
The early dialog (D1) between UE#1 and the CAT-AS is terminated.
> **23-24 ACK request (UE#1 to UE#2)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
## A.3.4 CAT when UE#1 has resources available while UE#2 does not have
required resources available
Figure A.3.4-1: CAT, UE#2 does not have required resources available
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.3.4-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.3.4-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: IEEE-802.11a
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
>
> Contact:\;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 6666::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, gruu and the 199 provisional response.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**SDP:** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the user at UE#1 for this session. The SDP contains an indication
that the local preconditions are fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the SIP INVITE request to UE#2.
> **5-6 180 (Ringing) provisional response (UE#2 to CAT-AS) see example in
> table A.3.4-2**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
Table A.3.4-2: 180 (Ringing) response (UE#2 to CAT-AS)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> From:
>
> To: \;tag=6322
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel, precondition
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote none
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**SDP:** The SDP answer (SDP_A) contains a set of codecs to be used for the
session. The local preconditions are indicated as fulfilled.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1)**
The CAT-AS changes the response code to 183 (Session Progress), and forwards
the SIP provisional response to UE#1.
An early dialog (D2) is established between UE#1 and UE#2.
> **9-10 PRACK request (UE#1 to UE#2)**
UE#1 sends a SIP PRACK request, which acknowledges the 183 (Session Progress)
provisional response, to UE#2.
  1. **200 (OK) response to PRACK (UE#2 to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **13-14 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.3.3-3**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#2.
An early dialog (D1) is established between UE#1 and the CAT-AS.
NOTE: As an alternative, the CAT-AS can send the SIP 183 (Session Progress)
provisional response when the initial SIP INVITE request is received from
UE#1.
Table A.3.3-4: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1pcscf1.visited1.net;branch=z9hG4bK240f34.1,
> SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:bbb:aaa
>
> s=-
>
> c=IN IP6 6666::eee:fff:bbb:aaa
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP:** The SDP answer (SDP_A) contains a set of codecs supported to be used
for CAT. The SDP content is based on information received from the MRF. The
SDP contains an indication that the local preconditions are fulfilled.
> **15-16 PRACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to start CAT media.
> **17-18 200 (OK) response to PRACK (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **19-20 200 (OK) response to INVITE (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
> **21-22 200 (OK) response to INVITE (CAT-AS to UE#1)**
The CAT-AS forwards the SIP 200 (OK) response to UE#1.
The early dialog (D1) between UE#1 and the CAT-AS is terminated.
  1. **ACK request (UE#1 to UE#2)**
UE#1 sends a SIP ACK request, which acknowledges the 200 (OK) final response,
to UE#2.
# A.4 CAT early session model signalling flows
## A.4.1 Introduction
The following flows show establishment of a session between UE#1 and UE#2,
using the early session model described in subclause 4.5.5.3.3 to provide CAT
to UE#1. The following flows are included:
\- subclause A.4.2 shows CAT, using the early session model, when UE#1 and
UE#2 have resources available;
\- subclause A.4.3 shows CAT, using the early session model, when UE#1 does
not have resources available;
\- subclause A.4.4 shows CAT, using the early session model, when UE#2 does
not have resources available;
## A.4.2 CAT when UE#1 and UE#2 have resources available
Figure A.4.2-1: CAT, no resource reservation
> **1 INVITE request (UE#1 to S-CSCF) see example in table A.4.2-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.4.2-1: INVITE request (UE#1 to S-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Supported: precondition, 100rel, early-session
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, and early-session SDP.
**SDP:** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. If preconditions are used, the
local preconditions are indicated as fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
**3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
**5-6 Relable 180 (Ringing) provisional response (UE#2 to CAT-AS) see example
in table A.4.2-5**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
Table A.4.2-5: 180 (Ringing) response (UE#2 to CAT-AS)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK472a32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.2, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> RSeq: 9022
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Length: 0
**7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see example
in table A.4.2-7**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#1.
An early-session SDP is sent to the UE#1 via the 183 provisional response.
Table A.4.2-7: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require: precondition, 100rel, early-session
>
> RSeq: 9022
>
> Contact:\;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:bbb:acc
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**early SDP** The early-session SDP offer (early SDP_O) contains a set of
codecs supported to be used for CAT. The early-session SDP content is based on
information received from the MRF. The local preconditions are indicated as
fulfilled.
> **9-10 PRACK request (UE#1 to CAT-AS) see example in table A.4.2-9**
UE#1 sends a SIP PRACK request with a early-session SDP answer, which
acknowledges the SIP 183 (Session Progress) provisional response, towards
UE#2.
The CAT-AS instructs the MRF to play CAT media.
Table A.4.2-9: PRACK request (UE#1 to CAT-AS)
> PRACK sip:cat-as.home1.net SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 128 PRACK
>
> Contact:
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=audio 3466 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**early SDP** The early-session SDP answer (early SDP_A) contains a set of
codecs supported by UE#1 to be used for CAT. The local preconditions are
indicated as fulfilled.
> **11-12 200 (OK) response to PRACK (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **13-14 200 (OK) response to INVITE (UE#2 to CAT-AS) see example in table
> A.4.2-13**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request towards UE#1.
The CAT-AS instructs the MRF to stop CAT media.
Table A.4.2-13: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Contact:
> \ >;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A) contains a set of codecs to be used for the
session. If preconditions are used, they are indicated as fulfilled.
> **15-16 200 (OK) response to INVITE (CAT-AS to UE#1)**
The CAT-AS forwards the SIP 200 (OK) response to UE#1.
A regular session is established between UE#1 and UE#2.
The early session between UE#1 and the CAT-AS is terminated.
  1. **ACK request (UE#1 to UE#2)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
## A.4.3 CAT when UE#1 does not have required resources available while UE#2
has resources available
Figure A.4.3-1: CAT, UE#1 does not have resources available
> **1-2 INVITE request (UE#1 to CAT-AS) see example in table A.4.3-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.4.3-1: INVITE request (UE#1 to S-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Supported: precondition, 100rel, early-session
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, and early-session SDP.
**SDP** The SDP offer (SDP_O1) contains a set of codecs supported by UE#1 and
desired by the user at UE#1 for this session. The SDP contains an indication
that the local preconditions are not fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the SIP INVITE request to UE#2.
> **5-6 183 (Session Progress) provisional response (UE#2 to CAT-AS) see
> example in table A.4.3-5**
UE#2 sends a SIP 183 (Session Progress) provisional response for the INVITE
request to the CAT-AS.
Table A.4.3-5: 183 (Session Progress) response (UE#2 to CAT-AS)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To: \;tag=6322
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel, precondition
>
> RSeq: 9021
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A1) contains a set of codecs to be used for the
session. The local preconditions are indicated as fulfilled.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.4.3-7**
The CAT-AS forwards the SIP 183 provisional response with early-session SDP
for CAT to UE#1.
Table A.4.3-7: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel, precondition, early-session
>
> RSeq: 9021
>
> Contact:
>
> Content-Type: multipart/mixed; boundary=\"boundary1\"
>
> Content-Length: (...)
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::ccc:aaa:bbb:acc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:bbb:acc
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> \--boundary1
**early SDP** The early-session SDP offer (early SDP_O1) contains a set of
codecs to be used for CAT. The preconditions are indicated as not fulfilled.
> **9-10 PRACK request (UE#1 to CAT-AS) see example in table A.4.3-9**
UE#1 sends a SIP PRACK request with early-session SDP answer, which
acknowledges the 183 (Session Progress) provisional response, towards UE#2.
Table A.4.3-9: PRACK request (UE#1 to CAT-AS)
> PRACK
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 128 PRACK
>
> Contact:
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3500 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> m=audio 3556 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**early SDP** The early-session SDP answer (early SDP_A1) contains a set of
codecs supported by UE#1 to be used for CAT. The preconditions are indicated
as not fulfilled.
> **11-12 PRACK request (CAT-AS to UE#2) see example in table A.4.3-11**
CAT-AS forwards the SIP PRACK request without early-session SDP answer to
UE#2.
Table A.4.3-11: PRACK request (CAT-AS to UE#2)
> PRACK
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP catas.home2.net;branch=z9hG4bK614Q63.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK464z73.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK351b51.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK582f12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> Max-Forwards: 66
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 128 PRACK
>
> Contact:
>
> Content-Length: 0
>
> **13-16 200 (OK) response to PRACK (UE#2 to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **17-18 UPDATE request (UE#1 to CAT-AS) see example in table A.4.3-17**
UE#1 reserved resources for regular session and early session, it sends an SIP
UPDATE request with session SDP offer and early-session SDP offer towards
UE#2.
Table A.4.3-17: UPDATE request (UE#1 to CAT-AS)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 129 UPDATE
>
> Contact:
>
> Content-Type: multipart/mixed; boundary=\"boundary1\"
>
> Content-Length: (...)
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3500 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3556 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> \--boundary1
**SDP** The offer (SDP_O2) contains a set of codecs supported by UE#1 and
desired by the user at UE#1 for this session. The SDP contains an indication
that the preconditions are fulfilled.
**early SDP** The early-session SDP offer (early SDP_O2) contains a set of
codecs supported by UE#1 to be used for CAT. The local preconditions are
indicated as fulfilled.
> **19-20 UPDATE request (CAT-AS to UE#2) see example in table A.4.3-19**
CAT-AS forwards the SIP UPDATE request towards UE#2 without early-session SDP.
The CAT-AS instructs the MRF to reserve CAT resources.
Table A.4.3-19: UPDATE request (CAT-AS to UE#2)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP catas.home2.net;branch=z9hG4bK164Q63.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK442z73.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK514b51.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK812f12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> Max-Forwards: 66
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 129 UPDATE
>
> Contact:
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> **21-22 200 (OK) response to UPDATE (UE#2 to CAT-AS) see example in table
> A.4.3-21**
UE#2 sends a SIP 200 (OK) for the SIP UPDATE request to the CAT-AS.
Table A.4.3-21: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK611k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764KS12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK164Q63.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK442z73.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK514b51.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK812f12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Contact:
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A2) contains a set of codecs to be used for the
session. The preconditions are indicated as fulfilled.
> **23-24 200 (OK) response to UPDATE (CAT-AS to UE#1) see example in table
> A.4.3-23**
CAT-AS forwards the SIP 200 (OK) for the SIP UPDATE request to UE#1.
Table A.4.3-23: 200 (OK) response (CAT-AS to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP catas.home2.net;branch=z9hG4bK164Q63.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK442z73.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK514b51.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK812f12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Contact:
>
> Content-Type: multipart/mixed; boundary=\"boundary1\"
>
> Content-Length: (...)
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::ccc:aaa:bbb:acc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:bbb:acc
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> \--boundary1
**early SDP** The early-session SDP answer (early SDP_A2) contains a set of
codecs supported by UE#1 to be used for CAT. The early-session SDP content is
based on information received from the MRF. The preconditions are indicated as
fulfilled.
> **25-26 180 (Ringing) response to INVITE (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request towards UE#1.
The CAT-AS terminates the provisional response.
The CAT-AS instructs the MRF to play CAT media.
> **27-28 200 (OK) response to INVITE (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request towards UE#1.
The CAT-AS instructs the MRF to stop CAT media.
> **29-30 200 (OK) response to INVITE (CAT-AS to UE#1)**
The CAT-AS forwards the SIP 200 (OK) response to UE#1.
A regular session is established between UE#1 and UE#2.
The early session between UE#1 and the CAT-AS is terminated.
> **31-32 ACK request (UE#1 to UE#2)**
UE#1 sends a SIP ACK request, which acknowledges the 200 (OK) final response,
to UE#2.
## A.4.4 CAT when UE#1 has resources available while UE#2 does not have
required resources available
Figure A.4.4-1: CAT, UE#2 does not have resources available
> **1-2 INVITE request (UE#1 to CAT-AS) see example in table A.4.4-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.4.4-1: INVITE request (UE#1 to S-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Supported: precondition, 100rel, early-session
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
> >;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, and early-session SDP.
**SDP** The SDP offer (SDP_O1) contains a set of codecs supported by UE#1 and
desired by the user at UE#1 for this session. The SDP contains an indication
that the local preconditions are fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the SIP INVITE request to UE#2.
> **5-6 183 (Session Progress) provisional response (UE#2 to CAT-AS) see
> example in table A.4.4-5**
UE#2 sends a SIP 183 (Session Progress) provisional response for the INVITE
request to the CAT-AS.
Table A.4.4-5: 183 (Session Progress) response (UE#2 to CAT-AS)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To: \;tag=6322
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel, precondition
>
> RSeq: 9021
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A1) contains a set of codecs to be used for the
session. The preconditions are indicated as fulfilled.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.4.4-7**
The CAT-AS forwards the SIP 183 provisional response with early-session SDP
for CAT to UE#1.
Table A.4.4-7: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel, precondition, early-session
>
> RSeq: 9021
>
> Contact:
>
> Content-Type: multipart/mixed; boundary=\"boundary1\"
>
> Content-Length: (...)
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::ccc:aaa:bbb:acc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:bbb:acc
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> \--boundary1
**early SDP** The early-session SDP offer (early SDP_O1) contains a set of
codecs to be used for CAT. The local preconditions are indicated as fulfilled.
> **9-10 PRACK request (UE#1 to CAT-AS) see example in table A.4.4-9**
UE#1 sends a SIP PRACK request with early-session SDP answer, which
acknowledges the 183 (Session Progress) provisional response, towards UE#2.
Table A.4.4-9: PRACK request (UE#1 to CAT-AS)
> PRACK
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 128 PRACK
>
> Contact:
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3500 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> m=audio 3556 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**early SDP** The early-session SDP answer (early SDP_A1) contains a set of
codecs supported by UE#1 to be used for CAT. The preconditions are indicated
as fulfilled.
> **11-12 PRACK request (CAT-AS to UE#2) see example in table A.4.4-11**
CAT-AS forwards the SIP PRACK request without early-session SDP answer to
UE#2.
Table A.4.4-11: PRACK request (CAT-AS to UE#2)
> PRACK
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74SIP/2.0
>
> Via: SIP/2.0/UDP catas.home2.net;branch=z9hG4bK614Q63.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK464z73.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK351b51.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK582f12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> Max-Forwards: 66
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 128 PRACK
>
> Contact:
>
> Content-Length: 0
>
> **13-16 200 (OK) response to PRACK (UE#2 to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **17-18 180 (Ringing) response to INVITE (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request towards UE#1.
The CAT-AS terminates the provisional response.
The CAT-AS instructs the MRF to play CAT media.
> **19-20 200 (OK) response to INVITE (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request towards UE#1.
The CAT-AS instructs the MRF to stop CAT media.
> **21-22 200 (OK) response to INVITE (CAT-AS to UE#1)**
The CAT-AS forwards the SIP 200 (OK) response to UE#1.
A regular session is established between UE#1 and UE#2.
The early session between UE#1 and the CAT-AS is terminated.
> **23-24 ACK request (UE#1 to UE#2)**
UE#1 sends a SIP ACK request, which acknowledges the 200 (OK) final response,
to UE#2.
# A.5 CAT Gateway model signalling flows
## A.5.1 Introduction
The following flows show establishment of a session between UE#1 and UE#2,
using the gateway model as defined in RFC 3960 [8] to provide CAT to UE#1. The
following flows are included:
\- subclause A.5.2 shows CAT, using the gateway model, when UE#1 and UE#2 have
resources available;
\- subclause A.5.3 shows CAT, using the gateway model, when UE#1 does not have
resources available;
\- subclause A.5.4 shows CAT, using the gateway model, when UE#2 does not have
resources available;
\- subclause A.5.5 shows CAT, using the gateway model, when both UE#1 and UE#2
do not have resources available.
## A.5.2 CAT when UE#1 and UE#2 have resources available
Figure A.5.1-1: CAT, no resource reservation
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.5.2-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.5.2-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact: \ user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for GRUU, 199 responses, reliable
provisional responses and preconditions.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**SDP** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
  1. **INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
  1. **180 (Ringing) provisional response (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.5.2-2**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#1.
Table A.5.2-2: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 340051372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs supported to be
used for CAT. The SDP content is based on information received from the MRF.
The local preconditions are indicated as fulfilled.
> **9-10 PRACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to play CAT media.
> **11-12 200 (OK) response to PRACK (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **13-14 200 (OK) response to INVITE (UE#2 to CAT-AS) see example in table
> A.5.2-3**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.5.2-3: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. If preconditions are used, they are indicated as fulfilled.
> **15-16 UPDATE request (CAT-AS to UE#1) see example in table A.5.2-4**
The CAT-AS sends an UPDATE request containing values received in the 200 OK
from UE#2.
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#2.
Table A.5.2-4: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933617 2987933617 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. The SDP content is based on information received from previous
200 (OK) response. The local preconditions are indicated as fulfilled.
> **17-18 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. UE#1
includes a SDP answer (SDP_O2) in the 200 (OK) response to the corresponding
SIP UPDATE request.
> **19-20 200 (OK) response to INVITE (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **21-22 ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **23-24 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
NOTE 2: The ACK request from CAT-AS towards UE#2 may be sent after receiving
200 OK from UE#2 in step 14.
## A.5.3 CAT when UE#1 does not have required resources available while UE#2
has resources available
Figure A.5.3-1 shows an example call flow for CAT when UE#1 does not have
required resources available and UE#2 have resources available.
Figure A.5.3-1: CAT, UE#1 does not have required resources available
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.5.3-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.5.3-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \ >;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for GRUU, 199 responses, reliable
provisional responses and preconditions.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**SDP** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as not fulfilled, and media are set to \"inactive\".
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
> **5-6 183 (Session Progress) provisional response (UE#2 to CAT-AS) see
> example in table A.5.3-2**
UE#2 sends a reliable SIP 183 (Session Progress) provisional response for the
INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
Table A.5.3-2: 183 (Session Progress) provisional response (UE#2 to CAT-AS)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. The local preconditions are indicated as not fulfilled, and media
are set to \"inactive\".
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.5.3-3**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#1. The CAT-AS shall take into account, when creating the SDP message, the
media indicated by UE#2 in the previously received 183 provisional response
and the one used by MRF for the media for CAT.
Table A.5.3-3: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 51372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs supported to be
used for CAT. The SDP content is based on information received from the MRF
and information in the previously received 183 provisonal response from UE#2.
The local preconditions are indicated as not fulfilled, and media are set to
\"inactive\".
> **9-12 PRACK request (UE#1 to CAT-AS, and to UE#2)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS, which is further sent to UE#2.
> **13-16 200 (OK) response to PRACK (UE#2 to CAT-AS, and to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to CAT-AS, which
is further sent to UE#1.
**17-18 UPDATE request (UE#1 to CAT-AS) - see example in table A.5.3-4**
UE#1 indicates that it can send and receive media as the necessary resources
are available.
Table A.5.3-4: UPDATE request (UE#1 to CAT-AS)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \, \,
> \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq: 129 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_O_cat) contains a set of codecs supported to be
used for CAT. The SDP content is based on information received from the MRF.
The local preconditions are indicated as fulfilled.
**19-20 UPDATE request (CAT-AS to UE#2) - see example in table A.5.3-5**
CAT-AS indicates to UE#2 that UE#1 can send and receive media as the necessary
resources are available.
Table A.5.3-5: UPDATE request (CAT-AS to UE#2)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74;comp=sigcomp
> SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq: 56101 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_O_regular) contains a set of codecs supported to
be used for CAT. The SDP content is based on information received from the
MRF. The local preconditions are indicated as fulfilled.
**21-22 200 (OK) response (UE#2 to CAT-AS) - see example in table A.5.3-6**
UE#2 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. The
SDP shall contain information relevant to the media that will be used after
the session is established.
CAT-AS shall store the relevant information in SDP for later use in step 31.
Table A.5.3-6: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. The local preconditions are indicated as fulfilled.
**23-24 200 (OK) response (CAT-AS to UE#1) - see example in table A.5.3-7**
CAT-AS sends a SIP 200 (OK) response for the SIP UPDATE request to UE#1. The
SDP shall contain information relevant to the media for CAT used by the MRF.
Table A.5.3-7: 200 (OK) response (CAT-AS to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336157 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs to be used for the
session. The local preconditions are indicated as fulfilled.
> **25-26 180 (Ringing) provisional response (UE#2 to CAT-AS)**
UE#2 sends a SIP 180 (Ringing) provisional response for the INVITE request to
the CAT-AS.
The CAT-AS instructs the MRF to play CAT media upon receipt of 180.
> **27-28 180 (Ringing) provisional response (CAT-AS to UE#1)**
CAT-AS sends a SIP 180 (Ringing) provisional response for the INVITE request
to the UE#1.
> **29-30 200 (OK) response to INVITE (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
> **31-32 UPDATE request (CAT-AS to UE#1) see example in table A.5.3-8**
The CAT-AS sends an UPDATE request containing values received in the 200 OK
for UPDATE from UE#2 in step 22.
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#2.
NOTE 1: The AS will remain in the signalling path, i.e. work as a B2BUA, in
order to align and maintain information in SDP for further exchanged messages
between UE#1 and UE#2.
Table A.5.3-8: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336158 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. The SDP content is based on information received from previous
200 (OK) response.
> **33-34 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. If
the resources indicated for the media cannot be reused by the one reserved for
the CAT media, UE#1 shall reserve necessary resources prior to sending the
response.UE#1 includes a SDP answer (SDP_O2) in the 200 (OK) response to the
corresponding SIP UPDATE request.
> **35-36 200 (OK) response to INVITE (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **37-38 ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **39-40 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
NOTE 3: The ACK request from CAT-AS towards UE#2 may be sent after receiving
200 OK from UE#2 in step 18.
## A.5.4 CAT when UE#1 has resources available while UE#2 does not have
required resources available
Figure A.5.4-1 shows an example call flow for CAT when UE#1 has resources
available while UE#2 does not have required resources available.
Figure A.5.4-1: CAT, UE#2 does not have required resources available
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.5.4-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.5.4-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact: \ user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for GRUU, 199 responses, reliable
provisional responses and preconditions.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**SDP** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
> **5-6 180 (Ringing) provisional response (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.5.4-2**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#1.
Table A.5.4-2: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 51372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs supported to be
used for CAT. The SDP content is based on information received from the MRF.
The local preconditions are indicated as fulfilled.
> **9-10 PRACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to play CAT media.
> **11-12 200 (OK) response to PRACK (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **13-14 200 (OK) response to INVITE (UE#2 to CAT-AS) see example in table
> A.5.4-3**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.5.4-3: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. If preconditions are used, they are indicated as fulfilled.
> **15-16 UPDATE request (CAT-AS to UE#1) see example in table A.5.4-4**
The CAT-AS sends an UPDATE request containing values received in the 200 OK
from UE#2.
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#2.
Table A.5.4-4: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933617 2987933617 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. The SDP content is based on information received from previous
200 (OK) response.
> **17-18 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. If
the resources indicated for the media cannot be reused by the one reserved for
the CAT media, UE#1 shall reserve necessary resources prior to sending the
response. UE#1 includes a SDP answer (SDP_O2) in the 200 (OK) response to the
corresponding SIP UPDATE request.
> **19-20 200 (OK) response to INVITE (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **21-22 ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **23-24 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
NOTE 2: The ACK request from CAT-AS towards UE#2 may be sent after receiving
200 OK from UE#2 in step 14.
### A.5.5 CAT when both UE#1 and UE#2 do not have required resources available
Figure A.5.5-1 shows an example call flow for CAT when UE#1 and UE#2 does not
have required resources available, and the session bandwidth between UE#1 and
UE#2 is rather than the session bandwidth between UE#1 and CAT-AS.
Figure A.5.5-1: CAT, UE#1 and UE#2 does not have required resources available
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.5.5-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.5.5-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \ >;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
Supported: The UE indicates support for 199 responses, reliable provisional
responses and preconditions.
P-Early-Media: The UE indicates support for the P-Early-Media header.
Recv-Info: The UE indicates willingness to receive DTMF Info Packages in INFO
requests.
SDP: The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as not fulfilled, and media are set to \"inactive\".
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
> **5-6 183 (Session Progress) provisional response (UE#2 to CAT-AS) see
> example in table A.5.5-2**
UE#2 sends a reliable SIP 183 (Session Progress) provisional response for the
INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
Table A.5.5-2: 183 (Session Progress) provisional response (UE#2 to CAT-AS)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** : The SDP answer (SDP_A_regular) contains a set of codecs to be used
for the session. The local preconditions are indicated as not fulfilled, and
media are set to \"inactive\".
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.5.5-3**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#1. The CAT-AS shall take into account, when creating the SDP message, the
media indicated by UE#2 in the previously received 183 (Session Progress)
provisional response.
Table A.5.5-3: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 51372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP:** The SDP answer (SDP_A_regular) contains a set of codecs to be used
for the session. The local preconditions are indicated as not fulfilled, and
media are set to \"inactive\".
> **9-12 PRACK request (UE#1 to CAT-AS, and to UE#2)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS, which is further sent to UE#2.
> **13-16 200 (OK) response to PRACK request (UE#2 to CAT-AS, and to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to CAT-AS, which
is further sent to UE#1.
**17-18 UPDATE request (UE#1 to CAT-AS) - see example in table A.5.5-4**
UE#1 indicates that it can send and receive media as the necessary resources
are available.
Table A.5.5-4: UPDATE request (UE#1 to CAT-AS)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \, \,
> \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq: 129 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP:** The SDP answer (SDP_O2) contains a set of codecs supported to be used
for the session. The SDP content is based on information received from the
UE#2. The local preconditions are indicated as fulfilled.
**19-20 UPDATE request (CAT-AS to UE#2) - see example in table A.5.5-5**
CAT-AS indicates to UE#2 that UE#1 can send and receive media as the necessary
resources are available.
Table A.5.5-5: UPDATE request (CAT-AS to UE#2)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74;comp=sigcomp
> SIP/2.0
>
> Via: [5555::ccc:aaa:abc:abc]:1357;comp=sigcomp;branch=z9hG4bKnashds8
>
> Max-Forwards: 66
>
> Route: \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq: 56101 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP:** The SDP answer (SDP_O2) contains a set of codecs supported to be used
for the session. The SDP content is based on information received from the
UE#1. The local preconditions are indicated as fulfilled.
**21-24 200 (OK) response (UE#2 to CAT-AS, and to UE#1) - see example in table
A.5.5-6**
UE#2 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. The
SDP shall contain information relevant to the media that will be used after
the session is established.
CAT-AS shall store the relevant information in SDP for later use in step 35.
Table A.5.5-6: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP:** The SDP answer (SDP_A_regular2) contains a set of codecs to be used
for the session. The local preconditions are indicated as fulfilled.
> **25-26 180 (Ringing) provisional response (UE#2 to CAT-AS)**
UE#2 sends a SIP 180 (Ringing) provisional response for the INVITE request to
the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources upon receipt of 180.
> **27-28 UPDATE request (CAT-AS to UE#1) see example in table A.5.5-8**
The CAT-AS sends an UPDATE request containing values received in the 200 (OK)
for UPDATE request from UE#2 in step 22.
Session between UE#1 and UE#2 is replaced with session between UE#1 and CAT-
AS.
NOTE 1: The AS will remain in the signalling path, i.e. work as a B2BUA, in
order to align and maintain information in SDP for further exchanged messages
between UE#1 and UE#2.
Table A.5.5-7: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336158 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_O_cat) contains a set of codecs to be used for
CAT. The SDP content is based on information received from previous 200 (OK)
response.
> **29-30 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. UE#1
includes a SDP answer (SDP_A_cat) in the 200 (OK) response to the
corresponding SIP UPDATE request. The CAT-AS instructs MRF to start playing
the CAT media.
> **31-32 180 (Ringing) provisional response (CAT-AS to UE#1)**
CAT-AS sends a SIP 180 (Ringing) provisional response for the INVITE request
to the UE#1.
> **33-34 200 (OK) response to INVITE request (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
> **35-36 UPDATE request (CAT-AS to UE#1) see example in table A.5.5-8**
The CAT-AS sends an UPDATE request containing values received in the 200 (OK)
for UPDATE request from UE#2 in step 22.
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#2.
NOTE 1: The AS will remain in the signalling path, i.e. work as a B2BUA, in
order to align and maintain information in SDP for further exchanged messages
between UE#1 and UE#2.
Table A.5.5-8: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336158 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP:** The SDP answer (SDP_O_regular2) contains a set of codecs to be used
for the session. The SDP content is based on information received from
previous 200 (OK) response.
> **37-38 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. If
the resources indicated for the media cannot be reused by the one reserved for
the CAT media, UE#1 shall reserve necessary resources prior to sending the
response.UE#1 includes a SDP answer (SDP_A3) in the 200 (OK) response to the
corresponding SIP UPDATE request.
> **39-40 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **41-42 ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **43-44 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
NOTE 3: The ACK request from CAT-AS towards UE#2 may be sent after receiving
200 (OK) from UE#2 in step 18.
# A.6 Interworking with CS domain
## A.6.1 Introduction
The following signalling flows show interworking with the CS domain, when CAT
is provided by the terminating CS domain to the IMS, and when CAT is provided
to the originating CS domain from the IMS. The following flows are included:
\- subclause A.6.2 shows CAT when CAT is provided by the terminating CS
domain;
\- subclause A.6.3 shows CAT, using the forking model, when CAT is provided to
the originating CS domain;
\- subclause A.6.4 shows CAT, using the early session, model, when CAT is
provided to the originating CS domain;
The signalling flow in subclause A.6.2 is not dependent on which CAT model is
used.
## A.6.2 CAT provided by the terminating CS domain
Figure A.6.2-1: CAT provided by terminating CS system
> **1-2 INVITE request (UE#1 to MGCF) see example in table A.6.2-1**
UE#1 sends a SIP INVITE request to the MGCF.
The MGCF sends an ISUP IAM message to CS.
Table A.6.2-1: INVITE request (UE#1 to MGCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: IEEE-802.11a
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 6666::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, gruu and the 199 provisional response.
**SDP:** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
> **3 183 (Session Progress) provisional response (MGCF to UE#1) see example
> in table A.6.2-2**
The MGCF sends a reliable SIP 183 (Session Progress) provisional response to
UE#1.
An early dialog is established between UE#1 and the MGCF.
CAT media is received from CS.
Table A.6.2-2: 183 (Session Progress) response (MGCF to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1pcscf1.visited1.net;branch=z9hG4bK240f34.1,
> SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendonly
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 0 RTP/AVP 98
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**P-Early-Media:** The MGCF requests authorization for early media.
**SDP:** The SDP answer (SDP_A) contains a set of codecs to be used for the
session. The video stream is rejected. The local preconditions are indicated
as fulfilled.
> **4 PRACK request (UE#1 to MGCF)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the MGCF.
> **5 200 (OK) response to PRACK (MGCF to UE#1)**
The MGCF sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
**6 ACM message (CS to MGCF)**
The MGCF receives an ISUP ACM message from CS.
> **7-8 200 (OK) response to INVITE (MGCF to UE#1)**
The MGCF receives an ISUP ANM message from CS.
The MGCF sends a SIP 200 (OK) response for the SIP INVITE request to UE#1.
> **9 ACK request (UE#1 to MGCF)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to the MGCF.
## A.6.3 CAT provided to the originating CS domain with the CAT forking model
Figure A.6.3-1: CAT provided to originating CS system
> **1-2 INVITE request (MGCF to CAT-AS) see example in table A.6.3-1**
The MGCF receives an ISUP IAM message from CS.
The MGCF sends a SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
Table A.6.3-1: INVITE request (MGCF to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Privacy: none
>
> P-Early-Media: supported
>
> P-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Supported: precondition, 100rel, gruu, 199
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 6666::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, gruu and the 199 provisional response.
**P-Early-Media:** The MGCF indicates support for the P-Early-Media header.
**Supported:** The MGCF indicates support for reliable provisional responses.
**SDP:** The SDP offer (SDP_O) contains a set of codecs supported by the MGCF
and desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
  1. **INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the SIP INVITE request to UE#2.
  1. ** 180 (Ringing) provisional response (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the SIP INVITE request to the CAT-AS.
The CAT-AS terminates the SIP 180 (Ringing) provisional response.
> **7-8 183 (Session Progress) provisional response (CAT-AS to MGCF) see
> example in table A.6.3-2**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
the MGCF.
An early dialog (D1) is established between the MGCF and the CAT-AS.
The MGCF sends an ISUP ACM message to CS.
Table A.6.3-2: 183 (Session Progress) response (CAT-AS to MGCF)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:bbb:aaa
>
> s=-
>
> c=IN IP6 5555::eee:fff:bbb:aaa
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP:** The SDP answer (SDP_A) contains a set of codecs supported to be used
for CAT. The SDP content is based on information received from the MRF. The
local preconditions are indicated as fulfilled.
> **9 PRACK request (MGCF to CAT-AS)**
The MGCF sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to play CAT media.
> **10 200 (OK) response to PRACK (CAT-AS to MGCF)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to the
MGCF.
> **11-12 200 (OK) response to INVITE (UE#2 to CAT-AS) see example in table
> A.6.3-3**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.6.3-3: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> From:
>
> To: \;tag=6322
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**SDP:** The SDP answer (SDP_A) contains a set of codecs to be used for the
session. If preconditions are used, they are indicated as fulfilled.
> **13-14 200 (OK) response to INVITE (CAT-AS to MGCF)**
The CAT-AS forwards the SIP 200 (OK) response to the MGCF.
A dialog (D2) is established between the MGCF and UE#2.
The early dialog (D1) between the MGCF and the CAT-AS is terminated.
The MGCF sends an ISUP ANM message to CS.
> **15 ACK request (MGCF to UE#2)**
The MGCF sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
## A.6.4 CAT provided to the originating CS domain with the CAT early session
model
Figure A.6.4-1: CAT provided to originating CS domain with the CAT early-
session model
> **1-2. INVITE request (MGCF to CAT-AS) see example in table A.6.4-2**
>
> The MGCF receives an ISUP IAM message from CS domain.
>
> The MGCF sends a SIP INVITE request to the CAT-AS.
>
> The CAT-AS instructs the MRF to reserve CAT resources.
Table A.6.4-2: INVITE request (MGCF to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Privacy: none
>
> P-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Supported: precondition, 100rel, gruu, early-session
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98 99
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=rtpmap:99 MP4V-ES
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; mode-change-period=2
>
> a=rtpmap:96 telephone-event
>
> a=maxptime:20
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, gruu and early-session disposition type.
**SDP** The SDP offer (SDP_O) contains a set of codecs supported by the MGCF
and desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
> **3 INVITE request (CAT-AS to UE#2)**
>
> The CAT-AS forwards the SIP INVITE request to UE#2.
>
> **4 180 (Ringing) provisional response (UE#2 to CAT-AS)**
>
> The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
> response for the SIP INVITE request to the CAT-AS.
>
> **5 180 (Ringing) provisional response (CAT-AS to MGCF) see example in
> table** **A.6.4-5**
>
> The CAT-AS sends a reliable SIP 180 (Ringing) provisional response to the
> MGCF.
Table A.6.4-5: SIP 180 (Ringing) responses (CAT-AS to MGCF)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 10001 RTP/AVP 98 99
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:98 H263
>
> a=rtpmap:99 MP4V-ES
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 6544 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; mode-change-period=2
>
> a=rtpmap:96 telephone-event
>
> a=maxptime:20
**Early Session SDP** The early session SDP offer (early-session SDP_O)
contains a set of codecs supported to be used for CAT. The SDP content is
based on information received from the MRF. The local preconditions are
indicated as fulfilled.
> **6 ACM/CPG message (MGCF to CS domain)**
>
> The MGCF sends an ACM or CPG message to CS domain.
>
> If the IMS CAT is multimedia, the MGCF shall take an indication in ACM or
> CPG message which instructs originating MSC to initiate H.245 negotiation
> between CS user and MGCF.
NOTE: How to take the indication in ACM or CPG message is out of scope of this
specification.
**7** **PRACK request (MGCF to CAT AS) see example in table A.6.4-7**
> The MGCF sends a SIP PRACK request, which acknowledges the SIP 180 (Ringing)
> provisional response, to the CAT-AS.
>
> An early dialog using early-session SDP is established between the MGCF and
> the CAT-AS.
>
> The CAT-AS instructs the MRF to play CAT media.
**Table A.6.4-7: SIP PRACK Request (MGCF to CAT AS)**
> PRACK sip:cat-as.home1.net SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 128 PRACK
>
> Require: precondition
>
> RAck: 9022 127 INVITE
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3402 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3458 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; mode-change-period=2
>
> a=rtpmap:96 telephone-event
>
> a=maxptime:20
**Early Session SDP** The early session SDP answer (early-session SDP_A)
contains a set of codecs to be used for the CAT. If preconditions are used,
they are indicated as fulfilled.
> **8 200 (OK) response to PRACK (CAT-AS to MGCF)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to the
MGCF.
> **9 200 (OK) response to INVITE (UE#2 to CAT-AS) see example in table
> A.6.4-9**
>
> The called party answers the call. UE#2 sends a SIP 200 (OK) final response
> for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.6.4-9: SIP 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \ >;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::ggg:hhh:iii:jjj
>
> s=-
>
> c=IN IP6 5555::ggg:hhh:iii:jjj
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; mode-change-period=2
>
> a=rtpmap:96 telephone-event
>
> a=maxptime:20
**SDP** The SDP answer (SDP_A) contains a set of codecs to be used for the
session. If preconditions are used, they are indicated as fulfilled.
> **10-11 200 (OK) responses to INVITE (CAT-AS to MGCF)**
>
> The CAT-AS forwards the SIP 200 (OK) response to the MGCF.
>
> The dialog for session is established between the MGCF and UE#2.
>
> The early dialog using early-session SDP between the MGCF and the CAT-AS is
> terminated.
>
> The MGCF sends an ISUP ANM message to CS domain.
>
> **12 ACK request (MGCF to UE#2)**
>
> The MGCF sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
> response, to UE#2.
#
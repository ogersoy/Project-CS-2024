# Foreword
This Technical Specification (TS) was been produced by ETSI Technical
Committee Telecommunications and Internet converged Services and Protocols for
Advanced Networking (TISPAN) and originally published as ETSI TS 183 006 [14].
It was transferred to the 3^rd^ Generation Partnership Project (3GPP) in
December 2007.
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
This clause is optional. If it exists, it is always the second unnumbered
clause.
# 1 Scope
The present document specifies the stage three Protocol Description of the
Message Waiting Indication (MWI) service, based on stage one and two of the
ISDN MWI supplementary services. Within the TISPAN NGN Release1 Next
Generation Network (NGN) the stage 3 description is specified using the IP
Multimedia Call Control Protocol based on Session Initiation Protocol (SIP)
and Session Description Protocol (SDP).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or nonâ€‘specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
Referenced documents which are not found to be publicly available in the
expected location might be found at
[http://docbox.etsi.org/Reference]{.underline}.
NOTE: While any hyperlinks included in this clause were valid at the time of
publication ETSI cannot guarantee their long term validity.
[1] ETSI TS 181 002: \"Telecommunications and Internet converged Services and
Protocols for Advanced Networking (TISPAN); Multimedia Telephony with
PSTN/ISDN simulation services\".
[2] ETSI ES 283 003: \"Telecommunications and Internet converged Services and
Protocols for Advanced Networking (TISPAN); IP Multimedia Call Control
Protocol based on Session Initiation Protocol (SIP) and Session Description
Protocol (SDP) Stage 3\ [3GPP TS 24.229 (Release 7), modified]\".
[3] IETF RFC 3842: \"A Message Summary and Message Waiting Indication Event
Package for the Session Initiation Protocol (SIP)\".
[4] IETF RFC 3265: \"Session Initiation Protocol (SIP)-Specific Event
Notification\".
[5] IETF RFC 3458: \"Message Context for Internet Mail\".
[6] IETF RFC 3938: \"Video-Message Message-Context\".
[7] IETF RFC 2822: \"Internet Message Format\".
[8] IETF RFC 2156: \"MIXER (Mime Internet X.400 Enhanced Relay): Mapping
between X.400 and RFC 822/MIME\".
[9] IETF RFC 3263: \"Session Initiation Protocol (SIP): Locating SIP
Servers\".
[10] ETSI TS 181 005: \"Telecommunications and Internet converged Services and
Protocols for Advanced Networking (TISPAN); Services and Capabilities
Requirements\".
[11] IETF RFC 3261: \"SIP: Session Initiation Protocol\".
[12] ETSI TS 124 228: \"Digital cellular telecommunications system (Phase 2+);
Universal Mobile Telecommunications System (UMTS); Signalling flows for the IP
multimedia call control based on Session Initiation Protocol (SIP) and Session
Description Protocol (SDP); Stage 3\ (3GPP TS 24.228 Release 5)\".
[13] ETSI TS 123 003: \"Digital cellular telecommunications system (Phase 2+);
Universal Mobile Telecommunications System (UMTS); Numbering, addressing and
identification\ (3GPP TS 23.003 Release 6)\".
[14] ETSI TS 183 006 V1.2.1: \"Telecommunications and Internet converged
Services and Protocols for Advanced Networking (TISPAN); PSTN/ISDN simulation
services; Message Waiting Indication (MWI): Protocol specification\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TS 181 002 [1], TS 181 005 [10],\ TS 123 003 [13] and the following apply:
**correspondent:** person or entity that deposits messages in the
subscriber\'s message account
NOTE: Correspondent and subscriber can be the same person or entity.
**Message Account (MA):** resource that retains multimedia messages (voice,
video, fax, etc.) deposited by correspondents for the subscriber
**subscriber:** person or entity that receives status information about
deposited messages
**supplementary service:** modifies or supplements a basic Telecommunication
service
**trusted identity:** network generated user address information
**untrusted identity:** user generated user address information
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
AS Application Server
CD Communication Deflection
CDIV **Communication DIVersion**
CFB Communication Forwarding Busy
CFNL Communication Forwarding on Not Logged-in
CFNR Communication Forwarding No Reply
CFU Communication Forwarding Unconditional
CONF **CONFerence calling**
CSCF Call Session Control Function
ECT Explicit Communication Transfer
HOLD Communication Hold
IBCF **Interconnection Border Control Function**
I-CSCF Interrogating - CSCF
IMS IP Multimedia Subsystem
IP Internet Protocol
ISDN Integrated Service Data Network
MA Message Account
MCID Malicious Call IDentification
MIME Multipurpose Internet Mail Extensions
MNUA **MWI Notifier User Agent**
MSUA **MWI Subscriber User Agent**
MWI Message Waiting Indication
NGN Next Generation Network
OIP Originating Identification Presentation
OIR Originating Identification Restriction
P-CSCF Proxy - CSCF
PSI Public Service Identity
PSTN Public Switch Telephone Network
S-CSCF Serving - CSCF
SDP Session Description Protocol
SIP Session Initiation Protocol
THIG **Topology HIding Gateway**
TIP Terminating Identification Presentation
TIR Terminating Identification Restriction
UA **User Agent**
UE User Equipment
URI Universal Resource Identifier
# 4 Message Waiting Indication (MWI)
## 4.1 Introduction
The **Message Waiting Indication (MWI)** service enables the network, upon the
request of a controlling user to indicate to the receiving user, that there is
at least one message waiting.
## 4.2 Description
### 4.2.1 General description
The MWI service enables the application server to indicate to the subscriber,
that there is at least one message waiting.
The indication is delivered to the subscriber\'s UE after successful
subscription to the Message Waiting Indication service as described in the
present document.
Other modes of MWI service invocation are not applicable.
NOTE: Having received this indication, the subscriber user can subsequently
access the message account, to have the deposited message delivered. The means
by which the subscriber accesses and manages the message account are outside
the scope of the present document.
## 4.3 Functional entities
### 4.3.1 User Equipment (UE)
The UE shall implement the MWI Subscriber User Agent role as described in
clause 4.4.1.
### 4.3.2 Application Server (AS)
An application server shall implement the role of a MWI Notifier User Agent as
described in clause 4.4.2.
Application Server can implement the role of the application server (AS)
acting as terminating UA as described in ES 283 003 [2], clause 5.7.2.
Additionally an application server may implement other roles for the receipt
and storage of the messages for example Web Server, Mail Transfer and Delivery
Agent, Short Message Service centre, etc.
The definition of additional roles for an MWI Application Server is out of the
scope for the current specification.
## 4.4 Roles
### 4.4.1 MWI Subscriber User Agent (MSUA)
A MWI Subscriber User Agent is an entity that is subscribed or requests
information about status change of message account from an MWI AS.
Actions performed by a MWI Subscriber User Agent as a part of the user
equipment are described in clause 4.7.2.1.
### 4.4.2 MWI Notifier User Agent (MNUA)
MNUA is an entity that provides information about changes in message account
status to the MSUA.
Actions performed by a notifier user agent as a part of the application server
are described in clause 4.7.2.5.
### 4.4.3 Message Account (MA)
The definition of the message account from the RFC 3842 [3] applies with
following additions:
Message account retains multimedia messages (e.g. voice, video, fax) intended
to a particular subscriber.
#### 4.4.3.1 Identification of the message account for the message deposit
Since messages may be intended to the different public user identities that
belong to the same subscriber, the message account may be configured to retain
messages for any of the subscriber\'s public user identities.
Configuration of a message account to retain messages for each public user
identity, for a group of public user identities or for all of public user
identities that belong to the same subscriber is subject to the operator\'s
policy.
#### 4.4.3.2 Identification of the message account for the MWI subscription
For the identification of the message account by subscriptions to the MWI
service either a public service identity can be assigned to the message
account or any of subscriber\'s public user identity can be used, subject to
the operator\'s policy (see examples in clause A.1.1.2).
## 4.5 Operational requirements
### 4.5.1 Provision/withdrawal
The MWI service shall be provided after prior arrangement with the service
provider. The MWI service shall be withdrawn at the subscriber\'s request or
for administrative reasons.
Depending on the arrangement with the service provider either any of the
subscriber\'s public user identities or public service identity of the message
account can be used to access the MWI service, see annex B.
The subscriber\'s UE shall be made aware about the option used by service
provider to identify access to the MWI service.
### 4.5.2 Requirements on the originating network side
No specific requirements are needed on the originating network side.
### 4.5.3 Requirements in the network
No specific requirements are needed in the network.
### 4.5.4 Requirements on the terminating network side
No specific requirements are needed in the network.
## 4.6 Coding requirements
The application/simple-message-summary MIME type used to provide Message
Summary and Message Waiting Indication Information shall be coded as described
in clause 5 of RFC 3842 [3].
The coding of the message types in the message-context-class values shall
follow the rules defined in the specifications listed in the \"reference\"
column of table 1.
Table 1: Coding requirements
* * *
Value Reference voice-message RFC 3458 [5] video-message RFC 3938 [6] fax-
message RFC 3458 [5] pager-message RFC 3458 [5] multimedia-message RFC 3458
[5] text-message RFC 3458 [5] none RFC 3458 [5]
* * *
The coding of the additional information about deposited messages in the
application/simple-message-summary MIME type body shall be in alignment with
the rules defined in clause 25 of RFC 3261 [11] for SIP extension-header
(clause 3.5 of RFC 3842 [3]) and follow the rules defined in the
specifications listed in the \"reference\" column of table 2.
Table 2: Additional information
* * *
Header Description Reference To: Indicates the subscriber\'s public user
identity used by correspondent to deposit a message. clause 3.6.3 of RFC 2822
[7] From: Indicates the correspondent\'s public user identity, if available.
clause 3.6.2 of RFC 2822 [7] Subject: Indicates the topic of the deposited
message as provided by correspondent. clause 3.6.5 of RFC 2822 [7] Date:
Indicates the time and date information about message deposit. clause 3.6.1 of
RFC 2822 [7] Priority: Indicates the message priority as provided by
correspondent. RFC 2156 [8] Message-ID: Indicates a single unique message
identity. clause 3.6.4 of RFC 2822 [7] Message-Context: Indicates a type or
context of message. RFC 3458 [5]
* * *
## 4.7 Signalling requirements
### 4.7.1 Activation/deactivation
The MWI service is immediately activated after successful SUBSCRIBE request
from the subscriber\'s UE, see clause 4.7.2.
The MWI service is deactivated after subscription expiry or after unsuccessful
attempt to deliver a notification about message waiting.
### 4.7.1A Registration/erasure
The MWI service requires no registration. Erasure is not applicable.
### 4.7.1B Interrogation
Interrogation of MWI is not applicable.
### 4.7.2 Invocation and operation
#### 4.7.2.1 Actions at the UE
When the subscriber user agent intends to subscribe for status information
changes of a message account, it shall generate a SUBSCRIBE request in
accordance with RFC 3265 [4] and RFC 3842 [3] and in alignment with the
procedures described in ES 283 003 [2].
Depending on the service provisioning the UE will address the SUBSCRIBE
request either to one of the subscriber\'s public user identities or to the
public service identity of the message account (see clause 4.5.1).
The subscriber\'s UE shall implement the \"application/simple-message-
summary\" content type as described in RFC 3842 [3].
#### 4.7.2.2 Actions at the P-CSCF
Procedures according to ES 283 003 [2] shall apply.
#### 4.7.2.3 Actions at the serving S-CSCF
Procedures according to ES 283 003 [2] shall apply.
NOTE: Annex B includes an example of an IFC that can be used to invoke the MWI
simulation service.
#### 4.7.2.4 Actions at the terminating S-CSCF
This clause applies if the MWI service is addressed using public service
identity, see clause 4.4.3.2.
Procedures according to ES 283 003 [2] shall apply.
#### 4.7.2.5 Actions at the AS
When the Application Server receives a SUBSCRIBE request for the \"message-
summary\" event package, the Application Server shall identify the message
account which status information is requested (see clause 4.4.3.2), then the
AS shall attempt to verify the identity of the source of the SUBSCRIBE request
as described in ES 283 003 [2] clause 5.7.1.4, then perform authorization
according to ES 283 003 [2] clause 5.7.1.5.
In case of successful subscription, the AS shall generate a response to the
SUBSCRIBE request and notifications in accordance with RFC 3265 [4] and RFC
3842 [3].
#### 4.7.2.6 Actions at the outgoing I-CSCF (THIG)
Procedures according to ES 283 003 [2] apply.
#### 4.7.2.7 Actions at the incoming I-CSCF
Procedures according to ES 283 003 [2] apply.
#### 4.7.2.8 Actions at the outgoing IBCF
Procedures according to ES 283 003 [2] apply.
#### 4.7.2.9 Actions at the incoming IBCF
Procedures according to ES 283 003 [2] apply.
## 4.8 Interaction with other IMS capabilities
### 4.8.1 Presence
Interaction of the presence IMS capability and message waiting indication
service is for further study.
### 4.8.2 Messaging
Interaction of messaging IMS capability and message waiting indication service
is for further study.
## 4.9 Interaction with other services
### 4.9.1 Communication Hold (HOLD)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.9.2 Terminating Identification Presentation (TIP)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.9.3 Terminating Identification Restriction (TIR)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.9.4 Originating Identification Presentation (OIP)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.9.5 Originating Identification Restriction (OIR)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.9.6 CONFerence calling (CONF)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.9.7 Communication DIVersion services (CDIV)
The subscriber of the message waiting indication service receives the
notifications about the change in the status of message account only from
message waiting indication application server.
Communication diversion services shall not impact the processing of message
waiting indication subscriptions, notifications and responses.
#### 4.9.7.1 Communication Forwarding Unconditional (CFU)
MWI notifications shall not be affected by the communication forwarding
unconditional service and always be forwarded to subscribers\' current
location (if known).
#### 4.9.7.2 Communication Forwarding Busy (CFB)
MWI notifications shall not be affected by the communication forwarding busy
service and always be forwarded to subscribers\' current location (if known).
The UE will inform the AS if it will not be able to process the notification
at the time.
#### 4.9.7.3 Communication Forwarding No Reply (CFNR)
MWI notifications shall not be affected by the communication forwarding busy
service and always be forwarded to subscribers\' current location (if known).
The S-CSCF will inform the AS if the UE can not be contacted at the time.
#### 4.9.7.4 Communication Forwarding on Not Logged-in (CFNL)
MWI notifications shall not be affected by the communication forwarding busy
service and always be forwarded to subscribers\' current location (if known).
The S-CSCF will inform the AS if the UE is not logged-in at the time.
#### 4.9.7.5 Communication Deflection (CD)
MWI notifications shall not be affected by the communication deflection
service. All the CSCFs and AS shall ignore the redirection information
received from the UE and proceed a 3xx response as a 480 Temporarily
Unavailable response.
### 4.9.8 Malicious Call IDentification (MCID)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.9.9 Explicit Communication Transfer (ECT)
No impact, i.e. neither service shall affect the operation of the other
service.
## 4.10 Interactions with other networks
Interaction with other networks is performed according to ES 283 003 [2].
### 4.10.1 Interworking with the PSTN/ISDN
Interworking of the SIP based MWI service with ISDN MWI service is for further
study.
### 4.10.2 Interaction with PSTN/ISDN Emulation
Interworking of the SIP based MWI service with the emulation MWI service is
for further study.
### 4.10.3 Interaction with external IP networks
Interaction with external IP networks are performed according to ES 283 003
[2].
## 4.11 Parameter values (timers)
Not applicable.
###### ## Annex A (informative): Example signalling flows of Message Waiting
Indication (MWI) service operation
# A.1 Scope of signalling flows
This annex gives examples of signalling flows for the Message Waiting
Indication service within the TISPAN PSTN/ISDN Simulation subsystem based on
the Session Initiation Protocol (SIP).
## A.1.1 Introduction
### A.1.1.1 General
The signalling flows provided in the following clauses follow the methodology
developed in TS 124 228 [12]. The following additional considerations apply.
### A.1.1.2 Key required to interpret signalling flows
The key to interpret signalling flows specified in TS 124 228 [12] clauses 4.1
and 4.2 applies with the additions specified below:
  * mwi.home1.net: an MWI AS in the home network of the service provider;
  * user1_mwiacc1\@home1.net: public service identity of the message account;
  * user1_public1\@home1.net: first subscriber\'s public user identity assigned to the message account;
  * user1_public2\@home1.net: second subscriber\'s public user identity assigned to the message account;
  * user2_public1\@home2.net: first correspondent of messages in the message account;
  * user3_public1\@home3.net: second correspondent of messages in the message account.
Each signalling flow table contains descriptions for headers where the content
of the header is new to that signalling flow, as is already performed in TS
124 228 [12].
However, TS 124 228 [12] includes extensive descriptions for the contents of
various headers following each of the tables representing the contents of the
signalling flows. Where the operation of the header is identical to that shown
in TS 124 228 [12], then such text is not reproduced in the present document.
Headers following the tables that are represented in **_fat cursive_** style
describe the contents of the application/simple-message-summary MIME body.
Additional text may also be found on the contents of headers within TS 124 228
[12] in addition to the material shown in the present document.
## A.1.2 Signalling flows demonstrating how UE subscribes to message waiting
indication event notification
### A.1.2.1 Introduction
The clause covers the signalling flows that show how UE can request message
waiting indication information from an application server.
### A.1.2.2 MWI Subscriber subscribing to the status of his message account,
MWI AS is in the subscriber\'s network
Successful subscription, UE in visited network. This example shows the case
when the originating S-CSCF, routes the SUBSCRIE request to an AS that
provides the MWI service, based on the resolution of the public service
identity of the message account.
For the purpose of the subscriber\'s identity verification, the AS is located
within the same trusted domain as the subscriber, see ES 283 003 [2] clause
5.7.1.4.
Figure A.1: UE subscription for the message-summary event package
Figure A.1 shows a user equipment subscribing to the message waiting
indication notification. The details of the signalling flows are as follows:
1\. **SUBSCRIBE request (UE to P-CSCF) - see example in table A.1**
A subscriber agent in a UE wishes to receive message waiting indication
information from an application server. To initiate a subscription, the UE
generates a SUBSCRIBE request containing the \"messageâ€‘summary\" event that it
wishes to be notified of, together with an indication of the length of time
this periodic subscription should last.
Table A.1: SUBSCRIBE request (UE to P-CSCF)
SUBSCRIBE sip:user1_mwiacc1\@home1.net SIP/2.0
Via: SIP/2.0/UDP 1.2.3.4:1357;branch=z9hG4bKnashds7
Max-Forwards: 70
Route: \, \
P-Preferred-Identity: \
Privacy: none
From: \;tag=31415
To: \
Call-ID: b89rjhnedlrfjflslj40a222
CSeq: 61 SUBSCRIBE
Event: message-summary
Expires: 7200
Accept: application/simple-message-summary
Contact: \
Content-Length: 0
**Request URI:** Public service identity of the message account whose events
the subscriber subscribes to. In this case the subscriber subscribes to the
message waiting indication events.
**Event:** This field is populated with the value \"message-summary\" to
specify the use of the Message Summary Package.
**Accept:** This field is populated with the value \"application/simple-
message-summary\" as described in RFC 3842 [3].
**To:** Same as the Request-Uri.
2\. **SUBSCRIBE request (P-CSCF to S-CSCF) - see example in table A.2**
The SUBSCRIBE request is forwarded to the I-CSCF.
The P-CSCF looks up the serving network information for the public user
identity that was stored during the registration procedure. The SUBSCRIBE
request is forwarded to S-CSCF#1. A Route header is inserted into SUBSCRIBE
request. The information for the Route header is taken from the service route
determined during registration.
Table A.2: SUBSCRIBE request (P-CSCF to S-CSCF)
> SUBSCRIBE sip:user1_mwiacc1\@home1.net SIP/2.0
>
> Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK120f34.1, SIP/2.0/UDP
> 1.2.3.4:1357;comp=sigcomp;branch=z9hG4bKehuefdam
>
> P-Access-Network-Info:
>
> Route: \
>
> Max-Forwards: 69
>
> P-Asserted-Identity: \
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=223551024\"
>
> Privacy:
>
> Record-Route: \
>
> Route: \
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Event:
>
> Supported:
>
> Expires:
>
> Accept:
>
> Contact:
>
> Content-Length:
3\. **Evaluation of initial filter criteria**
The S-CSCF validates the service profile of this subscriber and evaluates the
initial filter criteria. Assuming that sip:user1_mwiacc1\@home1.net is a
statically created PSI, sip:user1_mwiacc1\@home1.net is included in the
service profile of user1_public1\@home1.net as part of an originating initial
Filter Criteria with Service Trigger Point of Method = SUBSCRIBE AND Event =
\"message-summary\" AND Request-URI = sip:user1_mwiacc1\@home1.net, that
informs the S-CSCF to route the SUBSCRIBE request to the application server
sip:mwi.home1.net.
If there is no initial filter criteria for this PSI
(sip:user1_mwiacc1\@home1.net), the assumption is that the PSI is a sub
domain-based PSI. The procedure defined in RFC 3263 [9] with DNS NAPTR and SRV
queries aligned with the operator policy may then be used for the resolution
of the PSI.
4\. **SUBSCRIBE (S-CSCF to AS) - see example in table A.3**
The S-CSCF forwards the SUBSCRIBE request to AS.
Table A.3: SUBSCRIBE request (S-CSCF to AS)
> SUBSCRIBE sip:user1_mwiacc1\@home1.net SIP/2.0
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK344a65.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK120f34.1, SIP/2.0/UDP
> 1.2.3.4:1357;branch=z9hG4bKehuefdam
>
> Max-Forwards: 68
>
> P-Asserted-Identity: \, \
>
> P-Charging-Vector:
>
> P-Charging-Function-Addresses:
>
> Privacy:
>
> Record-Route: \,
> \
>
> Route: \, \
>
> From:
>
> To:
>
> Call-ID:
>
> CSeq:
>
> Event:
>
> Supported:
>
> Expires:
>
> Accept:
>
> Contact:
>
> Content-Length:
5\. **Identification of the message account and subscriber authorization**
Based on the Request-URI the MWI AS identifies the requested message account.
P-Asserted-Identity header information authorizes the subscriber to subscribe
to status change of the message account, as one of the identities is
authorized for this account.
In this example the authorization is successful, so the AS sends a 200 (OK)
response to the S-CSCF. If the previous condition failed, then a 403
(Forbidden) response would be sent to the S-CSCF.
> 6\. **200 (OK) response (MWI AS to S-CSCF) -- see example in table A.4**
The MWI AS forwards the response to the S-CSCF.
Table A.4: 200 (OK) response (AS to S-CSCF)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK344a65.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK120f34.1, SIP/2.0/UDP
> 1.2.3.4:1357;branch=z9hG4bKehuefdam
>
> P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=223551024\";
> orig-ioi=home1.net; term-ioi=home1.net
>
> Record-Route:
>
> From: \;tag=31415
>
> To: \;tag=151170
>
> Call-ID: b89rjhnedlrfjflslj40a222
>
> CSeq:
>
> Expires:
>
> Contact: \
>
> Content-Length: 0
>
> 7\. **200 (OK) response (S-CSCF to P-CSCF )**
The S-CSCF forwards the 200 OK response to the P-CSCF.
8\. **200 (OK) response (P-CSCF to UE)**
P-CSCF forwards the 200 OK response to the UE.
9\. **NOTIFY request (MWI AS to S-CSCF) - see example in table A.5**
As required by the RFC 3265 [4] the MWI AS immediately after successful
subscription sends the NOTIFY request to the S-CSCF to synchronize the current
state of the message account at the subscriber\'s UE. This initial
notification contains no extended information about available message. Further
notifications sent by MWI AS may contain either extended or basic set of
message waiting information as described in\ RFC 3842 [3].
In this example it is assumed that the message account at the moment of
subscription has thee voice messages (two new and one old, with one new
message being urgent), one old video message and two fax messages (one new and
one old with the old message being urgent).
Table A.5: Initial NOTIFY request (MWI AS to S-CSCF)
NOTIFY sip:user1_public1\@1.2.3.4:1357 SIP/2.0
Via: SIP/2.0/UDP mwi.home1.net;branch=z9hG4bK332b23.1
Max-Forwards: 70
Route: \, \
From: \;tag=31415
To: \;tag=151170
Call-ID: b89rjhnedlrfjflslj40a222
CSeq: 42 NOTIFY
Subscription-State: active;expires=7200
Event: message-summary
Contact: \
Content-Type: application/simple-message-summary
Content-Length: (...)
Messages-Waiting: yes
Message-Account: sip:user1_mwiacc1\@home1.net
Voice-Message: 2/1 (0/0)
Video-Message: 0/1 (0/0)
Fax-Message: 1/1 (0/1)
> **Content-Type:** Set to \"application/simple-message-summary\" as described
> in RFC 3842 [3].
>
> The message body in the NOTIFY request that carries the message waiting
> indication is formed as described in clause 4.6.
>
> **_Message-Account_ :** The MWI AS populates this filed with the public
> service identifier of the message account that received the subscription.
>
> **_Voice-Message_ :** The MWI AS populates this filed with the information
> about voice messages that are waiting in the message account.
>
> **_Video-Message_ :** The MWI AS populates this filed with the information
> about video messages that are waiting in the message account.
>
> **_Fax-Message_ :** The MWI AS populates this filed with the information
> about fax messages that are waiting in the message account.
12\. **200 (OK) response (UE to P-CSCF)**
The UE acknowledges the NOTIFY request with a 200 (OK) response to the P-CSCF.
15\. **notifications on message-summary event package**
After the MWI AS generated a NOTIFY request to inform the subscriber\'s UE
about the subscription state, the MWI AS waits for the change of the message
account status. As soon as new messages(s) are deposited into the message
account the MWI AS generates a NOTIFY request to indicate the change in the
message account status to the subscriber\'s UE.
16\. **NOTIFY request (AS to S-CSCF) -- see example in table A.6**
The MWI AS uses available information from the interaction with correspondents
and message left in the message account to fill the headers in the simple-
message-summary MIME body of the NOTIFY request. This notification sent by the
MWI AS contains an extended set of message waiting information about newly
deposited messages since the last notification as described in RFC 3842 [3].
In this example it is assumed that the subscriber\'s message account has
received three new messages (two urgent voice and one non urgent video
message) since the successful immediate NOTIFY transaction from the
correspondents sip:user2_public1\@home1.net and sip:user3_public1\@home3.net.
The correspondents used different public user identities of the subscriber to
deposit messages.
Table A.6: NOTIFY request (MWI AS to S-CSCF)
NOTIFY sip:user1_public1\@1.2.3.4:1357 SIP/2.0
Via: SIP/2.0/UDP mwi.home1.net;branch=z9hG4bK332b23.1
Max-Forwards: 70
Route: \, \
From: \;tag=31415
To: \;tag=151170
Call-ID: b89rjhnedlrfjflslj40a222
CSeq: 43 NOTIFY
Subscription-State: active;expires=5000
Event: message-summary
Contact: \
Content-Type: application/simple-message-summary
Content-Length: (...)
Messages-Waiting: yes
Message-Account: sip:user1_mwiacc1\@home1.net
Voice-Message: 4/1 (2/0)
Video-Message: 1/1 (0/0)
Fax-Message: 1/1 (0/1)
To: \
From: \
Subject: call me back!
Date: 19 Apr 2005 21:45:31 -0700
Priority: urgent
Message-ID: 27775334485\@mwi.home1.net
Message-Context: voice-message
To: \
From: \
Subject: Where are you that late???
Date: 19 Apr 2005 23:45:31 -0700
Priority: urgent
Message-ID: 27775334485\@mwi.home1.net
Message-Context: voice-message
To: \
From: \
Subject: Did you see that penalty!!!
Date: Tue, 19 Apr 2005 22:12:31 -0700
Priority: normal
Message-ID: 26775334485\@mwi.home1.net
Message-Context: video-message
> **Content-Type:** Set to \"application/simple-message-summary\" as described
> in RFC 3842 [3].
>
> The message body in the NOTIFY request that carries the message waiting
> indication is formed as described in the clause 4.6.
>
> **_Message-Account_ :** The MWI AS populates this filed with the public
> service identifier of the message account that has new messages for the
> subscriber.
>
> **_Voice-Message_ :** Since two new urgent voice messages were received by
> the message account, the number of new voice messages is increased to four
> and the number of the new urgent messages is increased to two.
>
> **_Video-Message_ :** One new video message was received by the message
> account and accordingly the number of new video messages set to one.
>
> **_Fax-Message_ :** No new fax messages were received by the message
> account, so the number of fax messages is unchanged.
>
> **_To:_** This header in the MIME body populates the information about the
> public user identity of subscriber, that was used by correspondent to
> deposit a message.
>
> **_From:_** This header in the MIME body populates the information about the
> public user identity, of correspondent, that left a message to the
> subscriber.
>
> **_Subject:_** This header populates the information about the subject, that
> was assigned to the left message by correspondent.
>
> **_Date:_** This header populates the information about the date and time
> when a message was left.
>
> **_Priority:_** This header populates the information about the message
> urgency assigned by correspondent.
>
> **_Message-ID:_** This header populates the information about the message
> identity, that is assigned to the message by the MWI AS.
>
> **_Message-Context:_** This header populates the information about the type
> of the deposited message, that has the extended set of message waiting
> information.
### A.1.2.3 MWI AS notifying the subscriber about changes in the status of
message account
This example shows the case when the message waiting indication service was
invoked by the subscription to one of the subscriber\'s public user
identities.
MWI AS notifies subscriber\'s UE about new message being deposited into the
subscribers message account.
Figure A.2: Notification of change in the status of message account
Table A.7: NOTIFY request (MWI AS to S-CSCF)
NOTIFY sip:user1_public1\@1.2.3.4:1357 SIP/2.0
Via: SIP/2.0/UDP mwi.home1.net;branch=z9hG4bK332b43.1
Max-Forwards: 70
Route: \, \
From: \;tag=53254
To: \;tag=34533
Call-ID: sdf243dsaf323fdswf23r
CSeq: 32 NOTIFY
Subscription-State: active;expires=3000
Event: message-summary
Contact: \
Content-Type: application/simple-message-summary
Content-Length: (...)
## A.1.3 Void
## A.1.4 Signalling flows demonstrating how a message is deposited into the
subscribers message account
### A.1.4.1 Introduction
The clause covers the signalling flows that show how a message is deposited
into the subscribers message account.
### A.1.4.2 Depositing a message into the subscriber\'s message account
#### A.1.4.2.1 Successful message deposit into the subscriber\'s message
account
This call-flow shows the deposit of the message in to the subscriber\'s
message account by a correspondent.
\"Integration of resource management and SIP\" not required by the MWI AS and
not used by correspondent\'s UE.
Figure A.5: Correspondent depositing a message into the subscriber\'s MA
Figure A.5 shows a correspondent user equipment creating, interacting over RTP
and terminating a session with the MWI AS. The details of the signalling flows
are as follows:
1\. **INVITE request (Correspondent to P-CSCF) -- see example in table A.15**
A correspondent wishes to initiate a session with the MWI subscriber. To
initiate the session, the correspondent generates an INVITE request to MWI
subscriber.
Table A.15: INVITE request (UE to P-CSCF)
INVITE sip:user1_public1\@home1.net SIP/2.0
Via: SIP/2.0/UDP 2.3.4.5:2468;branch=0uetb
Max-Forwards: 70
Route: \, \
P-Preferred-Identity: \
Privacy: none
From: \;tag=31417
To: \
Call-ID: apb03a0s09dkjdfglk49111
CSeq: 22 INVITE
Contact: \
Content-Type: application/sdp
Content-Length: (...)
v=0
o=user3 2890844526 2890844526 IN IP4 2.3.4.5
s=-
c=IN IP4 2.3.4.5
t=0 0
m=audio 49172 RTF/AVP 0
a=rtpmap:0 PCMU/8000
> **Request URI:** Public user identity of the MWI subscriber.
>
> **From:** Public user identity of the Correspondent.
>
> **To:** Same as the Request-Uri.
>
> **Content-Type:** Set to \"application/sdp\".
The message body includes the SDP information.
2\. **INVITE request (P-CSCF to S-CSCF) -- see example in table A.16**
The INVITE request is forwarded to the S-CSCF in MWI subscriber\'s home
network.
Table A.16: INVITE request (S-CSCF to S-CSCF)
> INVITE sip:user1_public1\@home1.net SIP/2.0
>
> Via: SIP/2.0/UDP scscf1.home3.net;branch=z9bhksl3dlc23xm
>
> Via: SIP/2.0/UDP pcscf1.visited2.net;branch=z9hG4bK120f34.1
>
> Via: SIP/2.0/UDP 2.3.4.5:2468;comp=sigcomp;branch=z9hG4bKehuefdam
>
> Record-Route: \
>
> Record-Route: \
>
> Max-Forwards: 68
>
> Privacy: none
>
> From: \;tag=31417
>
> To: \
>
> Call-ID: apb03a0s09dkjdfglk49111
>
> CSeq: 22 INVITE
>
> Contact: \
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=user3 2890844526 2890844526 IN IP4 2.3.4.5
>
> s=-
>
> c=IN IP4 2.3.4.5
>
> t=0 0
>
> m=audio 49172 RTF/AVP 0
>
> a=rtpmap:0 PCMU/8000
3\. **Evaluation of initial filter criteria**
The S-CSCF validates the service profile of this subscriber and evaluates the
initial filter criteria. Assuming that MWI service is included in the service
profile of user1_public1\@home1.net as part of an terminating initial Filter
Criteria with Service Trigger Point of Method = INVITE AND Request-URI =
sip:user1_public1\@home1.net AND subscriber state = logout, that informs the
S-CSCF to route the INVITE request to the application server sip:mwi.home1.net
when the state of user1_public1@home1.net is logout.
4\. **INVITE (S-CSCF to AS) -- see example in table A.17**
The S-CSCF forwards the INVITE request to AS.
Table A.17: INVITE request (S-CSCF to AS)
> INVITE sip:user1_public1\@home1.net SIP/2.0
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9ack2k2bjbm0fu
>
> Via: SIP/2.0/UDP scscf1.home3.net;branch=z9bhksl3dlc23xm
>
> Via: SIP/2.0/UDP pcscf1.visited2.net;branch=z9hG4bK120f34.1
>
> Via: SIP/2.0/UDP 2.3.4.5:2468;comp=sigcomp;branch=z9hG4bKehuefdam
>
> Record-Route: \
>
> Record-Route: \
>
> Record-Route: \
>
> Max-Forwards: 67
>
> Privacy: none
>
> From: \;tag=31417
>
> To: \
>
> Call-ID: apb03a0s09dkjdfglk49111
>
> CSeq: 22 INVITE
>
> Contact: \
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=user3 2890844526 2890844526 IN IP4 2.3.4.5
>
> s=-
>
> c=IN IP4 2.3.4.5
>
> t=0 0
>
> m=audio 49172 RTF/AVP 0
>
> a=rtpmap:0 PCMU/8000
>
> 5\. **Identification of the message account and subscriber authorization**
Based on the Request-URI the MWI AS identifies the requested message account.
In the requested message account is valid, AS sends a 200 (OK) response to the
S-CSCF.
> 6\. **200 (OK) response (MWI AS to S-CSCF) -- see example in table A.18**
The MWI AS forwards the response to the S-CSCF.
Table A.18: 200(OK) response (AS to S-CSCF)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf1.home1.net;branch=z9ack2k2bjbm0fu
>
> Via: SIP/2.0/UDP scscf1.home3.net;branch=z9bhksl3dlc23xm
>
> Via: SIP/2.0/UDP pcscf1.visited2.net;branch=z9hG4bK120f34.1
>
> Via: SIP/2.0/UDP 2.3.4.5:2468;comp=sigcomp;branch=z9hG4bKehuefdam
>
> Record-Route: \
>
> Record-Route: \
>
> Record-Route: \
>
> From: \;tag=31417
>
> To: \
>
> Call-ID: apb03a0s09dkjdfglk49111
>
> CSeq: 22 INVITE
>
> Contact: \
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=user3 2890844527 2890844527 IN IP4 12.13.14.15
>
> s=-
>
> c=IN IP4 12.13.14.15
>
> t=0 0
>
> m=audio 3456 RTF/AVP 0
>
> a=rtpmap:0 PCMU/8000
The Content-Type is set to \"application/sdp\" and the SDP information in AS
in included in the message body.
9\. **ACK (Correspondent to P-CSCF) -- see example in table A.19**
The correspondent sends an ACK to P-CSCF.
Table A.19: ACK (UE to P-CSCF)
ACK sip:user1_public1\@home1.net SIP/2.0
Via: SIP/2.0/UDP 2.3.4.5:2468;branch=0uetb
Max-Forwards: 70
Route: \, \
From: \;tag=31417
To: \
Call-ID: apb03a0s09dkjdfglk49111
CSeq: 22 ACK
Content-Length: 0
> 12\. **The Correspondent deposits a message to the message account**
The correspondent interacts with MWI AS and deposits a message via RTP into
the subscriber\'s message account.
13\. **BYE request (Correspondent to P-CSCF) - see example in table A.20**
After deposits a message to the subscriber\'s message account successfully,
the correspondent sends a BYE to release the session.
Table A.20: BYE request (UE to P-CSCF)
BYE sip:user1_public1\@home1.net SIP/2.0
Via: SIP/2.0/UDP 2.3.4.5:2468;branch=0uetb
Max-Forwards: 70
Route: \, \
From: \;tag=31417
To: \
Call-ID: apb03a0s09dkjdfglk49111
CSeq: 22 BYE
Content-Length: 0
> 16\. **200 (OK) response (MWI AS to S-CSCF) - see example in table A.21**
The MWI AS forwards the response to the S-CSCF.
Table A.21: 200 OK response (AS to S-CSCF)
SIP/2.0 200 OK
Via: SIP/2.0/UDP 2.3.4.5:2468;branch=0uetb
Max-Forwards: 70
Route: \, \
From: \;tag=31417
To: \
Call-ID: apb03a0s09dkjdfglk49111
CSeq: 22 BYE
Content-Length: 0
> 19\. **Status of subscriber\'s MA gets modified**
The MWI AS updates the status of the subscriber\'s message account.
If the MWI service is already invoked by the subscriber, MWI notifies the
subscriber about new message being deposited into the subscriber\'s message
account as described in clause A.1.2.3.
###### ## Annex B (informative): Example of a filter criteria
The following text is to be used when appropriate.
This annex provides an example of a filter criterion that triggers SIP
requests that are subject to initial filter criteria evaluation.
Following example shows the Service Point Triggers in an Initial Filter
Criteria of the service profile for the subscriber with the public user
identity user1_public1@home1.net. This Initial Filter Criteria informs the
S-CSCF to route the SUBSCRIBE request to the application server
sip:mwi.home1.net that provides MWI service addressed with the public service
identity sip:user1_mwiacc1\@home1.net.
Method: SUBSCRIBE
Event: message-summary
Request-URI: sip:user1_mwiacc1\@home1.net
Application Server: sip:mwi.home1.net
Another example shows the Service Point Triggers in an Initial Filter Criteria
of the service profile for the subscriber with the public user identity
user1_public1@home1.net. This Initial Filter Criteria informs the S-CSCF to
route the SUBSCRIBE request to the application server sip:mwi.home1.net that
provides MWI service addressed with the public user identity
sip:user1_user1_public1\@home1.net.
Method: SUBSCRIBE
Event: message-summary
Request-URI: sip:user1_public1\@home1.net
Application Server: sip:mwi.home1.net
###### ## Annex C (informative): Bibliography
IETF RFC 3428: \"Session Initiation Protocol (SIP) Extension for Instant
Messaging\".
#
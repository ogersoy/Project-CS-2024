# Foreword
This Technical Specification (TS) was been produced by ETSI Technical
Committee Telecommunications and Internet converged Services and Protocols for
Advanced Networking (TISPAN) and originally published as ETSI TS 183 004 [19].
It was transferred to the 3rd Generation Partnership Project (3GPP) in in
January 2008.
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the, stage three, Protocol Description of the
Communications Diversion (CDIV) services, based on stage one and two of the
ISDN Communication diversion supplementary services. Within the Next
Generation Network (NGN) the stage 3 description is specified using the IP
Multimedia Communication Control Protocol based on Session Initiation Protocol
(SIP) and Session Description Protocol (SDP).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
Referenced documents which are not found to be publicly available in the
expected location might be found at
[http://docbox.etsi.org/Reference]{.underline}.
For online referenced documents, information sufficient to identify and locate
the source shall be provided. Preferably, the primary source of the referenced
document should be cited, in order to ensure traceability. Furthermore, the
reference should, as far as possible, remain valid for the expected life of
the document. The reference shall include the method of access to the
referenced document and the full network address, with the same punctuation
and use of upper case and lower case letters.
NOTE: While any hyperlinks included in this clause were valid at the time of
publication ETSI cannot guarantee their long term validity.
## 2.1 Normative references
The following referenced documents are indispensable for the application of
the present document. For dated references, only the edition cited applies.
For non-specific references, the latest edition of the referenced document
(including any amendments) applies.
[1] ETSI TS 181 002: \"Telecommunications and Internet converged Services and
Protocols for Advanced Networking (TISPAN); Multimedia Telephony with
PSTN/ISDN simulation services\".
[2] ETSI ES 283 003: \"Telecommunications and Internet converged Services and
Protocols for Advanced Networking (TISPAN); IP Multimedia Call Control
Protocol based on Session Initiation Protocol (SIP) and Session Description
Protocol (SDP) Stage 3\".
[3] IETF RFC 4244: \"An Extension to the Session Initiation Protocol (SIP) for
Request History Information\".
[4] ETSI TS 183 023: \"Telecommunications and Internet converged Services and
Protocols for Advanced Networking (TISPAN); PSTN/ISDN simulation services;
Extensible Markup Language (XML) Configuration Access Protocol (XCAP) over the
Ut interface for Manipulating NGN PSTN/ISDN Simulation Services\".
[5] IETF RFC 2327: \"SDP: Session Description Protocol\".
[6] IETF RFC 3261: \"SIP: Session Initiation Protocol\".
[7] IETF RFC 3966: \"The tel URI for Telephone Numbers\".
[8] IETF RFC 3325: \"Private Extensions to the Session Initiation Protocol
(SIP) for Asserted Identity within Trusted Networks\".
[9] ETSI TS 183 011: \"Telecommunications and Internet converged Services and
Protocols for Advanced Networking (TISPAN); PSTN/ISDN simulation services:
Anonymous Communication Rejection (ACR) and Communication Barring (CB);
Protocol specification\".
[10] ETSI EN 300 356-15 (V4.2.1): \"Integrated Services Digital Network
(ISDN); Signalling System No.7 (SS7); ISDN User Part (ISUP) version 4 for the
international interface; Part 15: Diversion supplementary service [ITU-T
Recommendation Q.732, clauses 2 to 5 (1999) modified]\".
[11] ETSI TS 183 028: \"Telecommunications and Internet converged Services and
Protocols for Advanced Networking (TISPAN); Common Basic Communication
procedures; Protocol specification\".
[12] ETSI ES 282 001: \"Telecommunications and Internet converged Services and
Protocols for Advanced Networking (TISPAN); NGN Functional Architecture\".
[13] ETSI ES 283 027: \"Telecommunications and Internet converged Services and
Protocols for Advanced Networking (TISPAN); Endorsement of the SIP-ISUP
Interworking between the IP Multimedia (IM) Core Network (CN) subsystem and
Circuit Switched (CS) networks\ [3GPP TS 29.163(Release 7), modified]\".
[14] IETF RFC 4458: \"Session Initiation Protocol (SIP) URIs for Applications
such as Voicemail and Interactive Voice Response (IVR)\".
[15] IETF RFC 3265: \"Session Initiation Protocol (SIP) -Specific Event
Notification\".
[16] ETSI TS 183 029: \"Telecommunications and Internet converged Services and
Protocols for Advanced Networking (TISPAN); PSTN/ISDN simulation services:
Explicit Communication Transfer (ECT); Protocol specification\".
[17] IETF RFC 3515: \"The Session Initiation Protocol (SIP) Refer Method\".
[18] IETF RFC 4745: \"Common Policy: A Document Format for Expressing Privacy
Preferences\".
[19] ETSI TS 183 004 V2.4.0: \"Telecommunications and Internet converged
Services and Protocols for Advanced Networking (TISPAN); PSTN/ISDN simulation
services: Communication Diversion (CDIV); Protocol specification\".
[20] OMA-TS-XDM-Core-V1_1: \"XML Document Management (XDM) Specification\",
Version 1.1.
[21] Void.
[22] IETF RFC 3326: \"The Reason Header Field for the Session Initiation
Protocol (SIP)\".
[23] IETF RFC 5627 (October 2009): \"Obtaining and Using Globally Routable
User Agent URIs (GRUUs) in the Session Initiation Protocol (SIP)\".
[24] IETF RFC 3023 (January 2001): \"XML Media Types\".
[25] IETF RFC 4288 (December 2005): \"Media Type Specifications and
Registration Procedures\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
ETSI TS 181 002 [1] and the following apply:
**CDIV Session Identifier URI:** URI created and inserted by a diverting AS
that is routed through the same AS
NOTE: This is used to solve the service interaction of CDIV and ECT.
**escaped character:** See IETF RFC 3261 [6].
**transferee:** party being transferred to the transfer target
**transferor:** party initiating the transfer
**transfer target:** party that the existing communication is transferred to
NOTE: After transfer the transferee and the transfer target are in
communication with each other.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
ACK ACKnowledgement
ACM Address Complete Message
ACR Anonymous Communication Rejection
ANM ANswer Message
AS Application Server
CB Communication Barring
CD Communication Deflection
CDIV Communication DIVersion
CFB Communication Forwarding Busy
CFNL Communication Forwarding on Not Logged-in
CFNR Communication Forwarding No Reply
CFNRc Communication Forwarding on subscriber Not Reachable
CFU Communication Forwarding Unconditional
CONF CONFerence
CPC Calling Party\'s Category
CPG Call ProGress message
CSCF Call Session Control Function
ECT Explicit Communication Transfer
HOLD communication HOLD
IAM Initial Address Message
IFC **Initial Filter Criteria**
IMS IP Multimedia Subsystem
IP Internet Protocol
ISDN Integrated Service Data Network
ISUP Integrated Service digital network User Part
IWU Inter Working Unit
MCID Malicious Communication IDentification
MGCF Media Gateway Control Function
NDC National Destination Code
NGN Next Generation Network
NOA Nature Of Address
OCB Outgoing Communication Barring
OIP Originating Identification Presentation
OIR Originating Identification Restriction
O-MGCF Outgoing - Media Gateway Control Function
P-CSCF Proxy-Call Session Control Function
PSTN Public Switched **Telephone** Network
RTP Real-Time Transport Protocol
S-CSCF Server-Call Session Control Function
SDP Session Description Protocol
SIP Session Initiation Protocol
SN Subscriber Number
TIP Terminating Identification Presentation
TIR Terminating Identification Restriction
UA User Agent
UE User Equipment
URI Universal Resource Identifier
XCAP XML Configuration Access Protocol
XML eXtensible Markup Language
# 4 Communication~~s~~ Diversion (CDIV)
## 4.1 Introduction
The **Communications Diversion (CDIV)** service enables diverting user, to
divert the communications addressed to diverting user to an other destination.
## 4.2 Description
### 4.2.1 General description
The service description of the following Communication Services CFU, CFB, CFNR
and CD is based on the PSTN/ISDN Supplementary Services, whereas CFNL is
Communication service based on requirements for IP based networks and CFNRc is
based on requirements for mobile networks.
Generally the following requirements should be fulfilled:
  * It shall be possible for the user or the network to identify an alternative destination for an IP multimedia session or individual media of an IP multimedia session.
  * It shall be possible for redirection to be initiated at various stages of an IP Multimedia session. For example:
```{=html}
``` \- Prior to the set up of an IP Multimedia session.
  * During the initial request for an IP Multimedia session (CFU).
  * During the establishment of an IP Multimedia session (CD).
```{=html}
``` \- Redirection can be applied for all Multimedia sessions unconditionally
or it can be caused by any of a set list of events or conditions. Typical
causes could be:
```{=html}
``` \- Identity of the originating user.
  * Presence of the originating or destination party.
  * If the destination party is already in a session (CFB).
  * If the destination party is unreachable or unavailable in some other way (CFNL; CFNR, CFNRc).
  * If the destination party does not respond (CFNR).
  * After a specified alerting interval (CFNR).
  * User\'s preference on routing for specific IP Multimedia session based on the capabilities of multiple UEs sharing the same IMS service subscription.
  * The sending party, receiving party or the network on their behalf, may initiate redirection to alternative destinations.
It shall be possible for the user to subscribe to receive notifications of
his/her communications diversions. The following services describe
applications based on a subset of the above-mentioned requirements to provide
user different possibilities to divert a communication.
It should be possible that a user has the option to restrict receiving
communications that are forwarded.
**Communication Forwarding Unconditional (CFU)**
The CFU service enables a served user to have the network redirect to another
user communications which are addressed to the served user\'s address. The CFU
service may operate on all communications, or just those associated with
specified services. The served user\'s ability to originate communications is
unaffected by the CFU supplementary service. After the CFU service has been
activated, communications are forwarded independent of the status of the
served user.
As a service provider option, a subscription option can be provided to enable
the served user to receive a reminder indication that the CFU service has been
activated. This indication shall be provided when the served user originates a
communication and if the CFU service has been activated for the served user\'s
address and for the service requested for the communication.
The maximum number of diversions permitted for each communication is a service
provider option. The service provider shall define the upper limit of
diversions. When counting the number of diversions, all types of diversion are
included.
**Communication Forwarding on Busy user (CFB)**
The CFB service enables a served user to have the network redirect to another
user communications which are addressed to the served user\'s address and meet
busy. The CFB service may operate on all communications, or just those
associated with specified services. The served user\'s ability to originate
communications is unaffected by the CFB supplementary service.
As a service provider option, a subscription option can be provided to enable
the served user to receive a reminder indication that the CFB service has been
activated. This indication shall be provided when the served user originates a
communication and if the CFB service has been activated for the served user\'s
address and for the service requested for the communication.
The maximum number of diversions permitted for each communication is a service
provider option. The service provider shall define the upper limit of
diversions. When counting the number of diversions, all types of diversion are
included.
For more information on the procedures for determination of the busy condition
see ES 183 028 [11].
**Communication Forwarding on no Reply (CFNR)**
The CFNR service enables a served user to have the network redirect to another
user communications which are addressed to the served user\'s address, and for
which the connection is not established within a defined period of time. The
CFNR service may operate on all communications, or just those associated with
specified services. The served user\'s ability to originate communications is
unaffected by the CFNR supplementary service.
The CFNR service can only be invoked by the network after the communication
has been offered to the served user and an indication that the called user is
being informed of the communication has been received.
As a service provider option, a subscription option can be provided to enable
the served user to receive a reminder indication that the CFNR service has
been activated. This indication shall be provided when the served user
originates a communication and if the CFNR service has been activated for the
served user\'s address and for the service requested for the communication.
The maximum number of diversions permitted for each communication is a service
provider option. The service provider shall define the upper limit of
diversions. When counting the number of diversions, all types of diversion are
included.
**Communication Forwarding on Subscriber Not Reachable (CFNRc)**
The CFNRc service enables a user to have the network redirect all incoming
communications, when the user is not reachable (e.g. there is no IP
connectivity to the user\'s terminal), to another user. The CFNRc service may
operate on all communications, or just those associated with specified
services. The user\'s ability to originate communications is unaffected by the
CFNRc simulation service.
As a service provider option, a subscription option can be provided to enable
the user to receive an indication that the CFNRc service has been activated.
This indication may be provided when the user originates a communication if
the CFNRc service has been activated for the user and for the service
requested for the communication.
The maximum number of diversions permitted for each communication is a service
provider option. The service provider shall define the upper limit of
diversions. When counting the number of diversions, all types of diversion are
included.
**Communication Deflection (CD)**
The CD service enables the served user to respond to an incoming communication
by requesting redirection of that communication to another user. The CD
service can only be invoked before the connection is established by the served
user, i.e. in response to the offered communication (before ringing), i.e. CD
Immediate, or during the period that the served user is being informed of the
communication (during ringing). The served user\'s ability to originate
communications is unaffected by the CD supplementary service.
The maximum number of diversions permitted for each communication is a network
provider option. The network provider shall define the upper limit of
diversions. When counting the number of diversions, all types of diversion are
included.
**Communication Forwarding on Not Logged-in (CFNL)**
The Communication Forwarding on Not Logged-in (CFNL) service enables a served
user to redirect incoming communications which are addressed to the served
user\'s address, to another user (forwarded-to address) in case the served
user is not registered (logged-in). The CFNL service may operate on all
communications, or just those associated with specified basic services.
As a service provider option, a subscription option can be provided to enable
the served user to receive a reminder [ ]{.underline} indication that the CFNL
service has been activated. This indication shall be provided when the served
user logs out according to procedures described in RFC 3261 [6].
The maximum number of diversions permitted for each communication is a service
provider option. The service provider shall define the upper limit of
diversions. When counting the number of diversions, all types of diversion are
included.
## 4.3 Operational requirements
### 4.3.1 Provision/withdrawal
The CDIV services (Communication forwarding unconditional, Communication
forwarding busy, Communication forwarding no reply, Communication forwarding
not logged-in, Communication deflection and Communication Diversion
Notification) shall be provided after prior arrangement with the service
provider.
The CDIV services shall be withdrawn at the served user\'s request or for
administrative reasons.
The CDIV simulation services can be offered separately with subscription
options. For each subscription option, only one value can be selected. These
subscription options are part of the call diversion profile for the served
user. The subscription options are shown in table 4.3.1.1.
Table 4.3.1.1: Subscription options for CDIV services
+-------------------------+-------------------------+---------------+ | Subscription options | Value | Applicability | +-------------------------+-------------------------+---------------+ | _Served user_ receives | No (default)\ | CFU\ | | indication that a | _ | CFB\ | | communication has been | ___________\ | CFNR | | forwarded (indication | ____________ | | | of communication | | CFNRc | | diversion to the | Yes | | | diverting user). | | | +-------------------------+-------------------------+---------------+ |_Originating_ user | No\ | CFU\ | | receives notification | _ | CFB\ | | that his communication | ___________\ | CFNR | | has been diverted | ____________ | | | (forwarded or | | CFNRc\ | | deflected). | Yes (default) | CFNL\ | | | | CD | +-------------------------+-------------------------+---------------+ | Served user allows the | No\ | CFU\ | | presentation of | _ | CFB\ | | diverted to URI to | ___________\ | CFNR | | _originating_ user in | ____________ | | | diversion notification. | | CFNRc\ | | | Not reveal as GRUU\ | CFNL\ | | | _ | CD | | | ___________\ | | | |_ ___________ | | | | | | | | Yes (default) | | +-------------------------+-------------------------+---------------+ | Served user receives | No (default)\ | CFU\ | | reminder indication on | _ | CFB\ | | outgoing communication | ___________\ | CFNR | | that CDIV is currently | ____________ | | | activated. | | CFNRc\ | | | Yes | CFNL | +-------------------------+-------------------------+---------------+ | Served user allows the | No\ | CFU\ | | presentation of his/her | _ | CFB\ | | URI to _diverted‑to_ | ___________\ | CFNR | | user. | ____________ | | | | | CFNRc\ | | | Not reveal as GRUU\ | CFNL\ | | | _ | CD | | | ___________\ | | | | ____________ | | | | | | | | Yes (default) | | +-------------------------+-------------------------+---------------+ | Served user allows the | No\ | CFU\ | | presentation of his/her | _ | CFB\ | | URI to _originating_ | ___________\ | CFNR | | user in diversion | ____________ | | | notification. | | CFNRc\ | | | Not reveal as GRUU\ | CFNL\ | | | _ | CD | | | ___________\ | | | | ____________ | | | | | | | | Yes (default) | | +-------------------------+-------------------------+---------------+
The following network provider options are available for the CDIV services:
Table 4.3.1.2: Network provider options for CDIV services
+-------------------------+-------------------------+---------------+ | Network provider option | Value | Applicability | +-------------------------+-------------------------+---------------+ | Served user | Retain communication to | CFNR\ | | communication retention | the served user until | CD | | on invocation of | alerting begins at the | | | diversion (forwarding | diverted-to user\ | | | or deflection). | _ | | | | ___________\ | | | | ____________ | | | | | | | | Clear communication to | | | | the served user on | | | | invocation of call | | | | diversion | | +-------------------------+-------------------------+---------------+ | Served user | Continue to alert the | CFNR | | communication retention | diverting user (see | | | when diverting is | note 1)\ | CD | | rejected at\ | _ | | | diverted-to user. | ___________\ | | | |_ ___________ | | | | | | | | No action at the | | | | diverting user (see | | | | note 2) | | +-------------------------+-------------------------+---------------+ | Subscription option is | No | CFU | | provided for \"served | | | | user receives reminder | _ | CFB | | indication on outgoing | ___________\ | | | communication that CDIV | ____________ | CFNR | | is currently | | | | activated\". | Yes | CFNRc | | | | | | | | CFNL | +-------------------------+-------------------------+---------------+ | Total number of all | Maximum number of | CFU\ | | diversions for each | diverted connections\ | CFB\ | | communication. | ( upper limit is based | CFNR | | | on operator policy) | | | | | CFNRc\ | | | | CFNL\ | | | | CD | +-------------------------+-------------------------+---------------+ | CDIV Indication Timer. | Timer duration shall be | CFU\ | | | a service provider | CFB\ | | | option | CFNR | | | | | | | | CFNRc\ | | | | CFNL\ | | | | CD | +-------------------------+-------------------------+---------------+ | Communication | Timer default duration | CFNR | | forwarding on no reply | shall be a service | | | timer. | provider option (NOTE | | | | 3) | | +-------------------------+-------------------------+---------------+ | NOTE 1: This applies to | | | | the retention of the | | | | communication at | | | | invocation of | | | | communication | | | | diverting. | | | | | | | | NOTE 2: This applies to | | | | the clearing | | | | communication option on | | | | invocation of | | | | communication | | | | diverting. | | | | | | | | NOTE 3: As a network | | | | provider option, It | | | | shall be possible to | | | | change the timer | | | | duration by the served | | | | user.. | | | +-------------------------+-------------------------+---------------+
For user configuration of the CDIV the Ut interface described in ES 282 001
[12] could be used. More detail is described in clause 4.9.
Other possibilities for provisioning could be used too, like web based
provisioning or pre-provisioning by the operator.
### 4.3.2 Requirements on the originating network side
No specific requirements are needed in the network.
### 4.3.3 Requirements in the network
No specific requirements are needed in the network.
## 4.4 Coding requirements
ES 283 003 [2] defines the messages and parameters for this simulation
service. The following messages and parameters are used to support the
Communication diversion service due to fulfil the requirements.
### 4.4.1 SIP-Messages
#### 4.4.1.1 SIP messages for redirection
The following SIP messages are used due to the coding rules in ES 283 003 [2].
Table 4.4.1.1: SIP Header information for redirection
+---------------------------+-----------+---------------------------+ | SIP Message | Reference | SIP Header | +---------------------------+-----------+---------------------------+ | INVITE | [3] | History-Info header | | | | | | | [8] | Privacy header | | | | | | | [14] | cause-param URI parameter | | | | | | | [23] | \"gr\" URI parameter | +---------------------------+-----------+---------------------------+ | 180 (Ringing) | [3] | History-Info header | | | | | | | [8] | Privacy header | | | | | | | [14] | cause-param URI parameter | | | | | | | [23] | \"gr\" URI parameter in | | | | the Contact | +---------------------------+-----------+---------------------------+ | 181 (Call Is Being | [3] | History-Info header | | Forwarded) | | | | | [8] | Privacy header | | | | | | | [14] | cause-param URI parameter | | | | | | | [23] | \"gr\" URI parameter in | | | | the Contact | +---------------------------+-----------+---------------------------+ | 200 (OK) response | [3] | History-Info header | | | | | | | [8] | Privacy header | | | | | | | [14] | cause-param URI parameter | | | | | | | [23] | \"gr\" URI param URI | | | | parameter | +---------------------------+-----------+---------------------------+ | 302 (Moved Temporarily)\ | [2] | Contact header | | (see note) | | | | | [14] | cause-param URI parameter | +---------------------------+-----------+---------------------------+ | NOTE: The 302 (Moved | | | | Temporarily) response is | | | | in the present document | | | | only used for the CD | | | | services. | | | +---------------------------+-----------+---------------------------+
More information on the cause-param URI parameter is given in annex C.
An AS that implements the CDIV service shall support the REFER method RFC 3515
[17], to be able to handle the interaction with ECT TS 183 029 [16].
#### 4.4.1.2 Void
### 4.4.2 Parameters
The Privacy header is described in ES 283 003 [2]. The present document refers
for the History-Info header to\ RFC 4244 [3], for the Privacy header and
P-Asserted-Identity to RFC 3325 [8], for GRUU to RFC 5627 [23] and for the
cause-param to RFC 4458 [14].
## 4.5 Signalling requirements
### 4.5.0 General
For user configuration of the CFU, CFB, CFNR, CFNL, CFNRc and CD services the
Ut interface should be used.
See clause 4.9 for further information about the structure of the XML
document.
NOTE: Other possibilities for user configuration, as web-based provisioning or
pre-provisioning by the operator are outside the scope of the present
document.
### 4.5.1 Activation/deactivation
The services CFU, CFB, CFNR, CFNL, CFNRc and CD are individually activated at
provisioning or at the subscribers request by using for example the Ut
interface.
The services CFU, CFB, CFNR, CFNL, CFNRc and CD are individually deactivated
at withdrawal or at the subscribers request by using for example the Ut
interface.
### 4.5.1a Registration/erasure
For registration of diversion information for the services CFU, CFB, CFNR,
CFNL, CFNRc and CD, the Ut interface should be used. The diverted-to party
address of the services CFU, CFB, CFNR, CFNL, CFNRc and CD can individually be
registered at the subscribers request by using the Ut interface.
For erasure of diversion information for the services CFU, CFB, CFNR, CFNL,
CFNRc and CD, the Ut interface should be used. The diverted-to party address
of the services CFU, CFB, CFNR, CFNL, CFNRc and CD can individually be erased
at the subscribers request by using the Ut interface.
### 4.5.1b Interrogation
For interrogation of the services CFU, CFB, CFNR, CFNL, CFNRc and CD, the Ut
interface should be used.
### 4.5.2 Invocation and operation
#### 4.5.2.1 Actions at the originating UA
When communication diversion has occurred on the served user side and the
network option \"_Originating_ user receives notification that his
communication has been diverted (forwarded or deflected)\" is set to true, the
originating UA may receive a 181 (Call is being forwarded) response according
to the procedures described in ES 283 003 [2].
The Information given by the History-Info header could be displayed by the UA
if it is a UE.
#### 4.5.2.2 Actions at the originating P-CSCF
Procedures according to ES 283 003 [2] shall apply.
#### 4.5.2.3 Actions at the originating S-CSCF
Procedures according to ES 283 003 [2] shall apply.
#### 4.5.2.4 Actions at the diverting S-CSCF
Procedures according to **ES 283 003 [** 2**]** shall apply.
Based on the Initial Filter Criteria (IFC) Rules, indicating that the served
user is subscribed to the CDIV simulation services, the communication is be
forwarded to an AS.
NOTE: An example of the use of IFC is shown in annex B.
#### 4.5.2.5 Actions at the diverted to S-CSCF
Procedures according to **ES 283 003 [** 2**]** shall apply.
#### 4.5.2.6 Actions at the AS of the diverting User
##### 4.5.2.6.1 Checking of the diversion limits
When receiving an INVITE request and the AS determines that the AS shall
divert a communication the AS shall check if diverting the communication
exceeds the number of diversions allowed within the network. The AS shall
calculate the number of diversions by examination of the History-Info header
field:
\- using the entries including a cause-param URI parameter with cause values
specified in subclause 4.5.2.6.2.2; or
\- examining the entries in the Index entries parameter;
to see if another diversion is allowed due to network provider allowed [
]{.underline} limit of diversions.
If the number of diversions exceed the given limit then the following response
sent to the originating user shall apply:
a) communication diversion forwarding busy a 486 (Busy here) shall be sent;
b) communication forwarding no reply, 480 (Temporarily unavailable) shall be
sent;
c) communication forwarding unconditional 480 (Temporarily unavailable) shall
be sent;
d) communication deflection, 480 (Temporarily unavailable) shall be sent.
NOTE: It is based on operator policy that the communication can be delivered
to the latest diverting party when it is known.
In all cases a Warning header field indicating that the communication is
released due to the extension of diversion hops (e.g. \"Too many diversions
appeared\") shall be sent.
##### 4.5.2.6.2 Setting of the diversion parameters by the AS
##### 4.5.2.6.2.1 Overview {#overview .H6}
After checking the limit of diversions the following settings of the INVITE
request shall be performed.
##### 4.5.2.6.2.2 Diversion where served user is not last in received History-
Info header {#diversion-where-served-user-is-not-last-in-received-history-
info-header .H6}
If an AS determines that the AS shall divert a communication and the AS shall
apply the procedures in the present subclause if any of the following
conditions apply for the received INVITE request:
\- no History-Info header field received; or
\- a History-Info header field is received in which the last history-info
entry contains no hi-targeted-to-uri element for the served user.
The following information is to be set in the retargeted request:
\- the diverting parties address;
\- the diverted-to party address;
\- diversion information.
The following header fields shall be included or modified with the specified
values:
**a) The Request URI** \- shall be set to the SIP URI where the communication
is to be diverted to (see \ element in clause 4.9.1.4). In advance of
this, if the \ element contains a tel URI, the AS shall convert the
tel URI into a SIP URI as specified in RFC 3261 [6], and include a user
parameter set to \"phone\".
> The AS shall add the cause-param as defined by RFC 4458 [14] to the request
> URI. The mapping between the diversion conditions and the coding of the
> cause-param parameter values as defined by RFC 4458 [14] shall be as
> follows:
\- for communication forwarding busy, the cause value \"486\";
\- for communication forwarding no reply, the cause value \"408\";
\- for communication forwarding unconditional, the cause value \"302\";
\- for communication deflection (Immediate Response), the cause value \"480\";
\- for communication forwarding not logged in , the cause value \"404\";
\- for communication deflection during alerting, the cause value \"487\"; and
\- for communication forwarding on subscriber not reachable, the cause value
\"503\".
**b) The History-Info header** field - Two hist-info entries that shall be
generated.
b.1) The first entry includes the hi-targeted-to-uri of the served user.
The privacy header \"history\" shall be escaped within the hi-targeted-to-uri,
if:
\- the served user wishes privacy (e.g. the served user is subscribed to the
OIR Service); or
\- the served used has the subscription option \"Served user allows the
presentation of his/her URI to diverted‑to user\" set to false.
Otherwise, if the first entry contains the \"gr\" parameter and the
subscription option \"Served user allows the presentation of his/her URI to
_diverted‑to_ user\" is set to \"not-reveal-as-GRUU\", then it shall be
changed as follows:
  * replace the first entry with the public user identity of the served user.
If the diversion is based on a SIP response from the served user, a Reason
header as defined in RFC 3326 [22] shall be included in escaped form in the
hi-targeted-to-uri in accordance with RFC 4244 [3].
When a Reason header field or a Privacy header field needs to be included in
the hi-targeted-to-uri, the hi-targeted-to-uri shall be a SIP URI.
b.2) The second entry includes the new Request URI as described under bullet
a) as hi-targeted-to-uri .
NOTE: In accordance with RFC 4458 [14], hi-targeted-to-uri will contain a
cause-param in non-escaped format.
**c) The To header** field:
> If the served user does not want to reveal its identity to the diverted-to
> party, then the To header shall be changed to the URI where the
> communication is diverted to. The served user does not want to reveal its
> identity when one of the following conditions holds true:
>
> \- if the served user wishes privacy (e.g. the served user is subscribed to
> the OIR Service); or
>
> \- if the served used has the subscription option \"Served user allows the
> presentation of his/her URI to diverted‑to user\" set to \"false\".
>
> Otherwise, if the To header contains the \"gr\" parameter and the served
> user has the subscription option \"Served user allows the presentation of
> his/her URI to diverted‑to user\" set to \"not-reveal-as-GRUU\", then the To
> header field shall be changed to a public user identity of the served user.
In all other cases the To header shall not be changed.
##### 4.5.2.6.2.3 Diversion with served user last in received History-Info
header {#diversion-with-served-user-last-in-received-history-info-header .H6}
If an AS determines that the communication shall be diverted the AS shall
apply the procedures in the present subclause if the received INVITE request
includes a History-Info header, which in the last history-info entry includes
a hi-targeted-to-uri with an entry for the served user, encoded as in
subclause 4.5.2.6.2.2. In this case the AS shall add a new history-info entry
to the History-Info header field according to the rules defined in RFC 4244
[3]. The following information has to be added to the retargeted request:
  * the diverted-to party address;
  * diversion information.
The following header fields shall be included or modified with the specified
values;
**a) Request URI** \- shall be set to the SIP or SIPS URI where the
communication is to be diverted to (see \ element in subclause
4.9.1.4). In advance of this, if the \ element contains a tel URI, the
AS shall convert the tel URI into a SIP URI as specified in RFC 3261 [6], and
include a user parameter set to \"phone\".
The AS shall add the cause-param as defined by RFC 4458 [14] to the request
URI. The mapping between the diversion conditions and the coding of the cause-
param parameter shall be as defined under bullet a) in subclause 4.5.2.6.2.2.
**b) History-Info header** shall be modified in accordance with RFC 4244 [3].
The history entry corresponding to the previous request URI can be modified.
One history entry is added.
b.1) The existing history entry corresponding to the previous request URI
shall be treated as follows:
If the Privacy header field does not contain \"history\", the privacy header
\"history\" in escaped format shall be added or modified within the hi-
targeted-to-uri, if:
\- the served user wishes privacy (e.g. the served user is subscribed to the
OIR Service); or
\- the served used has the subscription option \"Served user allows the
presentation of his/her URI to diverted‑to user\" set to false.
If the history entry representing the served user contains the \"gr\"
parameter and the subscription option \"Served user allows the presentation of
his/her URI to _diverted‑to_ user\" set to \"not-reveal-as-GRUU\", it shall be
changed to a public user identity of the served user.
If the diversion is based on a SIP response from the served user, a Reason
header in escaped form shall be included in the hi-targeted-to-uri, in
accordance with RFC 4244 [3].
When a Reason header field or a Privacy header field needs to be included in
the existing hi-targeted-to-uri that is a tel URI, the hi-targeted-to-uri
shall be first converted to a SIP URI.
> b.2) A history entry shall be added containing the new Request URI as
> described under bullet a) as hi-targeted-to-uri.
NOTE: In accordance with RFC 4458 [14], hi-targeted-to-uri will contain a
cause-param in non-escaped format.
**c) To header** :
> If the served user does not want to reveal its identity to the diverted-to
> party, then the To header shall be changed to the URI where the
> communication is diverted to. The served user does not want to reveal its
> identity when one of the following conditions holds true:
\- if the served user wishes privacy (e.g. the served user is subscribed to
the OIR Service); or
\- if the served used has the subscription option \"Served user allows the
presentation of his/her URI to diverted‑to user\" set to false.
> Otherwise, if the To header contains the \"gr\" parameter and the served
> user has the subscription option \"Served user allows the presentation of
> his/her URI to _diverted‑to_ user\" set to \"not-reveal-as-GRUU\", then the
> To header shall be changed to a public user identity of the served user.
>
> In all other cases the To header shall not be changed.
##### 4.5.2.6.2.4 Overview of the operation {#overview-of-the-operation .H6}
Figure 4.5.2.6.2.4 shows the example of a communication path for multiple
diversions.
Figure 4.5.2.6.2.4: Originally A calls B Information transferred in the INVITE
request
Table 4.5.2.6.2.4 shows which parameters and header fields that are added or
modified in a diversion AS.
Table 4.5.2.6.2.4: Parameter information for multiple redirections
| HOP 1 | HOP 2 | HOP 3 | HOP 4 | HOP 5 |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---|---|---|---  
Number Information: P-Asserted-Identity Request URI | A B | A C | A D | A E | A F |  |  |  |  |  |  |   
hi-entry |  | B | C | B | C | D | B, C | D | E | B, C, D | E | F  
Information added: hi-targeted-to-uri (NOTE 4) Reason header (NOTE 2) cause-param (NOTE 3) Privacy Hi-index (NOTE 1) |  | B V W index 1 | C U index 2 | 
> No changes
| V W | D U index 3 | 
> No changes
| V W | E U index 4 | 
> No changes
| V W | F U index 5  
U = Value for the cause-param parameter as specified in 4.5.2.6.2.2 and 4.5.2.6.2.3 V = Value in accordance with the rules in RFC 4244 [3]. W = privacy value (history) or (none) or no entry. NOTE 1: The hi-index field shall be set or incremented according to the basic forwarding rules as specified in subclause 4.3.3.1.3 of RFC 4244 [3]. NOTE 2: The encoding of the reason header and the contained protocol-cause parameter are specified in RFC 3326 [22]. It is embedded in the hi-targeted-to-uri of the history info header in escaped format according to the rules in RFC 4244 [3]. NOTE 3: The cause-param is specified in RFC 4458 [14]. It is embedded in the hi-targeted-to-uri of the history info header in non-escaped format according to the rules in RFC 4458 [14]. NOTE 4: If the received hi-targeted-to-uri is a tel URI, it is converted to a SIP URI if the Reason or the Privacy header field has to be embedded. |  |  |  |  |  |  |  |  |  |  |  |   
##### 4.5.2.6.3 Diversion procedures at the diverting AS
The diverting AS shall continue the communication depending on the service
that is causing the diversion:
**1) Communication Forwarding Unconditional or Communication Forwarding Busy
network determined user busy or Communication forwarding on Not Logged in**
The AS shall continue in the following manner:
\- If the notification procedure of the originating user is supported then the
originating user shall be notified as described in the clause 4.5.2.6.4.
\- An INVITE request containing the diverted-to URI shall sent to the
(outgoing) S-CSCF. The INVITE request shall includes the parameter information
as shown in table 4.5.2.6.2.4 and described in clause 4.5.2.6.2.
  * If the served user has subscribed to the indication of communication diversion to the diverting user, then the served user will be notified of the communication diversion as described in clause 4.5.2.6.5.
**2) Communication Forwarding No Reply**
After receiving the first 180 (Ringing) response the no reply timer
(definition see clause 4.8) shall be started. If forking is provided by the
S-CSCF a further received 180 (Ringing) response does not refresh the timer.
With receiving a 200 (OK) response the no reply timer shall be terminated and
the call follows the Basic call procedure as described within ES 283 003 [2].
Other open early dialogs shall be terminated as described within ES 283 003
[2], clause 9.2.3.
When the no reply timer defined in clause 4.8 expires:
The dialog(s) to the diverting user shall be terminated e.g. by sending a
CANCEL request or BYE request according to the rules and procedures in RFC
3261 [6].
If the notification procedure of the originating user is supported then the
originating user shall be notified as described in the clause 4.5.2.6.4.
An INVITE request is sent to the (outgoing) S-CSCF towards the diverted-to
user. The INVITE request includes the parameter information as shown in table
4.5.2.6.2.4.
> If the served user has subscribed to the indication of communication
> diversion to the diverting user, then the served user will be notified of
> the communication diversion as described in clause 4.5.2.6.5.
**3) Communication Forwarding No Reply (ringing continues)**
After receiving the first 180 (Ringing) response the no reply timer
(definition see clause 4.8) shall be started. If forking is provided by the
S-CSCF a further received 180 (Ringing) response does not refresh the timer.
When the no reply timer defined in subclause 4.8 expires, an INVITE is sent to
the outgoing S-CSCF towards the diverted to user. The INVITE address message
includes the parameter information as shown in table 4.5.2.6.2.4.
When the diverting AS receives a provisional response or 200 (OK) response to
initial INVITE from diverted-to-user based on operator policy, the dialog(s)
to the diverting user shall be terminated e.g. by sending a CANCEL request or
a BYE request according to the rules and procedures in IETF RFC 3261 [6], and
if the notification procedure of the originating user is supported, the
originating user shall be notified as described in subclause 4.5.2.6.4.
If the served user has subscribed to the indication of communication diversion
to the diverting user, then the served user will be notified of the
communication diversion as described in clause 4.5.2.6.5.
If diverting user accepts the communication after sending the INVITE request
the communication path towards the diverted to user shall be released
according to the rules and procedures in RFC 3261 [6].
**4) Communication Forwarding User Determined Busy**
The Communication Forwarding User Determined Busy is offered to the served
user when the AS:
\- The received 486 Busy shall be acknowledged with a ACK.
\- If the notification procedures of the originating user is supported then
the originating user shall be notified as described in the clause 4.5.2.6.4.
\- An INVITE message containing the diverted-to URI is sent to the outgoing
S-CSCF. The INVITE address message includes the parameter information as shown
in table 4.5.2.6.2.4.
  * If the served user has subscribed to the indication of communication diversion to the diverting user, then the served user will be notified of the communication diversion as described in clause 4.5.2.6.5.
**5) Communication Deflection immediate response**
The Communication Deflection immediate response is offered to the served user.
A 302 (Moved Temporarily) response is received.
If the notification procedures of the originating user is supported then the
originating user shall be notified as described in clause 4.5.2.6.4.
An INVITE message containing the diverted-to URI is sent to the outgoing
S-CSCF. The INVITE address message includes the parameter information as shown
in table 4.5.2.6.2.4.
> If the served user has subscribed to the indication of communication
> diversion to the diverting user, then the served user will be notified of
> the communication diversion as described in clause 4.5.2.6.5.
**6) Communication Deflection during alerting**
When Communication Deflection during alerting is invoked after the AS receives
a 180 (Ringing) \"Ringing\" response. then:
  * A 302 (Moved Temporarily) response is received; and
  * if the notification procedures of the originating user is supported then the originating user shall be notified as described in clause 4.5.2.6.4; and
  * an INVITE request containing the URI received in the Contact header of the 302 as the diverted-to URI shall be sent as specified in ES 283 003 [2]. The diverted-to URI could be restricted by setting the privacy header for the entry of the diverted-to URI to \"history\"; and
  * the INVITE request shall include the parameter information as shown in table 4.5.2.6.2.4 \"Parameter information for multiple redirection\".
If the served user has subscribed to the indication of communication diversion
to the diverting user, then the served user will be notified of the
communication diversion as described in clause 4.5.2.6.5.
**7) Communication Forwarding on Subscriber Not Reachable**
When the AS receives a not reachable indication (see clause 4.5.2.6.6) on the
INVITE forwarded to the served user, then the following criteria shall apply
before the Communication Forwarding on Subscriber Not Reachable procedure is
executed:
  * the served user has an active forwarding rule containing not-reachable condition (see clause 4.9); and
  * the served user is registered.
The following steps shall be followed to perform Communication Forwarding on
Subscriber Not Reachable:
1) If the notification procedures of the originating user is supported then
the originating user shall be notified as described in the clause 4.5.2.6.4.
2) An INVITE message containing the diverted-to URI is sent to the outgoing
S-CSCF. The INVITE address message includes the parameter information as shown
in table 4.5.2.6.2.4.
If the served user has subscribed to the indication of communication diversion
to the diverting user, then the served user will be notified of the
communication diversion as described in clause 4.5.2.6.5.
##### 4.5.2.6.4 Notification procedures of the originating user (Subscription
Option)
When Communication Diversion occurs and if served user has the subscription
option \"_Originating_ user receives notification that his communication has
been diverted (forwarded or deflected).\" set to true then a 181 (Call Is
Being Forwarded) response shall be sent towards the originating user.
The following header fields shall be included or modified with the specified
values:
a) The **P-Asserted-Identity** includes the URI of the diverting user.
b) The **Privacy** header with the value \"id\" shall be included, if:
  * the served user wishes privacy (e.g. the served user is subscribed to the TIR Service); or
  * the served used has the subscription option \" Served user allows the presentation of his/her URI to _originating_ user in diversion notification.\" set to false.
c) The following entries shall be added to the **History-Info** header field:
c.1) If this is the first diversion then the first entry shall be populated
with the hi-targeted-to-uri of the served user. The Index is set to index = 1
according to the rules specified in RFC 4244 [3].
c.2) On the history entry that represents the served user:
> the privacy header with value \"history\" shall be escaped within the hi-
> targeted-to-uri, if:
  * the served user wishes privacy (e.g. the served user is subscribed to the TIR Service); or
  * the served used has the subscription option \"Served user allows the presentation of his/her URI to _originating_ user in diversion notification.\" set to false.
If the history is already escaped with the correct privacy value no
modification is needed.
If the history entry representing the served user contains the \"gr\"
parameter and the served user has the subscription option \"Served user allows
the presentation of his/her URI to _originating_ user in diversion
notification\" set to \"not-reveal-as-GRUU\", it shall be changed to the
public user identity of the diverted-to user.
In all other cases the history entry representing the served user shall not be
changed.
c.3) A history entry shall be added according to the rules of clause
4.5.2.6.2.3 item b.2. In addition, for this entry.
> c.3.1) if the history entry representing the forwarded to URI contains the
> \"gr\" parameter and the served user has the subscription option \"Served
> user allows the presentation of forwarded to URI to _originating_ user in
> diversion notification\" set to \"not-reveal-as-GRUU\", it shall be changed
> to the public user identity of the diverted-to user.
>
> c.3.2) the privacy header with value \"history\" shall be escaped within the
> hi-targeted-to-uri, if the served used has the subscription option \"Served
> user allows the presentation of forwarded to URI to _originating_ user in
> diversion notification\" set to \"false\".
Additional the AS may initiate an announcement to be included towards the
calling user in order to inform about the diversion. Announcements may be
played according to procedures as are described in TS 183 028 [11].
##### 4.5.2.6.5 Indication of communication diversion to the diverting user
(subscription option)
If the subscription option \"Served user receives notification that a
communication has been forwarded\" has been set to \"yes\", one or a
combination of the following procedures are possible:
1) When the diverting user is registering to the communication system, the AS
sends a MESSAGE request including the information where his calls are diverted
to [i]{.underline}f any. As an option; the MESSAGE request may be sent to the
user after a period of time according to the timer value T~CDIV_IND~ as
defined in clause 4.8.3 that can be provided by the user.
2) A diverting user will be informed periodically with a MESSAGE request the
information where the call is diverted to.
NOTE 1: A diverting user could be informed via a Voicemail or Message mail
system in the communication states described above.
3) If the subscription option \"Served user receives reminder notification on
outgoing communication that CDIV is currently activated\" has been set to
\"yes\", then a diverting user will be informed with a MESSAGE request after
the diverting user has initiated a new outgoing communication. The MESSAGE
request includes the information where the call is diverted to.
NOTE 2: A diverting user could be informed via a Voicemail or Message mail
system in the communication states described above.
The description of information text contained in the MESSAGE request is out of
scope of the present document.
##### 4.5.2.6.5.1 Void {#void-1 .H6}
##### 4.5.2.6.5.2 Void {#void-2 .H6}
##### 4.5.2.6.6 not reachable indication
It is recommended that the AS interprets the reception of one of the following
response events as not reachable indication:
  * 408 Request timeout response;
  * 503 Service unavailable;
  * 500 Server internal error;
and no provisional response, different than 100 Trying, has been received on
the same dialog.
NOTE 1: Once the response code for signalling channel outage between the UE
and the P-CSCF is standardized this response has to be added to this list.
NOTE 2: There may be other means to discover this condition. These other means
are out of the scope of the present document.
#### 4.5.2.7 Actions at the AS of the diverted to user
The AS shall store the History-Info header of an incoming Request.
If a 180, 181 or 200 response does not contain a History Info header field,
the AS shall include the stored History-Info header field and if diverted to
user is subscribed to the TIR service the Privacy header field of all
responses the\ priv-value of the last entry in the History-Info header field
shall be set to \"history\".
NOTE: A response including no History-Info header Field is coming from an
untrusted entity or the History-Info header field is not included due to the
privacy status within the SIP request.
#### 4.5.2.8 Void
#### 4.5.2.9 Actions at the incoming I-CSCF
Procedures according to ES 283 003 [2] shall apply.
#### 4.5.2.10 Actions at the outgoing IBCF
Procedures according to ES 283 003 [2] shall apply.
#### 4.5.2.11 Actions at the incoming IBCF
Procedures according to ES 283 003 [2] shall apply.
#### 4.5.2.12 Actions at the BGCF
Basic call procedures according to ES 283 003 [2] shall apply.
The interworking with other NGN is described in clause 4.7.3.
#### 4.5.2.13 Actions at the MGCF
Procedures according to ES 283 003 [2] shall apply.
The interworking is described in clause 4.7.1.
#### 4.5.2.14 Actions at the destination P-CSCF
Procedures according to ES 283 003 [2] shall apply.
#### 4.5.2.15 Actions at the diverted to UA
Procedures according to ES 283 003 [2] shall apply.
#### 4.5.2.16 Actions at the diverting UA
Procedures according to ES 283 003 [2] shall apply.
To invoke Communication Deflection the UA shall send a 302 including a Contact
header field with the address where the communication is diverted to.
## 4.6 Interaction with other services
### 4.6.1 Communication Hold (HOLD)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.2 Terminating Identification Presentation (TIP)
A P-Asserted-Identity and History-Info header field received in the diverting
AS is passed unmodified to the originating entity. The originating S-CSCF is
responsible for the interpretation of the privacy header field.
### 4.6.3 Terminating Identification Restriction (TIR)
A P-Asserted-Identity and History-Info header field received in the diverting
AS is passed unmodified to the originating entity. The originating CSCF is
responsible of the interpretation of the privacy header field.
If the served (diverting) user selects the option that the originating user is
notified, but without the diverted-to SIP, TEL or SIPS URI, then the AS shall
not send the connected user\'s identity when the communication is answered,
unless the originating user has an override capability.
### 4.6.4 Originating Identification Presentation (OIP)
When a communication has been diverted and the diverted-to user has been
provided with the originating identification presentation simulation service,
the S-CSCF of the diverted-to user shall sent the SIP, TEL or SIPS URI of the
original originating user, if this originating user has not subscribed to or
invoked the originating identification restriction simulation service.
### 4.6.5 Originating Identification Restriction (OIR)
When the originating identification restriction simulation service has been
invoked, the originating user\'s address shall not be presented to the
diverted-to user unless the diverted-to user has an override capability.
### 4.6.6 Conference calling (CONF)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.7 Communication Diversion Services (CDIV)
For the redirection services, no impact, i.e. neither service shall affect the
operation of the other service.
For the indication of communication diversion to the diverting user service,
the provision and activation of at least one redirection service is a pre-
requirement to provision and activate the indication of communication
diversion to the diverting user service.
### 4.6.8 Malicious Communication Identification (MCID)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.9 Anonymous Communication Rejection and Communication Barring (ACR/CB)
If the user where the communication is forwarded to has subscribed to a call
barring service \"inhibition of incoming forwarded communication\" the
procedures described in TS 183 011 [9] shall take precedence.
If the user is subscribed to an Outgoing Communication Barring (OCB) service
that includes the forwarded communication the OCB shall take precedence. The
CDIV service has to check if the forwarded to SIP, TEL or SIPS URI is
restricted and release the communication in such a case.
### 4.6.10 Explicit Communication Transfer (ECT)
#### 4.6.10.1 Actions at the diverting AS
##### 4.6.10.1.1 Determine whether ECT is applied to the diverted
communication
See TS 183 029 [16] clause 4.5.2.4.1 on the criteria that determine that a
REFER request is to be treated as a request for transfer of an existing
communication.
##### 4.6.10.1.2 Handling of transfer requests
When a REFER request is received in the context of a call transfer scenario
(see clause 4.6.10.1.1), it shall perform the following steps:
1) Create a new CDIV Session Identifier URI addressed to this AS. The URI
shall be created in such a way that a new dialog set up towards this URI can
be easily correlated with the current REFER dialog.
2) The AS stores the value of the Refer-To header field (transfer target) from
the REFER request and links it to the CDIV Session Identifier URI.
3) The AS Replaces the Refer-To header field with the CDIV Session Identifier
URI. (This ensures that the diverting AS remains in the loop when the
transferee sets up the communication with the transfer target.).
4) The AS forwards the REFER request to the transferee using basic
communication procedures ES 283 003 [2].
##### 4.6.10.1.3 Actions when CDIV is invoked again by the transferred
communication
When an INVITE is received targeted at the CDIV Session Identifier URI created
earlier when transfer of the diverted ongoing communication was requested, the
AS shall perform the following actions:
1) The AS replaces the request URI with the stored Refer-To header field value
linked to the specific CDIV Session Identifier URI.
NOTE: If needed the AS may generate charging events to charge for the extra
leg.
2) The AS sets the diversion parameters (History-Info and To header fields) as
specified in clause 4.5.2.6.2, in step 4.5.2.6.2.2 b2) or 4.5.2.6.2.3 b2) the
cause-param value 302 shall be used.
3) The AS forwards the INVITE request towards the transfer target using basic
communication procedures ES 283 003 [2].
## 4.7 Interworking with other networks
### 4.7.1 Interworking with PSTN/ISDN
In case of interworking with networks which do not provide any notification of
the communication diversion or communication redirection information (e.g.
redirection counter) in the signalling system, the communication continues
according to the basic call procedures.
#### 4.7.1.1 Interworking at the O-MGCF
For the mapping of IAM to the INVITE Message no additional procedures beyond
the basic call and interworking procedures are needed unless Call Forwarding
within the ISUP network appeared.
With regard to the backward messages the following mapping is valid.
Table 4.7.1.1.1: Mapping of SIP messages to ISUP messages
* * *
←Message sent to ISUP ←Message Received from SIP
ACM indicating call forwarding 181 (Call Is Being Forwarded) See table
4.7.1.1.6
CPG indicating call forwarding\ 181 (Call Is Being Forwarded) See table
4.7.1.1.7 (see note)
ACM indicating ringing 180 (Ringing) See table 4.7.1.1.8
CPG indicating Alerting (see note) 180 (Ringing) See table 4.7.1.1.9
ANM 200 (OK) See table 4.7.1.1.10
CON 200 (OK) (Neither a 181 (Call Is Being Forwarded) nor a 180 (Ringing) was
received) See table 4.7.1.1.10
NOTE: A CPG will be sent if an ACM was already send.
* * *
NOTE: The mapping of the basic Messages is shown in ES 283 027 [13].
Table 4.7.1.1.2: Mapping of History-Info Header to ISUP Redirection number
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Redirection | Derived value | | header field | Component | number | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | Hi-t | CC | Nature of | If CC is equal | | argeted-to-uri | | address | to the country | | of the last | | indicator | code of the | | History-Info | | | country where | | hi-entry | | | O‑MGCF is | | containing a | | | located AND | | cause-param | | | the next ISUP | | URI parameter, | | | node is | | as defined in | | | located in the | | IETF RFC 4458 | | | same country, | | [14]. [ | | | then set to | | ]{.underline} | | | \"national | | | | | (significant) | | The global | | | number\" else | | number portion | | | set to | | of the URI is | | | \ | | assumed to be | | | "international | | in form\ | | | number\". | | \"+\" CC + NDC | | | | | + SN. (NOTE) | | | | +----------------+----------------+----------------+----------------+ | | CC, NDC, SN | Address | If NOA is | | | | signals | \"national | | | | | (significant) | | | | | number\" then | | | | | set to\ | | | | | NDC + SN. | | | | | | | | | | If NOA is | | | | | \ | | | | | "international | | | | | number\" | | | | | | | | | | then set to CC | | | | | + NDC + SN. | +----------------+----------------+----------------+----------------+ | NOTE: If it is | | | | | SIP URI and | | | | | doesn't | | | | | contain | | | | | "user=phone", | | | | | mapping to | | | | | redirection | | | | | number is | | | | | impossible, | | | | | therefore no | | | | | need to | | | | | generate | | | | | Redirection | | | | | number and | | | | | Redirection | | | | | number | | | | | restriction | | | | | (per | | | | | tab | | | | | le 4.7.1.1.3). | | | | | Notification | | | | | subscription | | | | | options can't | | | | | be set as | | | | | "_presentation | | | | | allowed with | | | | | redirection | | | | | number_ ". | | | | +----------------+----------------+----------------+----------------+
Table 4.7.1.1.3: Mapping of History-Info header to ISUP Redirection number
restriction
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Redirection | Derived value | | header field | Component | number | of parameter | | and component | value | restriction | field | +----------------+----------------+----------------+----------------+ | Privacy, | \"history\" | Presentation | \"Presentation | | priv‑value | **_or | restricted | restricted\" | | component | "session" or | indicator | | | | "header"_** | | | +----------------+----------------+----------------+----------------+ | | Privacy header | | \"Presentation | | | field absent | | allowed\" or | | | | | absent | | | or \"none\" | | | +----------------+----------------+----------------+----------------+
Table 4.7.1.1.4: Mapping of hi-targeted-to-uri to ISUP Call Diversion
Information
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Call Diversion | Derived value | | header field | Component | Information | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | Privacy, | \"history\" | Notification | If the | | priv‑value | **_or | subscription | priv-value | | component | "session" or | options | \"history\" | | | "header"_** | | **_or | | | | | "session" or | | | | | "header"_** is | | | | | set for the | | | | | History-Info | | | | | header or to | | | | | the hist-info | | | | | element | | | | | entries | | | | | concerning the | | | | | redirecting | | | | | (see | | | | | ta | | | | | ble 4.7.1.2.2) | | | | | and diverted | | | | | to uri (see | | | | | ta | | | | | ble 4.7.1.1.2) | | | | | then | | | | | _presentation | | | | | not allowed_ | | | | | shall be set | | | | | | | | | | If the | | | | | priv-value | | | | | \"history\" | | | | | **_or | | | | | "session" or | | | | | "header"_** is | | | | | set only to | | | | | the hist-info | | | | | element | | | | | concerning the | | | | | diverted-to | | | | | uri then | | | | | _presentation | | | | | allowed | | | | | without | | | | | redirection | | | | | number shall | | | | | be set_ | +----------------+----------------+----------------+----------------+ | | Privacy header | | _Presentation | | | field absent | | allowed with | | | | | redirection | | | or \"none\" | | number_ | +----------------+----------------+----------------+----------------+ | hi-t | **cause-param | Call diversion |** Redirecting | | argeted-to-uri | value**| information | Reason** | | cause-param | | | | | URI parameter, | | | | | as defined in | | | | | RFC 4458 | | | | | [14] of the | | | | | last | | | | | History-Info | | | | | hi-entry | | | | | containing | | | | | such an a | | | | | cause-param. | | | | +----------------+----------------+----------------+----------------+ | | 404 | | Unknown | +----------------+----------------+----------------+----------------+ | | 302 | | Unconditional | +----------------+----------------+----------------+----------------+ | | 486 | | User busy | +----------------+----------------+----------------+----------------+ | | 408 | | No reply | +----------------+----------------+----------------+----------------+ | | 480 | | Deflection | | | | | immediate | +----------------+----------------+----------------+----------------+ | | 503 | | Mobile | | | | | subscriber not | | | | | reachable | +----------------+----------------+----------------+----------------+ | | 487 | | Deflection | | | | | during | | | | | alerting | +----------------+----------------+----------------+----------------+
Table 4.7.1.1.5: Void
Table 4.7.1.1.6: Mapping of 181 (Call Is Being Forwarded)  ACM if no ACM was
sent before
+----------------+----------------+----------------+----------------+ | Source SIP | Source | ISUP Parameter | Derived value | | header field | Component | | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | 181 (Call Is | | ACM | | | Being | | | | | Forwarded) | | | | +----------------+----------------+----------------+----------------+ | | | Generic | Call is | | | | notification | diverting | | | | indicators | | +----------------+----------------+----------------+----------------+ | History-Info | See table | Redirection | See table | | Header | 4.7.1.1.2 | number | 4.7.1.1.2 | +----------------+----------------+----------------+----------------+ | Priv-value | See table | Redirection | See table | | | 4.7.1.1.3 | number | 4.7.1.1.3 | | | | restriction | | +----------------+----------------+----------------+----------------+ | Priv-value | See table | Call diversion | See table | | | 4.7.1.1.4 | information | 4.7.1.1.4 | | | | _Notification | | | | | subscription | | | | | options_ | | +----------------+----------------+----------------+----------------+ | hi-ta | See table | Call diversion | **_Redirecting | | rgeted-to-uri; | 4.7.1.1.4 | information | Reason_** | | cause-param | | | | | URI parameter | | | See table | | as defined in | | | 4.7.1.1.4 | | IETF RFC | | | | | 4458[14] of | | | | | the last | | | | | History-Info | | | | | hi-entry | | | | | containing | | | | | such an a | | | | | cause-param. | | | | +----------------+----------------+----------------+----------------+
Table 4.7.1.1.7: Mapping of 181 (Call Is Being Forwarded) CPG if ACM was
already sent
* * *
Source SIP header field and component Source Component value ISUP Parameter
Derived value of parameter field 181 (Call Is Being Forwarded) CPG  
Generic notification indicators Call is diverting hi-targeted-to-uri; cause-
param URI parameter, as defined in IETF RFC 4458 [14] of the last History-Info
hi-entry containing such an a cause-param. 486 Event indicator CFB (national
use) 408 (see note) CFNR (national use) 302 CFU (national use) Any other
value, or if appropriate national use value CFB, CFNR or CFU is not used in a
network. or if no agreement exists between operators to use theses values, or
if no hi-targeted-to-uri cause-param URI parameter is contained in the SIP
181. PROGRESS History-Info Header See table 4.7.1.1.2 Redirection number See
table 4.7.1.1.2 Priv-value See table 4.7.1.1.3 Redirection number restriction
See table 4.7.1.1.3 Priv-value See table 4.7.1.1.4 Call diversion information
_Notification subscription options_ See table 4.7.1.1.4 hi-targeted-to-uri;
cause-param URI parameter, as defined in RFC 4458 [14] See table 4.7.1.1.4
Call diversion information _Redirecting Reason_ See table 4.7.1.1.4 NOTE: This
appears in the cases of CFNR.
* * *
Table 4.7.1.1.8: Mapping of 180 (Ringing)  ACM if no ACM was sent before
* * *
Source SIP header field and component Source Component value ISUP Parameter
Derived value of parameter field 180 (Ringing) ACM  
History Header If hi-targeted-to-uri of at least one History-Info hi-entry
contains a cause-param URI parameter, as defined in IETF RFC 4458 [113].
Generic notification indicators Call is diverting History Header See table
4.7.1.1.2 Redirection number (NOTE) See table 4.7.1.1.2 Priv-value See table
4.7.1.1.3 Redirection number restriction (NOTE) See table 4.7.1.1.3 Priv-value
See table 4.7.1.1.4 Call diversion information _Notification subscription
options (NOTE)_ See table 4.7.1.1.4 hi-targeted-to-uri; cause-param URI
parameter, as defined in IETF RFC 4458 [14] of the last History-Info hi-entry
containing such an a cause-param. See table 4.7.1.1.4 Call diversion
information _Redirecting Reason (NOTE)_ See table 4.7.1.1.4 NOTE: Parameter
shall only be supplied if hi-targeted-to-uri of at least one History-Info hi-
entry contains a cause-param URI parameter, as defined in IETF RFC 4458 [113].
* * *
The mapping described within table 4.7.1.1.1 can only appear if the
communication has already undergone a Call Forwarding in the ISDN/PSTN and the
180 is the first provisional response sent in backward direction.
The IWU can indicate the call diversion in the mapping of 180 (Ringing) to CPG
in fact if the response before was a 181 (Call Is Being Forwarded).
Table 4.7.1.1.9: Mapping of 180 (Ringing)  CPG if ACM was already sent
* * *
Source SIP header field and component Source Component value ISUP Parameter
Derived value of parameter field 180 (Ringing) CPG  
History-Info header field If hi-targeted-to-uri of at least one History-Info
hi-entry contains a cause-param URI parameter, as defined in IETF RFC 4458
[113]. Generic notification indicators Call is diverting Event indicator
ALERTING History Header See table 4.7.1.1.2 Redirection number (NOTE) See
table 4.7.1.1.2 Priv-value See table 4.7.1.1.3 Redirection number restriction
(NOTE) See table 4.7.1.1.3 Priv-value See table 4.7.1.1.4 Call diversion
information _Notification subscription options_ (NOTE) See table 4.7.1.1.4 hi-
targeted-to-uri; cause-param URI parameter, as defined in IETF RFC 4458 [14]
of the last History-Info hi-entry containing such an a cause-param. See table
4.7.1.1.4 Call diversion information _Redirecting Reason (NOTE)_ See table
4.7.1.1.4 NOTE: Parameter shall only be supplied if hi-targeted-to-uri of at
least one History-Info hi-entry contains a cause-param URI parameter, as
defined in IETF RFC 4458 [113].
* * *
The mapping in table **4.7.1.1. 9 appears when a 181 previously was mapped to
an ACM. Therefore the statemachine of the MGCF knows that a CDIV is in
Progress.**
Table 4.7.1.1.10: Mapping of 200 (OK) response
* * *
Source SIP header field and component Source Component value ISUP Parameter
Derived value of parameter field 200 (OK) response ANM/CON  
History-Info Header See table 4.7.1.1.2 Redirection number See table 4.7.1.1.2
Priv-value See table 4.7.1.1.3 Redirection number restriction See table
4.7.1.1.3
* * *
##### 4.7.1.1.1 Void
##### 4.7.1.1.2 Call forwarding within the ISUP Network appeared
The following Scenario shows if a Call Forwarding appears in the ISUP/PSTN
Network and the redirected Number is within the SIP Network. Table 4.7.1.1.2.1
should be seen as example.
For the mapping of 180 (Ringing) and 200 (OK) response OK to the regarding
ISUP messages and parameters no additional procedures beyond the basic call
procedures are needed.
To interwork the redirection number at the O-MGCF it can be needed to create
placeholder History entries. Such a History entry has to provide a hi-target-
to-uri with a placeholder value \"unknown\@unknown.invalid\" a cause-param and
a index as described within table 4.7.1.1.2.1.
Table 4.7.1.1.2.1: Mapping of IAM to SIP INVITE
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | or IE | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | IAM | | INVITE | | +----------------+----------------+----------------+----------------+ | Redirecting | | History Header | hi-t | | number | | | argeted-to-uri | | | | | of the | | | | | penultimate | | | | | created | | | | | hi-entry IF | | | | | Redirection | | | | | counter | | | | | exceeds 1 ELSE | | | | | no mapping | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | hi-t | Add CC (of the | | address | (significant) | argeted-to-uri | country where | | indicator: | number\"_ | | the MGCF is | | | | | located) to | | | | | Generic Number | | | | | Address | | | | | Signals then | | | | | map to user | | | | | portion of URI | | | | | scheme used. | | | | | | | | | | **Addr-spec** | | | | | | | | | | \"+\" CC NDC | | | | | SN mapped to | | | | | user portion | | | | | of URI scheme | | | | | used | +----------------+----------------+----------------+----------------+ | | _\ | | Map complete | | | "international | | Redirection | | | number\"_ | | number Address | | | | | Signals to | | | | | user portion | | | | | of URI scheme | | | | | used. | +----------------+----------------+----------------+----------------+ | Address | If NOA is | hi-t | \"+\" CC NDC | | Signals | \"_national | argeted-to-uri | SN mapped to | | | (significant) | | userinfo | | | number\"_ then | | portion of URI | | | the format of | | scheme used | | | the Address | | | | | Signals is: | | | | | | | | | | NDC + SN | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number\"_ | | | | | | | | | | then the | | | | | format of the | | | | | Address | | | | | Signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | Redirecting | APRI | Privacy Header | Priv-value | | number | | that | | | | | | | | | | corresponds to | | | | | the | | | | | penultimate | | | | | hi-t | | | | | argeted-to-uri | | | | | entry in the | | | | | History-Info | | | | | header | | +----------------+----------------+----------------+----------------+ | | \"presentation | | \"_History_ \" | | | restricted\" | | | +----------------+----------------+----------------+----------------+ | | \"presentation | | Privacy header | | | allowed\" | | field absent | | | | | or \"none\" | | | | | (NOTE 3) | +----------------+----------------+----------------+----------------+ | Redirection | Redirecting | Privacy Header | Priv-value | | Information | indicator | that | | | | | | | | | | corresponds to | | | | | the | | | | | penultimate | | | | | hi-t | | | | | argeted-to-uri | | | | | entry in the | | | | | History-Info | | | | | header | | +----------------+----------------+----------------+----------------+ | | Call diverted | | \"none\" (NOTE | | | | | 4) | +----------------+----------------+----------------+----------------+ | | Call diverted, | | \"_History_ \" | | | all | | | | | redirection | | | | | info | | | | | presentation | | | | | restricted | | | +----------------+----------------+----------------+----------------+ | Redirection | Redirection | History Index | Number of | | Information | counter | | diversions are | | | | | sown due to | | | 1 | | the number of | | | | | Index Entries | | | | | | | | | | Index for | | | | | original | | | | | called Party | | | | | Number = 1 | | | | | | | | | | Address | | | | | Signals (CdPN) | | | | | | | | | | Number = 1.1 | +----------------+----------------+----------------+----------------+ | | [ | []{.underline} | Index for | | | 2]{.underline} | | original | | | | | called Party | | | | | Number = 1 | | | | | | | | | | Index for | | | | | Redirecting | | | | | number | | | | | | | | | | with Index = | | | | | 1.1 | | | | | | | | | | Address | | | | | Signals (CdPN) | | | | | | | | | | Number = 1.1.1 | +----------------+----------------+----------------+----------------+ | | [ | []{.underline} | Index for | | | N]{.underline} | | original | | | | | called Party | | | | | Number = 1 | | | | | | | | | | Placeholder | | | | | History entry | | | | | with Index = | | | | | 1.1 | | | | | | | | | | ... | | | | | | | | | | Fill up | | | | | | | | | | ... | | | | | | | | | | Index for | | | | | Redirecting | | | | | Number | | | | | | | | | | with = | | | | | 1+[( | | | | | N-1)*\".1\"] | | | | | | | | | | Index for | | | | | Address | | | | | Signals (CdPN) | | | | | | | | | | = 1+N* \".1\" | | | | | (e.g. N=3  | | | | | 1.1.1.1) | +----------------+----------------+----------------+----------------+ | Redirection | **Redirecting | hi-ta |** Cause | | Information | Reason and**| rgeted-to-uri; | value** | | | | cause-param | | | | **Original | URI parameter, | | | | Redirection | as defined in | | | | Reason** | IETF RFC 4458 | | | | | [14] . The | | | | (NOTE 1) | Redirecting | | | | | Reason shall | | | | | be mapped to | | | | | the last | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | | | | | | If the | | | | | redirection | | | | | counter is 2 | | | | | or higher, the | | | | | Original | | | | | Redirection | | | | | Reason shall | | | | | be mapped to | | | | | the second | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | | | | | | If the | | | | | redirection | | | | | counter is 3 | | | | | or higher, for | | | | | each | | | | | hi-t | | | | | argeted-to-uri | | | | | following a | | | | | placeholder | | | | | History entry | | | | | the value | | | | | \"404\" shall | | | | | be taken (NOTE | | | | | 2) | | +----------------+----------------+----------------+----------------+ | | unknown | | 404 | +----------------+----------------+----------------+----------------+ | | unconditional | | 302 | +----------------+----------------+----------------+----------------+ | | User Busy | | 486 | +----------------+----------------+----------------+----------------+ | | No reply | | 408 | +----------------+----------------+----------------+----------------+ | | Deflection | | 487 | | | during | | | | | alerting | | | +----------------+----------------+----------------+----------------+ | | Deflection | | 480 | | | immediate | | | | | response | | | +----------------+----------------+----------------+----------------+ | | Mobile | | 503 | | | subscriber not | | | | | reachable | | | +----------------+----------------+----------------+----------------+ | Called Party | _See_ | History Header | URI of the | | Number | Redirecting | see | last | | | number | hi-t | hi-t | | | | argeted-to-uri | argeted-to-uri | | | | | entry of | | | | | History Header | +----------------+----------------+----------------+----------------+ | Original | _See_ | History Header | URI of first | | Called Party | Redirecting | see | hi-target | | Number | number | hi-t | ed-to-urientry | | | | argeted-to-uri | of History | | | | | Header | +----------------+----------------+----------------+----------------+ | Original | APRI | Privacy Header | Priv-value | | Called Party | | | | | Number | | | | +----------------+----------------+----------------+----------------+ | | \"presentation | | \"_history_ \" | | | restricted\" | | | +----------------+----------------+----------------+----------------+ | | \"presentation | | \"_none_ \" | | | allowed\" | | | +----------------+----------------+----------------+----------------+ | NOTE 1: | | | | | Original | | | | | Redirection | | | | | Reason | | | | | contains only | | | | | the | | | | | \"unknown\" | | | | | parameter. | | | | | | | | | | NOTE 2: For | | | | | all History | | | | | entries except | | | | | the first one | | | | | a cause-param | | | | | URI parameter | | | | | as defined in | | | | | RFC 4458 | | | | | [14] has to | | | | | be included. | | | | | | | | | | NOTE 3: If the | | | | | Redirecting | | | | | Indicator has | | | | | the value | | | | | \"Call | | | | | diverted, all | | | | | redirection | | | | | info | | | | | presentation | | | | | restricted\", | | | | | the privacy | | | | | value | | | | | \"history\" | | | | | shall be set. | | | | | | | | | | NOTE 4: If the | | | | | Redirecting | | | | | Number APRI | | | | | has the value | | | | | \"presentation | | | | | restricted\", | | | | | the privacy | | | | | value | | | | | \"history\" | | | | | shall be set. | | | | +----------------+----------------+----------------+----------------+
#### 4.7.1.2 Interworking at the I-MGCF
Table 4.7.1.2.1: Mapping of SIP to ISUP messages
* * *
Message received from SIP Message send to BICC/ISUP INVITE IAM
* * *
Table 4.7.1.2.2: Mapping of History-Info Header to ISUP Redirecting number
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Redirecting | Derived value | | header field | Component | number | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | In | | Redirecting | | | History-Info | | number | | | SIP header | | | | | field, | | | | | hi-t | | | | | argeted-to-uri | | | | | in hi-entry | | | | | before last | | | | | hi-entry | | | | | containing a | | | | | cause-param | | | | | URI parameter | | | | | as defined in | | | | | IETF RFC 4458 | | | | | [14] | | | | | (NOTE 1) | | | | +----------------+----------------+----------------+----------------+ | Hi | CC | Nature of | If CC is equal | | -target-to-uri | | address | to the country | | | | indicator | code of the | | appropriate | | | country where | | global number | | | MGCF is | | portion of the | | | located AND | | URI, assumed | | | the next ISUP | | to be in form\ | | | node is | | \"+\" CC + NDC | | | located in the | | + SN | | | same country, | | | | | then set to | | | | | \"national | | | | | (significant) | | | | | number\" else | | | | | set to | | | | | \ | | | | | "international | | | | | number\" | +----------------+----------------+----------------+----------------+ | | CC, NDC, SN | Address | If NOA is | | | | signals | \"national | | | | | (significant) | | | | | number\" then | | | | | set to\ | | | | | NDC + SN. | | | | | | | | | | If NOA is | | | | | \ | | | | | "international | | | | | number\" | | | | | | | | | | then set to CC | | | | | + NDC + SN | +----------------+----------------+----------------+----------------+ | Privacy Header | \"history\" | APRI | \"presentation | | , priv‑value | **_or | | restricted\" | | component | "session" or | | | | | "header"_** | | | | In | | | | | History-Info | | | | | header field | | | | | as specified | | | | | in this table | | | | | (NOTE 2) | | | | +----------------+----------------+----------------+----------------+ | | Privacy header | | \"presentation | | | field absent | | allowed\" | | | or \"none\" | | | +----------------+----------------+----------------+----------------+ | NOTE 1: If it | | | | | is SIP URI and | | | | | doesn't | | | | | contain | | | | | "user=phone", | | | | | mapping to | | | | | redirecting | | | | | number is | | | | | impossible, | | | | | therefore no | | | | | need to | | | | | generate | | | | | Redirecting | | | | | number. | | | | | | | | | | NOTE 2: It is | | | | | possible that | | | | | an entry of | | | | | the In | | | | | History-Info | | | | | header field | | | | | itself is | | | | | marked as | | | | | restricted or | | | | | the whole | | | | | History | | | | | header. | | | | +----------------+----------------+----------------+----------------+
Table 4.7.1.2.3: Mapping of History-Info Header to ISUP Redirection
Information
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Redirection | Derived value | | header field | Component | Information | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | Privacy header | **_\ | Redirecting |_ Call | | field and | "**history**\" | indicator | diverted, all | | priv‑value of | or "session" | | redirection | | hi-entry | or "header"**_| | info | | before the | | | presentation | | last hi-entry | for the | | restricted_ | | containing a | Privacy header | | | | cause-param | field or for | | | | URI parameter | the | | | | as defined in | hi-t | | | | IETF RFC 4458 | argeted-to-uri | | | | [14] of the | entry | | | | History Info | | | | | header field. | | | | +----------------+----------------+----------------+----------------+ | | Privacy header | | _Call | | | field and the | | diverted_ | | | privacy | | | | | component of | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | entry either | | | | | absent | | | | | | | | | | or | | | | | | | | | | \"_none_ | | | +----------------+----------------+----------------+----------------+ | | | Original | _Unknown_ | | | | redirection | | | | | reason | | +----------------+----------------+----------------+----------------+ | Cause-param | **cause-param | Redirecting |**_Redirecting | | value in the | value_ _| Reason | Reason_ ** | | last | | | | | hi-t | | | | | argeted-to-uri | | | | | containing a | | | | | cause-param | | | | | URI parameter, | | | | | as defined in | | | | | IETF RFC 4458 | | | | | [14] | | | | +----------------+----------------+----------------+----------------+ | | 404 | | Unknown/not | | | | | available | +----------------+----------------+----------------+----------------+ | | 302 | | Unconditional | +----------------+----------------+----------------+----------------+ | | 486 | | User busy | +----------------+----------------+----------------+----------------+ | | 408 | | No reply | +----------------+----------------+----------------+----------------+ | | 480 | | Deflection | | | | | immediate | | | | | response | +----------------+----------------+----------------+----------------+ | | 487 | | Deflection | | | | | during | | | | | alerting | +----------------+----------------+----------------+----------------+ | | 503 | | Mobile | | | | | subscriber not | | | | | reachable | +----------------+----------------+----------------+----------------+ | Hi-index | | Redirection | number of | | | | counter | History | | | | | entries | | | | | containing a | | | | | cause-param | | | | | with cause as | | | | | listed in the | | | | | cause-param | | | | | row in this | | | | | table | +----------------+----------------+----------------+----------------+
Table 4.7.1.2.4: Mapping of History-Info Header to ISUP Original Called number
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Original | Derived value | | header field | Component | called number | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | | | Numbering Plan | \"_ISDN | | | | Indicator | (Telephony) | | | | | numbering plan | | | | | ( | | | | | Recommendation | | | | | E.164)_ \" | +----------------+----------------+----------------+----------------+ | Hi | CC | Nature of | If CC is equal | | -target-to-uri | | address | to the country | | of hi-entry | | indicator | code of the | | preceding the | | | country where | | 1st | | | MGCF is | | hi-t | | | located AND | | argeted-to-uri | | | the next ISUP | | containing a | | | node is | | cause-param | | | located in the | | URI parameter, | | | same country, | | as defined in | | | then set to | | IETF RFC 4458 | | | \"national | | [14]; the | | | (significant) | | | | | number\" else | | global number | | | set to | | portion of the | | | \ | | URI is assumed | | | "international | | to be in form\ | | | number\" | | \"+\" CC + NDC | | | | | + SN (NOTE 2) | | | | +----------------+----------------+----------------+----------------+ | | CC, NDC, SN | Address | If NOA is | | | | signals | \"national | | | | | (significant) | | | | | number\" then | | | | | set to\ | | | | | NDC + SN. | | | | | | | | | | If NOA is | | | | | \ | | | | | "international | | | | | number\" | | | | | | | | | | then set to CC | | | | | + NDC + SN | +----------------+----------------+----------------+----------------+ | priv‑value | \"history\" or | APRI | \"presentation | | component | "session" or | | restricted\" | | | "header" | | | | in | | | | | History-Info | | | | | header field | | | | | of the | | | | | History-Info | | | | | header field | | | | | entry as | | | | | defined above | | | | | in this table | | | | | (Note 1) | | | | +----------------+----------------+----------------+----------------+ | | Privacy header | | \"presentation | | | field absent | | allowed\" | | | or \"none\" | | | +----------------+----------------+----------------+----------------+ | NOTE 1: It is | | | | | possible that | | | | | an entry of | | | | | the | | | | | History-Info | | | | | header field | | | | | itself is | | | | | marked as | | | | | restricted or | | | | | the whole | | | | | History-Info | | | | | header. | | | | | | | | | | NOTE 2: If it | | | | | is SIP URI and | | | | | doesn't | | | | | contain | | | | | "user=phone", | | | | | mapping to | | | | | Original | | | | | Called number | | | | | is impossible, | | | | | therefore no | | | | | need to | | | | | generate | | | | | Original | | | | | Called number. | | | | +----------------+----------------+----------------+----------------+
Table 4.7.1.2.5: Mapping of INVITE to IAM
* * *
INVITE IAM  
History Header See table 4.7.1.2.2 Redirecting number _See table 4.7.1.2.2_
History-Info Header See table 4.7.1.2.3 Redirection Information See table
4.7.1.2.3 cause-param in the last hi-targeted-to-uri containing a cause-param
as defined in IETF RFC 4458 [14]cause-param **cause-param value** Redirection
Information **_Redirecting Reason_** 404 Unknown/not available 302
Unconditional 486 User busy 408 No reply 480 Deflection immediate response 487
Deflection during alerting 503 Mobile subscriber not reachable History-Infoh
eader field See table 4.7.1.2.4 Original Called Number _See_ table 4.7.1.2.4
* * *
Table 4.7.1.2.6: Mapping of ISUP to SIP Massages
* * *
←Message sent to SIP ←Message Received from BICC/ISUP  
181 (Being forwarded) ACM no indication with Redirection number and call
diversion information (CFU, CFB, CDi) See table 4.7.1.2.8 180 (Ringing) ACM
indicating ringing, oBCi: Call diversion may occur (CFNR, CDa) Basic call
procedure as described within ES 283 027 [13] 181 (Being forwarded) CPG
indicating progress or subsequent diversion indicated in the CPG with
Redirection number and call diversion information (CFNR, CDa) See table
4.7.1.2.9 180 (Ringing) CPG indicating ringing and Redirection number
restriction parameter See table 4.7.1.2.10 200 (OK) ANM and Redirection number
restriction parameter See table 4.7.1.2.11
* * *
In the ISUP destination Exchange of the diverted-to user (see EN 300 356-15
[10]) only the Redirection Number Restriction parameter will be included into
the ACM, CPG, ANM or CON message. Therefore only the mapping of this parameter
is shown in the following table.
Table 4.7.1.2.7: Mapping of ISUP Redirection Number Restriction to History-
Info header field
+----------------+----------------+---------------+----------------+ | Redirection | Derived value | SIP component | Value | | Number | of parameter | | | | Restriction | field | | | +----------------+----------------+---------------+----------------+ | Presentation | | | | | restricted | | | | | indicator | | | | +----------------+----------------+---------------+----------------+ | | \"Presentation | | \"History\" | | | restricted\" | | | +----------------+----------------+---------------+----------------+ | | \"Presentation | | Privacy header | | | allowed\" or | | field absent | | | absent AND any | | | | | previous | | or | | | received | | | | | notification | | \"none\" | | | subscription | | | | | option was NOT | | | | | \"presentation | | | | | not allowed\" | | | | | OR was NOT | | | | | \"presentation | | | | | allowed | | | | | without | | | | | redirection | | | | | number\" | | | +----------------+----------------+---------------+----------------+
A received CPG shall be mapped t a 180 (Ringing) if the CPC indicates a
Alerting is due to the mapping rules defined within the basic call.
Table 4.7.1.2.8: Mapping of ACM  181 (Call Is Being Forwarded)
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | Generic | Call is | | | | notification | diverting | | | | indicators | | | | +----------------+----------------+----------------+----------------+ | Redirection | | History-Info | hi-ta | | number | | Header with | rgeted-to-uri: | | | | one hi-entry | | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | hi-t | Add CC (of the | | address | (significant) | argeted-to-uri | country where | | indicator: | number\"_ | | the MGCF is | | | | | located) to | | | | | Redirection | | | | | number Address | | | | | Signals then | | | | | map to user | | | | | portion of URI | | | | | scheme used. | | | | | | | | | | **Addr-spec** | | | | | | | | | | \"+\" CC NDC | | | | | SN mapped to | | | | | user portion | | | | | of URI scheme | | | | | used | | | | | | | | | | according to | | | | | the rules of | | | | | clause | | | | | 4.5.2.6.4 item | | | | | c | +----------------+----------------+----------------+----------------+ | | _\ | | Map complete | | | "international | | Redirection | | | number\"_ | | number Address | | | | | Signals to | | | | | user portion | | | | | of URI scheme | | | | | used | | | | | | | | | | according to | | | | | the rules of | | | | | clause | | | | | 4.5.2.6.4 item | | | | | c | +----------------+----------------+----------------+----------------+ | Address | If NOA is | hi-t | \"+\" CC NDC | | Signals | \"_national | argeted-to-uri | SN mapped to | | | (significant) | | userinfo | | | number\"_ then | | portion of URI | | | the format of | | scheme used | | | the Address | | | | | Signals is: | | | | | | | | | | NDC + SN | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number\"_ | | | | | | | | | | then the | | | | | format of the | | | | | Address | | | | | Signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | Call diversion | _Redirecting | IETF RFC 4458 |__cause-param | | information | Reason_ | [14] | value**| | | | cause-param | | | | | URI parameter | | | | | hi-t | | | | | argeted-to-uri | | | | | entry (NOTE) | | +----------------+----------------+----------------+----------------+ | | Unknown/not | |** 404**| | | available | | | +----------------+----------------+----------------+----------------+ | | Unconditional | |** 302**| +----------------+----------------+----------------+----------------+ | | User busy | |** 486**| +----------------+----------------+----------------+----------------+ | | No reply | |** 408**| +----------------+----------------+----------------+----------------+ | | Deflection | |** 4**80 | | | immediate | | | | | response | | | +----------------+----------------+----------------+----------------+ | | Deflection | | 487 | | | during | | | | | alerting | | | +----------------+----------------+----------------+----------------+ | | Mobile | | 503 | | | subscriber not | | | | | reachable | | | +----------------+----------------+----------------+----------------+ | |_Notification | Privacy | Roles | | | subscription | | | | | option_ | | | +----------------+----------------+----------------+----------------+ | | unknown | | Escaped | | | | | Privacy value | | | | | is set | | | | | according to | | | | | the rules of | | | | | clause | | | | | 4.5.2.6.4 item | | | | | c | +----------------+----------------+----------------+----------------+ | | presentation | | A 181 Being | | | not allowed | | Forwarded | | | | | shall **not** | | | | | be sent | +----------------+----------------+----------------+----------------+ | | presentation | | Escaped | | | allowed with | | Privacy value | | | redirection | | is set | | | number | | according to | | | | | the rules of | | | | | clause | | | | | 4.5.2.6.4 item | | | | | c | +----------------+----------------+----------------+----------------+ | | presentation | | Escaped | | | allowed | | Privacy value | | | without | | is set | | | redirection | | according to | | | number | | the rules of | | | | | clause | | | | | 4.5.2.6.4 item | | | | | c | +----------------+----------------+----------------+----------------+ | NOTE: Needs to | | | | | be stored for | | | | | a possible | | | | | inclusion into | | | | | subsequent | | | | | messages. | | | | +----------------+----------------+----------------+----------------+
Table 4.7.1.2.9: Mapping of CPG  181 (Call Is Being Forwarded)
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | Event | Progress | | | | Indicator | | | | +----------------+----------------+----------------+----------------+ | Generic | Call is | | | | notification | diverting | | | | indicators | | | | +----------------+----------------+----------------+----------------+ | Redirection | | History-Info | hi-ta | | number | | Header | rgeted-to-uri: | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | hi-t | Add CC (of the | | address | (significant) | argeted-to-uri | country where | | indicator | number\"_ | field with one | the MGCF is | | | | hi-entry | located) to | | | | | Redirection | | | | | number Address | | | | | Signals then | | | | | map to user | | | | | portion of URI | | | | | scheme used. | | | | | | | | | | **Addr-spec** | | | | | | | | | | \"+\" CC NDC | | | | | SN mapped to | | | | | user portion | | | | | of URI scheme | | | | | used | | | | | | | | | | according to | | | | | the rules of | | | | | clause | | | | | 4.5.2.6.4 item | | | | | c | +----------------+----------------+----------------+----------------+ | | _\ | hi-t | Map complete | | | "international | argeted-to-uri | Redirection | | | number\"_ | | number Address | | | | | Signals to | | | | | user portion | | | | | of URI scheme | | | | | used | | | | | | | | | | according to | | | | | the rules of | | | | | clause | | | | | 4.5.2.6.4 item | | | | | c | +----------------+----------------+----------------+----------------+ | Address | If NOA is | hi-t | \"+\" CC NDC | | Signals | \"_national | argeted-to-uri | SN mapped to | | | (significant) | | userinfo | | | number\"_ then | | portion of URI | | | the format of | | scheme used | | | the Address | | | | | Signals is: | | | | | | | | | | NDC + SN | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number\"_ | | | | | | | | | | then the | | | | | format of the | | | | | Address | | | | | Signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | Call diversion | _Redirecting | IETF RFC 4458 |__cause param | | information | Reason_ | [14] | value**| | | | cause-param in | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | (NOTE) | | +----------------+----------------+----------------+----------------+ | | Unknown/not | |** 404**| | | available | | | +----------------+----------------+----------------+----------------+ | | Unconditional | |** 302**| +----------------+----------------+----------------+----------------+ | | User busy | |** 486**| +----------------+----------------+----------------+----------------+ | | No reply | |** 408**| +----------------+----------------+----------------+----------------+ | | Deflection | |** 4**80 | | | immediate | | | | | response | | | +----------------+----------------+----------------+----------------+ | | Deflection | | 487 | | | during | | | | | alerting | | | +----------------+----------------+----------------+----------------+ | | Mobile | | 503 | | | subscriber not | | | | | reachable | | | +----------------+----------------+----------------+----------------+ | |_Notification | Privacy | Roles | | | subscription | | | | | option_ | | | +----------------+----------------+----------------+----------------+ | | unknown | | Escaped | | | | | Privacy value | | | | | is set | | | | | according to | | | | | the rules of | | | | | clause | | | | | 4.5.2.6.4 item | | | | | c | +----------------+----------------+----------------+----------------+ | | presentation | | A 181 Being | | | not allowed | | Forwarded | | | | | shall **not** | | | | | be sent | +----------------+----------------+----------------+----------------+ | | presentation | | Escaped | | | allowed with | | Privacy value | | | redirection | | is set | | | number | | according to | | | | | the rules of | | | | | clause | | | | | 4.5.2.6.4 item | | | | | c | +----------------+----------------+----------------+----------------+ | | presentation | | Escaped | | | allowed | | Privacy value | | | without | | is set | | | redirection | | according to | | | number | | the rules of | | | | | clause | | | | | 4.5.2.6.4 item | | | | | c | +----------------+----------------+----------------+----------------+ | NOTE: Needs to | | | | | be stored for | | | | | a possible | | | | | inclusion into | | | | | subsequent | | | | | messages. | | | | +----------------+----------------+----------------+----------------+
Table 4.7.1.2.10: Mapping of CPG  180 (Ringing)
* * *
ISUP Parameter Derived value of parameter field SIP component Value Event
Indicator Alerting  
Redirection number History-Info Header with one hi-entry See table 4.7.1.2.8
                                                                      RFC 4458 \[14\] cause-param in the hi-targeted-to-uri   Value stored from a previous received ACM or CPG. See table 4.7.1.2.8 and 4.7.1.2.9.
Redirection number restriction **See table 4.7.1.2.7**
* * *
Table 4.7.1.2.11: Mapping of ANM  200 OK (INVITE)
* * *
ISUP Parameter Derived value of parameter field SIP component Value
Redirection number History-Info Header with one hi-entry See table 4.7.1.2.8
RFC 4458 [14] cause-param URI parameter in the hi-targeted-to-uri cause value=
as stored from a previous received the ACM or CPG. See tables 4.7.1.2.8 and
4.7.1.2.9. Redirection number restriction See table 4.7.1.2.7
* * *
### 4.7.2 Interworking with PSTN/ISDN Emulation
The Interworking with PSTN/ISDN Emulation is for further study.
### 4.7.3 Interworking with external IP networks
For SIP based networks the procedures used shall be compliant with **ES 283
003 [** 2**]**.
The interworking with non SIP networks is for further study.
## 4.8 Parameter values (timers)
### 4.8.1 No reply timer
**No reply timer:** Timer duration shall be a service provider option.
### 4.8.2 Void
### 4.8.3 CDIV Indication Timer
T~CDIV_IND~ 60 sec - 00 sec.
The timer is started when the diverting user is registering to the
communication system. Based on operator policy the user has the possibility to
choose a certain timer value within the defined range.
## 4.9 Service Configuration for redirection services
### 4.9.1 Structure of the XML Document
Communication Diversion documents are subtrees of the _simservs_ document
specified in TS 183 023 [4]. As such, Communication Diversion documents use
the XCAP application usage in TS 183 023 [4].
In addition to the considerations and constraints defined by the _simservs_
document TS 183 023 [4], we define the additional constraints and
considerations for the Communication Diversion subtree:
**XML schema:** Implementations in compliance with the present document shall
implement the XML schema that minimally includes the XML Schema defined in
clause 4.9.2 and the _simservs_ XML schema specified in clause 6.3 of TS 183
023 [4].
**Data semantics:** The semantics of the communication diversion XML
configuration document is specified in clause 4.9.1.
An instance of the simulation services configuration containing a
communication diversion configuration document.
\
\
\
_rule set_
\
\
The communication diversion service contains a rule set that specifies how the
communication diversion service shall react to external stimuli.
#### 4.9.1.1 Communication Diversion Element
The communication diversion configuration contains a noReplyTimer element, a
rule set, or a noReplyTimer element followed by a rule set. The rule set
reuses the syntax as specified by the common policy draft (see RFC 4745 [18]).
\
\_NoReplyTimerValue_ \
\
_rule1_
_rule2_
\
\
In general the following procedure applies:
When the service processes a set of rules it shall start executing the first
rule. If:
\- the rule has no \ element;
\- the rule has an empty \ element; or
\- conditions are present and they all evaluate to true;
then the rule matches and the specified action shall be executed.
When the rule does not match the following rule shall be selected and the same
procedure repeated, until a matching rule is found or the set of remaining
rules is empty.
However not all rules can be matched at the same moment in the call. Some
conditions imply that rules that carry them are checked at specific events in
the call, for example the no-answer condition only holds when the called party
does not answer after a while. In this case the same procedure shall apply as
above with the modification that the set of rules to process contains only the
rules applicable for that specific network event.
In clause 4.9.1.3 all allowed conditions are specified, normally rules are
evaluated at communication setup time, for conditions where this is not the
case this is explicitly indicated.
The shown \"active\" attribute is inherited from the simservType from TS 183
023 [4], its meaning is also specified in TS 183 023 [4].
#### 4.9.1.1A NoReplyTimer
NoReplyTimer: An optional element that covers the time to elapse until the
communication diversion shall perform, if the served user does not answer when
alerted.
#### 4.9.1.2 Communication Diversion Rules
The Communication Diversion service is configured with an ordered set of
forwarding rules. The XML Schema reuses the rule syntax as specified by the
common policy draft (see RFC 4745 [18]). The rules take the following form:
\
\
_condition1_
_condition2_
\
\
\
\
_targetAddress1_
\
\true\
\
\
\
When the service processes a set of rules it shall start executing the first
rule. If:
\- the rule has no \ element;
\- the rule has an empty \ element; or
\- conditions are present and they all evaluate to true;
then the rule matches and the specified action is executed. When a rule
matches remaining rules in the rule set shall be discarded. Applied to the
fragment above this means that only if the expression (_condition1_ AND
_condition2_) evaluates to true that then the _rule66_ matches and the
forward-to action is executed.
When the rule does not match the following rule shall be selected and the same
procedure repeated, until a matching rule is found or the set of remaining
rules is empty.
The \"id\" attribute value of a rule shall uniquely identify the rule within a
rule set. This can be used in XCAP usage to address one specific rule.
#### 4.9.1.3 Communication Diversion Rule Conditions
The following conditions are allowed by the XML Schema for the communication
diversion service:
**busy:** This condition evaluates to true when the called user is busy. In
all other cases the condition evaluates to false. Rules with this condition
are evaluated when a busy indication is received from the called party.
**not-registered:** This condition evaluates to true when the called user is
not registered. In all other cases the condition evaluates to false.
**presence-status:** This condition evaluates to true when the called user\'s
current presence activity status is equal to the value set for this condition.
In all other cases the condition evaluates to false.
**cp:identity:** This condition evaluates to true when the _calling_ user\'s
identity matches with the value of the identity element. The interpretation of
all the elements of this condition is described in OMA-TS-XDM-Core-V1_1 [20].
In all other cases the condition evaluates to false. The Identity shall be
matched against the value taken from the P-Asserted-Identity header field,
unless both the \ element value and the Contact header field value
contain a \"gr\" parameter, then the \ element value shall be
matched against the value taken from the Contact header field.
**anonymous:** This condition evaluates to true when the P-Asserted-Identity
of the calling user is not provided or privacy restricted.
**cp:sphere:** Not applicable in the context of the Communication Diversion
service.
**cp:validity:** Specifies a period. The condition evaluates to true when the
current time is within the validity period expressed by the value of this
condition. In all other cases the condition evaluates to false.
**media:** When the incoming call request for certain media, the forwarding
rule can decide to forward the call for this specific media. This condition
evaluates to true when the value of this condition matches the media field in
one of the \"m=\" lines in the SDP (RFC 2327 [5]) offered in an INVITE (RFC
3261 [6]).
**no-answer:** This condition evaluates to true when the called user does not
answer. In all other cases the condition evaluates to false. Rules with this
condition are evaluated when a no-answer timeout is detected.
**rule-deactivated:** This condition always evaluates to false. This can be
used to deactivate a rule, without loosing information. By removing this
condition the rule can be activated again.
**ocp:external-list:** This condition evaluates to true when the calling users
identity is contained in an external resource list to which the value of
external-list refers. The exact interpretation of this element is specified
in\ OMA-TS-XDM-Core-V1_1 [20] (see bibliography).
**ocp:other-identity:** Not applicable in the context of communication
diversion service.
**not-reachable:** This condition evaluates to true when there is a signalling
channel outage during session setup to the served user\'s UE and the served
user is registered. In all other cases this condition evaluates to false.
NOTE: As described in RFC 4745 [18] the case of unconditional evaluates to be
true in all cases where all other reasons are not applicable. A communication
diversion is performed as soon as the served user is the called user. The
indication of unconditional is the absence of any reason element in the
ss:condition element.
The condition elements that are not taken from the common policy schema (see
RFC 4745 [18]) or oma common policy schema (see OMA-TS-XDM-Core-V1_1 [20] in
bibliography) are defined in the simservs document schema specified in 3GPP TS
183 023 [4].
#### 4.9.1.4 Communication Diversion Rule Actions
The action supported by the communication service is forwarding of calls. For
this the forward-to action has been defined. The forward-to action takes the
following elements:
**target:** Specifies the address of the forwarding rule. It should be a SIP
URI or SIPS (RFC 3261 [6]), TEL URL\ (RFC 3966 [7]).
**notify-caller:** An optional element that can be used to disable the default
behaviour that the caller is notified that the call is being forwarded (see
subscription option \"_Originating_ user receives notification that his
communication has been diverted (forwarded or deflected)\" in table 4.3.1.1).
**reveal-served-user-identity-to-caller:** An optional element that can be
used to disable the default behaviour that the caller, when notified that the
call is being forwarded, receives the _diverting_ party\'s identity
information (see subscription option \"Served user allows the presentation of
his/her URI to _originating_ user in diversion notification\" in table
4.3.1.1).
**reveal-identity-to-caller:** An optional element that can be used to disable
the default behaviour that the caller, when notified that the call is being
forwarded, receives some diverted-to party\'s identity information (see
subscription option \"Served user allows the presentation of forwarded to URI
to _originating_ user in diversion notification\" in table 4.3.1.1).
**notify-served-user:** An optional element that can be used to enable that
the served user is indicated that calls are being forwarded. Default this is
switched off (see subscription option \"_Served user_ receives notification
that a communication has been forwarded\" in table 4.3.1.1).
**notify-served-user-on-outbound-call:** An optional element that can be used
to enable that the served user is notified that calls are being forwarded when
he makes a call attempt. Default this is switched off (see subscription option
\"Served user receives reminder notification on outgoing communication that
forwarding is currently activated\" in table 4.3.1.1).
**reveal-identity-to-target:** An optional element that can be used to disable
the default behaviour that the diverted-to party receives some identity
information of the diverting party (see subscription option \"Served user
allows the presentation of his/her URI to _diverted‑to_ user\" in table
4.3.1.1).
### 4.9.2 XML Schema
\
\
\
\
\
\
\
\
\
\
\This is the communication diversion configuration
document.\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\ \
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
## 4.10 Void
###### ## Annex A (informative): Signalling Flows
# A.1 Normal cases
## A.1.1 Communication Forwarding unconditional
{width="6.691666666666666in" height="6.572222222222222in"}
Figure A.1: CFU AS based normal case
User B has activated the CFU service.
User A is sending a communication request towards User B:
> 1 to 2) Initial INVITE request towards User B. The URI-B is subscribed to
> the CFU service.
>
> 3 to 4) The based on the IFC the INVITE is forwarded to the AS.
>
> 5) Procedures for CFU are executed.
>
> 6 to 8) A 181 may be send towards the User A indicating that the
> communication is diverted.
>
> 9) A Invite including URI-C as destination is sent back to the S-CSCF.
> Additional the History-Info header is included.\ History-Info:
> \;index=1,\
> \index=1.1.
>
> 10) S-CSCF looks up to the HSS to identify the location of User-C.
>
> 11 to 12) The communication is routed towards User-C.
>
> 13 to 18) The 200 OK is sent Back to the User-A.
>
> 19 to 24) The ACK is send back to User-B.
>
> 25) RTP media is established.
## A.1.2 Communication Deflection
The flow below describes the Immediate CD feature the only difference compared
to a regular CD is that in the regular CD case the \"302 (Moved Temporarily)
Moved Temporarily\" is preceded by a \"180 (Ringing) Ringing\".
{width="6.691666666666666in" height="6.457638888888889in"}
Figure A.2a
{width="6.691666666666666in" height="6.441666666666666in"}
Figure A.2b
User B has activated the CD service.
User A is sending a communication request towards User B:
> 1 to 2) Initial INVITE request towards User B. The URI-B is subscribed to
> the CFU service.
>
> 2a to 3) The based on the IFC the INVITE is forwarded to the AS.
>
> 4 to 7) The INVITE is forwarded to User B due to normal communication
> procedures.
>
> 8 to 10) A 302 with a contact header including the URI of the forwarded to
> user is end back to the AS.
>
> 11) The CD logic is executed.
>
> 12 to 14) A 181 may be send towards the User A indicating that the
> communication is diverted.
>
> 15 to 18) A Invite including URI-C as destination is sent back to the
> S-CSCF. Additional the History-Info header is included.\ History-Info:
> \;index=1,\
> \index=2.
>
> 19 to 24) A 180 is sent back to the originating user including a History-
> Info header as shown above. If no restriction is given the diverted to user
> will be presented at the UE of user A.
>
> 25 to 30) The 200 OK is sent Back to the User-A.
>
> 31 to 36) The ACK is send back to User-B.
>
> 37) RTP media is established.
## A.1.3 Communication Forwarding on non Reply
{width="6.684027777777778in" height="7.371527777777778in"}
Figure A.3a
{width="6.691666666666666in" height="6.457638888888889in"}
Figure A.3b
User B has activated the CFNR service.
User A is sending a communication request towards User B:
> 1 to 2) Initial INVITE request towards User B. The URI-B is subscribed to
> the CFU service.
>
> 3) The based on the IFC the INVITE is forwarded to the AS.
>
> 4) The INVITE is forwarded to User B due to normal communication procedures.
>
> 5) The non-reply timer in the AS is started.
>
> 6 to 7) The INVITE is forwarded to User B due to normal communication
> procedures.
>
> 8 to 14) A 180 is sent back to the originating user indicating that the
> terminating UE is ringing.
>
> 15) The timer expires.
>
> 16 to 18) A 181 may be send towards the User A indicating that the
> communication is diverted.
>
> 19 to 21) To release the communication to User B the AS sends a CANCEL.
>
> 22 to 27) A 487 response with a ACK finalize the termination of the dialog
> between AS and UE:B.
>
> 28 to 31) A INVITE including URI-C as destination is sent back towards the
> UE:C. Additional the History-Info header is included.\ History-Info:
> \;index=1,\ \ User-B%40example.com;cause=408> index=1.1.
>
> 32 to 34) The 200 OK for the CANCKE is sent Back to the User-A.
>
> 35 to 40) A 180 is sent back to the originating user including a History-
> Info header as shown above. If no restriction is given the diverted to user
> will be presented at the UE of User A.
>
> 41 to 46) The 200 OK is sent Back to the User-A.
>
> 47 to 52 ) The ACK is send back to User-B.
>
> 53) RTP media is established.
## A.1.4 Communication Forwarding on Busy
{width="6.691666666666666in" height="7.1125in"}
Figure A.4a
{width="6.691666666666666in" height="7.045833333333333in"}
Figure A.4b
## A.1.5 Communication Forwarding Not Logged-in (CFNL)
{width="6.691666666666666in" height="6.525in"}
Figure A.5
## A.1.6 Void
# A.2 Interworking
## A.2.1 Communication Forwarding unconditional
{width="4.979861111111111in" height="4.754861111111111in"}
Figure A.6b: Call Forwarding Unconditional
## A.2.2 Communication Deflection
{width="6.692361111111111in" height="5.0055555555555555in"}
Figure A.7
###### ## Annex B (informative): Example of filter criteria
This annex provides an example of a filter criterion that triggers SIP
requests that are subject to initial filter criteria evaluation.
An example of an IFC when the CDIV simulation service is active at the
diverting S-CSCF is:
\- Method: INVITE.
###### ## Annex C (informative): Coding considerations
This annex provides an interpretation of the coding of the cause-param URI
parameter specified in RFC 4458 [14]
The cause specified in RFC 4458 [14] has the following syntax:
cause-param = \"cause\" EQUAL Status-Code
The Status-Code is originally specified in RFC 3261 [6] as a sequence of 3
digits. It is noted that the Status-Code simply indicates that it is composed
of 3 digits, without indicating the list of possible values. In particular,
Status-Code is not bound to and must not be confused with the 3 digit numbers
defined for SIP responses in RFC 3261 [6]. The Status-Code is used to hold the
redirecting reason.
For the purpose of legibility, the cause-param specified in RFC 4458 [14] is
interpreted according to the following syntax:
cause-param = \"cause\" EQUAL Status-Code
Status-Code = \"404\" ; Unknown/Not available
/ \"486\" ; User Busy
/ \"408\" ; No Reply
/ \"302\" ; Unconditional
/ \"487\" ; Deflection during alerting
/ \"480\" ; Deflection during immediate response
/ \"503\" ; Mobile subscriber not reachable
###### ## Annex D (informative): Bibliography
Void.
###### ## Annex E (normative): Void
#
# Foreword
This Technical Specification (TS) was been produced by ETSI Technical
Committee Telecommunications and Internet converged Services and Protocols for
Advanced Networking (TISPAN) and originally published as ETSI TS 183 029 [11].
It was transferred to the 3rd Generation Partnership Project (3GPP) in January
2008.
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the stage three (protocol description) of the
Explicit Communication transfer (ECT) supplementary service, based on stage
one and two of the ISDN ECT supplementary service. It provides the protocol
details in the IP Multimedia (IM) Core Network (CN) subsystem based on the
Session Initiation Protocol (SIP) and the Session Description Protocol (SDP).
The present document is applicable to User Equipment (UE) and Application
Servers (AS) which are intended to support the ECT supplementary service.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or nonâ€‘specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TS 24.229: \"Internet Protocol (IP) multimedia call control protocol
based on Session Initiation Protocol (SIP) and Session Description Protocol
(SDP); Stage 3\".
[2] IETF RFC 3515: \"The Session Initiation Protocol (SIP) Refer Method\".
[3] IETF RFC 3892: \"The Session Initiation Protocol (SIP) Referred-By
Mechanism\".
[4] IETF RFC 3891: \"The Session Initiation Protocol (SIP) \"Replaces\"
Header\".
[5] Void.
[6] IETF RFC 3261: \"SIP: Session Initiation Protocol\".
[7] 3GPP TS 29.228: \"IP Multimedia (IM) Subsystem Cx and Dx Interfaces;
Signalling flows and message contents\".
[7A] 3GPP TS 29.229: \"Cx and Dx interfaces based on the Diameter protocol;
Protocol details\".
[8] 3GPP TS 24.610: \"Communication HOLD (HOLD) using IP Multimedia (IM) Core
Network (CN) subsystem; Protocol specification\".
[9] 3GPP TS 24.605: \"Conference (CONF) using IP Multimedia (IM) Core Network
(CN) subsystem; Protocol specification\".
[10] 3GPP TS 24.628: \"Common Basic Communication procedures using IP
Multimedia (IM) Core Network (CN) subsystem; Protocol specification\".
[11] ETSI TS 183 029 V2.5.0: \"Telecommunications and Internet converged
Services and Protocols for Advanced Networking (TISPAN); PSTN/ISDN simulation
services: Explicit Communication Transfer (ECT); Protocol specification\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definitions
apply:
**ECT Session Identifier URI:** PSI created and inserted by a ECT AS that
resolves to the AS itself
NOTE: If this URI contains correlation information it has to be constructed in
such a way that it does not reveal identity information about any party
involved in the transfer.
**transferee:** party being transferred to the transfer target
**transferor:** party initiating the transfer
**transfer target:** party that the existing communication is transferred to
NOTE: After transfer the transferee and the transfer target are in
communication with each other.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
**3GPP** 3^rd^ Generation Partnership Project (www.3gpp.org)
ACR **Anonymous Communication Rejection**
**AS** SIP Application Server
**CDIV** Communication DIVersion
**CONF** CONFerence
**CSCF** Call Session Control Function
ECT **Explicit Communication Transfer**
GRUU Globally Routable User agent URI
HOLD communication HOLD
**IETF Internet Engineering Task Force**
IFC **Initial Filter Criteria**
**ISDN** Integrated Services Digital Network
MCID Malicious Call IDentification
**MGCF** Media Gateway Control Function
OCB **Outgoing Communication Barring**
OIP Originating Identification Presentation
OIR Originating Identification presentation Restriction
**PSTN** Public Switch Telephone Network
**S-CSCF** Serving-CSCF
**SIP** Session Initiation Protocol
TIP Terminating Identification Presentation
TIR Terminating Identification presentation Restriction
UE User Equipment
# 4 Explicit Communication transfer (ECT)
## 4.1 Introduction
The service provides a party involved in a communication to transfer that
communication to a third party.
## 4.2 Description
### 4.2.1 General description
The Explicit Communication transfer (ECT) service provides a party involved in
a communication to transfer that communication to a third party.
There are three actors active in a transfer, they are acting in the following
roles:
**transferor:** the party that initiates the transfer of the active
communication that it has with the transferee;
**transferee:** the party which stays in the communication which is
transferred;
**transfer target:** the party which the communication is transferred to and
which replaces the transferor in the communication.
There are two initial situations possible in which transfer shall be possible:
\- The transferor has no ongoing consultation communication with the transfer
Target (Blind/Assured transfer).
\- The transferor has a consultation communication with the transfer Target
(Consultative transfer).
The transferor AS takes care that it remains in the signalling path even after
the communication is transferred, this allows:
\- Classical charging models.
\- Anonymization of the transfer Target.
## 4.3 Operational requirements
### 4.3.1 Provision/withdrawal
The ECT service may be provided after prior arrangement with the service
provider or be generally available.
### 4.3.2 Requirements on the transferor network side
No specific requirements are needed in the network.
### 4.3.3 Requirements on the transferee network side
No specific requirements are needed in the network.
### 4.3.4 Requirements on the transfer target network side
No specific requirements are needed in the network.
## 4.4 Coding requirements
A user agent that wishes to use the ECT service (to act as a transferor):
\- Shall support the REFER method as a client as specified in RFC 3515 [2].
\- Shall support the Referred-By header as specified in RFC 3892 [3].
A user agent that is the transferred party in a communication transfer (acts
as the transferee):
\- Shall support the REFER method as a server as specified in RFC 3515 [2].
\- Shall support the Referred-By header as specified in RFC 3892 [3].
\- Shall support Replaces header field as a client as specified in RFC 3891
[4].
A user agent that is the transfer target in a communication transfer:
\- May support the Referred-By header as a server as specified in RFC 3892
[3].
\- May support the Replaces header as a server as specified in RFC 3891 [4].
## 4.5 Signalling requirements
### 4.5.1 Activation/deactivation
The ECT service is activated at provisioning and deactivated at withdrawal.
### 4.5.1A Registration/erasure
The ECT service requires no registration. Erasure is not applicable.
### 4.5.1B Interrogation
Interrogation of ECT is not applicable.
### 4.5.2 Invocation and operation
#### 4.5.2.1 Actions at the transferor UE
A UE that has initiated an emergency call, shall not perform any transfer
operation involving the dialog associated with the emergency call.
A UE that initiates a transfer operation shall:
\- Issue a REFER request in the original communications dialog, where:
\- The request URI shall contain the SIP URI of the transferee as received in
the Contact header field.
\- The Refer-To header field shall indicate the public address of the transfer
Target.
\- If the transferor UE has a consultation communication with the transfer
Target, a Replaces header field parameter shall be added to the Refer-To URI
together with a Require=replaces header field parameter.
\- The Referred-By header field can be used to indicate the identity of the
transferor. When privacy was required in the original communications dialog
and a Referred-By header field is included, the UE shall include a Privacy
header field set to \"user\".
After the REFER request is accepted by the other end with a 202 (Accepted)
response, the transferor UE should get notifications of how the transferee\'s
communication setup towards the transfer Target is progressing.
When a NOTIFY request is received on the REFER dialog that indicates that the
transferee and the transfer Target have successfully setup a communication,
the transferor UE may terminate the original communication with the transferee
UE, by sending a BYE message on the original dialog.
#### 4.5.2.2 Void
#### 4.5.2.3 Void
#### 4.5.2.4 Actions at the transferor AS
##### 4.5.2.4.1 Invocation of ECT service
###### 4.5.2.4.1.1 Prerequisite for invocation of the ECT service
For ECT to be provided to end users acting as transferor, the end user\'s AS
providing ECT shall be in the signalling path for all communications.
###### 4.5.2.4.1.2 Determine whether the ECT applies
The transferor AS is the one executing the ECT service logic, which is invoked
by the transferor sending a special REFER request.
###### # 4.5.2.4.1.2.1 REFER request received on a separate dialog
ECT does not apply in this case.
###### # 4.5.2.4.1.2.2 REFER request received in the to be transferred dialog
In order to know whether ECT service applies on a REFER request send by the
served user, the following criteria shall apply before the ECT logic is
executed:
\- The REFER request\'s request-URI (transferee) is targeted at the same UE
instance that is involved in the dialog.
\- The REFER request\'s Refer-To header contains a URI so that the method
constructed from the URI according to RFC 3261 [6] is equal to INVITE.
Any REFER request that does not comply with these criteria shall not invoke
the ECT service and is depending on operator policy:
\- Rejected.
\- Handled by another service.
\- Proxied on.
###### # 4.5.2.4.1.2.2A Procedures for call transfer with 3PCC
When a REFER request is received that invokes the call transfer service (see
subclause 4.5.2.4.1), the AS shall follow procedures specified in 3GPP TS
24.229 [1] for 3PCC as an initiating B2BUA:
\- terminate the REFER request from the transferor UE by sending a 202
(Accepted) response and subsequent NOTIFY requests according to IETF RFC 3515
[2];
\- generate an INVITE request without SDP content body based on the Refer-To
header in the REFER request. The AS shall not include Replaces header in this
INVITE request;
\- send the INVITE request to the transfer target as either an initial INVITE
if there is no consultative call between the transferor UE and the transfer
target or a re-INVITE over the existing dialog if there is a consultative call
between the transferor UE and the transfer target.
Upon receiving a reliable response (reliable 18x response or 200 OK response)
to the INVITE request from the transfer target UE with SDP offer information
in the message body, the AS shall generate a re-INVITE request to the
transferee UE. The re-INVITE shall include the media information in the SDP
offer that matches what was received from the transfer target UE. The re-
INVITE request is sent to the transferee UE over the existing dialog.
Upon receiving a reliable response (e.g., 200 OK) to the re-INVITE request
from the transferee UE containing an SDP answer in the message body, the AS
shall include the SDP answer into the next eligible request toward the
transfer target as an answer to the original SDP offer. The next eligible
request may be one of the following:
\- PRACK request for a reliable 18x response; or,
\- ACK request for 200 OK response.
Upon successful completion of the 3PCC procedure between the transferee and
the transfer target, the AS shall send a NOTIFY request to the transferor to
indicate that the call transfer has been completed based on the REFER request.
The AS shall not send NOTIFY requests on 200 (OK) responses received for
requests other than INVITE requests.
###### 4.5.2.4.1.2.3 Actions of ECT when invoked with a transfer request
When a REFER request is received that invokes the ECT service (see subclause
4.5.2.4.1), ECT service shall perform the following actions:
1) Create a new ECT Session Identifier URI addressed to this AS. The URI shall
be created in such a way that a new dialog set up towards this URI can be
easily correlated with the current REFER dialog.
2) The AS stores the value of the Refer-To header field (transfer Target URI)
from the REFER request and links it to the ECT Session Identifier URI.
3) The AS replaces the Refer-To header field with the ECT Session Identifier
URI (this ensures that the transferor AS remains in the loop when the
transferee sets up the communication with the transfer Target).
NOTE: If a Replaces header field parameter and/or a Require=replaces header
field parameter are available in the URI contained in the Refer-To header
field, the above step implies that they are not forwarded to the transferee.
4) If a Referred-By header is available in the request, the AS verifies if the
provided Referred-By header contains a valid identity of the served user. If
not it will replace the Referred-By header with a valid value matching the
REFER request\'s P-Asserted-Identity and if \"id\" privacy was requested,
include a Privacy header field set to \"user\". The AS then stores the
Referred-by header.
5) If no Referred-By header is available in the request a Referred-By header
is added that matches the REFER request\'s P-Asserted-Identity and if \"id\"
privacy was requested, include a Privacy header field set to \"user\".
6) The AS sends the REFER request on to the transferee using basic
communication procedures 3GPP TS 24.229 [1].
If the AS receives a 403 Forbidden or 501 Not implemented in response to a
REFER request, the AS of the initiator of the REFER request may initiate the
special REFER handling procedures, according to 3GPP TS 24.628 [10].
If the AS receives a NOTIFY request with a sipfrag message body indicating a
420 Bad Extension as defined in RFC 3892 [3], the AS of the initiator of the
REFER request may initiate the special REFER handling procedures according to
3GPP TS 24.628 [10].
As a network option, the AS of the initiator of the REFER request that has
prior knowledge that the remote party is not allowed to receive or does not
support the REFER method, may initiate the special REFER handling procedures
directly, according to 3GPP TS 24.628 [10].
##### 4.5.2.4.2 Subsequent procedures
##### 4.5.2.4.2.1 Actions of ECT when invoked again by the transferred
communication {#actions-of-ect-when-invoked-again-by-the-transferred-
communication .H6}
When an INVITE is received targeted at the ECT Session Identifier URI created
earlier when the served user requested transfer of an ongoing communication,
ECT shall perform the following actions:
> 0) If the stored transfer target URI linked to the ECT Session Identifier
> contains a Replaces header field parameter, then the AS inserts the Replaces
> header field in the INVITE request and:
>
> a) If the INVITE request does not contain a Requires header field, then the
> AS inserts a Requires header field in the INVITE request including a
> \"replaces\" token.
>
> b) If the INVITE request does contain a Requires header field without a
> \"replaces\" token, then the AS inserts a Requires header field in the
> INVITE request including a \"replaces\" token.
1) Strip all header field parameters and method parameter from the stored
transfer Target URI and replace the request URI with the stripped version of
the stored transfer Target URI linked to the specific ECT Session Identifier
URI.
```{=html}
``` 7) If a Referred-By header is available in the request, the AS verifies if
the provided Referred-By header contains a valid identity of the served user.
If not it will replace the Referred-By header with a valid value matching the
REFER request\'s P-Asserted-Identity and if \"id\" privacy was requested,
include a Privacy header field set to \"user\".
8) If no Referred-By header is available in the request a Referred-By header
is added that matches the REFER request\'s P-Asserted-Identity , and if \"id\"
privacy was requested, include a Privacy header field set to \"user\".
NOTE: If needed the AS can generate charging events to charge for the extra
leg.
9) The INVITE request is forwarded towards the transfer Target using basic
communication procedures 3GPP TS 24.229 [1].
##### 4.5.2.4.2.2 Actions of ECT on failed REFER request {#actions-of-ect-on-
failed-refer-request .H6}
#### 4.5.2.5 Actions at the transferee UE
##### 4.5.2.5.1 Actions at the transferee UE (without 3PCC)
When a REFER request is received in the context of a call transfer scenario
(see subclause 4.5.2.4.1), the transferee UE shall perform the following
steps:
1) apply the procedure for holding the active communication with the
transferor as described in 3GPP TS 24.610 [8] subclause 4.5.2.1; and
2) apply normal REFER handling procedures according to 3GPP TS 24.229 [1].
##### 4.5.2.5.2 Actions at the transferee UE (with 3PCC)
The transfer target UE if not on a consultative call with the transferor UE,
upon receiving an initial INVITE request with no SDP content, shall send
reliable provisional responses with an SDP offer. The content of the SDP offer
is derived base on service information received in the INVITE.
The transfer target UE if on a consultative call with the transferor UE, upon
receiving a re-INVITE request within the existing dialog with no SDP content,
shall send 200 OK response according to with an SDP offer. The content of the
SDP offer is derived based on the media characteristics of the existing
consultative call.
#### 4.5.2.6 Void
#### 4.5.2.7 Actions at the transferee AS
##### 4.5.2.7.0 Prerequisite for invocation of the ECT service
For ECT to be provided to end users acting as transferee, the end user\'s AS
providing ECT shall be in the signalling path for all communications of the
served user.
##### 4.5.2.7.1 Determine whether the ECT applies
See subclause 4.5.2.4.1 on the criteria that determine that a REFER request is
to be treated as a request for transfer of an existing communication.
##### 4.5.2.7.2 Actions of ECT when invoked with a transfer request
When a REFER request is received in the context of a call transfer scenario
(see subclause 4.5.2.4.1), it shall perform the following steps:
10) Store the value of the Refer-To header field (used later to correlate the
new communication with this REFER dialog).
    5a) Optionally it may store the value of the Referred-By header
    field, if it wants to ensure that the Referred-By is correct on the
    resulting INVITE request.
11) Forward the request to the transferee according to basic communication
procedures 3GPP TS 24.229 [1].
##### 4.5.2.7.3 Actions of ECT when invoked again by the transferred
communication
When an INVITE is received targeted at the SIP URI stored earlier when a
transfer request was received targeted at the served user (transferee), ECT
shall perform the following actions:
> 0) Optionally the AS may check the following header fields in the received
> INVITE request:
a) If a Referred-By header field is present in the INVITE, the AS may check if
it matches the Referred-By header of the REFER stored earlier. If it does not
match, depending on the policy of the service provider, the AS shall reject
the INVITE request or replace the Referred-By header in the INVITE request
with the value stored earlier.\ If a Referred-By header is absent in the
INVITE, the AS shall insert a Referred-By header with the value stored
earlier.
1) Optionally the AS may generate charging events:
a) To charge for the original communication between the transferee and the
transferor, in case the transferee was the originating party in the original
communication.
b) To switch of charging in case the transferee was the terminating party in
the original communication.
12) The INVITE is forwarded towards the transfer Target using basic
communication procedures 3GPP TS 24.229 [1].
#### 4.5.2.8 Void
#### 4.5.2.9 Void
#### 4.5.2.10 Void
#### 4.5.2.11 Void
#### 4.5.2.12 Void
#### 4.5.2.13 Void
#### 4.5.2.14 Void
#### 4.5.2.15 Actions at the transfer target\'s AS
Basic communication procedures according to 3GPP TS 24.229 [1] shall apply.
#### 4.5.2.16 Void
#### 4.5.2.17 Actions at the transfer target\'s UE
Basic communication procedures according to 3GPP TS 24.229 [1] shall apply.
## 4.6 Interaction with other services
### 4.6.1 Communication HOLD (HOLD)
No impact.
### 4.6.2 Terminating Identification Presentation (TIP)
No impact.
### 4.6.3 Terminating Identification Restriction (TIR)
No impact.
### 4.6.4 Originating Identification Presentation (OIP)
No impact.
### 4.6.5 Originating Identification Restriction (OIR)
Requirements relating to the Referred-By header field are described in
subclauses 4.5.2.4.1.2.3 and 4.5.2.4.2.1.
On the reception of an INVITE request from the transferee, the transferor AS
shall deduce the \"id\" related privacy requirement that the transferee has
indicated in the initial call between the transferee and the transferor; and
shall include a Privacy header field containing the according value in the
outgoing INVITE request.
For the other transferee AS and the transfer Target AS there is no impact.
### 4.6.6 CONFerence Calling (CONF)
ECT shall not apply when the following criteria apply:
\- REFER request is received in an INVITE dialog with a conference focus, or a
REFER request is received in an INVITE dialog and the Refer-to header field of
the REFER request indicates the public address of active dialog to conference
focus which is known by the AS providing ECT; and
\- The REFER is originated by the conference controller, the conference
controller is the user that created and owns the conference.
An AS can determine that an established INVITE dialog is terminated at a
conference focus because according to 3GPP TS 24.605 [9] it either:
\- has received a 1xx or 2xx response to the INVITE request with an
\"isfocus\" feature parameter in the Contact header field; or
\- has received an INVITE with an \"isfocus\" feature parameter in the Contact
header field.
### 4.6.7 Communication DIVersion Services (CDIV)
No impact.
### 4.6.8 Malicious Communication IDentification (MCID)
No impact.
### 4.6.9 Anonymous Communication Rejection and Communication Barring (ACR/CB)
For the transferor AS the following applies:
\- Shall not accept transfer requests with a transfer Target that is barred by
the served users Outgoing Communication Barring (OCB) rules.
\- For the transferee AS and the transfer Target AS there is no impact.
### 4.6.10 Explicit Communication Transfer (ECT)
#### 4.6.10.1 Determine whether a previously transferred communication is
transferred again
See subclause 4.5.2.4.1 on the criteria that determine that a REFER request is
to be treated as a request for transfer of an existing communication.
Additionally the following criteria should apply for this interaction case to
apply:
\- The INVITE dialog on which the REFER is received is a previously
transferred communication, for which the current ECT instance had the
Transferor role.
#### 4.6.10.2 Handling of transfer requests
When a REFER request is received and the criteria of subclause 4.6.10.1 apply,
then the AS shall perform the following steps:
1) Create a new ECT Session Identifier URI addressed to this AS. The URI shall
be created in such a way that a new dialog set up towards this URI can be
easily correlated with the current REFER dialog.
```{=html}
``` 13) The AS stores the value of the Refer-To header field (transfer target)
from the REFER request and links it to the ECT Session Identifier URI.
14) The AS replaces the Refer-To header field with the ECT Session Identifier
URI from step 1). (This ensures that this AS remains in the loop when the
transferee sets up the communication with the transfer target.).
15) The AS forwards the REFER request to the transferee using basic
communication procedures 3GPP TS 24.229 [1].
#### 4.6.10.3 Actions when this ECT instance is invoked again by the
transferred communication
When an INVITE is received targeted at the ECT Session Identifier URI created
earlier in subclause 4.6.10.2, the AS shall perform the following actions:
1) The AS replaces the request URI with the stored Refer-To header field value
linked to the specific\ ECT Session Identifier URI.
NOTE: If needed the AS may generate charging events to charge for the extra
leg.
16) The AS forwards the INVITE request towards the transfer target using basic
communication procedures 3GPP TS 24.229 [1].
## 4.7 Interworking with other networks
### 4.7.1 Void
### 4.7.2 Void
### 4.7.3 Void
## 4.8 Parameter values (timers)
No specific timers are required.
## 4.9 Service configuration
Not applicable.
###### ## Annex A (informative): Signalling flows
# A.1 Blind transfer
Figure A.1 signalling flow shows a blind transfer scenario, whereby the REFER
request is sent on the existing INVITE dialog between A and B.
{width="6.275in" height="7.117361111111111in"}
Figure A.1: Blind transfer
1\. A multimedia session exists between A-B. B initiates transfer A to C, by
sending REFER request To: UE-A with Referred-To: UE-C, Referred-By: UE-B. The
REFER request is send in the existing dialog that between A and B.
1.1 Upon reception of the REFER request, AS-B must check whether there is no
outgoing call barring active from B to C. Because B is charged for the call
from B-C when A is referred to C, when outgoing call barring is active from
B-C the REFER request is rejected.\ \ AS-B checks whether B is allowed to
transfer calls, if it is allowed to transfer the call then AS-B generates an
ECT Session Identifier URI, addressed to itself, with the new destination
information and billing information that will be needed for the new session.
It replaces the Refer-To value with the ECT Session Identifier URI. This
ensures that:\ \ AS-B will remain in the loop.
2\. The REFER request is sent on to AS-A.
2.1 AS-A checks whether it is allowed to transfer A.
3\. The REFER request is sent on to A by AS-A.
4\. The REFER request is accepted by A\'s UE.
4.1, 13.1, 31.1 AS-A can use result messages and notifications caused by the
REFER request to track success of refer and take appropriate actions. The AS-A
can ensure that header fields that where replaced with other content are
recreated with the original content on the way back.
5.1, 8.1, 32.1 AS-B can use this to track success of the REFER request and
take appropriate actions. The AS-B can ensure that header fields that where
replaced with other content are recreated with the original content on the way
back.
7\. Since the REFER request was accepted in 6. UE-B terminates the existing
INVITE dialog by sending a BYE to UE-A.
19\. The UE-A initiates a new session by sending an INVITE request to AS-B\'s
ECT Session Identifier URI (which represents UE-C).
19.1 AS-A routes the INVITE request to AS-B using the AS-B\'s ECT Session
Identifier URI using normal SIP routing procedures. Normal charging from A to
B applies.
20.1 Upon receiving the INVITE request to the ECT Session Identifier URI that
was inserted by the AS-B, the AS-B replaces it with the Request URI of C and
creates an INVITE targeted towards UE-C.\ \ In this scenario it can be assumed
that there is no active outgoing call barring towards UE-C, because the REFER
was accepted by AS-B. The ECT Session Identifier URI has a limited validity
time to ensure that no future barring is violated.\ \ Also the Referred-By:
header field is verified or filled in with the original uncodified values.
Then the INVITE request is forwarded to UE-C using normal routing procedures.
21.1, 23.1 Normal terminating services apply for UE-C. The call will be
treated as a call from A-C regarding call policies.
25.1 AS-A. Normal response handling applies.
27.1 AS-A. Normal ACK handling applies.
28.1 AS-B replaces all codified values and ECT Session Identifier URI \'s with
stored values.
# A.2 Consultative transfer
Figure A.2 signalling flow shows a consultative transfer scenario.
{width="6.270138888888889in" height="8.13263888888889in"}
Figure A.2: Consultative transfer
1\. A multimedia session exists between A-B and between B-C. B initiates
transfer A to C, by sending REFER method To: UE-A GRUU with the Refer-To:
UE-C?Replaces=dialog2&Require=replaces, Referred-By: UE-B. The REFER reuses
the dialog that exists from A-B.
1.1 Upon reception of the REFER operation AS-B must check whether there is no
outgoing call barring active from B to C. Because B is charged for the call
from B-C when A is referred to C, when outgoing call barring is active from
B-C the REFER is rejected.\ \ AS-B checks whether B is allowed to transfer
calls, if it is allowed to transfer the call then AS-B generates an ECT
Session Identifier URI, addressed to itself, with the new destination
information and billing information that will be needed for the new session.
It replaces the Refer-To value with the ECT Session Identifier URI. This
ensures that AS-B will remain in the loop.
2\. The REFER to method is sent on to AS-A.
2.1 AS-A checks whether it is allowed to transfer A.
3\. Refer is sent on to A by AS-A.
4.1, 7.1, 31.1 AS-A can use result messages and notifications caused by REFER
to track success of REFER and take appropriate actions. The AS-A can ensure
that header fields that where replaced with other content are recreated with
the original content on the way back.
5.1, 8.1, 32.1 AS-B can use this to track success of REFER and take
appropriate actions. The AS-B can ensure that header fields that where
replaced with other content are recreated with the original content on the way
back.
13\. UE-A initiates a new session by sending an INVITE to AS-B\'s ECT Session
Identifier URI (which represents UE-C).
13.1 AS-A checks whether A is allowed to use the Replace extension and routes
the INVITE to AS-B using the AS-B\'s ECT Session Identifier URI using normal
SIP routing procedures. Normal charging from A to B applies.
14.1 Upon receiving the INVITE to the ECT Session Identifier URI that was
inserted by the AS-B, the AS-B replaces the Request URI and creates an INVITE
targeted towards UE-C. Further AS-B inserts a Replaces header field with the
value of the Replaces parameter of the stored transfer Target URI if it is
available, which will allow the new session to take the place of the existing
session between B and C.\ In this scenario it can be assumed that there is no
active outgoing call barring towards UE-C, because UE-B was able to setup a
call to UE-C in the first place. However when there was no consultation call
to UE-C, there is an issue but this is solved at the initial reception of the
REFER from UE-C and not at this stage.\ The INVITE is forwarded to UE-C using
normal routing procedures.
15.1, 17.1 Normal terminating services apply for UE-C. The call will be
treated as a call from A-C regarding call policies. AS-C checks whether the
Replace mechanism is used.
19.1 AS-A. Normal response handling applies.
21.1 AS-A. Normal ACK handling applies.
22.1 AS-B replaces all codified values and the ECT Session Identifier URI with
stored values.
25\. UE-C terminates dialog 2 as consequence of normal Replace procedures
according to RFC 3891 [4].
# A.3 Blind call transfer with third party call control
Figure A.3 depicts a scenario where UE-1 and UE-2 are in an active call. UE-1
decides to blind transfer UE-2 to UE-3. In this scenario, UE-3's initial offer
(O1) is presented to the AS (acting on behalf of UE-1) in an 18x method. Since
UE-2 is already on hold, the INVITE to stimulate the UE-3 offer is sent first.
This expedites the off-hold processing of UE-2.
Note that 3PCC as shown in this call flow is also sometimes refered to as
"REFER interworking".
{width="6.252777777777778in" height="4.872222222222222in"}
Figure A.3: Blind Call Transfer with 3PCC
UE-1 and UE-2 are on an active call. UE-1 decides to blind transfer UE-2 to
UE-3.
1: UE-1 and UE-2 are in a normal call.
2: UE-1 first puts UE-2 on hold before initiating the blind call transfer.
3 to 5: UE-1 sends REFER to UE-2 with the Refer-To header set to UE-3. The
REFER is forwarded to the AS by UE-1's S-CSCF since the AS is included in the
signaling path between UE-1 and UE-2 due to initial filter triggers in the
original call setup process.
6 to 8: The AS acknowledges the REFER request with 202 Accepted response.
9 to 14: The AS can optionally notify UE-1 of the REFER processing status by
sending NOTIFY.
15 to 17: UE-1 sends BYE to UE-2 to terminate the call between them.
18 to 20: The AS acknowledges the BYE with 200 OK (BYE) toward UE-1.
21: The AS sends an INVITE to the URI contained in the Refer-To header to
establish a call with UE-3. The AS picks the non-hold UE for first contact.
The INVITE contains no SDP so that the UE-3 may present the initial offer, O1.
22: UE-3 extends the initial offer (O1) in a 18x message. The offer includes
mode=send/recv.
23: AS-1 sends a re-INVITE with offer, O1 received from UE-3, to UE-2.
24: UE-2 is on-hold when it receives the SDP offer with send/receive from
UE-3. This directs UE-2 to go off-hold and UE-2 responds with an answer (A1)
with mode=send/receive in a 200 OK for the re-INVITE.
25: AS-1 acknowledges the INVITE with an ACK (INVITE).
26: The PRACK message for the 18x (message 22) contains the answer (A1) from
UE-2.
27: UE-3 acknowledges with a 200 OK for the PRACK.
28: UE-3 acknowledges the INVITE with a 200 OK for the INVITE
29: AS-1 closes the INVITE with ACK to UE-3.
Media between UE-2 and UE-3
30 to 32: The AS notifies UE-1 of the transfer complete with a NOTIFY (200
OK).
33 to 35: UE-1 acknowledges the NOTIFY with 200 OK (NOTIFY).
# A.4 Consultative call transfer with third party call control
Note that 3PCC as shown in this call flow is also sometimes refered to as
"REFER interworking".
{width="6.248611111111111in" height="5.311805555555556in"}
Figure A.4: Consultative Transfer with 3PCC
UE-1 and UE-2 are on an active call. UE-1 decides to transfer UE-2 to UE-3,
but before the actual transfer happens, UE-1 consults with UE-3 first for
permission to transfer the call.
1: UE-1 and UE-2 are in a normal call.
2: UE-1 first puts UE-2 on hold before initiating the call transfer.
3 to 11: UE-1 establishes call with UE-3 following normal procedures and gets
UE-3's permission to transfer UE-2.
12: UE-1 optionally puts UE-3 on hold before the call transfer.
13 to 15: UE-1 sends REFER to UE-2 with the Refer-To header set to UE-3. The
REFER is forwarded to the AS by UE-1's S-CSCF since the AS is included in the
signaling path between UE-1 and UE-2 due to initial filter triggers in the
original call setup process.
16 to 18: The AS acknowledges the REFER request with 202 Accepted response.
19 to 24: The AS notifies UE-1 of the REFER processing status by sending
NOTIFY.
25: The AS sends re-INVITE to UE-3 with no SDP information.
26: UE-3 returns 200 OK to the AS with an SDP offer (O1). The SDP offer
proposes the call to be taken off hold.
27: The AS sends re-INVITE to UE-2 with the same SDP offer (O1).
28: UE-2 sends 200 OK with SDP answer (A1) to the AS.
29: The AS sends ACK to UE-2 with the SDP answer (A1). Now the end-to-end
offer/answer exchange between UE-2 and UE-3 is completed.
30: The AS sends ACK to UE-3 to acknowledge the 200 OK response.
31 to 36: UE-2 sends NOTIFY to UE-1 to notify the status of the REFER
processing.
37 to 42: UE-1 sends BYE and terminates the call leg between UE-1 and UE-2.
###### ## Annex B (informative): Example of filter criteria
# B.1 Example of filter criteria for ECT
This annex provides an example of a filter criterion that triggers SIP
requests that are subject to initial filter criteria evaluation.
When the initial request matches the conditions of the next unexecuted IFC
rule for the served user which points to the ECT service, the communication is
forwarded to the AS.
An example of an Initial Filter Criteria (IFC) Trigger Point configurations
under the assumption that the ECT service is a standalone service that can be
invoked by a very specific trigger point active at the destination S-CSCF:
\- Method=\"INVITE\".
NOTE 1: The coding of the Initial Filter Criteria is described in 29.228 [7]
and 29.229 [7A].
NOTE 2: When the REFER is sent on an existing dialog, no IFC processing will
be performed, because this is a subsequent request on an existing dialog. It
follows that when this scenario has to be supported, that then all signalling
has to traverse through the AS.
###### ## Annex C (informative): Example charging model
# C.1 Example of B REFER\'s A to C
This scenario is added to show that the solution presented in the present
document is able to support classical charging models. Assumption in this
scenario is that A originated the original call and is thus charged for the
initial A-B communication.
{width="6.235416666666667in" height="3.7555555555555555in"}
Figure C.1: Example of B REFER\'s A to C
Table C.1
* * *
Initial Session Initiated By Initial Session A-B Transferred Session\ Transfer
Target C
A=Transferee Transferee (A): A-B Transferee (A): A-B\ Transferor (B): B-C
A=Transferor Transferor (A): A-B Transferor (A): A-B\ Transferor (A): A-C
* * *
# C.2 Example of A REFER\'s B to C
This scenario is added to show that the solution presented in the present
document is able to support classical charging models. Assumption in this
scenario is that A originated the original call and is thus charged for
initial A-B communication.
{width="6.623611111111111in" height="4.308333333333334in"}
Figure C.2: Example of a REFER\'s B to C
Table C.2
+------------------------------+---------------------+---------------------+ | Initial Session Initiated By | Initial Session A-B | Transferred Session | | | | | | | | Transfer Target C | +------------------------------+---------------------+---------------------+ | A=Transferee | Transferee (A): A-B | Transferee (A): A-B | | | | | | | | Transferor (B): B-C | +------------------------------+---------------------+---------------------+ | A=Transferor | Transferor (A): A-B | Transferor (A): A-B | | | | | | | | Transferor (A): A-C | +------------------------------+---------------------+---------------------+
###### ## Annex D (informative): Void
#
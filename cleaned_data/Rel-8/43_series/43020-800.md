# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 0 Scope
This Technical Specification specifies the network functions needed to provide
the security related service and functions specified in 3GPP TS 42.009.
This specification does not address the cryptological algorithms that are
needed to provide different security related features. This topic is addressed
in annex C. Wherever a cryptological algorithm or mechanism is needed, this is
signalled with a reference to annex C. The references refers only to
functionalities, and some algorithms may be identical or use common hardware.
## 0.1 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
> [1] 3GPP TS 21.905: "Vocabulary for 3GPP Specifications\".
>
> [2] 3GPP TS 41.061: \" GPRS ciphering algorithm requirements\".
>
> [3] Void
>
> [4] 3GPP TS 42.009: \" Security aspects\".
>
> [5] 3GPP TS 42.017: \" Subscriber Identity Modules (SIM) Functional
> characteristics\".
>
> [6] 3GPP TS 42.056: \" GSM Cordless Telephone System (CTS) Phase 1; Service
> Description; Stage 1\".
>
> [7] 3GPP TS 22.060: "General Packet Radio Service (GPRS); Service
> description; Stage 1\".
>
> [8] 3GPP TS 23.003: \"Numbering, addressing and identification\".
>
> [9] GSM 03.56: \"Digital cellular telecommunications system (Phase 2+); GSM
> Cordless Telephone System (CTS), Phase 1; CTS Architecture Description;
> Stage 2\".
>
> [10] 3GPP TS 23.060: \" Service description; Stage 2\".
>
> [11] 3GPP TS 24.008: "Mobile radio interface layer 3 specification\".
>
> [12] Void
>
> [13] 3GPP TS 45.001: "Physical layer on the radio path; General
> description".
>
> [14] 3GPP TS 45.002: "Multiplexing and multiple access on the radio path".
>
> [15] 3GPP TS 45.003: "Channel coding".
>
> [16] 3GPP TS 29.002: \" Mobile Application Part (MAP) specification\".
>
> [17] 3GPP TS 51.011: \" Specification of the Subscriber Identity Module-
> Mobile Equipment (SIM-ME) interface\".
## 0.2 Abbreviations
Abbreviations used in this specification are listed in 3GPP TS 21.905.
Specific abbreviations used in annex A are listed in clause A.3.
Specific CTS related abbreviations used in annex E are listed in clause E.1.3.
Specific VCGS and VBS related abbreviations used in annex F are listed in
clause F.1.3.
# 1 General
The different security related services and functions that are listed in 3GPP
TS 42.009 are grouped as follows:
\- Subscriber identity confidentiality;
\- Subscriber identity authentication;
\- Signalling information element and connectionless user data confidentiality
and data confidentiality for physical connections (ciphering).
It shall be possible to introduce new authentication and ciphering algorithms
during the systems lifetime. The fixed network may support more than one
authentication and ciphering algorithm.
The security procedures include mechanisms to enable recovery in event of
signalling failures. These recovery procedures are designed to minimize the
risk of a breach in the security of the system.
General on figures in this specification:
\- In the figures below, signalling exchanges are referred to by functional
names. The exact messages and message types are specified in 3GPP TS 24.008
and 3GPP TS 29.002.
\- No assumptions are made for function splitting between MSC (Mobile
Switching Centre), VLR (Visitor Location Register) and BSS (Base Station
System). Signalling is described directly between MS and the local network
(i.e. BSS, MSC and VLR denoted in the figures by BSS/MSC/VLR). The splitting
in annex A is given only for illustrative purposes.
\- Addressing fields are not given; all information relates to the signalling
layer. The TMSI allows addressing schemes without IMSI, but the actual
implementation is specified in the GSM 04-series.
\- The term HPLMN in the figures below is used as a general term which should
be understood as HLR (Home Location Register) or AuC (Authentication Centre).
\- What is put in a box is not part of the described procedure but it is
relevant to the understanding of the figure.
# 2 Subscriber identity confidentiality
## 2.1 Generality
The purpose of this function is to avoid the possibility for an intruder to
identify which subscriber is using a given resource on the radio path (e.g.
TCH (Traffic Channel) or signalling resources) by listening to the signalling
exchanges on the radio path. This allows both a high level of confidentiality
for user data and signalling and protection against the tracing of a user\'s
location.
The provision of this function implies that the IMSI (International Mobile
Subscriber Identity), or any information allowing a listener to derive the
IMSI easily, should not normally be transmitted in clear text in any
signalling message on the radio path.
Consequently, to obtain the required level of protection, it is necessary
that:
\- a protected identifying method is normally used instead of the IMSI on the
radio path; and
\- the IMSI is not normally used as addressing means on the radio path (see
3GPP TS 42.009);
\- when the signalling procedures permit it, signalling information elements
that convey information about the mobile subscriber identity must be ciphered
for transmission on the radio path.
The identifying method is specified in the following subclause. The ciphering
of communication over the radio path is specified in clause 4.
## 2.2 Identifying method
The means used to identify a mobile subscriber on the radio path consists of a
TMSI (Temporary Mobile Subscriber Identity). This TMSI is a local number,
having a meaning only in a given location area; the TMSI must be accompanied
by the LAI (Location Area Identification) to avoid ambiguities. The maximum
length and guidance for defining the format of a TMSI are specified in 3GPP TS
23.003.
The network (e.g. a VLR) manages suitable data bases to keep the relation
between TMSIs and IMSIs. When a TMSI is received with an LAI that does not
correspond to the current VLR, the IMSI of the MS must be requested from the
VLR in charge of the indicated location area if its address is known;
otherwise the IMSI is requested from the MS.
A new TMSI must be allocated at least in each location updating procedure. The
allocation of a new TMSI corresponds implicitly for the MS to the de-
allocation of the previous one. In the fixed part of the network, the
cancellation of the record for an MS in a VLR implies the de-allocation of the
corresponding TMSI.
To cope with some malfunctioning, e.g. arising from a software failure, the
fixed part of the network can require the identification of the MS in clear.
This procedure is a breach in the provision of the service, and should be used
only when necessary.
When a new TMSI is allocated to an MS, it is transmitted to the MS in a
ciphered mode. This ciphered mode is the same as defined in clause 4.
The MS must store its current TMSI in a non volatile memory, together with the
LAI, so that these data are not lost when the MS is switched off.
## 2.3 Procedures
This subclause presents the procedures, or elements of procedures, pertaining
to the management of TMSIs.
### 2.3.1 Location updating in the same MSC area
This procedure is part of the location updating procedure which takes place
when the original location area and the new location area depend on the same
MSC. The part of this procedure relative to TMSI management is reduced to a
TMSI re-allocation (from TMSIo with \"o\" for \"old\" to TMSIn with \"n\" for
\"new\").
The MS sends TMSIo as an identifying field at the beginning of the location
updating procedure.
The procedure is schematized in figure 2.1.
Figure 2.1: Location updating in the same MSC area
Signalling Functionalities:
Management of means for new ciphering:
The MS and BSS/MSC/VLR agree on means for ciphering signalling information
elements, in particular to transmit TMSIn.
### 2.3.2 Location updating in a new MSCs area, within the same VLR area
This procedure is part of the location updating procedure which takes place
when the original location area and the new location area depend on different
MSCs, but on the same VLR.
The procedure is schematized on figure 2.2.
NOTE: From a security point of view, the order of the procedures is
irrelevant.
Figure 2.2: Location updating in a new MSCs area, within the same VLR area
Signalling functionalities:
Loc.Updating:
stands for Location Updating
The BSS/MSC/VLR indicates that the location of the MS must be updated.
### 2.3.3 Location updating in a new VLR; old VLR reachable
This procedure is part of the normal location updating procedure, using TMSI
and LAI, when the original location area and the new location area depend on
different VLRs.
The MS is still registered in VLRo (\"o\" for old or original) and requests
registration in VLRn (\"n\" for new). LAI and TMSIo are sent by MS as
identifying fields during the location updating procedure.
The procedure is schematized in figure 2.3.
NOTE: From a security point of view, the order of the procedures is
irrelevant.
Figure 2.3: Location updating in a new VLR; old VLR reachable
Signalling functionalities:
Sec.Rel.Info.:
Stands for Security Related information
The MSC/VLRn needs some information for authentication and ciphering; this
information is obtained from MSC/VLRo.
Cancellation:
The HLR indicates to VLRo that the MS is now under control of another VLR. The
\"old\" TMSI is free for allocation.
### 2.3.4 Location Updating in a new VLR; old VLR not reachable
This variant of the procedure in subclause 2.3.3 arises when the VLR receiving
the LAI and TMSIo cannot identify the VLRo. In that case the relation between
TMSIo and IMSI is lost, and the identification of the MS in clear is
necessary.
The procedure is schematized in figure 2.4
NOTE: From a security point of view, the order of the procedures is
irrelevant.
Figure 2.4: Location Updating in a new VLR; old VLR not reachable
### 2.3.5 Reallocation of a new TMSI
This function can be initiated by the network whenever a radio connection
exists. The procedure can be included in other procedures, e.g. through the
means of optional parameters. The execution of this function is left to the
network operator.
When a new TMSI is allocated to an MS the network must prevent the old TMSI
from being allocated again until the MS has acknowledged the allocation of the
new TMSI.
If an IMSI record is deleted in the VLR by O&M action, the network must
prevent any TMSI associated with the deleted IMSI record from being allocated
again until a new TMSI is successfully allocated to that IMSI.
If an IMSI record is deleted in the HLR by O&M action, it is not possible to
prevent any TMSI associated with the IMSI record from being allocated again.
However, if the MS whose IMSI record was deleted should attempt to access the
network using the TMSI after the TMSI has been allocated to a different IMSI,
then authentication or ciphering of the MS whose IMSI was deleted will almost
certainly fail, which will cause the TMSI to be deleted from the MS.
The case where allocation of a new TMSI is unsuccessful is described in
subclause 2.3.8.
This procedure is schematized in figure 2.5.
Figure 2.5: Reallocation of a new TMSI
### 2.3.6 Local TMSI unknown
This procedure is a variant of the procedure described in subclauses 2.3.1 and
2.3.2, and happens when a data loss has occurred in a VLR and when a MS uses
an unknown TMSI, e.g. for a communication request or for a location updating
request in a location area managed by the same VLR.
This procedure is schematized in figure 2.6.
NOTE: Any message in which TMSIo is used as an identifying means in a location
area managed by the same VLR.
Figure 2.6: Location updating in the same MSC area; local TMSI unknown
### 2.3.7 Location updating in a new VLR in case of a loss of information
This variant of the procedure described in 2.3.3 arises when the VLR in charge
of the MS has suffered a loss of data. In that case the relation between TMSIo
and IMSI is lost, and the identification of the MS in clear is necessary.
The procedure is schematized in figure 2.7.
NOTE: From a security point of view, the order of the procedures is
irrelevant.
Figure 2.7: Location updating in a new VLR in case of a loss of information
### 2.3.8 Unsuccessful TMSI allocation
If the MS does not acknowledge the allocation of a new TMSI, the network shall
maintain the association between the old TMSI and the IMSI and between the new
TMSI and the IMSI.
For an MS-originated transaction, the network shall allow the MS to identify
itself by either the old TMSI or the new TMSI. This will allow the network to
determine the TMSI stored in the MS; the association between the other TMSI
and the IMSI shall then be deleted, to allow the unused TMSI to be allocated
to another MS.
For a network-originated transaction, the network shall identify the MS by its
IMSI. When radio contact has been established, the network shall instruct the
MS to delete any stored TMSI. When the MS has acknowledged this instruction,
the network shall delete the association between the IMSI of the MS and any
TMSI; this will allow the released TMSIs to be allocated to another MS.
In either of the cases above, the network may initiate the normal TMSI
reallocation procedure.
Repeated failure of TMSI reallocation (passing a limit set by the operator)
may be reported for O&M action.
### 2.3.9 Combined location area updating with the routing area updating
**This subclause is only applicable if GPRS is supported.**
This procedure is part of the location updating of a General Packet Radio
Service (GPRS) class A or B mobile when the Gs-interface (SGSN MSC/VLR
signalling interface) is implemented. This procedure is not relevant if the
Gs-interface is not implemented.
The location area updating procedure and the routing area updating procedure
are combined to one MS Serving GPRS Support Node (SGSN) procedure. The MS
includes a Location Area Update (LAU) indication in the Routing Area Update
Request message. The SGSN performs the location updating towards the VLR on
behalf of the MS.
The procedure described in figure 2.8 shows only the interaction between the
SGSN and the VLR. The full procedure including the update to other network
element (e.g. HLR, old MSC/VLR) is described in 3GPP TS 23.060.
NOTE 1: The Routeing Area Update Request message including the old Routing
Area Identifier (RAI), the Temporary Logical Link Identifier (TLLI), and an
indication that a combined Location Area Update (LAU) is performed.
NOTE 2: Location Updating message.
NOTE 3: Location Updating Accept message including the new TMSI.
NOTE 4: Routing Area Update Accept message including the new TMSI and the new
TLLI (if any).
NOTE 5: Routing Area Update Complete message including the TLLI and TMSI.
NOTE 6: TMSI Reallocation Complete message including the TMSI.
Figure 2.8: Combined routing area and location updating in the same VLR
When the VLR does not change the TMSI, the old TMSI will stay in use and there
is no need to send any TMSI to the MS.
In case of combined routing area update and inter-VLR location area updating
procedure, the old TMSI will be cancelled and the HLR is updated as described
in 3GPP TS 23.060.
If the Location Updating message indicates a reject (if for example the MS try
to enter a forbidden location area), then this should be indicated to the MS
and the MS shall not access non-GPRS service until a successful Location
Update is performed.
For the combined location and routing area update and the combined GPRS Attach
and IMSI Attach for GPRS class A and B mobiles, the authentication is
performed by the SGSN. The authentication procedure for GPRS is described in
annex D. The MSC/VLR relies on the SGSN authentication. This authentication
procedure generates no ciphering key for circuit switched ciphering.
The ciphering key for circuit switched operation is allocated through an
authentication by MSC/VLR when the circuit switched service is requested.
Also, the MSC/VLR may use the old ciphering key if existing.
# 3 Subscriber identity authentication
## 3.1 Generality
The definition and operational requirements of subscriber identity
authentication are given in 3GPP TS 42.009.
The authentication procedure will also be used to set the ciphering key (see
clause 4). Therefore, it is performed after the subscriber identity
(TMSI/IMSI) is known by the network and before the channel is encrypted.
Two network functions are necessary: the authentication procedure itself, and
the key management inside the fixed subsystem.
## 3.2 The authentication procedure
The authentication procedure consists of the following exchange between the
fixed subsystem and the MS.
\- The fixed subsystem transmits a non-predictable number RAND to the MS.
\- The MS computes the signature of RAND, say SRES, using algorithm A3 and
some secret information: the Individual Subscriber Authentication Key, denoted
below by Ki.
\- The MS transmits the signature SRES to the fixed subsystem.
\- The fixed subsystem tests SRES for validity.
The general procedure is schematized in figure 3.1.
NOTE: IMSI is used to retrieve Ki in the network.
Figure 3.1: The authentication procedure
Authentication algorithm A3 is specified in annex C.
## 3.3 Subscriber Authentication Key management
The Subscriber Authentication Key Ki is allocated, together with the IMSI, at
subscription time.
Ki is stored on the network side in the Home Public Land Mobile Network
(HPLMN), in an Authentication Centre (AuC). A PLMN may contain one or more
AuC. An AuC can be physically integrated with other functions, e.g. in a Home
Location Register (HLR).
### 3.3.1 General authentication procedure
When needed for each MS, the BSS/MSC/VLR requests security related information
from the HLR/AuC corresponding to the MS. This includes an array of pairs of
corresponding RAND and SRES. These pairs are obtained by applying Algorithm A3
to each RAND and the key Ki as shown in figure 3.1. The pairs are stored in
the VLR as part of the security related information.
The procedure used for updating the vectors RAND/SRES is schematized in figure
3.2.
NOTE: The Authentication Vector Response contains also Kc(1..n) which is not
shown in this and the following figures. For discussion of Kc see clause 4.
Figure 3.2: Procedure for updating the vectors RAND/SRES
When an MSC/VLR performs an authentication, including the case of a location
updating within the same VLR area, it chooses a RAND value in the array
corresponding to the MS. It then tests the answer from the MS by comparing it
with the corresponding SRES, as schematized in figure 3.3.
Figure 3.3: General authentication procedure
### 3.3.2 Authentication at location updating in a new VLR, using TMSI
During location updating in a new VLR (VLRn), the procedure to get pairs for
subsequent authentication may differ from that described in the previous
subclause. In the case when identification is done using TMSI, pairs for
authentication as part of security related information are given by the old
VLR (VLRo). The old VLR shall send to the new VLR only those pairs which have
not been used.
The procedure is schematized in figure 3.4.
Figure 3.4: Authentication at location updating in a new VLR, using TMSI
### 3.3.3 Authentication at location updating in a new VLR, using IMSI
When the IMSI is used for identification, or more generally when the old VLR
is not reachable, the procedure described in subclause 3.3.2 cannot be used.
Instead, pairs of RAND/SRES contained in the security related information are
requested directly from the HPLMN.
The procedure is schematized in figure 3.5.
Figure 3.5: Authentication at location updating in a new VLR, using IMSI
### 3.3.4 Authentication at location updating in a new VLR, using TMSI, TMSI
unknown in \"old\" VLR
This case is an abnormal one, when a data loss has occurred in the \"old\"
VLR.
The procedure is schematized in figure 3.6.
Figure 3.6: Authentication at location updating in a new VLR, using TMSI,\
TMSI unknown in \"old\" VLR
### 3.3.5 Authentication at location updating in a new VLR, using TMSI, old
VLR not reachable
The case occurs when an old VLR cannot be reached by the new VLR.
The procedure is schematized in figure 3.7
Figure 3.7: Authentication at location updating in a new VLR, using TMSI, old
VLR not reachable
### 3.3.6 Authentication with IMSI if authentication with TMSI fails
If authentication of an MS which identifies itself with a TMSI is
unsuccessful, the network requests the IMSI from the MS, and repeats the
authentication using the IMSI. Optionally, if authentication using the TMSI
fails the network may reject the access request or location registration
request which triggered the authentication.
### 3.3.7 Re-use of security related information in failure situations
Security related information consisting of sets of RAND, SRES and Kc is stored
in the VLR and in the HLR.
When a VLR has used a set of security related information to authenticate an
MS, it shall delete the set of security related information or mark it as
used. When a VLR needs to use security related information, it shall use a set
which is not marked as used in preference to a set which is marked as used; if
there are no sets which are not marked as used then the VLR shall request
fresh security related information from the HLR. If a set of fresh security
related information cannot be obtained in this case because of a system
failure, the VLR may re-use a set which is marked as used.
"System failure" in this context means that the VLR was unable to establish
contact with the HLR, or the HLR returned a positive acknowledgement
containing no sets of security related information, or the HLR returned an
error indicating that there was a system failure or that the request was badly
formatted.
If the HLR responds to a request for security related information with an
indication that the subscriber is unknown or barred in the HLR, the VLR shall
not re-use security information which has been marked as used.
It is an operator option to define how many times a set of security related
information may be re-used in the VLR; when a set of security related
information has been re-used as many times as is permitted by the operator, it
shall be deleted.
If a VLR successfully requests security related information from the HLR, it
shall discard any security related information which is marked as used in the
VLR.
If a VLR receives from another VLR a request for security related information,
it shall send only the sets which are not marked as used.
If an HLR receives a request for security related information, it shall send
any sets which are not marked as used; those sets shall then be deleted or
marked as used. If there are no sets which are not marked as used, the HLR may
as an operator option send sets which are marked as used. It is an operator
option to define how many times a set of security related information may be
re-sent by the HLR; when a set of security related information has been sent
as many times as is permitted by the operator, it shall be deleted.
# 4 Confidentiality of signalling information elements, connectionless data
and user information elements on physical connections
## 4.1 Generality
In 3GPP TS 42.009, some signalling information elements are considered
sensitive and must be protected.
To ensure identity confidentiality (see clause 2), the Temporary Subscriber
Identity must be transferred in a protected mode at allocation time and at
other times when the signalling procedures permit it.
The confidentiality of connection less user data requires at least the
protection of the message part pertaining to OSI layers 4 and above.
The user information confidentiality of user information on physical
connections concerns the information transmitted on a traffic channel on the
MS-BSS interface (e.g. for speech). It is not an end-to-end confidentiality
service.
These needs for a protected mode of transmission are fulfilled with the same
mechanism where the confidentiality function is a OSI layer 1 function. The
scheme described below assumes that the main part of the signalling
information elements is transmitted on DCCH (Dedicated Control Channel), and
that the CCCH (Common Control Channel) is only used for the allocation of a
DCCH.
Four points have to be specified:
\- the ciphering method;
\- the key setting;
\- the starting of the enciphering and deciphering processes;
\- the synchronization.
## 4.2 The ciphering method
The layer 1 data flow (transmitted on DCCH or TCH) is ciphered by a bit per
bit or stream cipher, i.e. the data flow on the radio path is obtained by the
bit per bit binary addition of the user data flow and a ciphering bit stream,
generated by algorithm A5 using a key determined as specified in subclause
4.3. The key is denoted below by Kc, and is called \"Ciphering Key\".
For multislot configurations (e.g. HSCSD) different ciphering bit streams are
used on the different timeslots. On timeslot \"n\" a ciphering bit stream,
generated by algorithm A5, using a key Kcn is used. Kcn is derived from Kc as
follows:
Let BN denote a binary encoding onto 64 bits of the timeslot number \"n\"
(range 0‑7). Bit \"i\" of Kcn, Kcn(i), is then calculated as Kc(i) xor
(BN\ |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  | Allocation of TLLIn |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| Ciphered(TLLIn) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  | De-allocation of TLLIo |  |  |  |  |   
Figure D.2.1: Routing area updating in the same SGSN area
### D.2.3.2 Routing area updating in a new SGSN; old SGSN reachable
This procedure is part of the routing area updating procedure, using TLLI and
RAI, when the original routing area and the new routing area depend on
different SGSNs.
The MS is still registered in SGSNo (\"o\" for old or original) and requests
registration in SGSNn (\"n\" for new). RAI and TLLIo are sent by the MS as
identifying fields during the routing area updating procedure. The Routing
Area Update Request is not ciphered to allow the new SGSN to read RAI and
TLLIo.
The procedure is schematised in figure D.2.2.
MS |  |  |  |  |  | SGSNn |  | SGSNo |  | HPLMN |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---  
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| RAI, TLLIo |  |  | RAI,TLLIo |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| > |  |  | > |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  | IMSI |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| Acknowledge (note) |  |  | Acknowledge (note) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| > |  |  | > |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  | Cancellation |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  | old SGSN not reachable |  |  |  |  |  |  |  |  |  |  |  |   
| TLLI unknown (note 1) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| Management of means for new ciphering (see clause D4) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  | Allocation of TLLIn |  |  |  |  |  |  |  |  |  |  |  |   
| Ciphered(TLLIn) (note 2) |  |  | Update Loc. (note 2) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| Acknowledge (note 2) |  |  | Acknowledge (note 2) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| > |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  | De-allocation of TLLIo |  |  |  |  |   
Figure D.2.4: Reallocation of a new TLLI
### D.2.3.5 Local TLLI unknown
This procedure is a variant of the procedure described in subclauses D.2.3.1
and happens when a data loss has occurred in a SGSN and when a MS uses an
unknown TLLI, e.g. for a communication request or for a routing area updating
request in a routing area managed by the same SGSN. The SGSN indicates to the
MS that the TLLI is unknown and and the identification of the MS in clear is
necessary.
This procedure is schematised in figure D.2.5.
MS |  |  |  |  |  |  |  |  |  | SGSN |  | HPLMN |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---  
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| RAI, TLLIo (note 1) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| > |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  | TLLIo is unknown |  |  |  |  |  |  |  |   
| TLLI unknown (note 2) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| Management of means for new ciphering (see clause D4) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  | Allocation of TLLIn |  |  |  |  |  |  |  |   
| Ciphered(TLLIn) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
NOTE 1: Any message in which TLLIo is used as an identifying means in a
routing area managed by the same SGSN.
NOTE 2: From a security point of view, the exact signalling messages
(described in 3GPP TS 23.060) used to indicate that the TLLI is unknown, or to
send the IMSI are irrelevant.
Figure D.2.5: Routing area updating in the same SGSN area; local TLLI unknown
### D.2.3.6 Routing area updating in a new SGSN in case of a loss of
information
This variant of the procedure described in D.2.3.2 arises when the SGSN in
charge of the MS has suffered a loss of data. In that case the relation
between TLLIo and IMSI is lost, and the identification of the MS in clear is
necessary.
The procedure is schematised in figure D.2.6.
MS |  |  |  |  |  | SGSNn |  | SGSNo |  | HPLMN |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---  
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| RAI, TLLIo |  |  | RAI,TLLIo |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| > |  |  | > |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  | Unknown |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| TLLI Unknown(note 1) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| Management of means for new ciphering (see clause D4) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  | Allocation of TLLIn |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| Ciphered(TLLIn) (note 2) |  |  | Update location (note 2) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| Acknowledge (note 2) |  |  | Acknowledge (note 2) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| > |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  | generate RAND(1..n) |  | Ki |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  | V |  |  | V |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  | A3 |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  | Authentication Vector Response |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  | 
                                                                           V        V      
                                                                           =
                                                                           V               
                                                                           yes/no
* * *
Figure D.3.3: General authentication procedure
### D.3.3.2 Authentication at routing area updating in a new SGSN, using TLLI
During routing area updating in a new SGSN (SGSNn), the procedure to get pairs
for subsequent authentication may differ from that described in the previous
subclause. In the case when identification is done using TLLI, pairs for
authentication as part of security related information are given by the old
SGSN (SGSNo). The old SGSN shall send to the new SGSN only those pairs which
have not been used. SGSNn may also request the triplets directly from HLR.
The procedure is schematised in figure D.3.4.
* * *
        MS                                     SGSNn                         SGSNo      HPLMN
               RAI, TLLIo      TLLIo, RAI                                                                            
               \>              \>
                               IMSI                                                                                  
        Ki                     RAND(1..n)                                                                            
                               SRES(1..n)                                                                            
               RAND            \  
=
                                               V                                                                     
                                               yes/no
                                                        Update Location
* * *
Figure D.3.4: Authentication at routing area updating in a new SGSN, using
TLLI
### D.3.3.3 Authentication at routing area updating in a new SGSN, using IMSI
When the IMSI is used for identification, or more generally when the old SGSN
is not reachable, the procedure described in subclause D.3.3.2 cannot be used.
Instead, pairs of RAND/SRES contained in the security related information are
requested directly from the HPLMN.
The procedure is schematised in figure D.3.5.
* * *
        MS                                        SGSNn                               HPLMN
               IMSI      Sec. Rel. Info Req.                                                                       
               \>        \>                                                                                        
                         (IMSI)
                         RAND(1,..n)                                                                               
        Ki     RAND      \  
=
                                                  V                                                                
                                                  yes/no
                                                           Update Location
* * *
Figure D.3.5: Authentication at routing area updating in a new SGSN, using
IMSI
### D.3.3.4 Authentication at routing area updating in a new SGSN, using TLLI,
TLLI unknown in \'old\' SGSN
This case is an abnormal one, when a data loss has occurred in the \'old\'
SGSN.
The procedure is schematised in figure D.3.6.
* * *
        MS                                                  SGSNn                         SGSNo      HPLMN
               RAI, TLLIo        RAI, TLLIo                                                                                       
               \>                \>
                                 Unknown                                                                                          
               TLLI Unknown      \                Sec. Rel. Info Req.                                                                              
                                 \>                                                                                               
                                 (IMSI)
                                 RAND(1..n) SRES(1..n)                                                                            
                                 \  
=
                                                            V                                                                     
                                                            yes/no
                                                                     Update Location
* * *
Figure D.3.6: Authentication at routing area updating in a new SGSN, using
TLLI, TLLI unknown in \'old\' SGSN
### D.3.3.5 Authentication at routing area updating in a new SGSN, using TLLI,
old SGSN not reachable
The case occurs when an old SGSN cannot be reached by the new SGSN.
The procedure is schematised in figure D.3.7
| MS |  |  |  |  | SGSNn |  |  | SGSNo |  | HPLMN |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---  
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  | RAI, TLLIo |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  | > |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  | SGSNo not reachable |  |  |  |  |  |  |  |  |  |  |  |   
|  | TLLI Unknown |  |  |  | Sec. Rel. Info Req. |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  | > |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  | (IMSI) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  | RAND(1..n) SRES(1..n) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  | = |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  | V |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  | yes/no |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  | Update Location |  |  |  |  |  |  |  |  |  |  |  |   
Figure D.3.7: Authentication at routing area updating in a new SGSN, using
TLLI, old SGSN not reachable
### D.3.3.6 Authentication with IMSI if authentication with TLLI fails
If authentication of an MS which identifies itself with a TLLI is
unsuccessful, the network requests the IMSI from the MS, and repeats the
authentication using the IMSI. Optionally, if authentication using the TLLI
fails the network may reject the access request or location registration
request which triggered the authentication.
### D.3.3.7 Re-use of security related information in failure situations
Security related information consisting of sets of RAND, SRES and a ciphering
key (GPRS-Kc) is stored in the SGSN and in the HLR.
When a SGSN has used a set of security related information to authenticate an
MS, it shall delete the set of security related information or mark it as
used. When a SGSN needs to use security related information, it shall use a
set which is not marked as used in preference to a set which is marked as
used; if there are no sets which are not marked as used then the SGSN shall
request fresh security related information from the HLR. If a set of fresh
security related information cannot be obtained in this case because of a
system failure, the SGSN may re-use a set which is marked as used.
"System failure" in this context means that the SGSN was unable to establish
contact with the HLR, or the HLR returned a positive acknowledgement
containing no sets of security related information, or the HLR returned an
error indicating that there was a system failure or that the request was badly
formatted.
If the HLR responds to a request for security related information with an
indication that the subscriber is unknown or barred in the HLR, the SGSN shall
not re-use security information which has been marked as used.
It is an operator option to define how many times a set of security related
information may be re-used in the SGSN; when a set of security related
information has been re-used as many times as is permitted by the operator, it
shall be deleted.
If a SGSN successfully requests security related information from the HLR, it
shall discard any security related information which is marked as used in the
SGSN.
If a SGSN receives from another SGSN a request for security related
information, it shall send only the sets which are not marked as used.
If an HLR receives a request for security related information, it shall send
any sets which are not marked as used; those sets shall then be deleted or
marked as used. If there are no sets which are not marked as used, the HLR may
as an operator option send sets which are marked as used. It is an operator
option to define how many times a set of security related information may be
re-sent by the HLR; when a set of security related information has been sent
as many times as is permitted by the operator, it shall be deleted.
# D.4 Confidentiality of user information and signalling between MS and SGSN
## D.4.1 Generality
In 3GPP TS 42.009, some signalling information elements are considered
sensitive and must be protected.
To ensure identity confidentiality (see clause 2), the new TLLI must be
transferred in a protected mode at allocation time.
The confidentiality of user information concerns the information transmitted
on the logical connection between MS and SGSN.
These needs for a protected mode of transmission are fulfilled by a ciphering
function in the LLC layer. It is not an end-to-end confidentiality service.
Four points have to be specified:
\- the ciphering method;
\- the key setting;
\- the starting of the enciphering and deciphering processes;
\- the synchronisation.
## D.4.2 The ciphering method
The LLC layer information flow is ciphered by the algorithm GPRS-A5 as
described in 3GPP TS 41.061.
## D.4.3 Key setting
Mutual key setting is the procedure that allows the mobile station and the
network to agree on the key GPRS-Kc to use in the ciphering and deciphering
algorithms GPRS-A5. This procedure corresponds to the procedure described in
subclause 4.3 besides the different confidential subscriber identity. The
GPRS-Kc is handled by the SGSN independently from the MSC. If a MS is using
both circuit switched and packet switched, two different ciphering keys will
be used independently, one (Kc) in the MSC and one (GPRS-Kc) in the SGSN.
A key setting is triggered by the authentication procedure. Key setting may be
initiated by the network as often as the network operator wishes. If an
authentication procedure is performed during a data transfer, the new
ciphering parameters shall be taken in use immediately at the end of the
authentication procedure in both SGSN and MS.
Key setting may not be encrypted and shall be performed as soon as the
identity of the mobile subscriber (i.e. TLLI or IMSI) is known by the network.
The transmission of GPRS-Kc to the MS is indirect and uses the authentication
RAND value; GPRS-Kc is derived from RAND by using algorithm A8 and the
Subscriber Authentication key Ki, in the same way as defined in annex C for
Kc.
As a consequence, the procedures for the management of GPRS-Kc are the
authentication procedures described in subclause D.3.3.
The values GPRS-Kc are computed together with the SRES values. The security
related information (see subclause D.3.3.1) consists of RAND, SRES and GPRS-
Kc.
The key GPRS-Kc is stored by the mobile station until it is updated at the
next authentication.
Key setting is schematised in figure D.4.1.
* * *
                  MS                                                                    Network side
                                     RAI and TLLI or IMSI                                                                                    
                                     \>
                                     RAND                                                                                                    
                                     \ |  | > |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  | Routing area updating |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  | IMSI |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  | RAND |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  | SRES |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  | GPRS-Kc |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
| Ki | RAND |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
V |  |  |  |  |  |  | = |  |  |  |  |  |  |  |  |  |  |  |   
GPRS-Kc |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  | V |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  | yes |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  | start of ciphering |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  | Update location |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  | > |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  | Acknowledge |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  | Cancellation |  |  |  |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  | 
     IMM\_ASS                                                                                                                                                                                                                                                                                                                                                     
     \                                                                                                                                                                                                                                                                                                                      
                                                                                                                                           COM\_L3\_INFO                                                                                                                                                                                                          
                                                                                                                                           \-\-\-\-\-\-\-\-\-\-\-\-\-\--\>                                                            PROC\_ACC\_REQ                                                                                                              
     UA (SERVICE\_REQ)                                                                                         \-\-\-\-\-\--\>                                                                                                                                                                                                                                    
     \
                                                                                                               SETUP                                                                                                                                                                                                                                              
     \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>                     SEND\_INFO\_OUT                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                      \-\-\-\-\-\--\>
                                                                                                                                                                                                                                      COMPLETE\_CALL                                                                                                              
                                                                                                                                                                                                                                      \                                                                                         
                                                                                                                                                                                                                                      GCR\_INT\_ACK                                                                                                               
                                                                                                                                                                                                                                      (VK\_Id, VSTK\_RAND, VSTK, A5\_Id)                                                                                          
                                                                                                                                           ASS\_REQ                                                                                   \                                                                   ASS\_COMP                                                                                                                                                                                                                                          
                                                                                                                                           \-\-\-\-\-\-\-\-\-\-\-\-\-\--\>                                                                                                                                                                                        
                                                                                                                                                                                                                                      SETUP (to FN)                                                                                                               
                                                                                                               VGCS\_ASS\_REQUEST          \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>                                                                                                                                          
                                                                                                               (Group Id, VK\_Id,                                                                                                                                                                                                                                 
                                                                                                               VSTK\_RAND, VSTK,                                                                                                                                                                                                                                  
                                                                                                               A5\_Id) (NOTE 2, 3)   Txx                                                                                                                                                                                                                          
                                                                                                                                           \
* * *
* * *
MS\' MSs BSS MSC-A VLR GCR FNT MSC-R
* * *
* * *
                                                                                                                                                                                \|         PREPARE\_GROUP CALL\_ACK                                                                                                    
                                                                                                                                                                                \|         \                     
                                                                                                                                                                                \|                                                                                                                                     
                                                                                                                                                                                \|         CONNECT (from MSC-R)                                                                                                        
                                                                                                                                                                                \|         \                     
                                                                                                                                                                                \|                                                                                                                                     
                                                                                                        VGCS\_ASS\_RESULT                \|   CONNECT (from FN)                                                                                                                                                        
                                                                                                                                              \-\-\-\-\-\-\-\-\-\-\-\-\-\--\>   \_\_\|\_   \                                                            UPLINK\_RELEASE\_IND                                                                                                                                                                                           
                                                                                                                                              \-\-\-\-\-\-\-\-\-\-\-\-\-\--\>                                                                                                                                          
                                                                                                                                                                                           FORWARD\_GROUP CALL\_SIGNAL. (uplink rel ind)                                                                               
                                                                                                                                                                                           \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>                     
     CHAN\_RELEASE                                                                           CLR\_CMD                                                                                                                                                                                                                  
     \                                                                                                                                                                                    
     \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>                                                                                                                                                                                                                                                                           
     \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>
* * *
NOTE 1: If authentication and ciphering are performed, then the dedicated
channel of the originator of the voice group call is ciphered with the cipher
key Kc generated during the authentication procedure. If ciphering is started
without authentication, the cipher key indicated with CKSN in the Service
Request message is used.
NOTE 2: The Group Id and the Group cipher key number (VK_Id) are included in
the Descriptive group call reference.
NOTE 3: The permitted ciphering algorithm (A5_Id) is included in the
Encryption information.
NOTE 4: MS\' = calling subscriber mobile station;
MSs = destination subscriber mobile stations;
FNT = fixed network user terminal;
MSC-A = anchor MSC;
MSC-R = relay MSC.
Figure F.3.1-1: Distribution of ciphering data during establishment of a voice
group call
## F.3.2 Signalling information required for the voice group call uplink
access in the anchor MSC (normal case, subsequent talker on dedicated channel)
Figure F.3.2-1 shows how the MS and the BSC determine the Cipher Key Sequence
Number (CKSN) and Ciphering algorithm to use when the VGCS talker is switched
to a dedicated channel. The main points are:
\- The MS reads the CKSN and the individual cipher key Kc from the USIM and
passes the value to the BSC via the TALKER INDICATION Message
\- The CKSN is passed from the BSC to the MSC via the UPLINK REQUEST
CONFIRMATION message (within Layer 3 information).
\- The MS and BSC are informed of the ciphering algorithm identity in the
ASSIGNMENT COMMAND message.
* * *
MS BSS MSC-A MSC-R
* * *
* * *
     UPLINK\_FREE                                                                                                                                                                                                                                                   
     \                                                                UPLINK\_REQUEST                                                                                                                         
                                                                                                                            \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>                                                                                               
     VGCS\_UPLINK\_GRANT                                                                                                                                                                                                                                            
     \                                                                                                                                                                                                        
     UA (TALKER\_IND)                                                                                                                                                                               FORWARD\_GROUP CALL\_SIGN.                                      
     \
     UPLINK\_ REQ\_CONF (TALKER\_IND \[TMSI, CKSN\])                                                                                                                                                                                                                
                                                                                                                            \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>
                                                                                                                            ASS\_REQ (Kc)                                                           Dedicated channel                                               
     ASSIGNMENT\_CMD                                                                                                        \                                                                ASS\_COMP                                                                                                                               
                                                                                                                            \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>
     Conversation proceeds                                                                                                                                                                                                                                          
     \
     UPLINK\_RELEASE                                                                                                                                                                                                                                                
     \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>                                                                UPLINK\_RELEASE\_IND                                                                                                                    
                                                                                                                            \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>                                                                                             
     UPLINK\_FREE                                                                                                                                                                                   FORWARD\_GROUP CALL\_SIGN.                                      
     \
* * *
NOTE 1: In this case the MSC decided to transfer the subsequent talker to a
dedicated channel. The MSC includes the individual cipher key Kc indicated in
the Talker Indication message with CKSN.
NOTE 2: Upon reception of the ASSIGNMENT CMD message which transfers the MS
from the group call channel to a dedicated channel, the MS starts transmission
and reception on the dedicated channel in ciphered mode, using the ciphering
algorithm indicated in the cipher mode setting and using the individual cipher
key Kc.
NOTE 3: The network configuration has to take care that ciphering is applied
to a dedicated channel belonging to a ciphered VGCS Channel.
Figure F.3.2-1: Signalling information required for the voice group call
uplink access\ in the anchor MSC (normal case, subsequent talker on dedicated
channel)
## F.3.3 Signalling information required to transfer the originator or
subsequent talker from a dedicated channel to a group call channel
Figure F.3.3-1 shows the MS being transferred from a dedicated channel to the
group channel via the ASSIGNMENT COMMAND message. The main points are:
\- The group channel is ciphered with VGCS ciphering
\- The VK_Id, VSTK_RAND and Cell_Global_Count are supplied in the ASSIGNMENT
COMMAND message in order for the MS to calculate the voice group ciphering
keys.
* * *
MS BSS MSC-A MSC-R
* * *
* * *
     ASSIGNMENT\_CMD                                                                                                        (NOTE 1)                                          
     (VK\_Id, VSTK\_RAND, Cell\_global\_Count)                                                                                                                                
     \                                                                CLR\_REQ                                          
                                                                                                                            (Joined group call channel)                       
                                                                                                                            \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--\>         
                                                                                                                            CLR\_CMD                                          
                                                                                                                            \
     Conversation proceeds                                                                                                                                                    
     \
* * *
NOTE 1: In this case the BSC decided to transfer the originator or subsequent
talker to a group call channel.
NOTE 2: Upon reception of the ASSIGNMENT CMD message, if the Group cipher key
number is different from \'no ciphering\', the MS derives the cipher key V_Kc
and starts transmission and reception on the group call channel in ciphered
mode, using V_Kc.
Figure F.3.3-1: Signalling information required to transfer the originator or
subsequent talker from a dedicated channel to a group call channel
# F.4 Key derivation
The key derivation of the encryption is performed in two steps:
1\. derivation of a short term key VSTK on the GCR-side and USIM; VSTK_RAND
generation on the GCR-side and sending it to the ME via the BSS for use on the
USIM;
2\. derivation of the actual encryption key V_Kc in the BSS and ME.
Figure F.1: Key derivation
## F.4.1 Key derivation within the USIM / GCR
This function is performed on:
\- the set-up of a voice group or broadcast call by the GCR;
\- entry to a voice group or broadcast call by the USIM.
On the set-up of a voice group/broadcast call the GCR generates the VSTK_RAND
(See Annex G). Also an appropriate group key V_Ki (identified by VK_Id,
Group_Id and Service_type) is selected by the GCR. Using the function A8_V a
short term key VSTK is derived using as input parameters:
\- V_Ki (Group_Id , VK_Id, Service_type);
\- VSTK_RAND.
Output of A8_V is:
\- VSTK
Figure F.2
The GCR sends the parameters Group_Id, VK_Id, VSTK_RAND, VSTK, A5_Id via the
anchor-MSC and the relay-MSC\'s to the BSS. The BSS signals the Group_Id,
VSTK_RAND and VK_Id to the ME.
On the ME-side, each ME sends the Group_Id of the voice group or broadcast
call, the identifier of the key VK_Id, the Service_type and the VSTK_RAND to
the USIM. The USIM performs the calculation of the short term key VSTK using
the function A8_V and returns it (together with the encryption algorithm
identifier A5_Id).
## F.4.2 Key derivation within the ME/BSS
This function is performed by the ME on:
\- entry to a voice group/broadcast call;
\- cell reselection;
\- changing of the value of CELL_GLOBAL_COUNT;
\- Handover.
On the network side the function is performed by the BSS on
\- set-up of a voice group/broadcast call in a cell;
\- changing of the value of CELL_GLOBAL_COUNT.
For each cell the BSS and ME calculate an encryption key V_Kc using the key
modification function KMF. Input parameter of the KMF are:
\- VSTK: the short term key for this voice call group and this call;
\- CGI: the cell global identifier which identifies a cell world-wide
uniquely;
\- CELL_GLOBAL_COUNT: this parameter shall be incremented by the BSS when the
TDMA-frame-number wraps around.
NOTE: The MS and network SHALL be aligned regarding the value of the
CELL_GLOBAL_COUNT. In case of transmissions on the FACCH, this requires that
the network transmits a part of the whole of the TDMA frame number together
with the CELL_GLOBAL_COUNT.
The output of the key modification function is the actually cipher key V_Kc.
Figure F.3
To provide the required information to the ME the parameters CELL_GLOBAL_COUNT
and CGI are included in various messages from the BSS to the ME (i.e.
CELL_GLOBAL_COUNT on the NCH, FACCH and PCH, and the CGI on the BCCH and the
FACCH).
## F.4.3 Encryption algorithm selection
The encryption algorithm identifier A5_Id is stored in the GCR and the USIM.
For each group key V_Ki(Group_Id, VK_Id_, Service_type) there is a unique
A5_Id.
A5_Id is transmitted from the GCR to the BSS. The ME fetches the A5_Id
together with the VSTK from the USIM.
NOTE 1: It is possible that different algorithm identifiers are bound to
different V_Ki of the same group.
NOTE 2: The algorithm identifier A5_Id stored in the GCR and on the USIM shall
match with the encryption capabilities of the ME's used by the group and the
BSS where the voice group calls are allowed to take place.
## F.4.4 Algorithm requirements
### F.4.4.1 A8_V
The key derivation function A8_V has the following input and output parameter:
Input Parameter:
VSTK_RAND: 36 bit value (see annex G);
V_Ki (Group_Id, VK_Id, Service_type): 128 bit secret key;
Output:
VSTK: 128 bit short term key
A8_V is an operator specific algorithm. The calculation time for A8_V shall
not exceed 500 ms.
A8_V is implemented in the GCR and on the USIM.
### F.4.4.2 KMF
The key derivation function KMF has the following input and output parameter:
Input Parameter:
VSTK: 128 bit short term key;
CGI: the cell global identifier: 56 bit (TS 23.003 [F6]);
CELL_GLOBAL_COUNT: 2 bit.
Output:
V_Kc 128 bit encryption key.
The KMF is implemented in the BSS and in the ME.
The specification of KMF can be found in clause F.6
# F.5 Encryption of voice group calls
For the encryption of a voice group call the same encryption algorithms are
used as for a normal GSM speech call. Which algorithm out of the algorithm
suite A5/x is used is determined by the identifier A5_Id, which is stored on
the USIM (together with the group key V_Ki(Group_Id, VK_Id, Service_type)).
The algorithm A5/X is used in the same way as in the GSM (see clause C.1)
using the key V_Kc as encryption/decryption key Kc as input to A5/x.
If the key length KL of the encryption algorithm A5/X is shorter than the
length of V_Kc (128 bit) then only bits [0] to [KL-1] of V_Kc are used.
Figure F.4
# F.6 Specification of the Key Modification Function (KMF)
SHA‑1 (FIPS PUB 180‑1 [F7]) is used for generating V_Kc:
V_Kc= SHA-1(VSTK \| CGI \| CELL_GLOBAL_COUNT \| VSTK)
From the 160 bit output of SHA-1, the bits numbered as [0] to [127] are taken
as 128 bit V_Kc.
###### ## Annex G (informative): Generation of VSTK_RAND
All data variables in this Annex are presented with the most significant
substring on the left hand side and the least significant substring on the
right hand side. A substring may be a bit, byte or other arbitrary length
bitstring. Where a variable is broken down into a number of substrings, the
leftmost (most significant) substring is numbered 0, the next most significant
is numbered 1, and so on through to the least significant.
Since the length of VSTK_RAND (36 bits) is small, care should be taken that a
VSTK_RAND isn't generated twice (so-called collision) during the lifetime of
V_Ki. On the other hand, the predictibility of VSTK_RAND shall be avoided. The
following scheme could be used in order to generate 4096 VSTK_RAND for each
V_Ki with a probability \< 10^-6^ that a collision occurs.
NOTE: A collision probability of \<10^-4^ could still give a sufficient
security margin and may allow, depending on the VSTK_RAND structure that is
chosen, that more VSTK can be generated from one V_Ki.
The GCR maintains a COUNTER (12 bits) for each voice group. After each
generation of a VSTK_RAND for a specific voice group, COUNTER for that voice
group is incremented by one.
The left most 12 bits (COUNTER) of VSTK_RAND are set to COUNTER. The remaining
24 bits (RANDOM) are generated randomly, i.e. unpredictably for each new
VSTK_RAND.
Therefore VSTK_RAND = COUNTER \| RANDOM.
NOTE: For security reasons, any adopted scheme shall contain at least 24 true
random bits.
If COUNTER wraps around, a new V_Ki is required for that group.
Table G.1 gives the maximum number of voice group calls that are possible with
a full random generated VSTK_RAND:
Table G.1: Maximum number of voice group calls that are possible with a with a
full random generated VSTK_RAND
* * *
Length of VSTK_RAND Max collision prob for fixed V_Ki Number of calls 36
10^-6^ 371 36 10^-4^ TBD371
* * *
Table G.2 gives the maximum number of voice group calls that are possible with
a VSTK_RAND, as structured in this annex.
Table G.2: Maximum number of voice group calls that are possible with a
VSTK_RAND
* * *
Total challenge length Length of counter Length of random part Max collision
prob for fixed V_Ki Max collision prob for one fixed counter Number of calls
for one fixed counter Total number of calls for fixed V_Ki 36 12 24 10^-6^
2.44 × 10^-10^ 1 4096 36 12 24 10^-4^ 2.44 × 10^-8^ 1 4096
* * *
Explanation of the columns of table G.2:
Max collision probability for fixed V_Ki: what we have determined, for
security reasons, should be the maximum probability that the same value of
VSTK_RAND (and hence the same value of VSTK) is used twice before the value of
V_Ki is changed. 10^-6^ is a strong security setting; 10^-4^ is not quite so
strong, but probably adequate.
Max collision probability for one fixed counter: : suppose that VSTK_RAND is
made up of N_c counter bits and N_r random bits. We assume that the counter
part will take all possible 2^N_c^ values before V_Ki is updated. Having
selected our required \"Max collision prob for fixed V_Ki\", this is the
corresponding maximum permitted probability that the same value of the N_r
random bits (and hence the same value of VSTK) is used twice for a fixed value
of the N_c counter bits.
#
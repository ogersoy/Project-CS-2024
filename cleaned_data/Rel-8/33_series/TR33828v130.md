# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document studies use cases, requirements and candidate solutions
for protecting the IMS media plane against eavesdropping and undetected
modification. Currently IMS media protection relies on security provided at
the lower layers. With Common IMS, it has become possible to use IMS over a
wide variety of access networks which provide varying levels of security and
in some cases no security at all. It is therefore desirable to study solutions
for securing the IMS media plane in a uniform manner across all access
networks. Furthermore, media transport in the core network, although generally
less vulnerable than in the access network, may also be realised in varying
ways with different levels of security. Therefore, the present document also
studies solutions for end-to-end protection of IMS media.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
> [1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
>
> [2] IETF Internet-Draft: \"Media Security Requirements\" draft-wing-media-
> security-requirements-00 (October 2006).
>
> [3] 3GPP TS 23.228: \"**IP Multimedia Subsystem (IMS); Stage 2** \".
>
> [4] 3GPP TS 26.234: \"Transparent end-to-end Packet-switched Streaming
> Service (PSS)\".
>
> [5] IETF RFC 4975: The Message Session Relay Protocol (MSRP).
>
> [6] IETF RFC 4976: Relay Extensions for the Message Sessions Relay Protocol
> (MSRP).
>
> [7] IETF RFC 4346: The Transport Layer Security (TLS) Protocol Version 1.1.
>
> [8] IETF RFC 4279: Pre-Shared Key Ciphersuites for Transport Layer Security
> (TLS).
>
> [9] IETF RFC 3851: Secure/Multipurpose Internet Mail Extensions (S/MIME)
> Version 3.1.
>
> [10] IETF RFC 4347: Datagram Transport Layer Security
>
> [11] IETF Internet-Draft draft-ietf-avt-dtls-srtp-06: Datagram Transport
> Layer Security (DTLS) Extension to Establish Keys for Secure Real-time
> Transport Protocol (SRTP) (work in progress)
>
> [12] IETF Internet-Draft draft-ietf-sip-dtls-srtp-framework-05: Framework
> for Establishing an SRTP Security Context using DTLS (work in progress)
>
> [13] IETF RFC 4474: Enhancements for Authenticated Identity Management in
> the Session Initiation Protocol
>
> [14] IETF RFC 4916: Connected Identity in the Session Initiation Protocol
> (SIP)
>
> [15] E.-J. Goh, D. Boneh, P. Golle, B. Pinkas, \"The Design and
> Implementation of Protocol-Based Hidden Key Recovery\", 2003.\
> http://crypto.stanford.edu/~pgolle/papers/escrow.pdf
>
> [16] IETF Internet-Draft draft-wing-sipping-srtp-key-04: Secure Media
> Recording and Transcoding with the Session Initiation Protocol (work in
> progress, expired)
>
> [17] IETF Internet-Draft draft-wing-avt-dtls-srtp-key-transport-02: DTLS-
> SRTP Key Transport (work in progress)
>
> [18] 3GPP TR 23.894: \"System enhancements for the use of IMS services in
> local breakout and optimal routing of media\"
>
> [19] 3GPP TS 33.210: \"3G security: Network Domain Security (NDS): IP
> network layer security\"
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**Application layer security:** In the context of the present document,
application layer security is security applied on payload data and it is
independent of the transport mechanism used.
**Channel security:** In the context of the present document, channel security
is security applied on data and it is dependent of used transport mechanism or
transport identities.
**IMS User Equipment:** User equipment used for IMS media communications over
access networks. The presence of the UICC in this equipment is optional when
the equipment does not support any 3GPP access technology. In the case where
the user equipment is used for IMS media communications over any 3GPP access
network, the IMS User Equipment shall contain a UICC.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
\ \
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
NSPS National Security and Public Safety
QoE Quality of Experience
# 4 Use cases
Editor\'s Note: Further use cases need to be elaborated upon. In addition,
further study is needed on the priority of the use cases to help determine
which use cases should be addressed by the solution. The resulting
requirements should be added to clause 5. The mapping between use cases and
requirements in clause 5 should be added. References to the requirements in
clause 5 may be given directly within the description of the use cases, to
provide a clear relation of use cases to requirements.
## 4.1 Usage models
### 4.1.1 General
IMS media security may serve different purposes and its relevance for
different user groups may vary according to its design and features. The main
division of users into groups that may have different requirements on an IMS
media security solution is: the general public (private persons), enterprise
users, and users from National Security, Public Safety or other governmental
organizations (NSPS users).
A first purpose could be to have secure media over all access networks, a
second could be to specify an end-to-end media security solution to satisfy
the general public, while a third could be to provide high quality end-to-end
media security for important user groups like enterprises, National Security
and Public Safety (NSPS) organizations and different government authorities,
etc.
It should be noted that the protocols for the actual media plane protection
are uncontroversial as the working assumption is to use well established
protocols like SRTP and PSK-TLS. Thus the open issues are with respect to how
the key management solution is designed and where the end-points for the media
protection are located. Figure 1 gives an overview of the security endpoints
that may be involved.
Figure 1: Illustration of the different types of media security endpoints
When the IMS network is trusted, transmitted media may be protected only
between the UE and a Media Security Function (MSF) at the edge of the IMS.
This case is shown as end-to-access-edge (e2ae). The case when one or more
network nodes should be allowed to have access to the plaintext media is
denoted end-to-middle-to-end (e2m2e). In cases when media should be forwarded
over legacy systems we have an end-to-middle (e2m) use case in which the
security is terminated in the network. Finally, there is a "true" end-to-end
(e2e) security use case in which only the end-point UEs have access to
plaintext media.
To handle these use cases the terminals and the network may communicate the
security capabilities and the desired/accepted security functionality.
Terminals need not necessarily be able to differentiate all the different
cases shown in the figure above and the exact functionality is ffs.
### 4.1.2 Access media protection
The target for access media protection is to establish a security level for
IMS media over access networks which would be comparable with the access
protection in cellular systems. Such a solution is definitely 3GPP IMS
internal and it has no interoperability requirements against other SIP based
systems. It is an operator provided and controlled service.
Access media protection would have its main application in IMS systems where
the access network does not offer security. It should have the same
characteristics as access security in cellular networks, i.e. it should be
automatic and in principle invisible to the user. The user experience would be
as for an unprotected call.
In the access media protection usage model the user registers his access media
protection enabled terminal with the IMS system. If the system supports access
media security all media paths will be protected between the terminal and a
node in the IMS access edge. This means that all services will operate as in
an unprotected system and access media protection will not have impact on
their workings and implementation. An indicator in the terminal may inform the
user if no access security is provided.
### 4.1.3 End-to-end protection
For the general public, the peer-to-peer voice call will initially be the most
significant use case (so requirement 44 is relevant). While these users do not
have specific security policies, it can still be expected that they understand
and value the feature that such a voice call can be encrypted in a way that
\"attackers in the Internet\" have no chance to eavesdrop on the
communication. (Users may have less concerns about the security of the
operator-controlled part of the network, so, among the security requirements
from clause 5.4, requirement 6 may be the most relevant for this use case.)
Users will understand that it is not sufficient to secure only a part of the
connection and that end-to-end protection is needed (potentially protecting
all the hops separately) ( requirement 21). Note that such a protection
feature is already known to the public, e.g. by its usage in Skype.
Users may also understand that encrypted calls are not possible, if the called
party does not support encryption. However, they will appreciate it if the
protection feature is available not only for a small group of communication
peers. This implies that interoperability with communication peers outside the
IMS or peers using IMS terminal compliant to Releases prior to the
introduction of IMS media security in 3GPP specifications would be beneficial
( requirement 27).
On the other hand, it is not likely that many users are willing to be charged
significantly for the encryption feature (which implies that the solution has
to be cost efficient for the operator  requirements 34, 35, 25, 26, 28, 38),
and that they would accept degradation of the service performance caused by
encryption ( requirement 36). Also, most users most probably prefer
\"automatic protection\" (requirement 38 and 47).
Peer-to-peer voice call is as mentioned above initially expected to be the
most significant use case. Over time, it is however expected that IMS will
offer a rich set of services and that the users will use this services
increasingly. For example, instant messaging is a popular service today, and
it can be expected that also IMS users will be interested in such a service.
It can be expected that users value protection of their instant messaging, as
for their voice calls. As another example, users also frequently use voice
mailboxes today. For this case, users may desire that the confidentiality of
the data is upheld even while stored in the mailbox.
### 4.1.4 Enhanced end-to-end protection
Many user groups have well established security requirements for protection of
their communication, e.g. enterprises, NSPS organizations, and government
authorities. The trust model adopted in these cases is based on a need-to-know
model. Keys should only be available where needed and only in authorized
entities. The same is of course true also for plaintext media. An end-to-end
protection should preferably also securely indicate the identities of the
caller and the callee.
To serve the different user groups\' different requirements, there has to be
user control of the application of end-to-end media protection. Some
organizations may prefer to have security initiated by specific user request
to make sure that the user takes notice that security is turned on or not,
some may want to apply security based on the callee identity, and others would
like to configure it as an automatic service used without user intervention.
The user must have access to full information about the security status of his
call and warnings may be required if default security options are not complied
with. However, a user should be able to configure the security set-up to give
the same user experience as when making an unprotected call.
The user registers his end-to-end media capabilities and preferences with the
IMS system. The system may support end-to-end media security by providing
gateways for interoperability with legacy systems, transcoding, end-to-end
protected store and forward of media, etc. All this has of course to be based
on a user policy allowing it. A user may then either configure his device to
always try to use media security, or he can indicate manually or in his
address book when media security should be used.
## 4.2 Multimedia telephony
### 4.2.1 General
Clause 4.2 is about use cases where end-to-end media security is a
requirement. If access security is the only requirement, there are no use case
specific aspects on security.
NOTE: The use of the term \"multimedia telephony\" in this clause is not
limited to the definition in TS 22.172.
### 4.2.2 Peer-to-peer
The most common use case for multimedia telephony is a call from one peer to
another. Usually the call is made directly between the initiating terminal and
a terminal used by the designated receiver. However, sometimes the receiver
has set up call forwarding to some other user's terminal. In other cases the
call may be directed to more than one terminal (forking). A typical scenario
which combines both call forwarding and forking is when the phones of a
manager and his assistant ring simultaneously and the call is forwarded to a
voice mailbox if neither of them answers the call. At call initiation or
latest when the connection has been established the originating and the
terminating user's identities should be displayed at the other end. Only the
party picking up the call should have access to the plaintext media.
The security settings for the call indicate if and how media security should
be used. The user may indicate if end-to-end security is requested, or if end-
to-middle-to-end security is acceptable. The latter allows trusted network
nodes to access the clear text content to be able to perform e.g. transcoding.
If a call is started in unprotected mode it is possible to initiate security
during the ongoing call. The user may determine if use of security is
independent of the terminating user/subscriber identity or if it only should
be used if the call is terminated at a defined (set) of user/subscriber(s).
Note further that there is a trade-off between these security configuration
options and usability requirements.
### **4.2.3 Non** RTP **based media**
Multimedia telephony includes non-RTP based media such as text communication,
file transfers, video clip sharing, picture sharing, audio clip sharing, etc.
Such media is normally MIME encoded and transported over MSRP [5][6] with
media set-up in SDP. Information carried over MSRP may, according to the
standards [5] [6], be protected by (PSK-)TLS [7] [8] on a point-to-point basis
or by using S/MIME [9]. The standard solutions available thus either only give
a point-to-point protection or rely on public-key cryptography.
### 4.2.4 Deferred delivery
One use case of particular interest is when a call ends up in a voice or other
media mailbox in the network. In this case it may be beneficial if the media
payload could be stored by the mailbox in the same encrypted format as it is
sent in, i.e. without any decryption of the ciphering protecting it. When the
end user later accesses the encrypted media in the mailbox it should be sent
without having to perform re-encryption. Whether avoiding decryption and re-
encryption at the mailbox for other than security reasons is ffs. In either
case, channel security, specifically replay and integrity protection of the
communication between the end-point and mailbox is necessary. PSS [4] is an
example of how RTP payload media protection can be combined with transport
security. Deferred delivery of end-to-end protected media would require an
end-to-end security association for application layer security and security
association per hop for channel security where the hop-by hop security
associations might be derived from the end-to-end security association.
Deferred delivery of end-to-end protected media may require a key management
system which does not depend on the identity of transmission end-points but
should depend on the identities of the sender and intended receivers. This
type of deferred delivery may require new media set-up signaling and new media
protection mechanisms or a combination of existing ones. It will however not
be a problem for the caller to, if needed, determine the type of the
terminating device. as signalling of capabilities already is part of SIP.
### 4.2.5 Group and conference calls
Another use case is in group communication, e.g. conference calls with true
end-to-end security. In one realization of this type of service all users have
access to the same key, the group key. In another realization separate group
keys per sender are used. If support of large groups is out of scope, as it
would be for normal size conference calls, group key management could be based
on naïve schemes, e.g performing distribution of the group key directly from a
key management server to each user in the group. If true end-to-end security
isn't required, the conference bridge may decrypt and then re-encrypt the
media and other solutions will be available, e.g. protecting the communication
between a user and the conference bridge using user unique keys. Note that a
conference bridge needs access to media in cleartext for a type of group
communication where participants expect the bridge to mix media streams, like
in a normal conference call. Still group key management could yield simple and
efficient solutions also for this case. **Note that use of group keys is not
the only solution for securing conferences.**
### 4.2.6 Conclusions
The conclusions from the multimedia telephony use cases described above are
that it would increase the applicability of the key management system if it,
in addition to straightforward point-to-point channel protection also could
support group keying, application layer security and deferred delivery of end-
to-end protected media. The key management system should also be generic in
the sense that it is easy to introduce keying for new services. Media can be
RTP-media and/or different types of text, video, and picture
streams/files/formats.
It should be noted, however, that existing security protocols (like TLS or
SRTP) that may be used to protect multimedia telephony services have
considerably different requirements with respect to security context
management. It may therefore make sense to reduce complexity by offering
optimized solutions for major use cases, e.g. a key management system focussed
on RTP based traffic (voice or video calls as well as media streaming).
## 4.3 Push-to-talk (PoC)
Push-to-talk systems are in principle store and forward systems with message
replication for all intended receivers taking place in the PoC server. PoC
systems also often support instant messaging. Furthermore, it should be noted
that PoC systems may offer automatic functions for recording of all messages a
user cannot receive "on-line". Thus, for true end-to-end security PoC systems
exhibit the same requirements on key management and media protection as the
multimedia telephony described above, i.e. a group key management system
capable of handling deferred delivery of media. A PoC system doesn't only
handle voice but also handles other media types like e.g. video and text.
## 4.4 Instant messaging
Instant messaging systems have many similarities with PoC systems, the main
difference is that they focus on non-speech media even though they may also
carry voice and video messages.
For peer-to-peer instant messaging, there might be a direct link between the
peers but in most cases, due to charging and delivery of different types of
system services, the messages are forwarded via one or more intermediary
nodes. For multiuser instant messaging, messages are routed to an instant
messaging server where they are replicated and sent to all intended receivers.
The messages might be carried in the signalling path in e.g. SIP MESSAGEs or
they can be transferred e.g. on MSRP links. To protect messages carried in SIP
MESSAGE, application layer security may be used. MSRP links can be protected
hop-by hop with TLS or with S/MIME (see clause 4.2.3). **Alternatively, SIP
MESSAGE messages may rely on the protection mechanisms that are recommended
for SIP traffic in general, e.g. TLS or IPsec in the access, or Za/Zb
interfaces in the core [19].**
## 4.5 Chat
Chat differs to a certain extent compared to the use cases described above.
Here chat messages usually end up in the chat server where they are handled in
plaintext. It is difficult to imagine how an efficient chat service based on
true end-to-end security could be developed. Thus here the security
requirements are mainly to protect the communication between the user and the
chat server. This communication may however be over multiple hops and require
the same type of protection of media as used to protect IM to achieve terminal
to chat server security.
## 4.6 Media on demand
Media on demand is a service delivered over IP-based networks managed to
provide the required level of QoS/QoE. While there may be many security
requirements on media on demand services such as IPTV, the focus of the work
in this present document is to study whether an IMS media security solution
can be used to protect the confidentiality and authentication of media on
demand during transit. It is not the objective of this study to design a
solution to protect broadcast services over IP networks, or to provide a
content rights management solution.
## 4.7 Transcoders
Transcoders are devices in the network that need to change the media coding or
make other necessary modifications of the media streams. For example RFC 4117
[4117] describes the usage of transcoders in the context of SIP showing
examples when media streams are \"transcoded\" between audio and text as one
of the communication endpoints could be deaf or hearing impaired.
As is described in clause 5.4.1 of TS 23.228 [3], the MGW may support
transcoding between a codec used by the UE in the IM CN subsystem and the
codec being used in the network of the other party. In general a MRFP may
perform transcoding and/or other media stream processing.
In order to support this use case media protection needs to be terminated at
the transcoder.
The current IMS architecture as described in TS 23.228 [3] has specified that
transcoding function may be present in the TrGW, the MRFP and the CS/IMS-MGW.
The local breakout and optimal media routing work in SA2 may define
requirements to provide the transcoding service via these Functional Entities
to media flows for roaming UE in the Visited packet switching network [18]
Hence it is necessary that the media security architecture shall not prevent a
visited network from providing transcoding service on behalf of flows for
roaming UE.
## 4.8 PSTN-GW
PSTN gateway provides interworking between IMS networks and circuit switched
PSTN.
According to clause 5.4.1 of TS 23.228 [3] the IM CN subsystem is also able to
interwork with the CS networks (e.g. PSTN, ISDN, CS domain of some PLMN) by
supporting, for example, AMR to G.711 transcoding in the IMS MGW element.
Furthermore to allow interworking between users of the IM CN subsystem and IP
multimedia fixed terminals and other codecs may (this is implementation
dependent) be supported by the MGW. I.e. MGW is expected to act as a PSTN-GW.
In order to support this use case media protection needs to be terminated at
the PSTN-GW.
{width="6.624305555555556in" height="2.9763888888888888in"}
Figure 2: A simplified view of PSTN -- IMS interworking
## 4.9 Termination of media security in an AS
An IMS session is not always setup between two UEs. It may also be terminated
in an Application Server (AS).
In order to support this use case media protection needs to be terminated at
the AS.
# 5 Requirements
## 5.1 Overview
The purpose of this clause is to identify 3GPP requirements for IMS media
plane security and to evaluate IETF media security requirements detailed in
[2] with respect to their relevance for 3GPP. The requirements are grouped
into various categories in order to ease discussion and to check for
completeness. A comment is added to some of the IETF requirements indicating
the relation to 3GPP media security requirements. When no comment is added
then this indicates that the IETF requirement seems acceptable for IMS. With
some of the IETF requirements a status of ffs (for further study) is indicated
showing that the requirement is still under discussion in the IETF.
Editor\'s Note: Evaluation of the latest version of the IETF requirements
needs to be performed.
## 5.2 Summary of requirements
**A solution/framework shall preferably provide a level of security that can**
satisfy the needs of different user groups, including private users,
enterprise and NSPS (National Security and Public Safety) related
organizations as far as possible. It shall cover well the most frequent use
cases. **It shall be cost efficient, scale well for a large number of
subscribers, shall not adversely affect the performance of IMS services and
shall have minimal impact on existing networks. It shall allow interworking
with non IMS-capable user equipment. It shall satisfy applicable lawful
interception requirements.** In case it turns out that there is no single
solution satisfying all these requirements, or that such a solution may lead
to undue complexity or delay in standardisation and/or deployment, it may be
acceptable to standardise more than one solution.
## 5.3 Lawful interception
3GPP Requirements:
  1. Lawful interception requirements shall be met.
  2. The lawful interception solution shall not require the operator to reveal information to the interception agent that would allow him to intercept user communications that are outside the terms of the intercept warrant.
  3. It shall not be possible for users to determine whether their communications are subject to lawful interception.
NOTE: Further study is needed on the exact requirements for lawful
interception.
## 5.4 Security
3GPP Requirements:
  1. It shall be possible to protect IMS user traffic against eavesdropping, modification, spoofing, and replay on access network interfaces and access network nodes.
  2. It should be possible to protect IMS user traffic against eavesdropping, modification, spoofing, and replay on core network interfaces and at core network nodes. Depending on the use case, the degree of protection against these threats provided for IMS user traffic shall be equal to or higher than that provided for IMS signaling traffic.
NOTE 1: It should be considered whether SA3 could relax this requirement so
that the decryption key could be revealed to IMS network elements and on some
core network interfaces.
  1. The level of security provided should satisfy operators and the most important user categories, whilst at the same time satisfying applicable lawful interception requirements. If this level of security is insufficient for high security user groups, an enhanced solution may be additionally provided.
  2. A key management solution shall prevent a party engaging in a key exchange with a spoofed user identity (i.e. IMPI/IMPU) without being detected.
IETF Requirements:
  1. A solution MUST provide protection against passive attacks.
  2. A solution SHOULD consider active attacks (ffs).
Comment: A 3GPP solution shall provide protection against active attacks on
access network interfaces and access network nodes. It should also be possible
to protect against active attacks on core network interfaces and at core
network nodes. Depending on the use case, the degree of protection against
these threats provided for IMS user traffic shall be equal to or higher than
that provided for IMS signaling traffic.
NOTE 2: Active attacks at core network nodes may be mitigated by measures,
such as e.g. hardening, local access control, provided independently of a
media plane security solution. This would allow simple key management
solutions to be adopted where the sender generates the end-to-end key and
sends it to the receiver in SDP according to e.g. RFC4568.
  1. A solution MUST be able to support Perfect Forward Secrecy.
Comment: Perfect Forward Secrecy is not considered to be required in a 3GPP
network.
  2. A solution MUST support algorithm negotiation without incurring per-algorithm computational expense.
  3. A solution MUST support multiple cipher suites without additional computational expense.
## 5.5 Requirements related to SIP based call features/SIP related problems
### 5.5.1 Forking and retargeting
IETF Requirements:
  1. Forking and retargeting MUST work with all end-points being SRTP.
NOTE: An important scenario for IMS media security is securing only one leg of
a communication rather than the e2e communication. In such end-to-middle
security scenarios, media security and key management signalling terminate at
network nodes, and forking/retargeting issues are not applicable.
  1. Forking and retargeting MUST allow establishing SRTP or RTP with a mixture of SRTP- and RTP-capable targets.
  2. With forking, only the entity to which the call is finally established, MUST get hold of the media encryption keys.
  3. A solution SHOULD allow to start with RTP and then upgrade to SRTP (ffs).
Comment: From an architectural point of view 3GPP does not consider this to be
a good approach. However, the requirement is for further study, as there are
possible usage scenarios for that approach. E.g. when calling a call center,
it may be reasonable to receive unencrypted general announcements before
proceeding to an encrypted individual conversation.
  4. Endpoint identification when forking. The Offerer must be able to associate answer with the appropriate flow endpoint. In case of forking one might not want to perform a DH with every party but instead to associate the SDP response with the right end point. This is a performance related requirement.
Comment: Forking and retargeting in 3GPP is for further study.
### 5.5.2 Early media/media clipping
IETF Requirements:
  1. A solution SHOULD avoid clipping media before SDP answer without additional signalling.
Comment: In a 3GPP architecture media clipping shall be avoided, even at the
cost of additional signalling.
### 5.5.3 Secure multiparty communications
3GPP Requirements:
  1. A key management solution shall support secure multiparty communications (i.e. key management to distribute a group key) where the server relaying multiparty communication (e.g. a conference bridge) does not know the group key.
  2. A key management solution shall support secure multiparty communications (i.e. key management to distribute a group key) where the server relaying multiparty communication (e.g. a conference bridge) knows the group key.
NOTE 1: This kind of group key could be used for example for conference call,
PoC, etc.
NOTE 2: Shared key conferencing is out of scope of the IETF media security
work.
## 5.6 Architectural
3GPP Requirements:
  1. Encryption and integrity protection of user media should be applied on an end-to-end basis, where possible, to save on network resources and to avoid restrictions on media plane routing.
  2. Where it is not possible to provide protection on an end-to-end basis due to cost or complexity reasons, then solutions should be developed which terminate user plane security in an appropriate network element (e.g. at a conference bridge, a transcoder, an application server or at interworking gateways with non-IMS networks).
22a. Since the network based termination is possible in the visited and home
packet switching networks and at terminating or originating side, the security
architecture should allow a transcoding function residing in the visiting
packet switching network to provide transcoding service to media flows for
roaming UE, even in cases where the P-CSCF and the transcoding function
resides in different operator domains.
  3. It should be possible for operators to be able to terminate media plane security in the network in some cases, e.g. if the operator needs access to the media for content control purposes.
  4. A solution SHOULD support media recording (ffs).
  5. Multiple solutions should be avoided to reduce complexity in the network and to maximise interoperability between user devices. However, in case it turns out that there is no single solution satisfying all these requirements, or that such a solution may lead to undue complexity or delay in standardisation and/or deployment, it may be acceptable to standardise more than one solution. If multiple solutions are standardised, then they shall be defined within a single framework.
NOTE: It is ffs whether re-use of IETF developed protocols such as MIKEY, SDES
and DTLS-SRTP can be used in 3GPP to satisfy this requirement.
  1. The requirement for new functions on the user's smartcard should be avoided unless it would provide significant and cost effective benefits.
  2. The solution should support the possibility to protect user traffic on an end-to-end basis between IMS-capable and user equipment which is non IMS-capable or conforming to a 3GPP Release prior to the introduction of IMS media security.
  3. The solution shall have minimal impacts on already deployed network entities.
  4. A media security solution shall assume that messages cannot be sent over the media path until the media session has been established.
NOTE 1: 3GPP and TISPAN networks will likely block all traffic on media path
until the media session has been established (i.e. until the initiator has
received the responder\'s answer in the 200 OK message).
  1. A media security solution shall assume that only media traffic can be sent over the media path.
NOTE 2: Media path nodes in 3GPP and TISPAN networks will likely not let
anything other than media traffic through, e.g. due to traffic policing.
  1. Media security solutions for media protection and key management shall cover both end-to-end and end-to-middle media protection scenarios.
NOTE 3: Whether the solutions (especially for key management) are the same or
different for end-to-end and end-to-middle scenarios may depend on
environment, cost and complexity reasons.
_IETF Requirements:_
  1. A solution MUST NOT require 3rd-party certificates. If two parties share an auth infrastructure they should be able to use it.
NOTE 4: While 3rd-party certificates are not acceptable for a solution for the
majority of users, the use of certificates, e.g. from an enterprise PKI, may
be acceptable for special user groups.
  1. From an architectural point of view solutions can exchange key exchange messages along the media path, along the signaling path or on both paths. A solution SHOULD operate along the media path and the signaling path.
Comment: In the 3GPP architecture the preferred solution is to perform the key
exchange messages in the signaling path only.
## 5.7 Scalability, cost and performance
3GPP Requirements:
  1. The solution should scale well for large numbers of users.
  2. The solution should be cost effective.
  3. The solution should not adversely affect performance of IMS services. In particular, there should be no significant increase in call set-up delay and no media clipping.
## 5.8 Requirements regarding the access network type
3GPP Requirements:
  1. The solution shall support the possibility to provide protection on an end-to-end basis between any IMS-capable UE regardless of what type of access technology they use (fixed DSL, WLAN, cellular, etc.)
  2. The key management solution should be based on the existing IMS access security architecture, so that no special user registration or user involvement is required, and so that existing infrastructure can be re-used.
  3. Since the IMS client may use different access authentication methods, both smartcard and non smartcard based, the key management solution for end-to-end security shall be able to work independently of any of these authentication methods.
## 5.9 Backward compatibility and migration
3GPP Requirements:
  1. Media security shall be mandatory to implement for UEs and networks and optional to use for UEs.
  2. The media security solution shall allow a UE to negotiate media security settings for each individual call.
  3. The negotiation of media security must be protected against downgrading attacks
IETF Requirements:
  1. A solution MUST allow a SIP UE to negotiate media security parameters for each individual session.
## 5.10 Other requirements
3GPP Requirements:
  1. A solution shall support the possibility to protect RTP-based IMS user plane traffic.
  2. A solution shall support the possibility to protect non RTP-based IMS user plane traffic as well as application layer messages, e.g. SIP MESSAGE. In case it turns out that a single solution may lead to undue complexity or delay in standardisation and/or deployment, it may be acceptable to standardise more than one solution. If multiple solutions are standardised, then they shall be defined within a single framework.
NOTE 1: An example use case for this requirement is Message Session Replay
Protocol (MSRP) RFC 4975.
NOTE 2: Even though in the example of SIP MESSAGE a signalling message is used
for transport, it can still be regarded as being part of the media plane since
it carries user content and may need similar protection, e.g. confidentiality,
as RTP and MSRP.
  1. VOID
  2. The media security solution should not require user intervention. It may, however, allow a certain degree of configurability and may support the indication of the security level of a session.
NOTE 3: Some key management solutions require user intervention in the sense
of reading aloud an authentication string to the other endpoint. This may be
an inconvenient user experience, especially for elderly or disabled persons.
  1. A party shall have the possibility to get assurance about the identity of any other party in the session when the party joins a point-to-point session.
Editor\'s Note: In particular, **is necessary to give the calling party
assurance about the identity of the responding party** (after forking, etc.).
It is explained in clause 7.3.2.2 and 7.1.4.4.5 how IMS mechanisms can be used
to satisfy this requirement in certain scenarios. The details of the
requirement are ffs. The corresponding requirements in the case of a point-to-
multipoint session are ffs.
  1. A calling party shall have the possibility to stay anonymous towards any called parties in the session.
  2. The user should be able to access information about the scope of protection (end to access edge, end-to-middle-to-end or end-to-end), applied security level (if needed). It should also be visible if any non-IMS operators are involved in the session set-up. This should be balanced against the usability of such a feature and complexity of realisation.
  3. It should be possible to configure the terminal to give a visible or audible warning when security is not according to a policy defined by the user.
  4. A key management solution shall support deferred delivery of media. In case it turns out that a single solution also supporting deferred delivery may lead to undue complexity or delay in standardisation and/or deployment, it may be acceptable to standardise more than one solution. If multiple solutions are standardised, then they shall be defined within a single framework.
IETF Requirements:
  1. A solution SHOULD support the possibility to protect non-RTP-based data traffic.
> Comment: This is covered by one of the 3GPP requirements listed above.
# 6 General aspects of solutions
## 6.1 Introduction
Editor's Note: Explains that there are end-to-middle and end-to-end
approaches. Refers to section 7 for specific solutions.
## 6.2 Architectural aspects of end-to-middle protection
### 6.2.1 Preferred endpoints for end-to-middle protection
A schematic diagram of an IMS system with controlling and media handling
entities is depicted in Figure 3.
Figure 3: IMS signalling and media plane entities
The media plane traffic may be routed in different ways depending on required
network supported functionality and in which type of system the terminating
device is present. Traffic between two IMS UEs in the same IMS domain could be
routed without involvement of any media node. The media can however be
anchored in the access edge via the IMS Access GW (e.g., for NAT traversal or
transcoding purposes), while at the same time ensuring that media traffic is
only routed locally (which may be a requirement for local breakout). Traffic
may also be routed via the home network to a MRFP for conferencing,
transcoding or other media handling functions. When the traffic is intended
for a subscriber in another domain/network, the media traffic is routed to an
interworking gateway (CS-MGW, IM-MGW or TrGW).
From a security point of view it would be preferable to terminate the media
plane security as far into the network as possible. This would mean that when
traffic is between an IMS domain and e.g. a legacy system, media plane
security should be terminated in the IM-MGW and when traffic is between IMS
UEs in the same domain the media plane security should be terminated in the
IMS Access GW. Such dynamic behaviour may, however, be problematic and may
incur a lot of complexities and added new functionality.
The discussion below takes a call initiated by the IMS UE in Figure 3 as a
starting point. Similar considerations hold when analysing handling of media
coming into the domain via an interworking gateway.
Looking at how a call is set-up, we first note that resource allocation for
media handling in SIP-proxies is performed when an INVITE is processed. This
means that when e.g. the P-CSCF/ALG, or another SIP proxy in the IMS
signalling path, handles an INVITE it has to decide if it should initiate
termination of the media plane security or if it should let the secured media
pass further into the network. This means that this SIP proxy will have to
apply a policy on whether to terminate media plane security or not do this.
If e2m protection is to be potentially performed in an IMS network then, in a
particular IMS network deployment, there shall be one dedicated SIP proxy in
the IMS signalling path, which is capable of handling e2m protection. It can
be determined by network configuration which SIP proxy shall take this role,
e.g. the P-CSCF, the S-CSCF or an MRFC. In cases where an IMS Access GW is
part of the media path anyhow, it would seem natural to assign this role to
the P-CSCF, which controls the IMS Access GW.
### 6.2.2 Interfaces for end-to-middle protection
Editor's Note: Describes the interfaces needed to pass media encryption keys
from the control plane entity to the media plane entity.
## 6.3 Co-existence of end-to-end and end-to-middle solutions
### 6.3.1 Introduction
This report discusses 3GPP standardization of e2ae and e2e media security.
Application of e2ae media security is mainly a network responsibility and if
the network considers it to be appropriate the network should offer all e2ae
capable IMS UEs this protection. Application of e2e media security should be
controlled by the user. If a user accepts network access to media for network
support functions like transcoding, this is not part of the capability
registration but should be handled in the actual media security set-up
procedure.
To get simple operational procedures and good usability, it is beneficial to
register the IMS UE\'s media security capabilities when the IMS UE registers.
The network can then base its decision on knowledge of the IMS UE's
capabilities. This is especially important in the terminating procedures, when
the network e.g should select the terminating device from a set of registered
devices belonging to the called user.
The set-up of media security is controlled in the signalling plane. Normally,
the initiator includes an offer for media security in the originating session
set-up. The parameters of such an offer should indicate the preferred media
security capability to use.
For e2ae media protection it would be beneficial if the initiator could
express a preference that the terminating side also should apply e2ae
protection. A notification back to the originator that this has occurred would
make this feature even more useful.
The following scenarios described by signalling flows have been written to be
independent of the particular security mechanism finally selected for key
management and media protection. Where applicable, they generalize the flows
in clause 7.2.3.
### 6.3.2 Registration procedures
Figure 4 shows an IMS registration procedure in which the IMS UE registers its
media security capability.
Figure 4: Registering Media security capabilities
The IMS UE performs an IMS registration according to 3GPP TS 23.228. When
performing the registration, the IMS UE (in Step 1) includes the supported
media security capabilities (end-2-access-edge or end-to-end). This can be
added to the registration message as any other capability.
When receiving the media security capability from the I-CSCF (Step 5), the
S-CSCF stores the capability of the IMS UE.
### 6.3.3 Originating procedures
#### 6.3.3.1 End-to-access-edge
Figure 5 shows the originating procedures for session establishment using e2ae
based security. In this scenario, the P-CSCF / IMS ALG is used to terminate
the media security negotiation, and the IMS Access Gateway hosting the MSF is
used to terminate the media security from the IMS UE.
Figure 5: Originating call flow for end-to-access-edge case
The IMS UE performs an IMS originating session setup according to 3GPP TS
23.228. When performing the session setup, the IMS UE (in Step 1) includes the
e2ae offer, and optionally an indication that it desires this capability to be
used for the terminating side as well.
The P-CSCF / IMS ALG is the termination point of the media security
negotiation.
When the offer response is received, the P-CSCF / IMS ALG may interact with
the IMS Access Gateway to setup the media security. The P-CSCF / IMS ALG
includes a media security answer in the offer response sent to the IMS UE.
Already at this point in time, both the IMS UE and network will have
sufficient credentials for the media security.
When the full session setup has completed, and media can be sent, the
protected media is sent between the IMS UE and IMS Access Gateway.
#### 6.3.3.2 End-to-end
Figure 6 shows the originating procedures for session establishment using e2e
based security.
Figure 6: Originating call flow for end-to-end case
The IMS UE performs an IMS originating session setup according to 3GPP TS
23.228. When performing the session setup, the IMS UE (in Step 1) includes the
e2e media security offer, and an indication that the e2e media security
capability is used.
When receiving the offer response, an e2e media security answer is included in
the case the terminating end point accepted the offer. Already at this point
in time, both the end points will have sufficient credentials for the media
security.
When the full session setup has completed, and media can be sent, the
protected media is sent on an end-to-end basis.
### 6.3.4 Terminating Procedures
#### 6.3.4.1 End-to-access-edge
Figure 7 shows the terminating procedures for session establishment using e2ae
based security. In this scenario, the P-CSCF / IMS ALG is used to originate
the media security negotiation towards the IMS UE, and the IMS Access Gateway
is used to terminate the media security from the IMS UE.
Figure 7: Terminating call flow for end-to-access-edge case
A terminating session setup is received at the S-CSCF. In the event that a
media security preference is included, the S-CSCF may base the forking based
on this capability. The request is forwarded to the P-CSCF / IMS ALG of the
selected IMS UE(s).
If e2ae is the default in the terminating network, or if the originator
expressed a preference for e2ae and the terminating IMS UE has e2ae capability
registered, the P-CSCF / IMS ALG includes an e2ae media security offer in the
terminating request (Step 4). The IMS UE includes a media security answer in
the offer response sent back.
The P-CSCF / IMS ALG hosting the MSF is the termination point of the media
security negotiation.
When the offer response is received, the P-CSCF / IMS ALG may interact with
the IMS Access Gateway to setup the media security. Already at this point in
time, both the IMS UE and network will have sufficient credentials for the
media security.
When the full session setup has completed, and media can be sent, the
protected media is sent between the IMS UE and IMS Access Gateway.
#### 6.3.4.2 End-to-end
Figure 8 shows the terminating procedures for session establishment using e2e
based security.
Figure 8: Terminating call flow for end-to-end case
A terminating session setup is received at the S-CSCF. The e2e media security
capability is included in the request, which the S-CSCF may use to base the
forking decision on. The request is routed to the selected IMS UE(s).
The IMS UE accepts the e2e offer, and includes a media security answer in the
Offer response. Already at this point in time, both the end points will have
sufficient credentials for the media security.
When the full session setup has completed, and media can be sent, the
protected media is sent on an end-to-end basis.
# 7 Candidate solutions
## 7.1 Ticket-Based System (TBS)
### 7.1.1 Introduction
This clause describes a framework solution for IMS media security key
management in which requirements from different user groups can be
accommodated. A \"ticket\" concept, similar to Kerberos, is used to identify
and deliver keys. The solution is described with MIKEY [19] for key delivery,
and as such it is based on protocols already standardized with the IETF. Other
key delivery schemes could be used, however. In TBS there are two main
categories of tickets: protected and unprotected. Use of unprotected tickets
gives security features similar to those offered by the SDES solution
described in clause 7.3; their use is based on trust in the security of the
complete IMS infrastructure. Protected tickets may be used to achieve higher
security and provide security independent of the security of the complete IMS
infrastructure; in this case a Kerberos-like Key Management Server (KMS) is
the trust anchor. The KMS may also provide copies of keys to authorized
network functions and middle-boxes. Use of a ticket based system may also help
in the handling of keys for deferred delivery of end-to-end protected media to
currently off-line users.
Key management based on a key management service requires a signalling
mechanism between parties which allows them to retrieve the common credentials
used for the media protection from the key management service. A convenient
way to implement such a signalling scheme is to use a ticket based system. The
sender requests a ticket from the key management service and sends the ticket
containing a reference to the key, or the enveloped key, to the receiver. The
receiver then sends the ticket to the key management service which returns the
appropriate key.
This solution has a number of advantages. It offers a framework which is
flexible enough to satisfy users with a broad range of security needs.
Operators can set policies to provide end-to-end security and enable end-to-
access-edge and end-to-middle scenarios. By using different MIKEY modes, a KMS
can provide protected or unprotected tickets to support different levels of
trust in the IMS infrastructure and other system components. Here, and in the
following, the term IMS infrastructure denotes the current IMS infrastructure
not including a KMS. Examples of user groups and their security expectations
include:
  * General public user: Trusts IMS infrastructure and is satisfied with unprotected tickets.
  * Enterprise users: These users may require protected tickets, depending on their trust assumptions.
  * NSPS user: Likely to require additional protection beyond what is provided by IMS, including protected tickets which are bound to the recipient's identity.
Normally key management systems are either based on negotiation between peers
(e.g. Diffie-Hellman based schemes), pre-distributed knowledge of user
credentials (shared secrets/certificates), or performed with the help of a key
management service. In security systems serving large user groups a key
management service is often preferred so that there is no need to distribute
credentials in advance but to let the user request keys for any other user at
time of need.
A KMS also provides a central point to enable LI and other requirements for
network access to plaintext media.
In the following, the description of the solution has it main focus on use of
protected tickets.
### 7.1.2 Analysis
According to clause 4.2.4, \"it may be beneficial\" to store the media without
any decryption of the ciphering protecting it. This is manifested in
requirement 52 in clause 5.10 which states that the key management solution
shall support deferred delivery of protected media. This requirement is the
requirement that has the greatest impact on the possible types of key
management scheme and it restricts the types of key management that can be
used. In particular, it excludes all key management schemes that are based on
some type of negotiation between the participating IMS UEs / IMS users and
implies that the sender/initiator must have access to media keys before the
receiver has been contacted. A consequence is also that the receiver cannot
rely on contacting the sender to get access to the keys used. Also note that
the requirement on end-to-end protection at deferred delivery is more of a
requirement on the media protection protocol(s) used, since deferred delivery
of end-to-end protected media would in principle only require that the key
management system can establish both an end-to-end security association for
application layer security and security associations for channel security.
The best way to design the key management signalling is to have the key
information associated with the media, forwarded with the signalling
associated with the media set-up in e.g. a ticket. The ticket could be a
reference to a key held by the key management system or it could hold the key
itself. In the latter case, the ticket of course needs to be confidentiality
protected. To have the key itself transported in a ticket is seen as the
preferred solution as this would relieve the key management system of the task
to keep a record of all keys used for media protection.
There are different alternatives for how the receiver gets access to the key
in the ticket. The first is that the confidentiality protection of the ticket
is based on a long-term key shared between the receiver and the key management
system. With this option, it may be difficult to meet the requirements in
clause 5.5.3 on secure multiparty communication. A second alternative is to
have the ticket protected by a key known only by the key management system,
which seems more favourable. However, this seems to imply that the receiver
has to contact the key management system whenever secure media is received,
but the KMS could issue base tickets with a certain lifetime from which per
call keys are derived by the users. The key management system could implement
some authorization functionality for group key management. The details of
group key management are ffs.
End-to-end security can be enforced by the key management system by only
distributing the media keys to authorised end-users. Note here that it is
important to distinguish the end-user from the end-user equipment, and that an
authorization function in the key management system should be based on end-
user identity (IMPU/IMPI) as in requirement 7 in clause 5.4. This
authorization function in the KMS could also be used to help solve the key
access problem in forking and retargeting scenarios (as in clause 5.5.1). A
discussion on how authorized end-users can be defined can be found in clause
7.1.4.2 and forking is described in clause 7.1.4.4. Some network nodes may
require plaintext access to all media to perform various network functions,
e.g. transcoding. These nodes should have special authorization to retrieve
keys for all users.
The tickets should by preference be generic and their transport should not
rely on the type of media they help protect. Thus a signalling plane solution
for ticket transport seems to yield the simplest and most general systems
solution.
The detailed design of ticket format and the specification of the interface
between the IMS UE and the KMS, between different KMSs, and between authorized
network nodes and the KMS, are ffs; still, possible approaches are described
and discussed in the following. It should be noted that there are different
options in the ticket design and that depending on selected features they may
influence the statefulness of the KMS.
### 7.1.3 Solution description
A precondition for a key management scheme as discussed above is that the
users can establish secure connections with the key management server and that
mutual authentication is provided. In an IMS environment it is natural to base
the establishment of such a trusted and protected connection between the user
and the KMS on GBA. In Figure 9, a conceptual architecture for the discussed
key management system is depicted.
Note that if GBA is unavailable, other types of credentials like
username/password, client certificates, onetime passwords and server
certificates can be used for establishing mutual authentication between the
user and the KMS. Such credentials may, but doesn\'t have to, be related to
the user\'s credential used for IMS access.
NOTE: 3GPP should only specify very limited number of solutions.
Also note that the KMS does not have to be operated by the IMS operator. It
could be run by an enterprise or organization, which wants to have control of
the key management for its media security. This is possible as the design of
the KMS user SA establishment can, as described above, be based on any type of
credentials that the KMS operator find secure enough. Note, however, that this
may pose additional difficulties for Lawful Interception in case the
enterprise KMS is located in a foreign country.
.
Figure 9: Architecture for key management system
Note that rather than a single KMS, two different KMSs may be involved, one
for user A and one for user B. This is discussed in 7.1.4.3 below.
The key management when user A wants to establish a secure media session with
user B follows the following steps:
  1. IMS UE belonging to user A bootstraps with the BSF to be able to establish a secure connection with the KMS which acts as a NAF. This allows the BSF to authenticate the user and the user to indirectly authenticate the KMS.
> If GBA cannot be used, the IMS UE connects and authenticates to the KMS and
> establishes a shared key, based on a pre-established security association.
> The exact procedure for this pre-establishment is ffs.
  1. The IMS UE engages in a MIKEY exchange with the KMS and requests a key and a ticket to include in an INVITE to user B. This exchange would likely use the yet-to-be-defined PSK-R mode of MIKEY to allow the KMS to generate the media master protection key. The ticket is confidentiality and integrity protected and includes the media master key and other information needed like receiver's identity. In most cases the user identity should be an IMPU but for group key management a group identity or a list of users could be included.
Editor's Note: This solution will require extensions to MIKEY in the form of
IETF RFC. A MIKEY PSK-R mode would be similar to the MIKEY RSA-R mode already
defined but be based on pre-shared keys. It has to be clarified, how MIKEY
could be used to transport a list of authorized communication peers from the
IMS UE of user A to the KMS, as needed for efficient multiparty
communications, and how MIKEY would be used to transport tickets as specified
below. Approaches requiring further study include: using the general extension
payload and adding a new policy identifier in MIKEY (a \"ticket policy\") and
specify the contents of a \"ticket payload\".
  1. The KMS generates the media master key and the ticket and sends them to the IMS UE of user A.
  2. The IMS UE of user A includes the ticket in the INVITE and sends it to the IMS UE of user B.
  3. The IMS core detects the INVITE and handles the ticket in such a way that a network function, if authorized, can get access to the master media key. To get the key the network function sends the ticket to the KMS with a request to receive the plaintext key.
  4. The IMS UE of user B receives the INVITE including the ticket.
  5. The IMS UE of user B connects to the KMS using GBA based MIKEY. The KMS gets an authenticated user identity this way.
> The comment in step 1 applies here as well.
  1. The IMS UE of user B sends the ticket to the KMS and requests the master media key contained in the ticket.
  2. The KMS retrieves the master media key and other information from the ticket and checks that user B is an authorized receiver of the master media key.
  3. The KMS sends the master media key and the other needed information to the IMS UE of user B.
  4. The IMS UE of user B accepts the invitation and use of media security.
If user B is not registered in IMS and INVITEs are retargeted to a media
mailbox supporting end-to-end protected deferred delivery, the key in the
associated ticket would still be valid and the ticket should be stored
together with the encrypted media in the mailbox. When user B later wants to
retrieve the media from the mail box, the ticket is first sent to the IMS UE
of user B, which then performs, in principle, steps 8 to 12 as described
above, before the media is received.
Editor\'s Note: The following observations are made regarding the solution:
\- The signalling for the key management is in general a SIP signalling issue
and should be developed in cooperation with the IETF.
\- The applications/enablers relying on the key management system are in many
cases OMA specified. The key management functionality should thus be developed
by or in cooperation with OMA.
### 7.1.4 System details
#### 7.1.4.1 Ticket information and format
Tickets may carry many different types of information helping to enforce usage
policies. Policies may be for all users or they may be per user. In the latter
case the KMS has to maintain this information or be able to retrieve it from
some other system. An example of basic information forwarded in a ticket is
given in Table 1 below.
If tickets are unprotected any entity can generate a valid ticket and thus the
only protection that the ticket needs is against random errors during
transport. Protected tickets, as the name indicates, need better protection,
and only a KMS should be able to generate them. The ticket information must
thus be integrity protected and certain fields need confidentiality
protection, in particular the media master key. Other types of information may
also require confidentiality protection due to privacy reasons.
A KMS bases its ticket protection on an Issuer key. From this Issuer key
necessary keys for integrity and confidentiality protection of tickets are
derived.
Table 1: Ticket information content
+-----------------------+---------+----------------------------+ | Information field | Plain/\ | Comments | | | Encr. | | +-----------------------+---------+----------------------------+ | Issuer | P | Identity of the KMS | | | | issuing the ticket. The | | | | identity should allow | | | | entities find the issuers | | | | contact details and it | | | | would be natural to | | | | require it to be a FQDN.\ | | | | \ | | | | Example: | | | | (kms.operator1.com) | +-----------------------+---------+----------------------------+ | Issuer key identifier | P | An identifier which makes | | | | it possible for the | | | | issuing KMS to change base | | | | key used in ticket | | | | protection.\ | | | | \ | | | | Example: 24 bit sequence | | | | number | +-----------------------+---------+----------------------------+ | Originator | P | Public identity of the | | | | user requesting the ticket | | | | from the KMS\ | | | | \ | | | | Example: | | | | user1@operator1.com | +-----------------------+---------+----------------------------+ | Recipient(s) | P | Public identity(ies) of | | | | intended recipient.\ | | | | \ | | | | Example: | | | | user2@operator2.com | +-----------------------+---------+----------------------------+ | Time of issue | P | Time when the ticket was | | | | generated by the KMS\ | | | | \ | | | | Example: | | | | 2008-12-11:13:01:23 | +-----------------------+---------+----------------------------+ | Time of expiry | P | Time when the ticket | | | | expires. The format could | | | | be network time format | | | | | | | | Example: | | | | 2008-12-11:14:01:23 | +-----------------------+---------+----------------------------+ | Master key | E | 128/256 bit | +-----------------------+---------+----------------------------+ | Master salt | E | 128/256 bit | +-----------------------+---------+----------------------------+ | Policies | E | Policies for e.g.\ | | | | - which users that are | | | | allowed to use the key\ | | | | - which applications are | | | | allowed to derive keys | | | | | | | | - middlebox access | | | | allowed or not\ | | | | - use as base key for | | | | session key generation -- | | | | implies\ | | | | generation of a Mod_B\ | | | | - etc | +-----------------------+---------+----------------------------+ | ... | E | Other parameters | +-----------------------+---------+----------------------------+ | MAC | | Message authentication | | | | code | +-----------------------+---------+----------------------------+
#### 7.1.4.2 Binding between user and ticket recipient identities
The use of the recipient field in tickets may vary according to applied
policies per a user group. The recipient field may be used to specify a
specific user, a group of users or any user. The naming of users and user
groups may follow normal IMS conventions and may be extended with use of
wildcards. Example recipient fields would then be
  1. SIP: firstname.lastname@operator.com
  2. SIP:firstname.lastname\@enterprise.com
  3. SIP: *.lastname\@operator .com
  4. SIP: *@enterprise.com
  5. SIP:*@*
For the user group denoted as the general public it would be natural to have a
policy allowing any recipient (see 5 in list above) to use a given ticket. For
enterprise users it may be natural to have as a default that tickets are
issued with a recipient field (see 4 in list above) allowing any user within
the enterprise to use the ticket. In public safety organizations it is
probably stronger requirements on knowing that a call is answered by the
intended user so there the default is to insert the identity of a specific
user (see 1 in list above).
To ensure that ticket polices are enforced it also necessary that a public
user identity can be securely bound to an IMS UE and the ticket resolution
request. The solution here is to bind the identity used by the user to
authenticate against the KMS to a (set of) public identity. Using GBA as an
example the procedure would in principle work as follows on the terminating
side:
  1. The IMS UE on the terminating side performs a GBA bootstrap.
  2. The IMS UE on the terminating side submits a ticket to the KMS together with the BTID obtained in the bootstrap.
  3. The KMS, acting as a NAF, requests a NAF-Key for delivering the media master key to the user identified by the BTID. The KMS also requests the public identities associated with this user. This request for public identities may either be served by the BSF or the KMS may obtain the private identity from the BSF and then request the public identifiers from the HSS.
  4. The KMS reads the recipient field of the ticket and checks if any of the user\'s public identities match the identity in the recipients field. If there is a match the KMS performs any key derivations needed and protects the key(s) based on the NAF-Key received from the BSF.
  5. The KMS sends the key material to the IMS UE.
  6. The IMS UE derives the NAF-Key and reads the key material.
If GBA is not used the mapping between the user identity used for
authentication against the KMS has to be bound to the users public identities
in some other way.
#### 7.1.4.3 Interoperability between users in different KMS domains
Users in different KMS domains will have their protected tickets generated by
different KMSs. The fundamental issue is that a user in general only can be
expected to have a trust relation with a single KMS. Thus to ensure that
policies are enforced the \"home\" KMS has at least to be involved in the
authentication of the user requesting a new ticket or of a user presenting a
ticket for key retrieval. Thus, if one user in one KMS domain shall be able to
establish a secure call to a user in another KMS domain the involved KMSs have
to cooperate and there has to be a trust relation between KMS A and KMS B.
Cooperating KMSs have to be able to exchange secure messages.
Assume that user A in KMS domain A needs a ticket for user B in KMS domain B.
Then the procedure can be laid out as follows
1\. User A requests a ticket for user B from its home KMS, i.e. KMS A
2\. User A sends the ticket to user B
3\. User B presents the ticket to his home KMS, i.e. KMS B
4\. KMS B sends the ticket to KMS A with an assertion about the identity of
the user submitting the ticket.
5\. KMS A checks that the identity of the submitter is a valid receiver of the
ticket.
6\. The KMS generates the keys and other information according to the ticket
policies and KMS B request.
7\. KMS A sends the keys and the information to KMS B in a protected way.
> 8\. KMS B sends the keys and the information to user B in a protected way.
#### 7.1.4.4 Session and forking keys
##### 7.1.4.4.1 General aspects
One issue with key management systems based on key management services from a
central server may be load on the central server. One way to limit the load
would be to allow derivation of several independent session keys from one
ticket and in this way reduce the number of ticket requests received by the
KMS in scenarios where there are different (e.g. consecutive) sessions between
one sender and a recipient. Note that the ticket recipient filed may define a
group of recipients, see clause 7.1.4.2), which would allow a ticket to be
reused for all users in the indicated group. An efficient procedure to derive
such session keys is presented below. Another issue is that when a call is
forked to several terminating devices, all the terminating devices should use
unique keys and not have access to the keys derived/used by other endpoints. A
procedure to ensure that this requirement is fulfilled and which in general
enforces that all endpoints receiving a given ticket will use different keys
is also described.
We use the following notation:
KT_A The master key in a ticket generated on request from A
KF_AB Forking Key for user B, i.e. a key unique for user B based on KT_A
KS_AB Session Key for use between user A and user B
KDF_S ( K, Mod) Key derivation function used to derive a session key from a
key K and a modifier Mod
KDF_F ( K, Mod) Key derivation function used to derive a forking key from a
key K and a modifier Mod
Mod_A A (pseudo-)random modifier generated by the initiating party.
Mod B A (pseudo-)random modifier used at the receiving end.
The methods and procedures described below are mainly aimed for systems using
protected tickets. However, the principle behind the procedures for how keys
should be generated in forking scenarios is also valid when unprotected
tickets are used.
##### 7.1.4.4.2 Session keys
The proposed way to generate session keys is straightforward and only makes
use of a key derivation function modifying a base key with help of a random
value, Mod_A, generated by the initiating party.
KS_AB = KDF_S ( KF_AB, Mod_A)
or if no forking key generation is performed, then
KS_AB = KDF_S ( KT_A, Mod_A)
The random value, Mod_A, is transported to the receiving end together with the
ticket to allow the session key to be derived there. The key derivation at the
receiving end could be performed by either the KMS or the IMS UE. If the key
derivation is performed by the receiving IMS UE, then only one access from the
IMS UE to the KMS is needed. If the key derivation is performed by the KMS,
then the master key in the ticket (KT_A) would never be directly exposed to a
network element or an IMS UE. This would improve the security of this key, but
of course the receiving IMS UE would have to call the KMS for every session.
The preferred solution varies depending on the required security level. Since
the whole purpose of this mechanism is to re-use the same base key for several
sessions, it obviously requires state about previous sessions to be kept in
IMS UEs. Other mechanisms like session resumption in TLS may, when available,
be an alternative to this mechanism.
##### 7.1.4.4.3 Forking keys
Ticket policies used will determine rules how and when secure connections can
be established in forking scenarios. If the ticket indicates a specific user
as recipient, then only that user can resolve the ticket and establish a
secure call and thus forking will only work with IMS UEs belonging to that
user (see also 7.1.4.2). The other extreme is that the ticket recipient is
indicated as "any user in domain D" (or even \"any user\"). Note that in this
case, the initiator is assumed willing to accept any responder from within a
group and is assumed to accept that level of granularity in the assurance of
the identity of the responder. For this to hold, the KMS must here enforce
access control so that only users within the indicated group are permitted to
resolve the ticket. Note that the proposed solution below ensures that all
users allowed to resolve the ticket will get different keys and they will not
be able to derive the key for another user.
Note further that, in a general scenario a sender may not be aware whether
forking is performed at the receiving side nor may the sender be capable of
determining the set of identities of the allowed recipients of the forked call
when requesting a ticket from the KMS. In such a scenario, the sender has no
choice but sending a ticket for "any user", but nevertheless he may want
assurance about the recipients identity. For the conclusions in this case cf.
clause 7.1.4.4.5.
An approach similar to the one used to generate session keys can be taken to
generate different keys for different endpoints in a forking scenario meeting
the above level of assurance of responder authentication and key separation.
For each endpoint, the master key in the ticket is modified by performing a
key derivation function on the media master key and a modifying value, Mod_B.
The modifier may depend on the identity of B, preferably in a verifiable way,
e.g. hash(indentityB, .....), see also below.
KF_AB = KDF_F ( KT_A, Mod_B)
A similar idea is presented in the SDES solution. To have strong assurance
that the generated keys are unique per IMS UE, the key derivation function
shall be performed by the KMS which also enforces access control relative to
the granularity specified in the ticket. E.g. if the ticket specifies
*@domain.com, then the KMS is assumed to have means to authenticate B as
belonging to that group. If the ticket specifies *@* then no access control is
enforced (but the KMS may of course log the identity of B, if desired).
It should be noted that even if an IMS UE is not allowed to perform modifying
key derivation by itself, the Mod B parameters used in the modification can be
reused for all tickets that the IMS UE receives during the lifetime of its
current security association with the KMS, e.g if GBA is used to set up this
security association then the Mod_B could be reused for the lifetime of the
UE\'s GBA base key Ks. This would allow receiving IMS UEs to return the
modifying value to the initiator before getting a response from the KMS and
hence ensure that no extra delays are introduced.
##### 7.1.4.4.4 Combined session and forking key generation
The combined procedures for session key and forking key generation are
depicted in Figure 10 below. Note that the figure does not indicate how
security is implemented in the communication between the IMS UEs and the KMS.
Figure 10: Session and forking key signaling
##### 7.1.4.4.5 Terminating side identity assurance.
Assurance about the terminating side's identity is in many circumstances
important. In addition to the standard assurance offered by IMS, TBS can
provide additional cryptographically secured identity or group membership
assurance. In one approach, the assurance that TBS will provide about the
terminating side identity is based on the authorized receivers specified in
the ticket, i.e. the set of users in the tickets recipient field. The
assurance is obtained as the KMS will only deliver a key associated with a
given ticket to a user included in the tickets group of recipients. If a
single user is designated as ticket recipient, the initiator will for certain
know, when the call is successfully established, that the intended user was
reached. If a group of users is designated as recipients, e.g. by
*@enterprise.com, then the initiator will know that a user in enterprise is
answering the call. Which policy the initiator applies for selecting ticket
recipients should depend on the use case and required assurance of terminating
side identity
In forking and retargeting use cases a call may terminate in a phone not
registered (in IMS and/or KMS) by the intended receiver. In such cases the
caller can not get assurance that the intended receiver is the person
answering. The only assurance about the terminating side identity that the
caller can get is the identity of the user which has registered the phone. It
is questionable if this information in general would help the caller to decide
if he has reached the person he targeted or not. Thus, if the user needs
strong confirmation that he has reached a terminating device belonging to a
specific user, he should only have this user as ticket recipient. If the call
is forked/retargeted and rejected because the ticket is not valid for the
terminating side, the initiator has to request a new ticket and call again.
This has the benefit that the caller has full information about what is
happening and the drawback that additional SIP signaling is needed. However,
if the main concern only is that no-one should be able to intercept a call, a
ticket using *@* as recipient can be used and it would allow arbitrary forking
and retargeting. Once again this shows that the choice of rules that he
initiator should apply for selecting ticket recipients is a policy issue.
In a scenario where the sender sends a ticket for "any user", he may still
want to have assurance about the identity of the recipient established in the
forking process, cf. clause 7.1.4.4.3. Using another approach than the one
described above, it would be possible to let the KMS certify a user identity
associated with the device used to resolve the ticket. A simple means to do
this would be let the Mod_B be composed of the user identity and a random
component (U_Id, Rnd) and have this signed by the forking key or a key derived
in a similar way. The details of this solution should be worked out in
conjunction with the complete key management procedure for forking and session
keys.
#### 7.1.4.5 Unprotected tickets
By using the MIKEY-NULL mode defined in [19], the ticket based solution
described here allows a mode similar to SDES, i.e. keys and other set-up
information are carried in plaintext in the ticket. This mode is called the
unprotected ticket mode. The security properties of this mode are identical to
those of SDES: It requires secure transport between all SIP proxies and
exposes plaintext keys to all SIP proxies. It also relies on an external
mechanism (such as IPSec or TLS) to protect signalling between the IMS UE and
the P-CSCF. This mode also provides similar efficiency to SDES, as the
communicating IMS UEs do not need to contact the KMS. However, interoperation
with current or future IMS UEs implementing SDES according to RFC 4568 will
not be possible. This lack of interoperability can be accommodated, however,
by a function at the network edge to translate an unprotected ticket setting
up SRTP into SDES. Of course, none of the security services offered by a
protected ticket will be available, but on the other hand it also cannot be
expected that standard SDES equipment supports such services.
#### 7.1.4.6 Ticket replay protection
An attacker of a TBS may try to replay a ticket and in this way be able to
find an attack which would give him access to plaintext and/or modify
protected media content. Thus a TBS must implement mechanisms rendering such
attacks useless. The following mechanisms can be used to prevent replay of
tickets:
1\. Ticket expiry time. Short life-time tickets can be used to limit the
possibilities for replay but will itself not be sufficient to stop attacks. An
attacker can e.g. replay a ticket against a device associated with the
attacker himself and which has a fast response. Such a replay attack may help
in retrieving the target media plaintext if the media protection key generated
will be the same as that used for the target media.
2\. Tickets could have unique recipients. This would stop an attacker from
using other devices than the intended receiver\'s device as a tool in the
replay attack. Still additional means would be needed to stop replay, e.g. a
replay counter or some similar mechanism.
3\. Keys generated from received tickets can be (pseudo-)randomly modified as
suggested above. The way that forking keys are generated is an example of how
this can be performed. If the recipient of a ticket always submits it to the
KMS to obtain a forking key, then this modification of the key will be
(pseudo-)random and not controllable by the attacker as a new forking key will
be generated each time.
4\. Receivers could keep a record of received tickets for the ticket\'s
remaining lifetime. This would not stop attacks where replay is initiated on
another device.
> The conclusion from the above is that having recipient unique tickets and a
> replay counter is one way of achieving replay protection. Another way is to
> have the receiving end modify the tickets master key in a (pseudo-)random
> way before it is used for media protection. The latter method works even if
> the tickets don\'t specify a unique recipient.
#### 7.1.4.7 Limiting KMS statefulness
As noted in analysis in clause 7.1.2 the statefulness of the KMS will depend
on the choice of the protocol used between IMS UEs and the KMS. To limit the
need to store state, this protocol should not build upon a security session
like TLS but apply application layer security. In this way the only per IMS UE
SA information that the KMS must store between message exchanges is an IMS UE
identity and the corresponding key. This SA can be set-up using GBA or other
credentials as discussed above. Note also that the interaction between the IMS
UE and the KMS always is IMS UE initiated which allows a standard client
server design. Furthermore, it can be noted that due to the way keys are
generated and retrieved and the possibility to include indications of intended
use in the tickets, there is no need for a general replay protection mechanism
(see also clause 7.1.4.6).
#### 7.1.4.8 Lawful intercept
First of all we note that use of encryption, LI and related dependences are
subjected to national regulations. We also note that possible roaming
scenarios and agreements between operators need to be considered. These facts
would make a complete analysis of requirements and possible solutions quite
extensive and we leave that work to the SA3-LI groups. In the following
analysis we limit ourselves to the situation when it can be assumed that user
traffic always is routed via the home network.
To be able to provide a clear copy of intercepted communication, the following
conditions have to be fulfilled:
1\. It must be possible to intercept the traffic (both signalling and media).
2\. It must be possible to intercept the ticket and other signalling
information (and correlate ticket and traffic).
3\. If the ticket is a protected ticket, the keys used for actual traffic
protection have to be available. To make the keys available from protected
tickets some KMS functions/services would be required.
With media traffic routed via the home network, intercept of the media traffic
in the home network will always be possible. So the focus here is on the
issues with respect to intercept of tickets and retrieval of key information;
if tickets can be intercepted in the signalling plane then so can all other
information needed. Intercept of tickets in the home network can be done at
SIP server(s). In roaming situations, as the SIP signalling traffic normally
is confidentiality protected between the IMS UE and the P-CSCF and considering
that in current deployments the P-CSCF is located in the home network, the SIP
signalling is only available in encrypted format at bearer level in the
visited network.\ \ If an unprotected ticket is intercepted then all key
information needed for performing LI can be derived directly from it. When a
protected ticket is used, KMS operations on the ticket have to be performed to
make the keys needed for LI available and such operations could only be
performed by a KMS, i.e. either the ticket issuing KMS or a KMS which
interoperates with the ticket issuing KMS.
> NOTE: It is essential that the keys to allow decryption in case of LI are
> provided on per target basis by the KMS in order to ensure confidentiality
> of the communications that are not to be intercepted..
A summary of the discussion above is that if the SIP signalling is protected
and that the P-CSCF always is located in the home network, which seems to be
the normal situation in current IMS deployments, intercept of SIP signalling
and decrypted content will be possible in the home network. For roaming
scenarios, while encrypted SIP signalling and content will always be
available, in order to intercept SIP signalling and decrypt the content of
communication, one of the following options would be required:
1\. SIP signalling is performed in plain between IMS UE and P-CSCF;
2\. The P-CSCF is located in the visited network.
3\. Keys are provided by alternative mechanisms from the KMS handling entity.
SIP signalling in plain between IMS UE and P-CSCF rules out the use of
unprotected tickets while use of protected tickets would allow intercept of
the ticket but would require involvement of KMS functionality, i.e. there has
to be an interoperation agreement between the visited network and the entity
handling KMS. Typically, the KMS will reside in the home network so that, for
LI performed by the visited network, cooperation with the home network is
needed. With the P-CSCF in the visited network, intercept of tickets would
always be possible while also in this case there has to be an interoperation
agreement between the visited network and the entity handling KMS
functionality/services.
In line with LI standards, when the VPLMN is not involved in the encryption,
only encrypted content would be available for LI in the VPLMN.
#### 7.1.4.9 Access to KMS services when roaming
The simplest solution to access KMS services when roaming, would be to go
directly to the home KMS. Another solution would be to go to a KMS in the
visited network. The KMS in the visited network could then either act as a
proxy or it could authenticate the user and perform the KMS services.
Having a KMS in the visited network could possibly help in facilitating
autonomous LI in the visited network which would be on the upside of such a
solution. On the downside we have the difficulty for the IMS UE to discover
the KMS in a visited network. Note that here we talk about a visited IMS
network, not a visited access network; if we would consider visited in terms
of access then there would be interactions between access and IMS networks and
this would make the solution much more complex and out of scope for this
standard. On the downside we also note that even if the ticket information
becomes available it might be difficult to correlate it to signalling and
traffic flows. And the final downside aspect is if the KMS in the visited
network must authenticate users. Then all KMS in visited networks have to have
access to user authentication functions in the home network / home KMS domain;
an example if authentication is based on GBA would be that all KMSs in visited
networks would need access the users home BSF.
Thus it seems that the minor benefits from LI point of view does not motivate
the complexity of a solution mandating that access to KMS services should
always take place via local KMS in a visited network. This may however change
in the future.
#### 7.1.4.10 End-to-middle scenarios
In end-to middle scenarios media protection is between an IMS UE and a network
entity. The media protection can be set-up either from the IMS UEs or from the
network side. Note that to have efficient procedures for network initiated
media protection, IMS UE capabilities should be registered with the network. A
typical example when end-to--middle may be relevant is when a call is setup
between IMS and PSTN networks and in such cases it would be natural to have
the MGW to perform security functions on behalf of the PSTN network and we use
this scenario to exemplify how media protection is terminated/initiated in the
IMS network.
In TBS, end-to-middle traffic cases have to be explicitly allowed by the
ticket policies. Assuming this is the case then, in a scenario when the call
is initiated from an IMS UE, the set up of the call would follow the same
principles as for an end-to-end protected call. The initiating IMS UE requests
a ticket from the KMS if protected tickets are used, otherwise it generates a
ticket. The ticket is sent together with the INVITE. The MGWC intercepts the
ticket. If protected tickets are used, the MGWC contacts the KMS to retrieve
the keys used for media protection in the same way as a receiving IMS UE would
have done. The MGWC then sets up the MGW to have media security towards the
IMS UE. The media traffic is forwarded in plain in the PSTN.
For incoming calls to IMS UEs, the MGWC checks that at least one terminal
registered for the intended recipient has registered media security
capabilities and preferences. If there is no media protection capable terminal
the call is forwarded in plain. Otherwise the MGWC requests a ticket for the
recipient from the KMS if protected tickets are to be used, otherwise it
generates an unprotected ticket. The MGWC then inserts the ticket in the
INVITE and initiates use of media security in the MGW on the media traffic
between the MGW and the IMS terminal.
There are other use cases where end-to-middle protection might be required,
e.g. when transcoding has to be performed or if only end-to-access_edge
protection is allowed. All these cases will follow the procedures described
above and they will rely on a controlling entity intercepting and/or injecting
tickets in the SIP signalling flow and which also controls the media
protection functions in an associated MRF.
### 7.1.5 Evaluation of solution against requirements.
#### 7.1.5.1 Compliance of TBS with 3GPP Requirements
**For each requirement group in clause 5, 3GPP as well as IETF requirements
are given. This clause only discusses the 3GPP requirements. It is structured
in the same way as clause 5.**
##### 7.1.5.1.1 LI requirements
**The Ticket Based Solution allows compliance with LI requirements in the home
network. If unprotected tickets are used the master keys for protecting the
communication are known to the P-CSCF and any other SIP proxy processing the
INVITE dialogue. When using protected tickets, the LI system must have access
to standard user services from a KMS. LI may also be possible in visited
networks through the use of unprotected tickets. It should be noted, however,
that LI may be difficult in a roaming situation when protected tickets are
used and will require cooperation between KMSs in the visited and home
networks:**
##### 7.1.5.1.2 Security requirements
The TBS is in principle a stand alone key management function which can
support keying of any type of media protection protocols including protocols
supporting deferred delivery. In the following discussion of the compliance
with the security requirements, it is therefore assumed that user plane
traffic is properly secured based on the keys established using TBS.
**If unprotected tickets are used the SIP traffic has to be secured, i.e.
integrity and confidentiality has to be provided for all IMS signalling
traffic and especially for the signalling traffic between the IMS UE and the
P-CSCF. The security requirements and the needed/offered security for
unprotected tickets are exactly as described for SDES in clause 7.3.2. Use of
unprotected tickets will exhibit the same security features as SDES in a non-
IMS environment. The level of trust may or may not be lowered by the
involvement of foreign networks.**
**The conclusion is that unprotected tickets will comply with the 3GPP
security requirements in exactly the same way as SDES does.**
**A TBS with a KMS will protect the tickets themselves, independent of any SIP
signalling protection assumptions, and thus provides security on its own. It
will also protect tickets and key information while stored or handled in SIP
proxies. TBS may also implement different authorization and group key
management schemes, i.e. they support secure group communication using a group
key. This ticket protection mechanism is independent of IMS and may be
extended to cover also non-IMS environments.**
**The KMS itself may be a target for attacks. It should be protected in the
same way as would a BSF in a GAA/GBA deployment.**
##### 7.1.5.1.3 Requirements related to SIP based call features
**Concerning forking/retargeting and support of early media, clause 5 doesn\'t
state 3GPP specific requirements -- only the IETF requirements apply, cf.
further below.**
**TBS supports secure multiparty communications.**
##### 7.1.5.1.4 Architectural requirements
Clause 5.6 lists eleven architectural 3GPP requirements. Compliance of TBS
with these requirements is obvious in most cases. Only the most important ones
are discussed in this clause.
TBS supports e2e security as well as e2m and e2ae security (see clause
7.1.4.10 for discussion about e2m/e2ae). This is true for both unprotected and
protected tickets. When protected tickets are used, a network node needs to
have authorization to access the KMS to resolve the key in the ticket.
The requirement to support media recording is supported by TBS independent of
if the recording is of plaintext media or if it should be protected. Any
issues with recording of protected media are related to the media protection
protocol used.
TBS can be implemented in non-IMS UEs from a technical point of view, but from
a practical point of view, TBS may or may not be implemented.
The solution comprises two variants, \"unprotected tickets, no KMS\" versus
\"protected tickets, usage of a KMS\". Concerning Req 25 (no multiple
solutions), it can be stated, that these two variants share the \"ticket\" as
a format for delivering a key and other cryptographic parameters, which allows
set up of systems having different functional and security features.
Concerning Req 28 (impact on existing network entities), it should be taken
into account that the new function KMS may be deployed in an already existing
network equipment which would reduce OPEX and CAPEX, but of course cause an
impact on the existing network entity. Network nodes that need to control
media protection functionality in e2m scenarios would of course also be
impacted.
All different instances of KMS function in different IMSs must be
interconnected by security associations, for example in a similar manner how
S-CSCFs are connected, when interoperability using protected tickets is
required.
##### 7.1.5.1.5 Scalability, cost and performance
Obviously, the unprotected ticket version of TBS complies very well with these
requirements, as it is a very simple, straight forward approach without the
need of additional network elements, expensive computations, multiple
roundtrips etc.
TBS with a KMS offering use of protected tickets will require a KMS supporting
all its users. Its size/performance grows proportional to the number of users.
However, there is no technical challenge to implement a KMS supporting all IMS
users of an operator as can be seen from specifications of and implementations
of other nodes in cellular and IMS systems. The only issue might be cost,
otherwise, the KMS functionality is simple and likely to have small and
efficient implementation, it does not have to store any session state.
Note that TBS offers an opportunity to have some groups rely on protected
tickets while other groups rely on unprotected tickets together with trust in
the IMS signalling and infrastructure security. Other groups may want to
implement the KMS as an external trust anchor independent of IMS. These
options allow better operator control of the growth in demand on the KMS.
##### 7.1.5.1.6 Requirements regarding the access network type
TBS complies with these requirements, in the following way:
  * it is access network independent;
  * it may or may not leverage the IMS security architecture depending on user requirements (for protected tickets, it requires an additional KMS-infrastructure and for unprotected tickets its not required);
  * it may or may not work independently of any of the different authentication methods defined for IMS.
##### 7.1.5.1.7 Backward compatibility and migration
TBS complies with these requirements. In particular, keys and other parameters
can be negotiated individually for each call. When protected or unprotected
tickets are used downgrading attacks cannot be performed if secure SIP
signaling is assumed.
With protected tickets, protection against downgrading attacks can be achieved
without the secure SIP signalling assumption if IMS UEs implement a policy to
only accept calls with "high security" together with making the applied
security level visible to the user. It should be noted, however, that, in a
general environment with no policy control and automatic acceptance of
fallback to unprotected mode which may be a acceptable mode of operation for
the general public in a public IMS network, a downgrading attack against the
capability negotiation protocol described in clause 6.3, which is based on SIP
signaling security, would be still possible for an attacker with access to SIP
messages, e.g. by replacing an SDP media description containing SRTP usage by
a one that contains only RTP). Downgrading attack could be mitigated by making
the user security visible to the user. In such a mode of operation no
additional protection against downgrading attacks beyond SIP signalling
security would be provided.
##### 7.1.5.1.8 Other requirements
Note that TBS is specified to be independent of the media transport, still
allowing tickets to be bound to certain media types and media protection
protocols. TBS supports both transport and application layer media protection
protocols.
#### 7.1.5.2 Compliance of Ticket Based System with IETF requirements
**In this clause, not every IETF requirement is discussed in detail but the
important current IETF requirements are covered.**
##### 7.1.5.2.1 Security requirements
**The strongest security requirement that currently contain is requirement**
**R-ACT-ACT: A solution must provide a mode where an attacker, for performing
a successful attack, must be active in both the signalling and the media path,
and where such an attack would be detectable by the end users.**
**TBS with protected tickets fulfils this requirement. Unprotected tickets
will, in the same way as SDES, of course fail if it is assumed that an
attacker can compromise a SIP proxy on the signaling path.**
##### 7.1.5.2.2 Forking/retargeting
**IETF-requirements**
R**-FORK-RETARGET: The media security key management protocol MUST securely
support forking and retargeting when all endpoints are willing to use SRTP
without causing the call setup to fail. This requirement means the endpoints
that did not answer the call MUST NOT learn the SRTP keys (in either
direction) used by the answering endpoint**.
R-DISTINCT: The **media** security key management protocol MUST be capable of
creating distinct, **independent** cryptographic contexts for each endpoint in
a forked session.
**How STB can create different keys in a forking scenario is explained in
clause 7.1.4.4. If unprotected tickets are used the key modification can be
performed by the receiving client in a corresponding way.**
In TBS with protected tickets, a sender may authorize the receivers to receive
the key from the KMS. For this, he can provide e.g. a list of authorized
receivers. How tickets are bound to different receivers or groups of receivers
is described in clause 7.1.4.2.
The Internet-Draft draft-ietf-sip-media-security-requirements-08, describes
that in typical forking/retargeting scenarios, the sender does not know who a
call may be forked/retargeted to. This situation is discussed in clause
7.1.4.4 and it is described how tickets can be used and generated to get media
security also in forking and retargeting situations. In clause 7.1.4.4 it is
further discussed how TBS can offer SIP independent assurance about the
terminating side identity. This is done by firstly guaranteeing that it is a
legitimate recipient of the ticket that answers the call. If the recipient is
defined as a single user, this gives full assurance about the terminating side
identity. A second level of assurance can be obtained by having the KMS
include such identity information in parameters used in the forking key
generation, see clause 7.1.4.4.5.
R-HERFP: The media security key management protocol MUST function securely
even in the presence of HERFP behavior.
**HERFP behaviour is that in a forked call, rejections of the INVITE sent by
different endpoints may be terminated at the forking proxy and never reach the
caller. A solution to fulfil this requirement can be accommodated by TBS by
not allowing an answerer to send indications about key exchange failures in
order to let the offerer \"make another try\".**
**Another IETF-requirement, mentioned under \"media considerations\", is also
relevant with respect to forking, in case forking leads to a multiparty
session:**
R-ASSOC: The media security key management protocol SHOULD include a mechanism
for associating key management messages with both the signaling traffic that
initiated the session and with protected media traffic. Allowing such an
association also allows the SDP offerer to avoid performing CPU-consuming
operations (e.g., Diffie-Hellman or public key operations) with attackers that
have not seen the signaling messages.
**With TBS, keys are exchanged in the signalling messages, so association of
key management to signalling is clear. Association of key management to media
can e.g. be achieved through the use of the optional MKI field in an SRTP
packet. A suitable value for this field can be formed by e.g. a hash of a
concatenation of the issuer key identifier (as described in 7.1.4.1) with the
Mod_B value (described in 7.1.4.4). This value will be unique for each
recipient and easily computed by both participants.**
Editor\'s Note: It has to be clarified whether this is compatible with the
standard use of SRTP as RFC 3711 states: \"Note that the MKI SHALL NOT
identify the SRTP cryptographic context\". This possible incompatibility needs
to be resolved. Alternatively, the applicability to TBS of an approach as
indicated for SDES (see clause 7.3.3.2) should be studied.
**Finally, the following IETF requirement refers to forking/retargeting:**
R-BEST-SECURE: Even when some end points of a forked or retargeted call are
incapable of using SRTP, a solution MUST be described which allows the
establishment of SRTP associations with SRTP-capable endpoints and / or RTP
associations with non-SRTP-capable endpoints.
A simple solution to this is **that** the initiator offers two media streams,
one protected and one unprotected. Allowing unencrypted media is of course
always a security issue as the user has to be warned if media is not
protected.
##### 7.1.5.2.3 Early media
**The IETF requirement is**
R-AVOID-CLIPPING: The media security key management protocol SHOULD avoid
clipping media before SDP answer without requiring Security Preconditions
[RFC5027].
**TBS will in principle, if the mechanisms to guarantee that different IMS UEs
will have different keys in forking scenarios are deployed, need an SDP answer
before decryption of media can start which means that encrypted media would be
clipped before that. However, 3GPP generally assumes SBCs in the media path
that block media before SDP answer anyway and thus TBS does not lead to
specific problems here.**
**As discussed in the corresponding clause for SDES, it may also be considered
to allow the usage of unencrypted early media and apply protection only to
media after the SDP answer. A straightforward solution here would be for the
initiator to offer one plaintext media port and one port for protected
content. Such an approach would be in line with the most common way of
handling early media in IMS today. It would also obsolete the IETF-
requirement:**
R-ALLOW-RTP: A solution SHOULD be described which allows RTP media to be
received by the calling party until SRTP has been negotiated with the
answerer, after which SRTP is preferred over RTP.
Allowing unencrypted media is of course always a security issue as the user
has to be warned if media is not protected.
#### 7.1.5.3 Summary requirement compliance
TBS offers a framework which can encompass user groups with differing security
requirements. The framework also includes the possibility to allow specific
user groups to handle their key management. TBS with a KMS will offer a
solution which would comply with all security requirements. Unprotected
tickets could be an alternative for environments in which security
requirements aren\'t that strict. Thus TBS offers great flexibility.
The high security provided by TBS solution must be balanced against
implementation and performance.
## 7.2 Using IMS AKA keys for media protection over the access network
Editor\'s Note: It is ffs whether protecting IMS media over the access network
using an end to middle approach as described in this clause is needed.
### 7.2.1 Requirements
The following list of requirements are used as a starting point for the
solution architecture:
  1. The security shall be between the IMS UE and a protection end-point (MSF, Media Security Function) at the edge of the IMS trusted environment.
  2. No new credentials shall be needed for the SA (key) establishment between the IMS UE and the MSF.
  3. It shall be possible to protect RTP and MSRP traffic.
  4. The IMS operator shall be able to control the use of the protection mechanism
  5. The control of the protection mechanism shall be realized by SIP signaling.
The requirements are fulfilled as follows:
> Requirement 1 is fulfilled by introduction of a new functionality, the MSF,
> which possibly could be part of e.g. an IMS Access Gateway.
>
> Requirement 2 can be fulfilled by basing the security on a shared secret key
> obtained from a shared SA used for SIP authentication and/or signaling
> protection. This is a straightforward solution when user authentication is
> based on IMS AKA and the associated CK, IK is used in the protection of the
> SIP signaling between the IMS UE and the P-CSCF. (The CK, IK could be passed
> through a PDF to generate a media security master key.) When TLS is used to
> protect the SIP, the shared SA in TLS may be used as the basis for
> derivation of media protection keys. Finally, the third option is to base
> the media protection keys on the \"password\" used in SIP digest
> authentication. Doing this would give a media protection which has similar
> strength to the user authentication which might be reasonable, assuming
> strong and long passwords.
>
> This requirement can also be fulfilled by having the client or the network
> generate a master key which can be used to derive the needed media
> protection keys and distribute this master key in SDP by eg. SDES. This
> would require that the SIP signaling is confidentiality protected.
>
> Requirement 3 is fulfilled by employing SRTP and PSK-TLS. For SRTP the
> session keys may be e.g. generated with MIKEY. PSK-TLS has its own inbuilt
> session key generation mechanism. Other SA information is exchanged within
> SIP/SDP re-using the existing IETF SDESC mechanism.
>
> Requirement 4 and 5 are fulfilled by defining IMS UE security capabilities
> which the IMS UE includes when registering. The IMS UE may then propose the
> use of access security or the proposal may come from the network. The
> network will always be able to decline an invitation / not issue one.
Editor's note: It needs to be further clarified how the list of requirements
in this subclause relates to the list of requirements in clause 5.
### 7.2.2 Architecture
The architecture for IMS media access security is depicted in Figure 11. The
media security master key may emanate from the CK, IK generated by IMS AKA,
the master key used by TLS or from the password used in SIP digest. This media
security master key is held by the P-CSCF independently of its origin..
Editor\'s Note: This first version of the architecture indicates that the
media security master key is delivered from the P-CSCF to the MSF. This is not
the only way to handle the distribution; it could probably also be done via
e.g. a MRFC in case the functionality would be part of an MRFP. Exactly how
this key handling should be organized is for further study.
{width="5.001388888888889in" height="1.1979166666666667in"}
Figure 11: High level architecture for access security
### 7.2.3 Access security set-up
Figure 12 below shows an example signaling diagram for setting up access
security. The first phase, steps 1 to 3 indicates the registration of the IMS
UE access security capabilities. The following steps indicate how access
security is set up in both access networks. The actual establishment of the
media security is not included in the diagram.
{width="5.001388888888889in" height="3.3618055555555557in"}
Figure 12: Simplified signalling diagram for access protection
> 1a/b The IMS UE registers with the IMS system by sending a REGISTER
> including its capabilities regarding access protection (e2æ).
>
> 2a/b The IMS UE is authenticated to make the registration valid.
>
> 3a/b The IMS UE gets a 200 OK confirming the registration, and it may
> acknowledge support of the registered e2æ capability.
>
> 4 The IMS UE sends an INVITE containing an offer to use e2æ protection,
> including parameters for key establishment.
>
> The originating side P-CSCF inspects the INVITE and notices that e2æ
> protection is proposed. As the network is capable of e2æ protection it
> tacitly accepts the offer and stores the decision.
>
> 5 The originating side S-CSCF performs onwards routing to the terminating
> side S-CSCF. The originating network may optionally remove the e2æ
> indicator. If kept, the terminating network will use it as indicator that
> IMS UEs capable of e2æ should be selected prior other IMS UEs.
>
> The terminating S-CSCF inspects the INVITE and checks if the called party
> supports e2æ protection.
>
> 6 The terminating S-CSCF performs service invocation and onwards routing to
> the IMS UE. If not present, the terminating network, configured to apply e2æ
> protection, inserts an e2æ protection offer before the INVITE is forwarded
> to the IMS UE. The offer includes parameters necessary to establish a shared
> SA. The SDP must also be changed to route the media via the MSF.
>
> The terminating IMS UE accepts the INVITE including the e2æ offer. It
> derives the SA to be used and sends it together with a signal to the IMS UE
> media plane handler instructing it to enable media protection based on the
> that SA.
>
> 7 The terminating IMS UE answers with a 200 OK accepting the e2æ offer. The
> terminating P-CSCF receives the 200 OK and sees that the access security
> offer was accepted. It then generates a master key for e2æ protection and
> pushes it and other information needed to the MSF and requests that it
> enables media protection.
>
> 8\. The P-CSCF forwards the 200 OK to the terminating S-CSCF.
>
> 9\. The terminating S-CSCF forwards the 200 OK to the originating S-CSCF.
>
> 10\. The originating S-CSCF forwards the 200 OK to the P-CSCF.
>
> The P-CSCF inspects the 200 OK and recalls the decision to use e2æ
> protection. It generates the master key for e2æ protection. The P-CSCF then
> push the master key and other information needed by the MSF and a request
> that the MSF enables media protection.
>
> 11\. The P-CSCF forwards the 200 OK to the IMS UE. The IMS UE notices that
> the e2æ protection offer has been accepted and derives the master key to be
> used. It sends the master key together with a signal to the IMS UE media
> plane handler, instructing the media plane handler to enable media
> protection based on the provided SA.
### 7.2.4 Access security set-up with key mixing
A further enhancement of the methods described in clause 7.2 is the following
method of key mixing.
The security of e2m media plane protection is under current assumptions in the
TBS (unprotected ticket) and SDES solutions based on the fact that SIP
signaling between the IMS UE and the P-CSCF is secure. This means that media
plane security cannot be guaranteed if this signaling link is unprotected or
only integrity protected; confidentiality protection is thus required for the
SIP signalling.
Note that it would be possible to combine the use of end-point generated keys
as described for TBS and SDES with a shared secret as describe here in clause
7.2 by mixing the two keys together. If we do this, the requirement on having
SIP signaling confidentiality protected over the access link would go away
when a shared secret exists and the security would in general be improved.
Adopting a solution including such key mixing would mean that the solution
would be able to cope with both the situation that a shared secret exists and
the situation that there is no shared secret.
The effect of the key mixing would of course be only beneficial when SIP
signalling is unencrypted. The key mixing would guarantee that intercept of
the plain signalling would not help a wiretapper in obtaining the media key in
plaintext. Applying key mixing also when the SIP signalling is confidentiality
protected would not give any substantial increase in security, but would
neither be detrimental. It would however help converge procedures and avoid
having to handle different security set-up cases, given that a shared key
exists.
To have a straightforward solution it could be considered to use key-mixing
only when user authentication is based on ISIM and AKA. In this case the Ck,
Ik will be available in the P-CSCF and a key which could be combined with an
end-point generated key could, as indicated in clause 7.2.1, easily be
derived. Note that there is no requirement that the initiating end requests
that such key mixing takes place as both ends will a priori know when ISIM and
AKA is used for authentication and the IMS UE will by signalling know the
location of the other media security termination point.
Assume that an initiating IMS UE generates a key K_ep and that the IMS UE and
the P-CSCF share Ck and Ik, the key to be used for media protection could in
principle be derived as K = PRF(Ck, Ik, K_ep).
Editor's Note: A replay mechanism needs to be defined.
## 7.3 Security Descriptions (SDES)
### 7.3.1 Brief description of SDES
RFC 4568 "Session Description Protocol (SDP) Security Descriptions for Media
Streams" defines a Session Description Protocol (SDP) cryptographic attribute
for unicast media streams. The attribute describes a cryptographic key and
other parameters that serve to configure security for a unicast media stream
in either a single message or a roundtrip exchange. The attribute can be used
with a variety of SDP media transports, and RFC 4568 defines how to use it for
the Secure Real-time Transport Protocol (SRTP) unicast media streams. The SDP
crypto attribute requires the services of a data security protocol to secure
the SDP message. For the use of SDES in IMS, the SIP signalling security
mechanisms defined for IMS shall be used, for more details cf. 7.3.2.2.
SDES basically works as follows: when an offerer A and an answerer B establish
a SIP session they exchange cryptographic keys for protection of the ensuing
exchange of media with SRTP. A includes the key, by which the media sent from
A to B is protected, in a SIP message to B, and B responds with a SIP message
including a second key, by which the media sent from B to A is protected.
When used in end-to-end mode SDES has no requirements on the network
infrastructure, except for Lawful Interception. When used in end-to-middle
mode, the requirements on the network infrastructure can be seen from clause
7.3.5.
### 7.3.2 Compliance of SDES with 3GPP requirements
**For each requirement group in clause 5, 3GPP as well as IETF requirements
are given. This clause only discusses the 3GPP requirements. It is structured
in the same way as clause 5.**
#### 7.3.2.1 LI requirements
**SDES allows to comply easily with any LI requirements, as the master keys
for protecting the communication are known to the P-CSCF and any other SIP
proxy processing the INVITE dialogue. LI would also be possible in visited
networks.**
**In more detail:**
**END-TO-END SCENARIOS:**
**Non-roaming case: there is no problem as the encryption key can be obtained
from a node in the SIP signaling path in the home network.**
**Roaming case:**
**LI is always possible in the home network, as the S-CSCF resides in the home
network and can provide the master keys.**
**For LI performed by the visited network, we have to distinguish cases
according to the SIP signaling encryption methods defined in TS 33.203:**
  * **for Early IMS = GIBA the encryption is at GPRS level and terminates at the SGSN, which is in the visited network. So there is no problem with LI performed by the visited network.**
  * **for NIBA there is no encryption anyhow, and security is based on the assumption of physical security, so there is no problem with LI performed by the visited network.**
  * **for IPsec and TLS the encryption terminates at the P-CSCF**
    * **when the P-CSCF is in the visited network there is no problem with LI performed by the visited network.**
    * **when the P-CSCF is in the home network and SIP signaling encryption is enabled between** IMS **UE and P-CSCF then an LI entity in the visited network can obtain the key only with the cooperation of the home network. This is not a problem when home network and visited network are under the same jurisdiction, but may be otherwise.**
** **
**END-TO-MIDDLE SCENARIOS:**
**The media is always available in the clear at the encryption termination
point in the network. There is no problem with LI in the home network. There
is no problem with LI in the visited network in roaming situations if the
encryption termination point resides in the visited network. The latter is
always the case if the encryption termination point resides at the edge of the
access network, For SDES, the end-to-middle scenario is described in clause
7.3.5.**
#### 7.3.2.2 Security requirements
SDES is only a key exchange mechanism, while the security requirements refer
also to the security of the IMS user traffic, i.e. media. For the discussion
of the compliance with the security requirements, it is therefore assumed that
user plane traffic is properly secured based on the keys exchanged by SDES
(e.g. RTP based media traffic is secured by SRTP).
**SDES requires the SIP traffic to be secured between the** IMS **UE and the
P-CSCF. Several alternatives are available for that. In particular, IPsec
(with IMS AKA) and TLS (with SIPS as in RFC3261 or as in TS 33.203 Annex O)
are specified. SDES provides the same level of security for IMS media which is
also provided by IMS for SIP signalling. So, the user can place the same
degree of trust on media security as on signalling security. Within the core
network, SDES requires secure transport between all SIP proxies and trust in
all SIP proxies. Between the SIP proxies, security can be provided according
to the principles of NDS/IP. On the SIP proxies, however, the keys transported
with SDES become visible in plaintext. Therefore, the SIP proxies must be
trusted. SDES is not compliant with the requirement to protect IMS user
traffic against on core network nodes. It is still open if this requirement
can be relaxed (see NOTE 1 of clause 5.4).**
**Against parties that do not control one of the involved SIP proxies, SDES
with hop-by-hop protection between all involved SIP agents provides security
for the key exchange. Combined with the media plane security protocol SRTP,
the security will be higher as for insecured sessions. It should be noted that
as media keys will be available/transported in plaintext in all SIP proxies,
compromise of these proxies will allow, not only signalling security, but also
media security, to be compromised.** However, even if media keys are not
exposed to the proxies, the proxies need to be protected anyway to secure SIP
signalling which is an important requirement for operators and users.
**Within the IMS, protection of the SIP traffic can be expected to be
available, using the IMS access security mechanisms and NDS/IP. Outside the
IMS, at least SIPS (with hop-by-hop TLS) is likely to be supported. It is
unclear, how non-IMS SIP providers secure their SIP proxies. This makes SDES
appear less secure in a non-IMS environment. On the other hand, from the
perspective of an end user, it may not make much difference whether a foreign
network, which transports the signaling traffic, is an IMS or not. Typically,
the level of trust is lowered by the involvement of foreign networks, be they
IMSs or not.**
Requirement 7 is satisfied by SDES by using signalling integrity and assertion
of identities (P-Asserted-Identity), which prevents spoofing of the user
identities IMPI/IMPU. Note that the caller can decide to cancel the call if it
is terminated by an undesired callee.
**The conclusion is that with the assumptions described in the paragraphs
above, SDES complies with the 3GPP security requirements for sessions within
an IMS environment, except possibly with Requirement 5. Outside the IMS
environment, this may or may not be the case, depending on the availability of
SIPS and the trustworthiness of the involved non-IMS-SIP providers.**
#### 7.3.2.3 Requirements related to SIP based call features
**Concerning forking/retargeting and support of early media, clause 5 doesn\'t
state 3GPP specific requirements -- only the IETF requirements apply, cf.
further below.**
**Concerning secure multiparty communications, it must be noted that SDES
according to RFC 4568 is currently restricted to point-to-point unicast
communication, and multicast is for further study. However, SDES allows each
sender to choose a key for the traffic it sends, which may be used as a basis
for the support of efficient multicast, where a sender doesn\'t need to
protect the traffic it sends differently for different receivers. A further
discussion on needed extensions to SDES to more fully support multicast can be
found in clause 7.3.6.4 on Multicast Support.**
#### 7.3.2.4 Architectural requirements
Clause 5.6 lists eleven architectural 3GPP requirements. Compliance of SDES
with these requirements is obvious in most cases. Only the most important ones
are discussed in this clause.
SDES supports security between SIP endpoints, i.e. end-to-end security. A SIP
endpoint could also be a network node, e.g. a SIP application server. So the
case of end-to-middle security where the node terminating the media plane
security within the network is a SIP endpoint is clearly also supported.
End-to-middle security further comprises also cases, where the node within the
network that terminates the media plane security is not a SIP endpoint or is
not in the signaling path at all. E.g., it could be a PSTN-MGW or an IP-IP-MGW
performing transcoding. Such a MGW will be controlled by some node that is
aware of the SIP signaling, and thus knows the keys transmitted with SDES. It
is assumed that technically, it is rather easy and straightforward to enhance
the control protocol between controller and MGW, e.g. H.248, to support
sending the key to the MGW. For more details on how SDES can support end-to-
middle scenarios, see clause 7.3.5.
The requirement to support media recording is marked as \"ffs\" in clause 5.
The requirement doesn\'t specify any details on what kind of recording it
refers to. One can imagine various scenarios for media recording, in
particular recording of encrypted or plaintext media within the network.
Recording plaintext media means terminating the media plane security within
the network, which is supported by SDES as described in the previous
paragraph. In case encrypted media has to be recorded (e.g. the \"deferred
delivery\" as described in the use case in clause 4.1, SDES would allow to
store the key together with the encrypted message. The same level of trust can
be assumed for a network node recording encrypted messages as for any SIP
proxy that handles the keys transmitted with SDES.
Concerning the interoperability with non-IMS-capable UEs, SDES provides a
possible basis, as SDES is a standards track RFC of the IETF. SDES is already
widely deployed in IMS UEs -- currently it is the de facto interoperability
standard for \"IETF-compliant\" equipment that supports SRTP. (Quotation from
the summary report of the SIPit22 interoperability test event on April 14-18,
2008 (https://www.sipit.net/SIPit22_Summary**)** : \"There was a significant
amount of successful SRTP interop at this event.... Most of the tests
established the session using sdes.\"). However, it should be noted that IETF
currently promotes a new key management solution called DTLS-SRTP.
#### 7.3.2.5 Scalability, cost and performance
SDES complies with these requirements, as it is a simple, straight forward
approach without the need of additional network elements, expensive
computations, multiple roundtrips etc. provided that the IMS infrastructure
provides the security for the SIP signalling and the SIP proxies required. If
such security is not provided, cost and complexity of an update to provide it
may be substantial. SIP proxies handling SDES crypto attributes may need
enhanced security.
#### 7.3.2.6 Requirements regarding the access network type
SDES complies with these requirements. In particular,
  * it is access network independent;
  * it leverages the IMS security architecture in that it is totally reliant on it;
  * it works independently of any of the different authentication methods defined for IMS.
#### 7.3.2.7 Backward compatibility and migration
SDES complies with these requirements. In particular, keys and other
parameters can be negotiated individually for each call, and downgrading
attacks cannot be done in the secure signaling environment that is assumed.
#### 7.3.2.8 Other requirements
RFC 4568 currently only describes the usage of SDES for exchanging keys and
other crypto parameters for securing RTP based media traffic by SRTP (RFC
3711). However, RFC 4568 indicates that SDES could also be used for exchanging
keys for other media plane security protocols, by defining additional forms of
\"crypto objects\". For example, an enhanced SDES may be used to establish a
\"shared key\" for TLS-PSK (RFC 4279), thus allowing to secure TCP based media
traffic. (According to RFC4568, each party currently provides one master key
for securing the media traffic it will send. For TLS-PSK, a single shared
secret is needed. This could be generated by applying a hash function or
pseudo random function to the combined keys provided by the two parties. This
will create a single shared secret and at the same time solve any issues with
forking and retargeting in this scenario. See also clause 7.3.3.2.)
Note that, according to requirement 45, it may be acceptable to standardise
more than one solution if this offers lower complexity. In this case SDES
could be used in the case of RTP traffic, and either an enhancement of SDES to
support key management for protocols other than RTP or different solutions may
be used.
Protection of media transmitted with SIP messages (e.g. using SIP MESSAGE),
would not require any additional measures in the SDES approach, as a secure
signaling path is assumed.
### 7.3.3 Compliance of SDES with IETF requirements
**The IETF requirements are described in** /ID-MediaSecReqs/, which is in
\"working group last call\" at the moment.
**Clause 5 has not been aligned with the IETF media security requirements
draft for a considerable amount of time. So currently, it is not clearly
specified, which IETF requirements are considered relevant for the 3GPP
solution. Several IETF requirements are already covered by 3GPP requirements
and have therefore been discussed in clause 5.**
**Therefore, in this clause, not every IETF requirement is discussed in
detail. However, the important IETF requirements are covered, including the
requirements, where there might be doubts about the compliance of SDES.**
#### 7.3.3.1 Security requirements
**IETF security requirements have already been discussed in 3GPP Tdoc
S3-080100. The strongest security requirement that** /ID-MediaSecReqs/
**currently contains is requirement \"R-ACT-ACT\": A solution must provide a
mode where an attacker, for performing a successful attack, must be active in
both the signaling and the media path, and where such an attack would be
detectable by the end users. /ID-MediaSecReqs/ states, that compliance of a
mechanism with such a requirement cannot be evaluated absolutely, but depends
on additional assumptions. For example, the ID evaluates DTLS-SRTP as
compliant with R-ACT-ACT, assuming that the SIP-proxies performing the
authentication service according to RFC4474 are trusted (i.e. not compromised
by attackers). Without this assumption, DTLS-SRTP does not fulfill R-ACT-
ACT.**
In the IMS environment, as long as none of the nodes is compromised, there is
no way to break the security of SDES. So in that environment, SDES (which is
evaluated in /ID-MediaSecReqs/ to be susceptible even against a passive
attack) fulfills the strongest security requirement R-ACT-ACT. (Note that, for
DTLS-SRTP, only authenticating SIP nodes need to be trusted, while for SDES
all SIP nodes in the signalling path needs to be trusted.)
#### 7.3.3.2 Forking/retargeting
Editor's note: None of the IETF requirements from /ID-MediaSecReqs/ in this
clause is currently contained in clause 5, so, strictly speaking, a solution
proposed to 3GPP need not be compatible with these at all. However, earlier
forms of some of these requirements are contained in clause 5. We believe it
makes more sense to discuss the most recent form of the IETF requirements from
/ID-MediaSecReqs/. Nevertheless, a decision has still to be made by SA3 about
the relevance of these IETF requirements for 3GPP.
**/ID-MediaSecReqs/ states the IETF-requirement**
R-FORK-RETARGET:
The media security key management protocol MUST securely
support forking and retargeting when all endpoints are willing
to use SRTP without causing the call setup to fail. This
requirement means the endpoints that did not answer the call
MUST NOT learn the SRTP keys (in either direction) used by the
answering endpoint.
**Without modifications, SDES is not compliant with this requirement. For
certain scenarios it can be argued, that forking and retargeting will be
performed between endpoints that have a close relationship and possibly also a
high degree of trust between each other. In such forking/retargeting scenarios
SDES could be considered sufficiently secure.** Examples of such forking /
retargeting scenarios include: forking to different IMS UEs controlled by a
single user, forking to different clerks in a call center that all process the
same types of requests, retargeting from a person to its substitute. In other
scenarios like when a conversation is privileged between e.g. a counselor and
a client, such trust assumptions do not hold true and other solutions would be
required.
**In scenarios, where such a level of trust between forked/retargeted
endpoints cannot be assumed, an obvious workaround is to rekey the session
with only that parties that actually participate in the session. This would
require an UPDATE or re-INVITE and therefore some additional signaling. A
problem is that the inviting party may not always be aware of the fact that
other, non-responding endpoints may have received the SDP offer, and therefore
must rekey for every session. This problem might be alleviated by letting the
answerer perform the rekeying, assuming that the answerer knows, whether
forking/retargeting is configured for the chosen URI, and whether it perhaps
acceptable that other forked endpoints have got the key.** The above text
assumes a setup where parties just know it. This will be the case in many
scenarios, e.g., a clerk in a call center will know that incoming calls are
forked to all clerks, and a user will know that he has configured his account
in a way that incoming calls are forked to his various IMS UEs etc.
**Support of SIP forking is also discussed in the SDES RFC (RFC 4568) itself,
in its section 7.3.**
**/ID-MediaSecReqs/ further states the IETF-requirement**
R-DISTINCT:
The media security key management protocol MUST be capable of
creating distinct, independent cryptographic contexts for each
endpoint in a forked session.
**For SDES, if an offerer gets two or more answers, there will be two or more
keys for received media. Creating different contexts for received media
streams is no problem.**
**For sending media, creating different contexts per receiver (all with the
same key) is possible for the caller (e.g. by instantiating the data structure
describing the crypto context per receiver). There maybe be minor issues, e.g.
if the key lifetime is expressed by the maximum number of packets that can be
encrypted with the key, then it has to be taken into account that the same key
is used for different contexts. Note that there is no security problem with
using the same (master) key for different flows, as the sender can use
different SSRC ids for them (synchronization source ids, see RFC 3550), which
results in different key streams for the different flows.**
**It may also be argued that in a forked session, the caller will not send
different streams to the forked endpoints, and therefore doesn\'t really need
different crypto contexts. If the caller however decides to start a session
with several endpoints that were reached by forking of the original INVITE,
the caller can easily re-INVITE these endpoints and specify new, different
keys.**
**/ID-MediaSecReqs/ further states the IETF-requirement**
R-HERFP:
The media security key management protocol MUST function
securely even in the presence of HERFP behavior.
**HERFP behavior is shortly explained in /ID-MediaSecReqs/: In a forked call,
rejections of the INVITE sent by different endpoints may be terminated at the
forking proxy and never reach the caller.**
**SDES does not comprise mechanisms that allow an answerer to send indications
about key exchange failures (in order to let the offerer \"make another
try\"). If a sender has included crypto objects for all crypto suites it is
willing to use and does not get a response accepting any of these crypto-
objects, there is nothing it could do to establish the crypto session, even if
it would have received all the (rejecting) answers from the different
endpoints the INVITE has been forked to. So SDES complies with R-HERFP.**
**Another IETF-requirement, mentioned under \"media considerations\", is also
relevant with respect to forking, in case forking leads to a multiparty
session:**
R-ASSOC:
The media security key management protocol SHOULD include a
mechanism for associating key management messages with both the
signaling traffic that initiated the session and with protected
media traffic. Allowing such an association also allows the
SDP offerer to avoid performing CPU-consuming operations (e.g.,
Diffie-Hellman or public key operations) with attackers that
have not seen the signaling messages.
**With SDES, keys are exchanged in the signaling messages, so association of
key management to signaling is clear. SDES has an issue concerning the
association of incoming media to the keys transported with SIP signaling, if
several endpoints answer on a single INVITE and start sending media. E.g., in
an RTP session where A receives on one of its transport addresses (IP address
+ UDP port) media streams from two parties B and C, B and C will use
individual keys, and must also use different SSRC ids (synchronization source
ids, see RFC 3550). As SDES doesn\'t define the transport of SSRCs within the
crypto object (but uses the \"late binding\" approach, see RFC 4568), at the
beginning, A will not know, which key to use for which SSRC. In case of an
authenticated packet, A can find this out deterministically by trying all
received keys. (Note that while authentication is mandatory only for RTCP, but
not for RTP, for general security reasons it is highly recommended to
authenticate also RTP.)**
**These additional computations are only needed when a new SSRC id appears.
Moreover, they can be avoided completely by using different receive ports for
the streams received from different senders. RFC 4568, in its section 7.3,
suggests to take this approach. It also states that alternative approaches are
possible.**
**Note further, that SDES doesn\'t require expensive computations (like DH
exchanges), which alleviates the problem of DoS attacks as mentioned in
R-ASSOC.**
**Finally, the following IETF requirement refers to forking/retargeting:**
R-BEST-SECURE:
Even when some end points of a forked or retargeted call are
incapable of using SRTP, a solution MUST be described which
allows the establishment of SRTP associations with SRTP-capable
endpoints and / or RTP associations with non-SRTP-capable
endpoints.
**Concerning the multi-party aspects of this, see clause 7.3.6.4. Concerning
the usage of RTP instead of SRTP, see the discussion of R-ALLOW-RTP in clause
7.3.3.3.**
#### 7.3.3.3 Early media
**cf. remark on relevance of IETF requirements at the start of clause 5.1.**
**The respective IETF requirement is**
R-AVOID-CLIPPING:
The media security key management protocol SHOULD avoid
clipping media before SDP answer without requiring Security
Preconditions [RFC5027].
**SDES allows decryption only after successful transmission of the SDP answer,
so encrypted media would be clipped before that. However, 3GPP generally
assumes SBCs in the media path that block media before SDP answer anyway. So
SDES doesn\'t lead to a specific problem here.**
**It may also be considered to allow the usage of unencrypted early media and
apply protection only to media after the SDP answer. This may be reasonable
for non-sensitive announcements, ring tones, advertisement etc. Usage of RTP
for early media and then changing to SRTP after the SDP answer could be
specified outside SDES, just by suitable definition of the semantics of an SDP
offer specifying an encrypted session. This approach would also be in line
with another IETF-requirement:**
R-ALLOW-RTP: A solution SHOULD be described which allows RTP media
to be received by the calling party until SRTP has been
negotiated with the answerer, after which SRTP is preferred
over RTP.
### 7.3.4 Summary requirement compliance
Within an IMS environment assuming trusted SIP proxies and usage of the
recommended security mechanisms (e.g. TLS or IPsec in the access, or Za/Zb
interfaces in the core) SDES provides a security level corresponding to the
access protection of cellular systems. Outside the IMS, support of SIP over
TLS has to be assumed and if applied would protects SIP messages between the
proxies. A remaining security risk is that one of the involved operators is
malicious or fails to protect its proxies against attackers. It has to be
evaluated if this is acceptable for operators as well as the most relevant
user groups. Still, it would be an improvement compared to the unencrypted
media streams in a \"legacy\" IMS and the PSTN.
SDES is a lean approach, without needing any involvement of the network and
without the need to modify existing networks given that the networks provide
the required security mechanisms to have secure SIP signalling and trusted and
protected SIP-proxies. Under these conditions it is cost efficient and it
scales well. It does not require expensive computations or additional
roundtrips, so it does not cause any significant overhead and does not
adversely affect any IMS services.
SDES is a mechanism that is already widely deployed in non-IMS UEs --
currently it is the de facto interoperability standard for \"IETF-compliant\"
equipment that supports SRTP. However, it should be noted that IETF currently
promotes a new key management solution called DTLS-SRTP. SDES allows to comply
with any requirements where LI is performed in the home network, and, in many
scenarios, also with requirements where LI is performed in the visited
network, as the operator has access to the keys exchanged in the signalling
messages. Access to the keys is always possible for the home operator, and, in
many scenarios, also for the visited operator.
### 7.3.5 SDES in end-to-middle scenarios
While SDES is suitable as an end-to-end solution, where only the endpoints
encrypt/decrypt the media streams, it is usable in a straightforward way also
as an end-to-middle solution.
The classical end-to-middle scenario is a call between an IMS endpoint and a
PSTN endpoint. Here, the media gateway (plus its controller) can perform the
media plane security procedures on behalf of the PSTN endpoint. In this
approach, the network chooses a key for protecting the media sent by the PSTN
endpoint on the IP based call leg and inserts the key into the SDP body sent
to the IMS endpoint. This key, as well as the key provided by the IMS
endpoint, are passed to the media gateway which performs encryption/decryption
between the PSTN call leg and the IP based call leg.
Figure 13 illustrates the principle of this procedure, for a voice call from
an IMS endpoint to a PSTN endpoint. Note that the picture is an abstraction
focussing on the SDP offer and answer, not on the SIP messages. It does not
show the different SIP roundtrips required for the call setup within the IMS.
In addition, it does not show any details of the signaling towards the PSTN.
{width="5.995833333333334in" height="4.452083333333333in"}
Figure 13: SDES flow with a PSTN end-point
Description:
> (1) An SDP offer for an SRTP stream and a crypto object containing a key K1
> from an IMS endpoint arrives at the signaling gateway (SGW) controlling the
> PSTN MGW.
>
> (2) The SGW performs the TDM based signaling towards the PSTN.
>
> (3) At some time, the call setup reaches a state where an SDP answer can be
> sent to the IMS endpoint. The SGW creates a key K2 for protecting the media
> stream from the PSTN MGW to the IMS endpoint.
>
> (4) The SGW commands the PSTN MGW to relay the voice of the call. For the IP
> based leg, the command comprises the relevant transport addresses and the
> keys for both directions.
>
> (5) The SGW sends an SDP answer to the IMS endpoint, comprising the
> transport address at the MGW and K2.
>
> (6) Media can be passed between the IMS endpoint and the PSTN endpoint. SRTP
> is used on the IP based leg. The PSTN MGW performs decryption for data
> arriving from the IMS endpoint and encryption for the data sent to the IMS
> endpoint.
Another scenario, where end-to-middle security may be applied, is in calls
where one endpoint does not support media plane security. Such an endpoint
will not use SDES in INVITE requests and in answers to such requests. Like in
the PSTN gateway scenario, the operator could act on behalf of such an IMS UE
and by this provide media plane security at least in the call leg that lies
within the operator\'s network. The operator may also decide to apply media
plane security not for the complete call leg, but only between the edge of the
IMS core network and the security-capable endpoint. This may be reasonable if
the core network already provides media transport that is sufficiently
secured. In both cases, a signaling proxy in the operator\'s network inserts
the key management info into the SDP sent towards the security-capable
endpoint, and a media proxy in the operator\'s network performs
encryption/decryption based on the keys provided to it from the proxy in the
signaling path that controls the operation.
Media plane security applied between the user equipment and the edge of the
IMS core network, as mentioned in the previous paragraph, provides in
particular protection of IMS media over the access network, cf. also clause
7.2. By the very nature of any such solution, media keys must be available in
the SIP proxy controlling the encryption termination point (media proxy) at
the edge of the network (cf. SPA and MPA in Figure 14 below). This SIP proxy
typically is the first hop SIP proxy, i.e. the P-CSCF (similar to what is
shown also in Figure 11). Assuming network domain security between SIP proxy
and media proxy, the level of security of the media key management solution is
then as high as the level of security of the protocol used for IMS SIP
signaling protection between IMS UE and P-CSCF. A high degree of protection
can be obtained in this scenario by the use of IMS AKA with IPsec or Digest
with TLS (each with encryption enabled), as defined in TS 33.203, as then the
protection extends in an uninterrupted fashion between IMS UE and P-CSCF.
NOTE: The use of SDES in this scenario is also possible with other signaling
security methods defined in TS 33.203 in an identical way (as the use SDES
does not depend on any of these methods), but it should be noted that all
these other methods in TS 33.203 make assumptions on the security of the
underlying access networks for providing SIP signaling security. These
assumptions would then also apply to media security and may even make end
media protection unnecessary, e.g. due to the strong link layer security on
which GIBA is based.
Figure 14 illustrates the principle of this procedure, for a call from
endpoint A supporting SRTP/SDES to an endpoint B that supports only RTP (no
SRTP). Note that the picture is an abstraction focussing on the SDP offer and
answer, not on the SIP messages. In addition, it does not show the different
SIP roundtrips required for the call setup within the IMS.
{width="5.995833333333334in" height="4.452083333333333in"}
Figure 14: SDES flow where one end-point does not support SRTP/SDES
Description:
> (1) An SDP offer for an SRTP stream and a crypto object containing a key K1
> arrives from endpoint _A_ at the SIP proxy _SPA_. _A_ prefers SRTP, but he
> cannot assume that this is supported by _B_ and is willing to communicate
> even without security, if necessary. So he has included an offer for
> unencrypted communication, i.e. RTP, too.
>
> (2) To route the offered media stream towards _A_ via the media proxy _MPA_
> , the SIP proxy changes the transport address in the SDP offer from the
> address at _A_ (addr\@A) to an address at the media proxy (addr1\@MPA) and
> sends the changed SDP offer towards _B_.
>
> (3) An SDP answer from _B_ arrives at the SIP proxy, which analyses it and
> finds out, that _B_ does not support SRTP but can use RTP only.
>
> (4) The SIP proxy creates a key K2 for protecting the media stream towards
> _A_ between the media proxy and _A_.
>
> (5) The SIP proxy commands the media proxy to relay the stream from _A_ to
> _B_ and to decrypt the media arriving from _A_ using K1. Another address at
> the media proxy (addr2\@MPA) is used for routing the media stream to the
> media proxy.
>
> (6) The SIP proxy commands the media proxy to relay the stream from _B_ to
> _A_ and to encrypt the media arriving from _B_ using K2.
>
> (7) The SGW sends an SDP answer to the endpoint, comprising a transport
> address at the media proxy _MPA_ (addr2\@MPA), indication of support of
> SRTP/SDES and the key K2.
>
> (8) Media is exchanged between _A_ and _B_ via the media proxy, which
> decrypts media arriving from _A_ and encrypts media arriving from B before
> passing the media on.
Note that in these e2m scenarios endpoint A has only a security association
with a proxy or gateway, not an e2e security association as with normal SDES
usage according to the RFC 4568. If the subscription only promises to provide
e2m protection rather than e2e protection, this is obviously not an issue.
Clearly, if the security state of a session is indicated to the user, an
indication associated with \"e2e security\" should not be sent or shown by the
IMS UE.
A reasonable approach minimizing user intervention for e2m security while
maximizing the usage of protection could be that the IMS UE supporting media
security with SDES is configured to, when making calls, always send offers of
protected communication. For the purpose of receiving calls, there should be
an appropriate node in the terminating network always insert an offer of
protected communication, if this is not already part of the original offer
from the calling party. The IMS UE may or may not be configured to indicate
whether a session is protected (meaning e2m protection).
### 7.3.6 Possible enhancements to an SDES based solution
As discussed in the previous clauses, there are some issues with plain SDES as
described in RFC 4568, in particular related to SIP based call features, i.e.
forking/retargeting and early media. Workarounds have been described how to
cope with these issues without changing SDES itself. These workarounds may
provide acceptable solutions to the discussed issues.
Nevertheless, alternatives are considered how a solution based on SDES might
be enhanced in order to provide improved support for SIP based call features.
These alternatives may provide more efficient solutions. We provide an outline
of possible approaches in the following.
With respect to other requirements, in particular the security requirements,
these new approaches are very similar to regular SDES.
#### 7.3.6.1 The SDES crypto object
For the convenience of the reader, this clause shortly describes the usage of
the crypto object according to RFC 4568.
SDES introduces a crypto object
> a=crypto:\ \ \ [\]
with
> key-params = \ \":\" \
and only a single key-method (value \"inline\"), where a key is contained
directly in the crypto object.
If A sends an INVITE to B, the crypto object in the INVITE contains the key
for the traffic to be sent from A to B. A can include several crypto objects.
B must select one of them (identified by \), but must insert a different
key. This key is used for traffic sent from B to A.
#### 7.3.6.2 Advanced support for forking/retargeting
The security issue with forking could be addressed by interpreting the \ of SDES in the SDP offer not as the key, but as a nonce used to derive
the key. Together with the \ of SDES in the SDP answer, it could
serve as an input to a hash function or pseudo random function that generates
the key. By this mechanism, forked endpoints that do not engage in the session
will not get the key used for the traffic sent by the SDP offerer. As a trade-
off, the offerer could no longer use a common key for different receivers in a
multiparty communication.
According to the previous paragraph, the \ of SDES in the SDP answer
can be used as an input for a key derivation function to derive the key for
securing the traffic sent by the offerer. Obviously, this key derivation
function could also generate a (different) key for the traffic in the opposite
direction. However, it might be advantageous to use the \ of SDES in
the SDP answer directly as the key to protect traffic from the answerer to the
offerer, because this supports efficient multicast by the answerer (i.e. using
a common key for a stream that is sent to multiple receivers).
Note that the same support for forking/retargeting and multiparty
communications can be achieved by deriving both keys solely from the \ provided by the answerer.
#### 7.3.6.3 Support for encrypted early media
It is unclear whether this is a 3GPP requirement at all. If it is, the
subsequent considerations may be taken into account.
Support of encrypted early media requires the SDP offerer to somehow provide
the key to be used to protect the media sent to it. This would be in
accordance to the session description concept applied in SIP, where each
endpoint describes the streams it is willing to receive rather than the
streams it is going to send. This approach is discussed in an appendix of RFC
4568. A number of problems exist, as well as workarounds for these problems.
A now expired internet draft (**draft-wing-mmusic-sdes-early-media-00,**
available from http://tools.ietf.org/html/), proposes that the offerer
provides keys for both directions. Obviously, this makes the
forking/retargeting issues even worse, because all endpoints seeing the INVITE
get keys for both directions (not only for the traffic sent by the offerer as
in regular SDES). This could be mitigated again by specifying that such a SDP
answerer provide a new key for the direction answerer to offerer. This new key
replaces the key provided by the offerer. With this modification, the approach
would not solve the forking/retargeting issue of the regular SDES, but would
provide some support for early media without sacrificing the multicast
properties of SDES (each sender can choose a common key for the streams it
sends to different recipients).
An alternative approach is to let the offerer provide only a (preliminary) key
for receiving encrypted early media, and the answerer provide the final keys
for both directions. This would be similar to the approach mentioned in the
last paragraph of clause 7.3.6.1, with additional support for encrypted early
media.
#### 7.3.6.4 Multicast support
**SDES according to RFC 4568 currently is restricted to point-to-point unicast
communication. As discussed in clause 7.3.6.2, multiparty communication is not
excluded by this. If however multicast communication is considered to be a
strong requirement, SDES may need to be enhanced to make it more flexible and
capable.**
**For example, the crypto-object may be enhanced to be able to transmit more
input values to the SRTP crypto context, e.g. rollover counter and sequence
number. Also more session info might be helpful, e.g. SSRC ids.**
#### 7.3.6.5 How to indicate new SDES key exchange semantics
**An obvious way to indicate usage of one of the proposed new key exchange
mechanism is to introduce new key words for \ .**
Alternatively, one could replace the current semantics of the \ in
SDES even without change of the protocol syntax of SDES, only by using the
transmitted \ not necessarily as the sending key, but in the new
\"modes\" described in the previous clauses.
When using the unchanged syntax of SDES with new semantics, this might be
indicated by a new field in the SIP header or within the session description.
This field must be used by the caller to indicate, which of the modes the
caller wants to use.
If a called endpoint supports this mode, it returns the same value, and the
semantics of the specified mode are used. If the called endpoint does not
support the mode, it does not return the value, which means fallback to
regular SDES.
If the called endpoint does not recognize the new field, it will ignore it and
will not return it. Again, this results in the usage of regular SDES.
A called endpoint must not use the new field if the calling endpoint didn\'t
use it, and it must not select a different mode.
In this way, interoperation between endpoints that can use the new semantics
and endpoints that do no know the new semantics is possible.
## 7.4 "Otway-Rees" based key management protocol
### 7.4.1 Definitions
KMS: Key Management Server.
ID-A: Identity of User A.
ID-B: Identity of User B.
Ka: Shared key between IMS UE-A and KMS.
Kb: Shared key between IMS UE-B and KMS.
Ea (X): X is encrypted with key Ka.
Eb (X): X is encrypted with key Kb.
### 7.4.2 Solution description
Figure 15 shows a basic idea for IMS media security solution, which is based
on the "Otway-Rees" key management protocol.
Figure 15: Otway-Rees key management system
1a. IMS UE-A bootstraps with KMS to establish a shared key Ka.
1b. IMS UE-B bootstraps with KMS to establish a shared key Kb.
NOTE: Ka/Kb may be established through GBA mechanism where KMF is a NAF, or
other methods.
  1. IMS UE-A sends an INVITE message which includes the following parameters: plain identity of user A ID-A, plain identity of user B ID-B and Ea (ID-A, I, ID-B) (encrypted ID-A and ID-B with key Ka,).
  2. The INVITE message is sent to IMS UE-B.
  3. IMS UE-B sends a request message, which includes the following parameters: plain ID-A and plain ID-B, Ea (ID-A, ID-B) and Eb (ID-A, ID-B) (encrypted ID-A and ID-B with key Kb,), to the KMS to request the master key K for media protection.
  4. The KMS uses the plain ID-A and plain ID-B respectively to retrieve the shared key Ka and Kb, then use these keys respectively to get decrypted ID-A and ID-B from Ea (ID-A, I, ID-B) and Eb (ID-A, I, ID-B), and compare the decrypted ID-A and ID-B with plain ID-A and ID-B to make sure they are same. KMS then generates the master key K for media protection.
  5. The KMS encrypts the master key K using Ka to get Ea (K), and encrypts the master key K using Kb to get Eb (K), then sends the Ea (K) and Eb (K) to IMS UE-B in the response message.
  6. IMS UE-B gets K by decrypt Eb (K) using Kb.
  7. IMS UE-B sends the 200 response message which includes the Ea (K).
  8. The 200 response message is sent to IMS UE-A.
  9. IMS UE-A gets K by decrypt Ea (K) using Ka.
> Now IMS UE-A and IMS UE-B share the master K which can be used further to
> protect the media between them.
### 7.4.3 Analysis
#### 7.4.3.1 Peer-to-peer
For peer to peer communication, the solution could support end to end media
protection.
#### 7.4.3.2 Forking
Forking scenarios include two situations:
1\. A call is forked to different terminals belonging to a single user.
2\. A call is forked to different users within a group based on the user-
specific policy registered in advance.
In forking scenarios, all terminating terminals should use unique keys, and
only the terminal to which the call is finally established must get hold of
the media encryption key, while other terminals must not be able to obtain the
key. The proposed way to generate the media keys in forking scenarios is
straightforward. It makes use of a key derivation function modifying a base
key generated by the KMS with the help of a random value, which is generated
by each terminal on the terminating side.
Figure 16 depicts the procedures for forking key generation. IMS UE-B is
assumed to be the terminal that finally answers the call, while IMS UE-C is
any other forked terminal.
**Figure 16: Signaling diagram for parallel forking**
ID-G is a collective identity for all forked terminals, IMS UE-B and IMS UE-C.
IMS UE-B is the terminal which finally answers the call.
1a. IMS UE-A bootstraps with KMS to establish a shared key Ka.
1b. IMS UE-B bootstraps with KMS to establish a shared key Kb.
1c. IMS UE-C bootstraps with KMS to establish a shared key Kc.
NOTE: Ka/Kb may be established through GBA mechanism where KMS is a NAF or
through other methods.
2a. IMS UE-A generates a random Ra.
2b. IMS UE-A sends an INVITE message which includes the following parameters:
plain identity of IMS UE-A ID-A, plain identity of ID-G and Ea(Ra, ID-A,
ID-G)(encrypted Ra, ID-A and ID-G with key Ka).
3\. IMS network forwards INVITE message to corresponding IMS UEs, i.e. IMS
UE-B and IMS UE-C in parallel or in sequence based on the user-specific
forking policy. Note that in Figure 16, parallel forking is showed. For
sequential forking, only the step sequence is changed, but no main difference
occurs.
4a. After receiving the INVITE message, each IMS UE generates a random number,
i.e. IMS UE-B generates Rb, IMS UE-C generates Rc.
4b. Each IMS UE sends a request message to KMS. IMS UE-B sends a request
message including plain ID-A, ID-B, Ea(Ra, ID-A, ID-G) and Eb(Rb, ID-A,
ID-B)(encrypted Rb, ID-A and ID-B with key Kb), and IMS UE-C sends a request
message including plain ID-A, ID-C, Ea(Ra, ID-A, ID-G) and Ec(Rc, ID-A, ID-C
)(encrypted Rc, ID-A and ID-C with key Kc).
5.KMS uses the plain ID-A, plain ID-B and plain ID-C respectively to retrieve
the shared key Ka, Kb and Kc, then use these keys respectively to get
decrypted ID-A and ID-G from Ea(Ra, ID-A, ID-G), ID-A and ID-B from Eb(Rb,
ID-A, ID-B) and ID-A and ID-C from Ec(Rc, ID-A, ID-C), and KMS compares the
decrypted ID-A and ID-G with plain ID-A, ID-B and plain ID-A, ID-C to ensure
that they have the same ID-A, and ID-B, ID-C matches the ID-G. Then KMS
generates the master key K. Note that, for the same originating IMS UE, KMS
will generate only one master key for all receiving IMS UEs.
Editor's note: More information is needed to clarify how different messages
towards the KMS are correlated.
6\. For IMS UE-B, the KMS encrypts random numbers Ra, Rb and the master key K
using Ka to get Ea(Ra, Rb, K), and encrypts the master key K using Kb to get
Eb(K). For IMS UE-C, the KMS encrypts random number Ra, Rc and the master key
K using Ka to get Ea(Ra, Rc, K), and encrypts the master key K using Kc to get
Ec(K).Then KMS sends the Ea(Ra, Rb, K) and Eb(K) to IMS UE-B, and sends Ea(Ra,
Rc, K) and Ec(K) to the IMS UE-C in the response messages.
7\. IMS UE-B and IMS UE-C get K by respectively decrypting Eb(K) using Kb and
decrypting Ec(K) using Kc then deriving the unique media key by performing a
key derivation function on the master key K and the random number that is
generated by each terminal, i.e. for IMS UE-B, Ka-b= KDF(K, Rb) is derived and
for IMS UE-C Ka-c=KDF(K,Rc) is derived uniquely.
8\. IMS UE-B sends the 200OK response message which includes the Ea(Ra, Rb, K)
to IMS network.
9a. IMS network forwards the 200OK response message to IMS UE-A.
9b. As the call is established between IMS UE-A and IMS UE-B, IMS network
sends CANCEL message to other terminals, i.e. IMS UE-C in Figure 1.
10\. IMS UE-A gets K and Rb by decrypting Ea(Ra, Rb, K) using Ka, it then
derives the media key using KDF from the master key K and the random number
Rb, i.e. Ka-b=KDF(K,Rb).
Now IMS UE-A and IMS UE-B share the same unique media key Ka-b that is used to
protect the media between them.
#### 7.4.3.3 Deferred delivery
Figure 17 shows the procedure for the deferred delivery solution. For the sake
of simplicity the random number used in each message to prevent replay attack
is omitted in the message diagram.
Figure 17: Signalling diagram for deferred delivery
> 1a. User A bootstraps with KMS to establish a shared key Ka. If GBA is not
> support, User A can use other authentication method to get shared key Ka
>
> 1as. Mailbox AS can establish a secure connection with KMS by IPsec, TLS,
> GBA, etc by which KMS and mailbox AS can have a shared secret Kas.
  1. User A sends an INVITE message which includes the following parameters: plain identity of user A, ID-A, plain identity of user B, ID-B and Ea (ID-A, ID-B) (encrypted ID-A, ID-B with key Ka) to IMS network.
  2. IMS network forward INVITE message to User B's mailbox server.
  3. Once receive the INVITE message from user A, User B's mailbox server sends a request message, which includes the following parameters: plain ID-A, plain ID-B, Ea (ID-A, ID-B) and Eas(ID-A,ID-B) to the KMS to request media key K.
  4. KMS use Ka, Kas to get decrypted ID-A, ID-B from Ea (ID-A, ID-B) and Eas(ID-A,ID-B), and compare the decrypted ID-A, ID-B with plain ID-A , ID-B to make sure they are same. Then KMS generate the media key K either by reusing the previous media master key or generating the new one.
> NOTE: The KMS needs to maintain state in order to keep keys per user pair.
>
> Editor Note: Some more information is needed to describe how policies
> regarding key re-use are handled.
  1. KMS encrypts the K using Ka to get the Ea(K), and then sends the Ea(K) to user B's mailbox server in the response message.
  2. User B's mailbox server send the Ea(K) to IMS network in the response message to user A.
  3. IMS network forward the response message to user A.
After the above-mentioned procedure, user A gets the media key K while user
B's mailbox server has no way to get the media key K. So the UE-B's mailbox
server cannot access the plaintext of the media.
Once the user B gets online, it first gets security parameters including ID-A,
ID-B, Ea(ID-A, ID-B) from user B's mailbox server. From those security
parameters, IMS UE-B get to know there is a deferred media for him/her from
user A. If IMS UE-B keeps the previous media key K with user A, then IMS UE-B
can go directly to its media mailbox to retrieve the deferred media. If user B
does not keep the media key K with user A or user B never contact user A
before, user B should use those security parameters to request KMS to fetch
the media key K first, and then retrieve the deferred media from the mailbox.
The message diagram in Figure 18 shows the procedure where IMS UE-B fetches
the media key from KMS when it does not have the previous media key.
Figure 18: Message flow when IMS UE-B is online
> 1b. User B bootstraps with KMS to establish a shared key Kb. If GBA is not
> support, user B can use other authentication method to get shared key Kb
  1. User B sends a request including its identity ID-B to its mailbox server.
  2. User B's mailbox server response to user B with the messing including following security parameters: ID-A, ID-B, Ea(ID-A,ID-B).
  3. User B send a request message to KMS including ID-A, ID-B, Ea(ID-A,ID-B), Eb(ID-A,ID-B).
  4. KMS using Ka, Kb to decrypt the Ea(ID-A,ID-B) and Eb(ID-A,ID-B) and compare the decrypted ID-A, ID-B with plain ID-A , ID-B to make sure they are same. Then KMS retrieve the media key K already generated in step 5 in the previous procedure.
  5. KMS encrypts the K using Kb to get the Eb(K), and then sends the Eb(K) to user B in the response message.
After the procedure user B also gets the media key K, then user B can retrieve
the deferred media from mailbox server.
#### 7.4.3.4 Transcoders
For the network functions operating on plaintext media, e.g. transcoders, the
KMS could deliver the master key K to the network functions after successful
authorization. So this solution could support this use case. The detail is
FFS.
#### 7.4.3.5 Group and conference calls
Figure 19 shows the procedure for the conference calling. For the sake of
simplicity the random number used in each message to prevent replay attack is
omitted in the message diagram.
Figure 19: Message flow for group and conference calls
1a. IMS UE-A bootstraps with KMS to establish a shared key Ka.
1b. IMS UE-B bootstraps with KMS to establish a shared key Kb.
1c. IMS UE-C bootstraps with KMS to establish a shared key Kc.
Note: Ka/Kb/Kc may be established through GBA mechanism where KMS is a NAF, or
other methods.
  1. IMS UE-A sends an INVITE message which includes the following parameters: plain identity of user A ID-A, plain identity of user B ID-B and Ea (ID-A, ID-B) (encrypted ID-A, ID-B with key Ka).
  2. IMS Network forwards the invite message to IMS UE-B.
  3. IMS UE-B sends a request message, which includes the following parameters: plain ID-A，plain ID-B and Ea (ID-A, ID-B) and Eb(ID-A,ID-B) to the KMS to request the media key.
  4. The KMS use plain ID-A, plain ID-B to get Ka, Kb, and use Ka, Kb to get decrypted ID-A, ID-B from Ea (ID-A, ID-B) and Eb(ID-A,ID-B), and compare the decrypted ID-A, ID-B with plain ID-A , ID-B to make sure they are same. KMS then generates the key K1 for media protection between UE-A and Conference Bridge and the key K2 for media protection between IMS UE-B and Conference Bridge.
  5. KMS use Ka to encrypt the K1 to get Ea(K1) and use Kb to encrypt the K2 to get Eb(K2), then send Ea(K1) and Eb(K2) to IMS UE-B in reponse message.
  6. IMS UE-B get K2 by decrypting Eb(K2) using Kb, then send Ea(K1) to IMS netwok in response message.
  7. IMS network forward the Ea (K1) to IMS UE-A in response message.
  8. IMS UE-A sends an INVITE message which includes the following parameters: plain identiy of user A ID-A, plain identity of user C ID-C and Ea(ID-A,ID-C). (Encrypted ID-A, ID-C with key Ka).
> Notes: Step 9 can be implemented concurrently with step 2.
Editor's Note: In the case that step 9 and step 2 happen concurrently, it
needs to be described how the KMC can handle this situation.
  1. IMS Network forwards the INVITE message to IMS UE-C.
  2. IMS UE-C sends a request message, which includes the following parameters: plain ID-A，plain ID-C and Ea (ID-A, ID-C) and Ec(ID-A,ID-C) to the KMS to request the media key.
  3. The KMS use plain ID-A, plain ID-C to get Ka, Kc and use Ka, Kc to get decrypted ID-A, ID-C from Ea (ID-A, ID-C) and Ec(ID-A,ID-C), and compare the decrypted ID-A, ID-C with plain ID-A , ID-C to make sure that they are same. KMS then generates the key K1 for media protection between UE-A and Conference Bridge and the key K3 for media protection between UE-C and Conference Bridge.
> K1 generated in this step is same as the one generated in step 5.
>
> NOTE: The KMS needs to maintain state in order to keep keys per user pair.
  1. KMS use Ka to encrypte the K1 to get Ea(K1) and use Kc to encrypt the K3 to get Ec(K3), then send Ea(K1) and Ec(K3) to UE-C in response message.
  2. IMS UE-C get K3 by decrypting the Ec(K3) using Kc, and then send Ea(K1) to IMS network in response message.
  3. IMS network forward the Ea(K1) to IMS UE-A.
After the above-mentioned steps, the IMS UE-A, IMS UE-B and IMS UE-C get the
media key K1, K2 and K3 with KMS respectively.
The following diagram shows that the Conference Bridge communicates with KMS
in a secure way to obtain K1, K2 and K3 from the KMS. The conference bridge
then has the shared secrets it needs to communicate securely with IMS UE-A,
IMS UE-B and IMS UE-C respectively.
Editor's Note: It needs to be clarified how the Conference Bridge can
communicate securely with the KMS, e.g. using NDS/IP.
Figure 20: Key distribution for conference calling
#### 7.4.3.6 End-to-middle
Figure 21 shows a typical end-to-middle scenario where a call takes place
between an IMS end user and a PSTN end user. This solution does not apply to
the case where the protection is required between the end user and the access
edge. For the sake of simplicity the random number used in each message to
prevent replay attack is omitted in the message diagram.
Figure 21: Message flow for end-to-middle scenario
> 1a. User A bootstraps with KMS to establish a shared key Ka. If GBA is not
> support, User A can use other authentication method to get shared key Ka
>
> 1sg. Secure Gateway(SGW) establish a secure connection with KMS by IPsec,
> TLS or any other authentication method by which KMS and SGW can have a
> shared secret Ksg.
>
> 1sm. SGW establish a secure connection with PSTN media gateway (MGW) by
> Ipsec, TLS or any other authentication method to get shared key Ksm
  1. User A sends an INVITE message which includes the following parameters: plain identity of user A ID-A, plain identity of user B ID-B and Ea (ID-A, ID-B) (encrypted ID-A, ID-B with key Ka) to SGW
  2. Once receive the INVITE message from user A, SGW sends a request message, which includes the following parameters: plain ID-A, plain ID-B, Ea (ID-A, ID-B) and Esg(ID-A,ID-B) to the KMS to request media key K.
  3. KMS use Ka, Ksg to get decrypted ID-A, ID-B from Ea (ID-A, ID-B) and Esg(ID-A,ID-B), and compare the decrypted ID-A, ID-B with plain ID-A , ID-B to make sure they are same. Then KMS generate the media key K.
  4. KMS encrypts the K using Ka, Ksg to get the Ea(K), Esg(K) respectively, and then sends the Ea(K), Esg(K) to SGW in the response message.
  5. SGW get media key K by decrypting the Esg(K). Then SGW send media key K to PSTN MGW using the security link between SGW and PSTN MGW protected by Ksm.
  6. SGW send media Ea(K) to user A.
NOTE: Step 6 and step 7 can be executed concurrently.
After the above-mentioned procedure, the IMS endpoint user has a security
association with PSTN MGW.
## 7.5 DTLS-SRTP
### 7.5.1 Brief Description of DTLS-SRTP
**DTLS-SRTP, described currently in two IETF Internet-Drafts ([11] and [12]),
uses the handshake protocol of DTLS (RFC 4347, [10]) to establish keying
material, algorithms, and parameters for SRTP. The handshake is performed in
the media path, using UDP between those transport addresses (transport address
= IP address + port) that are also used by the RTP media streams to be
secured. DTLS-SRTP is specified for point-to-point sessions with two
participants.**
**DTLS ([10]) requires that peers can be mutually authenticated, preferably by
presenting certificates signed by a certificate authority (CA) that is trusted
by both peers. (Other peer authentication methods like relying on a pre-shared
key are also specified.) The goal of DTLS-SRTP is however to allow secure
communication between parties that do not know each other before and that do
not share a common trusted CA. To achieve this, DTLS-SRTP uses peer
authentication methods where each peer is authenticated via a certificate that
is not signed by a CA, but only by the peer itself. The identity of the peers
cannot be asserted by such certificates, but is asserted via the SIP
signalling used to establish the media session, e.g. by the usage of the
P-asserted-identity header field or by SIP identity and SIP connected identity
(RFC 4474 and RFC 4916, [13] and [14]).**
**To ensure that an attacker in the media path cannot perform a man-in-the-
middle attack on the certificates, certificate fingerprints are transmitted in
the SIP messages (inside the SDP bodies) that allow verifying the validity of
a certificate received over the media path. The integrity of the fingerprint
must be protected, e.g. by general measures to protect the signalling traffic,
or by the usage of SIP identity and SIP connected identity. (Additional
variants have been proposed in different (personal) Internet Drafts.)**
**The following sections discuss the most important issues for DTLS-SRTP as a
solution candidate for the IMS media plane security.**
### 7.5.2 Usage of the media path
According to requirement 29, a solution must not rely on the media path being
available before session establishment, because it is assumed that session
border controllers may be present that block the media path until the session
has been established. This view is also affirmed by a comment to the (IETF)
requirement 33.
While DTLS-SRTP allows that the called party uses the media path to perform
the DTLS-SRTP handshake immediately after it has received the SDP offer, it is
also possible for the called party to stay passive and let the caller start
the handshake.
Depending on the policies in the network, the media path may be available
after the SDP answer has been transmitted, or -- at the latest \-- after the
200 OK message has been passed. In both cases, the calling party is the
receiver of the message that opens up the media path and can therefore start
the DTLS-SRTP handshake immediately after receiving the message.
According to requirement 30, a media security solution shall assume that only
media traffic can be sent over the media path. In case of DTLS-SRTP, the
handshake packets, which are not media packets, must be transmitted in the
media path. These packets use exactly the same IP addresses and UDP ports as
the subsequent media packets. There seems not much point in blocking such
traffic. **Moreover, there is reason to assume that deployed SBC-products
feature a considerable degree of flexibility and are not limited in a way that
they cannot be configured to let the handshake traffic pass.**
Concerning requirement 36: Obviously, a slight delay arises because the
handshake cannot be done before the media path is available. However, the
problem of clipping is rather caused by the policy enforced by the SBCs (block
the path until session establishment) than by the fact that the DTLS-SRTP
handshake is done in the media path.
### 7.5.3 Lawful interception
**Requirements 1-3 require the support of LI. Three approaches to perform LI
for DTLS-SRTP are outlined in the following sections. None of them is as easy
and straightforward as it would be e.g. for SDES. Of the three approaches
below, only "Key disclosure" seems to be feasible.**
**Note that on the other hand, it is currently not fully clear, to what degree
an operator will be obliged to provide cleartext communication content, if the
operator does not contribute to the encryption and does not know the keys (as
it is the case for DTLS-SRTP).**
#### 7.5.3.1 Lawful MitM attack
**At its current state, LI for DTLS-SRTP would require a man-in-the-middle
"attack" (it would be a "lawful attack") in both the media and the**
**67ignalling path to allow interception. This "attack"** could not be
detected by the end user by applying the means available through the DTLS-SRTP
mechanism, e.g. by comparing the **certificate fingerprint from the**
**67ignalling messages with the certificate used during the DTLS handshake.
(End users could however agree on additional means allowing them to find out
that there is a man-in-the-middle, e.g. transmitting the certificate
fingerprints again by spoken voice and comparing them with the ones received
during the DTLS-SRTP handshake. It is assumed that it would not be feasible
for the operator to prevent such methods.)**
**This method obviously requires considerable effort for LI, and it is
doubtful whether it is feasible.**
#### 7.5.3.2 Protocol-based hidden key recovery
The principles of such an approach are described in [15]. The idea is to use
protocol fields that carry a random or an unspecified value to transport
secret information (like e.g. a session key) to a party (the Law Enforcement
Agency) that eavesdrops the communication and is informed about this kind of
secret information disclosure. A prerequisite is, that the protocol
implementation (on the user equipment) must include this „disclosure
function", i.e. it must be compromised (from the point of view of its
unknowing user).
An example would be the following: A client TLS implementation that performs
RSA key exchange uses the 28 Byte nonce in the client hello to transport a
value that can be used by the eavesdropping LEA to compute the pre-master
secret (and by this the session keys).
One problem with this approach is, that suitable protocol fields are not
always available -- e.g. in TLS, the available fields are too short.
Workarounds for this are available, but they require that secret information
is disclosed during several consecutive sessions. The LEA must not miss one of
these, and can only decrypt the sessions that are established after all
necessary information has been disclosed (i.e. it cannot decrypt the first few
sessions).
There are more problems, e.g. it seems hard to ensure that users do not use
other, non-compromised protocol implementations. When protocols change (e.g.
improved, new versions), the method may have to be adapted or may even become
unfeasible.
Because of these weaknesses, protocol-based hidden key recovery is not
considered to be a sound basis for LI.
#### 7.5.3.3 Key disclosure
The Internet-Draft draft-wing-sipping-srtp-key-04 (formerly entitled "SRTP Key
Disclosure") ([16]) proposes that after the key exchange, user agents send
SRTP keys to trusted nodes in the network. This is proposed in order to
support scenarios, where the network has to decrypt the media, e.g. for
recording or because of the need for transcoding. While this is expected to be
done with knowledge and agreement of the end users, one could imagine that an
operator mandates such a procedure for all calls and discards all call
attempts that do not comply. (The operator will have to make this part of the
subscription contract, and can justify this by legal obligations.) The
operator will then get all SRTP keys, and can use them in case a call has to
be intercepted.
There are some issues with this approach. One of it is that one or two
additional messages would have to be passed and processed per call. (Whether
one or two messages depends on the method used for key disclosure -- different
options have been described.) Moreover, the solution currently does not cover
roaming scenarios that require that traffic is decrypted in a visited network.
Another issue is the question of how to prevent "cheating", i.e. "disclosing"
a wrong key. Note that this issue also arises for all other key management
procedures: Two users could agree on performing a secret, additional
transformation of the keys as known to a network element that supports LI
before using them for encrypting media. There is however a difference: While
typically, both end users must agree on a "cheating mechanism", with key
disclosure, the intercepted end user can sabotage interception without
cooperation of the other end user in the call.
### 7.5.4 Support of multiparty communication
DTLS-SRTP is specified for point-to-point communications. DTLS-SRTP "inherits"
the key exchange methods of TLS ([7]). In these key exchange methods, both
peers contribute random values to the key material, so a peer cannot dictate
the SRTP master key. Multiple point-to-point sessions (of one peer with
multiple other peers) will use different keys typically, so multiparty
communications are not supported efficiently.
The Internet-Draft draft-wing-avt-dtls-srtp-key-transport-02 ([17]) defines an
extension to DTLS-SRTP that allows a peer to dictate the SRTP master key.
E.g., a conference bridge could dictate a single master key to all listeners
for the traffic it sends, and it could dictate a new master key to the
listeners each time a participant joins or leaves the conference.
# 8 Analysis of solutions
#
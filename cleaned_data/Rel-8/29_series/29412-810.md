# Foreword
This Technical Specification (TS) was been produced by ETSI Technical
Committee Telecommunications and Internet converged Services and Protocols for
Advanced Networking (TISPAN) and originally published as ETSI ES 283 012 [17].
It was transferred to the 3rd Generation Partnership Project (3GPP) in in
February 2008.
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document defines the control procedures for trunk gateways when
PSTN/ISDN emulation and PSTN/ISDN simulation services in an NGN Network
require interworking with ETSI PSTN/ISDN services in a ISUP network.
Interworking with BICC networks is not included in the scope of TISPAN R2.
Existing profiles will be evaluated, in order to determine if they can be re-
used, with possible modifications, or if a completely new profile is to be
defined.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or nonâ€‘specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
Referenced documents which are not found to be publicly available in the
expected location might be found at
[http://docbox.etsi.org/Reference]{.underline}.
[1] ETSI TS 129 163: \"Digital cellular telecommunications system (Phase 2+);
Universal Mobile Telecommunications System (UMTS); Interworking between the IP
Multimedia (IM) Core Network (CN) subsystem and Circuit Switched (CS) networks
(3GPP TS 29.163 version 6.6.0 Release 6)\".
[2] ETSI TS 129 332: \"Universal Mobile Telecommunications System (UMTS);
Media Gateway Control Function (MGCF) - IM Media Gateway (IM-MGW) Mn
interface; Stage 3\ (3GPP TS 29.332 version 6.2.0 Release 6)\".
[3] ITU-T Recommendation H.248.1 (2005): \"Gateway control protocol: Version
3\".
[4] IETF RFC 3261: \"SIP: Session Initiation Protocol\".
[5] IETF RFC 2833: \"RTP Payload for DTMF Digits, Telephony Tones and
Telephony Signals\".
[6] ITU-T Recommendation G.168: \"Digital network echo cancellers\".
[7] ITU-T Recommendation I.231.1: \"Circuit-mode 64 kbit/s unrestricted, 8 kHz
structured bearer service\".
[8] IETF RFC 4040: \"RTP Payload Format for a 64 kbit/s Transparent Call\".
[9] ITU-T Recommendation G.703: \"Physical/electrical characteristics of
hierarchical digital interfaces\".
[10] ITU-T Recommendation G.704: \"Synchronous frame structures used at 1544,
6312, 2048, 8448 and 44 736 kbit/s hierarchical levels\".
[11] ITU-T Recommendation G.707: \"Network node interface for the synchronous
digital hierarchy (SDH)\".
[12] ITU-T Recommendation G.957: \"Optical interfaces for equipments and
systems relating to the synchronous digital hierarchy\".
[13] ITU-T Recommendation Q.115.0: \"Protocols for the control of signal
processing network elements and functions\".
[14] ITU-T Recommendation Q.115.1: \"Logic for the control of echo control
devices and functions\".
[15] ITU-T Recommendation G.711: \"Pulse code modulation (PCM) of voice
frequencies\".
[16] ITU-T Recommendation G.726: \"40, 32, 24, 16 kbit/s Adaptive Differential
Pulse Code Modulation (ADPCM)\".
[17] ETSI ES 283 012 V1.1.1 \"Telecommunications and Internet converged
Services and Protocols for Advanced Networking (TISPAN); Interworking;
Trunking Gateway Control Procedures for interworking between NGN and external
CS networks\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definitions
apply:
**Media Gateway:** See ITU-T Recommendation H.248.1 [3], clause 3.3.
**Media Gateway Controller:** See ITU-T Recommendation H.248.1 [3], clause
3.4.
**Trunking Media Gateway:** H.248 Media Gateway that interworks with the PSTN
network on basis of network node interfaces (NNI)
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
3GPP 3rd Generation Partnership Project
CLASS Custom Local Area Signalling Services
CS Circuit-Switched
CN Core Network
DTMF Dual Tone Multi Frequency
ECD Echo Control Device/function
IETF Internet Engineering Task Force
IM IP Multimedia
IMS IP Multimedia Subsystem
IP Internet Protocol
ISDN Integrated Services Digital Network
MGC Media Gateway Controller
MGCF Media Gateway Control Function
OAM Operation, Administration and Maintenance
OoS Out-of-Service (see H.248.1)
PES PSTN/ISDN Emulation Subsystem
PSTN Public Switched Telecommunication Network
RFC Request For Comments (IETF)
RTP Real-time Transport Protocol
SIP Session Initiation Protocol
SS Silence Suppression
TDM Time Division Multiplexing
TGW Trunking GateWay
TISPAN Telecommunications and Internet converged Services and Protocols for
Advanced Networking
TMGW Trunking Media GateWay
TS Technical Specification (3GPP, ETSI)
UP User Plane
VAD Voice Activity Detection
VBD VoiceBand Data
# 4 Applicability
## 4.1 Architecture
Figure 1 illustrates the architecture assumed in the present document. It is
assumed that call control signalling on the PSTN/ISDN side is ISUP, while the
call/session control signalling on the IP side is SIP. The SIP is defined by
RFC 3261 [4].
Figure 1: Reference Architecture
The reference architecture applies to both PSTN/ISDN Simulation (IMS
Architecture) and Emulation Subsystem (TISPAN PES).
## 4.2 Functional Requirements
1) Trunking Media Gateways shall support the establishment and release of
IMS/NGN (ephemeral) Terminations. H.248 IMS/NGN Terminations are based on IP.
The IP version used by H248 IMS/NGN Terminations in TISPAN IMS domains is
either IPv4 or IPv6.The default IP version is IPv4 for H.248 RTP Terminations
for ETSI PES. IPv4 is still in use for H.248 IMS/NGN Terminations for VoIP
NGNs, particularly in non-3GPP environments.
NOTE: The default IP version is IPv6 for H.248 IMS/NGN Terminations in 3GPP
IMS domain.
2) Trunking Media Gateways shall support the establishment and release of TDM
(physical) Terminations.
3) Trunking Media Gateways shall support the interworking of the associated
User Plane (UP) protocol stacks for the networks to which the TMGW is inter-
connecting. These details and further physical characteristics are described
in clause 4.3.
4) Trunking Media Gateways shall provide support for G.711 A-law codecs and
may support other codecs.
5) Trunking Media Gateways supporting other codecs than G.711 shall support
autonomous transition to\ G.711-based VBD mode upon detection of voiceband
data traffic (like fax/modem, data/modem, text/modem) according to V.152. This
shall be upon a per-call-basis request from the MGC. Additionally, Trunking
Media Gateways shall be fully compliant with ITU-T Recommendation G.168 [6] on
detecting VBD.
6) Trunking Media Gateways supporting other codecs than G.711 shall also
support the procedures defined in RFC 2833 [5] to detect, generate and forward
DTMF digits. DTMF shall be identified by name, as opposed to their waveform
properties.
7) Trunking Media Gateways may support the generation of fixed announcements
and tones. See also clauses 4.5.2.4 and 4.5.2.5.
8) All properties of tones requested by the MGC shall be provisioned in the
Media Gateway. The MGC is not required to send the physical characteristics of
tones to Media Gateways.
9) Trunking Media Gateways shall support ISDN Bearer Service ITU-T
Recommendation I.231.1 [7] for\ TDM-to-TDM bearer connections.
10) Trunking Media Gateways shall support ISDN Bearer Service ITU-T
Recommendation I.231.1 [7] for\ TDM-to-RTP bearer interworking. This ISDN
bearer service on TDM side shall be mapped onto RTP Clearmode according RFC
4040 [8] on IP side.
11) Trunking Media Gateways shall support testing of circuit-oriented bearer
connections at circuit-switched network interfaces of the TMG. The bearer test
may be either:
a) performed via the corresponding H.248 TDM Termination by H.248 test
procedures, or
b) may be OAM driven without H.248 involvement.
The reason behind test procedures (A) are tests which are associated to call
control activities (e.g. SS7 Continuity Checks); whereas (B) are call
independent test activities initiated be Element/Network Management systems.
12) Trunking Media Gateways shall support Echo Control Device/Function (ECD).
An ECD shall be associated with H.248 TDM Termination on a call by call basis,
if the G.168 cancelled end is located on PSTN/ISDN side.
13) Trunking Gateways shall support codec negotiation.
14) The Trunking Gateway shall support the indication of packetization time
for appropriate codec types.
15) The Trunking Gateway shall support emergency call identification via
context property toward the TMG.
## 4.3 User Plane Interworking and Physical Interface Requirements
1) The Trunking Media Gateway shall support the interworking of User Plane
protocol stacks as defined in TS 129 163 [1], clause 8 with the exception of
the Bearer Independent CS User Plane protocol stack.
2) Trunking Media Gateways shall support physical interfaces that conform to
at least one of the following\ ITU-T Recommendations G.703 [9], G.704 [10],
G.707 [11] and G.957 [12].
3) Trunking Gateways shall support IPv4 and may support IPv6.
4) Echo control activation/deactivation shall be supported.
Physical terminations are required to support echo cancellation. Echo
cancellation is automatically activated on physical terminations by the TMGW
and may be deactivated using the TDM Circuit package (see note 1).
NOTE 1: H.248 TDM Circuit Package Version 1 (see ITU-T Recommendation H.248.1
[3], clause E.13) is providing the basic control capabilities for ECDs in
H.248 MGs. The SPNE Control Package (see ITU-T Recommendation Q.115.0 [13],
clause 7.2) is extending the tdmc Version 1 Package by further ECD control
possibilities. The SPNE Control Package is not required and is beyond the
scope of Version 1 of this Profile.
Deactivation by the MGC occurs on TDM terminations in case of Unrestricted 64
kbit/s. Echo cancellation may also be deactivated by the TMGW when entering
the VBD mode.
An **Echo Control Device** /Function (ECD; see ITU-T Recommendation Q.115.1
[14], clause 3.1) is therefore always associated with a physical H.248
Termination (see notes 2 and 3).
NOTE 2: A VoIP Media Gateway defined by this H.248 Profile is a so-called
\"type 1 exchange/node\" from ECD point of view (see ITU-T Recommendation
Q.115.1 [14], clause A.2.4.3.1).
NOTE 3: The configuration of the HECD (or ECD) in a Media Gateway is the
\"reverse associated\" mode (see\ ITU-T Recommendation Q.115.1 [14], clause
A.1.1, note 1 and figures A.2a, A.2b, A.3).
An ECD is responsible for a single echo path, therefore also known as half-way
ECD (**HECD**) (see notes 4 and 5). The G.168 Digital Network ECD is required
for the echo generated at \"legacy terminal\" side of the MGW. This is the
echo path on which the HECD is intended to operate, called as G.168
**Cancelled End** (or formerly as Near End). The required ECD **tail length
capacity** is given by the echo path at the cancelled end.
NOTE 4: A local call, resulting in a single H.248 Context with two physical
H.248 Terminations (Phy-to-Phy bearer interworking) may result in the
allocation of two HECDs, one per direction. Such two complementary HECDs
representing a full-way ECD (called full ECD (FECD), see ITU-T Recommendation
Q.115.1 [14], clause 3.7). A FECD configuration for Phy-to-Phy H.248 Context
types is not required and supported in this Profile version. It is rather
anticipated from TMGW side, that the MGC is disabling the ECD resources for
such a Context type, due to the small end-to-end propagation delay here.
NOTE 5: More detailed ECD notation: In case of an outgoing call the ECD in the
originating Media Gateway, responsible for the hybrid echo generated by the
calling party, is playing the role of the outgoing ECD (OECD, see ITU-T
Recommendation Q.115.1 [14], clause 3.12). In case of an incoming call the ECD
in the terminating Media Gateway, responsible for the hybrid echo generated by
the called party, is playing the role of the incoming ECD (IECD, see ITU-T
Recommendation Q.115.1 [14], clause 3.11).
5) Voice codec types should support silence suppression (SS) mode, which
includes voice activity detection (VAD), the generation/insertion of comfort
noise (CN) and/or silence insertion descriptor. Silence suppression mode is
only required for packet-switched bearers (H.248 IMS or RTP Termination), but
not for\ circuit-switched network (H.248 TDM Termination).\ Silence
suppression mode is direction-independent and shall be supported call/bearer
individually. Silence suppression mode must be explicitly enabled and
disabled. Default shall be a disabled SS mode.
6) DTMF tone relay according to RFC 2833 [5] shall be supported. This does not
exclude the usage of G.711 to carry DTMF tones.
7) Media Gateways shall discard packets with RTP payload types (PT) that do
not match the Local Descriptor contents.
NOTE 6: Besides an incorrect RTP PT field might be also other reasons for
discarding packets (invalid SSRC field, invalid CRC, etc.).
NOTE 7: The MG has the option to collate statistics on discarded packets.
8) When sending packets from a termination, Media Gateways shall use the
address and port in the Local Descriptor as a source address and port and the
address and port in the Remote Descriptor as a destination address and port.
## 4.4 Control Plane Signalling Flows
### 4.4.1 ISUP-ISUP call
#### 4.4.1.1 Introduction
The deployment of VoIP NGNs like 3GPP IMS, or particularly ETSI PES does not
happen \"in a greenfield\". Efficient interworking with the existing PSTN/ISDN
is therefore very crucial to success. Interworking does not only focus on
\"breakout from VoIP domains to the PSTN/ISDN\", it must consider also
existing switching scenarios in PSTN/ISDNs.
Switching on TDM-to-TDM basis may occur on different network levels in
PSTN/ISDN. The present document is solely scoping the requirement on transit
exchange level (also known as CLASS 4). This is a type of NNI-to-NNI
interworking, which relates to an ISUP-to-ISUP call (in case of ISUP/SS7 as
used call control protocol).
The ISUP-to-ISUP use case is for instance required due to dedicated network
topologies, call routing/numbering planes, realization restrictions of
dedicated supplementary services (like local number portability in certain
markets), or when simply missing crosscuts prohibiting switching on a lower
network level.
The H.248 TGW must be able to takeover the role of a legacy transit exchange
for such kind of scenarios.
#### 4.4.1.2 Call Control Procedures
Dedicated control plane signalling flows are not given by the present
document, because there is nothing new (i.e. it is not intended to define new
PSTN/ISDN services) or specific with regards to the call control flows.
#### 4.4.1.3 Gateway Control Procedures
TDM-to-TDM interworking on transit exchange level is basically a switching
function without the general need of any signal processing network functions
(definition see ITU-T Recommendation Q.115.0 [13], clause 3.2).
The default TGW control procedure for 2-Party (2PTY) calls is therefore the
creation of a single H.248 Context for TDM-to-TDM interworking, which
corresponds to \"TDM bearer switching\" (as in legacy TDM switching systems).
NOTE: The TMG may realize the \"TDM bearer switching function\" either by
using MG-internally continuous circuit-switched transmission and switching
resources (\"native TDM switching\"), or a circuit emulation approach via
packet-switching technologies (\"emulated TDM switching\").
### 4.4.2 IMS-ISUP call
No additional call flows are foreseen over and above what is described for
this interworking in TS 129 163 [1] for\ IMS-ISUP calls.
## 4.5 TGW Control Procedures
The identified stage 2 procedures for controlling the Trunking Media Gateway
are described here. The procedures will either be identified in the
requirements section or the control plane signalling flows.
This clause describes of logical signalling procedures (i.e. message
identifiers are not part of the protocol) between the MGCF and TMGW. The
procedures within this clause are intended to be implemented using the
standard H.248 procedure as defined in ITU-T Recommendation H.248.1 [3] with
appropriate parameter combinations.
### 4.5.1 Procedures related to terminations towards the IM CN Subsystem
A mapping of the procedures defined here to H.248 procedures and parameters is
provided in TS 129 332 [2].
#### 4.5.1.1 Reserve IMS connection point
This procedure is used to reserve local connection addresses and local
resources. This is the same procedure as the one defined in the clause
\"Reserve IMS connection point\" in TS 129 163 [1].
#### 4.5.1.2 Configure IMS resources
This procedure is used to select multimedia-processing resources for an
IMS/NGN Termination interface connection. This is the same procedure as the
one defined in the clause \"Configure IMS resources\" in TS 129 163 [1].
#### 4.5.1.3 Reserve IMS Connection point and configure remote resources
This procedure is used to reserve multimedia-processing resources for an
IMS/NGN Termination interface connection. This is the same procedure as the
one defined in the clause \"Reserve IMS Connection point and configure remote
resources\" in TS 129 163 [1].
#### 4.5.1.4 Release IMS/NGN Termination
This procedure is used by the MGCF to release a termination towards the IMS
and free all related resources. This is the same procedure as the one defined
in the clause \"Release IMS termination\" in TS 129 163 [1].
##### 4.5.1.4.1 Statistics
Statistics may be requested during the release procedure in conjunction with
the H.248 Subtract command.
The information collected could for instance be used to correlate bearer
statistics to a call which could be used to determine how a call should be
charged. Only statistics, defined by H.248 Packages and applicable for the
H.248 Termination type (here \"IMS\"), may be used.
The MGCF may request statistics related to the RTP packet transmission process
of the IMS bearer connection.
#### 4.5.1.5 Termination Out-of-Service
This procedure is used by the TMGW to indicate towards the MGCF that one or
several physical Termination(s) will go out of service. This is the same
procedure as the one defined in the clause \"Termination Out-of-Service\"
(OoS) in TS 129 163 [1].
### 4.5.2 Procedures related to a termination towards an ISUP network
A mapping of the procedures defined here to H.248 procedures and parameters is
provided in TS 129 332 [2].
#### 4.5.2.1 Reserve TDM circuit
This procedure is used by the MGCF to reserve a TDM circuit in the TMGW
towards the preceding/succeeding CS network element. This is the same
procedure as the one defined in the clause \"Reserve TDM circuit\" in TS 129
163 [1].
#### 4.5.2.2 Change TDM through-connection
This procedure is used by the MGCF to modify the through-connection (forward,
backward, both-way, inactive) of a TDM Termination at the TMGW towards the
PSTN.
This is the same procedure as the one defined in the clause \"Change TDM
through-connection\" in TS 129 163 [1].
#### 4.5.2.3 Activate TDM voice-processing function
This procedure is used by the MGCF to activate or de-activate a voice
processing function of a TDM Termination at the TMGW towards the PSTN. This
voice processing function may include a cancellation for electrical echoes (as
opposed to acoustical echoes).
This is the same procedure as the one defined in the clause \"Activate TDM
voice-processing function\" in TS 129 163 [1].
#### 4.5.2.4 Send TDM tone
This procedure is used by the MGCF to order the TMGW to generate a ringing
tone at a TDM Termination towards the PSTN.
This is the same procedure as the one defined in the clause \"Send TDM tone\"
in TS 129 163 [1].
#### 4.5.2.5 Stop TDM tone
This procedure is used by the MGCF to order the TMGW to stop generating a
ringing tone at a TDM termination towards the PSTN.
This is the same procedure as the one defined in the clause \"Stop TDM tone\"
in TS 129 163 [1].
#### 4.5.2.6 Play TDM announcement
This procedure is used by the MGCF to order the TMGW to generate an
announcement at a TDM Termination towards the PSTN. The MGCF may request a
notification that the announcement is completed. This is the same procedure as
the one defined in the clause \"Play TDM announcement\" in TS 129 163 [1].
This procedure is optional.
#### 4.5.2.7 TDM announcement completed
This procedure is used by the TMGW to notify the MGCF that an announcement at
a TDM Termination towards the PSTN is completed. This is the same procedure as
the one defined in the clause \"TDM announcement completed\" in TS 129 163
[1]. This procedure is optional.
#### 4.5.2.8 Stop TDM announcement
This procedure is used by the MGCF to order the TMGW to stop generating an
announcement at a TDM Termination towards the PSTN. This is the same procedure
as the one defined in the clause \"Stop TDM announcement\" in TS 129 163 [1].
This procedure is optional.
#### 4.5.2.9 Continuity check
This procedure is used by the MGCF to order the TMGW to generate a continuity
check tone at a TDM Termination towards the PSTN and to inform the MGCF about
the result of the continuity check as soon as the continuity check tone is
received or a time-out occurs. This is the same procedure as the one defined
in the clause \"**Continuity check** \" in TS 129 163 [1]. This procedure is
optional.
#### 4.5.2.10 Continuity check verify
This procedure is used by the TMGW to indicate towards the MGCF that the
continuity check at a TDM Termination towards the PSTN has been completed and
to return the result of the check: success or failure. This is the same
procedure as the one defined in the clause \"Continuity check verify\" in TS
129 163 [1]. This procedure is optional.
#### 4.5.2.11 Continuity check response
This procedure is used by the MGCF to order the TMGW to loop back an incoming
continuity check tone at a TDM termination towards the PSTN. This is the same
procedure as the one defined in the clause \"Continuity check response\" in TS
129 163 [1]. This procedure is optional.
#### 4.5.2.12 Release TDM Termination
This procedure is used by the MGCF to release a TDM Termination at the TMGW
towards the PSTN and free all related resources. This is the same procedure as
the one defined in the clause \"Release TDM Termination\" in TS 129 163 [1].
#### 4.5.2.13 Termination Out-of-Service
This procedure is used by the TMGW to indicate towards the MGCF that one or
several physical Termination(s) will go out of service. This is the same
procedure as the one defined in the clause \"Termination Out-of-Service\" in
TS 129 163 [1].
### 4.5.3 Non-call related procedures
#### 4.5.3.1 Procedures Inherited from 3GPP
+----------------------------+----------------------------------------+ | Procedure defined in | Remarks | | | | | TS 129 332 [2] | | +----------------------------+----------------------------------------+ | IM-MGW Out of service | | +----------------------------+----------------------------------------+ | IM-MGW Communication Up | | +----------------------------+----------------------------------------+ | IM-MGW Restoration | | +----------------------------+----------------------------------------+ | IM-MGW Register | | +----------------------------+----------------------------------------+ | IM-MGW Re-register | | +----------------------------+----------------------------------------+ | MGCF Ordered Re-register | | +----------------------------+----------------------------------------+ | MGCF Restoration | | +----------------------------+----------------------------------------+ | MGCF Out of Service | | +----------------------------+----------------------------------------+ | Termination Out-of-Service | The \"Termination Out-of-Service | | | procedure\" is used as call-related | | | H248 command as well | +----------------------------+----------------------------------------+ | Termination Restoration | | +----------------------------+----------------------------------------+ | Audit Value | | +----------------------------+----------------------------------------+ | Audit Capability | | +----------------------------+----------------------------------------+ | Command Rejected | The \"Command Rejected\" procedure may | | | be used in response both to | | | call-related and non-call-related | | | H.248 Commands. | +----------------------------+----------------------------------------+ | IM-MGW Capability Change | | +----------------------------+----------------------------------------+
#### 4.5.3.2 Procedures Changed from 3GPP
+----------------------------------+----------------------------------+ | Procedure defined in | Remarks | | | | | TS 129 332 [2] | | +----------------------------------+----------------------------------+ | IM-MGW Resource Congestion | TISPAN permit use of H248.11 in | | Handling - Activate | addition to H.248.10. | +----------------------------------+----------------------------------+ | IM-MGW Resource Congestion | TISPAN permit use of H248.11 in | | Handling - Indication | addition to H.248.10. | +----------------------------------+----------------------------------+
#### 4.5.3.3 Monitoring the H.248 Control Association
See ITU-T Recommendation H.248.1 [3], clause 11.6.
#### 4.5.3.4 TMGW Congestion Control
The MGW shall support a mechanism whereby it monitors its own load and is able
to provide a notification to the MGCF in order to reduce offered load during
periods of MGW overload.
#### 4.5.3.5 MGCF Redundancy
The non-call related procedure, MGCF Redundancy, is a requirement for NGN
Release 2.
There shall be full redundancy of the MGCF so that an outage of an MGCF shall
not interrupt the TMGWs from being utilized for providing service.
Network availability is related to the H.248 concept of primary and secondary
systems with the correspondent H.248 ServiceChange procedures. Dedicated
support of these H.248 mechanisms may additionally also positively influence
service availability performance.
The Trunking Gateway (here MGCF and TMGW) shall support at least one
\"secondary MGCF\". There are two basic procedures for changeovers between
primary MGCF and secondary MGCF. Either the MG initiates the changeover
procedure (also known as \"switchover\" or \"failover\"), or the primary MGCF
initiates the changeover procedure (also known as \"handoff\"). ITU-T
Recommendation H.248.1 [3], clause F.3.6 provides more details for the
correspondent failover procedure. ITU-T Recommendation H.248.1 [3], clause
F.3.11 provides more details for the correspondent handoff procedure.
##### 4.5.3.5.1 MGCF Changeover: Handoff Scenario
In case of a \"handoff\" procedure is the changeover between primary and
secondary MGCF triggered by the primary entity. The correspondent
ServiceChange procedure is based on ITU-T Recommendation H.248.1 [3], clause
F.3.11.
Trigger points are for instance:
  * planned outages of a primary MGCF (e.g. due to maintenance actions); or
  * unplanned events like a partially failing primary MGCF, which is still capable in initiating the handoff procedure (see also ITU-T Recommendation H.248.1 [3], clause 11.5).
###### ## Annex A (informative): DTMF Handling
# A.1 DTMF Digit Transfer
The function of \"DTMF Digit transfer\" is related to the handling of
individual DTMF digits by the TMG. This does not cover any kind of DigitMap
based MG functions.
There are basically following modes of operation for DTMF Digit transfer at MG
level:
+----------------------+----------------------+----------------------+ | No. | Mode of Operation: | TMG Interface | +----------------------+----------------------+----------------------+ | 1 | **DTMF Inband (IB)** | H.248 TDM | | | | Termination | | | **= | | | | D | | | | TMF-over-G.711/TDM** | | +----------------------+----------------------+----------------------+ | 2a | **DTMF RTP | H.248 RTP | | | Pass-Through | Termination | | | (PaTh)** | | | | | | | | **= | | | | DTMF-over-VoiceCodec | | | | (see note)/RTP** | | +----------------------+----------------------+----------------------+ | 2b | **DTMF** RTP Packet | H.248 RTP | | | Relay **(PaRe _)_** | Termination | | | | | | | **= | | | | DTMF-over-RFC __ 2833 | | | | [5]/RTP** | | +----------------------+----------------------+----------------------+ | | **Support of RTP | Yes | | | Packet Relay | | | | submode:** | No | | | | | | | **(i) \"Named | | | | Telephone Events\" | | | | (_see_ RFC 2833 | | | | [5])** | | | | | | | | **(II) \"Telephony | | | | Tones\" (see | | | | RFC _2_ 833 [5], | | | | clause 4)** | | +----------------------+----------------------+----------------------+ | 3 | **DTMF Out-of-Band | H.248 Control | | | (OoB)** | Interface | | | | | | | **= DTMF-over-H.248 | | | | Package** | | +----------------------+----------------------+----------------------+ | NOTE: E.g. ITU-T | | | | Recommendations | | | | G.711 [15] and | | | | G.726 [16]. | | | +----------------------+----------------------+----------------------+
There are different DTMF interworking scenarios, dependent on the type of MG
interfaces involved in the digit forwarding process.
## A.1.1 DTMF Interworking \"TDM Inband\" to \"RTP Pass-Through\"
When a G.711 codec is used, Media Gateways shall be able to generate, detect
and forward DTMF tones inband.
## A.1.2 DTMF Interworking \"TDM Inband\" to \"RTP Packet Relay\"
When other codec types as G.711 are used, the MGC should request the use of
the procedures defined in RFC 2833 [5] to send and receive DTMF tones.
\- If the Local Descriptor sent by the MGC includes the support for RFC 2833
[5], Media Gateways shall be prepared to receive DTMF tones in the form of
named events (see RFC 2833 [5], clause 3.10) and relay the appropriate audio
signal to the physical terminations (here: H.248 TDM Termination).
\- If the Remote Descriptor indicates that RFC 2833 [5] is supported, Media
Gateways shall be prepared to relay in the form of named events, any DTMF tone
received from the physical terminations (here: H.248 TDM Termination).
A Dynamic Payload type shall be used to indicate support of IETF RFC 2833 [5]
for DTMF packet relay.
EXAMPLE: When requesting such a dynamic payload, the MGC has two options:
i) MGC selects and passes a dynamic payload number to the MG, e.g.
> v= 0
>
> c= IN \ \
>
> m= audio \ RTP/AVP 18 110
>
> a= ptime: 10
>
> a= rtpmap: 110 telephone-event/8000
>
> a= fmtp: 110 0-15
ii) request the MG to choose the dynamic payload via the \'\$\' notation, e.g.
> v= 0
>
> c= IN IP4 \$
>
> m= audio \$ RTP/AVP 18 \$
>
> a= rtpmap: \$ telephone-event/8000
>
> a= ptime: 10
For TDM terminations the procedures are described in clause 16 of TS 129 332
[2].
## A.1.3 DTMF Interworking at H.248 Interface
DTMF Digit relay via H.248 interface is not required for ETSI TISPAN NGN
Release 1.
NOTE: This function may be required in future Profile versions, e.g. in case
of interworking with\ BICC-controlled NGNs (e.g. 3GPP CS CN Release 4 and
higher).
###### ## Annex B (informative): TDM Hairpinning
The term \"TDM hairpinning\" is often synonymously used for the designation of
the TDM-to-TDM capability and support by H.248 MGWs, independent on the
network level (e.g. UNI-to-UNI, NNI-to-NNI, etc).
The common understanding of **TDM Hairpinning** is:
A scenario whereby a call is being made between two **TDM endpoints** on a
**single** media **gateway**. The media comes in on one **TDM channel** (e.g.
a DS0, a 1x64-kbit/s channel) and goes out on another **TDM channel** through
the use of an **internal loop** in the media gateway.
NOTE 1: There are technically a variety of **TDM-to-TDM types** behind TDM
hairpinning, dependent on required type of IWF.
NOTE 2: TDM Hairpinning from pure H.248 perspective results in a single H.248
Context with two H.248 TDM Terminations.
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
This 3GPP Technical Specification (TS) specifies:
  1. The interactions between the HSS (Home Subscriber Server) and the SIP AS (Application Server) and between the HSS and the OSA SCS (Service Capability Server). This interface is referred to as the Sh reference point.
  2. The interactions between the SIP AS and the SLF (Subscription Locator Function) and between the OSA SCS and the SLF. This interface is referred to as the Dh reference point.
The IP Multimedia (IM) Core Network Subsystem stage 2 is specified in 3GPP TS
23.228 [1] and the signalling flows for the IP multimedia call control based
on SIP and SDP are specified in 3GPP TS 24.228 [2].
The IP Multimedia (IM) Session Handling with the IP Multimedia (IM) call model
is specified in 3GPP TS 23.218 [4].
This document addresses the signalling flows and message contents for the
protocol at the Sh and Dh interface.
This document also addresses how the functionality of Ph interface is
accomplished.
The Presence Service Stage 2 description (architecture and functional
solution) is specified in 3GPP TS 23.141 [18].
# 2 References
[1] 3GPP TS 23.228: \"IP Multimedia (IM) Subsystem -- Stage 2\".
[2] 3GPP TS 24.228: \"Signalling flows for the IP multimedia call control
based on SIP and SDP (Release 5)\".
[3] 3GPP TS 23.002 \"Network architecture\".
[4] 3GPP TS 23.218: \"IP Multimedia (IM) Session Handling; IP Multimedia (IM)
call model\".
[5] 3GPP TS 29.329: \"Sh Interface based on Diameter -- Protocol details\".
[6] 3GPP TS 29.228: \"IP multimedia (IM) Subsystem Cx Interface; Signalling
flows and Message Elements\".
[7] 3GPP TS 29.229: \"Cx and Dx Interfaces based on the Diameter protocol ;
Protocol details\".
[8] IETF RFC 3588 \"Diameter Base Protocol\".
[9] ITU-T recommendation Q.763: \"Signalling System No. 7 - ISDN User Part
formats and codes\".
[10] 3GPP TS 23.018: \"Basic Call Handling; Technical realization\".
[11] 3GPP TS 23.003: \"Numbering, Addressing and Identification\".
[12] 3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".
[13] 3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".
[14] 3GPP TS 23.078: \"Customised Applications for Mobile network Enhanced
Logic (CAMEL) Phase 3 - Stage 2\".
[15] IETF RFC 2045: \"Multipurpose Internet Mail Extensions (MIME) Part One:
Format of Internet Message Bodies\".
[16] IETF RFC 3261: \"SIP: Session Initiation Protocol\".
[17] IETF RFC 3966: \"The tel URI for Telephone Numbers\".
[18] 3GPP TS 23.141: \"Presence Service; Architecture and Functional
Description\".
[19] 3GPP TS 23.012: \"**Location Management Procedures** \".
[20] ANSI X3.4: \"Coded Character Set - 7-bit American Standard Code for
Information Interchange\".
[21] Void.
[22] 3GPP TS 33.203: \"Access Security for IP-based services\".
[23] IETF RFC 791: \"Internet Protocol\".
[24] IETF RFC 4291: \"IP Version 6 Addressing Architecture\".
[25] IETF RFC 4412: \"Communications Resource Priority for the Session
Initiation Protocol (SIP)\".
[26] 3GPP TS 29.272: \" MME and SGSN Related Interfaces Based on Diameter
Protocol \".
[27] 3GPP TS 23.008: \"Organization of subscriber data\".
[28] Void
[29] Void.
[30] Void.
[31] Void.
[32] 3GPP TS 23.237: \"IP Multimedia Subsystem (IMS) Service Continuity\".
[33] Void.
[34] Void.
[35] Void.
[36] Void.
[37] Void.
[38] Void.
[39] Void.
[40] Void.
[41] IETF RFC 5952: \"A Recommendation for IPv6 Address Text Representation\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definitions
apply.
**IP Multimedia session:** IP Multimedia session and IP Multimedia call are
treated as equivalent in this specification.
**Transparent data** : Data that is understood syntactically but not
semantically by the HSS. It is data that an AS may store in the HSS to support
its service logic. One example is data that an AS stores in the HSS, using it
as a repository.
**Non-transparent data** : Data that is understood both syntactically and
semantically by the HSS.
**AS (Application Server)** : a term used to denote either of a SIP
Application Server or an OSA Service Capability Server.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
AS Application Server
C Conditional
CSCF Call Session Control Function
CSG Closed Subscriber Group
CSG ID Closed Subscriber Group Identity
GIBA GPRS-IMS-Bundled-Authentication
HSS Home Subscriber Server
IE Information Element
IP Internet Protocol
IM IP Multimedia
IMS IP Multimedia Subsystem
M Mandatory
O Optional
SIP Session Initiation Protocol
SLF Subscription Locator Function
S-CSCF Serving CSCF
# 4 Main Concept
This document presents the Sh interface related functional requirements of the
communicating entities.
It gives a functional classification of the procedures and describes the
procedures and message parameters.
Error handling flows, protocol version identification, etc. procedures are
also included.
# 5 General Architecture
This section further specifies the architectural assumptions associated with
the Sh reference point, building on 3GPP TS 23.228 [1], 3GPP TS 23.218 [4] and
also the Ph reference point building upon 3GPP TS 23.141 [18].
## 5.1 Functional requirements of network entities
### 5.1.1 Functional Requirements of the Application Server
The Application Server may communicate with the HSS over the Sh interface.
For functionality of the Application Server refer to 3GPP TS 23.002 [3], 3GPP
TS 23.228 [1] and 3GPP TS 23.218 [4].
### 5.1.2 Functional requirements of HSS
The HSS may communicate with the Application Server over the Sh interface and
with the Presence Network Agent over the Ph interface. The functionality of
the Ph interface shall be the same as the functionality of the Sh interface.
For functionality of the HSS refer to 3GPP TS 23.002 [3], 3GPP TS 23.228 [1]
and 3GPP TS 23.218 [4].
### 5.1.3 Functional Requirements of the Presence Network Agent
The Presence Network Agent may communicate with the HSS over the Ph interface.
In this case, all references to an Application Server in this specification
apply also to a Presence Network Agent.
## 5.2 Functional classification of Sh interface procedures
Operations on the Sh interface are classified in functional groups:
1\. Data handling procedures
\- The download of data from the HSS to an AS.
\- The update of data in the HSS.
2\. Subscription/notification procedures
\- An AS can subscribe to receive notifications from the HSS of changes in
data.
\- The HSS can notify an AS of changes in data for which the AS previously had
subscribed.
# 6 Procedure Descriptions
In the tables that describe the Information Elements transported by each
command, each Information Element is marked as (M) Mandatory, (C) Conditional
or (O) Optional.
\- A mandatory Information Element (marked as (M) in the table) shall always
be present in the command. If this Information Element is absent, an
application error occurs at the receiver and an answer message shall be sent
back to the originator of the request with the Result-Code set to
DIAMETER_MISSING_AVP. This message shall also include a Failed-AVP AVP
containing the missing Information Element i.e. the corresponding Diameter AVP
defined by the AVP Code and the other fields set as expected for this
Information Element.
\- A conditional Information Element (marked as (C) in the table) shall be
present in the command if certain conditions are fulfilled.
\- If the receiver detects that those conditions are fulfilled and the
Information Element is absent, an application error occurs and an answer
message shall be sent back to the originator of the request with the Result-
Code set to DIAMETER_MISSING_AVP. This message shall also include a Failed-AVP
AVP containing the missing Information Element i.e. the corresponding Diameter
AVP defined by the AVP Code and the other fields set as expected for this
Information Element.
\- If those conditions are not fulfilled, the Information Element shall be
absent. If however this Information Element appears in the message, it shall
not cause an application error and it may be ignored by the receiver if this
is not explicitly defined as an error case. Otherwise, an application error
occurs at the receiver and an answer message with the Result-Code set to
DIAMETER_AVP_NOT_ALLOWED shall be sent back to the originator of the request.
A Failed-AVP AVP containing a copy of the corresponding Diameter AVP shall be
included in this message.
\- An optional Information Element (marked as (O) in the table) may be present
or absent in the command, at the discretion of the application at the sending
entity. Absence or presence of this Information Element shall not cause an
application error and may be ignored by the receiver.
When a procedure is required to determine the Public Identity used for an
identity lookup in HSS and SLF, the HSS and SLF shall derive the Public
Identity from the SIP URI or Tel URI contained in the Public-Identity AVP, if
not already in canonical form as per 3GPP TS 23.003 [11], as described below:
\- If the Public-Identity AVP contains a SIP URI, the HSS and SLF shall follow
rules for conversion of SIP URI into canonical form as specified in IETF RFC
3261 [16] chapter 10.3.
\- If the Public-Identity AVP contains a Tel URI in E.164 format, the HSS and
SLF shall remove visual separators and remove all URI parameters.
When a command contains a ServiceData XML element with or without content
(i.e. \\), the Service Data element is defined as
present in the sub-clauses 6.1 to 6.4 .
Unknown permanent failure error codes shall be treated in the same way as
DIAMETER_UNABLE_TO_COMPLY. For unknown transient failure error codes the
request may be repeated, or handled in the same way as
DIAMETER_UNABLE_TO_COMPLY.
## 6.1 User data handling procedures
### 6.1.1 Data read (Sh-Pull)
This procedure is used between the AS and the HSS. The procedure is invoked by
the AS and is used:
\- To read transparent and/or non-transparent data for a specified user from
the HSS.
This procedure is mapped to the commands User-Data-Request/Answer in the
Diameter application specified in 3GPP TS 29.329 [5]. Tables 6.1.1.1 and
6.1.1.2 detail the involved information elements.
Table 6.1.1.1: Sh-Pull
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | User Identity | User-Identity | M | IMS Public User | | (See 7.1) | | | Identity, Public | | | | | Service Identity, | | | | | or MSISDN of the | | | | | user for whom the | | | | | data is required. | | | | | | | | | | See section 7.1 | | | | | for the content | | | | | of this AVP. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | Wildcarded PSI, | | | | | the AS may | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. | | | | | | | | | | If this element | | | | | is present, it | | | | | should be used by | | | | | the HSS to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public Service | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | PSI. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Wildcarded Public | | | | | User Identity, | | | | | the AS may | | | | | include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. | | | | | | | | | | If this element | | | | | is present, it | | | | | should be used by | | | | | the HSS to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public User | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | Public User | | | | | Identity. | +-------------------+-------------------+------+-------------------+ | Requested data | Data-Reference | M | This information | | | | | element indicates | | (See 7.3) | | | the reference to | | | | | the requested | | | | | information. The | | | | | set of valid | | | | | reference values | | | | | are defined in | | | | | 7.6. | +-------------------+-------------------+------+-------------------+ | Requested | Identity-Set | O | If Data-Reference | | Identity set (See | | | indicates that | | 7.11) | | | IMS Public | | | | | Identities is the | | | | | requested data | | | | | set to be | | | | | downloaded, this | | | | | information | | | | | element should be | | | | | included. | | | | | | | | | | When this | | | | | information | | | | | element takes the | | | | | value | | | | | IMPL | | | | | ICIT_IDENTITIES, | | | | | the HSS shall | | | | | provide all | | | | | non-barred IMS | | | | | Public Identities | | | | | that belong to | | | | | the same implicit | | | | | registration set | | | | | as the IMS Public | | | | | Identity included | | | | | in the message in | | | | | the User-Identity | | | | | AVP. The MSISDN | | | | | user identity is | | | | | not applicable | | | | | for this value. | | | | | If the User | | | | | Identity is a | | | | | Public Service | | | | | Identity, the HSS | | | | | shall return only | | | | | the User Identity | | | | | in the request. | | | | | | | | | | When this | | | | | information | | | | | element takes the | | | | | value | | | | | A | | | | | LIAS_IDENTITIES, | | | | | the HSS shall | | | | | provide all | | | | | non-barred IMS | | | | | Public User | | | | | Identities that | | | | | are in the same | | | | | alias group as | | | | | the IMS Public | | | | | User Identity | | | | | included in the | | | | | message in the | | | | | User-Identity AVP | | | | | (see 3GPP TS | | | | | 23.228 [1] for | | | | | the definition of | | | | | Alias Public User | | | | | Identities). The | | | | | MSISDN user | | | | | identity is not | | | | | applicable for | | | | | this value. If | | | | | the User Identity | | | | | is a Public | | | | | Service Identity, | | | | | the HSS shall | | | | | return only the | | | | | User Identity in | | | | | the request. | | | | | | | | | | When this | | | | | information | | | | | element takes the | | | | | value | | | | | REGIST | | | | | ERED_IDENTITIES, | | | | | the HSS shall | | | | | provide all | | | | | non-barred IMS | | | | | Public Identities | | | | | whose state is | | | | | registered, | | | | | belonging to all | | | | | Private | | | | | Identities that | | | | | the IMS Public | | | | | Identity or | | | | | MSISDN in the | | | | | User-Identity AVP | | | | | is associated | | | | | with. If the User | | | | | Identity is a | | | | | Public Service | | | | | Identity, the HSS | | | | | shall return no | | | | | identities in the | | | | | response. | | | | | | | | | | When this | | | | | information | | | | | element takes the | | | | | value | | | | | ALL_IDENTITIES, | | | | | the HSS shall | | | | | provide all | | | | | non-barred IMS | | | | | Public | | | | | Identities, | | | | | belonging to all | | | | | Private | | | | | Identities that | | | | | the User Identity | | | | | is associated | | | | | with. | | | | | | | | | | If Data-Reference | | | | | indicates that | | | | | IMS Public | | | | | Identities is the | | | | | requested data | | | | | set to be | | | | | downloaded and | | | | | this information | | | | | element is not | | | | | included, the HSS | | | | | shall download | | | | | the set of IMS | | | | | Public Identities | | | | | that would be | | | | | downloaded if the | | | | | value of this | | | | | information | | | | | element had been | | | | | ALL_IDENTITIES. | +-------------------+-------------------+------+-------------------+ | Requested domain | Requested-Domain | C | This information | | | | | element indicates | | (See 7.2) | | | the domains to | | | | | which the | | | | | operation is | | | | | applicable. Check | | | | | table 7.6.1 to | | | | | see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Current Location | Current-Location | C | This information | | | | | element indicates | | (See 7.8) | | | whether an active | | | | | location | | | | | retrieval has to | | | | | be initiated or | | | | | not. It shall be | | | | | present if | | | | | Location | | | | | Information is | | | | | requested. | | | | | | | | | | If this | | | | | information | | | | | element takes the | | | | | value | | | | | InitiateActive | | | | | LocationRetrieval | | | | | (1) the HSS shall | | | | | indicate to the | | | | | MSC/VLR and/or | | | | | SGSN the need to | | | | | initiate an | | | | | active location | | | | | retrieval. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Service | S | C | IE that | | Indication | ervice-Indication | | identifies, | | | | | together with the | | (See 7. 4) | | | User Identity | | | | | included in the | | | | | User-Identity AVP | | | | | and | | | | | Data-Reference, | | | | | the set of | | | | | service related | | | | | transparent data | | | | | that is being | | | | | requested. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Application | Origin-Host | M | IE that | | Server Identity | | | identifies the AS | | (See 7.9) | | | originator of the | | | | | request and that | | | | | is used to check | | | | | the AS permission | | | | | list. | +-------------------+-------------------+------+-------------------+ | Application | Server-Name | C | IE that is used, | | Server Name (See | | | together with the | | 7.10) | | | User Identity | | | | | included in the | | | | | User-Identity AVP | | | | | and | | | | | Data-Reference, | | | | | as key to | | | | | identify the | | | | | filter criteria. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | DSAI Tag (See | DSAI-Tag | C | IE that is used, | | 7.14) | | | together with the | | | | | User Identity | | | | | included in the | | | | | User-Identity AVP | | | | | and | | | | | Data-Reference, | | | | | as key to | | | | | identify the | | | | | instance of | | | | | Dynamic Service | | | | | Activation Info | | | | | (DSAI) requested. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Session Priority | Session-Priority | O | This information | | (see 7.15) | | | element shall | | | | | indicate the | | | | | session\'s | | | | | priority to the | | | | | HSS. If it is not | | | | | included, the | | | | | request shall be | | | | | treated as | | | | | normal. | +-------------------+-------------------+------+-------------------+ | Private Identity | User-Name | O | IMS Private | | | | | Identity of the | | (see 7.6.18) | | | user for whom the | | | | | data is required. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+
Table 6.1.1.2: Sh-Pull Resp
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | Result of the | | | Exp | | request. | | (See 7.5) | erimental_Result | | | | | | | Result-Code AVP | | | | | shall be used for | | | | | errors defined in | | | | | the Diameter Base | | | | | Protocol. | | | | | | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for Sh errors. | | | | | This is a grouped | | | | | AVP which | | | | | contains the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | specific PSI | | | | | matching a | | | | | Wildcarded PSI | | | | | and the | | | | | Wildcarded PSI | | | | | was not included | | | | | in the request | | | | | and is not | | | | | included in the | | | | | User-Data AVP, | | | | | the HSS may | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. This | | | | | information may | | | | | be used by the AS | | | | | to identify the | | | | | affected | | | | | Wildcarded PSI. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Public User | | | | | Identity matching | | | | | a Wildcarded | | | | | Public User | | | | | Identity and the | | | | | Wildcarded-IMPU | | | | | AVP was not | | | | | included in the | | | | | request and is | | | | | not included in | | | | | the User-Data | | | | | AVP, the HSS may | | | | | include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. This | | | | | information may | | | | | be used by the AS | | | | | to identify the | | | | | affected | | | | | Wildcarded Public | | | | | User Identity. | +-------------------+-------------------+------+-------------------+ | Data | User-Data | C | Requested data. | | | | | This element | | (See 7.6) | | | shall be present | | | | | if the requested | | | | | data exists in | | | | | the HSS and the | | | | | AS has | | | | | permissions to | | | | | read it. | +-------------------+-------------------+------+-------------------+
#### 6.1.1.1 Detailed behaviour
The HSS may prioritise the received request message according to priority
level received within the Session-Priority AVP.
The conditions for the inclusion of Requested-Domain as an additional key to
the requested data are described in table 7.6.1. If repository data is
requested, Service-Indication shall be present in the request. If initial
filter criteria are requested, the Server-Name AVP shall contain the SIP URL
of the AS that initiates the request; requests for initial filter criteria are
limited to those initial filter criteria which are relevant to the requesting
AS. If DSAI information is requested, the DSAI-Tag AVP shall be present.
Upon reception of the Sh-Pull request, the HSS shall, in the following order:
1\. In the AS permission list (see section 6.2) check that the requested user
data is allowed to be read (Sh-Pull) by this AS by checking the combination of
the identity of the AS sending the request (identified by the Origin-Host AVP)
and the supplied Data-Reference.
> If one or more Data References in the request are not allowed to be read,
> Experimental-Result shall be set to DIAMETER_ERROR_USER_DATA_CANNOT_BE_READ
> in the Sh-Pull Response.
2\. Check that the User Identity for whom data is asked exists in HSS. If not,
Experimental-Result shall be set to DIAMETER_ERROR_USER_UNKNOWN in the Sh-Pull
Response.
2a. Check if the Private Identity (if received) corresponds to the IMPU
received in User-Identity. If not, Experimental-Result-Code shall be set to
DIAMETER_ERROR_IDENTITIES_DONT_MATCH.
3\. If the User Identity and the Private Identity (if present) do not apply to
the Data-Reference indicated in the request according to Table 7.6.1,
Experimental-Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in
the Sh-Pull Response.
3a. If data-reference is IPAddressSecureBindingInformation (22) and the User
Identity is an IMS Public User Identity that is shared between multiple
Private User Identities, Experimental-Result shall be set to
DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Pull Response.
4\. Check whether or not the data that is requested to be downloaded by the AS
is currently being updated by another entity. If there is an update of the
data in progress, the HSS may delay the Sh-Pull-Resp message until the update
has been completed. The HSS shall ensure that the data returned is not
corrupted by this conflict. If HSS is not able to delay the Sh-Pull-Resp
message e.g. due to timeout the Experimental-Result-Code shall be set to
DIAMETER_USER_DATA_NOT_AVAILABLE.
5\. The HSS shall include the data pertinent to the requested Data Reference
in the User-Data AVP and if the HSS supports the Notif-Eff feature, the HSS
shall include the data pertinent to all the requested Data References in the
User-Data AVP. The HSS shall set the Result-Code to DIAMETER_SUCCESS. This
includes cases where the data is not available to the HSS.
> If both the AS and the HSS have determined via mutual feature evaluation to
> not support the Notif-Eff feature and in the case that requested data is not
> available to the HSS, the HSS shall not include the User-Data AVP in the Sh-
> Pull Response. If both the AS and the HSS support the Notif-Eff feature and
> none of the requested data is available to the HSS, the HSS shall not
> include the User-Data AVP in the Sh-Pull Response.
>
> If both the AS and the HSS support the Notif-Eff feature and some of the
> requested data is not available to the HSS, it shall be indicated as
> follows. Empty repository data shall be indicated with the RepositoryData
> element that contains a Service Indication and a Sequence Number but does
> not contain a ServiceData element (i.e. ServiceData is not present). Empty
> Public Identifiers shall be indicated with an empty PublicIdentifiers
> element. Empty location information shall be indicated by an empty
> CSLocationInformation and/or an empty PSLocationInformation element. Empty
> elements of Sh IMS Data shall be indicated as follows. An empty S-CSCF name
> shall be indicated with empty SCSCFName element. An empty IP Address Secure
> Binding Information shall be indicated with empty IPv4address element or
> empty IPv6prefix element. If all iFCs for the user that are relevant for the
> AS are empty it shall be indicated with empty IFCs element.
If there is an error in any of the above steps then the HSS shall stop
processing and shall return the error code specified in the respective step
(see 3GPP TS 29.329 [5] and 3GPP TS 29.229 [7] for an explanation of the error
codes).
If the HSS cannot fulfil the received request for reasons not stated in the
above steps, e.g. due to a database error or empty mandatory data elements, it
shall stop processing the request and set Result-Code to
DIAMETER_UNABLE_TO_COMPLY.
Otherwise, the requested operation shall take place and the HSS shall return
the Result-Code AVP set to DIAMETER_SUCCESS. Result-Code DIAMETER_SUCCESS is
used also if the requested data does not exist in the HSS i.e. when the HSS is
indicating valid empty data elements.
### 6.1.2 Data Update (Sh-Update)
This procedure is used between the AS and the HSS. The procedure is invoked by
the AS and is used:
  * To allow the AS to update the transparent (repository) data stored at the HSS for each IMS Public User Identity (for Public User Identities matching a Wildcarded Public User Identity, the transparent data shall be stored per Wildcarded Public User Identity, and not for each specific Public User Identity matching that Wildcarded Public User Identity) or Public Service Identity (for Public Service Identities matching a Wildcarded PSI, the transparent data shall be stored per Wildcarded PSI, and not for each specific Public Service Identity matching that Wildcarded PSI).
  * To allow the AS to update the PSI Activation State of a distinct Public Service Identity in the HSS.
  * To allow the AS to update the Dynamic Service Activation Info stored at the HSS.
  * To allow the AS to update the Short Message Service Registration Info stored at the HSS.
This procedure is mapped to the commands Profile-Update-Request/Answer in the
Diameter application specified in 3GPP TS 29.329 [5]. Tables 6.1.2.1 and
6.1.2.2 detail the involved information elements.
Table 6.1.2.1: Sh-Update
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | User Identity | User-Identity | M | IMS Public User | | | | | Identity or | | (See 7.1) | | | Public Service | | | | | Identity or | | | | | MSISDN for which | | | | | data is updated. | | | | | | | | | | See section 7.1 | | | | | for the content | | | | | of this AVP. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | Wildcarded PSI, | | | | | the AS may | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. | | | | | | | | | | If this element | | | | | is present, it | | | | | should be used by | | | | | the HSS to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public Service | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | PSI. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Wildcarded Public | | | | | User Identity, | | | | | the AS may | | | | | include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. | | | | | | | | | | If this element | | | | | is present, it | | | | | should be used by | | | | | the HSS to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public User | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | Public User | | | | | Identity. | +-------------------+-------------------+------+-------------------+ | Requested data | Data-Reference | M | This information | | | | | element includes | | (See 7.3) | | | the reference to | | | | | the data on which | | | | | updates are | | | | | required | | | | | (possible values | | | | | of the Data | | | | | Reference are | | | | | defined in Table | | | | | 7.6.1). | +-------------------+-------------------+------+-------------------+ | Data | User-Data | M | Updated data. | | | | | | | (See 7.6) | | | | +-------------------+-------------------+------+-------------------+ | Application | Origin-Host | M | IE that | | Server Identity | | | identifies the AS | | | | | originator of the | | (See 7.9) | | | request and that | | | | | is used to check | | | | | the AS permission | | | | | list. | +-------------------+-------------------+------+-------------------+
Table 6.1.2.2: Sh-Update Resp
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | Result of the | | | Ex | | update of data in | | (See 7.5) | perimental-Result | | the HSS. | | | | | | | | | | Result-Code AVP | | | | | shall be used for | | | | | errors defined in | | | | | the Diameter Base | | | | | Protocol. | | | | | | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for Sh errors. | | | | | This is a grouped | | | | | AVP which | | | | | contains the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | specific PSI | | | | | matching a | | | | | Wildcarded PSI | | | | | and the | | | | | Wildcarded PSI | | | | | was not included | | | | | in the request, | | | | | the HSS may | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. This | | | | | information may | | | | | be used by the AS | | | | | to identify the | | | | | affected | | | | | Wildcarded PSI. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Public User | | | | | Identity matching | | | | | a Wildcarded | | | | | Public User | | | | | Identity and the | | | | | Wildcarded-IMPU | | | | | AVP was not | | | | | included in the | | | | | request, the HSS | | | | | may include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. This | | | | | information may | | | | | be used by the AS | | | | | to identify the | | | | | affected | | | | | Wildcarded Public | | | | | User Identity. | +-------------------+-------------------+------+-------------------+
#### 6.1.2.1 Detailed behaviour
Within the Sh-Update Request, the keys to determine the updated data are part
of the information element Data (See 7.6). When data in the repository is
updated (i.e. added, modified or removed) Service-Indication and Sequence-
Number are also sent as part of the information element Data.
Newly added transparent data shall be associated with a Sequence Number of 0
in the Sh-Update Request. Sequence Number value 0 is reserved exclusively for
indication of newly added transparent data.\ Modified and removed transparent
data shall be associated within the Sh-Update Request with a Sequence Number
of n+1 where n is the original Sequence Number associated with the transparent
data before modification or removal. If n equals 65535, then the next
modification or deletion of that transparent data shall be associated with a
Sequence Number of 1.
Upon reception of the Sh-Update request, the HSS shall, in the following
order:
1\. In the AS permission list (see section 6.2) check that the data that is
requested to be updated (Sh-Update) by this AS, is allowed to be updated by
checking the combination of the identity of the AS sending the request
(identified by the Origin-Host AVP) and the supplied Data-Reference.
> \- If the data is not allowed to be updated, Experimental-Result shall be
> set to DIAMETER_ERROR_USER_DATA_CANNOT_BE_MODIFIED in the Sh-Update
> Response.
2\. Check that the User Identity in the request exists in the HSS. If not,
Experimental-Result shall be set to DIAMETER_ERROR_USER_UNKNOWN in the Sh-
Update Response.
3\. If the User Identity does not apply to the Data-Reference indicated in the
request according to Table 7.6.1, Experimental-Result shall be set to
DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Update Response.
4\. If Data-Reference is PSIActivation (18), then the HSS shall check that the
User Identity contains a distinct Public Service Identity. If it does, then
the HSS shall update the corresponding PSI Activation State and return the
Result-Code AVP set to DIAMETER_SUCCESS. If it does not, then the
Experimental-Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in
the Sh-Update Response.
> The change of a Public Service Identity from ACTIVE to INACTIVE shall
> trigger the network initiated deregistration of the Public Service Identity
> in the HSS.
4a. If Data-Reference is DSAI (19), check whether or not, for the Public
Identity, there is an instance of DSAI matching the DSAI-Tag contained in the
Sh-Update command. If so, then the HSS shall update the DSAI value and return
the Result-Code AVP set to DIAMETER_SUCCESS. If not, Experimental-Result shall
be set to DIAMETER_ERROR_DSAI_NOT_AVAILABLE.
> The changes of DSAI value shall trigger the procedures described in section
> 7.14 in order to determine which initial filter criteria should be masked or
> unmasked. If these procedures change the set of unmasked initial filter
> criteria, the HSS should behave as if the initial filter criteria had been
> administratively changed, which implies e.g. sending Sh-Notif or Cx-
> Update_Subscr_Data messages (see 3GPP TS 29.228 [6]).
4b. If Data-Reference is SMSRegistrationInfo (24), check whether or not, for
the Public Identity or MSISDN, IP-SM-GW number contained in the Sh-Update
command is empty. If it is empty, then the HSS shall delete the stored IP-SM-
GW number and return the Result-Code AVP set to DIAMETER_SUCCESS.
If it is not empty, the HSS shall further check if a preconfigured IP-SM-GW
number exists and does not match the IP-SM-GW number contained in the Sh-
Update command. If so, Experimental-Result shall be set to
DIAMETER_ERROR_USER_DATA_CANNOT_BE_MODIFIED. If not, the HSS shall update the
IP-SM-GW number and return the Result-Code AVP set to DIAMETER_SUCCESS.
5\. Check whether or not the data that is requested to be updated by the AS,
as identified by the Service-Indication, is currently being updated by another
entity. If there is an update of the data in progress, Experimental-Result
shall be set to DIAMETER_PRIOR_UPDATE_IN_PROGRESS in the Sh-Update Response.
6\. Check whether or not there is any repository data stored at the HSS
already for the specified Service-Indication and the associated IMS Public
User Identity (or group if the IMS Public User Identity is alias) or Public
Service Identity.
\- If repository data identified by the Service-Indication is stored at the
HSS for the specified IMS Public User Identity, IMS Public User Identity group
or Public Service Identity, check the following premises:
1\. Sequence_Number_in_Sh_Update is not equal to 0
2\. (Sequence_Number_in_Sh_Update - 1) is equal to (Sequence_Number_In_HSS
modulo 65535)
\- If either of the above premises is false then Experimental-Result‑ shall be
set to DIAMETER_ERROR_TRANSPARENT_DATA_OUT_OF_SYNC in the Sh-Update Response.
\- If both of the above premises are true, then check whether or not Service
Data is received within the Sh-Update Req.
\- If Service Data element is present in the Sh-Update Req, check whether or
not the size of the data is greater than that which the HSS is prepared to
accept.
\- If there is more data than the HSS is prepared to accept then
Experimental‑Result shall be set to DIAMETER_ERROR_TOO_MUCH_DATA and the new
data shall be discarded.
\- If the HSS is prepared to accept the data, then the repository data stored
at the HSS shall be updated with the repository data sent in the Sh-Update Req
and the Sequence Number associated with that repository data shall be updated
with that sent in the Sh-Update Req. This triggers the sending of Sh-Notif
messages to any other ASs that are subscribed to Notifications for updates to
the service data for that IMS Public User Identity or Public Service Identity
(see 6.1.4).
\- If Service Data element is not present in the Sh-Update Req, the data
stored in the repository at the HSS shall be removed, and as a consequence the
Service Indication and the Sequence Number associated with the removed data
shall also be removed. This triggers the sending of Sh-Notif messages with
that Service Indication and Sequence Number to be deleted but with an absent
Service Data element, to any other ASs that are subscribed to Notifications
for updates to the service data for that IMS Public User Identity or Public
Service identity (see 6.1.4). After sending Sh-Notif messages, the
subscriptions to Notifications for the removed Repository Data shall be
deleted.
\- If repository data identified by the Service-Indication is not stored for
the IMS Public User Identity, IMS Public User Identity group or Public Service
Identity i.e. the Sh-Update Req intends to create a new repository data, check
whether or not the Sequence Number in the Sh-Update Req is 0.
\- If the sequence number is not set to 0, Experimental-Result shall be set to
DIAMETER_ERROR_TRANSPARENT_DATA_OUT_OF_SYNC
\- If the sequence number is set to 0 check whether Service Data is included
within the Sh-Update Req.
\- If Service Data element is not present in the Sh-Update Req, then
Experimental-Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED and
the operation shall be ignored by the HSS.
\- If Service Data element is present in the Sh-Update Req, check whether or
not the size of the data is greater than that which the HSS is prepared to
accept.
\- If there is more data than the HSS is prepared to accept then
Experimental‑Result shall be set to DIAMETER_ERROR_TOO_MUCH_DATA and the new
data shall be discarded.
\- If the HSS is prepared to accept the data included in the Sh-Update Req,
then the data shall be stored in the data repository in the HSS.
If there is an error in any of the above steps then the HSS shall stop
processing and shall return the error code specified in the respective step
(see 3GPP TS 29.329 [5] and 3GPP TS 29.229 [7] for an explanation of the error
codes).
If the HSS cannot fulfil the received request for reasons not stated in the
above steps, e.g. due to database error, it shall stop processing the request
and set Result-Code to DIAMETER_UNABLE_TO_COMPLY.
Otherwise, the requested operation shall take place and the HSS shall return
the Result-Code AVP set to DIAMETER_SUCCESS.
NOTE: When an AS receives DIAMETER_ERROR_TRANSPARENT_DATA_OUT_OF_SYNC the AS
may attempt to resolve the inconsistency between the version of the repository
data that it holds and that stored at the HSS. It may execute a Sh-Pull to
retrieve the current version of the data from the HSS or it may wait to
receive a subsequent Sh-Notif message from the HSS for the affected repository
data.
### 6.1.3 Subscription to notifications (Sh-Subs-Notif)
This procedure is used between the AS and the HSS. The procedure is invoked by
the AS and is used:
\- To subscribe to Notifications for when particular transparent and/or non-
transparent data for a specified IMS Public User Identity or Public Service
Identity is updated, from the HSS.
\- Optionally to request the user data from the HSS in the same operation.
This procedure is mapped to the commands Subscribe-Notifications-
Request/Answer in the Diameter application specified in 3GPP TS 29.329 [5].
Tables 6.1.3.1 and 6.1.3.2 detail the information elements involved.
Table 6.1.3.1: Sh-Subs-Notif
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | User Identity | User-Identity | M | IMS Public User | | | | | Identity or | | (See 7.1) | | | Public Service | | | | | Identity or | | | | | MSISDN for which | | | | | notifications of | | | | | data changes are | | | | | requested. See | | | | | section 7.1 for | | | | | the content of | | | | | this AVP. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | Wildcarded PSI, | | | | | the AS may | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. | | | | | | | | | | If this element | | | | | is present, it | | | | | should be used by | | | | | the HSS to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public Service | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | PSI. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Wildcarded Public | | | | | User Identity, | | | | | the AS may | | | | | include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. | | | | | | | | | | If this element | | | | | is present, it | | | | | should be used by | | | | | the HSS to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public User | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | Public User | | | | | Identity. | +-------------------+-------------------+------+-------------------+ | Requested Data | Data-Reference | M | This information | | | | | element includes | | (See 7.3) | | | the reference to | | | | | the data on which | | | | | notifications of | | | | | change are | | | | | required (valid | | | | | reference values | | | | | are defined in 7. | | | | | 6). | +-------------------+-------------------+------+-------------------+ | Subscription | Subs-Req-Type | M | This information | | request type (See | | | element indicates | | 7.7) | | | the action | | | | | requested on | | | | | subscription to | | | | | notifications. | +-------------------+-------------------+------+-------------------+ | Send Data | Sen | O | This information | | Indication | d-Data-Indication | | element requests | | | | | that the data is | | (See 7.13) | | | sent in the | | | | | response. | +-------------------+-------------------+------+-------------------+ | Service | S | C | IE that | | Indication | ervice-Indication | | identifies, | | | | | together with the | | (See 7.4) | | | User Identity and | | | | | Data-Reference, | | | | | the set of | | | | | service related | | | | | transparent data | | | | | for which | | | | | notifications of | | | | | changes are | | | | | requested. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Application | Origin-Host | M | IE that | | Server Identity | | | identifies the AS | | (See 7.9) | | | originator of the | | | | | request and that | | | | | is used to check | | | | | the AS permission | | | | | list. | +-------------------+-------------------+------+-------------------+ | Application | Server-Name | C | IE that is used, | | Server Name (See | | | together with the | | 7.10) | | | User Identity and | | | | | Data-Reference, | | | | | as key to | | | | | identify the | | | | | filter criteria. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Expiry Time (See | Expiry-Time | O | Gives the | | 7.12) | | | absolute time | | | | | requested at | | | | | which the | | | | | subscription | | | | | expires. | +-------------------+-------------------+------+-------------------+ | Dynamic Service | DSAI-Tag | C | IE that | | Activation | | | identifies, | | Information Tag | | | together with the | | (see 7.14) | | | User Identity and | | | | | Data-Reference, | | | | | the instance of | | | | | Dynamic Service | | | | | Activation Info | | | | | (DSAI) requested. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Requested | Identity-Set | C | Check table 7.6.1 | | Identity set (See | | | to see when it is | | 7.11) | | | applicable. | +-------------------+-------------------+------+-------------------+ | One time | One-Time- | O | This information | | notification | Notification | | element indicates | | | | | if subscription | | | | | shall be ended by | | | | | the HSS after | | | | | sending the first | | | | | notification. | | | | | | | | | | This IE is only | | | | | applicable to UE | | | | | reachability for | | | | | IP | | | | | | | | | | T | +-------------------+-------------------+------+-------------------+
Table 6.1.3.2: Sh-Subs-Notif Resp
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Expiry Time (See | Expiry-Time | O | Acknowledges the | | 7.12) | | | absolute time at | | | | | which the | | | | | subscription | | | | | expires. | +-------------------+-------------------+------+-------------------+ | Data (See 7.6) | User-Data | O | Current values of | | | | | the data for | | | | | which | | | | | notifications | | | | | have been | | | | | requested. | | | | | | | | | | It should be | | | | | present if the | | | | | Sen | | | | | d-Data-Indication | | | | | AVP is set to | | | | | value | | | | | USER\ | | | | | _DATA_REQUESTED. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | specific PSI | | | | | matching a | | | | | Wildcarded PSI | | | | | and the | | | | | Wildcarded PSI | | | | | was not included | | | | | in the request | | | | | and is not | | | | | included in the | | | | | User-Data AVP, | | | | | the HSS may | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. This | | | | | information may | | | | | be used by the AS | | | | | to identify the | | | | | affected | | | | | Wildcarded PSI. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Public User | | | | | Identity matching | | | | | a Wildcarded | | | | | Public User | | | | | Identity and the | | | | | Wildcarded-IMPU | | | | | AVP was not | | | | | included in the | | | | | request, the HSS | | | | | may include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. This | | | | | information may | | | | | be used by the AS | | | | | to identify the | | | | | affected | | | | | Wildcarded Public | | | | | User Identity. | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | Result of the | | | Ex | | request. | | (See 7.5) | perimental-Result | | | | | | | Result-Code AVP | | | | | shall be used for | | | | | errors defined in | | | | | the Diameter Base | | | | | Protocol. | | | | | | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for Sh errors. | | | | | This is a grouped | | | | | AVP which | | | | | contains the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+
#### 6.1.3.1 Detailed behaviour
The HSS shall take note of the subscription request on the data identified by
User Identity and Data-Reference. If notifications on changes of repository
data are requested, Service-Indication shall be present in the request. If
notifications on changes of filter criteria are requested, the Server-Name AVP
shall be used as key to the filter criteria. If the request contains a
specific Public Service Identity matching a Wildcarded PSI, the HSS shall
interpret that the subscription refers to the information associated to the
Wildcarded PSI. The Server-Name AVP shall contain the SIP URL of the AS
sending the request. If notifications on changes of DSAI are requested, the
DSAI-Tag AVP shall be used as key of the DSAI whose changes are to be
monitored.
Upon reception of the Sh-Subs-Notif request, the HSS shall, in the following
order (if there is an error in any of the following steps the HSS shall stop
processing and return the corresponding error code, see 3GPP TS 29.329 [5] and
3GPP TS 29.229 [7]):
1\. In the AS permission list (see section 6.2) the HSS shall check that the
AS is allowed to subscribe to notifications (Sh-Subs-Notif) for the requested
data by checking the combination of the identity of the AS sending the request
(identified by the Origin-Host AVP) and the supplied Data-Reference.
> \- If this AS does not have Sh-Subs-Notif permission for the data
> referenced, Experimental-Result shall be set to
> DIAMETER_ERROR_USER_DATA_CANNOT_BE_NOTIFIED in the Sh-Subs-Notif Response.
2\. Check that the IMS Public User Identity or Public Service Identity in the
request exists in HSS. If not, Experimental-Result shall be set to
DIAMETER_ERROR_USER_UNKNOWN in the Sh-Subs-Notif Response.
3\. If the User Identity does not apply to the Data-Reference indicated in the
request according to Table 7.6.1, Experimental-Result shall be set to
DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Subs-Notif Response.
3a. If Data-Reference is DSAI (19), check whether or not, for the Public
Identity, there is an instance of DSAI matching the DSAI-Tag contained in the
Sh-Subs-Notif command. If not, Experimental-Result shall be set to
DIAMETER_ERROR_DSAI_NOT_AVAILABLE.
4\. If the Sh-Subs-Notif Request contains an Expiry Time, the HSS should also
include in the Sh-Subs-Notif Response an Expiry Time IE with the absolute time
at which the subscription expires in the case of a successful subscription.
This time may be earlier than the requested expiry time. If the HSS includes
this IE, then no notification shall be sent to the AS after the expiration
time. If the HSS receives a Sh-Subs-Notif Request without the Expiry Time IE,
the HSS should treat it as a request for an unlimited subscription.
> If the HSS does not include this IE in the response, that indicates an
> unlimited subscription.
>
> If a subsequent request is received by the HSS where the Expiry Time IE is
> present but different from what the HSS has previously stored, the HSS
> should replace the stored expiration time with what was received in the
> request.
5\. If Data-Reference is RepositoryData(0) and the transparent data associated
with the Service Indication does not exist in the HSS (i.e. Service Data is
not present), then Experimental-Result shall be set to
DIAMETER_ERROR_SUBS_DATA_ABSENT.
6\. If the Subscription request type information element indicates that this
is a request to subscribe, the HSS shall associate the Application Server
Identity with the list of entities that need to be notified when the data
identified by the request is modified and set the Result-Code to
DIAMETER_SUCCESS in the Sh-Subs-Notify response. If the Subscription request
type information element indicates that this is a request to unsubscribe, the
HSS shall remove the association of the Application Server Identity with the
same list. In this last case, the Result-Code shall be set to DIAMETER_SUCCESS
if the operation is successful or if the Application Server Identity was not
present in the list.
7\. If the HSS and AS supports the Notif-Eff feature and if multiple Data-
Reference AVPs occur in the Sh-Subs-Notif Request, each Data-Reference shall
be treated as a request to establish a separate notification request. When
mulitiple notification requests are requested, and all of them succeed, the
HSS shall set the Result-Code to DIAMETER_SUCCESS in the Sh-Subs-Notify
response.
8\. If the HSS and AS supports the Notif-Eff feature and if multiple Service-
Indication AVPs occur in the Sh-Subs-Notif Request, each Service-Indication
shall be treated as a request to establish a separate notification request for
change of Transparent data. When mulitiple notification requests are
requested, and all of them are successful, the HSS shall return the Result-
Code set to DIAMETER_SUCCESS in the Sh-Subs-Notify response.
9\. If the Send Data Indication information element is present in the request
and the HSS supports the return of the User-Data in this request, check
whether or not the data that is requested to be downloaded by the AS is
currently being updated by another entity. If there is an update of the data
in progress, the HSS may delay the response until the update has been
completed. The HSS shall ensure that the data returned is not corrupted by
this conflict.
10\. If the Send Data Indication information element is present in the
request, the HSS should include the data pertinent to the requested Data
Reference in the User-Data AVP and if the HSS supports the Notif-Eff feature,
the HSS should include the data pertinent to all the requested Data References
in the User-Data AVP. The HSS shall set the Result-Code to DIAMETER_SUCCESS.
This includes cases where the data is not available to the HSS and an empty
tag is included as follows. Empty elements of Sh IMS Data shall be indicated
as follows. An empty S-CSCF name shall be indicated with empty SCSCFName
element. If all iFCs for the user that are relevant for the AS are empty it
shall be indicated with empty IFCs element. Similarly for PSI activation
information.
If the HSS cannot fulfil the received request for reasons not stated in the
above steps, e.g. due to database error, it shall stop processing the request
and set Result-Code to DIAMETER_UNABLE_TO_COMPLY.
### 6.1.4 Notifications (Sh-Notif)
This procedure is used between the HSS and the AS. The procedure is invoked by
the HSS and is used:
\- To inform the AS of changes in transparent and/or non-transparent data to
which the AS has previously subscribed to receive Notifications for, using Sh-
Subs-Notif (see 6.1.3).
This procedure is mapped to the commands Push-Notification-Request/Answer in
the Diameter application specified in 3GPP TS 29.329 [5]. Tables 6.1.4.1 and
6.1.4.2 detail the involved information elements.
Table 6.1.4.1: Sh-Notif
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | User Identity | User-Identity | M | IMS Public User | | | | | Identity or | | (See 7.1) | | | Public Service | | | | | Identity for | | | | | which data has | | | | | changed. | | | | | | | | | | If the request | | | | | refers to a | | | | | Wildcarded PSI, | | | | | the HSS may | | | | | include any PSI | | | | | matching the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. The AS | | | | | shall find the | | | | | corresponding | | | | | Wildcarded PSI | | | | | with this | | | | | information. | | | | | | | | | | See section 7.1 | | | | | for the content | | | | | of this AVP. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | Wildcarded PSI, | | | | | the HSS shall | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. | | | | | | | | | | If this element | | | | | is present, it | | | | | shall be used by | | | | | the AS instead of | | | | | the User Identity | | | | | to identify the | | | | | identity affected | | | | | by the request. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Wildcarded Public | | | | | User Identity, | | | | | the HSS shall | | | | | include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. | | | | | | | | | | []{.underline} | | | | | | | | | | If this element | | | | | is present, it | | | | | shall be used by | | | | | the AS instead of | | | | | the User Identity | | | | | to identify the | | | | | identity affected | | | | | by the request. | +-------------------+-------------------+------+-------------------+ | Data | User-Data | M | Changed data. | | | | | | | (See 7.6) | | | | +-------------------+-------------------+------+-------------------+
Table 6.1.4.2: Sh-Notif Resp
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | Result of the | | | Ex | | request. | | (See 7.5) | perimental-Result | | | | | | | Result-Code AVP | | | | | shall be used for | | | | | errors defined in | | | | | the Diameter Base | | | | | Protocol. | | | | | | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for Sh errors. | | | | | This is a grouped | | | | | AVP which | | | | | contains the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+
#### 6.1.4.1 Detailed behaviour
The keys to the updated data are part of the information element User-Data
AVP. When data repository is updated Service-Indication and Sequence Number
shall also be part of the information element User-Data.
Since authentication pending is a transient state of normally very short
duration, notification of an IMS user\'s state change, to and from the
authentication pending state shall not be sent to Application Servers, when
the previous state before authentication pending and next state after
authentication pending are the same. If the states are different before the
authentication pending state is entered and after the authentication pending
state is left then notification is sent to the AS of this new state.
If the HSS and AS supports the Notif-Eff feature and if multiple subscriptions
to notifications are associated with a Public User Identity, the HSS may
combine the notifications for multiple Data References and Service Indications
into a single notification message.
Removal of the subscribed data is indicated with the content of User-Data AVP.
The content shall be compliant with the XML-schema defined in Annex D. Removed
repository data shall be indicated with RepositoryData element that does not
contain ServiceData element. Removed S-CSCF name shall be indicated with empty
SCSCFName element. Removed IP Address Secure Binding Information shall be
indicated with empty IPv4Addres, or IPv6Prefix and/ or IPv6 interface element
respectively. If all iFCs for the user that are relevant for the AS have been
removed it shall be indicated with empty IFCs element.
Removal of Public Identity for which the AS has any active subscription other
than IMSPublicIdentity (see table 7.6.1) shall be indicated in the
DeletedIdentities element.
If One-Time-Notification AVP was included by the AS in Sh-Subs-Notif, the HSS
shall remove the related subscription information after sending Sh-Notif, i.e.
no subsequent notifications shall be sent to AS.
Table 6.1.4.1 details the valid result codes that the AS can return in the
response.
Table 6.1.4.1.1: Sh-Notif response valid result codes
* * *
Result-Code AVP value Condition DIAMETER_SUCCESS The request succeeded.
DIAMETER_ERROR_USER_DATA_NOT_RECOGNIZED The request failed. The AS informs the
HSS that the received user information contained information, which was not
recognized or supported by the AS. DIAMETER_ERROR_USER_UNKNOWN The request
failed because the Public Identity is not found in the AS.
DIAMETER_ERROR_TOO_MUCH_DATA The request failed. The AS informs the HSS that
it tried to push too much data into the AS.
DIAMETER_ERROR_NO_SUBSCRIPTION_TO_DATA The request failed. The AS informs the
HSS that the notification refers to information to which the AS is not
subscribed. DIAMETER_UNABLE_TO_COMPLY The request failed.
* * *
## 6.2 AS permissions list
In table 7.6.1, the contents of the Data-AVP are described. Some of the
individual elements carried within Data-AVP may be requested by the AS from
the HSS using the Sh-Pull command (see section 6.1.1) or may be updated at the
HSS by the AS using the Sh-Update command (see section 6.1.2). The AS may also
request that the HSS notifies the AS of changes to specific elements within
the Data-AVP using the Sh-Subs-Notif command (see section 6.1.3). The HSS will
only allow these operations to take place if the element of the Data-AVP is
permitted to be included in the specific command requested by the AS, as
indicated in table 7.6.1.
To manage whether an AS may request each element of Data-AVP with a specific
command, the HSS shall maintain a list of AS permissions (the 'AS Permissions
List'). AS permissions are identified by AS identity and Data Reference with
the possible permissions associated with each Data Reference being Sh-Pull,
Sh-Update, Sh-Subs-Notif or any combination of these permissions (see table
7.6.1 for details of which permissions are allowed for each Data Reference).
The permissions apply to all users served by the HSS, they are not user
specific. When an AS requests Sh-Pull, Sh-Update or Sh-Subs-Notif the HSS
shall check permissions and return an error result if the AS does not have the
required permission. If the AS permissions change in a later stage, i.e. the
AS does not longer have the required permission, the HSS shall remove all the
subscription to notifications for the AS for which required permissions have
been prohibited.
## 6.3 Void
## 6.4 Void
## 6.5 User identity to HSS resolution
The User identity to HSS resolution mechanism enables the AS to find the
identity of the HSS that holds the subscriber data for a given IMS Public User
Identity or Public Service Identity when multiple and separately addressable
HSSs have been deployed by the network operator. The resolution mechanism is
not required in networks that utilise a single HSS or when an AS is configured
to use pre-defined HSS.
The resolution mechanism described in 3GPP TS 23.228 [8] shall use a
Subscription Locator Function (SLF) or a Diameter Proxy Agent.
The AS accesses the SLF via the Dh interface. The Dh interface shall always be
used in conjunction with the Sh interface. The Dh interface shall be based on
Diameter. The SLF functionality shall use the routing mechanism provided by an
enhanced Diameter redirect agent.
The SLF or the Diameter Proxy Agent shall be to determine the HSS identity.
To get the HSS identity the AS shall send the Sh request normally destined to
the HSS to a pre-configured Diameter address/name.
\- If this Sh Request is received by an SLF (acting as a Diameter redirect
agent), the SLF shall determine the HSS address and shall send to the AS a
notification of redirection towards the HSS identity, in response to the Sh
request. Multiple HSS identities may be included in the response, as specified
in IETF RFC 3588 [9]. In such a case, the AS shall send the Sh Request to the
first HSS identity in the ordered list received in the Sh Response from the
SLF. If the AS does not receive a successful response to the Sh Request, the
AS shall send a Sh Request to the next HSS identity in the ordered list. This
procedure shall be repeated until a successful response from an HSS is
received.
\- If this Sh Request is received by the Diameter Proxy Agent, the Diameter
Proxy Agent shall determine the HSS identity and shall forward the Sh request
directly to the HSS. The AS shall determine the HSS identity from the response
to the Sh request received from the HSS.
The AS should store the HSS identity/name/Realm and shall use it in further Sh
requests associated to the same IMS Public Identity.
In networks where the use of the user identity to HSS resolution mechanism is
required and the AS is not configured to use a predefined HSS, each AS shall
be configured with the pre-configured address/name of the SLF or the Diameter
Proxy Agent to enable use of these resolution mechanisms.
# 7 Information element contents
## 7.1 User Identity
This information element contains an IMS Public User Identity, Public Service
Identity or MSISDN according to the conditions described in table 7.1.1.
Table 7.1.1: User Identity content
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | IMS Public User | Public-Identity | C | IMS Public User | | Identity / Public | | | Identity or | | Service Identity | | | Public Service | | | | | Identity for | | (See 7.1.1) | | | which data is | | | | | required. If the | | | | | MSISDN is not | | | | | included in the | | | | | User-Identity | | | | | AVP, the | | | | | Public-Identity | | | | | AVP shall be | | | | | included in Sh | | | | | messages only for | | | | | allowed Data | | | | | References as | | | | | described in | | | | | Table 7.6.1. | +-------------------+-------------------+------+-------------------+ | MSISDN | MSISDN | C | MSISDN for which | | | | | data is required. | | (See 7.1.2) | | | If the | | | | | Public-Identity | | | | | AVP is not | | | | | included in the | | | | | User-Identity | | | | | AVP, the MSISDN | | | | | AVP shall be | | | | | included in the | | | | | Sh-Pull or | | | | | Sh-Subs-Notif or | | | | | Sh-Update | | | | | messages only for | | | | | allowed Data | | | | | References as | | | | | described in | | | | | Table 7.6.1. | +-------------------+-------------------+------+-------------------+
### 7.1.1 IMS Public User Identity / Public Service Identity
This information element contains an IMS Public User Identity / Public Service
Identity (either SIP URI or tel URI). See 3GPP 23.003 [11].
### 7.1.2 MSISDN
This information element contains a Basic MSISDN (see 3GPP TS 23.012 [19]).
## 7.1A Wildcarded PSI
This information element contains a Wildcarded PSI that is hosted by an
application server. For definition of a Wildcarded PSI, see 3GPP TS 23.003
[11].
## 7.1B Wildcarded Public User Identity
This information element contains a Wildcarded Public User Identity that is
stored in the HSS. For definition of a Wildcarded Public User Identity, see
3GPP TS 23.003 [11].
## 7.2 Requested Domain
This information element details the access domains for which certain data
(e.g. user state, location information) are requested. See 3GPP TS 29.329 [5]
for the list of possible values.
## 7.3 Requested Data
\- Reference to the data that an AS is requesting from the HSS.
\- Reference to the data which, an AS wants to be notified of, when changed.
\- Reference to data for which subscription to notification of change is
rejected.
See section 7.6.
## 7.4 Service Indication
Identifier of one set of service related transparent data, which is stored in
an HSS in an operator network per Public Identity. The HSS shall allocate
memory space to implement a data repository to store transparent data per IMS
Public User Identity or Public Service Identity and value of Service
Indication with a Sequence Number for verification. For Public Service
Identities matching a Wildcarded Public Service Identity, the repository data
shall be stored per Wildcarded Public Service Identity and not for each
specific Public Service Identity.
## 7.5 Result
This information element contains the result code of the operation. See 3GPP
TS 29.329 [5] for the list of possible values.
## 7.6 Data
This information element contains an XML document conformant to the XML schema
defined in Annex D.
Annex C specifies the UML logical model of the data downloaded via the Sh
interface.
Table 7.6.1 defines the data reference values and tags, access key and
recommended AS permissions (as described in section 6.2) for the the
operation(s) on data accessible via the Sh interface, i.e. the listed
operation(s) in the Operations column are the only ones allowed to be used
with this Data Ref value. It is a matter of operator policy to further
restrict the AS permission rights defined in table 7.6.1.
Table 7.6.1: Data accessible via Sh interface
+-------------+-------------+------------+-------------+-------------+ | Data Ref. | XML tag | Defined in | Access key | Operations | +-------------+-------------+------------+-------------+-------------+ | 0 | Rep | 7.6.1 | IMS Public | Sh-Pull, | | | ositoryData | | User | Sh-Update, | | | | | Identity or | Sh | | | | | Public | -Subs-Notif | | | | | Service | (Note 1, | | | | | Identity + | Note 3) | | | | | Dat | | | | | | a-Reference | | | | | | + | | | | | | Service | | | | | | -Indication | | +-------------+-------------+------------+-------------+-------------+ | 10 | IMSPub | 7.6.2 | IMS Public | Sh-Pull, | | | licIdentity | | User | Sh | | | | | Identity + | -Subs-Notif | | | | | Dat | | | | | | a-Reference | | | | | | + | | | | | | I | | | | | | dentity-Set | | +-------------+-------------+------------+-------------+-------------+ | 10 | IMSPub | 7.6.2 | IMS Public | Sh-Pull, | | | licIdentity | | Service | Sh | | | | | Identity + | -Subs-Notif | | | | | Dat | | | | | | a-Reference | | | | | | + | | | | | | I | | | | | | dentity-Set | | | | | | (all values | | | | | | other than | | | | | | ALIAS_ | | | | | | IDENTITIES) | | +-------------+-------------+------------+-------------+-------------+ | 10 | IMSPub | 7.6.2 | MSISDN + | Sh-Pull, | | | licIdentity | | Dat | Sh | | | | | a-Reference | -Subs-Notif | | | | | + | | | | | | I | | | | | | dentity-Set | | | | | | (all values | | | | | | other than | | | | | | IMPLICIT | | | | | | IDENTITIES | | | | | | or | | | | | | ALIAS_ | | | | | | IDENTITIES) | | +-------------+-------------+------------+-------------+-------------+ | 11 | I | 7.6.3 | IMS Public | Sh-Pull, | | | MSUserState | | User | Sh | | | | | Identity + | -Subs-Notif | | | | | Dat | | | | | | a-Reference | | +-------------+-------------+------------+-------------+-------------+ | 12 | S-CSCFName | 7.6.4 | IMS Public | Sh-Pull, | | | | | User | Sh | | | | | Identity or | -Subs-Notif | | | | | Public | (Note 1) | | | | | Service | | | | | | Identity + | | | | | | Dat | | | | | | a-Reference | | +-------------+-------------+------------+-------------+-------------+ | 13 | InitialFil | 7.6.5 | IMS Public | Sh-Pull, | | | terCriteria | | User | Sh | | | | | Identity or | -Subs-Notif | | | | | Public | (Note 1) | | | | | Service | | | | | | Identity + | | | | | | Dat | | | | | | a-Reference | | | | | | + | | | | | | Server-Name | | +-------------+-------------+------------+-------------+-------------+ | 14 | Location | 7.6.6 | MSISDN + | Sh-Pull | | | Information | | Data | | | | | | -Reference+ | | | | | | Reque | | | | | | sted-Domain | | | | | | + | | | | | | Curr | | | | | | entLocation | | +-------------+-------------+------------+-------------+-------------+ | 15 | UserState | 7.6.7 | MSISDN + | | | | | | Data | | | | | | -Reference+ | | | | | | Reque | | | | | | sted-Domain | | +-------------+-------------+------------+-------------+-------------+ | 16 | Charging | 7.6.8 | IMS Public | Sh-Pull, | | | information | | User | Sh | | | | | Identity or | -Subs-Notif | | | | | Public | | | | | | Service | | | | | | Identity or | | | | | | MSISDN + | | | | | | Dat | | | | | | a-Reference | | +-------------+-------------+------------+-------------+-------------+ | 17 | MSISDN | 7.6.9 | IMS Public | Sh-Pull | | | | | User | (Note 4) | | | | | Identity or | | | | | | MSISDN + | | | | | | Dat | | | | | | a-Reference | | +-------------+-------------+------------+-------------+-------------+ | 17 | MSISDN | | IMS Public | | | | | | User | | | | | | Identity + | | | | | | Private | | | | | | Identity + | | | | | | Dat | | | | | | a-Reference | | +-------------+-------------+------------+-------------+-------------+ | 18 | PS | 7.6.10 | Specific | Sh-Pull, | | | IActivation | | Public | Sh | | | | | Service | -Subs-Notif | | | | | Identity | (Note 1) | | | | | matching a | | | | | | Wildcarded | | | | | | Public | | | | | | Service | | | | | | Identity or | | | | | | Wildcarded | | | | | | Public | | | | | | Service | | | | | | Identity + | | | | | | Dat | | | | | | a-Reference | | +-------------+-------------+------------+-------------+-------------+ | 18 | PS | 7.6.10 | Distinct | Sh-Pull, | | | IActivation | | Public | Sh-Update, | | | | | Service | Sh | | | | | Identity + | -Subs-Notif | | | | | Dat | | | | | | a-Reference | | +-------------+-------------+------------+-------------+-------------+ | 19 | DSAI | 7.6.11 | Public User | Sh-Pull, | | | | | Identity or | Sh-Update, | | | | | Public | Sh | | | | | Service | -Subs-Notif | | | | | Identity + | (Note 1) | | | | | Dat | | | | | | a-Reference | | | | | | + DSAI-Tag | | | | | | + | | | | | | Server-Name | | +-------------+-------------+------------+-------------+-------------+ | 20 | Reserved | | | | +-------------+-------------+------------+-------------+-------------+ | 21 (Note 5) | ServiceLev | 7.6.13 | IMS Public | Sh-Pull, | | | elTraceInfo | | User | Sh | | | | | Identity or | -Subs-Notif | | | | | MSISDN + | | | | | | Data | | | | | | Reference | | +-------------+-------------+------------+-------------+-------------+ | 22 | IP Address | 7.6.14 | IMS Public | Sh-Pull, | | | Secure | | User | Sh | | | Binding | | Identity+ | -Subs-Notif | | | Information | | Data | | | | | | Reference | | +-------------+-------------+------------+-------------+-------------+ | 23 | Service | 7.6.15 | IMS Public | Sh-Pull, | | | Priority | | User | Sh | | | Level | | Identity + | -Subs-Notif | | | | | Data | | | | | | Reference | | +-------------+-------------+------------+-------------+-------------+ | 24 | SMSRegis | 7.6.16 | IMS Public | Sh-Pull, | | | trationInfo | | User | Sh-Update | | | | | Identity or | | | | | | MSISDN + | | | | | | Data | | | | | | Reference | | +-------------+-------------+------------+-------------+-------------+ | 25 | UE | 7.6.17 | IMS Public | Sh | | | r | | User | -Subs-Notif | | | eachability | | Identity or | | | | for IP | | MSISDN + | | | | | | Data | | | | | | Reference | | +-------------+-------------+------------+-------------+-------------+ | N 1: If an | | | | | | AS | | | | | | subscribes | | | | | | to a | | | | | | Specific | | | | | | PSI | | | | | | matching a | | | | | | Wildcarded | | | | | | PSI, the | | | | | | n | | | | | | otification | | | | | | shall be | | | | | | sent as if | | | | | | the | | | | | | s | | | | | | ubscription | | | | | | was made to | | | | | | the | | | | | | co | | | | | | rresponding | | | | | | Wildcarded | | | | | | PSI. | | | | | | | | | | | | Note 2: If | | | | | | not | | | | | | specified | | | | | | otherwise | | | | | | Public User | | | | | | Identity | | | | | | and Public | | | | | | Service | | | | | | Identity | | | | | | refer also | | | | | | to the | | | | | | wildcarded | | | | | | identities. | | | | | | | | | | | | Note 3: Any | | | | | | IMS Public | | | | | | User | | | | | | Identity in | | | | | | an alias | | | | | | group may | | | | | | be used as | | | | | | a key for | | | | | | the | | | | | | repository | | | | | | data of the | | | | | | group. All | | | | | | IMS Public | | | | | | User | | | | | | Identities | | | | | | within the | | | | | | same group | | | | | | shall be | | | | | | considered | | | | | | alias of | | | | | | each other | | | | | | and shall | | | | | | share the | | | | | | same | | | | | | transparent | | | | | | data. See | | | | | | 3GPP TS | | | | | | 23.228 | | | | | | [8] for | | | | | | the | | | | | | definition | | | | | | of an alias | | | | | | group. | | | | | | | | | | | | Note 4: If | | | | | | several | | | | | | MSISDNs are | | | | | | associated | | | | | | to the | | | | | | Public | | | | | | identity, | | | | | | an AS shall | | | | | | be required | | | | | | to indicate | | | | | | the IMS | | | | | | Private | | | | | | User | | | | | | Identity to | | | | | | fetch the | | | | | | C-MSISDN. | | | | | | See 3GPP TS | | | | | | 23.003 | | | | | | [11] and | | | | | | 3GPP TS | | | | | | 23.237 | | | | | | [32] for | | | | | | the | | | | | | definition | | | | | | of | | | | | | C-MSISDN. | | | | | | | | | | | | Note 5: The | | | | | | data | | | | | | reference | | | | | | 21 shall | | | | | | not be used | | | | | | in this | | | | | | release of | | | | | | the | | | | | | spe | | | | | | cification. | | | | | +-------------+-------------+------------+-------------+-------------+
### 7.6.1 Repository Data
This information element contains transparent data. A data repository may be
shared by more than one AS implementing the same service.
### 7.6.2 IMSPublicIdentity
This information element contains an IMS Public User Identity or a Public
Service Identity. If a wildcarded PSI that is stored in the HSS matches the
Public Service Identity received, the HSS shall return the wildcarded PSI in
addition to the Public Service Identity that was received in the request. If a
Wildcarded Public User Identity that is stored in the HSS matches the Public
User Identity received, the HSS shall return the Wildcarded Public User
Identity in addition to the Public User Identity that was received in the
request.
An IMS Public Identity would be either:
  * associated with the same Private User Identity or Private Service Identity as the User Identity included in the request or
  * associated with the MSISDN present in the request.
Multiple instances of this information element may be included in the message.
### 7.6.3 IMS User State
This information element contains the IMS User State of the public identifier
referenced. Its possible values are:
\- REGISTERED,
\- NOT_REGISTERED,
\- AUTHENTICATION_PENDING,
\- REGISTERED_UNREG_SERVICES.
If the IMS Public User Identity is shared between multiple Private User
Identities, HSS shall indicate the most registered state of the shared IMS
Public User Identity to an AS. The most registered state of a shared IMS
Public User Identity is defined as follows:
\- If the shared IMS Public User Identity is registered with any of the
Private User Identities, the most registered state of the shared IMS Public
User Identity is REGISTERED.
\- If the shared IMS Public User Identity is not currently registered with any
of the Private User Identities, but it is in state REGISTERED_UNREG_SERVICES,
then the most registered state of the shared IMS Public User Identity is
REGISTERED_UNREG_SERVICES.
\- If the shared IMS Public User Identity is not currently registered with any
of the Private User Identities, and it is not in state
REGISTERED_UNREG_SERVICES, but it is in the process of being authenticated
with any of the Private User Identities, then the most registered state of the
shared IMS Public User Identity is AUTHENTICATION_PENDING.
\- If the shared IMS Public User Identity is not currently registered with any
of the Private User Identities, and it is not in state
REGISTERED_UNREG_SERVICES, and it is not in the process of being authenticated
with any of the Private User Identities, then the most registered state of the
shared IMS Public User Identity is NOT_REGISTERED.
### 7.6.4 S-CSCF Name
This information element contains the name of the S‑CSCF assigned to the IMS
Subscription.
### 7.6.5 Initial Filter Criteria
This information element contains the triggering information for a service.
For a more detailed description, refer to 3GPP TS 23.218 [4] and 3GPP TS
29.228 [6].
### 7.6.6 Location Information
This information element contains the location of the served subscriber in the
MSC/VLR if the requested domain is CS, or the location of the served
subscriber in the SGSN if the requested domain is PS. If the HSS has to
communicate with the MSC/VLR and/or SGSN to retrieve location information, it
shall make use of the service MAP-PROVIDE-SUBSCRIBER-INFO.
For both Location Information for CS and Location Information for GPRS, the
considerations described in 3GPP TS 23.078 [14] apply.
#### 7.6.6.1 Location information for CS
This information element consists of the following subordinate information
elements:
\- Location number: defined in ITU-T Recommendation Q.763 [9]. Considerations
described in 3GPP TS 23.018 apply [10].
\- Service area ID: defined in 3GPP TS 23.003 [11].
\- Global Cell ID: defined in 3GPP TS 23.003 [11].
\- Location area ID: defined in 3GPP TS 23.003 [11].
\- Geographical Information: defined in 3GPP TS 23.032 [12]. Considerations
described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.
\- Geodetic Information: defined in ITU-T Recommendation Q.763 [9].
Considerations described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.
\- VLR Number: defined in 3GPP TS 23.003 [11].
\- MSC Number: defined in 3GPP TS 23.003 [11].
\- Age of location information: defined in 3GPP TS 23.018 [10].
\- Current Location Retrieved: shall be present when location information was
obtained after a successful paging procedure for Active Location Retrieval.
> \- User CSG information: contains the CSG ID associated with the CSG cell
> where the UE is located. See 3GPP TS 23.003 [11].
#### 7.6.6.2 Location information for GPRS
This information element consists of the following subordinate information
elements:
\- Service area ID: defined in 3GPP TS 23.003 [11].
\- Global Cell ID: defined in 3GPP TS 23.003 [11].
\- Location area ID: defined in 3GPP TS 23.003 [11].
\- Geographical Information: defined in 3GPP TS 23.032 [12]. Considerations
described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.
\- Geodetic Information: defined in ITU-T Recommendation Q.763 [9].
Considerations described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.
\- SGSN Number: defined in 3GPP TS 23.003 [11].
\- Routing Area ID: defined in 3GPP TS 23.003 [11].
\- Current Location Retrieved: shall be present when location information was
obtained after a successful paging procedure for Active Location Retrieval.
> \- User CSG information: contains the CSG ID associated with the CSG cell
> where the UE is located. See 3GPP TS 23.003 [11].
### 7.6.7 User state
This information element indicates the state of the User Identity in the
domain indicated by the Requested-Domain (see 7.2), with the values specified
in 3GPP TS 23.078 [14] for Subscriber State and PS Domain Subscriber State.
The HSS shall make use of the operation MAP-PROVIDE-SUBSCRIBER-INFO towards
the MSC/VLR and/or the SGSN to obtain this information.
### 7.6.8 Charging information
This information element contains the addresses of the charging functions:
primary Online Charging Function (PrimaryEventChargingFunctionName), secondary
Online Charging Function (SecondaryEventChargingFunctionName), primary
Charging Data Function (PrimaryChargingCollectionFunctionName), and secondary
Charging Data Function (SecondaryChargingCollectionFunctionName). When a
**clash occurs between the charging function address(es) received over the ISC
interface and those received over the Sh interface, the address(es) received
over the ISC interface should take precedence.**
NOTE: The use of the Sh interface to retrieve charging function addresses is
not intended as a general-purpose alternative to receiving charging function
addresses from the ISC interfaces. Rather, it is meant to address a special
case where the AS needs to interact with the charging system before initiating
a request to a user when the AS has not received the third party REGISTER for
that user.
The AS shall extract the FQDN of the DiameterURI in these information elements
and may use it as content of the Destination-Host AVP for the Diameter
accounting requests. The parent domain of the FQDN in the DiameterURI shall be
used as Destination-Realm. The number of labels used for the Destination-Realm
shall be determined before the Charging Information is provisioned and may be
a configuration option.
NOTE: A FQDN is an absolute domain name including a subdomain and its parent
domain. The subdomain and the parent domain contain one or more labels
separated by dots.
### 7.6.9 MSISDN
This information element contains a Basic MSISDN (see 3GPP TS 23.012 [19])
that is associated with the User Identity present in the request. All valid
instances of this information element shall be included in the message.
### 7.6.10 PSIActivation
This information element contains the activation state of the Public Service
Identity present in the request. Its possible values are:
\- ACTIVE,
\- INACTIVE.
### 7.6.11 DSAI
When a service is provisioned but not active, an Application Server is
typically involved through the ISC interface in sessions where the Application
Server is not supposed to perform any task but to proxy incoming transactions.
In order to avoid this disoptimization, a mechanism is provided for the
Application Server to signal the HSS that a set of initial filter criteria
should be "masked" for a specific Public User Identity or Public Service
Identity. This is, from the Application Server's perspective, just an
indication, and an Application Server must be prepared to be involved in
sessions even if the trigger that caused its involvement has been masked by
that Application Server.
This information element contains the activation state of a Service
(identified by its DSAI-tag, see section 7.14, for a specific user identified
by a Public User Identity or of a Service identified by its PSI). Its possible
values are:
\- ACTIVE,
\- INACTIVE.
In the HSS the DSAI can also be associated to a wildcarded PSI. In that case,
there is a set of identities matching a specific wildcarded PSI and all the
identities in the set share the same DSAIs. Any change in these DSAIs masked
from a single identity of the set will apply to all the identities associated
to that wildcarded PSI.
Each DSAI is implicitly bound to a list of (at least one) initial filter
criteria. The binding is not exclusive, i.e. one instance of initial filter
criteria may be bound to zero or more DSAIs, however all the iFCs bound to a
given DSAI should trigger to the same AS (i.e. they should share the same
ServerName), which is the only one allowed to update it.
An instance of initial filter criteria shall be included into the Service-
Profile sent through the Cx Interface according to the operations described in
3GPP TS 29.228 [6] if at least one of the following conditions applies:
\- No DSAI is bound to those initial filter criteria;
\- At least one of the DSAIs bound to those initial filter criteria is set to
ACTIVE.
### 7.6.12 Void
### 7.6.13 Void
### 7.6.14 IP address secure binding information
This information element contains the IP address (or the prefix in the case of
IPv6 stateless autoconfiguration) at any given time.See 3GPP TS 33.203 [22],
Annex T.
### 7.6.15 Service Priority Level
This information element the Priority Level allowed for the Public Identity
for Priority Service. If the ServicePriority Level is present, priority
services are allowed for the Public Identity. See IETF RFC 4412 [25].
### 7.6.16 SMSRegistrationInfo
This information element contains an IP-SM-GW number. For the definition of an
IP-SM-GW number, see 3GPP TS 23.008 [27].
### 7.6.17 UE reachability for IP
This information element reflects the change of URRP-MME parameter and
indicates whether the UE has become reachable, i.e. when the URRP-MME
parameter was set and has been cleared due to UE activity notification from
the MME, see 3GPP TS 29.272 [26]. It consists of the following subordinate
information elements:
\- UE-IP-REACHABILITY-MME. Its possible values are:
\- REACHABLE (0)
## 7.6.18 Private Identity
This information element contains the IMS Private User Identity. See 3GPP TS
23.003 [11].
## 7.7 Subscription request type
This information element indicates the action requested for subscription to
notifications. See 3GPP TS 29.329 [5] for the list of valid values.
## 7.8 Current Location
This information element indicates whether an active location retrieval has to
be initiated or not when an AS requested location information. See 3GPP TS
29.329 [5] for the list of possible values.
## 7.9 Application Server Identity
This information element contains the identity of the Application Server. It
is used for the AS permission check (see 6.2).
## 7.10 Application Server Name
This information element indicates application server's SIP URI. See 3GPP TS
29.229 [7] for the detailed definition of the AVP.
## 7.11 Requested Identity Set
This information element indicates the set of IMS Public Identities that the
AS wishes to download. See 3GPP TS 29.329 [5] for the detailed definition of
the AVP.
## 7.12 Expiry Time
This information element indicates the expiry time of the subscription to
notifications in the HSS. See 3GPP TS 29.329 [5] for the detailed definition
of this AVP.
## 7.13 Send Data Indication
This information element indicates the request that the User Data is sent in
the response. See 3GPP TS 29.329 [5] for the detailed definition of this AVP.
## 7.14 DSAI Tag
An instance of Dynamic Service Activation Info is uniquely identified by the
Public User/Service Identity and a DSAI tag. The same DSAI tag may be used for
all the user profiles when indicating the same type of information, but not
all the user profiles may contain the same set of tags.
Application Servers shall signal that they are not interested in being
involved in new sessions by manipulating Dynamic Service Activation Info
(DSAI) inside of dynamic service information data, see section 7.6.11.
## 7.15 Session-Priority
This information element indicates the session\'s priority level to the HSS.
See 3GPP TS 29.229 [7].
# 8 Protocol version identification
See 3GPP TS 29.329 [5].
# 9 Operational Aspects
See 3GPP TS 29.329 [5].
###### ## Annex A (normative): Mapping of Sh operations and terminology to
Diameter
# A.1 Introduction
This appendix gives mappings from Sh to Diameter protocol elements. Diameter
protocol elements are defined in 3GPP TS 29.329 [5].
# A.2 Sh message to Diameter command mapping
The following table defines the mapping between stage 2 operations and
Diameter commands:
Table A.2.1: Sh message to Diameter command mapping
* * *
Sh message Source Destination Command-Name Abbreviation Sh-Pull AS HSS User-
Data-Request UDR Sh-Pull Resp HSS AS User-Data-Answer UDA Sh-Update AS HSS
Profile-Update-Request PUR Sh-Update Resp HSS AS Profile-Update-Answer PUA Sh-
Subs-Notif AS HSS Subscribe-Notifications-Request SNR Sh-Subs-Notif Resp HSS
AS Subscribe-Notifications-Answer SNA Sh-Notif HSS AS Push-Notification-
Request PNR Sh-Notif Resp AS HSS Push-Notification-Answer PNA
* * *
# A.3 Void
###### ## Annex B (informative): Message flow
# B.1 Message flows
The following message flows give examples regarding which Diameter messages
shall be sent in scenarios described in 3GPP TS 23.218 [4].
## B.1.1 Data Update, Registration, Notification Subscription.
Figure B.1.1: Data Update, Registration, Notification Subscription
1\. A user subscribes to a new service. The operator provisions the service in
an AS. The AS stores some service data for a user in the HSS, Sh-Update (user
identity, updated data) e.g. repository data.
2\. HSS confirms the data is updated
3\. Some time later, user registers with the network
4\. S-CSCF downloads the data from the HSS (during the procedure S-CSCF
Registration Notification on Cx interface). Filter criteria specify that the
AS wants to be notified that the end user is registered.
5\. 200 OK
6\. S-CSCF sends third party registration message to the application server to
notify that user is registered.
7\. 200 OK
8\. The AS subscribes to notifications and downloads data needed for providing
service from HSS, by means of Sh-Subs-Notif (user identity, requested data,
service information and send data indication).
9\. HSS confirms the subscription request and sends data to AS
10\. At some moment, the AS decides to update user's service data e.g.
repository data in the HSS, by means of Sh-Update (user identity, updated
data).
11\. The HSS confirms the service data is updated.
12\. At some moment, user data is updated in the HSS. As the AS subscribed to
notifications (step 8), the HSS sends to the AS the requested updates, by
means of Sh-Notif (user identity, updated data).
13\. The AS acknowledges the notification.
###### ## Annex C (informative): UML model of the data downloaded over Sh
interface
The purpose of this UML model is to define in an abstract level the structure
of the data downloaded over the Sh interface and describe the purpose of the
different information classes included in it.
# C.1 General description
The following picture gives an outline of the UML model of the user profile,
which is exchanged between the HSS and an AS:
Figure C.1.1: Sh-Data
Each instance of the Sh-Data class contains 0 or 1 instance of the class
PublicIdentifiers, 0 or n instances of the class RepositoryData, 0 or 1
instance of the class Sh-IMS-Data, 0 or 1 instance of the class CSUserState, 0
or 1 instance of the class PSUserState 0 or 1 instance of the class
CSLocationInformation and 0 or 1 instance of the class PSLocationInformation,
0 or 1 instance of the class RegisteredIdentities, 0 or 1 instance of the
class ImplicitIdentities, 0 or 1 instance of the class AllIdentities, 0 or 1
instance of the class AliasIdentities, and 0 or 1 instance of the class
DeletedIdentities.
If AS and HSS both support the Notif-Eff feature and AS requires more than one
identity sets of a public identity, or it has subscribed to be notifed of
changes to IMSPublicIdentity (see table 7.6.1), the class PublicIdentifiers
shall not be used. Instead the classes RegisteredIdentities,
ImplicitIdentities, AllIdentities and AliasIdentities shall be used and they
contain the REGISTERED_IDENTITIES, IMPLICIT_IDENTITIES, ALL_IDENTITIES and
ALIAS_IDENTITIES associated with the IMS Public Identity included in the
request respectively, See Table 6.1.1.1 for the detailed information. The
class PublicIdentifiers or the one among the four which may be used to contain
the correspongding identity set can both be used when AS requires only one
identity set of a public identity.
If AS or HSS do not support the Notif-Eff feature, the classes
RegisteredIdentities, ImplicitIdentities and AllIdentities shall not be used.
Instead the class PublicIdentifiers shall be used.
If Public Identity(ies) are deleted and the AS hassubscribed to be notified of
changes to IMSPublicIdentity(see table 7.6.1), the class DeletedIdentities
shall not be used.If Public Identity(ies) are deleted and the AS has not
subscribed to be notified of changes to IMSPublicIdentity but has any other
subscription active for the deleted identity(ies), the HSS shall notify the AS
of the deletion of the identity(ies) using the class DeletedIdentities.
Class RepositoryData contains repository data (transparent data) for a given
service that are associated to a Public user Identity or a group of alias
Public User Identities. It has attributes ServiceIndication, SequenceNumber
and ServiceData.
Class CSUserState contains the state of a user in the CS domain. Its only
attribute, State, is an enumeration whose possible values are defined in
section 7.6.7.
Class PSUserState contains the state of a user in the PS domain. Its only
attribute, State, is an enumeration whose possible values are defined in
section 7.6.7.
NOTE: the fact that attribute State is an enumeration is a difference from
what can be carried in the MAP protocol.
Class CSLocationInformation has the attributes Location Number, Service Area
ID, GlobalCellId, LocationAreaId, GeographicalInformation,
GeodeticInformation, VLR Number, MSC Number, AgeOfLocationInformation and
CurrentLocationRetrieved and UserCSGInformation. They are defined in 7.6.
Class PSLocationInformation has the attributes ServiceAreaId, GlobalCellId,
LocationAreaID, RoutingAreaID, GeographicalInformation, GeodeticInformation,
SGSN Number, AgeOfLocationInformation and CurrentLocationRetrieved and
UserCSGInformation. They are defined in 7.6.
Class DeletedIdentities contains Public Identities (IMS Public User Identities
or Public Service Identities) removed from the HSS.
Class UEreachabilityForIP contains the UE reachability for IP. Its only
attribute, UE-IP-Reachable-MME, is an enumeration whose possible values are
defined in section 7.6.17.
# C.2 PublicIdentifiers
The following picture details the UML model of the class PublicIdentifiers:
Figure C.2.1: The UML model of the class PublicIdentifiers
Class PublicIdentifiers contains 0 or more public user identities which may be
either of class IMSPublicIdentity or of class MSISDN. The identifiers are of
format SIP URL, tel URI or MSISDN. Instances of class IMSPublicIdentity shall
contain a Public User Identity, a distinct PSI or an identity matching a
Wildcarded PSI or a Wildcarded Public User Identity in the HSS. They shall
contain the Identity Type and the wildcarded identity if the Identity in the
request matches a wildcarded identity in the HSS.
# C.3 Sh-IMS-Data
The following picture details the UML model of the class Sh-IMS-Data.
Figure C.3.1: Sh-IMS-Data
Each instance of the class Sh-IMS-Data contains 0 or 1 instance of the class
S-CSCFName, 0 to 1 instance of the class IFCs, 0 or 1 instance of the class
IMSUserState, 0 or 1 instance of the class ChargingInformation, 0 or 1
instance of the class PSIActivation, 0 or 1 instance of the class DSAI or 1
instance of the class IPAddressSecureBindingInformation.
Class S-CSCFName contains a SIP URI. See section 7.6.4 for further details.
Class IFCs contains 0 to n instances of the initial filter criteria of the
multimedia public identity that the AS included in the request. The initial
filter criteria is defined in 3GPP TS 29.228 [6].
Class IMSUserState contains the registration state of the identity given by
the attribute of class Sh-IMS-Data. See section 7.6 for possible values.
Class Charging Information contains the online and offline charging function
addresses. See section 7.6 for possible values.
Class PSIActivation contains the activation state of the Public Service
Identity given by the attribute of class Sh-IMS-Data. See section 7.6 for
possible values.
Class DSAI contains the DSAI Tag and a DSAI Value (reflecting the activation
state) for services the user is subscribed to. See section 7.14 for contents
and usage.
Class IPAddressSecureBindingInformation contains either 0 or one IPv4 address,
either 0 or one IPv6 prefix and/or IPv6 interface identifier. See section
7.6.14 for contents and usage.
Class ServicePriorityLevel contains the Service Priority Level allowed for the
Public Identity to be used for priority services. See section 7.6.15 for
contents and usage.
Class SMSRegistrationInfo contains the IP-SM-GW-Number. See section 7.6. for
further details.
###### ## Annex D (normative): XML schema for the Sh interface user profile
The file ShDataType_Rel8.xsd, attached to this specification, contains the XML
schema for the user profile that is sent over the Sh interface. The user
profile XML schema defines the data types that are used in the user profile
XML.\ The data that is allowed to be sent in the user profile may vary
depending on the features supported by the Diameter end points, see 3GPP TS
29.329 [5]. The user profile XML schema file is intended to be used by an XML
parser.\ The version of the Sh application sending the user profile XML shall
be the same as the version of the sent user profile XML and thus it implies
the version of the user profile XML schema to be used to validate it.
Tables D.1 and D.2 describe the data types and the dependencies among them
that configure the user profile XML schema.
Table D.1: XML schema for the Sh user profile interface: simple data types
+-----------------+-----------------+------------+-----------------+ | Data type | Tag | Base type | Comments | +-----------------+-----------------+------------+-----------------+ | tPriority | Priority | integer | >= 0 | +-----------------+-----------------+------------+-----------------+ | tProfi | Profi | enumerated | Possible | | lePartIndicator | lePartIndicator | | values: | | | | | | | | | | 0 (REGISTERED) | | | | | | | | | | 1 | | | | | (UNREGISTERED) | +-----------------+-----------------+------------+-----------------+ | tGroupID | Group | integer | >= 0 | +-----------------+-----------------+------------+-----------------+ | tR | R | enumerated | Possible | | egistrationType | egistrationType | | values: | | | | | | | | | | 0 | | | | | (**INITIAL_ | | | | | REGISTRATION**) | | | | | | | | | | 1 | | | | | (R | | | | | E-REGISTRATION) | | | | | | | | | | 2 | | | | | (D | | | | | E-REGISTRATION) | +-----------------+-----------------+------------+-----------------+ | t | DefaultHandling | enumerated | Possible | | DefaultHandling | | | values: | | | | | | | | | | 0 | | | | | (SESS | | | | | ION_CONTINUED) | | | | | | | | | | 1 | | | | | (SESSI | | | | | ON_TERMINATED) | +-----------------+-----------------+------------+-----------------+ | tDir | SessionCase | enumerated | Possible | | ectionOfRequest | | | values: | | | | | | | | | | 0 | | | | | (ORIGIN | | | | | ATING_SESSION) | | | | | | | | | | 1 | | | | | TERMI | | | | | NATING_SESSION | | | | | | | | | | 2 | | | | | (TERMINATING | | | | | _UNREGISTERED) | | | | | | | | | | 3 | | | | | (ORIGINATING | | | | | _UNREGISTERED) | | | | | | | | | | 4 | | | | | (ORI | | | | | GINATING_CDIV) | +-----------------+-----------------+------------+-----------------+ | tIMSUserState | IMSUserState | Enumerated | Possible | | | | | values: | | | | | | | | | | 0 | | | | | (N | | | | | OT_REGISTERED) | | | | | | | | | | 1 (REGISTERED) | | | | | | | | | | 2 | | | | | (REGISTERED_U | | | | | NREG_SERVICES) | | | | | | | | | | 3 | | | | | (AUTHENTIC | | | | | ATION_PENDING) | +-----------------+-----------------+------------+-----------------+ | tCSUserState | CSUserState | Enumerated | Possible values | | | | | (as defined in | | | | | 3GPP TS 23.078 | | | | | [14]): | | | | | | | | | | 0 (CAMELBusy) | | | | | | | | | | 1 | | | | | ( | | | | | NetworkDetermin | | | | | edNotReachable) | | | | | | | | | | 2 (AssumedIdle) | | | | | | | | | | 3 | | | | | (NotP | | | | | rovidedfromVLR) | +-----------------+-----------------+------------+-----------------+ | tPSUserState | PSUserState | Enumerated | Possible values | | | | | (as defined in | | | | | 3GPP TS 23.078 | | | | | [14]): | | | | | | | | | | 0 (Detached) | | | | | | | | | | 1 | | | | | ( | | | | | AttachedNotReac | | | | | hableForPaging) | | | | | | | | | | 2 | | | | | (AttachedReac | | | | | hableForPaging) | | | | | | | | | | 3 | | | | | (C | | | | | onnectedNotReac | | | | | hableForPaging) | | | | | | | | | | 4 | | | | | (ConnectedReac | | | | | hableForPaging) | | | | | | | | | | 5 | | | | | (NotPr | | | | | ovidedFromSGSN) | | | | | | | | | | 6 | | | | | ( | | | | | NetworkDetermin | | | | | edNotReachable) | +-----------------+-----------------+------------+-----------------+ | tLocationNumber | LocationNumber | string | Syntax | | | | | described in | | | | | ITU-T Q.763 | | | | | [9] (Base64 | | | | | encoded | | | | | according to | | | | | IETF RFC 2045 | | | | | [15]). | | | | | | | | | | Length >=4 and | | | | | \=0, \= 4 | | | | | and \=0, \ Choice | Cell | tCell | 0 to 1 | | | | > of | GlobalId | GlobalId | | +----------+----------+----------+----------+----------+--------+ | | | | Servi | tServi | 0 to 1 | | | | | ceAreaId | ceAreaId | | +----------+----------+----------+----------+----------+--------+ | | | | Locati | tLocati | 0 to 1 | | | | | onAreaId | onAreaId | | +----------+----------+----------+----------+----------+--------+ | | | Geograp | tGeograp | 0 to 1 | | | | | hicalInf | hicalInf | | | | | | ormation | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | Geo | tGeo | 0 to 1 | | | | | deticInf | deticInf | | | | | | ormation | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | V | tISD | 0 to 1 | | | | | LRNumber | NAddress | | | +----------+----------+----------+----------+----------+--------+ | | | M | tISD | 0 to 1 | | | | | SCNumber | NAddress | | | +----------+----------+----------+----------+----------+--------+ | | | CurrentL | tBool | 0 to 1 | | | | | ocationR | | | | | | | etrieved | | | | +----------+----------+----------+----------+----------+--------+ | | | AgeOfLoc | t | 0 to 1 | | | | | ationInf | AgeOfLoc | | | | | | ormation | ationInf | | | | | | | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | E | tCSLocat | 0 to 1 | | | | | xtension | ionInfor | | | | | | | mation-E | | | | | | | xtension | | | +----------+----------+----------+----------+----------+--------+ | tCSLocat | CSLocat | Us | tUs | 0 to 1 | | | ionInfor | ionInfor | erCSGInf | erCSGInf | | | | mation-E | mation-E | ormation | ormation | | | | xtension | xtension | | | | | +----------+----------+----------+----------+----------+--------+ | tPSLoc | PSLoc | > Choice | Cell | tCell | 0 to 1 | | ationInf | ationInf | > of | GlobalId | GlobalId | | | ormation | ormation | | | | | +----------+----------+----------+----------+----------+--------+ | | | | Servi | tServi | 0 to 1 | | | | | ceAreaId | ceAreaId | | +----------+----------+----------+----------+----------+--------+ | | | | Locati | tLocati | 0 to 1 | | | | | onAreaId | onAreaId | | +----------+----------+----------+----------+----------+--------+ | | | Routi | tRouti | 0 to 1 | | | | | ngAreaId | ngAreaId | | | +----------+----------+----------+----------+----------+--------+ | | | Geograp | tGeograp | 0 to 1 | | | | | hicalInf | hicalInf | | | | | | ormation | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | Geo | tGeo | 0 to 1 | | | | | deticInf | deticInf | | | | | | ormation | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | SG | tISD | 0 to 1 | | | | | SNNumber | NAddress | | | +----------+----------+----------+----------+----------+--------+ | | | CurrentL | tBool | 0 to 1 | | | | | ocationR | | | | | | | etrieved | | | | +----------+----------+----------+----------+----------+--------+ | | | AgeOfLoc | t | 0 to 1 | | | | | ationInf | AgeOfLoc | | | | | | ormation | ationInf | | | | | | | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | E | tPSLocat | 0 to 1 | | | | | xtension | ionInfor | | | | | | | mation-E | | | | | | | xtension | | | +----------+----------+----------+----------+----------+--------+ | tPSLocat | PSLocat | Us | tUs | 0 to 1 | | | ionInfor | ionInfor | erCSGInf | erCSGInf | | | | mation-E | mation-E | ormation | ormation | | | | xtension | xtension | | | | | +----------+----------+----------+----------+----------+--------+ | tUs | Us | CSGId | tCSGId | 1 | | | erCSGInf | erCSGInf | | | | | | ormation | ormation | | | | | +----------+----------+----------+----------+----------+--------+ | tISD | ISD | Addre | tAddre | 0 to 9 | | | NAddress | NAddress | ssString | ssString | | | +----------+----------+----------+----------+----------+--------+ | tPublic | P | I | tI | 0 to n | | | Identity | ublicIde | MSPublic | MSPublic | | | | | ntifiers | Identity | Identity | | | +----------+----------+----------+----------+----------+--------+ | | | MSISDN | tMSISDN | 0 to n | | +----------+----------+----------+----------+----------+--------+ | | | E | tPublicI | (0 to 1) | | | | | xtension | dentityE | | | | | | | xtension | | | +----------+----------+----------+----------+----------+--------+ | tPublicI | E | Iden | tIden | (0 to 1) | | | dentityE | xtension | tityType | tityType | | | | xtension | | | | | | +----------+----------+----------+----------+----------+--------+ | | | Wildc | tWildc | (0 to 1) | | | | | ardedPSI | ardedPSI | | | +----------+----------+----------+----------+----------+--------+ | | | E | t | (0 to 1) | | | | | xtension | PublicId | | | | | | | entityEx | | | | | | | tension2 | | | +----------+----------+----------+----------+----------+--------+ | t | E | Wildca | tWildca | (0 to 1) | | | PublicId | xtension | rdedIMPU | rdedIMPU | | | | entityEx | | | | | | | tension2 | | | | | | +----------+----------+----------+----------+----------+--------+ | tIniti | Initi | Priority | t | 1 | | | alFilter | alFilter | | Priority | | | | Criteria | Criteria | | | | | +----------+----------+----------+----------+----------+--------+ | | | Trig | tTrigger | 0 to 1 | | | | | gerPoint | | | | +----------+----------+----------+----------+----------+--------+ | | | A | tA | 1 | | | | | pplicati | pplicati | | | | | | onServer | onServer | | | +----------+----------+----------+----------+----------+--------+ | | | Prof | tProf | 0 to 1 | | | | | ilePartI | ilePartI | | | | | | ndicator | ndicator | | | +----------+----------+----------+----------+----------+--------+ | tTrigger | Trig | Conditio | tBool | 1 | | | | gerPoint | nTypeCNF | | | | +----------+----------+----------+----------+----------+--------+ | | | SPT | tSePoTri | 1 to n | | +----------+----------+----------+----------+----------+--------+ | tSePoTri | SPT | Conditio | tBool | 0 to 1 | | | | | nNegated | | | | +----------+----------+----------+----------+----------+--------+ | | | Group | tGroupID | 1 to n | | +----------+----------+----------+----------+----------+--------+ | | | Choice | Re | tString | 1 | | | | of | questURI | | | +----------+----------+----------+----------+----------+--------+ | | | | Method | tString | 1 | +----------+----------+----------+----------+----------+--------+ | | | | S | tHeader | 1 | | | | | IPHeader | | | +----------+----------+----------+----------+----------+--------+ | | | | Ses | tDi | 1 | | | | | sionCase | rectionO | | | | | | | fRequest | | +----------+----------+----------+----------+----------+--------+ | | | | Se | tSe | 1 | | | | | ssionDes | ssionDes | | | | | | cription | cription | | +----------+----------+----------+----------+----------+--------+ | | | **Ext |** tSe | **(0 to | | | | | ension** | PoTriExt | 1)**| | | | | | ension** | | | +----------+----------+----------+----------+----------+--------+ | t | E | Registra | t | (0 to 2) | | | SePoTriE | xtension | tionType | Registra | | | | xtension | | | tionType | | | +----------+----------+----------+----------+----------+--------+ | tHeader | S | Header | tString | 1 | | | | IPHeader | | | | | +----------+----------+----------+----------+----------+--------+ | | | Content | tString | 0 to 1 | | +----------+----------+----------+----------+----------+--------+ | tSe | Se | Line | tString | 1 | | | ssionDes | ssionDes | | | | | | cription | cription | | | | | +----------+----------+----------+----------+----------+--------+ | | | Content | tString | 0 to 1 | | +----------+----------+----------+----------+----------+--------+ | tA | A | Se | t | 1 | | | pplicati | pplicati | rverName | SIP_URL | | | | onServer | onServer | | | | | +----------+----------+----------+----------+----------+--------+ | | | Default | tDefault | 0 to 1 | | | | | Handling | Handling | | | +----------+----------+----------+----------+----------+--------+ | | | Ser | tSer | 0 to 1 | | | | | viceInfo | viceInfo | | | +----------+----------+----------+----------+----------+--------+ | | | E | tAp | 0 to 1 | | | | | xtension | plicatio | | | | | | | nServerE | | | | | | | xtension | | | +----------+----------+----------+----------+----------+--------+ | tAp | E | Includ | tInclud | 0 to 1 | | | plicatio | xtension | eRegiste | eRegiste | | | | nServerE | | rRequest | rRequest | | | | xtension | | | | | | +----------+----------+----------+----------+----------+--------+ | | | Include | tInclude | 0 to 1 | | | | | Register | Register | | | | | | Response | Response | | | +----------+----------+----------+----------+----------+--------+ | tInclud | Includ | (NOTE 3) | (NOTE 3) | 0 to 1 | | | eRegiste | eRegiste | | | | | | rRequest | rRequest | | | | | +----------+----------+----------+----------+----------+--------+ | tInclude | tInclude | (NOTE 3) | (NOTE 3) | 0 to 1 | | | Register | Register | | | | | | Response | Response | | | | | +----------+----------+----------+----------+----------+--------+ | tCha | Cha | PrimaryE | tDia | 0 to 1 | | | rgingInf | rgingInf | ventChar | meterURI | | | | ormation | ormation | gingFunc | | (note 2) | | | | | tionName | | | | +----------+----------+----------+----------+----------+--------+ | | | Se | tDia | 0 to 1 | | | | | condaryE | meterURI | | | | | | ventChar | | | | | | | gingFunc | | | | | | | tionName | | | | +----------+----------+----------+----------+----------+--------+ | | | Primary | tDia | 0 to 1 | | | | | Charging | meterURI | | | | | | Collec | | (note 2) | | | | | tionFunc | | | | | | | tionName | | | | +----------+----------+----------+----------+----------+--------+ | | | S | tDia | 0 to 1 | | | | | econdary | meterURI | | | | | | Charging | | | | | | | Collec | | | | | | | tionFunc | | | | | | | tionName | | | | +----------+----------+----------+----------+----------+--------+ | tDSAI | DSAI | DSAI-Tag | t | 1 | | | | | | DSAI-Tag | | | +----------+----------+----------+----------+----------+--------+ | | | DS | tDS | 1 | | | | | AI-Value | AI-Value | | | +----------+----------+----------+----------+----------+--------+ | tSMS | SMS | IP-SM-G | tIP-SM-G | 1 | | | Registra | Registra | W-Number | W-Number | | | | tionInfo | tionInfo | | | | | +----------+----------+----------+----------+----------+--------+ | tUER | UER | UEI | tUEI | (0 to 1) | | | eachabil | eachabil | PReachab | PReachab | | | | ityForIP | ityForIP | ilityMME | ilityMME | | | +----------+----------+----------+----------+----------+--------+ | NOTE 1: | | | | | | | "n" | | | | | | | shall be | | | | | | | int | | | | | | | erpreted | | | | | | | as | | | | | | | non- | | | | | | | bounded. | | | | | | | | | | | | | | NOTE 2: | | | | | | | At least | | | | | | | one of | | | | | | | these | | | | | | | two | | | | | | | inf | | | | | | | ormation | | | | | | | elements | | | | | | | ( | | | | | | | PrimaryE | | | | | | | ventChar | | | | | | | gingFunc | | | | | | | tionName | | | | | | | or | | | | | | | Primar | | | | | | | yChargin | | | | | | | gCollect | | | | | | | ionFunct | | | | | | | ionName) | | | | | | | shall be | | | | | | | present. | | | | | | | | | | | | | | NOTE 3: | | | | | | | empty | | | | | | | cells | | | | | | | shall be | | | | | | | int | | | | | | | erpreted | | | | | | | as | | | | | | | complex | | | | | | | XML | | | | | | | elements | | | | | | | without | | | | | | | defined | | | | | | | content. | | | | | | | | | | | | | | NOTE 4: | | | | | | | the | | | | | | | "Servic | | | | | | | eLevelTr | | | | | | | aceInfo" | | | | | | | XML | | | | | | | element | | | | | | | shall | | | | | | | not be | | | | | | | used in | | | | | | | this | | | | | | | release | | | | | | | of the | | | | | | | speci | | | | | | | fication | | | | | | +----------+----------+----------+----------+----------+--------+
###### ### Annex E: Void
#
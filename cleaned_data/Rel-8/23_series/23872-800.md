# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
This study intends to investigate the architectural impacts on and potential
enhancements to IMS specifications to meet the normative requirements for CAT
in IMS domain as specified in TS 22.182 [2]:
\- Architecture and procedures to support basic call scenarios for CAT in IMS
domain;
\- Interaction with other service, e.g. IMS Multimedia telephony supplementary
services;
\- Service provision for roaming subscribers;
\- Interworking between IMS CAT and CS CAT in TR 29.882 [3].
In the end, this study will provide conclusions with respects to what further
specification work is required in order to fulfil the requirements for the CAT
in IMS domain.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.182: \"Customized Alerting Tones (CAT) Requirements\".
[3] 3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".
[4] 3GPP TS 24.229: \"Internet Protocol (IP) multimedia call control protocol
based on Session Initiation Protocol (SIP) and Session Description Protocol
(SDP); Stage 3\".
[5] IETF RFC 3959: \"The Early Session Disposition Type for the Session
Initiation Protocol (SIP)\".
[6] IETF RFC 3960: \" Early Media and Ringing Tone Generation in the Session
Initiation Protocol (SIP)\".
[7] 3GPP TS 23.218: \"IP Multimedia (IM) session handling; IM call model;
Stage 2\".
[8] IETF RFC 2616: \" Hypertext Transfer Protocol -- HTTP/1.1\".
[9] IETF RFC 3262: \" Reliability of Provisional Responses in Session
Initiation Protocol (SIP)\".
[10] 3GPP TS 26.234: \"Transparent end-to-end Packet-switched Streaming
Service (PSS) \".
[11] 3GPP2 X.S0055: \"MMD Supplementary Services \".
[12] IETF RFC 2833: \"RTP Payload for DTMF Digits, Telephony Tones and
Telephony Signals\".
[13] IETF RFC 3841: \"Caller Preferences for the Session Initiation Protocol
(SIP)\".
[14] IETF RFC 4483: \"A Mechanism for Content Indirection in Session
Initiation Protocol (SIP) Messages\".
[15] 3GPP TS 29.163: \"Interworking between the IP Multimedia (IM) Core
Network (CN) subsystem and Circuit Switched (CS) networks\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] apply. An abbreviation defined in the present document takes precedence
over the definition of the same abbreviation, if any, in TR 21.905 [1].
# 4 Architecture
## 4.1 Architectural requirements
\- The IMS CAT solution shall minimize the impact on the IMS architecture.
\- The CAT solution shall be able to be deployed independently of the existing
Services; and not interact unduly.
\- The impact on the originating UE shall be minimized.
\- The impact on the intermediate nodes in the originating network UE shall be
minimized.
\- CAT service shall not break legacy services.
### 4.1.1 Multiple CAT Caused by Forking or Flexible Alerting (FA)
If the communication has been forked, or terminating side has FA service, and
there\'re more than one terminator has provisioned CAT service, there will be
multiple early media streams wish to be played by originating UE, those early
media streams may be provided by MRFP in IMS network, or by CS domain through
MGW.
An example of multiple CAT caused by forking or FA is illustrated in figure
4.1.1-1.
Figure 4.1.1-1: An example of multiple CAT caused by forking or FA
It is clarified that for the scenario of multiple CAT caused by forking or FA:
\- UE shall play early media provided by network to override local generated
alerting tone.
\- UE shall select specific early media to play.
\- Terminating IMS network shall be able to apply only one CAT service.
## 4.2 Reference architecture
Editor\'s Note: This sub-clause will describe the reference model to provide
CAT.
Figure 4.2-1: Reference Architecture
### 4.2.1 Reference points
#### 4.2.1.1 CAT Application Server -- MRFC (Cr) Interface
In addition to the session control requests sent via Mr, media control related
commands and resources may be passed between the Application Server and the
MRF using the Cr interface as specified in TS 23.218 [7].
### 4.2.2 Functional entities
# 5 Alternatives
Editor\'s Note: This section will describe and evaluate the detailed reference
architecture, including network elements, interfaces and reference points,
suitable to provide CAT.
## 5.1 Alternative 1
### 5.1.1 Procedures
#### 5.1.1.1 CAT provided by the terminating IMS domain based on the Early
Session model (Flow 1)
In figure 5.1.1.1-1, it is assumed that the called party (UE-B) has CAT
active, calling party (UE-A) does not have CAT active.
Figure 5.1.1.1-1: CAT provided by the terminating IMS domain based on the
Early Session model (Flow 1)
Editor\'s Note: The specific message used at step 8 and step 9 is FFS.
1\. UE A sends INVITE to S-CSCF. The INVITE includes the SDP offer of UE A,
early-session and reliable response mark in supported header indicating that
UE A supports the early-session disposition type and reliability of
provisional responses.
2\. S-CSCF forwards the INVITE to CAT AS based on iFC.
3\. CAT AS checks the subscription data of the UE B. If UE B subscribes CAT
service, CAT AS forwards the INVITE to S-CSCF.
4\. S-CSCF forwards the INVITE to UE B.
5-6. UE B responds Alerting.
7\. CAT AS gets CAT SDP offer from the MRF.
8\~9. CAT AS checks that UE A supports early session, CAT AS sends Alerting
message to UE A, and the Alerting message includes CAT SDP offer as early-
session disposition type.
10\~11. UE A acknowledges to CAT AS with UE A CAT answer.
12\. CAT AS completes the CAT media negotiation with MRF using the received UE
A CAT answer.
13\. CAT AS starts CAT playing, and MRF plays CAT to UE A.
14\~15. CAT AS acknowledges to UE B.
16\~17. UE B sends final successful responds to CAT AS.
18\. CAT AS stops CAT playing, and indicates MRF to stop playing CAT to UE A.
19\~24. CAT AS forwards final successful respond to UE A.
#### 5.1.1.2 CAT provided by the terminating IMS domain based on the Early
Session model (Flow 2)
In figure 5.1.1.2-1, it is assumed that the called party (UE-B) has CAT
active, calling party (UE-A) does not have CAT active.
Figure 5.1.1.2-1: CAT provided by the terminating IMS domain based on the
Early Session model (Flow 2)
1\~2. UE-A sends INVITE with an SDP OFFER (O1) to establish a call with UE-B.
The INVITE is routed to the AS due to initial Filter Criteria on the S-CSCF.
UE-A includes the early-session option tag in its Supported header field of
the SIP INVITE.
3\~5. The AS sends INVITE with an SDP OFFER (O1) to the UE-B.
6\~11. The AS determines that UE-B has CAT service and requests resources from
MRFP. The AS determines that UE-A supports early session and sends a SIP 183
to UE-A with early session. Early session contains an SDP OFFER (CAT-O) which
helps to establish the CAT media between the MRFP and UE-A. UE-A acknowledges
SIP 183 with an SDP ANSWER (CAT-A) in early session, and AS plays CAT to UE-A.
Based on operator policy, Steps 6\~11 can happen right after Step 2 before the
INVITE is forwarded to UE-B.
12\~14. UE-B sends a SIP 180 with an SDP answer (A1), the response first
reaches the AS.
15\~16. The AS changes the \"180 Ringing\" response received from UE-B to
\"183 Session Progress\" and forwards the response with the same SDP answer
(A1) to UE-A.
17\~26. UE-A acknowledges the reliable provisional response.
27\~36. The UE-B answers the call. UE-B sends 200 OK to the AS, and AS stop
CAT which is established by early session.
#### 5.1.1.3 CAT provided by the terminating IMS domain based on the Early
Session model (Flow 3)
Figure 5.1.1.3-1: Call flows for CAT provided in terminating IMS domain based
on AS model (Flow 3)
1\~2. UE_A sends an INIVTE request towards the terminating IMS domain, The
INVITE request includes the session SDP offer A1 and the Early Media supported
indication. The S-CSCF in the terminating IMS domain forwards the INVITE
request to the terminating CAT AS based on the iFC.
3\. The terminating CAT AS gets the INVITE and checks the subscription data of
the UE_B. If UE_B subscribes CAT service, the terminating CAT AS forwards the
INVITE to UE_B, and then gets CAT SDP offer MRS from the MRF.
4\. UE_B sends an 183 session progress to the INVITE request with the session
SDP answer B1.
5\~6. The terminating CAT AS sends the 183 session progress with the session
SDP answer B1 and the early-session SDP offer MRS towards UE_A through S-CSCF.
7\~8. UE_A sends PRACK request to the 183 session progress with the early-
session SDP answer A2. The S-CSCF in the terminating IMS domain forwards the
PRACK request to the terminating CAT AS.
9\. The terminating CAT AS tells MRF the CAT SDP answer A2, and sends the
PRACK request without early-session SDP answer A2 to UE_B.
10\~12. UE_B sends a 200 OK response to the PRACK request towards UE_A.
13\~14. If UE_A need reserve resources, and introduces precondition in session
SDP offer A1 and early-session SDP answer MRS\', UE_A reserves the resources
and sends an UPDATE request with early-session SDP offer A2\' and session SDP
offer A1\'
15\. The terminating CAT AS tells MRF the CAT SDP offer A2\', and gets CAT SDP
answer MRS\', meanwhile, it sends the UPDATE request with session SDP offer
A1\'.
16\. UE_B sends a 200 OK response to the UPDATE request with session SDP
answer B1\'.
17\~18. The terminating CAT AS sends the 200 OK response with early-session
SDP answer MRS\' and session SDP answer B1\' towards UE_A.
19\~21. UE_B alert and sends an 180 Ringing towards UE_A.
22\. The terminating CAT AS informs MRF to play CAT to UE_A. This step can be
happened directly after step 8 or step 14.
23\~25. UE_B answers and send an 200 OK response towards UE_A.
26\. The terminating CAT AS stops playing CAT.
27\~29. UE_A acknowledges, and sends an ACK request towards UE_B.
#### 5.1.1.4 CAT provided by the originating IMS domain based on the Early
Session model
The call flow for IMS CAT provided by the originating IMS domain is similar to
the call flows provided in clauses 5.1.1.1, 5.1.1.2 and 5.1.1.3, except for
the flowing differences:
\- The CAT AS is in the originating IMS domain, and is serving for the
originating user.
\- The CAT AS is trigger by the S-CSCF in the originating IMS domain according
to the originating user\'s iFC.
\- The CAT AS provides the CAT service according to the originating user\'s
subscription.
### 5.1.2 Interaction with supplementary services
### 5.1.3 Impact
The early session mechanism is not very widely used, and has so far not been
adopted in TS**** 24.229 [4]. This means that the usage of early session
mechanism would also require changes to the functional elements, both in the
terminating network as well as the originating network. The impacts of the
early session mechanisms are:
\- The originating network needs to be upgraded to support the early sessions.
\- Intermediate network functions such as IBCF, MGCF, and originating
network\'s ASs needs support the early session mechanism, defined in RFC 3959
[5] and RFC 3960 [6], and media control functions would be impacted such as
PCC.
\- The originating UE must support the early session mechanism.
\- The CAT AS needs to be made aware of whether the originating and visited
networks support early session capabilities.
The usage of early session mechanism would only work in networks where all of
these elements support the early session mechanism, defined in RFC 3959 [5]
and RFC 3960 [6].
## 5.2 Alternative 2 Forking model
Editor\'s Note: alternatives have to be documented as defined in alternative 1
above.
### 5.2.1 Procedures
In the figures that pertain to the \'Signalling flows\' section:
\- The notation _\'Dn\'_ within parentheses means _\'SIP Dialog n\'_.
\- The notation _\'On\'_ within parentheses means _\'SDP Offer n_ \'.
\- The notation _\'An\'_ within parentheses means _\'SDP Answer n\'_.
#### 5.2.1.1 Procedures at the UE
The procedures in TS 24.229 [4] for session initiation and termination shall
apply.
#### 5.2.1.2 Procedures at the CAT AS serving for the terminating UE
The procedures specified in 3GPP2 X.S0055 [11] and the procedures in TS 24.229
[4] for an AS acting as a routing B2BUA shall apply.
#### 5.2.1.3 Forking-based CAT provided by the terminating IMS domain
In Figure 5.2.1.3-1, it is assumed that the called party (UE-B) has CAT active
and the calling party (UE-A) does not have CAT active.
The following flow assumes that UE-A does not include a \"no-fork\" directive
in the INVITE or if included in the INVITE, the AS chooses to ignore the \"no-
fork\" directive based on local policy configured in the AS, as specified in
the clause 7.1 of IETF RFC 3841 [13].
NOTE: The CAT AS behaviour of when the \"no-fork\" is not ignored, is out of
scope of this clause, but can be handled by basic B2BUA call procedures
according to TS 24.229 [4].
Figure 5.2.1.3-1: Forking-based CAT provided by the terminating IMS domain
1\~2. UE-A sends INVITE with an SDP offer (O1) to establish a call with UE-B.
The INVITE is routed through the AS due to initial filter triggers on the
S-CSCF.
3\~5. The AS forwards the original INVITE to UE-B.
6\~8. UE-B sends \"180 Ringing\" with an SDP answer (A1) for an early dialog
(D1), the response first reaches the AS.
9\. The AS request resources from MRFP and creates CAT answer (A2). Based on
operator policy, Steps 9\~15 can happen right after Step 2 before the INVITE
is forwarded to UE-B.
10\~11. The AS generates a reliable \"183 Session Progress\" response to UE-A
as if this is a response from a forked INVITE, which establishes an early
dialog (D2). Using \"183 Session Progress\" avoids triggering local CAT at
UE-A. This response message contains the SDP answer (A2) which helps to
establish the CAT media path between the MRFP and UE-A.
12\~13. UE-A acknowledges the reliable provisional response.
14\~15. The AS sends 200OK to acknowledge PRACK from UE-A.
16\~17. The AS changes the \"180 Ringing\" response received from UE-B to
\"183 Session Progress\" and forwards the response with the same answer (A1)
to UE-A and establishes early dialog (D1). Based on operator policy, Steps 16
\~19 and Steps 26\~27 can also be omitted if the AS chooses to store the
answer (A1) from UE-B and not to send provisional response immediately. UE-A
still saves both SDP answers A1 and A2 since it has no knowledge which answer
will be confirmed finally.
18\~19. UE-A acknowledges the reliable provisional response message.
20\~25. The AS acknowledges the reliable provisional response from UE-B.
28\~30. The user at UE-B finally answers the call. UE-B sends 200 OK and the
response reaches the AS first.
31\. The AS coordinates with the MRFP to stop playing CAT.
32\~33. The AS forwards the 200 OK to UE-A to confirm the early dialog (D1).
If the AS has not sent the answer (A1) from UE-B to UE-A in step 16, the AS
includes the answer (A1) in this 200 OK message and confirms dialog (D1).
34\~38. UE-A acknowledges the confirmed dialog (D1). The call is now
established between UE-A and UE-B based on SDP offer (O1) and SDP answer (A1).
The early dialog (D2) set up by the \"183 Session Progress\" for CAT has no
final response and automatically times out.
### 5.2.2 Interaction with supplementary services
### 5.2.3 Impact
## 5.3 Alternative 3 (Content Indirection)
### 5.3.1 Architectural Details
#### 5.3.1.1 Reference architecture
No additional architectural impacts are necessary to support this proposed
alternative, i.e. the architecture as specified in TS 23.228 [3] can be used.
#### 5.3.1.2 Reference points
No additional reference points are necessary to support this proposed
alternative for providing CAT.
#### 5.3.1.3 Functional entities
##### 5.3.1.3.1 Application Server supporting CAT
An AS supporting the CAT service on behalf of the user needs to be present in
the network.
#### 5.3.1.4 Information flows and Procedures
##### 5.3.1.4.1 Procedures at the Originating UE
The UE shall follow the procedures in TS 24.229 [4] for session initiation and
termination.
When receiving an URI to CAT information the UE should (taking the
requirements in TS 22.182 [2] into account) retrieve and play the content
until media is received on the declared ports.
##### 5.3.1.4.2 Procedures at the AS serving the Terminating UE
Upon receiving (or generating) a SIP message where an URI to CAT information
should be added, the AS generates HTTP URI(s) using standard HTTP procedures
as defined in RFC 2616 [8].
##### 5.3.1.4.3 Information flow for CAT provided by the terminating IMS
domain
Figure 5.3.1.4.3-1: CAT info provided in terminating IMS domain based on URI
in SIP header
1-2. UE-A sends INVITE with an SDP offer to establish a call with UE-B. The
INVITE is routed through the AS due to initial filter triggers on the S-CSCF.
3-4. The AS forwards the original INVITE to UE-B.
5-6. UE-B sends an SDP answer in a 18x response, the response first reaches
the AS.
7\. The AS generates an HTTP URI to the CAT info.
8-9. The AS adds the HTTP URI in a SIP header and forwards the 18x response
towards the UE-A.
NOTE: The SIP header to be used is a stage 3 matter, but can be e.g. Alert-
Info, Call-Info header or according to RFC 4483 [14].
10, 12-14. UE-A acknowledges the reliable provisional response.
11\. UE-A starts reserving resources for the media declared in the SDP Answer
and at the same time retrieves the CAT Info and plays it for the user A. The
CAT information should be retrieved using progressive download of the
information, see TS 26.234 [10].
15-18. The UE-B sends 200 OK to acknowledge PRACK from UE-A.
19-22. When UE-A has reserved the resources the UE-A sends an updated Offer
with media set to \"active\" towards UE-B
23-26. UE-B sends 200 OK to acknowledge the UPDATE from UE-A, which includes
an SDP Answer with media set to \"active\".
27, 29. User B answers the call and the conversation starts
28, 31-33. UE-B sends 200 OK to acknowledge the INVITE.
30\. UE-A stops playing the CAT info as soon as media is received on the
declared ports
34-37. UE-A acknowledges the confirmed dialog
##### 5.3.1.4.4 Information flow for CAT provided by the Originating IMS
domain
CAT provided by the originating IMS domain can be achieved in the same manner
as described in clause 5.3.1.4.1.
#### 5.3.1.5 Interaction with supplementary services
Supplementary services may generate early media towards the calling UE. In
case the early media is using same content indirection principles as described
above, then the UE will be able to choose which early media to retrieve. If
early media is sent in‑band the UE would have to render the in‑band content(s)
to the user.
### 5.3.2 Impact
At a minimum the UE and the AS needs to support HTTP.
For a more enhanced experience the UE should support progressive download as
described in TS 26.234 [10].
## 5.4 CAT Control
This section shows the ways to control the CAT. There are two kinds of
control:
a) UE control the CAT, to stop it, and/or, if possible, to re-start it again;
and,
b) Originating network control the CAT, to disable/enable terminating CAT
according priority, or, to reject it according to rules set by user.
### 5.4.1 CAT stop alternative 1: using out-band method
#### 5.4.1.1 Early-Session Model
In Figure 5.4.1.1-1, it is assumed that the called party (UE_B) has CAT active
and the calling party (UE_A) does not have CAT active.
{width="6.685416666666667in" height="5.836111111111111in"}
Figure 5.4.1.1-1: call flows for CAT stop based on early-session model
1\~2. UE_A sends an INIVTE request towards the terminating IMS domain, The
INVITE request includes the session SDP offer A1 and the Early Media supported
indication. The S-CSCF in the terminating IMS domain forwards the INVITE
request to the terminating CAT AS based on the iFC.
3\. The terminating CAT AS forwards the INVITE request to UE_B, and then gets
CAT SDP offer MRS1 from the MRF.
4\. UE_B sends a 180 Ringing response to the INVITE request.
5\~6. The terminating CAT AS sends a 183 session progress with the early-
session SDP offer MRS1 towards UE_A through S-CSCF. This step can be happened
directly after step 3.
7\~8. UE_A sends PRACK request with the early-session SDP answer A2. The
S-CSCF in the terminating IMS domain forwards the PRACK request to the
terminating CAT AS.
9\~10. The terminating CAT AS tells MRF the received early-session SDP answer
A2, and sends a 200 OK response towards UE_A.
11\. The terminating CAT AS informs MRF to play CAT to UE_A.
12\~13. UE_A wants to stop the CAT, and then sends a UPDATE request with
early-session SDP offer towards UE_A to \"Stop CAT\", e.g., A2 with inactive
attribute for all media types.
14\~15. The terminating CAT AS tells MRF the received early-session SDP offer
A2, and gets CAT SDP answer MRS2 from the MRF with inactive attribute for all
media types, and then sends a 200 OK response with early-session SDP answer
MRS2 towards UE_A through S-CSCF.
16\. The MRF stops to play CAT to UE_A. UE_A may generate local ring tone to
user.
17\~19. UE_B answers and send an 200 OK response with session SDP answer B1
towards UE_A.
20\~22. UE_A acknowledges, and sends an ACK request towards UE_B.
#### 5.4.1.2 Non-Early-Session Model
In Figure 5.4.1.2-1, it is assumed that the IMS called party (UE_B) has CAT
active and the calling party (UE_A) does not have CAT active.
{width="6.685416666666667in" height="5.836111111111111in"}
Figure 5.4.1.2-1: call flows for stop IMS CAT based on forking-based model
1\~2. UE_A sends an INIVTE request towards the terminating IMS domain, The
INVITE request includes the session SDP offer A1. The S-CSCF in the
terminating IMS domain forwards the INVITE request to the terminating CAT AS
based on the iFC.
3\. The terminating CAT AS forwards the INVITE request to UE_B, and then gets
CAT SDP answer MRS from the MRF.
4\. UE_B sends a 180 Ringing response to the INVITE request on dialog D1.
5\~6. The terminating CAT AS sends a 183 session progress with the session SDP
answer MRS towards UE_A through S-CSCF on dialog D2. This step can be happened
directly after step 3.
7\~8. UE_A sends PRACK request on dialog D2. The S-CSCF in the terminating IMS
domain forwards the PRACK request to the terminating CAT AS.
9\~10. The terminating CAT AS indicates MRF to play CAT to UE_A, and sends a
200 OK response towards UE_A on dialog D2.
11\. The MRF start to play CAT to UE_A.
12\~13. UE_A wants to stop the CAT, and then sends a UPDATE request on dialog
D2, which has \"Stop CAT\" indication, e.g., using P-Early-Media header field
that has value of \"inactive\".
14\~15. The terminating CAT AS indicates MRF to stop the CAT, and then sends a
200 OK response towards UE_A through S-CSCF on dialog D2.
16\. The MRF stops to play CAT to UE_A. UE_A may generate local ring tone to
user.
17\~19. UE_B answers and send an 200 OK response with session SDP answer B1
towards UE_A on dialog D1.
20\~22. UE_A acknowledges, and sends an ACK request towards UE_B on dialog D1.
In Figure 5.4.1.2-2, it is assumed that the CS called party has CAT active,
the calling party (UE_A) does not have CAT active, and the call has been
forked.
{width="6.688888888888889in" height="4.760416666666667in"}
Figure 5.4.1.2-2: call flows for stop CS CAT in forking case
1\. UE_A sends an INIVTE request towards the terminating network. The INVITE
request includes the session SDP offer A1.
2\~3. The S-CSCF in the terminating network forked the INVITE request, one
destination is IMS UE-B, the other destination is in CS domain.
4\. MGCF/MGW start the procedure for CS call setup, and the CS user has
subscribed CAT in CS domain.
5\. MGCF understand that CS CAT is active, so it sends 183 session progress
with Session SDP answer A2 on dialog D1.
6\. At the same time, UE-B sends 183 session progress with Session SDP answer
B1 on dialog D2.
7\~8. The terminating S-CSCF forwards the forked responses to UE_A.
9\. UE_A goes on to establish session and waits for the answer. MGW pass-
through CS CAT media to IMS session, so that UE_A can experience the CS CAT.
10\~11. UE_A wants to stop the CAT, and then sends a UPDATE request on dialog
D1, which has \"Stop CAT\" indication, e.g., using P-Early-Media header field
that has value of \"inactive\".
12\~13. The MGCF tells the MGW to stop pass-through the CS CAT media, and then
sends a 200 OK response towards UE_A through S-CSCF on dialog D1.
14\. The MGW stops to pass-through CS CAT media. UE_A may generate local ring
tone to user.
15\. The CS user answers the call, and the CS domain sends an ANM message to
MGCF.
16\~17. MGCF send a 200 OK response towards UE_A on dialog D1.
18\~19. UE_A acknowledges, and sends an ACK request towards MGCF on dialog D1.
In Figure 5.4.1.2-3, it is assumed that the CS called party has CAT active;
the calling party (UE_A) does not have CAT active.
Figure 5.4.1.2-3: call flows for stop CS CAT
1\~2. UE_A sends an INIVTE request towards the terminating IMS domain, The
INVITE request includes the session SDP offer A1. The S-CSCF in the
terminating IMS domain forwards the INVITE request to the MGCF based on the
iFC.
3\. The MGCF sends an IAM message to CS network.
4\. CS network sends a ACM message with \"CAT Active\" indication to the MGCF.
5\~6. The MGCF sends a 183 session progress with the session SDP answer A2
towards UE_A through S-CSCF.
7\~8. UE_A sends PRACK request. The S-CSCF in the terminating IMS domain
forwards the PRACK request to the MGCF.
9\~10. The MGCF indicates MGW to pass-through CS CAT media to UE_A, and sends
a 200 OK response towards UE_A.
11\. The CS CAT media server play CAT information, and the MGW pass-through
the CS CAT media to UE_A.
12\~13. UE_A wants to stop the CAT, and then sends a UPDATE request, which has
\"Stop CAT\" indication, e.g., using P-Early-Media header field that has value
of \"inactive\".
14\~15. The MGCF indicates MGW to stop pass-through the CS CAT media, and then
sends a 200 OK response towards UE_A through S-CSCF.
16\. The MGW stops to pass-through CS CAT media to UE_A. UE_A may generate
local ring tone to user.
17\. The CS user answers the call, and the CS domain sends an ANM message to
MGCF.
18\~19. MGCF send a 200 OK response towards UE_A.
20\~21. UE_A acknowledges, and sends an ACK request towards MGCF.
### 5.4.2 CAT stop alternative 2: using in-band method
Figure 5.4.2-1: CAT stopped by originating UE
1\. MRF is playing CAT to UE A.
2\. UE A sends DTMF for CAT stop to the MRF using RTP package (see IETF RFC
2833 [7]).
NOTE: DTMF digit from UE A should be understood correctly by the CAT AS.
3\. MRF sends the DTMF to the CAT AS.
4\. After received the DTMF, the CAT AS indicates MRF to stop playing CAT and
play the default alerting tone.
### 5.4.3 CAT priority and reject alternative 1: direct way
#### 5.4.3.1 IMS CAT Priority
Figure 5.4.3.1-1: call flow for IMS CAT priority service provided by the
originating CAT AS
1\. UE A sends INVITE the originating CAT AS.
2-3. The originating CAT AS checks the CAT priority setting. If UE A set the
originating CAT has the higher priority, the originating CAT AS includes the
originating CAT provision indication in INVITE message and forwards the INVITE
to the terminating IMS network.
4\. The terminating IMS CAT AS not start the terminating CAT procedure
according to the originating CAT provision indication in the INVITE message.
Multiple options are possible, two of which are shown:
4a. According to the originating CAT provision indication and iFC, the
terminating S-CSCF would not to trigger the terminating CAT AS.
4b. Based on iFC, the terminating S-CSCF forwards the INVITE to the
terminating CAT AS. And according to the originating CAT provision indication,
the terminating CAT AS would not execute the terminating CAT procedure.
5\. The terminating IMS network forwards the INVITE to UE B.
6-10. Normal call establishment and the originating CAT procedure.
11\. The originating CAT AS starts to play the originating CAT to UE A.
#### 5.4.3.2 IMS CAT Reject
IMS CAT reject procedure is similar with IMS CAT priority in clause 5.4.3.1
with following differences:
\- In step 2 and step 3, the originating CAT AS checks the CAT reject setting,
and sends the INVITE message with CAT reject indication according to the CAT
reject setting.
\- In step 8 to step 10, Early Session CAT SDP negotiation is not needed.
\- Step 11 is not needed.
### 5.4.4 CAT priority and reject alternative 2: indirect way
#### 5.4.4.1 Early-Session Model
In Figure 5.4.4.1-1, it is assumed that the called party (UE_B) and calling
party (UE_A) both have CAT active, and originating CAT has priority than
terminating CAT.
Figure 5.4.4.1-1: call flows for CAT priority based on early-session model
1\~3. UE_A sends an INIVTE request towards the terminating IMS domain, The
INVITE request includes the session SDP offer A1 and the Early Media supported
indication. The S-CSCF in the originating/terminating IMS domain forwards the
INVITE request to the originating/terminating CAT AS based on the iFC. The
originating/terminating CAT AS gets CAT SDP offer from the MRF.
4\. UE_B sends a 180 Ringing response to the INVITE request.
5\. The terminating CAT AS sends a 183 session progress with the early-session
SDP offer t-CAT towards UE_A through terminating S-CSCF. This step can be
happened directly after step 3.
NOTE: The early-session SDP offer t-CAT is special for CAT service, it include
indication that this is for CAT service, not for others, e.g., using special
media type, or using a media type with 0 port number, other service, such as
Announcement, has higher priority than CAT, so, if the early-session SDP is
not CAT SDP, O-CAT may not be provide.
6\. The originating CAT AS sends a 183 session progress with the early-session
SDP offer o-CAT towards UE_A through originating S-CSCF. This step can be
happened directly after step 2. And according the priority, originating CAT AS
does not forward the terminating CAT SDP offer t-CAT towards UE_A.
7\. UE_A sends PRACK request with the early-session SDP answer A2. The
originating S-CSCF forwards the PRACK request to the originating CAT AS.
8\. The originating CAT AS sends PRACK request with an early-session SDP
answer to \"Reject CAT\", e.g., t-CAT with 0 port number for all media types.
The terminating S-CSCF forwards the PRACK request to the terminating CAT AS.
This step can be happened directly after step 5.
9\. The terminating CAT AS tells MRF the received early-session SDP answer,
and sends a 200 OK response to the PRACK request towards UE_A.
10\. The originating CAT AS tells MRF the received early-session SDP answer,
and sends a 200 OK response to the PRACK request towards UE_A. This step can
be happened directly after step 7.
11\. The originating CAT AS informs MRF to play CAT to UE_A.
12\~14. UE_B answers and send a 200 OK response with session SDP answer B1
towards UE_A.
15\~17. UE_A acknowledges, and sends an ACK request towards UE_B.
In Figure 5.4.4.1-2, it is assumed that the called party (UE_B) has CAT active
and the calling party (UE_A) does not have CAT active, and originating
operator has rules to reject terminating CAT.
Figure 5.4.4.1-2: call flows for CAT reject based on early-session model
1\~3. UE_A sends an INIVTE request towards the terminating IMS domain, The
INVITE request includes the session SDP offer A1 and the Early Media supported
indication. The S-CSCF in the originating/terminating IMS domain forwards the
INVITE request to the originating/terminating CAT AS based on the iFC. The
terminating CAT AS gets CAT SDP offer from the MRF because UE_B active the CAT
service.
4\. UE_B sends a 180 Ringing response to the INVITE request.
5\. The terminating CAT AS sends a 183 response with the early-session SDP
offer t-CAT towards UE_A through terminating S-CSCF. This step can be happened
directly after step 3.
NOTE: The early-session SDP offer t-CAT is special for CAT service, it include
indication that this is for CAT service, not for others, e.g., using special
media type, or using a media type with 0 port number, other service, such as
Announcement, has higher priority than CAT, so, if the early-session SDP is
not CAT SDP, CAT rejection may not be executed.
6\. According to the rule, e.g., black list of terminator\'s ID, the
originating CAT AS decides to reject the terminating CAT because, say, the
terminator\'s ID in the black list.
7\. The originating CAT AS removes the early-session SDP in the 183 response
and forwards it towards UE_A through originating S-CSCF.
8\. UE_A sends PRACK request. The originating S-CSCF forwards the PRACK
request to the originating CAT AS.
9\. The originating CAT AS forwards the PRACK request with an early-session
SDP answer to \"Reject CAT\", e.g. t-CAT with 0 port number for all media
types.
10\~11. The terminating CAT AS tells MRF the received early-session SDP
answer, and sends a 200 OK response to the PRACK request towards UE_A.
12\. Optionally, the originating CAT AS may send a 180 Ringing response to
UE_A in order to trigger the local tone of UE_A.
13\~15. UE_B answers and send an 200 OK response with session SDP answer B1
towards UE_A.
16\~18. UE_A acknowledges, and sends an ACK request towards UE_B.
#### 5.4.4.2 Forking-Based Model
In Figure 5.4.4.2-1, it is assumed that the called party (UE_B) and calling
party (UE_A) both have CAT active, and originating CAT has higher priority
than terminating CAT.
Figure 5.4.4.2-1: call flows for CAT priority based on forking-based model
1\~3. UE_A sends an INIVTE request towards the terminating IMS domain, The
INVITE request includes the session SDP offer A1. The S-CSCF in the
originating/terminating IMS domain forwards the INVITE request to the
originating/terminating CAT AS based on the iFC. The originating/terminating
CAT AS gets CAT SDP answer o-MRS/t-MRS from the MRF.
4\. UE_B sends a 180 Ringing response to the INVITE request on dialog D1.
5\. The terminating CAT AS sends a 183 session progress with the session SDP
answer t-MRS towards UE_A through terminating S-CSCF on dialog D2. This step
can be happened directly after step 3.
6\. The originating CAT AS sends a 183 session progress with the session SDP
answer o-MRS towards UE_A through originating S-CSCF on dialog D3. This step
can be happened directly after step 2. And according the priority, originating
CAT AS does not forward the terminating CAT SDP answer t-MRS towards UE_A.
7\. UE_A sends PRACK request on dialog D3. The originating S-CSCF forwards the
PRACK request to the originating CAT AS.
8\. The originating CAT AS sends PRACK request with \"Reject CAT\" indication
on dialog D2, e.g., using P-Early-Media header field that has value of
\"inactive\". The terminating S-CSCF forwards the PRACK request to the
terminating CAT AS. This step can be happened directly after step 5.
9\. The terminating CAT AS sends a 200 OK response towards UE_A on dialog D2,
with indication that the rejection has been accepted, e.g., using P-Early-
Media header field with value of \"inactive\".
NOTE: \"Reject CAT\" indication will only be understood by CAT service, other
service will not impact. If there\'s no rejection accepted indication, then
O-CAT may not be played and the message for dialog D2 need to be sent to UE_A,
because other service, e.g., Announcement, has higher priority than CAT.
10\. The originating CAT AS sends a 200 OK response towards UE_A on dialog D3.
This step can be happened directly after step 7.
11\. The terminating MRF stop playing CAT to UE_A.
12\. The originating CAT AS informs MRF to play CAT to UE_A.
13\~15. UE_B answers and send a 200 OK response with session SDP answer B1
towards UE_A on dialog D1.
16\~18. UE_A acknowledges, and sends an ACK request towards UE_B on dialog D1.
In Figure 5.4.4.2-2, it is assumed that the called party (UE_B) has CAT active
and the calling party (UE_A) does not have CAT active, and originating
operator has rules to reject terminating CAT.
Figure 5.4.4.2-2: call flows for CAT reject based on forking-based model
1\~3. UE_A sends an INIVTE request towards the terminating IMS domain, The
INVITE request includes the session SDP offer A1. The S-CSCF in the
originating/terminating IMS domain forwards the INVITE request to the
originating/terminating CAT AS based on the iFC. The terminating CAT AS gets
CAT SDP answer t-MRS from the MRF because UE_B active the CAT service.
4\. UE_B sends a 180 Ringing response to the INVITE request on dialog D1.
5\. The terminating CAT AS sends a 183 session progress with the session SDP
answer t-MRS towards UE_A through terminating S-CSCF on dialog D2. This step
can be happened directly after step 3.
6\. According to the rule, e.g., black list of terminator\'s ID, the
originating CAT AS decides to reject the terminating CAT because, say, the
terminator\'s ID in the black list.
7\. The originating CAT AS forwards the 183 session progress towards UE_A
through originating S-CSCF.
8\. UE_A sends PRACK request on dialog D2. The originating S-CSCF forwards the
PRACK request to the originating CAT AS.
9\. The originating CAT AS forwards the PRACK request with \"Reject CAT\"
indication towards UE_B, e.g., using P-Early-Media header field with the value
of \"inactive\", and then the terminating S-CSCF forwards the PRACK request to
the terminating CAT AS.
10\. The terminating CAT AS sends a 200 OK response towards UE_A on dialog D2,
with indication that the rejection has been accepted, e.g., using P-Early-
Media header field with value of \"inactive\".
NOTE: \"Reject CAT\" indication will only be understood by CAT service, other
service will not impact. If there\'s no rejection accepted indication, then
O-CAT may not be played, because other service, e.g., Announcement, has higher
priority than CAT.
11\. The originating CAT AS sends a 200 OK response towards UE_A on dialog D2.
12\. Optionally, the originating CAT AS may send a 180 Ringing response
towards UE_A on dialog D2 in order to trigger local tone of UE_A.
13\~15. UE_B answers and send an 200 OK response with session SDP answer B1
towards UE_A on dialog D1.
16\~18. UE_A acknowledges, and sends an ACK request towards UE_B on dialog D1.
## 5.5 IMS CAT service notification
IMS CAT AS shall be able to send the notification message to the serving UE to
inform about the status and changes in his CAT service e.g. the system will
periodically check subscription record, and if the CAT service will expire,
the system sends a CAT expiration notification to the subscriber. The
notification can be sent by existing methods such as SMS, MMS and SIP MESSAGE.
Editor\'s notes: It is for further study what level of specification is
required for this feature.
## 5.6 IMS CAT copy
### 5.6.1 Alternative 1: using in-band method
The following figure shows how the CAT AS copies the terminating CAT as the
originating CAT, when the CAT AS is serving for the originating UE and the
terminating UE.
Figure 5.6.1-1: IMS CAT copy procedure
1\. MRF is playing CAT to UE A.
2\. UE A sends DTMF for CAT copy to the MRF using RTP package (see IETF RFC
2833 [12]).
3\. MRF sends the DTMF to the CAT AS.
4\. CAT AS identifies that the received DTMF is CAT copy instruction, and the
CAT AS copies the playing CAT as the UE A\'s CAT.
### 5.6.2 Alternative 2: using out-band method
#### 5.6.2.1 SIP MESSAGE usage for copying CAT or changing CAT
In Figure 5.6.2.1-1 below it is shown how UE-A uses SIP MESSAGE to inform the
AS that it wishes to copy the CAT content. Other methods are possible, and in
particular the Ut interface could be used to offline request the copying of a
CAT previously experienced.
Analogously to Figure 5.6.2.1-1, UE-B can use SIP MESSAGE to change the CAT
that is currently played towards UE‑A.
Figure 5.6.2.1-1: SIP MESSAGE used to invoke the Copy CAT function
1\. The call is set up in accordance with according to the CAT procedures.
User A experiences the CAT provided by User B. User A decides to copy the CAT
and use it as his/hers own.
2\. A SIP message requesting to copy the CAT is sent to the CAT AS in the
originating network.
3\. The CAT AS generates a 200 OK to acknowledge the receipt of the SIP
MESSAGE.
4\. The AS initiates procedures to copy the CAT.
5\~6. Optionally the AS sends a SIP MESSAGE to notify UE-A about the outcome
of the copy CAT operation. The arrival of this MESSAGE is acknowledged by UE-A
#### 5.6.2.2 Ut usage for copying CAT or changing CAT
In Figure 5.6.2.2-1 below it is shown how UE-A uses Ut to inform the AS that
it wishes to copy the CAT content. The UE-A could e.g. receive a list of the
last calls it made and the ring signals it can Copy.
Analogously to Figure 5.6.2.2-1, UE-B can use Ut to change the CAT that is
currently played towards UE-A.
Figure 5.6.2.2-1: Ut interface used to invoke the Copy CAT function
1\. The call is set up in accordance with according to the CAT procedures.
User A experiences the CAT provided by User B. User A decides to copy the CAT
and use it as his/hers own.
2\. UE-A contacts the AS using Ut, requesting to copy the CAT. This step may
occur after the session where CAT is experienced is terminated.
3\. The CAT AS performs internal logic to copy the CAT and add this to the
user\'s list of ring tones.
## 5.7 CAT selection by the called party
Figure 5.7-1: call flow for selecting CAT by the called party
1\. The CAT AS plays pre-configured CAT to the calling party using the normal
call setup and CAT procedure.
2-3. The UE B sends a CAT selection to the CAT AS to indicate which CAT to be
played to the calling party, e.g. index of the CAT pre-configured in the CAT
AS.
4\. According to the received CAT selection, the CAT AS instructs the MRF to
play the selected CAT to the UE A.
# 6 Assessment
# 7 Interaction with other features
Editor\'s Note: This clause will describe the CAT service interactions with
other features.
## 7.1 Interaction with other services and functions
## 7.2 Interaction with charging
# 8 Interworking with CS domain
## 8.1 Alternative 1
### 8.1.1 Call flow for providing the IMS CAT to the originating UE in CS
domain
Figure 8.1.1-1: call flows for providing the IMS CAT to the originating UE in
CS domain
1\. PSTN sends IAM to MGCF.
2\. The MGCF sends INVITE to CAT AS. The INVITE includes the MGCF SDP offer,
early session supported indication.
3\. The CAT AS sends INVITE to UE B.
4\. UE B responds Alerting.
5\. CAT AS/MRF checks that MGCF supports early session, and sends Alerting to
MGCF, which includes the MRF CAT early session offer.
6-7. MGCF acknowledges to the CAT AS/MRF with MGCF CAT early session answer.
NOTE: The early session negotiation shown from step 4 to step 7 could be
accomplished by SIP 183 procedure, which are shown in clauses 5.1.1.2 and
5.1.1.3, and after that, the CAT AS continues the Alerting procedure.
8\. The MGCF sends ACM to the PSTN.
9\. UE B sends final successful response to CAT AS with the SDP answer of UE
B.
10\. CAT AS stops CAT playing.
11\. CAT AS forwards final successful response to MGCF
12\. The MGCF sends ANM to PSTN.
13-14. The MGCF acknowledges the final successful response to UE B.
## 8.2 Alternative 2
### 8.2.1 Procedures
In the figures that pertain to the \'Signalling flows\' section:
\- The notation _\'Dn\'_ within parentheses means _\'SIP Dialog n\'_
\- The notation _\'On\'_ within parentheses means _\'SDP Offer n\'_
\- The notation _\'An\'_ within parentheses means _\'SDP Answer n\'_
#### 8.2.1.1 Session-based CAT provided by the terminating IMS domain
In Figure 8.2.1.1-1, it is assumed that the called party (UE-B) has CAT
active. The calling party in CS network is assumed to not have CAT active.
Figure 8.2.1.1-1: Session-based CAT provided by the terminating IMS domain
1-3. The MGCF sends INVITE with an SDP offer (O1) to establish a call with
UE-B. The INVITE is routed through the AS due to initial filter triggers on
the S-CSCF. The call proceeds as in steps 3-9 in clause 5.2.1.3, Figure
5.2.1.3-1.
4-6. The AS generates a reliable Session Progress response to the MGCF as if
this is a response from a forked INVITE, which establishes an early dialog
(D2). This response message contains the SDP answer (A2) which the MGCF
provides to the MGW to establish the CAT media path between the MRFP and the
MGW. The ACM message is sent towards the CS network, enabling CAT to be
provided to the originating UE.
The call proceeds as in steps 12-27 in clause 5.2.1.3, Figure 5.2.1.3-1.
7-8. The user at UE-B answers the call. UE-B sends 200 OK and the response
reaches the AS.
9\. The AS coordinates with the MRFP to stop playing CAT.
10-11. The AS forwards the 200 OK to the MGCF to confirm the dialog (D1). If
the AS has not already sent the answer (A1) from UE-B to the MGCF, the AS
includes the answer (A1) in this 200 OK message and confirms dialog (D1).
12-16. The MGCF acknowledges and starts to use the confirmed dialog (D1). An
ANM message is sent towards the CS network. The call is now established
between the MGCF/MGW and UE-B based on SDP offer (O1) and SDP answer (A1). The
early dialog (D2) set up by the \"Session Progress\" for CAT has no final
response and automatically times out.
## 8.3 CAT provided by the terminating CS domain
The following flow for interworking procedures for CAT provided by the
terminating CS domain is independent of the CAT model used in the IMS domain
(forking or early session model).
In Figure 8.3-1, it is assumed that the called party in the CS network has CAT
active and the calling party (UE-A) does not have CAT active. These procedures
are based on and compliant with the existing procedures defined in TS 29.163
[15].
Figure 8.3-1: Session-based CAT provided by the terminating IMS domain
1\. UE-A sends INVITE with an SDP offer to establish a call with a user in the
CS network.
2\. The MGCF sends an IAM to the CS network.
3\. The MGCF may send a session progress to UE-A.
4\. The CS network sends an ACM (or CPG) to the MGCF.
5\. The MGCF sends an updated session progress or a ringing message. If the
MGCF supports early media indication, the MGCF includes an early media
indication provided an early media indication was received in step 1\. CAT
media can flow from CS network to UE-A.
NOTE: PSTN media supports both the CAT media and the normal CS media.
6\~7. The user in the CS network answers the call. This ends the playing of
CAT media. The session setup is completed.
# 9 Conclusion
SA2 were given an exception by TSG SA as follows:
\"SA WG2 should decide on a path forward for some solutions for CAT work and
may bring CRs as a result of this Study Item in order to do fulfil the
intention of the 3GPP2 joint Workshop conclusions, to include some CAT
functionality in Rel‑8.\"
To address the exception from SA, this study concludes that both the Forking
model and Early-Session model need to be specified in Release 8.
The Gateway model as described in RFC 3960 [6] supports CAT provided by the
terminating IMS network without additional specification at stage 2.
CAT inter-working between CS and IMS is included in release 8, as described in
clause 8.
Service Notification requires no additional specification at stage 2.
Content indirection is not to be included.
#
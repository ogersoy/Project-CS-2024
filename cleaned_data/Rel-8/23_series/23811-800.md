# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
TS 23.204 [5] specifies how to deliver SMS over generic 3GPP IP access, where
the Short Message (SM) is entirely encapsulated in the SIP based messages so
that the traditional SM not only can be delivered in CS, but also in IMS over
different IP-CANs. However, the interworking between the Short Message and the
Instant Messaging has not been defined yet, which prohibits the message
interworking between the traditional SMS terminals and the non-SMS capable
terminals.
As a result, there is an interest for supporting service level interworking
for instance between Short Message (SM) and existing Instant Messaging (IM)
services, which enables the communication between SMS terminals and the
terminals that do not support the SMS, such as pure SIP terminals. This TR
documents alternatives for how to provide such service level interworking.
# 1 Scope
This document contains the results of the study into the architectural
requirements and comes up with the solution of the service level interworking
for the Short Message service as defined in the TS 23.040 [6] and Instant
Messaging service as defined in **OMA-TS-SIMPLE_IM-V1_** 20070816-C****[8].
Considerations include overall requirements, architectural requirements,
evaluation of potential architectural solutions and alternative architectures.
The objective is to identify an architectural solution that allows completely
service level interworking between SMS and SIMPLE IM without degrading
existing services, under the service requirements defined in the TS 22.340 [2]
and TS 22.105 [3]. In addition, how to charge for the interworked services
shall be considered in this study as well.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TR 22.340: \"IP Multimedia System (IMS) messaging\".
[3] 3GPP TS 22.105: \"Services and service capabilities\".
[4] 3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".
[5] 3GPP TR 23.204: \"Support of Short Message Service (SMS) over generic 3GPP
Internet Protocol (IP) access\".
[6] 3GPP TS 23.040: \"Technical realization of the Short Message Service (SMS)
Point to Point (PP)\".
[7] 3GPP TS 24.011: \"Point-to-Point (PP) Short Message Service (SMS) support
on mobile radio interface\".
[8] OMA: \"Instant Messaging using SIMPLE\", OMA-TS-SIMPLE_IM-V1_0-20070816-C,
http://member.openmobilealliance.org/ftp/Public_documents/MWG/IM/Permanent_
documents/OMA-TS-SIMPLE_IM-V1_0-20070816-C.zip
[9] IETF draft, draft-ietf-simple-imdn-06: \"Instant Message Disposition
Notification\", 14 January 2008.
[10] 3GPP TS 24.247: \"Messaging service using the IP Multimedia (IM) Core
Network (CN) subsystem; Stage 3\".
[11] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[12] 3GPP TS 24.341: \"Support of SMS over IP networks; Stage 3\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**IMS origination** : origination of an Instant Message by an IMS UE.
**IMS termination** : termination of an Instant Message by an IMS UE.
**SMS origination:** origination of a Short Message (including SMS over IP) by
an SMS capable UE, as defined in TS 23.040 [6] and TS 23.204 [5].
**SMS termination:** termination of a Short Message (including SMS over IP) by
an SMS capable UE, as defined in TS 23.040 [6] and TS 23.204 [5].
**SIMPLE IM service** : the Instant Messaging Service as defined in the OMA-
TS-SIMPLE_IM-V1_0-20070816-C [8].
**SMS:** the Short Message Service as defined in the TS 23.040 [6]
**SMSIP MESSAGE:** an immediate message as defined in TS 23.228 [4], which
encapsulates a SM in its text body.
**Instant Message** : an Instant Message as defined in the OMA-TS-
SIMPLE_IM-V1_0-20070816-C [8] and TS 24.247 [10].
**SMSIP UE:** a UE which supports SMSIP MESSAGE.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
(void)
# 4 Overall requirements
This document should consider in priority (but not being limited to) the
following aspects:
\- providing a consistent service experience to the user when service-level
interworking takes place;
\- providing requirements for suitable security mechanisms for interworked
messages, for instance stop certain message from being interworked;
\- providing the service-level interworking authorisation;
\- avoiding overlap with OMA;
\- providing the appropriate mechanisms to apply charging principles for
interworking;
\- considering the interaction with existing functionality specified in TS
23.040 [6].
NOTE: For ensuring the integrity of the response messages from the IM UE, it
is strongly recommended that in networks where the IP-SM-GW is deployed, no
intermediate nodes modify or terminate the message between the IP-SM-GW and
the terminating IM UE. If intermediate nodes are deployed, they can send
response messages that do not reflect the final response from the IM UE. Final
responses from the IM UE are necessary to ensure correct charging and delivery
reports on the SMS side.
# 5 Scenarios for service-level interworking
## 5.1 General
The following clauses describe the use cases and the scenarios to consider in
this TR. Note that other scenarios could be added when identified.
## 5.2 Capability of the UE
The set of supported capabilities of the UE in the terminated network is
important for the network entity to decide whether service level interworking
is needed. From the terminal\'s perspective, supporting Instant Message
implies that the UE is an IM Client. At least, it requires the UE to support
IM feature-tag \'+g.oma.sip-im\' and IMDN procedure for message delivery
report. However, for SM over CS/PS domain, it requires UE to support SMS
protocol stack, for SM over IP as defined in TS 23.204 [5], it requires the UE
to support both the SMS protocol stack and IMS SIP MESSAGE. As a result,
different sets of UE capabilities should be considered when identifying the
interworking scenarios.
**Category one** : IMS registered UE only supporting Instant Message
This type of UE registers to the Instant Message service as well as the IMS
service. However, it only supports the Instant Message format. In other words,
service level interworking needs to be done when Short Message is received
from the other side based on the capability of the UE. Otherwise, the UE is
not able to resolve the message format.
**Category two:** IMS registered UE only supporting SMSIP MESSAGE
This type of UE registers to the IMS service but does not register to Instant
Message service and it supports the SMSIP MESSAGE format. In this case, when
it is sent an Instant Message service level interworking is needed.
**Category three:** IMS registered UE supporting both SMSIP MESSAGE and
Instant Message
This type of UE registers to the Instant Message service as well as the IMS
service and it supports the SMSIP MESSAGE and Instant Message simultaneous.
This means that when it is sent a Short Message, no message format translation
is needed, and it is only necessary to encapsulate the Short Message in the
text body of the SIP MESSAGE. Optionally, service level interworking can be
also performed based on the preference and the subscription of the user for
this type of UE.
**Category four:** SM UE over PS/CS
This type describes legacy UEs that only support short messages. When it is
sent a pure IM, service level interworking is required, otherwise, the UE is
not able to resolve the message format.
## 5.3 Use cases
### 5.3.1 IM user with non SMS capable UE receives short message from an SMS
user
An IMS registered user with SIMPLE IM service receives an SMS message
formatted via service-level interworking to an Instant Message.
### 5.3.2 IM user with non SMS capable UE sends an Instant Message to an SMS
user
An IMS registered user with SIMPLE IM service sends an Instant Message to an
SMS recipient formatted via service-level interworking to an SMS message.
### 5.3.3 IMS user with delivery preferences/operator policy set to SMS for
receiving messages
An Instant Message is received for an IMS subscriber where the subscriber has
set terminating user preferences to deliver all Instant Messages via SMS (e.g.
because the user is not available in IMS) or operator policy determines that
this Instant Message shall be delivered as short message.
### 5.3.4 Concatenated SMS messages delivered as an IM large message
An IMS registered user with OMA IM service receives an SMS via service-level
interworking to MSRP (needed for large SMS\'s).
### 5.3.5 IM large message delivered as concatenated SMS messages
An IMS registered user with OMA IM service sends a message via MSRP (needed
for a large message) where the recipient is not an IMS user.
### 5.3.6 IM user with delivery preferences set to SMS for large messages
An IMS registered user with OMA IM service sends a message via MSRP where the
recipient is an IMS user but the user has set terminating user preferences to
deliver all Instant Messages received via MSRP via SMS (perhaps because the
user is not available in IMS).
### 5.3.7 Prevention from being interworked
Some SMS messages are prevented from being interworked to IMS based on the
specific SMS service (e.g., a priority SMS, OTA SMS, etc.).
### 5.3.8 IM user sends an Instant Message to an SMSIP UE
An IM user sends an Instant Message to an SMSIP UE via the service level
interworking to an encapsulated SIP MESSAGE.
### 5.3.9 SMSIP UE sends an encapsulated Short Message to an IM user with non
SMS capable UE
An SMSIP UE sends an encapsulated Short Message to an IM user with non SMS
capable UE via the service level interworking to an Instant Message.
### 5.3.10 IM user sends an Instant Message to a group list including SMS
users
An IM user sends an Instant Message to a group list which includes the
recipients of the SMS users as well as the IM users.
### 5.3.11 AS addressed by PSI receives short message from an SMS user
AS addressed by PSI receives an SMS message formatted via service-level
interworking to an Instant Message.
## 5.4 Scenarios
### 5.4.1 Scenario 1: IMS origination and SMS termination to the SMS UE with
the service level interworking in the originating side
A IM UE initiates an Instant Message and the Instant Message is terminated as
a Short Message in the CS or PS domain to a SMS UE.
Figure 5.1: interworking scenario of IMS origination and SMS termination to
the SMS UE-1
### 5.4.2 Scenario 2: IMS origination and SMS termination to the SMS UE with
the service level interworking in the terminating side
A IM UE initiates an Instant Message and the Instant Message is terminated as
a Short Message in the IMS to a SMS UE.
Figure 5.2: interworking scenario of IMS origination and SMS termination to
the SMS UE-2
### 5.4.3 Scenario 3: SMS origination from the SMS UE and IMS termination
A SMS UE initiates a Short Message over CS or PS domain and the Short Message
is terminated as an Instant Message in the IMS to an IM UE.
Figure 5.3: interworking scenario of SMS origination from the SMS UE and IMS
termination
### 5.4.4 Scenario 4: SMSIP UE sends an encapsulated Short Message to an IM
user
A SMSIP UE initiates an encapsulated Short Message and the Short Message is
terminated as an Instant Message in the IMS to an IM UE.
Figure 5.4: interworking scenario of SMS origination from the SMSIP UE and IMS
termination
The encapsulated Short Message is sent from the SMSIP client to the
Originating S-CSCF.
The IP-SM-GW on the originating side translates the encapsulated Short Message
into a Short Message for delivery to the SM-SC as described in TS 23.204 [5],
clause 6.3.
The SM-SC delivers the short message to the IM user according to the
procedures in subclause 7.1.1.4.2 (IM user receives short message from an SMS
user).
### 5.4.5 Scenario 5: IMS origination and SMS termination to the SMSIP UE with
the service level interworking in the terminating side
\- A IM UE initiates an Instant Message and the Instant Message is terminated
as a SMSIP MESSAGE in the IMS to a SMSIP UE.
Figure 5.5: Interworking scenario of IMS origination and SMS termination to
the SMSIP UE-3
The IM client sends an Instant Message.
The IP-SM-GW on the terminating side translates the Instant Message into a
Short Message by performing service level interworking and then delivers the
message as a Short Message over IMS.
# 6 Architectural requirements
The SMS-IM service level interworking architecture shall allow for the
following:
\- The service level interworking is a value added service which requires
service subscription, In addition, it shall also take the operator\'s policy,
if available, into account, e.g. checking on the barring setting of the
subscriber to determine whether to provide this interworking or not, so the
service authorisation shall be supported before the interworking is executed.
\- The service level interworking applies as a fallback only in case the users
cannot communicate with each other using their chosen messaging service,
subject to user preferences and operator policies. The location of the
interworking service can be in the originating network when the sender sends a
message that needs to be interworked, and in the terminating network when the
message is to be delivered in a format different than the one it was received
in.
\- The service level interworking shall support interworking between OMA
SIMPLE IM service as defined in OMA-TS-SIMPLE_IM-V1_0-20070816-C [8] and Short
Message Service, which includes not only the Short message over CS/PS as
defined in the TS 23.040 [6] but also the short message over IP as defined in
the TS 23.204 [5].
\- The service level interworking shall not break existing functionality.
\- The service level interworking shall be able to take the capability of the
terminating UE into account when possible.
\- The service level interworking shall be transparent to the end user.
\- The service level interworking shall minimize the impact on the IMS
architecture.
\- The service level interworking shall not impact existing functionality of
the SMS service as described in TS 23.040[6] or of the SIMPLE IM service
enabler as described in OMA-TS-SIMPLE_IM-V1_0-20070816-C [8]. Existing
security mechanisms for both the SIMPLE IM service and the SMS service shall
be reused.
\- The service level interworking shall minimize the impact on existing
functionality of the SIP based messaging service as described in TS 23.204
[5]. Existing security mechanisms for SIP based messaging service shall be
reused.
\- Delivery to offline subscribers shall be supported in the receiving system.
\- The interworking function shall be aware if the message should be
interworked or not, e.g., specific types of SMS messages such as an over the
air configuration message, shall not be interworked, but shall be instead
transported as an SMS message via IMS, CS or PS.
\- If an SMS user requests an SMS status report that the message was delivered
to the recipient and the SM is interworked to IM on the originating side, then
an SMS status report shall be generated by the interworking function when the
message is delivered as an Instant Message.
\- If an IMS user requests a notification that the message was delivered to
the recipient, an SMS status report shall be generated when the message is
delivered to the SMS user\'s client.
\- The interworking function shall generate the appropriate charging-related
information and provide the appropriate online charging mechanism (if it is
applied for the SMS and/or SIMPLE IM services) for the interworking services.
\- Functionality is required to be able to select the domain for message
delivery between IMS and CS/PS, and to have the message delivered to the
selected domain.
\- Functionality is required to determine whether to transform the message
format or not, and to performed the transformation of the message format when
determined.
\- The interworking functionality shall be executed in the following cases:
\- The sender is an IM user and the recipient is an SMS user, e.g., the
recipient is not routeable in IMS.
\- The operator policy on the originating side has been set to send the
Instant Messages via SMS.
\- The user preferences and/or the operator policy of the recipient have been
set to receive the incoming Instant Messages via SMS.
\- The sender is an SMS user and the recipient is an IM user.
# 7 Architecture alternatives
Editor\'s Note: This clause will describe and evaluate detailed reference
architectures, including network elements, interfaces and reference points,
suitable to provide SMS-IM service level interworking.
## 7.1 Alternative 1
### 7.1.1 Architectural details
#### 7.1.1.1 Reference architecture
The overall architecture for translation between SMS and IM Messaging is the
same as the architecture for SMS over IP as specified in TS 23.204 [5].
Figure 7.1.1.1: Architecture for providing Service Level (SMS and IM) Inter-
working
#### 7.1.1.2 Reference points
The same reference points as specified in TS 23.204 [5] are employed to
support protocol interworking and translation between SMS and IM Messaging.
#### 7.1.1.3 Functional entities for IP-SM-GW
The IP-SM-GW shall perform all the functions as described in TS 23.204 [5].
The IP-SM-GW shall select the domain for message delivery between IMS and
CS/PS, and shall have the message delivered to the selected domain.
The IP-SM-GW shall determine whether to transform the message format or not,
and shall perform the transformation of the message format when determined.
The IP-SM-GW shall either use the SC address retrieved as part of the
subscriber data from the HSS at registration or as provisioned by
configuration when transforming the Instant Message into Short Message.
In addition, the IP-SM-GW shall perform the authorization for service level
interworking.
#### 7.1.1.4 Procedures
##### 7.1.1.4.1 IM capable UE sends an Instant Message to an SMS user
Figure 7.1.1.4.1: Successful MO Instant Message to SMS procedure
1) The UE registers to S-CSCF according the IMS registration procedure. Note
that I-CSCF and P-CSCF are not shown in this figure.
2) UE submits the Instant Message to the S-CSCF using an appropriate SIP
method.
3) S-CSCF forwards the Instant Message to IP-SM-GW based on stored iFC.
NOTE 1: Subscribers with no subscription for service level interworking will
be provided with the relevant iFCs.
4) The IP-SM-GW shall decide whether to perform service level interworking
depending on SIP request header (e.g., R-URI), operator policy, when the
Instant Message is not routable in the IMS. If IP-SM-GW decided to perform
service level interworking, the IP-SM-GW performs service authorization based
on the stored subscriber data retrieved from the HLR/HSS at the time of the
third party registration procedure as specified in TS 23.204 [5]. The IP-SM-GW
shall check whether the originating subscriber is authorised to use the
interworking service .If the result of service authorization is negative, the
IP-SM-GW shall not forward the message, and shall return the appropriate error
information to the UE in a failure report. Otherwise, the IP-SM-GW shall use
the SC Address in the subscriber data retrieved from the HSS at registration
or provisioned by configuration and translates the Instant Message to the SMS
(SMS- SUBMIT) carrying SC Address, then forwards it towards SC (SC Address)
via the SMS-IWMSC (as described in TS 23.040 [6]). If the size of the content
of the Instant Message is larger than the size of the content that one Short
Message could transfer, the IP-SM-GW shall split the content of the Instant
Message into several parts, translate them to concatenated Short Messages, and
forward the concatenated Short Messages to SC as described in TS 23.040 [6].
5) If service authorization is successful, the IP-SM-GW acknowledges the
Instant Message.
6) Instant Message acknowledgement is forwarded by S-CSCF to UE.
NOTE 2: Steps 5 and 6 can occur anytime after the subscriber authorization
check has been performed by the IP-SM-GW.
7) The SMS-IWMSC forwards the SMS message (SMS- SUBMIT) to the SC (see TS
23.040 [6]).
8) SC sends SUBMIT‑REPORT to SMS-IWMSC (see TS 23.040 [6]).
9) SMS-IWMSC sends SUBMIT‑REPORT to IP-SM-GW (see TS 23.040 [6]).
10) IP-SM-GW translates the received SUBMIT-REPORT to an appropriate IMS
Message, and forwards it to the S-CSCF. If the IP-SM-GW sends concatenated
Short Messages to SC in step 4, the IP-SM-GW should wait the last SUBMIT-
REPORT, and translate the last SUBMIT-REPORT to an appropriate IMS Message,
and forward it to the S-CSCF.
11) S-CSCF sends the translated Instant Message to the UE.
12) UE acknowledges the translated Instant Message.
13) Acknowledgement of the translated Instant Message is forwarded by S-CSCF
to IP-SM-GW.
NOTE 3: As mentioned in Figure 7.2.1.4.1 (similar flow for Alternative 2),
flow might end in step 9, means Steps 10 to 13 occur only if the IM user
requested a delivery report in the message sent in step 2.
##### 7.1.1.4.2 IM user receives short message from an SMS user
An IMS registered user with SIMPLE IM service receives a SM message formatted
via service-level interworking to an Instant Message.
Figure 7.1.1.4.2: Successful SM to Instant Message delivery procedure,
including Successful Delivery Report
1) The UE registers to the S-CSCF according to the IMS registration procedure.
Note that the I-CSCF and P-CSCF are not shown in this figure.
2) The SMS-SC forwards an SM to the SMS-GMSC.
NOTE 1: It is assumed that the message is destined to UE with a Tel-URI,
otherwise HLR/HSS will not be able to resolve the none-msisdn address.
3a) The SMS‑GMSC interrogates the HSS to retrieve routeing information. Based
on the pre-configured IP-SM-GW address for the user, the HSS forwards the
request to the corresponding IP-SM-GW
3b) The HLR/HSS returns the IMSI and the address(es) of the current MSC and/or
SGSN to the IP-SM-GW for delivery of the SM in CS/PS domain.
3c) The IP-SM-GW creates a Correlation Identifier as per TS 23.040 [6], which
associates the Routeing Info retrieval with the subsequent ForwardSM
messages(s), and stores this along with the IMSI of the receiving subscriber.
The IP-SM-GW returns to the SMS-GMSC the address of itself, along with the
Correlation Identifier in the IMSI field, as routeing information.
Alternatively, the IP-SM-GW may return the address(es) of the current MSC
and/or SGSN, in which case, the subsequent procedure to forward the message is
the same as defined in TS 23.040 [6].
4) The SMS-GMSC delivers the short message to the IP-SM-GW in the same manner
that it delivers the short message to an MSC or SGSN, including the
Correlation Identifier received from the IP-SM-GW, in place of the IMSI.
5) The IP-SM-GW checks whether the recipient is authorized for the
interworking service.
NOTE 2: The IP-SM-GW will determine whether the transport level interworking
or the service level interworking is to be preformed based on the users\'
subscription and authorisation, and on the UE capability as indicated during
IMS registration. If the user has subscribed to both services, is authorised
for both and the UE has indicated its capability to receive both encapsulated
Short Messages and Instant messages, the priority between the transport-level
interworking and the service-level interworking is based on operator policy
and user preferences. If the authorization fails for both services, an error
is returned.
6) If the user is authorized to the service level interworking, the IP-SM-GW
converts the SM to an Instant Message. It sends the IM using the appropriate
SIP method towards the S-CSCF.
7) The S-CSCF forwards the Message to the UE.
8) The UE sends a response back to the S-CSCF.
9) The S-CSCF sends the response to the IP-SM-GW.
10) The IP-SM-GW acknowledges the ForwardSM to the SMS-GMSC.
11) The SMS-GMSC may send an SM delivery report status to the HLR/HSS for
either of the following cases:
\- setting of the Message Waiting flags when the ForwardSM was unsuccessful;
\- clearing of the Message Waiting flags in HLR/HSS when the ForwardSM was
successful, but had previously failed.
NOTE 3: See TS 23.040 [6] for a full explanation of when the Message Waiting
flags are set and unset.
12) The SMS-GMSC sends a delivery report (status) to the SMS-SC.
##### 7.1.1.4.3 Concatenated SM messages delivered as an IM large message
An IMS registered user with IM service receives a concatenated short message
delivered as two or more short messages. The received concatenated short
message may or may not exceed the maximum payload size of an Instant Message.
Figure 7.1.1.4.3: Concatenated SMS messages delivered as an IM large message
1) The UE registers to the S-CSCF according to the IMS registration procedure.
Note that the I-CSCF and P-CSCF are not shown in this figure.
2) The SMS-SC forwards an SMS SM that is part of a concatenation of two or
more SMs to the SMS-GMSC.
3a) The SMS‑GMSC interrogates the HSS to retrieve routeing information. Based
on the pre-configured IP-SM-GW address for the user, the HSS forwards the
request to the corresponding IP-SM-GW.
3b) The HLR/HSS returns the IMSI and the address(es) of the current MSC and/or
SGSN to the IP-SM-GW for delivery of the SMS SM in CS/PS domain.
3c) The IP-SM-GW creates a Correlation Identifier as per TS 23.040 [6], which
associates the Routeing Info retrieval with the subsequent ForwardSM
messages(s), and stores this along with the IMSI of the receiving subscriber.
The IP-SM-GW returns to the SMS-GMSC the address of itself, along with the
Correlation Identifier in the IMSI field, as routeing information.
Alternatively, the IP-SM-GW may return the address(es) of the current MSC
and/or SGSN, in which case, the subsequent procedure to forward the message is
the same as defined in TS 23.040 [6].
4) The SMS-GMSC delivers the short message to the IP-SM-GW in the same manner
that it delivers the short message to an MSC or SGSN, including the
Correlation Identifier received from the IP-SM-GW, in place of the IMSI.
5) The IP-SM-GW checks whether the recipient is authorized for the
interworking service. .If the user is authorized to the service level
interworking, the IP-SM-GW recognizes that the received message is part of a
concatenated SMS message and stores the received message.
NOTE 1: The IP-SM-GW will determine whether the transport level interworking
or the service level interworking is to be preformed based on the users\'
subscription and authorisation, and on the UE capability as indicated during
IMS registration. If the user has subscribed to both services, is authorised
for both and the UE has indicated its capability to receive both encapsulated
Short Messages and Instant messages, the priority between the transport-level
interworking and the service-level interworking is based on operator policy
and user preferences. If the authorization fails for both services, an error
is returned.
NOTE 2: The IP-SM-GW needs to have access to a persistance storage in order to
aggregate all the SM parts.
6) The IP-SM-GW acknowledges the ForwardSM to the SMS-GMSC.
7) The SMS-GMSC may send an SM delivery report status to the HLR/HSS for
either of the following cases:
\- setting of the Message Waiting flags when the ForwardSM was unsuccessful;
\- clearing of the Message Waiting flags in HLR/HSS when the ForwardSM was
successful, but had previously failed.
8) The SMS-GMSC sends a delivery report (status) to the SMS-SC.
NOTE 3: steps 7 and 8 need to be verified.
9) The SMS-SC forwards the next SMS SM that is part of a concatenation of two
or more SMs to the SMS-GMSC. If this is not the last SM of the concatenation,
then processing continues at step 4.
10) If this is the last SM of the concatenation then the SMS‑GMSC delivers the
short message to the IP-SM-GW in the same manner that it delivers the short
message to an MSC or SGSN, including the Correlation Identifier received from
the IP-SM-GW, in place of the IMSI.
11) The IP-SM-GW checks whether the recipient is authorized for the
interworking service. If the user is authorized to the service level
interworking, the IP-SM-GW recognizes that the received message is part of a
concatenated SMS message and stores the received message.
NOTE 4: The same interworking service will be authorized as selected in step 5
at this stage in order to have all the concatenated messages sent using the
same message format.
12-13) Once all the segments have been received, the IP-SM-GW establishes an
MSRP session with the recipient\'s UE to deliver the message.The session
invitation is sent to the recipient UE.
NOTE 5: As a matter of implementation efficiency, the IP-SM-GW may initiate
the connection towards the recipient after receiving the first ForwardSM and
passing a service authorization check. This may help prevent timeouts at the
SMS‑GMSC (while it waits for the final ForwardSM Ack) but may also result in
unncessary session initiation signalling if there is a failure in a service
check for subsequently received SMs.
NOTE 6: The IP-SM-GW needs to have access to a persistance storage in order to
aggregate all the SM parts.
14) The IP-SM-GW delivers the message in one or more MSRP SEND requests to the
recipient UE
15) -16) The IP-SM-GW closes the session after message delivery is complete.
17) The IP-SM-GW acknowledges the ForwardSM to the SMS-GMSC.
18) The SMS-GMSC may send an SM delivery report status to the HLR/HSS for
either of the following cases:
\- setting of the Message Waiting flags when the ForwardSM was unsuccessful;
\- clearing of the Message Waiting flags in HLR/HSS when the ForwardSM was
successful, but had previously failed.
NOTE 7: See TS 23.040 [6] for a full explanation of when the Message Waiting
flags are set and unset.
19) The SMS-GMSC sends a delivery report (status) to the SMS-SC.
##### 7.1.1.4.4 Status Report procedure for Instant Message to SMS message
interworking
Figure 7.1.1.4.4: Status report procedure for Instant Message to SMS
interworking
1) The UE has successfully received the short message, and the original
message in the IMS domain requested a Disposition notification.
NOTE 1: A Disposition Notification can be requested in the message sent by the
UE in step 1 as described in IETF IMDN draft-ietf-simple-imdn-06 [9]. If the
requested Disposition Notification by the IM user is a request for a read
notification, the IP-SM-GW ignores the request.
2) The SMS-SC sends a status report to the SMS-GMSC. NOTE: The status report
will, from the SMS-GMSC\'s point of view be treated as any MT SMS delivery.
NOTE 2: The status report is an optional message.
3a) The SMS‑GMSC interrogates the HSS to retrieve routeing information. Based
on the pre-configured IP-SM-GW address for the user, the HSS forwards the
request to the corresponding IP-SM-GW.
3b) The HLR/HSS returns the IMSI and the address(es) of the current MSC and/or
SGSN to the IP-SM-GW for delivery of the SMS SM in CS/PS domain.
3c) The IP-SM-GW creates a Correlation Identifier as per TS 23.040 [6], which
associates the Routeing Info retrieval with the subsequent ForwardSM
messages(s), and stores this along with the IMSI of the receiving subscriber.
The IP-SM-GW returns to the SMS-GMSC the address of itself, along with the
Correlation Identifier in the IMSI field, as routeing information.
Alternatively, the IP-SM-GW may return the address(es) of the current MSC
and/or SGSN, in which case, the subsequent procedure to forward the message is
the same as defined in TS 23.040 [6].
4) The SMS-GMSC sends the status report to the IP-SM-GW.
NOTE 3: Steps 5 to 11 only occur if the original IM requested a delivery
notification in the Disposition Notification.
5) The IP-SM-GW translates and maps the SMS status report into an IM message
carrying a delivery notification as described in the IETF IMDN draft-ietf-
simple-imdn-06 [9]. The IP-SM-GW should keep the message id for a message for
which IMDN was requested so it can send the message id to the UE in the IMDN.
6-7) The IP-SM-GW sends a delivery notification to the S-CSCF, which sends it
to the UE.
8-9) The UE acknowledges receipt of the delivery notification to the S-CSCF.
The S-CSCF sends the acknowledgment to the IP-SM-GW.
10) The IP-SM-GW sends a ForwardSM Ack to the SMS-GMSC.
11) The SMS-GMSC sends an acknowledgement back to the SMS-SC.
##### 7.1.1.4.5 IMS registered user with delivery preferences/operator policy
set to SMS for receiving short messages
In this case, the delivery procedures are the same as described in TS 23.040
[6], clause 10.1.
##### 7.1.1.4.6 Delivery to unregistered subscriber
When a short message is received in the IP-SM-GW for delivery to an IM user,
the IP-SM-GW shall verify the registration status of the IM user. If the user
is not registered in IMS, the delivery of the Instant Message will not be
allowed, to prevent the message from being deferred in the IM system, and
according to operator policy and user preferences, either the message is sent
over CS/PS as described in TS 23.204 [5], or an error indication is sent back
to the SM-SC. In that case, when the IM user registers at a later time, this
information is sent to the SM-SC and the delivery is attempted at that time.
Figure 7.1.1.4.6: Delivery procedure
1) A Short Message is destined to be delivered to an IM user as described in
clause 7.1.1.4.2 steps 2 to 4.
2) The IP-SM-GW checks the registration status of the IM user. This user is
currently not registered for the SMS-IM interworking service and the IP-SM-GW
has determined that the message is not to be delivered over CS/PS, so the IP-
SM-GW sends an SMS‑DELIVERY‑REPORT with an appropriate error code to the SMS-
GMSC.
3) The SMS-GMSC forwards the SMS‑DELIVERY‑REPORT to the SM-SC.
4) The SMS‑GMSC sends a SM Delivery Report Status to the HSS, indicating that
the message failed to be sent by the IP-SM-GW. The HSS records the
corresponding MWD, i.e. the SM‑SC address which stores the un-delivered
message and the failure reason which indicates that the message failed to be
sent by IP‑SM‑GW due to the UE not being available.
5) At any time after the unsuccessful SMS MT delivery procedure, the UE may
register in IMS again, the UE is registered at the S‑CSCF according to the IMS
registration procedures.
6) After the IMS registration is finished, the HLR/HSS checks the user\'s MWD,
and if it is not Null, the HLR/HSS initiates an alert service centre message
to the SM-SC (through the SMS-IWMSC) according to the stored MWD in step 4.
7) Upon receipt of the alert service centre message, the SM‑SC re-attempts to
send the stored short message as described in the clause 7.1.1.4.2.
##### 7.1.1.4.7 AS addressed by PSI receives short message from an SMS user
The SMS-SC forwards a Short Message to the IP-SM-GW, as described in step 2 to
4 of 7.1.1.4.2. The IP-SM-GW checks if the recipient is an AS addressed by a
PSI. If the recipient is an AS addressed by a PSI, the IP-SM-GW sends the
Message to I-CSCF. I-CSCF routes the Message to the AS addressed by the PSI
according to normal PSI routeing procedures. The AS addressed by the PSI sends
a response back to the I-CSCF. The I-CSCF forwards the response to the IP-SM-
GW.
##### 7.1.1.4.8 IM user sends an Instant Message to an SMSIP UE
An IMS registered user with SIMPLE IM service sends an Instant Message via
service-level interworking to an SMSIP MESSAGE to an SMSIP UE, which did not
indicate support for SIMPLE IM when registering to IMS.
NOTE 1: Based upon user subscription and depending on network deployment,
other Application Servers could be processing the incoming Instant Message
before the IP-SM-GW. The behaviour of the IM AS is described in OMA-TS-
SIMPLE_IM-V1_0-20070816-C [8] and TS 24.247 [10].
{width="4.884722222222222in" height="4.126388888888889in"}
Figure 7.1.1.4.8: Successful MT Instant Message to SMSIP MESSAGE procedure
1) IM UE sends an Instant Message to the S-CSCF#1.
2) The S-CSCF#1 forwards the Instant Message to the S-CSCF#2.
3) The S-CSCF forwards the Instant Message to the IP-SM-GW based on iFC.
4) Based on user subscription and authorisation for service-level
interworking, on operator policy and user preferences, and on UE capability
indicated during IMS registration, the IP-SM-GW shall decide whether to
perform the service-level interworking. If the user is subscribed and
authorised for transport-level interworking, and based on UE capability
indicated during IMS registration, and on operator policy and user
preferences, the message may be delivered as an encapsulated Short Message to
the UE over IMS. Otherwise, the Short Message is delivered over CS/PS, as
described in clause 7.1.1.4.10. If the incoming Instant Message requested a
delivery notification, the IP-SM-GW includes the Status Report Request
described in TS 23.040 [6] in the outgoing SMS or SMSIP MESSAGE.
NOTE 2: If a delivery notification was requested in the message sent by the UE
in step 1 as described in IETF IMDN draft-ietf-simple-imdn-06 [9], the
procedure for delivery report described in clause 7.1.1.4.9 applies. Otherwise
IP-SM-GW will just acknowledge, at the SIP level, the Delivery report received
from the SMSIP UE.
5) The IP-SM-GW forwards the SMSIP MESSAGE to the S-CSCF#2.
6) The S-CSCF#2 forwards the SMSIP MESSAGE to the SMSIP UE.
7) The SMSIP UE acknowledges the translated SMSIP MESSAGE.
8) Acknowledgement of the translated SMSIP MESSAGE is forwarded by the S-CSCF
to the IP-SM-GW.
9-11) Acknowledgement of the translated SMSIP MESSAGE is forwarded by the IP-
SM-GW to the originating IM UE.
##### 7.1.1.4.9 Delivery report for an Instant Message delivered as SMSIP
MESSAGE
This procedure follows the procedure described in 7.1.1.4.8, when the original
Instant Message included a delivery notification request.
Figure 7.1.1.4.9: Delivery report after a successful Instant Message to SMSIP
Message procedure
NOTE: An SMSIP MESSAGE has been sent successfully according to the procedure
described in clause 7.1.1.4.8 before the procedure below can be performed.
1-2) The SMSIP UE has received the short message as described in clause
7.1.1.4.8 and sends a SMS-DELIVERY-REPORT to the IP-SM-GW via the S-CSCF.
3-4) The IP-SM-GW acknowledges, at the SIP level, the SMS-DELIVERY-REPORT to
the SMSIP UE via the S-CSCF.
5-7) The IP-SM-GW sends a Delivery Notification to the IM UE.
8-10) The IM UE acknowledges the reception of the Delivery Notification.
##### 7.1.1.4.10 IM capable UE sends an IM to an SMS user with Interworking in
the terminating side
The IM capable UE registers to S-CSCF according to the IMS registration
procedure. Note that the I-CSCF and P-CSCF are not shown in this figure.
Figure 7.1.1.4.10: Successful IM originating to SMS procedure with
Interworking in the Terminating Side
1) UE submits an Instant Message, destined to another IM user in another IMS
domain, using an appropriate SIP method.
2) The S-CSCF resolves the destination domain and routes the message towards
the S-CSCF in the terminating network (\"Terminating S-CSCF\").
3) The terminating S-CSCF forwards the Instant Message to the IM AS
(\"Terminating IM AS\") based on stored iFC.
4) The terminating IM AS invokes terminating IM services as applicable for the
destination IM user.
5) The IM AS can forward the Instant Message back to the terminating S-CSCF,
e.g. the terminating IM user is offline.
6) The terminating S-CSCF forwards the Instant Message to the IP-SM-GW, e.g.
based on stored iFC.
7) If the user is authorized, the IP-SM-GW performs service-level interworking
by converting the IM to SMS. The IP-SM-GW shall obtain the routeing
information for the UE from the HLR/HSS and deliver the message to the UE.
8) The IP-SM-GW obtains the routeing information for the destination UE from
the HLR/HSS.
9) The IP-SM-GW sends the MT Forward SM message to the target MSC.
10) The MSC sends the Short Message to the UE.
11) The UE acknowledges the receipt of the Short Message.
12) The MSC sends Forward SM Ack to the IP-SM-GW.
13) The IP-SM-GW sends OK response to the terminating S-CSCF.
14) The S-CSCF forwards the OK to the terminating IM AS.
15) The terminating IM AS forwards the OK response back to the terminating
S-CSCF.
16) The terminating S-CSCF forwards the OK back towards the originating
S-CSCF.
17) The originating S-CSCF forwards the OK to the originating UE.
### 7.1.2 Impact
### 7.1.3 Assessment
## 7.2 Alternative 2
### 7.2.1 Architectural details
#### 7.2.1.1 Reference architecture
Figure 7.2.1.1: SMS-IM service-level interworking architecture
#### 7.2.1.2 Reference points
The same reference points as specified in TS 23.204 [5] are employed to
support protocol interworking and translation between SMS and IM Messaging.
One new reference point My is proposed in this architecture to allow routeing
to the IP-SM-GW in the originating network.
NOTE: The ISC interface is used only in the terminating network.
##### 7.2.1.2.1 My Reference Point
This reference point allows the Breakout Gateway Control Function (BGCF) to
forward the session signalling to the IP-SM-GW for the purpose of interworking
between the IM and SMS services in the originating network.
The My reference point is based on external specifications, i.e. SIP.
#### 7.2.1.3 Functional Entities IP-SM-GW
The IP-SM-GW shall perform the subscription checking, the authorization for
service level interworking, protocol interworking and the translation between
SMS and IMS messaging. The IP-SM-GW includes the functionality described in TS
23.204 [5].
#### 7.2.1.4 Procedures
##### 7.2.1.4.1 IM user sends an Instant Message to an SMS user
Figure 7.2.1.4.1: Successful MO Instant Message to SMS procedure
1) UE submits the Instant Message to the S-CSCF using the appropriate SIP
method. Initial filter criteria is checked in the S-CSCF for originating
services and routeing towards any application servers takes place. The message
is addressed using a TEL URI for the recipient.
2) After originating services have been executed,. the S-CSCF processes the
Instant Message according to procedures in IMS and since the Request-URI
contains a TEL-URI the S-CSCF performs a database lookup to find the
corresponding SIP URI. If no SIP URI is found, the S-CSCF forwards the message
to the BGCF as described in TS 24.229 [11], clause 5.4.3.2.
3) The BGCF makes the routeing decision depending on SIP request method or any
other information the BGCF may have indicating where to route a particular TEL
URI. In this case, because it is MESSAGE message, it is routed to the IP-SM-
GW.
NOTE: A new interface is needed between the BGCF and the IP-SM-GW.
4) Upon receipt of the Instant Message, the IP-SM-GW performs service
authorization and determines that the message is destined to an SMS recipient.
5) Message accepted information is forwarded by the IP-SM-GW towards the UE.
If the result of service authorization is negative, the IP-SM-GW shall return
the appropriate error response back to the UE; otherwise a successful response
is sent back.
6-7) The response is forwarded back to the UE.
8) When service is authorized, the IP-SM-GW creates the SMS message from the
Instant Message and forwards it towards the SMS-IWMSC using standard MAP
signalling (as described in TS 23.040 [6]).
9) The SMS-IWMSC forwards the SMS message to the SM-SC (see TS 23.040 [6]).
10) The SM-SC sends submit report to the SMS-IWMSC (see TS 23.040 [6]).
11) The SMS-IWMSC sends submit report to the IP-SM-GW (see TS 23.040 [6]).
Steps 12 to 17 occur only if the IM user requested a failure delivery report
in the message sent in step 2, and only if the submit report was actually a
failure report. For a delivery report (successful or failure) sent as a result
of a status report, see the flow in clause 7.1.1.4.4.
Editor\'s Note: Ongoing work in IETF will allow an IM user to request delivery
reports\ (draft-ietf-simple-imdn-06.txt [9]).
12) If the submit report was actually a failure report, the IP-SM-GW maps the
submit report to a failure delivery report and sends it to the S-CSCF, using a
service level mapping of the status information in the submit report to a
failure delivery report.
13-14) S-CSCF sends the report to the UE.
15) The UE acknowledges the report.
16-17) Acknowledgement of the report is forwarded by S-CSCF to IP-SM-GW.
##### 7.2.1.4.2 IM user receives short message from an SMS user
This procedure is identical to the procedure described in clause 7.1.1.4.2.
##### 7.2.1.4.3 Concatenated SM messages delivered as an IM large message
This procedure is identical to the procedure described in clause 7.1.1.4.3.
##### 7.2.1.4.4 Status Report procedure for Instant Message to SMS message
interworking
This procedure is identical to the procedure described in clause 7.1.1.4.4.
##### 7.2.1.4.5 IMS registered user with delivery preferences/operator policy
set to SMS for receiving short messages
This procedure is identical to the procedure described in clause 7.1.1.4.5.
##### 7.2.1.4.6 Delivery to unregistered subscriber
This procedure is identical to the procedure described in clause 7.1.1.4.6.
Upon receipt of the alert service centre message, the SM‑SC re-attempts to
send the stored short message as described in the clause 6.4.
##### 7.2.1.4.7 AS addressed by PSI receives short message from an SMS user
This procedure is identical to the procedure described in clause 7.1.1.4.7.
# 8 Conclusion
It has been identified that the two alternative architectures for the service-
level interworking are identical in the terminating cases, and are only
differing in the originating case (clauses 7.1.1.4.1 and 7.2.1.4.1):
architecture alternative 1 is using iFCs to route the Instant Messages to the
IP-SM-GW, while architecture alternative 2 is going through the BGCF in order
to reach the IP-SM-GW.
It is concluded to include architecture alternative 1 in the normative part of
TS 23.204 [5].
The architecture and flows have been transferred to TS 23.204 [5] and this
Technical Report will not be updated anymore. For an accurate and up-to-date
description of service-level interworking, please refer to TS 23.204 [5].
###### ### Annex A: IM user sends an Instant Message to a group list including
SMS users
Figure A.1: IM user sends an Instant Message to a group list including SMS
users
1) The UE registers to S-CSCF according the IMS registration procedure. Note
that I-CSCF and P-CSCF are not shown in this figure.
2) UE generates Instant Message which includes group information, e.g., Group
identifier in the R-URI and/or recipient list in the body of the Instant
Message. UE submits the Instant Message to the S-CSCF using an appropriate SIP
method.
3) Based on the stored iFC, S-CSCF forwards the Instant Message to an AS in
charge of the group delivery, e.g., the controlling function server defined in
**OMA-TS-SIMPLE_IM-V1_0-** 20070816-C**[8]**.
4) The group delivery AS replicates per Instant Message for per recipient
according to the group information it obtains acting as a B2BUA. See detail in
**OMA-TS-SIMPLE_IM-V1_0-** 20070816-C**[8]**.
5) The group delivery AS sends the generated multiple Instant Messages to
S-CSCF (e.g., the Instant Messages can be delivered as what the list server
does defined in the TS 24.247 [10]).
6) The S-CSCF forwards the Instant Messages to the IP-SM-GW based on the
stored iFC.
7) The IP-SM-GW shall decide whether to perform service level interworking
depending on SIP request header (e.g., R-URI), operator policy, when the
Instant Message is not routable in the IMS. If IP-SM-GW decided to perform
service level interworking, the IP-SM-GW performs service authorization based
on the stored subscriber data as described in the clause XX. The IP-SM-GW
shall check whether the originating subscriber is authorised to use the
interworking service .If the result of service authorization is negative, the
IP-SM-GW shall not forward the message, and shall return the appropriate error
information to the UE in a failure report. Otherwise, the IP-SM-GW shall
translate the IMS message to the SMS (SMS- SUBMIT) and forwards it towards SC
(SC Address) via the SMS-IWMSC (as described in TS 23.040 [6]).
8) If service authorization is successful, the IP-SM-GW acknowledges the
Instant Messages.
9-11) Instant Message acknowledgement is forwarded by S-CSCF to UE.
12) The SMS-IWMSC forwards the SMS messages (SMS- SUBMIT) to the SC (see TS
23.040 [6]).
13) SC sends multiple SUBMIT‑REPORTs to SMS-IWMSC (see TS 23.040 [6]).
14) SMS-IWMSC sends the SUBMIT‑REPORTs to IP-SM-GW (see TS 23.040 [6]).
15) IP-SM-GW translates the received SUBMIT-REPORTs to appropriate IMS
delivery notifications defined in draft-ietf-simple-imdn-06.txt [9], and
forwards the IMS delivery notifications to the S-CSCF.
16) The S-CSCF forwards the IMS delivery notifications to the group delivery
AS.
17) The group delivery AS aggregates the delivery notifications of the same
type from different recipients into a single delivery notification.
18) The group delivery AS sends the delivery notification to the S-CSCF.
19) The S-CSCF forwards the delivery notification to the UE.
20-22) Acknowledgement of the delivery notification is forwarded by S-CSCF to
IP-SM-GW.
###### ### Annex B: Relationship between SMSIP and SMS-IM Interworking
This annex applies to the architecture option described in clause 7.2.1.1.
The Service Level Interworking Functionality uses a very similar architecture
to the one used for the SMSIP functionality. The two functionalities may be
co-located as described in the architecture options in clause 7. However each
one of those functions is responsible for handling messages in different
circumstances.
The key issue is how the S-CSCF handles an Instant Message received from a
user.
It is the S-CSCF that needs to invoke the correct Application server based on
unambiguous criteria.
Two Application Servers in the network may be called upon to handle an Instant
Message:
\- the IM AS;
\- the IP-SM-GW AS.
The following flowchart explains how an Instant Message received from an IMS
subscriber is handled in the network based and which Application Server should
be invoked to handle the message.
When the originating S-CSCF receives an Instant Message from an originating
UE, it should determine the required handling by checking the content type of
the message.
If the content type indicates that it is an encapsulated SMS message (content
type = application/vnd.3gpp.sms) as described in TS 24.341 [12], the message
is routed to the IP-SM-GW for handling.
If not, the Instant Message maybe sent to the IM AS.
NOTE 1: The iFC could be something different such as the feature tag
registered by the client.
At the IM AS, after originating services are executed, the InstantMessage is
sent back to the S-CSCF for routeing.
The S-CSCF executes a DNS/ENUM lookup to find the SIP address of the
recipient. If the S-CSCF finds a SIP address for the recipient, it sends the
Instant Message towards the recipient\'s IMS system for delivery. If not, it
will send the message to the IP-SM-GW for interworking.
Figure B.1: routeing on originating side
NOTE 2: If no IM AS is deployed, the steps in the dashed rectangle are
omitted.
**Routeing on the terminating side:**
When the terminating S-CSCF receives an Instant Message, it should determine
the required handling by checking the content type of the message.
If the content type indicates that it is an encapsulated SMS message (content
type = application/vnd.3gpp.sms) as described in TS 24.341 [12], the message
is routed towards the recipient. Note that in the case of the terminating
network, this message can only be received from an IP-SM-GW (Scenario 6.4) in
TS 23.204 [5].
If not, the Instant Message may be sent to the IM AS.
NOTE 3: The iFC could be something different such as the feature tag
registered by the client.
At the IM AS, after terminating services are executed, the Instant Message is
sent back to the S-CSCF for routeing.
The S-CSCF routes the Instant M message towards the recipient.
If operator policy or user preferences in the terminating system indicate that
the message is to be delivered as SMS, the message is sent to the IP-SM-GW for
delivery as SMS.
Figure B.2: Routeing on terminating side
NOTE 4: If no IM AS is deployed, the steps in the dashed rectangle are
omitted.
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the Stage 2 of the Proximity Services (ProSe)
features in EPS. ProSe features consist of: ProSe discovery (direct or EPC-
level) and ProSe Direct Communication (using E-UTRAN or WLAN direct).
ProSe discovery identifies that ProSe-enabled UEs are in proximity, using
E-UTRAN or EPC.
ProSe Direct Communication enables establishment of communication paths
between two or more ProSe-enabled UEs that are in direct communication range.
The ProSe Direct Communication path could use E-UTRAN or WLAN.
For Public Safety specific usage:
\- ProSe-enabled Public Safety UEs can establish the communication path
directly between two or more ProSe-enabled Public Safety UEs, regardless of
whether the ProSe-enabled Public Safety UE is served by E-UTRAN.
Security aspects of ProSe are defined in TS 33.303 [29].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] Open Mobile Alliance, OMA AD SUPL: \"Secure User Plane Location
Architecture\", (http://www.openmobilealliance.org).
[3] 3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".
[4] Void.
[5] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[6] IETF RFC 4862: \"IPv6 Stateless Address Autoconfiguration\".
[7] IETF RFC 2131: \"Dynamic Host Configuration Protocol\".
[8] IETF RFC 4039: \"Rapid Commit Option for the Dynamic Host Configuration
Protocol version 4 (DHCPv4)\".
[9] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[10] IETF RFC 4861: \"Neighbor Discovery for IP version 6 (IPv6)\".
[11] 3GPP TS 23.221: \"Architectural requirements\".
[12] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[13] Wi-Fi Alliance Technical Committee P2P Task Group, \"Wi-Fi Peer-to-Peer
(P2P) Technical Specification\", Version 1.1.
[14] IEEE Std 802.11-2012: \"IEEE Standard for Information technology \-
Telecommunications and information exchange between systems - Local and
metropolitan area networks - Specific requirements - Part 11: Wireless LAN
Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".
[15] Void.
[16] IETF RFC 3927: \"Dynamic Configuration of IPv4 Link-Local Addresses\".
[17] 3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall
description; Stage 2\".
[18] IETF RFC 3588: \"Diameter Base Protocol\".
[19] IETF RFC 4960: \"Stream Control Transmission Protocol\".
[20] Open Mobile Alliance, OMA LIF MLP: \"Mobile Location Protocol\",
(http://www.openmobilealliance.org).
[21] 3GPP TS 29.343: \"Proximity-services (Prose) Function to Proximity-
services (ProSe) Application Server aspects (PC2); Stage 3\".
[22] 3GPP TS 29.344: \"Proximity-services (Prose) Function to Home Subscriber
Server (HSS) aspects; Stage 3\".
[23] 3GPP TS 29.345: \"Inter-Proximity-services (Prose) Function signalling
aspects; Stage 3\".
[24] 3GPP TS 24.334: \"Proximity-services (Prose) User Equipment (UE) to
Proximity-services (ProSe) Function Protocol aspects; Stage 3\".
[25] 3GPP TS 22.278: \"Service requirements for the Evolved Packet System
(EPS)\".
[26] 3GPP TS 23.468: \"Group Communication System Enablers for LTE (GCSE_LTE);
Stage 2\".
[27] Void.
[28] IETF RFC 826: \"An Ethernet Address Resolution Protocol\".
[29] 3GPP TS 33.303: \"Proximity-based Services (ProSe); Security aspects\".
[30] OMA-TS-DM_Protocol-V1_2: \"OMA Device Management Protocol\".
[31] 3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile
Station (MS) in idle mode\".
[32] 3GPP TS 36.304: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
User Equipment (UE) procedures in idle mode\".
[33] 3GPP TS TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC); Protocol specification\".
[34] 3GPP TS TS 29.272: \"Mobility Management Entity (MME) and Serving GPRS
Support Node (SGSN) related interfaces based on Diameter protocol\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**Application ID:** A globally unique identifier identifying a specific
application. This is the identifier used in mobile operating systems by the
applications within the mobile operating system. All mobile operating systems
have namespaces that identify the applications within the mobile operating
system.
**Application Layer User ID:** An identity identifying a user within the
context of a specific application (e.g. alice@social.net). The format of this
identifier is outside the scope of 3GPP.
**Destination Layer-2 ID:** A link-layer identity that identifies a device or
a group of devices that are recipients of ProSe communication frames.
**Discovery Filter:** A container of a ProSe Application code, zero or more
ProSe Application Mask(s) and Time To Live value. These are used by the
monitoring UE to match ProSe Application Codes that are received on the PC5
interface for Direct Discovery.
**EPC ProSe User ID:** An identifier for EPC-level ProSe Discovery and EPC
support for WLAN direct communication that uniquely identifies a UE registered
for ProSe. This identifier can be occasionally reassigned by the ProSe
Function.
**EPC-level ProSe Discovery:** A ProSe Discovery procedure by which the EPC
determines the proximity of two ProSe-enabled UEs and informs them of their
proximity.
**Geographical Area:** The Geographical Area identifies a region, whose
borders are defined by means of suitable geographic coordinates of e.g. a
polygon or circle outlining its borders.
**Local PLMN:** A PLMN which is not the serving PLMN of the monitoring UE, and
in whose radio resources the monitoring UE is authorized by the HPLMN to
engage in ProSe Direct Discovery.
**Model A:** involves one UE announcing \"I am here\"
**Model B:** involves one UE asking \"who is there\" and/or \"are you there\"
**ProSe Application ID:** The ProSe Application ID is an identity used for
ProSe Direct Discovery, identifying application related information for the
ProSe-enabled UE. Each ProSe Application ID could be globally unique, e.g. in
case of open Direct Discovery.
**ProSe Application Code:** The ProSe Application Code is associated with the
ProSe Application ID and used in the discovery procedures.
**ProSe Application Mask:** The ProSe Application Mask is provided by the
ProSe Function in order to allow the monitoring UE to perform partial matching
of ProSe Application Codes on the PC5 interface.
**ProSe Direct Communication:** A communication between two or more UEs in
proximity that are ProSe-enabled, by means of user plane transmission using
E-UTRA technology via a path not traversing any network node.
**ProSe Direct Discovery:** A procedure employed by a ProSe-enabled UE to
discover other ProSe-enabled UEs in its vicinity by using only the
capabilities of the two UEs with E-UTRA technology.
**ProSe Discovery:** A process that identifies that a UE that is ProSe-enabled
is in proximity of another, using E-UTRA or EPC.
**ProSe Function ID:** An FQDN that identifies a ProSe Function.
**ProSe Layer-2 Group ID:** A layer-2 group identifier that may be used to
address a set of users at the 3GPP lower layers. This ID needs to be
configured in the UE before enabling one-to-many ProSe Direct Communication.
**ProSe-enabled non-Public Safety UE:** A UE that supports ProSe procedures
but not capabilities specific to Public Safety.
**ProSe-enabled Public Safety UE:** A UE that the HPLMN has configured to be
authorized for Public Safety use, and which is ProSe-enabled and supports
ProSe procedures and capabilities specific to Public Safety. The UE may, but
need not, have a USIM with one of the special access classes {12, 13, 14}.
**ProSe-enabled UE:** A UE that supports ProSe requirements and associated
procedures. Unless explicitly stated otherwise, a Prose-enabled UE refers both
to a non-Public Safety UE and a Public Safety UE.
**Source Layer-2 ID:** A link-layer identity that identifies a device that
originates ProSe communication frames.
**WLAN Link Layer ID:** A link layer identity used for WLAN direct discovery
and/or WLAN direct communication. Depending on the WLAN technology it can be
temporary (e.g. temporary MAC address) or permanent (e.g. permanent MAC
address). The format of this identifier depends on the WLAN technology and is
outside of 3GPP scope.
For the purposes of the present document, the following terms and definitions
given in TS 22.278 [25] apply:
**Open ProSe Discovery**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
ALUID Application Layer User ID
DPF Direct Provisioning Function
EPUID EPC ProSe User ID
PFID ProSe Function ID
ProSe Proximity-based Services
SLP SUPL Location Platform
SUPL Secure User Plane Location
TTL Time to Live
WLLID WLAN Link Layer ID
# 4 Architecture Model and Concepts
## 4.1 General Concept
Proximity Services (ProSe) are services that can be provided by the 3GPP
system based on UEs being in proximity to each other.
The 3GPP system enablers for ProSe include the following functions:
\- EPC-level ProSe Discovery;
\- EPC support for WLAN direct discovery and communication;
\- Direct discovery;
\- Direct communication;
## 4.2 Architectural Reference Model
Figure 4.2-1 shows the high level view of the non-roaming architecture. In
this figure, UE A and UE B use a subscription of the same PLMN.
Figure 4.2-1: Non-Roaming Reference Architecture
The following figure 4.2-2 show the high level view of the non-roaming inter-
PLMN architecture. In this figure, PLMN A is the HPLMN of UE A and PLMN B is
the HPLMN of UE B.
Figure 4.2-2: Inter-PLMN Reference Architecture
Figure 4.2-3 shows the high level view of the roaming architecture. In this
figure, UE A uses a subscription of PLMN A and UE B uses a subscription of
PLMN B; UE A is roaming in PLMN C while UE B is not roaming.
Figure 4.2-3: Roaming Reference Architecture
NOTE: For EPC-level ProSe discovery the roaming architecture is not specified
in this release.
## 4.3 Reference points
### 4.3.1 List of Reference Points
**PC1** : The reference point between the ProSe application in the UE and in
the ProSe Application Server. It is used to define application level
signalling requirements. This reference point is not specified in this release
of the specification.
**PC2** : The reference point between the ProSe Application Server and the
ProSe Function. It is used to define the interaction between ProSe Application
Server and ProSe functionality provided by the 3GPP EPS via ProSe Function
(e.g. name translation) for EPC-level ProSe discovery.
**PC3** : The reference point between the UE and the ProSe Function. PC3
relies on EPC user plane for transport (i.e. an \"over IP\" reference point).
It is used to authorise ProSe Direct Discovery and EPC-level ProSe Discovery
requests, and perform allocation of ProSe Application Codes corresponding to
ProSe Application Identities used for ProSe Direct Discovery. It is used to
define the authorisation policy per PLMN for ProSe Direct Discovery (for
Public Safety and non -Public Safety) and communication (for Public Safety
only) between UE and ProSe Function.
**PC4a** : The reference point between the HSS and ProSe Function. It is used
to provide subscription information in order to authorise access for ProSe
Direct Discovery and ProSe Direct Communication on a per PLMN basis. It is
also used by the ProSe Function (i.e. EPC-level ProSe Discovery Function) for
retrieval of EPC-level ProSe Discovery related subscriber data.
**PC4b** : The reference point between the SUPL Location Platform (SLP)
defined in OMA AD SUPL [2] and the ProSe Function. It is used by the ProSe
Function (i.e. EPC-level ProSe Discovery Function) (in the role of LCS client
to query the SLP defined in OMA AD SUPL [2].
**PC5** : The reference point between ProSe-enabled UEs used for ProSe Direct
Discovery and ProSe Direct Communication.
**PC6** : The reference point between ProSe Functions in different PLMNs (EPC-
level ProSe Discovery) or between the ProSe Function in the HPLMN and the
ProSe Function in a Local PLMN (ProSe Direct Discovery). With ProSe Direct
Discovery this reference point is used for HPLMN control of ProSe service
authorization. It is also used to authorise ProSe Direct Discovery requests,
retrieve the Discovery Filter(s) corresponding ProSe Application ID name(s)
and translate the ProSe Application Code to the ProSe Application ID Name.
**PC7** : The reference point between the ProSe Function in the HPLMN and the
ProSe Function in the VPLMN. It is used for HPLMN control of ProSe service
authorization. It is also used to authorise ProSe Direct Discovery requests,
retrieve the Discovery Filter(s) corresponding ProSe Application ID name(s)
and translate the ProSe Application Code to the ProSe Application ID Name.
**S6a** : In addition to the relevant functions defined in TS 23.401 [5] for
S6a, in case of ProSe S6a is used to download ProSe related subscription
information to MME during E-UTRAN attach procedure or to inform MME
subscription information in the HSS has changed.
**S1-MME:** In addition to the relevant functions defined in TS 23.401 [5] for
S1-MME, in case of ProSe it is also used to convey the ProSe direct services
authorization from MME to eNodeB.
## 4.4 Functional Entities
### 4.4.1 ProSe Function
#### 4.4.1.1 General
The ProSe Function is the logical function that is used for network related
actions required for ProSe. The ProSe Function plays different roles for each
of the features of ProSe. In this version of the specification it is assumed
that there is only one logical ProSe Function in each PLMN that supports
Proximity Services.
NOTE: If multiple ProSe Functions are deployed within the same PLMN (e.g., for
load reasons), then the method to locate the ProSe Function that has allocated
a specific ProSe Application Code (e.g. through a database lookup, etc.) is
not defined in this version of the specification.
Figure 4.4.1-1: UE to ProSe Function Interfaces for each sub-function
Figure 4.4.1-2: ProSe Function Interfaces to other network elements and PLMNs
The ProSe Function consists of three main sub-functions that perform different
roles depending on the ProSe feature:
\- Direct Provisioning Function (DPF) is used to provision the UE with
necessary parameters in order use ProSe Direct Discovery and Prose Direct
Communication. It is used to provision the UEs with PLMN specific parameters
that allow the UE to use ProSe in this specific PLMN. For direct communication
used for Public Safety DPF is also used to provision the UE with parameters
that are needed when the UE is not served by E-UTRAN.
\- Direct Discovery Name Management Function is used for open Prose Direct
Discovery to allocate and process the mapping of ProSe Applications IDs and
ProSe Application Codes used in ProSe Direct Discovery. It uses ProSe related
subscriber data stored in HSS for authorisation for each discovery request. It
also provides the UE with the necessary security material in order to protect
discovery messages transmitted over the air.
\- EPC-level Discovery ProSe Function has a reference point towards the
Application Server (PC2), towards other ProSe Functions (PC6), towards the HSS
(PC4a) and the UE (PC3). The functionality includes the following:
\- Storage of ProSe-related subscriber data and/or retrieval of ProSe-related
subscriber data from the HSS;
\- Authorization and configuration of the UE for EPC-level ProSe Discovery and
EPC-assisted WLAN direct discovery and communication over PC3;
\- Storage of a list of applications that are authorized to use EPC-level
ProSe Discovery and EPC-assisted WLAN direct discovery and communication;
\- Acting as location services client (SLP agent) to enable EPC-level ProSe
Discovery;
\- Providing the UE with information to assist WLAN direct discovery and
communications;
\- Handling of EPC ProSe User IDs and Application Layer User IDs;
\- Exchange of signalling with 3^rd^ party Application Servers over PC2
reference point for application registration and identifier mapping;
\- Exchange of signalling with ProSe Functions in other PLMNs over PC6
reference points for sending proximity requests, proximity alerts and location
reporting;
\- Optional support for functionality for requesting UE location via the HSS.
The ProSe Function provides the necessary charging and security functionality
for usage of ProSe (both ProSe via the EPC and for ProSe Direct Discovery,
ProSe Direct Communication and WLAN direct discovery and communication).
NOTE: The ProSe Function in HPLMN can be always reached if Home Routed
configuration is applied for PDN connection (e.g. PDN GW is located in the
HPLMN), when such function is supported by the HPLMN. In case of Local
Breakout (e.g. PDN GW is located in the VPLMN), a ProSe Proxy Function can be
deployed by the VPLMN to support UE to Home ProSe Function communication, if
inter-PLMN signalling is required. Whether a PDN connection is provided by
Local Breakout or Home Routed is determined by the HSS configuration described
in 3GPP TS 23.401 [5]. UE is not aware of this and as such will not know which
APN can be used for communication with ProSe Function unless specific APN
information is configured in the UE indicating that this APN provides
signalling connectivity between the UE and the Home ProSe Function.
#### 4.4.1.2 ProSe Function Discovery
The ProSe Functions of HPLMN is discovered through interaction with the Domain
Name Service function. The FQDN of a ProSe Function in the Home PLMN may
either be pre-configured on the UE or provisioned by the network or self-
constructed by the UE, e.g. derived from PLMN ID of the HPLMN. The IP address
of a ProSe Function in the Home PLMN may also be provisioned to the UE.
### 4.4.2 UE
Any ProSe-enabled UE may support the following functions:
\- Exchange of ProSe control information between ProSe-enabled UE and the
ProSe Function over PC3 reference point.
\- Procedures for open ProSe Direct Discovery of other ProSe-enabled UEs over
PC5 reference point.
The ProSe-enabled Public Safety UE may support the following functions:
\- Procedures for one-to-many ProSe Direct Communication over PC5 reference
point.
\- Configuration of parameters (e.g. including IP addresses, ProSe Layer-2
Group IDs, Group security material, radio resource parameters). These
parameters can be pre-configured in the UE, or, if in coverage, provisioned by
signalling over the PC3 reference point to the ProSe Function in the network.
### 4.4.3 Void
### 4.4.4 ProSe Application Server
The ProSe Application Server supports the following capability:
\- Storage of EPC ProSe User IDs and ProSe Function IDs;
\- Mapping of Application Layer User IDs and EPC ProSe User IDs.
### 4.4.5 MME
In addition to the function defined in TS 23.401 [5] in case of ProSe MME
performs the following functions:
\- receives subscription information related to ProSe from HSS;
\- provides indication to E-UTRAN that the UE is authorized to use ProSe.
## 4.5 High Level Function
### 4.5.1 Provisioning for ProSe Direct Discovery and ProSe Direct
Communication
#### 4.5.1.1 Authorization and provisioning for ProSe
##### 4.5.1.1.1 General
The basic principles of service authorization for ProSe Direct Discovery and
ProSe Direct Communication are as follows:
\- the UE gets authorization to use ProSe Direct Discovery on a per PLMN
basis.
\- the UE gets authorization to use ProSe Direct Communication on a per PLMN
basis in the serving PLMN by the ProSe Function in the HPLMN,
\- the ProSe Function in the HPLMN requests authorisation information from the
ProSe Function of the serving PLMN and Local PLMN(s).
NOTE: The UE does not need to be registered in the Local PLMN.
\- The ProSe Function in the HPLMN merges authorization information from home,
serving and local PLMNs.
\- Final authorization always comes from the ProSe Function in the Home PLMN.
The ProSe Function in the Local PLMN or the VPLMN or HPLMN may revoke the
authorization at any time. The ProSe Function in the HPLMN shall be notified
when authorization is revoked by the Local PLMN or the VPLMN.
OMA DM [30] is used as the protocol to provision ProSe related configuration
and authorization information in the ME. Provisioning is performed via the PC3
reference point.
##### 4.5.1.1.2 Provisioning information for ProSe Direct Discovery and ProSe
Direct Communication
##### 4.5.1.1.2.1 General {#general-2 .H6}
The following information can be contained in the authorisation info that is
provided by the ProSe Function to the UE for authorisation of using ProSe
Direct Discovery and ProSe Direct Communication in a particular PLMN.
##### 4.5.1.1.2.2 Authorisation for ProSe Direct Discovery {#authorisation-
for-prose-direct-discovery .H6}
The following information is provisioned to the UE for ProSe Direct Discovery
authorisation:
1) ProSe Direct Discovery monitoring authorisation policy:
\- PLMNs in which the UE is authorised to perform ProSe Direct Discovery
monitoring.
2) ProSe Direct Discovery announcing authorisation policy:
\- PLMNs in which the UE is authorized to perform announcing.
\- Authorised discovery range for announcing per PLMN.
##### 4.5.1.1.2.3 Provisioning for ProSe Direct Communication (Public Safety
UE) {#provisioning-for-prose-direct-communication-public-safety-ue .H6}
##### 4.5.1.1.2.3.1 General {#general-3 .H6}
The content of clause 4.5.1.1.2.3 is applicable to ProSe-enabled Public Safety
UEs only.
Clause 3 provides the definition of a ProSe-enabled Public Safety UE. To
comply with international and national regulations, the HPLMN shall endeavour
to ensure that the UE only uses the specific Public Safety capabilities in
territories in which the HPLMN is authorised to permit such rights to the UE.
For Public Safety usage the operator may pre-configure ProSe-enabled Public
Safety UEs with the required provisioning parameters for ProSe Direct
Communication, without the need for the ProSe-enabled Public Safety UEs to
connect to the ProSe Function to get this initial configuration. The following
apply:
\- The provisioning parameters for ProSe Direct Communication may be
configured in the UICC, in the ME, or in both the UICC and the ME.
\- The UICC shall indicate whether the UE is authorized to use provisioning
parameters.
\- ProSe Direct Communication shall be accessible only when a USIM authorized
for ProSe Direct Communication is selected.
\- The ME provisioning parameters shall not be erased when a USIM is
deselected or replaced.
\- If both the USIM and the ME contain the same set of provisioning
parameters, the set of parameters from the UICC shall take precedence.
\- The UE shall use radio resources for ProSe Direct Communication as follows:
\- While a UE has a serving cell and is camped on a cell and the UE intends to
use for ProSe the radio resources (i.e. carrier frequency) operated by this
cell, then the UE shall use the radio resource description indicated by this
cell the UE is camped on and ignore any radio resource description of the same
radio resource provisioned in the ME or the UICC. If the cell does not provide
radio resources for ProSe, the UE shall not perform ProSe transmission and
reception on radio resources operated by this cell.
\- If the UE intends to use radio resources (i.e. carrier frequency) for ProSe
that are not operated by the UE\'s serving cell or if the UE is out of
coverage, the UE shall search for a cell in any PLMN that is operating the
provisioned radio resources (i.e. carrier frequency) as defined in TS 36.300
[17] and TS 36.304 [32], and:
\- If the UE finds such cell in the registered PLMN or a PLMN equivalent to
the registered PLMN, and authorisation for ProSe Direct Communication to this
PLMN is confirmed, the UE shall use the radio resource description indicated
by that cell. If that cell does not provide radio resources for ProSe, the UE
shall not perform ProSe transmission and reception on those radio resources.
\- If the UE finds such cell but not in the registered PLMN or a PLMN
equivalent to the registered PLMN, and that cell belongs to a PLMN authorised
for ProSe Direct Communication and provides radio resources for ProSe then the
UE shall perform PLMN selection triggered by ProSe Direct Communication as
defined in TS 23.122 [31].
\- If the UE finds such cell but not in a PLMN authorised for ProSe Direct
Communication the UE shall not use ProSe.
\- If the UE does not find any such cell in any PLMN, then the UE shall use
radio resources provisioned in the ME or the UICC. If no such provision exists
in the ME or the UICC or the provision does not authorise ProSe Direct
Communication then the UE is not authorised to transmit.
\- The UE provisioning shall support setting Geographical Areas.
NOTE 1: It is possible for a UE to use other radio resources for ProSe based
on the Geographical Area instead of those operated by the serving E‑UTRAN
cell, when provisioned in the UE, even if the UE\'s serving cell offers normal
service and the ProSe SIB indicates that the service (communication) is
available. This is to cover the scenario when e.g. the radio resources used
for ProSe Direct Communication are not owned by the serving network of the UE.
NOTE 2: The UE can only use ProSe Direct Communication when it contains a UICC
that has been configured for ProSe, i.e. the selected USIM indicates that the
UE is authorized to use the provisioning parameters for ProSe.
NOTE 3: The scenario that a cell is detected and the cell does not provide
support for ProSe Direct Communications when the UE attempts to use a carrier
frequency configured for ProSe Direct Communication, is considered a
configuration error. Therefore the UE does not transmit on that frequency to
avoid interference to the network.
\- The ProSe Direct Communication is only specified for E-UTRA.
NOTE 4: It is out of scope of the present specification to define how the UE
can locate itself in a specific Geographical Area. When the UE is in coverage
of a 3GPP RAT, it can for example, use information derived from the serving
PLMN. When the UE is not in coverage of a 3GPP RAT, it can use other
techniques, including user provided location, as determined by local
regulations.
##### 4.5.1.1.2.3.2 Void {#void-1 .H6}
##### 4.5.1.1.2.3.3 Provisioning information for one-to-many ProSe Direct
Communication {#provisioning-information-for-one-to-many-prose-direct-
communication .H6}
NOTE 1: ProSe Direct Communication one-to-one is not specified in this version
of the 3GPP specifications.
The following information is provisioned to the UE for one-to-many ProSe
Direct Communication:
1) Authorisation policy:
\- When the UE is \"served by E-UTRAN\":
\- PLMNs in which the UE is authorised to perform one-to-many ProSe Direct
Communication.
\- When the UE is \"not served by E-UTRAN\":
\- Indicates whether the UE is authorised to perform one-to-many ProSe Direct
Communication procedures when \"not served by E-UTRAN\".
2) ProSe Direct Communication policy/parameters:
\- Include the parameters that enable the UE to perform one-to-many ProSe
Direct Communication when provisioned from DPF in ME or configured in UICC:
\- ProSe Layer-2 Group ID;
\- ProSe Group IP multicast address
\- Indication whether the UE should use IPv4 or IPv6 for that group
\- For a specific Group configured to operate using IPv4, optionally an IPv4
address to be used by the UE as a source address. If none is provisioned, then
the UE shall use Dynamic Configuration of IPv4 Link-Local Addresses IETF RFC
3927 [16] to obtain a link local address for the Group.
\- Include group security related content for one-to-many ProSe Direct
Communication.
NOTE 2: More details on the necessary security aspect will be defined in SA3
specifications.
\- Alternatively these parameters can be provided from the 3rd party public
safety provider application server (e.g. GCS AS as in TS 23.468 [26]). If UE
receives the same set of data from AS that has been previously provided by DPF
then UE uses the data set provided by AS for one-to-many ProSe Direct
Communication.
3) Radio parameters for when the UE is \"not served by E-UTRAN\":
\- Includes the radio parameters with Geographical Area(s) that need to be
configured in the UE in order to be able perform one-to-many ProSe Direct
Communication procedures when \"not served by E-UTRAN\". These radio
parameters (e.g. frequency bands) are defined in TS 36.331 [33]. The UE uses
the radio parameters only if the UE can locate itself in the corresponding
Geographical Area. Otherwise, the UE is not authorised to transmit.
NOTE 3: The \"not served by E-UTRAN\" cover the cases when the UE is not
served by the E-UTRAN cell operating on the carrier frequency provisioned for
ProSe Direct Communication.
##### 4.5.1.1.2.3.4 Void {#void-2 .H6}
### 4.5.2 Subscription to ProSe
The user\'s profile in the HSS contains the subscription information to give
the user permission to use ProSe.
At any time, the operator can remove the ProSe UE subscription rights from
user\'s profile in the HSS, and revoke the user\'s permission to use ProSe.
The following subscription information is defined for ProSe:
\- subscription for ProSe Direct Discovery.
\- subscription for EPC-level ProSe Discovery.
\- subscription for EPC support WLAN direct discovery and communication.
\- subscription for one-to-many ProSe Direct Communication, applicable only to
ProSe-enabled Public Safety UEs.
Additional parameters related to the ProSe Direct service may be stored in the
user\'s profile, such as:
\- the list of the PLMNs where the UE is authorised for Direct Discovery, i.e.
to announce or monitor or both.
\- the list of the PLMNs where the UE is authorised to perform one-to-many
ProSe Direct Communication.
### 4.5.3 IP address allocation
For one-to-many ProSe Direct Communication:
\- when the UE is configured to use IPv6 on the direct link, the UE auto-
configures a link local IPv6 Address following procedures defined in RFC 4862
[6]. This address can only be used as the source IP address for one-to-many
ProSe Direct Communication.
\- when the UE is configured to use IPv4 for a certain Group for one-to-many
ProSe Direct Communication, then either it uses the configured IPv4 address
for the Group or, if it is not configured with an address for the Group, it
uses Dynamic Configuration of IPv4 Link-Local Addresses IETF RFC 3927 [16].
### 4.5.4 Void
### 4.5.5 ProSe Proxy Function
ProSe Proxy Function enables support for UE to Home ProSe Function/ProSe Key
Management Function communication as defined in clause 4.4.1.1 and in TS
33.303 [29], where the Home ProSe Function/ProSe Key Management Function is
not located in the same network as the PDN GW for the PDN connection being
used. Such proxy functions are needed when requirements on security are not
met by signalling over Internet. Inter-PLMN signalling may be used in that
case. Due to restrictions on the inter-PLMN network, the UE to Server traffic
over the user plane may not be sent between networks directly. Only tunnelled
server to server traffic may be sent between networks.
A roaming UE, which has a Local Breakout PDN Connection in the VPLMN, uses
this access to reach a ProSe Function in the Home network and a ProSe Key
Management Function in the Home network or another network. UE is not aware of
the presence of a ProSe Proxy Function.
A ProSe Proxy implemented in the VPLMN on the SGi interface may be used to
reach the ProSe Function located in the HPLMN. The ProSe Proxy Function
forwards signalling traffic between the UE and the ProSe Function in the
HPLMN.
A ProSe Proxy implemented in either the HPLMN or the VPLMN on the SGi
interface may be used to reach a ProSe Key Management Function located in a
different PLMN. The ProSe Proxy Function forwards the signalling traffic (as
defined in clause 6.2.2.3.1 in TS 33.303 [29]) between the UE and the ProSe
Key Management Function.
### 4.5.6 Support for ProSe for UEs in limited service state
ProSe-enabled non-Public Safety UE shall not use ProSe when in limited service
state.
ProSe-enabled Public Safety UEs that are authorised to use ProSe Direct
Communication shall be able to use ProSe Direct Communication when in limited
service state following the procedures defined in clause 4.5.1.1.2.3.1 for
ProSe Direct Communication when the UE enters in limited service state:
\- because it cannot find a suitable cell of the selected PLMN as described in
TS 23.122 [31] or
\- as the result of receiving one of the following reject reasons defined in
TS 23.122 [31]:
\- a \"PLMN not allowed\" response to a registration request or;
\- a \"GPRS not allowed\" response to a registration request
A ProSe-enabled Public Safety UE in limited service state shall only use ProSe
mechanisms available in ECM-IDLE, for details see TS 36.300 [17].
A ProSe-enabled Public Safety UE in limited service state shall not use ProSe
in ECM-CONNECTED mode.
ProSe-enabled Public Safety UEs shall not use ProSe Direct Communication if
the UE has entered in limited service state due to all other situations (e.g.
no SIM in the MS, an \"illegal MS\" or \"illegal ME\" response to a
registration request, or an \"IMSI unknown in HLR\" response to a registration
request) defined in TS 23.122 [31], where the UE is unable to obtain normal
service from a PLMN.
## 4.6 Identifiers
### 4.6.1 Identifiers for EPC-level ProSe Discovery
The following identities are used for EPC-level ProSe Discovery: EPC ProSe
User ID, Application Layer User ID and Application ID.
The ProSe Function is identified by an FQDN that the UE constructs using the
HPLMN ID.
### 4.6.2 Identifiers for EPC support for WLAN direct discovery and
communication
The following identifier is used in addition to those in clause 4.6.1 for EPC
support for WLAN direct discovery and communication: WLAN Link Layer ID.
### 4.6.3 Identifiers for ProSe Direct Communication
#### 4.6.3.1 ProSe UE ID
This is a link layer identifier that is used as a source Layer-2 ID in all the
packets the UE sends for one-to-many ProSe Direct Communication.
When bearer-level security is configured to be used, the ProSe UE ID is
assigned by the ProSe Key Management Function as defined in TS 33.303 [29].
The ProSe Key Management Function ensures that the ProSe UE ID is unique in
the context of one-to-many ProSe Direct Communication for this group.
When bearer-level security is configured not to be used (including the case of
Layer-2 broadcast communication required to support Dynamic Configuration of
IPv4 Link-Local Addresses IETF RFC 3927 [16]), the ProSe UE ID is either
configured in the UE or self-assigned by the UE.
Assuming that global uniqueness of ProSe UE ID cannot be ensured, the UE
should be prepared to handle conflicts of ProSe UE IDs using mechanisms that
are out of scope of this release of the specification (e.g. by self-assigning
a new ProSe UE ID when a conflict is detected).
#### 4.6.3.2 ProSe Layer-2 Group ID
This is a link layer identifier that identifies the group in the context of
one-to-many ProSe Direct Communication. It is used as a destination Layer-2 ID
in all the packets the UE sends to this group for one-to-many ProSe Direct
Communication.
### 4.6.4 Identifiers for ProSe Direct Discovery
#### 4.6.4.1 ProSe Application ID
For Open ProSe Discovery, (as described in 3GPP TS 22.278 [25]) the ProSe
Application ID is called the Public ProSe Application ID. The geographic scope
of the Public ProSe Application ID may be PLMN-specific, country specific or
global.
Each Public ProSe Application ID is composed of the following parts:
a. The ProSe Application ID Name is described in its entirety by a data
structure characterized by different levels e.g., broad-level business
category (Level 0) / business sub-category (Level 1) / business name (Level 2)
/ shop ID (Level 3). For the purpose of presentation, a ProSe Application ID
Name is usually displayed as a string of labels in which the labels represent
hierarchical levels.
b. The PLMN ID that corresponds to the PLMN that assigned the ProSe
Application ID Name.
NOTE: If the Public ProSe Application ID is country specific then the Mobile
Network Code (MNC) of the PLMN ID is wild carded. If global, both the MCC and
MNC are wild carded. The use of wild carded ProSe Application IDs is further
explained in Annex B.
#### 4.6.4.2 ProSe Application Code
For the announcing UE, the ProSe Application Code is obtained from the HPLMN
ProSe Function using the Announce Request procedure (see clauses 5.3.3.1 and
5.3.3.2). The ProSe Application Code is contained in the message that is
actually transmitted over the radio interface (on PC5) by a UE engaged in the
ProSe Direct Discovery procedure (see clause 5.3) to \"monitoring\" UEs.
For the \"monitoring\" UE, Discovery Filter(s) to monitor the ProSe
Application Code(s) over the radio interface (on PC5) are obtained from the
HPLMN ProSe Function using the Monitor Request procedure (see clauses 5.3.3.4
and 5.3.3.5).
Each ProSe Application Code is composed of the following parts:
a. A temporary identity that corresponds to the ProSe Application ID Name.
Given the data structure associated with the Public ProSe Application ID, each
ProSe Application ID can be associated with various temporary identities that
contains as many identifiers as there are levels in the corresponding ProSe
Application ID Name: this allows partial matching at the monitoring UE side
using a ProSe Application Mask (see clause 4.6.4.2b) or a Discovery Filter,
making more effective and flexible the filtering of the received temporary
identity in a monitoring UE. See clause 4.6.4.2a..
b. The PLMN ID of the ProSe Function that assigned the ProSe Application Code,
i.e. Mobile Country Code (MCC) and Mobile Network Code (MNC).
NOTE 1: In this version of the specification the ProSe Application Code is
always assigned by a HPLMN ProSe Function.
ProSe Application Code matching considers all components listed above. In
ProSe Application Code matching, the \"monitoring\" UE shall consider it a
full match, if both PLMN ID and temporary identity match with the
corresponding contents of the Discovery Filter. A partial match is obtained if
the PLMN ID matches fully and the temporary identity matches partially with
the corresponding contents of the ProSe Application Mask (see clause
4.6.4.2b).
A ProSe Application Code is allocated per \"announcing\" UE and per
application and has an associated validity timer that runs both in the ProSe
Function and in the UE.
NOTE 2: In this Release of the specification it is not possible to revoke an
assigned ProSe Application Code to announcing UE before the expiry of the
validity timer.
In case of Open ProSe Discovery:
\- when the \"announcing\" UE wants to announce something, it shall send a
Discovery Request containing the Public ProSe Application ID to the ProSe
Function, and the ProSe Function assigns a ProSe Application Code.
\- when the \"monitoring\" UE wants to monitor something, it shall send a
discovery request containing the full or a subset of the Public ProSe
Application ID, e.g. it may provide 2 out of the n levels of the full Public
ProSe Application ID.
NOTE 3: The ProSe Application ID Name data structure is not expected to change
often.
#### 4.6.4.2a Discovery Filter
A Discovery Filter consists of ProSe Application Codes, ProSe Application
Mask(s) and a time to live (TTL). A TTL indicates for how long the related
Discovery Filter is valid after it is received.
NOTE: In order for the ProSe Application Mask not to change often, the ProSe
Application Mask does not extend to the last level of the corresponding Prose
Application ID data structure (typically the leaf, i.e. the lowest level).
A Discovery Filter is provided to a monitoring UE by its HPLMN ProSe Function.
It is used by the monitoring UE to selectively match ProSe Application Codes
received on the PC5 interface.
Discovery Filters allow full matching and partial matching of as many parts of
ProSe Application Code as are contained in the ProSe Application Mask. A
Discovery Filter may contain more than one mask in order to support allocation
of masks for different parts of the ProSe Application Code.
#### 4.6.4.2b ProSe Application Mask
A ProSe Application Mask shall be used for partial matching of ProSe
Application Codes received on the PC5 interface. A ProSe Application Mask is
contained in a Discovery Filter.
NOTE 1: It is up to stage 3 specifications whether a ProSe Application Mask is
used in case of full matching, or the lack of the ProSe Application Mask
indicates the need of full matching.
A ProSe Application Mask consists of one or more applicable parts of temporary
identities of ProSe Application Codes to allow partial matching of ProSe
Application Codes.
NOTE 2: The ProSe Application Mask is not expected to change often.
#### 4.6.4.3 Void
# 5 Functional Description and Information Flow
## 5.1 Control and user plane stacks
### 5.1.1 Control Plane
#### 5.1.1.1 General
The control plane stack consists of protocols for control and support of the
user plane functions:
\- controlling the configuration of the ProSe-enabled UE; and
\- controlling ProSe Direct Discovery.
The following control planes are used in E-UTRAN mode.
#### 5.1.1.2 UE - ProSe Function
**Legend:**
\- ProSe Control Signalling between UE and ProSe Function is carried over the
user plane and is specified in TS 24.334 [24].
NOTE: PC3 may be realized with one or more protocols.
Figure 5.1.1.2-1: Control Plane for PC3 Interface
#### 5.1.1.3 HSS - ProSe Function
**Legend:**
\- Diameter: This protocol supports the transfer of subscription and
authentication data for authenticating/authorizing user access to ProSe
between ProSe Function and HSS (PC4a). Diameter is defined in RFC 3588 [18].
\- Stream Control Transmission Protocol (SCTP): This protocol transfers
signalling messages. SCTP is defined in RFC 4960 [19].
\- PC4a between the ProSe Function and the HSS is specified in TS 29.344 [22].
Figure 5.1.1.3-1: Control Plane for PC4a Interface
#### 5.1.1.4 SLP - ProSe Function
**Legend:**
\- Mobile Location Protocol (MLP) is specified in OMA LIF MLP [20].
Figure 5.1.1.4-1: Control Plane for PC4b Interface
#### 5.1.1.5 UE - UE
**Legend:**
\- **PC5-D:** The MAC/PHY functionality is specified in TS 36.300 [17].
\- The \"ProSe protocol\" is used for handling ProSe Direct Discovery and is
specified in TS 24.334 [24].
Figure 5.1.1.5-1: Discovery Plane for PC5 Interface
#### 5.1.1.6 ProSe Function - ProSe Function
**Legend:**
\- PC6 is an inter-PLMN interface between the ProSe Functions in different
PLMNs (EPC-level ProSe Discovery) and between the ProSe function in the HPLMN
and the ProSe function in Local PLMN (ProSe Direct Discovery). PC7 is a
roaming interface between the ProSe function in the HPLMN and the ProSe
function in VPLMN. PC6 and PC7 are specified in TS 29.345 [23]
\- Diameter: This protocol supports the transfer of subscriber location
related information between ProSe Functions (PC6/PC7). Diameter is defined in
RFC 3588 [18].
\- Stream Control Transmission Protocol (SCTP): This protocol transfers
signalling messages. SCTP is defined in RFC 4960 [19].
Figure 5.1.1.6-1: Control Plane for PC6 and PC7 interface
#### 5.1.1.7 ProSe Function - ProSe Application Server
**Legend:**
\- PC2-AP is the PC2 Application Protocol and is specified in TS 29.343 [21].
Figure 5.1.1.7-1: Control Plane for PC2 interface
### 5.1.2 User Plane
#### 5.1.2.1 UE - UE
**Legend:**
\- **PC5-U:** The PDCP/RLC/MAC/PHY functionality is specified in TS 36.300
[17].
Figure 5.1.2.1-1: User Plane for PC5 interface
#### 5.1.2.2 Void
## 5.2 Service authorisation and revocation for ProSe Direct Discovery and
ProSe Direct Communication
### 5.2.1 Service authorisation procedures
Figure 5.2-1: Pre-configuration for ProSe Direct Discovery or ProSe Direct
Communication or both
The HPLMN pre-configures the UE with the authorization information for a list
of PLMNs where the UE is authorized to perform ProSe Direct Discovery or ProSe
Direct Communication or both and in addition information regarding out-of-
coverage operation may be provided. If there is no associated UE context, the
ProSe Function gets the subscription information for ProSe Direct Discovery
and/or ProSe Direct Communication from HSS.
Figure 5.2-2: Service authorisation for ProSe Direct Discovery or ProSe Direct
Communication or both
The UE gets the service authorisation for ProSe Direct Discovery or ProSe
Direct Communication or both, with a given validity time, from the ProSe
Function of the HPLMN.
The service authorisation procedure is executed:
\- before starting the setup of ProSe Direct Discovery or ProSe Direct
Communication if the UE has no valid authorization information, or
\- when the UE already engaged in a ProSe Direct Discovery or ProSe Direct
Communication changes its registered PLMN and has no valid authorization
information for the new registered PLMN, or
\- when the service authorisation expires.
The authorisation is happening using \"over IP\" mechanisms and only IP
connectivity is required to allow the UE to access this ProSe Function.
In this signalling flow, shown in Figure 5.2-2, the following steps are
performed:
Step 1: The UE requests authorisation for Direct Discovery or Direct
Communication or both for HPLMN or for the VPLMN or for Direct Discovery (as a
\"monitoring UE\" only) for some Local PLMNs from the ProSe Function in HPLMN.
Step 2: The ProSe Function in HPLMN obtains authorization info from Local PLMN
or VPLMN and merges with own policy.
Step 3: The ProSe Function in HPLMN provides authorisation info to UE. The
authorisation info provided to the UE applies to the serving PLMN and to PLMNs
determined by the HPLMN as Local PLMNs (e.g. based on the Serving PLMN) to be
available to the UE. The UE stores the authorisation information obtained from
this ProSe Function in a secure way. If needed at any point the authorization
can be revoked by the ProSe Function in Local PLMN or VPLMN or Prose Function
in the HPLMN.
### 5.2.2 Service authorization update procedures
#### 5.2.2.1 General
The allowed PLMN for ProSe direct service can be updated at any point by the
HSS or the ProSe function. And the ProSe function can be the ProSe function in
HPLMN, in VPLMN or in Local PLMN.
The update of the allowed PLMN for ProSe direct service applies to ProSe
Direct Discovery or ProSe Direct Communication or both.
NOTE: The addition of the PLMN into allowed PLMN list for ProSe direct service
is triggered by HSS.
#### 5.2.2.2 HSS triggered ProSe direct Service authorization update
Figure 5.2.2.2-1: HSS triggered ProSe direct services authorization update
NOTE: Steps 3, 4 can be executed at the same time as step 2.
1\. The ProSe related subscription data is updated, e.g. the authorization for
ProSe direct discovery service is updated. The HSS sends a Subscription Data
Updated Notify (IMSI, updated ProSe data) message to the ProSe Function in
HPLMN. The Subscription Data Updated Notify message may add or remove the
PLMNs from the allowed PLMN list for ProSe direct service. The updated ProSe
data includes the indication and the PLMN ID. The PLMN ID is optional. If it
is not included, it denotes the authorization for ProSe direct service
(discovery or communication or both) identified by the indication is to be
updated on all PLMNs. Otherwise only the authorization for ProSe direct
service in the indicated PLMN is to be updated. Upon receiving the message,
the ProSe Function in HPLMN updates the associated ProSe UE context if it has
been stored before.
2\. The UE get the updated authorisation for ProSe direct service via the
ProSe Service Notification message immediately or waits to the next time
communication with the ProSe function in HPLMN per operator\'s policy.
3\. If the authorization for ProSe direct service includes the change to the
PLMN which UE is registered, e.g. remove the PLMN UE registered from allowed
ProSe direct discovery PLMN list, and the ProSe direct service to be updated
includes ProSe direct discovery announcing or ProSe direct communication, the
HSS notifies the updated ProSe subscription data to the MME via the Insert
Subscriber Data message. If only the authorization for ProSe direct discovery
monitoring is to be updated, the notification to the MME is not need. The MME
updates the stored UE context.
4\. If the S1 bearer is established, the MME sends the updated UE ProSe
context to eNodeB via the UE Context Modification Request (ProSe Authorized)
message. The eNodeB take the following action based on the updated \"ProSe
Authorized\" indication.
#### 5.2.2.3 ProSe function triggered ProSe Direct Service revocation (non-
roaming)
Figure 5.2.2.3-1: ProSe Function triggered ProSe direct services revocation
(non-roaming)
NOTE: Steps 2, 3, 4 can be executed at the same time as step 1.
1\. The HPLMN ProSe Function decides to revoke the authorization for ProSe
direct service, e.g. ProSe Direct Discovery service is revoked on one PLMN.
The UE get the updated authorization for ProSe direct service via the ProSe
Service Notification message immediately or waits to the next time
communication with the ProSe function in HPLMN per operator\'s policy.
2\. The ProSe Function notifies the HSS to change the subscription data by
sending an Update ProSe Policy Data (IMSI, updated ProSe data) message. The
updated ProSe data includes the indication and the PLMN ID. The combination of
the indication and the PLMN ID denotes the authorization for ProSe direct
service (discovery or communication or both) identified by the indication is
to be revoked on the indicated PLMN. Upon receiving the message, the HSS
updates the ProSe subscription data.
The description of steps 3-4 are the same as steps 3-4 in clause 5.2.2.2.
#### 5.2.2.4 ProSe function triggered ProSe Direct Service revocation
(roaming)
Figure 5.2.2.4-1: ProSe Function triggered ProSe direct services revocation
(roaming)
NOTE: Steps 3, 4, 5, 6 can be executed at the same time as step 2.
1\. The VPLMN or Local PLMN ProSe Function decides to revoke the authorization
for ProSe direct service, e.g. ProSe direct discovery service is revoked for
the inbound roamer. The VPLMN or Local PLMN ProSe Function sends a ProSe
Service Policy change Notification (UE identity, indication, revoked PLMN ID,
HPLMN ID) message to HPLMN ProSe Function. The UE identity is optional, e.g.
it is not included if the Local PLMN ProSe Function wants to revoke ProSe
direct discovery service for all UEs of the HPLMN. The UE identity can be
either IMSI or MSISDN. If UE identity is not included in the message, the
ProSe direct service to be revoked aims to all the UE from the indicated HPLMN
ID. The combination of the indication and the revoked PLMN ID denotes the
authorization for ProSe direct service (discovery or communication or both)
identified by the indication is to be revoked on the indicated PLMN.
2\. The UE get the updated authorization for ProSe direct service via the
ProSe Service Notification message immediately or waits to the next time
communication with the ProSe function in HPLMN per operator\'s policy.
3\. The HPLMN ProSe Function notifies the HSS to change the subscription data
by sending an Update ProSe Policy Data (IMSI, updated ProSe data) message. If
the UE identity is received in step 1, the ProSe Function includes the IMSI of
the UE in the message. The updated ProSe data includes the indication and the
Revoked PLMN ID received in step 1.
4\. If the IMSI is not received, the HSS determines the affected UE based on
the revoked PLMN ID, i.e. all UE\'s whose ProSe direct service authorization
includes the revoked PLMN ID, and updates the corresponding ProSe subscription
data.
For each affected UE the HSS trigger the update procedure as the steps 5-6.
The description of steps 5-6 are the same as steps 3-4 in clause 5.2.2.2.
## 5.3 ProSe Direct Discovery
### 5.3.1 General
#### 5.3.1.1 Overview
ProSe Direct Discovery is defined as the process that detects and identifies
another UE in proximity using E-UTRA direct radio signals.
There are two types of ProSe Direct Discovery: open and restricted. Open is
the case where there is no explicit permission that is needed from the UE
being discovered, whereas restricted discovery only takes place with explicit
permission from the UE that is being discovered.
ProSe Direct Discovery can be a standalone service enabler that could for
example use information from the discovered UE for certain applications in the
UE that are permitted to use this information e.g. \"find a taxi nearby\",
\"find me a coffee shop\". Additionally depending on the information obtained
ProSe Direct Discovery can be used for subsequent actions e.g. to initiate
ProSe Direct Communication.
The UE can act as \"announcing UE\" only in the band designated by the serving
PLMN but may act as a \"monitoring\" UE also in the resources of the serving
PLMN and Local PLMNs.
ProSe-enabled UEs which have obtained authorization to participate in ProSe
Direct Discovery procedures shall not continue in participating in ProSe
Direct Discovery procedures as soon as they detect loss of E-UTRA coverage in
the serving PLMN.
#### 5.3.1.2 ProSe Direct Discovery Models
The following models for ProSe Direct Discovery exist:
**Model A (\"I am here\")**
This model defines two roles for the ProSe-enabled UEs that are participating
in ProSe Direct Discovery.
\- Announcing UE: The UE announces certain information that could be used by
UEs in proximity that have permission to discover.
\- Monitoring UE: The UE that monitors certain information of interest in
proximity of announcing UEs.
In this model the announcing UE broadcasts discovery messages at pre-defined
discovery intervals and the monitoring UEs that are interested in these
messages read them and process them.
NOTE: This model is equivalent to \"I am here\" since the announcing UE would
broadcast information about itself e.g. its ProSe Application Code in the
discovery message.
**Model B (\"who is there?\" / \"are you there?\")**
This model defines two roles for the ProSe-enabled UEs that are participating
in ProSe Direct Discovery.
\- **Discoverer UE:** The UE transmits a request containing certain
information about what it is interested to discover.
\- **Discoveree UE:** The UE that receives the request message can respond
with some information related to the discoverer\'s request.
It is equivalent to \" who is there/are you there\" since the discoverer UE
sends information about other UEs that would like to receive responses from,
e.g. the information can be about a ProSe Application Identity corresponding
to a group and the members of the group can respond.
### 5.3.2 Overall procedure for ProSe Direct Discovery (Model A)
Figure 5.3.2-1: Overall procedure for ProSe Direct Discovery
This procedure is only applied for open ProSe discovery when the ProSe enabled
UE is served by E-UTRAN.
1\. Service authorisation for ProSe direct services is performed for ProSe
Direct Discovery as defined in clauses 5.2, and 4.5.1.
If the UE is authorised to announce:
2a. When the UE is triggered to announce then it sends a discovery request for
announcing to the ProSe Function in HPLMN as defined in clauses 5.3.3.2 and
5.3.3.3.
3a. If the request is successful and is provided with ProSe Application Code
then it starts announcing on PC5 interface.
NOTE 1: More details on the Access Stratum protocol of this step are provided
in RAN specifications.
If the UE is authorised to monitor:
2b. When the UE is triggered to monitor, it sends a discovery request for
monitoring to the ProSe Function as defined in clauses 5.3.3.4 and 5.3.3.5.
3b. If the request is successful and the UE is provided with a Discovery
Filter consisting of ProSe Application Code(s) and/or ProSe Application
Mask(s) it starts monitoring for these ProSe Application Codes on the PC5
interface.
NOTE 2: More details on the Access Stratum protocol of this step are provided
in RAN specifications.
4b. When the UE detects that one or more ProSe Application Code(s) that match
the filter (see sub-clause 4.6.4.2), it reports the ProSe Application Code(s)
to the ProSe Function as defined in clause 5.3.4.
Non roaming direct discovery procedures cover the case where both the
\"announcing UE\" and \"monitoring UE\" are served by their respective HPLMN.
Roaming direct discovery procedures cover the other cases.
### 5.3.3 Discovery Request
#### 5.3.3.1 General
The Discovery Request is sent by the \"announcing UE\" or \"monitoring UE\" in
order to be authorised to access the discovery resources and perform ProSe
Direct Discovery.
#### 5.3.3.2 Announce request (non-roaming)
Figure 5.3.3.2-1: Announce request procedure (non-roaming)
0\. The UE is configured with the data structure of the ProSe Application IDs
corresponding to HPLMN. This step is performed using mechanisms that are out
of scope of 3GPP.
1\. If the UE is authorised to announce in HPLMN and is triggered to announce,
it shall establish a secure connection with the ProSe Function and it shall
send a Discovery Request (ProSe Application ID, UE Identity, announce command,
Application ID) message for announcing. The ProSe Application ID indicates
what the UE is interested to announce. The UE Identity is set to e.g. IMSI.
The Application ID represents a unique identifier of the UE application that
has triggered the transmission of the Discovery Request message. This request
is always sent to the ProSe Function in HPLMN.
2\. The ProSe Function checks for the authorization of the application
represented by the Application ID. If there is no associated UE context, the
ProSe Function shall check with HSS the authorisation for discovery and create
a new context for this UE that contains the subscription parameters for this
UE. The HSS provides the MSISDN of the UE.
NOTE 1: Home ProSe Function can retain the previously camped PLMN ID and
associated ProSe Application Code for an operator configurable time when
informed by HSS of a PLMN change. When the configuration timer expires, the
previously camped PLMN ID and associated ProSe Application Code can be removed
from the UE context.
3\. If the Discovery Request is authorised, then the ProSe Function shall
check whether the UE is authorized to use the ProSe Application ID contained
in the Discovery Request. If the UE is authorised to use that ProSe
Application ID, then the ProSe Function shall respond with a Discovery
Response (ProSe Application Code, validity timer) message. The ProSe
Application Code is provided by the ProSe Function and corresponds to the
ProSe Application ID that was contained in the Discovery Request. The validity
timer indicates for how long this ProSe Application Code is going to be valid.
The UE will be authorised to announce this ProSe Application Code for the
duration of validity timer and if it remains in the HPLMN. When the validity
timer expires or the UE changes its registered PLMN the UE needs to request a
new ProSe Application Code.
NOTE 2: To avoid interrupting the discovery procedure, if the UE changes its
registered PLMN but the validity timer of the Prose Application Code has not
yet expired then the ProSe Function may allocate the same ProSe Application
Code to the UE, with a validity timer set to the residual validity time of the
validity timer not yet expired.
4\. The UE may start announcing the provided ProSe Application Code in HPLMN,
using the radio resources authorised and configured by E-UTRAN to be used for
ProSe as defined in RAN specifications.
If the validity timer associated with a ProSe Application Code expires
(because the UE has not refreshed the corresponding Discovery Request within
the duration of the validity timer), then the ProSe Function removes the entry
related to that ProSe Application Code from the UE context.
#### 5.3.3.3 Announce request (roaming)
Figure 5.3.3.3-1: Announce request procedure (roaming)
The UE is only allowed to announce in the bands signalled from VPLMN.
0\. The UE is configured with the data structure of the ProSe Application IDs
corresponding to HPLMN. This step is performed using mechanisms that are out
of scope of 3GPP.
1\. If the UE is authorised to announce in VPLMN and is triggered to announce,
it shall establish a secure connection with the ProSe Function in HPLMN and it
shall then send a Discovery Request (ProSe Application ID, UE Identity,
announce command, Application ID) message for announcing. The ProSe
Application ID indicates what the UE is interested to announce. The UE
Identity is set to e.g. IMSI. The Application ID represents a unique
identifier of the UE application that has triggered the transmission of the
Discovery Request message. This request is always sent by the UE to the ProSe
Function in HPLMN.
2\. The ProSe Function checks for the authorization of the application
represented by the Application ID. If there is no associated UE context, the
ProSe Function shall check with HSS the authorisation for discovery and, if
necessary, create a new context for this UE that contains the subscription
parameters for this UE. The HSS provides the MSISDN of the UE. The HSS also
provides the VPLMN ID of where the UE is registered.
NOTE 1: Home ProSe Function can retain the previously camped PLMN ID and
associated ProSe Application Code for an operator configurable time when
informed by HSS of a PLMN change. When the configuration timer expires, the
previously camped PLMN ID and associated ProSe Application Code can be removed
from the UE context.
3\. If the Discovery Request is authorised, then the HPLMN ProSe Function
shall check whether the UE is authorized to use the ProSe Application ID
contained in the Discovery Request. If the UE is authorised to use that ProSe
Application ID, then the HPLMN ProSe Function shall inform the ProSe Function
in VPLMN with the Announce Authorisation (ProSe Application ID, ProSe
Application Code, UE Identity, validity timer) message. The ProSe Application
ID corresponds to the request from the UE, whereas the ProSe Application Code
indicates the assigned code for this request. The request also includes the UE
identity information e.g. IMSI or MSISDN and validity timer in order to allow
the ProSe Function in VPLMN to perform charging. The validity timer indicates
for how long this ProSe Application Code is going to be valid.
4\. The ProSe Function in VPLMN authorizes the UE to perform ProSe Direct
Discovery announcing.
5\. The ProSe Function in HPLMN shall respond to the UE with a Discovery
Response (ProSe Application Code, validity timer) message. ProSe Application
Code is provided by the ProSe Function in HPLMN and corresponds to the ProSe
Application ID that was contained in the Discovery Request from the UE. The
validity timer shall indicate for how long this ProSe Application Code is
going to be valid. The UE will be authorised to announce this ProSe
Application Code for the duration of validity timer and if it remains in the
same PLMN.
NOTE 2: To avoid interrupting the discovery procedure, if the UE changes PLMN
but the validity timer of the Prose Application Code has not yet expired then
the ProSe Function may allocate the same ProSe Application Code to the UE,
with a validity timer set to the residual validity time of the validity timer
not yet expired.
6\. The UE may start announcing the provided ProSe Application Code in the
VPLMN, using the radio resources authorised and configured by E-UTRAN to be
used for ProSe as defined in RAN specifications.
If the validity timer associated with a ProSe Application Code expires
(because the UE has not refreshed the corresponding Discovery Request within
the duration of the validity timer), then the ProSe Function removes the entry
related to that ProSe Application Code from the UE context.
#### 5.3.3.4 Monitor request (non-roaming)
Figure 5.3.3.4-1: Monitor request procedure (non-roaming)
0\. The UE is configured with the data structure of the ProSe Application IDs
corresponding to PLMNs the UE is authorised to monitor. This step is performed
using mechanisms that are out of scope of 3GPP.
1\. If the UE is authorised to monitor in at least one PLMN and is interested
to monitor certain ProSe Application ID(s), it shall establish a secure
connection with ProSe Function in the HPLMN to which it shall then send a
Discovery Request (ProSe Application ID(s), UE Identity, monitor command,
Application ID) message for monitoring. The ProSe Application ID(s) indicate
what the UE is interested to monitor and they consist a subset of the data
structure of the PLMN. The UE Identity is set to e.g. IMSI. The Application ID
represents a unique identifier of the application that has triggered the
transmission of the Discovery Request message. This request is always sent to
the ProSe Function in HPLMN.
2\. The ProSe Function checks for the authorization of the application
represented by the Application ID. If there is no associated UE context, the
ProSe Function shall check with HSS the authorisation for discovery and create
a new context for this UE that contains the subscription parameters for this
UE. The HSS provides the MSISDN of the UE. The authorisation information also
contains the PLMNs that this UE is allowed to perform discovery.
If the Discovery Request is authorised, and the ProSe Application ID sent by
the UE in step 1 indicates another Local PLMN then steps 3-6 are executed,
otherwise (i.e. the ProSe Application ID indicates HPLMN) only steps 5-6 are
executed:
3\. When the ProSe Application ID has PLMN-specific scope then the ProSe
Function in HPLMN shall contact if needed) other PLMNs that are indicated by
the ProSe Application ID(s) sent by the UE, in order to resolve the
corresponding ProSe Application ID Name(s) to ProSe Application Code(s) and/or
a ProSe Application Mask. The request shall also include the UE identity
information e.g. IMSI or MSISDN in order to allow the ProSe Function in Local
PLMN to perform charging.
4\. If the ProSe Function of the Local PLMN stores valid ProSe Application
Code(s) corresponding to the requested ProSe Application ID Name(s), then the
ProSe Function of the Local PLMN returns the related ProSe Application Code(s)
and/or ProSe Application Mask(s) and the corresponding TTL for each.
5\. The ProSe Function in the HPLMN shall respond with a Discovery Response
(Discovery Filter(s)) message. The TTL(s) in the Discovery Filter(s) indicates
for how long the Discovery Filter(s) is going to be valid.
NOTE 1: The UE can randomize the request for assignment of new Discovery
Filter in order to guard against a peak of Discovery Requests when the TTL
expires.
NOTE 2: To allow a change of the announced ProSe Application Code without
interrupting the discovery procedure, two Discovery Filters for the same ProSe
Application ID can be provided to the UE (as the monitoring UE would have
Discovery Filters for both the ProSe Application Code which is currently in
use by the announcing UE as well as the ProSe Application Code which will
replace the current one). Alternatively a ProSe Application Mask, which is
able to match both ProSe Application Codes, can be provided.
6\. The UE may start monitoring using the Discovery Filter(s) in the radio
resources that are authorized and configured by the PLMN(s) to be used for
ProSe as defined in RAN specifications.
If the TTL corresponding to a Discovery Filter expires (because the UE has not
refreshed the corresponding Discovery Request within the duration of the TTL),
then the ProSe Function removes the entry related to that Discovery Filter
from the UE context.
#### 5.3.3.5 Monitor request (roaming)
Figure 5.3.3.5-1: Monitor request procedure (roaming)
0\. The UE is configured with the data structure of the ProSe Application IDs
corresponding to PLMNs the UE is authorised to monitor. This step is performed
using mechanisms out of scope of 3GPP.
1\. If the UE is authorised to monitor in at least one PLMN and is interested
to monitor certain ProSe Application ID(s), it shall establish a secure
connection with the ProSe Function in HPLMN and it shall send a Discovery
Request (ProSe Application ID(s), UE Identity, monitor command, Application
ID) message for monitoring. The ProSe Application ID(s) indicate what the UE
is interested to monitor and they consist of a subset of the data structure of
the PLMN. The UE Identity is set to e.g. IMSI. The Application ID represents a
unique identifier of the application that has triggered the transmission of
the Discovery Request message. This request is always sent to the ProSe
Function in HPLMN.
2\. The ProSe Function checks for the authorization of the application
represented by the Application ID. If there is no associated UE context, the
ProSe Function shall check with HSS the authorisation for discovery and, if
necessary, create a new context for this UE that contains the subscription
parameters for this UE. The authorisation information also contains the PLMNs
that this UE is allowed to perform discovery. The HSS provides also the VPLMN
ID where the UE is registered. The HSS provides the MSISDN of the UE.
If the Discovery Request is authorised, and the ProSe Application ID sent by
the UE in step 1 indicates another PLMN and not the HPLMN, then steps 3-6 are
executed, otherwise (i.e. the ProSe Application ID indicates HPLMN) only steps
5-6 are executed:
3\. When the ProSe Application ID has PLMN-specific scope then the ProSe
Function in HPLMN shall contact (if needed) other PLMNs that are indicated by
the ProSe Application ID(s) sent by the UE, in order to resolve the
corresponding ProSe Application ID Name(s) to ProSe Application Code(s) and/or
a ProSe Application Mask. The request shall also include the UE identity
information e.g. IMSI or MSISDN in order to allow the ProSe Function in
Local/Visited PLMN to perform charging.
4\. If the ProSe Function of the other PLMN stores valid ProSe Application
Code(s) corresponding to the requested ProSe Application ID Name(s), then the
ProSe Function of the VPLMN/Local PLMN returns the related ProSe Application
Code(s) and/or ProSe Application Mask(s) and the corresponding TTL for each.
Based on the UE context in the ProSe Function of the VPLMN/Local PLMN, it also
includes the PLMN ID of the PLMN that the \"announcing UE\" is registered (if
roaming) for the ProSe Function in HPLMN of the monitoring UE to store in the
associated UE context.
5\. The ProSe Function in the HPLMN responds with a Discovery Response
(Discovery Filter(s)) message. The TTL(s) in the Discovery Filter(s) indicate
for how long the Discovery Filter(s) are going to be valid.
NOTE 1: The UE can randomize the request for assignment of new Discovery
Filter in order to guard against a peak of Discovery Requests when the TTL
expires.
NOTE 2: To allow a change of the announced ProSe Application Code without
interrupting the discovery procedure, two Discovery Filters for the same ProSe
Application ID can be provided to the UE (as the monitoring UE would have
Discovery Filters for both the ProSe Application Code which is currently in
use by the announcing UE as well as the ProSe Application Code which will
replace the current one). Alternatively a ProSe Application Mask, which is
able to match both ProSe Application Codes, can be provided.
6\. The UE may start monitoring using the Discovery Filter(s) in the radio
resources that are authorized and configured by the PLMN(s) to be used for
ProSe as defined in RAN specifications.
If the TTL corresponding to a Discovery Filter expires (because the UE has not
refreshed the corresponding Discovery Request within the duration of the TTL),
then the ProSe Function removes the entry related to that Discovery Filter
from the UE context.
### 5.3.4 Discovery reporting
#### 5.3.4.1 Match report (non-roaming)
Figure 5.3.4.1-1: Match report procedure (non-roaming)
1\. If the UE finds ProSe Application Code(s) that matches the Discovery
Filters and does not have ProSe Application ID(s) already locally stored that
correspond to this ProSe Application Code(s), it shall (re)establish a secure
connection with the ProSe Function in HPLMN to which it shall then send a
Match Report (ProSe Application Code(s), UE Identity, Monitored PLMN ID)
message to the ProSe Function in HPLMN. The ProSe Application Code is the code
that the corresponding Discovery Filter of the UE matched. This request is
always sent to the ProSe Function in HPLMN. The UE Identity is set to e.g.
IMSI. The Monitored PLMN ID is the PLMN in which the UE has monitored the
ProSe Application Code.
NOTE: How the Monitored PLMN ID is derived will be defined in RAN
specifications.
2\. The ProSe Function shall check the context for this UE that contains its
subscription parameters. The authorisation information also contains the PLMN
that this UE is allowed to perform discovery. The HSS provides the MSISDN of
the UE.
3\. The ProSe Function analyses the ProSe Application Code received from the
UE.
If the PLMN ID that assigned the given ProSe Application Code is another Local
PLMN then steps 4-7 are executed, otherwise (i.e. the ProSe Application Code
was assigned by HPLMN) only step 7 is executed:
4\. The ProSe Function in HPLMN sends a Match Report (ProSe Application
Code(s), UE identity, Monitored PLMN ID) to the ProSe Function of the PLMN
that assigned the ProSe Application Code. The UE identity information e.g.
IMSI or MSISDN can be used by the ProSe Function in Local PLMN to perform
charging.
5\. The ProSe Function ensures that the received ProSe Application Code is
authorized to be transmitted on the monitored PLMN, i.e. the pair of ProSe
Application Code and the monitored PLMN is stored in the UE context. The ProSe
Function analyses the ProSe Application Code(s) received from the UE. As the
\"announcing\" UE is not roaming, the ProSe function only needs to check
whether the received ProSe Application Code(s) is still valid.
6\. If the ProSe Application Code is confirmed then the ProSe Function in
Local PLMN shall send Match Report Acknowledgement (ProSe Application ID
Name(s), validity timer(s)). This message may also contain certain metadata
corresponding to the ProSe Application ID Name e.g. postal address, phone
number, URL etc.
7\. The ProSe Function in HPLMN shall respond to the UE with Match Report
Acknowledgment (ProSe Application ID(s), validity timer(s)). This message may
also contain certain metadata corresponding to the ProSe Application ID Name
e.g. postal address, phone number, URL etc. The validity timer(s) indicate for
how long the mapping of ProSe Application Code(s) and ProSe Application ID(s)
provided are going to be valid. The UE stores the mapping of ProSe Application
Code(s) and corresponding ProSe Application ID(s) for the duration of their
validity timer.
#### 5.3.4.2 Match reporting (roaming)
Figure 5.3.4.2-1: Match report procedure (roaming)
1\. If the UE finds ProSe Application Code(s) that matches the Discovery
Filters and does not have ProSe Application ID(s) already locally stored that
correspond to this ProSe Application Code(s), it (re)establishes a secure
connection with the ProSe Function in HPLMN and sends a Match Report (ProSe
Application Code(s), UE Identity, VPLMN ID, Monitored PLMN ID) message to the
ProSe Function in HPLMN. The ProSe Application Code is the code that the
corresponding Discovery Filter of the UE matched. The UE Identity is set to
e.g. IMSI. The Monitored PLMN ID is the PLMN in which the UE has monitored the
ProSe Application Code.
NOTE 1: The Monitored PLMN ID is needed in order to cover the case that the
announcing UE that broadcast the ProSe Application Code was registered in
another PLMN.
NOTE 2: How the Monitored PLMN ID is derived will be defined in RAN
specifications.
2\. The ProSe Function shall check the context for this UE that contains its
subscription parameters for this UE. The authorisation information also
contains the PLMN that this UE is allowed to perform discovery. The UE context
also contains the VPLMN ID where the UE is registered. The HSS provides the
MSISDN of the UE.
3\. The ProSe Function analyses the ProSe Application Code(s) received from
the UE.
If the PLMN ID that assigned the given ProSe Application Code is not the
HPLMN, then steps 4-8 are executed, otherwise (i.e. the HPLMN assigned the
ProSe Application Code) only steps 7-8 are executed:
4\. The ProSe Function in HPLMN sends a Match Report (ProSe Application
Code(s), UE identity, Monitored PLMN ID) to the ProSe Function of the PLMN
that assigned the ProSe Application Code (i.e. the ProSe Function of the HPLMN
of the \"announcing UE\"). The UE identity information e.g. IMSI or MSISDN can
be used by the ProSe Function in Local/Visited PLMN to perform charging.
5\. The ProSe Function ensures that the received ProSe Application Code is
authorized to be transmitted on the monitored PLMN, i.e. the pair of ProSe
Application Code and the monitored PLMN is stored in the UE context. The ProSe
Function analyses the ProSe Application Code(s) received from the UE, and
confirms the ProSe Application Code(s).
6\. The ProSe Function shall send Match Report Acknowledgement (ProSe
Application ID Name(s), validity timer(s)). This message may also contain
certain metadata corresponding to the ProSe Application ID Name e.g. postal
address, phone number, URL etc.
7\. The ProSe Function in HPLMN shall respond to the UE with Match Report
Acknowledgment (ProSe Application ID(s), validity timer(s)). This message may
also contain certain metadata corresponding to the ProSe Application ID Name
e.g. postal address, phone number, URL etc. The validity timer(s) indicate for
how long the mapping of ProSe Application Code(s) and ProSe Application ID(s)
provided are going to be valid. The UE stores the mapping of ProSe Application
Code(s) and corresponding ProSe Application ID(s) for the duration of their
validity timer.
8\. If the \"announcing UE\" is roaming, i.e. the Monitored PLMN ID is
different from the PLMN ID contained in the ProSe Application Code, the ProSe
Function in HPLMN may optionally send a Match Report Info (ProSe Application
ID(s), UE Identity) to the ProSe Function of the serving PLMN of the
\"announcing UE\".
## 5.4 Procedures for ProSe Direct Communication
### 5.4.1 One-to-many ProSe Direct Communication general
One-to-many ProSe Direct Communication is applicable only to ProSe-enabled
Public Safety UEs and when authorised, can apply when the UE is served by
E-UTRAN and when the UE is outside of E-UTRA coverage.
One-to-many ProSe Direct Communication has the following characteristics:
\- One-to-many ProSe Direct Communication is connectionless. Thus there is no
signalling over PC5 control plane.
\- There is no QoS support.
\- There is no support for priority handling.
\- The radio layer provides a user plane communication service for
transmission of IP packets between UEs engaged in direct communication.
\- Members of a group share a secret from which a group security key may be
derived to encrypt all user data for that group.
\- Authorisation for one-to-many ProSe Direct Communication is configured in
the UE by the ProSe Function using PC3 reference point.
\- ProSe UE configuration parameters (e.g. including ProSe Group IP multicast
addresses, ProSe Group IDs, Group security material, radio related parameters)
are configured in the UE.
### 5.4.2 One-to-many ProSe Direct Communication transmission
This procedure is applicable to authorized ProSe-enabled Public Safety UEs.
Figure 5.4.2-1: One-to-many ProSe Direct Communication transmission
1\. UE is configured with the related information for one-to-many ProSe Direct
Communication as defined in clause 4.5.1.1.2.3.3. The UE obtains the necessary
group context (ProSe Layer-2 Group ID, ProSe Group IP multicast address) to
transmit IP-layer transport of data, and also the radio resource related
parameters used for the Direct Communication.
2\. The originating UE finds the appropriate radio resource to conduct one-to-
many ProSe Direct Communication as specified in clause 4.5.1.1.2.3.1.
The protocol data unit passed for transmission to the Access Stratum is
associated with a Layer-3 protocol data unit type. In this release of the
specification the following Layer-3 protocol data types are supported: IP
packet and Address Resolution Protocol packet (see RFC 826 [28]).
The packet passed for transmission to the Access Stratum is associated with
the corresponding Source Layer-2 ID and Destination Layer-2 ID. The Source
Layer-2 ID is set to the ProSe UE ID assigned from the ProSe Key Management
Function. The Destination Layer-2 ID is set to the ProSe Layer-2 Group ID.
NOTE: More details about step 2 to be defined in RAN specifications.
3\. The originating UE sends the IP data to the IP multicast address using the
ProSe Layer-2 Group ID as Destination Layer-2 ID.
### 5.4.3 One-to-many ProSe Direct Communication reception
This procedure is only applicable to authorized ProSe-enabled Public Safety
UEs.
Figure 5.4.3-1: One-to-many Direct Communication reception
1\. UE is configured with the related information for one-to-many ProSe Direct
Communication as defined in clause 4.5.1.1.2.3.3. The UE obtains the necessary
group context (ProSe Layer-2 Group ID, Group IP multicast address) to receive
IP-layer transport of data, and also the radio resource related parameters
used for the Direct Communication.
2\. The receiving UE listens to the allocated radio resource to receive one-
to-many ProSe Direct Communication.
NOTE: More details about step 2 to be defined in RAN specifications.
3\. The receiving UE filters out the received frames based on the ProSe
Layer-2 Group ID contained in the Destination Layer-2 ID and if it matches one
of the configured Group IDs, it delivers the enclosed packet to the upper
layers. The IP stack filters the received packets based on the Group IP
multicast address.
The protocol data unit passed to the upper layers is associated with a Layer-3
protocol data unit type. In this release of the specification the following
Layer-3 protocol data types are supported: IP packet and Address Resolution
Protocol packet (see RFC 826 [28]).
### 5.4.4 Void
## 5.5 EPC-level ProSe Discovery procedures
### 5.5.1 General
EPC-level ProSe Discovery can be used independently or in conjunction with EPC
support for WLAN direct discovery and communication.
When EPC support for WLAN direct discovery and communication is requested as
part of the EPC-level ProSe Discovery procedure, the additional parameters for
support of WLAN direct discovery and communication are enclosed in brackets in
the figures.
### 5.5.2 Overall call flow for EPC-level ProSe Discovery
The overall call flow for EPC-level ProSe Discovery and optional EPC support
for WLAN direct discovery and communication is illustrated in Figure 5.5.2-1.
Each procedural box is subsequently described in more detail as a separate
call flow.
Figure 5.5.2-1: Overall call flow for EPC-level ProSe Discovery and optional
EPC support for WLAN direct discovery and communication
1\. UEs perform UE registration for ProSe with the ProSe Function residing in
their respective Home PLMNs;
2\. UEs perform application registration for ProSe with the ProSe Function
residing in their respective Home PLMNs;
3\. UE A makes a proximity request for UE B, i.e. requests that it be alerted
for proximity with UE B (possibly indicating a window of time during which the
request is valid). In response, ProSe Function A requests location updates for
UE A and UE B. These location updates can be periodic, based on a trigger, or
a combination of both. To request location updates for UE A, ProSe Function A
contacts SUPL Location Platform (SLP) A. To request location updates for UE B,
ProSe Function A contacts ProSe Function B, which requests location updates
for UE B from SLP B;
4\. The UEs\' locations are reported to their respective ProSe Functions
intermittently. ProSe Function B forwards UE B\'s location updates to ProSe
Function A based on the conditions set by ProSe Function A. Whenever ProSe
Function A receives location updates for UE A and/or UE B, it performs
proximity analysis on UE A and UE B\'s locations;
5\. When ProSe Function A detects that the UEs are in proximity, it informs UE
A that UE B is in proximity and (optionally) provides UE A with assistance
information for WLAN direct discovery and communication with UE B. ProSe
Function A also informs ProSe Function B, which in turn informs UE B of the
detected proximity and (optionally) provides UE B with assistance information
for WLAN direct discovery and communication with UE A.
### 5.5.3 UE registration for ProSe
To obtain ProSe service a ProSe-enabled UE needs to register with the ProSe
Function.
Depicted in Figure 5.5.3-1 is the procedure for UE registration for ProSe.
Figure 5.5.3-1: UE registration for ProSe
1\. To select ProSe Function A, UE A constructs an FQDN using the HPLMN ID and
relies on DNS translation to obtain the IP address of ProSe Function A. UE A
registers with ProSe Function A by sending a UE Registration Request (IMSI,
[WLLID_A]) message.
If UE A intends to use EPC support for WLAN direct discovery and communication
and if it uses a permanent WLAN Link Layer ID, the message also includes UE
A\'s permanent WLAN Link Layer ID (WLLID_A). Alternatively, the UE may obtain
a temporary WLAN Link Layer ID from the ProSe Function as part of the
Proximity Request procedure.
2\. ProSe Function A may interact with the HSS in order to authenticate the
user, obtain the user\'s profile and check whether the user is authorised for
ProSe. Alternatively, all user settings related to authentication and
authorisation for ProSe may be configured locally in ProSe Function A, in
which case the interaction with the HSS is not needed.
3\. ProSe Function A generates an EPC ProSe User ID for the authorized UE A
(EPUID_A), stores the EPUID_A together with user\'s IMSI and responds to UE A
by sending a UE Registration Response (EPUID_A) message.
### 5.5.4 Application registration for ProSe
When a user registers with a 3rd party application server, he/she is
designated an Application Layer User ID (e.g. ALUID_A for user A). This
procedure is out of 3GPP specification scope. Then to activate ProSe features
such as EPC-level ProSe Discovery for a specific application, the UE registers
the application with the ProSe Function, as illustrated in Figure 5.5.4-1.
Figure 5.5.4-1: Application registration for ProSe
1\. UE A sends Application Registration Request (EPUID_A, Application ID,
ALUID_A) message to ProSe Function A to register an application for ProSe.
EPUID_A is the EPC ProSe User ID for UE A. The Application ID is used to
identify the 3rd party App Server platform. ALUID_A is user A\'s Application
Layer User ID.
2\. ProSe Function A uses EPUID_A to retrieve user\'s profile, checks that the
requested application is on the stored list of authorised Application IDs and
sends a ProSe Registration Request (ALUID_A, EPUID_A, PFID_A) message to the
App Server indicating that a user of this application (identified as ALUID_A)
has requested to use ProSe for that application. PFID_A is the ProSe Function
ID of ProSe Function A. If the App Server accepts the request, it stores the
user\'s Application Layer User ID (ALUID_A) and EPC ProSe User ID (EPUID_A)
together with the PFID_A.
3\. The App Server sends a ProSe Registration Response message to ProSe
Function A indicating that the registration was successful (or not).
4\. ProSe Function A sends Application Registration Response (Allowed Range)
message to UE A indicating that the registration was successful (or not). The
Allowed Range parameter contains the set of range classes that are allowed for
this application.
### 5.5.5 Proximity Request
In order to request that it be alerted when it enters proximity with user B,
UE A triggers the Proximity Request procedure, as illustrated in Figure
5.5.5-1.
Figure 5.5.5-1: Proximity Request
1\. UE A sends a Proximity Request (EPUID_A, Application ID, ALUID_A, ALUID_B,
window, Range, A\'s location, [WLAN indication]) message to ProSe Function A.
The Application ID parameter identifies the 3rd party App Server platform.
ALUID_A and ALUID_B are the Application Layer User IDs for users A and B,
respectively. The window parameter indicates the time period during which the
request is valid. Range is a requested range class for this application chosen
from the set of allowed range classes. A\'s location is the current location
of UE A with the best accuracy known by UE A. UE A may optionally request EPC
support for WLAN direct discovery and communication with UE B by adding the
WLAN indication.
2\. ProSe Function A sends a Map Request (ALUID_A, ALUID_B) message to the App
Server, requesting that it provide the EPC ProSe User ID for the targeted user
B. ProSe Function A stores the Application Layer User IDs (ALUID_A and
ALUID_B) until the execution of the Proximity Alert procedure described in
clause 5.5.7, the Proximity Request Cancellation procedure described in clause
5.5.9 or until the expiry of the time window during which the request is
valid.
3\. The App Server checks user B\'s application-specific ProSe permissions,
confirms that user A is allowed to discover user B, and sends a Map Response
(EPUID_B PFID_B) message to ProSe Function A indicating user B\'s EPC ProSe
User ID (EPUID_B) as well as the ProSe Function ID of ProSe Function B
(PFID_B), ProSe Function A stores the EPUID_B and PFID_B until the execution
of the Proximity Alert procedure described in clause 5.5.7, the Proximity
Request Cancellation procedure described in clause 5.5.9 or until the expiry
of the time window during which the request is valid.
4\. ProSe Function A propagates the Proximity Request (EPUID_B, EPUID_A,
Application ID, window, A\'s location, [WLLID_A], SUPL Config) message to
ProSe Function B. A\'s location is the current location of UE A provided in
step 1 expressed in GAD shapes defined in TS 23.032 [3]. WLAN indication is
included if UE A has requested EPC support for WLAN direct discovery and
communication in step 1. SUPL Config is a set of parameters that enable ProSe
Function B to configure SUPL reporting in UE B using the \'\"Inside\" Trigger
with Repeated Reporting\' as defined in OMA AD SUPL [2].
5\. Based on EPUID_B received in the previous step, ProSe Function B retrieves
subscriber B\'s record. ProSe Function B may request UE B\'s last known
location via the HSS (step 5a). Based on the last known location of UE B
obtained via the HSS and UE A\'s location and time window provided by ProSe
Function A in step 4, ProSe Function B may determine that the users are
unlikely to enter proximity within the requested time window and rejects the
request by sending a Proximity Request Reject message towards UE A with an
appropriate cause value (steps 5b and 5c), in which case the remaining steps
of the procedure are skipped.
6\. Depending on UE B\'s ProSe profile, UE B may be asked to confirm
permission for the proximity request (e.g. user B may have temporarily
disabled the ProSe function on UE B).
7\. ProSe Function B requests location reporting on UE B from SLP B and
acknowledges the proximity request to ProSe Function A and provides UE B\'s
current location (if known). The WLAN Link Layer ID of UE B (WLLID_B) is
included if UE A has requested EPC support for WLAN direct discovery and
communication in step 1 and if UE B uses a permanent WLAN Link Layer ID.
8\. ProSe Function A requests location reporting on UE A from SLP A. If UE
A\'s current location is available and if UE B\'s location was included in
step 7, ProSe Function A may decide to cancel the Proximity Request procedure
if it determines that the UEs are unlikely to enter proximity within the
requested time window. Otherwise ProSe Function A acknowledges the proximity
request to UE A.
### 5.5.6 UE Location Reporting
SLP A and SLP B configure UE A and UE B, respectively, to report their
locations periodically, based on a trigger, or a combination of both depending
on what ProSe Function A and ProSe Function B requested (see Figure 5.5.6-1).
Figure 5.5.6-1: UE location reporting
1-4. The locations of UE A and UE B are reported to their corresponding Prose
Servers intermittently.
NOTE 1: If UE is engaged in multiple concurrent proximity request procedures,
the location reports are grouped together by the SLP.
NOTE 2: The UE location reporting procedure is executed until the time window
expires even if UE B \"unfriends\" UE A at application layer in the middle of
an active proximity request.
5\. Assuming that ProSe Function A is in charge of determining proximity,
ProSe Function B forwards UE B\'s location to ProSe Function A at the cadence
prescribed by ProSe Function A in the Proximity Request message. The UE
location information exchanged between ProSe Functions are expressed in GAD
shapes defined in TS 23.032 [3]. ProSe Function A may decide to cancel the
Proximity Request procedure if it determines that the UEs are unlikely to
enter proximity within the requested time window.
NOTE 3: Based on the last reported UE A\'s or UE B\'s location, ProSe Function
A may decide to send a new Proximity Request message over PC6 in order to
provide updated SUPL Config to ProSe Function B.
### 5.5.7 Proximity Alert
When the UEs enter into proximity, the network triggers the Proximity Alert
procedure, as illustrated in Figure 5.5.7-1.
Figure 5.5.7-1: Proximity Alert
1-3.The location of UE B is reported to ProSe Function B, which forwards it to
ProSe Function A.
4\. ProSe Function A detects that the two UEs are in proximity based on the
requested discovery range class and alerts UE A by sending a Proximity Alert
(Application ID, ALUID_B, Assistance Information) message. ALUID_B is the
Application Layer User ID of user B. The message optionally includes
Assistance Information for WLAN direct discovery and communications with UE B.
5\. If UE A has requested as part of the Proximity Request procedure as
described in step 1 of clause 5.5.5 to be assisted for WLAN direct discovery
and communication, ProSe Function A requests ProSe Function B to send a
Proximity Alert (Application ID, ALUID_A, Assistance Information) message to
UE B. ALUID_A is the Application Layer User ID of user A. The message includes
Assistance Information for WLAN direct discovery and communication with UE A.
ProSe Function A cancels location reporting on UE A from SLP A. ProSe Function
B also cancels location reporting on UE B from SLP B.
6\. If UE A has not requested as part of the Proximity Request procedure as
described in step 1 of clause 5.5.5 to be assisted for WLAN direct discovery
and communication, ProSe Function A initiates Proximity Request Cancellation
by sending a Cancel Proximity Request (EPUID_B, EPUID_A) message to ProSe
Function B as described in step 2 of clause 5.5.9.
NOTE 1: The WLAN interface in the UE need not be turned on before step 7 in
Figure 5.5.7-1.
NOTE 2: The assistance information is designed to expedite WLAN direct
discovery and communication. The content of the assistance information depends
on the technology used on the WLAN direct link. All the content in the
assistance information is dynamically generated by ProSe Function A, with the
exception of WLLID_B in case UE B supports only permanent WLLID.
### 5.5.8 UE deregistration for ProSe
#### 5.5.8.1 General
At any time the UE or the ProSe Function may initiate UE deregistration for
ProSe.
#### 5.5.8.2 Network-initiated deregistration
Depicted in Figure 5.5.8.2-1 is the procedure for network-initiated
deregistration for ProSe.
Figure 5.5.8.2-1: Network-initiated deregistration for ProSe
1\. At any time the ProSe Function may decide to deregister the UE by sending
a UE Deregistration Request (cause) message.
2\. UE acknowledges the deregistration request by sending a UE Deregistration
Response message.
#### 5.5.8.3 UE-initiated deregistration
The UE may decide to deregister for ProSe (e.g. when there are no ProSe-
enabled applications activated on the UE). Depicted in Figure 5.5.8.3-1 is the
procedure for UE-initiated deregistration for ProSe.
Figure 5.5.8.3-1: UE initiated deregistration
1\. At any time the UE may decide to deregister for ProSe by sending a UE
Deregistration Request (EPUID, cause) message.
2\. The ProSe Function acknowledges the deregistration request by sending a UE
Deregistration Response message and removes the stored ProSe context for the
UE.
### 5.5.9 Proximity Request Cancellation
The Proximity Request Cancellation may be initiated by the UE or the ProSe
Function.
UE A may decide to cancel Proximity Request it sent earlier (e.g. due to
change in its location, termination of corresponding application or due to
completion of certain event). The ProSe Function A may cancel Proximity
Request sent by UE A earlier (e.g. when time window is exceeded). In order to
cancel Proximity Request, UE A triggers procedure as illustrated in Figure
5.5.9-1.
Figure 5.5.9-1 Proximity Request Cancellation
1\. UE A sends Cancel Proximity Request (EPUID_A, Application ID, ALUID_B) to
Prose Function A. This optional step is performed only when the Proximity
Request Cancellation procedure is initiated by the UE.
2\. Prose Function A sends the Cancel Proximity Request (EPUID_B, EPUID_A)
message to ProSe Function B based on the stored PFID B information.
3\. If there are no other pending proximity requests for UE A, ProSe Function
A cancels location reporting on UE A from SLP A.
4-5. ProSe Function B cancels location reporting on UE B from SLP B and
acknowledges the proximity request cancellation to ProSe Function A.
6\. ProSe Function A sends Proximity Request Cancellation (Application ID,
ALUID_B) to UE A. The Application ID and ALUID_B parameters are included only
when the procedure is initiated by ProSe Function A.
## 5.6 EPC support for WLAN direct discovery and communication
### 5.6.1 General
The EPC network may decide to enable two or more ProSe-enabled WLAN-capable
UEs to directly communicate using WLAN technology. This decision can be taken,
for example, when the EPC network supports EPC-level ProSe discovery and
becomes aware that two or more UEs are in close proximity, when the EPC
network knows that UE-A requests to communicate with UE-B which is in close
proximity of UE-A, etc.
### 5.6.2 Enabling of EPC assisted WLAN direct communication
Figure 5.6.2-1 shows how the EPC network enables UE-A and UE-B to directly
communicate in WLAN direct mode. This is accomplished by triggering the two
UEs to establish a WLAN direct group and providing them with assistance
information which enables the EPC network to control and to expedite the
establishment of the WLAN direct group.
With the procedure shown in Figure 5.6.2-1 the EPC network can (_i_) control
when a WLAN direct group can be established, (_ii_) authorize the UEs that can
become members of this group (and thus communicate with each other in WLAN
direct mode) and (_iii_) control the operating parameters of the WLAN direct
group e.g. the SSID, the security keys, etc.
> NOTE 1: When the WLAN direct discovery and communication is based on the Wi-
> Fi Peer-to-Peer (P2P) specification [13], a WLAN direct group is
> autonomously established by one or more UEs without any network involvement.
> However, with the procedure shown in Figure 5.6.1-1 it is the EPC network
> that can authorize and trigger the establishment of WLAN direct groups. An
> example on the operating parameters provided by the ProSe Function when the
> direct communication is based on Wi-Fi Peer-to-Peer specification [13] can
> be found in Annex A.
NOTE 2: WLAN direct discovery and communication without Assistance Information
from EPC is outside the scope of 3GPP.
The ProSe Function shown in Figure 5.6.2-1 is the network function that
triggers and controls the establishment of a WLAN direct group between one or
more UEs.
Figure 5.6.2-1: Signalling flow for EPC support for WLAN direct communication
1\. The ProSe Function decides to trigger UE-A and UE-B to establish a WLAN
direct group under the control of the network.
2\. The ProSe Function sends a WLAN Direct Group Setup Request (Assistance
Information) to UE-A. The Assistance Information is a set of parameters which
can expedite the establishment of the WLAN direct group and enables the EPC
network to control the operating parameters of the WLAN direct group. The
Assistance Information content depends on the WLAN technology. If UE-A accepts
the request and the offered Assistance Information, it responds with a WLAN
Direct Group Setup Response. This response may include parameters for the WLAN
direct group proposed by UE-A (e.g. an operating channel).
NOTE 2: When EPC support for WLAN direct discovery and communication is used
in conjunction with EPC-level discovery, the assistance information for WLAN
direct discovery and communication is provided as part of the Proximity Alert
procedure.
3\. The ProSe Function sends also a WLAN Direct Group Setup Request
(Assistance Information) to UE-B. The Assistance Information in the request
may take into account the parameters proposed by UE-A in step 2b.
4\. The two UEs establish a WLAN direct group and may start communicating in
WLAN direct mode.
NOTE 3: In this release of the specification it is assumed that UE-A and UE-B
are controlled by the same ProSe Function.
### 5.6.3 Revocation of EPC assisted WLAN direct communication
At any time the ProSe Function may decide to revoke the EPC assisted WLAN
direct communication as shown in Figure 5.6.3-1.
Figure 5.6.3-1: Signalling flow for Revocation of EPC assisted WLAN direct
communication
1\. The ProSe Function decides to revoke EPC assisted WLAN direct
communication for UE-A and UE-B.
2a. The ProSe Function sends a WLAN Direct Communication Revocation Request to
the UE-A.
2b. The UE-A accepts the request.
3a. The ProSe Function sends a WLAN Direct Communication Revocation Request
(Control Information) to the UE-B.
3b. The UE-B accepts the request.
4\. The EPC assisted WLAN direct communication Assistance Information is no
longer valid and the EPC assisted WLAN direct communications using the EPC
Assistance Information are released.
## 5.7 ProSe impacts to EPC procedures
### 5.7.1 E-UTRAN attach procedure for ProSe-enabled UEs
E-UTRAN attach for ProSe-enabled UE is performed as defined in TS 23.401 [5]
with the following additions:
\- ProSe-enabled UE includes the ProSe capability indication as part of the
\"UE Network Capability\" in the Attach Request message. MME stores this
information for ProSe operation. ProSe capability can indicate whether the UE
is capable of supporting one or more of the following ProSe direct services:
ProSe Direct Discovery and ProSe Direct Communication.
\- If the MME is configured to indicate \"ProSe authorised\" to E-UTRAN, the
UE is ProSe-enabled, and the UE is authorised to use ProSe direct services
based on the subscription data, the MME shall include a \"ProSe authorised\"
indication in the S1 AP Initial Context Setup Request, indicating which of the
ProSe direct services the UE is authorised to use.
NOTE: If the TAI list sent to the UE includes different PLMNs, only the
\"ProSe authorised\" information associated with the registered PLMN is
available on the MME. The ProSe authorization for equivalent PLMNs of the
registered PLMN is not addressed in this release of specification.
### 5.7.2 Service Request procedures for ProSe-enabled UEs
Service Request procedures for ProSe-enabled UE are performed as defined in TS
23.401 [5] with the following additions:
\- If the MME is configured to indicate \"ProSe authorised\" to E-UTRAN, the
UE is ProSe-enabled, and the UE is authorised to use ProSe direct services
based on the subscription data, the MME shall include a \"ProSe authorised\"
indication in the S1 AP Initial Context Setup Request, indicating which of the
ProSe direct services the UE is authorised to use.
### 5.7.3 PS Handover procedures for ProSe-enabled UEs
Intra-E-UTRAN S1-based handover or the Inter-RAT to E-UTRAN handover
procedures for ProSe-enabled UE are performed as defined in TS 23.401 [5] with
the following additions:
\- If the MME is configured to indicate \"ProSe authorised\" to E-UTRAN, the
UE is ProSe-enabled, and the UE is authorised to use ProSe direct services
based on the subscription data, the target MME shall send the \"ProSe
authorised\" indication to the target eNodeB as follows:
\- For the intra MME handover, the \"ProSe authorized\" indication is included
in the S1-AP handover Request message. If after the handover procedure, the
\"ProSe authorized\" indication is changed, the updated \"ProSe authorized\"
indication is included in the S1-AP UE Context Modification Request message
sent to the target eNodeB.
\- For the inter MME handover or Inter-RAT handover to E-UTRAN, the \"ProSe
authorized\" indication is included in the S1-AP UE Context Modification
Request message sent to the target eNodeB after the handover procedure.
For X2-based handover, the \"ProSe authorized\" indication is sent to target
eNodeB as follows:
\- If the source eNodeB is ProSe-enabled and the \"ProSe authorized\"
indication is included in the UE context, the source eNodeB shall include a
\"ProSe authorised\" indication in the X2-AP Handover Request message to the
target eNodeB.
\- If the MME is configured to indicate \"ProSe authorised\" to E-UTRAN, the
UE is ProSe-enabled, and the UE is authorised to use ProSe direct services
based on the subscription data, the MME shall send the \"ProSe authorised\"
indication to the target eNodeB in the Path Switch Request Acknowledge
message. If after the handover procedure, the \"ProSe authorized\" indication
is changed, the updated \"ProSe authorized\" indication is included in the
S1-AP UE Context Modification Request message sent to the target eNodeB.
The \"ProSe authorised\" indication sent to target eNodeB denotes which of the
ProSe direct services UE is authorized to use.
### 5.7.4 Tracking Area Update procedure for ProSe-enabled UEs
Tracking Area Update procedures for ProSe-enabled UE are performed as defined
in TS 23.401 [5] with the following additions:
\- ProSe-enabled UE includes the ProSe capability indication as part of the
\"UE Network Capability\" in the Tracking Area Update Request message. MME
stores this information for ProSe operation.
\- If the MME is configured to indicate \"ProSe authorised\" to E-UTRAN and
determines to re-establish the radio and S1 bearers for all active EPS bearer
contexts due to the \"active\" flag included in the Tracking Area Update
Request message or the pending downlink data or signalling, the UE is ProSe-
enabled, and the UE is authorised to use ProSe direct services based on the
subscription data, the MME shall include a \"ProSe authorised\" indication in
the S1-AP Initial Context Setup Request.
NOTE: If the TAI list sent to the UE includes different PLMNs, only the
\"ProSe authorised\" information associated with the registered PLMN is
available on the MME. The ProSe authorization for equivalent PLMNs of the
registered PLMN is not addressed in this release of specification.
### 5.7.5 Insert Subscriber Data procedure for ProSe-enabled UEs
Insert Subscriber Data procedure for ProSe-enabled UE are performed as defined
in TS 23.401 [5] with the following additions:
\- If the \"ProSe authorised\" indication needs to be changed due to the
changed subscription data and the S1 bearer is established, the MME shall
notify the eNodeB the updated \"ProSe authorised\" indication via the S1-AP UE
Context Modification Request message.
### 5.7.6 Delete Subscriber Data procedure for ProSe-enabled UEs
Delete Subscriber Data procedure for ProSe-enabled UE is performed as defined
in TS 29.272 [34] with the same additions as in clause 5.7.5.
###### ## Annex A (informative): Assistance Information for EPC support for
WLAN direct discovery and communication
# A.1 General
This Annex presents an example how the Assistance Information can be designed
to expedite WLAN direct discovery and communication. The Assistance
Information content depends on the WLAN technology.
# A.2 Wi-Fi Peer-to-Peer
Wi-Fi Peer-to-Peer (P2P) specification [13] defines an architecture and set of
protocols that facilitate direct discovery and communication using the IEEE
802.11 technology [14].
To assist WLAN direct discovery and communication as required by the Wi-Fi P2P
technology [13] the EPC needs to supply some or all of the following items as
part of the Assistance Information:
\- SSID: The SSID to use for Wi-Fi P2P operation. To be compliant with the Wi-
Fi P2P specification [13] the SSID should be in the form \"DIRECT-ab\" where
a, b are two random characters.
\- WLAN Secret Key: The pre-shared key to be used by UEs to secure their Wi-Fi
P2P communication. This is used by UEs as the Pairwise Master Key (PMK).
\- Group Owner indication: If set, the UE should implement the Group Owner
(GO) functionality specified in the Wi-Fi P2P specification [13]. The UE
implementing this functionality essentially becomes an AP that transmits
Beacons with the P2P Information Element and accepts associations from other
Wi-Fi P2P devices or from legacy Wi-Fi devices (those not implementing the Wi-
Fi P2P functionality). If not set, the UE should behave as a Wi-Fi P2P client
that attempts to discover and associate with a GO.
\- P2P Device Address of self: This is the WLAN Link Layer ID to be used by a
UE when participating in a Wi-Fi P2P group.
\- P2P Device Address of peers: This is a list of WLAN Link Layer IDs provided
to a UE implementing the Group Owner functionality in a Wi-Fi P2P group. Such
UEs should accept WLAN association requests only from devices that are
included in this list.
\- Operation channel: The channel on which Wi-Fi P2P discovery and
communication should take place.
\- Validity time: The time period during which the content provided in the
assistance information is valid.
###### ## Annex B (informative): Wild carded ProSe Application IDs
# B.1 General
The wildcard indicator, in the MNC or MCC part of the PLMN ID of the ProSe
Application ID indicates whether this particular ProSe Application ID is PLMN
specific (in which case neither MCC nor MNC will be wild carded) or
countrywide (in which case the MNC part will be wild-carded) or global (in
which case both the MCC and MNC parts will be wild-carded).
Countrywide or global ProSe Application IDs belong in different data
structures that are managed by \"authorities\" not associated with a specific
PLMN.
Notwithstanding the description in this annex, showing both PLMN specific and
country-wide or global data structures, this does not preclude that in the
future the country-wide or global data structures may supersede the PLMN
specific data structures.
Figure B.2-1: Country-wide, global and PLMN specific ProSe Application IDs
This arrangement between the PLMN and the \"authority\" that allocates these
ProSe Application IDs is out of scope of 3GPP in this release of the
specification.
NOTE: The interfaces between the ProSe Functions and the repositories of
global or country-wide ProSe Application IDs/ProSe Application Codes that are
shown in figure B.2-1 is out of scope of 3GPP in this Release.
# B.2 Use of wild-carded ProSe Application IDs
The monitoring or announcing UE can request to monitor or announce a ProSe
Application Code that has countrywide or global scope following the procedures
defined in clause 5.3.3 by wildcarding accordingly the MNC element of the PLMN
ID of the ProSe Application ID (for countrywide) or both the MCC and MNC (for
global) elements of the PLMN ID of the ProSe Application ID.
The monitoring UE will have to know whether to send a monitoring request for
PLMN specific, or countrywide, or global ProSe Application ID, based on the
configuration that applies to the particular data structure.
If country-wide or global data structures are used then PC6 and PC7 interfaces
are not used for monitoring requests.
For example if the UE is interested to monitor or announce for restaurants
that are registered in a configured PLMN specific data structure (e.g., local
restaurants in a particular geographical area) it will send a monitoring
request that contains only the following PLMN specific ProSe Application ID.
If on the other hand the UE is interested to monitor or announce for
restaurants that are registered in the configured global data structure (e.g.,
chain restaurants present in several countries/available all over the world)
it will send a monitoring or announcing request that contains only the global
ProSe Application ID. The monitoring UE can also send multiple ProSe
Application IDs with different scope in the same request, but overall it
should not be considered that one ProSe Application ID replaces the other.
#
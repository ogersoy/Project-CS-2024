# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
Since Release 7, SMS delivery over IMS has been possible with TS 23.204 [4].
The fundamental principle used when developing that work is to reuse the
legacy CS SMS infrastructure in order to preserve the possibility to deliver
SMS to both CS/PS domain and IMS as the user may roam between both domains. In
addition, the existing SMS infrastructure that an operator has in place e.g.
SC, GMSC-SMS, IWMSC is able to be reused. This is achieved by mandating MSISDN
as part of the SMS delivery addressing, even for SMS delivery toward IMS.
In Release 11, MTC allows the UE to have PS only subscription without MSISDN.
Such UE may also be IMS UE. Allowing Messages delivery to these UEs in IMS
without MSISDN is an important requirement for these devices.
Therefore, there is a need to improve the SMS submit/delivery mechanism within
IMS to allow MSISDN-less delivery toward the IMS registered UEs.
# 1 Scope
This Technical Report is to specify architecture enhancement toward SMS
submit/delivery mechanism in IMS to allow IMS registered UE to:
\- Receive and send SMS without requiring an MSISDN associated as part of
their IMS subscription record in HSS and
\- any possible enhancements towards the related storing and forwarding
mechanism if the UE is out of reach.
There are three potential aspects for these IMS UEs without MSISDN that need
to be investigated:
1) Server - IMS UE communication via SMS (e.g. for M2M).
2) IMS UE to IMS UE communication via SMS for person to person communications.
Both UEs do not have MSISDN.
3) SMS Interworking between IMS UE without MSISDN and traditional UE (e.g. CS)
with MSISDN.
Normative specification work (if needed or feasible) for each of these areas
can be started independently.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.040: \"Technical realization of the Short Message Service
(SMS)\".
[3] 3GPP TR 21 912 (V3.1.0): \"Example 2, using fixed text\".
[4] 3GPP TS 23.204: \"Short Message Service (SMS) over generic 3GPP Internet
Protocol (IP) access\".
[6] 3GPP TS 24.011: \"Point-to-Point (PP) Short Message Service (SMS) support
on mobile radio interface\".
[7] 3GPP TS 29.311: \"Service Level Interworking (SLI) for messaging
services\".
[8] 3GPP TS 23.682: \"Architecture enhancements to facilitate communications
with packet data networks and applications\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**Server:** A Short Message Entity (SME) in the network which sends or
receives SMS to/from MSISDN-less IMS UE.
**Traditional UE:** UE with MSISDN for as part of its subscription profile and
using MSISDN for SMS service.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply.
MSISDN Mobile Station International ISDN Number
# 4 Architecture Requirements and assumptions
## 4.1 General
The solution shall not impact the SMS service defined in TS 23.040 [2] and
shall coexist with SMS services that make use of MSISDN.
Existing charging procedures for SMS associated with MSISDN shall not be
affected. Charging for SMS not associated with an MSISDN will need to be based
on an identity other than MSISDN.
## 4.2 MSISDN-less IMS UE - Server communication
The solution can assume that:
\- Server can receive UE specific information, e.g. E.164 address of UE\'s IP-
SM-GW or a new functionality to support this scenario;
\- Server can receive SMS via traditional SMS addressing method (i.e. has
E.164 address associated with it).
\- When UE receives an SM from Server, the UE is expected to know which
address to use for SM reply to Server if needed (e.g. address from SM payload
or from TP-OA field, etc.).
## 4.3 Communication between MSISDN-less IMS UEs
## 4.4 MSISDN-less IMS UE -- Traditional UE communication
# 5 Solution Alternatives
## 5.1 Server - MSISDN-less IMS UE communication via SMS
### 5.1.1 Server to MSISDN-less IMS UE
#### 5.1.1.1 Alternative 1: Direct delivery without IP-SM-GW
##### 5.1.1.1.1 Procedure
Figure 5.1.1.1-1 shows a solution when SMS sender delivers the short message
directly to the MSISDN-less IMS UE by creating a terminating SMSIP request.
This solution does not use the legacy SMS architecture.
Figure 5.1.1.1-1: Direct SMSIP delivery to MSISDN-less IMS UE
0) SMS sender decides to send an SMS to the MSISDN-less IMS UE.
1-3) (optional) Either the SMS sender is a server that is aware of the
registration status of the SMSIP capable MSISDN-less IMS UE, or it is assumed
that the MSISDN-less IMS UE is always registered.
NOTE 1: There is no trigger to make the MSISDN-less IMS UE to register.
4) As the SMSIP capable MSISDN-less IMS UE is available, the SMS sender
creates an SMSIP request as done by the IP-SM-GW in short message termination
procedure in case of transport-level interworking with the following changes:
\- The creation of the SMSIP request is not triggered by an SMS received from
SMS-GMSC, but triggered by an application / service logic.
\- The target of the SMSIP request is not a tel URI received in the SMS, but
the SIP URI determined by an application / service logic.
\- The body of the message is the RP-DATA message created by application /
service logic. The RP-DATA includes SMS headers and the SMS user information
encoded as specified in TS 23.040 [2].
NOTE 2: For terminating short message: as the SMSIP message is the last hop of
the \"SMS path\", the RP-Destination-Address element is not needed.
5) (optional) According to operator policy terminating SMSIP requests (not
created by an IP-SM-GW) can be routed to IP-SM-GW for service authorization.
NOTE 3 Charging function is not affected by the fact that the served UE is an
MSISDN-less IMS UE.
6) SMSIP request is sent to the MSISDN-less IMS UE. Note that the 200 OK SIP
response is not shown in the figure.
7-8) MSISDN-less IMS UE sends back delivery report in SMSIP request. Note that
the 200 OK SIP response is not shown.
##### 5.1.1.1.2 Affect / necessary changes in existing functionality
Optional service authorization in IP-SM-GW for a terminating SMSIP request. If
operator policy does not require service authorization, then the IP-SM-GW will
not be triggered as a terminating service.
##### 5.1.1.1.3 Applicability
Requirements for SMS addressing / routing: None, the SMS path not used at all.
Restriction/requirement on SM sender: Store and forward functionality is not
available, SMS sender either must be aware of the availability of the MSISDN-
less IMS UE, or it can be assumed that the MSISDN-less IMS UE is an always-on
type equipment.
##### 5.1.1.1.4 Advantages, drawbacks
**Pro**
\- Simple, no additional requirement for existing functions (except if service
authorization in IP-SM-GW needed).
**Con**
\- SMS sender must be able to create an SMSIP request with terminating SMS and
process delivery report (i.e. not the \'usual\' SMS sending function).
\- No intermediate storage, just a one-shot-message sending.
\- SMS sender must know recipient availability status or assume always-on
status. There is no trigger to make the MSISDN-less IMS UE to register when
the server wants to send a short message.
#### 5.1.1.2 Alternative 2: Direct delivery with IP-SM-GW
##### 5.1.1.2.1 Procedure
Figure 5.1.1.2-1 shows a solution when SMS sender triggers IP-SM-GW to deliver
a short message directly to the MSISDN-less IMS UE over IP. This solution uses
the last hop of the \"SMS path\" mandating SMS over IP.
Figure 5.1.1.2-1: Triggering SMSIP delivery in IP-SM-GW to MSISDN-less IMS UE
0) SMS sender decides to send an SMS to the MSISDN-less IMS UE.
1-3) (optional) Either the SMS sender is a server that is aware of the
registration status of the SMSIP capable MSISDN-less IMS UE, or it is assumed
that the MSISDN-less IMS UE is always registered.
NOTE 1: There is no trigger to make the MSISDN-less IMS UE to register.
4) As the SMSIP capable MSISDN-less IMS UE is available, the SMS sender
triggers IP-SM-GW to deliver short message to the MSISDN-less IMS UE. The
trigger can be:
\- a SIP request (addressing either the IP-SM-GW, or the MSISDN-less IMS UE if
it can be assumed that the IP-SM-GW will be triggered as terminating service
of the MSISDN-less IMS UE); or
NOTE 2: Using a plain SIP MESSAGE request has the drawback that IP-SM-GW must
answer immediately with a 202 Accepted response, which means only that an
intermediate node handles the request.
\- any direct (proprietary) request addressing the IP-SM-GW.
NOTE 3: The IM trigger case is described in separate solution as well.
The trigger must include:
\- the text message the short message must contain;
\- the target MSISDN-less IMS UE\'s SIP URI.
5) The IP-SM-GW creates an SMSIP request as described in procedure for short
message termination in case of service-level interworking with the following
changes:
\- The trigger is generalized, not necessary triggered by an Instant Message,
the trigger can be any request that includes the target of the SMS and the
actual message to be delivered.
NOTE 4: To avoid too many variants of triggers and mechanisms, the same
procedure as defined for Alternative 5 for IP-SM-GW to retrieve the target\'s
SIP_URI can be reused here.
SMSIP request is sent to the MSISDN-less IMS UE. Note that the 200 OK SIP
response not shown.
6) MSISDN-less IMS UE sends back delivery report in SMSIP request. Note that
the 200 OK SIP response not shown.
7) IP-SM-GW sends back a response to the SMS sender.
##### 5.1.1.2.2 Affect / necessary changes in existing functionality
Generalized functionality in IP-SM-GW: create terminating SMSIP based on any
request, leaving the RP-Destination-Address empty.
Also domain selection functionality of IP-SM-GW has to be skipped. According
to TS 23.204 [4] 6.11 point 4 delivery over CS/PS is also needed if not
possible via IMS even if IP-SM-GW is triggered by IM and not MT-SM. But in
this case it is not possible since HLR query via SRIforSM cannot be done
without MSISDN-B. Also RSMDS cannot be done without MSISDN.
##### 5.1.1.2.3 Applicability
Requirements for SMS addressing / routing: None, only the last hop of the SMS
path is used.
Restriction/requirement on SM sender: Store and forward functionality is not
available, SMS sender either must be aware of the availability of the MSISDN-
less IMS UE, or it can be assumed that the MSISDN-less IMS UE is an always-on
type equipment.
##### 5.1.1.2.4 Advantages / Drawbacks
**Pro**
\- Simple, generalization of an existing functions.
**Con**
\- SMS sender must be able to create an SMSIP request with terminating SMS and
process delivery report (i.e. not the \'usual\' SMS sending function).
\- No intermediate storage, just a one-shot-message sending.
\- SMS sender must know recipient availability status or assume always-on
status. There is no trigger to make the MSISDN-less IMS UE to register when
the server wants to send a short message.
\- It is necessary to standardize how the target of the SMS is sent to the IP-
SM-GW.
#### 5.1.1.3 Alternative 3: SMS delivery with modified IM-SMS interworking
##### 5.1.1.3.1 Procedure
Figure 5.1.1.3-1 shows a solution when server sends Instant Message and IP-SM-
GW interworks that to SMS over IP.
Figure 5.1.1.3-1: IM to SM interworking -- registered case
0) SMS sender decides to send a message to the SMS capable MSISDN-less IMS UE
as an Instant Message.
1-4) SMS sender triggers IP-SM-GW to deliver short message to the MSISDN-less
IMS UE by sending an Instant Message.
5) The IP-SM-GW creates an SMSIP request as described in procedure for short
message termination in case of service-level interworking. SMSIP request is
sent to the MSISDN-less IMS UE. Note that the 200 OK SIP response not shown.
6) MSISDN-less IMS UE sends back delivery report in the SMSIP request. Note
that the 200 OK SIP response not shown.
7-10) If requested in the Instant Message, IP-SM-GW sends back a delivery
notification towards the SMS sender.
Figure 5.1.1.3-2 shows the same scenario when SMSIP capable MSISDN-less IMS UE
is not registered.
Figure 5.1.1.3-2: IM to SM interworking -- unregistered case
0) SMS sender decides to send a message to the SMS capable MSISDN-less IMS UE
as an Instant Message.
1-2) The Instant Message reaches the IM AS with the iFC mechanism. As the IM
AS is aware of the MSISDN-less IMS UE\'s registration status, it stores the
Instant Message.
3-4) IM AS sends back a response indicating that the message is handled by an
intermediate entity.
5-6) MSISDN-less IMS UE registers, IM AS (and IP-SM-GW) is notified on the
availability of an SMSIP capable MSISDN-less IMS UE.
7-8) IM AS sends the stored Instant Message towards the MSISDN-less IMS UE.
The request reaches the IP-SM-GW with the iFC mechanism.
9) The same procedure applies as in registered case, starting from step 5, see
figure 5.1-3. The rest of the procedure is not shown.
##### 5.1.1.3.2 Affect / necessary changes in existing functionality
In case of service level interworking from IM to SM on the terminating side
(see clause 6.1.5.3.4 in TS 29.311 [7]), the IP-SM-GW will not perform the SMS
router functionality (i.e. no domain selection for SMS termination).
##### 5.1.1.3.3 Applicability
Requirements for SMS addressing / routing: None, only the last hop of the SMS
path is used.
IM AS is available in the MSISDN-less IMS UE\'s network, and the MSISDN-less
IMS UE is authorized to use both instant messaging and SMS over IP services.
Domain selection functionality of IP-SM-GW has to be skipped. According to TS
23.204 [4] (see clause 6.11, bullet 4) delivery over CS/PS is also needed if
not possible via IMS even if IP-SM-GW is triggered by IM and not MT-SM. But in
this case it is not possible since HLR query via SRIforSM cannot be done
without MSISDN-B. Also RSMDS cannot be done without MSISDN.
##### 5.1.1.3.4 Advantages / Drawbacks
**Pro**
\- Simple, minimal change in existing functionality (IP-SM-GW must not perform
SMS router functionality).
\- intermediate storage available.
**Con**
\- IM needed in the MSISDN-less IMS UE\'s network.
#### 5.1.1.4 Alternative 4: SMS delivery through SMS proxy
##### 5.1.1.4.1 Procedure
In the following two solutions an \"SMS proxy\" is assigned to the MSISDN-less
IMS UE. The E.164 address of the SMS proxy can be stored as an addition to the
subscriber data of the MSISDN-less IMS UE. The \"SMS proxy\" can be co-located
with the IP-SM-GW.
The scenario in figure 5.1.1.4-1 assumes that the \"SMS proxy\" is co-located
with IP-SM-GW.
Figure 5.1.1.4-1: SMS proxy (co-located with IP-SM-GW)
0) SMS sender decides to send an SMS to the MSISDN-less IMS UE.
1) SMS sender sends the short message to the E.164 address of the \"SMS
proxy\". The short message includes the MSISDN-less IMS UE\'s SIP URI besides
the actual message. The short message is delivered to the SMS proxy.
NOTE 1: As for this solution the SC alert mechanism is not available, it is
advised to send short messages via SMS proxy with short validity period.
2) Based on the received short message the SMS proxy creates a terminating
short message as an SMSIP request with the following changes:
\- the user information is copied from the received message after cutting out
the MSISDN-less IMS UE\'s SIP URI; and
\- the target of the SMSIP request is the MSISDN-less IMS UE\'s SIP URI
received in the SMS.
NOTE 2: The 200 OK SIP response is not shown in the figure.
3) MSISDN-less IMS UE\'s SIP URI sends back delivery report in SMSIP request.
Note that the 200 OK SIP response not shown.
4) SMS proxy (IP-SM-GW) sends back delivery report towards the SC.
As from SC point of view the SMS proxy is the target of the short message, the
SC alert mechanism must not be triggered (a successful delivery to an another
MSISDN-less IMS UE would trigger another delivery attempt to the unavailable
MSISDN-less IMS UE), so the IP-SM-GW will not report the short message
delivery status in this case.
In case of failure the delivery report must indicate a temporary error to
ensure that SC will re-attempt delivery.
##### 5.1.1.4.2 Affect / necessary changes in existing functionality
Generalized functionality in IP-SM-GW: create terminating SMSIP based on any
request.
IP-SM-GW will not report short message delivery status to the HLR and will not
attempt domain selection.
##### 5.1.1.4.3 Applicability
Requirements for SMS addressing / routing: None.
Restriction/requirement on SM sender:
1\. The SMS sender either must be aware of the MSISDN-less IMS UE\'s
availability, or it can be assumed that the MSISDN-less IMS UE is an always-on
type equipment.
2\. SMS sender must know the SMS proxy of the MSISDN-less IMS UE: can be a
subscription info, or could be configured number (even in inter-operator
agreement if the incoming short messages for all MSISDN-less IMS UEs for a
certain operator are handled by the same SMS proxy).
3\. In addition to the actual message, the address (SIP URI) of the MSISDN-
less IMS UE must also be included in the short message, this reduces the
maximum message length that can be sent in a single short message.
Assuming that the SMS proxy is always on, the SC alert mechanism is not
applicable.
##### 5.1.1.4.4 Evaluation
**Pro**
\- The SMS sender can use any access technology to send short message.
**Con**
\- If the SMS proxy cannot forward the short message to the addressed MSISDN-
less IMS UE, then the message delivery fails, but the SC alert mechanism
cannot be used, only the re-attempt delivery mechanism of the SC will trigger
another delivery attempt. At the same time to ensure that offline MSISDN-less
IMS UEs do not cause big load (both on the number of short message delivery
attempts and on the number of stored shored messages), the validity period
must be set to a low value.
\- SMS sender must send a short message to an SMS proxy, and the message must
include the real addressee of the message.
\- It is necessary to standardize how the target of the SMS is sent to the SMS
proxy.
#### 5.1.1.5 Alternative 5: Direct delivery with IP-SM-GW interworking
##### 5.1.1.5.1 Procedure
Each IMS server/application has an assigned MSISDN.
The MSISDN-less terminating short code or other special address is a \"code\"
that the IP-SM-GW recognizes as a MSISDN-less IMS UE terminated IM or SM
during the process.
The MSISDN-less terminating code will indicate MSISDN-less UE address is
embedded in the use data. This is a common code used by all MSISDN-less IMS
UEs for MT procedures.
Figure 5.1.1.5-1 shows a solution when server sends a SIP MESSAGE to MSISDN-
less IMS UE via IP-SM-GW.
Figure 5.1.1.5-1: IMS Server Delivery SM to MSISDN-less UE
0) IMS server decides to send an IM or SM to the MSISDN-less IMS UE.
1) IMS server sends an IM or SM to the MSISDN-less IMS UE via IP-SM-GW.
This request includes a vnd.3gpp.sms payload that includes the short message
and routing information for the IP-SM-GW to forward the short message. SIP
Request URI and To headers should be IM-SM-GW SIP URI, From header should be
IMS server SIP URI.
IMS Server MSISDN should be included in RP-OA and TP-OA of RP-DATA (SMS-
DELIVER) (see TS 24.011 [6] and TS 23.040 [2]).
MSISDN-less UE terminating code should be included. IMS server must embed
MSISDN-less IMS UE address in use data body. IMS Server includes MSISDN-less
UE terminating code so IP-SM-GW can retrieve UE address (e.g. SIP URI) from
the use data body -- embedding UE address is required since SIP headers do not
include UE address. The MSISDN-less UE terminating code is included in RP-DA.
2) IP-SM-GW returns 202 Accepted.
3-5) (optional) IP-SM-GW receives SIP MESSAGE with SMS-DELIVER, and queries
HSS for MSISDN-less IMS UE. HSS returns UE status and S-CSCF address.
IP-SM-GW will retrieve MSISDN-less UE address from the user data body per
indication of MSISDN-less terminating code, and query HSS using MSISDN-less UE
address.
6) IP-SM-GW sends SIP MESSAGE to S-CSCF.
In this step, IP-SM-GW will fill the UE address in SIP Request URI and To
headers as it is a pure MT scenario. From header should be IP-SM-GW. RP-OA and
TP-OA will be IMS server MSISDN, IP-SM-GW may not parse or change RP-DATA.
7) S-CSCF sends SIP MESSAGE to MSISDN-less IMS UE.
S-CSCF will not change SIP headers except Route header. S-CSCF will not parse
or change RP-DATA encapsulated in SIP MESSAGE
8-9) UE returns 200 OK.
10) UE parses SMS payload successfully and returns RP-ACK encapsulated in a
SIP MESSAGE to S-CSCF with the IP-SM-GW address in SIP Request URI and To
headers, and MSISDN-less UE SIP URI in SIP From header. UE may optionally
embed UE address in the user data of RP-ACK.
In the RP-ACK, RP-DA (optional) is IMS server MSISDN that the UE obtained from
the TP-OA of RP-DATA; the MSISDN-less terminating code that the UE obtained
from the received SM is included in RP-OA.
11) S-CSCF forwards a SIP MESSAGE containing the RP-ACK to IP-SM-GW.
S-CSCF will not change SIP headers except Route header. S-CSCF will not parse
or change RP-DATA encapsulated in SIP MESSAGE.
12-13) IP-SM-GW returns 202 Accepted.
14) (optional) IP-SM-GW sends a SIP MESSAGE encapsulating SMS-STATUS-REPORT in
RP-DATA to IMS server.
IP-SM-GW will fill IMS server SIP URI in SIP Request URI and To headers, and
IP-SM-GW URI in From header. It must fill TP-Recipient-Address (TP-RA)
(mandatory field) so this is set to the MSISDN-less terminating code, and must
include MSISDN-less UE address in the user data body. IP-SM-GW either obtains
UE address from the user data body of RP-ACK or from previously saved data.
15) (optional) IMS server returns 200 OK.
##### 5.1.1.5.2 Affect / necessary changes in existing functionality
IMS server will use MSISDN-less terminating code. This MSISDN-less terminating
short code or other special address is a \"code\" that the IP-SM-GW recognizes
as a MSISDN-less IMS UE terminated IM or SM during the process.
IMS server will embed MSISDN-less UE address in SM use data body of RP-DATA.
UE will embed MSISDN-less UE address in SM use data body of RP-ACK.
IP-SM-GW must recognize MSISDN-less terminating code as an indicator to obtain
embedded UE IP identifier from the SM use data body.
##### 5.1.1.5.3 Applicability
Requirements for SMS addressing / routing: same as existing function.
Restriction/requirement on SM sender: Store and forward functionality is not
available if SIP MESSAGE is sent to IP-SM-GW (since IP-SM-GWs do not support
this functionality).
##### 5.1.1.5.4 Evaluation
**Pro**
\- Minimal impact on IP-SM-GW, IMS Server and MSISDN-less UE to use MSISDN-
less terminating code for embedded MSISDN-less IMS address.
\- IP-SM-GW can use MSISDN-less IMS UE address embedded in use data for
billing identifier.
NOTE: In practice, some SM entities only use parameters in RP-DATA for billing
but ignore SIP headers.
\- Encapsulating sender or receiver\'s alternative address in use data body
has been commonly used in practice, like encapsulating email address in use
data body for email and SM exchanges at Email GW.
\- The MSISDN-less terminating code can be optionally used as MTC user group
identifier.
**Con**
\- IM or SM needed in the IMS network with MSISDN-less IMS UE.
### 5.1.2 MSISDN-less IMS UE to Server
#### 5.1.2.1 Alternative 1: Direct delivery with IP-SM-GW interworking
##### 5.1.2.1.1 Procedure
Each IMS server/application has an assigned MSISDN.
The MSISDN-less originating short code or other special address is a \"code\"
that the IP-SM-GW recognizes as a MSISDN-less IMS UE originated IM or SM
during the process.
The MSISDN-less originating short code or other special address will indicate
MSISDN-less UE address is embedded in the use data. This is a common code used
by all MSISDN-less IMS UEs for MO procedures.
Figure 5.1.2.1-1 shows a solution when an MSISDN-less IMS UE sends a SIP
MESSAGE to IMS sever via IP-SM-GW.
Figure 5.1.2.1-1: MSISDN-less UE Submit SM to IMS Server
1) MSISDN-less IMS UE originates an IM or SM to IMS server via IP-SM-GW.
This request includes a vnd.3gpp.sms payload that includes the short message
and routing information for the IP-SM-GW to forward the short message.
SIP Request URI and To headers should be IM-SM-GW SIP URI, From header should
be UE SIP URI.
MSISDN-less Originating code should be included, and IMS server MSISDN in RP-
DA and TP-DA of RP-DATA (SMS-SUBMIT). The MSISDN-less UE originating code is
included in RP-OA.
MSISDN-less IMS UE address is embedded in use data body. Even UE address is
already in SIP From header, it is strongly suggest to embed UE address in the
user data body so that next hop IP-SM-GW won\'t need to embed it when sending
SIP MESSAGE to the IMS server.
2) S-CSCF runs iFC.
3) S-CSCF routes SIP MESSAGE to IP-SM-GW.
S-CSCF will not change SIP headers except Route header. S-CSCF will not parse
or change RP-DATA encapsulated in SIP MESSAGE
4) IP-SM-GW forwards SIP MESSAGE to IMS server.
IP-SM-GW will fill IMS server URI in SIP Request URI and To headers, and IP-
SM-GW URI in To header. IP-SM-GW will not change addresses in RP-DATA.
5-7) IMS server returns 202 Accepted.
8) IMS server parses SM data.
9) IMS server returns RP-ACK encapsulated in a SIP MESSAGE to MSISDN-less UE
to IP-SM-GW. SIP From header will be IMS server SIP URI, and SIP Request URI
and To headers will be IP-SM-GW SIP URI. In RP-ACK, RP-OA is the IMS server
MSISDN, and the MSISDN-less originating code that the IMS server obtained from
the received SM is included in RP-DA. MSISDN-less UE address is embedded in
the use data body.
10) IP-SM-GW retrieves MSISDN-less UE address from the user data body or from
previously saved data, send SIP MESSAGE with RP-ACK encapsulated to S-CSCF.
SIP Request URI and To headers are UE URI, From header is IP-SM-GW URI.
11) S-CSCF forwards SIP MESSAGE with RP-ACK to MSISDN-less UE.
12-14) MSISDN-less UE returns 202 Accepted.
##### 5.1.2.1.2 Affect / necessary changes in existing functionality
MSISDN-less UE will use MSISDN-less originating code. This MSISDN-less
originating code will help IP-SM-GW realize it is a MSISDN-less IMS UE
originated IM or SM during the process.
MSISDN-less UE will embed MSISDN-less UE address in SM use data body of RP-
DATA.
IMS-Server will embed MSISDN-less UE address in SM use data body of RP-ACK.
IP-SM-GW must recognize MSISDN-less originating code as an indicator to obtain
embedded UE IP identifier from the SM use data body.
##### 5.1.2.1.3 Applicability
Requirements for SMS addressing / routing: same as existing function.
Restriction/requirement on SM sender: Store and forward functionality is not
available if SIP MESSAGE is sent to IP-SM-GW (since IP-SM-GWs do not support
this functionality).
##### 5.1.2.1.4 Evaluation
**Pro**
\- Minimal impact on IP-SM-GW, IMS Server and MSISDN-less UE to use MSISDN-
less originating code for embedded MSISDN-less IMS address.
\- IP-SM-GW can use MSISDN-less IMS UE address in SIP From header or embedded
in use data for as billing identifier.
NOTE: In practice, some SM entities only use parameters in RP-DATA for billing
but ignore SIP headers.
Encapsulating sender or receiver\'s alternative address in use data body has
been commonly used in practice, like encapsulating email address in use data
body for email and SM exchanges at Email GW.
\- The MSISDN-less originating code can be optionally used as MTC user group
identifier.
**Con**
\- IM or SM needed in the IMS network with MSISDN-less IMS UE.
#### 5.1.2.2 Alternative 2: SMS delivery through SMS proxy
##### 5.1.2.2.1 Procedure
In the following two solutions an \"SMS proxy\" is assigned to the MSISDN-less
IMS UE. The E.164 address of the SMS proxy can be stored as an addition to the
subscriber data of the MSISDN-less IMS UE. The \"SMS proxy\" can be co-located
with the IP-SM-GW.
The scenario in figure 5.1.2.2-1 assumes that the \"SMS proxy\" is co-located
with IP-SM-GW.
Figure 5.1.2.2-1: SMS proxy (co-located with IP-SM-GW)
1) MSISDN-less IMS UE submits a short message as an SMSIP message.
2) As no E.164 number (MSISDN) available for the originator of the request,
the IP-SM-GW acts as an SMS proxy and adds its own E.164 address as the
originator of the short message (RP-Originating-Address) and includes the
MSISDN-less IMS UE\'s SIP URI into the actual message.
NOTE 1: If based on configuration the IP-SM-GW can assume that an identifier
of the MSISDN-less IMS UE (e.g. device id) is already included in the short
message itself (the server will know the originator\'s identity), then it is
not necessary to insert the MSISDN-less IMS UE\'s SIP URI into the actual
message.
3) The IP-SM-GW acknowledges the SMSIP message with a 202 (Accepted) response.
4) The IP-SM-GW forwards the short message to the SC.
5) The SC returns a submit report.
6) The IP-SM-GW forwards the submit report to the MSISDN-less IMS UE as an
SMSIP message.
7) The MSISDN-less IMS UE returns a 200 (OK) response.
8) Using standard SM delivery procedures the SC attempts to deliver the short
message to the \"Server/SMS receiver\".
The scenario in figure 5.1.2.2-2 assumes that the \"SMS proxy\" is not co-
located with IP-SM-GW.
Figure 5.1.2.2-2: Standalone SMS proxy
1) MSISDN-less IMS UE submits a short message as an SMSIP message.
2) SMS proxy creates a new request to the IP-SM-GW as a B2BUA. It includes the
MSISDN-less IMS UE\'s SIP URI into the actual message. The originator of the
new SMSIP submit message is the SMS proxy.
NOTE 1: If based on configuration the SMS proxy can assume that an identifier
of the MSISDN-less IMS UE (e.g. device id) is already included in the short
message itself (the server will know the originator\'s identity), then it is
not necessary to insert the MSISDN-less IMS UE\'s SIP URI into the actual
message.
3) The SMS proxy acknowledges the SMSIP message with a 202 (Accepted)
response.
4) The SMS proxy sends the new SMSIP submit request to the IP-SM-GW.
5) The IP-SM-GW acknowledges the SMSIP message with a 202 (Accepted) response.
6) The IP-SM-GW forwards the short message to the SC.
7a) The SC returns a submit report.
7b) Using standard SM delivery procedures the SC attempts to deliver the short
message to the \"Server/SMS receiver\".
8) The IP-SM-GW forwards the submit report to the SMS proxy as an SMSIP
message.
9) The SMS proxy returns a 202 (Accepted) response.
10) The SMS proxy forwards the submit report to the MSISDN-less IMS UE as an
SMSIP message.
NOTE 2: No B2BUA needed for the submit report.
11) The MSISDN-less IMS UE returns a 200 (OK) response.
In both of these variants, the SMSC needs to have an indication that the
sender\'s address is embedded in the SMS payload. This indication can be based
on a special E.164 number that the IP-SM-GW inserts into the TP-OA field which
will allow the SMSC to perform this triggering.
##### 5.1.2.2.2 Affect / necessary changes in existing functionality
SMS proxy functionality in the originating network introduced that can be co-
located with IP-SM-GW.
SMSC/SMS-IWMSC needs a new functionality to detect the sender identity based
on indication /matching in TP-OA field.
##### 5.1.2.2.3 Applicability
**Requirements for SMS addressing / routing:** None.
**Restriction/requirement on SM sender:** None.
**Restriction/requirement on the \"Server/SMS receiver\":** Must determine the
originator\'s identity from the received short message itself (and can create
answer SMS as described in clause 5.1.1).
##### 5.1.2.2.4 Advantages, drawbacks
**Pro**
\- The \"Server/SMS receiver\" can use any access technology to receive short
message.
\- Can be used for any receiver assuming that the receiver is able to
determine the originator\'s identity from the received short message itself
(and not TP-Originating-Address).
**Con**
\- SMS proxy needed.
\- It is necessary to standardize how the originator of the SMS is sent from
the SMS proxy.
\- SMSC is impacted and coordination of indication between IP-SM-GW and SMSC
are required.
#### 5.1.2.3 Alternative 3: SMS submit with direct delivery from originating
IP-SM-GW
##### 5.1.2.3.1 Procedure
Figure 5.1.2.3-1 shows a solution in which the MSISDN-less IMS UE submits a
SM, which triggers IP-SM-GW to deliver the short message directly to the
\"Server/SMS receiver\". This solution uses the first and last hop of the
\"SMS path\" by basically skipping the legacy SMS architecture including the
intermediate storage functionality. For the SMS submit, SMS over IP is
mandatory.
Figure 5.1.2.3-1: Direct delivery from originating IP-SM-GW
1-2) MSISDN-less IMS UE submits a short message as an SMSIP message. The IP-
SM-GW acknowledges the request with a 202 (Accepted) response.
3) As no E.164 number (MSISDN) available for the originator of the request,
the IP-SM-GW creates a terminating short message as follows:
\- the short message includes the MSISDN-less IMS UE\'s SIP URI into the
actual message;
Editor\'s note: It is necessary to standardize how the MSISDN-less IMS UE\'s
SIP URI is sent in the SMS to the server.
NOTE 1: If based on configuration, the IP-SM-GW can assume that an identifier
of the MSISDN-less IMS UE (e.g. device id) is already included in the short
message itself (the server will know the originator\'s identity), then it is
not necessary to insert the MSISDN-less IMS UE\'s SIP URI into the actual
message.
\- both the sender of the request (RP-Originating-Address) and the originator
of the request (TP-Originating-Address ) is set to the E.164 address of the
IP-SM-GW.
4) The SMSIP message is sent to the \"Server/SMS receiver\".
NOTE 2: The termination of the SIP MESSAGE request to the \"Server/SMS
receiver\" can include the routing of a request to an I-CSCF / S-CSCF in a
terminating network that hosts the \"SMS receiver\", those hops are not shown
in Figure 5.1-x.
5) The \"Server/SMS receiver\" answers with a 200 (OK) response.
6) The \"Server/SMS receiver\" sends back a delivery report in an SMSIP
message.
7) The IP-SM-GW returns a 202 (Accepted) response.
8-9) The IP-SM-GW creates a submit report based on the delivery report and
sends it back to the MSISDN-less IMS UE in an SMSIP request.
10) The MSISDN-less IMS UE returns a 200 (OK) response.
NOTE 3: If the MSISDN-less IMS UE has requested status report, the IP-SM-GW
can send that to the MSISDN-less IMS UE after the 200 (OK) response for the
submit report is received.
##### 5.1.2.3.2 Affect / necessary changes in existing functionality
Direct delivery (creating a short message delivery request based on the short
message submit request without sending it to a SC is an possible optimization
implementation today, although not standardized. As part of the direct
delivery procedure the IP-SM-GW may need to manipulate the short message text,
inserting the originator\'s SIP URI.
The \"Server/SMS receiver\" must be ready to determine the originator\'s
identity from the received short message itself (ignoring the TP-Originating-
Address) either as the SIP URI inserted by the IP-SM-GW, or the identity (e.g.
device id) inserted by the MSISDN-less IMS UE.
##### 5.1.2.3.3 Applicability
Requirements for SMS addressing / routing: None. The \"Server/SMS receiver\"
must know that the TP-Originating-Address of the received short message is the
E.164 address of the IP-SM-GW.
**Restriction on SM sender:** None.
IP-SM-GW must support direct delivery, and optionally the insertion of the
real originator\'s address into the short message.
\"Server/SMS receiver\" can determine the originator\'s identity from the
received short message itself (and can create answer SMS as described in
clause 5.1.1).
No storage capability in the network used, \"Server/SMS receiver\" is assumed
to be always-on. If the \"Server/SMS receiver\" is not always-on, then:
\- the MSISDN-less IMS UE must try resending the SMS periodically (additional
load for the network);
\- an additional mechanism needed to inform MSISDN-less IMS UE on the
availability of the \"Server/SMS receiver\";
\- the IP-SM-GW attempts another method, considering direct delivery as an
optimization only.
##### 5.1.2.3.4 Advantages / Drawbacks
**Pro**
\- No service level interworking needed.
\- Only the (extended) IP-SM-GW used in the network.
**Con**
\- It may be required to add the identifier of the MSISDN-less IMS UE sender
if it has not been included by the client already.
\- No intermediate message storage capability used in the network.
## 5.2 Communication via SMS between MSISDN-less IMS UEs
### 5.2.1 Alternative 1: Direct delivery with IP-SM-GW interworking
#### 5.2.1.1 Procedure
The MSISDN-less originating and terminating short codes or other special
addresses are a \"code\" that the IP-SM-GW recognizes as a MSISDN-less IMS UE
originated or terminated IM or SM during the process.
The MSISDN-less originating or terminating codes will indicate MSISDN-less UE
address is embedded in the use data. Each is a common code used by all MSISDN-
less IMS UEs for MT or MO procedures.
Figure 5.2.1-1 shows a solution when an MSISDN-less IMS UE sends a SIP MESSAGE
to another MSISDN-less IMS UE via IP-SM-GW.
Figure 5.2.1-1: MSISDN-less UE to MSISDN-less UE
1) MSISDN-less UE 1 sends an IM or SM to the MSISDN-less IMS UE 2 via IP-SM-
GW.
This request includes a vnd.3gpp.sms payload that includes the short message
and routing information for the IP-SM-GW to forward the short message.
Addresses are included in RP-DATA (SMS-SUBMIT) (see TS 24.011 [6] and TS
23.040 [2]). MSISDN-less originating code, and MSISDN-less terminating code
are included. MSISDN-less IMS UE 1 (originator) and MSISDN-less IMS UE 2
(recipient) addresses must be embedded in use data body. Note: SIP header does
not contain MSISDN-less IMS UE 2 (recipient) addresses. So, it is critical to
include MSISDN-less IMS UE 2 (recipient) addresses in use data body. The
MSISDN-less originating code is included in RP-OA, and MSISDN-less terminating
code in RP-DA and TP-DA.
2) S-CSCF runs iFC.
3) S-CSCF routes SIP MESSAGE to IP-SM-GW.
4-5) IP-SM-GW returns 202 Accepted.
6-7) IP-SM-GW sends a SIP MESSAGE to MSISDN-less UE 1. In RP-ACK, RP-OA is IP-
SM-GW MSISDN, MSISDN-less originating code is included in RP-DA. MSISDN-less
UE 1 address can be optionally embedded in use data body.
IP-SM-GW use UE 1 SIP URI in SIP Request URI and To header and SC URI in From
header. UE 1 address is in SIP header, so it is optional to embed UE 1 address
in the user data body.
8-9) MSISDN-less UE 1 returns 200 OK.
10-12) (optional) IP-SM-GW queries HSS for MSISDN-less IMS UE 2. HSS returns
UE 2 status and terminating S‑CSCF address.
IP-SM-GW retrieves UE 2 address from the user data body per MSISDN-less
originating code, and uses UE 2 address to query the HSS.
13) IP-SM-GW sends SIP MESSAGE to S-CSCF.
This request includes a vnd.3gpp.sms payload that includes the short message
and routing information to forward the short message. Addresses is included in
RP-DATA (SMS-DELIVER) (see TS 24.011 [6] and TS 23.040 [2]) with IP-SM-GW
address in RP-OA and TP-OA, MSISDN-less UE terminating code is included in RP-
DA. MSISDN-less IMS UE 1 (originator) and MSISDN-less IMS UE 2 (recipient)
addresses must be embedded in use data body. Note: SIP header does not contain
MSISDN-less IMS UE 1 (originator) addresses. So, it is critical to include
MSISDN-less IMS UE 1 (originator) addresses in use data body.
It is a MT scenario, IP-SM-GW uses UE 2 SIP URI in SIP Request URI and To
headers, and SC SIP URI in From header.
14) Terminating S-CSCF sends SIP MESSAGE to MSISDN-less IMS UE 2.
15-16) MSISDN-less IMS UE 2 returns 200 OK.
17) MSISDN-less IMS UE 2 parses SMS payload successfully and returns RP-ACK
encapsulated in a SIP MESSAGE to S-CSCF. In RP-ACK, RP-DA is IP-SM-GW address,
MSISDN-less terminating code is included in the RP- OA. MSISDN-less IMS UE 1
(originator) and MSISDN-less IMS UE 2 (recipient) addresses must be embedded
in use data body. Note: SIP header does not contain MSISDN-less IMS UE 1
(originator) addresses.
Similar to the SIP MO scenario, UE 2 uses SC SIP URI in SIP Request URI and To
headers and UE 2 SIP URI in From header.
18) Terminating S-CSCF forwards a SIP MESSAGE with RP-ACK to IP-SM-GW.
19-20) IP-SM-GW returns 202 Accepted.
21-23) (optional) IP-SM-GW queries HSS for MSISDN-less IMS UE 1. HSS returns
UE 1 status and originating S-CSCF address.
IP-SM-GW retrieves UE 1 address from the user data body per MSISDN-less
terminating code, and uses UE 1 address to query the HSS.
24-25) (optional) IP-SM-GW sends SIP MESSAGE encapsulating SMS-STATUS-REPORT
in RP-DATA to MSISDN-less IMS UE 1.
IP-SM-GW will fill UE 1 SIP URI in SIP Request URI and To headers, and SC URI
in From header. It must fill TP-Recipient-Address (TP-RA) (mandatory field)
and with the MSISDN-less originating code, and must include MSISDN-less UE
address in the user data body.
26-27) (optional) MSISDN-less IMS UE 1 returns 200 OK.
#### 5.2.1.2 Affect / necessary changes in existing functionality
IP-SM-GW will use the MSISDN-less originating and terminating codes realize it
is MSISDN-less IMS UE to MSISDN-less IMS UE during the process.
UE and IP-SM-GW have to embed MSISDN-less UE addresses (originator and
recipient) in SM use data body (RP-DATA and RP-ACK).
MSISDN-less IMS UE can be optionally used as MTC user group identifier.
#### 5.2.1.3 Applicability
Requirements for SMS addressing / routing: IP-SM-GW uses MSISDN-less
originating and terminating codes and MSISDN-less UE addresses (originator and
recipient) in SM payload together to figure out addresses and routing.
Restriction/requirement on UE: none.
#### 5.2.1.4 Evaluation
**Pro**
\- Minor change in existing functionality in IP-SM-GW and MSISDN-less UEs to
use MSISDN-less terminating code and MSISDN-less originating code for embedded
MSISDN-less IMS addresses.
\- MSISDN-less IMS UE addresses are used in SIP From or To headers, and
embedded in use data. MSISDN-less IMS UE addresses need to be used for billing
purpose. Note: in practice, some SM entities only use parameters in RP-DATA
for billing but ignore SIP headers.
\- Encapsulating sender or receiver\'s alternative address in use data body
has been commonly used in practice, like encapsulating email address in use
data body for email and SM exchanges at Email GW. Encapsulating sender or
receiver\'s MSISDN-less IMS UE address in use data body aligns with current
usages.
\- The MSISDN-less originating and terminating codes can be optionally used as
MTC user group identifier.
**Con**
\- IM or SM needed in the IMS network with MSISDN-less IMS UE.
### 5.2.2 Alternative 2: Direct delivery with SIP level interworking I
#### 5.2.2.1 Procedure
The SIP MESSAGE carries identities of sender and receiver for the MSISDN-less
originating and terminating SMS. The UE, which can handle MSISDN-less
originating and terminating SMS, can retrieve the sender\'s identity from SIP
level instead of the TP-OA/DA.
NOTE: The actual SIP protocol details are left for CT1 to decide.
Figure 5.2.2-1 shows the SMS submit aspect when an MSISDN-less IMS UE sends a
SMS to another MSISDN-less IMS UE via IMS.
Figure 5.2.2-1: MSISDN-less UE to MSISDN-less UE, SMS submit aspect
1) UE-A is IMS registered and IP-SM-GW-A has been included as part of 3rd
party registration. UE-A constructs a MO-SMS and delivers to IP-SM-GW-A based
on existing procedure. Since party B does not have MSISDN, the UE-A fills the
TP-DA field with dummy value (e.g., 000000s). UE-A sets the R-URI to PSI (SMSC
address) and the To header with B\'s SIP URI in the MESSAGE. Based on the
existing procedure, P-CSCF fills the A\'s default URI to p-asserted-identity
before sending the MESSAGE to S-CSCF and S-CSCF executes the iFC and forwards
the MESSAGE to IP-SM-GW-A.
2\. IP-SM-GW-A retrieves the B\'s SIP URI from the To Header. It queries the
HSS-B for B\'s IMSI and SMS routing info (similarly with \"Subscriber Info
Request\" message defined in TS 23.682 [8] for machine type triggering message
between HSS and MTC-IWF).
3\. HSS return\'s B\'s IMSI and current serving nodes for SMS delivery to
Party B.
4a. In step 3, HSS returns IP-SM-GW-B as one of the possibly delivery node.
Based on local policy, IP-SM-GW-A may try to deliver this SMS directly to B
without going to SMSC-A first.
It constructs a SIP MESSAGE with {p-asserted-identity: A\'s SIP-URI, To: B\'s
SIP-URI, R-URI=IP-SM-GW-B, SMS Deliver {TP-OA=dummy, RP-OA=IP-SM-GW-A, RP-
DA=B\'s IMSI, sms payload). Note the use of B\'s IMSI for SMS delivery is the
same as MSISDN-less T4 as currently being documented in TS 23.682 [8].
4b. IP-SM-GW-B adds its own URI to topmost p-asserted-identity, to ensure the
UE-B sends the delivery report to IP-SM-GW-B. IP-SM-GW-B delivers the SIP
MESSAGE to UE-B by using the B\'s SIP URI it received in the To header field.
UE-B stores and removes the topmost URI in p-asserted-identity, and uses it as
an R-URI for delivery report. The remaining URIs in the p-asserted-identity
contain the A\'s SIP URI.
4c-d. Successful or failure notice back to IP-SM-GW-A. UE-B may be temporary
out of coverage or memory full so the delivery in this scenario may fail. If
failed, the IP-SW-GW-A will submit this SMS to SMSC-A for store and forwarding
with step 4d.
5-6. IP-SM-GW-A submits the SMS to SMSC-A with the procedure similar to TS
23.204 [4], clause 6.3, step 6. It may reuse the similar message as defined
for Submit Trigger in TS 23.682 [8] between SMSC and MTC-IWF (T4 reference
point) with the new addition that the A\'s SIP URI is included. Alternatively,
A\'s IMSI is included instead of A\'s SIP URI to avoid additional parameter to
that interface.
Figure 5.2.2-2 shows the segment on how the SMSC-A forwards the SMS to
receiver\'s MSISDN-less IMS UE.
Figure 5.2.2-2. SMS deliver without MSISDN
1\. This is the submit part shown in figure 5.2.2-1, step 4d, 5, or 6.
2\. SMSC-A selects the IP-SM-GW-B for delivery and sends the SMS with
forwardshortMsg to IP-SM-GW-B. This message includes A\'s SIP URI or IMSI. The
TP-OA field sets to some dummy value (e.g., 000s).
3\. IP-SM-GW-B is aware that A\'s party does not have MSISDN because of the
dummy value in TP-OA or the inclusion of A\'s SIP URI. If only IMSI is
received, IP-SM-GW-B queries the HSS-A for A\'s SIP URI via Sh.
4\. IP-SM-GW-B delivers the SIP MESSAGE to UE-B as in step 4b in the previous
flow, except the IP-SM-GW-B uses the SIP URI instead of IMSI received from
step 2.
Editor\'s note: Interworking with traditional IMS UE is FFS.
#### 5.2.2.2 Affect / necessary changes in existing functionality
Originating IP-SM-GW will use the Sh to query receiver\'s HSS to determine the
IMSI and delivery nodes address (i.e. T4 approach as in TS 23.682 [8]).
If only A\'s IMSI is sent then Terminating IP-SM-GW will use the Sh to query
sender\'s HSS to determine the A\'s SIP-URI.
IP-SM-GW is made aware the recipient\'s IMS UE can handle this new SIP/SMS
protocol as defined in this proposal.
#### 5.2.2.3 Applicability
Restriction/requirement on UE: New type of UE required.
#### 5.2.2.4 Evaluation
**Pro**
\- Build on top of the T4 MTC-HSS-SMSC approach for delivery.
\- No SMS payload is used for embedding sender\'s and receiver\'s addresses.
\- Storing and forwarding with SMSC is supported.
**Con**
\- Required new type of IMS UE.
\- Only valid for intra-PLMN scenario (i.e., both UE-A and -B belong to the
same operator) because Step 2 and 3 in Figure 5.2.2-1 is based on MTC-IWF -
HSS query that is defined in TS 23.682 [8], and it is defined as intra
operator interface.
### 5.2.3 Alternative 3: Direct delivery with SIP level interworking II
#### 5.2.3.1 Procedure
The SIP MESSAGE carries identities of sender and receiver for the MSISDN-less
originating and terminating SMS. The UE, which can handle MSISDN-less
originating and terminating SMS, can retrieve the sender\'s identity from SIP
level instead of the TP-OA/DA.
NOTE: The actual SIP protocol details are left for CT1 to decide.
Figure 5.2.3-1 shows the SMS submit aspect when an MSISDN-less IMS UE sends a
SMS to another MSISDN-less IMS UE via IMS.
Figure 5.2.3.1-1: MSISDN-less UE to MSISDN-less UE, SMS submit aspect
1) UE-A is IMS registered and IP-SM-GW-A has been included as part of 3rd
party registration. UE-A constructs a MO-SMS and delivers to IP-SM-GW-A based
on existing procedure. Since party B does not have MSISDN, the UE-A fills the
TP-DA field with dummy value (e.g., 000000s) and also indicates B\'s SIP URI
in SIP MESSAGE (e.g., UE-A sets the R-URI to PSI (SMSC address) and the To
header with B\'s SIP URI in the MESSAGE). Based on the existing procedure,
P-CSCF fills the A\'s default URI to p-asserted-identity before sending the
MESSAGE to S-CSCF and S-CSCF executes the iFC and forwards the MESSAGE to IP-
SM-GW-A. It is up to stage 3 to define how B\'s SIP URI is to be indicated in
the protocol level.
2a. SIP MESSAGE arrives to IMS network of UE-B. The UE is not IMS registered
and the message is routed to S-CSCF then to an IP-SM-GW-B using the procedure
defined in TS 23.228 [xx] for \"Mobile Terminating call procedures to
unregistered Public User Identity that has services related to unregistered
state\". IP-SM-GW-B aware that the UE-B is unreachable and may try to deliver
the SMS via SGSN or MSC. This can be done by querying the HSS for the current
serving MSC and SGSN address.
3a/4a. IP-SM-GW-B aware that UE is not reachable in IMS and is not trying to
deliver via MSC or SGSN so it sets the message waiting flag and stores the
SMSC-A address and A\'s party identity (SIP-URI) in HSS, and retrieves B\'s
correlation ID (see sub clause 5.2.3.2).
5a. IP-SM-GW-B returns a negative ack to IP-SM-GW-A, and indicates that UE-B
is unreachable along with B\'s correlation ID.
6a. IP-SM-GW-A submits the SMS toward SMSC-A with indication that UE-B is
unreachable along with B\'s correlation ID.
2b/3b. SIP MESSAGE arrives to IMS network of UE-B. The UE is IMS registered so
this message is routed to IP-SM-GW-B that is serving the UE-B. IP-SM-GW-B then
tries to deliver the SMS to UE-B
4b. If message is successful delivered to UE-B then a ack is sent back to IP-
SM-GW-A.
If message is failed to deliver (e.g., UE is out of coverage) then IP-SM-GW-B
follows step 3a to 6a to submit the SMS to SMSC-A for store and forwarding.
Figure 5.2.3-2 shows the segment on how the SMSC-A forwards the SMS to
receiver\'s MSISDN-less IMS UE.
Figure 5.2.3-2: SMS deliver without MSISDN
1\. This is the step 6a of figure 5.2.3-1.
2\. SMSC-A receives a trigger to redeliver and selects the IP-SM-GW for
delivery. The correlation ID points toward the IP-SM-GW at the terminating
network.
3\. IP-SM-GW (terminating) queries the HSS to retrieve the sender and receiver
identities (SIP-URI) corresponding to this correlation ID. The HSS also
returns the current serving IP-SM-GW.
4\. IP-SM-GW (terminating) delivers the SIP MESSAGE to UE-B via serving IP-SM-
GW that is associated with UE-B.
#### 5.2.3.2 The use of \"Correlation ID\"
Operator may be sensitive to send the A or B\'s party IMSI to other PLMN.
Instead of providing the IMSI, terminating party\'s HSS can return a
\"correlation ID\". This \"correlation ID\' is similar to MT Correlation ID
that is being defined in TS 23.040 [2] as MCC+MNC+Sender ID to correlate an
SMS. This correlation ID can map an incoming SMS to both the sender and
receiver\'s identity. This \"correlation ID\" is only associated with the
terminating SMS when there is a message waiting flag active in the
subscription data for the user. This \"correlation ID\" points to an IP-SM-GW
that can handle the forwardSMS operation by SMSC.
NOTE: Correlation ID is the form of SIP-URI is possible, based on the
supporting protocol between the IP-SM-GW and SMSC.
#### 5.2.3.3 Affect / necessary changes in existing functionality
Terminating IP-SM-GW will use the Sh to query receiver\'s HSS to determine the
sender and receiver\'s SIP URI.
Terminating network HSS needs to generate a correlation ID for mapping to
sender/receiver\'s identity for the terminating SMS.
#### 5.2.3.4 Applicability
Restriction/requirement on UE: New type of UE required.
#### 5.2.3.5 Evaluation
**Pro**
\- IMSI is not sent across PLMN.
\- No SMS payload is used for embedding sender\'s and receiver\'s addresses.
\- Storing and forwarding with SMSC is supported.
**Con**
\- Required new type of IMS UE.
## 5.3 Communication via SMS between MSISDN-less IMS UE and Traditional UE
### 5.3.1 MSISDN-less IMS UE to Traditional UE
#### 5.3.1.1 Alternative 1: Direct delivery with IP-SM-GW interworking
##### 5.3.1.1.1 Procedure
Figure 5.3.1.1-1 shows a solution which the MSISDN-less IMS UE sends a SIP
MESSAGE to Traditional UE via IP-SM-GW. In this solution, The IP-SM-GW shall
recognize the message is from MSISDN-less IMS UE. The IP-SM-GW includes a
special code in \"RP-OA\" to indicate the SM is originated by the MSISDN-less
UE and MSISDN-less UE\'s SIP URI in the \"TP-UD\", and then forward the SM to
the SMS-SC. Then the SMS-SC sends the SM to the traditional UE.
Figure 5.3.1.1-1: MSISDN-less UE Submit SMS to Traditional UE
1) MSISDN-less IMS UE originates an SIP MESSAGE to Traditional UE via IP-SM-GW
according to TS 23.341.
a) The SIP MESSAGE request includes a vnd.3gpp.sms payload that includes the
short message and routing information for the IP-SM-GW to forward the short
message.
b) SIP Request URI and To headers should be the PSI of the SC of the SM-over-
IP sender.
c) From header should be UE SIP URI.
d) MSISDN-less IMS UE address is embedded in use data body.
NOTE 1: The MSISDN-less IMS UE SIP URI is embedded in the user data body. This
can be done by UE or IP-SM-GW.
2) S-CSCF invokes iFC.
3) S-CSCF forwards SIP MESSAGE to IP-SM-GW.
4) IP-SM-GW returns 202 accepted.
5) IP-SM-GW recognizes this message from MSISDN-less IMS UE, and executes the
special handling, which includes:
a) the RP-OA contains the special code of IP-SM-GW, which indicates the SM
originated by a MSISDN-less UE.
b) the TP-UD contains the SIP URI of the MSISDN-less UE
c) the TP-UDHI is set to 1, which indicates there are headers in the message
body.
Then, IP-SM-GW forwards the SM to SC.
6) SMS-SC sends SUBMIT-REPORT to IP-SM-GW
7) IP-SM-GW generates a special SIP MESSAGE according to the special code in
the RP-DA, which includes:
a) Request-URI and To header uses the SIP URI in the TP-UD.
b) From and P-Asserted-Identity uses the identity of the IP-SM-GW.
c) the body of the request shall contain the RP-ACK or RP-ERROR message for
the SM submit report.
8) S-CSCF forwards the SIP MESSAGE to the MSISDN less UE.
9) The MSISDN less UE returns 200 OK to S-CSCF.
10) S-CSCF returns 200 OK to IP-SM-GW.
11) SMS-SC sends STATUS-REPORT to IP-SM-GW.
12) IP-SM-GW generates a special SIP MESSAGE according to the special code in
the RP-DA, which includes:
a) Request-URI and To header uses the SIP URI in the TP-UD.
b) From and P-Asserted-Identity uses the identity of the IP-SM-GW.
c) the body of the request which shall contain an RP-DATA message as defined
in TS 24.011 [6], including the SMS headers and the SMS user information
encoded as specified in TS 23.040 [2].
NOTE 2: If needed, IP-SM-GW can use the SIP URI of the MSISDN-less UE in the
TP-UD and the TP-Message-Reference (TP-MR) to correlate the STATUS-REPORT
message in step 11 with the SUBMIT message in step 3.
13) S-CSCF forwards the SIP MESSAGE to the MSISDN less UE.
14) The MSISDN less UE returns 200 OK to S-CSCF.
15) S-CSCF returns 200 OK to IP-SM-GW.
16) MSISDN-less IMS UE generates an SIP MESSAGE to Traditional UE via IP-SM-GW
according to TS 23.341, which includes:
a) create a delivery report for the status report. The content of the delivery
report is defined in TS 24.011 [6].
17) S-CSCF executes iFCs and forwards the SIP MESSAGE to the IP-SM-GW.
18) IP-SM-GW returns 202 Accepted response to S-CSCF.
19) S-CSCF returns 202 Accepted response to MSISDN-less IMS UE.
20) IP-SM-GW executes the similar handling with step 5) and sends a proper
delivery report to SC response.
The procedure between SMS-SC and traditional UE applies the procedure
specified in TS 23.040 [2].
##### 5.3.1.1.2 Affect / necessary changes in existing functionality
MSISDN-less UE will embed MSISDN-less UE address in SM use data body of RP-
DATA.
IP-SM-GW will embed MSISDN-less UE address in SM use data body of RP-ACK.
IP-SM-GW is required to know that the SM is originated by the MSISDN-less UE
and obtain embedded UE SIP URI from the SM use data body.
IP-SM-GW shall uses the special code in the \"RP-DA\" header of the MAP
message as an indicator that the SM is sent to an MSISDN-less UE and obtain
embedded UE SIP URI from the SM user data body.
##### 5.3.1.1.3 Applicability
Requirements for SMS addressing / routing: same as existing function.
##### 5.3.1.1.4 Evaluation
**Pro**
\- Minimal impact on MSISDN-less UE.
\- No special requirements for the MSISDN-less UE except one optional feature
to embed the SIP URI in the TP-UD.
**Con**
\- One special code shall be allocated to indicate the type of MSISDN-less IMS
UE.
#### 5.3.1.2 Alternative 2: Delivery with IP-SM-GW interworking to traditional
UE
##### 5.3.1.2.1 Procedure
Figure 5.3.1.2-1 shows a solution, which the MSISDN-less IMS UE sends a SIP
MESSAGE to Traditional UE via IP-SM-GW. In this solution, the IP-SM-GW
recognizes IMS UE is MSISDN-less from the 3^rd^ party registration, as the
Tel-URI for this UE is not received.
When IP-SM-GW receives the MO Short Message from this UE, it examines the TP-
DA field to determine if the terminating party is addressed by MSISDN or
unknown/dummy value. If it is unknown/dummy value, the IP-SM-GW delivers the
Short Message using SIP level procedure as shown in clause 5.2.2 or 5.2.3.
Otherwise, IP-SM-GW fills the RP-OA with a pre-configured number. This number
points the Short Message reply back to an IP-SM-GW\' that can provide
traditional UE to MSISDNless UE interworking as defined in Alternative 1 under
clause 5.3.2.1. IP-SM-GW then forwards the Short Message to SMSC and includes
the A\'s SIP URI from P-Served-User header or P-Asserted-Identity header. SMSC
then inserts this SIP-URI to the payload before delivering the Short Message
to traditional UE.
Figure 5.3.1.2-1: MSISDN-less IMS UE to traditional UE
1\. UE-A sends a SIP MESSAGE to UE-B using B\'s E.164,
2\. IP-SM-GW is aware that UE-A does not have MSISDN from 3rd party
registration. Hence, IP-SM-GW knows to execute special SMS submit procedure to
UE-B. It checks the TP-DA field to determine that party-B is addressed with
B\'s MSISDN. IP-SM-GW then fills in the RP-OA with a IP-SM-GW\' address that
it can interwork the reply Short Message back to UE-A with the alternative
defined in clause 5.3.2.1,
3\. IP-SM-GW submits the Short Message to SMSC-A and includes the A\'s SIP URI
from P-Served-User header or P-Asserted-Identity header.
4\. SMSC inserts A\'s SIP URI to sms payload before deliver the Short Message
to UE-B.
NOTE: After SMSC performed the A\'s SIP URI insertion into the SM payload, the
SMSC may have to segment the payload into multiple Short Messages if the
message size exceeded the payload size. If the incoming Short Message is part
of a larger message (e.g., segmented into multiple parts by the sending
entity), SMSC may need to reassemble all the segmented parts before performing
the A\'s SIP-URI insertion and re-segmenting into multiple Short Messages to
be delivered to the receiver.
5-6. Normal Short Message delivery procedure to UE-B.
##### 5.3.1.2.2 Affect / necessary changes in existing functionality
IP-SM-GW checks the TP-DA to determine the procedure for interworking (deliver
to MSISDNless IMS UE or to legacy UE). IP-SM-GW fills the RP-OA with a IP-SM-
GW\' address that can provide the interworking for SMS reply as in alternative
defined in clause 5.3.2.1,
SMSC embeds the A\'s SIP URI to sms payload before delivery the SMS to UE-B.
It may require the SMSC to consolidate the segmented short messages first,
then performs the insertion, and the re-segment the message back to multiple
short messages.
##### 5.3.1.2.3 Applicability
Requirements for SMS addressing / routing: same as existing function.
##### 5.3.1.2.4 Evaluation
**Pro**
\- solution provides compatibility with solution for sending Short Message
between two MSISDNless UEs.
**Con**
\- Require more complex handling function in the SMSC.
\- Charging may be impacted if it is done \"per Short Message\" usage.
#### 5.3.1.3 Alternative 3: MSISDN-less UE delivery SMS to traditional UE Only
For SMS delivery between MSISDN-less UE and traditional UE, it may be not
needed for the traditional UE to reply the SMS. In this solution, the SMS
sending from the MSISDN-less UE may not insert the SIP URI of the MSISDN-less
UE in the TP-UD field. Alternatively, the originating address field can be
anonymous to avoid traditional UE to reply the SMS. Specific indication may be
carried with the SMS for authorization of anonymous SMS, either in originating
or terminating PLMN.
##### 5.3.1.3.1 Procedure
Figure 5.3.1.3-1: Procedure flows
1\. The UE performs IMS registration as per TS 23.204 [4]. The HSS may
indicate the IP-SM-GW that the UE is MSISDN-less in response to the quarry
message.
2\. The MSISDN-less UE originates SIP message and sends the SIP message to
SMSC via IP-SM-GW. The RP-OA fields left as empty.
3\. The IP-SM-GW checks whether the SIP message is from MSISDN-less UE if such
information is not provided by the HSS. If the SIP message is from the MSISDN-
less UE, the IP-SM-GW performs authorization based on stored subscriber
information and checks whether the MSISDN-less UE is authorized to send SMS to
traditional UE by anonymous. If the result is negative, the IP-SM-GW shall not
forward the SMS and instead return appropriate error cause to MSISND-less UE
in the failure report. Otherwise the IP-SM-GW extracts the Short Message, sets
the RP-OA fields as anonymous value as per TS 29.311 [7], and forwards the SMS
to SMSC.
4\. The IP-SM-GW forwards the anonymous SMS to the SMSC. The IP-SM-GW may send
the SMS with indication that the SMS is from MSISDN-less UE authorized to send
anonymous SMS.
##### 5.3.1.3.2 Affect / necessary changes in existing functionality
The IP-SM-GW is required to recognize the SIP message is from MSISDN-less UE.
The indication may be necessary for anonymity allowance.
##### 5.3.1.3.3 Applicability
Requirements of SMS addressing / routing: same as existing function.
##### 5.3.1.3.4 Evaluation
**Pro**
\- MSISDN-less UE is not necessary to carry the sender information for the
MSISDN-less UE.
**Con**
\- An indication for anonymity allowance may be necessary.
### 5.3.2 Traditional UE to MSISDN-less IMS UE
#### 5.3.2.1 Alternative 1: SMS Delivery through IP-SM-GW
##### 5.3.2.1.1 Procedure
**Short message mobile originated procedure:**
Figure 5.3.2.1-1: SMS MO procedure - Traditional UE to SC
1) Traditional UE performs Access Request to the VLR and possible
authentication procedure as specified in TS 23.040 [2].
2) Traditional UE decides to send a message to the SMS capable MSISDN-less IMS
UE. Traditional UE sends a short message via SMS-SUMBIT to the MSC/SGSN as
specified in TS 23.040 [2], with the following changes:
\- An indication which indicates that the terminating UE is an MSISDN-less IMS
UE is carried in the SMS-SUBMIT, e.g. by setting a specific value to the TP-
Destination-Address or TP‑Protocol‑Identifier field, or to define a new
indication field. This is up to stage 3 to decide;
\- The IMPU of the terminating UE in the form of SIP URI is carried in the TP-
User-Data field (either in the header or in the short message), of the SMS-
SUBMIT;
3)-7) The MSC/SGSN transfer the SMS Message to the SMS-SC via the SMS-IWMSC,
and the SMS-SC sends back delivery report to the UE as specified in TS 23.040
[2].
**Short message mobile terminated procedure:**
Figure 5.3.2.1-2: SMS MT procedure - SC to MSISDN-less IMS UE via IP-SM-GW
1) An MSISDN-less IMS UE performs IMS registration/Re-registration procedure
as specified in TS 23.204 [4].
2) The SMS-SC sends the short message via SMS-DELIVER to the SMS-GMSC as
specified in TS 23.204 [4], with the following changes:
\- An indication which indicates that the terminating UE is an MSISDN-less IMS
UE is carried in the RP-Destination‑Address field (or a newly defined field)
of the RP-MT-DATA which encapsulates the SMS-DELIVER;
\- The IMPU of the terminating UE in the form of SIP URI is carried in the TP-
User-Data field (either header or short message) of the SMS-DELIVER message,
which is copied by the SMS-SC from the TP-User-Data field of the received SMS-
SUMBIT message.
3a)-3c) The routing info interrogation procedure is performed as specified in
TS 23.204 [4], with the following differences:
  * The indication which indicates that the terminating UE is an MSISDN-less IMS UE is included in the routing info request, e.g. in the MSISDN field;
  * **Step 3b is not performed.**
4) The SMS-GMSC forwards the short message to the IP-SM-GW as specified in TS
23.204 [4].
5) The IP-SM-GW, based on the indication which indicates that the terminating
UE is an MSISDN-less IMS UE, retrieves the SIP URI of the terminating UE in
the TP-User-Data, and encapsulates the short message in a SIP Message as
specified in TS 23.204 [4] with the Request URI set to the SIP URI of the
terminating UE.
6)-9) The IP-SM-GW sends the SIP Message which encapsulates the short message
to the UE via the S-SCSF as specified in TS 23.204 [4]. The UE acknowledges
the SIP request.
10)-16) The UE sends the delivery report to the S-CSCF and delivery report
procedures are performed as specified in TS 23.204 [4].
If the SMS delivery to the IMS UE fails in IMS domain, the IP-SM-GW may send
the SIP-URI of the UE to the HLR/HSS to interrogate the routing info for the
SM. The HSS/HLR gets the IMSI of the UE based on the SIP-URI and returns the
MSC/SGSN address to the IP-SM-GW if available. The IP-SM-GW can then try to
deliver the SM to the terminating UE via CS/PS domain.
##### 5.3.2.1.2 Affect / necessary changes in existing functionality
The IP-SM-GW needs to recognize the indication which indicates that the
terminating UE is an MSISDN-less IMS UE, and to retrieve the SIP URI of the
terminating UE. The SMS-SC may need enhancement to support the indication;
however, if the indication is carried in TP-Destination-Address field of SMS-
SUMBIT, then there is no change in SMS-SC\'s function.
The traditional UE may need enhancement to include the indication and the SIP
URI of the terminating UE in the SMS-SUBMIT. If the indication is carried in
TP-Destination-Address field of SMS-SUMBIT (i.e. a specific number is input by
the user as the destination address of the SM) and the SIP URI of the
terminating UE is carried in TP-User-Data short message part, then there is no
change in UE\'s function of SMS delivery; but there may be some impact on
traditional UE\'s other application functions related to SMS addressing for
terminating UE (e.g. address book).
The HSS/HLR will not send the MSC/SGSN address to the IP-SM-GW after receiving
the routing info request from the SMS-GMSC (because there is no MSISDN of the
terminating UE in the request), but may provide the MSC/SGSN address to the
IP-SM-GW when receiving the SIP URI of the UE from the IP-SM-GW for routing
info if the SMS delivery fails in IMS domain.
##### 5.3.2.1.3 Applicability
Requirements for SMS addressing / routing: The SMS path is not changed. The
SIP URI is carried in the SMS message to address the terminating UE, and only
used for SMS routing in IMS domain after the IP-SM-GW retrieves the SIP URI of
the terminating UE.
Roaming: If different values for the indication are used in the HPLMN and
VPLMN, the SMS may fail to be delivered; however, this can be resolved based
on roaming agreement or by choosing a global unique indication.
##### 5.3.2.1.4 Advantages, drawbacks
**Pro**
\- No additional requirement for the MSC/SGSN, SMS-IWMSC and SMS-GMSC.
**Con**
\- Require enhancements in the IP-SM-GW and HSS/HLR. There may be some changes
to the SMS-SC.
\- It reduces the maximum message length that can be sent in a single short
message to include the SIP URI of the MSISDN-less IMS UE in the short message.
\- It may have some impact on user experience.
#### 5.3.2.2 Alternative 2: SMS Delivery through specific Server
##### 5.3.2.2.1 Procedure
The main difference between Alternative 2 and Alternative 1 is that a Server
for the specific service(s) of SMS to MSISDN-less IMS UE is used in place of
the IP-SM-GW and the Server has a MSISDN which is known by the user or the
traditional UE for the specific services. Therefore, the MSISDN of the Server
is carried in the SMS message for the SMS delivery.
**Short message mobile originated procedure:**
Figure 5.3.2.2-1: SMS MO procedure - Traditional UE to SC with Server MSISDN
1) Traditional UE performs Access Request to the VLR and possible
authentication procedure as specified in TS 23.040 [2].
2) Traditional UE decides to send a message to the SMS capable MSISDN-less IMS
UE. Traditional UE sends a short message via SMS-SUMBIT to the MSC/SGSN as
specified in TS 23.040 [2], with the following changes:
\- The MSISDN of the Server is carried in the TP-Destination-Address field of
the SMS-SUBMIT;
\- The IMPU of the terminating UE in the form of SIP URI is carried in the TP-
User-Data field (either in the header or in the short message) of the SMS-
SUBMIT;
3)-7) The MSC/SGSN transfer the SMS Message to the SMS-SC via the SMS-IWMSC,
and the SMS-SC sends back delivery report to the UE as specified in TS 23.040
[2].
**Short message mobile terminated procedure:**
Figure 5.3.2.2-2: SMS MT procedure - SC to MSISDN-less IMS UE with Server
MSISDN
1) An MSISDN-less IMS UE performs IMS registration/Re-registration procedure
as specified in TS 23.204 [4], with the difference that the Server is in place
of the IP-SM-GW.
2) The SMS-SC sends the short message via SMS-DELIVER to the SMS-GMSC as
specified in TS 23.204 [4], with the following changes:
\- The MSISDN of the Server is carried in the RP-Destination‑Address field of
the RP-MT-DATA which encapsulates the SMS-DELIVER;
\- The IMPU of the terminating UE in the form of SIP URI is carried in the TP-
User-Data field (either header or short message) of the SMS-DELIVER message,
which is copied by the SMS-SC from the TP-User-Data field of the received SMS-
SUMBIT message.
3a)-3c) The routing info interrogation procedure is performed as specified in
TS 23.204 [4], with the following differences:
  * HLR/HSS forward the routing info request to the Server based on the MSISDN of the Server;
  * The Server performs the function of the IP-SM-GW in the routing info interrogation procedure, e.g. creating a MT Correlation ID which associates the routing info request with the subsequent Forward Short Message message(s);
  * **Step 3b is not performed;**
4) The SMS-GMSC forwards the short message to the Server based on the MSISDN
of the Server.
5) The Server retrieves the SIP URI of the terminating UE in the TP-User-Data,
and encapsulates the short message in a SIP Message as specified in TS 23.204
[4] with the Request URI set to the SIP URI of the terminating UE.
6)-9) The Server sends the SIP Message which encapsulates the short message to
the UE via the S-SCSF as specified in TS 23.204 [4]. The UE acknowledges the
SIP request.
10)-16) The UE sends the delivery report to the S-CSCF and delivery report
procedures are performed as specified in TS 23.204 [4] with the difference
that the Server is in place of the IP-SM-GW.
If the SMS delivery to the IMS UE fails in IMS domain, the Server may send the
SIP-URI of the UE to the HLR/HSS to interrogate the routing info for the SM.
The HSS/HLR gets the IMSI of the UE based on the SIP-URI and returns the
MSC/SGSN address to the Server if available. The Server can then try to
deliver the SM to the terminating UE via CS/PS domain.
##### 5.3.2.2.2 Affect / necessary changes in existing functionality
The traditional UE may need be configured with the MSISDN of the Server for
the specific service(s) of SMS to MSISDN-less IMS UE, and include the MSISDN
of the Server and the SIP URI of the terminating UE in the SMS-SUBMIT;
however, if the MSISDN of the Server is input by the user as the destination
address of the SM and the SIP URI of the terminating UE is carried in TP-User-
Data short message part, then there is no change in UE\'s function.
The HSS/HLR may provide the MSC/SGSN address to the Server when receiving the
SIP URI of the UE from the Server for routing info if the SMS delivery fails
in IMS domain.
##### 5.3.2.2.3 Applicability
Requirements for SMS addressing / routing: The SMS path is not changed except
the SMS being sent to the Server instead of the IP-SM-GW. The SIP URI is
carried in the SMS message to address the terminating UE, and only used for
SMS routing in IMS domain after the Server retrieves the SIP URI of the
terminating UE.
##### 5.3.2.2.4 Advantages, drawbacks
**Pro**
\- No additional requirement for the MSC/SGSN, SMS-IWMSC, SMS-GMSC, IP-SM-GW
and SMS-SC.
**Con**
\- Need the Server for the specific service(s) of SMS to MSISDN-less IMS UE.
However the function can be incorporated into the existing Server(s) for
specific service(s) where the SMS is delivered to MSISDN-less UE.
\- The HSS/HLR needs to communicate with the Server during registration and
routing info request procedures; however, it can be done in almost the same
way as the HSS/HLR does with the IP-SM-GW/AS.
\- It reduces the maximum message length that can be sent in a single short
message to include the SIP URI of the MSISDN-less IMS UE in the short message.
\- It may have some impact on user experience.
#### 5.3.2.3 Alternative 3: SMS Delivery through enhanced MSC/SGSN
##### 5.3.2.3.1 Procedure
Figure 5.3.2.3-1: SMS from Traditional UE to MSISDN-less IMS UE via enhanced
MSC/SGSN
Steps 1-2 are identical to Figure 5.3.2.1.1-1 Steps 1-2.
3) The MSC/SGSN, based on the indication which indicates that the terminating
UE is an MSISDN-less IMS UE, retrieves the SIP URI of the terminating UE in
the TP-User-Data, and encapsulates the short message in a SIP Message with the
Request URI setting to the SIP URI of the terminating UE.
NOTE: Here the MSC/SGSN is enhanced MSC/SGSN which can perform CS/PS to SIP
interworking (for SMS).
4)-8) The MSC/SGSN sends the SIP Message which encapsulates the short message
to the UE2 via the S-SCSF1 and the S-CSCF2.
9)-11) The UE acknowledges the SIP request.
12) The MSC/SGSN sends the delivery report to the UE1.
##### 5.3.2.3.2 Affect / necessary changes in existing functionality
The MSC/SGSN needs to be enhanced to perform CS/PS to SIP interworking for
SMS.
The traditional UE may need enhancement to include the indication and the SIP
URI of the terminating UE in the SMS-SUBMIT. If the indication is carried in
TP-Destination-Address field of SMS-SUMBIT (i.e. a specific number is input by
the user as the destination address of the SM) and the SIP URI of the
terminating UE is carried in TP-User-Data short message part, then there is no
change in UE\'s function of SMS delivery; but there may be some impact on
traditional UE\'s other application functions related to SMS addressing for
terminating UE (e.g. address book).
##### 5.3.2.3.3 Applicability
Requirements for SMS addressing / routing: The SIP URI is used to address the
terminating UE and for SMS routing in IMS domain.
Domain selection and Alter SC procedures are not supported.
##### 5.3.2.3.4 Advantages, drawbacks
**Pro**
\- No additional requirement for the SMS-IWMSC, SMS-GMSC, IP-SM-GW, SMS-SC and
HSS/HLR.
**Con**
\- Domain selection and Alter SC procedures are not supported.
\- Needs enhancement to the MSC/SGSN for supporting CS/PS to SIP interworking
for SMS.
\- It reduces the maximum message length that can be sent in a single short
message to include the SIP URI of the MSISDN-less IMS UE in the short message.
\- It may have some impact on user experience.
# 6 Key Issues
## 6.1 Key Issue1: Storage and redelivery of the SMS for transferring SMS from
Server to MSISDN-less IMS UE
### 6.1.1 Description
Alternatives for transferring SMS from server to MSISDN-less IMS UE are
provided in clause 5.1.1, but as shown in the drawbacks (for alternatives 1
and 2), there is no intermediate storage or redelivery of the SM when the UE
is unreachable or memory unavailable. This needs to be resolved.
### 6.1.2 Solution
#### 6.1.2.1 Alternative 1: Forward the SMS to the SMS-SC
Figure 6.1.2.1-1 shows an alternative for storage and redelivery of the SMS
when transferring SMS from Server to MSISDN-less UE.
Figure 6.1.2.1-1: Storage and redelivery of the SMS: Forward the SMS to SMS-SC
1\. SMS sender decides to send a short message to the MSISDN-less UE in IMS.
The SMS sender which is a server may create an SMSIP request or other SIP
request including the Short message information in the body of the request.
2\. The short message is received by IP-SM-GW/S-CSCF on the terminating side.
The short message fails to reach the UE, e.g. due to the UE not being
reachable in IMS or exceeded memory capacity of the UE, and a failure delivery
report is returned to the IP‑SM‑GW. Or, if the short message is not delivered
via the IP-SM-GW, the S-CSCF encapsulates the short message failing to reach
the UE in the appropriate SIP method and sends to the IP-SM-GW.
3\. The IP-SM-GW sends a Report SM Delivery Status to the HSS. Before sending
report to HSS, the IP-SM-GW creates a MT Correlation ID according to TS 23.040
[2] which is stored along with the corresponding SIP URI which identifies the
terminating UE of the short message. The MT Correlation ID, the address of the
IP-SM-GW and SMS-SC, the IMSI of the terminating UE and the failure reason are
sent along with the Report SM Delivery Status to the HSS. The HSS records the
received information in the corresponding MWD.
NOTE 1: The IP-SM-GW acquires the address of the SMS-SC serving the
terminating UE from the HSS during registration procedure or be provisioned by
configuration, as specified in TS 23.204 [4].
4\. The IP-SM-GW extracts the short message from the SIP request and forwards
the short message to the SMS-SC based on the SMS-SC address via the SMS-IWMSC
using standard MAP signalling. The MT Correlation ID is included in the short
message.
5\. The SMS-IWMSC forwards the short message to the SMS-SC. The SMS-SC stores
the received short message.
NOTE 2: The MT Correlation ID can be recognized by the SMS-SC to save the
received short message without forwarding it.
6-9. The SMS-SC sends a submit report to the IP-SM-GW via the SMS-IWMSC. The
IP-SM-GW forwards the submit report to the IMS Server via the S-CSCF.
10\. At any time after the unsuccessful SM termination procedure, the status
of the UE may indicate that UE is available, due to e.g. registration in IMS
or memory being available.
11\. The HSS checks the user\'s MWD. If the MWD is not NULL, the HSS initiates
an Alert service centre message to the SMS-IWMSC. The Alert service centre
message includes the MT Correlation ID.
12\. The SMS-IWMSC forwards the Alert service centre message to the SMS-SC.
13\. Upon receipt of the Alert service centre message, the SMS-SC re-sends the
stored short message associated with the MT Correlation ID to the IP-SM-GW via
the SMS-GMSC. The Short message includes the MT Correlation ID.
14\. The SMS-GMSC interrogates the HSS to retrieve routing information (i.e.
the address of the IP-SM-GW) based on the MT Correlation ID.
15\. The HSS returns the address of the IP-SM-GW related to the MT Correlation
ID.
16\. The SMS-GMSC delivers the short message to the IP-SM-GW including the MT
Correlation ID.
17\. Upon receipt of the short message from the SMS-SC, the IP-SM-GW performs
appropriate interworking to generate a new SIP message (e.g. SMSIP request)
including the received short message in the body of the request to re-attempt
to send the Short message. The IP-SM-GW uses the SIP URIs related to the MT
Correlation ID to generate the SIP message. The termination procedure in IMS
is performed.
#### 6.1.2.2 Alternative 2: Save the SMS in IP-SM-GW
Figure 6.1.2.2-1 shows another alternative for storage and redelivery of the
SMS when transferring the SMS from Server to MSISDN-less UE.
Figure 6.1.2.2-1: Storage and redelivery of the SMS: Save the SMS in IP-SM-GW
1\. SMS sender decides to send a Short message to the MSISDN-less IMS UE. The
SMS sender which is a server may create an SMSIP request or other SIP request
including the Short message information in the body of the request.
2\. The short message is received by IP-SM-GW/S-CSCF on the terminating side.
The short message fails to reach the UE, e.g. due to the UE not being
reachable in IMS or exceeded memory capacity of the UE, and a failure delivery
report is returned to the IP‑SM‑GW. Or, if the short message is not delivered
via the IP-SM-GW, the S-CSCF encapsulates the short message failing to reach
the UE in the appropriate SIP method and sends to the IP-SM-GW.
3\. The IP-SM-GW stores the delivery request for the short message.
NOTE 1: The IP-SM-GW will save the SIP request for short message in IMS domain
when short message fails to forward to terminating UE, but need not to save
the request from the SMS-GMSC as specified in TS 23.204 [4].
4\. At any time after the unsuccessful SM termination procedure, the status of
the UE may indicate that UE is available, due to e.g. registration in IMS or
memory being available. The IP-SM-GW is notified of the change of UE status
(i.e. from being unavailable to available) as specified in TS 23.204 [4].
5\. The IP-SM-GW re-attempts to send the stored request for Short message upon
notification of the availability of the UE. The termination procedure in IMS
is performed.
#### 6.1.2.3 Alternative 3: Reuse SMS SC in SIMTC approach
The following figure 6.1.2.3-1 reuses the T4 approach in TS 23.682 [8] with
the adaptation needed for SMSMI work from Server to UE direction.
Figure 6.1.2.3-1 SIMTC with IP-SM-GW adaption
0\. If UE is IMS registered, the IP-SM-GW (AS) is in the loop as part of the
3rd party registration and has context of IMSI and B\'s SIP URI association.
1\. Same procedure as defined in clause A.3.1, steps 1 to 3, related to SMS
generation from Server.
2\. The external ID used for SRI for SM is MSIDN-less UE\'s URI. This message
is sent to HSS.
3\. In addition to the information and criteria defined in the present
document, the IP-SM-GW address is returned in the Routing Information because
UE is also IMS registered. IMSI is returned as defined by the present
document.
4\. The MTC-IWF selects a suitable SMS-SC for SMS submission. IP-SM-GW address
received from HSS along with other possible addresses is sent to this SMS-SC.
The SMS-SC confirms to the MTC Server that the SMS has been stored in the SMS-
SC.
5\. The SMS is delivered to the UE using B\'s IMSI and in this case, it is
forwarded to IP-SM-GW.
NOTE: The SMS-SC does not perform an SRI for SM with the HSS; instead it uses
the visited node address information received in step 4a.
6\. IP-SM-GW uses the SIP URI associated with the B\'s IMSI of the message
received for the target UE to send the Short Message (SMS DELIVER, SC Address)
encapsulated in the appropriate SIP method towards the S-CSCF.
It can be seemed that the following additional requirements are needed for
this study in the Server to UE direction:
1\. External ID is the IMPU (SIP-URI) of the UE in step 4
2\. RI for SM in step 6 from HSS will include IP-SM-GW for performing SMS
router function and to route to UE in IMS when it is IMS registered based on
current procedure. (Routing is based on IMSI returned by HSS).
3\. The SMS SC will perform the storing and forwarding functionality also for
SMSMI.
4\. Optimization to perform direct delivery without going via SMS-SC when both
Server and IMS UE are available is TBD.
### 6.1.3 Evaluation
#### 6.1.3.1 Evaluation for alternative 1
Impacts to existing function of the network entities: The IP-SM-GW transfers
to the SMS-SC the short message which fails to be delivered to the terminating
UE. The SMS-SC needs to be enhanced to store the short message received from
the IP-SM-GW which fails to be delivered to the terminating UE, instead of
immediately delivering it. The HSS/HLR stores additional information (e.g. the
MT Correlation ID and the addresses of the IP-SM-GW) in the MWD. The SMS-GMSC
interrogates the HSS to retrieve routing information (i.e. the address of the
IP-SM-GW) related to the MT Correlation ID.
#### 6.1.3.2 Evaluation for alternative 2
No other impacts on the network entities except that the saving and redelivery
SMS functions are required in IP-SM-GW.
#### 6.1.3.3 Evaluation for alternative 3
Minor enhancement is needed on top of SIMTC work for providing \"storing and
forwarding\" functionality also for this study.
## 6.2 Key Issue 2: Traditional UE replies SMS to MSISDN-less IMS UE
### 6.2.1 Description
Upon receiving a short message from an MSISDN-less IMS UE, it should be
possible for tradition UE to reply a short message based on the information of
the received short message automatically or manually. How the traditional UE
generates the replied short message correctly needs study.
### 6.2.2 Solution
#### 6.2.2.1 Alternative 1: Generated the replied message by User
If tradition UE is operated by a person, who recognizes that the short message
came from an MSISDN-less UE, he can remember SIP URI or extract SIP URI with
the help of UE\'s enhanced function. Then he uses the SIP URI to reply the
short message as depicted in clause 5.3.2.
**Pro**
\- No change or little enhancement to traditional UE.
**Con**
\- Bad user experience.
#### 6.2.2.2 Alternative 2: Generated the replied message by UE
The traditional UE is enhanced to recognize whether the short message comes
from MSISDN-less IMS UE, which is done by special indication or special code.
When replying automatically or manually, the enhanced traditional UE is able
to extract the SIP URI from the received short message user body, and then use
the SIP URI as the destination address to generate the replied short message
as depicted in clause 5.3.2. The extracting behaviour is similar with one that
some traditional UE can extract the E.164 number in the message body.
**Pro**
\- Good user experience.
**Con**
\- Need enhancement to traditional UE. For some traditional UE, it can not be
applied.
#### 6.2.2.3 Alternative 3: Use special reply number
When SMS proxy is in the submit path of a short message from MSISDN-less IMS
UE, SMS proxy can assign a routable E.164 number (reply number) owned by SMS
proxy as the originator address (RP-Originating-Address). When need to reply,
the traditional UE uses this reply number as the destination address and reply
short message to SMS SC. SMS SC delivers the short message to SMS proxy
according to the replied number. SMS proxy is able to restore the SIP URI from
the reply number, and creates a terminating message using the SIP URI. Then
SMS proxy delivers the message to MSISDN-less IMS UE.
NOTE: To restore the SIP URI from the reply number, SMS proxy must establish
the relationship between the reply number and SIP URI. The relationship may be
static or dynamic. The static relationship means to assign a unique E.164
number to the MSISDN-less IMS UE which has the requirement to communicate with
traditional UE. The dynamic relationship is used to save the E.164 number
resource. For example, SMS proxy assigns an unused reply number to an MSISDN-
less IMS UE only when it sends a short message to traditional UE. The
relationship is valid during a special period, and after that the reply number
can be reused.
**Pro**
\- No change to traditional UE.
**Con**
\- SMS proxy assigns the E.164 number for replying short message and
establishes the relationship between SIP URI and reply number.
\- The static relationship requires more E.164 number resource. It can not
work if there is a large number of MSISDN-less UEs.
\- The dynamic relationship takes less E.164 number. But reply message may be
delivered to wrong destination when the number expires and is assigned to
another MSISDN-less UE.
## 6.3 Key Issue 3: MSISDN-less UE\'s SIP URI in SMS payload
### 6.3.1 Description
Many Alternatives in this TR requires the MSISDN-less UE\'s SIP URI to be
carried in the SMS payload. The drawback of such approach is that the payload
size of 160 characters (7 bit/ea) is reduced by length of the SIP-URI plus
possibly some overhead bytes.
For concatenated SMS, the pointers used within the SMS payload will have to be
reconstructed if IP-SM-GW inserts the SIP URI to the SMS payload.
Charging is also impacted if the insertion of SIP URI is requirement
additional SMS to be sent due to exceeding the payload size of 160, when
charges to the user is based per SMS.
### 6.3.2 Solution
#### 6.3.2.1 General
Because there is a requirement not to impact the SMS service defined in TS
23.040 [2], it is not expected a solution with protocol changes would meet
this requirement.
If those alternatives that require MSISDN-less UE\'s SIP URI in SMS payload
are selected, Stage 3 will have to determine how to encode the SIP-URI within
the SMS payload.
#### 6.3.2.2 Alternative 1: Included by IMS UE
When an SMS over IP is initiated to an IMS server or a remote UE, the MSISDN-
less IMS UE includes its own MSISDN-less IMS UE SIP URI in SMS user data body,
as depicted in clauses 5.1.2.1 and 5.2.1. As the IMS UE is not trusted, IP-SM-
GW in path must extract SMS user data (TP-User-Data), then checks the IMS UE
address included by UE by comparing it with the SIP URI carried in P-Served-
User header or P-Asserted- Identity header. If not correct, IP-SM-GW replaces
the IMS UE address in SMS user data body with SIP URI carried in P-Served-User
header or P-Asserted- Identity header. If IP-SM-GW finds that the SIP URI
inserted by user is invalid, it will reject the SMS.
**Pro**
\- UE can select the preferred identity if there are more SIP URIs assigned.
**Con**
\- IP-SM-GW should extract TP-User-Data to check the validity of the SIP URI
included by UE. There is no more advantage over Alternative 2.
#### 6.3.2.3 Alternative 2: Inserted by IP-SM-GW
When an SMS over IP is initiated to an IMS server or a remote UE, the MSISDN-
less IMS UE does not include any IMS UE address in SMS user data body. Upon
receiving such a message, IP-SM-GW in path must insert MSISDN-less IMS UE SIP
URI in SMS user data. The inserted SIP URI is obtained from P-Served-User
header or P-Asserted- Identity header. For single SMS, the insert of SIP-URI
may result in payload size exceeding, so the IP-SM-GW should be able to
reconstruct SMS using concatenated SMS or additional SMS. For concatenated
SMS, the IP-SM-GW has to reconstruct the pointers within the SMS payload.
**Pro**
\- Simple to UE. UE need not include IMS UE SIP URI into SMS user data.
**Con**
\- UE cannot select the preferred identity if there are more SIP URIs
assigned, or uses P- Prefered- Identity to indicate its preference.
> \- IP-SM-GW should be able to reconstruct SMS when the payload size exceeds
> after inserting SIP URI to single SMS or a concatenated SMS is received.
#### 6.3.2.4 Alternative 3: Retrieved by IMS Server
If an SMSIP originated by an MSISDN-less IMS UE is delivered to an IMS Server
directly from S-CSCF, IMS Server can retrieve the originator\'s SIP URI from
P-Served-User header or P-Asserted- Identity header. In this case, it does not
require the IMS UE or IP-SM-GW include IMS UE address in the message.
**Pro**
\- No requirement to UE and IP-SM-GW to include the MSISDN-less IMS UE SIP
URI.
**Con**
\- Only applies the scenario that the message is delivered to IMS server
directly from S-CSCF.
### 6.3.3 Assessment
Table 6.2.3-1 summarizes the requirements to MSISDN-less UE and IP-SM-GW of
Alternative1 vs. Alternative 2
Table 6.2.3-1: Requirements of Alternative1 vs. Alternative 2
+----------------------+----------------------+----------------------+ | Essential nodes and | Alternative 1: | Alternative 2: | | requirements▼ | Included by IMS UE | Inserted by IP-SM-GW | +----------------------+----------------------+----------------------+ | MSISDN-less UE | It selects the | Need not any | | | preferred identity | handling of its own | | | and inserts into | SIP URI. | | | payload. | | +----------------------+----------------------+----------------------+ | IP-SM-GW | It checks the | It selects the | | | validity of SIP URI | default SIP URI and | | | inserted by UE, and | inserts into | | | rejects this SMS if | payload. | | | the SIP URI is | | | | invalid. | It should be able to | | | | reconstruct the SMS | | | | in some cases. | +----------------------+----------------------+----------------------+
# 7 Alternatives Assessment and Conclusions
## 7.1 Assessment of Server - MSISDN-less IMS UE communication via SMS
alternatives
Table 7.1-1 summarizes the criteria / requirements vs. Alternatives for Server
to UE direction.
Table 7.1-1: Criteria / Requirements vs. Alternatives for Server to UE
direction
+----------+----------+----------+----------+----------+----------+ | Alt | Alt 1: | Alt 2: | Alt 3: | Alt 4: | Alt 5: | | ernative | Server | Direct | | SMS | Direct | | ▶ | creates | delivery | Use of | delivery | delivery | | | the | with | IM AS | through | with | | C | SMSIP | IP-SM-GW | | SMS | IP-SM-GW | | riteria▼ | delivery | | | proxy | inte | | | directly | | | | rworking | +----------+----------+----------+----------+----------+----------+ | Store | NO | NO | YES | NO | NO | | and | | | | | | | fo | | | | | | | rwarding | | | | | | | ca | | | | | | | pability | | | | | | +----------+----------+----------+----------+----------+----------+ | SMS | No | Reduced | No | Reduced | Reduced | | payload | impact | by the | impact | by the | by the | | size | | length | | length | length | | | | of the | | of the | of the | | | | target | | target | target | | | | SIP URI | | SIP URI | SIP URI | +----------+----------+----------+----------+----------+----------+ | Roaming | NO | NO | NO | NO | NO | | impacts | | | | | | +----------+----------+----------+----------+----------+----------+ | Compa | + | - | + | - | - | | tibility | | | | | | | with | | | | | | | SIMTC | | | | | | +----------+----------+----------+----------+----------+----------+ | E | | | | | | | ssential | | | | | | | nodes | | | | | | | and | | | | | | | requi | | | | | | | rements▼ | | | | | | +----------+----------+----------+----------+----------+----------+ | Server | - | - | - | - | SIP | | | Assume | Assume | Create | Assume | Request | | | UE is | UE is | the SMS | UE is | to | | | always | always | as | always | IP-SM-GW | | | on or | on or | Instant | on | contains | | | aware | aware | Message | | a | | | the UE | the UE | | - | \"ter | | | regi | regi | | Create | minating | | | stration | stration | | SMS | code\" | | | status | status | | toward | that | | | by 3rd | by 3rd | | SMS | allows | | | party | party | | proxy by | the | | | regi | regi | | setting | IP-SM-GW | | | stration | stration | | TP-DA | to aware | | | and | and | | with | that | | | event | event | | E.164 of | this SMS | | | package | package | | the SMS | is | | | | | | proxy | toward | | | - | - reuse | | | MSI | | | Create | the same | | - | SDN-less | | | the SMS | m | | target | UE. | | | IP | echanism | | SIP URI | | | | request | as in | | is | - | | | directly | Alt | | embedded | \"ter | | | and | ernative | | in the | minating | | | process | 5 for | | SMS | code\" | | | delivery | e | | payload | is put | | | report | mbedding | | | into | | | | SIP URI | | | RP-DA. | | | - Retry | in the | | | | | | if | SMS | | | - | | | delivery | payload | | | target | | | failed | | | | SIP URI | | | | - Retry | | | is | | | | if | | | embedded | | | | delivery | | | in the | | | | failed | | | SMS | | | | | | | payload | | | | | | | | | | | | | | - | | | | | | | process | | | | | | | the | | | | | | | status | | | | | | | report | | | | | | | by | | | | | | | looking | | | | | | | into the | | | | | | | body to | | | | | | | d | | | | | | | etermine | | | | | | | which | | | | | | | target | | | | | | | this is | | | | | | | from. | +----------+----------+----------+----------+----------+----------+ | IP-SM-GW | - | - | - | - | - | | | Perform | Create | Perform | Retrieve | T | | | service | the SMS | service | the | riggered | | | autho | IP | level | target | by the | | | rization | request | inte | SIP URI | \"ter | | | if | based on | rworking | from SMS | minating | | | required | the | from IM | payload | code\", | | | by | incoming | to SMS | and | IP-SM-GW | | | confi | message | ( | create | creates | | | guration | from | existing | SMS IP | the SMS | | | | server | pr | request | IP | | | | with | ocedure) | directly | request | | | | re | | | by | | | | trieving | - | - | re | | | | the | Domain | Delivery | trieving | | | | target | s | report | the | | | | SIP URI | election | to SC is | target | | | | from SMS | (i.e., | either | SIP URI | | | | payload, | retry to | success | from SMS | | | | based on | CS | or | payload. | | | | the | domain) | t | | | | | in | must not | emporary | - | | | | dication | be used. | failure. | \"ter | | | | as | | | minating | | | | proposed | | - Will | code\" | | | | in alt | | not | is | | | | 5. | | report | placed | | | | | | status | into | | | | - | | to HSS | RP-OA. | | | | Domain | | because | | | | | s | | SC alert | - for | | | | election | | m | sending | | | | (i.e. | | echanism | the | | | | retry to | | can not | SMS-STAT | | | | CS | | be used | US-REPOR | | | | domain) | | | to IMS | | | | must not | | | Server, | | | | be used. | | | the | | | | | | | TP-RA is | | | | | | | set to | | | | | | | \"ter | | | | | | | minating | | | | | | | code\" | | | | | | | and | | | | | | | includes | | | | | | | the | | | | | | | target | | | | | | | SIP URI | | | | | | | (i.e. | | | | | | | MSI | | | | | | | SDN-less | | | | | | | UE) in | | | | | | | the user | | | | | | | data | | | | | | | body. | +----------+----------+----------+----------+----------+----------+ | S | N/A | N/A | N/A | The | N/A | | MSC-GMSC | | | | validity | | | | | | | period | | | | | | | for | | | | | | | retry | | | | | | | must be | | | | | | | set to | | | | | | | low | | | | | | | value. | | | | | | | | | | | | | | SMSC | | | | | | | does not | | | | | | | know the | | | | | | | actual | | | | | | | r | | | | | | | ecipient | | | | | | | of the | | | | | | | SMS so | | | | | | | charging | | | | | | | can be | | | | | | | a | | | | | | | ffected. | | +----------+----------+----------+----------+----------+----------+ | IM AS | N/A | N/A | Store IM | N/A | N/A | | | | | if UE is | | | | | | | una | | | | | | | vailable | | | | | | | ( | | | | | | | existing | | | | | | | pr | | | | | | | ocedure) | | | +----------+----------+----------+----------+----------+----------+ | MSI | None | None | None | None | The | | SDN-less | | | | | RP-ACK | | UE | | | | | contains | | | | | | | | | | | | | | - the | | | | | | | \"ter | | | | | | | minating | | | | | | | code\" | | | | | | | in | | | | | | | RP-OA. | | | | | | | | | | | | | | - IMS | | | | | | | server | | | | | | | E.164 in | | | | | | | RP-DA. | | | | | | | | | | | | | | - its | | | | | | | own SIP | | | | | | | URI in | | | | | | | the SM | | | | | | | data | | | | | | | body. | +----------+----------+----------+----------+----------+----------+
Interim conclusions for Release 11 are:
\- Enhance the work to be completed by SIMTC to allow \"storing and forwarding
functionality\" to be reused by SMSMI. This requires an extension with
dependency on SIMTC.
\- For solution without \"storing and forwarding functionality\", adopt Alt-1
and Alt-3 for Rel‑11 as they are implementation only without any needs for
further standardization. This allows maximum compatibility with SIMTC.
\- Other solutions, which reduce the payload side is seem unnecessary
complicated, as SIMTC does not has similar requirements. So they are not
considered for this Server to UE direction.
## 7.2 Assessment of MSISDN-less IMS UE - Server communication via SMS
alternatives
Table 7.2-1 summarizes the criteria / requirements vs. Alternatives for UE to
Server direction.
Table 7.2-1: Criteria / Requirements vs. Alternatives for UE to Server
direction
+----------------+----------------+----------------+----------------+ | Alternative ▶ | Alt 1: Direct | Alt 2: SMS | Alt 3: SMS | | | delivery with | delivery | submit with | | Criteria▼ | IP-SM-GW | through SMS | direct | | | interworking | proxy | delivery from | | | | | originating | | | | | IP-SM-GW | +----------------+----------------+----------------+----------------+ | Store and | NO | YES | NO | | forwarding | | | | | capability | | | | +----------------+----------------+----------------+----------------+ | SMS payload | Reduced by the | Reduced by the | Reduced by the | | size | length of the | length of the | length of the | | | target SIP URI | target SIP URI | target SIP URI | +----------------+----------------+----------------+----------------+ | Roaming | NO | NO (both SMSC | NO | | impacts | | and IP-SM-GW | | | | | are from the | | | | | home PLMN) | | +----------------+----------------+----------------+----------------+ | Essential | | | | | nodes and | | | | | requirements▼ | | | | +----------------+----------------+----------------+----------------+ | Server | When receives | When receives | When receives | | | the SMS, it | the SMS, it | the SMS, it | | | needs to | needs to | needs to | | | extract the | extract the | extract the | | | sender | sender | sender | | | identity from | identity from | identity from | | | SMS payload. | SMS payload. | SMS payload. | | | | | | | | Construct the | | | | | RP-ACK with | | | | | RP-DA=short | | | | | code and | | | | | include sender | | | | | identity -- | | | | | SIP URI into | | | | | payload | | | +----------------+----------------+----------------+----------------+ | IP-SM-GW | SMS status | When sending | It may insert | | | report | to the Server, | UE\'s SIP URI | | | delivery to UE | it acts as SMS | in payload if | | | is based on | proxy for the | it knows that | | | server to | MSISDN less UE | UE has not | | | MSISDN-less UE | by adding its | done so | | | mechanism. | own E.164 as | already. | | | | the originator | | | | | of the SMS in | It sets the | | | | TP-OA. | sender of the | | | | | request | | | | It may insert | (RP-Origin | | | | UE\'s SIP URI | ating-Address) | | | | in payload if | and the | | | | it knows that | originator of | | | | UE has not | the request | | | | done so | (TP-Origin | | | | already. | ating-Address) | | | | | is set to the | | | | | E.164 address | | | | | of the | | | | | IP-SM-GW | +----------------+----------------+----------------+----------------+ | SMSC-GMSC | N/A | It needs to | N/A | | | | look into the | | | | | payload to be | | | | | aware who is | | | | | the actual | | | | | sender. The | | | | | trigger can be | | | | | based on | | | | | sending party | | | | | (i.e. TP-OA is | | | | | E.164 of IP SM | | | | | GW) | | +----------------+----------------+----------------+----------------+ | MSISDN-less UE | Embed its own | None or embed | None or embed | | | SIP URI in the | its own SIP | its own SIP | | | payload | URI in the | URI in the | | | | payload | payload | | | RP-OA: Short | | | | | code | | | +----------------+----------------+----------------+----------------+
Conclusions for Release 12 is:
\- Conclusion for sending SMS from MSISDN-less UE to traditional UE in clause
7.4 applies also for sending SMS from MSISDN-less UE to Server. The network
does not differentiate the end point is a server or a traditional UE.
## 7.3 Assessment of SMS between MSISDN-less IMS UEs
The following table 7.3-1 summarize the key points and also suggested
evaluation criteria for the alternatives in clause 5.2.
Table 7.3-1: Criteria vs. Alternatives for SMS between MSISDN-less IMS UEs
+----------------+----------------+----------------+----------------+ | Alternative ▶ | Alternative 1: | Alternative 2: | Alternative 3: | | | Direct | Direct | Direct | | Criteria▼ | delivery with | delivery with | delivery with | | | IP-SM-GW | SIP level | SIP level | | | interworking | interworking I | interworking | | | | | II | +----------------+----------------+----------------+----------------+ | Store and | Not shown | YES | YES | | forwarding | | | | | capability | | | | +----------------+----------------+----------------+----------------+ | SMS payload | Reduced by the | No impact | No impact | | size | length of both | | | | | the sender and | | | | | target SIP | | | | | URIs | | | +----------------+----------------+----------------+----------------+ | Roaming | ? | NO | YES | | support | | | | +----------------+----------------+----------------+----------------+ | Essential | | | | | nodes and | | | | | requirements▼ | | | | +----------------+----------------+----------------+----------------+ | IP-SM-GW of | Detects the | Detects TP-DA | Detects TP-DA | | the sending | special short | field is | field is | | party | codes | \"null or | \"null or | | | RP-DA/TP-DA in | dummy field\" | dummy field\" | | | order to parse | and queries | and forward | | | the | the HSS for | the SIP | | | terminating | routing info | MESSAGE toward | | | SIP URI to | using B\'s SIP | the | | | perform | URI retrieved | terminating | | | directly | from SIP | IMS for | | | delivery. | MESSAGE | handling. When | | | | | delivery | | | | When delivery | failed, it | | | | failed, it | submits the | | | | submits the | SMS to SMSC | | | | SMS to SMSC | for storing | | | | for storing | and | | | | and | forwarding. | | | | forwarding. | | +----------------+----------------+----------------+----------------+ | IP-SM-GW of | Not used? | Forward the | When delivery | | the | | SMS using the | failed, it | | terminating | | B\'s IMSI | queries the | | party | | received from | HSS with the | | | | SMSC. | correlation ID | | | | | and returns | | | | Retrieve B\'s | that back to | | | | IMSI to | the | | | | originating | originating | | | | network if SMS | network. When | | | | can\'t be | receiving a | | | | terminated so | SMS from SMSC | | | | the SMSC can | with | | | | redeliver | correlation | | | | using B\"s | ID, it quires | | | | IMSI. | the HSS for | | | | | routing to | | | | | terminating | | | | | UE. | +----------------+----------------+----------------+----------------+ | UE | Put special | SIP MESSAGE | Same as Alt 2. | | | designated | includes the | | | | short code in | B\'s party SIP | | | | RP-OA and | URI, the TP-DA | | | | RP-DA/TP-DA to | is filled with | | | | indicate both | dummy or null) | | | | sender and | | | | | receiver is | When receiving | | | | MSISDNless. | SMS, the | | | | Put both | sender\'s | | | | sender and | identity is | | | | receiver SIP | retrieved from | | | | URIs in SMS | SIP header | | | | payload. | instead of | | | | | TP-OA. | | +----------------+----------------+----------------+----------------+ | SMSC | Not used | Store and | Same as Alt 2. | | | | forward, and | | | | | support the | | | | | additional | | | | | parameters | | | | | from IP-SM-GW | | | | | for SMS | | | | | deliver | | | | | function. | | +----------------+----------------+----------------+----------------+ | HSS | NO special | No special | Generate | | | requirement | requirement | correlation ID | | | | | to allow SMS | | | | | routing to | | | | | terminating | | | | | UE. | +----------------+----------------+----------------+----------------+
Conclusion:
Alternative 2 does not support roaming because the IMSI is returned back to
the originating network. It can be considered when both UEs belong to the same
PLMN.
Alternative 3 further enhances alternative 2 with correlation ID from the
terminating network to hide the IMSI from originating network.
Alternative 1 does not support store and forwarding and how roaming and
terminating network is supporting this requirement is not clear. Furthermore,
it requires both sender/receiver identities to be placed in sms payload, which
can take up the effective use of payload space for the actual message by the
sender. Therefore, it is recommended not to consider this alternative further.
It is recommended that Alt 3 is used as basis for potential normative work as
it can support both roaming and non-roaming scenarios.
## 7.4 Assessment SMS between MSISDN-less UE and Traditional UE
There is existing service today that Traditional UE can already receive SMS
from non-MSISDN source (e.g, email to SMS service). The sender identity in the
form of e.g, xxx\@domain.com is shown either in the sender field of the SM
with alphanumeric coding (allowed in stage 3) or shown in the SMS payload.
There is no de facto way on how the traditional UE can reply to this kind of
email via SMS. This behaviour seems reasonable as the legacy UE can\'t be
modified and the recipient is aware of the sending identity. This type of
email to SMS interworking is implementation specific and not standardized.
Sending SMS from MSISDN-less UE to traditional UE is somewhat analogous as
sending email via SMS to an traditional UE.
**Conclusions for Release 12 is:**
It is proposed that the same approach can be adopted for MO SMS from MSISDN-
less IMS UE to Traditional UE, i.e., it is not subjected to standardization in
Rel-12 and operator can implement that service in its own way.
At some point, when SA1 indicates the user requirements for a traditional UE
to send/reply to an MSISDN-less UE then SA WG2 can study the solution further
to meet those requirements in Rel-12 if time permits.
## 7.5 Conclusion
The following conclusions have been reached for this study:
\- For Server - MSISDN-less IMS UE communication via SMS, the corresponding
normative specification based on clause 7.1 has been specified to TS 23.682
[8] and TS 23.204 [4] in Release 11.
\- The conclusion for MSISDN-less IMS UE - Server communication via SMS is
detailed in clause 7.2.
\- The conclusion for SMS between MSISDN-less IMS UEs is detailed in clause
7.3.
\- The conclusion for SMS between MSISDN-less UE and Traditional UE is
detailed in clause 7.4.
###### ### Annex A: Addressing in SMS
# A.1 General
Figure A.1-1 shows high level SMS architecture and the schematic numbering of
hops in end-to-end SMS routing.
Figure A.1-1: SMS architecture with schematic hops of the \"SM path\"
NOTE: SMS Router as domain selection functionality is in the IP-SM-GW. The IP-
SM-GW in figure A.1-1 represents the transport layer interworking
functionality, which plays the same role for SMS origination/termination in
case of SMS over IP, as the MSC in case of SMS over CS and the SGSN in case of
SMS over PS.
The following table summarizes how the addressing is handled in different hops
of the SMS path.
Table A.1-1: Addressing in the SMS architecture
* * *
SM type MO-SMS MO-SMS MT-SMS MT SMS hop 1. UE  MSC / SGSN / IP-SM-GW 2. MSC /
SGSN / IP-SM-GW  SC 3. SC  MSC / SGSN / IP-SM-GW 4. MSC / SGSN / IP-SM-GW 
UE A party **Not included** (see CP-DATA in TS 24.011 [6], 7.2.1 and the
embedded RP-MO-DATA in TS 24.011 [6], 7.3.1.2 and TS 23.040 [2], 9.3.2.1). A
party\'s **MSISDN** is included by the MSC / SGSN / IP-SM-GW into the RP-
Originating-Address, **mandatory** element within RP-MO-DATA. A party\'s
**MSISDN** is included in TP-Originating-Address (based on originating SMS),
**mandatory** element within SMS-DELIVER type. A party\'s **MSISDN** is
included in TP-Originating-Address (kept there), **mandatory** element within
SMS-DELIVER type. B party B party\'s **MSISDN** is included (input from A
party) in TP-Destination-Address within SMS-SUBMIT type, **mandatory** element
B party\'s **MSISDN** is included (kept there) in TP-Destination-Address
within SMS-SUBMIT type, **mandatory** element B party\'s **IMSI** (included by
GMSC or SMS Router based on HSS/HLR query with MSISDN) is included in RP-
Destination-Address within RP-MT-DATA, **mandatory** element **Not included**.
MSC/SGSN sends the request to the UE after paging with TIMSI (or IMSI). IP-SM-
GW addresses the SIP request using standard mechanism. sent from A party, see
above A party, see above SC of A party Included in RP-Originating-Address,
**mandatory** element within RP-MT-DATA. SC of A party Included in RP-
Originating-Address, **mandatory** element within RP-MT-DATA. sent to SC of A
party (configured in UE can be a logical address), included in RP-Destination-
Address within RP-MO-DATA, mandatory element SC of A party (either kept or
replaced to a physical address), included in RP-Destination-Address within RP-
MO-DATA, mandatory element B party, see above B party, see above
* * *
For information, the relevant parts of TS 23.040 [2] are copied here.
9.3.2.1 RP‑MO‑DATA
Basic elements of the RP‑MO‑DATA type.
* * *
Abbr. Reference P1) Description RP‑OA RP‑Originating‑Address ++‑ Address of
the originating MS. RP‑DA RP‑Destination‑Address ‑++ Address of the
destination SC. RP‑UD RP‑User‑Data +++ Parameter containing the TPDU
* * *
1) Provision on the links SC\MSC, MSC\MSC or MSC\SGSN, and MSC\MS
or SGSN\MS indicated by \"xxx\", where x may be either \"+\" or \"‑\",
dependent on whether the parameter is mandatory or not on the respective link.
9.3.2.2 RP‑MT‑DATA
Basic elements of the RP‑MT‑DATA type.
* * *
Abbr. Reference P1) Description RP‑PRI RP‑Priority‑Request +‑‑ Parameter
indicating whether or not the short message transfer should be stopped if the
originator SC address is already contained in the MWD. RP‑MMS
RP‑More‑Messages‑To‑Send OO‑ Parameter indicating that there are more messages
waiting in the SC RP‑OA RP‑Originating‑Address +++ Address of the originating
SC. RP‑DA RP‑Destination‑Address ++‑ Address of the destination MS. RP‑UD
RP‑User‑Data +++ Parameter containing the TPDU RP-MTI RP-Message Type
Indicator O-- Parameter indicating if the TPDU is a SMS Deliver or a SMS
Status Report 2) RP-SMEA RP-originating SME-Address O-- Address of the
originating SME 2)
* * *
1) Provision on the links SC\MSC, MSC\MSC or MSC\SGSN, and MSC\MS
or SGSN\MS indicated by \"xxx\", where x may be \"+\", \"‑\" or \"O\",
dependent on whether the parameter is mandatory, not present or optional on
the respective link.
9.2.2.1 SMS‑DELIVER type
Basic elements of the SMS‑DELIVER type:
* * *
Abbr. Reference P1) R2) Description TP‑MTI TP‑Message‑Type‑Indicator M 2b
Parameter describing the message type. TP‑MMS TP‑More‑Messages‑to‑Send M b
Parameter indicating whether or not there are more messages to send TP-LP TP-
Loop-Prevention O b Parameter indicating that SMS applications should inhibit
forwarding or automatic message generation that could cause infinite looping.
TP‑RP TP‑Reply‑Path M b Parameter indicating that Reply Path exists. TP‑UDHI
TP‑User‑Data‑Header‑Indicator O b Parameter indicating that the TP‑UD field
contains a Header TP‑SRI TP‑Status‑Report‑Indication O b Parameter indicating
if the SME has requested a status report. TP‑OA TP‑Originating‑Address M 2‑12o
Address of the originating SME. TP‑PID TP‑Protocol‑Identifier M o Parameter
identifying the above layer protocol, if any. TP‑DCS TP‑Data‑Coding‑Scheme M o
Parameter identifying the coding scheme within the TP‑User‑Data. TP‑SCTS
TP‑Service‑Centre‑Time‑Stamp M 7o Parameter identifying time when the SC
received the message. TP‑UDL TP‑User‑Data‑Length M I Parameter indicating the
length of the TP‑User‑Data field to follow. TP‑UD TP‑User‑Data O 3)
* * *
9.2.2.2 SMS‑SUBMIT type
Basic elements of the SMS‑SUBMIT type:
* * *
Abbr. Reference P1) P2) Description TP‑MTI TP‑Message‑Type‑Indicator M 2b
Parameter describing the message type. TP‑RD TP‑Reject‑Duplicates M b
Parameter indicating whether or not the SC shall accept an SMS‑SUBMIT for an
SM still held in the SC which has the same TP‑MR and the same TP‑DA as a
previously submitted SM from the same OA TP‑VPF TP‑Validity‑Period‑Format M 2b
Parameter indicating whether or not the TP‑VP field is present. TP‑RP
TP‑Reply‑Path M b Parameter indicating the request for Reply Path. TP‑UDHI
TP‑User‑Data‑Header‑Indicator O b Parameter indicating that the TP‑UD field
contains a Header. TP‑SRR TP‑Status‑Report‑Request O b Parameter indicating if
the MS is requesting a status report. TP‑MR TP‑Message‑Reference M I Parameter
identifying the SMS‑SUBMIT. TP‑DA TP‑Destination‑Address M 2‑12o Address of
the destination SME. TP‑PID TP‑Protocol‑Identifier M o Parameter identifying
the above layer protocol, if any. TP‑DCS TP‑Data‑Coding‑Scheme M o Parameter
identifying the coding scheme within the TP‑User‑Data. TP‑VP
TP‑Validity‑Period O o/7o Parameter identifying the time from where the
message is no longer valid. TP‑UDL TP‑User‑Data‑Length M I Parameter
indicating the length of the TP‑User‑Data field to follow. TP‑UD TP‑User‑Data
O 3)
* * *
# A.2 Special cases in service level interworking
When service level interworking is in use, the SM will not travel end-to-end
through the whole SMS path, but only either:
A) only the first hop;
This scenario assumes SMSIP, i.e. the SM travels from A party to the IP-SM-GW
of the A party, where it is interworked to Instant Message. Note that in this
case the SUBMIT-REPORT and the optional STATUS-REPORT are generated by the IP-
SM-GW based on IM responses, i.e. travel the last hop only as SMSIP message.
Figure A.2-1: Interworking SM to IM in the originating network
There is no difference in short message addressing for this scenario;
B) only the last hop
This scenario assumes that IP-SM-GW (performing service level interworking) in
the terminating network receives an IM that can be interworked to a short
message. The IP-SM-GW (acting as SMS Router) may forward the created short
message over CS/PS/IP.
Figure A.2-2: Interworking IM to SM in the terminating network
Differences in short message addressing:
1) the originating address will be the IP-SM-GW instead of the SC (cf. table
A.1-1), and
2) the A-party address (TP-OA element) can be an implementation dependent
value, if E.164 number (MSISDN) is not available in the Instant Message;
For information, the relevant part of TS 29.311 [7] is copied here.
6.1.5.3.2 Common Procedures
Both the SM-RP-UI parameter of the MT_FORWARD_SHORT_MESSAGE and the RP-User
Data element of the RP-DATA message in the SMSIP MESSAGE body shall be set to
SMS-DELIVER. And the elements of SMS-DELIVER message shall be set in
accordance with 3GPP TS 23.040 [2], with the following information:
a) TP-MTI element set to 00 (SMS-DELIVER);
b) TP-MMS element set in accordance with 3GPP TS 23.040 [2];
NOTE 1: For example, for concatenated Short Messages, TP-MMS would be set to 0
while there are more messages to send.
c) TP-RP element set to 0 (TP-Reply-Path parameter is not set in this SMS-
DELIVER);
d) TP-UDHI element set in accordance with 3GPP TS 23.040 [2];
e) TP-SRI element shall be set to 1, if the SIP MESSAGE request contains in a
CPIM body a Disposition-Notification header field with the value of
\"positive-delivery\" or \"negative-delivery\" (i.e. the SIP MESSAGE request
sender requests the Instant Message Delivery Notification). Otherwise, the TP-
SRI element shall be set to 0;
f) TP-OA element set based on the value of the P-Asserted-Identity header
field in the Instant Message if the P-Asserted-Identity header field contains
a E.164 address;
NOTE 2: If no E.164 address is present in the P-Asserted-Identity header
field, the value of the TP-OA element will be implementation dependant.
g) TP-PID element set to 00000000 (SME-to-SME protocol);
h) TP-DCS element set in accordance with 3GPP TS 23.040 [2];
i) TP-SCTS element set to time when the IP-SM-GW received the Instant Message;
j) TP-UDL element set in accordance with 3GPP TS 23.040 [2]; and
k) TP-UD element set based on the content of Instant Message body.
If the content of the body in Short Message format is greater than the allowed
message length of a Short Message, then the IP-SM-GW shall send concatenated
Short Messages.
NOTE 3: In case of receiving MT_FORWARD_SHORT_MESSAGE_ACK message with the SM-
RP-UI parameter set to value SMS-DELIVER-REPORT, containing the User error
parameter for one segment of the concatenated Short Message, the default
action of the IP-SM-GW is not to send any remaing segment.
3GPP TS 23.040 [2] specifies that a Short Message supports GSM 7-bit and UCS2
encoded text while an Instant Message may support different text types as
defined in 3GPP TS 26.141 [16]. The IP-SM-GW shall reformat the received
Instant Message text into an appropriate text type supported for Short
Messages.
6.1.5.3.3 Sending of SMS-DELIVER over CS/PS
The parameters of the MT_FORWARD_SHORT_MESSAGE shall be set as described in
3GPP TS 29.002 [7], with the following information:
\- Invoke-ID parameter set in accordance with 3GPP TS 29.002 [7];
\- SM-RP-DA element set to the address associated with the SIP MESSAGE request
receiver;
\- SM-RP-OA element set to the address of the IP-SM-GW;
\- More Messages To Send parameter set in accordance with 3GPP TS 29.002 [7];
and
NOTE: For example, for concatenated Short Messages, More Messages To Send
would be set to 0 while there are more messages to send.
\- SM-RP-UI parameter set to SMS-DELIVER.
6.1.5.3.4 Sending of SMS-DELIVER over IP
The IP-SM-GW shall send the SMSIP MESSAGE as described in 3GPP TS 24.341 [5]
with the following exceptions:
\- the Request-URI mapped from the Request-URI of the associated SIP MESSAGE
request; and
\- the body of the request shall contain an RP-DATA message. The elements of
the RP-DATA message shall be set as described in 3GPP TS 24.011 [9], with the
following information:
a) RP-Message Type element set to 001 (network to MS);
b) RP-Message Reference element set in accordance with 3GPP TS 24.011 [9];
c) RP-Originator Address element set to the address of the IP-SM-GW;
d) RP-Destination Address element shall be set to the MSISDN of the associated
SIP MESSAGE request receiver, retrieved by the IP-SM-GW as part of the
subscriber data from the HSS at registration; and
e) RP-User Data set to SMS-DELIVER.
C) all but the first hop
This scenario assumes that the IP-SM-GW in the originating network receives an
IM that can be interworked to a short message.
Figure A.2-3: Interworking IM to SM in the originating network
Differences in short message addressing:
1) the A-party address (RP-OA element) can be an anonymous value, if the
privacy settings in the Instant Message requires that and operator policy
allows that (no affect on delivering the short message, only B party cannot
reply);
For information, the relevant part of TS 29.311 [7] is copied here.
6.1.6.3 Sending of SMS-SUBMIT over CS/PS
To submit a Short Message to the SC, the IP-SM-GW shall send
MO_FORWARD_SHORT_MESSAGE as described in 3GPP TS 29.002 [7] and 3GPP TS 23.040
[2]. In addition, for the information elements listed below, the following
interworking procedures shall apply:
\- Invoke-ID parameter set in accordance with 3GPP TS 29.002 [7];
\- SM-RP-DA parameter set to the address of user\'s home network Service
Centre configured in the IP-SM-GW, or retrieved as part of the subscriber data
from the HSS at registration by the IP-SM-GW;
\- if the SIP MESSAGE request contains the Privacy header field with
\"header\" or \"user\" or \"id\" and the operator policy allows sending of
anonymous Short Message, the value of SM-RP-OA shall be set to an anonymous
value. If the SIP MESSAGE request does not contain the Privacy header field,
the value of the SM-RP-OA shall be set based on the value of the P-Asserted-
Identity header field or the address retrieved as part of the subscriber data
from the HSS at registration by the IP-SM-GW;
\- SM-RP-UI parameter set to SMS-SUBMIT; and
\- the elements of the SMS-SUBMIT message shall be set as described in 3GPP TS
23.040 [2] subclause 9.2.2, with the following information:
a) TP-MTI element set to 01 (SMS-SUBMIT);
b) TP-RD element set to 1 (Instruct the SC to reject an SMS SUBMIT for an SM
still held in the SC which has the same TP MR and the same TP DA as the
previously submitted SM from the same OA.);
c) if the SIP MESSAGE request contains an Expires header field with a non-zero
value, the value of TP VPF element shall be set according to the TP VP
element. Otherwise, the value of TP VPF element shall be set to 00 (TP VP
field not present);
d) TP VP element set based on the Expires header field value and the optional
Date header field value;
e) TP-UDHI element set in accordance with 3GPP TS 23.040 [2];
f) if the SIP MESSAGE request contains in a CPIM body a Disposition-
Notification header field with the value of \"positive-delivery\" or
\"negative-delivery\" (i.e. the SIP MESSAGE request sender requests the
Instant Message Delivery Notification), the value of TP SRR element shall be
set to 1 (A status report is requested), Otherwise, the value of TP-SRR
element shall be set to 0 (A status report is not requested);
g) TP-MR element set in accordance with 3GPP TS 23.040 [2];
h) TP-RP element set to 0 (TP Reply Path parameter is not set in this SMS
SUBMIT);
i) TP-DA element set based on the value of the Request-URI in the Instant
Message as long as the Request-URI contains a E.164 address;
j) TP-PI element set to 00000000 (SME-to-SME protocol);
k) TP-DCS element set in accordance with 3GPP TS 23.040 [2];
l) TP-UDL element set in accordance with 3GPP TS 23.040 [2]; and
m) TP-UD element set based on the content of Instant Message body.
If the content of the body in Short Message format is greater than the allowed
message length of a Short Message, then the IP-SM-GW shall send concatenated
Short Messages.
NOTE: In case of receiving MO_FORWARD_SHORT_MESSAGE_ACK message with the SM-
RP-UI parameter set to value SMS-SUBMIT-REPORT, containing the User error
parameter for one segment of the concatenated Short Message, the default
action of the IP-SM-GW is not to send any remaing segment.
3GPP TS 23.040 [2] specifies that a Short Message supports GSM 7-bit and UCS2
encoded text while an Instant Message may support different text types as
defined in 3GPP TS 26.141 [16]. The IP-SM-GW shall reformat the received
Instant Message text into an appropriate text type supported for Short
Messages.
D) all but the last hop
This scenario assumes that the IP-SM-GW in the terminating network receives a
short message that can be interworked to an Instant Message. Note that in this
case the DELIVERY-REPORT is generated by the IP-SM-GW based on IM response and
sent to the SC.
Figure A.2-4: Interworking SM to IM in the terminating network
There is no difference in short message addressing for this scenario.
E) only the hops not involving the UE
This scenario assumes that the IP-SM-GW in the originating network receives an
IM that can be interworked to a short message, and the IP-SM-GW in the
terminating network interworks the respective short message back to Instant
Message. This can be considered as the combination of scenario C and D, just
listed here for completeness, the combination does not introduce any new
requirement for the addressing in the SMS part of the message path.
Figure A.2-5: Double interworking: IM to SM followed by SM to IM
F) only the hops involving the UE
This scenario assumes that the IP-SM-GW in the originating network receives an
SM over IP that can be interworked to an Instant Message, and the IP-SM-GW in
the terminating network interworks the respective IM back to short message.
This can be considered as the combination of scenario A and B, just listed
here for completeness, the combination does not introduce any new requirement
for the addressing in the SMS parts of the message path.
Figure A.2-6: Double interworking: SM to IM followed by IM to SM
#
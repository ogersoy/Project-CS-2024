# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document is limited to the Stage 2 study and evaluation of
possible 3GPP technical system solutions for architectural enhancements needed
to support Proximity-based Services (ProSe) based on the relevant Stage 1
requirements as defined in TS 22.278 [3] and TS 22.115 [4].
NOTE: Some aspects in this feasibility study have led into normative
specification in TS 23.303 [26].The text of the present document was not
updated to align with normative specifications.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 41.101: \"Technical Specifications and Technical Reports for a
GERAN-based 3GPP system\".
[3] 3GPP TS 22.278: \"Service requirements for the Evolved Packet System
(EPS)\".
[4] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[5] 3GPP TR 23.768: \"Study on Architecture Enhancements to Support Group
Communication System Enablers for LTE\".
[6] 3GPP TS 33.222: \" Generic Authentication Architecture (GAA); Access to
network application functions using Hypertext Transfer Protocol over Transport
Layer Security (HTTPS)\".
[7] 3GPP TS 33.220: \" Generic Authentication Architecture (GAA); Generic
Bootstrapping Architecture (GBA)\".
[8] 3GPP TS 22.468: \"Group Communication System Enablers for LTE
(GCSE_LTE)\".
[9] 3GPP TS 23.271: \" Functional stage 2 description of Location Services
(LCS)\".
[10] 3GPP TS 29.061: \"Interworking between the Public Land Mobile Network
(PLMN) supporting packet based services and Packet Data Networks (PDN)\".
[11] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[12] IETF RFC 4862: \" IPv6 Stateless Address Autoconfiguration\".
[13] Open Mobile Alliance: \"OMA PoC System Description\" v2.1.
[14] IETF RFC 4582 (November 2006): \"The Binary Floor Control Protocol
(BFCP)\".
[15] IETF RFC 3864: \"Presence Information Data Format (PIDF)\".
[16] 3GPP TS 23.141: \"Presence service; Architecture and functional
description\".
[17] 3GPP TS 23.228: \"IP Multimedia System (IMS); Stage 2\".
[18] IETF RFC 3986: \"Uniform Resource Identifier (URI): Generic Syntax\".
[19] IETF RFC 6121: \"Extensible Messaging and Presence Protocol (XMPP):
Instant Messaging and Presence\".
[20] IETF RFC 3261: \"SIP: Session Initiation Protocol\".
[21] IETF RFC 3265: \"Session Initiation Protocol (SIP) - Specific Event
Notification\".
[22] Wi-Fi Alliance Technical Committee P2P Task Group: \"Wi-Fi Peer-to-Peer
(P2P) Technical Specification\", Version 1.1.
[23] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[24] ETSI TR 102 300-3: \"Terrestrial Trunked Radio (TETRA); Voice plus Data
(V+D); Designers\' guide; Part 3: Direct Mode Operation (DMO)\".
[25] 3GPP TR 22.803: \"Feasibility study for Proximity Services (ProSe)\".
[26] 3GPP TS 23.303: \"Architecture enhancements to support proximity services
(ProSe)\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
NOTE: The identifiers defined below are intended for terminology harmonisation
to achieve common understanding. There is no expectation that all solutions
need to support all of these identifiers.
**Source Layer-2 ID** : A link-layer identity that uniquely identifies a
device that originates ProSe communication frames.
**Destination Layer-2 ID** : A link-layer identity that uniquely identifies a
device or a group of devices that are recipients of ProSe communication
frames.
**ProSe direct communication** : A communication between two or more UEs in
proximity that are ProSe-enabled, by means of user plane transmission using
E-UTRA technology via a path not traversing any network node.
**ProSe-enabled UE:** A UE that supports ProSe requirements and associated
procedures. Unless explicitly stated otherwise, a ProSe-enabled UE refers both
to a non-public safety UE and a public safety UE.
**ProSe-enabled Public Safety UE:** A ProSe-enabled UE that also supports
ProSe procedures and capabilities specific to Public Safety.
**ProSe-enabled non-public safety UE** : A UE that supports ProSe procedures
and but not capabilities specific to public safety.
**ProSe direct discovery:** A procedure employed by a ProSe-enabled UE to
discover other ProSe-enabled UEs in its vicinity by using only the
capabilities of the two UEs with Rel-12 E-UTRA technology.
**EPC-level ProSe discovery:** a process by which the EPC determines the
proximity of two ProSe-enabled UEs and informs them of their proximity.
**ProSe UE Identity (also shortened as ProSe UE ID)** : A unique identity
allocated by EPS which identifies the ProSe enabled UE It can be assigned to a
UE at any moment in time for a configurable duration, can be stored at the UE,
but its value cannot be assigned by the user, and is subject to operator
assignment and re-assignment.
**ProSe Application Identity (also shortened as ProSe Application ID)** : An
identity identifying application related information for the ProSe enabled UE.
They can exist more than one ProSe Application Identities per UE.
Editor\'s note: Alignment of the definitions with TS 22.278 [3] needs to be
done.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply.\ An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
ProSe Proximity-based Services.
# 4 Assumptions and architectural requirements
## 4.1 Assumptions
Editor\'s note: This clause will define the underlying assumptions of the
work.
### 4.1.1 Supported E-UTRAN ProSe direct communication scenarios
When the registered PLMN, ProSe direct communication path and coverage status
( in coverage or out of coverage) are considered, there are a number of
different possible scenarios. Table 1 presents different combinations of
direct data paths and in-coverage and out -of-coverage. In the Table 4.1.1-1
and Figure 4.1.1-1, \"in coverage and in PLMN X\" means that the UE is camping
on the cell of the PLMN X and under the control of the PLMN X.
Table 4.1.1-1: Direct ProSe communication scenarios without a Relay
+----------------------+-----+-----+----------------------+-----------+ | | UE1 | UE2 | Serving PLMN/Cell | data path | +----------------------+-----+-----+----------------------+-----------+ | 1A | Out | Out | - | direct | +----------------------+-----+-----+----------------------+-----------+ | 1B | In | Out | - | direct | +----------------------+-----+-----+----------------------+-----------+ | 1C | In | In | same PLMN, Same cell | direct | +----------------------+-----+-----+----------------------+-----------+ | 1D | In | In | same PLMN, Different | direct | | | | | cell | | +----------------------+-----+-----+----------------------+-----------+ | 1E | In | In | different PLMN, | direct | | | | | different cell | | | | | | | | | | | | (both UEs are in | | | | | | both cells\' | | | | | | coverage) | | +----------------------+-----+-----+----------------------+-----------+ | 1F | In | In | different PLMN, | direct | | | | | different cell | | | | | | | | | | | | (one UE is in both | | | | | | cells\' coverage and | | | | | | the other UE is in | | | | | | serving cell\'s | | | | | | coverage) | | +----------------------+-----+-----+----------------------+-----------+ | 1G | In | In | different PLMN, | direct | | | | | different cell | | | | | | | | | | | | (both UE are in its | | | | | | own serving cell\'s | | | | | | coverage) | | +----------------------+-----+-----+----------------------+-----------+ | NOTE: In = in | | | | | | coverage, Out = out | | | | | | of coverage | | | | | +----------------------+-----+-----+----------------------+-----------+
Figure 4.1.1-1: ProSe direct communication scenarios without a relay
Editor\'s note: The ProSe direct communication scenarios in the above Figure 1
and Table 1 may not cover all possible ProSe communication scenarios.
Additional scenarios could be added.
Editor\'s note: The ProSe direct communication scenarios shown in the above
Figure 1 are all applicable in cases of network sharing. It is FFS whether the
scenarios in figures could be enhanced or additional figures should to be
added to further clarify the scenarios in relation to network sharing.
Editor\'s note: It is FFS whether ProSe direct communication scenarios in
Figure 1 and Table 1 should be enhanced or new ProSe communication scenarios
should be added for group communication.
Editor\'s note: It is FFS whether ProSe direct communication scenarios in
Figure 1 and Table 1 should be enhanced or new ProSe communication scenarios
should be added to cover further roaming cases.
### 4.1.2 Supported E-UTRAN ProSe direct communication Modes
Two different modes for ProSe direct communication are supported:
\- Network independent direct communication: This mode of operation for ProSe
direct communication does not require any network assistance to authorize the
connection and communication is performed by using only functionality and
information local to the UE(s). This mode is applicable:
\- only to pre-authorized ProSe-enabled Public Safety UEs;
\- regardless of whether the UEs are served by E-UTRAN or not;
\- to both ProSe direct communication one-to-one and to ProSe direct
communication one-to-many.
\- Network authorized direct communication: This mode of operation for ProSe
direct communication always requires network assistance by the EPC to
authorize the connection. This mode of operation applies:
\- to ProSe direct communication one-to-one;
\- when both UEs are \"served by E-UTRAN\"; and
\- for Public Safety UEs it may apply when only one UE is served by E-UTRAN.
Editor\'s note: Whether Network authorized mode of operation is applicable to
ProSe direct communication one-to-many is FFS.
Editor\'s note: Lawful interception and data retention aspects for the network
independent direct communication are FFS.
Editor\'s note: It is FFS how service continuity is supported between network
independent direct communication and network authorized direct communication
when UEs move from being \"not served by E-UTRAN\" to being \"served by
E-UTRAN\" (and vice versa).
### 4.1.3 UE-Relay variants for UE-to-UE relay or UE-to-Network relay
For a Public safety UE acting as a relay, it can be a UE-to-Network relay or
UE-to-UE relay. The UE-to-Network relay shall be served by E-UTRAN. The
illustration diagram is as shown in Figure 4.1.3-1, where UE-R is UE-relay,
solid line is ProSe E-UTRA communication path between UE1 and UE2 via UE-to-UE
relay, and dash line is ProSe E-UTRA Communication path between E-UTRAN and
UEs out of coverage via UE-to-Network relay.
Figure 4.1.3-1: UE-relay variants
A: For a UE-Relay being served by E-UTRAN, the UE-Relay can be a UE-to-Network
relay to relay ProSe one-to-one or one-to many communications from E-UTRAN to
UEs out of coverage or from a UE out of coverage to E-UTRAN. The network can
control any ProSe E-UTRA Communication that is relayed by a UE-to-Network
relay.
A, B: For a UE-relay whether or not being served by E-UTRAN, the UE-relay can
be a UE-to-UE relay to relay ProSe one-to-one or one-to-many communications
for Public Safety ProSe-enabled UEs that are within its communication range.
### 4.1.4 Direct discovery models
It has been identified that the following models for direct discovery may
exist
**Model A (\"I am here\")**
This model defines two roles for the UEs that are participating in direct
discovery.
\- Announcing UE: The UE announces certain information that could be used from
UEs in proximity that have permission to discover.
\- Monitoring UE: The UE that receives certain information that is interested
in from other UEs in proximity.
In this model the announcing UE broadcasts the discovery messages at pre-
defined discovery intervals and the UEs that are interested in these messages
read them and process them.
It is equivalent to \"I am here\" since the announcing UE would broadcast info
about itself e.g. its ProSe Application Identities or ProSe UE Identities in
the discovery message.
**Model B (\"who is there\"/\"are you there\")**
This model defines two roles for the UEs that are participating in direct
discovery.
\- **Discoverer UE:** The UE transmits a request containing certain
information about what is interested to discover.
\- **Discoveree UE:** The UE that receives the request message can respond
with some information related to the discoverer\'s request
It is equivalent to \" who is there/are you there\" since the discoverer UE
sends info about other UEs that would like to receive responses from, e.g. the
information can be about a ProSe Application Identity corresponding to a group
and the members of the group can respond.
## 4.2 Architectural requirements
Editor\'s note: This clause will define the architectural requirements based
on the normative stage-1 requirements defined in TS 22.278 [3], TS 22.115 [4]
and TS 33.106.
In order to satisfy the normative stage-1 general requirements the system
shall:
\- enable the ProSe discovery of the ProSe-enabled UE by other ProSe-enabled
UEs where the discovery is based on direct signals using E-UTRA or EPC-level
ProSe discovery within the same PLMNs or different PLMNs;
\- enable the operator to control the ProSe discovery feature in its network,
authorize the functionality required for the ProSe discovery functions for
each UE;
\- enable the ProSe communication or ProSe-assisted WLAN Direct communication
and seamless service continuity when switching user traffic between an
infrastructure paths and a ProSe communication path of the ProSe-enabled UEs;
enable HPLMN operator to authorize ProSe-enabled UE to use ProSe communication
separately for the HPLMN and for roaming in VPLMNs;
\- enable an authorized 3rd party ProSe application to interact with 3GPP
network in order to utilise the ProSe services offered by the network;
\- be able to control ProSe communication between ProSe-enabled UEs when the
UEs are served by a same eNB or different eNBs;
\- accommodate the ProSe related security functions related to privacy,
support for regulatory functions including Lawful Interception, and
authentication upon ProSe discovery and ProSe communication; enable the
operator to authorize and authenticate the third party applications before
making use of the ProSe feature;
\- accommodate for charging by the operators (HPLMN or VPLMN) for the
utilization of the ProSe functionality.
The Solution shall support ProSe direct communications without need of ProSe
discovery (as defined in TS 22.278 [3]).
## 4.3 High level architecture
Editor\'s note: This clause is work in progress. The functions and reference
points will be updated according to agreed principles and solutions.
### 4.3.1 Reference architecture model
Figure 4.3.1-1 shows the high level view of the non-roaming architecture.
Figure 4.3.1-1: Non-Roaming Reference Architecture
The following figure 4.3.1-2 shows the high level view of the roaming
architecture.
Figure 4.3.1-2: Roaming Reference Architecture
EPC here represents the E-UTRAN Core Network architecture as represented in TS
23.401 [11]. Interfaces inside the EPC may also be impacted albeit they are
not explicitly shown in this diagram.
### 4.3.2 Reference Points/Interfaces
**Reference points:**
**PC1** : It is the reference point between the ProSe application in the UE
and in the ProSe App Server. It is used to define application level signalling
requirements.
Editor\'s note: It is FFS if this is to be 3GPP specified reference point.
**PC2** : It is the reference point between the ProSe App Server and the ProSe
Function. It is used to define the interaction between ProSe App Server and
ProSe functionality provided by the 3GPP EPS via ProSe Function. One example
may be for application data updates for a ProSe database in the ProSe
Function. Another example may be data for use by ProSe App Server in
interworking between 3GPP functionality and application data, e.g. name
translation.
**PC3** : It is the reference point between the UE and ProSe Function. It is
used to define the interaction between UE and ProSe Function. An example may
be to use for configuration for ProSe discovery and communication.
Editor\'s note: Whether PC3 relies on EPC user plane for transport (i.e. an
\"over IP\" reference point) or whether it relies on EPC control plane for
transport is FFS.
**PC4** : It is the reference point between the EPC and ProSe Function. It is
used to define the interaction between EPC and ProSe Function. Possible use
cases may be when setting up a one-to-one communication path between UEs or
when validating ProSe services (authorization) for session management or
mobility management in real time.
Editor\'s note: Depending on the function needed, PC4 and PC7 may terminate in
different EPC entities and may reuse existing interfaces. This will be further
defined as work progresses.
**PC5** : It is the reference point between UE to UE used for control and user
plane for discovery and communication, for relay and one-to-one communication
( between UEs directly and between UEs over LTE-Uu).
**PC6:** This reference point between ProSe Functions in different PLMNs (when
not roaming) may be used for functions such as ProSe discovery between users
subscribed to different PLMNs. Additional use of this reference point is FFS.
**PC7** : It is the reference point between the ProSe Function in the VPLMN
and the ProSe Function in the HPLMN. It is used for HPLMN control of ProSe
service authorization. Additional use of this reference point is FFS.
**PC8:** This reference point between a roaming UE and the HPLMN ProSe
Function may be used for UE ProSe configuration by the ProSe Function in the
HPLMN. Additional use of this reference point is FFS.
**SGi** : In addition to the relevant functions defined in TS 29.061 [10] via
SGi, it may be used for application data and application level control
information exchange.
NOTE: Applicability of the above interfaces/reference points may be dependent
on solutions developed for ProSe.
### 4.3.3 Entities
Evolved Packet Core (EPC): As defined in TS 23.401 [11], includes entities
such as MME, S-GW, P-GW, PCRF, HSS etc.
Application servers, which are users of the ProSe capability for building the
application functionality, e.g. in the Public Safety cases they can be
specific agencies (PSAP) or in the commercial cases social media. These
applications are defined outside the 3GPP architecture but there may be
reference points towards 3GPP entities. The Application server can communicate
towards an application in the UE.
Applications in the UE use the ProSe capability for building the application
functionality. Example may be for communication between members of Public
Safety groups or for social media application that requests to find buddies in
proximity.
Whether any of these applications are defined within 3GPP or they are outside
the scope of 3GPP defined architecture is FFS.
The ProSe Function in the network (as part of EPS) defined by 3GPP has a
reference point towards the ProSe App Server, towards the EPC and the UE. The
functionality may include but not restricted to e.g.:
\- Interworking via a reference point towards the 3rd party Applications;
\- Authorization and configuration of the UE for discovery and direct
communication are controlled by the HPLMN ProSe Function in non-roaming case
and by the HPLMN or VPLMN ProSe Function in the roaming case;
\- Enable the functionality of the EPC level ProSe discovery;
\- ProSe related new subscriber data and /handling of data storage; also
handling of ProSe identities;
\- Security related functionality;
\- Provide Control towards the EPC for policy related functionality;
\- Provide functionality for charging (via or outside of EPC, e.g. offline
charging).
Additional functions are FFS.
Editor\'s note: ProSe Function may be distributed among existing entities or
in new entities or both.
# 5 Key Issues
Editor\'s note: For each key issue identified, the clause will capture the
\"General description and assumptions\" (clause 1). Different architecture
solutions to address the key issues will be documented in clause 6.
## 5.1 Key Issue #1: ProSe system architecture
### 5.1.1 General description
In SA WG2 the objective is to identify the 3GPP architecture enhancements
needed to support the ProSe feature such that the normative Stage -1
requirements in TS 22.278 [3] are met. In general the ProSe system
architecture should enable the ProSe functionality related to discovery,
communication and service continuity, authorization, security and provide for
charging for ProSe enabled UEs as well as public safety UEs. The ProSe system
architecture shall consider at least the following aspects:
\- the new entities and their required functionality;
\- possible ProSe related new subscriber data and necessity/handling of data
storage;
\- reference points / interfaces in user plane as well as control plane
between the RAN and EPC;
\- role of the application(s) and the interworking mechanisms with EPS;
\- reference points /interfaces to the 3rd party applications layer functions
in the UE and network/EPC;
\- user plane and control plane for ProSe discovery and communication paths;
\- impacts on the UE and/or existing network entities from the architecture
perspective and functional layer AS or NAS;
\- impacts on the performance;
\- how does ProSe System Architecture support WLAN Direct communication?
\- how does ProSe System Architecture support public safety usage?
\- split of responsibilities between RAN and CN entities (to be done in
collaboration with RAN WG(s) and CT WG(s));
ProSe Stage 2 procedures to be further specified under the responsibility of
SA WG2 only.
## 5.2 Key Issue #2: Configuration for ProSe direct discovery
### 5.2.1 General description
ProSe direct discovery can be subject to user and operator settings. In order
for the UE to use ProSe direct discovery, it needs to be configured with
certain parameters.
Depending on the scenarios and architecture assumptions, where ProSe direct
discovery is used it may also be necessary for the HPLMN and the VPLMN to also
configure in the UE the info that are used for ProSe direct discovery in
certain situations e.g. in the case the UE goes out of E-UTRAN coverage.
For configuration for ProSe direct discovery, at least the following issues
need to be clarified as part of this TR:
\- what configuration parameters need to be specified?
\- how is the configuration of operator policy per subscriber to be performed?
Including:
\- by the HPLMN and by the VPLMN;
\- when served by E-UTRAN and when not served by E-UTRAN.
## 5.3 Key Issue #3: Configuration and Capability Handling for ProSe
### 5.3.1 General description
When a ProSe-enabled UE requests ProSe service (e.g. ProSe discovery/ProSe
communication), the network in HPLMN or VPLMN needs to check if the UE and the
application(s) on the UE is authorized to make the request for utilizing the
ProSe service per UE\'s subscription and/or per applications.
According to the general requirements for ProSe specified in TS 22.278 [3],
this key issue shall cover the following aspects:
\- What are the new features required for UE/network entities in EPS for
supporting ProSe discovery, E-UTRA ProSe Communication, ProSe-assisted WLAN
Direct communication and Public Safety?
\- How do the network and the UE exchange the support of ProSe capability?
\- How is the UE with ProSe capability configured with ProSe capability
feature?
\- What is the configuration information (ProSe capability feature) required
for a ProSe-enabled UE to be specified under SA WG2 domain?
\- How does the network authorize the ProSe request from the ProSe-enabled UE?
## 5.4 Key Issue #4: ProSe direct communication one-to-one
### 5.4.1 General description
ProSe direct communication one-to-one needs to consider the following cases:
\- ProSe-enabled UEs are served by E-UTRAN (applicable for both non-public
safety and public safety)
\- one of the ProSe-enabled Public Safety UEs is served by EUTRAN and the
other not (public safety only)
\- both of the ProSe-enabled Public Safety UEs are not served by E-UTRAN
(public safety only).
At least, the following aspects should be clarified:
\- System architecture and mechanisms to allow the setup of a ProSe direct
communication path between UEs including cases when one or both of the UEs are
roaming:
\- Mechanisms to use identifiers from prior ProSe discovery based on direct
signals in the setup of ProSe direct communication one-to-one.
\- IP address allocation for ProSe direct communication, including the cases
where one or both of the UEs are not served by E-UTRAN (public safety
specific).
\- Association to UE\'s PDN connections or EPS bearers (if needed):
\- this includes whether or not QoS applies to the case of ProSe direct
communication and whether multiple PDN connections apply?
\- this includes the case Public Safety ProSe UE is not served by EUTRAN.
\- Mechanisms for the network to be able to control ProSe direct
communication.
\- Mechanisms to establish multiple concurrent ProSe direct communication one-
to-one sessions for ProSe-enabled UE with one or more other ProSe-enabled UEs.
\- Whether the UE in ProSe direct communication considered \"connected\" or
\"idle\" from the network point of view. This will affect procedures like:
intra-RAT handover (switching from ProSe direct communication to communication
over the network in LTE), inter-RAT handover including cases of E-UTRAN to
UTRAN/GERAN or PS to CS handovers such as CSFB or SRVCC.
NOTE: There is no intention to impact existing inter-RAT procedure rather
indicate how ProSe direct communication interacts with existing procedures.
\- Whether revocation of ProSe discovery permission should affect ProSe direct
communication one-to-one.
\- For the case of ProSe direct communications without discovery, the way a
single target is addressed needs to be studied, including:
\- At what layer should addressing take place?
\- At what layer should the data encryption take place?
\- The UE power consumption aspects of the solution should be studied.
In addition to the above, security aspects of ProSe direct communication such
as integrity and confidentiality protection need to be taken into account.
## 5.5 Key Issue #5: Relay for Public Safety ProSe
### 5.5.1 General description
Relays are specific to public safety use cases. The relays can be used for
both ProSe communication one-to-one and one-to-many.
At least the following aspects need to be considered in potential solutions:
\- What is the overall procedure to setup a connection between a Public Safety
ProSe-enabled UE and EUTRAN via a ProSe UE-to-network relay?
\- What is the overall procedure to setup a connection between two Public
Safety ProSe-enabled UEs via a ProSe UE-to-UE relay?
\- What is the procedure for relay selection (both ProSe UE-to-network relay
and ProSe UE-to-UE relay)? There might be multiple relay capable Public Safety
UEs in communication range of a Public Safety UE requiring relaying.
\- What is the procedure for relay re-selection (both ProSe UE-to-network
relay and ProSe UE-to-UE relay)? The mobility of UEs (relays and relayed)
implies that a relay may be in a better communication range than another.
Mobility across relays should be possible.
\- At which layer the ProSe relays should function? Above IP or below, in the
3GPP layers?
\- How should authorization for acting as and using a ProSe relay be defined?
Can any UE act as a ProSe relay or only specific UEs?
\- What are the procedures to determine when a UE should act as a ProSe relay?
\- What are the procedures for EPS to initiate or move a session of a ProSe-
enabled public safety UE that has lost connection to the network to a
communication path via a ProSe-enabled UE acting as a ProSe UE-to-network
relay that is in ProSe communication range and has connectivity to the
network?
\- What are the service continuity aspects for ProSe UE-to-UE relays and UE-
to-Network relays excluding the service continuity aspects within the scope of
ProSe Group Communication?
\- Whether a relay node needs to be discovered before a UE can communicate via
the relay?
## 5.6 Key Issue #6: Authorization for ProSe capability feature
### 5.6.1 General description
In order for the UE to use ProSe, it needs to be authorized to perform ProSe
procedures. In the authorization for ProSe capability feature the following
aspects at least need to be considered in the solutions:
\- System architecture to allow the HPLMN to authorize the ProSe capability
features for a UE when the UE is in the HPLMN or in a VPLMN, in particular:
\- To be able to discover, to be discoverable.
\- To be able to perform ProSe Communication.
\- To be able to discover ProSe-enabled UEs served by the E-UTRAN of other
PLMNs.
\- The maximum range class ProSe discovery is allowed to use.
\- System architecture to allow the serving PLMN to determine the
authorization policy for ProSe capability features to be used for each UE.
\- System architecture to allow the authorization policy to be updated from
the network.
\- System architecture to allow the operator to authorize applications and the
use of discovery information by authorized applications.
\- System architecture to allow the operator to control the proximity criteria
for both ProSe discovery and Communications.
In relation to the authorization of ProSe capability feature using E-UTRA at
least the following issues need to be clarified as part of this TR:
\- How does the network authorize ProSe operations requested by the UEs?
\- How can the network revoke authorization and prevent UEs from using ProSe
capabilities they are not or no longer authorized to be used?
\- Does RAN need to be involved in authorizing ProSe operations requested by
the UEs?
\- What is the granularity of authorization for using ProSe capability
feature? E.g. per PLMN, TA/TA-list, cell etc.?
\- Is the authorization for using ProSe capability feature associated with a
time limit?
\- What is the authorization model for ProSe direct discovery per application
(i.e. how an how an application is authorized to use ProSe discovery services
? How applications can utilize Proximity information?
In addition how can public safety UEs be authorized for use of ProSe
capability feature outside E-UTRAN coverage?
## 5.7 Key Issue #7: ProSe direct discovery (common key issue in and out of
E-UTRAN network coverage)
### 5.7.1 General description
One of the key capabilities of a ProSe-enabled UE is to be able to discover
other ProSe-enabled UEs in its vicinity by using direct UE-to-UE signalling
with E-UTRA technology. Therefore, there is need to specify solutions that
support this capability.
As part of the normative requirements in TS 22.278 [3] there are two types of
discovery: open and restricted. Open applies where there is no explicit
permission that is needed from the UE being discovered, while restricted
discovery only takes place with explicit permission from the UE that is being
discovered.
ProSe direct discovery can happen in coverage and out of coverage. Out of
coverage is only applicable to Public Safety.
For ProSe direct discovery at least the following issues need to be clarified
as part of the present document:
\- what is the procedure of ProSe direct discovery? e.g. discovery using
direct radio signals, etc.
\- how to carry out required signalling between involved entities? e.g.
whether a ProSe-enabled UE announces itself and allows itself to be discovered
by others or a ProSe-enabled UE requests that other ProSe-enabled UEs reply if
in proximity to the requesting ProSe-enabled UE
\- whether it is necessary to optimally manage and trigger the ProSe direct
discovery mechanism from the network e.g. activate it only in specific
geographical location?
## 5.8 Key Issue #8: EPC-level ProSe discovery
### 5.8.1 General description and assumptions
The following assumptions apply:
\- The solutions need to support scenarios where UEs are registered to the
same or different PLMNs, including when roaming;
\- EPC-level ProSe discovery may be used independently or as a prelude to
establishment of direct path (i.e. E-UTRA ProSe Communication path or WLAN
Direct communications path) or infrastructure path between ProSe enabled UEs;
\- EPC-level ProSe discovery solution shall take into consideration the user-
and/or application-related discoverability settings (e.g. UE is discoverable
only by UEs that are explicitly permitted);
\- EPC-level ProSe discovery solutions shall take into consideration the
interactions with other capability settings (e.g. Presence, TS 23.141 [16]);
\- EPC-level ProSe discovery solutions shall take into consideration the
device capabilities.
For this key issue the following needs to be studied at least:
\- whether the solutions support both restricted ProSe discovery and open
ProSe discovery and how;
\- what is the information/criteria needed to determine proximity of two
ProSe-enabled UEs in the network;
\- how the EPC gathers the information for determination of proximity;
\- which information is sent to the UEs from the EPC when they are determined
to be in proximity;
\- how the solutions cope with use cases where the user or the network update
the discoverability settings/ permissions dynamically.
## 5.9 Key Issue #9: EPC Support for WLAN Direct communications
### 5.9.1 General description and assumptions
The solutions need to clarify the following:
\- What is the configuration information required by a ProSe-enabled UE with
WLAN capability for the purpose of establishing ProSe-assisted WLAN Direct
communication?
\- How EPC provides the configuration information to a ProSe-enabled UE with
WLAN capability?
\- How does the network authorize the WLAN Direct communication from the
ProSe-enabled UE with WLAN capability?
## 5.10 Key Issue #10: ProSe Identities
### 5.10.1 General description
It is assumed that there is a unique user application-layer identity per
ProSe-enabled application. In addition, each ProSe enabled application may
have some application specific attributes.
The user may or may not enable ProSe for the application and also may have
ability to control discoverability and discovery via user settings in the
application (therefore effective for each individual application layer
identity) and in the UE (effective for the whole UE, that is for all the
applications identities).
The key aspects need studying are:
\- The definition of a ProSe Identity.
\- The ProSe identities required for
1) ProSe discovery;
2) ProSe Communication:
\- The procedure to allocate a ProSe identity and whether the same method can
be used for:
\- in-coverage scenarios and out-of-coverage scenarios.
\- open and Restricted discovery use cases.
\- The format of the ProSe identity and whether the same format can be used
for:
\- in-coverage and out-of-coverage scenarios.
\- open and Restricted discovery use cases.
\- How ProSe identities are exchanged; 1) between ProSe enabled UEs and 2)
between UE and the EPC network.
\- How ProSe identities are protected in order to comply with the user\'s
identity and privacy protection requirements.
\- Whether a globally or locally unique 3GPP UE identity (device specific or
user and device specific) or an identity identifying the user can be used as a
ProSe identity.
\- For ProSe direct discovery identify the approximate size limitation of an
over-the-air identifier and the usage of such identifier when UE supports
multiple ProSe-enabled applications.
\- How Users can set preferences as to whether ProSe discovery is enabled or
not. For example, providing preferences per applications or device on ProSe
discovery.
## 5.11 Key Issue #11: Service Continuity aspects
### 5.11.1 General description
The following assumptions apply:
\- Service continuity is required for 1:1 communications only For service
continuity scenarios represented in stage-1 requirements, the involvement of
various network nodes and their respective functions need to be defined as
part of stage-2 work;
\- It is desirable that service degradation be minimised for all scenarios;
Service continuity needs to be supported for both IMS and other PS traffic
sessions. For the service continuity key issue, the following aspects at least
need to be clarified:
\- whether solutions should be common for both E-UTRA ProSe Communications and
WLAN Direct communications;
\- whether the network or UE /user, taking into account operator policy,
should decide moving a user traffic session from the infrastructure path to
ProSe communication path, and vice versa;
\- whether solutions support the presence of NAT devices and IPv4 on the
infrastructure path and how.
## 5.12 Key Issue #12: ProSe one-to-many communications
### 5.12.1 General description and assumptions
ProSe one-to-many communications refers to ProSe Group Communication and ProSe
Broadcast Communication. One-to-many communications may also work without
prior discovery.
The following assumptions apply:
\- ProSe one-to-many communications are applicable to both in and out of
network coverage and are specific to Public Safety UEs;
\- The source UE shall be able to transmit data to a group of UEs \"with a
single transmission\";
NOTE: This assumption does not preclude solutions where the single
transmission from the source UE is relayed by another UE before reaching the
recipient UEs. This assumption does not preclude the use of \"multiple
transmissions\" solutions where the source UE uses multiple one-to-one
communications to reach the recipient UEs, in scenarios where this is more
efficient.
\- ProSe Broadcast Communication is used for broadcast of data from a UE to
all public safety UEs that are in range regardless of group membership;
\- Service continuity between infrastructure path and direct path is not
required for ProSe one-to-many communications.
For this key issue the following needs to be considered at least:
\- Addressing in ProSe Group Communications and ProSe Broadcast Communications
and at which layer(s) this takes pace;
\- Power efficiency aspects;
\- Commonalities with MBMS;
\- clarify the notion of \"group\" in ProSe Group Communication, given its
transient nature (e.g. UEs may dynamically go in or out of transmission range
with other \"group\" members);
\- for the \"broadcast/multicast transport method\" that has to be defined for
ProSe, what are the impacts in the 3GPP layers (e.g. NAS, AS)?
\- whether ProSe group communication needs to be IP based and whether IP
multicast can be used?
\- clarify the relationship between the ProSe-layer group used for ProSe Group
Communications with an application layer group (e.g. a specific Public Safety
group) and which group-related details need to be configured in the UE?
\- what are the impacts in the service/application layer? What are the
boundaries of the 3GPP specification?
\- how to prevent non-members from listening to ProSe Group Communication
transmissions?
## 5.13 Key Issue #13: Charging in ProSe
### 5.13.1 General description
As part of the study phase, the involvement of the various network nodes and
functions will be defined in order to fulfil the service requirements for
charging. Given the nature of ProSe, involvement of the UE may be needed for
charging reporting in certain cases. Therefore SA2 needs to consider the
implications and necessary interface enhancements to meet the charging
requirements. At least, the following should be defined:
\- Charging architecture for ProSe:
\- Required functionalities in EPS to collect charging data.
\- Signalling within EPS to collect charging data.
## 5.14 Key Issue #14: Establishment of a ProSe communication path via eNB
### 5.14.1 General description
This key issue addresses the case where ProSe enabled UEs that are in
proximity and are served by E-UTRAN establish the ProSe communication path via
eNB(s).
The ProSe communication path via eNB(s) addresses the following scenarios:
\- ProSe communication between only two ProSe-enabled UEs.
\- ProSe Group Communication or ProSe Broadcast Communication among Public
Safety ProSe-enabled UEs that are under network coverage.
_This key issue will investigate potential enhancements on the system
architecture for enabling the following capabilities_ :
\- Decision to establish a ProSe communication path via the eNB(s);
\- Setup ProSe communication path via eNB(s) including the cases where one or
more UEs are roaming;
\- Support service continuity for a ProSe communication path via eNB(s)
(applicable only for the one-to-one communication scenario).
# 6 Solutions
Editor\'s note: This clause is intended to document architecture solutions.
Each solution should clearly describe which of the key issues it covers and
how.
## 6.1 ProSe discovery
### 6.1.1 Solution D1: LTE based solution for direct discovery
#### 6.1.1.1 Architecture reference model
Figure 6.1.1.1-1: Direct discovery (non-roaming)
Figure 6.1.1.1-2: Direct discovery (roaming)
Basic concept:
\- UE obtains configuration for direct services from Direct Services
Provisioning Function (DPF) in a secure way.
\- Direct Services Provisioning Function (DPF) exists in every PLMN.
\- UE obtains configuration from Direct Services Provisioning Functions (DPFs)
in PLMNs is authorized to perform direct discovery.
New Reference points:
\- **PC3:** Reference point between UE and Home DPF (H-DPF) or between UE and
a DPF in a local PLMN where the UE is authorized by the H-DPF to perform
direct services. It enables PLMN-specific direct services authorization.
\- **PC6:** Reference point between DPF in local PLMN and Home DPF (H-DPF). It
enables the DPF in local PLMN to obtain authorization information for the UE.
\- **PC6a:** Reference point between DPF in local PLMN and Home DPF (H-DPF).
It enables the DPF in local PLMN to obtain authorization information for the
UE. This reference point is used to obtain authorization information for the
UE in \"local PLMNs DPFs\" (if needed) and is not a roaming interface.
\- **PC5:** Reference point used for all the control and user plane
information exchange needed in order to perform direct discovery between two
UEs.
#### 6.1.1.2 High Level Functions
##### 6.1.1.2.1 Authorization and configuration for ProSe direct services
The basic principles of service authorization for direct discovery are as
follows:
\- UE gets authorization from HPLMN for using direct discovery in certain
PLMNs per country as defined in Mobile Country Code (MCC). These PLMNs are
called \"local PLMNs\" and their DPFs \"local DPFs\".
NOTE 1: The UE does not need to be registered in \"local PLMNs\" to get
authorization from local DPFs.
NOTE 2: The UE does not need to be simultaneously connected to multiple DPFs.
\- UE accesses \"local DPFs\" to get PLMN specific Authorisation Information
including the registered PLMN and other \"local PLMNs\" when it is in a
specific MCC.
\- \"Local DPF\" contacts always the DPF in HPLMN to check authorization and
consolidates the authorization information.
\- Final authorization info always comes from \"local DPFs\".
The authorization can be revoked at any point from the \"local DPF\" or \"DPF
in HPLMN\" if the UE is de-authorized to use to use ProSe either from the
\"local PLMN\" or HPLMN.
##### 6.1.1.2.1.1 Configuration information from DPF {#configuration-
information-from-dpf .H6}
The following information can be contained in the configuration info that is
provided by the DPF to the UE:
**Authorisation for direct discovery**
1\. Is the UE allowed to announce in this PLMN (Yes/No)
\- What is allowed to announce?
\- What is the authorized range?
\- This information always comes from registered PLMN.
2\. Is the UE allowed to \"monitor\" in this PLMN? (Yes/No)
\- This information comes from registered PLMN and other local PLMNs.
**Authorisation for applications using direct discovery**
A list of applications that are permitted or not permitted to use direct
discovery can be provisioned in the UE. The configuration format can be based
on application identifiers and similar to DIDA.
Additional settings related to individual application use for ProSe can also
be configured as part of this authorization, if required (such as e.g.
discovery range class for each application).
##### 6.1.1.2.1.2 Signalling flow for UE provisioning from DPF {#signalling-
flow-for-ue-provisioning-from-dpf .H6}
Figure 6.1.1.2.1.2-1: Signalling flow for UE configuration from DPFs
The UE gets the authorization for direct services from the DPFs of the local
PLMNs. The configuration is happening using \"over IP\" mechanisms and only IP
connectivity is required to allow the UE to access this DPF. For example OMA
DM can be used as the protocol to configure the UE.
In this signalling flow the following steps are performed:
Step 0: HPLMN configures UE with PLMN list that support direct discovery.
Step1\~4: UE constructs the DPF FQDNs and contacts the local DPFs to receive
authorization info. Standard GBA/GAA authentication can be used to
authenticate UE in local DPF. The procedure is as defined in TS 33.220 [7]).
When the UE roams, it can employ GBA security as detailed in TS 33.220 [7],
clause 4.5. The shared key derived in this procedure is to be used as a master
key in the TLS tunnel establishment. This step requires HTTP and TLS client on
UE (ME or UICC). Ks_\_NAF is used to secure PC3 interface. The UE
establishes TLS tunnel to a \"local DPF\" as in TS 33.222 [6], clause 5.4. The
UE uses PSK-TLS for mutual authentication. Client-side certificates are not
employed.
Step 5: Local DPF obtains authorization info from HPLMN and merges with own
policy
Step 6: Local DPF provides authorization info to UE that applies to this PLMN.
The UE stores the authorization information obtained from Local DPF in a
secure way. 3GPP SA WG3 should further investigate the exact security aspects
of storing the DPF configuration. If needed at any point the authorization can
be revoked by the Local DPF or DPF in the HPLMN e.g. by sending an OMA DM push
message.
##### 6.1.1.2.2 Resource Configuration
The UE needs to know the resources that are dedicated for direct discovery and
communication in specific PLMN. The resources that are used for direct
discovery and communication can be based on the various deployment scenarios.
The resources that are dedicated or dynamically allocated for direct discovery
can be indicated to the UE by the eNB using a new SIB and the allocation is
semi-static. clause.
Table 6.1.1.2.2-1: Resource configuration for \"in\" and \"out of coverage\"
cases
* * *
                    In network coverage                      Out of network coverage
Registered PLMN Read new SIB of the camped cell N/A in Rel-12 Other PLMNs Read
new SIB in the band of other PLMN N/A in Rel-12
* * *
The resource configuration aspects of the various deployment scenarios and
related specification impacts will further need to be clarified in RAN WGs.
##### 6.1.1.2.3 ProSe direct discovery
ProSe discovery is defined as \"the continuous process that identifies another
UE in proximity using E-UTRAN\". In TR 22.803 [25] there are two types of
discovery: open and restricted. Open is the case where there is no explicit
permission that is needed from the UE being discovered. Whereas alternatively
restricted discovery only takes place with explicit permission from the UE
that is being discovered.
ProSe discovery can be a standalone service enabler that could for example use
information from the discovered UE for certain applications in the UE that are
permitted to use this information e.g. \"find a taxi nearby\", \"find me
police officer X\". Additionally depending on the information obtained ProSe
discovery can be used for subsequent actions e.g. to initiate direct
communication.
There are two roles for the UE in ProSe discovery:
\- Announcing UE: The UE announces certain information that could be used from
UEs in proximity that have permission to discover.
\- Monitoring UE: The UE that receives certain information that is interested
in from other UEs in proximity.
We assume that based on PLMN authorization as described in clause 6.1.1.2.1.1
the UE can act as \"announcing UE\" only in the band designated by the
registered PLMN but act as a \"monitoring\" UE in the resources authorized by
\"local PLMNs\".
Figure 6.1.1.2.3-1: Announcing and monitoring UE roles in different PLMNs
##### 6.1.1.2.3.2 General direct discovery procedure {#general-direct-
discovery-procedure .H6}
The following figure depicts the necessary steps undertaken for direct
discovery and various functional entities involved.
Figure 6.1.1.2.3.2-1: ProSe direct discovery procedure
Procedures for announcing UE:
Step 1: An application requests the allocation of an expression Code from the
ProSe manager in the UE.
Editor\'s note: The list of functions performed by ProSe Manager and which of
them are in the scope of a 3GPP specification is FFS.
Step 2: The expression allocation procedure is performed. This procedure is
only performed the first time an Expression Code is allocated
Step 3: The ProSe Manager in the UE provide an Expression Code to the
application.
Step 4 (optional): The application may share this expression code with the
interested parties using application layer mechanisms.. Only for 3GPP defined
applications e.g. IMS application 3GPP may need to define mechanisms for this
step. This step is not necessary for open discovery.
\'Editor\'s note: The authorization for an application using an expression
code is FFS.
Step 5: In case the UE is authorized to perform discovery, the application via
the ProSe manager initiates the announcing of the expression code by the 3GPP
layers.
Step 6: The UE starts broadcasting the related expression Code. The broadcast
of the expression code can be repeated in a configurable interval.
NOTE: More details for this step to be defined in RAN WGs.
The following procedures for the monitoring UE and they are related to the
procedures in the announcing UE e.g. step 7 below is related to step 4 and
step 8 can happen after step 6:
Step 7: The application sends a request to the ProSe manager of the UE to
monitor for an expression Code.
Step 8: In case the UE is authorized to perform discovery, ProSe manager of
the UE monitors the requested expression Code. It then detects the Code of the
announcing UE.
Step 9: The ProSe Manager of the UE passes the detected expression code to the
application.
\'The above steps will be repeated for all the expressions in the monitoring
and announcing side each UE is authorized and capable to receive and announce
respectively.
###### 6.1.1.2.3.3 Discovery message format and operations
An example protocol format for discovery messages in the context of this
solution can be as follows:
Figure 6.1.1.2.3.3-1: Example direct discovery Message
The Discovery Model field indicates whether the message is for Model A (\"I am
here\"), or Model B (\"who is there\"/\"are you there\").
The Type field indicates whether the ProSe Identity is a ProSe UE Identity,
and whether it is used for Open Discovery or Restricted Discovery.
The Content field indicates:
\- with the Type field set to 1: the ProSe UE Identity or ProSe Group
Identity,
\- with the Type field set to 2: the ProSe Application Identity,
\- with the Type field set to 3: the ProSe Application Identity and ProSe UE
Identity
If the UE or application is configured to support Model B discovery, it can
announce a discovery message, indicating in the \"Discovery model\" field
\"Model B (request)\" and carrying the ProSe UE Identity and/or ProSe
Application Identity of the discoveree UE or Group in the \"Content\" field
either the ProSe UE Identity of the discoveree UE or the ProSe Group Identity
of the group of discoveree UEs or the ProSe Application Identity. When the
Type field is set to 3, the discovery message contains the ProSe Application
Identity in addition to either the ProSe UE Identity or the ProSe Group
Identity. In this case each of the recipient(s) of this message can respond
with a discovery message with \"Discovery model\" field set to \"Model B
(response)\" and contain its ProSe UE Identity and/or the ProSe Application
Identity that was included in the request at the next discovery interval (if
required based on the protocol design).
NOTE: The interval length during which the discoveree repeats the Discovery
Response message can be preconfigured or signalled from the network. The RAN
design needs to support collision resolution for the multiple responses. To
support Types 1, 2 and 3, the RAN design needs to support several message
sizes.
Editor's note: When Model B discovery is used with Type field set to 1 or 2 it
is FFS whether there are any security implications given the discoveree may
not know the identity of the discoverer.
Editor's note: When Model B is used it is FFS which combinations of Types in
the request and the response are allowed/ useful.
Editor's note: It is FFS whether the RAN design for discovery supports several
message sizes.
Alternatively, if the UE or application can support discovery using \"Model A,
the UE can announce a discovery message indicating in the \"Discovery model\"
field \"Model A\" and the ProSe Application Identity of its own.
If the Type field is set to \"2\" then the ProSe Application Identity is
contained in the content of the message.
If the Type field is set to \"3\" then the ProSe Application Identity and
ProSe UE Identity is contained in the content of the message.
The Type in these cases is also used in order to assist the processing of open
or restricted discovery messages by the access stratum.
NOTE: The details of the exact protocol format and details such as the timeout
values of the different messages will be specified by RAN WGs, they are shown
here for information purposes only.
##### 6.1.1.2.4 Operational aspects
###### 6.1.1.2.4.1 Accounting
Collection and reporting of data by the UE that can be used by an entity in
the network that is defined for this purpose can be triggered at any time. The
UE can be configured to periodically report data to this entity that can be
used for accounting purposes via a secure interface if needed. For example
ProSe Application Identities monitored and announced ProSe application
Identities matched etc.
NOTE: The reporting can use over IP protocols or any form of small data
interface that exists (e.g. SMS) or any other possible small data mechanism
that could be defined in Rel-12.
###### \'6.1.1.2.4.2 Lawful Interception
The Lawful Interception requirements and related procedures will be defined by
SA WG3 LI Group.
#### 6.1.1.3 Impact on existing entities and interfaces
UE:
\- The application needs to be modified in order to make use of ProSe
discovery.
\- Procedures for allocation of expressions from the ProSe Manager.
\- Broadcasting expressions on the air interface. More details to be defined
by RAN WGs.
\- Authorisation and provisioning from DPF for using ProSe discovery.
RAN:
\- Method (e.g. new SIB) to signal the resources used for ProSe discovery.
#### 6.1.1.4 Solution evaluation
\'.This solution provides a complete ProSe direct discovery mechanism that can
work either standalone or with other communication solutions. It has addressed
the following key issues outlined in clause 5:
\- Key Issue #1: ProSe System Architecture;
\- Key Issue #2: Configuration for ProSe direct discovery;
\- Key Issue #3: Configuration and Capability Handling for ProSe;
\- Key Issue #6 Authorization for ProSe capability feature;
\- Key Issue #7 ProSe direct discovery;
\- Key Issue #13 Charging in ProSe.
This solution fulfils the architecture requirements in clause 4.2, as it
allows the discovery on direct signalling within the same PLMN or different
PLMN, enables the operator to control the discovery feature in its network per
UE, provides security function related to privacy with restricted discovery,
and allows the operator authorizing the discovery service and collecting data
that can be used for generating charging information.
The security procedures for this solution will be defined by SA WG3.
### 6.1.2 Solution D2: Solution for direct discovery
#### 6.1.2.1 Overview
This solution is based on mapping application identities to ProSe private
expression codes in the network.
#### 6.1.2.2 Signalling Flow
The solution is specified with the aid of figure 6.1.2.2-1 shown below. This
figure shows two UEs running the same ProSe-enabled application and assumes
that the users of those UEs have a \"friend\" relationship on the considered
application. The \"3GPP Layers\" shown in the figure correspond to the
functionality specified by 3GPP that enables mobile applications in the UE to
use ProSe discovery services.
Figure 6.1.2.2-1: Main steps for ProSe direct discovery.
NOTE 1: The ProSe Announcement is assumed to be transmitted on E-UTRA radio in
clear. To improve the identity confidentiality properties of the solution, the
ProSe Announcement may not contain an expression code but rather a value
derived from the expression code that changes from announcement to
announcement. The details for these procedures are FFS.
UE-A and UE-B run a ProSe-enabled application, which discovers and connects
with an associated application server in the network. As an example, this
application could be a social networking application. The application server
could be operated by the 3GPP network operator or by a third-party service
provider. When operated by a third-party provider, a service agreement is
required between the third-party provider and the 3GPP operator in order to
enable communication between the ProSe Server in the 3GPP network and the
application server.
1\. Regular application-layer communication takes place between the mobile
application in UE-A and the application server in the network. This
communication is based on an application programming interface (API) which is
outside the scope of 3GPP. It is important to Note however that this solution
does not require changes to this API.
2\. The ProSe-enabled application in UE-A retrieves a list of application-
layer identifiers, called \"friends\". Typically, such identifiers have the
form of a Network Access Identifier (see RFC 4282), i.e. username\@realm. The
identity of Adam on the considered application is assumed to be
\"adam\@example.com\".
3\. The ProSe-enabled application wants to be notified when one of Adam\'s
friends is in the vicinity of UE-A. For this purpose, it requests from the
3GPP layers to retrieve private expressions codes (i) for the user of UE-A
(with an application-layer identity adam\@example.com) and (ii) for each one
of his friends.
NOTE 2: A \"private expression code\" is essentially an application-specific
identity that hides the real identity of the user and provides identity
confidentiality. A ProSe-enabled application in the UE can retrieve only the
private expression codes for the friends received in step 2.
4\. The 3GPP layers delegate the request to a ProSe server in the 3GPP
network. This server can be located either in HPLMN or in a VPLMN. How this
ProSe server is selected is out of the scope of this solution. Any ProSe
server that supports the considered application can be used. The communication
between the UE and ProSe server can take place either over the IP layer or
below the IP layer. If the application or the UE is not authorized to use
ProSe discovery, then the ProSe server rejects the request.
5\. The ProSe server maps all provided application-layer identities to private
expression codes. For example the application-layer identity
\"adam\@example.com\" is mapped to the private expression code
GTER543\$#2FSJ67DFSF. This mapping is based on parameters retrieved from the
application server in the network (e.g. mapping algorithm, keys, etc.) thus
the derived private expression code can be globally unique. In other words,
any ProSe server requested to derive the private expression of
\"adam\@example.com\" for a specific application, it will derive the same
private expression code. The mapping parameters retrieved from the application
server describe how the mapping should be done. In this step, the ProSe server
and/or the application server in the network authorize also the request to
retrieve expression codes for a certain application and from a certain user.
It is ensured, for example, that a user can retrieves expression codes only
for his friends.
Editor\'s note: Further details about this mapping procedure are FFS.
6\. The derived expression codes for all requested identities are sent to the
3GPP layers, where they are stored for further use. In addition, the 3GPP
layers notify the ProSe-enabled application that expression codes for the
requested identities and application have been successfully retrieved.
However, the retrieved expression codes are not sent to the ProSe-enabled
application.
7\. The ProSe-enabled application requests from the 3GPP layers to start
discovery, i.e. attempt to discover when one of the provided \"friends\" is in
the vicinity of UE-A and, thus, direct communication is feasible. As a
response, UE-A announces the expression code of \"adam\@example.com\" for the
considered application (see NOTE 1 above). The mapping of this expression code
to the corresponding application-layer identify can only be performed by the
friends of Adam, who have also received the expression codes for the
considered application.
8\. UE-B also runs the same ProSe-enabled application and has executed steps
3-6 to retrieve the expression codes for friends. In addition, the 3GPP layers
in UE-B carry out ProSe discovery after being requested by the ProSe-enabled
application.
9\. When UE-B receives the ProSe Announcement from UE-A, it determines that
the announced expression code is known and maps to a certain application and
to identity \"adam\@example.com\". The UE-B can determine the application and
the application identity that corresponds to the received expression code
because it has also received the expression code for adam\@example.com (Adam
is included in the friend list of UE-B).
The steps 1-6 in the above procedure can only be executed when the UE is
inside the network coverage. However, these steps are not required frequently.
They are only required when the UE wants to update or modify the friends that
should be discovered with ProSe direct discovery. After receiving the
requested expression codes from the network, the ProSe discovery (steps 7 and
9) can be conducted either inside or outside the network coverage.
It is noted that an expression code maps to a certain application and to a
certain application identity. Thus when a user runs the same ProSe-enabled
application on multiple UEs, each UE announces the same expression code.
#### 6.1.2.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.1.2.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.1.3 Solution D3: Targeted ProSe discovery
The present solution is a \"who is there?\" type of solution where a user (the
\"discoverer\") searches to discover a specific target population (the
\"discoverees\").
Editor\'s note: it is FFS whether Targeted ProSe Discovery is applicable to a
group of non-public safety UEs
#### 6.1.3.1 Targeted ProSe Discovery for Public Safety ProSe-enabled UEs
##### 6.1.3.1.1 Functional description
###### 6.1.3.1.1.1 General
The present solution assumes that a Public Safety group (corresponding to a
\"GCSE group\" in the sense of the definitions in TS 22.468 [8]) is uniquely
identified at the application layer with an application layer identifier
referred to as _App Group ID_ (e.g. a _SIP URI_ in the following format:
sip:fire.brigade75@first.net).
Similarly, it is assumed that a specific member of a Public Safety group is
uniquely identified at the application layer with an application layer
identifier referred to as _App Personal ID_ (e.g. a _SIP URI_ in the following
format: sip:john.doe@first.net).
In addition to being uniquely identified by the _App Group ID_ , a Public
Safety group may also be identified at the 3GPP lower layers via a layer-2
group identifier (referred to here as _Layer-2 Group ID_).
According to TS 22.468 [8], a Public Safety group can have as many as 500
members. Storing information about individual group members in every Public
Safety ProSe-enabled UE may be impractical in that any group update (addition
or deletion of an individual member) would need to be propagated to every UE.
Encoding a Public Safety Group ID (to which a user belongs) in a portion of
the overall user ID may not be practical either, because in case the UE
belongs to multiple Public Safety groups, it would have to announce the IDs of
all the groups to which it belongs.
Targeted ProSe discovery reverses the paradigm by having the discoverer UE
pro-actively seeking to discover any members of a specific Public Safety group
(the \"discoveree\" UEs), rather than looking for individual group members.
###### 6.1.3.1.1.2 System architecture
The Targeted ProSe discovery solution described here assumes that the 3GPP
lower layers provide the following ProSe Communication service to the
discoverer UE and the discoveree UE:
\- ProSe communication based on exchange of layer-2 frames whose header
contains at a minimum a _Source Layer-2 ID_ and _Destination Layer-2 ID_
fields, indicating the message originator and recipients, respectively.
\- The discoverer UE shall be able to broadcast or groupcast a Targeted
Discovery Request message containing at least the following parameters:
\- A parameter uniquely identifying the targeted population (e.g. _App Group
ID, Layer-2 Group ID, App Personal ID_);
\- A parameter uniquely identifying the discoverer (e.g. _App Personal ID_);
\- The _Source Layer-2 ID_ in the layer-2 frame header is set to the
discoverer UE\'s Layer-2 identifier allowing the discoveree UEs to send their
unicast responses;
\- The discoveree UE, having been solicited with a Targeted Discovery Request
message, shall be able to respond with a Targeted Discovery Response message
containing at least the following parameters:
\- A parameter uniquely identifying the discoveree (e.g. _App Personal ID_);
\- The _Destination Layer-2 ID_ in the layer-2 frame header is set to the
discoverer UE\'s Layer-2 identifier that was received in the frame carrying
the Target Discovery Request message;
\- The _Source Layer-2 ID_ in the layer-2 frame header is set to the
discoveree UE\'s Layer-2 identifier allowing the discoverer to potentially
engage in ProSe direct communication one-to-one.
Editor\'s note: Impacts in the radio resources from a L2 broadcast mechanism
are FFS.
###### 6.1.3.1.1.3 Applicability to Open ProSe discovery
By definition, Target Discovery is a \"Who is there?\" type of discovery that
is in contradiction with Open Discovery, the latter consisting in self-
advertising (e.g. \"I am a restaurant\", \"I am a store\", \"I am a relay\",
etc.).
Nevertheless, it is noted here that the same layer-2 frame format can also be
used to support a rich-information beacon signal that can be used for self-
advertisement, similar to Open ProSe discovery.
For instance, the UE that wants to advertise itself (\"I am John Doe\") or its
services (\"I am happy to serve as a UE-to-Network Relay\") can regularly
transmit the layer-2 frame on a broadcast or multicast _Destination Layer-2
ID_ , providing any type of advertisement information within the frame
payload.
Similar to the Targeted Discovery Request and Targeted Discovery Response
messages described previously, the Beacon message is carried within a ProSe
communication layer-2 frame, with the _Destination Layer-2 ID_ field set to
the _Layer-2 Group ID_ of the targeted GCSE Group or to a broadcast address.
##### 6.1.3.1.2 Procedures
Depicted in Figure 6.1.3.1.2-1 is the procedure for Targeted ProSe discovery.
Figure 6.1.3.1.2-1: Targeted ProSe discovery procedure
1\. The user of UE1 (the discoverer) wishes to discover whether there are any
members of a specific GCSE Group in proximity. UE1 broadcasts or groupcasts a
Targeted Discovery Request message:
\- If the UE is a group member, it sends a multicast layer-2 frame with the
_Destination Layer-2 ID_ field set to the _Layer-2 Group ID_ of the targeted
GCSE Group. The message payload can be encrypted with the group master key for
this GCSE group;
\- Alternatively, if the UE is not a group member, it may send the layer-2
frame on a broadcast address and include the _Layer-2 Group ID_ of the
targeted GCSE group in the Targeted Discovery Request message payload. In this
case the message payload is unencrypted.
The message may also include the discoverer\'s unique identifier (_App
Personal ID_ of user 1). The Targeted Discovery Request message is received by
UE2, UE3, UE4 and UE5. Apart from the user of UE5, all other users are members
of the requested GCSE Group and their UEs are configured accordingly.
2a.-2c. Each one of UE2, UE3 and UE4 responds directly to UE1 with a Targeted
Discovery Response message which may contain the unique _App Personal ID_ of
its user. In contrast, UE5 sends no response message.
##### 6.1.3.1.3 Impact on existing entities and interfaces
Impacts on existing RAN entities specific to this solution are generic to any
ProSe solutions (e.g. designation and announcements of radio resources that
can be used for direct radio discovery).
##### 6.1.3.1.4 Solution evaluation
This solution addresses Key Issue #7 ProSe direct Discovery outlined in clause
5.
NOTE: The solution description does not address all ProSe direct discovery
aspects (e.g. those described in Key Issue #2 Configuration for ProSe direct
discovery and Key Issue #6 Authorization for ProSe capability feature). It is
assumed that this solution is compatible with solution components described
elsewhere in the TR in order to address these additional aspects.
The solution presents the following advantages:
\- The only required RAN functionality on PC5 to support Targeted Discovery
(D3) is the RAN ProSe communication capability (i.e. \"a single mechanism that
would support broadcast-, group- and 1:1 communication, implemented by a
broadcast mechanism at the physical layer\" as summarised in SP-130470). In
other words, Targeted Discovery does not require any dedicated RAN capability
that is specific to ProSe discovery.
\- The Targeted Discovery search can be performed using a group identifier as
a target (\"Anyone there belonging to Group75-\". The discoverer does not have
to know the personal identities of the group members ahead of the search.
\- The Targeted Discovery search can be performed using any type of
application-level identifiers, possibly human-readable (e.g.
sip:fire.brigade75\@firstresponder.net, sip:john.doe\@firstresponder.net).
Given that the search is performed using ProSe Communication, there is
practically no limit for the identifier size.
\- The Targeted Discovery can be extended to multiple consecutive transactions
(see description of D6) to support any challenge-response security check.
\- The transport vehicle (i.e. layer-2 frame) that is used to carry the
Targeted Discovery Request message can also be used to support a rich-
information beacon signal (e.g. \"I can serve as a UE-to-Network Relay, for
these groups and under these conditions\").
Figure 6.1.3.1.4-1: Layer-2 frame format for D3 (shared in common with C1 and
C5)
The solution requires the definition of the following functionality in the RAN
groups:
\- A layer-2 frame header (see Figure 6.1.3.1.4-1) containing at least a
Destination Layer-2 ID that can be set to a unicast, groupcast or broadcast
identifier, and a Source Layer-2 ID that is always set to a unicast
identifier.
\- The unicast, groupcast and broadcast identifiers are assumed to have the
same size.
NOTE: The layer-2 frame format depicted in Figure 6.1.3.1.4-1 can also be used
to support a rich-information beacon signal.
### 6.1.4 Solution D4: EPC-level ProSe discovery
#### 6.1.4.1 Functional description
##### 6.1.4.1.1 General
The solution described in this clause addresses the EPC-level ProSe discovery
key issue described in clause 5.8. It relies on the Location Services (LCS)
architecture and is agnostic of the technology used on the direct link (i.e.
\"WLAN direct\" or \"LTE Direct\").
The solution described in this clause also contains text related to Solution
W1 described in clause 6.5.1 addressing the EPC support for WLAN Direct
communication key issue described in clause 5.9. The details specific to
Solution W1 are indicated with red ink in the figures and italicised text in
the call flow description.
##### 6.1.4.1.2 System architecture
Depicted in Figure 6.1.4.1.2-1 and Figure 6.1.4.1.2-2 is a system architecture
for EPC-level ProSe discovery using C-plane and U-plane location services,
respectively.
Figure 6.1.4.1.2-1: Architecture for EPC-level ProSe discovery using C-plane
location services
Figure 6.1.4.1.2-2: Architecture for EPC-level ProSe discovery using U-plane
location services
New reference points:
**PC3** : Reference point between UE and ProSe Function. It is used for ProSe
registration, proximity requests and proximity alerts. The PC3 protocol runs
in the user plane of EPS.
**PC2** : Reference point between ProSe Function and Third party Application
Server (AS). It is used for ProSe registration and identifier retrieval.
**PC6** : Reference point between ProSe Function residing in the HPLMN of the
discoverer and the ProSe Function residing in the HPLMN of the discoveree. It
is used when the discoverer and the discoveree(s) are subscribers of different
PLMNs.
In this solution a ProSe Function resides in the EPC and has the following
functions:
\- stores subscriber\'s ProSe profile;
\- acts as a location services client (LCS client or SLP client);
\- interacts with a Third party App Server (AS) via the PC2 reference point;
\- interacts with the UE via the PC3 reference point;
\- communicates with ProSe Function peers in other PLMNs over the PC6
reference point to support cross-PLMN EPC-level ProSe discovery scenarios;
\- provides the UE with information to assist with WLAN Direct discovery and
WLAN Direct communication;
\- may have interfaces to the charging architecture.
The 3rd party App Server hosts the following functions:
\- stores user\'s profile for applications relying on ProSe service (e.g.
application IDs, authentication credentials, user\'s discovery settings per
application, a list of application IDs and ProSe IDs of buddies per
application, etc.);
\- interacts with both UE (out of 3GPP scope) and ProSe Function (in 3GPP
scope).
It is assumed that the user has a permanent user identifier for ProSe service
referred to as its \"ProSe ID\". The ProSe ID is encoded in a way that
identifies both the user and the PLMN to which it is subscribed (e.g.
user@operator.com) and may also include a reference identifying the ProSe
Function (e.g. user\@ProSeserver.operator.com). Although an existing permanent
identifier (e.g. SIP URI) could be used as the ProSe ID, it is preferable to
use a ProSe-specific user identifier in order to prevent unnecessary sharing
of user identifiers with the 3rd party Application Server.
##### 6.1.4.1.3 Architecture for Cross-PLMN EPC-level ProSe discovery
Depicted in Figure 6.1.4.1.3-1 and Figure 6.1.4.1.3-2 is a system architecture
for EPC-level ProSe discovery with users subscribed to different operators
using C-plane and U-plane location services, respectively.
Figure 6.1.4.1.3-1: Architecture for cross-PLMN EPC-level ProSe discovery
using C-plane location services
Figure 6.1.4.1.3-2: Architecture for cross-PLMN EPC-level ProSe discovery
using U-plane location services
In this approach each of the two Evolved Packet Core (EPC) networks contains a
ProSe Function that stores all relevant ProSe information for its own
subscribers.
The current locations of UE A and UE B are stored in Gateway Mobile Location
Centres (GMLC) residing in each of the two EPC networks. Similar to the single
operator case, each ProSe Function is an LCS client (SLP Agent) of a GMLC
(SLP) which can look up the current locations of its ProSe subscribers.
Although residing in different PLMNs, the two ProSe Functions are capable of
communicating with each other via the PC6 reference point to exchange their
subscribers\' ProSe permissions, current locations, etc.
When the proximity threshold is reached, the requesting subscriber\'s ProSe
Function informs it of this event and may pass this information on to the
other ProSe Function (which then relays this message to the requested UE).
This information can be coupled with direct connection establishment
information if the subscribers wish to follow up with direct communications.
##### 6.1.4.1.4 Roaming Architecture
Editor\'s note: The roaming architecture is FFS.
#### 6.1.4.2 Procedures
##### 6.1.4.2.1 Overall call flow for EPC-level ProSe discovery
The overall call flow for EPC-level ProSe discovery is illustrated in Figure
6.1.4.2.1-1. Each procedural box is subsequently described in more detail as a
separate call flow.
Figure 6.1.4.2.1-1: Overall call flow for EPC-level ProSe discovery
1\. UEs register for ProSe with the ProSe Function residing in their Home
PLMNs.
2\. UE A makes a proximity request for UE B, i.e. requests that it be alerted
for proximity with UE B (possibly indicating a window of time during which the
request is valid). ProSe Function A can request periodic updates from ProSe
Function B regarding UE B\'s location, or it can request an update whenever UE
B moves beyond a given threshold.
3\. UE locations are reported to the ProSe Functions intermittently. Whenever
ProSe Function A receives a location update from ProSe Function B, it performs
proximity analysis on UE A and UE B\'s locations.
4\. When ProSe Function A detects that the UEs are in proximity, it informs UE
A that UE B is in proximity and provides UE A with assistance information for
WLAN Direct communications with UE B. ProSe Function A may inform ProSe
Function B, which in turn informs UE B of the detected proximity and provides
UE B with assistance information for WLAN Direct communications with UE A
(this is optional when the procedure is used for EPC-level discovery only).
Editor\'s note: It is FFS whether the existing GMLC capability for location
calculation can be re-used for proximity analysis on UE A and UE B\'s
locations in step 3.
##### 6.1.4.2.2 UE registration with ProSe Function
When a user registers with an application server for services such as ProSe,
he/she is designated an application identifier (e.g. AppA for user A). This
procedure is out of 3GPP specification scope. Then to activate ProSe features
such as EPC-level ProSe discovery for a specific application, the UE registers
the application with the ProSe Function, as illustrated in Figure 6.4.2.2-1.
Figure 6.1.4.2.2-1: UE registration with ProSe Function
1\. The user of UE A sends a ProSe Registration message to ProSe Function A to
register an application for ProSe. This message includes the UE\'s ProSe ID
(ProSeA), the Application ID (which identifies the App Server), and the
user\'s application-specific identifier (AppA). It also includes UE A\'s
permanent link layer identifier (LinkA) that will be used as the device
identifier for WLAN Direct discovery. Alternatively, the UE may obtain a
temporary link layer identifier from the ProSe Function as part of the
Proximity Request procedure;
2\. ProSe Function A may interact with the HSS in order to authenticate the
request and check whether the UE is authorized for ProSe. Alternatively, all
user settings related to authentication and authorization for ProSe may be
configured locally in ProSe Function A, in which case the interaction with the
HSS is not needed;
3\. ProSe Function A sends a ProSe Registration Request to the App Server
indicating that a user of this application (identified as AppA) has requested
to register to use ProSe for that application. If the App Server accepts the
request, it stores the user\'s application-specific ID A (AppA) and ProSe ID
(ProSeA) together;
4\. The App Server sends a ProSe Registration Response message to ProSe
Function A indicating that the registration was successful (or not);
5\. ProSe Function A sends a ProSe Registration Ack message to UE A indicating
that the registration was successful (or not).
Editor\'s note: The deregistration procedure needs to be described.
##### 6.1.4.2.3 UE makes a Proximity Request
In order to request that it be alerted when it enters proximity with user B,
UE A triggers the Proximity Request procedure, as illustrated in Figure
6.1.4.2.3-1.
Figure 6.1.4.2.3-1: Call flow for Proximity Request
1\. UE A sends a Proximity Request message to ProSe Function A indicating its
ProSe ID (ProSeA), the application ID, its application-specific ID (AppA), the
targeted user B\'s application-specific ID (AppB), and potentially a window
period. The window parameter is used to indicate the time period during which
the request is valid. In this message, UE A may also request support for WLAN
Direct communication with UE B;
2\. ProSe Function A sends a Map Request message to the App Server, requesting
that it provide the ProSe ID for the targeted user B;
3\. The App Server checks user B\'s application-specific ProSe permissions,
confirms that user A is allowed to discover user B, and sends a Map Response
message to ProSe Function A indicating user B\'s ProSe ID (ProSeB);
4\. ProSe Function A propagates the Proximity Request message to ProSe
Function B, indicating the ProSe IDs of both users (ProSeA, ProSeB), the link
layer identifier of UE A (LinkA), and a location update periodicity, trigger
or both. The encoding of the ProSeB identifier allows ProSe Function A to
derive ProSe Function B;
5\. Depending on UE B\'s ProSe profile, UE B may be asked to approve UE A\'s
proximity request or dynamically change the discovery permission for UE A.
Note, user B\'s application-specific ProSe permissions may be different than
UE B\'s ProSe permissions. Both must permit discovery by user A (UE A);
6\. ProSe Function B for location reporting on UE B from GMLC B/SLP B and
acknowledges the proximity request to ProSe Function A, and provides UE B\'s
link layer ID (LinkB) and current location (if known);
7\. ProSe Function A requests GMLC A for location reporting on UE A from GMLC
A/SLP A and acknowledges the proximity request to UE A.
##### 6.1.4.2.4 UE Location Reporting
The locations of UE A and UE B are intermittently reported to their
corresponding GMLCs, as illustrated in Figure 6.1.4.2.4-1.
Figure 6.1.4.2.4-1: UE location reporting
1.- 4. The locations of UE A and UE B are reported to their corresponding
ProSe Functions intermittently.
NOTE: Currently, deferred location reporting procedures (e.g. change location
reporting and periodic location reporting) for the C-plane location services
architecture are supported for GERAN/UTRAN only. It is expected that deferred
location reporting will be made available for E-UTRAN in the same release as
ProSe.
Editor\'s note: Details of using deferred location reporting procedures are
FFS.
5\. Assuming that ProSe Function A is in charge of determining proximity,
ProSe Function B forwards UE B\'s location to ProSe Function A periodically or
based on a trigger criterion provided by ProSe Function A.
##### 6.1.4.2.4.1 Specific to the architecture using C-plane location services
{#specific-to-the-architecture-using-c-plane-location-services .H6}
TS 23.271 [9] stipulates that if a UE is in idle mode when a location report
is requested, the network will bring the UE into connected mode to perform
location estimation. However, it would be preferable if an LCS client (e.g.
the ProSe Function) could indicate whether the network should bring the UE
into connected mode for location estimation or defer location estimation until
the UE is again in connected mode with the option of returning the UE\'s
latest location estimate (w/ time stamp) in the meantime. This additional
attribute in the LCS Location Reporting Request is referred to as
\"Idle/Connected Sensitivity\" and is expected to be defined as an LCS
enhancement. Here is an example of how the ProSe Function could make use of
the proposed \"Idle/Connected Sensitivity\":
a) When UE A requests to be alerted for proximity with UE B, the ProSe
Function initially makes a standard location request for UE A and UE B;
b) Based on the received location updates (expressed in GAD shapes as defined
in TS 23.032), the ProSe Function determines that the two UEs are roughly
within 4-5 km distance of each other. Therefore it makes a new location
request with deferred location attributes to the MMEs, the request may
indicate that the MMEs may defer location estimation for UEs in Idle mode (by
setting the \"Idle/Connected Sensitivity\" attribute);
c) Based on the most recent location report, the ProSe Function determines
that the two UEs are within roughly 1km distance of each other. Knowing that
the UEs may soon enter within direct communications range (say 500m), the
ProSe Function makes a new location request to the MMEs, indicating that the
MMEs must not defer location estimation for UEs in idle mode.
Editor\'s note: The benefit of this LCS enhancement for avoiding bringing UE
in connected mode unnecessarily needs to be evaluated.
Editor\'s note: It is FFS whether C-plane LCS scales well when large user
population uses EPC-level ProSe discovery concurrently.
##### 6.1.4.2.4.2 Specific to the architecture using U-plane location services
{#specific-to-the-architecture-using-u-plane-location-services .H6}
Here is an example of how the ProSe Function \"in charge\" could make use of
the range of SUPL location update methods to minimize overhead:
a) When UE A requests to be alerted for proximity with UE B, ProSe Function A
initially makes a location request for UE A and UE B;
b) Based on their received location updates, ProSe Function A determines an
approximate border area between the UEs and requests that they only send
location updates when/if they cross into that area;
c) When a UE crosses into the border area, it performs a location update,
which gets reported to ProSe Function A.
d) ProSe Function A then requests the UE only send a location update if/when
it leaves the border area.
e) ProSe Function A waits to see if the UE leaves the border area or if the
other UE enters it.
f) Depending on where the UEs move, ProSe Function A updates the border area
whenever necessary. This process ends when either the discovery window expires
or both UEs enter the border area. In the latter case, ProSe Function A may
redefine a smaller border area or simply request periodic updates until the
UEs are in proximity.
NOTE: The frequency of border area updates depends on the mobility of ether UE
and the size of the border area.
##### 6.1.4.2.5 Proximity Alert
When the UEs enter into proximity, the network triggers the Proximity Alert
procedure, as illustrated in Figure 6.1.4.2.5-1.
Figure 6.1.4.2.5-1: Call flow for Proximity Alert
1.-3. The location of UE B is reported to ProSe Function B, which forwards it
to ProSe Function A.
4\. ProSe Function A detects that the two UEs are in proximity and alerts UE A
by sending a Proximity Alert message containing assistance information for
WLAN Direct communications with UE B.
5\. Optionally, ProSe Function A may also request ProSe Function B to send a
Proximity Alert message to UE B containing assistance information for WLAN
Direct communications with UE A (this is optional when the procedure is used
for EPC-level ProSe discovery only).
The assistance information can be designed to expedite WLAN Direct
communication. The content of the assistance information depends on the
technology used on the WLAN Direct link (refer to clause 6.5.1).
NOTE 1: The WLAN interface in the UE need not be turned on before step 6 in
Figure 6.1.4.2.5-1.
NOTE 2: This solution can also be used to assist in the establishment of
E-UTRA ProSe communications.
#### 6.1.4.3 Impact on existing entities and interfaces
The solution has no specification impact on existing RAN entities.
The solution using C-plane location services may have specification impact on
existing EPC entities:
\- The solution using C-plane location services would benefit from the LCS
enhancements described in clause 6.4.2.4, i.e. support for deferred location
reporting in E-UTRAN and the addition of an \"Idle/Connected Sensitivity\"
attribute in the LCS Location Reporting Request.
#### 6.1.4.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.1.5 Solution D5: IMS based ProSe architecture
#### 6.1.5.1 Functional description
##### 6.1.5.1.1 General
The proximity service communication has the two main requirements on ProSe
discovery and ProSe Communication over E-UTRA as well as over Wi-Fi. These
requirements result in functionalities such as monitoring the location of the
UE, comparing the location of the UE with the one it wants to discover and
alerting the UEs when they are in proximity of each other so that they can
setup a D2D communication. The UE itself needs to subscribe to an alerting (or
reporting) service for the location of particular UEs. Also in order to
establish a D2D communication, some configuration parameters need to be
exchanged before, so that there is no explicit user interaction needed.
Additionally the ProSe discovery shall be also working in the case when the
UEs are roaming in another network; this means that the location reporting has
to be transferred between networks, in order to determine the proximity of the
UEs. The UEs participating the D2D communication may also belong to different
operators.
Therefore the following functionalities have to be supported:
\- Location reporting;
\- Location comparison;
\- Roaming support;
\- Device parameter repository;
\- Secure device to device parameter exchange;
\- Subscription / notification methods for the discovery of a specific UE;
\- Access agnostic to support LTE and Wi-Fi.
##### 6.1.5.1.1 IMS based ProSe Architecture
The following figure shows how ProSe can be realized in IMS with the help of
an application server:
Figure 6.1.5.1.1-1: IMS ProSe Architecture
The ProSe AS is the central functional entity for provisioning the service and
it has the following functionality:
\- Repository of device configuration of the ProSe UEs, e.g. Wi-Fi Direct
configuration or specific LTE D2D parameters;
\- Acts as LCS Client i.e. monitors the location of the ProSe UE;
\- If the UEs are subscribed/configured for ProSe service at AS, the UEs get
notifications for being in the proximity of other configured UEs;
\- Determines the location of ProSe configured UEs that are subscribed to be
notified once being in proximity of each other.
##### 6.1.5.1.2 EPC based ProSe discovery using Presence Service
Figure 6.1.5.1.2-1 details how ProSe can be realized in an operator network
that also deploys Presence Service.
Figure 6.1.5.1.2-1 Architecture for EPC based ProSe discovery using Presence
Presence service TS 23.141 [16] incorporates various User\'s information like
device status, communication addresses, willingness to communicate etc.
Furthermore, presence service provides enhanced operator and user control in
terms of Presentity filters, User Authorization filters that are required by
ProSe. These building blocks are also functionalities that shall be supported
by ProSe.
Following are the high level functionality of the architecture.
\- It uses the already developed Presence service and presentity model TS
23.141 [16]. It reuses the 3GPP security mechanism for
authentication/authorization TS 23.228 [17].
\- Architecture assumes no changes in RAN, EPC, and IMS network.
\- The ProSe Server is an IMS application server. It communicates to the UE\'s
and other network entities through the IMS Service Control Interface (ISC) TS
23.228 [17].
\- ProSe Server also acts as a Presence Network Agent /LCS client for getting
the location information.
\- ProSe Server can have any of the three functionalities as defined in
Presence specification TS 23.141 [16], watcher, fetcher and/or principal.
ProSe Server is responsible to watch UEs or applications that are of interest.
ProSe Application is a Watcher Application and supports both Presence
Monitoring and fetching modes. In fetching mode, it shall be possible for the
ProSe Server to once request all or only a subset of a presentity\'s presence
information.
##### 6.1.5.1.2.1 Reference Points {#reference-points .H6}
##### 6.1.5.1.2.1.1 Reference point UE to ProSe Watcher Proxy Function - PC3
{#reference-point-ue-to-prose-watcher-proxy-function---pc3 .H6}
This reference point PC3 is from the UE/Application to the Presentity Proxy.
It is used to publish the ProSe Information and receive notifications when two
UE\'s are in proximity. The reference point is used to carry the presentity
information to the Presence server TS 23.141 [16] and/or to the ProSe Server.
ProSe information will be in PIDF format [15]. Following Figure 6.1.5.1.2.1-1
shows the high level overview of the PIDF and its potential enhancements for
carrying direct communication information.
PC3 shall support IMS SIP(Gm) based communications for publishing the presence
information.
Figure 6.1.5.1.2.1.1-1 PIDF model for carrying WLAN or D2D info
##### 6.1.5.1.2.1.2 Reference point ProSe Server to ProSe Watcher Proxy
Function - PC2 {#reference-point-prose-server-to-prose-watcher-proxy-function
---pc2 .H6}
This reference point PC2 is used between the ProSe server acting as a
watcher/principal and/or principal application to the presentity proxy TS
23.141 [16].
This reference point uses ISC reference point TS 23.228 [17].
###### # 6.1.5.1.2.1.3 Reference point UE to ProSe Server - PC1
This reference point PC1 shall allow the ProSe server to manage various ProSe
lists. A subset of the lists is shown below:
\- Discoverable devices.
\- Allowed applications.
\- UE/ProSe Application status.
NOTE: Complete set of lists are FFS.
This reference point uses capabilities based on Ut reference TS 23.228 [17].
#### 6.1.5.2 Procedures
##### 6.1.5.2.1 Registration
Figure 6.1.5.2.1-1: IMS ProSe Architecture
1\. The UE performs normal IMS registration.
2\. The UE subscribes to the proximity service with the ProSe AS.
3\. The ProSe AS responds with an acknowledgement, the SIP OK message.
Editor\'s note It is FFS whether an existing event package or new event
package needs to be defined.
##### 6.1.5.2.1.1 Registration for Presence based Discovery {#registration-
for-presence-based-discovery .H6}
ProSe Server uses the IMS third party registration TS 23.228 [17] and SIP
Subscribe/Notify mechanism RFC 3265 [21] to identify the UE\'s capabilities
and device information.
Figure 6.1.5.2.1.1-1 Architecture for EPC based ProSe discovery in multi PLMN
scenario
Following are the high level steps of the ProSe Registration, Authorization
and Authentication
[1] UE authenticates and authorizes with IMS network.
[2.1 & 2.2] Presence Server communicates with S-CSCF over ISC interface. As
part of the third party registration TS 23.228 [17], the Presence server
receives the third party registration of the UE. The Presence Server
acknowledges the third party registration.
[3.1 & 3.2] The ProSe Server, representing as Application Server over ISC.
ProSe Application server can be a watcher, principal and or fetcher
application for presentity. As part of the ISC reference TS 23.228 [17], ProSe
server gets the third party registration. ProSe Server acknowledges the
registration.
As described in the architecture clause, the ProSe server uses the existing
authentication/authorization and security mechanism TS 23.228 [17].
[4.1 to 4.3] ProSe Subscription. As ProSe Server is notified on the
registration of the UE, ProSe server now subscribes to the UE\'s presentity
profile and sends the request through the ISC interface. S-CSCF routes the
subscription to Presence Server. Presence Server as per operator/user policy
authorizes the subscription.
NOTE: Operator policy can pre authorize subscriptions for the ProSe Server or
based on the user\'s policy could ask the UE (part of watcher info TS 23.141
[16]) for authorization. Operator policy overwrites user policy.
[4.4 to 4.5] Presence Server acknowledges to S-CSCF which in turn propagates
to ProSe Server.
##### 6.1.5.2.2 Network initiated Discovery (within network coverage)
In this scenario a UE A explicitly indicates if it should be alerted by the
network when a specific UE B is in the proximity of UE A.
Figure 6.1.5.2.2-1: Network based proximity discovery
1\. UE A sends a proximity request to ProSe AS A to be alerted when UE A and
UE B are in the proximity of each other.
2\. The ProSe AS A requests location reporting of UE A from GMLC A.
3\. The ProSe AS A requests location reporting of UE B from ProSe AS B. The
request is routed to the terminating network via normal SIP routing. The ProSe
AS A may include already the D2D configuration of the UE A.
4\. The ProSe AS B requests location reporting of UE B from GMLC B.
5\. The ProSe AS B sends an acknowledgement back to the ProSe AS A (200 OK).
The ProSe AS B may include already the D2D configuration of the UE B.
6\. Once the ProSe AS A received the ACK, it sends also an acknowledgement of
the request to the UE A. From now on the locations of UE A and UE B are
monitored and compared, as described in the next steps.
7\. GMLC A periodically checks the location of UE A and GMLC B is periodically
checking the location of UE B.
8\. Each time the GMLC B receives the new location of the UE B, it reports the
location to the ProSe AS B.
9\. When the ProSe AS B receives location information from the GMLC B, it
forwards the location information to the ProSe AS A.
10\. The ProSe AS A sends an acknowledgement back to the ProSe AS B (200 OK).
11\. The ProSe AS A compares the received location information from UE A with
the one of UE B. The steps 8, 9, 10, 11 and 12 are repeated until proximity is
detected.
12\. The ProSe AS A detects that the two UEs are within the configured
alerting range of proximity.
13\. The ProSe AS A sends a proximity alert message to the ProSe AS B.
14\. The ProSe AS A sends a proximity alert message to the UE A. The UE A
acknowledges the message with a SIP 200 OK.
15\. The ProSe AS B sends a proximity alert message to the UE B. The UE B
acknowledges the message with a SIP 200 OK.
16\. The ProSe AS B is sending an acknowledgement back to the ProSe AS A.
17\. UE A and UE B can connect directly once they are in coverage of each
other.
##### 6.1.5.2.3 UE initiated Discovery (within network coverage)
In this scenario, the UEs detect the proximity by themselves with their D2D
radio technology.
Figure 6.1.5.2.3-1: UE based proximity discovery with network support
1\. UE A detects UE B or vice versa or both detect themselves at the same
time. In the following it is assumed for simplicity that UE A detects UE B
first.
2\. UE A sends a proximity alert message with the identity of the UE B to the
ProSe AS A. In case UE B would detect UE A too, it would send a similar
message to its ProSe AS B with the identity of UE A.
3\. The ProSe AS A detects the proximity of the two UEs and prepares an alert
message for ProSe AS B.
4\. The ProSe AS A sends a proximity alert message that UE A and UE B are
within coverage of their D2D radio technology to the ProSe AS B. The ProSe AS
A may include already the D2D configuration of the UE A.
5\. If the UE B has not already alerted the ProSe AS B, it now detects the
proximity of the two UEs.
6\. The ProSe AS B sends an acknowledgement (200 OK) back to the ProSe AS A.
The ProSe AS B may include already the D2D configuration of the UE B.
7\. The ProSe AS B sends a proximity alert message with the D2D configuration
of the UE A.
8\. ProSe AS A sends an acknowledgment with the D2D configuration of the UE B
9\. UE A and UE B can now connect to each other.
##### 6.1.5.2.4 Network supported D2D Communication (within network coverage)
When the network supports the D2D communication setup, then the SIP signalling
is routed via the network but the media is transmitted via D2D directly
between the two UEs.
Figure 6.1.5.2.4-1: Simplified session setup with network support
1\. UE A sends the INVITE to UE B via the IMS, indicating the D2D interface
for the media.
2\. UE B acknowledges the request with a 200 OK.
3\. Media communication is setup directly between the UE A and B via D2D
interface.
##### 6.1.5.2.5 Direct D2D Communication (out of network coverage)
There may be situations where the network cannot support the session setup due
to low or no radio coverage of the macro cell. This requires that the UEs are
already preconfigured and are able to setup a D2D connection without previous
exchange of configuration parameters as described in clause 6.1.5.2.2 and
6.1.5.2.3. Basic security like encryption parameters have to be preconfigured
too.
Figure 6.1.5.2.5-1: Direct session setup without network support
1\. UE A detects UE B via the D2D interface, since the devices are
preconfigured, they can directly exchange messages.
2\. UE A sends the INVITE to UE B via the D2D interface.
3\. Since there is no IMS involved, the UE B authorizes the request from UE A
and acknowledges it with a 200 OK.
4\. Media communication is setup directly between the UE A and B via D2D
interface.
##### 6.1.5.2.6 Discovery procedures using Publish-Notify mechanism
##### 6.1.5.2.6.1 Publish direct communication info {#publish-direct-
communication-info .H6}
ProSe server needs information about the WLAN/D2D information and is Published
to ProSe Server. The request could be published by UE whenever there is a
change in the information. The presentity data is kept in ProSe Server when
Proximity notification is sent to the UE\'s.
Figure 6.1.5.2.6.1-1 shows the publication of direct path info (WLAN/E-UTRAN)
information of the ProSe enabled UE to the ProSe Server. ProSe server can use
this information to establish the direct communication between the UE\'s when
they are in proximity.
Figure 6.1.5.2.6.1-1 Architecture for EPC based ProSe discovery in multi PLMN
scenario
It\'s assumed the UE is registered to the ProSe Server as described in clause
6.1.5.2.1.1.
[1] UE publishes the information whenever there is change in the UE\'s
capability or on user\'s discretion. For example, UE may want to switch off
the ProSe communication or may change is willingness to communicate.
[2.1 to 2.5] UE publishes the information to Presence Server through the IMS
core (P-CSCF, S-CSCF). The information includes the PIDF [15] extension for
WLAN/EUTRAN direct communication.
Presence server acknowledges the PUBLISH and the acknowledgement is propagated
to the UE. Retransmissions and loss of publications are handled using the SIP
[20].
[3.0] Presence server runs the filters TS 23.141 [16]. Upon detection of any
active subscriptions, the Watchers are notified about the change on the
filtered content.
[3.1 to 3.3] ProSe Server is notified RFC 3265 [21] about the change and
acknowledgement is sent to the Presence Server. ProSe server updates the UE\'s
capabilities based on the notification.
##### 6.1.5.2.6.2 UE requesting proximity information. {#ue-requesting-
proximity-information. .H6}
Figure 6.1.5.2.6.2-1 shows the methodology of one UE requesting Proximity
notifications of another UE that might be in Proximity. The figure details a
multi PLMN scenario. The same flow may also be used when both UE\'s are in the
same PLMN.
Figure 6.1.5.2.6.2-1: Proximity request procedure
Following is a high level description of the subscription flow.
[1.A &.B] UE-A is interested to know when UE-B is in proximity. UE-B may be in
the same PLMN or a different PLMN. **_UE-A requests the ProSe Server for
Proximity Request of UE-B through PSet interface._**
[2.A & B] **_ProSe Server requests Location information from the GMLC of its
network._** Location information is retrieved directly to optimize the flow.
It might be retrieved from the presentity information sent through Presence
Server.
[3.A through E] **_ProSe Server uses the SUBSCRIBE mechanism to request for
UE-B information_**. UE-B may choose to accept the request or provide only
that information according to the PLMN-B and UE-B policies. Notification of
the UE-B info is sent to the ProSe Server-A.
[4.A through D] Notification of the UE-B info to UE-A.
[5.A through D] On UE-B willingness to communicate, ProSe Server-A asks for
location information UE-B through ProSe Server-B. To achieve optimization, the
frequency of the location could be optimized only when the UE\'s might be in
proximity.
Only the originator ProSe Server is responsible for determining proximity.
This solution does not preclude from both ProSe Servers determining proximity
and making independent decisions.
##### 6.1.5.2.6.3 Proximity notifications to UE {#proximity-notifications-to-
ue .H6}
Upon determining from location and presentity, ProSe Server detects UE\'s are
in Proximity. The information about the direct path is sent directly to the
UE\'s concerned using SIP [20]. The direct path info is sent as a MIME in the
SIP MESSAGE.
Figure 6.1.5.2.5.3-1 shows the ProSe server procedure in notifying the UE\'s
that are in Proximity.
Figure 6.1.5.2.6.3-1: Proximity request procedure
Following is the high level description of the flows. It is assumed that the
Proximity Request procedure as described in clause 6.1.5.2.5.2 is done prior
to this flow.
[1] Proximity Request procedure as described in 6.1.5.2.5.2 is done.
[2.A through B] Location information of UE-A is sent from GMLC-A to ProSe
Server-A.
[3.A through B] Location information of UE-B is sent from GBLC-B to ProSe
Server-B.
[4.A through B] Location information is sent from ProSe Server-A to ProSe
Server-B.
[5.A through D] Once the ProSe server determines the UE\'s are in proximity,
ProSe-Server sends the message to UE-A. This flow assumes the SIP messaging is
used to communicate with UE-A. The message includes the direct connection
(WLAN/EUTRAN) info that UE-A can used to communicate directly with UE-B.
[6.A through F] Message is sent to UE-B about UE-A information. This is an
optional message but could be used to authorization at UE-B.
#### 6.1.5.3 ProSe Identities and Attributes
A discovering ProSe-enabled UE shall be able to determine whether or not
another ProSe-enabled UE is of interest to it. A ProSe-enabled UE is of
interest to a discovering ProSe-enabled UE if its proximity needs to be known
by one or more authorized applications on the discovering ProSe-enabled UE. A
ProSe UE application running on a ProSe-enabled UE shall be able to
unambiguously register its profile attributes with the ProSe Server and
identify other ProSe-enabled UEs that share similar attributes.
The Extensible Messaging and Presence Protocol(XMPP) (RFC 6120/6121[19]) is an
application profile that enables the exchange of structured yet extensible
data between multiple network entities. It uses application-specific data
qualified by particular XML namespaces.
An XML namespace allows different modules to be able to recognize the elements
and attributes which they are designed to process, even in the face of
\"collisions\" occurring when mark-up intended for some other modules uses the
same element name or attribute name. XML namespaces accomplish this by
assigning _expended names_ to elements and attributes.
An **XML namespace** is identified by a URI reference (RFC 3986 [18]). An
**expanded name** is a pair consisting of a namespace name and a local name.
XMPP naming and messaging (RFC 6121 [19]) are used for EPC based ProSe
discovery based on Presence.
#### 6.1.5.4 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.1.5.5 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
IMS provides authentication, secure transmission, service control and roaming
support and is access agnostic. Additionally service continuity scenarios as
described in TR 22.803 [25] could be realized with IMS too.
An IMS based solution has the following benefits:
\- Access agnostic, support of Wi-Fi and LTE.
\- Security support, ideal for exchanging device configurations like the pre-
shared secret for WiFi direct.
\- Roaming support.
\- Subscribe/Notify methods.
\- Easy integration with LCS.
\- UE impact is limited to IMS client.
\- IMS Service Continuity support.
### 6.1.6 Solution D6: Targeted Discovery based on application-defined ProSe
Application ID and system provided ProSe UE ID
#### 6.1.6.1 Functional description
Targeted discovery assumes the party interested in discovering peers knows
exactly how to identify/address the potential discovery targets and so it aims
at discovering these only as part of the discovery process. This implies
application layer communication needs that are well known when discovery is
initiated and discovery is functional to the satisfaction of these
communications needs. This also implies the existence of particular user or
set of users that are communication targets.
Examples are:
\- Public safety agent out of coverage needing to discover a PS relay.
\- Public safety agent needing to discover a peer agent device to send to
him/her a video feed from his/her own device.
\- Application users\' discovery in vicinity (determined by the allowed
range).
\- Discovery of a particular application user in the vicinity (determined by
the allowed range).
This type of discovery is \"targeted\" in that membership to a
group/application is required to discover and be discoverable. So this can be
classified as targeted discovery.
#### 6.1.6.2 Procedures
Targeted Discovery can be regarded as using a \"looking for members\" type of
message to find out if any members of a specific potential application peer
group are around. The members of a group share a ProSe Application Identity
that is defined at application layer, so it may not be unique globally.
The preconditions of targeted discovery are:
1\. The discovering UE is authorized to discover by the system
2\. The UE\'s that can be discovered are authorized to participate in
discovery
3\. The UE\'s that initiate targeted discovery know how to address the group
by a ProSe Application Identity
4\. The Application Group membership is validated by a secret key. So
overlapping ProSe Application Identities may exist but filtering is operated
via application layer shared secrets. It is assumed the UE\'s involved in
targeted discovery can also support a challenge/response method of mutual
authentication of group members based on shared secret.
5\. The UE identity used for ProSe (ProSe UE ID) does not reveal the UE mobile
subscriber identity. This identity should be resolvable to (or be the same as)
a direct communications address which could be used for one to one
communications for signalling or user plane. This identity is application
independent. This is provided by 3GPP layer (e.g. at attach time and can be
refreshed via MM procedures), or it can be configured in the UE by the
manufacturer or derived from e.g. the IMEI SV if no network is available and
the device.
6\. The User application layer identity of the ProSe UE user can be bound to
the UE ProSe UE Identity to determine interest for further communications;
however this is not required for all possible applications.
7\. The application/Group is authorized for ProSe.
It should be noted that there is no real logical difference in the logical
sequence whether the UE is in or outside network coverage, so the solution is
logically applicable to both public safety and non-public safety use cases as
long as the necessary radio level transmission mechanisms are available. Radio
layer procedures may change for in coverage and out of coverage of course, but
this is not in scope of the present document. An example message flow for the
discovery can be as per the following figure 6.1.6.2.1.
Figure 6.1.6.2.1-1: Targeted discovery including UE network and application
layer ProSe registration
If the UE is not under network coverage, the dashed lines parts are not
applicable. Also the ProSe registration does not happen and the ProSe UE IDs
is preconfigured in the device. The mapping of ProSe UE ID\'s to application
layer ID is based also on pre-configuration or a specific application will
enter a user plane exchange to determine interest.
If the UE is under network coverage, the ProSe UE ID is provided by the
network e.g. at attach time. This is implicit authorization of ProSe. This may
be renewed upon UE or network request as part of MM procedures.
The ProSe Application ID is assumed to be associated to the application the
discovery is targeting. It is some value that is perhaps hardcoded or assigned
to the app by the related application server.
Once the UE acquires or is configured a ProSe UE ID from the network (when
under coverage) it registers with the application server its value and any
preferences related to discoverability by other applications members
(generally or for e.g. members of the user\'s social network). The application
server will also provide the UE with the ProSe Ids of all the application
members associated with this UE if this is the initial registration.
In step 1, UE A sends over a broadcast channel used for discovery a Targeted
Discovery Request message using a broadcast Layer one channel. This message
has a Layer two address of UE A as source address and Layer two Broadcast
address as destination address. It should be noted that for a UE to be able to
transmit on the broadcast channel for discovery under PLMN coverage, it has to
get scheduling grant by the network, which is only possible for UE\'s that are
authorized to discover other UE\' then the discovery in the coverage area
where the UE is located. When the network is absent, Public safety UE\'s are
assumed to be authorized to use discovery and be discovered, if their
application requires it. The definition and the way layer two addresses are
configured and used is in scope of RAN working groups.
In step 2, UE B sends a Targeted Discovery Response Message using a Layer one
Broadcast channel. This message uses UE B\'s layer two address as source
address and either the broadcast address or the source address of the Targeted
Discovery Request message (UE A\'s address) as destination address. A UE may
locally disable responding Targeted Discovery requests for ProSe ID, a ProSe
Application Identity, set of ProSe Application Identities, or for all ProSe
Application Identities based on its user settings and applications status and
settings in the UE, or based on operator determined settings. This enables the
user and the operator to control discovery on a ProSe Application ID or ProSe
UE ID basis via a whitelist or a blacklist approach. The configuration of
these blacklists or whitelist is not in scope of this proposal but it may be
based on configuration via a D2D provisioning function documented elsewhere in
this TR.
The challenge mechanism permits the UE sending the challenge to determine
whether the respondents are belonging to the group and are trustworthy members
of these groups. The response to the challenge is a function of the ProSe UE
ID of the respondent and the challenge itself. A UE is not allowed to respond
to a challenge more than once, so replay based attacks are not possible (i.e.
the challenging UE will accept at most one response to a challenge).
In step 3 UE A replies to the Targeted Discovery Response message with a
Targeted Discovery Ack message using a Layer one Broadcast channel. This
message uses UE A\'s layer two address as source address and either the
broadcast address or the source address of the Targeted Discovery Response
message (UE B\'s address) as destination address.
At the end of the targeted discovery procedure the UE A gains the UE B ProSe
ID and the UE attributes for this group (attributes may include e.g. whether
the UE can act as a ProSe relay for the specific application). This may then
be used for direct communication.
#### 6.1.6.3 Impact on existing entities and interfaces
\- MME : needs to be able to issue and maintain the ProSeID.
\- eNB: Must enable the transmission on a broadcast discovery channel using
unicast address (ProSe ID) and group address (Group ID) as well as to all
devices.
\- UE: must register for ProSe at application and 3GPP layer, must support
discovery channels and the related RAN layer procedures.
#### 6.1.6.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.1.7 Solution D7: Non targeted Discovery based on application-defined
ProSe Application Identity and system provided ProSe UE ID
#### 6.1.7.1 Functional description
Non targeted Discovery assumes the party interest in detecting any potentially
available communications peers and to discover the services and communications
possibilities these offer. No particular application need is the trigger of
this discovery (e.g. the UE user may just trigger a generic discovery) and
actually the set up of application layer peerings can be dynamical and a
consequence of the discovery process itself.
Examples use cases are:
\- Discovering any available direct communications peers nearby (determined by
the allowed range).
\- Discovering any ProSe relay nearby(determined by the allowed range).
In this type of discovery, membership of a specific group/application is not
required to discover and be discoverable. So this can be classified as \"non-
targeted\" discovery.
#### 6.1.7.2 Procedures
Non-Targeted discovery can be regarded as a \"hello\" type of message to find
out what sort of potential application peers are around. This may be then
followed by targeted discovery and/or direct communications. An example flow
is shown here below.
The preconditions of Non-Targeted discovery are:
1) The discovering UE is authorized to discover by the system.
2) The UE\'s that can be discovered are authorized to participate in
discovery.
3) The UE\'s that initiate non targeted discovery are just interested in
discovering what is around.
4) There is no intent to authenticate or validate the information received in
response as part of the non-targeted discovery.
5) The UE identity used for ProSe (ProSe ID) does not reveal the UE subscriber
identity. This identity should be resolvable to (or be the same as) a direct
communications address. This identity is application independent. This is
provided by 3GPP layer (e.g. at attach time and can be refreshed via MM
procedures), or it can be configured in the UE by the manufacturer or derived
from e.g. the IMEI SV if no network is available.
6) The application and user settings and preferences determine whether the UE
responds to non-targeted discovery and if so revealing which application
groups a UE is willing to disclose.
7) The application/Group in the discovered entity is authorized to participate
in non-targeted discovery.
Figure 6.1.7.2.1-2: Non-Targeted discovery
Figure 6.1.7.2.1-2 illustrates the operation of this procedure:
The UE is assumed to have obtained a ProSe UE ID as in figure 6.1.6.2.1-2. If
the UE is not under network coverage, the dashed lines parts are not
applicable. Also the ProSe registration does not happen and the ProSe UE ID is
preconfigured in the device. The mapping of ProSe UE ID's to application layer
IDs is based also on pre-configuration or a specific application will enter a
user plane exchange to determine interest.
In step 1 UE A sends out a Non-Targeted Discovery Request including UE A\'s
ProSe UE ID, using a broadcast Layer one channel. This message has a Layer two
address of UE A as source address and Layer two Broadcast address as
destination address.
In step 2, UE B sends a Non-Targeted Discovery Response Message using a
broadcast Layer one channel. This message uses UE B\'s layer two address as
source address and either the broadcast address or the source address of the
Non-Targeted Discovery Request message (UE A\'s address) as destination
address. This message may be repeated (and dedicated) for each supported ProSe
Application ID, or a number of ProSe Application IDs information may be
aggregated in fewer messages than the supported application groups.
A UE may disable responding non targeted discovery requests for all or a
subset of the supported ProSe applications based on its user preferences or
operator settings. This enables the user and the operator to control discovery
on a ProSe Application ID or ProSe UE ID basis via a whitelist or a blacklist
approach. The configuration of these blacklists or whitelist is not in scope
of this proposal but it may be based on configuration via a D2D provisioning
function documented elsewhere in this TR.
At the end of the non-targeted discovery procedure the UE A gains the UE B
ProSe UE ID, the disclosed ProSe Application memberships (ProSe Application
Identities) and the UE attributes for these groups (attributes may include
e.g. whether the UE can act as a ProSe relay for the specific application
group, whether it is under coverage or not etc.). Both UE A and UE B know the
peer Layer two addresses for communications over a Layer one broadcast
channel. This may then be used for subsequent direct communication or
signalling over a broadcast channel.
#### 6.1.7.3 Impact on existing entities and interfaces
\- MME: needs to be able to issue and maintain the ProSe UE ID, authorize the
UE for ProSe.
\- eNB: Must enable the transmission on a broadcast discovery channel.
\- UE: must register for ProSe at application and 3GPP layer, must support
discovery channels and the related RAN layer procedures and addressing
schemes.
#### 6.1.7.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.1.8 Solution D8: Network based solution for ProSe discovery
#### 6.1.8.1 Architecture reference model
Figure 6.1.8.1-1: ProSe architecture (non-roaming)
Basic concept:
\- ProSe server functionality in MME is utilized to authorize the ProSe
discovery and/or ProSe communication.
\- The application running in the UE asks ProSe service from the EPS layer
functionality in the UE.
\- ProSe server allocates the ProSe ID per application instance in the UE. The
ProSe ID is used for ProSe discovery and ProSe communication.
\- The ProSe ID is sent to the application server and distributed to other
users who are allowed to discover this user.
New Reference points
**U1** : Reference point used for information exchange needed in order to
perform ProSe discovery and communication between two ProSe UEs.
Roaming scenario is similar to those defined clause 4.2 in TS 23.401 [11],
with the enhancement made above for non-roaming scenario.
#### 6.1.8.2 High Level Functions
##### 6.1.8.2.1 Authorisation for ProSe services
Two levels of authorization for ProSe services are required:
\- At 3GPP layer, the ProSe Server verifies whether a UE is subscribed to
ProSe service in the 3GPP network and whether the application is allowed to
use proximity service provided by the 3GPP network.
\- At the application layer, the application server authorize whether to
distribute the ProSe ID to the friends who are allowed to discover this user.
##### 6.1.8.2.2 ProSe ID allocation
The ProSe ID is a temporary user identity specific to an application instance
of which the ID is assigned by the ProSe Server. Each application instance, to
which proximity service can be provided, will be allocated a unique ProSe ID
during the ProSe registration. The ProSe ID also indicates whether it is
allocated for open discovery or restrictive discovery. For intra-MME mobility,
the ProSe ID doesn\'t need to be reassigned. For inter-MME mobility, the
application needs to perform ProSe registration and new ProSe ID is
reassigned. In this case the new ProSe ID needs to be sent to application
server and distributed to the friends who are allowed to discover this user.
##### 6.1.8.2.3 Signalling flow for ProSe registration
Figure 6.1.8.2.3-1: Signalling flow for ProSe registration procedure
1\. The UE performs LTE attach procedure after power on and establishes a PDN
connection to PGW.
2\. If the application running in the UE wants to use Proximity service, it
asks the EPS layer in UE to perform ProSe registration procedure. The request
message includes (application id and open/restrictive indication).
3\. The EPS layer in UE sends a ProSe registration request NAS signalling to
the eNodeB via RRC signalling. The NAS signalling includes the application
identity, the GUTI and the open/restrictive indication.
4\. The ProSe server verifies the subscription of the UE to see whether the
indicated Open/Restrictive ProSe service is subscribed. The ProSe Server also
authorizes the application identity provided by the UE in ProSe registration
request NAS signalling.
5\. If the ProSe service is allowed for the UE and for the application, it
asks the eNodeB to allocate the Radio Resource to the UE. RAN group will
further study the details.
6\. The ProSe Server will assign a ProSe ID to the UE for this application
instance. The ProSe ID indicates whether it is allocated for open/restrictive
discovery. The ProSe Server sends a ProSe registration Ack (ProSe ID) to the
UE.
7\. The EPS layer in UE sends a ProSe registration complete message to the
ProSe Server.
8\. The EPS layer in UE sends the ProSe Registration response(the ProSe ID) to
the application.
9\. The application in the UE registers with application server with the ProSe
ID.
10\. The Application server stores the mapping between the ProSe ID and the
application layer user ID. The ProSe ID is distributed via application layer
signalling to other users which is allowed to discover this user.
##### 6.1.8.2.4 Targeted ProSe discovery procedure
Figure 6.1.8.2.4-1: Signalling flow for targeted ProSe discovery procedure
1\. The application running in UE1 gets the ProSe ID of the interested user
via application layer signalling. If it is decides to discover the proximity
of the UE2, the application sends Discovery Request (ProSe ID2) to the EPS
layer in the UE1.
2\. The EPS layer in UE1 makes decision whether to use Open discovery or
Restrictive discovery based on the target ProSe ID2. The flowing steps 3-9
only apply to Restrictive discovery, steps 10-12 only apply to Open discovery.
3\. The EPS layer in UE1 obtains the ProSe discovery radio resource
information. When the UE1 is out of coverage it obtains this information from
static configuration. When the UE1 is in coverage it obtains this information
from the network. The details are FFS.
4\. The EPS layer in UE1 broadcasts ProSe discovery signalling (ProSe ID2,
ProSe ID1). RAN group will further study the details.
NOTE 1: When the UE1 is in EUTRAN coverage the discovery signalling may also
be transferred via EPC. The details are FFS.
5\. The EPS layer in UE2 receives the discovery signalling and report it to
the application indicated by the ProSe ID2, including the source ProSe ID1.
6\. The application checks whether it is allowed to be discovered by UE1. If
accepted it sends discovery confirmed to the EPS layer of UE2.
7\. The EPS layer in UE2 obtains the ProSe discovery radio resource
information. When the UE2 is out of coverage it obtains this information from
static configuration. When the UE2 is in the coverage it obtains this
information from the network. The details are FFS.
8\. The EPS layer in UE2 broadcasts ProSe discovery signalling (ProSe ID1,
ProSe ID2) to confirm the ProSe discovery.
NOTE 2: When the UE2 is in EUTRAN coverage the discovery signalling may also
be transferred via EPC. The details are FFS.
9\. The EPS layer in UE1 receives the discovery signalling and report it to
the application indicated in step1, including the ProSe ID2.
10\. The EPS layer in UE1 obtains the ProSe discovery radio resource
information. When the UE1 is out of coverage it obtains this information from
static configuration. When the UE1 is in EUTRAN coverage it obtains this
information from the network. The details are FFS.
11\. The EPS layer in UE1 monitors the broadcasts ProSe discovery signalling
including the ProSe ID2.
12\. The EPS layer in UE1 reports to the application indicated in step 1,
including the ProSe ID2.
#### 6.1.8.3 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.1.9 Solution D9: Proximity service Architecture using PDCF
#### 6.1.9.1 Architecture reference model
Figure 6.1.9.1-1: Non-roaming architecture for Proximity-based service
Figure 6.1.9.1-2: Roaming architecture for Proximity-based service
A new network element PDCF is added into the EPS network. PDCF is the
Proximity Discovery and Communication control Functionality. It is connected
to the MME, UE and Application Server(s).
In non-roaming scenario, there is only one PDCF in the HPLMN associated with
one UE. In a roaming scenario there are two PDCFs associated with one UE.
\- H-PDCF that resides within the H-PLMN;
\- V-PDCF that resides within the V-PLMN.
The H-PDCF contains the subscriber/subscription data needed for ProSe service.
In the roaming case the subscriber\'s ProSe service data is given by the
H-PDCF to the V-PDCF via the SPb interface. Based on the visitor operator\'s
policy the V-PDCF may update the ProSe service data obtained from the HPLMN.
The UE\'s ProSe Discovery and Communication is controlled either by the H-PDCF
in non-roaming case or by the V-PDCR in the roaming case.
The PDCF include the following function:
\- ProSe Subscription data/subscription data management.
\- ProSe Service registration of the UE(e.g. ProSe UE ID assignment, ProSe
Service policy download to the UE).
\- EPC-level ProSe discovery authorization/ ProSe direct discovery
authorization(e.g. radio resource permission).
\- ProSe communication authorization.
\- ProSe Application server interaction for ProSe discovery ProSe Service
charging related functions.
Editor\'s note: It is for FFS whether the PDCF is map to one entity or several
entities.
For the ProSe service the below new reference points are added:
**PC1** : the reference point between the ProSe application in the UE and in
the application server. It is used to define application level signalling
requirements.
**PC2** : the reference point between the PDCF and Application server for
ProSe service usage.
**PC3** : the reference point between the PDCF and UE for the Registration,
ProSe Service control Policy control, ProSe Service Invoking.
**PC4** : the reference point between the PDCF and MME for authorization; It
is used for the ProSe service authorization, e.g. direct discovery radio
resource application permission control.
**PC5** : the reference point between the ProSe devices for ProSe direct
discovery and communication.
**PC7** : the reference point between the H-PDCF and V-PDCF for the ProSe
Service Data transferring from the HPLMN to the VPLMN. It is control plane
interface.
#### 6.1.9.2 Procedures
##### 6.1.9.2.1 ProSe registration
##### 6.1.9.2.1.1 General {#general-3 .H6}
This clause provides the solution for the key issues \"Key Issue #3:
Configuration and Capability Handling for ProSe\" and \"Key Issue #6:
Authorisation for ProSe capability feature\".
##### 6.1.9.2.1.2 ProSe UE registration {#prose-ue-registration .H6}
The flow for ProSe UE registration is depicted in Figure 6.1.9.2.1.2-1. ProSe
UE registration could be initiated when the UE activates ProSe Service but not
activate the ProSe enabled application.
Figure 6.1.9.2.1.2-1: ProSe UE registration in Roaming case
1\. The UE sends ProSe Registration request (IMSI) to the PDCF in Serving
PLMN. In the roaming case the PDCF is the V-PDCF.
Editor\'s note: the authentication and security assured communication between
UE and PDCF should be studied in SA WG3.
2\. The V-PDCF determines whether the UE is permitted to use the ProSe service
in the serving PLMN. If it is permitted and no valid ProSe UE context is
stored, the V-PDCF sends the ProSe UE context request (serving PLMN, IMSI) to
the H-PDCF.
3\. The H-PDCF sends back the ProSe UE context response (ProSe UE context).
The ProSe UE context includes the subscriber/subscription related data needed
for ProSe service. For the same user the H-PDCF may send different ProSe UE
context to V-PDCF depending on which PLMN UE is camped.
4\. The V-PDCF assigns a ProSe UE identity. The V-PDCF sends the ProSe
Registration response (ProSe UE identity, ProSe UE general context) back to
the UE. The ProSe UE general Context is only related to UE granularity ProSe
service control and not linked to any specific application ProSe service
control. The V-PDCF stores the IMSI, ProSe UE identity and the ProSe UE
context for late usage.
NOTE: The ProSe UE identity assigned to UE is not permanent.
5\. The UE stores the ProSe UE identity, ProSe UE general context.
##### 6.1.9.2.1.3 ProSe application registration {#prose-application-
registration .H6}
The ProSe application registration process take place in the following cases:
\- Combined with ProSe UE registration process.
\- A separated ProSe application registration process if one ProSe application
which requires ProSe service is activated on the UE.
\- A new ProSe UE identity has been assigned by the PDCF.
The flow depicted in the Figure 6.1.9.2.1.3-1 shows that the UE initiates
ProSe application registration process.
Figure 6.1.9.2.1.3-1: ProSe Application Registration
1\. It is assumed that UE has been registered to PDCF successfully. The UE
sends Application Registration Request (IMSI or ProSe UE identity, application
ID, application user identity, ProSe service to be activated) to the PDCF.
IMSI is used when the UE has not obtained the valid ProSe UE identity. In the
roaming case the PDCF is the V-PDCF.
2\. Based on the application ID the PDCF checks the ProSe UE context on
whether this application is authorized to use ProSe service. The PDCF sends
the ProSe Application Registration Requests (ProSe UE identity, application
user ID, ProSe service to be activated) to the Application Server. The ProSe
Service to be activated indicates on whether UE want to activate the discovery
service.
3\. The Application server recorded the mapping between the application user
ID and ProSe UE identity. The application server sends back the ProSe
Application Registration Response to the PDCF.
4\. The PDCF sends the Application Registration Response (ProSe UE Application
context). The ProSe UE Application context is related to application
granularity ProSe service control.
5\. The UE stores ProSe UE Application context.
##### 6.1.9.2.2 ProSe direct Discovery
##### 6.1.9.2.2.1 General description {#general-description-11 .H6}
The solutions in this clause are to address the key issue \"ProSe direct
Discovery\".
##### 6.1.9.2.2.2 UE triggered ProSe direct Discovery procedure {#ue-
triggered-prose-direct-discovery-procedure .H6}
For the ProSe direct discovery it includes two types of UE, i.e. the
announcing UE and monitoring UE.
**Announcing UE**
Assumption: for the application on the announcing UE, the announcing code that
is broadcasted in the radio interface is allocated by the network and the UE
stores the announcing code.
The procedure for ProSe announcing UE includes follow steps:
1\. The ProSe-enabled application XY on the announcing UE requests the access
network layer of the UE to announce the application;
2\. The access network layer of the UE applies the radio resource for ProSe
announcement.
3\. The access network layer of the UE broadcast the announcing code which can
identify the related application.
For the step 2) radio resource application there are two options.
Editor\'s note: Based on the outcome of RAN selection, one of these options
will be adopted.
Option A) The RAN only indicates the available radio resources for ProSe
announcement. The permitted announcing UE contend with each other for the
available radio resource for announcement. In this case, the UE is authorized
to use the radio resource via the ProSe registration procedure.
Option B) The UE needs to request from the network to allocate radio resources
before it performs the announcement. In this case the RAN may also indicate
the radio resources for ProSe announcement. The monitoring UE can discover the
announcing UEs in its vicinity by monitoring that radio resource.
The detail procedure for option B) is depicted as follows:
Figure 6.1.9.2.2.2-1: ProSe announcing procedure
1\. The ProSe enabled application XY in the UE decides to request ProSe
service . It sends the ProSe Announcing req including a NAS message (ProSe UE
ID, application ID, Requested Range class, application user ID and announcing
code) to the eNB.
Editor\'s note: It is FFS that what\'s the granularity of the radio resource
used for announcing, for example, whether the UEs need to request for new
radio resource when they move to a new cell.
NOTE: The communication between the MME and the PDCF is only in control plane.
2\. The eNB sends a ProSe Announcement Req to the MME.
3\. Based on the ProSe UE ID, the MME select the PDCF and delivers the
Announcement Auth Req(ProSe UE ID, application ID, Requested Range class) to
it.
4\. Based on the ProSe UE context stored in the PDCF, PDCF authorize the UE\'s
request (application ID, Authorized range class) for ProSe announcement.
5\. If the UE\'s announcing code is not included in step 1 or a new announcing
code is needed, the PDCF assigns a new announcing code to the UE. The
application server store the mapping mechanism between the announcing code and
the application ID/ application user ID.
6\. The PDCF sends the Announcement Auth Res(ProSe UE ID, announcing code,
application ID, Authorized range class) to the MME.
7\. When received the acknowledgement from the PDCF, the MME sends ProSe
Announcement Res with an indication which indicates the eNB to allocate the
announcing radio resource to the UE, a NAS message (Application ID, Announcing
code and Authorized range class information) is also included.
8\. The eNB allocates announcing radio resource for the UE according to the
indication.
9\. The eNB sends the ProSe announcing Res message (the allocated announcing
radio resource (announcing frequency, announcing periodicity etc.), and the
NAS message) to the UE.
10\. The UE start to announce the announcing code based on the allocated
announcing radio resource from the eNB. So it is capable to be discovered by
the monitoring UEs in the vicinity.
**Monitoring UE**
For the monitoring UE, there are two options.
Editor\'s note: Based on the outcome of RAN selection, one of these options
will be adopted.
Option A) The UE has obtained the related announcing code to be discovered. In
this case the UE only monitors if the related announcing code is received. If
it is received, then the discovering UE regards the destination UE is
discovered. The authorized range class is used to control how far the radio
signal can be detected.
Option B) The UE does not have a definite UE to be discovered. In this case
the discovering UE just monitors the received radio signal. Per the UE\'s
interest it may query the network to resolve the identity of a received
announcement code. The network may then return the related application layer
user ID to the UE, if it is authorized for this application. The detail
procedure for option B) is depicted as follows:
Figure 6.1.9.2.2.2-2: ProSe monitoring procedure
1\. The UE performs monitoring.
Editor\'s note: How the UE obtains the radio resource designated for
announcing UEs is FFS.
2\. The UE sends the ProSe Query Req (ProSe UE-A ID, Application user ID-A,
Announcing Codes) to the PDCF-A. The announcing codes reflect the identity
which the UE is interested and need the network to identify the related
Application layer user ID. For the roaming scenario, PDCF A resides in the
VPLMN. Application user ID-A is the application layer user ID of the UE-A.
3\. The PDCF-A check the authorization on whether UE-A is permitted to perform
monitoring.
4\. If UE-A is permitted to monitor, PDCF-A sends the ProSe UE ID query Req
(Announcing code) to the application server.
5\. The Application server send the ProSe UE ID query Res (ProSe UE-B ID) to
the PDCF-A.
6\. Based on the ProSe UE-B ID, PDCF-A send the ProSe discovery Req (UE-A
network layer ID, Application user ID-A, ProSe UE-B ID, announcing code,
Application ID) to the PDCF-B
7\. PDCF B verifies whether UE-B is authorized to be discovered.
8\. The PDCF-B send the App Discovery Req (ProSe UE-B ID, Application ID,
Application user ID-A, announcing code) to the application server.
9\. The application server sends the App Discovery Res (ProSe UE-B ID,
Application ID, announcing code, Application user ID-B) to the PDCF-B.
10\. The PDCF B sends the ProSe Discovery Res (UE-B Network layer ID,
Application user ID-B, announcing code, Application ID) to the PDCF-A.
11\. The PDCF-A sends ProSe Discovery response (Application ID, Application
user ID-B, announcing code) to the UE. If multiple announcing code is queried
in step 2, per announcing code multiple response is sent back to the UE.
##### 6.1.9.2.3 Network-triggered ProSe discovery Procedure
The procedure for network-triggered target ProSe discovery is depicted in
figure 6.1.9.2.3-1.
The procedure may be triggered when the UE decides the targeted UE(s) is close
enough to trigger the direct discovery, e.g. via the Application layer
notification or the EPC-level based discovery or UE implementation trigger. In
the procedure the ProSe announcing and monitoring operations are triggered and
controlled by the network.
Figure 6.1.9.2.3-1: Network-triggered ProSe discovery
1\. The application XY on the UE-A requires ProSe discovery, e.g. wants to be
informed whether his friends are in proximity. It sends the ProSe Service
Request message (Application layer user-A ID, the list of target Application
layer user IDs) to UE-A 3GPP layer.
2\. The UE-A 3GPP layer forwards the ProSe discovery Request to the PDCF-A.
The PDCF-A is the PDCF in the serving PLMN where the UE-A is camping.
3\. The PDCF-A checks whether the application of UE-A is allowed to use ProSe
discovery. Application Identity is used by PDCF to identify the application on
the UE. If the application is not allowed to perform ProSe discovery due to no
service agreement between the PDCF-A and application server, PDCF-A rejects
the ProSe discovery request.
4\. If the application is allowed to perform ProSe discovery, the PDCF-A
derives the address of the associated application server based on the
Application Identity and sends Authorization Request (ProSe UE-A identity,
Application layer user-A ID, list of target Application layer user IDs) to the
Application server. The application server may verify the correct application
layer user-A ID based on the received ProSe UE-A identity. Then the
application server sends back Authorization response to the PDCF-A. If the
application user A is permitted to discover application user B, the ProSe UE-B
identity is included in the response message.
NOTE 1: For simplicity only UE-B is shown in the following step.
5\. If the application user-A is permitted to discover application user B, the
PDCF-A sends Forward ProSe Discovery Request (ProSe UE-A identity, ProSe UE
identity of target UE-B) to PDCF-B. PDCF-A identifies PDCF B which serves UE_B
according to ProSe UE-B identity. The PDCF-B is the PDCF in the serving PLMN
where the UE-B is camping.
6\. The PDCF-B checks whether the UE-B is permitted to do the announcement. If
it is permitted, PDCF-B assigns one Announcing code to UE-B. The PDCF-B sends
the Proximity Ann Req (Announcing code) to be used for announcement by the
UE-B.
NOTE 2: The PDCF-B may check whether the UE-A is allowed to detect the
proximity of the UE-B, for example, based on the discovery preference of the
application XY on the UE-B.
7\. If the explicit end-user permission for being discovered is indicated, the
UE-B 3GPP layer may send a ProSe Service notification to the ProSe Application
XY. The UE-B ProSe application layer sends back its permission or rejection.
8\. The UE-B 3GPP layer broadcast the assigned ProSe Announcing code.
NOTE 3: Depending on Resource allocation model. Two types of resource
allocation procedure can be trigger as described in clause 6.1.9.2.2.2.
9\. The PDCF-B sends Forward Proximity request Ack (announcing code) to the
PDCF-A.
10\. The PDCF-A sends the ProSe Discovery Request Ack to the UE-A and the
announcing code of UE-B is also provided for UE-A monitoring.
11\. The UE-A 3GPP layer sends a Discovery Ack message to the UE-A ProSe
Application to notify that the discovery request is permitted in the network.
12\. The UE-A 3GPP layer monitors for the assigned announcing code(s).
13\. If the announcing code is found, the UE-A 3GPP layer sends a ProSe
Discovery Notice message to the network.
14\. The PDCF-A send a ProSe Discovery Response (Application Identity,
Application layer user-A ID, Application layer user-B ID) message to the UE-A
3GPP layer, if user-A is still authorized to discover user B for application
XY.
15\. The UE-A 3GPP layer forwards the message to the UE-A ProSe Application
layer that the proximity of Application layer user-B was detected.
16\. PDCF-A may notify the PDCF-B/UE-B of this discovery, which can be used to
stop the announcing (it can also be stopped via a Timer).
#### 6.1.9.4 Impact on existing entities and interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.1.9.5 Solution Evaluation
Editor\'s note: To be completed.
This solution requires interconnection between the PDCF in the Serving PLMN
and the ProSe Application servers the UE may be using.
### 6.1.10 Solution D10: ProSe System Architecture using ProSe Server
This solution is for the key issue #1: ProSe System Architecture.
#### 6.1.10.1 Architecture reference model
Figure 6.1.10.1-1 shows the general reference architecture for the Proximity-
based Services (ProSe) feature support in EPS.
Figure 6.1.10.1-1 Reference architecture model for the ProSe support in EPS
(non-roaming)
The ProSe Server is introduced to support the ProSe operations. It is a new
logical network entity in the EPC on the 3GPP control plane and implements the
following functionality of ProSe Function entity (see clause 4.3.1):
\- ProSe registration of the UE;
\- authorization of ProSe operations;
\- control;
\- charging related functions;
\- parameterization;
\- EPC-level ProSe discovery;
\- holding information about applications that are authorized by the operator
for the ProSe.
It is connected to the MME, ProSe Server(s) in other PLMNs and HSS when
applicable. The radio resource utilization and control are handled by the
E-UTRAN.
The ProSe entity in the UE is utilized for the ProSe operations of discovery
and communication. There can be only one ProSe entity in the UE. This ProSe
entity communicates with the ProSe Server on top of NAS signalling.
APP(s) is an entity at the UE representing the third party applications or
application instances in the UE designed for utilizing the proximity services.
There may be more than one APP utilizing the ProSe functionality at the same
time.
For the ProSe feature support usage of new reference points is as follows:
**PC1** : reference point between application instance in the UE and
application server;
**PC2** : reference point between ProSe Server and application server;
**PC3** : reference point between UE and ProSe Server for ProSe operation
related signalling. PC3 is a control plane interface in 3GPP domain.
Editor\'s note: The details of PC3 are FFS.
**PC4-1** : reference point between the ProSe Server and MME enables transfer
of ProSe related subscription information relevant within the corresponding
PLMN;
**PC4-2** : reference point between the ProSe Server and HSS enables transfer
of ProSe related subscription and authentication data for
authenticating/authorizing user access to the ProSe services. It\'s FFS if all
required information can be received from the MME via PC4_1;
**PC5** : reference point between the ProSe-enabled UEs for ProSe direct
discovery and communication.
**PC6** : reference point between the ProSe Servers of different PLMNs to
enable inter-PLMN ProSe discovery. PC6 may rely on existing S10 between
operators for transport.
**PC7** : reference point between the ProSe Server in VPLMN and HPLMN in
roaming case to fetch ProSe authorization data and settings from HPLMN. PC7
may rely on existing S10 between operators for transport.
Figure 6.1.10.1-2 shows the general reference architecture for the ProSe
support in EPS in case of roaming for home routed traffic scenario.
Figure 6.1.10.1-2: Reference architecture model for the ProSe support in EPS
in case of roaming, home routed traffic.
The ProSe entity in the UE and in the ProSe Server is a protocol layer which
provides the following services to upper layers.
\- registration for ProSe services;
\- enabling/disabling of discoverability;
\- discovery of ProSe Service User(s) in proximity;
\- enabling/disabling of direct communications.
The ProSe entity expects the following services from lower layers:
\- integrity protection and ciphering;
\- reliable and in-sequence delivery of information, with duplication
avoidance.
The ProSe Entity includes the following functions:
\- registration for ProSe services with the ProSe entity in the network;
\- discoverability;
\- discovery;
\- control information transfer.
##### 6.1.10.1.1 ProSe entity functions
##### 6.1.10.1.1.1 Registration {#registration-1 .H6}
The registration function includes:
\- authorization for use of ProSe services from the ProSe entity in the ProSe
Server; and
\- authorization for ProSe discovery;
\- authorization for direct communications;
\- authorization of the upper layer entity for the use of ProSe discovery
and/or ProSe discoverability.
##### 6.1.10.1.1.2 Discoverability {#discoverability .H6}
The discoverability function is offered to the upper layers through the
discoverability service. The function is used to make a registered upper layer
entity discoverable by peer upper layer entities registered for the discovery
in ProSe entities on other UEs. In the request for the discoverability
service, the upper layer indicates the type of discoverability: open or
restricted. If restricted discovery is requested, the upper layer shall also
provide permissions which peer upper layer entities are permitted or
prohibited to discover. EPS shall use the permission information to execute
the restrictions (This function may be available only if the discovery is
performed under the coverage).
The ProSe entity shall only notify the permitted upper layers about the peer
upper layer entity in proximity, see sub clause 6.1.10.1.1.3.
##### 6.1.10.1.1.3 Discovery {#discovery .H6}
From the ProSe entity point of view, the discovery function is finding out:
\- whether or not there is a peer ProSe entity on a UE in proximity; and
\- whether or not there is an upper layer registered for discoverability with
the ProSe services in the peer ProSe entity; and
\- whether or not the ProSe entity is permitted to discover the peer ProSe
entity (optional for UE/subscription level open/restricted discovery in 3GPP
internally); and
\- whether or not the ProSe entity has a upper layer registered for discovery
which should be notified about the proximity of the upper layer registered for
discoverability in the peer ProSe entity; and
\- whether or not the ProSe entity is permitted to indicate the proximity of
the upper layer (ProSe Entity User) registered for discoverability in the peer
ProSe entity to the upper layer (ProSe Entity User) registered for discovery
(the open/restricted discovery at the application layer).
At least two ProSe entities are involved in the discovery process:
\- a discovering ProSe entity; and
\- a discoverable ProSe entity.
The discovering ProSe entity performs the discovery upon the request from the
upper layers by:
\- optionally, sending a discovery request message to peer ProSe entities in
proximity so they transmit a discovery message;
\- the reception of a discovery message from a peer ProSe entity.
The discoverable ProSe entity can be configured to transmit a discovery
message:
\- upon reception of a discovery request message; and/or
\- periodically.
There are certain requirements on the discovery request message and the
discovery message:
1\. When the discoverable ProSe entity receives a discovery request message,
the ProSe entity shall be able to determine/verify whether the request has
been sent from a discovering ProSe entity which is authorized to discover the
discoverable ProSe entity. However, the discoverable ProSe entity shall be
able to discover the discovering ProSe entity only if this entity is also
discoverable to the discoverable ProSe entity.
2\. The system shall ensure that the discovery message can be correctly
interpreted only by the discovering ProSe entities which are authorized to
discover the discoverable ProSe entity.
##### 6.1.10.1.1.4 Control Information Transfer {#control-information-transfer
.H6}
The control information transfer includes functions for information transfer
between the ProSe entities in the UE and in the ProSe Server, and between the
peer ProSe entities in the UEs.
#### 6.1.10.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
#### 6.1.10.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.1.10.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.1.11 Solution D11: ProSe discovery using the architecture of solution 13
This solution covers the key issue #7: ProSe direct discovery.
#### 6.1.11.1 Functional description
##### 6.1.11.1.1 General description
The solution presented in this clause 6.1.11 allows the discovery of UEs and
of Application users by means of direct radio signals exchanged between UEs.
It articulates around the following principles:
\- The identity of an Application user is not disclosed outside the
Application.
\- The UE identities are not disclosed outside the 3GPP domain.
\- Application-level restrictions are enforced solely at the Application.
\- The discovery procedure articulates around a ProSe server (per PLMN) that
provides the functions required to support ProSe operation. Signalling between
the UE and ProSe server is assumed to take place on control plane.
##### 6.1.11.1.2 Principles of the solution
This solution uses layered approach:
**\- ProSe UE discovery** of ProSe-enabled UEs in proximity whereby a UE
discovers other ProSe-enabled UEs in proximity, provided ProSe is enabled and
authorized.
\- **Application-level discovery** of application users in proximity, enabled
by the discovery of UEs in proximity, provided the application is authorized
to use ProSe.
The discovery of a UE (respectively Application user) in proximity relies on
identifying the UE (respectively Application user). The proximity of
Application users relies on the proximity of underlying UEs: two Application
users are in proximity if their UEs are in proximity.
#### 6.1.11.2 Procedures
##### 6.1.11.2.1 Registration
Figure 6.1.11.2.1-1: Registration
1\. The UE registers to the ProSe server on the registered PLMN.
NOTE: for out-of-coverage operation this registration step does not take
place; the UE ought to be implicitly authorized and configured to use ProSe.
In this case it is also pre-configured with a dedicated UE identity.
Editor\'s note: Signalling between UE and ProSe Server relies on a control
plane signalling via MME. It\'s FFS whether the signalling is transparent to
MME or not.
Editor\'s note: ProSe Server in registered PLMN receives ProSe related
subscription data from HPLMN. The details of this information transfer are
FFS.
2\. The ProSe server determines that the UE is authorized for ProSe and
assigns a temporary ProSe UE ID to the UE. ProSe Server can re-allocate the
ProSe UE identifier whenever needed.
Editor\'s note: It is FFS if an existing 3GPP level UE identifier can be used
or a new identifier within the 3GPP domain is required.
As a result of 2 the UE is now allowed to use ProSe.
##### 6.1.11.2.2 Discoverability
The discoverability procedure is used by an application on the ProSe
registered UE to request an application layer discoverability from ProSe
server. The application shall provide a ProSe_App_User_ID to the UE.
The ProSe_App_User_ID may correspond to a user, a user group, etc. The
application should use an application-level mechanism to map the application
layer identity to ProSe_App_User_ID in such a way that the privacy and
confidentiality of the application layer identity is ensured.
Figure 6.1.11.2.2-1: Discoverability
1\. The application requests the UE that it wants to be discoverable by the
ProSe_App_User_ID. The request includes the App ID. As an alternative, the UE
itself determines the appropriate App ID (if App IDs are \"owned\" by the
operator).
Editor\'s note: It\'s FFS how the App ID is selected.
2\. The UE forwards the request from the application to the ProSe server,
including its ProSe UE ID, the application App ID and the ProSe_App_User_ID.
3\. The ProSe server determines using the received App ID that the application
is authorized to use ProSe. It creates an entry for this UE storing the
received App ID and ProSe_App_User_ID. The ProSe server indicates the entry
index corresponding to the {App ID; ProSe_App_User_ID} pair for this UE,
within the acknowledgement to the UE. This index value is later used in the
discovery phase together with the ProSe UE ID. Comparatively to expression
code allocation in clause 6.2.2, the ProSe server allocates the value (here
index value for the UE) for the application user within certain application
but here the value is associated with the ProSe UE ID to form a complete
announcing information. It is to be noted that multiple indices, corresponding
to multiple application users being discoverable, can be associated to the
ProSe UE ID in the announcing phase.
4\. The UE confirms the successful completion of the discoverability procedure
to the application.
The application user is now discoverable using ProSe, according to the
restrictions enforced at the application and possibly by the operator.
##### 6.1.11.2.3 Discovery
The discovery procedure is used by a discovering UE (respectively application
user) to request a discovery of a discoverable UE (respectively application
user) and, after ProSe server confirms the discovery is allowed, to perform
the discovery. The prerequisites for the discovery procedures are:
\- UE1 and UE2 are successfully registered to the ProSe Server; and
\- The application on UE2 completed the discoverability procedure using App
ID1 and ProSe_App_User_ID2 successfully; and
\- ProSe_App_User_ID2 is available to the application (App ID1) on UE1 via
application specific mechanisms.
Figure 6.1.11.2.3-1: Discovery using UE identifier and Application user index
1\. App1 on UE1 requests UE1 to be able to discover ProSe_App_User_ID2 by
means of ProSe.
2\. UE1 determines it holds no UE identity record for {App ID1;
ProSe_App_User_ID2} and therefore requests for it from the ProSe Server. The
ProSe server creates a UE relationship recording that UE1 (ProSe UE ID1) is
interested in UE2 (ProSe UE ID2) given the interest for {App ID1,
ProSe_App_User_ID2}. Optionally, the ProSe server can also validate whether
UE1 is authorized to discover { App ID1, ProSe_App_User_ID2} on UE2.
3\. The ProSe server retrieves ProSe UE ID2 based on the {App ID1;
ProSe_App_User_ID2} received from UE1, as well as the Entry index (\"1\") of
{App ID1; ProSe_App_User_ID2} for ProSe UE ID2. The ProSe server responds back
to UE1 indicating ProSe UE ID2 and the index \"1\".
UE1 is now able to discover the proximity specifically of {App ID1;
ProSe_App_User_ID2} by monitoring the occurrence of ProSe UE ID2 together with
index \"1\" on the radio resources assigned for ProSe discovery. Exact means
for the allocation are to be done by RAN WGs.
4\. Application user at app1 in UE2 requests to be discovered and issues a
request to be discovered to UE2, indicating the ProSe_App_User_ID2.
5\. Upon receipt of the REQ DiscoverMe from App 1, UE2 sends a DiscoverMe
signal on the radio resources assigned for ProSe discovery., indicating its
ProSe UE ID2 as well as the index value (\"1\") corresponding to {App ID1,
ProSe_App_User_ID2}.
6\. UE1 receives a discovery signal containing ProSe UE ID2) and index value
\"1\". UE1 determines it holds a record for ProSe UE ID2, and thereafter also
determines the index value received (\"1\") matches a recorded index it holds
for ProSe UE ID2. Matching the ProSe UE ID and index value, UE1 retrieves the
record {App ID1, ProSe_App_User_ID2}. It then notifies App 1 (App ID1) it has
discovered ProSe_App_User_ID2.
Editor\'s note: Support for inter-PLMN discovery is FFS.
NOTE: Any change in a ProSe UE identifier of a given UE must be communicated
to all UEs interested in this UE. The ProSe server maintaining the list of
which UEs are interested in which UEs provides means for the ProSe server to
inform the needed UEs whenever required. Moreover, the ProSe server can
enforce operator control as per the stage 1 requirement \"The permission to be
discoverable is given by the user and shall be executed by the EPS, subject to
operator control, on a per-application basis.\" (see TS 22.278 [3]).
Editor\'s note: It\'s FFS how the ProSe Server enforces the operator control.
#### 6.1.11.3 Impact on existing entities and interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.1.11.4 Solution evaluation
Editor\'s note: To be completed.
### 6.1.12 Solution D12: Network assisted ProSe discovery
#### 6.1.12.1 Functional description
In this solution two phases ProSe discovery solution is proposed by taking
into account both of EPC-level ProSe discovery and ProSe direct discovery. The
EPC-level ProSe discovery provides the coarse geographical location
information of a ProSe-enabled UE, while direct discovery ensures the radio
link between ProSe peers are feasible. The proximity determination for two UEs
is in terms of geographical location and the radio link feasibility.
For a UE in E-UTRAN coverage, the network can perform proximity detection on
registered UEs requesting for ProSe service. The purpose of first phase EPC-
level discovery procedure is for a ProSe server to obtain the location
information of a registered UE in coarse granularities, e.g. EGCI, where EGCI
is a global unique identifier. Based on the same EGCI value of two UEs in ECM-
CONNECTED state, the ProSe server knows two UEs are located in the same cell
and served by the same eNB. The ProSe server can take the EGCI value as
proximity criterion for determining the proximity of two UEs registered for
Proximity service. The estimation of proximity accuracy of two UEs based on a
cell ID depends on the cell size, which might vary from 100 meters to several
kilometres. Further, for two UEs in proximity served by different serving cell
with the same or different eNB, ProSe communication is also possible if the
ProSe server is with the information that two cells are neighbouring cells.
Editor\'s note: It is FFS if finer granularity of the location information can
be provided by an eNB as proximity criterion in a ProSe server.
Editor\'s note: It is FFS how to determine proximity of two UEs served by
different eNBs.
Based on received location information by EPC-level ProSe discovery mechanism
in the first phase, the network can determine if initiating one-to-one ProSe
communication between two interested and discovered UEs in proximity. Before
starting to establish radio bearers and scheduling radio resource for ProSe
communication between two UEs in proximity, in the second phase the eNB can
initiate direct radio discovery between two UEs attempting for ProSe
communication. This is to ensure that the ProSe communication between two
proximity UEs can be applied with good radio signal quality and would not
generate much interference to adjacent UEs.
#### 6.1.12.2 Procedures
In this procedure, a target discovery is taken as an example and assumed. For
non-target discovery, the network-assisted ProSe discovery can still be
applied for a discovered ProSe-enabled UE if meeting proximity criteria and
considered as a target ProSe-enabled UE. The detail procedure for non-roaming
case is as follows:
Figure 6.1.12.2-1: Network assisted ProSe discovery and ProSe communication
setup procedure
1\. A UE registers for ProSe to EPC and the ProSe application user registers
to Application server. This step includes both ProSe UE registration procedure
and ProSe application user registration procedure, which is dependent on
system architecture and not in the scope of this solution.
2\. The discoverability confirmation procedure is performed to check the
discoverability of the indicated application users. The following steps
continue if the discoverability between two users are confirmed.
3\. When receiving discovery request and determining discoverability between
two users, the ProSe server-A sends Location report Request message to trigger
the location report procedure towards the serving MME and eNodeB of the UE-A
in ECM-Connected mode. The detailed procedure of location report procedure is
as indicated in clause 5.9.1 of TS 23.401 [11]. To identify the UE-A indicated
by ProSe UE-A ID from the ProSe server for registering location report, the
MME needs to retrieve the corresponding ProSe ID from the HSS or store mapping
table between ProSe ID and the IMSI/GUTI of the UE-A.
4\. When the eNB detects the cell change of a UE, e.g. UE-A, being monitored,
the eNB indicates the changes of the ECGI+TAI information in the Location
report message to the UE-A\'s serving MME and in turn the MME sends a Location
report message to the ProSe server indicating the new ECGI+TAI information for
UE-A.
5\. When the ProSe server obtains location information of UE-B, the ProSe
server determines if UE-A and UE-B are in proximity based on the following
proximity criteria, e.g. serving cells, eNB, and MME. Then the ProSe server
authorizes ProSe communication for both UEs. In roaming case that UE-A and
UE-B are registered by different ProSe servers, this step depends on system
architecture and is not within the scope of this solution. In the following
steps it is assumed that the UE-A and UE-B are served by the same cell and
eNB, i.e. ECGI is the same.
6\. The ProSe server sends a ProSe communication request message to the
serving MME of the UEs for initiating ProSe communication between UE-A and
UE-B. In the ProSe communication request message, the ProSe server can provide
UE discovery profiles of UE-A and UE-B to the serving MME, where the UE
discovery profile contains UE discovery range class, discovery codes for
user-A and user-B, monitoring and/or announcing role in discovery for UE-A and
UE-B. Notice that user discovery range class can be determined by the ProSe
server based on the maximum UE range class of UE-A and UE-B as well as the
user range class of user-A and user-B.
7\. The MME sends an S1-AP message including UE discovery profiles of UE-A and
UE-B to the serving eNB of the UEs for initiating ProSe communication
preparation procedure before setting up a direct communication path between
UE-A and UE-B.
8\. The eNB initiates ProSe communication preparation procedure towards UE-A
and UE-B by scheduling radio frequency, transmission power (based on UE range
class information), and uplink/downlink radio resource of
announcing/monitoring UEs for guiding ProSe direct discovery between UE-A and
UE-B. Noticeably, the eNB may refer to UE discovery profiles of UE-A and UE-B
to determine the announcing/monitoring UEs as indicated in step 3.
Editor\'s note: This step requires further study in RAN WGs.
Editor\'s note: It is FFS for RAN WG investigating this step for two UEs
served by different eNBs.
9\. If the eNB determines that the direct radio link between both UEs is
feasible for ProSe communication, it sends an S1-AP message to inform the MME.
If the result of the ProSe direct discovery is negative for applying ProSe
one-to-one communication between UE-A and UE-B, the eNB may determine to
initiate local path routing via eNB for communication between UE-A and UE-B.
Otherwise, the eNB reports results providing the failure cause back to the
MME.
10\. In response to request message received in step 9, the MME returns the
ProSe communication response message indicating the result of ProSe
communication back to the ProSe server. If failed to setup ProSe
communication, an appropriate cause value is also indicated. According to the
result, the ProSe server would deactivate the location report instance towards
MME or retain the location report instance on the MME/eNB.
11\. The MME initiates ProSe communication setup procedure if receiving a
positive response for ProSe direct communication from the eNB. The MME sends
parallel Bearer Setup Request message to the eNB for each UE to establish
dedicated EPS bearer as direct bearer between two UEs, in which the detail
procedure of dedicate bearer activation is as indicated in clause 5.4.1 of TS
23.401 [11].
Additionally, the MME creates and stores a correlation ID that correlates two
EPS bearer Identifiers for UE-A and UE-B and provides the correlation ID to
the eNB in the Bearer Setup Request message. The eNB stores the correlation ID
and the mapping table between the correlation ID and EPS bearer IDs. The
correlation ID is used by the eNB to identify the associated EPS radio bearers
for ProSe one-to-one direct communication path when scheduling data radio
bearers between two UEs. The correlation ID is also provided to the UE so that
UE can correlate the EPS bearer ID with the ProSe direct communication path to
the target UE.
Editor\'s note: This step requires further study in RAN WG.
12\. The user-A and user-B communicates each other via ProSe communication
path between UE-A and UE-B, and the radio resource is managed by the serving
eNB.
#### 6.1.12.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.1.12.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.1.13 Solution D13: Network controlled ProSe discovery service
#### 6.1.13.1 Functional description
##### 6.1.13.1.1 General
The solution described in this clause allows the discovery of applications in
proximity by means of direct radio signalling exchanged between UEs.
It is based on the principle that the bit-streams announced and monitored over
the radio interface are meaningless for the announcing/monitoring ProSe
enabled UEs, if such UEs do not receive proper network support. There is a
complete separation between the identifiers and the semantics used at the
application layer and the bit-streams transmitted at ProSe layer over the air;
in fact, the results of the discovery process are first elaborated by the
network and then sent to interested applications that reside on the UEs.
##### 6.1.13.1.2 Architecture reference model
Figure 6.1.13.1.2-1: Non-roaming architecture for Proximity services
The ProSe Server is introduced to support the ProSe operations. It is
connected to the HSS, MME, UE, service platforms and ProSe Server(s) in other
PLMNs.
In non-roaming scenario, there is only one ProSe Server in the HPLMN
associated with one UE (Serving ProSe Server). The Serving ProSe Server may
interact with one or more ProSe Servers of the HPLMN or of other PLMN(s) to
offer the ProSe discovery service.
Figure 6.1.13.1.2-2: Roaming architecture for Proximity-based Services
In a roaming scenario there are two ProSe Servers associated with one UE:
\- Home ProSe Server that resides within the HPLMN (Serving ProSe Server);
\- Visited ProSe Server that resides within the VPLMN.
For the ProSe discovery service the below new reference points are added:
**PC1** : Reference point between an application in the UE and the service
platform. It is used for application level signalling.
**PC2** : Reference point between Serving ProSe Server and a service platform.
NOTE: When the service platform is not operated by the operator, the
connectivity across the reference point PC2 is configured within a commercial
agreement between the operator and the service provider.
Editor\'s note: How the service provider and the operator exchange mutual
authentication over PC2 is FFS.
**PC3** : Reference point between a non-roaming UE and Serving ProSe Server.
**PC4** : Reference point between MME and ProSe Server.
**PC4a** : Reference point between ProSe Server and HSS.
**PC5** : Reference point between ProSe devices.
**PC6** : Reference point between Serving ProSe Server and ProSe Servers of
different PLMNs to enable inter-PLMN ProSe discovery.
**PC6a** : Reference point between Serving ProSe Server and other ProSe
Servers in the HPLMN.
**PC7** : Reference point between the Home ProSe Server (Serving ProSe Server)
in the HPLMN and the Visited ProSe Server in the VPLMN for the roaming
scenario.
**PC8** : Reference point between a roaming UE and Serving ProSe Server.
The radio resource allocation and control are handled by the E-UTRAN.
#### 6.1.13.2 Subscription of ProSe discovery service
When the user subscribes the ProSe discovery service a correspondent entry is
inserted in the user\'s profile in the HSS, to give the user permission to use
the ProSe discovery service. Additional parameters related to the ProSe
discovery service are stored in the user profile, e.g. whether the user is
authorized to Inter-PLMN discovery or not, etc.
The operator can bar at any time the ProSe entry of the user\'s profile in the
HSS, to revoke the user permission to use the ProSe discovery service.
#### 6.1.13.3 ProSe User Context creation
The ProSe enabled UE is equipped with a ProSe client.
When the ProSe client is started, it makes an authenticated access to the
Serving ProSe Server using the PC3 or PC8 reference point (depending on
roaming condition).
The first time the ProSe client connects to the Serving ProSe Server an empty
permanent ProSe User Context, that will store the ProSe discovery user\'s
preferences, is created and labelled with the user IMSI retrieved during the
authentication procedure.
After the first successful authenticated access of the ProSe client to the
ProSe User Context, the Serving ProSe Server asks the HSS to store its address
into the user\'s profile and retrieves from the user profile all the
subscription parameters relevant for the service, e.g. whether the user is
authorized to Inter-PLMN discovery or not, etc.
NOTE: The Serving ProSe Server is configured by the Operator with the lists of
the PLMNs that the users are allowed to monitor when registered in a given
PLMN.
Editor\'s note: The definition of the mechanism to make an authenticated
access (e.g. EAP-AKA, GBA security, etc.) to the Serving ProSe Server using
the PC3 or PC8 reference point and retrieve the IMSI is under the SA WG3
responsibility.
#### 6.1.13.4 Configuration of the ProSe discovery user\'s preferences
##### 6.1.13.4.1 General
The ProSe user\'s preferences are stored in the ProSe User Context.
The user connected to the Serving ProSe Server (by means of the ProSe client)
interacts with a dashboard that presents his/her ProSe User Context (at the
beginning empty) and the directory of all the available services. The user may
populate his/her ProSe User Context by choosing a service from the directory,
adding it as new entry into his/her ProSe User Context and configuring some
local parameters such as the discovery range class or the role of the ProSe
enabled UE (announcing/monitoring), as described in clause 6.1.13.4.3. The
user may add/remove at any time an entry into the ProSe User Context and/or
modify the local parameters for each entry in the ProSe User Context.
The configuration of the discovery criteria for a given service is made
instead directly on the service platform, according to a logic provided by the
service provider (e.g., who can discover me, who I want discover, etc.). Upon
successful completion of the service level configuration of the discovery
criteria, the service platform allocates to the user an Application User
Identifier (App_User_ID) that the user shall write down. Subsequently, the
user may modify at any time his/her service level configuration of the
discovery criteria on the service platform.
NOTE 1: How the user makes access to a service platform is out of the scope of
3GPP.
NOTE 2: The discovery criteria configured according to a logic provided by the
service provider allow for both restricted and open discovery.
NOTE 3: The App_User_ID is allocated only the first time the user configures
his/her discovery criteria on the service platform. The App_User_ID, while
unique within a given service platform/application, may not be unique across
different service platforms/applications therefore it is always coupled within
the EPS with an Application Identifier (App_ID).
NOTE 4: The App_User_ID is used to hide/protect the application level user
identity from the EPS whilst still unambiguously identifying the user within a
given application. For example, the 3GPP operator never knows the Facebook
username of a certain user that is asking to use the ProSe discovery service,
but just his/her App_User_ID (i.e. an identifier, different from the Facebook
identity, that has been allocated to that user when he/she has successfully
completed the configuration of the discovery criteria on the Facebook server).
##### 6.1.13.4.2 Services
The available services listed in the directory on the ProSe Server are
provided by service platforms that may be owned and managed by the operator or
by 3rd party service providers. The allowed 3rd party services are those for
which there is a commercial agreement between the operator and a 3rd party
service provider (e.g. social networks, commercial services, etc.).
Each service is identified by an Application Identifier (App_ID). Each App_ID
is globally unique and unambiguously identifies a service across the 3GPP
PLMNs.
> NOTE 1: Some business services may be effectively described by a data
> structure; an example could be a tree data structure characterized by
> different levels/tiers e.g., broad-level business category (tier0) /
> business sub-category (tier1) / business name (tier2) / shop ID (tier3).
> Each node of the tree has associated a different App_ID that is built
> appending a new piece of identifier (specific to that node) to the App_ID
> inherited by the predecessor node: this allows partial matching at the UE
> side reflecting application-specified interests, making more effective and
> flexible the filtering of the received ProSe_Codes in a monitoring UE.
>
> NOTE 2: The App_ID\'s namespace is maintained by a public register
> authority, e.g. as in clause F.1.2.
It is well known that each application on a UE has associated an Operating
System specific Application Identifier (OSApp_ID) that uniquely identifies the
application itself. In order to make the ProSe procedures independent from the
dependency of the different Operating Systems, all the OSApp_IDs that identify
the same application running on different UEs under different Operating
Systems are mapped into a single 3gppApp_ID.
NOTE 3: The 3gpp App_ID\'s namespace is maintained by 3GPP.
##### 6.1.13.4.3 ProSe configuration
The user, connected to the Serving ProSe Server (by means of the ProSe
client), that wants to add a service of interest as a new entry into his/her
ProSe User Context is asked if already owns his/her App_User_ID for that
service:
1\. If the user already has his/her App_User_ID for that service, means that
he/she has already configured the discovery criteria at the application level
and therefore:
a. The user is asked to insert his/her App_User_ID.
NOTE 1: When the service platform is owned and managed by the operator, the
configuration of the proximity criteria, the retrieval of the App_User_ID and
the addition of the service of interest as a new entry into the ProSe User
Context may be completed in a single step, facilitating in such a way the
procedure for the user.
NOTE 2: If the App_User_ID is not inserted, the configuration procedure for
that service is aborted and the corresponding new entry into the ProSe User
Context is not added.
b. The user selects the discovery range class for the service, if available.
NOTE 3: The discovery range class for a service may have been defined by the
operator or may have been agreed between the operator and the service provider
within the commercial agreement.
c. The user selects whether he/she wants his/her UE to act as an \"announcing
UE\", or as a \"monitoring UE\", or both.
All the configured data are stored within the new entry into his/her ProSe
User Context, next to the App_ID and the 3gppApp_ID of the selected service.
2\. If the user has not yet obtained his/her App_User_ID for that service, is
informed that he/she should first get his/her App_User_ID by completing the
configuration of the discovery criteria at the application level on the
service platform.
#### 6.1.13.5 ProSe_Code
The ProSe_Code is the bit-stream that is actually announced/monitored on the
radio interface by a UE engaged in the ProSe discovery procedure.
Each ProSe_Code is composed of the following parts:
i. A PLMN specific part, i.e. Mobile Country Code (MCC) and Mobile Network
Code (MNC), and
ii. the ProSe_Server_ID of ProSe Server that has allocated the ProSe_Code, and
iii. a temporary UE identifier (unique within the ProSe Server that has
allocated the ProSe_Code), and
iv. the App_ID.
NOTE 1: Even though the App_ID is announced over the air as a part of the
ProSe_Code, the user\'s privacy is not threatened because the user\'s identity
remains hidden behind the ProSe_Code.
A ProSe_Code is allocated per UE and per application.
A ProSe_Code may have an associated validity timer that runs both in ProSe
Server and in the UE.
The ProSe Server removes a ProSe Code from the ProSe User Context upon expiry
of the associated validity timer.
The EPS layer in the UE is authorized to announce a ProSe_Code until the
associated validity timer expires; after that a new ProSe_Start_Discovery_Req
shall be issued.
NOTE 2: Even if it happens that a UE continues to broadcast a ProSe_Code even
after the associated validity timer has expired, the ProSe Server will no
longer be able to recognize that ProSe_Code, and therefore the ProSe discovery
service will not be provided.
The ProSe Server may decide at any time to replace a previously allocated
ProSe_Code providing the UE with a new ProSe_Code, where the temporary UE
specific identifier is changed. Replacing a ProSe_Code resets the
corresponding validity timer both in the ProSe Server and in the UE.
#### 6.1.13.6 ProSe discovery procedures (non-roaming)
##### 6.1.13.6.1 Start ProSe discovery procedure
Figure 6.1.13.6-1: Start ProSe discovery procedure
1\. When the user wants to discover one or more buddies for one or more
services, he/she launches the corresponding application(s) on the UE and
activates the ProSe discovery service within the application(s).
2\. Each application, identified by its OSApp_ID, send a request to the EPS
layer in the UE to start using ProSe discovery.
3\. Upon receiving the request(s) from the application(s), the EPS layer in
the UE sends a ProSe_Start_Discovery_Req NAS signalling to the MME, containing
the OSApp_ID(s) of the application(s).
NOTE 1: The UE may include in a single ProSe_Start_Discovery_Req message one
or more OSApp_ID(s), depending on the number of the requesting applications.
4\. If the address of the Serving ProSe Server is not present in the UE MM
context in the MME, then the MME queries the HSS to check whether the user is
authorized to the ProSe discovery service. If the address of the Serving ProSe
Server is present in the UE MM context in the MME, then step 5. is not
executed.
NOTE 2: Authorization criteria are defined by the mobile network operator.
5\. If the user has subscribed the ProSe discovery service and other
authorization criteria are met, the HSS acknowledges the MME query sending
back the address of the Serving ProSe Server where is stored the ProSe User
Context of the user.
6\. The MME adds the IMSI of the user to the ProSe_Start_Discovery_Req and
forwards it to the Serving ProSe Server.
7\. The Serving ProSe Server finds the correct ProSe User Context, using the
IMSI as a keyword. If the UE is allowed to act as an \"announcing UE\" for
some of the received OSApp_ID(s) (mapped in the corresponding 3gppApp_ID) and
if there are not any operational reasons that prevent providing the ProSe
discovery service (e.g., the number of ProSe_Codes in the ProSe User Context
exceeds the maximum allowed by operator policies), the ProSe Server:
a. allocates one or more ProSe_Code(s) for each received 3gppApp_ID according
to the entries in the ProSe User Context, and
b. starts a validity timer associated to each allocated ProSe_Code, and
c. stores the allocated ProSe_Code(s) into the ProSe User Context, and
d. keeps track of each App_ID to which a ProSe_Code has been allocated for
accounting reasons.
NOTE 3: If for any reason the allocation of a ProSe_Code is rejected an error
message with a cause value is generated and delivered to the UE.
8\. The Serving ProSe Server stores the MME address and sends a
ProSe_Start_Discovery_Ack message to the MME. The ProSe_Start_Discovery_Ack
message contains:
a. the command to start monitoring, if the UE is allowed to act as a
\"monitoring\" UE, including the list of the App_ID(s) that UE is allowed to
monitor (also the corresponding OSApp_ID(s) is(are) sent), or
b. the command to start announcing one or more ProSe_Code(s), each of them
associated with the indication of the discovery range class and the validity
timer, if the UE is allowed to act as an \"announcing UE\", or
c. both.
If the user is authorized to the Inter-PLMN ProSe discovery, then a list of
PLMNs that can be monitored in the registered PLMN is also included.
NOTE 4: The Serving ProSe Server is updated with the address of the current
serving MME whenever the MME is relocated within the PLMN. When S1-based
handover takes place within the PLMN, the source MME provides the target MME
with the address of the ProSe Server: the information is included within the
UE MM context in the MME that is included within the Forward Relocation
Request message. When an Inter-PLMN handover occurs the procedure described in
clause 6.1.13.7 applies and the UE shall issue a new
ProSe_Start_Discovery_Req.
9\. Upon receiving the ProSe_Start_Discovery_Ack message, the MME stores the
address of the Serving ProSe Server in the UE MM context. Based on the
ProSe_Start_Discovery_Ack message the MME sends an indication to the eNB to
provide the UE with the radio resources for ProSe; the
ProSe_Start_Discovery_Ack NAS message to be forwarded to the UE is also
included.
10\. The eNB sends the ProSe_Res message (with the indication of the radio
resource to be used for ProSe).
Editor\'s note: How to provide the UE with the radio resources for ProSe
direct discovery will be defined in RAN WGs.
11\. The eNB forwards the ProSe_Start_Discovery_Ack NAS message to the EPS
layer in the UE. The EPS layer in the UE stores locally the received App_ID(s)
and the mapping between the OSApp_ID(s) and the App_ID(s). The EPS layer in
the UE stores locally also the received ProSe_Code(s), if any. Based on the
commands in the ProSe_Start_Discovery_Ack message, the EPS layer in the UE
starts monitoring and/or announcing each received ProSe_Code, according to the
corresponding discovery range class, until the associated validity timer
expires.
12\. The EPS layer in the UE notifies the application(s) that has(have)
requested the service that ProSe discovery has started.
NOTE 5: The list of the App_ID(s) is stored and used by the EPS layer in the
monitoring UE to filter out the listened ProSe_Code(s) not matching with the
applications of interest the UE is allowed to monitor.
##### 6.1.13.6.2 ProSe monitoring procedure
Figure 6.1.13.6-2: ProSe Monitoring procedure
Assumption: The application is running on the UE as per step 1. in clause
6.1.13.6.1.
1\. When EPS layer in the monitoring UE \"listens\" a ProSe_Code, it applies a
filter to find a match between the App_ID part of the ProSe_Code and one of
the App_ID(s) stored locally: if the match is found the ProSe_Code is kept
because potentially of interest, otherwise it is discarded. The EPS layer in
the monitoring UE sends the collected ProSe_Code(s), for which the match is
found, in a single ProSe_Discovery_Req NAS message to the MME.
NOTE 1: The ProSe_Discovery_Req NAS message may be sent out as soon one or
more ProSe_Code(s) have been received or periodically in order to reduce the
burden of NAS signalling.
Editor\'s note: The optimum frequency for UE sending the ProSe_Discovery_Req
NAS message can be determined in Stage 3 activity (or even left as a UE
parameter configurable by the manufacturer or by the operator) as the best
trade-off between the quickness in recognizing proximity events of interest
and the corresponding signalling load.
2\. The MME forwards the ProSe_Discovery_Req message to the Serving ProSe
Server (the address of the Serving ProSe Server is retrieved from the UE MM
context in the MME), adding the IMSI of the user.
3\. The Serving ProSe Server sends a ProSe_Discovery_Req_Ack to the MME.
4\. The MME sends a ProSe_Discovery_Req_Ack to the UE.
5\. The Serving ProSe Server identifies the ProSe User Context of the user
(discoverer) using the IMSI, and analyzes each ProSe_Code in the
ProSe_Discovery_Req:
a. if the PLMN specific part (MCC, MNC) of the ProSe_Code belongs to the same
PLMN of the Serving ProSe Server, then the Serving ProSe Server looks at the
ProSe_Server_ID to determine which ProSe Server has allocated that ProSe_Code:
i. if the ProSe_Server_ID belongs to the Serving ProSe Server, then the
Serving ProSe Server identifies the ProSe User Context of the corresponding
discoveree using the ProSe_Code as a keyword, and retrieves the corresponding
App_User_ID.
ii. if the ProSe_Server_ID belongs to a different ProSe Server (hereafter
called Target ProSe Server), then the Serving ProSe Server sends to the Target
ProSe Server a ProSe_Query(ProSe_Code). The Target ProSe Server identifies the
ProSe User Context of the corresponding discoveree using the ProSe_Code as a
keyword, retrieves the corresponding App_User_ID and sends back to the Serving
ProSe Server a ProSe_Answer(ProSe_Code, App_User_ID) message.
b. if the PLMN specific part (MCC, MNC) of the ProSe_Code belongs to a PLMN
different from that of the Serving ProSe Server, then the Serving ProSe Server
sends to the Target ProSe Server a ProSe_Query(ProSe_Code). The Target ProSe
Server identifies the ProSe User Context of the corresponding discoveree using
the ProSe_Code as a keyword, retrieves the corresponding App_User_ID and sends
back to the Serving ProSe Server a ProSe_Answer(ProSe_Code, App_User_ID)
message.
6\. The Serving ProSe Server collects all the App_User_ID(s) corresponding to
the ProSe_Code(s) received in the ProSe_Discovery_Req and sends a ProSe_Eval
message to the service platform across the PC2 reference point, containing:
a. the (App_User_ID) of the discoverer, and
b. the (App_User_ID1, App_User_ID2 , ... , App_User_IDi) of the potential
discoveree(s).
7\. The service platform acknowledges the Serving ProSe Server with a
ProSe_Eval_Ack message.
8\. The service platform checks possible matches according the discovery
criteria configured by the users (e.g., who can discover me, who I want
discover, etc.). If one or more matches are found the service platform reports
the successful discovery results within the corresponding application running
on the UE of the discoverer.
NOTE 2: The notification of a successful discovery result may contain
additional information, e.g. to facilitate the setup of a communication (e.g.,
voice call, SMS, chat, etc.) between discoverer and discoveree,
advertisements, etc.
##### 6.1.13.6.3 User initiated stop ProSe discovery procedure
1\. A notification is received at the EPS layer in the UE when the user has
finished to use the ProSe discovery service within an application or when the
user shuts down an application that is using the ProSe discovery service.
2\. The EPS layer in the UE sends a ProSe_End_Discovery message to the MME.
The ProSe_End_Discovery message contains the App_ID of the service previously
engaged in ProSe discovery service.
3\. The MME sends the ProSe_End_Discovery message to the Serving ProSe Server.
4\. The Serving ProSe Server keeps track of the change for accounting reasons.
5\. The Serving ProSe Server sends back to the MME a ProSe_End_Discovery_Ack
message.
6\. The MME forwards the ProSe_End_Discovery_Ack message to the UE.
7\. The EPS layer in the UE removes from the local storage every App_ID and/or
ProSe_Code related to the discovery service that has come to an end (The
mapping between the OSApp_ID and the App_ID is not removed).
##### 6.1.13.6.4 Network initiated stop ProSe discovery procedure
The Serving ProSe Server may at any time command the UE to stop the ProSe
discovery service.
1\. The Serving ProSe Server sends a ProSe_Stop_Discovery message to the MME.
The ProSe_Stop_Discovery message may contain:
a. the command to stop monitoring, or
b. the command to stop announcing one or more ProSe_Code(s), with the
indication of the correspondent App_ID(s), or
c. the command to stop any ProSe discovery service.
2\. The MME sends the ProSe_Stop_Discovery NAS message to the EPS layer in the
UE.
3\. The EPS layer in the UE stops monitoring or announcing the ProSe_Code(s)
or any ProSe discovery service, based on the commands in the
ProSe_Stop_Discovery message, and removes from the local storage the App_ID(s)
and/or ProSe_Code(s) related to the stopped ProSe discovery service(s). The
EPS layer in the UE alerts the applications that were using the ProSe
discovery service.
4\. The UE sends to the MME a ProSe_Stop_Discovery_Ack message. If the
ProSe_Stop_Discovery message initially sent by the Serving ProSe Server
contained the command to stop any ProSe discovery service, then the MME
removes the address of the Serving ProSe Server from the UE MM context.
5\. The MME forwards the ProSe_Stop_Discovery_Ack message to the Serving ProSe
Server. If the ProSe_Stop_Discovery message initially sent by the Serving
ProSe Server contained the command to stop any ProSe discovery service, then
the Serving ProSe Server removes all the ProSe Codes from the ProSe User
Context.
#### 6.1.13.7 ProSe discovery service in roaming scenarios
The Serving ProSe Server always resides in the HPLMN.
When an outbound roamer in a VPLMN wants to configure the user\'s preferences
for ProSe discovery service, he/she shall follow the procedure described in
clause 6.1.13.4, i.e. the configuration is made on the Home ProSe Server
(Serving ProSe Server) by means of the PC8 reference point.
When an outbound roamer in a VPLMN wants to start using the ProSe discovery
service, the signalling flow in clause 6.1.13.6.1 applies with the following
differences:
\- The MME forwards the ProSe_Start_Discovery_Req message to a default local
ProSe Server in the VPLMN (Visited ProSe Server) not shown in Figure
6.1.13.6-1, dedicated to handling of the ProSe inbound roamers.
\- When forwarding the ProSe_Start_Discovery_Req message to the Visited ProSe
Server, in addition to adding the IMSI, it also adds the address of the Home
ProSe Server (Serving ProSe Server) received by the HSS during the ProSe
authorization procedure.
\- Upon receiving the ProSe_Start_Discovery_Req message, if there are not any
operational reasons that prevent providing the ProSe discovery service to that
roamer, the Visited ProSe Server creates a temporary local ProSe User Context
where it stores the IMSI, the MME address and the address of the Home ProSe
Server (Serving ProSe Server).
\- Then, the Visited ProSe Server forwards the ProSe_Start_Discovery_Req
message to the Home ProSe Server (Serving ProSe Server), adding to the message
the VPLMN ID.
\- Upon receiving the ProSe_Start_Discovery_Ack message from the Visited ProSe
Server, the MME stores the address of the Visited ProSe Server in the UE MM
context.
When the EPS layer in the monitoring UE \"listens\" one or more ProSe_Code(s),
the signalling flow in clause 6.1.13.6.2 applies with the only difference that
the MME sends all the messages to the Visited ProSe Server, not shown in
figure 6.1.13.6-2, to be forwarded to the Home ProSe Server (Serving ProSe
Server).
Also the signalling flow in clause 6.1.13.6.3 applies with the only difference
that the MME sends all the messages to the Visited ProSe Server, to be
forwarded to the Home ProSe Server (Serving ProSe Server).
The signalling flow in clause 6.1.13.6.4 applies with the difference that the
Home ProSe Server sends the ProSe_Stop_Discovery message to the MME via the
Visited ProSe Server. Moreover, if the ProSe_Stop_Discovery message contains
the command to stop any ProSe discovery service, the Visited ProSe Server
deletes the temporary local ProSe User Context before the MME removes the
address of the Visited ProSe Server from the UE MM context.
##### 6.1.13.7.1 Visited Network initiated stop ProSe discovery procedure
The Visited ProSe Server may at any time command the UE to stop the ProSe
discovery service.
1\. The Visited ProSe Server sends a ProSe_Stop_Discovery message to the MME.
The ProSe_Stop_Discovery message contains the command to stop any ProSe
discovery service.
2\. The MME sends the ProSe_Stop_Discovery NAS message to the EPS layer in the
UE.
3\. The EPS layer in the UE stops any ProSe discovery service and alerts the
applications that were using the ProSe discovery service.
4\. The UE sends to the MME a ProSe_Stop_Discovery_Ack message.
5\. The MME forwards the ProSe_Stop_Discovery_Ack message to the Visited ProSe
Server and removes the address of the Visited ProSe Server from the UE MM
context.
6\. The Visited ProSe Server notifies the Home ProSe Server (Serving ProSe
Server) with the ProSe_Stop_Discovery message.
7\. The Home ProSe Server (Serving ProSe Server) acknowledges the
ProSe_Stop_Discovery message.
8\. The Visited ProSe Server removes the temporary local ProSe User Context.
#### 6.1.13.8 Impact on existing entities and interfaces
**UE:**
\- The ProSe enabled UE needs to be equipped with a ProSe client.
\- The applications need to be modified in order to make use of ProSe
discovery.
\- The EPS layer in the UE needs:
> \- to support ProSe related signalling defined in this solution, and
>
> \- to broadcast ProSe_Codes over the air interface. More details to be
> defined by RAN WGs.
**RAN:**
\- The Radio Access Network needs to provide the UE with the radio resources
used for ProSe discovery.
**MME:**
\- The MME needs to support ProSe related signalling defined in this solution.
\- The MME needs to update the ProSe Server with the address of the current
serving MME whenever the MME is relocated.
**HSS:**
\- The HSS needs to store a ProSe entry in the user's profile containing the
authorization for the ProSe discovery service and, after the first successful
authenticated access of the ProSe client to the ProSe User Context, the
address of the Serving ProSe Server (retrieved over the new reference point
PC4a).
#### 6.1.13.9 Solution Evaluation
This solution provides a complete ProSe direct discovery mechanism that can
work either standalone or with other communication solutions. It has addressed
the following key issues outlined in clause 5:
\- Key Issue #1: ProSe System Architecture;
\- Key Issue #2: Configuration for ProSe direct discovery;
\- Key Issue #3: Configuration and Capability Handling for ProSe;
\- Key Issue #6 Authorization for ProSe capability feature;
\- Key Issue #7 ProSe direct discovery (in coverage);
\- Key Issue #10 ProSe Identities (for ProSe discovery);
\- Key Issue #13 Charging in ProSe.
The security procedures for this solution will be defined by SA WG3.
Procedures to provide the UE with the radio resources for this solution will
be defined by RAN WGs.
**Pros:**
This solution fulfils the architecture requirements in clause 4.2, as it
allows ProSe direct discovery both within the same PLMN or different PLMNs and
in roaming scenarios. The solution ensures a continuous network control over
ProSe discovery, so that for any ProSe discovery event the operator can
enforce:
\- the revocation of the ProSe discovery authorization to the users (both
discoverer and discoveree), just interrupting the elaboration of the monitored
ProSe_Codes at the Serving ProSe Server and thus stopping the ProSe discovery
service for those users;
\- the Lawful Interception e.g. of the discovery proximity results, which are
made available to the UE via SGi interface, whilst in other solutions are made
directly available to UEs without possibility of intercept.
The solution gives the operator the guarantee that only authorized
applications can use ProSe discovery services, as every ProSe discovery
request generated by an application/UE is processed by the network only if it
is related an application that the operator has allowed.
In this solution the EPS layer in the UE starts announcing/monitoring a
ProSe_Code only when it receives an appropriate control plane message from the
network.
The solution makes easier and more reliable charging of ProSe discovery
service because all processing for determining who is in proximity is
performed at network level (without the need to rely on accounting data from
the UE, that is generally considered untrusted).
The separation between the identifiers and the semantics used at the
application layer and the bit-streams transmitted over the air enables the
operator to control and differentiate the offer to the 3rd party service
providers and allows more flexible models for revenue sharing.
The use of the identifier App_User_ID in the transactions between the EPS and
the service platforms and in the Inter-PLMN discovery ensures confidentiality
and privacy of the identities of the UE used in the EPS and of the Application
user identity used in the service layer.
**Cons:**
The need for the monitoring UE of sending the received ProSe_Codes to the
network for their processing determines a signalling load on the control
plane.
NOTE: When a UE starts monitoring, it is very likely it needs to send to the
network the ProSe_Codes (potentially of interest, e.g. Facebook) announced by
most, if not all, the UEs nearby. However, after this initial burst, the
subsequent requests from the monitoring UE to the network can contain only the
ProSe_Codes of any new UEs entered into its discovery range, i.e. no need to
send each time the ProSe Codes of all existing UEs nearby.
### 6.1.14 Solution D14: EPC assisted direct discovery
#### 6.1.14.1 Functional description
The following assumptions and proposals are made with this solution:
\- EPC assisted discovery is carried out by ProSe Function, assisted by the
MME
\- ProSe Function triggers MME to enable EPC assisted direct discovery for
selected UEs based on user preferences provided by a ProSe Application server,
\- The MME reports location information, i.e. the ECGI that is retrieved from
the S1AP Initial UE Message, of selected UEs to the ProSe function using
existing procedures, i.e. MME is aware of UE location at cell level when UE is
in ECM_CONNECTED mode e.g. during Tracking Area Update procedures.
\- In cases where finer granularity of location information is required for
UEs in IDLE mode the MME based on configuration information provided by the
ProSe Function may notify the UE to provide Tracking Area Updates based on
\- Option 1: Reporting based on cell ID change.
\- Option 2: Reporting based on proximity area change. A proximity area is
defined by the operator and is broadcasted to the UEs via the eNB using SIB
information.
\- The ProSe Function obtains geographical information using the ECGI that is
received from the MME. The ProSe Function may have a database with mapping
between ECGI and geographical information. The ProSe function uses the
database in inter-PLMN scenario (details in clause 6.1.14.2.2).
\- Once ProSe Function detects that UEs of interest are in proximity, the MME
can page UEs to initiate direct discovery procedure based on a trigger by the
ProSe Function
Editor\'s note: The impacts of this solution regarding proximity location
information to the outcome of the work specified for CNO ULI is FFS
#### 6.1.14.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
##### 6.1.14.2.1 Procedure for EPC assisted direct discovery
Figure 6.1.14.2.1-1: EPC assisted direct discovery via MME
The following procedures are applicable:
1\. It is assumed that the UEs are already registered with the ProSe function
and the Application Server for ProSe services.
2\. ProSe Application request for proximity information. In addition user
preferences for discovery are provided. For example, ProSe IDs and/or ProSe
application user IDs of UEs that are discoverable.
3\. ProSe Function trigger the MME to enable EPC assisted direct discovery for
selected ProSe UEs. In addition based on operator configuration the ProSe
function include ProSe configuration information such as reporting based on
Proximity Area change.
3a. - 3b. Steps 3a and 3b are optional. Steps 3a - 3b are carried out if the
ProSe function has provided configuration information.
NOTE: If the UEs are in IDLE mode, the UEs transition to connected mode using
the Paging and Service Request procedures after which they are provided with
the configuration information.
4.-5. The UEs perform a Tracking Area Update based on the triggers defined in
clause 5.3.3.0 of TS 23.401 [11]. In addition, the UE send a TAU for the case
where the UEs have been configured for proximity area change reporting using
TAU. If the TAU was due to a proximity area change the UE includes in the TAU
the reason for the trigger (e.g. change in Proximity Area).
6\. The MME reports the location information, i.e. the ECGI that is retrieved
from the S1AP Initial UE Message, of selected UEs to ProSe function.
7\. The ProSe function detects that some UEs are in proximity of each other
e.g. UEs are in the same Proximity Area.
8\. If the criteria for proximity are met (e.g. proximity range, application
type, etc) the ProSe function reports proximity information to ProSe
application.
8a. UEs are informed about proximity information via the application server.
9\. Alternatively, the ProSe Function triggers and/or forwards information
that is relevant for direct discovery between UEs. The ProSe function requests
the MME to forward direct discovery trigger and/or relevant information, e.g.
target UE identifier, that is needed for direct discovery.
9a. The MME forwards the trigger and/or information, e.g. target UE identifier
(UE2) and application ID, etc, to UE1 so that direct discovery. can be
started.
9b. The MME forwards the trigger and/or information, e.g. target UE identifier
(UE1) and application ID, etc, to UE2 so that direct discovery. can be
started.
Editor\'s note: It is FFS which identifier is used for direct discovery
NOTE: If UEs are in IDLE mode, the UEs transition to connected mode using the
Paging and Service Request procedures after which they are provided with
Direct Discovery information.
10\. Direct discovery is initiated by the UEs.
11\. UEs provide proximity information.
##### 6.1.14.2.2 Procedure for EPC assisted direct discovery in an inter-PLMN
scenario
The procedure below shows the scenario where the UEs are served by different
MME/ProSe Functions in different PLMNs. For simplicity, only the steps for the
location reporting and proximity detection are shown.
Figure 6.1.14.2.2-1: Inter-PLMN EPC based discovery
1\. UEs perform a Tracking Area Update based on the triggers defined in clause
5.3.3.0 of TS 23.401 [11]. In addition, the UE send a TAU for the case where
the UEs have been provided with ProSe configuration information . If the TAU
was due to a proximity area change the UE includes in the TAU the reason for
the trigger (e.g. change in Proximity Area).
2\. MME provide location information, i.e. the ECGI that is retrieved from the
S1AP Initial UE Message, to ProSe function.
3\. ProSe function detects that some of the UEs on the user\'s buddy list are
served by different ProSe function. In such a case the ProSe Function obtain
geographical information for the ECGI reported.
4\. Steps 4 to 6 are repeated for UE2.
7\. The ProSe Function exchange geographical information over PC6 reference
point. The ProSe ID is also included in the information exchange.
8\. ProSe Function detect proximity.
#### 6.1.14.3 Impact on existing entities and interfaces
MME impacts: (1) configuring UEs to report proximity area changes, (2)
forwarding of UE location information, i.e. the ECGI that is retrieved from
the S1AP Initial UE Message, to the ProSe server.
eNB impacts: broadcast of proximity area identity.
UE impacts: initiation of Tracking Area Update procedure based on changes in
proximity area, if configured by the MME.
#### 6.1.14.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.1.15 Solution D15: EPC-level ProSe discovery
#### 6.1.15.1 Functional description
##### 6.1.15.1.1 General
As a new entity for EPC-level ProSe discovery, a ProSe Server is introduced in
this solution. The ProSe Server resides in the EPC and has the following
functions:
\- interacting with the UE to support EPC-level ProSe discovery feature;
\- interacting with HSS to get UE\'s location information;
\- determining whether Discoverer UE (shortly discoverer) and Discoveree UE
(shortly discoveree) are in proximity;
\- communicating with home ProSe Server of inbound roamer to request location
information of the inbound roamer\'s UE;
\- communicating with ProSe Server peers in other PLMNs to support EPC-level
ProSe discovery for the scenarios where Discoverer UE and Discoveree UE are
registered to the different PLMNs in network sharing case.
The Discoverer UE registers with a ProSe Server which resides in the
registered PLMN before requesting ProSe discovery to the ProSe Server.
Therefore, if the discoverer is non-roaming, it registers with a home ProSe
Server while if the discoverer is roaming, it registers with a visited ProSe
Server.
NOTE: The discovery granularity in this solution is a cell.
##### 6.1.15.1.2 Description regarding requests for ProSe discovery with time
window
In order to be alerted for proximity with discoveree in a window of time,
discoverer requests ProSe discovery to the ProSe Server with time window
information indicating to the ProSe Server how long the request is valid. In
order to provide proximity alerting to the discoverer, the ProSe Server
performs location reporting control to other network node so that it can be
reported whenever location information of discoverer or discoveree is updated
during a window of time or until proximity is detected. During the location
reporting period, if the UE (discoverer or discoveree) is in idle mode, the
MME does not page the UE to get the current location information of the UE.
Instead, the MME waits that the UE performs Tracking Area Update procedure or
Service Request procedure.
##### 6.1.15.1.3 Description regarding EPC-level ProSe discovery within the
different PLMNs in network sharing case
If the ProSe Server receives a request for ProSe discovery from the
discoverer, it checks whether the discoveree has registered with the ProSe
Server or not. If the discoveree has not registered with the ProSe Server, the
ProSe Server determines that the discoveree is registered to other PLMN than
the PLMN which the discoverer is registered to and the ProSe Server resides
in. Therefore, the ProSe Server decides to check network sharing information
to determine the proximity between the discoverer and discoveree and indicates
to other network node to provide network sharing information together with
UE\'s location information when it makes a location request to the other
network node. If the eNodeB that serves the UE (discoverer or discoveree) is a
shared RAN, the MME provides network sharing information together with UE\'s
location information. The network sharing information is the identity list of
PLMNs broadcasted by the eNodeB that serves the UE.
Editor\'s note: The inter-PLMN discovery for non-sharing operators is FFS.
#### 6.1.15.2 Procedures
##### 6.1.15.2.1 EPC-level ProSe discovery with time window (both discoverer
and discoveree are registered to the same PLMN and non-roaming)
UE-A requests ProSe discovery to the network with time window as illustrated
in Figure 6.1.15.2.1-1 in order to be alerted when it enters proximity with
UE-B in a window of time. In this procedure, UE-A (discoverer) and UE-B
(discoveree) are registered to the same PLMN and are non-roaming.
Figure 6.1.15.2.1-1: EPC-level ProSe discovery with time window (both
discoverer and\ discoveree are registered to the same PLMN and non-roaming)
UE-A and UE-B have registered with the ProSe Server.
1\. UE-A sends a ProSe discovery Request message to the ProSe Server in order
to be alerted for proximity with UE-B in a window of time. UE-A includes time
window information (i.e. Time_X in Figure 6.1.15.2.1-1) indicating to the
ProSe Server how long the request is valid in the ProSe discovery Request
message.
NOTE: It can be considered that UE-A and UE-B actually mean an application on
ProSe-enabled UE-A and an application on ProSe-enabled UE-B, respectively.
2\. The ProSe Server authorizes the ProSe discovery request from UE-A and
checks that UE-A/user-A is permitted to discover UE-B/user-B. If UE-A/user-A
is not permitted to discover UE-B/user-B, step 16 is performed.
Steps 3a to 14a are for obtaining UE-A\'s location information:
3a. The ProSe Server starts a timer with Time_X for UE-A.
4a. The ProSe Server requests the HSS to start location reporting related to
UE-A by sending a Location Reporting Request message to the HSS.
5a. The HSS sends a Location Reporting Request message to the MME in order to
make the MME start location reporting related to UE-A.
6a. The MME responds with a Location Reporting Request Ack message to the HSS.
7a. The HSS responds with a Location Reporting Request Ack message to the
ProSe Server.
8a. It is assumed that UE-A is in connected mode. The MME sends a Location
Reporting Control message to the eNodeB in order to get UE-A\'s most up-to-
date cell information. The MME includes information indicating to the eNodeB
to report UE-A\'s current location whenever UE-A changes its serving cell to
another cell belonging to the eNodeB in the Location Reporting Control
message.
9a. The eNodeB returns UE-A\'s most up-to-date cell information by sending a
Location Report message to the MME.
10a. The MME sends a Location Notification message containing the most current
location information for UE-A to the HSS.
11a. The HSS sends a Location Notification message containing the most current
location information for UE-A to the ProSe Server.
12a. The ProSe Server responds with a Location Notification Ack message to the
HSS.
13a. The HSS responds with a Location Notification Ack message to the MME.
14a. After step 9a, the eNodeB sends a Location Report message to the MME
whenever UE-A changes its serving cell to another cell belonging to the
eNodeB. The updated location information is delivered from the MME to the
ProSe Server via the HSS as described in step 10a to 13a.
Steps 3b to 14b are for obtaining UE-B\'s location information:
3b. The ProSe Server starts a timer with Time_X for UE-B.
4b. The ProSe Server requests the HSS to start location reporting related to
UE-B by sending a Location Reporting Request message to the HSS.
5b. The HSS sends a Location Reporting Request message to the MME in order to
make the MME start location reporting related to UE-B.
6b. The MME responds with a Location Reporting Request Ack message to the HSS.
7b. The HSS responds with a Location Reporting Request Ack message to the
ProSe Server.
8b. It is assumed that UE-B is in idle mode. The MME waits until UE-B performs
Tracking Area Update procedure, UE triggered Service Request procedure or
Network triggered Service Request procedure. At some time, UE-B performs
Tracking Area Update procedure or Service Request procedure.
9b. The MME obtained UE-B\'s cell information in step 8b and sends a Location
Notification message containing the most current location information for UE-B
to the HSS.
10b. The HSS sends a Location Notification message containing the most current
location information for UE-B to the ProSe Server.
11b. The ProSe Server responds with a Location Notification Ack message to the
HSS.
12b. The HSS responds with a Location Notification Ack message to the MME.
13b. After step 8b, if UE-B was changed to connected mode due to step 8b, the
MME performs location reporting control to indicate the eNodeB to report
UE-B\'s current location whenever UE-B changes its serving cell to another
cell belonging to the eNodeB as described in step 8a.
14b. If the MME performs location reporting control to the eNodeB in step 13b,
the eNodeB sends a Location Report message to the MME whenever UE-B changes
its serving cell to another cell belonging to the eNodeB. The updated location
information is delivered from the MME to the ProSe Server via the HSS as
described in step 9b to 12b.
15\. Upon reception of both the Location Notification message in step 11a and
the Location Notification message in step 10b, the ProSe Server determines
that UE-A and UE-B are in proximity based on the location information for UE-A
and UE-B and proximity criteria. If the ProSe Server determines that UE-A and
UE-B are in proximity, step 16 is performed. Otherwise, the ProSe Server
performs proximity check whenever a new Location Notification message is
received from the HSS. If the ProSe Server determines that UE-A and UE-B are
in proximity or if the timer started in step 3a and the timer started in step
3b expire, step 16 is performed.
16\. The ProSe Server sends a ProSe Discovery Response message to UE-A with
information indicating whether UE-A and UE-B are in proximity or not. If
UE-A/user-A is not permitted to discover UE-B/user-B, the ProSe Discovery
Response message indicates that the ProSe Discovery request from UE-A is
rejected.
17\. If UE-A and UE-B are in proximity, the ProSe Server may send a ProSe
Discovery Alert message to UE-B to inform that UE-A wants to discover UE-B.
UE-A and UE-B may attempt to discover each other.
18\. The ProSe Server requests the HSS to stop location reporting related to
UE-A. The location reporting cancellation is made to the MME and if needed to
the eNodeB.
19\. The ProSe Server requests the HSS to stop location reporting related to
UE-B. The location reporting cancellation is made to the MME and if needed to
the eNodeB.
The steps for obtaining UE-A\'s location information (i.e. steps 3a - 14a) may
take place in parallel with the steps for obtaining UE-B\'s location
information (i.e. steps 3b - 14b).
The ProSe Server may start a single timer with Time_X for both UE-A and UE-B
instead of starting separate timers for UE-A and UE-B.
If UE-A is in idle mode, operations for obtaining location information of UE
in idle mode as described in steps 8b - 14b are performed instead of steps 8a
- 14a. If UE-B is in connected mode, operations for obtaining location
information of UE in connected mode as described in steps 8a - 14a are
performed instead of steps 8b - 14b.
Figure 6.1.15.2.1-1 shows that UE-A and UE-B are served by the same eNodeB and
the same MME for the purpose of pictorial simplification. Therefore, the
procedure depicted in Figure 6.1.15.2.1-1 also applies to the scenarios where
UE-A and UE-B are served by the different eNodeBs and the same MME, the
scenarios where UE-A and UE-B are served by the same eNodeB and the different
MMEs, and the scenarios where UE-A and UE-B are served by the different
eNodeBs and the different MMEs.
##### 6.1.15.2.2 EPC-level ProSe discovery with time window (both discoverer
and discoveree are registered to the same PLMN and discoverer is roaming)
UE-A requests ProSe Discovery to the network with time window as illustrated
in Figure 6.1.15.2.2-1 in order to be alerted when it enters proximity with
UE-B in a window of time. In this procedure, UE-A (discoverer) and UE-B
(discoveree) are registered to the same PLMN, i.e., PLMN-B while UE-A is
roaming from its HPLMN, i.e., PLMN-A. In Figure 6.1.15.2.2-1, HSS-A and ProSe
Server-A belong to PLMN-A while eNodeB, MME, HSS-B and ProSe Server-B belong
to PLMN-B.
Figure 6.1.15.2.2-1: EPC-level ProSe discovery with time window (both
discoverer and discoveree are registered to the same PLMN and discoverer is
roaming)
UE-A and UE-B have registered with ProSe Server-B.
1\. UE-A sends a ProSe Discovery Request message to ProSe Server-B that is a
visited ProSe Server to UE-A in order to be alerted for proximity with UE-B in
a window of time. UE-A includes time window information (i.e., Time_X in
Figure 6.1.15.2.2-1) indicating to ProSe Server-B how long the request is
valid in the ProSe Discovery Request message.
NOTE: It can be considered that UE-A and UE-B actually mean an application on
ProSe-enabled UE-A and an application on ProSe-enabled UE-B, respectively.
2\. ProSe Server-B authorizes the ProSe Discovery request from UE-A and checks
that UE-A/user-A is permitted to discover UE-B/user-B. If UE-A/user-A is not
permitted to discover UE-B/user-B, step 20 is performed.
Steps 3a to 18a are for obtaining UE-A\'s location information:
3a. ProSe Server-B starts a timer with Time_X for UE-A.
4a. ProSe Server-B sends a ProSe Location Request message to ProSe Server-A
that is a home ProSe Server to UE-A in order to request UE-A\'s location
information.
5a. ProSe Server-A responds with a ProSe Location Request Ack message to ProSe
Server-B.
6a. ProSe Server-A requests HSS-A to start location reporting related to UE-A
by sending a Location Reporting Request message to HSS-A.
7a. HSS-A sends a Location Reporting Request message to the MME in order to
make the MME start location reporting related to UE-A.
8a. The MME responds with a Location Reporting Request Ack message to HSS-A.
9a. HSS-A responds with a Location Reporting Request Ack message to ProSe
Server-A.
10a. It is assumed that UE-A is in connected mode. The MME sends a Location
Reporting Control message to the eNodeB in order to get UE-A\'s most up-to-
date cell information. The MME includes information indicating to the eNodeB
to report UE-A\'s current location whenever UE-A changes its serving cell to
another cell belonging to the eNodeB in the Location Reporting Control
message.
11a. The eNodeB returns UE-A\'s most up-to-date cell information by sending a
Location Report message to the MME.
12a. The MME sends a Location Notification message containing the most current
location information for UE-A to HSS-A.
13a. HSS-A sends a Location Notification message containing the most current
location information for UE-A to ProSe Server-A.
14a. ProSe Server-A responds with a Location Notification Ack message to
HSS-A.
15a. HSS-A responds with a Location Notification Ack message to the MME.
16a. ProSe Server-A sends a ProSe Location Notification message to ProSe
Server-B to provide UE-A\'s current location information.
17a. ProSe Server-B returns a ProSe Location Notification Ack message to ProSe
Server-A.
18a. After step 11a, the eNodeB sends a Location Report message to the MME
whenever UE-A changes its serving cell to another cell belonging to the
eNodeB. The updated location information is delivered from the MME to ProSe
Server-A via HSS-A as described in step 12a to 15a. If ProSe Server-A receives
the updated location information, it forwards the information to ProSe
Server-B as described in step 16a to 17a.
Steps 3b to 14b are for obtaining UE-B\'s location information:
3b. ProSe Server-B starts a timer with Time_X for UE-B.
4b. ProSe Server-B requests HSS-B to start location reporting related to UE-B
by sending a Location Reporting Request message to HSS-B.
5b. HSS-B sends a Location Reporting Request message to the MME in order to
make the MME start location reporting related to UE-B.
6b. The MME responds with a Location Reporting Request Ack message to HSS-B.
7b. HSS-B responds with a Location Reporting Request Ack message to ProSe
Server-B.
8b. It is assumed that UE-B is in idle mode. The MME waits until UE-B performs
Tracking Area Update procedure, UE triggered Service Request procedure or
Network triggered Service Request procedure. At some time, UE-B performs
Tracking Area Update procedure or Service Request procedure.
9b. The MME obtained UE-B\'s cell information in step 8b and sends a Location
Notification message containing the most current location information for UE-B
to HSS-B.
10b. HSS-B sends a Location Notification message containing the most current
location information for UE-B to ProSe Server-B.
11b. ProSe Server-B responds with a Location Notification Ack message to
HSS-B.
12b. HSS-B responds with a Location Notification Ack message to the MME.
13b. After step 8b, if UE-B was changed to connected mode due to step 8b, the
MME performs location reporting control to indicate the eNodeB to report
UE-B\'s current location whenever UE-B changes its serving cell to another
cell belonging to the eNodeB as described in step 10a.
14b. If the MME performs location reporting control to the eNodeB in step 13b,
the eNodeB sends a Location Report message to the MME whenever UE-B changes
its serving cell to another cell belonging to the eNodeB. The updated location
information is delivered from the MME to ProSe Server-B via HSS-B as described
in step 9b to 12b.
19\. Upon reception of both the ProSe Location Notification message in step
16a and the Location Notification message in step 10b, ProSe Server-B
determines that UE-A and UE-B are in proximity based on the location
information for UE-A and UE-B and proximity criteria. If ProSe Server-B
determines that UE-A and UE-B are in proximity, step 20 is performed.
Otherwise, ProSe Server-B performs proximity check whenever a new location
notification message is received from ProSe Server-A or HSS-B. If ProSe
Server-B determines that UE-A and UE-B are in proximity or if the timer
started in step 3a and the timer started in step 3b expire, step 20 is
performed.
20\. ProSe Server-B sends a ProSe Discovery Response message to UE-A with
information indicating whether UE-A and UE-B are in proximity or not. If
UE-A/user-A is not permitted to discover UE-B/user-B, the ProSe Discovery
Response message indicates that the ProSe Discovery request from UE-A is
rejected.
21\. If UE-A and UE-B are in proximity, ProSe Server-B may send a ProSe
Discovery Alert message to UE-B to inform that UE-A wants to discover UE-B.
UE-A and UE-B may attempt to discover each other.
22\. ProSe Server-B requests ProSe Server-A to stop location reporting related
to UE-A. The location reporting cancellation is made to the MME via HSS-A and
if needed to the eNodeB.
23\. ProSe Server-B requests HSS-B to stop location reporting related to UE-B.
The location reporting cancellation is made to the MME and if needed to the
eNodeB.
The steps for obtaining UE-A\'s location information (i.e., steps 3a - 18a)
may take place in parallel with the steps for obtaining UE-B\'s location
information (i.e., steps 3b - 14b).
ProSe Server-B may start a single timer with Time_X for both UE-A and UE-B
instead of starting separate timers for UE-A and UE-B.
If UE-A is in idle mode, operations for obtaining location information of UE
in idle mode as described in steps 8b - 14b are performed instead of steps 10a
- 15a and 18a. If UE-B is in connected mode, operations for obtaining location
information of UE in connected mode as described in steps 10a - 15a and 18a
are performed instead of steps 8b - 14b.
Figure 6.1.15.2.2-1 shows that UE-A and UE-B are served by the same eNodeB and
the same MME for the purpose of pictorial simplification. Therefore, the
procedure depicted in Figure 6.1.15.2.2-1 also applies to the scenarios where
UE-A and UE-B are served by the different eNodeBs and the same MME, the
scenarios where UE-A and UE-B are served by the same eNodeB and the different
MMEs, and the scenarios where UE-A and UE-B are served by the different
eNodeBs and the different MMEs.
##### 6.1.15.2.3 EPC-level ProSe discovery with time window (both discoverer
and discoveree are registered to the same PLMN and discoveree is roaming)
UE-B requests ProSe Discovery to the network with time window as illustrated
in Figure 6.1.15.2.3-1 in order to be alerted when it enters proximity with
UE-A in a window of time. In this procedure, UE-B (discoverer) and UE-A
(discoveree) are registered to the same PLMN, i.e., PLMN-B while UE-A is
roaming from its HPLMN, i.e., PLMN-A. In Figure 6.1.15.2.3-1, HSS-A and ProSe
Server-A belong to PLMN-A while eNodeB, MME, HSS-B and ProSe Server-B belong
to PLMN-B.
Figure 6.1.15.2.3-1: EPC-level ProSe discovery with time window (both
discoverer and\ discoveree are registered to the same PLMN and discoveree is
roaming)
UE-A and UE-B have registered with ProSe Server-B.
1\. UE-B sends a ProSe Discovery Request message to ProSe Server-B in order to
be alerted for proximity with UE-A in a window of time. UE-B includes time
window information (i.e., Time_X in Figure 6.1.15.2.3-1) indicating to ProSe
Server-B how long the request is valid in the ProSe Discovery Request message.
NOTE: It can be considered that UE-A and UE-B actually mean an application on
ProSe-enabled UE-A and an application on ProSe-enabled UE-B, respectively.
2\. ProSe Server-B authorizes the ProSe Discovery request from UE-B and
requests ProSe Server-A that is a home ProSe Server to UE-A to check that
UE-B/user-B is permitted to discover UE-A/user-A by sending a ProSe Permission
Check Request message to ProSe Server-A.
3\. ProSe Server-A checks that UE-B/user-B is permitted to discover
UE-A/user-A.
4\. ProSe Server-A returns a ProSe Permission Check Response message to ProSe
Server-B with information indicating whether UE-B/user-B is permitted to
discover UE-A/user-A or not. If UE-B/user-B is not permitted to discover
UE-A/user-A, step 22 is performed.
Steps 5a to 20a are for obtaining UE-A\'s location information:
5a. ProSe Server-B starts a timer with Time_X for UE-A.
6a. ProSe Server-B sends a ProSe Location Request message to ProSe Server-A
that is a home ProSe Server to UE-A in order to request UE-A\'s location
information.
7a. ProSe Server-A responds with a ProSe Location Request Ack message to ProSe
Server-B.
8a. ProSe Server-A requests HSS-A to start location reporting related to UE-A
by sending a Location Reporting Request message to HSS-A.
9a. HSS-A sends a Location Reporting Request message to the MME in order to
make the MME start location reporting related to UE-A.
10a. The MME responds with a Location Reporting Request Ack message to HSS-A.
11a. HSS-A responds with a Location Reporting Request Ack message to ProSe
Server-A.
12a. It is assumed that UE-A is in idle mode. The MME waits until UE-A
performs Tracking Area Update procedure, UE triggered Service Request
procedure or Network triggered Service Request procedure. At some time, UE-A
performs Tracking Area Update procedure or Service Request procedure.
13a. The MME obtained UE-A\'s cell information in step 12a and sends a
Location Notification message containing the most current location information
for UE-A to HSS-A.
14a. HSS-A sends a Location Notification message containing the most current
location information for UE-A to ProSe Server-A.
15a. ProSe Server-A responds with a Location Notification Ack message to
HSS-A.
16a. HSS-A responds with a Location Notification Ack message to the MME.
17a. ProSe Server-A sends a ProSe Location Notification message to ProSe
Server-B to provide UE-A\'s current location information.
18a. ProSe Server-B returns a ProSe Location Notification Ack message to ProSe
Server-A.
19a. After step 12a, if UE-A was changed to connected mode due to step 12a,
the MME performs location reporting control to indicate the eNodeB to report
UE-A\'s current location whenever UE-A changes its serving cell to another
cell belonging to the eNodeB as described in step 10b.
20a. If the MME performs location reporting control to the eNodeB in step 19a,
the eNodeB sends a Location Report message to the MME whenever UE-A changes
its serving cell to another cell belonging to the eNodeB. The updated location
information is delivered from the MME to ProSe Server-A via HSS-A as described
in step 13a to 16a. If ProSe Server-A receives the updated location
information, it forwards the information to ProSe Server-B as described in
step 17a to 18a.
Steps 5b to 16b are for obtaining UE-B\'s location information:
5b. ProSe Server-B starts a timer with Time_X for UE-B.
6b. ProSe Server-B requests HSS-B to start location reporting related to UE-B
by sending a Location Reporting Request message to HSS-B.
7b. HSS-B sends a Location Reporting Request message to the MME in order to
make the MME start location reporting related to UE-B.
8b. The MME responds with a Location Reporting Request Ack message to HSS-B.
9b. HSS-B responds with a Location Reporting Request Ack message to ProSe
Server-B.
10b. It is assumed that UE-B is in connected mode. The MME sends a Location
Reporting Control message to the eNodeB in order to get UE-B\'s most up-to-
date cell information. The MME includes information indicating to the eNodeB
to report UE-B\'s current location whenever UE-B changes its serving cell to
another cell belonging to the eNodeB in the Location Reporting Control
message.
11b. The eNodeB returns UE-B\'s most up-to-date cell information by sending a
Location Report message to the MME.
12b. The MME sends a Location Notification message containing the most current
location information for UE-B to HSS-B.
13b. HSS-B sends a Location Notification message containing the most current
location information for UE-B to ProSe Server-B.
14b. ProSe Server-B responds with a Location Notification Ack message to
HSS-B.
15b. HSS-B responds with a Location Notification Ack message to the MME.
16b. After step 11b, the eNodeB sends a Location Report message to the MME
whenever UE-B changes its serving cell to another cell belonging to the
eNodeB. The updated location information is delivered from the MME to ProSe
Server-B via HSS-B as described in step 12b to 15b.
21\. Upon reception of both the ProSe Location Notification message in step
17a and the Location Notification message in step 13b, ProSe Server-B
determines that UE-A and UE-B are in proximity based on the location
information for UE-A and UE-B and proximity criteria. If ProSe Server-B
determines that UE-A and UE-B are in proximity, step 22 is performed.
Otherwise, ProSe Server-B performs proximity check whenever a new location
notification message is received from ProSe Server-A or HSS-B. If ProSe
Server-B determines that UE-A and UE-B are in proximity or if the timer
started in step 5a and the timer started in step 5b expire, step 22 is
performed.
22\. ProSe Server-B sends a ProSe Discovery Response message to UE-B with
information indicating whether UE-A and UE-B are in proximity or not. If
UE-B/user-B is not permitted to discover UE-A/user-A, the ProSe Discovery
Response message indicates that the ProSe Discovery request from UE-B is
rejected.
23\. If UE-A and UE-B are in proximity, ProSe Server-B may send a ProSe
Discovery Alert message to UE-A to inform that UE-B wants to discover UE-A.
UE-A and UE-B may attempt to discover each other.
24\. ProSe Server-B requests ProSe Server-A to stop location reporting related
to UE-A. The location reporting cancellation is made to the MME via HSS-A and
if needed to the eNodeB.
25\. ProSe Server-B requests HSS-B to stop location reporting related to UE-B.
The location reporting cancellation is made to the MME and if needed to the
eNodeB.
The steps for obtaining UE-A\'s location information (i.e., steps 5a - 20a)
may take place in parallel with the steps for obtaining UE-B\'s location
information (i.e., steps 5b - 16b).
ProSe Server-B may start a single timer with Time_X for both UE-A and UE-B
instead of starting separate timers for UE-A and UE-B.
If UE-A is in connected mode, operations for obtaining location information of
UE in connected mode as described in steps 10b - 16b are performed instead of
steps 12a - 16a and 19a - 20a. If UE-B is in idle mode, operations for
obtaining location information of UE in idle mode as described in steps 12a -
16a and 19a - 20a are performed instead of steps 10b - 16b.
Figure 6.1.15.2.3-1 shows that UE-A and UE-B are served by the same eNodeB and
the same MME for the purpose of pictorial simplification. Therefore, the
procedure depicted in Figure 6.1.15.2.3-1 also applies to the scenarios where
UE-A and UE-B are served by the different eNodeBs and the same MME, the
scenarios where UE-A and UE-B are served by the same eNodeB and the different
MMEs, and the scenarios where UE-A and UE-B are served by the different
eNodeBs and the different MMEs.
##### 6.1.15.2.4 EPC-level ProSe discovery within the different PLMNs in
network sharing case (both discoverer and discoveree are non-roaming)
UE-A requests ProSe Discovery to the network with time window as illustrated
in Figure 6.1.15.2.4-1 in order to be alerted when it enters proximity with
UE-B in a window of time. In this procedure, UE-A (discoverer) and UE-B
(discoveree) are registered to the different PLMNs, i.e. UE-A and UE-B are
registered to PLMN-A and PLMN-B, respectively. UE-A and UE-B are non-roaming.
In Figure 6.1.15.2.4-1, MME-A, HSS-A and ProSe Server-A belong to PLMN-A while
MME-B, HSS-B and ProSe Server-B belong to PLMN-B.
Figure 6.1.15.2.4-1: EPC-level ProSe discovery within the different PLMNs in
network sharing case (both discoverer and discoveree are non-roaming)
UE-A has registered with ProSe Server-A while UE-B has registered with ProSe
Server-B.
1\. UE-A sends a ProSe Discovery Request message to ProSe Server-A in order to
be alerted for proximity with UE-B in a window of time. UE-A includes time
window information (i.e., Time_X in Figure 6.1.15.2.4-1) indicating to the
ProSe Server how long the request is valid in the ProSe Discovery Request
message.
NOTE: It can be considered that UE-A and UE-B actually mean an application on
ProSe-enabled UE-A and an application on ProSe-enabled UE-B, respectively.
2\. ProSe Server-A authorizes the ProSe Discovery request from UE-A and
requests ProSe Server-B that is a home ProSe Server to UE-B to check that
UE-A/user-A is permitted to discover UE-B/user-B by sending a ProSe Permission
Check Request message to ProSe Server-B.
3\. ProSe Server-B checks that UE-A/user-A is permitted to discover
UE-B/user-B.
4\. ProSe Server-B returns a ProSe Permission Check Response message to ProSe
Server-A with information indicating whether UE-A/user-A is permitted to
discover UE-B/user-B or not. If UE-A/user-A is not permitted to discover
UE-B/user-B, step 22 is performed.
Steps 5a to 16a are for obtaining UE-A\'s location information:
5a. ProSe Server-A starts a timer with Time_X for UE-A.
6a. ProSe Server-A requests HSS-A to start location reporting related to UE-A
by sending a Location Reporting Request message to HSS-A. Because the
discoveree, UE-B has not registered with ProSe Server-A, ProSe Server-A
decides that network sharing information is needed to check the proximity of
UE-B. Therefore, ProSe Server-A includes information indicating to HSS-A to
provide network sharing information together with UE-A\'s location information
to ProSe Server-A in the Location Reporting Request message.
7a. HSS-A sends a Location Reporting Request message to MME-A in order to make
MME-A start location reporting related to UE-A. HSS-A includes information
indicating to MME-A to provide network sharing information together with
UE-A\'s location information to HSS-A in the Location Reporting Request
message.
8a. MME-A responds with a Location Reporting Request Ack message to HSS-A.
9a. HSS-A responds with a Location Reporting Request Ack message to ProSe
Server-A.
10a. It is assumed that UE-A is in connected mode. MME-A sends a Location
Reporting Control message to the eNodeB in order to get UE-A\'s most up-to-
date cell information. MME-A includes information indicating to the eNodeB to
report UE-A\'s current location whenever UE-A changes its serving cell to
another cell belonging to the eNodeB in the Location Reporting Control
message.
11a. The eNodeB returns UE-A\'s most up-to-date cell information by sending a
Location Report message to MME-A.
12a. MME-A sends a Location Notification message containing the most current
location information for UE-A to HSS-A. If the eNodeB that serves UE-A is a
shared RAN, MME-A includes network sharing information about broadcast PLMNs
in relation to the eNodeB that serves UE-A in the Location Notification
message. The information about broadcast PLMNs is the identity list of PLMNs
broadcasted by the eNodeB that serves UE-A.
13a. HSS-A sends a Location Notification message containing the most current
location information for UE-A and if available the identity list of broadcast
PLMNs to ProSe Server-A.
14a. ProSe Server-A responds with a Location Notification Ack message to
HSS-A.
15a. HSS-A responds with a Location Notification Ack message to MME-A.
16a. After step 11a, the eNodeB sends a Location Report message to MME-A
whenever UE-A changes its serving cell to another cell belonging to the
eNodeB. The updated location information is delivered from MME-A to ProSe
Server-A via HSS-A as described in step 12a to 15a.
Steps 5b to 20b are for obtaining UE-B\'s location information:
5b. ProSe Server-A starts a timer with Time_X for UE-B.
6b. ProSe Server-A sends a ProSe Location Request message to ProSe Server-B
that is a home ProSe Server to UE-B in order to request UE-B\'s location
information. Because the discoveree, UE-B has not registered with ProSe
Server-A, ProSe Server-A decides that network sharing information is needed to
check the proximity of UE-B. Therefore, ProSe Server-A includes information
indicating to ProSe Server-B to provide network sharing information together
with UE-B\'s location information to ProSe Server-A in the ProSe Location
Request message.
7b. ProSe Server-B responds with a ProSe Location Request Ack message to ProSe
Server-A.
8b. ProSe Server-B requests HSS-B to start location reporting related to UE-B
by sending a Location Reporting Request message to HSS-B. ProSe Server-B
includes information indicating to HSS-B to provide network sharing
information together with UE-B\'s location information to ProSe Server-B in
the Location Reporting Request message.
9b. HSS-A sends a Location Reporting Request message to MME-B in order to make
MME-B start location reporting related to UE-B. HSS-B includes information
indicating to MME-B to provide network sharing information together with
UE-B\'s location information to HSS-B in the Location Reporting Request
message.
10b. MME-B responds with a Location Reporting Request Ack message to HSS-B.
11b. HSS-B responds with a Location Reporting Request Ack message to ProSe
Server-B.
12b. It is assumed that UE-B is in idle mode. MME-B waits until UE-B performs
Tracking Area Update procedure, UE triggered Service Request procedure or
Network triggered Service Request procedure. At some time, UE-B performs
Tracking Area Update procedure or Service Request procedure.
13b. MME-B obtained UE-B\'s cell information in step 12b and sends a Location
Notification message containing the most current location information for UE-B
to HSS-B. If the eNodeB that serves UE-B is a shared RAN, MME-B includes
network sharing information about broadcast PLMNs in relation to the eNodeB
that serves UE-B in the Location Notification message. The information about
broadcast PLMNs is the identity list of PLMNs broadcasted by the eNodeB that
serves UE-B.
14b. HSS-B sends a Location Notification message containing the most current
location information for UE-B and if available the identity list of broadcast
PLMNs to ProSe Server-B.
15b. ProSe Server-B responds with a Location Notification Ack message to
HSS-B.
16b. HSS-B responds with a Location Notification Ack message to MME-B.
17b. ProSe Server-B sends a ProSe Location Notification message to ProSe
Server-A to provide UE-B\'s current location information and if available the
identity list of broadcast PLMNs.
18b. ProSe Server-A returns a ProSe Location Notification Ack message to ProSe
Server-B.
19b. After step 12b, if UE-B was changed to connected mode due to step 12b,
MME-B performs location reporting control to indicate the eNodeB to report
UE-B\'s current location whenever UE-B changes its serving cell to another
cell belonging to the eNodeB as described in step 10a.
20b. If MME-B performs location reporting control to the eNodeB in step 19b,
the eNodeB sends a Location Report message to MME-B whenever UE-B changes its
serving cell to another cell belonging to the eNodeB. The updated location
information is delivered from MME-B to ProSe Server-B via HSS-B as described
in step 13b to 16b. If ProSe Server-B receives the updated location
information, it forwards the information to ProSe Server-A as described in
step 17b to 18b.
21\. Upon reception of both the Location Notification message in step 13a and
the ProSe Location Notification message in step 17b, ProSe Server-A determines
that UE-A and UE-B are in proximity based on the location information for UE-A
and UE-B, network sharing information about broadcast PLMNs and proximity
criteria. If ProSe Server-A determines that UE-A and UE-B are in proximity,
step 22 is performed. Otherwise, ProSe Server-A performs proximity check
whenever a new location notification message is received from HSS-A or ProSe
Server-B. If ProSe Server-A determines that UE-A and UE-B are in proximity or
if the timer started in step 5a and the timer started in step 5b expire, step
22 is performed.
22\. ProSe Server-A sends a ProSe Discovery Response message to UE-A with
information indicating whether UE-A and UE-B are in proximity or not. If
UE-A/user-A is not permitted to discover UE-B/user-B, the ProSe Discovery
Response message indicates that the ProSe Discovery request from UE-A is
rejected.
23-25. If UE-A and UE-B are in proximity, ProSe Server-A may request ProSe
Server-B to send a ProSe Discovery Alert message to UE-B to inform that UE-A
wants to discover UE-B.
UE-A and UE-B may attempt to discover each other.
26\. ProSe Server-A requests HSS-A to stop location reporting related to UE-A.
The location reporting cancellation is made to MME-A and if needed to the
eNodeB.
27\. ProSe Server-A requests ProSe Server-B to stop location reporting related
to UE-B. The location reporting cancellation is made to MME-B via HSS-B and if
needed to the eNodeB.
The steps for obtaining UE-A\'s location information (i.e., steps 5a - 16a)
may take place in parallel with the steps for obtaining UE-B\'s location
information (i.e., steps 5b - 20b).
ProSe Server-A may start a single timer with Time_X for both UE-A and UE-B
instead of starting separate timers for UE-A and UE-B.
If UE-A is in idle mode, operations for obtaining location information of UE
in idle mode as described in steps 12b - 16b and 19b - 20b are performed
instead of steps 10a - 16a. If UE-B is in connected mode, operations for
obtaining location information of UE in connected mode as described in steps
10a - 16a are performed instead of steps 12b - 16b and 19b - 20b.
The procedure depicted in Figure 6.1.15.2.4-1 also applies to the scenarios
where UE-A and UE-B are served by the same eNodeB and the same MME, the
scenarios where UE-A and UE-B are served by the different eNodeBs and the same
MME, and the scenarios where UE-A and UE-B are served by the different eNodeBs
and the different MMEs.
#### 6.1.15.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.1.15.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.1.16 Solution D16 (consolidation of D3/D6/D7): ProSe Discovery through
Communication (DtC)
#### 6.1.16.1 Functional description
##### 6.1.16.1.1 General
This clause is a consolidated description of solutions D3, D6 and D7, commonly
referred to as ProSe Discovery through Communication (DtC).
The only required RAN functionality on PC5 to support ProSe Discovery through
Communication is the RAN physical layer ProSe communication capability. In
other words, ProSe Discovery through Communication does not require any
dedicated RAN physical layer capability that is specific to ProSe discovery.
Editor's note: The DtC applicability to in-coverage inter-PLMN discovery is
FFS and need to be confirmed by the RAN groups.
##### 6.1.16.1.2 System architecture
ProSe Discovery through Communication (DtC) relies on signalling messages that
are carried within the same layer-2 frames as those used for ProSe
communication.
It is assumed that the following functionality is provided by the common
layer-2:
  * _Destination Layer-2 ID_ that can be set to a unicast, groupcast or > broadcast identifier.
  * _Source Layer-2 ID_ that is always set to a unicast identifier.
  * The unicast, groupcast and broadcast identifiers are assumed to have > the same size.
  * A Frame Type parameter indicating whether the layer-2 frame payload > carries a DtC signalling message or a data packet.
  * The following DtC signalling messages are needed: Targeted Discovery > Request, Targeted Discovery Response, and, potentially, a Targeted > Discovery Ack and Beacon.
Editor's note: The exact number of messages is to be defined by CT1 as part of
Stage 3 work.
Editor's note: The assumptions on the functionality provided by the common
layer-2 need to be confirmed by the RAN groups.
The content carried within the signalling message payload is limited in size
only by the maximum layer-2 frame size.
The initial DtC signalling message is sent on a broadcast or groupcast
_Destination Layer-2 ID_. The subsequent DtC signalling messages are carried
in layer-2 frames with unicast _Destination Layer-2 ID_.
##### 6.1.16.1.3 Identifiers for ProSe Discovery through Communication
The following identities are used for ProSe Discovery through Communication:
ProSe Application ID, ProSe Layer-2 Group ID, ProSe UE ID and Application
Layer User ID.
In the context of ProSe Discovery through Communication, ProSe Application ID
is used to identify a (target) population. It can be defined to point to a
single user or to a group of users. The definition of these identifiers is out
of 3GPP scope in this release.
For the case of network --based interpretation services, a UE may get assigned
by the network one or more ProSe Codes.
#### 6.1.16.2 Procedures
##### 6.1.16.2.1 Allocation and handling of ProSe UE ID and ProSe_Code in
ProSe Discovery through Communication (DtC)
The ProSe UE ID can be self-assigned by the UE or configured in the UE (e.g.
for out of network coverage operation). Also, the network may allocate the
ProSe UE ID or a ProSe_Code in the following use cases:
  * The network operator desires to guarantee uniqueness of the ProSe UE ID;
  * The network operator desires to offer services based on interpretation of a ProSe_Code.
In order to guarantee uniqueness and in order to deliver network-based
interpretation services precise formats of the ProSe UE ID are used. For the
case of network --based interpretation ProSe discovery services, a UE may get
multiple ProSe_Codes assigned for network --based interpretation ProSe
discovery services.
Editor\'s note: The format of the ProSe_Code for Network-based interpretation
ProSe discovery services is FFS.
A ProSe UE ID is also a way to divorce the identity discovered via discovery
procedures and the Application Level User IDs used by applications. Indeed, a
mapping to application level user identities is required to determine the
identity of the user discovered.
The procedure for network allocation of the ProSe UE ID is defined is shown in
Figure 6.1.16.2.1-1
Figure 6.1.16.2.1-1: ProSe UE ID assignment and registration
1\. The UE obtains the ProSe UE ID (or ProSe_Code, for network based
interpretation ProSe discovery services) from the network, by interacting on
the user plane with the ProSe Function.
2\. The UE, for applications which are authorized to access the ProSe UE ID
based on configuration information, and that require it, optionally registers
with the related Application Server the mapping of the related ALUID with the
ProSe UE ID obtained in step 1 using an application specific method. This step
is not executed for network --based interpretation ProSe discovery services.
3\. The Application Server provides the mapping of the ProSe UE ID to the
ALUID to the application clients of UEs which are registered as buddies of the
application user using an application specific method.
The format of the ProSe UE ID may include the MCC/MNC of the operator that has
generated it to guarantee its uniqueness. For applications that allow a
partial matching, a hierarchical structure outside of the scope of 3GPP may be
used.
The UE may request the network to reallocate the ProSe UE ID as in figure
6.1.16.2.1-2
Figure 6.1.16.2.1-2: UE requested ProSe UE ID reallocation
1\. The UE requests the ProSe function to allocate a new ProSe UE ID by
sending on the user plane a UE requested ProSe UE ID reallocation request
(GUTI).
2\. The network assigns the new ProSe UE ID by responding with a UE requested
ProSe UE ID reallocation Accept (_new_ ProSe UE ID)
The network may assign a new ProSe UE ID as in figure 6.1.16.2.1-3:
Figure 6.1.16.2.1-3: Network initiated ProSe UE ID reallocation
1\. The ProSe Function allocates a new ProSe UE ID by sending on the user
plane a Network Initiated ProSe UE ID reallocation request (_new_ ProSe UE
ID).
2\. The UE accepts the new ProSe UE ID by responding with a Network Initiated
ProSe UE ID reallocation Accept ().
Figure 6.1.16.2.1-4 documents the overall handling of the ProSe UE ID,
including provisioning aspects:
Figure 6.1.16.2.1-4: ProSe UE ID handling during discovery
0\. A D2D Provisioning Function (DPF), provisions discovery policies per
application and per UE in each UE ProSe Manager on an ongoing basis (so that
any policy update is readily provided to the UE). The discovery policies allow
the operator to restrict discovery function access (the default is e.g.
\"allow\"), and in particular:
\- Determine which application cannot participate in ProSe Discovery through
Communication.
\- Determine which applications can cause the UE to announce using a Beacon
message and if so using which Destination Layer 2-ID.
\- Determine which applications can monitor Beacon messages and if so whether
on specific Destination Layer 2 IDs or on the broadcast Layer-2 ID or both.
\- Determine which UE cannot be discovered for a certain application.
\- Determine which UE cannot discover other UEs for a certain application.
\- Determine whether restrictions apply for a UE for ProSe Discovery through
Communication.
\- Determine which applications can use network based interpretation ProSe
discovery services and obtain ProSe Codes
1\. The UE ProSe Manager (part of the UE responsible for ProSe UE ID handling
and Discovery procedures) obtain a ProSe UE ID or a ProSe Code from the ProSe
Function.
2\. Once the ProSe Manager obtains the ProSe UE ID, it can provide it to
applications that request it based on the discovery policies that are
provisioned in step 0.This is repeated every time a new ProSe UE ID is
allocated. If an application requires to participate in ProSe discovery or in
monitoring ProSe Codes for network based interpretation ProSe discovery
services, it registers with the ProSe Manager its ProSe Application ID, or,
for network based interpretation ProSe discovery services, it would register
one or more ProSe Code matching criteria. Based on this information, the ProSe
manager can notify the application of the value of an incoming ProSe UE ID
when a Targeted Discovery Request message or a Beacon message is received so
the application may also decide whether to do any additional processing e.g.
for security. For network based interpretation ProSe discovery services, when
a match occurs, the ProSe manager would be triggered to request the network to
interpret the ProSe code. Additional steps for describing network based
interpretation ProSe discovery services are not described in this diagram.
3\. Application clients in the UE register the ProSe UE ID of the respective
UE with the applications alongside its own preferences and settings. The
application servers return a mapping of ProSe UE IDs to the user\'s potential
discovery targets user identities. The Application Server may also provide the
preferences and settings of the remote parties in terms of privacy settings,
etc. The application may also provide its own policies as to whether the user
can discover or can be discovered and whether it can do so per remote user
ProSe UE ID. This step is repeated every time the ProSe UE ID is renewed and
also remote parties get notified asynchronously by the application server when
a UE updates its ProSe UE ID. This step and the following steps are not
executed for network based interpretation services.
4\. The UEs execute the discovery procedures. In step 4a the UEs request the
discovery services (Model A or Model B discovery). In step 4b the application
is notified of discovery-related events (e.g. incoming Beacon messages,
incoming Targeted Discovery Request messages, incoming Targeted Discovery
Response messages).
5\. Optionally (as the application client may not require end user
interaction), the end users of the UEs is notified by GUI of the proximal
users based on network and application-layer preferences and settings so they
can take any actions.
Out of network coverage operates based on pre-provisioned information. The
ProSe UE ID is provisioned in the UE as well as any secrets related to ProSe
Application IDs used in ProSe Discovery through Communication. Network based
interpretation ProSe discovery services are not used if the UE is out of
network coverage.
##### 6.1.16.2.2 Procedures for discovery proper
Depicted in Figure 6.1.16.2.2-1 is the procedure for ProSe Discovery through
Communication allowing a group member to discover group members in vicinity:
the Identity that a UE discovers or announces is either the ALUID or the ProSe
UE ID. The ProSe UE ID may potentially be the same as the Source Layer-2 ID.
Figure 6.1.16.2.2-1: ProSe Discovery through Communication procedure for a
group member
1\. The user of UE-1 (the discoverer) wishes to discover whether there are any
members associated with a specific _ProSe Application ID_ in proximity. UE-1
groupcasts a Targeted Discovery Request (ProSe Application ID, ALUID or ProSe
UE ID) message. _ProSe Application ID_ indicates the targeted discoverees.
ALUID is the Application Layer User ID of the discoverer and ProSe UE ID is
the ProSe UE ID of the discoverer's UE.
NOTE: For the use of additional parameters refer to the description of UE-to-
Network Relay discovery.
> The _Destination Layer-2 ID_ field is set to the _ProSe Layer-2 Group ID_
> associated with the targeted _ProSe Application ID_ that is pre-configured
> for all group members. The Targeted Discovery Request message payload is
> encrypted using the group master key configured for this _ProSe Application
> ID_.
>
> The _Source Layer-2 ID_ field in the layer-2 frame carrying the Targeted
> Discovery Request message is set to the Layer-2 ID of UE-1. This Layer-2 ID
> can be statically configured or generated on the fly by UE-1.
2\. The Targeted Discovery Request message is received by UE-2, UE-3, UE-4 and
UE-5.
> By inspecting the _Destination Layer-2 ID_ field in the received layer-2
> frame, UE-2, UE-3 and UE-4 determine that the frame is related to a group of
> which they are members and proceed to decryption with the group master key
> configured for this group. Each one of UE-2, UE-3 and UE-4 responds directly
> to UE-1 with a Targeted Discovery Response (ALUID or ProSe UE ID) message.
> ALUID is the Application Layer User ID of the discoveree, and ProSe UE ID is
> the ProSe UE ID of the discoveree.
>
> The Targeted Discovery Response message payload is encrypted using the group
> master key configured for this _ProSe Application ID_. The knowledge of the
> common group master key is a means for implicit mutual authentication
> between the discoverer and each of the discoverees.
>
> The _Source Layer-2 ID_ field in the layer-2 frame carrying the Targeted
> Discovery Response message is set to the Layer-2 ID of the discoveree UE.
> This Layer-2 ID can be statically configured or generated on the fly by the
> discoveree UE.
>
> The _Destination Layer-2 ID_ field in the layer-2 frame is set to the
> Layer-2 ID of the discoverer UE (UE1) that was received in the _Source
> Layer-2_ field in step 1.
>
> Non-member UEs (UE-5) discard the received message based on the _Destination
> Layer-2 ID_ value.
Depicted in Figure 6.1.16.2.2-2 is the procedure for ProSe Discovery through
Communication allowing a non-member user to discover specific group's members
who are located in vicinity.
Figure 6.1.16.2.2-2: ProSe Discovery through Communication procedure for a
non-member
The ProSe Discovery through Communication procedure for a non-member is
largely the same as the procedure for a group member, with the following
notes:
\- it is not possible to assume that a mapping between a ProSe UE ID and ALUID
exists in the peer UE;
\- the layer-2 frame in step 1 is broadcasted by setting the _Destination
Layer-2 ID_ field to a well-known broadcast value. The frame payload is not
encrypted;
\- the Targeted Discovery Request and Targeted Discovery Response message may
include security-related parameters (e.g. Security(1), Security(2),
Security(3), Security(4) in Figure 6.1.16.2.2-2);
\- there may be more than one Targeted Discovery Request/Response/Ack
consecutive rounds in order to conclude the security procedure (e.g. a 3 or
4-way handshake may apply depending on SA WG3 decisions). In reference to
Figure 6.1.16.2.2-2, steps 3 and 4 are part of the same ProSe Discovery
through Communication transaction as steps 1 and 2;
Editor's note: The security details of this procedure will be studied in SA
WG3. It is expected that the users should be able to authenticate each other
using certificates issued by a trusted certificate authority.
Depicted in Figure 6.1.16.2.2-3 is the procedure for ProSe Discovery through
Communication allowing a group member to announce itself to UEs in vicinity:
the Identity that a UE announces is either the ALUID or the ProSe UE ID. The
ProSe UE ID may potentially be the same as the Source Layer-2 ID.
Figure 6.1.16.2.2-3: Beacon procedure for a group member
1\. The user of UE-1 (the announcing UE) wishes to announce itself to any UE
or to any members associated with a specific _ProSe Application ID_ in
proximity. UE-1 groupcasts or broadcasts a Beacon (ProSe Application ID, ALUID
or ProSe UE ID, additional parameters) message. _ProSe Application ID_
indicates a specific application group the user of UE1 is affiliated with and
it may not be present if the announcing user is not a member of any group.
ALUID is the Application Layer User ID of the announcing user and ProSe UE ID
is the ProSe UE ID of the announcing UE. Additional parameters can be conveyed
(e.g. whether the UE is a relay or not, whether it is in connected status or
not, which network a relay may provide access to etc.).
NOTE: For the use of additional parameters refer to the description of UE-to-
Network Relay discovery.
> The _Destination Layer-2 ID_ field is set to the _ProSe Layer-2 Group ID_
> associated with the targeted _ProSe Application ID_ that is pre-configured
> for all group members. Alternatively, if the announcement is to a well-known
> broadcast address. The Beacon message payload may be encrypted using the
> group master key configured for this _ProSe Application ID_ when the
> announcement applies to group members only.
>
> The _Source Layer-2 ID_ field in the layer-2 frame carrying the Targeted
> Discovery Request message is set to the Layer-2 ID of UE-1. This Layer-2 ID
> can be statically configured or generated on the fly by UE-1.
Editor\'s note: It is FFS whether the ProSe UE ID and the Layer-2 ID of the UE
can be the same value.
Depicted in Figure 6.1.16.2.2-4 is the procedure for ProSe Discovery through
Communication used for open ProSe discovery based on network interpretation of
ProSe UE ID.
Figure 6.1.16.2.2-4: Beacon procedure for open ProSe discovery
1\. The user of UE-1 (the announcing UE) wishes to advertise a commercial
service to any UE in vicinity. UE-1 broadcasts a Beacon (ProSe_Code) message.
ProSe_Code is the open ProSe discovery announcement information of the
announcing UE. A portion of the ProSe_Code indicates the type of business
allowing the monitoring UEs to filter Beacon messages that they are not
interested in. The rest of the ProSe_Code is opaque and requires network
interpretation in order to be rendered in a message that is meaningful to the
monitoring UE.
The _Destination Layer-2 ID_ field is set to a well-known broadcast Layer-2
ID.
The _Source Layer-2 ID_ field in the layer-2 frame carrying the Targeted
Discovery Request message is set to the Layer-2 ID of UE-1. This Layer-2 ID
can be statically configured or generated on the fly by UE-1.
2\. The monitoring UEs receive the message and perform filtering based on the
ProSe_Code portion indicating the business type. For ProSe_Codes that pass the
filtering test, the UE sends the ProSe_Code to the ProSe Function for
interpretation.
Editor\'s note: The details of the ProSe_Code composition and the procedure
for network-based interpretation of a ProSe_Code are FFS.
#### 6.1.16.3 Impact on existing entities and interfaces
No impact on existing entities or interfaces.
#### 6.1.16.4 Solution evaluation
The solution requires the definition of the following functionality in the RAN
groups:
\- A layer-2 functionality that is common to both ProSe Discovery through
Communication and ProSe direct communication. The common layer-2 functionality
includes at least a Destination Layer-2 ID that can be set to a unicast,
groupcast or broadcast identifier, and a Source Layer-2 ID that is always set
to a unicast identifier.
\- The unicast, groupcast and broadcast identifiers are assumed to have the
same size.
\- A common layer-2 capable of indicating whether the layer-2 payload carries
data or signalling message.
The following signalling messages are carried within the layer-2 payload:
Targeted Discovery Request, Targeted Discovery Response, Targeted Discovery
Ack and Beacon.
### 6.1.17 Solution D17: Targeted ProSe discovery
#### 6.1.17.1 Targeted ProSe Discovery via network control
##### 6.1.17.1.1 Functional description
###### 6.1.17.1.1.1 General
The handling of response for ProSe direct discovery in coverage is depicted in
Figure 6.1.17.1.1-1.
Figure 6.1.17.1.1-1: The handling of direct discovery response in coverage
1\. If the UE-1 is authorised to announce in the PLMN and triggered to find
the UE in the vicinity, it shall sends a ProSe Discovery Request (Target ProSe
Application code, ProSe UE Identity) in the air interface. The Target ProSe
Application code indicates what the target application UE is interested. The
ProSe UE Identity the requesting UE.
2\. UE-2 checks Target ProSe Application code in ProSe Discovery Request
message. If the ProSe Application code is not for Public safety usage and UE-2
determines to send discovery response to UE-1, UE-2 sends ProSe discovery
alert(ProSe UE identity, UE identity) to the serving ProSe Function in the
network. The ProSe UE identity is the identity UE received from the air
interface, i.e. the discoverer UE. The UE identity is the discoveree UE. This
message may also contain certain metadata corresponding to the discoveree UE,
e.g. postal address, phone number, URL etc.
3\. Serving ProSe Function verifies whether the UE-1 is authorized for ProSe
announcing. If allowed, Serving ProSe Function sends ProSe discovery alert to
UE-1.
4\. UE-1 acknowledges the discovery response.
5\. Serving ProSe Function sends ProSe discovery alert confirm to UE-2 to
notice that UE-1 already received the discovery response.
Besides UE-2, UE-3 is also able to send discovery response to the UE-1 by the
procedure same as step 2-5.
In the procedure above, the announcing ProSe UE and the monitoring ProSe UE
are served by the same ProSe Function. If the announcing ProSe UE and the
monitoring ProSe UE are served by the different ProSe Functions, the two ProSe
Functions interact via PC6 reference point to transfer ProSe discovery alert
message.
##### 6.1.17.1.2 Impact on existing entities and interfaces
##### 6.1.17.1.3 Solution evaluation
## 6.2 ProSe Communication
### 6.2.1 Solution C1: ProSe communications in Group Owner mode
#### 6.2.1.1 Functional description
##### 6.2.1.1.1 General
The solution described in this clause addresses the key issue \"ProSe one-to-
many communications\" described in clause 5.12. It is designed to work in or
out of network coverage.
The ProSe Group Owner modes may be used whenever there is a possibility for
stable group ownership, such as the relay use cases (i.e. UE-to-UE Relay and
UE-to-Network Relay). In that sense, the present clause also addresses the
\"Relay for Public Safety ProSe\" key issue described in clause 5.5.
The ProSe Group Owner model may also be used for ProSe one-to-one
communication, described in clause 5.4 as key issue \"ProSe direct
communication one-to-one\".
##### 6.2.1.1.2 System architecture
Depicted in Figure 6.2.1.1.2-1 is the architecture for ProSe communications in
Group Owner mode.
Figure 6.2.1.1.2-1: Architecture for ProSe communications in Group Owner mode
New or enhanced reference points:
**PC5** : This is the \"lower layer\" (ProSe) reference point between a UE and
a UE acting as a ProSe Group Owner. It provides basic IP connectivity between
the two UEs.
The salient features of this architecture are:
\- Before direct communication can be established between two or multiple
ProSe-enabled UEs, these UEs need to become members of the same ProSe Group.
Essentially, a ProSe Group is a private IP network composed by one or more
member UEs that can securely communicate with any IP-based application. Each
ProSe group is characterised by a locally unique identity. The procedure with
which a new ProSe Group is created is called \"group formation\" procedure.
\- One of the UEs in a ProSe Group plays the role of the \"Group Owner\" (UE_3
in Figure 6.2.1.1.2-1) i.e. implements special functionality that facilitates
the group formation and operation. A Group Owner is similar to a wireless
access router: It announces the group (e.g. by broadcasting a certain group
identity) and admits or rejects new UEs that request to become group members.
It also authenticates new group members and provides them with IP
configuration data. The Group Owner creates the group identity with a pseudo-
random fashion so that the group identity can be assumed locally unique, i.e.
unique across all other groups that operate in the same area. A Group Owner
could be dynamically elected.
\- The Group Owner (GO) is within the transmission range of all ProSe Group
members, however, the ordinary (non-GO) ProSe Group members need not be within
transmission range of each other.
\- The GO may act as a synchronization source to all group member UEs
\- There is a clear ProSe Group formation process whereby:
\- Individual members join the ProSe Group by performing mutual authentication
with the GO;
\- Each ProSe Group member is assigned an IP address/prefix by the GO;
\- The ProSe Group members form a distinct IP subnet;
\- All traffic exchanged within the ProSe Group is forwarded via the GO:
\- The group leader behaves also as a communication bridge, i.e. it receives
all transmissions from the group members and (if necessary) forwards the
transmissions to other group members (e.g. based on the L2 or L3 destination
address);
\- Multicast traffic (i.e. traffic destined to some or all ProSe Group
members) sent by an ordinary ProSe Group member is delivered in unicast mode
to the GO, which subsequently distributes it to all ProSe Group members; the
distribution from the GO can be in either unicast or multicast mode (e.g.
depending on the number of ProSe Group members);
\- The GO may be in position to perform a centralised radio resource control
from the GO;
\- The GO may be able to provide some QoS support;
\- Strong security:
\- The GO may be in position to authenticate each UE individually and generate
security material during the group formation process;
ProSe one-to-many communications in Group Owner mode are IP-based. IP packets
are encapsulated within layer-2 frames. As a minimum, the layer-2 frame header
consists of the following fields:
\- Destination Layer-2 ID: this identifier can take the form of either an
individual (unicast) or a group (multicast) identifier; multicast identifiers
are used when the data distribution from the GO to the group members is in
multicast mode;
\- Source Layer-2 ID: this identifier is always set to the individual
(unicast) identifier of the sender\'s device;
Other aspects of the layer-2 frames are in the scope of RAN groups.
UEs engaging in joining the same ProSe Group learn their respective _Layer-2
ID_ s during the group formation process. Multicast _Layer-2 ID_ s (used only
when the Group Owner relies on multicast distribution to other ProSe Group
members) are assigned using application-layer signalling.
#### 6.2.1.2 Procedures
##### 6.2.1.2.1 Procedures for ProSe Group formation
A ProSe Group can be formed either (i) autonomously by one or more UEs without
any network involvement or (ii) with network assistance, as described in the
following two clauses.
##### 6.2.1.2.1.1 Autonomous ProSe Group formation {#autonomous-prose-group-
formation .H6}
The autonomous ProSe Group formation is particularly useful in scenarios where
a ProSe Group needs to be formed outside the network coverage, e.g. to enable
direct communication between public safety UEs that need to handle an
emergency situation in an isolated area or where network coverage is not
available.
Figure 6.2.1.2.1.1-1: ProSe-enabled UEs arranged in ProSe Groups
An autonomous ProSe Group may be created with one of the following ways:
\- A ProSe-enabled UE may create a ProSe Group by autonomously becoming a
Group Owner (see Group D in Figure 6.2.1.2.1.1-1). This UE creates a new group
identity and advertises the existence of the ProSe Group (e.g. by broadcasting
the group identity on designated radio channel(s)) and serves requests from
other ProSe-enabled UEs that want to become group members. In this case, the
ProSe Group starts as a single-member group (the Group Owner is the only
initial member).
\- A ProSe-enabled UE may start a ProSe Group after it discovers (e.g. by
using ProSe direct Discovery) another ProSe-enabled UE in close proximity.
These two UEs negotiate the Group Owner role, i.e. one of them is elected to
function as Group Owner. In this case, the ProSe Group starts as a two-member
group.
An autonomous ProSe Group can be expanded (_i_) when other UEs request to join
the group or (_ii_) when other UEs are invited to join the group. The
invitation to the group is useful when two UEs need to directly communicate,
but they are not members of a common ProSe Group. If, for example, UE-5 is
member of Group B and wants to establish direct communication with UE-8, which
is not a member of Group B, the UE-5 may send an invitation request message to
UE-8 and trigger it to join Group B.
Only the Group Owner can accept new members to the group, thus all join
requests need to be sent to the Group Owner. The Group Owner can be discovered
by its broadcast transmissions. When the Group Owner accepts a new ProSe-
enabled UE to join the group, it provides to this UE the necessary security
information (a pre-shared key) for securing all further communications with
the Group Owner.
When two ProSe-enabled UEs need to establish direct communication, they need
first to create a new ProSe Group. One of these UEs will be assigned the role
of Group Owner and, subsequent to mutual authentication, will provide IP
configuration information to the other UE. If necessary, the group may be kept
closed by rejecting other UEs to join this group.
An autonomous ProSe Group can be created by using E-UTRA Rel-12 radio
technology.
Editor\'s note: It is FFS if WiFi Direct can also be used for autonomous ProSe
Group formation.
##### 6.2.1.2.1.2 Group Formation with Network Assistance {#group-formation-
with-network-assistance .H6}
> Editor\'s note: To be completed.
#### 6.2.1.3 Impact on existing entities and interfaces
The solution has no specification impact on existing RAN entities.
The solution has no specification impact on existing EPC entities.
#### 6.2.1.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
The solution presents the following advantages:
\- Allows for common synchronisation clock, centralised medium access control
and centralised IP address assignment, the GO being in the role of
synchronisation source, medium access control coordinator and DHCP
server/relay, respectively.
\- The GO is well-suited to serve as UE-to-Network Relay.
\- Supports 1:1 communication (one of the two UEs acting as a GO).
\- The GO can serve as a centralised authenticator (i.e. mutual authentication
is required between each group member and the GO only, but is not needed
between each pair of group members).
\- ProSe communication is protected using dynamic security keys generated upon
mutual authentication.
The solution presents the following drawbacks:
\- The GO is a single point of failure.
Figure 6.2.1.4-1: Layer-2 frame format for C1 (shared in common with C5 and
D3)
The solution requires the definition of the following functionality in the RAN
groups:
\- A layer-2 frame header (see Figure 6.2.1.4-1) containing at least a
Destination Layer-2 ID that can be set to a unicast, groupcast or broadcast
identifier, and a Source Layer-2 ID that is always set to a unicast
identifier.
\- The unicast, groupcast and broadcast identifiers are assumed to have the
same size.
\- Centralised medium access control protocol controlled from the GO.
### 6.2.2 Solution C2: Direct communications point to point with authorization
based on application-defined Group ID and system provided ProSe ID
#### 6.2.2.1 Functional description
This solution is expected to apply for all direct communication cases (in and
(for Public Safety UE\'s) out of coverage). It is assumed the calling party UE
knows the Group ID and the ProSe ID (which also is or maps to radio link layer
addresses) of the communication peer (called party), perhaps after a targeted
discovery process or by pre-configuration or auto-configuration.
As per Targeted discovery based on application-defined Group ID and system
provided ProSe ID defined in clause 6.1.6, the Group Id is also associated to
a secret that may be used for application layer encryption. The network may
provide additional encryption keys for UE\'s in coverage, however the Group
secret may be used when UE are out of coverage for encryption. During the
authorization process, for UE\'s under network coverage, the eNB may also get
configured also with information related to transmission (e.g. applicable
radio resources information). The UE also may receive additional configuration
information (like security keys). Default configuration information sufficient
to perform communication is assumed for Public safety UE\'s operating out of
coverage. It also assumed that, if application level authorization was
required by the operator, the MME can reach an application server for
application layer validation and authorization of communications. This may be
triggered e.g. by the specific application used or subscription of the UE\'s.
The address of this application server (or its FQDN) may be provided by the UE
or it could be, if the application group is supported directly by the operator
via a business agreement, resolved locally by the MME based on the received
value of the Group ID. The MME may reject the establishment of the direct link
even if the application server may grant it, based on 3GPP layer
considerations alone.
If direct communication is rejected, the UE\'s, if they are under network
coverage, may continue to communicate via the infrastructure as they are
assumed to have an active default PDN connection as they are in connected mode
in EUTRAN while the authorization procedure is ongoing.
UE\'s can exchange direct communication establishment signalling using the
discovery channel. This makes it possible to asynchronously enter into
communication without the need of network initiated paging.
A possible system architecture for the case of UE\'s under coverage is the
following (omitting explicitly calling out the two UE\'s):
Figure 6.2.2.1-1
The user plane path to the application server is optional and is used
primarily for application registration and UE configuration. The optional
ProSe authorization interface is shown as a direct logical interface between
MME and the ProSe application, but in principle the S11-S5 path may mediate
the application interaction, via a PCRF Rx interface.
#### 6.2.2.2 Procedures
The following procedures are instrumental to the establishment of a direct
communication link point to point between two ProSe enabled UE\'s, whether
one, both or none of them are under network coverage. The establishment of a
data link entails instructing the entities involved (UE\'s and, if in
coverage, eNB\'s) on the terms of the communication establishment.
Under network coverage the eNB\'s involved in communication (the ones where
the UE is in RRC connected state when while the procedure for establishment of
the data link are ongoing) are involved in getting the communication
authorized and set up. The message flow in Figure 6.2.2.2-1 here below is an
example of how this could work.
{width="6.677777777777778in" height="4.573611111111111in"}
Figure 6.2.2.2-3: Case of two UE\'s under network coverage ( if dashed lines
apply) or out of coverage (dashed line does not apply)
UE A is the initiator of direct communication. UE B is the called party. It is
assumed in step 1 the initiator contacts the called party using the discovery
channel as a medium for session set up signalling, using the ProSe ID of the
target as address.
If UE B accepts communication establishment, it would respond on the discovery
channel using the ProSe ID of the calling party as address.
At the end of step 2, both UE\'s know if the peer has accepted direct
communication and know whether the peer is in or out of coverage of one eNB
(as this information is exchanged between the UE\'s).
At this stage the UE\'s, if they are under coverage, enter, if they were not
already, RRC connected state in the respective radio access node and start the
authorization steps.
The UE initiating the communication in step 1 appears to its MME as the one
asking for communication authorization (possibly also at application level),
using the ProSe ID\'s that are assigned by the network to the UE\'s. For the
eNB to be able to resolve the MME the UE is homed to, the ProSe ID must
implicitly identify the MME the UE is homed to. The IP address or the name of
the server where the MME needs to optionally check for application layer
authorization and maybe obtain data volume quotas and possibly other necessary
information, is provided by the UE\'s (another option is that the name of the
application is resolved to the right IP address by the MME based on business
agreements, solely based on a agreed-upon Group ID). The Application is
assumed to have the current ProSe ID available for the two UE\'s available via
a registration mechanism.
The \"in coverage indication flags\" indicate which of the two parties is in
coverage. In the case depicted in figure 1, both UE\'s notify the other UE
they are in coverage, so these flags are set to true.
It should be noted that the message for communication authorization include
first the ProSe ID of the initiator of communication and second the called
party ProSe ID. The in coverage indication flags provide the network with
information as to whether the called and calling party are in coverage.
In the message flow indicated in figure 6.2.2.2-1 here above both parties are
in coverage when the dashed lines apply also. Otherwise when the UE\'s are out
of network coverage the respective dashed lines do not apply.
The MME of the calling party is in charge of asking for authorization if the
calling party is in coverage. Otherwise it will be the called party MME as in
figure 6.2.2.2-2. When none of the UE\'s is in coverage, no authorization step
is assumed and local authorization to direct communication out of network
coverage is assumed for public safety UE\'s.
It should be noted that the MME obtaining authorization from the application
(i.e. the calling party MME, as per the flow above) , contacts the MME of the
other UE only in case both UE\'s are under coverage, as per figure 6.2.2.2-1.
When the Calling party UE is not under coverage, then MME and eNB of the
called party (if different from those of the calling party) would be in charge
to request authorization, as described in figure 6.2.2.2-2. In this case the
in coverage flag of the calling party is set to FALSE and the MME of called
party takes action to get application level authorization and will not wait
for a message from the MME of the calling party.
Figure 6.2.2.2-4: Direct communication when the called party UE only is in
coverage
Conversely, when only the calling party is in coverage, the MME and eNB of the
calling party only (if different if different from those of the called party)
would be involved in communication authorization and set up, as depicted in
figure 6.2.2.2-3. In this case the in-coverage flag of the called party would
be set to FALSE and the MME of the calling party would not send an
authorization message to the called party MME as in figure 6.2.2.2-1.
Figure 6.2.2.2-5: Direct communication when the calling party UE only is in
coverage
When the Two UE\'s are finally authorized to communicate the UE\'s receive
from the MME(s) also transmission parameters configuration (including e.g.
secret keys, frequencies, power range, QoS, filters to determine which traffic
should go on direct link and which on infrastructure path). In absence of
network coverage it is assumed that transmission parameters are pre-configured
in the UE. Also application layer encryption may be adopted if link layer
encryption was not available outside network coverage. Some transmission
parameters also apply to the eNB.
At step 10 in figure 6.2.2.2-1, or 8 in figure 6.2.2.2-2 and 6.2.2.2- 3,
direct communications is started. This step may include RAN signalling between
or with UE\'s out of coverage to further coordinate transmission. During this
phase the initiator acts as DHCP server for IP address assignment on the Link,
unless the called party acts as a relay, and the calling party is not a relay,
in which case the IP address is assigned by the called party.
Also, throughout the procedures, the Radio network nodes may coordinate e.g.
via X2 for optimal transmission, but this is not in scope of SA2 study and
more in scope of RAN activities, so this detail is not provided here.
If the UE\'s are not authorized to use ProSe, they (if applicable) can
continue to communicate via the infrastructure as they are already in RRC
connected state.
#### 6.2.2.3 Impact on existing entities and interfaces
**MME:**
\- needs to be able to issue and maintain the ProSeID.
\- need to support interactions with eNB\'s and applications for ProSe direct
communications authorization.
**eNB:**
\- must enable the transmission on a broadcast discovery channel using
unicastaddress (ProSe ID) and group address (Group ID) as well as to all
devices.
\- must support the direct communications links transmissions.
\- must be involved in direct link set up.
**UE:**
\- must register for ProSe at application and 3GPP layer, must support
discovery channels and the related RAN layer procedures.
#### 6.2.2.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.2.3 Solution C3: Network independent LTE direct communication (one-to-
one)
#### 6.2.3.1 Functional description
As defined in clause 4.1.1 two different modes for ProSe direct communication
need to be supported for ProSe \"one-to-one\" direct communication.
This solution defines procedures for the network independent mode.
The different phases that occur before the direct communication between two
UEs can commence over IP are the following:
1\. Discovery phase: the originating UE has discovered the UE that is
interested to initiate communication to.
The procedures of the Discovery phase for this solution alternative are
described in different clauses.
NOTE: This phase may not be needed for public safety scenarios.
2\. Direct connectivity phase: the originating UE is performing direct alert
(similar to the paging procedure in the WAN case) and initiates the process to
setup the direct connection. This involves exchanging RRC and NAS signalling
to exchange information like IP addresses, QoS etc. Session keys are also
being setup at this phase.
3\. Direct communication phase: the originating UE is initiating direct
communication (over IP) with the terminating UE. This involves any form of
\"over IP\" signalling as/if required e.g. SIP to setup a VoIP session
The following assumptions apply as part of this solution alternative and are
applicable to ProSe-enabled Public Safety UEs only:
\- Security material for direct communication is (pre-)provisioned in the UEs.
\- Direct connection is initiated \"autonomously\" between the UEs in
resources provisioned by the ProSe Function or RAN e.g. via SIB when the UE is
\"in coverage\".
\- No direct connection context kept when the UE is not in Direct-connected
state.
Editor\'s note: The concept of QoS for direct communication is FFS and so is
whether dedicated direct bearers will be needed/used. This will also depend on
the capabilities of AS layers.
#### 6.2.3.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
##### 6.2.3.2.1 Autonomous direct connection Setup
As described in clause 6.2.3.1 this procedure makes use of the discovery
solution 1, and is only applicable to an authorized ProSe-enabled Public
Safety UE.
Figure 6.2.3.2.1-1: Autonomous direct connection Establishment procedure
1\. Optional Discovery procedure as defined in different clauses.
2\. The originating and terminating UEs if authorized using direct radio
signals to allow the UEs to establish radio link.
NOTE 1: More details about this step to be defined in RAN WGs.
3\. The originating UE sends direct connection request including a Connection
id and security parameters to establish the direct bearer.
4\. Authentication is performed, based for example on pre-provisioned UE-
specific digital certificates.
NOTE 2: More details about this step to be defined in SA WG3 TR.
5\. If authentication is successful, the terminating UE sends a Direct
Connection Accept message including the connection id the IP address of UE-2
used for direct communication (if available) and proposed QoS parameters for
the bearer. Other parameters are FFS.
6\. The originating UE sends a Direct Connection Complete message with
connection id, (if available) the IP address of UE-1 used for communication
and acceptance of the QoS parameters used for communication. Other parameters
are FFS.
Editor\'s note: It is FFS whether the QoS for the default bearer could be
exchanged in earlier steps.
7\. The direct radio bearer is setup and communication can start.
#### 6.2.3.3 Configuration information direct communication
The following information is provisioned for autonomous direct communication
one-to-one:
**Authorization for direct communication**
Is the UE authorized to perform direct communication in this PLMN? (yes/no):
\- This information always comes from the registered PLMN.
Is the ProSe enabled Public Safety UE authorized to \"autonomous connection
procedures\" in this PLMN? (yes/no):
\- This information always provided from the registered PLMN.
**Additional information**
For \"out of E-UTRAN coverage\" operation also the resources (e.g. frequency
bands) that the UE would use for direct services need to be provisioned.
This information can be common for direct discovery and communication and
indicates to the UE, what are the resources (e.g. frequency bands used) that
are provided in the registered PLMN for direct discovery and communication:
\- This information always provided from the registered PLMN.
In cases where the registered PLMN cannot provide any resources for direct
communication e.g. out of E-UTRAN coverage, the UE is pre-provisioned with a
list table that indicates the resources (e.g. frequency bands used) per
different location:
\- This information can be provided from HPLMN.
#### 6.2.3.4 Direct bearer concept
The direct bearer can be considered similar to the concept to EPS bearer in
case of WAN communication.
Figure 6.2.3.4-1: Direct bearer concept- autonomous connection
Editor\'s note: The concept of D2D TFT, whether it is needed, how it is
provisioned and whether it can be expanded when the UE is \"out of E-UTRAN
coverage\" is FFS.
##### 6.2.3.4.1 IP address allocation
IPv6 only IP address is used for the direct link.
The UE auto-configures a link local IPv6 Address following procedures defined
in RFC 4862 [12]. This address can be used for direct communication with
another UE as long as no session continuity to the WAN is required.
In addition to that the UE may use a /64 IPv6 prefix that is locally stored to
form a globally unique address.
Editor\'s note: It is FFS how the /64 IPv6 prefix is provisioned in the UE for
the \"autonomous direct connection use\" that can happen when the UE is \"out
of coverage\". Options include: a) provisioned, b) provided during PDN
connection establishment (as per normal procedures) and not released when the
UE goes \"out of coverage\". Other options are FFS.
Editor\'s note: Other mechanisms for allocation of IP address e.g. DHCP are
FFS.
#### 6.2.3.5 Direct Connection Management States
The Direct Connection Management States in the UE are defined for the
signalling connection on the U2 reference point.
##### 6.2.3.5.1 DCM-IDLE
A UE is in DCM-IDLE state when no NAS signalling connection or context exists
between the UE and any other UE. When at this state the UE shall monitor the
relevant radio resources for Direct Alert signalling.
The UE shall enter the DCM-CONNECTED state when a signalling connection is
established with at least one other UE. The initial NAS message that initiates
a transition of the UE from DCM-IDLE to DCM-CONNECTED state is the Direct
Connection Request.
##### 6.2.3.5.2 DCM-CONNECTED
For a UE in the DCM-CONNECTED state, there exists a signalling connection
between the UE and at least another UE. When at this state the UE continues to
monitor the relevant radio resources for Direct Alert signalling.
The UE stays at this state if signalling connections are established with
additional UEs.
The UE shall enter the DCM-IDLE state when its signalling connections to all
other UEs have been released or broken. This release or failure is explicitly
indicated to the UE or detected by the UE.
##### 6.2.3.5.1 State Transition and Functions
Figure 6.2.3.5.1-1: DCM state model in the UE
Editor\'s note: The time it is required to switch from DCM_CONNECTED to
DCM_IDLE is FFS.
#### 6.2.3.6 Mobility aspects
Editor\'s note: Mobility and service continuity aspects for the autonomous
case are FFS.
#### 6.2.3.7 Operational aspects
##### 6.2.3.7.1 Lawful intercept
Editor\'s note: Lawful intercept aspects for the autonomous case are FFS.
##### 6.2.3.7.2 Accounting
Reporting of data by the UE that can be used by a server in the network that
is defined for this purpose can be triggered at any time. The UE can be
configured to periodically report data to this server for accounting purposes
via a secure interface if needed.
NOTE: The reporting can use over IP protocols or any form of small data
interface that exists (e.g. SMS) or any other possible small data mechanism
that could be defined in Rel-12.
For the specific cases of \"out of E-UTRAN coverage\" the UE can be expected
to report data to the network that could be used for accounting purposes if
needed when it goes back into E-UTRAN coverage.
Editor\'s note: Whether such UE-provided info can be considered a trusted
source of information to base accounting procedures on or whether other
solutions need to be developed is subject to SA WG3/SA WG5 evaluation.
#### 6.2.3.8 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
**UE:**
\- Support of discovery procedures.
\- Support for autonomous direct connection procedures defined in this clause.
\- Support for authorization and provisioning from the ProSe Function.
#### 6.2.3.9 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.2.4 Solution C4: Network-authorized LTE direct communication (one-to-
one)
#### 6.2.4.1 Functional description
As defined in clause 4.1.1 two different modes for ProSe direct communication
need to be supported for ProSe \"one-to-one\" direct communication.
This solution defines procedures for the network authorized mode.
The different phases that occur below before the direct IP communication
between two UEs can commence are the following:
1\. Discovery phase: the originating UE has discovered the UE that is
interested to initiate communication to. The procedures of the Discovery phase
for this solution alternative are described in different clauses.
NOTE: This phase may not be needed for public safety scenarios.
2\. Network assistance for direct connection establishment: the originating
and terminating UEs exchange signalling with the network before they establish
the direct connection. This may involve obtaining authorization for using
ProSe direct communication and obtaining direct communication parameters such
as security keys, etc.
3\. Direct connectivity phase: the originating UE initiates the process to
setup the direct connection. This involves exchanging RRC and NAS signalling
to convey information like IP addresses, QoS etc. Session keys are also being
setup at this phase.
4\. Direct communication phase: the originating UE is initiating direct
communication (over IP) with the terminating UE. This involves any form of
\"over IP\" signalling as/if required e.g. SIP to setup a VoIP session.
The following assumptions apply as part of this solution alternative and are
applicable to all ProSe-enabled UEs under E-UTRAN coverage:
\- Network-authorized direct communication can only apply between two UEs in
the same serving MME or different MMEs;
Editor\'s note: The case of UEs in different serving MMEs is FFS.
\- Direct connection setup shall always involve the network. The UE exchanges
signalling with the network in order to obtain authorization and obtain
security keys that could be used for confidentiality and integrity protection
of direct connection;
\- ProSe-enabled UEs will always be in ECM-CONNECTED to network when
attempting/performing direct communications;
\- RAN control can apply to the direct bearer and can also trigger termination
of the direct connection e.g. due to Radio Resource Management reasons;
\- Security keys are provided by the serving MME;
\- Each direct bearer can be mapped \"one-to-one\" with an equivalent EPS
bearer in order to facilitate path switch between direct connection and
infrastructure;
\- Revocation of authorization of the direct bearer from the network (e.g.
with network initiated context modification) requires the bearer to be moved
back to the network;
\- When the UE is not in connected state in direct mode i.e. when the direct
communication terminates, the context in the two UEs is dropped. The direct
\"inactivity timer\" can be in sync associated with the network inactivity
timer i.e. the UE to release the direct context when it transitions to idle
mode w.r.t. the network.
Editor\'s note: The concept of QoS for direct communication is FFS and so is
whether dedicated direct bearers will be needed/used. This will also depend on
the capabilities of AS layers.
#### 6.2.4.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
##### 6.2.4.2.1 Network Authorized Direct connection setup
Figure 6.2.4.2.1-1: Network-authorized direct connection establishment
procedure
1\. Discovery procedure.
2\. The originating UE performs the network authorized procedures as defined
in clause 6.2.4.2.1.1 in order to obtain authorization for establishing a
direct connection and obtain keys from the network. The keys are exchanged and
the connection is authorized by the terminating network and accepted by the
terminating UE following the procedures defined in next clauses.
The following steps are almost identical to the network independent direct
connection establishment procedure.
3\. The originating and terminating UEs if authorized use direct radio signals
to allow the UEs to establish direct link.
NOTE 1: More details about this step to be defined in RAN WGs.
Editor\'s note: It is FFS whether this step is necessary for the network
authorized case, or it can be fulfilled via the eNB e.g. in step 2.
4\. The originating UE sends Direct Connection Request including security
parameters to establish the direct bearer.
5\. Security procedures are performed, including security keys exchange. The
UEs are using the keys obtained from the network as part of the network
authorized originating and terminating procedures.
NOTE 2: More details about this step to be defined in SA WG3 TR.
6\. The terminating UE sends a Direct Connection Accept message including the
IP address of UE-2 used for direct communication and proposed QoS parameters
for the bearer. Other parameters are FFS.
7\. The originating UE sends a Direct Connection Complete message with the IP
address of UE-1 used for communication and acceptance of the QoS parameters
used for communication. Other parameters are FFS.
Editor\'s note: It is FFS whether the QoS for the default could be exchanged
in earlier steps.
8\. The direct radio bearer is setup and communication can start.
###### 6.2.4.2.1.1 Network authorized Direct Connection originating procedure
This procedure is followed by the UE in order to obtain authorization from the
network and also all the parameters needed to establish direct communication
with another UE served by the same MME.
Figure 6.2.4.2.1.1-1: Network authorized Direct Connection originating
procedure
0\. UE-1 is EPS attached and is idle or active mode.
1\. If discovery is used the originating UE discovers the UE of interest.
2\. The originating UE sends Extended Service Request message for originating
direct connectivity that includes the expression code of the terminating UE
obtained. Other parameters are FFS.
Editor\'s note: How the MME will find the terminating UE identity is FFS.
Editor\'s note: The case of UEs in different serving MMEs is FFS.
3\. Step 3 corresponds to steps 3\~12 of clause 5.3.4.1 of TS 23.401 [11]
without any modification and is performed in order to establish the EPS
bearers the UE has active at the time.
4\. The MME --based on the information received from the UE in step 2-- finds
the terminating UE and proceeds with the rest of the procedures described in
clause 6.2.4.2.1.2 or clause 6.2.4.2.1.3 depending on whether the UE is in
idle or active mode w.r.t. the network.
Editor\'s note: This signalling step included in this \"box\" (terminating
procedures) can happen in parallel to some of the following steps.
5\. MME S1-AP Initial Context Update message indicating direct connection
established is sent to the eNB. This message also includes the association
between the EPS bearer(s) and corresponding direct bearer(s) to be
established. As part of this message, MME sends an Activate Direct Connection
message indicating to UE to start the direct connection procedure. This
message also provides the direct communication security material to the UE.
6\. The eNodeB sends RRC reconfiguration message indicating the activation of
direct Connection that triggers UE-1 to start the direct connection procedure
to establish the direct radio bearer.
7\. The eNodeB confirms the allocation of resources and sends an S1-AP message
to MME.
8\. The two UEs perform steps 3\~8 in clause 6.2.4.2.1 to establish the direct
radio bearer.
###### 6.2.4.2.1.2 Network Authorized direct Connection Terminating Procedure
in Idle mode
This procedure is followed when the UE on the terminating side is in idle mode
w.r.t. the network. It is used to obtain authorization from the network and
also all the parameters needed to establish direct communication with another
UE to originate the connection.
Figure 6.2.4.2.1.2-1: Network authorized direct Connection terminating
procedure in idle mode
1\. Network Authorized direct connection procedures defined in clause
6.2.4.2.1.1 steps 1\~2.
2\. MME sends a paging request indicating paging for a direct connection.
3\. The terminating UE sends Extended Service Request message for originating
direct connectivity. Other parameters are FFS.
4\. Step 3 corresponds to steps 3\~12 of clause 5.3.4.1 of TS 23.401 [11]
without any modification and is performed in order to establish the EPS
bearers the UE has active at the time.
5\. MME S1-AP Initial Context Update message indicating that the direct
Connection is established is sent to the eNB. This message also includes the
association between the EPS bearer(s) and corresponding direct bearer(s) to be
established. As part of this message, MME sends an Activate Direct Connection
message indicating to UE to start the direct connection procedure. This
message also provides the direct communication security material to the UE.
6\. The eNodeB sends RRC reconfiguration message indicating the activation of
direct Connection that will trigger UE-1 to start the direct connection
procedure.
7\. The eNodeB confirms acceptance and sends an S1-AP message to MME.
8\. The two UEs perform steps 3\~8 in clause 6.2.4.2.1 to establish the direct
radio bearer.
##### 6.2.4.2.1.3 Network Authorized direct Connection Terminating Procedure
in active mode {#network-authorized-direct-connection-terminating-procedure-
in-active-mode .H6}
This procedure is followed when the UE on the terminating side is in active
mode w.r.t. the network. It is used to obtain authorization from the network
and also all the parameters needed to establish direct communication with
another UE to originate the connection.
Figure 6.2.4.2.1.3-1: Network Authorized direct Connection Terminating
Procedure in active mode
1\. Network Authorized direct connection procedures defined in clause
6.2.4.2.1.1 steps 1\~2.
2\. MME sends a paging notification for a direct connection. The eNodeB
forwards the paging message to the UE indicating direct connection. This
message is sent over the existing RRC connection of the UE.
3\. The terminating UE sends Extended Service Request message for originating
direct connectivity. Other parameters are FFS.
4\. The MME sends S1-AP Initial Context Setup Request message indicating
direct Connection to the eNodeB. This message also includes the association
between the EPS bearer(s) and corresponding direct bearer(s) to be
established. As part of this message, MME sends an Activate Direct Connection
message indicating to UE to start the direct connection procedure. This
message also provides the direct communication security material to the UE.
This step also activates the radio and S1 bearers for all the active EPS
Bearers (as in clause 5.3.4.1 of TS 23.401 [11]).
5\. The eNodeB sends RRC reconfiguration message indicating the activation of
direct Connection that will trigger UE-2 to start the direct connection
procedure. At this step the authorization from the RAN for using direct
communication is performed. It is also indicated the activation of direct
Connection that will trigger UE-2 to start the direct connection procedure,
e.g. start monitoring the radio resources for direct alert messages.
6\. The eNodeB confirms acceptance and sends an S1-AP message to MME.
7\. The two UEs perform steps 3\~8 in clause 6.2.4.2.1 to establish the direct
radio bearer.
#### 6.2.4.3 Configuration information for direct communication
The following information is provisioned for network authorized direct
communication one-to-one:
**Authorisation for direct communication**
Is the UE authorized to perform direct communication in this PLMN? (yes/no):
\- This information always comes from the registered PLMN.
#### 6.2.4.4 Direct bearer concept
The direct bearer can be considered similar to the concept of EPS bearer in
the case of WAN communication.
{width="6.6618055555555555in" height="1.7215277777777778in"}
Figure 6.2.4.4-1: Direct bearer concept
Editor\'s note: Whether the concept of D2D TFT is needed and how it is
provisioned and whether it can be expanded when the UE is \"out of E-UTRAN
coverage\" is FFS.
##### 6.2.4.4.1 IP address allocation
IPv6 only IP address is used for the direct link.
For the network-authorized case, the IP address can be linked to a EPS bearer
and use the /64 IPv6 prefix that is assigned to the associated EPS bearer and
allocated via one of the mechanisms defined for IPv6 prefix allocation in TS
23.401 [11].
#### 6.2.4.5 Direct Connection Management States
The Direct Connection Management States in the UE are defined for the
signalling connection on the U2 reference point.
In the network-authorized procedure, the UE Direct Connection Management
States will be synchronised with the ECM states.
##### 6.2.4.5.1 DCM-IDLE
A UE is in DCM-IDLE state when no NAS signalling connection or context exists
between the UE and any other UE.
The UE shall enter the DCM-CONNECTED state when a signalling connection is
established with at least one other UE. The initial NAS message that initiates
a transition of the UE from DCM-IDLE to DCM-CONNECTED state is the Direct
Connection Request.
##### 6.2.4.5.2 DCM-CONNECTED
For a UE in the DCM-CONNECTED state, there exists a signalling connection
between the UE and at least another UE.
The UE shall enter the DCM-IDLE state when its signalling connection to the
other UE has been released or broken. This release or failure is explicitly
indicated to the UE or detected by the UE.
When a UE changes to DCMâ€‘CONNECTED state and if a direct radio bearer cannot
be established, or the UE cannot maintain a bearer in the DCM-CONNECTED state,
the corresponding direct bearer is transferred to the network.
The DCM-CONNECTED state in the UE is always synchronised with the ECM-
CONNECTED state w.r.t. the network. That is, if the UE is in the DCM-CONNECTED
state w.r.t. at least one other UE, then that UE must also be in the ECM-
CONNECTED state w.r.t. the network if under E-UTRAN coverage.
##### 6.2.4.5.1 State Transition and Functions
Figure 6.2.4.5.1-1: DCM state model in the UE
#### 6.2.4.6 Mobility Aspects
Editor\'s note: Mobility and service continuity aspects for the autonomous
case are FFS.
#### 6.2.4.7 Operational aspects
Operational aspects for accounting, lawful interception need to be defined for
direct services based on the SA1 requirements.
##### 6.2.4.7.1 Lawful interception
In this solution this is based on the disabling of the direct Path so that
traffic goes via the EPC. Then the interception is happening as normal over
the EPC and should be transparent to user since this is controlled from the
network like e.g. SIPTO activation. The detailed requirements and procedures
will be defined in SA WG3 and SA WG3-LI Group.
##### 6.2.4.7.2 Accounting
Reporting of data by the UE that can be used by a server in the network that
is defined for this purpose can be triggered at any time. The UE can be
configured to periodically report data to this server for accounting purposes
via a secure interface if needed.
NOTE: The reporting can use over IP protocols or any form of small data
interface that exists (e.g. SMS) or any other possible small data mechanism
that could be defined in Rel-12.
Editor\'s note: Whether such UE-provided info can be considered a trusted
source of information to base accounting procedures on or whether other
solutions need to be developed is subject to SA WG3/SA WG5 evaluation.
#### 6.2.4.8 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
**UE**
\- Support of discovery procedures
\- Support of network authorized connection establishment procedures described
in this clause
\- Support for authorization and provisioning from ProSe Function
**MME**
\- Support network authorized connection establishment described in this
clause:
\- Authorisation for direct connection setup
\- Mapping of direct connection bearer to EPS bearer
\- Determination that two UEs are served by the same MME based on the
discovery information
\- Security procedures, providing security keys to the UEs for the direct
connection
**RAN**
\- Support network authorized connection establishment described in this
clause
\- Authorisation and control of the radio resources used for direct connection
#### 6.2.4.9 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.2.5 Solution C5: ProSe communications in Ad-Hoc mode
#### 6.2.5.1 Functional description
##### 6.2.5.1.1 General
The solution in this clause addresses the key issue \"ProSe one-to-many
communications\" described in clause 5.12. It is designed to work out of
network coverage, but can also be used when in coverage.
It is assumed that a UE supporting ProSe Ad-Hoc mode also supports ProSe Group
Owner mode described in clause 6.2.1. The user explicitly selects one or the
other mode when wishing to engage in ProSe one-to-many communications.
The ProSe Ad-Hoc mode should be used when the use of the ProSe Group Owner
model is not possible (e.g. independently moving users, no apparent candidate
for Group Ownership).
##### 6.2.5.1.2 System architecture
Depicted in Figure 6.2.5.1.2-1 is the architecture for ProSe one-to-many
communications in Ad-Hoc mode.
Figure 6.2.5.1.2-1: Architecture for ProSe one-to-many communications in Ad-
Hoc mode
New or enhanced reference points:
**PC5ah** : This is the \"lower layer\" (ProSe) reference point among UEs that
reside within transmission range. It provides layer-2 multicast connectivity.
The salient features of this architecture are:
\- It is entirely distributed (no single point of failure);
\- When sending traffic to a group of receivers, the sender uses a multicast
address in the Destination Layer-2 ID field of the layer-2 data frame;
\- Collision detection on the transmitter\'s side needs to be resolved due to
the exclusive use of multicast delivery;
\- There is no QoS support;
\- The communication in the Ad-Hoc network is layer-2 based (no IP; see
NOTE1);
\- Confidentiality and data integrity is enabled via static security keys
configured in each UE. The sender of a data frame is authenticated implicitly
- by being able to successfully encrypt the data using the static keys. On the
receiving side, only UEs that are in possession of the static keys are able to
successfully decrypt the received frames;
\- There is no possibility for centralised floor control for Push-to-Talk
applications. (An example of distributed floor control that works in
conjunction with ProSe Ad-Hoc mode is provided in Annex A.3.1).
NOTE 1: From functional perspective there is no need for IP communication in
the described architecture. However, addition of an IP \"shim\" layer in the
protocol stack may be beneficial from implementation perspective.
As a minimum, the header of the layer-2 frame consists of the following
fields:
\- Destination Layer-2 ID: this identifier can take the form of a group
(multicast) identifier;
\- Source Layer-2 ID: this identifier is always set to the individual
(unicast) identifier of the sender\'s device;
The frame payload can contain various types of user data, including signalling
messages for floor control, talk bursts, etc.
For each GCSE Group of which it is a member the Public Safety UE is configured
with the following data:
\- Layer-2 Group ID - a layer-2 identifier uniquely identifying this GCSE
Group, and
\- Group Master Key - a static security key that is common for all members of
this GCSE Group. This key is used for derivation of encryption and integrity
protection keys for all traffic sent within the group.
NOTE 2: In addition to being uniquely identified by the Layer-2 Group ID, a
GCSE Group may also be identified at the application layers via a unique App
Group ID (e.g. a SIP URI in the following format:
sip:fire.brigade75@firstresponder.net). There is a 1:1 relationship between
App Group ID and Layer-2 Group ID. The configuration of Layer-2 Group ID and
App Group ID in the UE allows for consistent GCSE Group membership, regardless
whether the UE takes part in GCSE Group communication in ProSe Group Owner or
ProSe Ad-Hoc mode or via a direct network connection. Refer to Annex A.3.1 for
a possible GCSE Group identifier usage with distributed floor control and
ProSe Ad-Hoc communication.
All layer-2 frames carry Layer-2 Group ID in the Destination Layer-2 ID field.
This applies both to frames carrying signalling messages for floor control and
frames carrying user data. The Source Layer-2 ID field in all frames is set to
the layer-2 identifier of the sender\'s device. Upon reception of a layer-2
frame the receiver checks the Destination Layer-2 ID field to see whether it
belongs to a GCSE Group of which it is a member. In the affirmative case the
receiver proceeds by decryption of the frame payload using the static keys;
otherwise, it discards the whole frame.
#### 6.2.5.2 Procedures
Editor\'s note: The PC5ah procedures for frame transmission are in the RAN
realm. To support this solution the RAN groups need to define a mechanism for
efficient collision detection on the transmitter side due to the exclusive use
of multicast delivery.
#### 6.2.5.3 Impact on existing entities and interfaces
The solution has no specification impact on existing RAN entities.
The solution has no specification impact on existing EPC entities.
#### 6.2.5.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
The solution presents the following advantages:
\- No need for ProSe group formation prior to frame transmission (i.e. no
notion of \"ProSe group joining\").
\- Fully distributed architecture: all UEs being equal, there is no single
point of failure.
The solution presents the following drawbacks:
\- ProSe communication is protected using static (pre-configured) security
keys;
\- No QoS support.
Figure 6.2.5.4-1: Layer-2 frame format for C5 (shared in common with C1 and
D3)
The solution requires the definition of the following functionality in the RAN
groups:
\- A layer-2 frame header (see Figure 6.2.5.4-1) containing at least a
Destination Layer-2 ID that can be set to a unicast, groupcast or broadcast
identifier, and a Source Layer-2 ID that is always set to a unicast
identifier.
\- The unicast, groupcast and broadcast identifiers are assumed to have the
same size.
\- Distributed medium access control protocol, preferably with priority access
support.
\- Mechanism for efficient collision detection on the transmitter side due to
the exclusive use of multicast delivery.
### 6.2.6 Solution C6: LTE direct communication (one-to-many)
#### 6.2.6.1 Functional description
This solution for ProSe one-to-many communication includes both ProSe
broadcast and ProSe multicast modes:
\- ProSe broadcast mode is a transport service that is supported by ProSe
enabled Public Safety UEs to deliver data to all potential UEs in the
proximity regardless of their group membership.
\- ProSe multicast mode is a transport service to deliver data only to the UEs
in the proximity that are members of a group. More about the formulation of
this group is described in clause 6.2.6.2.
NOTE: How to support broadcast and multicast mode \"over the air\" will be
clarified in RAN WGs.
The solution presented here is based on IP communication. Generally, the
direct one-to-many communication is initiated in network independent manner
among the UEs in the proximity with resources provisioned by DPF or semi-
statically by RAN (e.g. via a new SIB) when the UE is \"in coverage\".
The following steps occur before the direct one-to-many communication among
UEs can commence over IP:
1\. Group Configuration. This may involve setting up groups (e.g., talk-groups
for public safety voice communication) with a common group identifier. Part of
this configuration may involve authorizing UEs to participate in one-to-many
ProSe communication, provisioning security credentials for one-to-many ProSe
communication sessions, provisioning individual IP address for the UE,
priority for the groups handling and an IP multicast address for the groups
where the UE has the group membership.
2\. Optional Discovery phase: the originating UE discovers the UEs which have
the same group membership.
The procedures of the Discovery phase for this solution alternative are
described in different clauses.
3\. Direct communication phase (one-to-many): the originating UE is initiating
and starting direct one-to-many communication (over IP) with the terminating
UEs.
#### 6.2.6.2 Group in ProSe one-to-Many communication
##### 6.2.6.2.1 Concept description
An application layer group could utilize the one-to-many communication
capabilities provided by the ProSe system.
In this case, we assume group memberships are all pre-configured according to
this application layer group.
When performing direct one-to-many communication, the group is identified by a
Direct Group Identifier (DGI).
Editor\'s note: The format of the direct group identifier is FFS.
Each Direct Group Identifier (DGI) is also associated with an IP multicast
address used by the application-layer group e.g. specific Public Safety group
for its broadcast/multicast service. ProSe one-to-many communication only
occurs amongst its group members which are in \"proximity\". In mobility
scenarios, it is possible that some members are temporarily \"unreachable\"
for a ProSe communication session.
After a DGI is allocated to a group and configured to all group members
beforehand, the group members can use it to identify a one-to-many ProSe
bearer context for their group. The particular radio resource used by this
group for one-to-many communication may be also associated with this DGI.
Editor\'s note: How to access radio resources for group communication will be
decided by RAN WGs.
In order to optimize the power consumption at the receiving end, a \"group
session announcement procedure\" is envisaged to be used so as to allow a
power-efficient way to keep the group \"alive\" during the ProSe one-to-many
communication session. The announcement needs to be invoked periodically or
occasionally when new traffic is initiated by an originating UE. When there is
no more data transmission activity, the session announcement message stops.
This may happen after some configurable time of inactivity in order to cover
cases of \"bursty traffic\" and minimize signalling. This can either be
achieved by sending an explicit \"stop\" announcement or by just terminating
the earlier transmitted announcement.
By monitoring \"group session announcements\", the receiving UEs could avoid
being \"always on\" in the receiving mode, and save power when there is no
likelihood of participation.
NOTE: How to monitor \"group session announcement\" and how to listen to group
communication will be decided by RAN WGs. It is expected that RAN WG will
specify the structure of the \"group session announcement\".
##### 6.2.6.2.2 ProSe-layer Group Security
For broadcast operation, the devices do not need explicit authorization to
receive broadcast data. However, for multicast group operation, to prevent
non-members from listening to ProSe group communication transmissions (i.e.
perform access control), each group member needs to obtain explicit
authorization and get pre-provisioned with security material for this purpose.
Editor\'s note: More details about the security procedures to be defined in SA
WG3 TR.
#### 6.2.6.3 Procedures
##### 6.2.6.3.1 Direct One-to-Many communication
As described in clause 6.2.6.3.1, this procedure is applicable to authorized
ProSe-enabled Public Safety UEs.
Figure 6.2.6.3.1-1: Direct one-to-many communication procedure
1\. UE is configured with the related information for one-to-many
communication. The UE obtains the necessary group context (name, Direct Group
Identifier, priority etc.), the source IP address and destination IP multicast
address to conduct IP-layer transport of data, and also the radio resource
used for the broadcast/multicast service.
Editor\'s note: It is FFS if the priority can be used in order to determine
the priority in access stratum e.g. to determine the pre-emption.
2\. Optional discovery procedure in which the initiating UE perform the
discovery procedure for the group members.
3\. The originating UE sends the group session announcement to announce the
group activity to notify other group members. Such a signalling could contain
the Direct Group Identifier, transmitter identity, and other information
related to the one-to-many direct communication.
4\. The originating UE finds the appropriate radio resource to conduct one-to-
many communication. If the UE is in network coverage the use of resources
signalled to the UE from the network e.g. via a new SIB take priority over the
pre-configured ones.
5\. The originating UE sends the data for group communication
NOTE: More details about steps 3 and 4 to be defined in RAN WGs.
#### 6.2.6.4 Configuration information from DPF for direct communication one-
to- many
Following the procedures defined in clause 6.1.2.1.2 the following information
is provisioned for direct communication one-to-many:
**Authorisation for direct communication one-to-many**
Is the UE authorized to perform direct communication one-to-many in this PLMN?
(yes/no):
\- This information always comes from the registered PLMN.
**Additional information**
For direct communication one-to-many also group configuration needs to be
provided. This may involve setting up groups (e.g., talk-groups for public
safety voice communication) with a common group identifier. Part of this
configuration may involve authorizing UEs to participate in one-to-many ProSe
communication, provisioning security credentials for one-to-many ProSe
communication sessions, provisioning individual IP addresses and an IP
multicast address for the whole group, provisioning the service description
(e.g. SDP) of the group communication sessions etc.
For \"out of network coverage\" operation, the resources (e.g. frequency
bands) that the UE would use for direct services also need to be provisioned.
This information can be common for both direct discovery and communication and
indicates to the UE what are the resources (e.g. frequency bands used) that
are provided in the registered PLMN for direct discovery and communication.
\- This information is always provided from the registered PLMN.
In cases where the registered PLMN cannot provide any resources for direct
communication out of network coverage, the UE is provisioned with a list/table
that indicates the resources (e.g. frequency bands used) for different
locations.
\- This information can be provided from the HPLMN.
All the above information can also be pre-provisioned into the UE and how
often the UE has to contact the DPF can be operator controlled.
#### 6.2.6.5 Direct one-to-many bearer concept
The direct one-to-many bearer defines IP flows upon an IP multicast address.
Note that this direct one-to-many bearer is pre-configured, without using NAS
signalling.
##### 6.2.6.5.1 IP address allocation
IPv6 addresses are the only IP addresses used for the direct link.
Each individual UE involved in One-to-Many ProSe communication should reuse
the IP address allocated for its One-to-One communication, if possible.
#### 6.2.6.6 Mobility aspects
##### 6.2.6.6.1 Interacting with GCSE-LTE system
No interactions with GCSE-LTE system are foreseen in this release.
#### 6.2.6.7 Operational aspects
##### 6.2.6.7.1 Accounting
Collection and reporting of data by the UE that can be used by an entity in
the network e.g. ProSe Function that is defined for this purpose can be
triggered at any time. The UE can be configured to periodically report data to
this entity that can be used for accounting purposes via a secure interface if
needed. For example incoming and outgoing group communication calls, etc.
NOTE: The reporting can use over IP protocols or any form of small data
interface that exists (e.g. SMS) or any other possible small data mechanism
that could be defined in Rel-12.
For the specific cases of \"out of E-UTRAN coverage\" the UE can be expected
to report data to the network that could be used for accounting purposes if
needed when it goes back into E-UTRAN coverage.
Editor\'s note: Whether such UE-provided info can be considered a trusted
source of information to base accounting procedures on or whether other
solutions need to be developed is subject to SA WG5 evaluation.
#### 6.2.6.8 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
**UE:**
\- stores configuration on group information, including the associated
resources;
\- requires a mechanism to send broadcast/multicast traffic over the air to be
received by group members only.
**RAN:**
\- requires a method (e.g. new SIB) to signal the resources used for ProSe
one-to-many communication (applicable only to cases when the UE is \"served by
E-UTRAN\").
#### 6.2.6.9 Solution evaluation
\'This solution addressed the key issue#12 of the ProSe one-to-many
communications aspect of the ProSe service. It allows the ProSe-enabled UE to
discover the existence of other ProSe-enabled UEs of the same group, and
perform 1-to-many communications.
This solution fulfils the requirements in clause 4.2 for one-to-many
communication. The operator is able to exercise authorization through the DPF,
and control the usage of radio resources when the UEs are served by E-UTRAN.
This Solution does not support IPv4.
Editor\'s note: It is FFS whether this solution can work in the presence of
ProSe UE to Network Relay.
### 6.2.7 Solution C7: A hybrid mode for one-to-many communication
This solution addresses the issue of ProSe 1-to many communications in the
scenario when availability of a group controller/Group Owner (GO) is
intermittent. Devices which are not in proximity of a group controller nor are
in network coverage can continue communicating in the group they participate
in provided that they themselves are in proximity. The group owner
communication mode is the preferred mode of communication for Public Safety
ProSe enabled UEs with the fall back option to the autonomous/ad-hoc mode. The
fall back occurs when Public Safety ProSe enabled UEs are not in communication
range of a group controller/owner nor are they in network coverage.
The solution can be seen as a framework used for a hybrid mode of operation.
Atomic solutions can be plugged in for the \"group owner/coordinated\" and
\"autonomous/ad-hoc\" modes.
When such an \"out of network\" and \"not in proximity of a group controller\"
scenario occurs, the Public Safety ProSe enabled UEs use pre-authorized
resources.
When Public Safety ProSe enabled UEs are in coverage of a group controller
which is in network coverage, the resources are managed by the network.
When Public Safety ProSe enabled UEs are in coverage of a group controller
which is not in network coverage, the use of resources is pre-authorized.
However the resources used are distinct from the case when Public Safety ProSe
enabled UEs are \"out of network coverage\" and \"not in proximity to a group
controller\".
It is subject to configuration whether:
\- the ad-hoc communication mode is maintained by the Public Safety ProSe
enabled UEs use when they are back in the group owner mode or not.
\- the Public Safety ProSe enabled UEs can modify the setting configured by
the network/service provider.
Editor\'s notes:
\- the rules governing when the ad-hoc communication mode is terminated when
the Public Safety ProSe enabled UEs are back in network coverage is left FFS.
\- solutions defined in this TR for the coordinated mode (e.g. solution C1)
and autonomous mode (e.g. solution C5) may be used.
#### 6.2.7.1 Functional description
System architecture (assuming non roaming case see note below) supporting this
solution is presented in Figure 6.2.7- 1.
Figure 6.2.7-1: Architecture for ProSe 1-to Many Communication in Group Owner
mode
Editor\'s notes:
\- The roaming case does not have impact on this solution, and it is not
presented.
\- Release 10 relays may be used as UE-to-Network relays.
\- The entities coloured in yellow are considered to form the same group. This
is for illustration purposes and as such it does not restrict general
applicability of the architectures.
The architecture in the ad-hoc mode used when Public Safety ProSe enabled UEs
are not in proximity of a group owner nor are they in network coverage is
presented in Figure 6.2.7- 2.
Figure 6.2.7-2: Architecture for Ad-Hoc mode (no network coverage and no
proximity of a group owner)
The architecture used for communication by a dispatcher or Public Safety ProSe
enabled UEs which are not in radio proximity to a group controller/owner but
are in network coverage is presented in Figure 6.2.7-3.
Figure 6.2.7-3: Architecture used for group communication via E-UTRAN and/or
EPC (no proximity of a group owner)
Editor\'s note: A dispatcher /interaction with the ProSe Application server is
not in the scope of 3GPP.
#### 6.2.7.2 Procedures
The following procedures are defined:
\- Initialisation procedures (clause 6.2.7.2.1).
\- Ad-Hoc mode initialisation (clause 6.2.7.2.2).
\- Re-entering the group owner/coordinated mode (clause 6.2.7.2.3).
\- Communication via E-UTRAN / EPC (clause 6.2.7.2.4).
##### 6.2.7.2.1 Initialisation procedures
High level signalling for the initialisation procedure and group
activation/deactivation is presented in Figure 6.2.7- 4.
Figure 6.2.7-4: Initialisation and Group activation / deactivation
0\. In network coverage a Public Safety ProSe UE which functions as a group
controller and UE-to-Network relay is required to register with the EPC
network - step 0b. The \"out of network\" coverage scenario is also supported
in which case step 0b is optional. If Release 10 UE-to-Network relays are
used, the relay needs to be initialised/ registered with the network - step 0a
(the Public Safety ProSe UEs are unaware of the fact that release-10 relays
are used).
1\. After registering with the EPC network, the group controller initiates the
registration with the ProSe function. During registration, the group
controller obtains information about authorized services, group management
information (e.g. permissions to create new groups, restriction on groups
which can be activated, authorization information for group participants
etc.). This information is supplied by the ProSe function and ProSe
Application server. The Public Safety ProSe UE which functions as a group
controller also registers its IP address (this is required to enable e.g. a
dispatcher or another Public Safety ProSe UE which is not in proximity but
forms part of a group to participate in group communication). If the EPC
network is not available, the pre-provisioned configuration information is
used.
2\. The group controller advertises its presence and the group information
(e.g. available/active groups). The presence information contains the identity
of the group controller and information about the application instances (e.g.
PTT application). It may also include some control information to users such
as e.g. group management information (e.g. only predefined groups are handled
and the list of these groups is advertised or new groups may be created).
3\. Depending on group management information, the UE may be required to
join/create a group (step 3a). Although it is considered as the application
layer signalling (see notes below) it may impact the information advertised by
the group controller (e.g. the supported groups / active groups, control
information) - step 3b. Once a group is activated, a group participant is
required to monitor the availability of a group owner (step 3c). The
monitoring may be based on the detection of presence information and /or
indication of active groups. Note that once a group has been activated, Public
Safety ProSe UEs may participate in group communication provided that they are
in proximity and have or have been pre-configured with the relevant data (e.g.
access information).
4\. Steps 4a/ 4b are similar to 3 for other Public Safety ProSe enabled UEs
forming a group except that step 3b is not required.
5\. A group controller may monitor whether groups are active i.e. the
communication occurs for a group. Should there be no communication for a
predefined time; the group becomes/is marked as inactive. This step is
optional.
For group communication in the group owner mode, a group owner (i.e. a data
hub) functions as the UE-to-Network relay if it is in network coverage and has
been successfully registered with the EPC and ProSe function.
Editor\'s notes:
\- It is FFS whether group management is performed at the application layer or
not.
\- Information provided by ProSe Application Server is left FFS as it depends
on the agreements related to the layer at which the group management
procedures are implemented.
##### 6.2.7.2.2 Activation of \"autonomous / ad-hoc\" mode
High level procedure to activate the \"ad-hoc\" mode is presented in Figure
6.2.7- 5.
Figure 6.2.7-5: Activation of \"ad-hoc\" mode
0\. A group owner is not in proximity to the Public Safety ProSe enabled UE
which currently participates in group communication.
1\. Public Safety ProSe enabled UE discovers that it is no longer in proximity
to the group owner of interest. The discovery process may be based on the lAck
of advertised information (e.g. no reception of the ProSe discovering
signals/messages and/or no broadcast information. That includes the case when
the signal/message is present but the relevant information is absent e.g.
another group owner is present which does not handle communication for a
group).
2\. Public Safety ProSe enabled UE switches to the \"ad-hoc\" mode of
operation for which distinct resources are used. The resources have been
defined by the configuration parameters pre-provisioned by the network
The ad-hoc mode of operation is characterised by the fact that there is no
group controller assigned to handle the communication for a group.
##### 6.2.7.2.3 Re-entering the \"coordinated\" mode
High level procedure to enter the \"coordinated\" mode is presented in Figure
6.2.7-6.
Figure 6.2.7-6: Re-entering the \"coordinated/group owner\" mode
0\. Public Safety ProSe enabled UE discovers that it is in proximity of the
group owner of interest. The group owner advertises its presence along with
group information.
1\. Public Safety ProSe enabled UE checks whether it is authorized to
communicate with the group owner (e.g. based on, application type running, the
identity of the application instance and group information).
2\. Public Safety ProSe enabled UE switches to the \"group owner\"
communication mode if it wishes to re enter the communication with a group
owner/controller. The decision is based on the group information advertised by
a group controller and the groups the Public Safety ProSe enabled UE
participates in)
3\. Subject to the configuration, Public Safety ProSe enabled UE may maintain
its ad-hoc mode of operation
4\. If the group, which Public Safety ProSe enabled UE is interested in, is
not active, the joining procedure may be invoked. (not described - see notes
below)
Public Safety ProSe enabled UEs which participate in group communication and
have regained communication with the group controller, do not relay
communication from Public Safety ProSe enabled UEs in the adâ€‘hoc mode.
Editor\'s note: It is left FFS whether group management is performed at the
application layer or not. The joining procedure may be considered as out of
scope if it is the application layer procedure.
##### 6.2.7.2.4 Communication via E-UTRAN/EPC
High level procedure outlining the communication option via the E-UTRAN/EPC is
presented in Figure 6.2.7-7.
Figure 6.2.7-7: Communication with a dispatcher or UE via E-UTRAN/EPC
**Dispatcher communicating via E-UTRAN/EPC:**
0\. If a dispatcher has not been communicating with a group, it needs to
obtain information how to reach a group controller. At this stage the
application server will authenticate the dispatcher and authorize the request
made by a dispatcher. Means how to achieve it is not in the scope of 3GPP
specification. Once the request has been authorized and dispatcher
authenticated, the ProSe Application server will request from the ProSe
function further information about the target. The ProSe Server based on group
identity supplied by a dispatcher and response from the ProSe function
provides the information associated with the group owner which contains at
least the following:
\- the IP address assigned to the group owner (GO) (mandatory)
\- Authorisation information
1\. The dispatcher initiates the application layer signalling based on the
information provided by the ProSe application server. The communication occurs
over the SGi and IP routing/ 3GPP tunnelling is used to deliver the
communication to the group controller. The dispatcher may be required to join
the group in order to inform the group controller that it should pass
communication also to the dispatcher. From now on the dispatcher may request
\"the floor\" or issue the control commands (not in the scope of 3GPP)
**UE communicating via E-UTRAN/EPC:**
0\. As a pre-condition the Public Safety ProSe enabled UE is required to be
registered with the EPC and with the ProSe function so the Public Safety ProSe
enabled UE is authenticated, authorized to use ProSe services and obtained the
relevant configuration parameters. If the so the Public Safety ProSe enabled
UE has not been communicating with a group, it is required to obtain
information how to reach the group controller. The group controller is
typically identified by the application layer identifier however some further
assisting information may also be present (e.g. ProSe identity, application
instance etc.). The query is made to the ProSe Application server which in
turn queries the ProSe function in a similar fashion as in the case presented
above. The response message contains at least the following:
\- the IP address assigned to a group owner (GO) (mandatory)
\- Authorisation information
\- Relevant ProSe identities should ProSe Group communication be used when in
proximity of a group owner.
1\. Once the Public Safety ProSe enabled UE is able to communicate via the
E-UTRAN/EPC with the group controller, the control signalling may be invoked
(if it is at the application layer it is not in the scope of 3GPP). The data
may be routed via the E-UTRAN (see notes) or EPC (intra PLMN case) or via the
PLMNs (inter PLMN case).
When the Public Safety ProSe enabled UE is in proximity to the GO, it shall
attempt to communicate with the GO first using the ProSe Group Communication
regardless if in network coverage or not.
Editor\'s notes:
\- Depending on trust relationship, the ProSe Server may be required to
authenticate the Public Safety ProSe enabled UE /authorize its request (not in
the scope of SA WG2).
\- Depending on trust relationship, the ProSe function may be required to
authenticate the ProSe server /authorize the request (not in the scope of SA
WG2).
\- Routing via E-UTRAN is not supported in Release 12 due to the
prioritisation activity.
#### 6.2.7.3 Impact on existing entities and interfaces
**UE:**
\- stores groups configuration / authorization information such as e.g. group
members /access information (as a group controller).
#### 6.2.7.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.2.8 Solution C8: One to many communication
#### 6.2.8.1 Functional description
##### 6.2.8.1.1 General
The solution described in this clause addresses the one-to-many communication
key issue described in clause 5.12.
A ProSe enabled UE needs to be able to communicate with other ProSe enabled
UEs both out of coverage and in coverage. The one-to-many communication use
case may build on a radio communication mechanism based on broadcast. RAN is
studying a single mechanism that would support broadcast-, group- and 1:1
communication, implemented by a broadcast mechanism at the MAC layer.
Each UE shall be able to broadcast over the air to the surrounding UEs in
proximity.
It is assumed that the communication is not preceded by a discovery phase, but
that the sender will start transmitting at any time when there is data to be
sent. The transmitting UE will have no knowledge about potential receivers in
the vicinity. The UEs are preconfigured instead of doing dynamic discovery.
A connectionless communication scenario is assumed and any type of
acknowledgements or session based communication methods are solved by the
application.
It is assumed that there shall be a ProSe Layer between the EPS layer and the
applications. The content of the ProSe Layer is provided.
Screening of messages in the receiver may be needed, in order not to burden
the application with decoding messages not intended for it in an environment
where the air may be full of broadcasts in the D2D radio link. The application
may be subscribing to messages from certain groups and there needs to be a
discarding mechanism at lower layers.
Group management is proposed to be handled in the application. A ProSe user
may belong to a group of users within an application. ProSe users can belong
to multiple groups. The members of a group share a secret which defines the
group. The shared secret is used within the group to encrypt and decrypt
messages sent towards members of the group. It is anticipated that for Public
Safety applications it is a requirement to provide security solutions in the
applications instead of only relying on the 3GPP provided security mechanisms.
Encryption by the application ensures that only group members defined in the
application can receive/decode the messages and that the message is not useful
for users outside the group, which don\'t share the secret key.
Dynamic management of groups such as joining, adding or removing members or
modifying groups in other ways is handled in the application. For the \'out-
of-coverage\' scenario the handling is assumed to be based on pre-configured
shared secrets in the application. Authentication for the addition of group
member is done by the validation from the group manager. After authentication
the exchange of group specific keys may be done, e.g. it may use a OMA group
management as defined by OMA Group XDM Specification. The group management is
further described in the GCSE TR 23.768 [5]. Neither are different roles for
the group members considered here, instead it is assumed to be handled within
the application.
For communication towards group members residing on the SGi interface, e.g. a
PSAP user, it is assumed to re-use in-coverage procedure procedures as for the
application in use, e.g., to establish EPS bearers for the application in use
and if E2E user plane security is used it is setup E2E as using existing
means. For user out-of-coverage a ProSe UE-to-NW relay function may be used if
available.
For Public Safety usage the \"Out of the box\" requirement is important. The
equipment shall work in a use case where there is no network coverage. That
means there is no possibility to rely on any configuration, authorization or
other network based equipment management for a group communication scenario.
The UE settings as well as all group related management has to be pre-
configured in the UEs. However, it is important that the out of the box
scenario is future compatible to in-coverage scenarios and requirements that
will apply e.g. concerning UE-to-NW relay or session continuity.
Editor\'s note: It is FFS e.g. how PDN connection handling in the NW based
scenarios are compatible with the basic out-of-coverage communication
scenario.
##### 6.2.8.1.2 System architecture
NOTE 1: UE internal interfaces in the figure will not be specified by 3GPP.
NOTE 2: The layer 1 in the figure comprises a physical layer without any
address capability.
NOTE 3: The ProSe Layer is assumed to be built on existing EPS protocol
layers.
Figure 6.2.8.1.2-1: ProSe UE one to many communication structure
The communication model for the UE includes a EPS layer and above that a ProSe
Layer, which provides services to the higher layers. The model shall work in
the out-of-coverage UE one-to-many scenario as well as in a one-to-one
scenario. There are also use cases for in-coverage scenarios and other ProSe
functions such as relay and session continuity. Although these other scenarios
are not considered here, the ProSe Layer will provide generic services that
can ensure the UE to work in a multitude of environments and communication use
cases.
The ProSe Layer will in the current scenario require a broadcast one-to-many
service in the MAC layer.
The ProSe Layer will provide the means for the applications to exchange user
data, such as messages, talk bursts, video streams etc. User data is exchanged
between one application in the sender towards the same application in the
receiver(s). The ProSe Layer will provide support for multiple applications.
Applications may be end user applications, but also possibly control functions
for signalling between UEs. Possible control functions can be ProSe relay,
session management over D2D, etc. At the moment only end user applications are
considered e.g. Public Safety application.
The user may activate user groups in the application, which will require lower
layers to receiving the corresponding group messages. The application is
identified by a registered APP ID, which is guaranteed to be unique by a
registration organization. In the application the group is identified by a
preconfigured Group ID. The Group ID may be treated entirely within the
application and may not be guaranteed to be unique. The unique Group ID will
in the application provide a security mechanism such that messages can be
confined to only members of the group.
NOTE: How the privacy requirement may be fulfilled when using a pre-configured
setting will be resolved by SA WG3.
Using the header information in the received packets all matching/subscribed
packets received over the air will be delivered up to the application in
question. The user data part will be encrypted by the sender application and
the receiving application will decrypt the message.
NOTE: The exact method of the encryption/decryption method is for further
study by the SA WG3.
A user may in the application invoke services such as messaging, voice or
video. Depending on the services used by the application user, different above
IP protocol parts may be utilized and is not discussed here.
ProSe Layer information is exchanged between the sender and the receiver:
\- the ProSe header will make it possible to differentiate between different
user plane applications and control for signalling dispatching data messages.
\- the ProSe header will include a protocol identifier, such that apart from
application data, there may be signalling control messages, or other higher
layer protocols.
It is assumed that application control information enables the application to:
\- assess that the user data is received to a member of a specific group
within the application.
\- select shared security keys and decode the received user data.
##### 6.2.8.1.2.1 System architecture, L2 multicast or L3 multicast {#system-
architecture-l2-multicast-or-l3-multicast .H6}
The key issue #12 addresses:
\- Whether ProSe group communication needs to be IP based and whether IP
multicast can be used?
For the pure out-of-coverage, out of the box communication scenario which was
discussed above it is seen that a L2 solution will be adequate. However, as
was stated above, there are also other scenarios which need to be considered
and there is a need to be compatible to other cases. The in coverage
communication scenario as well as the relay communication scenario will need
to use the IP layer communication model. The compatibility with the EPS
communication model need to be maintained also for the GCSE functions.
The IP layer for the UP is added on top of the ProSe layer for the model
presented here. For the One-to-many communication case, the IP layer
destination address to be used is the IP Multicast address assigned to the
one-to-many communication session. The IP Multicast address may be pre-
configured in the out of coverage use case. The source IP address is the IP
address assigned to the sender. It is proposed that IPv6 is used in order to
simplify the functionality.
Security requirements, which will be determined by SA WG3, will potentially
call for a PDCP layer within the protocol stack.
NOTE: Depending on the exact method of the encryption/decryption determined by
SA WG3, an effective message screening may be performed also by the PDCP
layer.
Figure 6.2.8.1.2.1-1: ProSe Management
NOTE: The ProSe Layer may consist of the PDCP, RLC and MAC layers but it is
for the RAN Groups to be determined.
##### 6.2.8.1.3 Requirements
The relevant requirements for the discussion of the current key issue are
found in TS 22.278 [3].
#### 6.2.8.2 Procedures in the UE
##### 6.2.8.2.2 Management
The ProSe Management registers the control information (e.g. address
information) for transmission and reception to lower layers (ProSe Layer).
NOTE: Functionality within the ProSe layer is determined by the RAN Groups.
##### 6.2.8.2.1 Transmit data
For the one-to-many mode, the ProSe Layer may use a ProSe layer broadcast
method.
##### 6.2.8.2.3 Receive data
The ProSe Layer will use information in the received packet to process the
received packet and deliver the message to upper layers. The user plane
packets will be delivered to the IP stack, while control information will be
delivered to the control layer..
#### 6.2.8.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.2.8.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.2.9 Solution C9: Authorization of direct communications One-to-Many
based on application-defined ProSe application ID and system provided ProSe UE
ID
#### 6.2.9.1 Functional description
This solution defines procedures by which the operator can authorize
explicitly a UE to become a source for a specific application group, perhaps
by involving a specific Application server in the decision. Specifically
provides a way for the operator to authorize a one-to-many source to send
traffic over the allotted RAN resources in static or semi-static fashion. This
needs not be performed at every transmission and typically may be executed in
association to specific \"Direct Mode\" public safety application start-
up/registration or when serving PLMN or ProSe UE ID change or when an
authorization timer expires or for instance a transmission quota is about to
be exhausted.
This solution is expected to apply for all direct communication cases (in and
(for Public Safety UE\'s) out of coverage). It is assumed the source of the
one-to-many communications knows the ProSe application ID, the Group
communications Layer two address and the IP multicast address used for one-to-
many communications.
As per Targeted discovery based on application-defined ProSe application ID
and system provided ProSe UE ID defined in clause 6.1.6, the ProSe application
ID is also associated to a secret that may be used for encryption. The network
may provide additional encryption keys for UE\'s in coverage, however the
Group secret may be used when UE are out of coverage for encryption. Default
configuration information sufficient to perform communication is assumed for
Public safety UE\'s operating out of coverage. It also assumed that, if
application level authorization was required by the operator, the MME can
reach an application server for application layer validation and authorization
of communications. This may be triggered e.g. by the specific application used
or subscription of the UE\'s. The address of this application server (or its
FQDN) may be provided by the UE or, if the application group is supported
directly by the operator via a business agreement, it could be resolved
locally by the MME based on the received value of the ProSe application ID.
The MME may reject the establishment of the direct link even if the
application server may grant it, based on 3GPP layer considerations alone.
If direct communication is rejected, the UE\'s, if they are under network
coverage, may continue to communicate via the infrastructure using group
communications, as they are assumed to have an active default PDN connection
as they are in connected mode in E-UTRAN while the authorization procedure is
ongoing.
#### 6.2.9.2 Procedures
The following procedures are instrumental to the establishment of logical one-
to-many direct communications. It should be noted that this logical one-to-
many communications may be virtualized over a broadcast multiple access medium
at lower layers.
The message flow in Figure 6.2.2.2-1 here below is an example of how this
could work.
Figure 6.2.9.2-1: Case of UE\'s under network coverage ( if dashed lines
apply) or out of coverage (dashed line does not apply)
UE A is a potential source of one-to-many direct communication. If it is under
coverage of a network, it is assumed to obtain authorization to transmit
(asynchronously to data transmission so that there is no latency when actual
data needs to be sent), so it enters RRC connected state and sends NAS
signalling to the MME.
1) UE A sends a Authorise Direct communication request (ProSe Application ID,
ProSe UE ID A, App server IP@ or FQDN) to the MME. The IP address or the name
of the server where the MME needs to optionally check for application layer
authorization and obtain data volume quotas and possibly other necessary
information, is provided by the UE\'s (another option is that the name of the
application is resolved to the right IP address by the MME based on business
agreements, solely based on the agreed-upon ProSe application ID). The
Application is assumed to be already aware of the ProSe UE ID of the UE via
previous ProSe registration.
Based on the received information, the MME, perhaps based also on application
interaction, authorizes communication and may also provide traffic quotas,
timers for reauthorization, geographical scope e.g. in form of TAI-list, and
also assign authorized layer two address and also maybe the encryption keys
for the group. This is included in the transmission attributes in step 2.
2) The MME sends Authorise Direct communication Accept (ProSe Application ID,
ProSe UE ID A, Transmission attributes) to UE A.
As a result of step 2, the UE is authorized to use one-to-many communications
using the specific transmission attributes.
For public safety UE\'s out of coverage, the authorization procedure does not
apply and they can right away proceed to transmission when they have data to
send using one-to-many direct communications and they are authorized to do so.
It is in the scope of RAN defining the exact procedures used at RAN layers to
transmit in a battery efficient manner, if applicable, as tradeoffs between
battery efficiency and latency in communications may apply. So direct
transmission is in the picture here above but not explicitly addressed by this
solution.
#### 6.2.9.3 Impact on existing entities and interfaces
**MME:**
\- needs to be able to issue and maintain the ProSe UE ID.
\- need to support interactions with eNB\'s and applications for ProSe direct
communications authorization.
**eNB:**
\- must enable the transmission on a broadcast channel.
**UE:**
\- must register for ProSe at application and 3GPP layer,
\- must support ProSe authorization procedures,
\- must support one to many transmission on the broadcast channel.
#### 6.2.9.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
## 6.3 ProSe Relays
### 6.3.1 Solution R1: Relay enabling and configuration for Public Safety
#### 6.3.1.1 Functional description
In this solution, the following assumptions are applied:
\- If authorized, whether or not being served by E-UTRAN the Public Safety UE
capable of acting as a relay (either UE-to-UE relay or UE-to-Network relay)
can relay traffic for Public safety ProSe communication including ProSe E-UTRA
Communication between two Public Safety ProSe-enabled UEs, ProSe Broadcast
Communication, and ProSe Group Communication.
\- The UE-Relay is within communication range of the source UE that initiates
public safety ProSe communication.
##### 6.3.1.1.1 UE-Relay Activation Types
To extend communication range for public safety, a Public safety ProSe UE
capable of relay can be configured to act as a UE-relay, either UE-to-UE relay
or UE-to-Network relay, with the following two relay functions:
1\. Relay discovery function.
2\. Relay Public safety ProSe communication.
When being a UE-relay, the UE-relay would consume extra power for the relay
discovery procedure and relay communication. Due to limited battery life, the
relay function of the UE-relay should be activated only when needed. It is
proposed that the UE-relay activates relay function for relaying Public safety
ProSe communication by the following three activation types:
Activation type 1 (no relay discovery): the relay function can be activated
whenever the public safety UE has an active Public safety ProSe communication
with source UE.
\- This type of relay would consume unnecessary power if there is no public
safety UE requiring relay for communication. This is more suitable for
communication with emergency or high priority.
Activation type 2 (UE-relay as monitoring UE in relay discovery): the relay
function can be activated when receiving an announcement message from a UE
requesting for discovering a public safety Relay.
\- Whenever there is active Public Safety ProSe Communication, the UE-relay
needs to periodically monitor for relay discovery in order to promptly
activate/deactivate its relay function.
\- The relay discovery for an announcing UE requesting for relay may be
triggered periodically or when moving out of the communication range of a
source UE and lost the active public safety ProSe communication.
Activation type 3 (UE-relay as announcing UE in relay discovery): the relay
function of the UE-relay can be activated when receiving an Ack message from a
monitoring Public safety UE requesting for relay.
\- Whenever there is active Public Safety ProSe communication, the UE-relay
needs to periodically announce its existence by sending announcement message
in relay discovery.
\- This type of UE-relay would consume unnecessary power for announcement in
relay discovery if no public safety UE is around.
It is noticeable that a public safety UE configured as a UE-relay, the relay
discovery procedure needs to perform periodically either being an announcement
UE in type 3 or a monitoring UE in type 2. By this the UE-relay can determine
if deactivating its relay function for Public safety ProSe communication when
there is no public safety UE within its communication range for relaying.
##### 6.3.1.1.2 UE-Relay Configuration
In support of public safety ProSe communication, including ProSe broadcast
communication and ProSe Group communication, whether or not in coverage or out
of coverage a public safety UE is configured with authorized
broadcast/multicast group identifiers. For a public safety UE capable of being
a UE-Relay user to request relay service and/or being a UE-Relay to provide
relay service, it is authorized/configured by the network via OMA-DM to enable
corresponding capabilities as well as the authorized public safety ProSe
communication. Furthermore, according to the operator policies, UEs need to be
configured with the same UE-relay activation type in relay discovery
procedure.
The configuration of a public safety UE is as follows:
\- UE-Relay user capability enabling.
\- Credential for using UE-Relay.
Editor\'s note: It is FFS for SA WG3 if common credential for Relay access can
be used by all of the UEs.
\- UE-relay activation type in UE-relay discovery procedure.
\- UE-Relay capability enabling.
\- UE-to-Network capability enabling.
\- UE-relay activation type in UE-relay discovery procedure.
\- Authorized group identifier for relay.
\- Priority level.
\- Associated radio resource profile in UE-relay discovery procedure and UE-
relay Public Safety ProSe communication.
#### 6.3.1.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
#### 6.3.1.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.3.1.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.3.2 Solution R2: UE-UE Relay using IP Routing and Forwarding
#### 6.3.2.1 Functional Description
In this case the UE acts as a relay node by routing traffic between two UEs
that are outside of the EUTRAN coverage, but visible to a third UE. The
forwarding of the packets from the two out of coverage UEs is done by the UE
relay using basic IP forwarding. The control plane of this scenario is basic
IP routing.
Figure 6.3.2.1-1 shows an UE providing relay functionality for two other UE\'s
acting as a IP Relay. The figure shows only two UE\'s but in perspective the
relay may be provided to a larger number of UE\'s. ProSe Relay UE could do
routing of Unicast streams or provide multicast streams to other UE\'s that is
served by that ProSe Relay UE.
Figure 6.3.2.1-1 UE-UE relay using IP Routing
#### 6.3.2.2 Procedures
Figure 6.3.2.2-1 describes the procedures for setting up the relay. In the
figure below it is assumed the ProSe Relay is in E-UTRA network coverage where
UE1 & UE2 are outside the E-UTRAN coverage.
Figure 6.3.2.2-1: UE-UE relay procedures
Step1: ProSe Relay UE establishes radio connection to the eNodeB.
Step2: ProSe Relay attaches to the eNodeB. Default PDN could be ProSe PDN or
could be some other PDN. In case the default PDN is the ProSe PDN then Step 3
is optional.
Step 3: ProSe Relay establishes a ProSe PDN. The PDN is either managed by the
P-GW in case of coverage or could be locally established at the eNodeB.
Step 4: UE1 that is out of coverage, discovers ProSe Relay UE.
Step 5: UE1 attaches to ProSe Relay UE and gets an IP address.
Step 6: UE1 registers to GCSE AS. ProSe Relay UE relays UE1 data to the
network as described in clause 6.3.2.
Step 7: UE2 that is out of coverage, discovers ProSe Relay UE.
Step 8: UE2 attaches to ProSe Relay UE and gets an IP address.
Step 9: UE2 registers to GCSE AS. ProSe Relay UE relays UE2 data to the
network as described in clause 6.3.2.
Step 10: ProSe Relay UE sets up the IP routing tables.
Step 11: UE1 communicates to UE2 directly using the ProSe Relay UE as the
router.
#### 6.3.2.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.3.2.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.3.3 Solution R3: UE-Network Relay using Layer 3 Routing based on EPS
Bearer (lend me a EPS bearer)
#### 6.3.3.1 Functional Description
In this case a ProSe UE acting as a relay node carries data traffic to/from a
ProSe UE that is out of EUTRA coverage to/from an eNodeB. Following are high
level procedures for layer 3 routing:
1) Each of the ProSe Relay UE is part of a ProSe Relay PDN.
2) The ProSe Relay UE creates EPS bearer(s) for a given traffic flow towards
the E-UTRAN on the ProSe Relay PDN.
3) The ProSe Relay UE identifies the uplink packet flows coming from the Out
of coverage UE, and maps them to a ProSe Relay EPS Bearer.
4) Route the ProSe Relay EPS bearer downlink traffic to the associated UE.
5) IPv4 and IPv6 communication is achieved by creating the appropriate PDN
type.
In the case of IPv4 communication, the Relay UE provides the NAT.
Editor\'s note: The number of UE\'s that could be supported for relay is FFS.
Figure 6.3.3.1-1 shows the UE-Network relay at the ProSe Relay UE. The Layer 3
forwarding maps particular IP traffic to the EPS bearer.
Figure 6.3.3.1-1 UE-Network relay using Layer 3 routing.
#### 6.3.3.2 Procedures
Figure 6.3.3.2-1 describes the procedures for setting up the relay
functionality at the UE. The figure assumes that the ProSe Relay is in network
coverage and UE2 is out of coverage.
Figure 6.3.3.2-1 UE-UE relay procedures
Step1: ProSe Relay UE establishes radio connection to the eNodeB.
Step2: ProSe Relay attaches to the eNodeB. Default PDN could be ProSe PDN or
could be some other PDN. In case the default PDN is the ProSe PDN then Step 6
is optional.
Step 3: UE that is out of coverage, discovers ProSe Relay UE.
Step 4: UE attaches to ProSe Relay UE and gets an IP address.
Step 5: Depending the kind of traffic, ProSe Relay UE establishes the ProSe
PDN.
Step 6: ProSe Relay establishes a ProSe PDN. The PDN is either managed by the
P-GW in case of coverage or could be locally established at the eNodeB. Based
on the type of traffic, corresponding QCI bearers are established.
Editor\'s note: ProSe PDN could be enhanced to indicate the PDN is being used
for ProSe Communication and is FFS.
Step 7: UE2 registers to GCSE AS through the established ProSe PDN.
Editor\'s note: The APN that is used for ProSe Relay is FFS.
Editor\'s note: Traffic flow mapping from an out of coverage UE to the EPS
bearer is FFS.
#### 6.3.3.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.3.3.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.3.4 Solution R4: UE-to-UE Relay operating at the application layer
#### 6.3.4.1 Functional Description
##### 6.3.4.1.1 Solution Description
The solution for UE-to-UE Relay described here builds on top of the ProSe
communications in Group Owner mode described in clause 6.2.1, by adding a SIP
client in the ProSe Group member UE and a SIP server/registrar function in the
ProSe Group Owner.
##### 6.3.4.1.2 Architecture reference model
Figure 6.3.4.1.2-1: Architecture for UE-to-UE Relay operating at the
application layer
New or enhanced reference points:
**Gm-ter** : This is a reference point between the SIP client residing in a
ProSe Group member UE and the SIP server residing in the ProSe Group Owner. It
relies on SIP signalling for establishment, modification and release of GCSE
Group communication sessions, or for joining and leaving pre-established GCSE
Group communication sessions. Floor control is performed using BPCF [14] or
RTCP messages (e.g. like those defined in [13]).
The following are the salient features of this solution:
1\. The UE-to-UE Relay functionality resides in the ProSe Group Owner (GO);
2\. The UE-to-UE Relay operates at the application layer by including a SIP
registrar and SIP server functionality in the ProSe GO;
3\. If needed, the UE-to-UE Relay is statically configured to determine
whether it is authorized to act as relay for a specific GCSE Group;
4\. Uplink delivery on PC5 (UE-to-GO) is unicast;
5\. Downlink delivery on PC5 (GO-to-UE) can be either unicast or multicast.
The SIP server can make the decision for delivery type based on e.g. the
number of GCSE Group members in the ProSe Group;
6\. The solution supports both IPv4 and IPv6;
7\. The solution supports one-to-one communication via UE-to-UE Relay;
8\. For applications that require it, floor control is performed by a
centralised floor control server collocated with the SIP server.
NOTE 1: Strictly speaking the UE-to-UE Relay function can reside in any ProSe
Group member, however this would lead to a suboptimal usage because every Gm-
ter hop would involve two PC5 hops. Another reason for collocating the UE-to-
UE Relay function with the ProSe GO is to allow the ProSe GO to advertise the
collocated UE-to-UE Relay capability.
NOTE 2: There can be only one UE-to-UE Relay on the path between any pair of
ProSe Group members because there is only one ProSe GO in a ProSe Group.
##### 6.3.4.1.3 GCSE Group and ProSe Group relationship
One UE-to-UE Relay (owning one ProSe Group) may provide relay functionality to
UEs belonging to multiple GCSE Groups. Only UEs that are member of the same
GCSE Group are able to communicate with each other via the UE-to-UE Relay.
#### 6.3.4.2 Procedures
##### 6.3.4.2.1 General
The procedures in the present clause are provided as examples only.
##### 6.3.4.2.2 Relay discovery and ProSe Group joining
Depicted in Figure 6.3.4.2-1 is a high-level call flow for the ProSe Group
Owner architecture applied to a relay use case.
Figure 6.3.4.2.2-1: Relay discovery and ProSe Group joining
1\. UE_A is out of network coverage and needs to discover a UE-to-UE Relay in
order to increase its communication range. UE_R is capable of acting as a UE-
to-UE Relay. There are several possibilities for relay discovery and their
applicability may depend on additional requirements (e.g. covert operation):
\- UE_R may autonomously start a ProSe Group and send a beacon message
advertising its capability for acting as a UE-to-UE Relay;
\- UE_A may periodically transmit probe messages (e.g. using Targeted ProSe
discovery described in clause 6.3) indicating that it is looking for a
specific GCSE Group and/or for relay service. Upon reception of the probe
message, UE_R starts a ProSe Group and replies to UE_A that it can act as a
relay;
\- Using a \"human channel\" i.e. the user of UE_R may know that he is within
transmission range of UE_A and UE_B, however, by talking to both of them, he
realises that UE_A and UE_B are not within transmission range of each other.
The user of UE_R graciously offers that UE_R act as UE-to-UE Relay for the
other two UEs, and may even join the same GCSE Group communication itself.
2\. UE_A performs mutual authentication with the GO (e.g. based on
certificates or a common pre-shared secret). A Pairwise Master Key (PMK) is
generated as part of the authentication procedure and is used subsequently to
protect unicast traffic between UE_A and GO;
3\. The GO assigns an IP address to UE_A for use on the local ProSe IP subnet.
At this point both UEs are also cognisant of their respective layer-2 IDs;
4\. The SIP client in UE_A registers with the SIP server in the relay via Gm-
ter, requesting relay service for a specific GCSE Group. This procedure is
explained in more details in clause 6.3.4.2.3.
##### 6.3.4.2.3 SIP client registration and GCSE Group communication setup
Outlined in Figure 6.3.4.2.3-1 are the control plane procedures for SIP client
registration and GCSE Group communication establishment in presence of UE-to-
UE Relay.
Figure 6.3.4.2.3-1: SIP client registration and GCSE Group communication setup
1\. UE_A establishes ProSe communication with UE_R which acts as a UE-to-UE
Relay, as described in clause 6.3.4.2.2. After completion of this procedure
there is basic IP connectivity between UE A and UE_R.
2\. The SIP client in UE_A sends a GCSE Register message to UE_R indicating
that it wishes to take part in the GCSE group communication session identified
via GCSE Group ID i.e. a GCSE Group specific URI (e.g.
fire.brigade75@firstresponder.com). The message also carries the personal
application-layer identifier of the requesting user (e.g.
john.doe\@firstresponder.com).
3\. The SIP registrar functionality in UE_R records the request by associating
the IP address of UE_A with the personal SIP URI of the registering user and
sends an acknowledgement. Given that all ProSe Group members are on the same
IP subnet, the relay operation is equivalent to IP routing (i.e. there is no
need to use an RTP translator).
NOTE 1: The user of UE_R may or may not be a member of the requested GCSE
Group. It is up to the user of UE_R to decide whether a non-member UE_R shall
be authorized to act as UE-to-UE Relay.
4.-6. The corresponding steps for UE_B are performed.
7\. The SIP server in UE_R may now start sending SIP INVITE (GCSE Group ID)
messages to the registered SIP clients.
NOTE 2: If UE_R takes part in the group communication as a GCSE Group member,
it may send the SIP INVITE message to the SIP clients as soon as they register
(e.g. step 7b could be performed right after step 3).
NOTE 3: In case of one-to-one communication, the SIP INVITE message in step 7
is sent by either UE_A or UE_B and contains the personal SIP URI of the called
user (instead of GCSE Group ID).
Editor\'s note: The security aspects at Gm-ter level in this architecture are
FFS. This includes end-to-end authentication between UE_A and UE_B (if
needed), mechanism allowing a UE to assert its affiliation with a specific
GCSE Group and mechanism for end-to-end security (UE_A to UE_B) that would
prevent a non-member relay to eavesdrop on the GCSE Group communication (if
needed). Note that both UE_A and UE_B have already been individually
authenticated by the ProSe GO at PC5 level (step 2 in Figure 6.3.4.2.2-1) upon
joining the ProSe Group.
8\. OK messages.
##### 6.3.4.2.4 Floor control procedure
Outlined in Figure 6.3.4.2.4-1 is the floor control procedure (only for
applications that need it).
Figure 6.3.4.2.4-1: Floor control procedure
The call flow is largely self-explanatory and needs no step-by-step
description. The following assumptions apply:
\- Floor control messages (Floor Request and Floor Grant in Figure
6.3.4.2.3-1) may be based on RTCP messages (e.g. like those defined in [13]);
\- Floor control requests are arbitrated by a centralised floor control server
collocated with the SIP server.
#### 6.3.4.3 Impact on existing entities and interfaces
There is no impact on existing entities and interfaces.
#### 6.3.4.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.3.5 Solution R5: Solution for Public Safety UE-to-UE Relays
#### 6.3.5.1 Functional description
When a public safety UE (i.e. the initiating UE) needs to communicate with
another public safety UE (i.e. the destination UE) which is not in proximity,
the initiating UE tries to communicate with the destination UE via a UE-to-UE
relay.
An example of the scenario is shown in Figure 6.3.5.1-1. UE1, UE2, UE3, UE4
and UE5 in the scenario are public safety UEs. Furthermore UE2, UE3 and UE4
are relay capable. The UEs in proximity with UE1 are UE2, UE3 and UE4. And
UE2, UE3 and UE4 are also in proximity with UE5. UE1 wants to communicate with
UE5 which is not in proximity with UE1.
Figure 6.3.5.1-1: a scenario of discovering UE to UE relay
In order to find a public safety UE to act as the UE-to-UE relay, the
initiating UE broadcasts a relay request message including the identifiers of
the initiating UE and the destination UE. When a UE in proximity with the
initiating UE receives the relay request message, it decides whether it can
act as the relay for the communication. If it can, it returns a relay response
message including its identifier to the initiating UE. Otherwise, the UE drops
the relay request message. If there are more than one UE in proximity with the
initiating UE can act as the relay, the initiating UE has to select one from
them based on, e.g. the received signalling strength.
Editor\'s note: The identifier of the public safety UE is FFS.
After the UE-to-UE relay is selected, in order to trigger the UE-to-UE relay
to establish the path between the UE-to-UE relay and the destination UE, the
initiating UE sends a relay path establish request message to the UE-to-UE
relay including the identifier of the destination UE, the QoS of the path to
be established and so on. After the path between the UE-to-UE relay and the
destination UE and the path between the UE-to-UE relay and the initiating UE
are successfully established, the initiating UE can communicate with the
destination UE through these two paths.
#### 6.3.5.2 Communication path establish procedure
The detail of the procedure to establish the communication path is illustrated
based on the scenario shown in Figure 6.3.5.1-1 and the procedure is shown in
Figure 6.3.5.2-1.
Figure 6.3.5.2-1: Relay path establishment procedure
Step 1: UE1 wants to communicate with UE5, but UE1 finds that UE5 is not in
proximity. In order to find a UE-to-UE relay for the communication, UE1
broadcasts a relay request message including identifiers of UE1 and UE5.
Step 2\~4: When a UE in proximity with UE1 receives the message, the UE first
makes a decision on whether it can act as the relay for UE 1 and UE 5 based
on, such as the relay capability (enabled or disabled), the proximity
relationship with the destination UE, the current process load, the signalling
strength received from the destination UE, the user preferences and so on. If
the UE can act as the relay, it returns a relay response message to UE1
including the identifier of the UE. Otherwise, it drops the relay request
message.
NOTE 1: The UE to UE Relay may initiate ProSe discovery to determine whether
the destination UE is in its proximity if it has no valid proximity
information of the destination UE, or initiate ProSe discovery procedure
periodically to gather the proximity information of UEs nearby.
Step 5: UE1 obtains the UEs that can act as the relay for the communication
based on the received relay response message, then selects one of them by
considering, e.g. the received signalling strength. It is assumed that UE1
selects UE2 to act as the relay. Then UE1 sends a relay path establish request
message to UE2, and the message includes the identifier of UE5, the QoS of the
path and UE1 Tunnel Endpoint ID. UE1Tunnel Endpoint ID is allocated by UE1 to
uniquely identify a tunnel endpoint of the tunnel between UE1 and UE2.
NOTE 2: The type of tunnel to be established between UE to UE relay and
initiating/destination UE is FFS.
Step 6: Authentication and security setup procedure between UE1 and UE2.
Editor\'s note: Authentication and security setup procedure is FFS.
Step 7: UE2 sends a connection establish request message to UE5 including the
identifier of UE2, the QoS of the path and UE2 Tunnel Endpoint ID. UE2 Tunnel
Endpoint ID is allocated by UE2 to uniquely identify the tunnel endpoint of
the tunnel between UE2 and UE5.
Step 8: Authentication and security setup procedure between UE2 and UE5.
Editor\'s note: Authentication and security setup procedure is FFS.
Step 9: UE5 returns a connection establish response message to UE2 including
an indication whether UE5 accepts the request to establish a relay path via
UE2 or not. If UE5 accepts the request, UE5 Tunnel Endpoint ID is also
included in the message. UE5 Tunnel Endpoint ID is allocated by UE5 to
uniquely identify the tunnel endpoint of the tunnel between UE2 and UE5.
Step 10: UE2 receives the response message from UE5, if the message indicates
that the path between UE2 and UE5 has been successfully established, UE2 sends
a relay path establish response message to UE1 including an indication whether
the communication path is successfully established. If the communication path
is successfully established, UE2 Tunnel Endpoint ID is also included in the
message. UE2 Tunnel Endpoint ID is allocated by UE2 to uniquely identify the
tunnel endpoint of the tunnel between UE1 and UE2.
After the tunnel between UE1 and UE2, and the tunnel between UE2 and UE5 are
established, UE1 can send data to UE5.
#### 6.3.5.3 Communication path via a UE-to-UE relay
The communication path between the initiating UE and the destination UE is
based on two tunnels:
\- The tunnel between the initiating UE and the UE-to-UE relay; and
\- The tunnel between the UE-to-UE relay and the destination UE.
The UE-to-UE relay stores the one-to-one mapping between these two tunnels.
#### 6.3.5.4 Impact on existing entities and interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.3.5.5 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.3.6 Solution R6: ProSe Relay as v4/v6 IP router with application level
gateway functions
#### 6.3.6.1 Functional description
##### 6.3.6.1.1 General
Based on stage 1 requirements defined in TS 22.278 [3], a ProSe relay is
assumed to be used for public safety UE\'s only. For this reason, we assume
for the rest of the discussion that the UE uses only network independent ProSe
communications with relays, i.e. the ProSe communication is enabled without
requesting network authorization even if the UE happened to be under network
coverage. In a nutshell, the assumption is that a relay is used when the UE
believes it benefits from it more than it could benefit from the network so it
goes into a mode where it assumes to operate independently from the network
and via the relay.
ProSe Relays support interfaces which may be:
\- ProSe direct communications connections only (UE-to-UE relay documented in
TS 22.278 [3])
\- ProSe connections and regular network connections (UE-to-Network relay
documented in TS 22.278 [3]).
ProSe Relays restrict usage to just a select set of applications groups
(identified each by a ProSe Application ID) e.g. based on configuration.
##### 6.3.6.1.2 ProSe UE-to-UE relay
The UE to UE ProSe relay allows for routing among ProSe direct communications
links. Some application layer gateway/function may optionally be present e.g.
for inter-group communications firewalling related needs if the relay allows
opening inter-group routing, based on configuration. Based on stage one, there
cannot be multiple hops over relays, so it is assumed that a UE-to UE relay
cannot connect to another relay.
Figure 6.3.6.1.2-1
##### 6.3.6.1.3 ProSe UE-to-Network relay
The ProSe UE-to-Network relay allows relaying traffic between a ProSe
interface and the network. Since a UE-to -network ProSe relay may serve a
number of UE\'s, direct routing between these UE\'s is also allowed (thus
functioning as a UE-to-UE relay). For this reason, a UE-to-network ProSe relay
is a superset of a UE- to-UE ProSe relay which in addition to UE to UE
communications supports the connectivity to PDNs reachable via the EPS.
If the connectivity to the network is via a NAT in the ProSe Relay (for IPv4),
or the Uu connectivity can be optimized for specific applications, proxies or
application level gateways may be supported in the ProSe Relay. In the case of
proxies, the address of the proxies is provided to the UE e.g. using ProSe
signalling used for discovery or direct communications (as part of ProSe
Attributes for the specific application group, as documented in clauses 6.2.2
and 6.1.6).
Figure 6.3.6.1.3-1
##### 6.3.6.1.4 ProSe Link establishment to a ProSe relay
These are the underlying assumptions:
\- ProSe relay is used only for public safety.
\- Network independent direct communications are used for UE to relay
communications.
Devices using a ProSe Relay will use targeted or non-targeted discovery
(documented in clauses 6.1.6 and 6.1.7 of the present document) to discover
the existence of any relay in proximity, without any assistance from the
network. A relay advertises its capability to be a UE-to UE or UE-to-Network
relay in the attributes fields of the discovery messages.
A UE can only send data directly to a ProSe Relay if it is a member of one of
the Groups supported by a ProSe Relay, as identified by the ProSe Application
IDs exchanged in the discovery phase and direct communications establishment
phase (see clause 6.2.2 of this document). This means the relay and the UE\'s
that use it share a secret which enables mutual authentication and also secure
transmission of data, independently of any assistance or coverage by the
network. Further security aspects as to whether a dedicated session key to
access a ProSe UE-Network relay is required inside a public safety group are
to be studied in SA WG3.
##### 6.3.6.1.5 Routing of traffic in ProSe relays
A ProSe Relay forwards multicast data to all intended devices in proximity
using direct group communications (without discovery) to all members of a
ProSe Application ID identified by a ProSe Application ID.
Routing between members of the same application group can happen directly in
the relay if applicable. However, if UEs belong to different application
groups, mutual local routability between groups needs to be authorized by
local configuration in the ProSe Relay. Firewalling and NAT among application
groups may exist.
In release-12 it is not allowed for Ad-Hoc networks of ProSe relays to avoid
the need to support routing protocols in relays.
##### 6.3.6.1.6 IP address assignment and networking
Both IPv6 and IPv4 are supported by a ProSe Relay.
As described e.g. in TR 23.703 clause 6.2.2\"Solution C2: Direct
communications point to point with authorization based on application-defined
ProSe Application ID and system provided ProSe ID\") the relay is in charge of
assigning IP addresses on the ProSe Link.
For IPv4, the relay uses Private addresses for assignment of IP addresses to
devices it supports. The relay acts as default gateway for the devices.
For IPv6, the ProSe relay shares a prefix among the UE\'s it supports by
allocating different prefixes to different groups and manages IP addresses
using DHCPv6 on ProSe links. When the ProSe Relay is a UE-Network relay, the
ProSe Relay acts as a \"Requesting Router\" as described in RFC 3633 and uses
procedures similar to those described in clause 5.3.1.2.6 of TS 23.401 [11] to
allocate prefixes to different groups. Network access policies and mutual
routability are managed on a prefix basis and group membership basis.
##### 6.3.6.1.7 Interactions with GCSE_LTE and other applications.
A UE-to-network ProSe Relay may act as an agent/application level gateway for
GCSE_LTE. The Relay is supporting just the set of group communications
applications the public safety agencies require to be supported for the
foreseen deployment scenarios of the specific ProSe Relay. It is assumed a
ProSe Application ID is associated to an instance of GCSE application agent in
the relay. When a UE connects with the relay, it obtains the IP address of the
agent in the relay.
A relay may support more than one Group application and therefore more than
one group communication service Agent towards the network. All these agents
share the same IP address towards the network and the differentiation between
different signalling for different groups and different content of
communication is determined by the agents based on transport level
information.
The relay may enable listen only mode operations by acting as a GCSE client
towards the network and then forwarding to all the group members in the
vicinity the received data by direct group communications without discovery
using a well-known multicast IP address for the particular application. A UE
intending to participate in the mission using listen only mode via the relay
would listen to such direct group communications via the relay.
As an agent, the ProSe Relay acts as a UE towards the GCSE application and
would receive the content either in unicast or multicast mode as described in
TR 23.768 [5] clause 6.5. Therefore the UEs using the relay are not involved
in monitoring the TMGI and transitioning between unicast and Multicast. The
relay would register with the Group application only if there is at least one
device connected to it requesting the support of the group application,
including itself if the relay itself was a group communications user. Also, it
would register each individual UE with the application but the application
knows these are registration from a Relay as the relay inserts information
into the signalling to the Group Application Server indicating so. The relay
may be required by a specific group application to register itself as a valid
relay node before registering individual UEs that use it.
A device registers for a group application via the ProSe Relay as normal but
the agent in the ProSe Relay would indicate explicitly in the response to the
UE it is using a relay and that it has not to activate the TMGI monitoring and
rather expect transmissions over a specific ProSe Application ID - related
Layer two address using ProSe direct communications.
When there is no UE left for a specific Group communications application in
the relay, the Relay would stop forwarding this specific group communications
from the network.
#### 6.3.6.2 Procedures
The procedure for the involvement of a relay in group communications is
depicted here below in Figure 6.3.6.2-1.
Figure 6.3.6.2-1 ProSe relay and participation in a group communication
supported by the relay
1) The ProSe UE-to Network Relay attaches to the network and obtains its IP
address / prefix for the supported PDN for the group
2) The UE discovers the ProSe relay and it finds out it supports the
application group it is interested in and that it is a ProSe relay supporting
the network it needs for the group communications
3-5) Establish the ProSe communications link (including IP address assignment)
between the UE and the Relay. If IPv6 is used the relay may use prefix
delegation from the PGW (not shown) as per TS 23. 401 clause 5.3.1.2.6 \"IPv6
Prefix Delegation via DHCPv6\".
6) The UE initiates registration with the Application. The ProSe Relay acts as
application level gateway/proxy and manipulates some signalling messages so
that the TMGI allocated to the group, which the relay learns, is not what the
UE will use to receive data, but rather listen to a specific direct one to
many communications the ProSe Relay will use to forward the Group
communications application data using a specific IP multicast address. The
ProSe Relay also notifies the Group Application server that it is a relay, so
when the application sends data in unicast to the ProSe relay, it does so only
once even if many UE\'s are linked to the relay for the specific group
application. Group communications switch between unicast and multicast is
managed by the relay and not by the UE\'s attached to the relay.
7) In step 7 the UE executes the instructions learned in step 6 from the ProSe
Relay (i.e. listens to the ProSe Application ID- related Layer two address
specific direct communications and in particular the group communications will
use a specific multicast IP address the UE learns in step 6).
8) DL data arrives to the ProSe Relay either using multicast or unicast as
required.
9) The UE receives data as per the learned in step 6 and enabled executed in
step 7.
10) The communications continue using the relay as agent of UE signalling and
maintaining the communication path with the network without involving the UE.
When path switched to unicast in the link between the relay and the network
the transmission method over the UE-relay interface is unaffected.
#### 6.3.6.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.3.6.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.3.7 Solution R7: GCSE architecture with UE-to-Network Relay
#### 6.3.7.1 Functional Description
##### 6.3.7.1.1 Solution Description
The solution for UE-to-Network Relay described here builds on top of the
following:
\- GCSE architecture using IMS and eMBMS described in clause 6.4 of TR 23.768
[5];
\- ProSe communications in Group Owner mode described in clause 6.2.1 of TR
23.703.
##### 6.3.7.1.2 Architecture reference model
Figure 6.3.7.1.2-1: Architecture for GCSE communication via a ProSe UE-to-
Network Relay
New or enhanced reference points:
**Gm*** : This is an enhanced Gm as described in clause 6.4.1 of TR 23.768
[5]. It relies on SIP signalling for establishment, modification and release
of GCSE Group communication sessions, or for joining and leaving pre-
established GCSE Group communication sessions. Floor control is performed
using BPCF [14] or RTCP messages (e.g. like those defined in [13]).
**Gm-bis** : This is a reference point between GCSE application clients
residing in the UE and in the UE-to-Network Relay. It relies on SIP signalling
and has similar functionality as the enhanced Gm*.
The following are the salient features of this solution:
1\. The UE-to-Network Relay functionality resides in the ProSe Group Owner
(GO);
2\. The UE-to-Network Relay operates at the application layer by including the
following functionality in the ProSe GO:
\- a Back-to-Back User Agent (B2BUA) functionality that interworks control
plane signalling between Gm* and Gm-bis;
\- an RTP/RTCP translator for relaying user plane data (which may not be
needed when IPv6 is used on both sides of the relay);
3\. The UE-to-Network Relay is able to explicitly check with the network
whether it is authorized to act as relay for a specific GCSE Group and/or a
specific GCSE Group member. The UE-to-Network Relay is also able to restrict
the UE traffic to GCSE communication only;
4\. Uplink delivery on PC5 (UE-to-GO) is unicast;
5\. Downlink delivery on PC5 (GO-to-UE) can be either unicast or multicast,
regardless of the delivery method on Uu (unicast or eMBMS). The B2BUA can make
the decision for delivery type based on e.g. the number of GCSE Group members
in the ProSe Group;
6\. The solution supports both IPv4 and IPv6, including different IP versions
on Gm* and Gm-bis;
7\. The solution supports one-to-one communication via UE-to-Network Relay;
8\. For applications that require it, floor control is performed is performed
by a centralised floor control server residing in the network (e.g. collocated
with the GCSE AS).
NOTE: Strictly speaking the UE-to-Network Relay function can reside in any
ProSe Group member, however this would lead to a suboptimal usage because
every Gm-bis hop would involve two PC5 hops, whereas Gm* would have an
additional PC5 hop. Another reason for collocating the UE-to-Network Relay
function with the ProSe GO is to allow the ProSe GO to advertise the
collocated UE-to-Network Relay capability.
Editor\'s note: Support for HTTP-based interfaces (e.g. Ut) in this
architecture is FFS.
Editor\'s note: If the UE is under network coverage it is FFS whether it needs
to detach from the network in order to use the relay service of a UE-to-
Network Relay.
##### 6.3.7.1.3 GCSE Group and ProSe Group relationship
The GCSE Group includes all group members that take part in a common group
communication, regardless whether they access to the network directly or via a
UE-to-Network Relay.
The members of an established GCSE Group communication may thus be scattered
across multiple ProSe Groups.
In contrast, ProSe Group is a local concept designating a collection of UEs
capable of communicating with each other or with the network (via a GO) and
belonging to the same local IP subnet.
UEs connected to the same ProSe Group (for the purpose of getting network
access via a UE-to-Network Relay) may actually be unaffiliated and may belong
to different GCSE Groups.
#### 6.3.7.2 Procedures
##### 6.3.7.2.1 General
The procedures in the present clause are provided as examples only.
##### 6.3.7.2.2 Relay discovery and ProSe Group joining
Depicted in Figure 6.3.7.2-1 is a high-level call flow for the ProSe Group
Owner architecture applied to a relay use case.
Figure 6.3.7.2.2-1: Relay discovery and ProSe Group joining
1\. UE_A is out of network coverage and needs to discover a UE-to-Network
Relay. UE_R is under network coverage and is capable of acting as a UE-to-
Network Relay. There are several possibilities for relay discovery and their
applicability may depend on additional requirements (e.g. covert operation):
\- UE_R may autonomously start a ProSe Group and send a beacon message
advertising its capability for acting as a UE-to-Network Relay;
\- UE_A may periodically transmit probe messages (e.g. using Targeted ProSe
discovery described in TR 23.703 clause 6.3) indicating that it is looking for
a relay service. Upon reception of the probe message, UE_R starts a ProSe
Group and replies to UE_A that it can act as a relay;
2\. UE_A performs authentication with the GO. A Pairwise Master Key (PMK) is
generated as part of the authentication procedure and is used subsequently to
protect unicast traffic between UE_A and GO. There are several possibilities
for authentication:
\- UE_A and the GO engage in mutual authentication that does not require any
network involvement (e.g. based on certificates or a pre-shared secret);
\- UE_A authenticates with the network, the GO acting as the authenticator;
3\. The GO assigns an IP address to UE_A for use on the local ProSe IP subnet.
At this point both UEs are also cognisant of their respective layer-2 IDs;
4\. The GCSE application client in UE_A registers with the GCSE application
client in the relay via Gm-bis, requesting relay service for a specific GCSE
Group. This procedure is explained in more details in clause 6.3.7.2.3.
##### 6.3.7.2.3 GCSE client registration and GCSE Group communication setup
Outlined in Figure 6.3.7.2.3-1 are the control plane procedures for GCSE
client registration and mobile terminated GCSE Group communication
establishment in presence of UE-to-Network Relay. Given that these procedures
are SIP/IMS-based, the EPC nodes are absent from the figure. For simplicity,
the intermediate IMS nodes (e.g. P-CSCF, S-CSCF) have been omitted, too.
Figure 6.3.7.2.3-1: GCSE client registration and GCSE Group communication
setup
1\. UE_A establishes ProSe communication with UE_R which acts as a UE-to-
Network Relay, as described in clause 6.3.7.2.2. After completion of this
procedure there is basic IP connectivity between UE A and UE_R.
2\. UE_A sends a GCSE Register message to UE_R indicating that it wishes to
take part in the GCSE group communication session identified via GCSE Group ID
i.e. a GCSE Group specific URI (e.g. fire.brigade75@firstresponder.com).
3\. UE_R forwards the GCSE Register request to GCSE AS informing the latter
that it can act as a relay for A. UE_R also indicates the relevant SIP address
of its Back-To-Back User Agent (B2BUA) that will be used as SIP signalling
relay, as well as its RTP translator address that will be used as a user plane
(RTP/RTCP) relay.
NOTE 1: The user of UE_R may or may not be a member of the requested GCSE
Group. It is up to the GCSE AS to decide whether a non-member UE_R shall be
authorized to act as UE-to-Network Relay.
4.-5. GCSE AS performs authorization checks (e.g. whether UE_R is authorized
to act as UE-to-Network Relay for User A and/or for GCSE Group ID) and
acknowledges the registration to UE_A.
6\. A remote user using UE_C initiates a GCSE group communication session to
GCSE Group ID by sending a SIP INVITE (GCSE Group ID) to the GCSE AS.
NOTE 2: In case UE_A joins an already established GCSE communication, the SIP
INVITE (GCSE Group ID) is sent by the GCSE AS.
NOTE 3: In case of one-to-one communication, the SIP INVITE in step 6 contains
the personal SIP URI of the called user (instead of GCSE Group ID).
7.-8. GCSE AS checks that both UE A and UE_R are members of the GCSE Group
identified via GCSE Group ID and forwards a SIP INVITE to both of them. Thanks
to the GCSE registration performed in steps 2-5, GCSE AS knows that the SIP
INVITE sent to UE_A needs to be routed via UE_R. This is enforced e.g. by
including a Route header value pointing to UE_R.
9\. UE_R inserts a B2BUA for relaying SIP signalling messages to/from UE_A and
forwards the SIP INVITE to UE_A.
10.-13. OK messages.
NOTE 4: Steps 7 and 12 in Figure 6.3.7.2.3-1 are needed only when the UE-to-
Network Relay is part of the GCSE Group for which it acts as a relay.
NOTE 5: The security aspects at Gm-bis/Gm* level in this architecture to be
studied by SA WG3 include the following: UE authentication with the GCSE AS
and end-to-end security (UE to GCSE AS) that would prevent a non-member relay
to eavesdrop on the GCSE Group communication.
Outlined in Figure 6.3.7.2.4-1 is the floor control procedure (only for
applications that need it).
Figure 6.3.7.2.4-1: Floor control procedure
The call flow is largely self-explanatory and needs no step-by-step
description. The following assumptions apply:
\- Floor control messages (Floor Request and Floor Grant in Figure
6.3.7.2.4-1) may be based on RTCP messages (e.g. like those defined in [13]);
\- Floor control requests are always arbitrated by the GCSE AS, regardless
whether UE connects to the network directly or via a UE-to-Network Relay;
\- UE-to-Network Relay forwards the floor control messages to/from UE as any
other user plane data.
#### 6.3.7.3 Impact on existing entities and interfaces
The existing Gm reference point is enhanced with SIP signalling functionality
for GCSE Group communication control. In the user plane Gm is enhanced with
RTCP functionality for floor control (only for applications that need one).
#### 6.3.7.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
It presents the following advantages:
\- It completely decouples the radio technology used on Uu and PC5. For
instance, it allows for use of LTE-based PC5 and UTRA-based Uu. This could
maximise the geographical areas in which a Relay can be used.
\- It has no impact on Uu. At EPS level the network perceives only one entity
- the ALG Relay. The presence of multiple out-of-coverage UEs is visible to
the network only at the application layer.
\- The only required RAN functionality on PC5 to support the Relay operation
in this solution is ProSe communication. The solution assumes that Relay
discovery on PC5 is performed using Targeted Discovery or a beacon signal (as
described above).
\- It completely decouples the delivery type on Uu and PC5. For instance, it
allows for use of unicast delivery on PC5 and multicast delivery (eMBMS) on
Uu, or vice versa. The ALG function in the Relay has freedom to choose the
most efficient delivery type on PC5 regardless of the delivery type on Uu.
\- The ALG function in the Relay ensures that multiple copies of the same
content are never transmitted on Uu (by always requesting a single copy from
the GCSE AS using application-level signalling), regardless of the Uu delivery
mode.
\- The ALG function in the Relay can host a NAT device, thus allowing for use
of IPv4 addresses on Uu.
NOTE: The first two bullets apply to all PC5-based Relay solutions.
### 6.3.8 Solution R8: Application layer based ProSe Relay
#### 6.3.8.1 Functional description
This solution provides the functionality to provide connectivity for group
communication service to out of network coverage UEs via ProSe UE-to-Network.
The following figure shows the additional reference points in the architecture
to support application layer based ProSe Relay.
Figure 6.3.8.1-1: Application layer based ProSe Relay reference points
New application layer interface of Gc1\' is used between the UE and the ProSe
Relay node. The Gc1\' supports the group communication for the UEs behind of
the ProSe Relay node. The Gc1\' is designed as an generic interface to provide
the functionality that can also be reused for ProSe UE to UE relay, for
example when, both ProSe enable public safety UEs are out of coverage.
The ProSe Relay node must be authorized as the ProSe Relay function on per
group basis.
In order to keep track of the membership per GCSE group, ProSe Relay node
needs to maintain a ProSe Relay authorized UE-white list per authorized GCSE
group. The ProSe Relay node relays the data only for the UEs in the ProSe
Relay authorized UE-white list of this group. The ProSe Relay authorized UE-
white list must be provided by GCSE AS. The GCSE AS authorizes the UE to
validate UE\'s membership for that group.
Because of radio efficiency it is proposed that GCSE AS doesn\'t communicate
directly to the UEs behind ProSe Relay node. Instead the GCSE AS sends
downlink group communication data to ProSe Relay node via unicast or MuSe.
After the ProSe Relay node receives the downlink group communication data, it
forwards the data to the UE(s) in the ProSe Relay authorized UE-white list of
the group via one-to-one communication path or one-to-many communication path.
The UE behind the ProSe Relay node will explicitly indicate to the GCSE AS
that, it is communicating to the GCSE AS via the ProSe Relay node, so that,
GCSE AS would have sufficient info to coordinate with MuSe to determine the
unicast or multicast downlink towards the ProSe Relay node and the UE.
Editor\'s note: More detailed investigation is needed to verify the system
impacts due to the presence of ProSe Relay node between the UE and the
existing GCSE Applications (e.g. HTTP-based, IMS-based, MBMS-based etc.).
#### 6.3.8.2 Procedures
Figure 6.3.8.2-1: ProSe Relay communication establishment call flow
1\. The ProSe Relay node sends GCSE registration request to GCSE AS, including
the ProSe Relay node application user identity and the Relay capability
indication. The GCSE AS address is preconfigured in the ProSe Relay node.
2\. The GCSE AS performs authentication to the ProSe Relay node according to
the subscription. The GCSE AS verifies whether the GCSE group is allowed to be
relayed and whether this node can be ProSe Relay node of the GCSE group. The
GCSE AS sends GCSE registration response to the ProSe Relay node, including
the authorized GCSE group id and the Relay allowed indication.
3\. The ProSe Relay node performs ProSe Announcement, including a Relay
indication and the authorized GCSE group id.
4\. UE and ProSe Relay node do the discovery via ProSe direct discovery
mechanism. In case of multiple ProSe Relay Nodes discovered by the UE, the UE
selects one ProSe Relay Node for ProSe direct communication.
NOTE 1: How the UE selects the ProSe Relay Node is FFS.
5\. The UE establishes ProSe communication to the selected ProSe Relay node.
The ProSe Relay node allocates local IP address to the UE and this local IP
address will be used for ProSe communication between the UE and ProSe Relay
node.
6\. The UE sends GCSE Relay joint request to the ProSe Relay node, within this
message is a GCSE registration request message with parameters: including the
UE\'s GCSE application user id, the GCSE group id and a relay indication. The
GCSE group id is the same as the one announced by the ProSe Relay Node.
7\. The ProSe Relay node verifies if this is GCSE Relay joint request targeted
for the GCSE group that has been authorized for the ProSe Relay node before
forwarding the UE\'s GCSE registration request to the corresponding GCSE AS,
including UE GCSE application user id, the GCSE group id and a relay
indication.
8\. The GCSE AS performs authentication and authorization to verify if the UE
is allowed to be participated in the target GCSE group.
9\. If the UE is allowed, the GCSE AS sends GCSE registration response (GCSE
group ID, Relay allowed indication) to the ProSe Relay node, indicating that
the UE is authorized to be participated in the Group communication of the
given GCSE group.
10\. The ProSe Relay node adds the UE into the ProSe Relay authorized UE-white
list of the corresponding GCSE group.
11\. The ProSe Relay node sends GCSE Relay Joint response with the GCSE
registration response to the UE.
12\. When the ProSe Relay node receives Group communication data via unicast
(ProSe Relay Node EPS PDN connection) or multicast (MuSe), it forwards the
data to all of the UEs in the ProSe Relay authorized UE-whitelist of the
corresponding GCSE group via one-to-one or one-to-many communication path.
Editor\'s note: It is FFS how to establish one-to-many communication path
between the ProSe Relay Node and UE.
13\. When the ProSe Relay node receives data from the UE in the ProSe Relay
authorized UE-white list of this GCSE group, it forwards the data to the GCSE
AS for the corresponding GCSE group.
#### 6.3.8.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.3.8.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.3.9 Solution R9: Reuse of Architecture A1 from TR 36.806
#### 6.3.9.1 Functional description
The proposed architecture is essentially \"architecture A-1\" from TR 36.806
\"Relay architectures for E-UTRA\" v9.0.0 using \"outband relays\" (note 1).
NOTE 1: Clause 9, TR 36.814 \"Further advancements for E-UTRA physical layer
aspects\" v9.0.0.
In this scenario, \"outband relay\" could mean, for example, that the Public
Safety UE-Network Relay Node to Donor eNB is using LTE 800 MHz and the Public
Safety UE-Network Relay Node to end User UE is using a channel in a 700 MHz
band.
NOTE 2: Release 10 selected \"architecture A-2\" from TR 36.806. However the
Relâ€‘10 work enabled operation of inband relays (which required DeNB changes
for new radio control channels on the Un interface between DeNB to RN); had to
support Relâ€‘8 UEs; and support X2 mobility to adjacent cells.
Editor\'s note: It is FFS whether this architecture can also be used for
\"inband\" operation with Release 12 ProSe enabled Public Safety UEs.
The figure below is a copy of Figure 4.2.1.1-1 from TR 36.806 v9.0.0 that has
been edited to only show 'alternative 1\' of 'architecture A\'.
Figure 6.3.9.1-1: Architecture A-1 for relays (edited copy from TR 36.806)
#### 6.3.9.2 Procedures
##### 6.3.9.2.1 General
With this architecture and \'outband\' operation:
a) the Donor-eNB is intended to be a standard Rel-8 eNB, (i.e. the Release 10
Relay Control Channels are not needed), and
b) the \"Relay-UE\" is intended to operate as a normal UE.
Then
c) (when activated as a relay by the Public Safety personnel) the Relay-UE
activates a Default Bearer to the PLMN\'s \"relay APN\". The Relay-UE\'s MME
(in association with the HSS) verifies that the Relay-UE is permitted to
activate such a Default Bearer.
If not already configured, the Relay-UE can use this default bearer to receive
e.g. an OMA DM Managed Object that configures the parameters (e.g. Cell ID,
TAI and User-UE\'s MME address) that the PS UE-Network Relay Node will use in
the S1-AP signalling on the S1-MME(UE) interface. This TAI is NOT used by
other PS UE-Network Relay Nodes or normal eNBs (at least, not used within that
geographic area).
NOTE 1: The Release 10 two phase Relay Node Attach procedures described in
clause 4.3.20.2 of TS 23.401 [11] are not used.
d) the security procedures designed in TS 33.401 to counter the threats
identified in clause 5 of TR 33.816, \"Feasibility study on LTE relay node
security\" are NOT used. This is because:
\- the relay-eNB is only intended to be used in a \"closed access\" mode by
members of the emergency service; and
\- the emergency service users should be using (at least) \"end to middle\"
encryption between the \"User-UE\" and the \"GCSE application server\" (so
reading the data stream inside the Public Safety UE-Network Relay Node is not
a threat).
\- if integrity protection of the S1-AP signalling on the S1-MME(UE) interface
is required, then appropriate keys could be agreed during step c (e.g. by
using Protocol Configuration Options IEs sent between the Relay-UE and the
RADIUS/Diameter servers connected to the Relay-UE\'s PGW, coupled with not-
yet-specified mechanisms to convey those keys to the User-UE\'s MME).
Editor\'s note: SA WG3 should be involved in the security analysis.
e) the \"Relay-eNB\" performs the S1 Setup procedures (clause 8.7.3 of S1-AP,
TS 36.413) with the User-UE\'s MME.
NOTE 2: (Using the terminology in Figure 6.3.9.1-1 above), the User-UE\'s MME
may need to maintain more S1 connections than the Relay-UE\'s MME: if this is
an issue, then an appropriate MME with such capabilities is signalled in step
c.
f) The \"Relay eNB\" either broadcasts this Tracking Area ID on the \"PC9\"
interface or sends the TAI direct on PC9 to the \"User-UE\".
\- When the User-UE detects the Relay eNB (e.g. following loss of macro
network coverage), the User-UE performs a TA Update to the User-UE\'s MME.
\- As with normal S1 interface procedures, the Relay eNB inserts its cell ID
and TAC into the Initial UE Message that carries the TA Update Request to the
User-UE\'s MME.
\- The User-UE\'s MME determines whether the User-UE is authorized to access
that Relay eNB. If not authorized, the User-UE is rejected with cause #15,
resulting in the User-UE looking for other Relay eNBs/TAUs/LAUs to access.
g) As part of a successful registration on the Relay eNB (or movement to away
from the Relay eNB to another Tracking Area), the Cell ID of the User-UE is
using is sent from the User-UE\'s MME through the User-UE\'s PGW onto the GCSE
Application Server. The GCSE AS uses its normal processes to determine whether
or not the Relay eNB is part of the User-UE\'s 'group call area\' for any
group media that it needs to distribute.
NOTE 3: The restriction in TS 36.300 clause 8.2 \"network entity related
identities\" that \"_The Global eNB ID of RN is the same as its serving DeNB_
\" does not apply to this architecture (as it is based on architecture A-1).
h) (as described in the GCSE TR 23.768 [5], clause 6.2 \"Solution 2 -
Permanently RRC Connected\") the GCSE-AS performs the counting procedures and
determines whether to use unicast or broadcast procedures for the media
distribution via that Relay eNB.
Coordinated reservation by the HPLMN and VPLMN of a range of Cell IDs for the
Relay-eNBs allows the GCSE AS to determine that the User-UE is on a Public
Safety UE-Network Relay Node. This may be useful if the User-UE to Relay-eNB
is generally used in broadcast rather than unicast mode.
i) The Public Safety UE-Network Relay Node is designed to support Broadcast
(eMBMS) mode.
\- MBSFN operation of the Public Safety UE-Network Relay Node is not used as
exact time synchronisation of the Public Safety UE-Network Relay Node poses
extra requirements on its link to the DeNB link (and requirements on the
DeNB).
\- Because this Public Safety UE-Network Relay Node is a single \'cell\', and
MBSFN is not in use, the MCE is located within the Public Safety UE-Network
Relay Node.
\- in step e) above, the Relay eNB also performs the M3-AP Setup procedure.
The Relay-UE does not receive any eMBMS broadcasts from the DeNB. M3
procedures are carried across the Relay-UE\'s GTP-U tunnel with the Relay-
UE\'s PGW.
\- when the GCSE AS determines that Broadcast mode needs to be used on the
Public Safety UE-Network Relay Node, the GCSE AS causes the MME (e.g. using
signalling through the BM-SC and MBMSâ€‘GW to the MME) to initiate an M3-AP MBMS
Session Start Request message to the IP address of the Relay-UE.
\- The Relay UE sends an IGMP (IPv4) or MLD (IPv6) Join message over its
default bearer (on the Relay APN) to signal its interest in receiving that
particular multicast MBMS bearer service (the one identified by the IP
multicast address received in the M3-AP Session Start Request).
\- the Relay UE PDN GW is assumed to be IP Multicast aware (this is a
requirement on 2G and 3G GGSNs in networks supporting MBMS) and hence the
Relay UE PDN GW associates the IP multicast address in the Join message with
the IP address of the Relay UE.
Editor\'s note: It is FFS whether the above step is needed.
\- downstream data received by the Relay UE PDN GW on the IP multicast address
is then distributed on the unicast GTP tunnels from the Relay UE PDN-GW to the
Relay UE.
\- the Relay eNB then broadcasts the data using the TMGI received in the M3-AP
Session Start Request.
NOTE 4: In step c, the RN-UE is stated to use a special APN when activating
its default bearer. This APN can be used to select a PDN-GW that supports IP
Multicast.
i) The mobility of the User-UE follows the procedures that will be defined for
PC9 and PC 5. (e.g. cell reselection, or, S1 handovers with the User-UE MME).
j) Mobility of the Relay Node UE is fully supported, irrespective of whether
zero, one, or many User-UEs are connected to it.
NOTE 5: The mobility of the UE-to-Network Relay is not a Stage 1 requirement
in Rel-12.
Clause 5.2.2.1 of the NOT approved TR 36.836 v2.0.1 \"Mobile Relay for Evolved
Universal Terrestrial Radio Access\" shows the signalling flows and the basic
architecture is copied below:
Figure 6.3.9.2-1: Mobility of Relay Node (copied from v2.0.1, TR 36.836)
##### 6.3.9.2.2 Relay Node Operation with PC9 interface based on PC5
While the nature of the \"1:many\" variant of the PC5 interface is still not
finalised, the following assumptions are made for the PC9 interface:
\- The Public Safety UE-Network Relay Node broadcasts some form of \'beacon\'
signal that enables User-UEs to detect its presence and obtain time
synchronisation.
\- The \'beacon\' signal broadcasts the fact that it is a Public Safety UE-
Network Relay Node WITH a connection to the network.
\- (At least because in Direct Mode Operation the units transmit before
receiving) the Relay Node is assumed to broadcast an identity on the
\'beacon\' signal. This can be viewed as equivalent to the ECGI (e.g. PLMN-ID
plus Cell ID).
Then,
1) To enable reuse of existing NAS procedures and network selection procedures
(e.g. TS 23.122), the Public Safety UE-Network Relay Node\'s 'beacon\' signal
also broadcasts a Tracking Area ID that is unique (at least within the local
radio environment) to that Relay Node.
2) When the User-UE detects the Public Safety UE-Network Relay Node\'s
'beacon\' signal, the User-UE initiates a Tracking Area Update that indicates
there is also data to be sent (e.g. \"follow on request\" is set) irrespective
of whether or not there is actually data to be sent.
\- the User-UE 'broadcasts\' the TA Update message using the ECGI as the AS
layer destination address. The Public Safety UE-Network Relay Node receives
this broadcast.
\- within the payload, the User-UE includes its GUTI.
\- The Public Safety UE-Network Relay Node opens an S1 association for that
User-UE with the User-UE\'s MME and sends the TAU to the User-UE MME.
\- The Public Safety UE-Network Relay Node allocates a \"PSUNR-Radio Network
Temporary ID\" to the User-UE.
3) because the User-UE indicated the \"follow on request\" for data, the User-
UE\'s MME sends the S1 Initial Context Request to the eNodeB part of the
Public Safety UE-Network Relay Node. The Public Safety UE-Network Relay Node
does not establish radio bearers or security contexts but does acknowledge
receipt of the S1 message. Because the User-UE\'s MME has sent the Initial
Context Request the User-UE\'s MME does not release the S1 connection until
the User-UE makes an authenticated access on another cell.
4) The Public Safety UE-Network Relay Node maintains the S1-MME connection to
the User-UE MME (and its binding to the PSUNR-RNTI) until the MME releases it.
**For downlink user plane data** :
\- the Public Safety UE-Network Relay Node broadcasts the data (received from
the BMSC) using the TMGI of the Public Safety User Group;
\- the payload contains the source IP address, and, the User-UE is
(implicitly) aware of the APN;
OR optionally if the network knows that there is only one recipient of the
data:
\- the Public Safety UE-Network Relay Node broadcasts the user data using the
PSUNR-RNTI of the User-UE.
**For uplink user plane data:**
\- the User-UE \'broadcasts\' the data using the ECGI as the AS layer
destination address. The Public Safety UE-Network Relay Node receives data
\'broadcast\' to its ECGI.
\- within the payload, the User-UE includes its PSUNR-RNTI and the identity of
the bearer.
\- the Public Safety UE-Network Relay Node uses the PSUNR-RNTI and the bearer
ID to identify on which S1-U (UE) bearer to send the data.
**For downlink NAS signalling:**
\- the Public Safety UE-Network Relay Node is assumed to not know which
GUTIs/PSUNR-RNTIs are associated with which TMGIs.
\- the Public Safety UE-Network Relay Node broadcasts the (typically,
encrypted) NAS signalling message using the PSUNR-RNTI of the User-UE.
**For uplink NAS signalling:**
  * the User-UE broadcasts the (typically, encrypted) NAS signalling message using the ECGI as the AS layer destination address. The Public Safety UE-Network Relay Node receives data 'broadcast\' to its ECGI.
  * within the payload, the User-UE includes its PSUNR-RNTI .
  * The Public Safety UE-Network Relay Node uses the received PSUNR-RNTI to identify the connection on which to forward the NAS message to the User-UE\'s MME.
##### 6.3.9.2.3 Relay Node Operation with PC9 interface based on Uu
With a Uu based PC9 interface, the Public Safety UE-Network Relay Node appears
as a normal eNodeB to the UE and existing Uu/S1 routeing/binding mechanisms
are reused.
The main concerns with basing the PC9 interface on the existing Uu interface
are:
\- It is desirable that the Public Safety UE-Network Relay Node functionality
could be available and usable in every Public Safety UE. However, use of Uu
for PC9 requires that the Public Safety UE-Network Relay Node broadcasts
significant amounts of control signals (e.g. in FDD mode it transmits
continuously) and this is likely to result in too short a battery life.
\- The control plane processing of the Public Safety UE-Network Relay Node may
be limited and it would be desirable that ordinary UEs did not attempt to camp
on it and perform a TAU. Techniques to achieve this are FFS.
NOTE 6: CSG functionality may be inappropriate to use on the Public Safety UE-
Network Relay Node. This is because UE\'s detect closed femto cells based on
non-specified search mechanisms that may be based on \"fingerprinting\" of the
local macro cell network. With nomadic Public Safety UE-Network Relay Nodes,
the surrounding macro cells will change and the UE\'s \"fingerprint\" of the
local network will not be detected and hence the (power hungry) search for the
femto cell will not start.
#### 6.3.9.3 Impact on existing entities and interfaces
No specification impact has yet been identified for the existing RAN entities
(the ProSe Public Safety UE-Network Relay Node described is this clause is NOT
the same as the existing Release 10 Relay Node). No specification impact has
yet been identified for the existing EPC entities, except:
\- procedures to integrity protect the S1-AP signalling between the User-UE\'s
MME and the ProSe Public Safety UE-Network Relay Node eNB may be required;
\- the Relay UE PDN GW may need to be IP Multicast aware.
Impacts on UE:
\- A relay UE is expected to support some of eNB functionality and protocol
stacks, i.e. broadcast signals (e.g. system information, cell id, etc.) and
perform the paging procedure for the proximity service.
\- A relay UE is expected to implement MCE (Multi-Cell/Multicast Coordination
Entity) function.
\- A User-UE is expected to perform the location registration procedure (i.e.
TAU) for the proximity service.
#### 6.3.9.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated. This clause is not yet complete.
The above descriptions refer to work that has been included in RAN Technical
Reports but which has not been progressed to normative Specifications. As
such, the future involvement of other WGs is anticipated.
ProSe Public Safety UE-Network Relay Node needs to support the S1-MME and S1-U
reference points, which implies support of protocols such as S1-AP, SCTP and
GTP-U.
The solution presents the following drawbacks:
\- Require a relay UE has to support some of eNB functionality and protocol
stacks.
It causes that Public Safety UE implementation complexity and implementation
cost increase.
### 6.3.10 Solution R10: L2 ProSe UE-to-Network Relay with Bearer sharing
#### 6.3.10.1 Functional description
The following figure shows the initial steps when an out of coverage ProSe UE
(UE-oA) is trying to get access to the network via UE-R (ProSe UE-to-Network
Relay). Step 1 and 2 is performed locally between UE-oA and UE-R for discovery
and Link establishment, authentication, etc.,. After that, UE-R needs to
interact with the network in order to establish a PDN connection with the UE-
oA.
Figure 6.3.10.1-1: Initial steps showing an out of network coverage (UE-oA)
interacting with ProSe UE-to-Network Relay (UE-R)
In this solution, the relay method used by UE-R is with layer 2. The IP
address for UE-oA is allocated by P-GW. The PDN connection that UE-R has with
the network can be shared among other connecting ProSe UE(s). The concept of
the connection sharing is depicted in Figure 2. The data traffic of the PDN
connection of ProSe UEs (UE_oA, UE_oB) uses the bearers of a PDN connection of
the Relay UE (UE_R).
Figure 6.3.10.1-2: Sharing of a PDN connection with multiple ProSe UEs
The ProSe UE has no signalling connection to the MME, the Relay UE is
responsible for the establishment and maintenance of the EPS bearers. On the
other hand the Relay UE does not perform any IP level processing for the ProSe
UE, the ProSe UE receives the IP level configuration parameters from the
SGW/PGW and the SGW/PGW is the first-hop router. The ProSe Relay performs the
mapping between the bearers over PC5 and Uu. The following figure shows the
protocol stack overview.
Figure 6.3.10.1-3: Protocol stack view between ProSe UE, Relay UE and Network
The following are the salient features of this solution.
1\. Provides an efficient means to establish one bearer for many ProSe UE(s)
via a Relay UE.
2\. The network can perform authorization (e.g. MME can check whether a ProSe
UE have right to use a given APN).
3\. The PGW is responsible for IP address allocation.
4\. It has no eNB and SGW impact. It does not change the basic concept of a
PDN connection. MME impacts are only needed if special functions (e.g.
authorization, LI report) in MME are needed.
5\. The solution can work with IPv4 and IPv6, e.g. no problem of NATting
occurs in the Relay UE if IPv4 is used.
Editor\'s note: It is FFS how the Relay UE is authorized to be used as a Relay
for a given application for a given UE
Editor\'s note: It is FFS how the solution works in roaming scenarios when the
HPLMN of the ProSe UE differs from the HPLMN of the Relay UE?
Editor\'s note: It is FFS whether the Relay UE can be a member of the same
GCSE group as the ProSe UE.
#### 6.3.10.2 Procedures
##### 6.3.10.2.1 PDN connection establishment
The following call flow shows how a PDN connection is established including
the IP address/prefix allocation for ProSe UE (UE-oA) via ProSe UE-to-Network
Relay (UE-R).
Figure 6.3.10.2.1-1: PDN connection establishment for ProSe UE (UE-oA) via
ProSe UE-to-Network Relay (UE-R)
1-2. UE-oA discovers UE-R and initiates establishment of a session with the
UE-R for Relay connectivity. This step should include the mutual
authentication of the UE-oA and UE-R.
As part of these steps, the UE-oA triggers the establishment of a Relay PDN
connection and optionally, provides an APN. If UE-oA does not provide an APN,
then it implies default APN can be used.
3\. If the UE-R has no suitable PDN connection then it establishes a new PDN
connection (with the UE requested PDN connectivity procedure). If the UE-R has
an appropriate PDN connection for the requested APN or the default APN (when
no APN was provided), then this step is skipped.
4\. The UE-R triggers the creation of a Relay Connection within the existing
PDN connection by invoking the existing UE requested bearer resource
modification procedure (Bearer Resource Modification Request). No new type of
message is needed, but new parameters should be added to indicate the addition
of relay connection (e.g. identifier for UE-R). These new parameters shall be
interpreted by the PGW, this could be transparent to the MME and SGW (e.g.
they can be inserted in PCO). Note it is possible that the MME should be aware
of this new connection e.g. for authorization or other purposes, but this is
optional.
5\. The MME forwards the request to the PGW. If no MME authorization is needed
then this may have no impact on the MME.
NOTE 1: There is no need that the MME learns anything about the UE-oA, e.g.
from the MME point of view the UE-oA is not attached to the network and the
MME does not need to perform mobility management for the UE-oA. However if
there is a need for extra authorization then the MME can perform this, but
this is not proposed in this solution.
6\. The PGW interprets the request for the creation of a new Relay Connection,
allocates the IPv6 prefix and/or IPv4 address and other resources. It sends an
Update Bearer Request to the MME via the SGW including the IP and other
parameters (e.g. updated TFTs).
7\. The MME creates a NAS message Modify EPS Bearer Context Request based on
the information received in the previous message and sends a Downlink NAS
Transport message to the eNB. This behaviour is the same as legacy MME
behaviour, the new parameters can be transparent to the MME.
8\. The eNB forwards the NAS message in a Direct Transfer message to the UE-R.
This is the legacy eNB behaviour.
9\. The ProSe bearer is established between the UE-R and the UE-oA. During the
bearer establishment the UE-oA also receives the IP address allocated by the
PGW.
10-12. The UE requested bearer resource modification procedure continues in
the legacy way between the Relay UE and the PGW
##### 6.3.10.2.2 Dedicated Bearer Establishment
Dedicated bearers are triggered by PCC based on existing procedure. PCC is not
aware that the connection to the ProSe UE (UE-oA) is via UE-to-Network relay
(UE-R). If there is an existing dedicated EPS bearer with the required QCI
with the same APN toward the UE-R then this connection can be updated to
accommodate the new dedicated bearer establishment. This requires the PGW to
combine them. In the example below it is assumed that a dedicated bearer with
the requested QCI has already been established. PCC (e.g. due to a request
from an application server) sends a new policy to the PGW to triggered the
establishment of a dedicated bearer for UE-oA. The PGW uses the Bearer
Modification Procedure with Bearer QoS Update to update the QoS parameters of
the dedicated bearer to meet the QoS requirements of the PCC request.
Figure 6.3.10.2.2-1: Dedicated bearer establishment procedure for a relay
connection
1\. The PGW receives a trigger from PCC to establish a dedicated bearer for a
UE-oA that is connected to the network via a Relay Connection. PGW aware the
connection is via Relay (UE-R) during the PDN establishment procedure.
2\. The PGW recognizes that an existing dedicated EPS bearer with the
appropriate QCI exists to the UE-R. Thus it triggers a Bearer Modification
Procedure with Bearer QoS Update by sending a Bearer Modify Request to the MME
via the SGW. (Note if no appropriate dedicated bearer exists then the legacy
dedicated bearer creation procedure could be used).
3\. The MME creates a NAS message based on the information received in the
previous message and sends a Bearer Modify Request to the eNB. This is a
legacy MME behaviour.
4\. The eNB processes the message in the legacy way, and starts updating the
radio bearer to the Relay UE. This is a legacy eNB behaviour.
5\. The Relay UE creates a dedicated bearer (or something equivalent) with the
ProSe UE based on the received modification request in the previous step.
6-8. The dedicated bearer update procedure continues in the legacy way between
the Relay UE and the PGW.
In downlink direction for packets of the UE-oA the PGW finds the appropriate
EPS bearer, i.e. one of the EPS bearer belonging to the PDN connection of
UE-R, based on the downlink TFTs. In this case a TFT can include the IP
address/prefix of the UE-oA as destination IP address/prefix. The UE-R
forwards the packet to UE-oA via a ProSe bearer. The UE-R should create its
own downlink TFTs, which includes e.g. the IP address/prefix of the ProSe UEs,
for ProSe bearers.
In uplink direction UE-oA sends the packet to UE-R using a ProSe bearer. Then
UE-R forwards the uplink packet via a PDN connection towards the PGW. The UE-R
selects the uplink EPS bearers based on the uplink TFTs received from the PGW.
##### 6.3.10.2.3 Relationship with GCSE
The following figure shows in a high level on how the solution addressed is
this TR is related to GCSE.
Figure 6.3.10.2.3-1: ProSe relationship with GCSE TR.
#### 6.3.10.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.3.10.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.3.11 Solution R11: ProSe UE-to-Network Relay as IP router
#### 6.3.11.1 Functional description
This solution for ProSe UE-to-Network provides the functionality to provide
connectivity for both \"unicast\" and \"multicast/broadcast\" (MBMS) services
to out of network UEs.
Figure 6.3.11.1-1: ProSe UE-to-Network Relay reference points
The ProSe UE-to-Network Relay needs to relay the traffic in the UL and DL
between a UE that connects to the relay and the network. This traffic (from
the network side) can be both unicast and broadcast (only in the downlink).
The relay can therefore be specific to GCSE-LTE application layer or can be a
generic function that can relay any type of traffic that is relevant for
public safety communication.
**a) ProSe UE-to-Network Relays - unicast traffic support**
The ProSe UE-to-Network Relay for unicast traffic needs to relay the unicast
traffic that is sent/received over/from the PC5 interface to/from the network
(i.e. via Uu to eNB and further). In this respect for unicast traffic the UE
connecting to the ProSe UE-to-Network Relay can be considered a tethered
device and the ProSe UE-to-Network Relay can act as \"IP router\" to this UE.
Figure 6.3.11.1-6: ProSe UE-to-Network basic \"stack\" (unicast support)
The ProSe UE-to-Network Relay using IPv6 can perform prefix delegation of the
IPv6 prefix it receives from the network or simply route the traffic to the
\"auto-configured\" IPv6 address of the UE if this prefix is globally
routable.
**b) ProSe UE-to-Network Relays - broadcast/multicast traffic support with
eMBMS to the Relay**
As part of TR 23.768 [5] it is already proposed in a number of solutions that
eMBMS will be used to serve the downlink traffic for group communication. We
therefore consider this as an \"assumption\" and consider how the DL broadcast
can be relayed on the PC5. For this case also we do not need any application
layer functionality in the ProSe UE-to-Network Relay and we investigate
further the procedures.
Figure 6.3.11.1-3: ProSe UE-to-Network basic \"stack\" (broadcast on downlink
support)
**c) ProSe UE-to-Network Relays - broadcast/multicast traffic support with IP
multicast on the Relay**
As part of TR 23.768 [5] it is already proposed in a number of solutions that
unicast will be used to serve the downlink traffic for group communication.
With IP multicast support we do not need any application layer functionality
in the ProSe UE-to-Network Relay and do not have to rely on the serving eNB
supporting eMBMS.
#### 6.3.11.2 Procedures
##### 6.3.11.2.1 Unicast traffic support
Figure 6.3.11.2.1-1: ProSe UE-to-Network connection procedure (unicast
support)
Step 1\~3: The ProSe UE-to-Network Relay attaches to the network and obtains
IPv6 prefix from the network. It may optionally in addition establish an
additional number of PDN connections based on configuration. During the attach
and/or PDN connection establishment procedure the ProSe UE-to-Network Relay
can indicate its capability to act as a relay and can be authorized by the
network e.g. via a new NAS indicator and/or PCO.
Editor\'s note: Whether IPv4 can also be supported and needs to be considered
is FFS.
Step 4: The ProSe UE-to-Network Relay \"announces\" itself as relay that has
network reachability and possibly (if needed) indicates PDN connections it has
connected to. This would assist the \"relay election\" e.g. if more than one
relays announces in proximity. The discovery procedure as in other cases is
optional in this case the UEs can be pre-configured with ProSe identities of
relays.
Step 5: The UE connects to ProSe UE-to-Network relay following procedures e.g.
as described in clause 6.2.3. During the connection procedure the ProSe UE-to-
Network relay may also authorize the UE based on the credentials and
identities exchanged. As part of this procedure the ProSe UE-to-Network Relay
may also allocate IPv6 address using \"prefix delegation via DHCPv6\" as
described in TS 23.401 [11]. This could allow easier identification of UEs
connecting to the network via ProSe UE-to-Network Relay e.g. for purposes of
charging, policy control etc.
Editor\'s note: It is FFS how the ProSe UE-to-Network Relay performs
authorization e.g. to only allow UEs to connect that connecting, belong to
specific groups.
##### 6.3.11.2.2 Multicast/Broadcast traffic support with eMBMS to the Relay
Figure 6.3.11.2.2-1: ProSe UE-to-Network receiving broadcast on downlink
Step 0: The ProSe UE-to-Network Relay is attached to EPS following normal UE
procedures.
Step 1\~2: The UE establishes a connection to the ProSe UE-to-Network Relay.
This is similar to what is described in the previous clause. As part of the
connection procedure the ProSe UE-to-Network Relay can potentially indicate to
the UE whether it supports MBMS and potentially the services indicated by
TMGIs supported in the area.
Step 3\~5: The UE since it has IP connectivity via the ProSe UE-to-Network
Relay it can register with the GCSE AS. To perform this procedure it uses the
ProSe UE-to-Network Relay only as IP router. The UE also retrieves the service
announcement of eMBMS. This can happen in two ways: either using interactive
mechanisms from BMSC in which case it contacts the BM-SC over IP or using an
eMBMS service. For the latter case in step 2, the UE can indicate the TMGI of
the service announcement in the connection procedure. In case the ProSe UE-
Network Relay moves out of the MBSFN area it informs the UEs connected to the
relay. This can be used to trigger the UEs to receive the content using
unicast.
Steps: 6\~9: When the UE will identify the TMGI corresponding to the eMBMS
service from the retrieved service announcement it sends signalling to the
ProSe UE-to-Network Relay indicating the TMGIs of the services it wants to
start receiving. In this case the ProSe UE-to-Network Relay will start
transmitting/broadcasting this service on the access stratum of the direct
link.
Editor\'s note: It is FFS how the ProSe UE-to-Network Relay performs
authorization e.g. to only allow UEs to connect that connecting, belong to
specific groups.
##### 6.3.11.2.3 Multicast/Broadcast traffic support using IP Multicast on
Relay
There may be multiple ProSe UEs ("End UEs") belonging to the same talk group
in contact with the one ProSe UE to Network Relay. To enable battery (and
radio) efficient transmissions from the ProSe UE to Network Relay for this
talk group the following steps occur:
0) While in network coverage the "End UE" is configured with the contact name
(URL) or IP address of the Group Call Application Server.
1) The ProSe Relay UE is authorised to act as a PS Relay (or rejected) by its
MME when it attempts to activate the ProSe Relay PDN. The ProSe Relay PDN is
an intranet. When the ProSe Relay UE activates the ProSe Relay PDN, the PCO
carries an indication as to whether it supports IP Multicast. This indication
is transferred to the GCSE-AS. The mechanism to do this is FFS. By
configuration, the GCSE-AS knows whether or not the Relay PDN's PDN GW
supports IP Multicast.
2) after the End UE contacts the Relay, the Relay UE allocates the End UE a
locally significant IP address.
3) the End UE contacts the GCSE-AS and is authorised and authenticated (or
rejected).
4a) (after GC2 communication) the GCSE-AS informs the End UE of the IP
Multicast address(es) that its talk group is using (and -- to avoid tracking
--those IP multicast addresses that will be used by the talk group in the
short term future).
4b) the GCSE-AS notes that the End UE is using this Relay and (until step 10)
uses unicast to distribute data to this End UE in case the relay or PDN GW
does not support IP Multicast.
5) the End UE sends an IGMP Join (or IPv6 equivalent) to the Relay UE.
6) if the Relay UE is not already a member of that IP multicast group, the
Relay UE sends the IGMP Join (as an IP packet) to the PGW serving the ProSe
Relay PDN.
7) (If not already a member of that IP multicast group ) that PGW then sends
the IGMP Join message to the MBMS GW. (A possible operator configuration is
that the MBMS GW is the same logical entity as the ProSe Relay PDN's PGW).
8) if either the ProSe Relay PDN's PGW or the ProSe Relay is already a member
of that group, then (respectively) the new Relay (new End UE) is added to the
PDN GW's (Relay's) IP multicast distribution tree.
9) Across GC1, the End UE informs the GCSE-AS that it has requested to join
the multicast distribution tree. From its knowledge (obtained in step 1), the
GCSE-AS informs the End-UE whether the Join attempt will have failed.
10) The GCSE-AS sends the media on both the unicast path to the UE and through
the MBMS GW (possibly via the BM-SC).
11) When the Relay receives IP packets on the Relay PDN containing an IP
multicast address, it checks whether it has any End UEs for that group, and if
it has one or more, the Relay then 'broadcasts' that packet on the radio
interface towards the End UE(s).
12) the End UEs receive all the 'broadcast' packets and, at layers above the
Access Stratum, they filter out packets that are not for their individual IP
address or joined IP multicast groups.
13) When an End UE receives its group's media on the IP multicast address, the
End UE informs the GCSE-AS that it has successfully joined the multicast
group.
14) The GCSE-AS then sends the media for that group for that UE only through
the MBMS GW (possibly via the BM-SC).
The End UE periodically contacts the Relay UE to keep the NAT binding alive
and/or renew (part of) its IP v6 address. Absence of this contact informs the
Relay UE that the End UE can be removed from its multicast distribution tree.
#### 6.3.11.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
##### 6.3.11.3.1 Impacts from Unicast Traffic Support
##### 6.3.11.3.2 Impacts from Multicast/Broadcast traffic support using eMBMS
to Relay
##### 6.3.11.3.3 Impacts from Multicast/Broadcast traffic support using IP
Multicast on Relay
The PDN GW and MBMS GW need to support IP Multicast.
The BM-SC may need functionality to support this feature.
The transfer of the PS UE-Network Relay's PCO's indication of IP multicast
support to the GCSE-AS may impact some nodes. Which ones are FFS.
#### 6.3.11.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.3.12 Solution R12: UE-to-Network relay with network authorization
#### 6.3.12.1 General
The solution in this clause addresses the key issue#5 \"Relay for Public
Safety ProSe\" described in clause 5.5. The UE behind the Relay UE is named as
Remote UE for simplicity.
#### 6.3.12.2 Procedures
##### 6.3.12.2.1 Overall phases for UE-to-Network relay communication
The overall phases for ProSe UE-to-Network relay communication are depicted in
the Figure 6.3.12.2.1-1.
Figure 6.3.12.2.1-1: The overall phases for UE-to-Network relay
The overall ProSe UE-to-Network relay communication includes the following
phases:
1\. Relay UE activates the Relay function based on user\'s configuration or
external triggering, e.g. receiving one message for Relay UE query. More
detail procedure can be found in 6.3.12.2.2.
2\. The Remote UE tries to find Relay UE. More details about this procedure
can be found in 6.3.12.2.3.
3\. The Remote UE tries to establish the communication path to the network via
the Relay UE. More details about this procedure can be found in 6.3.12.2.4.
4\. The Remote UE can communicate with the network via the UE-to-network
relay. More details about this procedure can be found in 6.3.12.2.5.
##### 6.3.12.2.2 UE-to-Network Relay UE activation
When the Relay UE activates the UE-to-network relay function, the PDCF need
authorize whether it is permitted to activate UE-to-network relay function
based on the ProSe UE context.
If UE-to-Network Relay function is permitted, the network provides the relay
configuration information to the Relay UE. The configuration information
includes:
\- The allowed radio resource used for UE-to-network relay.
The procedure for activating the UE-to-network relay function is depicted in
Figure 6.3.12.2.2-1:
Figure 6.3.12.2.2-1: Activation procedure for UE-to-network Relay
0\. Relay UE is triggered to activate the UE-to-Network relay based on user\'s
configuration or external triggering, e.g. receiving one message for Relay UE
query.
1\. The Relay UE sends the PDN connectivity Req (Relay activation indicator,
ProSe UE identity) to the serving MME. The Relay activation indicator can be
the APN specific for relay service.
2/3. The MME sends the relay authorization request message to the PDCF in
order to check whether the Relay UE is permitted to activate the UE-to-network
relay function.
4\. It is same as steps 2\~6 of clause 5.10.2 of TS 23.401 [11].
6\. The eNB allocates the radio resource for the Relay UE and sends the relay
configuration information to the Relay UE via RRC reconfiguration message.
7/8. It is same as steps 10, 12 of clause 5.10.2 of TS 23.401 [11].
After this procedure one PDN connection is established between the Relay UE
and the PGW, i.e. Relay PDN connection. All the following communication
between Remote UE and the network is transferred via the Relay PDN connection.
##### 6.3.12.2.3 Discovery and selection of UE-to-Network relay
The discovery of UE-to-network relay could be realized by the ProSe 1:m
communication operation. The solution defined in \"6.1.3 Solution D3: Targeted
ProSe discovery\" can be used. It is possible that the Remote UE receives
several responses for its relay request from the Relay UEs, the Remote UE will
select one Relay UE, e.g. based on the direct signal strength from the Relay
UEs.
NOTE: The UE-to-Network Relay function in Relay UE can be triggered when it
receives the query message from Remote UE.
##### 6.3.12.2.4 Establishment of UE-to-Network relay connection
The procedure for accessing the network via the UE-to-network relay is
depicted in Figure 6.3.12.2.4-1:
Figure 6.2.12.2.4-1: Attach the network via UE-to-network Relay
1\. The Remote UE sends a Relay PDN connection request to the Relay UE.
2\. The Relay UE triggers the Remote UE authentication procedure. The AAA
server and the UE perform the mutual authentication using i.e. EAP-AKA
protocol. The Relay UE and the AAA proxy transfer the authentication message
between the AAA server and the UE.
Editor\'s note how to transfer the EAP-AKA on the Relay PDN connection is FFS.
NOTE 1: The authentication message is transferred to the PGW as a data packet
via the established the Relay PDN connection (refer to 6.3.12.2.2) between
Relay UE and PGW.
NOTE 2: More details about this step will be defined in SA WG3.
3\. If the UE is authenticated successfully, Relay UE accepts the Relay PDN
connection request and sends response message back to the Remote UE.
4\. When the Remote UE receives the Relay PDN connection accept message, it
tries to apply IP address from network via the DHCP procedure. The allocated
IP address could be IPv4/IPv6 address. PGW needs the record the Remote UE IP
address assigned by the network.
5\. The IP address assigned to Remote UE before the communication to the
network via the UE-to-Network relay are not preserved. The Remote UE can
transfer the data packet via the Relay UE. The Relay UE selects the PDN
connection based on the bearer mapping, i.e. the mapping between PC5 bearer
and the Relay PDN connection). The network can also transfer the unicast data
packet to the Remote UE via the Relay UE. The PGW selects the PDN connection
based on the destination IP address. Relay UE forwards the downlink packet
based on the mapping between the destination IP address and the PC5 bearer.
##### 6.3.12.2.5 Multicast support via UE-to-Network relay
Similar as the procedure \"6.3.11.2.2 Multicast/Broadcast traffic support\"
step 6/7, the Relay UE starts to monitor the multicast channel.
#### 6.2.12.3 Impact on existing entities and interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.2.12.4 Solution evaluation
Editor\'s note: Solution evaluation will be added.
### 6.3.13 Solution R13: ProSe Relay selection
#### 6.3.13.1 General
The solution is applicable to those scenarios where multiple relay-capable
Public Safety UEs are available in communication range of a Public Safety UE
requiring relaying. The solution provides network assistance to ProSe UE
requiring relaying and helps in selecting ProSe relay, from among several
available relays in its proximity.
#### 6.3.13.2 Functional description
Relay selection procedure proposed here works in agreement with network
policies. The EPC decides on certain parameters and communicate to the ProSe
Relay UE.
A UE participates in a normal communication with infrastructure may enable
ProSe service when the connection quality decades.
A relay-capable UE is a ProSe-capable UE implemented with relay functions for
ProSe UE-to-Network relay. A relay-capable UE could turn into a Relay node
when necessary.
The network shall be aware of the capability and the configuration of ProSe-
enabled UEs.
#### 6.3.13.3 Procedures
Procedures for ProSe relay selection are shown in Figure 6.3.13.3-1:
Figure 6.3.13.3-1: ProSe Relay selection procedure
0\. Relay function in UE-R1 and UE-R2 are enabled. This may be based on UE or
network or coordinated decision.
1\. UE-R1 (and UE-R2) sends Relay-registration request to ProSe server. UE-R1,
along with its ProSe ID, may also send any relevant parameters/preferences.
2\. ProSe server, on receiving Relay-registration request, performs
authorization procedures for UE-R1 (and UE-R2) with HSS.
3\. On successful authorization, ProSe server sends Relay-registration confirm
message to UE-R1 (and to UE-R2) indicating successful registration. At this
point ProSe server adds UE-R1 (and UE-R2) in its Relay-list database.
4\. UE1 is out-of-network coverage. It thus broadcasts UE-Relay request. It
may include its location information available e.g. from GPS or other methods.
This is received by all Relay-UEs in its proximity, including UE-R1 and UE-R2.
5\. UE-R1 (and also UE-R2) sends \"ProSe_Relay_Setup_Request\" to ProSe
server. This request includes UE1 location, UE1 & UE-R1 ProSe IDs. It may
include any radio measurement information.
6\. ProSe Server receives UE-R1 location information.
7\. ProSe server sends ProSe_Relay_Setup_Reply which also includes
configuration information. ProSe server selects a relay-UE based on e.g.
proximity, operator policies, activation type (per clause 6.3.1 TR 23.703),
etc.
8\. UE-R1 sends unicast \'Relay Response\' to UE1 reply. It includes
configuration information for UE-to-Network Relay.
Editor\'s note: Accuracy of location information in Figure 6.3.13.3-1 for
selecting the Relay-UE is FFS
#### 6.3.13.4 Impact on existing entities and interfaces
Editor\'s note: Impacts on existing nodes or functionalities is FFS.
#### 6.3.13.5 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
## 6.4 ProSe Identities
### 6.4.1 Solution I1: Solution for ProSe Identifiers for Public Safety
Mission Critical Applications using direct discovery
#### 6.4.1.1 Length of ProSe Identifiers used for ProSe direct Discovery
ProSe identifiers used over-the-air during ProSe direct Discovery can be seen
as bit strings of limited maximum length. The strings may be generated from
other forms of identifiers (e.g. expressions), but ultimately their length
cannot exceed some maximum value. That value depends on the size and
availability of radio resources, on the characteristics of the radio
transmission, on how many UEs may be transmitting of the same time and on
other variables. In general, the longer (the transmitted messages containing)
the identifiers and the more often they are transmitted, the higher the
battery usage at the UEs. However, this can be of significant less concern in
this case, because working in Mission Critical mode is in general limited in
time, while many Public Safety UEs have fewer battery constraints than
commercial UEs, as they can be mounted on vehicles, re-charged at every work
shift, etc. It is reasonable to expect that the maximum length will be a known
constant value that will apply to all ProSe direct Discoveries, at least
within a given system.
NOTE: The RAN working groups will likely have the technical lead in the
detailed work to support this solution in an optimal way.
It is also reasonable to expect that in some cases, the length of those ProSe
identifiers will be insufficient to uniquely determine the identity during
ProSe direct discovery. This is equivalent to potentially having the same
value for an identifier used by different UEs, users or applications during
ProSe direct Discovery. The implication of limited length ProSe identifiers is
that ProSe direct Discovery may be incomplete from a user point of view, even
if it yields a complete match of a ProSe identifier against the discovery
criteria.
It is possible that ProSe direct Discovery be followed by an automatic phase
during which the UEs actually engage in (hidden) ProSe Communication in order
to complete (at the application layer) the discovery procedure against the
overall discovery criteria (including full security validation).
ProSe direct Discovery and Communication with ProSe identifiers of
insufficient length for discovery:
* * *
User perception: Communication  
System working: ProSe direct Discovery ProSe direct communication  
Internal sub-phases: ProSe direct Discovery Automatic UE to UE communication
setup UE to UE direct communication to complete identification and mutual
authentication User plane direct UE to UE communication
* * *
#### 6.4.1.2 Security considerations for ProSe Identifiers used for ProSe
direct Discovery
While in-depth security work is out-of-scope for this document, the general
requirements for ProSe direct Discovery to be as secure as other LTE
operations, may have direct implications on the ProSe identifiers used in
direct discovery.
NOTE: SA WG3 will have the technical lead in the detailed security-related
work needed to support this solution in an optimal way.
A first specific potential requirement is that the system should be able to at
least detect and discard forged ProSe identifiers that may be transmitted by
rogue UEs. The implication here is that some type of integrity protection or
digital signature field should be included in messages that use ProSe
identifiers.
A second specific potential requirement is confidentiality. Although it could
be waived in certain cases, in the general case it is not waived. Normally
this requirement is met by using some form of encryption of the identities. An
alternative mechanism (providing TMSIs) may not be practical in the absence of
network assistance, to assign new TMSIs once the already assigned are used up.
The implication here is that in general a ProSe identifier contains
parts/fields that are encryptable.
A third specific potential requirement is also linked to confidentiality and
states that the same bit configuration representing same identity is not used
over-the-air, to prevent replays. Usually good solutions to the previously two
identified security considerations are sufficient to cover this case, but a
general requirement of not reusing same identifying bit pattern over time
(i.e. changing the values often), can be inferred.
In alignment with the previous clause, support of security functionality for
the messages carrying ProSe identifiers used for direct discovery may require
space (allocated bits) in the over-the-air transmissions.
#### 6.4.1.3 Considerations on the identification of applications
The proposed paradigm is a UE having a set of \"applications\" that are
created by third parties and \"vetted\" by the operator for security issues
and compliance to the APIs and are downloadable from the Internet into the
user\'s UE. This requires significant flexibility and variability in the
designation of the applications and in their use. One option is to specify
these applications as human-readable strings or as expression codes. However,
the few very common and frequently used applications can be assigned a unique
index, and those applications can then be identified via their associated
index, which is a small number requiring significantly fewer bits than other
encoding alternatives. This mechanism can be used often to limit the length of
the identifiers.
For example application \"facebook\" gets the index 1, application \"twitter\"
gets the index 2, etc. It is assumed that given the small number of
frequently-used application that are assigned an index, the values can be
coordinated between operators. In this example, the value 1 can be encoded
with fewer bits than the number of bits taken by an expression code of
\"facebook\". A possible application is a \"Directory of supported
applications\" application, broadcasting a \"bitmap\" of supported
applications for ProSe discovery, and thus avoiding several \"one per
application\" separate broadcasts.
Another possible and very useful for Public Safety UEs only can be a uniquely
identifiable \"Default PS application\". It guarantees, subject to
permissions, that any Public Safety worker can discover another Public Safety
worker in proximity, enables mutual aid and emergency support, and may provide
additional information such as agency type, jurisdiction, role and incident
identification. The exact details are out of scope for this document.
#### 6.4.1.4 A potential format for direct discovery messages containing ProSe
identifiers
This solution recognizes that ProSe direct Discovery identifiers may have
length limitations while the identifiers used in network-assisted ProSe
discovery may not necessarily be subject to these kind of restrictions. The
conclusion is that a variable length (and thus multiple formats) should be
allowed. This is also consistent with the potential encryption of parts of the
identifier, as discussed in 6.4.1.2. In addition, for Public Safety only, it
may become highly desirable that special formats be defined for the \"Default
PS Application\" and the length of the identifiers be small enough to allow
rapid single phase processing for mission critical situations.
A generic format for ProSe identifiers is shown below, yet it is TBD if other
security-related fields are present:
* * *
Format Control Command ProSe Identifier Message Validation
* * *
**Format Control:** controls the length and layout of the message
**Command:** e.g. message is an Announcement or Query
**Message Validation:** one or more security related fields, (e.g. integrity
protection, digital signature); details to be specified by SA WG3.
**ProSe Identifier:** details to be specified by RAN working group(s).
#### 6.4.1.4 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.4.1.5 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.4.2 Solution I2: ProSe Identities
#### 6.4.2.1 Functional description
##### 6.4.2.1.1 General
The solution described in this clause addresses the Identities key issue
described in clause 5.10.
A ProSe enabled UE needs to be able to discover and be discoverable. The
discoverable UE needs to announce its identity and the discovering UE needs to
be able to extract the identity of the announcing UE. The mechanism may be a
push or pull mechanism such that the discovery process is initiated by the
announcer or by the monitoring UE. The mechanism may depend on the settings
for the procedure. The procedure of discovery may, according to the
requirements, be a restricted discovery procedure or an open procedure, i.e.
ProSe discovery that only takes place with explicit permission from the UE
being discovered or ProSe discovery without explicit permission from the UE
being discovered.
The restricted discovery procedure described as follows.
##### 6.4.2.1.2 Identity architecture
Figure 6.4.2.1.2-1: ProSe Identities structure
It is assumed that there is a record of the subscription for ProSe saved in
the operator network, indicating ProSe specific subscription data for ProSe
functionality. The record may consist of permanent data and temporary data.
Permanent subscription data may be such data to be stored on a long term basis
and connected to the subscription of the user/UE while the temporary data may
be of changeable nature, such that the life time of these records may be
during an session or during an attach of the UE.
Permanent data in the subscription may be e.g. the type of discovery and
communication that is allowed or range class allowed for the UE. The ProSe
subscription e.g. stored in the HSS, may include information about
applications that are allowed to be run by the subscriber, i.e. on the
terminal associated with the ProSe subscription. When the terminal is starting
up and authorizing for ProSe, there may also be an authorization for using an
application which is indicated by the ProSe record in e.g. the HSS.
Temporary data may be of the type that is either data which needs to be
updated or which is preferred to be updated, such as temporary identifications
used in the discovery and communication procedures, temporarily used options
in the UE or records of settings due to specific usage of certain options or
applications.
Storage options for the ProSe related data records will not be described
further.
#### 6.4.2.2 Procedures
##### 6.4.2.2.1 Application authorization
An application may be under the control of the operator or it may be a third
party produced application. An applications use of ProSe needs to be under the
control of the operator. The application should be recognized and authorized
to use ProSe by the operator.
The UE includes by pre-loading or by downloading and installation a number of
ProSe enabled applications. These may be invoked by the user at any time. The
application may be pre-authorized in the terminal/SIM or may be authorized on-
line by the ProSe Function in the operator network. Both home and visited
operator may need to authorize applications for using ProSe services in the
network.
\'The ProSe user may after UE attaching to the network and finding the ProSe
Function in the network, try to get authorization for the Application to use
ProSe by invoking the ProSe registration procedure.
Editor\'s note: It is FFS the mechanism for how the UE will find the ProSe
Function after attaching.
When the user invokes a ProSe application, there is a request from the
application towards the ProSe part in the UE for authorization. The ProSe part
in the terminal needs to assess if the application is authorized or not to use
the ProSe capability features. In case not already authorized, there is a
request towards the ProSe Function in the NW for authorization of the
application to use ProSe. The application shall be identified, authenticated
and authorized according to the stage 1 requirement PR.49. UE will send a Auth
Req towards the ProSe Function, including a APP ID and e.g. a ProSe
certificate. The application is identified by the NW and authorized to us
ProSe.
NOTE: If a certificate or other methods should be used needs to be reviewed by
SA WG3.
##### 6.4.2.2.2 Registration in order to be discoverable
The application in a UE may request the ProSe Function in the UE to be
discoverable by other UEs. The operator may have a policy for the options for
discovery. The NW need to be accessed in order for the discovery to be
authorized by the NW. The requested discovery options chosen by the user is
sent from the Terminal App to the ProSe Function in the UE and forwarded to
the ProSe Function in the NW. If the UE is roaming the request will be
forwarded from the Visited ProSe Function to the Users home NW ProSe function.
The visited ProSe Function may put restrictions on the visited ProSe UE e.g.
deny to be discoverable. The user is identified by a ProSe ID, which is a
permanent ID for the ProSe users specific options stored in the home NW,
possibly in the HSS or in a database related to the ProSe function.
The ProSe ID is a unique identity for the ProSe user, possibly created from
the IMSI. It is composed of parts indicating the network where the UE has its
subscription. This is used in order for the ProSe Function to find the related
ProSe Function in the Home NW for roaming users. During this authorization
procedure, the ProSe Function in the NW assigns the ProSe user a temporary
expression code that it will broadcast in order to be discoverable by other
ProSe users.
When the discovery is requested by the application X, the App ID and the
Application User ID is stored in the NW as temporary information in the ProSe
records for the ProSe user.
If another App B will register in the terminal, it shall be registered in the
NW, but there will not be a new expression code assigned. When all App user
IDs have deregistered a new expression code may be assigned.
The registration procedure may be divided in two steps, ProSe registration and
Application registration.
Figure 6.4.2.1.2-2: ProSe Registration request procedure
  1. The ProSe Function in the UE, after doing EPS Attach, will send a request for Registration towards the ProSe Function in the NW. It is identifying itself by the ProSe ID.
  2. The ProSe Function in the NW authorizes the UE for being discoverable and provides an expression code to the UE.
  3. The expression code for the UE is sent back to the UE.
Figure 6.4.2.1.2-3: Application registration request procedure
  1. The Application \"a\" in the UE requests from the ProSe part in the UE to be discoverable. The application uses an Application User ID in the request to identify the application user.
  2. The ProSe Function in the UE will send a request for Application Registration towards the ProSe Function in the NW. It is identifying itself by the ProSe ID and provides the App User ID to the ProSe function.
  3. The ProSe Function in the NW stores the App User ID in the temporary record for the ProSe ID.
  4. The request is acknowledged towards the UE.
5\. The UE indicates to the Application\" a\" that it is registered in the NW
for being discoverable.
##### 6.4.2.2.3 Authorization for discovery
The application in the terminal may request discovery of a ProSe user or
several users. According to the SA1 requirements the request may also be for a
user category to be discovered. Operator policy for discovery need to be
enforced and the UE shall request the discovery authorization from the ProSe
Function in the NW. A request is sent to the local ProSe function. In this
case the NW policy options need to be stated for the requester and for the
requested users:
\- for the requester, possibly a home NW for a roaming user needs to be
contacted.
\- for the requested discovered ProSe users, their home NWs need also be
contacted such that operator policy is enforced.
For the discovery of other ProSe users there is a need for their expression
codes to be known when they are the broadcast to be monitored. Their
expression codes(s) may be provided by their home operator ProSe function. The
NW needs to find the home operator of the requested discovered ProSe users.
This information can be provided to the ProSe Function by the requesting
terminal or by the App Server:
1\. In case the terminal can provide the home network information of the
requested user, it may send it to the NW. The App User Id of the requested
discovered user may include the home operator code for the discovered user. In
this case such knowledge must be possessed by the requesting application in
the terminal.
\- How can the application in the terminal know the home network of the
requested users- Possible solutions may be that the ProSe enabled application
server in the NW stores and can provide such information for its ProSe enabled
users to the discovering UE application by request. Or it may be configured
into the discovering UE application which NW the friends in the application
friend list has subscribed to.
2\. When the ProSe enabled application server in the NW stores such
information for its ProSe enabled users it can be requested over the PC2
reference point by the ProSe function. In this case the terminal only needs to
send an Application User ID towards the ProSe Function in the NW.
Editor\'s note: Other methods to find the home NW may be FFS.
The home NW ProSe Function shall be able to find the records for the ProSe
users to be discovered by the Application User ID. Thus the Application User
ID needs to be stored for the UE identified by the ProSe ID in the Home NW HSS
or ProSe function. Based on the finding of the ProSe User, the expression code
which the user is currently using may be found and sent back to the monitoring
ProSe user, such that the requested ProSe users can be discovered.
When a group of users are to be monitored, the requesting application may
simply repeat the request towards the ProSe Function in the terminal a number
of times. A service primitive in the ProSe Function API in the terminal may
otherwise take a number of users as argument, i.e. a list of ProSe users to be
monitored.
Editor\'s note: It is FFS how to define and treat a request for discovery of a
group of users, identified as a group.
The case when user y is registered in Home NW B is shown by the dashed line in
Figure 6.4.2.1.2-3 below.
Figure 6.4.2.1.2-3: Discovery authorization of other ProSe users
1\. The Application a in the UE requests from the ProSe part in the UE to
discover/monitor the \"friend y\" identified by its App user ID.
2\. The ProSe Function in the UE will send a request for Discovery towards the
ProSe Function in the NW. It is identifying itself by the ProSe ID and
provides the App User ID (or IDs) to be discovered.
3\. The ProSe Function in the NW searches for the App User ID to be discovered
in its own NW. If this App User has registered, the App User ID will be stored
in the ProSe record for that ProSe User. If not found it may request the App
Server for the NW where the APP User is subscribed/registered. (If the
Terminal could already provide this information, the request towards the App
Server is not needed). The ProSe Function may store the discoverability
preferences of a user per application, e.g. the ProSe function maintains a
list of discoverable friends of a user per application. If the discoverability
preferences are not available in the ProSe Function the ProSe Function would
need to request the application server to get discoverability preferences
based on a user discovery request.
4\. \'The ProSe ID record of the requested App User stores the expression code
for the ProSe User. It is sent back to the requesting user.
5\. The requesting UE starts monitoring for the expression code of the friend.
##### 6.4.2.2.4 Discovery event
The monitoring and the broadcasting functions as described above may result in
a match of expression codes in the monitoring ProSe function. When a match is
found, the monitoring ProSe Function translates the expression to the App user
ID which was requested by the application in the previous discovery request.
The application in the UE which issued the monitoring request is notified by
the ProSe Function about the match, while other potential apps in the terminal
are not notified.
Figure 6.4.2.1.2-4: ProSe user discovery procedure
1\. The UE A broadcasts its expression code.
2\. UE B monitors for the expression code of UE A and detects the UE A and
translates it to the App User ID of the earlier requested friend \"x\" of
Application \"a\".
3\. The App Use ID is indicated towards the App \"a\" for being in proximity.
4\. The user is indicated that the friend \"x\" is found.
#### 6.4.2.3 Summary
The following ProSe related identities are needed in the ProSe discovery
procedure use cases as below:
**APP ID:** an application Id identifying the application running in the UE,
such that the NW may identify, and authorize the usage of ProSe functionality
by the application in question. The NW ProSe Function authorizes that the
application can be used for ProSe irrespective of application user.
Editor\'s note: Where the list of authorized applications is stored is FFS.
Editor\'s note: How the APP ID is defined is FFS.
**ProSe ID:** the ProSe ID is a subscription parameter identifying the ProSe
subscriber and the records for ProSe parameters and ProSe options for the
specific ProSe user. This ProSe ID should be one-to-one identifiable to a IMSI
for a subscription for a ProSe enabled UE. As such the ProSe ID is only
allocated to ProSe enabled UEs subscribers and thus not available generally
for all subscribers. The ProSe ID is used to build and storing ProSe records
for the ProSe Enabled UEs/subscribers, which may be stored in the NW. When the
user performs the ProSe registration towards the NW ProSe function, a
certificate method is used authenticate the ProSe user by use of its ProSe ID.
Editor\'s note: It is FFS if the ProSe records for the ProSe enabled
UEs/subscribers are stored in the HSS or in a ProSe specific repository e.g.
in the ProSe function.
**Expression Code:** an identity, which the ProSe enabled UE uses for
broadcasting its identity and used in discovery. The expression is an alias
for the ProSe ID for ProSe enabled users. The expression code may be sent in
open or as an encrypted expression. Due to privacy requirements, the
expression code may be encoded using some RAND part as well as the ProSe ID
and may also be allocated on a temporary basis and renewed at certain time
intervals.
NOTE: SA WG3 will do final evaluation of the privacy requirement impact.
Editor\'s note: It is FFS if more than one Expression Code is needed per UE
e.g. to support different range classes.
**App User ID:** an ID used by an application to identify an application user
which is ProSe enabled. This ID may e.g. be used for discovery of friends in
the application. The ID shall be stored as an entry in the temporary ProSe
record for the user, such that the ProSe Function may find the ProSe ID and
the actual ProSe enabled UE based on the ProSe App user ID, provided that the
user has registered as an App user in the ProSe record database.
\- If the application in the terminal can provide information about home NW of
friends to be discovered, the ProSe App User ID may be amended with a NW part
which is used by the EPS NW. The NW part is used to identify the user as a MNO
subscriber and for a visited NW to route requests to the home NW of the user.
Editor\'s note: User category identification is FFS.
Above described procedure signalling are handled over the user plane between
the terminal and the ProSe function in the network.
#### 6.4.2.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.4.2.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 will be
evaluated.
### 6.4.3 Solution I3: Retrieval of ProSe Identity
#### 6.4.3.1 Functional description
This solution assumes that there is a unique ProSe identity which has one to
one mapping with IMSI for each user subscribing to ProSe service, and unique
application layer user identity per ProSe-enabled application, each ProSe-
enabled UE can support multiple ProSe-enabled applications operating
simultaneously.
Permanent ProSe ID is assigned/allocated by ProSe function when user
subscribes to the ProSe service. It is a permanent identity for identifying a
ProSe user, it can also be used to indicate the subscription of the user, the
entity storing the subscription, and ProSe function subscribed in home PLMN,
for example, EPSID.
Temporary ProSe ID corresponding to a permanent ProSe ID is allocated by ProSe
function for identifying a ProSe user during ProSe direct discovery procedure,
it can be an expression code, or a ProSe UE ID. Temporary ProSe ID may be re-
allocated periodically or as requested by user or ProSe function.
When a ProSe-enabled application performs registration procedure, it provides
both of application layer user ID and permanent ProSe ID in the registration
request to application server. Alternatively, it can provide both of
application layer user ID and permanent ProSe ID in the registration request
to ProSe function first, then ProSe function perform registration to
application server with application layer user ID and permanent ProSe ID. The
Application Server stores the mapping of application layer user ID and
permanent ProSe ID.
For direct discovery, if a user using ProSe enabled UE would like to announce
itself, the user has to get his temporary ProSe ID (e.g. expression code)
beside ProSe ID; On the other hand, a discovering UE gets the user\'s
temporary ProSe ID first, and monitors this temporary ProSe ID in the
discovery procedure. If a user using ProSe enabled UE would like to discover a
target user, the discovering UE has to get target user\'s temporary ProSe ID
first, and includes this temporary ProSe ID in discovery message.
After the successful discovery, the discovery results should be stored in the
UE with ProSe ID of target users for a lifetime. Then, if another ProSe-
enabled application on the UE also requests ProSe discovery, and after getting
ProSe ID of target user indicated by application layer user ID, it finds that
the ProSe ID has been stored in the UE together with the valid discovery
result, the application can re-use the stored discovery result.
#### 6.4.3.2 Signalling Flow
##### 6.4.3.2.1 Login procedure of ProSe enabled application
There are two options for ProSe-enabled application to login to ProSe
application server, i.e. login over PC1 interface and login over PC3
interface, as shown in figure 6.4.3.2.1-1.
Figure 6.4.3.2.1-1: Login procedure of ProSe enabled application
0\. Permanent ProSe ID is assigned/allocated for a user by ProSe Server when
the user subscribes to ProSe service, it has one to one mapping to IMSI. This
procedure is out of 3GPP scope. ProSe ID is a permanent identity for
identifying a ProSe user, it can also be used to indicate the subscription of
the user, the entity storing the subscription, and ProSe function subscribed
in home PLMN, for example, MSISDN or a new defined identity like
user\@ProSeserver.operator.3gpp.
**Option A. login over PC1 interface:**
1-2. A ProSe enabled application running on a ProSe enabled UE gets permanent
ProSe ID of the user who subscribed ProSe service by using this UE.
3\. The application sends application layer login request carrying permanent
ProSe ID to application server over PC1 interface.
4\. The application server stores the mapping of application layer user ID and
permanent ProSe ID, in addition, the discovery setting related information if
possible, e.g. whether the user represented by the ProSe ID is discoverable
for this application.
5\. The application sends back a response over PC1 interface.
**Option B. login over PC3 interface:**
1-2. A ProSe enabled application running on a ProSe enabled UE triggers the UE
to send login request with application ID, application layer user ID and
permanent ProSe ID to ProSe function over PC3 interface. The ProSe function is
identified by permanent ProSe ID, such as constructing a FQDN containing ProSe
ID to use DNS service
3\. The ProSe function authenticates that this UE is allowed to use ProSe
service, then sends registration request with application layer user ID and
permanent ProSe ID to Application server identified by application ID.
4\. The application server stores the mapping of application layer user ID and
permanent ProSe ID, in addition, the discovery setting related information if
possible, e.g. whether the user represented by the ProSe ID is discoverable
for this application.
5-7. The Application server sends back a response to the ProSe enabled
application.
Editor\'s note: In the option B, it is FFS that the login request from UE are
sent on 3GPP control plane or 3GPP user plane.
#### 6.4.3.2.2 Retrieval of ProSe ID for discoverable procedure
Figure 6.4.3.2.2-1: Retrieval of temporary ProSe ID for discoverable procedure
1\. After a user has logged in a ProSe-enabled application, the user is
allowed to be discoverable through direct ProSe discovery procedure as long as
the user has such requirement. In this case, the user can send discoverable
request to ProSe enabled UE.
2\. In order to perform direct discovery without disclosing user's permanent
ProSe ID on the air, the UE needs get user's temporary ProSe ID from ProSe
function if there is no valid temporary ProSe ID, then the UE sends Get
temporary ProSe ID request including application ID and user's ProSe ID to
ProSe function. The ProSe function is the subscribed ProSe function identified
by user's ProSe ID.
3\. The ProSe function retrieves user's subscription by using user's ProSe ID,
and then authenticates that the UE and the application are allowed to use
ProSe service. Further, the ProSe function allocates a temporary ProSe ID
corresponding to the provided ProSe ID.
4\. The ProSe function sends temporary ProSe ID back to the UE and authorizes
the UE to perform discovery procedure.
5-6. The ProSe-enable UE (3GPP layer) sends response to upper layer
(application layer) and performs direct discovery procedure by using received
temporary ProSe ID.
##### 6.4.3.2.3 Retrieval of ProSe ID for discovery procedure
Figure 6.4.3.2.3-2: Retrieval of ProSe ID for discovery procedure
1-2. A ProSe-enabled application is requested by user to discover some target
users, this application layer requests will trigger the ProSe-enabled UE(3GPP
layer) to retrieve the ProSe IDs of users by using indicated application layer
user identities. The UE (3GPP layer) sends Get ProSe ID Request including
application layer user ID list of target users, user's ProSe ID and
application ID to the ProSe function, the ProSe function is the subscribed
ProSe function identified by user's ProSe ID.
3\. The ProSe function retrieves user's subscription by using user's ProSe ID,
and then authenticates that the UE and the application are allowed to use
ProSe service. After that, the ProSe function sends the Get ProSe ID Request
to Application server identified by application ID to ask for searching the
ProSe IDs of target users.
4\. The Application server finds the ProSe ID and the discovery setting of
each target user by indexing its application layer user ID, then sends Get
ProSe ID Response including the list of application layer user ID and ProSe ID
pair for each discoverable user to ProSe server. For supporting restrictive
discovery, the application server needs to check the discovery setting of
target user to determine how to response, e.g. if the discovery setting of
target user is not discoverable, the application server may not provide ProSe
ID or return a negative response.
5-6. When the ProSe function receives target user's ProSe IDs, it finds the
temporary ProSe ID corresponding to these ProSe IDs if necessary, then sends
the list of \ to the UE
and authorizes the UE to perform discovery procedure.
7\. The UE stores the mapping of application layer user ID and temporary ProSe
ID which are included in the response message, which allows the UE to re-use
the stored ProSe IDs to perform discovery procedure.
8\. The ProSe-enabled UE performs ProSe direct discovery based on received
temporary ProSe ID of the target user e.g. direct discovery procedure defined
in solution D8 can be used.
9-10. The ProSe-enabled UE (3GPP layer) forwards the discovery result to upper
layer (application layer), and stores the discovery result for preconfigured
limited lifetime for future use, e.g. If other ProSe-enabled applications
request the UE to perform discovery/communication, after performing step 2\~6
to retrieve temporary ProSe ID of a target user identified by different
application layer user ID, the UE finds target user\'s temporary ProSe ID has
been stored together with valid discovery result, then the UE doesn\'t need to
perform duplicated discovery procedure as shown in step 8 for this target
user.
#### 6.4.3.3 Impact on existing entities and interfaces
UE: needs to support ProSe direct discovery at 3GPP layer, need to be able to
perform application registration with ProSe ID at application layer.
eNB: needs to be able to allocate and announce radio resources that can be
used for direct discovery.
HSS: may need to support interface to ProSe function if ProSe related
subscription are stored in HSS.
#### 6.4.3.4 Solution evaluation
This solution provides a mechanism of allocation and utilization of ProSe
identity for network authorized ProSe direct discovery procedure. It addresses
Key Issue #6: Authorization for ProSe capability feature and Key Issue #10
ProSe identities outlined in clause 5.
The solution presents the following advantages:
  * Since the discovery result can be used by multiple applications on the UE, signalling cost over the air will be lower than per application discovery.
  * UE power consumption will be decreased due to not broadcasting discovery request for each application.
  * Restricted discovery is supported by configuring white-list or blacklist on the server, which reduces direct signalling between two UEs.
### 6.4.4 Solution I4: ProSe Identities for ProSe service
#### 6.4.4.1 Identity for ProSe discovery
##### 6.4.4.1.1 ProSe discovery type and the requirement for ProSe Identities
The types of ProSe discovery and the requirement to ProSe Identities are
listed in table 6.4.4.1.1-1.
Table 6.4.4.1.1-1: The ProSe discovery Type and the required ProSe Identity
+---+--------------------+--------------------+--------------------+ | | ProSe discovery | The description | The requirement | | | type | for | for | | | | | | | | | ProSe discovery | ProSe identities | +---+--------------------+--------------------+--------------------+ | 1 | EPC level ProSe | The application | UE need indicate | | | discovery with | user on the | which application | | | target application | discovering UE | tries to activate | | | user. | requests EPC to | the ProSe | | | | get the proximity | discovery service. | | | | of its friends, | | | | | and EPC determines | Application User | | | | the proximity of | identity is needed | | | | the target UE and | by the application | | | | sends the result | on the UE, the | | | | to the discovering | related | | | | UE. | application server | | | | | to indentify the | | | | | application user. | | | | | | | | | | ProSe UE identity | | | | | is needed by the | | | | | network and the | | | | | application server | | | | | to identify the | | | | | discovering UE and | | | | | the discovered UE. | +---+--------------------+--------------------+--------------------+ | 2 | ProSe direct | The discoverable | a) UE need | | | discovery with | UE announces one | indicate which | | | non- target | code on the radio | application tries | | | application user | interface. | to activate the | | | | | ProSe discovery | | | | The discovering UE | service. | | | | performs ProSe | | | | | monitoring and | b) The Discovery | | | | identifies the | code should be | | | | interested | able to identify | | | | discoverable UEs | the service which | | | | based on the | UE can offer and | | | | interest of the | also the | | | | applications on | associated UE | | | | the discovering | identity. | | | | UE. | | +---+--------------------+--------------------+--------------------+ | 3 | ProSe direct | The application | UE need indicate | | | discovery with | user of the | which application | | | target application | discovering UE | tries to activate | | | user | requests the UE to | the ProSe | | | | get the proximity | discovery service. | | | | of the target | | | | | application user. | The Discovery code | | | | | should be able to | | | | | identify the | | | | | target users or | | | | | group users. Also | | | | | considering the | | | | | privacy | | | | | requirement, this | | | | | identity should be | | | | | able to be changed | | | | | dynamically. | +---+--------------------+--------------------+--------------------+
##### 6.4.4.1.2 Application Identity
ProSe Application ID is used to uniquely identify one ProSe application. The
network stores the UE\'s authorized ProSe Application ID and identifies the
related ProSe Application server via Application ID.
It is proposed that ProSe Application ID should be unique across the PLMNs in
order that the ProSe discovery could be supported across the PLMNs.
The Application Identity is transferred between:
\- UE and the ProSe Function via PC3 reference point.
\- ProSe Function and Application server via PC2 reference point.
\- ProSe Functions in different PLMNs via PC6 reference point.
##### 6.4.4.1.3 Application User Identity
Application User Identity is used by the application on the UE and the
associated Application server to uniquely identify one Application user in the
application domain.
The allocation and management mechanism for Application User Identity is out
scope of 3GPP.
NOTE 1: It is possible that one user can utilizes the same Application User ID
on several multiple ProSe applications on the UE.
NOTE 2: Some solution may not need the Application User Identity. The
Application User Identity is transferred between:
\- UE and the ProSe Function via PC3 reference point.
\- ProSe Function and APP server via PC2 reference point.
\- ProSe Functions in different PLMNs via PC6 reference point.
##### 6.4.4.1.4 ProSe UE Identity
ProSe UE Identity is used to identify one ProSe UE. For the purpose of
security and privacy, ProSe UE ID is a temporary identity. ProSe UE ID is
allocated by the ProSe Function residing in the serving PLMN during ProSe UE
registration procedure. For Public Safety UE, the ProSe UE Identity pre-
configured by the home operator could be used when it is out of the network
coverage.
ProSe UE ID could also be used to identify the serving PLMN and the serving
ProSe Function for the ProSe UE.
The proposed format and size of the ProSe UE Identity is as below:
\ = \\\\ ;
##### 6.4.4.1.5 ProSe discovery code
ProSe discovery code is used by the announcing UE to indicate the
service/application, application user identity in ProSe direct discovery
process. ProSe discovery code is a temporary identity and can be updated by
the network dynamically.
For ProSe discovery and communication under the network coverage, the
authorized Discovery code is allocated by the network.
For non-Public safety usage the UE only announces the network allocated
Discovery code.
For Public Safety usage when the UE is in/out of the network coverage, the
Discovery code could be the pre-configured code obtained from the home
operator.
There are the following types of Discovery codes:
\- Service/Application type Discovery code, the Discovery code can indicate
the service or application offered by the UE.
\- Dedicated user type Discovery code , the Discovery code is only used to
identify the dedicated user.
#### 6.4.4.2 Identity for ProSe communication
##### 6.4.2.2.1 ProSe UE identity
The ProSe UE identity for ProSe Communication is the same as ProSe UE identity
for ProSe discovery.
##### 6.4.4.2.2 ProSe Group identity
ProSe Group Identity is used to identify one ProSe group. ProSe Group identity
is transport identity.
##### 6.4.4.2.3 ProSe Source and Destination Identity
For ProSe one-to-one Communication, the ProSe UE identity is used as the
transport source/target identity.
For ProSe one-to-many communication, the ProSe group identity is used as the
transport destination identity, and the ProSe UE identity is used as the
transport source identity.
##### 6.4.4.2.4 ProSe direct Connection Identity
More than one ProSe direct Connections can be established between two UEs.
ProSe direct Connection Identity is used to identify each ProSe direct
connection between the two UEs.
If the ProSe direct communication occurs under the network coverage, the ProSe
Direct Connection Identity is allocated by the network (i.e. MME). If the
direct communication occurs out of network coverage, the ProSe Direct
Connection Identity is generated by the ProSe UE.
#### 6.4.4.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.4.4.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.4.5 Solution I5: Solution with ProSe UE Identifiers targeted towards
Public Safety applications
#### 6.4.5.1 Definitions
**Type 1 ProSe sub-identifier** : A unique string of bits permanently or
temporarily associated to a specific UE. It is assigned/re-assigned by the
operator and handled by the 3GPP layer. It cannot be modified by the user.
**Type 2 ProSe sub-identifier** : A string of bits that identifies an
application context at the UE. Typically there can be many Type 2 ProSe sub-
identifiers for a UE, but the user chooses to use one at a time. The content
of this sub-identifier is set and controlled by the user, at the application
layer. If encrypted, it will be at the application layer and it will be used
over-the-air \"as is\", without any processing by the 3GPP layer.
**ProSe identifier**. Consists of a Type1 ProSe sub-identifier and/or a Type 2
ProSe sub-identifier.
#### 6.4.5.2 Assumptions about ProSe UE Identifiers targeted towards Public
Safety applications
The following assumptions apply for the ProSe UE Identifiers:
\- Type 1 sub-identifier used in ProSe Identifiers is unique to the UE at any
moment in time for a configurable duration, can be stored at the UE, but it
cannot be changed by the user, and is subject to operator assignment and re-
assignment.
\- The contents (including potential encryption / decryption) of Type 2 sub-
identifiers is determined at the application layer without the involvement of
the 3GPP Layer. However, any security key that would support the above
mentioned encryptions/decryptions is made known to the operator.
\- From the application Layer, the user can specify whether a discovery
request is an announcement or a query and can indicate the inclusion of Type 1
and/or Type 2 sub-identifiers in the ProSe identifier used for that discovery,
with the Type 2 sub-identifier determined based on application context
information provided by the user.
\- At the receiver side, the kind of request for a discovery, the Type 1 sub-
identifier (if present) and the application context derived from the Type 2
sub-identifier (if present) is to be made available at the application Layer,
except in case when exclusionary filtering is performed based on the Type 1
sub-identifier at the 3GPP Layer and there was no match, in which case the
application context can be discarded.
\- If encoding of the application context information into a Type 2 sub-
identifier is used, it will be two-way reversible such that decoding and
restoration of the application context at the receiver can be accomplished
directly, without loss of information.
NOTE 1: The encoding of the application context may have security implications
and may involve SA WG3. In particular, as an optimization, the discovery
message may contain a hashed value computed based on the unencrypted
identifier, to assist the potential discoverers with selecting the proper key
for decoding., thus avoiding potential multiple attempts to decipher, using
different keys. SA WG3 may have to advise if this technique does not introduce
a security weakness.
\- Matching of ProSe ids (e.g. for determining interest) based on application
context information derived from decoding of Type 2 sub-identifiers does not
involve the 3GPP Layer, but is done at the application layer and is
application specific.
\- Relays and their type shall be easily identifiable based on their ProSe Id,
and, if Type 1 Sub- Identifiers are used, they should be different and
uncorrelated for each type of relay and for the case when the UE does not act
as a relay.
\- If additional information about a specific relay is made available via a
ProSe identifier (e.g. lists of supported PDNs, GCSE groups, etc.), it will be
done via a Type 2 sub-identifier.
\- ProSe Identifiers that are not used in direct ProSe discovery have the same
format as those that are, with the possible exception of security-related
fields, if any.
#### 6.4.5.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.4.5.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.4.6 Solution I6: ProSe Application Identities allocated using
application layer mechanisms
#### 6.4.6.1 Functional description
In the context of this solution the ProSe Application Identifiers used for
direct discovery are named \"expression codes\" and this term is used to refer
to the discovery information broadcast by a ProSe-enabled UE to announce
specific ProSe Application identities (such as identities associated with
applications and/or services). Expression codes can be used by ProSe-enabled
UEs to discover available services, identities, or applications associated
with other ProSe-enabled UEs in proximity. One UE may broadcast more than one
expression code if needed.
There are two types of expression codes: (_i_) Private Expression codes and
(_ii_) Public Expression codes.
(i) The private expression codes are used to support restricted discovery (see
TS 22.278 [3]). As explained below, they are requested by ProSe-enabled
applications when these applications want to use ProSe discovery services.
(ii) The public expression codes are used to support open discovery (see TS
22.278 [3]). They can also be requested by applications but due to their
\"public nature\" (i.e. all UEs in proximity should be able to monitor
irrespective of their applications), their allocation is done per UE rather
than per application.
The mechanisms for allocation of expression codes in the context of this
solution are using user plane mechanisms (over IP) in the application layer.
In informative Annex F some indicative procedures for allocation of ProSe
Application Identities in the context of this solution are shown for
information.
#### 6.4.6.3 Impact on existing entities and interfaces
No impacts in existing entities are foreseen.
#### 6.4.6.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
The mechanisms for allocation of ProSe Application Identities in the context
of this solution are out of scope of 3GPP in Rel-12.
### 6.4.7 Solution I7: Random and Temporary ProSe Identity
#### 6.4.7.1 General
We propose random and temporary ProSe Identity assignment in this solution. We
are presenting how this random and temporary ProSe Identity assignment is
performed under in-coverage scenario and out-of-coverage scenario in the
following clauses.
#### 6.4.7.2 Flows for ProSe Temporary Identity Association and Inquiry
A ProSe enabled UE gets a randomly selected temporary ProSe Identity along
with associated expiration time for a permanent identity by contacting an
authorized network node. The associated ProSe Identity is valid until the time
indicated by the expiration time. The expiration time in this description
denotes an absolute time. In case the UE is within E-UTRAN coverage, the
authorized network node is ProSe Function. Figure 6.4.7.2-1 shows an example
flows of how a ProSe Identity is assigned as a ProSe Application Identity and
how the ProSe Identity is used.
Figure 6.4.7.2-1: Flows for temporary ProSe Identity association as a ProSe
Application Identity
1\. When a UE, UE1, is activated for ProSe services, the UE1 registers with
the authorized network node (if UE is in E-UTRAN coverage, the authorized
network node is ProSe Function) using the permanent identity in the
application layer, which is bob@ex.com in this example.
2\. On receiving the registration request message from the UE1, the authorized
network entity optionally performs authorization procedure with the
application server. For this procedure, the UE1 may provide the application
layer credential information as well, but it is beyond the scope of this
solution.
3\. When the authorized network node determines to associate a random
temporary ProSe Identity to the permanent identifier in the application layer,
the authorized network node randomly selects a ProSe Identity, T-ID1 in the
example, from the available ProSe Identity pool and assigns an expiration
time, ExpT1 in the example, to the selected ProSe Identity. The authorized
network node saves the association of the permanent identity in the
application layer, ProSe Identity, and expiration time to the database. The
authorized network node sends an Ack message including associated ProSe
Identity, T-ID1, and expiration time, ExpT1. On receiving the Ack message, the
UE1 locally stores T-ID1 and ExpT1.
4\. A UE, UE2, inquires the valid ProSe Identity of his/her friend in the
application layer using the friend\'s permanent identity in the application
layer, which is bob@ex.com in this example. Though the message in this example
inquires only one friend\'s ProSe Identity, it could be a list of friends and
the message may be piggybacked with another message.
Editor\'s note: It is FFS how UE2 determines proper authorized network node.
5\. On receiving an inquiry request, the authorized network node may
optionally check with the application server if the UE2 is allowed to inquire
the ProSe Identity associated with provided permanent identity, bob\@ex.com.
If it is allowed, the authorized network node sends an Ack message including
ProSe Identity, T-ID1, and expiration time, ExpT1, associated with the given
permanent identity, bob\@ex.com, based on the stored database record. Note
that the expiration time provided in this message indicates exact same time
provided during the ProSe Identity association to UE1. On receiving the Ack
message, UE2 locally stores the association of bob@ex.com, T-ID1, and ExpT1.
6\. A UE with valid ProSe Identity is required to send a renew request message
with the permanent identity in the application layer to the authorized network
node as long as the UE is active in ProSe services before the expiration time,
ExpT1, assigned to the currently valid ProSe Identity, T-ID1, is reached.
7\. The authorized network node associates another ProSe Identity, T-ID2, and
expiration time, ExpT2, to the provided permanent identity in the application
layer, bob\@ex.com. Note that the previous associated T-ID1 and ExpT1 are not
removed from the association record database until the assigned expiration
time, ExpT1, is reached.
8\. The UE1 uses previous associated ProSe Identity, T-ID1, until the assigned
expiration time, ExpT1, is reached even after a new ProSe Identity, T-ID2, was
associated with the permanent identity, bob@ex.com. The valid period of new
T-ID2 in this example would be (ExpT1, ExpT2]. UE1 broadcast T-ID1 for
discovery purpose until ExpT1 is reached.
9\. On receiving the broadcast message from UE1, UE2 maps the received ProSe
Identity, T-ID1, with the list of stored ProSe Identities of friends. If there
is a match, UE2 may trigger communications with UE1 as they have friend
relationship. When ExpT1 is reached, the UE2 is required to inquire the
associated ProSe Identity of bob@ex.com again to the authorized network node.
10\. When Expiration time ExpT1 is reached, UE2 sends another Inquiry message
with permanent identity in the application layer to the authorized network
node in order to refresh the record.
11\. On receiving an inquiry request, the authorized network node sends an Ack
message including new ProSe Identity, T-ID2, and expiration time, ExpT2,
associated with the given permanent identity, bob\@ex.com, based on the stored
database record. If the authorized network node receives an Inquiry message
before ExpT1 but after assigning T-ID2 to the given permanent identity in the
application layer, the authorized network node provides both {T-ID1, ExpT1}
and {T-ID2, ExpT2}.
Figure 6.4.7.2-1 shows how random temporary ProSe Identity is associated as a
ProSe Application Identity. With this approach, a UE may have multiple ProSe
Identities if multiple applications on the UE utilize the ProSe services.
Figure 6.4.7.2-2 shows how ProSe Identity is associated as a ProSe UE
Identity.
Figure 6.4.7.2-2: Flows for T-ID association as a ProSe UE Identity
1\. Instead of permanent identity in the application layer, the UE1 provides a
permanent UE identity when the UE registers with the authorized network node.
It could be 3GPP specific UE identifier such as IMSI or a new permanent
identifier for ProSe services assigned to the UE.
2\. On receiving the registration request message from the UE1, the authorized
network node associates a random and temporary ProSe Identity, and expiration
time with the provided UE permanent Identifier. The authorized network node
sends an Ack message including the associated ProSe Identity, T-ID1, and
expiration time, ExpT1.
3\. When an associated ProSe Identity and expiration time are provided from
the authorized network node, the UE associates the given ProSe Identity,
expiration time to all the permanent identity in the application layer, and
the UE updates the association information towards all the corresponding
application servers. More than one application server may get this information
update. In some cases, the application server is combined with the authorized
network node. In this case, the UE does not need to update information to the
application server.
4-5. As friend relationship is established in the application layer, a friend
UE inquires the valid ProSe Identity and expiration time to the application
server.
6-7. UE1 sends a renew request message with a permanent UE identity to the
authorized network node before the expiration time is reached. The authorized
network node associates a new ProSe Identity and expiration time to the
provided permanent UE identity.
8\. UE provides new association to the application server(s).
#### 6.4.7.3 ProSe Identity under Out-of-Coverage scenarios
In the previous sub-clause, it was assumed that UE is under E-UTRAN coverage.
Thus, the authorized network node is the ProSe Function in EPC. If UE is out
of E-UTRAN coverage, the UE does not have connectivity to the ProSe Function.
If the expiration time assigned to the associated ProSe Identity is reached
while the UE is out of E-UTRAN coverage, the UE should be able to get a new
ProSe Identity and expiration time. In this solution, we assume that Public
Safety UEs have hierarchical structure in their organization. For example,
each fire fighter belongs to a fire station, and a number of fire stations
belong to a regional headquarter of the fire department as depicted in Figure
6.4.7.3-1.
Figure 6.4.7.3-1: Hierarchy of Fire Department
In the example presented in Figure 6.4.7.3-1, the UE for the head of the
regional headquarter is an authorized network node to associate ProSe Identity
to any member who belongs to that regional headquarter including the heads of
the fire stations and the fire fighters. Likewise, the UE for the head of each
fire station is an authorized network node to associate ProSe Identity to any
fire fighter within the fire station. In order to avoid potential collision
between ProSe Identities associated by different authorized network nodes,
each authorized network node maintains an exclusive ProSe Identity pool. When
a UE needs to renew the ProSe Identity, the UE contacts available highest
class authorized network node. If a UE is in E-UTRAN coverage, the UE contacts
the ProSe Function as the ProSe Function is the highest class authorized
network node among all. If a UE is out of E-UTRAN coverage, the UE will choose
the highest class authorized network node among available. An authorized UE
may associate a ProSe Identity for itself when there is no higher class
authorized issuer available.
#### 6.4.7.4 Impact on existing entities and interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.4.7.5 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
Some regulatory requirements may require transmissions of permanent ProSe
Identity.
### 6.4.8 Solution I8: Application-defined ProSe Application ID and system
provided ProSe UE ID
#### 6.4.8.1 Functional description
The basic principles behind these solutions IDs handling are:
\- The network allocates the ProSe UE ID for use in ProSe signalling, or the
ProSe UE ID is locally configured in the device for use out of network
coverage or in network independent procedures.
\- UEs authorized to use ProSe discovery are assigned a ProSe UE Identifier by
the ProSe function (possibly via the MME).
\- Applications define ProSe Application IDs for use in ProSe signalling.
\- A device which has a ProSe UE ID allocated by the network is allowed to
request the network to engage in network authorized communications.
\- A device which does not have a ProSe UE ID allocated by the network (out of
coverage device) can only engage in network independent communications.
However, if the peer is under network coverage and the peer has a network
allocated ProSe UE ID, the peer may request authorization from the network to
allow it to communicate with the device out of network coverage. A UE under
network coverage may still use network independent procedures if it uses the
ProSe UE ID not allocated by the network.
\- A device which engages in ProSe is member of one or more applications
groups (i.e. it can run one or more than one application that could use ProSe
and these applications may be associated to different Applications Groups from
a ProSe perspective).
\- The ProSe UE ID allocated by the network may be refreshed upon mobility
management events (e.g. MME relocations) or based on network decision, or the
UE may request the ProSe UE ID to be reallocated.
\- An application group is identified by a ProSe Application ID.
\- The ProSe Application ID is not assigned by a PLMN and is managed at
application layer in decentralized manner (i.e. it is not assumed ProSe
Application ID\'s are unique).
\- An application group shares a secret that may be refreshed over time with
mechanisms outside the scope of 3GPP. This is used for mutual authentication,
integrity protection and ciphering for the group members.
\- An application user may have an identifier. This identifier is not expected
to be solely used for ProSe purposes and is solely managed at application
layer. We refer to it as application user ID.
\- The relationship between the application user ID and the ProSe UE ID
allocated to the UE is managed by specific application, as well as the related
privacy issues. When the ProSe UE ID is allocated or refreshed, the UE must
update each active ProSe capable application of interest that supports
targeted discovery.
\- When a UE registers its allocated/refreshed ProSe UE ID with an application
that supports targeted discovery, the application will manage notifying
application members associated with the UE of the UE\'s new ProSe UE ID.
\- A UE, based on application or user requirements, may request the network to
reallocate the ProSe UE ID assigned by the network. The UE may check if the
ProSe UE ID is allocated by the network before requesting the network to
reallocate it (i.e. in network independent mode or in modes of operation where
both out of coverage and in coverage devices are used, no network assigned
ProSe UE ID is used, rather a ProSe UE ID provisioned in the UE for network
independent procedures).
\- The ProSe UE ID for network independent operation may be reconfigured in
the device only upon conditions that are specific to the domain of application
of the device. However, from a 3GPP standpoint they are assumed to be static.
\- Applications authorized to use ProSe Discovery are allowed to access the
ProSe ID allocated to the UE and can receive the ProSe ID of UE\'s
participating in targeted, non targeted discovery or advertisement model.
\- Targeted, non targeted and advertisement based discovery can be authorized
separately per UE and per application via the DPF.
\- The application client in the UE, if it is authorized to participate in
targeted discovery, records with the ProSe Manager function in the UE the
ProSe Application ID(s) it is going listen on for targeted discovery.
\- The ProSe Manager is a function in the UE which restrict access to the
ProSe UE ID to authorized applications only and also that keeps track of the
Applications clients in the device which have registered interest in some
specific ProSe application ID\'s (for targeted Discovery).
\- An Application client in the UE registers with the ProSe Manager in the UE
whether it participates in Non- targeted discovery.
\- The ProSe manager in the UE provides to the application client the ProSe UE
ID of the UE issuing a Targeted discovery request so the application can
decide whether to respond to it and optionally to generate a challenge and
respond to a challenge, or perform any security functions like checking a
signature.
\- The ProSe manager in the UE provides to the application clients that
registered for Non targeted discovery the ProSe UE ID of the UE issuing a non-
targeted discovery request so the application can decide whether to respond to
it.
\- Applications can restrict ProSe Discovery by selective distribution, update
or withdrawal of the ProSe ID to user ID association.
During discovery phase or communication establishment phases, the request
messages are sent on a common RADIO resource. The information in these
messages may include the ProSe UE ID and ProSe Application ID so to facilitate
the targeting of information.
#### 6.4.8.2 Procedures
Normal MM procedures are used to manage the ProSe UE ID assignment (attach)
and management (tracking area update). Basically this implies.
**For attach procedure:**
\- Adding a ProSe UE ID request/proposal IE in the attach request messages.
\- Adding the ProSe UE ID as additional optional parameter in the Attach
Accept message included in the RRC connection reconfiguration (step 18 of the
attach procedure).
**For TAU procedure:**
\- Adding a ProSe UE ID in the TAU request messages.
\- Adding the \"new ProSe UE ID\" as additional optional parameter in the TAU
Accept message.
In addition, dedicated procedures for ProSe UE ID reallocation UE or network
initiated may be defined. An example of such procedures is provided in figures
6.4.8.2-1 and 6.4.8.2-2.
Figure 6.4.8.2â€‘7: UE requested ProSe UE ID reallocation
Figure 6.4.8.2â€‘8: Network initiated ProSe UE ID reallocation
It should be noted that in step 4 the UE needs to update only the active
applications using ProSe and not all those potentially capable to use ProSe.
And again here the Network is in the MME but the MME may optionally use a
separate entity (the ProSe Function) if 3GPP decided to open an interface to a
ProSe Entity/Function. If the application supports direct discovery then the
application will manage notifying application members associated with the UE
of the UE\'s updated ProSe UE ID.
Some other solutions claim this way to operate with a single ProSe UE ID is
flawed as a second application hosted on a device may get a leaked user
identity mapping by correlating different application layer user identities to
the same user and the user to a single ProSe UE ID.
However:
\- Compliant applications should not leak the ProSe UE ID mappings.
\- If compliant applications are not used (i.e. rogue applications aimed at
leaking ProSe IDs) then of course there is an issue. However this issue is
also present if we assigned a different code per application and the non
compliant applications could establish a mapping between different application
user ID and a user and the application user IDs mapped to a plurality of
codes, each associated to a different application.
\- In other words, the leaking of identity/ProSe UE ID mapping is a problem
that is not unique to any solution, as long a s a single ProSe UE ID to user
mapping is replaced by a plurality of ProSe ID\'s to user mapping.
\- The mapping with a single ProSe UE ID can be easier however if a
user/application is concerned it can refresh the ProSe UE ID on demand, just
as easily as a code can be reassigned.
In addition, by using a unique ProSe UE ID and a separate ProSe application ID
in discovery phase it is also possible to define which applications can use
discovery and which not, and also which UE can discover and which can only be
discovered for a certain application. The following figure 6.4.8-1 shows the
procedures involved in authorizing per application discovery behaviour.
Figure 6.4.8â€‘9: ProSe Identities handling during discovery
0) A D2D Provisioning Function ( DPF, which may be part of the ProSe function)
provisions discovery policies per application and per UE in each UE ProSe
Manager on an ongoing basis (so that any policy update is readily provided to
the UE). The discovery Policies allow the operator to restrict discovery
function access (the default is e.g. \"allow\"), and in particular:
\- Determine which application cannot participate in targeted discovery
\- Determine which applications cannot participate in non- targeted discovery
\- Determine which UE cannot be discovered for a certain application
\- Determine which UE cannot discover other UE\'s for a certain application
\- Determine whether restrictions apply for a UE for targeted or non-targeted
discovery
1) Before a UE can participate in discovery it needs to obtain a ProSe UE ID
from the MME. The MME may interact with a ProSe function if we allocate the
ProSe UE ID assignment to a ProSe Function entity. Also this step is repeated
every time a new ProSe UE ID is allocated.
2) Once the ProSe Manager obtains the ProSe UE ID, it can provide it to
applications that request it based on the discovery policies that are
provisioned in step 0.This is repeated every time a new ProSe UE ID is
allocated. If an application requires the ProSe ID, it notifies its ProSe
Application ID to the ProSe manager in the UE so it can participate in
targeted discovery and the ProSe manager can notify the Application when a
targeted discovery request is received so the application may also decide
whether to respond or not to the request and do any additional processing
required e.g. for security.
3) Application clients in the UE register the ProSe UE ID of the respective UE
with the applications alongside its own preferences and settings. The
application servers return a mapping of ProSe UE ID\'s to the User\'s
potential discovery targets user identities. The Application server may also
provide the preferences and settings of the remote parties in terms of privacy
settings etc. The application may also provide its own policies as to whether
the user can discover or can be discovered and whether it can do so per remote
user ProSe UE ID. This step is repeated every time the ProSe UE ID is renewed
and also remote parties get notified asynchronously by the application server
when a UE updates its ProSe UE ID.
4) The UEs execute the discovery procedures according to the policies they are
provided. In step 4a the UE\'s request the discovery based on whether they
need targeted or non- targeted behaviour, and may get a challenge and respond
to it. In step 4B the application gets notified of the outcome of the
discovery.
5) Optionally (as the application client may not require end user
interaction), the end users of the UEs get notified by GUI of the proximal
users based on network and application layer preferences and settings so they
can take any actions.
Out of network coverage operates based on pre-provisioned information. The
ProSe UE ID is pre-provisioned in the UE as well as any secrets related to
ProSe application ID\'s used in targeted discovery.
#### 6.4.8.3 Impact on existing entities and interfaces
The MME may be involved in ProSe ID allocation if this is not done on the user
plane by the ProSe function.
#### 6.4.8.4 Solution evaluation
This solution is providing a simple way to deal with per application
authorization and per user control by applications in using the ProSe
discovery capability if the UE is authorized to use ProSe. It naturally lends
itself to be use in targeted and non- targeted discovery, as well as
advertisement use cases.
### 6.4.9 Solution I9: Registration for ProSe services by using a 3GPP
assigned ProSe Identity
#### 6.4.9.1 Functional description
The ProSe identity can be configured by the 3GPP operator as follows:
\- Option 1: ProSe identity derived from IMSI. There is a one to one mapping
with the IMSI for each user subscribing to the ProSe Function.
NOTE 1: In that case the ProSe identity is a ProSe UE ID.
\- Option 2: In order to protect user privacy the 3GPP operator (i.e. ProSe
Function) may assign one or more temporary ProSe identities per user. The
ProSe Function maintains a mapping between ProSe Identities and the permanent
3GPP UE identity (i.e. IMSI). The ProSe ID is refreshed during UE mobility
events (e.g. when MME changes). In addition, for maintaining user privacy the
identifier is also assigned an expiry timer. ProSe function refreshes the
identifier when the timer expires.
NOTE 2: In that case the ProSe identity is a ProSe Application ID.
Editor\'s note: The procedure to renew ProSe ID for UE mobility events in an
inter-PLMN scenario is FFS.
It is also assumed that there is an application layer user identity per ProSe-
enabled application, and each ProSe-enabled UE can support multiple ProSe-
enabled applications.
ProSe ID is assigned/allocated by the ProSe Function when user subscribes to
the ProSe service. The ProSe application in the UE registers to an Application
Server with application layer user ID, and the 3GPP assigned ProSe identity.
The Application Server stores the mapping of application layer user ID and
ProSe ID and uses this information during a ProSe discovery procedure.
NOTE 3: A ProSe identifier can be updated or renewed at any time by the ProSe
Function or by the requesting ProSe-enabled UE.
NOTE 4: The ProSe Function also maintains a mapping of ProSe identities to
ProSe application layer identities.
#### 6.4.9.2 Signalling Flow
##### 6.4.9.2.1 Registration procedure
The procedure for registration is shown in the figure below:
\- **OPTION 1:** Registration over PC1 reference point.
Figure 6.4.9.2.1-1: ProSe registration procedure over PC1
1\. UE sends a ProSe registration request to the ProSe function over PC3. The
UE includes application id. The ProSe function assigns a ProSe Application
identifier
Editor\'s note: The format of the ProSe Application ID is FFS.
> 2\. The application client in the UE registers with ProSe application(s)
> over PC1 reference point by providing application user credentials and the
> ProSe Application identifier. The ProSe Application identifier also provides
> the application with information regarding the 3GPP operator that will
> assist the application server to locate the ProSe Function to request
> authorization.
3\. The application server stores the mapping between ProSe Application ID and
Application user credentials for all registered users. In this step the App
client in the UE will also be aware of discoverable ProSe Application IDs
based on the user\'s preferences.
4\. The application server provides the user preferences on ProSe discovery to
the ProSe function. For example, the ProSe Application IDs of a restricted
discovery list are provided to the ProSe function. The ProSe Function
maintains the mapping between the ProSe Application identifier and registered
application ID(s).
\- **OPTION 2:** Registration over PC3 reference point.
Figure 6.4.9.2.1-2: ProSe registration procedure over PC3
1\. UE sends a ProSe registration request to the ProSe function over PC3. The
ProSe function assigns a ProSe UE ID.
Editor\'s note: The exact format of the ProSe ID is FFS.
2\. The UE registers the application with the ProSe function over PC3
reference point. The UE include ProSe UE ID, application id, application user
id (user credentials) and ProSe discovery list.
3\. The ProSe function authorizes the application and forwards the information
to the application server over PC2.
4\. Application server stores the mapping between ProSe UE ID and application
user credentials.
Editor\'s note: It is FFS whether PC3 information is conveyed over the control
or the user plane.
#### 6.4.9.3 Impact on existing entities and interfaces
Editor\'s note: To be completed.
#### 6.4.9.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
## 6.5 EPC Support for WLAN Direct Communications
### 6.5.1 Solution W1: EPC support for WLAN Direct communication
#### 6.5.1.1 Functional description
##### 6.5.1.1.1 General
The solution described in this clause addresses the EPC support for WLAN
Direct communication key issue described in clause 5.9.
##### 6.5.1.1.2 System architecture
The system architecture is the same as the architecture for EPC-level
discovery described in clause 6.1.4.
#### 6.5.1.2 Procedures
The call flows described in clause 6.1.4 also apply here. The details specific
to Solution W1 are indicated with red ink in the figures and italicised text
in the call flow description.
Specific to the call flow in Figure 6.1.4.2.5-1, the Assistance information
for EPC support for WLAN Direct communication when the WLAN technology is
based on [22] may include one or more of the following parameters:
\- Common direct discovery period;
\- User\'s temporary link-layer identifier (i.e. the P2P Device Address)
assigned by its ProSe Function;
\- Link-layer identifier of the peer;
\- Designated P2P Group Owner;
\- SSID;
\- Radio channel description (e.g. selected operating channel);
\- Pre-shared secret for authentication, confidentiality and data integrity
protection on the direct link. The pre-shared key is generated anew for each
Proximity Request.
#### 6.5.1.3 Impact on existing entities and interfaces
The solution has no specification impact on existing RAN entities.
The solution has no specification impact on existing EPC entities:
#### 6.5.1.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.5.2 Solution W2: ProSe assisted WLAN Direct communication
#### 6.5.2.1 Functional description
The different phases that occur before the WLAN Direct communication between
two UEs can commence over IP are the following:
1\. Configuration of WLAN Direct parameters: Parameters for WLAN Direct can be
configured to the UE using ANDSF Policies special to WLAN Direct can be
defined for this purpose and provided to the UE from ANDSF using procedures
similar to TS 23.402 [23].
2\. Discovery phase using E-UTRA direct discovery: the originating UE has
discovered the identity of the UE (e.g. expression) that is interested to
initiate communication to. The procedures of the Discovery phase for this
solution alternative are similar to those described in clause 6.1. As part of
this process the UE can exchange information about the other UEs connection id
on WLAN Direct e.g. the MAC addresses.
3\. Direct connectivity phase on WLAN Direct: the originating UE and
terminating UE are initiating the connectivity procedure for WLAN Direct as it
is currently defined in [22]. These procedures are out of scope of 3GPP.
Editor\'s note: How communicating UEs share security configuration is FFS.
4\. Direct communication phase on WLAN Direct: the originating UE is
initiating direct communication (over IP) with the terminating UE. This
involves any form of \"over IP\" signalling as/if required e.g. SIP to setup a
VoIP session.
The following alternatives apply for the security procedures as part of this
solution alternative:
\- Security material for WLAN Direct communication can be (pre-)provisioned in
the UEs; or
\- Security keys can be provided from the serving MME following similar
procedures to those defined for network authorized procedures.
#### 6.5.2.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
##### 6.5.2.2.1 WLAN Direct Connection Setup
As described in clause 6.5.2.1 this procedure makes use of the discovery
solution 1, and is only applicable to any authorized ProSe-enabled UE.
Figure 6.5.2.2.1-1: Autonomous direct Connection Establishment procedure
1\. The two UEs get configured from ANDSF using mechanisms described in TS
23.402 [23] about the policies and access network discovery information that
apply to WLAN Direct.
Editor\'s note: Whether the ANDSF MO or another MO is needed for ProSe for
this purpose is FFS.
2\. The two UEs perform direct discovery over E-UTRA e.g. as described in
clause 6.1. As part of this process the UE can exchange information about the
other UEs connection id on WLAN Direct e.g. the MAC addresses.
3\. If the security keys are provided by the network the two UEs exchange
signalling with their respective MMEs. This follows similar procedures as
those described in clause 6.2.4 for key derivation for the \"network
authorized connection establishment\".
NOTE: More details about this step to be defined in SA WG3 TR.
4\. The two UEs execute WLAN Direct procedures to connect using WLAN Direct.
These procedures are out of scope of 3GPP.
#### 6.5.2.3 Configuration information from DPF for WLAN Direct communication
No additional configuration information is needed except what is described
already for direct discovery in clause 6.1.1.2.1.1.
#### 6.5.2.4 IP address allocation
IPv6 and IPv4 address can be used for the WLAN Direct link.
If IPv6 is used the UE auto-configures a link local IPv6 Address following
procedures defined in RFC 4862 [12]. This address can be linked to a EPS
bearer and use the /64 IPv6 prefix that is assigned to the associated EPS
bearer and allocated via one of the mechanisms defined for IPv6 prefix
allocation in TS 23.401 [11].
In addition to that the UE may use a /64 IPv6 prefix that is locally stored to
form a globally unique address.
Editor\'s note: IPv4 address allocation procedures are FFS.
#### 6.5.2.5 Mobility Aspects
Editor\'s note: Mobility and service continuity aspects are FFS.
#### 6.5.2.6 Operational aspects
##### 6.5.2.6.1 Lawful Intercept
Editor\'s note: Lawful intercept aspects are FFS.
##### 6.5.2.6.2 Accounting
Reporting of data by the UE that can be used by a server in the network that
is defined for this purpose can be triggered at any time. The UE can be
configured to periodically report data to this server for accounting purposes
via a secure interface if needed.
NOTE: The reporting can use over IP protocols or any form of small data
interface that exists (e.g. SMS) or any other possible small data mechanism
that could be defined in Rel-12.
Editor\'s note: Whether such UE-provided info can be considered a trusted
source of information to base accounting procedures on or whether other
solutions need to be developed is subject to SA WG3/SA WG5 evaluation.
#### 6.5.2.7 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
**UE:**
\- Support of discovery procedures as defined in clause 6.1.1.
\- Support for configuration information from ANDSF related to communication
using WLAN Direct.
**ANDSF:**
\- Provide configuration information to the UEs for interworking with ProSe
enabled WLAN Direct.
If procedures for network provided keys are used:
**MME:**
\- Security procedures, providing security keys to the UEs for the WLAN Direct
connection.
#### 6.5.2.8 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.5.3 Solution W3: Network-assisted WLAN Direct communication
#### 6.5.3.1 Functional description
This solution addresses the key issue #9: EPC Support for WLAN Direct. It
specifies how the EPC network can trigger two or more ProSe-enabled UEs to
form a WLAN Direct group and thus enable them to directly communicate in WLAN
Direct mode. It also specifies how the EPC network can terminate the operation
of an existing WLAN Direct group.
Two or more ProSe-enabled UEs can start communicating in WLAN Direct mode
after these UEs become members of the same WLAN Direct group. A WLAN Direct
group is essentially a peer-to-peer WLAN network, as shown in Figure
6.5.3.1-1. It has a Group Owner (GO) that operates as the access point of the
group and one or more clients (UE-2, UE-3, UE-4) that communicate with the GO.
A UE can become a client in the group by associating and authenticating with
the GO as specified in the Wi-Fi P2P specification [22]. Every WLAN Direct
group is using an SSID of the form \"DIRECT-ab\", where a, b are two random
characters. The SSID can be included in the Beacon transmissions of GO.
Figure 6.5.3.1-1: UEs participating in a WLAN Direct group.
Typically, a WLAN Direct group is autonomously formed by one or more WLAN
Direct devices (as specified in the Wi-Fi P2P specification [22]) without any
network involvement. This does not make it feasible for the network to control
and authorize P2P communication between devices. However, the present solution
enables the network to prevent autonomous WLAN Direct group formation (see
details below). In such case, a WLAN Direct group can only be formed by the
EPC network which selects the devices that should participate in the group and
selects the operating parameters of the group, such as the SSID and the
security keys. By having the EPC network form WLAN Direct groups all P2P
communications must be authorized and admitted by the network. Thus the
network can exercise the necessary control over P2P communications.
The network can configure ProSe-enabled UEs so that they are either allowed or
not allowed to autonomously form WLAN Direct groups. This configuration can be
done via OMA-DM and the definition of a suitable Management Object (MO) for
ProSe services. The procedures specified below apply to UEs which are not
allowed to autonomously form WLAN Direct groups. Such UEs can only participate
to WLAN Direct groups which are initiated by the EPC network as specified in
clause 6.5.3.2.1. The EPC network can also terminate WLAN Direct groups as
specified in clause 6.5.3.2.2.
#### 6.5.3.2 Procedures
##### 6.5.3.2.1 Network-initiated WLAN Direct Group Formation
The \"network-initiated WLAN Direct group formation\" procedure is initiated
by the EPC network when it wants to enable two or more UEs to start P2P
communication in WLAN Direct mode (as specified in the Wi-Fi P2P specification
[22]). The EPC network can decide to initiate this procedure based on several
triggers, for example, after receiving a message from one UE requesting direct
communication with another UE and after authorizing this request.
The main steps of the \"network-initiated WLAN Direct group formation\"
procedure are shown below in Figure 6.5.3.2.1-1. This figure shows an example
when the EPC network initiates the setup of a WLAN Direct group between two
UEs (UE-A and UE-B) but it can be easily extended to include more UEs in the
group. Before this procedure is executed, it is assumed that the EPC network
is made aware (e.g. during ProSe registration) that UE-A and UE-B are capable
to support ProSe communication in WLAN Direct mode.
Figure 6.5.3.2.1-1: Network-initiated WLAN Direct Group Formation to enable
WLAN Direct communication
1\. ProSe server A initiates the WLAN Direct group formation by sending a
ProSe Group Setup Request message to UE-A. This message includes a Mode
information element that indicates the technology (e.g. WLAN Direct) to use
for setting up the ProSe group. The ProSe server A is made aware that UE-A
supports WLAN Direct (e.g. during ProSe registration). The ProSe Group Setup
Request message includes also the following information elements:
a. SSID: The SSID to use for the WLAN Direct operation. This should be
compliant with the WLAN P2P specification [22] so it should be in the form
\"DIRECT-ab\" where a, b are two random characters.
b. WLAN Secret Key: The pre-shared key to be used by UE-A and UE-B to secure
their WLAN Direct communication. This is used by UE-A and UE-B as the Pairwise
Master Key (PMK).
c. Implement Group Owner: If set, the UE should implement the Group Owner (GO)
functionality specified in the Wi-Fi P2P specification [22]. The UE
implementing this functionality essentially becomes an AP that transmits
Beacons with the P2P IE and accepts associations from other WLAN Direct
devices or from legacy WLAN devices (those not implementing the WLAN Direct
functionality). If not set, the UE should behave as a WLAN Direct client that
attempts to discover and associate with a GO.
d. Peer Device ID: This is only required when the Implement Group Owner is set
and indicates the WLAN Direct device from which the GO should accept WLAN
association requests. Association requests from all other WLAN devices should
be rejected by GO. This is further explained in steps 3 and 6 below.
2\. UE-A responds with a ProSe Group Setup Response message which may include
the WLAN channel on which UE-A starts operating as GO and the IP addresses
assigned to UE-A and UE-B (IP address A and IP address B, respectively). These
IP addresses can be allocated by UE-A in this step in order to expedite the
group formation by eliminating the need to use DHCP later on. Note that the
Wi-Fi P2P specification assumes that a GO functions as a DHCP server and
dynamically allocates IP addresses to WLAN Direct clients. This DHCP
functionality is not required if the IP addresses are assigned by UE-A in this
step. The WLAN channel also may be included in order to accelerate the WLAN
Direct group formation procedure in step 6.
3\. UE-A tunes on the selected WLAN channel (channel 11) and starts
functioning as GO. Note however that in this case UE-A does not accept
associations from any WLAN client but only from the WLAN client that includes
in the Association Request a P2P Device ID = Peer Device ID (received in step
1). This is required to make sure that only the UE-B can associate and
communicate with UE-A.
4\. The ProSe server A sends also a ProSe Group Setup Request to UE-B. This
request may need to be routed via another ProSe server (as shown in Figure
6.5.3.2.1-1) if UE-B is unknown to ProSe Server A, e.g. when UE-B has a ProSe
subscription in another network. It is assumed that the ProSe server A can
find the contact information of ProSe server B e.g. by performing a DNS query
or by querying the HSS of UE-B.
5\. The ProSe Group Setup Request sent to UE-B includes the same Mode sent
previously to UE-A, i.e. WLAN Direct. The following information elements are
also included:
a. SSID: The same SSID sent to UE-A.
b. WLAN Secret Key: The same pre-shared key sent to UE-A.
c. WLAN Channel: The WLAN channel indicated by UE-A in step 2.
d. IP Address A and IP Address B: The IP addresses allocated by UE-A in step
2.
e. Implement Group Owner: In this case it is unset so that UE-B behaves as a
WLAN Direct client that attempts to discover and associate with a GO (UE-A).
f. Device ID: The same as the Peer Device ID sent to UE-A in step 2.
6\. UE-B accepts the request and responds with a ProSe Group Setup Response
which is forwarded to ProSe server A.
7\. The normal WLAN Direct procedure takes place for forming a direct group
between UE-A and UE-B. In this context, UE-B associates and authenticates with
UE-A, which functions as GO. In the association request UE-B includes the
Device ID received by the network (in step 4). Finally, the two UEs assign IP
addresses to their WLAN interfaces and the WLAN Direct group formation is
completed. The two UEs belong now to a common IP network and can establish
direct IP communication over WLAN.
##### 6.5.3.2.2 Network-initiated WLAN Direct Group Termination
The \"network-initiated WLAN Direct group termination\" procedure is initiated
by the EPC network when it wants to disable two or more UEs to start P2P
communication in WLAN Direct mode.
Editor\'s note: How the network can terminate a WLAN Direct group is FFS.
#### 6.5.3.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.5.3.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
## 6.6 ProSe Configuration and capabilities handling
### 6.6.1 Solution P1: Configuration of ProSe feature support of network in UE
#### 6.6.1.1 Functional description
HPLMN of ProSe-enabled UE configures on which VPLMNs the UE is authorized to
use ProSe features. Here, ProSe features are classified into ProSe discovery
and ProSe communication because TS 22.278 [3] defines that ProSe-enabled
Network is a network that supports ProSe discovery, and/or ProSe Communication
which means either or both can be supported by ProSe-enabled Network.
The configuration can be structured as shown in Figure 6.6.1.1-1:
Figure 6.6.1.1-1: Example structure of configuration of ProSe feature support
of network
In the figure above, the PLMN leaf indicates a VPLMN code. The
SupportProSeDiscovery leaf indicates that the UE is authorized to use the
ProSe discovery feature on that VPLMN. The SupportProSeCommunication leaf
indicates that the UE is authorized to use the ProSe Communication feature on
that VPLMN. Therefore, HPLMN can set on which VPLMNs its subscriber\'s UE is
authorized to use the ProSe discovery feature and/or the ProSe Communication
feature.
Note that Figure 6.6.1.1-1 is only for illustration, the details would be
specified by stage 3.
The configuration of ProSe feature support of network can be statically stored
in the ProSe-enabled UE and/or downloaded to the ProSe-enabled UE, e.g., by
OMA DM or (U)SIM OTA procedures, by HPLMN of the UE.
Based on the configuration, the ProSe-enabled UE determines whether it
initiates ProSe related operations in the registered PLMN.
#### 6.6.1.2 Procedures
Editor\'s note: It is considered that this solution does not need descriptions
related to procedures.
#### 6.6.1.3 Impact on existing entities and interfaces
> Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 6.6.1.4 Solution evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 needs will be
evaluated.
### 6.6.2 Solution P2: HSS based configuration
#### 6.6.2.1 Functional description
{width="6.496527777777778in" height="3.071527777777778in"}
Figure 6.6.2.1-1: ProSe configuration overview
The figure above illustrates what information related to ProSe configuration
is stored in each entity.
NOTE: This solution is applicable when the PC3 interface is routed via the
EPC.
1\. Parameters stored in UE
The UE is provisioned with configuration information indicating which ProSe UE
capabilities are enabled, and what are the parameters associated with those
capabilities. This configuration information could be provisioned, for
instance, via USIM or OMA DM.
Editor\'s note: The list of ProSe capabilities and parameters is FFS.
2\. Parameters stored in HSS
The HSS stores subscription information. New parameters are defined to
describe ProSe subscription information, such as:
\- Allowed ProSe features
\- ProSe discovery
\- Maximum Range Class
\- ProSe Communication
\- Allow ProSe Communications in HPLMN
\- Allow ProSe Communications in VPLMN
\- List of VPLMNs
\- ProSe user preferences
\- Activate / Deactivate ProSe direct communication
\- Act as a UE-to-UE Relay
\- Act as a UE-to-UE to Network Relay
Editor\'s note: the full list of ProSe subscription parameters is FFS.
3\. MME
The MME context receives configuration parameters from HSS, and UE
capabilities (UE Network Capabilities and UE Radio Capabilities) from UE ProSe
Function
The ProSe Function stores ProSe configuration parameters in a ProSe context.
Those parameters are provided by the MME.
Editor\'s note: it is FFS which configuration parameters are stored in the MME
and which parameters are stored in the ProSe Function.
4\. ProSe Application Server
The ProSe Application Server stores parameters related to applications that
use 3GPP ProSe Features.
Those parameters are not specified in 3GPP.
#### 6.6.2.2 Procedures
##### 6.6.2.2.1 High-level interactions for ProSe configuration
The following figure illustrates the high-level interactions related to ProSe
configuration.
Figure 6.6.2.1.2.1-1: High-level interactions for ProSe configuration
1\. ProSe configuration is performed during initial Attach.
2\. ProSe subscription update is the procedure initiated by HSS to update
parameters in MME and ProSe Function, when some subscription parameters in HSS
have been modified.
3\. ProSe configuration update is the procedure performed when the UE
temporarily changes its user preferences (i.e. without modifying its
subscription information).
#### 6.6.2.3 Impact on existing entities and interfaces
\- ProSe UEs need to be provisioned with ProSe UE network and ProSe UE radio
capabilities.
\- New subscription parameters need to be defined and stored in HSS.
\- MME context needs to be extended with new parameters.
\- The configuration parameters handled by the ProSe Function need to be
identified, as well the messages that provide those parameters to the ProSe
Function.
#### 6.6.2.4 Solution evaluation
This solution is reusing existing 3GPP procedures and therefore has limited
standardization impacts.
In addition, it has the following advantages:
\- Operators can control which ProSe features are allowed as part of user's
subscription, and perform charging for the use of those features, as specified
in SA1 requirements.
\- Operators can perform better resource management based on ProSe parameters.
\- It enables seamless support of roaming (via existing S6a interface),
Some new parameters within NAS messages will have to be specified in stage 3.
## 7 Evaluation
Editor\'s note: This clause contains the overall evaluation of various
solutions.
## 7.1 Evaluation of EPC-level discovery solutions
Solution D4 using U-plane location services (SUPL) has the following
advantages:
\- no standardisation impact on the RAN;
\- no standardisation impact on existing EPC nodes (assuming that the
subscriber\'s ProSe record is stored in the ProSe Function);
\- no impact on UE access stratum;
\- no signalling impact on the EPC control plane apart from the optional HSS
dip for initial location check;
\- location granularity as fine as the underlying LCS service (in any case
better than a cell);
\- EPC support for WLAN direct discovery and communication may be provided as
an incremental part of EPC-level discovery;
\- user\'s location is not disclosed to 3rd party application platforms
(contrary to OTT approaches).
\- if combined with IMS the existing procedures for authentication,
authorization, security, registration, deregistration and presence information
can be utilized. In particular, the use of an IMS-based procedure for UE
registration for ProSe has the following benefits:
\- IMS can be used to bootstrap PC3 security.
\- Re-registration/Re-authentication/out-of-coverage procedures are handled in
the IMS layer instead of developing in the ProSe layer.
\- User willingness to communicate: In case the User is in a meeting or an
important call or don\'t wish to communicate, ProSe Function could retrieve
this information from IMS/Presence instead of checking/disturbing the user.
\- UE location information could be retrieved from IMS/Presence in case the UE
reports its location.
\- IMS could be used as the registrar for ProSe there by avoiding an
additional registration from the UE.
\- Service Continuity could be built on IMS procedures in Release 13 and
forward.
\- By using the IMS, the ProSe client on the UE does not need to have access
to UICC.
\- if combined with initial targeted UE\'s location check via the HSS (as
proposed in D15) the Proximity Request can be cancelled early on when the UEs
are unlikely to enter proximity within the requested time window, without
bringing the targeted UE in connected mode.
EPC-level discovery solutions (e.g. #D4, #D5, #D15) present the following
drawbacks:
\- Determining UE proximity information by only performing location matching
cannot always be accurate due to variation in the accuracy of location
detection e.g. indoor vs. outdoor. The benefit depends on the use case. EPC-
level discovery can save UE battery and radio resources in use cases where the
UEs begin the proximity request time period outside proximity;
\- EPC-level discovery can create signalling in the network for activating and
maintaining location reporting. Signalling load can arise also across inter-
PLMN interfaces.
## 7.2 Summary of solutions for allocation of identities for network-
authorised direct discovery
This section provides a high-level summary of all solutions requiring
allocation of identities for network-authorised direct discovery.
The criteria to summarise the solutions were based on identifying similarities
between solutions for the following procedures:
\- What is the procedure to register UE for ProSe services?
\- What is the procedure to authenticate the application for discovery?
\- What is the procedure to allocate identifiers for direct discovery?
Based on these criteria, three categories of solutions were identified below:
NOTE: It is assumed that allocation of application user identifiers (e.g. user
credential for registering with an application) is out of scope for 3GPP.
\- Category 1: ProSe Application IDs for direct discovery are allocated using
application layer mechanisms which is out of 3GPP scope.
\- Category 2: ProSe identifiers (ProSe UE IDs & ProSe Application IDs) are
managed by a 3GPP defined entity (ProSe Function or MME).
\- Category 3: ProSe identifiers (ProSe UE IDs or ProSe Application IDs) are
managed by a 3GPP defined entity (ProSe Function or MME). 3GPP credentials are
disclosed to ProSe application over PC1 for management of discovery.
The table below provide a high-level overview of such solutions.
Table 7.2-1: Category 1: ProSe identifiers for direct discovery are allocated
using application layer mechanisms
+-------+-------+-------+-------+-------+-------+-------+-------+ | | UE | ProSe | A | Disc | Ident | Ident | F | | | re | UE ID | pplic | overy | ifier | ifier | ormat | | | gistr | | ation | Re | for | ass | of | | | ation | | Aut | quest | D | igned | ProSe | | | | | horis | | irect | by | A | | | | | ation | | Disc | | pplic | | | | | | | overy | | ation | | | | | | | | | ID | +-------+-------+-------+-------+-------+-------+-------+-------+ | Sol | ProSe | Yes | Pre- | Ma | One | A | Code | | ution | Su | (su | confi | naged | or | pplic | | | 1a | bscri | bscri | gured | by | more | ation | | | | ption | ption | at UE | a | ide | layer | | | (I6) | at | b | or | pplic | ntifi | mecha | | | | HSS | ased) | via | ation | er(s) | nisms | | | | | | OMA | | ass | | | | | | | DM | | igned | | | | | | | (DPF) | | per | | | | | | | | | a | | | | | | | | | pplic | | | | | | | | | ation | | | +-------+-------+-------+-------+-------+-------+-------+-------+
Table 7.2-2: Category 2: ProSe identifiers are managed by a 3GPP defined
entity (ProSe Function or MME)
+-------+-------+-------+-------+-------+-------+-------+-------+ | | UE | ProSe | A | Disc | Ident | Ident | F | | | re | UE | pplic | overy | ifier | ifier | ormat | | | gistr | ID? | ation | Re | for | ass | of | | | ation | | Aut | quest | D | igned | ProSe | | | | | horis | | irect | by | A | | | | | ation | | Disc | | pplic | | | | | | | overy | | ation | | | | | | | | | ID | +-------+-------+-------+-------+-------+-------+-------+-------+ | Sol | ProSe | Yes | Pre- | via | One | ProSe | Code | | ution | Su | ( | confi | user | ident | Fun | | | 2a | bscri | fixed | gured | plane | ifier | ction | | | | ption | s | at UE | PC3 | ass | | | | (I2) | at | tored | or | incl | igned | | | | | HSS | at | pro | uding | per | | | | | | HSS) | vided | app | UE | | | | | | | by | ID, | | | | | | | | ProSe | user | | | | | | | | Fun | crede | | | | | | | | ction | ntial | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Sol | UE | Not | Autho | Via | One | ProSe | Code | | ution | regi | req | rised | user | ident | Fun | | | 2b | sters | uired | by | plane | ifier | ction | | | | to | | ProSe | or | per | ( | | | (D2) | ProSe | | Fun | co | autho | optio | | | | Fun | | ction | ntrol | rised | nally | | | | ction | | | plane | a | with | | | | | | | PC3 | pplic | ma | | | | | | | incl | ation | pping | | | | | | | uding | | param | | | | | | | app | | eters | | | | | | | id, | | pro | | | | | | | user | | vided | | | | | | | crede | | by | | | | | | | ntial | | a | | | | | | | | | pplic | | | | | | | | | ation | | | | | | | | | se | | | | | | | | | rver) | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Sol | ProSe | Not | Aut | via | One | ProSe | Code | | ution | su | req | horis | co | ident | Fun | | | 2c | bscri | uired | ation | ntrol | ifier | ction | | | | ption | | s | plane | per | | | | (D13) | at | | tored | PC3 | autho | | | | | HSS | | at | incl | rized | | | | | | | HSS | uding | a | | | | | | | | app | pplic | | | | | | | | ID | ation | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Sol | UE | D | UE | via | One | ProSe | Code | | ution | regi | uring | sends | co | ident | Fun | | | 2d | sters | UE | a | ntrol | ifier | ction | | | | to | re | sep | or | per | | | | (D9, | ProSe | gistr | arate | user | UE. | | | | I4) | Fun | ation | a | plane | | | | | | ction | ProSe | pplic | PC3 | | | | | | | Fun | ation | incl | | | | | | | ction | re | uding | | | | | | | as | gistr | ProSe | | | | | | | signs | ation | UE | | | | | | | a | to | ID, | | | | | | | temp | ProSe | app | | | | | | | ProSe | Fun | ID, | | | | | | | UE ID | ction | user | | | | | | | | | crede | | | | | | | | | ntial | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Sol | UE | D | UE | via | One | ProSe | Con | | ution | regi | uring | sends | co | ident | Fun | tains | | 2e | sters | UE | a | ntrol | ifier | ction | a UE | | (D10, | to | re | sep | or | per | | ident | | D11) | ProSe | gistr | arate | user | UE. | | ifier | | | Fun | ation | a | plane | | | and a | | | ction | ProSe | pplic | PC3 | and | | user | | | | Fun | ation | incl | | | ident | | | | ction | re | uding | one | | ifier | | | | as | gistr | ProSe | ident | | | | | | signs | ation | UE | ifier | | | | | | a | to | ID, | per | | | | | | temp | ProSe | app | a | | | | | | ProSe | Fun | ID, | pplic | | | | | | UE ID | ction | user | ation | | | | | | | | crede | user | | | | | | | | ntial | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Sol | UE | D | A | via | One | ProSe | Code | | ution | regi | uring | pplic | co | ident | Fun | | | 2f | sters | UE | ation | ntrol | ifier | ction | | | (I9 | to | re | autho | or | per | | | | o | ProSe | gistr | rised | user | autho | | | | ption | Fun | ation | at | plane | rized | | | | 2) | ction | ProSe | disc | PC3 | a | | | | | | Fun | overy | incl | pplic | | | | | | ction | re | uding | ation | | | | | | as | quest | ProSe | | | | | | | signs | | UE | | | | | | | a | | ID, | | | | | | | temp | | app | | | | | | | ProSe | | ID, | | | | | | | UE ID | | user | | | | | | | | | crede | | | | | | | | | ntial | | | | +-------+-------+-------+-------+-------+-------+-------+-------+
Table 7.2-3: Category 3: ProSe identifiers are managed by a 3GPP defined
entity (ProSe Function or MME). Application manages 3GPP assigned identifiers
for discovery
+-------+-------+-------+-------+-------+-------+-------+-------+ | | UE | ProSe | A | Disc | Ident | Ident | F | | | re | UE | pplic | overy | ifier | ifier | ormat | | | gistr | ID? | ation | Re | for | ass | of | | | ation | | Aut | quest | D | igned | ProSe | | | | | horis | aut | irect | by | App | | | | | ation | horis | Disc | | ID | | | | | | ation | overy | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Sol | UE | Ass | Pre- | via | One | 3GPP | Ma | | ution | regi | igned | confi | OMA | ident | ident | naged | | 3a | sters | by | gured | DMc | ifier | ifier | by | | (D6, | for | MME | at UE | | ass | ( | a | | D7, | ProSe | | or | | igned | ProSe | pplic | | I8) | ser | | pro | | per | UE | ation | | | vices | | vided | | UE + | ID) | out | | | to | | via | | an | by | of | | | MME. | | OMA | | ident | MME | scope | | | MME | | DM | | ifier | and | of | | | as | | proce | | ass | ProSe | 3GPP | | | signs | | dures | | igned | A | | | | a | | | | by an | pplic | | | | temp | | | | autho | ation | | | | ProSe | | | | rized | ID by | | | | UE | | | | a | A | | | | ID. | | | | pplic | pplic | | | | | | | | ation | ation | | | | UE | | | | | | | | | regi | | | | | | | | | sters | | | | | | | | | to | | | | | | | | | a | | | | | | | | | pplic | | | | | | | | | ation | | | | | | | | | using | | | | | | | | | temp | | | | | | | | | ProSe | | | | | | | | | UE ID | | | | | | | | | and | | | | | | | | | a | | | | | | | | | pplic | | | | | | | | | ation | | | | | | | | | ass | | | | | | | | | igned | | | | | | | | | ProSe | | | | | | | | | A | | | | | | | | | pplic | | | | | | | | | ation | | | | | | | | | ID | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Sol | UE | Not | A | Via | One | ProSe | Ident | | ution | regi | req | pplic | PC1 | ident | Fun | ifies | | 3b | sters | uired | ation | incl | ifier | ction | the | | (I9 | to | | autho | uding | per | or | user | | o | ProSe | | rised | ProSe | autho | MME | and | | ption | Fun | | by | A | rized | | the | | 1, | ction | | ProSe | pplic | a | | ap | | D8, | via | | Fun | ation | pplic | | plica | | I3, | PC3. | | ction | ID | ation | | tion, | | I7) | | | d | | | | i.e. | | | ProSe | | uring | | | | ident | | | Fun | | UE | | | | ifies | | | ction | | re | | | | the | | | as | | gistr | | | | ProSe | | | signs | | ation | | | | se | | | a | | | | | | rvice | | | ProSe | | | | | | | | | A | | | | | | | | | pplic | | | | | | | | | ation | | | | | | | | | ID. | | | | | | | | | | | | | | | | | | UE | | | | | | | | | regi | | | | | | | | | sters | | | | | | | | | to | | | | | | | | | a | | | | | | | | | pplic | | | | | | | | | ation | | | | | | | | | using | | | | | | | | | ProSe | | | | | | | | | A | | | | | | | | | pplic | | | | | | | | | ation | | | | | | | | | ID | | | | | | | | | and | | | | | | | | | user | | | | | | | | | crede | | | | | | | | | ntial | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Sol | UE | Not | Pre | Once | Tar | A | Con | | ution | regi | req | confi | UE is | geted | pplic | tains | | 3c | sters | uired | gured | ass | ProSe | ation | a | | (D3) | to | | at UE | igned | A | s | layer | | | A | | | a | pplic | erver | 2 | | | pplic | | | ProSe | ation | | user | | | ation | | | A | ID | | ID | | | s | | | pplic | (e.g. | | (e.g. | | | erver | | | ation | SIP | | SIP | | | via | | | ID | URI | | URI) | | | PC1 | | | a | of an | | and | | | and | | | nd/or | ap | | an | | | is | | | ProSe | plica | | a | | | ass | | | La | tion- | | pplic | | | igned | | | yer-2 | level | | ation | | | a | | | ID, | g | | de | | | ProSe | | | UE | roup) | | fined | | | A | | | sends | in | | group | | | pplic | | | a | la | | ID | | | ation | | | disc | yer-2 | | | | | ID | | | overy | frame | | | | | a | | | re | pa | | | | | nd/or | | | quest | yload | | | | | a | | | via | a | | | | | ProSe | | | PC1 | nd/or | | | | | La | | | | a | | | | | yer-2 | | | | ProSe | | | | | Group | | | | La | | | | | ID | | | | yer-2 | | | | | | | | | Group | | | | | | | | | ID in | | | | | | | | | D | | | | | | | | | estin | | | | | | | | | ation | | | | | | | | | La | | | | | | | | | yer-2 | | | | | | | | | ID | | | +-------+-------+-------+-------+-------+-------+-------+-------+
When evaluating solutions describing allocation of identifiers for network-
authorised direct discovery the following need to be addressed:
\- Signalling cost
\- Message size
\- Security/user privacy
\- UE power consumption
\- Degree of network control
\- Support of open/restricted discovery
\- Impacts on existing nodes
## 7.3 ProSe Communication
### 7.3.1 Direct one-to-many communication decentralized mode
#### 7.3.1.1 Common approach
The following UE entity diagram shows a composite view of the different ProSe
Communication solutions C5 to C9, and it also takes into account some of the
agreements made in RAN.
Figure 7.3.1.1-1: Composite representation of direct one-to-many communication
decentralised mode entities
This composite view has the following characteristics:
1\. Communication is connectionless. Thus there is no over-the-air control
plane for the setting up of D2D sessions for the one-to-many communication
case. Bearer configuration and establishment is handled locally by the ProSe
Management (PME).
2\. The user plane interface to the layer 2 is IP packets carried over radio
bearers.
3\. A ProSe layer in the UE offers a ProSe Bearer (PSB) user plane transport
service to the IP layer. The Layer 2 maps ProSe Bearers one-to-one to radio
bearers at the radio layer.
4\. Radio bearers for ProSe traffic will be configured to offer an
unacknowledged service (acknowledgements if required will be handled by the
application layer) and will likewise be configured to perform Unidirectional
Mode (U-Mode) ROHC IP header compression (to be confirmed by RAN WGs).
5\. Transmission at the physical layer will be in broadcast mode.
NOTE 1: The need for collision detection and/or contention resolution at the
physical layer is to be determined by RAN (WGs).
Editor\'s note: The need for session announcement (keep alive) signalling
messages, to be used to allow a power-efficient way to keep the group
\"alive\" during the ProSe one-to-many communication session, is FFS.
6\. Applications can request the transmission on ProSe bearers with a
specified (destination) group ID/IP Multicast address and protocol
discriminator (PID). The default protocol will be IP data packets which are
passed through transparently to the radio layer.
6a. An IP layer common to all applications is included above the ProSe layer.
In the one-to-many communication the destination IP address is an IP Multicast
address for the group, while the source IP address is the IP address of the
sender.
7\. A ProSe Management Entity creates L2 destination and source addresses from
the requested destination group ID/IP Multicast address and configured source
ID/assigned ProSe UE ID as defined by RAN WGs.. The addresses and protocol
discriminator are passed to Layer 2 of the radio layer.
7a. A mapping between IP multicast addresses used at the IP layer and Layer 2
destination address is to be determined by RAN WGs.
7b. A mapping between IP multicast addresses used at the IP layer and Group
IDs is determined by pre-configuration or configuration by the ProSe Function.
NOTE 2: The size of Layer 2 addresses and the algorithm to derive them are to
be determined by RAN.
8\. IP packets passed to the radio layer on a given radio bearer will be
transmitted by the physical layer with the associated L2 destination address.
Packets passed up from the radio layer on the same radio bearer will have been
received over the air addressed to the same L2 destination.
NOTE 3: It is assumed that members of a group share a secret from which a
group security key may be derived to encrypt all user data for that group.
Only group members will be able to decrypt the user data as only they will
possess the group secret. This mechanism is considered by SA WG3.
9\. Any Layer 2 security needed is to be determined by RAN WGs and SA WG3.
10\. Authorisation for Direct ProSe communication in the out-of-coverage
scenario may be pre-configured in the UE by offline mechanisms as determined
by the HPLMN (off-line mechanisms need to be compatible with online mechanisms
used in an in-coverage scenario).
10a. Authorisation for Direct ProSe communication in the in-coverage scenario
may be done by signalling to the ProSe Function in the NW.
11\. ProSe UE and Bearer configuration parameters (e.g. including IP
addresses, Group IDs, Group security material, radio resource parameters) may
be pre-configured in the UE, as determined by the HPLMN (off-line mechanisms
need to be compatible with online mechanisms used in an in-coverage scenario).
When the one-to-many communication is destined for a GCSE group, the non PLMN
specific ProSe UE configuration parameters (i.e. IP Multicast address, Group
IDs, Group security material) is determined by the same entity that
administers the GCSE AS.
11a. ProSe UE and Bearer configuration parameters in the in-coverage scenario
may be done by signalling to the ProSe Server in the NW.
12\. Authorisation and bearer configuration parameters may be updated under
control of the registered PLMN when the UE is served by E-UTRAN. Authorization
and configuration of radio resources is handled by the eNodeB.
# 8 Conclusions
Editor\'s note: The clause will capture agreed conclusions from the Key Issues
and Architecture Solutions clauses.
## 8.1 Conclusions for ProSe one-to-many communication
\- The link layer of ProSe one-to-many communications shall be capable of
supporting a variety of network layer protocols via a Protocol identifier
field;
\- IPv6 and IPv4 shall be supported by the ProSe one-to-many communications
link layer.
## 8.2 Conclusions for ProSe one-to-many communication decentralized mode
Normative work needs to proceed as follows:
\- No need for dynamic ProSe group management prior to transmission (i.e. no
notion of \"ProSe group joining\").;
\- Distributed architecture: all UEs being equal in data traffic transmission,
there is no single point of failure;
\- When sending traffic to a group of receivers, the sender uses a multicast
address in the Destination Layer-2 ID field of the layer-2 data frame;
\- There is no QoS support apart from priority handling;
\- UEs are configured with a set of information that would allow one-to-many
communication to work;
\- UEs are provided with information regarding radio resources to be used for
out of network operation;
\- A mechanism for providing the aforementioned information to UEs needs to be
standardised in Rel-12;
\- Network independent procedures for one-to-many communication are to be
standardised in Rel-12;
\- The \"network layer\" stack for one-to-many communication in decentralized
mode is based on IP;
As the result of the SA2 study phase 1-many communication solution may require
the definition of the following functionality by the RAN groups (non-
exhaustive list):
\- At a minimum what is required from RAN layer is, a connectionless, layer-2
broadcast service including at least a destination layer-2 group identifier
address. A source layer-2 ID that is always set to a unicast identifier may
also be relevant;
\- Distributed medium access control protocol, preferably with priority access
support and pre-emption;
\- Mechanism for radio resource management and how to signal/configure the
radio resources to the UE;
\- Mechanism to minimise collisions on the transmitter side.
Additional details on the characteristics of the solution for ProSe one-to-
many communication decentralized mode are provided in clause 7.3.1.
## 8.3 Key Issue #8: EPC-level ProSe discovery
It has been agreed that in this release EPC-level ProSe Discovery shall be
supported using solution D4 as a basis, with the following assumptions:
1\. The PC3 reference point is established in the user plane of EPS;
2\. Proximity tracking relies on user plane LCS (SUPL) in this release;
3\. The roaming architecture is not specified in this release.
In order to fully exploit synergies with the IMS there is an IMS variant of
the Device Registration and Device Deregistration procedures, in addition to
their non-IMS variant. In order to allow for early Proximity Request
cancellation without bringing the targeted UE in connected mode it has been
agreed to support the targeted UE's initial location check via the HSS as an
option.
The solution corresponding to the agreements above is described in Annex I.
Annex I is technically endorsed and shall be moved to the new TS with the
exception of the following points that need to be revisited based on the
agreed upon solutions for ProSe Direct discovery:
\- The overall architecture figure and architecture description is to be
editorially aligned with the corresponding architecture for ProSe Direct
discovery.
\- The initial (rough) location check that is currently performed via the HSS
may be performed over a direct interface between the ProSe Function and MME
(provided such an interface is defined for ProSe Direct discovery).
\- It is FFS whether the UE registration procedure via IMS and UE
deregistration via IMS, i.e. if the use of IMS as part of EPC level discovery
is needed in this release.
## 8.4 Key Issue #9: EPC Support for WLAN Direct communications
It has been agreed that in this release EPC support for WLAN direct
communications shall be supported both:
\- as an incremental part of EPC-level discovery using solution W1 as a basis,
and
\- as a stand-alone procedure using solution W3 as a basis.
The list of parameters in the assistance information are defined in Annex H
(and may further be enhanced as part of Stage 3 specification) and shall be
moved to the new TS when it becomes available.
## 8.5 Conclusions for ProSe direct discovery
Normative work needs to proceed as follows:
\- PC3 interface is used for ProSe configuration and the functional entity
that provisions the UE with some necessary parameters is a new EPC node and
named Direct Provisioning Function (DPF);
\- Authorisation for the UE in order to perform discovery in a specific PLMN
is provided from ProSe Function or based on UE pre-configuration information
for ProSe-enabled Public Safety UEs that may be out of coverage;
\- Authorisation for applications to be able to use direct discovery is
provided from the ProSe Function;
\- Necessary subscription parameters in HSS will be defined for ProSe direct
discovery as will be determined by the related procedures;
\- For operator controlled open discovery the allocation and processing
mechanisms via PC3 for ProSe Application Identities is based in principle on
solution D13;
\- The allocation and processing mechanism for ProSe Application Identities
uses user plane PC3;
\- The format of ProSe Application Identities for open discovery may have a
structure so as to allow partial matching at the UE side reflecting
application-specified interests, and thus reduce the number of processing of
discovered ProSe Application Identities;
\- The values of ProSe Application Identities as defined in D13 for open
discovery is not expected to be specified in 3GPP, but another organization is
expected to specify that on behalf of operators\' community (e.g. GSM
Association).
\- ProSe Application Identities for open discovery shall have a standards
defined format in 3GPP to allow the 3GPP function to process them. The exact
format is FFS.
\- Both discovery models \"I am here\" (model A) and \"who is there\"/\"are
you there\" (model B) as described in clause 4.1.4 are relevant.
As the result of the SA2 study phase the solution may require at least the
definition of the following functionality by the RAN groups:
\- Discovery message format and signalling in the access stratum;
\- Mechanism for radio resource management and how to signal the radio
resources to the UE. This includes also allocation of radio resources of each
sharing operator in the network sharing case.
## 8.6 Key Issue #5: Relay for Public Safety ProSe
It has been agreed that the following applies for the UE-to-Network Relay:
\- At EPS level (excluding the ProSe Function) the network perceives only one
entity - the UE-to-Network Relay.
\- Relay selection on PC5 takes into account information that is announced by,
or solicited from, the UE-to-Network relay and that reflects a meaning such as
\"I can act as a relay for public safety\". It is FFS which other criteria are
used for relay selection.
\- The relay function can be activated on demand.
\- The relay function can be activated in any relay capable UE subject to
network authorization.
\- L3-based relay (solution R11) is adopted for UE-to-network relay unicast
communication.
\- IPv6 and IPv4 shall be supported for the connection between the remote UE
and the network. The remote UE shall use the same IP version as the relay UE
connects to the network. The relay UE allocates IP address to the remote UE.
\- IPv6 is mandatory for the relay UE and remote UE.
\- It is FFS whether the control plane function for the relay connection on
the access stratum is needed in order that the radio resource can be
coordinated among the remote UEs by the same relay UE.
NOTE: The radio resource control mechanism and the **parameters of the radio
access protocols** are defined in RAN1/2 WGs.
8.7 PC3 and PC8 reference points Architecture Conclusion
The following architecture option shall be used for PC3 and PC8 for ProSe
architecture:
\- PC3 and PC8 shall be handled via user plane between UE and ProSe Function.
## 8.8 Conclusions on configuration (Key Issues #2, #3 and #6)
Normative work needs to proceed as follows:
\- New management objects will have to be defined for:
\- ProSe discovery
\- ProSe one-to-many communication
Those are pre-provisioned or provisioned (e.g. via OMA DM), and contain:
\- Radio and network level parameters
\- Security related parameters (e.g. encryption keys)
\- ProSe features allowed per PLMN, as described in solution P1
\- HSS parameters:
\- List of subscription parameters retrieved by the ProSe Function: will be
defined as will be determined by the related procedures.
###### ### Annex A: Interactions with GCSE_LTE for Public Safety
# A.1 General
This Annex is intended for capturing certain aspects for interaction with
GCSE_LTE (such as Public Safety relays) which would include text that may be
outside of the ProSe WI scope (currently this is unclear), but whose inclusion
should greatly contribute to the clarity and applicability of the solutions
described in the main body of this TR.
# A.2 ProSe communications in Group Owner mode and Public Safety Relays
Depicted in Figure A.2-1 is a possible architecture for GCSE communications
via a ProSe UE-to-Network Relay supporting ProSe communications in Group Owner
mode described in clause 6.2.1.
Editor\'s note: Application layer and related reference points (GC1, GC1bis).
It is FFS whether these aspects will be studied as part of ProSe or GCSE_LTE.
Figure A.2-1: Architecture for GCSE communication via a ProSe UE-to-Network
Relay
New reference points:
**GC1** : The reference point between the GCSE application in the UE and in
the GCSE application server. It is used to define application level signalling
requirement to enable Multipoint functionality for GCSE_LTE, and possibly for
session establishment and floor control usages, etc. It is studied in TR
23.768 [5].
**GC1bis** : The reference point between GCSE application clients residing in
the UE and in the ProSe UE-to-Network Relay.
# A.3 Floor Control
## A.3.1 Example of distributed floor control for ProSe communications in Ad-
Hoc mode
Depicted in Figure A.3.1-1 is a possible architecture for GCSE communications
over a network operating in ProSe Ad-Hoc mode described in clause 6.2.5.
Figure A.3.1-1: Architecture for ProSe one-to-many communications in Ad-Hoc
mode
New or enhanced reference points:
**PC5ah** : This is the \"lower layer\" (ProSe) reference point among UEs that
reside within transmission range. It provides layer-2 multicast connectivity.
**GC1ah** : This is the reference point between application clients residing
in the UEs. It allows the UE to take part in direct ProSe one-to-many
communication (i.e. without a relay). For applications that need it, this
reference point supports distributed floor control.
One of the salient features of the ProSe Ad-Hoc architecture described in
clause 6.2.5 is the absence of a location for centralised floor control for
applications that require it (e.g. Push-to-Talk). Figure A.3.1-2 attempts a
system-level description of distributed floor control protocol that can be
used in conjunction with the ProSe Ad-Hoc architecture described in clause
6.2.5. The figure focuses both on:
\- Layer-2 aspects, such as layer-2 addressing and medium access protocol;
\- Application layer aspects, such as application layer addressing and
signalling messages for floor control.
{width="6.704166666666667in" height="2.029861111111111in"}
Figure A.3.1-2: Distributed floor control in the ProSe Ad-Hoc architecture
(clause 6.2.5)
It is assumed that the Public Safety UE is configured with the following data
for each GCSE Group of which it is a member:
\- Layer-2 Group ID - the layer-2 identifier uniquely identifying this GCSE
Group, and
\- Group Master Key - a static security key that is common for all members of
this GCSE Group. This key is used for derivation of encryption and integrity
protection keys for all traffic sent within the group.
All layer-2 frames carry Layer-2 Group ID in the Destination Layer-2 ID field.
This applies to both signalling messages and talk bursts. The Source Layer-2
ID field in all frames is set to the layer-2 identifier of the sender\'s
device.
Floor control for Push-to-Talk type of applications is performed with two
signalling messages:
\- FLOOR REQUEST (freq): used for seizing the floor for group communication to
this specific Layer-2 Group ID;
\- FLOOR RELEASE (frls): used for releasing the floor for group communication
to this specific Layer-2 Group ID.
The payload of the FLOOR REQUEST message may include the following parameters:
\- Msg ID: a signalling message identifier (set to \"FLOOR REQUEST\");
\- App Personal ID: an application layer identifier of the sender (e.g.
sip:john.doe@first.net). This is needed for sender\'s identification, given
that the layer-2 identifier of the sender\'s device (\"UE A\'s L2 ID\" in
Figure A.3.1-2) may be meaningless to the other GCSE Group members;
\- App Group ID: an application layer identifier of the GCSE Group (e.g.
sip:fire.brigade75@first.net). This is an optional parameter that may be
included for disambiguation purposes e.g. if for some reason the Layer-2 Group
ID address contained in the Destination Layer-2 ID field is not globally
unique. There is a 1:1 relationship between App Group ID and Layer-2 Group ID;
\- Other ...
When a UE wishes to seize the floor (which in a Push-to-Talk application
typically corresponds to the user pressing the \"Talk\" button), it first
checks whether the floor is busy by listening to the traffic exchanged on the
medium. If the floor is found to be free, the UE attempts to seize the floor
by transmitting several FLOOR REQUEST (\"freq\") signalling messages. The
reason for sending multiple identical signalling messages is for robustness
purposes: it is expected that consecutive transmission of identical signalling
messages may improve the chances for successful reception in the receivers.
NOTE 1: The repetition of signalling messages for floor control depicted in
Figure A.3.1-2 is just an example on how to improve robustness at the \"upper
layers\". The RAN groups may also design a \"lower layer\" solution for more
reliable transport of certain frames (notably, those carrying messages for
floor control), when requested to do so by the upper layers.
Subsequent to the frame carrying the last FLOOR REQUEST message the sender
starts transmitting the talk burst frames (\"tb\"). All other group members
refrain from seizing the floor until the floor is cleared.
At the end of the talk burst frame train (e.g. when the sender releases the
\"Talk\" button) the sender\'s UE transmits several consecutive FLOOR RELEASE
(\"frls\") signalling messages indicating to other group members that they can
attempt seizing the floor (i.e. they can attempt a \"changeover\").
In reference to Figure A.3.1-2, as soon as UE A releases the floor (by sending
consecutive FLOOR RELEASE messages), UE B attempts to seize the floor by
transmitting consecutive frames carrying the FLOOR REQUEST signalling message.
The interactions between the distributed floor control protocol and the MAC
protocol are further clarified in Figure A.3.1-3. It is assumed there are five
UEs in proximity of each other. At the application layer they are grouped in
two GCSE groups: GCSE group A (including UE_A1, UE_A2 and UE_A3) and GCSE
group B (including UE_B1 and UE_B2). It is also assumed that the MAC protocol
relies on RTS/CTS (Request-To-Send / Clear-To-Send) control frames for
collision detection. Given that the data frames are always sent on a multicast
address, it is assumed that the RTS/CTS control frames are exchanged with a
selected adjacent device. Note that the use of RTS/CTS is a MAC layer concept
and can be used in conjunction with the repetition of signalling messages
(\"freq\", \"frls\") for floor control described in Figure A.3.1-2.
Figure A.3.1-3: Interactions between distributed floor control and MAC
protocols
1\. UE_A1 has already seized the floor in GCSE group A and transmits a talk
burst train destined to members of GCSE group A (i.e. the Destination Layer-2
ID field in all layer-2 frames is set to a value uniquely identifying GCSE
group A). Although UE_B4 and UE_B5 are within transmission range, they filter
the received layer-2 frames without forwarding them to the upper layers.
2\. At the end of the talk burst train of UE_A1 (indicated by the reception of
FLOOR RELEASE signalling message) the user of UE_A3 presses the \"talk\"
button in order to initiate a \"changeover\". This results in the GCSE
application client residing in UE_A3 to send the identity of UE_A1 to the
lower layers, so that the lower layers can initiate a directed RTS.
3\. UE_A3 sends a directed RTS control frame to UE_A1, as suggested by the
upper layers.
4\. UE_A1 responds to UE_A3 with a CTS.
5\. UE_A3 can now seize the floor in GCSE group A (sending a FLOOR REQUEST
signalling message) and start sending a talk burst train. Note that for
individual layer-2 frames carrying talk burst frames UE_A3 has the option of
either preceding the talk burst frames with RTS/CTS (e.g. for increased
reliability) or not. If it decides to use RTS/CTS, it may still direct them to
the last talker (UE_A1), as was suggested by the upper layers upon the last
\"changeover\", or decide to direct them to any other UE of whose presence it
is aware.
6\. At some point UE_B2 wishes to seize the floor in GCSE group B in order to
start a new GCSE dialogue. Given that UE_B2 has filtered all frames sent on
the GCSE group A\'s Layer-2 Group ID, it is not aware of the talk burst train
boundaries in GCSE group A and may attempt to seize the transmission medium at
any point. This being a new dialogue, the application client residing in UE_B2
makes no suggestion for directed RTS to the lower layers, leaving them to
select a target device on their own.
7\. With regard to the recent activity of UE_A3 (with whom UE_B2 is completely
unaffiliated), the lower layers in UE_B2 decide to send a directed RTS to
UE_A3, etc.
NOTE 2: The floor control messages FLOOR REQUEST and FLOOR RELEASE correspond
to the SETUP (\"su\") and TX_CEASED (\"txc\") messages in the TETRA DMO
specification (ETSI TR 102 300-3 [24]). Although the meaning of these messages
is similar, there is one major difference that is worth clarifying. TETRA DMO
provides a \"circuit\"-like bearer service and the SETUP/TX_CEASED messages
are used for seizing/releasing both the floor and the medium (i.e. a TETRA DMO
channel). In other words, when a device seizes the floor, the medium too is
reserved continuously until either the sender relinquishes the overall
resource (floor + medium) or a timer expires. Even when the sender is not
effectively transmitting on the medium, the radio resource is still reserved
for a certain period of time (referred to as the \"reservation period\" in
[24]) in order to allow for \"changeover\" on the same call, the changeover on
the same group call having higher priority compared to a completely unrelated
group call. During this \"reservation period\", the TETRA DMO frame structure
provides special time slots that can be used by other UEs to contend for the
\"changeover\" or for pre-emption of the radio resource (e.g. allowing someone
to place an emergency call). In contrast, the FLOOR REQUEST and FLOOR RELEASE
messages for distributed floor control are used only for seizing/ releasing
the floor within a specific GCSE group, whereas access to the medium is
controlled by a MAC protocol. The ProSe Ad-Hoc communication medium being
frame-switched, UEs that have seized the floor within their GCSE group may
still have to contend for access to the medium with UEs in unrelated adjacent
GCSE groups. This contention-based access is performed for every single frame.
In reference to Figure A.1.1-3 this means that the talk burst frames destined
to GCSE group A (step 5) will likely be interleaved on frame-by-frame basis
with the talk burst frames destined to GCSE group B (step 9).
###### ### Annex B: Security Considerations for solution I1
NOTE: This clause is purely informational, since security aspects are handled
by SA WG3.
The exact level of security depends on the operator policy and user
preferences, and some of the operations mentioned below may be optional. All
the distributions of keys and other security data mentioned below is done in a
secure fashion, such that the information is not compromised during the
distribution phase.
In the case of restricted discovery, several cases may arise:
1\. A group of UEs form a \"trusted group\" where any member can discover any
other member. This is the most common case. All members of the group use a
single key which is pre-distributed to them by the operator. The key has an
expiration date and should be renewed periodically.
2\. If some members of the group want to be able to discover within the group
but not be discoverable, they can each obtain an additional (different) key
for when they transmit their own ProSe identifier and use the key associated
with the group when they decode received ProSe identifiers associated with the
group.
3\. A UE may belong to several \"trusted groups\", which means that it may
have several separate keys. As a potential optimization, the ProSe discovery
message may contain an unencrypted field that is a hash of the unencrypted
trusted group or individual id, to identify which key to use, thus avoiding
multiple decryption attempts with several keys.
4\. If some UEs in the \"trusted group\" trust all the others to be
discovered, but do not trust that they will not be impersonated by some member
of the group, then they will each obtain a \"signature\" bit string and a pair
of asymmetrical keys (private/public) in addition to the \"normal\" key
associated with the trusted group. The public key and the unencrypted
signature will be distributed to all the members of the group, while the
private key will be used by its owner to encrypt his/her \"signature\" bit
string. Discoverers will be able to verify the authenticity of the discovered
member of the group by decoding his/her signature with the public key and
matching it against the distributed signature. An alternative to using the
\"signature bit\" is having some already existing field double encrypted, once
with the private key of the sender and once with the key for the trusted
group.
Confidentiality can be assured by encryption of the ids using the distributed
keys. The message validation field could be an integrity code or can be
obtained by encrypting some digest of the message, Replay attacks can be
prevented by using in the encryption process , in addition to the key, of a
changing crypto-sync e.g. derived from the system time, considered common to
all UEs (within a few seconds).
###### ### Annex C: ProSe Identities Temporary Assumptions
The following assumptions apply for the ProSe Identities:
\- In order to satisfy the needs for open, restricted discovery and direct
communication, it will include at least a \"ProSe UE Identity\" and/or one or
more \"ProSe Application Identities\". The ProSe enabled UE can use the
\"ProSe UE Identity\", and/or one or more \"ProSe Application Identities\" for
discovery depending on operator configuration, user settings, application
settings etc.
\- ProSe UE Identity value is allocated from an entity in operator\'s network.
\- ProSe UE Identity should be possible to be configured, cached/stored in the
Public Safety UE and be used for \"out of network\" operation.
Editor\'s note: It is FFS whether \"ProSe UE Identity\" can be the GUTI itself
or another identity.
Editor\'s note: It is FFS if the aforementioned assumptions apply to all
solutions.
Editor\'s note: ProSe Identities for one-to-many communication, EPC-level
discovery are FFS. It is FFS whether additional ProSe Identities are required
for one-to-many communication.
Editor\'s note: It is FFS how the ProSe UE Identity is allocated for Public
Safety UEs expected to work \"out of box\" without first contacting the
network.
The following assumptions apply for the ProSe identities for Targeted
Discovery (D3, D6) and ProSe communication:
\- in the context of Targeted Discovery, ProSe Application ID is used to
designate the targeted population (an individual or a group) and is carried
within layer-2 frames used for ProSe communication;
\- the identifiers enabling ProSe communication, and - indirectly - Targeted
Discovery, are Destination Layer-2 ID and Source Layer-2 ID. They are both
carried within layer-2 frames used for ProSe communication;
\- in some solutions the Source Layer-2 ID and Destination Layer-2 ID may be
assigned by the network.
Editor\'s note: It is FFS whether \"ProSe UE Identity\" is the same as a
unicast _Layer-2 ID_ or is resolvable to it.
###### ### Annex D: Format of ProSe Identifier for Solution I5
* * *
Control Field Type 1 Sub-identifier Type 2 Sub-identifier
* * *
**Control Field:** which of the two possible sub-identifiers are included
(one, the other or both), whether or not the UE is a relay and if yes, what
kind.
**Type 1 Sub-Identifier:** Controlled at the 3GPP Layer. It is TBD whether or
not all Type 1 Sub-identifiers have the same length.
NOTE 1: Legal requirements may mandate that this Type 1 Sub-Identifier is
always present in ProSe Identifiers that are sent over-the-air for discovery.
This issue may need to be discussed and resolved in the SA WG3 LI Group
(lawful interception group within SA WG3).
NOTE 2: This Type 1 Sub-Identifier can be encrypted / decrypted at the 3GPP
layer, for the benefit of another discoverer or as a requirement from the
operator or from the law. In general, the used key is different than the key
used for encrypting the Type 2 Sub-Identifier. This issue is in SA WG3\'s
domain.
**Type 2 Sub-Identifier:** Controlled at the application layer. It is a
variable length field.
###### ### Annex E: Functional Split for ProSe
This clause identifies the 3GPP group which has the primary responsibility for
the various ProSe functions.
Table E.1: Direct discovery
+----------------+----------------+----------------+----------------+ | High Level | SA WG2 | RAN | Comments | | Function | responsibility | responsibility | | +----------------+----------------+----------------+----------------+ | UE | X | | | | Configuration | | | | | and | | | | | provisioning | | | | +----------------+----------------+----------------+----------------+ | UE | X | | | | authorization | | | | | for using | | | | | ProSe direct | | | | | discovery | | | | +----------------+----------------+----------------+----------------+ | Radio resource | | X | | | management for | | | | | ProSe direct | | | | | discovery | | | | +----------------+----------------+----------------+----------------+ | Allocation of | X | | It is FFS if | | ProSe | | | the allocation | | Application | | | of ProSe | | Identities | | | Application | | | | | Identities is | | | | | in scope of | | | | | 3GPP. | +----------------+----------------+----------------+----------------+ | Allocation of | X | | | | ProSe UE | | | | | Identities | | | | +----------------+----------------+----------------+----------------+ | Discovery | X | | This function | | Models | | | will determine | | | | | whether e.g. | | | | | both targeted | | | | | and | | | | | non-targeted | | | | | discovery will | | | | | need to be | | | | | supported | +----------------+----------------+----------------+----------------+ | Structure of | | X | | | discovery | | | | | messages | | | | | \"over the | | | | | air\" | | | | +----------------+----------------+----------------+----------------+ | Application | X | | | | authorization | | | | | for using | | | | | ProSe direct | | | | | discovery | | | | +----------------+----------------+----------------+----------------+ | Charging | X | | It is FFS what | | | | | is needed to | | | | | be defined by | | | | | 3GPP SA WG2 | | | | | | | | | | In the scope | | | | | of 3GPP SA | | | | | WG5. | +----------------+----------------+----------------+----------------+ | Inter-PLMN | X | FFS | | | discovery | | | | +----------------+----------------+----------------+----------------+ | Network | FFS | FFS | Resources of | | sharing | | | the different | | | | | sharing | | | | | partners may | | | | | need to be | | | | | signalled by | | | | | RAN | +----------------+----------------+----------------+----------------+ | Roaming | X | | | +----------------+----------------+----------------+----------------+ | Security | | | In the scope | | functions | | | of 3GPP SA WG3 | +----------------+----------------+----------------+----------------+
Table E.2: Direct communication 1-many
+----------------+----------------+----------------+----------------+ | High Level | SA WG2 | RAN | Comments | | Function | responsibility | responsibility | | +----------------+----------------+----------------+----------------+ | UE | X | | | | Configuration | | | | | and | | | | | provisioning | | | | +----------------+----------------+----------------+----------------+ | UE | X | | | | authorization | | | | | for using | | | | | ProSe direct | | | | | communication | | | | | (one-to-many) | | | | +----------------+----------------+----------------+----------------+ | - Network | X | X | This is shared | | independent | | | responsibility | | procedures | | | between SA2 | | | | | and RAN | +----------------+----------------+----------------+----------------+ | - Network | X | X | This is shared | | authorized | | | responsibility | | procedures | | | between SA2 | | | | | and RAN | +----------------+----------------+----------------+----------------+ | Radio resource | | X | | | management for | | | | | ProSe direct | | | | | communication | | | | | one-to-many | | | | +----------------+----------------+----------------+----------------+ | Allocatio | X | | | | n/provisioning | | | | | of ProSe Group | | | | | Identities | | | | +----------------+----------------+----------------+----------------+ | QoS | X | | It is FFS | | | | | whether QoS | | | | | can be | | | | | supported on | | | | | PC5 (direct | | | | | link) | +----------------+----------------+----------------+----------------+ | Ciphering | | | In the scope | | | | | of 3GPP SA WG3 | +----------------+----------------+----------------+----------------+ | Integrity | | | In the scope | | protection | | | of 3GPP SA WG3 | +----------------+----------------+----------------+----------------+ | IP header | | X | | | compression | | | | +----------------+----------------+----------------+----------------+ | Power saving | | X | | | for | | | | | one-to-many | | | | | communication | | | | | e.g. session | | | | | announcement | | | | +----------------+----------------+----------------+----------------+ | Protocol stack | X | | Out of scope | | (above IP) | | | of 3GPP Rel-12 | +----------------+----------------+----------------+----------------+ | Radio | | X | | | protocols for | | | | | \ | | | | | "one-to-many\" | | | | | communication | | | | +----------------+----------------+----------------+----------------+ | Inter-PLMN | X | FFS | | | one-to-many | | | | | communication | | | | +----------------+----------------+----------------+----------------+ | Network | FFS | FFS | Resources of | | sharing | | | the different | | | | | sharing | | | | | partners may | | | | | need to be | | | | | signalled by | | | | | RAN | +----------------+----------------+----------------+----------------+ | IP address | X | | | | allocation | | | | +----------------+----------------+----------------+----------------+ | Charging | X | | It is FFS what | | | | | is needed to | | | | | be defined by | | | | | 3GPP SA WG2 | | | | | | | | | | In the scope | | | | | of 3GPP SA | | | | | WG5. | +----------------+----------------+----------------+----------------+ | Roaming | X | | | +----------------+----------------+----------------+----------------+ | Other security | | | In the scope | | functions e.g. | | | of 3GPP SA WG3 | | key | | | | | provisioning | | | | +----------------+----------------+----------------+----------------+
###### ### Annex F: Procedures for allocation of ProSe Application Identities
in the context of solution I6
# F.1 General
The following text is provided only for information only in the context of
solution I6.
## F.1.1 Assignment of Private Expression Codes
A private expression code is associated with a ProSe-enabled application
running in the UE. For example, a UE running three ProSe-enabled applications
can broadcast three different expression codes, each one associated with one
ProSe-enabled application.
A private expression code is associated with a ProSe-enabled application
running in the UE. For example, a UE running three ProSe-enabled applications
can broadcast three different expression codes, each one associated with one
ProSe-enabled application.
Private expression codes are requested by ProSe-enabled applications in order
to make use of ProSe discovery services. Typically, an application requests
the ProSe Manager in the UE to generate a private expression code that is
associated with a certain application identity (also called \"Expression
Name\"). The ProSe Manager in the UE generates the private expression code by
using mechanisms out of scope of 3GPP. This procedure is performed the first
time an Expression Code is allocated, periodically as per application policy,
or when something changes into the permissions policy of the application with
respect to who is authorized to receive discovery information e.g. removing
someone from the friend list.
## F.1.2 Assignment of Public expression codes
The assignment of Public Expressions that are used for \"open discovery\" may
involve two steps:
**1\. Registration of a Public expression code associated with a business name
or application name** :
This process can be considered to generally be out of scope of 3GPP and is
equivalent to registering an Internet domain name into a registry (e.g.
\"3gpp.org\" for the .org TLD) via a registrant. Herein we do not give any
further details on this step.
**2\. Assigning a public expression code to a specific UE** :
How an allocated public expression code can be provisioned to a UE can be
accomplished also with methods outside the scope of 3GPP. An example of this
type of process is to support Public Expression allocation and maintenance,
each operator can employ in their core network an Application Function that
assigns full public expressions (Name/Code) to individual UEs such that the
expression Name and Code combination is globally unique e.g. per country.
## F.1.3 Lookup for Public expressions
The lookup procedure for Public Expressions involves the UE querying the
network to resolve the mapping between the Public Expression name and the
Expression code.
NOTE: The interface between UE and network can be based for example on HTTP or
DNS.
###### ### Annex G: Taxonomy of direct discovery solutions
Editor\'s note: This is work in progress and reflects the status of solutions
included in the latest version of the TR.
Figure G-1: Basic steps for ProSe direct discovery
The overall procedure for ProSe direct discovery can be split in the following
basic steps:
\- UE configuration and capability handling: This step refers to the key issue
#2 and #3. It will determine how the UE can be configured with certain
parameters that would be needed for direct discovery. This for example would
involve parameters necessary for the UE to operate \"out of network
coverage\".
Solutions available in clause 6: #D1, #P1, #P2.
\- ProSe Authorisation: This step refers to key issue #6 and determines
whether the UE itself and applications in the UE are authorized to use ProSe.
Solutions available in clause 6: #D1, #D6, #D7, #D8, #D9, #D11, #D13, #I8,
#I2.
\- ProSe identifiers allocation: This step refers to key issue #10 and defines
the procedures for allocation of ProSe identifiers and other related that
would allow the UEs to perform discovery. This determines how the ProSe
identifiers are allocated and to what they correspond.
Solutions available in clause 6: #D2, #I3, #D3, #D6, #D7, #D8, #D11, #I2,
#D13, #I6, #I7, #I8, #I9.
\- Discovery procedure: This step defines the actual discovery procedure
\"over the air\". It determines how the identifiers allocated are used in
order to allow the discovery to take place.
Solutions available in clause 6: #D1, D2, #D3, #D6, #D7, #D8, #D9, #D11, #D13,
#I2.
NOTE: SA WG2 will decide whether model A or model B or both shall be used for
discovery. RAN WG2 will decide on the format of discovery messages over the
air.
###### ### Annex H: EPC support for WLAN direct discovery and communication
The present annex is a temporary placeholder for the endorsed solution for EPC
support for WLAN direct discovery and communication, when the latter is used
as a stand-alone procedure.
The description in this annex uses the same clause numbering as the ProSe
technical specification (TS 23.303 [26]) and the text in each clause below
targets the corresponding clause in TS 23.303 [26].
The following clauses need to be revisited upon transferring the text from
this annex to TS 23.303 [26]:
\- none.
2 References
[x] Wi-Fi Alliance Technical Committee P2P Task Group, \"Wi-Fi Peer-to-Peer
(P2P) Technical Specification\", Version 1.1.
[y] IEEE Std 802.11-2007: \"IEEE Standard for Information technology -
Telecommunications and information exchange between systems - Local and
metropolitan area networks - Specific requirements - Part 11: Wireless LAN
Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".
5 Functional Description and Information Flow
5.1 Control and user plane stacks
5.x EPC support for WLAN direct discovery and communication
5.x.1 General
The EPC network may decide to enable two or more ProSe-enabled WLAN-capable
UEs to directly communicate using WLAN technology. This decision can be taken,
for example, when the EPC network supports EPC-level ProSe discovery and
becomes aware that two or more UEs are in close proximity, when the EPC
network knows that UE-A requests to communicate with UE-B which is in close
proximity of UE-A, etc.
Figure 5.x.1-1 shows how the EPC network enables UE-A and UE-B to directly
communicate in WLAN direct mode. This is accomplished by triggering the two
UEs to establish a WLAN direct group (e.g. like the Peer-to-Peer Group
specified in [x]) and providing them with assistance information which enables
the EPC network to control and to expedite the establishment of the WLAN
direct group.
With the procedure shown in Figure 5.x.1-1 the EPC network can (_i_) control
when a WLAN direct group can be established, (_ii_) authorize the UEs that can
become members of this group (and thus communicate with each other in WLAN
direct mode) and (_iii_) control the operating parameters of the WLAN direct
group e.g. the SSID, the security keys, etc. (more details are provided in
Annex X).
NOTE 1: When the WLAN direct discovery and communication is based on the Wi-Fi
Peer-to-Peer (P2P) specification [x], a WLAN direct group is autonomously
established by one or more UEs without any network involvement. However, with
the procedure shown in Figure 4.x.1-1 it is the EPC network that can authorize
and trigger the establishment of WLAN direct groups.
The ProSe Function shown in Figure 5.x.1-1 is the network function that
triggers and controls the establishment of a WLAN direct group between one or
more UEs.
Figure 5.x.1-1: Signalling flow for EPC support for WLAN direct communication
1\. The ProSe Function decides to trigger UE-A and UE-B to establish a WLAN
direct group under the control of the network.
2\. The ProSe Function sends a WLAN Direct Group Setup Request (Assistance
Information) to UE-A. The Assistance Information is a set of parameters which
can expedite the establishment of the WLAN direct group and enables the EPC
network to control the operating parameters of the WLAN direct group. The
Assistance Information content depends on the WLAN technology and is further
described in Annex X. If UE-A accepts the request and the offered Assistance
Information, it responds with a WLAN Direct Group Setup Response. This
response may include parameters for the WLAN direct group proposed by UE-A
(e.g. an operating channel).
NOTE 2: When EPC support for WLAN direct discovery and communication is used
in conjunction with EPC-level discovery, the assistance information for WLAN
direct discovery and communication is provided as part of the Proximity Alert
procedure.
3\. The ProSe Function sends also a WLAN Direct Group Setup Request
(Assistance Information) to UE-B. The Assistance Information in the request
may take into account the parameters proposed by UE-A in step 1b.
4\. The two UEs establish a WLAN direct group and may start communicating in
WLAN direct mode.
NOTE 3: In this release of the specification it is assumed that UE-A and UE-B
are controlled by the same ProSe Function.
Annex X:\ Assistance Information for EPC support for WLAN direct discovery and
communication
X.1 General
The Assistance Information is designed to expedite WLAN direct discovery and
communication. The Assistance Information content depends on the WLAN
technology.
X.2 Wi-Fi Peer-to-Peer
Wi-Fi Peer-to-Peer (P2P) specification [x] defines an architecture and set of
protocols that facilitate direct discovery and communication using the IEEE
802.11 technology [y].
To assist WLAN direct discovery and communication as required by the Wi-Fi P2P
technology [x] the EPC needs to supply some or all of the following items as
part of the Assistance Information:
\- SSID: The SSID to use for Wi-Fi P2P operation. To be compliant with the Wi-
Fi P2P specification [x] the SSID should be in the form \"DIRECT-ab\" where a,
b are two random characters.
\- WLAN Secret Key: The pre-shared key to be used by UEs to secure their Wi-Fi
P2P communication. This is used by UEs as the Pairwise Master Key (PMK).
\- Group Owner indication: If set, the UE should implement the Group Owner
(GO) functionality specified in the Wi-Fi P2P specification [x]. The UE
implementing this functionality essentially becomes an AP that transmits
Beacons with the P2P Information Element and accepts associations from other
Wi-Fi P2P devices or from legacy Wi-Fi devices (those not implementing the Wi-
Fi P2P functionality). If not set, the UE should behave as a Wi-Fi P2P client
that attempts to discover and associate with a GO.
\- P2P Device Address of self: This is the WLAN Link Layer ID to be used by UE
to advertise itself. A UE implementing the Group Owner and indicates the WLAN
Direct device from which the GO should accept WLAN association requests.
Association requests from all other WLAN devices should be rejected by GO.
\- P2P Device Address of peers: This is the WLAN Link Layer ID to be used by
UE to discover peer UEs. A UE implementing the Group Owner should accept WLAN
association requests only from devices that are in this list.
\- Operation channel: The channel on which Wi-Fi P2P discovery and
communication should take place.
\- Validity time: The time period during which the content provided in the
assistance information is valid.
###### ### Annex I: EPC-level ProSe discovery
This annex is a temporary placeholder for the endorsed solution for EPC-level
ProSe discovery and EPC support for WLAN direct communication, when the latter
is provided as part of EPC-level ProSe discovery.
The description in this annex uses the same clause numbering as the ProSe
technical specification (TS 23.303 [26]) and the text in each clause below
targets the corresponding clause in TS 23.303 [26].It is agreed that the
contents of this annex shall be moved to TS 23.xxx with the following
exceptions:
\- Clause 5.x.5 step 5: If a direct reference point between the ProSe Function
and MME is defined to support ProSe Direct discovery, it shall be reassessed
whether the initial (rough) location query shall be sent via Sh functionality
to the HSS or via the direct reference point to the MME;
\- Clause 5.x.4 step 1: The identification of the App Server (e.g. via
Application ID or FQDN) shall be aligned with any similar mechanism in the
architecture for ProSe Direct discovery.
\- Clause 4 (Architecture models and Concepts): Most of the text in this
clause is subject to editorial alignment with corresponding input related to
ProSe Direct discovery.
\- Clause 5.x.3.3 (UE registration for ProSe through IMS) and clause 5.x.8.3
(UE deregistration for ProSe through IMS): It is FFS whether the UE
registration procedure via IMS and UE deregistration via IMS, i.e. if the use
of IMS as part of EPC level discovery, is needed in this release.
2 References
[x] Open Mobile Alliance, OMA AD SUPL: \"Secure User Plane Location
Architecture\", (http://www.openmobilealliance.org).
[y] 3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".
[z] 3GPP TS 23.218: \"IP Multimedia (IM) session handling; IM call model\".
3 Definitions and abbreviations
3.1 Definitions
**ProSe discovery:** A process that identifies that a UE that is ProSe-enabled
is in proximity of another, using E-UTRA (with or without E-UTRAN) or EPC.
**EPC-level ProSe discovery:** A ProSe discovery procedure by which the EPC
determines the proximity of two ProSe-enabled UEs and informs them of their
proximity.
**ProSe-enabled UE:** A UE that supports ProSe requirements and associated
procedures. Unless explicitly stated otherwise, a ProSe-enabled UE refers both
to a non-public safety UE and a public safety UE.
**EPC ProSe Subscriber ID** : An identifier for EPC-level ProSe discovery and
EPC support for WLAN direct communication that uniquely identifies a UE
registered for ProSe. This identifier can be occasionally reassigned by the
ProSe Function.
**ProSe Function ID** : An FQDN that uniquely identifies a ProSe Function.
**Application ID** : A globally unique identifier identifying a specific
application.
**Application Layer User ID** : An identity identifying a user within the
context of specific application (e.g. alice@social.net). The format of this
identifier is outside of 3GPP scope.
**WLAN Link Layer ID** : A link layer identity used for WLAN direct discovery
and/or WLAN direct communication. Depending on the WLAN technology it can be
temporary (e.g. temporary MAC address) or permanent (e.g. permanent MAC
address). The format of this identifier depends on the WLAN technology and is
outside of 3GPP scope.
3.2 Abbreviations
ALUID Application Layer User ID
EPSID EPC ProSe Subscriber ID
PFID ProSe Function ID
ProSe Proximity Services
SLP SUPL Location Platform
SUPL Secure User Plane Location
WLLID WLAN Link Layer ID
4 Architecture Model and Concepts
4.1 General Concept
Proximity Services (ProSe) are services that can be provided by the 3GPP
system based on UEs being in proximity to each other.
The 3GPP system enablers for ProSe include the following functions:
\- EPC-level ProSe discovery;
\- EPC support for WLAN direct discovery and communication.
4.2 Architectural Reference Model
Figure 4.3.x.2-1: Architecture reference model for ProSe (non-roaming)
4.3 Reference points
4.3.1 General
4.3.2 List of Reference Points
**Reference points:**
**PC1** : It is the reference point between the ProSe application in the UE
and in the App Server. It is used to define application level signalling
requirements. PC1 is not specified in this release of the specification.
**PC2** : It is the reference point between the App Server and the ProSe
Function. It enables the interaction between App Server and ProSe
functionality provided by the 3GPP EPS via ProSe Function (e.g. name
translation).
**PC3** : It is the reference point between the UE and the ProSe Function. It
enables the interaction between UE and ProSe Function. PC3 relies on EPC user
plane for transport (i.e. an \"over IP\" reference point).
**PC4** : It is the reference point between the EPC and ProSe Function. It is
used to define the interaction between EPC and ProSe Function. With EPC-level
ProSe discovery PC4 is used by the ProSe Function in the role of LCS client to
query the SUPL Location Platform (SLP) defined in [x].
**PC4x** : It is the reference point between IMS and ProSe Function. It is an
ISC interface as defined in IMS [73]. This interface may be used by the ProSe
Function to get Presence status as well as information of the UE being
registered/de-registered on the network.
**PC5** : It is the reference point between UE to UE used for control and user
plane for direct discovery, direct communication and ProSe relay.
**PC6** This reference point enables ProSe discovery between users subscribed
to different PLMNs.
4.3.3 Reference Point Requirements
4.4 Network Elements
4.4.1 General
4.5 High Level Function
Editor\'s note: This clause explains the high level functions (e.g. charging,
triggering, etc) for ProSe.
The ProSe Function in the network (as part of EPS) defined by 3GPP has a
reference point towards the App Server, towards the EPC and the UE. The
functionality includes the following:
\- Storage of ProSe-related subscriber data and/or retrieval of ProSe-related
subscriber data from the HSS;
\- Authorization and configuration of the UE for EPC-level ProSe discovery and
EPC-assisted WLAN direct discovery and communication;
\- Acting as location services client (SLP agent) to enable EPC-level ProSe
discovery;
\- Providing UE with information to assist WLAN direct discovery and
communications;
\- Handling of EPC ProSe Subscriber IDs and Application Layer User IDs;
\- Security related functionality;
\- Interaction with UE over PC3 reference point;
\- Interaction with 3rd party Application Servers over PC2 reference point;
\- Interaction with IMS over PC4x reference point; ProSe Function acts as
application server to IMS;
\- Interaction with ProSe Functions in other PLMNs over PC6 reference point;
\- Optional support for Sh functionality for requesting UE location via the
HSS;
\- Provide functionality for charging (via or outside of EPC e.g. offline
charging).
Application servers, which are users of the ProSe capability for building the
application functionality, are defined outside the 3GPP architecture. In order
to be able to use ProSe, the Application Server needs to support the following
capability:
\- Storage of the subscribers\' EPC ProSe Subscriber ID and its ProSe Function
ID;
\- Mapping of Application Layer User IDs and EPC ProSe Subscriber IDs.
4.6 Identifiers
4.6.1 General
4.6.x Identifiers for EPC-level discovery
The following identities are used for EPC-level ProSe discovery: EPC ProSe
Subscriber ID, Application Layer User ID and Application ID.
The ProSe Function is identified by an FQDN that UE constructs by using the
PLMN ID.
4.6.y Identifiers for EPC support for WLAN direct discovery and communication
The following identifier is used in addition for EPC support for WLAN direct
discovery and communication: WLAN Link Layer ID.
5 Functional Description and Information Flow
5.1 Control and user plane stacks
5.x EPC-level ProSe discovery procedures
5.x.1 General
EPC-level ProSe discovery can be used independently or in conjunction with EPC
support for WLAN direct discovery and communication.
When EPC support for WLAN direct discovery and communication is requested as
part of the EPC-level ProSe discovery procedure, the additional parameters for
support of WLAN direct discovery and communication are indicated in the
figures with italicised text.
5.x.2 Overall call flow for EPC-level ProSe discovery
The overall call flow for EPC-level ProSe discovery and optional EPC support
for WLAN direct discovery and communication is illustrated in Figure 5.x.2-1.
Each procedural box is subsequently described in more detail as a separate
call flow.
Figure 5.x.2-1: Overall call flow for EPC-level ProSe discovery and optional
EPC support for WLAN direct discovery and communication
1\. UEs perform UE registration for ProSe with the ProSe Function residing in
their respective Home PLMNs;
2\. UEs perform application registration for ProSe with the ProSe Function
residing in their respective Home PLMNs;
3\. UE A makes a proximity request for UE B, i.e. requests that it be alerted
for proximity with UE B (possibly indicating a window of time during which the
request is valid). In response, ProSe Function A requests location updates for
UE A and UE B. These location updates can be periodic, based on a trigger, or
a combination of both. To request location updates for UE A, ProSe Function A
contacts SUPL Location Platform (SLP) A. To request location updates for UE B,
ProSe Function A contacts ProSe Function B, which requests location updates
for UE B from SLP B;
4\. The UEs\' locations are reported to their respective ProSe Functions
intermittently. ProSe Function B forwards UE B\'s location updates to ProSe
Function A based on the conditions set by ProSe Function A. Whenever ProSe
Function A receives location updates for UE A and/or UE B, it performs
proximity analysis on UE A and UE B\'s locations;
5\. When ProSe Function A detects that the UEs are in proximity, it informs UE
A that UE B is in proximity and (optionally) provides UE A with assistance
information for WLAN direct discovery and communication with UE B. ProSe
Function A also informs ProSe Function B, which in turn informs UE B of the
detected proximity and (optionally) provides UE B with assistance information
for WLAN direct discovery and communication with UE A.
5.x.3 UE registration for ProSe
5.x.3.1 General
To obtain ProSe service a ProSe-enabled UE needs to register with the ProSe
Function. The UE registration for ProSe can be performed natively or via the
IMS.
5.x.3.2 UE registration for ProSe
Depicted in Figure 5.x.3.2-1 is the native procedure for UE registration for
ProSe.
Figure 5.x.3.2-1: UE registration for ProSe
1\. To select ProSe Function A, UE A constructs an FQDN using the serving PLMN
ID and relies on DNS translation to obtain the IP address of ProSe Function A.
UE A registers with ProSe Function A by sending a UE Registration Request
(IMSI, [WLLID_A]) message.
If UE A intends to use EPC support for WLAN direct discovery and communication
and if it uses a permanent WLAN Link Layer ID, the message also includes UE
A\'s permanent WLAN Link Layer ID (WLLID_A). Alternatively, the UE may obtain
a temporary WLAN Link Layer ID from the ProSe Function as part of the
Proximity Request procedure.
Editor\'s note: It is FFS for 3GPP SA WG3 whether the use of permanent WLLIDs
in the context of EPC-support for WLAN direct discovery and communication is
acceptable.
2\. ProSe Function A may interact with the HSS in order to authenticate the
user and check whether the user is authorised for ProSe. Alternatively, all
user settings related to authentication and authorisation for ProSe may be
configured locally in ProSe Function A, in which case the interaction with the
HSS is not needed.
3\. ProSe Function A generates an EPC ProSe Subscriber ID for UE A (EPSID_A),
stores the EPSID_A together with user\'s IMSI and responds to UE A by sending
a UE Registration Response (EPSID_A) message.
Editor\'s note: The security aspects of the registration procedure need to be
studied by SA WG3.
5.x.3.3 UE registration for ProSe through IMS
Depicted in Figure 5.x.3.3-1 is the procedure for UE registration for ProSe
via the IMS.
Figure 5.x.3.3-1: UE registration for ProSe through IMS
1\. UE A starts registration with the home IP Multimedia Subsystem (IMS) with
Private identity (based on IMSI) and other authorization parameters. As part
of the IMS registration, UE may provide WLAN contact information.
Alternatively, the ProSeFunction may retrieve WLAN contact information through
the Presence Info. If UE A intends to use EPC support for WLAN direct
discovery and communication and if it uses a permanent WLAN Link Layer ID, the
message also includes UE A\'s permanent WLAN Link Layer ID (WLLID_A).
2\. The IMS authenticates and authorises the user.
3\. Based on information received in step 1, the IMS determines that the user
wishes to register for ProSe. It sends the 3rd party registration to the ProSe
Function and includes the IMSI as part of the IMS 3rd party registration as
defined in IMS [73, z].
4\. ProSe Function generates an EPC ProSe Subscriber ID for UE A (EPSID_A),
stores the EPSID_A together with user\'s IMSI and responds to the IMS by
sending a UE Registration Response (EPSID_A) message.
5\. Completions of the IMS registration procedure.
Editor\'s note: The security aspects of the registration procedure need to be
studied by SA WG3.
5.x.4 Application registration for ProSe
When a user registers with a 3rd party application server, he/she is
designated an Application Layer User ID (e.g. ALUID_A for user A). This
procedure is out of 3GPP specification scope. Then to activate ProSe features
such as EPC-level ProSe discovery for a specific application, the UE registers
the application with the ProSe Function, as illustrated in Figure 5.x.4-1.
Figure 5.x.4-1: Application registration for ProSe
1\. UE A sends Application Registration Request (EPSID_A, Application ID,
ALUID_A) message to ProSe Function A to register an application for ProSe.
EPSID_A is the EPC ProSe Subscriber IP for UE A. The Application ID is used to
identify the 3rd party App Server platform. ALUID_A is user A\'s Application
Layer User ID.
Editor\'s note: It is FFS whether Application ID or an FQDN is used to
identify the App Server. This decision is to be aligned with any similar
decision in the procedure for ProSe Direct discovery.
2\. ProSe Function A retrieves user\'s EPC ProSe Subscriber ID (EPSID_A).
ProSe Function A may interact with the HSS in order to check whether the UE is
authorized to register this application for ProSe. Alternatively, all user
settings related to authentication and authorisation for ProSe may be
configured locally in ProSe Function A, in which case the interaction with the
HSS is not needed.
3\. ProSe Function A sends a ProSe Registration Request (ALUID_A, EPSID_A,
PFID_A) message to the App Server indicating that a user of this application
(identified as ALUID_A) has requested to use ProSe for that application.
PFID_A is the ProSe Function ID of ProSe Function A. If the App Server accepts
the request, it stores the user\'s Application Layer User ID (ALUID_A) and EPC
ProSe Subscriber ID (EPSID_A) together with the PFID_A.
4\. The App Server sends a ProSe Registration Response message to ProSe
Function A indicating that the registration was successful (or not).
5\. ProSe Function A sends Application Registration Response (Allowed Range)
message to UE A indicating that the registration was successful (or not). The
Allowed Range parameter contains the set of range classes that are allowed for
this application.
5.x.5 Proximity Request
In order to request that it be alerted when it enters proximity with user B,
UE A triggers the Proximity Request procedure, as illustrated in Figure
5.x.5-1.
Figure 5.x.5-1: Proximity Request
1\. UE A sends a Proximity Request (EPSID_A, Application ID, ALUID_A, ALUID_B,
window, Range, A\'s location, [WLAN indication]) message to ProSe Function A.
The Application ID parameter identifies the 3rd party App Server platform.
ALUID_A and ALUID_B are the Application Layer User IDs for users A and B,
respectively. The window parameter indicates the time period during which the
request is valid. Range is a requested range class for this application chosen
from the set of allowed range classes. A\'s location is the current location
of UE A with the best accuracy known by UE A. UE A may optionally request EPC
support for WLAN direct discovery and communication with UE B by adding the
WLAN indication.
2\. ProSe Function A sends a Map Request (ALUID_A, ALUID_B) message to the App
Server, requesting that it provide the EPC ProSe Subscriber ID for the
targeted user B. ProSe Function A stores the Application Layer User IDs
(ALUID_A and ALUID_B) until the execution of the Proximity Alert procedure
described in clause 4.3.x.6.6 or until the expiry of the time window during
which the request is valid.
3\. The App Server checks user B\'s application-specific ProSe permissions,
confirms that user A is allowed to discover user B, and sends a Map Response
(EPSID_B PFID_B) message to ProSe Function A indicating user B\'s EPC ProSe
Subscriber ID (EPSID_B) as well as the ProSe Function ID of ProSe Function B
(PFID_B),
4\. ProSe Function A propagates the Proximity Request (EPSID_B, EPSID_A,
window, A\'s location, [WLLID_A]) message to ProSe Function B, indicating a
location update periodicity, trigger or both. A\'s location is the current
location of UE A provided in step 1 expressed in in GAD shapes defined in TS
23.032 [y]. WLAN indication is included if UE A has requested EPC support for
WLAN direct discovery and communication in step 1.
5\. Based on EPSID_B received in the previous step, ProSe Function B retrieves
subscriber B\'s record. ProSe Function B may request UE B\'s last known
location via the HSS using the Sh functionality for UE location query (step
5a). The request may indicate that the initiation of active location retrieval
is not required. Based on the last known location of UE B obtained via the HSS
and UE A\'s location and time window provided by ProSe Function A in step 4,
ProSe Function B may determine that the users are unlikely to enter proximity
within the requested time window and cancel the procedure by sending a Cancel
Proximity Request message towards UE A with an appropriate cause value (steps
5b and 5c).
6a. Depending on UE B\'s ProSe profile, UE B may be asked to confirm
permission for the proximity request (e.g. user B may have temporarily
disabled the ProSe function on UE B).
6b. In IMS deployments, ProSe Function B can confirm UE B\'s Presence status,
ProSe authorization status and other related information from the IMS.
7\. ProSe Function B requests location reporting on UE B from SLP B and
acknowledges the proximity request to ProSe Function A and provides UE B\'s
current location (if known). The WLAN Link Layer ID of UE B (WLLID_B) is
included if UE A has requested EPC support for WLAN direct discovery and
communication in step 1 and if UE B uses a permanent WLAN Link Layer ID.
8\. ProSe Function A requests location reporting on UE A from SLP A. If UE
A\'s current location is available and if UE B\'s location was included in
step 6, ProSe Function A may decide to cancel the Proximity Request procedure
if it determines that the UEs are unlikely to enter proximity within the
requested time window. Otherwise ProSe Function A acknowledges the proximity
request to UE A.
5.x.6 UE Location Reporting
SLP A and SLP B configure UE A and UE B, respectively, to report their
locations periodically, based on a trigger, or a combination of both depending
on what ProSe Function A and ProSe Function B requested (see Figure 5.x.6-1).
Figure 5.x.6-1: UE location reporting
1-4. The locations of UE A and UE B are reported to their corresponding ProSe
Servers intermittently.
NOTE 1: If UE is engaged in multiple concurrent proximity request procedures,
the location reports are grouped together by the SLP.
NOTE 2: The UE location reporting procedure is executed until the time window
expires even if UE B \"unfriends\" UE A at application layer in the middle of
an active proximity request.
5\. Assuming that ProSe Function A is in charge of determining proximity,
ProSe Function B forwards UE B\'s location to ProSe Function A periodically,
based on a trigger criterion, or a combination of both as requested by ProSe
Function A. The UE location information exchanged between ProSe Functions are
expressed in GAD shapes defined in TS 23.032 [y]. ProSe Function A may decide
to cancel the Proximity Request procedure if it determines that the UEs are
unlikely to enter proximity within the requested time window.
5.x.7 Proximity Alert
When the UEs enter into proximity, the network triggers the Proximity Alert
procedure, as illustrated in Figure 5.x.7-1.
Figure 5.x.7-1: Proximity Alert
1-3. The location of UE B is reported to ProSe Function B, which forwards it
to ProSe Function A.
4\. ProSe Function A detects that the two UEs are in proximity based on the
requested discovery range class and alerts UE A by sending a Proximity Alert
(ALUID_B, Assistance Information) message. ALUID_B is the Application Layer
User ID of user B. The message optionally includes Assistance Information for
WLAN direct discovery and communications with UE B. ProSe Function A cancels
location reporting on UE A from SLP A.
5\. ProSe Function A also requests ProSe Function B to send a Proximity Alert
(ALUID_A, Assistance Information) message to UE B. ALUID_A is the Application
Layer User ID of user A. The message optionally includes Assistance
Information for WLAN direct discovery and communication with UE A. ProSe
Function B cancels location reporting on UE B from SLP B.
NOTE 1: The WLAN interface in the UE need not be turned on before step 6 in
Figure 5.x.7-1.
NOTE 2: The assistance information is designed to expedite WLAN direct
discovery and communication. The content of the assistance information depends
on the technology used on the WLAN direct link. All the content in the
assistance information is dynamically generated by ProSe Function A, with the
exception of WLLID_B in case UE B supports only permanent WLLID.
5.x.8 UE deregistration for ProSe
5.x.8.1 General
At any time the ProSe Function may decide to deregister the UE with an
appropriate cause. The UE deregistration for ProSe can be performed natively
or via the IMS.
5.x.8.2 UE deregistration for ProSe
Depicted in Figure 5.x.8.2-1 is the native procedure for UE deregistration for
ProSe.
Figure 5.x.8.2-1: UE deregistration for ProSe
1\. At any time the ProSe Function may decide to deregister the UE by sending
a UE Deregistration Request (EPSID_A, cause) message.
2\. UE acknowledges the deregistration request by sending a UE Deregistration
Response message.
5.x.8.3 UE deregistration for ProSe Function through IMS
Depicted in Figure 5.x.8.3-1 is the procedure for UE deregistration for ProSe
via the IMS.
Figure 5.x.8.3-1: UE deregistration for ProSe through IMS
1\. At any time ProSe Function may decide to de-register the UE by sending UE
Deregistration Request message to IMS.
2\. IMS procedures informing the UE of UE deregistration for ProSe.
3\. Acknowledgment of the procedure is sent from IMS to ProSe Function.
5.x.9 Proximity Request Cancellation
UE A may decide to cancel Proximity Request it sent earlier for example, due
to change in its location, termination of corresponding application or due to
completion of certain event. In order to cancel Proximity Request, UE A
triggers procedure as illustrated in figure 5.x.9-1.
Figure 5.x.9-1 Proximity Request Cancellation
1\. UE A sends Cancel Proximity Request (EPSID_A, Application ID, ALUID_B) to
ProSe Function A.
2\. ProSe Function A propagates the cancel Proximity Request(EPSID_B, EPSID_A)
message to ProSe Function B.
3\. ProSe Function A cancels location reporting on UE A from SLP A
4-5. ProSe Function B cancels location reporting on UE B from SLP B and
acknowledges the proximity request cancellation to ProSe Function A.
6\. ProSe Function A acknowledges proximity request cancellation to UE A.
###### ### Annex J: ProSe direct communication one-to-many (decentralised
mode)
This annex is a temporary placeholder for the endorsed solution for ProSe
direct communication one-to-many (decentralised mode).
The description in this annex uses the same clause numbering as the ProSe
technical specification (TS 23.303) and the text in each clause below targets
the corresponding clause in TS 23.303. It is agreed that the contents of this
annex shall be moved to TS 23.303.
2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[x2] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[x3] RFC 4862: \"IPv6 Stateless Address Autoconfiguration\".
3 Definitions and abbreviations
3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
**ProSe direct communication** : A communication between two or more UEs in
proximity that are ProSe-enabled, by means of user plane transmission using
E-UTRA technology via a path not traversing any network node.
**ProSe-enabled UE:** A UE that supports ProSe requirements and associated
procedures. Unless explicitly stated otherwise, a ProSe-enabled UE refers both
to a non-public safety UE and a public safety UE.
**ProSe-enabled Public Safety UE:** A ProSe-enabled UE that also supports
ProSe procedures and capabilities specific to Public Safety.
**ProSe-enabled non-public safety UE** : A UE that supports ProSe procedures
and but not capabilities specific to public safety.
**Source Layer-2 ID** : A link-layer identity that uniquely identifies a
device that originates ProSe communication frames.
**Destination Layer-2 ID** : A link-layer identity that uniquely identifies a
device or a group of devices that are recipients of ProSe communication
frames.
**ProSe Layer-2 Group ID** : A pre-configured layer-2 group identifier that
may be used to address a set of users at the 3GPP lower layers. It is
typically associated with a ProSe Application ID.
3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
ProSe Proximity-based Services
PSB ProSe Bearer Service
4 Architecture Model and Concepts
4.1 General Concept
Editor\'s note: This clause will describe the overall concept of ProSe e.g. a
short description of the features supported.
[...]
4.1.2 Direct communication one-to-many (decentralised mode)
Direct communication one-many (decentralised mode) is applicable to Public
Safety UEs only and can apply when the UE is served by E-UTRA or not, if
authorised.
Direct communication one-many (decentralised mode) has the following
characteristics:
\- One-to-many communication decentralised mode is connectionless. Thus there
is no over PC5 control plane signalling.
\- There is no QoS support apart from priority handling.
\- The user plane interface to the D2D radio layer is IP packets carried over
radio bearers.
\- Members of a group share a secret from which a group security key may be
derived to encrypt all user data for that group. Only group members will be
able to decrypt the user data as only they will possess the group secret.
\- Authorisation for Direct communication one-to-many (decentralised mode) is
pre-configured in the UE by the ProSe Function using PC3c reference point.
\- ProSe UE configuration parameters (e.g. including ProSe Group IP multicast
addresses, ProSe Group IDs, Group security material, radio related parameters)
are be pre-configured in the UE, as defined by procedures defined in this
document.
4.2 Architectural Reference Model
Editor\'s note: This clause will describe the high-level non-roaming and
roaming architecture for ProSe.
Figure 4.2-1 shows the high level view of the non-roaming architecture.
Figure 4.2-1: Non-Roaming Reference Architecture
The following figure 4.2-2 shows the high level view of the roaming
architecture.
Figure 4.2-2: Inter-PLMN Reference Architecture
Figure 4.2-3: Roaming Reference Architecture
EPC here represents the E-UTRAN Core Network architecture as represented in TS
23.401 [x2].
Editor\'s note: How EPC \"box\" maps to the different nodes inside EPC needs
to be updated.
More details on the different instantiations of the reference points to
interfaces to the different EPC network nodes is provided in other clauses.
4.3 Reference points
Editor\'s note: This clause will list the reference points that will be
defined to support ProSe.
4.3.1 General
4.3.2 List of Reference Points
**PC1** : It is the reference point between the ProSe application in the UE
and in the ProSe App Server. It is used to define application level signalling
requirements. This interface is out of scope of 3GPP in this release of the
specification.
**PC2** : It is the reference point between the ProSe Application Server and
the ProSe Function. It is used to define the interaction between ProSe App
Server and ProSe functionality provided by the 3GPP EPS via ProSe Function.
This interface is out of scope of 3GPP in this release of the specification.
**PC3a** : (as defined for EPC-level discovery)
**PC3b** : It is the reference point between the UE and ProSe Function that is
used to authorise direct discovery requests, and perform allocation of ProSe
Application Codes and ProSe Application Identities used for direct discovery.
**PC3c** : It is the reference point between the UE and ProSe Function. It is
used to define the authorisation policy per PLMN for ProSe direct discovery
(for Public Safety and non Public Safety) and communication (for Public Safety
only) between UE and ProSe Function. In case of Public Safety it is also used
to provision parameters in the PMCE that are needed when the UE is not
\"served by E-UTRA\".
**PC4a** : It is the reference point between the HSS and ProSe Function. It is
used to provide subscription information in order to authorise access for
direct services in a PLMN.
**PC4b** : It is the reference point between the HSS and ProSe Function. It is
used to provide subscription information in order to allow the ProSe Function
to authorise direct discovery requests.
**PC4c** : (defined for EPC-level discovery)
**PC4d** : (defined for EPC-level discovery)
Editor\'s note: Depending on the function needed, PC4 and PC7 may terminate in
different EPC entities and may reuse existing interfaces. This will be further
defined as work progresses.
**PC5** : It is the reference point between UE to UE directly used for control
and user plane for direct discovery and communication.
**PC6b** : It is the reference point between the ProSe Functions in different
PLMN (when not roaming) and the ProSe Function in the HPLMN. It is used to
authorise direct discovery requests, and perform allocation of ProSe
Application Identity Codes and ProSe Application Identity Names from the
HPLMN.
**PC6c** : It is the reference point between the ProSe Functions in different
PLMN (when not roaming) and the ProSe Function in the HPLMN. It is used for
HPLMN control of ProSe service authorization.
**PC7b** : It is the reference point between the ProSe Function in the VPLMN
or ProSe Functions in different PLMN (when roaming) and the ProSe Function in
the HPLMN. It is used to authorise direct discovery requests, and perform
allocation of ProSe Application Identity Codes and ProSe Application Identity
Names from the HPLMN.
**PC7c** : It is the reference point between the ProSe Function in the VPLMN
or ProSe Functions in different PLMN (when roaming) and the ProSe Function in
the HPLMN. It is used for HPLMN control of ProSe service authorization.
**SGi** : In addition to the relevant functions defined in TS 29.061 [10] via
SGi, it may be used for application data and application level control
information exchange.
4.4 Network Elements
4.4.1 General
4.4.2 ProSe Function
The ProSe Function is the logical function that is used for network related
actions required for ProSe. The ProSe Function plays different roles for each
of the features of ProSe.
Figure 4.4.2-1: UE to ProSe Function Interfaces for each sub-function
Figure 4.4.2-2: ProSe Function Interfaces to other network elements and PLMNs
The ProSe Function consists of three main sub-functions that perform different
roles depending on the ProSe feature:
\- Direct Provisioning Function (DPF) is used to provision the UE with
necessary parameters in order use ProSe direct services. It is used to
provision the UEs with PLMN specific parameters that allow the UE to use ProSe
in this specific PLMN. For direct communication used for Public Safety DPF is
also used to provision the UE with parameters that are needed when the UE is
not \"served by E-UTRA\".
\- Direct Discovery Name Management Server is used for open direct discovery
to allocate and process the mapping of ProSe Applications IDs and ProSe
Application Codes used in direct discovery. It uses ProSe related subscriber
data stored in HSS for authorisation for each discovery request. It also
provides the UE with the necessary security material in order to protect
discovery messages transmitted over the air.
\- EPC-level ProSe Function is used ...
ProSe Function provides the necessary charging functionality for usage of
ProSe (via the EPC or for direct services).
4.4.3 UE
The ProSe capable UE supports the following functions:
\- 1-to-many direct communication over PC5.
\- Direct discovery of other ProSe capable UEs over PC5.
\- May act as a ProSe UE-to-Network relay. The remote ProSe UE communicates
with the ProSe UE-to-Network relay over PC5. The ProSe UE-to Network relay
uses layer-3 packet forwarding.
\- Exchange of control information between ProSe UEs over PC5, e.g. for UE-to-
Network relay detection and direct discovery.
\- Exchange of ProSe control information between ProSe UE and the ProSe
Function over the user plane over PC3/PC8. In the UE-to-NW Relay case the
remote ProSe UE will send this control information over PC5 user plane to be
relayed over the LTE-Uu interface towards the ProSe Function.
\- Configuration of parameters (e.g. including IP addresses, Group IDs, Group
security material, radio resource parameters). These can be pre-configured in
the UE, or done by signalling over the PC3/PC8 reference point to the ProSe
Function in the network if in coverage.
4.5 High Level Function
Editor\'s note: This section explains the high level functions (e.g. charging,
triggering, etc.) for ProSe.
4.5.1 Provisioning for direct discovery and communication
4.5.1.1 Authorization and provisioning for ProSe
The basic principles of service authorization for ProSe direct discovery and
communication are as follows:
\- UE gets authorization from HPLMN for using direct discovery in certain
PLMNs per country. These PLMNs are called local PLMNs and their ProSe
Functions, local ProSe Functions. The authorisation policy can authorise the
UE from HPLMN to use discovery in local PLMN without need to contact these
PLMN first, conditionally authorise the UE requiring to also receive
authorisation from the ProSe Functions of local PLMNs or not authorise the UE
at all.
NOTE 1: The UE does not need to be registered in local PLMNs to get
authorization (if required) from local ProSe Functions since authorisation is
performed \"over IP\".
\- If the UE is required to get authorisation from local ProSe Functions, it
accesses local ProSe Functions to get PLMN specific Authorisation Information;
these ProSe Functions include the one of the registered PLMN those of other
local PLMNs (of that specific country).
\- In that case, the local ProSe Function always contacts the ProSe Function
in HPLMN to check authorization and consolidates the authorization info. Final
authorization info always comes from local ProSe Functions.
The authorization can be revoked at any point by any of the local ProSe
Functions or the ProSe Function in HPLMN if the UE is de-authorized to use to
use ProSe either from the local PLMN or HPLMN.
OMA DM is used as the protocol to authorise the UE via the PC3c reference
point.
4.5.1.1.1 Provisioning information for ProSe direct services
The following information can be contained in the authorisation info that is
provided by the ProSe Function to the UE for authorisation of using direct
services in a particular PLMN.
NOTE: For Public Safety usage the operator is able to pre-configure Public
Safety UEs (e.g. in the USIM or ME) with the required provisioning parameters
for ProSe direct services, without the need for the Public Safety UEs to
connect to the ProSe Function to get this initial configuration.
4.5.1.1.1.2 Provisioning for direct discovery and communication (Public Safety
UE)
The contents of this section are applicable to Public Safety UEs only.
4.5.1.1.1.2.1 Additional provisioning information for direct discovery
In addition to the parameters indicated in clause 4.5.1.1.1.1, the Public
Safety UE is provisioned with the following information:
1) Authorisation policy when the UE is \"not served by E-UTRA\"
\- Indicates whether the UE is authorised to perform direct discovery when
\"not served by E-UTRA\".
2) Radio parameters container for when the UE is \"not served by E-UTRA\"
\- Includes the radio parameters that need to be configured in the UE in order
to be able perform direct discovery procedures when not \"served by E-UTRA\".
This includes e.g. frequency bands etc.
NOTE: More details on the necessary parameters will be defined in RAN
specifications.
4.5.1.1.1.2.2 Provisioned information for direct communication one-to-many
The following information is provisioned to the UE for direct communication:
1) Authorisation policy
When the UE is \"served by E-UTRA\":
\- PLMNs that the UE is authorised to perform direct communication one-to-many
\- For each PLMN in the list also indicate whether the UE is pre-authorised by
HPLMN to perform direct communication one-to-many or it is conditionally
authorised, in which case the UE would need to contact the ProSe Functions of
these PLMNs (when it is in this country) in order to obtain authorisation.
When the UE is \"not served by E-UTRA\":
\- Indicates whether the UE is authorised to perform one-to-many communication
procedures when \"not served by E-UTRA\"
2) Direct communication policy/parameters
\- Includes the identifiers that allow the UE to perform one-to-many
communication:
\- ProSe Layer-2 Group ID;
\- ProSe Group IP multicast address
\- Indication whether the UE should use IPv4 or IPv6 for the specific group
[...]
3) Radio parameters container for when the UE is \"not served by E-UTRA\"
\- Includes the radio parameters that need to be configured in the UE in order
to be able perform direct communication one-to-many procedures when \"not
served by E-UTRA\". This includes e.g. frequency bands etc.
NOTE: More details on the necessary parameters will be defined in RAN
specifications.
4) Security container
\- Includes any security related content that need to be configured in the UE
in order to be able perform direct communication one-to-many procedures when
\"not served by E-UTRA\".
NOTE: More details on the necessary parameters will be defined in SA WG3
specifications.
Editor\'s note: SA WG3 will also assess whether it is necessary to provision
any security parameters from DPF.
Editor\'s note: It is FFS which of these parameters are provisioned from the
PLMN and which from 3rd party Public Safety provider.
4.5.3 IP address allocation
For ProSe one-to-many communication (decentralised mode):
\- when the UE is configured to use IPv6 on the direct link, the UE auto-
configures a link local IPv6 Address following procedures defined in RFC 4862
[x3]. This address can be used as source IP address for direct communication
one-to-many only.
[...]
4.6.2 Identifiers for direct communication
4.6.2.1 ProSe UE ID
It is a unique link layer identifier assigned by the EPS and uniquely
represents the UE in the context of ProSe communication. It is used as a
Source or Destination Layer-2 ID in all the packets the UE sends for ProSe
direct communication.
[...]
4.6.2.2 ProSe Layer-2 Group ID
It is a unique link layer identifier uniquely represents the group in the
context of ProSe direct communication one-to-many (decentralised mode). It is
used as a Destination Layer-2 ID in all the packets the UE sends to this
group.
5.2 Service authorisation for ProSe direct services
Figure 5.2-1: Service authorisation for ProSe direct services
The UE gets the service authorisation for direct services (i.e. direct
discovery and/or communication) from the ProSe Functions of HPLMN and
optionally from local PLMNs. The authorisation is happening using \"over IP\"
mechanisms and only IP connectivity is required to allow the UE to access this
ProSe Function.
In this signalling flow the following steps are performed:
Step 0: HPLMN configures UE with PLMN list that support direct services.
Step1\~3: If the UE is conditionally authorised for direct services for local
PLMNs, the UE contacts the local ProSe Functions to receive authorization info
applicable to this PLMN. The address of the ProSe Function in local PLMN, can
either be provided from HPLMN or self-constructed by the UE e.g. derived from
PLMN id of the local PLMN.
Editor\'s note: The mechanism to authenticate and verify authorization of the
UE in each ProSe Function will be defined by SA WG3.
Step 4: The local ProSe Function obtains authorization info from HPLMN and
merges with own policy.
Step 5: Local ProSe Function provides authorisation info to UE. This
authorisation info applies to this PLMN. The UE stores the authorisation
information obtained from local ProSe Function in a secure way. If needed at
any point the authorization can be revoked by the Local ProSe Function or
ProSe Function in the HPLMN e.g. by sending an OMA DM push message.
5.4 Procedures for direct communication
5.4.1 Direct communication one-to-many (decentralized mode) transmitter
This procedure is applicable to authorized ProSe-enabled Public Safety UEs
that are authorised to transmit.
Figure 5.4.1-1: Direct one-to-many communication (decentralised mode)
transmitter
1\. UE is configured with the related information for one-to-many
communication as defined in clause 4.5.1.1.1.2.2. The UE obtains the necessary
group context (ProSe Layer-2 Group ID, ProSe Group IP multicast address) to
transmit IP-layer transport of data, and also the radio resource used for the
direct communication.
2\. The originating UE finds the appropriate radio resource to conduct one-to-
many communication. If the UE is \"served by E-UTRA\" it always uses the
resources signalled from the network. If the UE is not \"served by E-UTRA\" it
uses the appropriate radio resources for this purpose.
NOTE: More details about step 2 to be defined in RAN WGs.
3\. The originating UE sends the IP data to the IP multicast address, and the
ProSe Layer-2 Group ID as Destination Layer-2 ID.
5.4.2 Direct communication one-to-many (decentralized mode) receiver
This procedure is only applicable to authorized ProSe-enabled Public Safety
UEs that are authorised to receive.
Figure 5.4.2-1: Direct one-to-many communication (decentralised mode) receiver
1\. UE is configured with the related information for one-to-many
communication as defined in clause 4.5.1.1.1.2.2. The UE obtains the necessary
group context (ProSe Layer-2 Group ID, Group IP multicast address) to receive
IP-layer transport of data, and also the radio resource used for the direct
communication.
2\. The receiving UE finds the appropriate radio resource to conduct one-to-
many communication. If the UE is \"served by E-UTRA\" it always uses the
resources signalled from the network. If the UE is not \"served by E-UTRA\" it
uses the appropriate radio resources for this purpose.
NOTE: More details about step 2 to be defined in RAN WGs.
3\. The receiving UE filters out the received packet based on the ProSe
Layer-2 Group ID contained in the Destination Layer-2 ID and if it matches the
Group IDs configured, delivers the packet to upper layers. The user plane
packets will be delivered to the IP stack that filters the packets based on
the Group IP multicast address.
###### ### Annex K: ProSe UE-to-Network Relays
This annex is a temporary placeholder for the endorsed solution for ProSe UE-
to-Network Relays.
The description in this annex uses the same clause numbering as the ProSe
technical specification (TS 23.303) and the text in each clause below targets
the corresponding clause in TS 23.303. It is agreed that the contents of this
annex shall be moved to TS 23.303.
2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[x2] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[x3] IETF RFC 4862: \"IPv6 Stateless Address Autoconfiguration\".
[x4] IETF RFC 2131: \"Dynamic Host Configuration Protocol\".
[x5] IETF RFC 4039: \"Rapid Commit Option for the Dynamic Host Configuration
Protocol version 4 (DHCPv4)\".
[x6] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[x7] IETF RFC 4861: \" Neighbor Discovery for IP version 6 (IPv6)\".
[x8] 3GPP TS 23.221: \"Architectural requirements\".
[x9] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[...]
4.1.1.1 Direct discovery models
The following models for direct discovery exist:
**Model A (\"I am here\")**
This model defines two roles for the UEs that are participating in direct
discovery.
\- Announcing UE: The UE announces certain information that could be used from
UEs in proximity that have permission to discover.
\- Monitoring UE: The UE that receives certain information that is interested
in from other UEs in proximity.
In this model the announcing UE broadcasts the discovery messages at pre-
defined discovery intervals and the UEs that are interested in these messages
read them and process them.
It is equivalent to \"I am here\" since the announcing UE would broadcast info
about itself e.g. its ProSe Application Identities or ProSe UE Identities in
the discovery message.
**Model B (\"who is there\"/\"are you there\")**
This model defines two roles for the UEs that are participating in direct
discovery.
\- **Discoverer UE:** The UE transmits a request containing certain
information about what is interested to discover.
\- **Discoveree UE:** The UE that receives the request message can respond
with some information related to the discoverer\'s request.
It is equivalent to \" who is there/are you there\" since the discoverer UE
sends info about other UEs that would like to receive responses from, e.g. the
information can be about a ProSe Application Identity corresponding to a group
and the members of the group can respond.
[...]
4.4.3 ProSe UE-to-Network Relay
ProSe UE-to-Network Relay provides the functionality to provide connectivity
for \"unicast\" services to Public Safety UEs that are not \"served by
E-UTRAN\".
Figure 4.4.3-1: ProSe UE-to-Network Relay
The ProSe UE-to-Network Relay needs to relay the unicast traffic in the UL and
DL between a UE that connects to the Relay and the network. The relay is
therefore a generic function that can relay any type of traffic that is
relevant for public safety communication.
NOTE: There is no support for relaying eMBMS traffic from Uu interface to PC5
in this release of the specification.
Un-optimised one-to-one direct communication with ProSe UE-to-Network Relays
has the following characteristics:
\- Communication with ProSe UE-to-Network Relays is connectionless.
\- ProSe Direct discovery following model A or model B can be used in order to
allow the remote UE to select a ProSe UE-to-Network Relay.
\- ProSe Direct discovery can be used in order to allow the remote UE to
discover the ProSe UE ID of the ProSe UE-to-Network Relay.
\- ProSe Direct discovery can be used in order to allow the remote UE to
discover L2 link layer address of the ProSe UE-to-Network Relay to be used by
the remote UE for IP address allocation signalling and user plane traffic
corresponding to a specific PDN connection supported by the ProSe UE-to-
Network Relay.
\- ProSe Bearers are bi-directional. IP packets passed to the radio layer on a
given radio bearer will be transmitted by the physical layer with the
associated L2 destination address. Packets passed up from the radio layer on
the same radio bearer will have been received over the air addressed to the
same L2 destination.
The ProSe UE-to-Network Relay includes the following functions:
\- Acts as an \"announcing\" or \"discoveree\" UE on the PC5 performing direct
discovery.
\- Acts as a default router to the remote UE forwarding IP packets between the
UE-ProSe UE-to-Network Relay point-to-point link and the corresponding PDN
connection.
\- Handles Router Solicitation and Router Advertisement messages as defined in
RFC 4861 [x7].
\- Acts as DHCPv4 and DHCPv6 Proxy or Server.
Editor\'s note: Procedures for ProSe UE-to-Network Relay using DHCPv4 or
DHCPv6 proxy are FFS.
\- Acts as a NAT if IPv4 is used replacing the locally assigned IPv4 address
of the remote UE with its own.
\- Maps the L2 link ID used by the remote UE as Destination Layer-2 ID to the
corresponding PDN connection supported by the UE-to-Network Relay UE.
NOTE: The aspects of the point-to-point link are defined in RAN
specifications.
4.5.1 Provisioning for direct discovery and communication
4.5.1.1 Authorization and provisioning for ProSe
The basic principles of service authorization for ProSe direct discovery and
communication are as follows:
\- UE gets authorization from HPLMN for using direct discovery in certain
PLMNs per country. These PLMNs are called local PLMNs and their ProSe
Functions, local ProSe Functions. The authorisation policy can authorise the
UE from HPLMN to use discovery in local PLMN without need to contact these
PLMN first, conditionally authorise the UE requiring to also receive
authorisation from the ProSe Functions of local PLMNs or not authorise the UE
at all.
NOTE: The UE does not need to be registered in local PLMNs to get
authorization (if required) from local ProSe Functions since authorisation is
performed \"over IP\".
\- If the UE is required to get authorisation from local ProSe Functions, it
accesses local ProSe Functions to get PLMN specific Authorisation Information;
these ProSe Functions include the one of the registered PLMN those of other
local PLMNs (of that specific country).
\- In that case, the local ProSe Function always contacts the ProSe Function
in HPLMN to check authorization and consolidates the authorization info. Final
authorization info always comes from local ProSe Functions.
The authorization can be revoked at any point by any of the local ProSe
Functions or the ProSe Function in HPLMN if the UE is de-authorized to use to
use ProSe either from the local PLMN or HPLMN.
OMA DM is used as the protocol to authorise the UE via the PC3c reference
point.
4.5.1.1.1 Provisioning information for ProSe direct services
The following information can be contained in the authorisation info that is
provided by the ProSe Function to the UE for authorisation of using direct
services in a particular PLMN.
NOTE: For Public Safety usage the operator is able to pre-configure Public
Safety UEs (e.g., in the USIM or ME) with the required provisioning parameters
for ProSe direct services, without the need for the Public Safety UEs to
connect to the ProSe Function to get this initial configuration.
4.5.1.1.1.2 Provisioning for direct discovery and communication (Public Safety
UE)
The contents of this section are applicable to Public Safety UEs only.
4.5.1.1.1.3 Additional provisioning information for direct discovery
In addition to the parameters indicated in clause 4.5.1.1.1.1, the Public
Safety UE is provisioned with the following information:
1) Authorisation policy when the UE is \"not served by E-UTRA\"
\- Indicates whether the UE is authorised to perform direct discovery when
\"not served by E-UTRA\".
2) Radio parameters container for when the UE is \"not served by E-UTRA\"
\- Includes the radio parameters that need to be configured in the UE in order
to be able perform direct discovery procedures when not \"served by E-UTRA\".
This includes e.g. frequency bands, etc.
NOTE: More details on the necessary parameters will be defined in RAN
specifications.
4.5.3 IP address allocation
[...]
For communication with ProSe UE-to-Network Relay:
\- When the ProSe UE-to-Network Relay has an established PDN connection with
PDN type IPv4:
\- The IPv4 address allocation and IPv4 parameter configuration via DHCPv4 is
performed according to RFC 2131 [x4] and RFC 4039 [x5] procedure. The IPv4
address provided to the remote UE from the ProSe UE-to-Network Relay by DHCPv4
procedure shall correspond to a local IPv4 address range configured in the
ProSe UE-to-Network Relay.
\- DHCPv4 request from the remote UE is always sent subsequent to the
discovery of the ProSe UE-to-Network Relay to the L2 link address of the Relay
corresponding to the ProSe Access Code/PDN connection the remote UE has
selected.
\- If the IPv4 address is allocated by using DHCPv4 procedure, then at any
time after the UE releases the IPv4 address using DHCPv4 or the IPv4 address
lease time expires, the same IPv4 address shall not be allocated to another
remote UE immediately by the ProSe UE-to-Network Relay.
\- When the ProSe UE-to-Network Relay has an established PDN connection with
PDN type IPv6:
\- IPv6 network prefix allocation via IPv6 Stateless Address auto-
configuration:
\- Router solicitation from the Remote UE is always sent subsequent to the
discovery of the ProSe UE-to-Network Relay to the L2 link layer ID of the
Relay corresponding to the PDN connection the remote UE has selected. The IPv6
network prefix assigned to the remote UE is sent in the Router Advertisement.
\- The IPv6 network prefix is assigned to the ProSe UE-to-Network Relay using
existing procedures described in TS 23.401[x6] and TS 23.402 [x7]. For
stateless address auto-configuration however, the UE can choose any interface
identifier to generate IPv6 address, other than link-local, without involving
the network. Any prefix that the ProSe UE-to-Network Relay will advertise to
the remote UE is unique, there is no need for the remote UE to perform
Duplicate Address Detection for global uniqueness for any IPv6 address
configured from the allocated IPv6 network prefix.
\- IPv6 parameter configuration via Stateless DHCPv6: The UE may use stateless
DHCPv6 for additional parameter configuration. The ProSe UE-to-Network Relay
acts as the DHCP server and provides the requested parameters from locally
provisioned database.
\- When the ProSe UE-to-Network Relay has an established PDN connection with
PDN type IPv4v6:
\- The IPv6 network prefix allocation via IPv6 Stateless Address auto-
configuration procedure, IPv6 parameter configuration via Stateless DHCPv6
procedure and DHCPv4 procedure are the same as for PDN type IPv6 or IPv4
defined in pervious bullets.
4.6.2 Identifiers for direct discovery
[...]
4.6.2.3 Identifiers for ProSe UE-to-Network Relay selection
The following information may be used for ProSe UE-to-Network Relay selection:
\- Message type identifier (e.g. identifying model A or model B discovery).
\- ProSe Relay (UE) ID: link layer identifier that is used for direct
communication and is associated with the PDN connection the ProSe UE-to-
Network Relay has established.
\- PLMN ID: identifies the PLMN to which the relay is connected.
\- ProSe Application Identity: parameter identifying connectivity the ProSe
UE-to-Network Relay provides. (e.g. including APN information).
\- Whether the UE can act as a relay.
\- Status/maintenance flags (e.g. indicating whether the relay is temporarily
without connectivity or battery running low so the Remote UEs can
seek/reselect another Relay).
Editor\'s note: The list of parameters needs to be reviewed.
Editor\'s note: The need for discoverer\'s ProSe UE ID when Model B is used is
FFS.
Editor\'s note: It is FFS if additional parameters are needed in order to
protect the discovery message (e.g. restricted discovery).
4.6.2 Identifiers for direct communication
4.6.2.1 ProSe UE ID
It is a unique link layer identifier assigned by the EPS and uniquely
represents the UE in the context of ProSe communication. It is used as a
Source or Destination Layer-2 ID in all the layer-2 frames the UE sends for
ProSe direct communication.
For support of multiple PDN connections, the ProSe UE-to-Network Relay assigns
a different ProSe UE ID for each PDN connection.
[...]
5.2 Service authorisation for ProSe direct services
Figure 5.2-1: Service authorisation for ProSe direct services
The UE gets the service authorisation for direct services (i.e. direct
discovery and/or communication) from the ProSe Functions of HPLMN and
optionally from local PLMNs. The authorisation is happening using \"over IP\"
mechanisms and only IP connectivity is required to allow the UE to access this
ProSe Function.
In this signalling flow the following steps are performed:
Step 0: HPLMN configures UE with PLMN list that support direct services.
Step1\~3: If the UE is conditionally authorised for direct services for local
PLMNs, the UE contacts the local ProSe Functions to receive authorization info
applicable to this PLMN. The address of the ProSe Function in local PLMN, can
either be provided from HPLMN or self-constructed by the UE e.g. derived from
PLMN id of the local PLMN.
Editor\'s note: The mechanism to authenticate and verify authorization of the
UE in each ProSe Function will be defined by SA WG3.
Step 4: The local ProSe Function obtains authorization info from HPLMN and
merges with own policy.
Step 5: Local ProSe Function provides authorisation info to UE. This
authorisation info applies to this PLMN. The UE stores the authorisation
information obtained from local ProSe Function in a secure way. If needed at
any point the authorization can be revoked by the Local ProSe Function or
ProSe Function in the HPLMN e.g. by sending an OMA DM push message.
5.4.3 Direct communication via ProSe UE-to-Network Relay
5.4.3.1 IPv6 Stateless Address auto-configuration
Figure 5.4.3.1-1: Direct communication via ProSe UE-to-Network Relay (IPv6
prefix allocation)
1\. The ProSe UE-to-Network Relay attaches to the network and obtains IPv6
prefix from the network. It may optionally in addition establish an additional
number of PDN connections.
2\. The ProSe UE-to-Network Relay following model A or model B discovery can
provide information assisting the remote UE to perform \"relay selection\"
e.g. if more than one relays announces in proximity. The ProSe UE-to-Network
Relay also indicates whether it supports the ability to receive signalling
from the remote UE.
Editor\'s note: It is FFS whether there is a need for control plane signalling
between the remote UE and ProSe UE-to-Network Relay in order to establish a
security association between the remote UE and the ProSe UE-to-Network Relay.
3\. The remote UE uses the received relay selection information to select the
UE-to-Network Relay and the PDN connection it wants to connect.
4\. If the PDN type associated with the PDN connection is IPv4v6 or IPv6 and
the remote UE is configured to perform IPv6 Stateless Address auto-
configuration, the remote UE shall send a Router Solicitation message to the
network to the Layer-2 link ID of the Relay corresponding to the PDN
connection the remote UE has selected, in order to solicit a Router
Advertisement message. The message is sent using as Destination Layer-2
Address the ProSe UE ID of the ProSe UE-to-Network Relay discovered in step 2.
5\. Upon receiving the Route Solicitation message from the UE the ProSe UE-to-
Network Relay shall send an IPv6 Router Advertisement message as specified in
IETF RFC 4862 [x3] to the UE for PDN connection type IPv4v6 or IPv6 (i.e. the
ProSe UE-to-Network Relay acts as an advertising interface as specified in
IETF RFC 4861 [x7] for the PDN connection type IPv4v6 or IPv6). The Router
Advertisement messages shall contain the assigned IPv6 prefix received during
the establishment of the PDN connection selected by the remote UE. After the
remote UE receives the Router Advertisement message, it constructs a full IPv6
address via IPv6 Stateless Address auto-configuration in accordance with IETF
RFC 4862 [x3]. However, the remote UE shall not use any identifiers defined in
TS 23.003 [x9] as the basis for generating the interface identifier. For
privacy, the remote UE may change the interface identifier used to generate
the full IPv6 address, as defined in TS 23.221 [x8] without involving the
network. The remote UE shall use the auto-configured IPv6 address while
sending packets in this implicitly created PDN connection.
5.4.3.2 IPv4 Address allocation using DHCPv4
Figure 5.4.3.2-1: Direct communication via ProSe UE-to-Network Relay (using
DHCPv4)
1-3. As in clause 5.4.3.1.
  1. If the PDN type associated with the PDN connection is IPv4v6 or IPv4 and the remote UE is configured to perform DHCPv4, the remote UE shall send DHCPv4 Discovery message. The message shall be sent using as Destination Layer-2 Address the ProSe UE ID of the ProSe UE-to-Network Relay discovered in step 2.
  2. The ProSe UE-to-Network Relay acting as a DHCPv4 Server sends the DHCPv4 Offer with the assigned remote UE IPv4 address corresponding to the PDN connected selected by the remote UE.
  3. When the remote UE receives the lease offer, it sends a DHCP REQUEST message containing the received IPv4 address.
  4. The ProSe UE-to-Network Relay acting as DHCPv4 server sends a DHCPAck packet to the remote UE. This message includes the lease duration and any other configuration information that the client might have requested.
When receiving the DHCPAck message, the remote UE completes TCP/IP
configuration process.
NOTE : The DHCPv4 client may skip DHCPv4 Discovery phase, and send DHCPv4
Request message in broadcast as the first message.
###### ### Annex L: ProSe direct discovery
This annex is a temporary placeholder for the endorsed solution for ProSe
direct discovery.
The description in this annex uses the same clause numbering as the ProSe
technical specification (TS 23.303) and the text in each clause below targets
the corresponding clause in TS 23.303. It is agreed that the contents of this
annex shall be moved to TS 23.303.
2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[x2] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
3 Definitions and abbreviations
3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
**ProSe-enabled UE:** A UE that supports ProSe requirements and associated
procedures. Unless explicitly stated otherwise, a ProSe-enabled UE refers both
to a non-public safety UE and a public safety UE.
**ProSe-enabled Public Safety UE:** A ProSe-enabled UE that also supports
ProSe procedures and capabilities specific to Public Safety.
**ProSe-enabled non-public safety UE** : A UE that supports ProSe procedures
and but not capabilities specific to public safety.
**ProSe direct discovery:** A procedure employed by a ProSe-enabled UE to
discover other ProSe-enabled UEs in its vicinity by using only the
capabilities of the two UEs with rel.12 E-UTRA technology.
3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
ProSe Proximity-based Services
TTL Time to Live
4 Architecture Model and Concepts
4.1 General Concept
Editor\'s note: This clause will describe the overall concept of ProSe e.g. a
short description of the features supported.
4.1.1 Direct discovery
ProSe discovery is defined as the process that identifies another UE in
proximity using E-UTRA direct radio signals.
There are two types of discovery: open and restricted. Open is the case where
there is no explicit permission that is needed from the UE being discovered,
whereas restricted discovery only takes place with explicit permission from
the UE that is being discovered.
ProSe direct discovery can be a standalone service enabler that could for
example use information from the discovered UE for certain applications in the
UE that are permitted to use this information e.g. \"find a taxi nearby\",
\"find me a coffee shop\". Additionally depending on the information obtained
ProSe discovery can be used for subsequent actions e.g. to initiate direct
communication.
The UE can act as \"announcing UE\" only in the band designated by the serving
PLMN but act as a \"monitoring\" UE also in the resources of other PLMN(s) in
the same area if authorised. These PLMNs are called local PLMNs.
ProSe-enabled non-Public Safety UEs which have obtained authorization to
participate in discovery procedures shall not continue in participating in
discovery procedures as soon as they detect loss of E-UTRA coverage in the
serving PLMN.
4.2 Architectural Reference Model
Editor\'s note: This clause will describe the high-level non-roaming and
roaming architecture for ProSe.
Figure 4.2-1 shows the high level view of the non-roaming architecture.
Figure 4.2-1: Non-Roaming Reference Architecture
Figure 4.2-2 shows the high level view of the roaming architecture.
Figure 4.2-2: Inter-PLMN Reference Architecture
Figure 4.2-3: Roaming Reference Architecture
EPC here represents the E-UTRAN Core Network architecture as represented in TS
23.401 [x2].
Editor\'s note: How EPC \"box\" maps to the different nodes inside EPC needs
to be updated.
More details on the different instantiations of the reference points to
interfaces to the different EPC network nodes is provided in other clauses.
4.3 Reference points
Editor\'s note: This clause will list the reference points that will be
defined to support ProSe.
4.3.1 General
4.3.2 List of Reference Points
**PC1** : It is the reference point between the ProSe application in the UE
and in the ProSe App Server. It is used to define application level signalling
requirements. This interface is out of scope of 3GPP in this release of the
specification.
**PC2** : It is the reference point between the ProSe Application Server and
the ProSe Function. It is used to define the interaction between ProSe App
Server and ProSe functionality provided by the 3GPP EPS via ProSe Function.
This interface is out of scope of 3GPP in this release of the specification.
**PC3a** : (as defined for EPC-level discovery).
**PC3b** : It is the reference point between the UE and ProSe Function that is
used to authorise direct discovery requests, and perform allocation of ProSe
Application Codes and ProSe Application Identities used for direct discovery.
**PC3c** : It is the reference point between the UE and ProSe Function. It is
used to define the authorisation policy per PLMN for ProSe direct discovery
(for Public Safety and non Public Safety) and communication (for Public Safety
only) between UE and ProSe Function.
**PC4a** : It is the reference point between the HSS and ProSe Function. It is
used to provide subscription information in order to authorise access for
direct services in a PLMN.
**PC4b** : It is the reference point between the HSS and ProSe Function. It is
used to provide subscription information in order to allow the ProSe Function
to authorise direct discovery requests.
**PC4c** : (defined for EPC-level discovery).
**PC4d** : (defined for EPC-level discovery).
Editor\'s note: Depending on the function needed, PC4 and PC7 may terminate in
different EPC entities and may reuse existing interfaces. This will be further
defined as work progresses.
**PC5** : It is the reference point between UE to UE directly used for control
and user plane for direct discovery and communication.
**PC6b** : It is the reference point between the ProSe Functions in different
PLMN (when not roaming) and the ProSe Function in the HPLMN. It is used to
authorise direct discovery requests, and perform allocation of ProSe
Application Identity Codes and ProSe Application Identity Names from the
HPLMN.
**PC6c** : It is the reference point between the ProSe Functions in different
PLMN (when not roaming) and the ProSe Function in the HPLMN. It is used for
HPLMN control of ProSe service authorization.
**PC7b** : It is the reference point between the ProSe Function in the VPLMN
or ProSe Functions in different PLMN (when roaming) and the ProSe Function in
the HPLMN. It is used to authorise direct discovery requests, and perform
allocation of ProSe Application Identity Codes and ProSe Application Identity
Names from the HPLMN.
**PC7c** : It is the reference point between the ProSe Function in the VPLMN
or ProSe Functions in different PLMN (when roaming) and the ProSe Function in
the HPLMN. It is used for HPLMN control of ProSe service authorization.
**SGi** : In addition to the relevant functions defined in TS 29.061 [10] via
SGi, it may be used for application data and application level control
information exchange.
4.4 Network Elements
4.4.1 General
4.4.2 ProSe Function
The ProSe Function is the logical function that is used for network related
actions required for ProSe. The ProSe Function plays different roles for each
of the features of ProSe.
Figure 4.4.2-1: UE to ProSe Function Interfaces for each sub-function
Figure 4.4.2-2: ProSe Function Interfaces to other network elements and PLMNs
The ProSe Function consists of three main sub-functions that perform different
roles depending on the ProSe feature:
\- Direct Provisioning Function (DPF) is used to provision the UE with
necessary parameters in order use ProSe direct services. It is used to
provision the UEs with PLMN specific parameters that allow the UE to use ProSe
in this specific PLMN. For direct communication used for Public Safety DPF is
also used to provision the UE ...
\- Direct Discovery Name Management Server is used for open direct discovery
to allocate and process the mapping of ProSe Applications IDs and ProSe
Application Codes used in direct discovery. It uses ProSe related subscriber
data stored in HSS for authorisation for each discovery request.
\- EPC-level ProSe Function is used ...
ProSe Function provides the necessary charging functionality for usage of
ProSe (via the EPC or for direct services).
Editor\'s note: Each sub-section specifies a new network element required for
ProSe.
4.5 High Level Function
Editor\'s note: This clause explains the high level functions (e.g. charging,
triggering, etc.) for ProSe.
4.5.1 Provisioning for direct discovery and communication
4.5.1.1 Authorization for ProSe
The basic principles of service authorization for ProSe direct discovery and
communication are as follows:
\- UE gets authorization from HPLMN for using direct discovery in certain
PLMNs per country. These PLMNs are called local PLMNs and their ProSe
Functions, local ProSe Functions. The authorisation policy can authorise the
UE from HPLMN to use discovery in local PLMN without need to contact these
PLMN first, conditionally authorise the UE requiring to also receive
authorisation from the ProSe Functions of local PLMNs or not authorise the UE
at all.
NOTE: The UE does not need to be registered in local PLMNs to get
authorization (if required) from local ProSe Functions since authorisation is
performed \"over IP\".
\- If the UE is required to get authorisation from local ProSe Functions, it
accesses local ProSe Functions to get PLMN specific Authorisation Information;
these ProSe Functions include the one of the registered PLMN and those of
other local PLMNs (of that specific country).
\- In that case, the local ProSe Function always contacts the ProSe Function
in HPLMN to check authorization and consolidates the authorization info. Final
authorization info always comes from local ProSe Functions.
The authorization can be revoked at any point by any of the local ProSe
Functions or the ProSe Function in HPLMN if the UE is de-authorized to use to
use ProSe either from the local PLMN or HPLMN.
OMA DM is used as the protocol to authorise the UE via the PC3c reference
point.
4.5.1.1.1 Provisioning information for ProSe direct services
The following information can be contained in the authorisation info that is
provided by the ProSe Function to the UE for authorisation of using direct
services in a particular PLMN.
4.5.1.1.1.1 Authorisation for direct discovery (non-Public Safety UE)
The following information is provisioned to the UE for direct discovery
authorisation:
1) Direct discovery monitoring authorisation policy.
\- PLMNs that the UE is authorised to perform direct discovery monitoring:
\- For each PLMN in the list also indicate whether the UE is pre-authorised by
HPLMN to perform direct discovery monitoring or it is conditionally
authorised, in which case the UE would need to contact the ProSe Functions of
these PLMNs (when it is in this country) in order to obtain authorisation.
2) Direct discovery announcing authorisation policy:
\- Authorised discovery range (short/medium/long) for announcing per PLMN.
NOTE: Given that direct discovery announcing can only be performed in the
bands of the registered PLMN this policy can only be provided by the
registered PLMN. In other cases a default discovery range would apply.
4.5.2 Subscription of ProSe direct discovery service (non-Public Safety UE)
When the user subscribes the ProSe discovery service, a corresponding entry is
inserted in the user\'s profile in the HSS, to give the user permission to use
the ProSe discovery service. Additional parameters related to the ProSe
discovery service are stored in the user profile, e.g. whether the user is
authorized to perform inter-PLMN discovery or not.
The operator can remove at any time the ProSe UE subscription from user\'s
profile in the HSS, and revoke the user permission to use the ProSe.
4.6 Identifiers
Editor\'s note: This clause will describe the new identifiers added in order
to support ProSe.
4.6.1 General
4.6.2 Identifiers for direct discovery
4.6.2.1 ProSe Application ID
The ProSe Application ID is an identity used for direct discovery, identifying
application related information for the ProSe enabled UE. Each ProSe
Application ID is globally unique and unambiguously identifies a service
across the 3GPP PLMNs.
For open discovery, the ProSe Application ID is called Public ProSe
Application ID. The Public ProSe Application ID can be PLMN-specific or
country specific or global.
Each Public ProSe Application ID is composed of the following parts:
a. ProSe Application ID Name is described in its entirety by a data structure
that could be a tree data structure characterized by different levels e.g.,
broad-level business category (Level0) / business sub-category (Level1) /
business name (Level2) / shop ID (Level3). For the purpose of presentation, a
ProSe Application ID Name is usually displayed as a string of labels in which
the labels represent hierarchical levels.
b. ProSe Application ID Operator Identifier that corresponds to the PLMN id
that assigned the ProSe Application ID Name.
NOTE: If the public ProSe Application ID is country specific then the Mobile
Network Code (MNC) of the ProSe Application ID Operator Identifier is wild
carded. If global, both the MCC and MNC are wild carded.
In case of open discovery:
\- when the \"announcing\" UE wants to indicate to the ProSe Function what is
interested to announce, in order to be assigned a ProSe Application Code it
contains in the discovery request a Public ProSe Application ID that indicates
its interest.
\- when the \"monitoring\" UE wants to indicate to the ProSe Function what to
monitor, it contains in the discovery request the full or a subset of the
public ProSe Application ID e.g. it can contain 2 out of the n levels of the
full Public ProSe Application ID.
NOTE: The ProSe Application ID Name tree data structure is not expected to
change often.
4.6.2.2 ProSe Application Code
The ProSe Application Code is contained in the message that is actually
transmitted \"over the air\" (on PC5) by a UE engaged in the ProSe direct
discovery procedure.
Each ProSe Application Code is composed of the following parts:
a. A temporary identity that corresponds to the ProSe Application ID Name.
Given the tree structure associated with public ProSe Application ID, each is
associated with a different temporary identity that is built appending a new
piece of identifier (specific to that node) to the identifier inherited by the
predecessor node: this allows partial matching at the UE side using a mask,
making more effective and flexible the filtering of the received temporary
identity in a monitoring UE.
b. The PLMN id that assigned the ProSe Code, i.e. Mobile Country Code (MCC)
and Mobile Network Code (MNC)
c. The ProSe Function Identifier of the ProSe Function that has assigned the
ProSe Code.
Editor\'s note: The need for ProSe Function Identifier as part of the ProSe
Application Code is FFS.
NOTE: In this release of the specification the ProSe Application Code is
always assigned by a ProSe Function in HPLMN.
A ProSe Application Code is allocated per \"announcing\" UE and per
application and has an associated validity timer that runs both in the ProSe
Function and in the UE.
The ProSe Function may decide at any time to replace a previously allocated
ProSe Application Code providing the UE with a new ProSe Application Code,
where the temporary UE specific identifier is changed. Replacing a ProSe Code
resets the corresponding validity timer both in the ProSe Function and in the
UE.
Editor\'s note: Each sub-section specifies a new identifier required for
ProSe.
5 Functional Description and Information Flow
5.1 Control and user plane stacks
Editor\'s note: This section specifies the protocol stacks on the control and
user planes for each of the interfaces required for ProSe.
5.2 Service authorisation for ProSe direct services
Figure 5.2-1: Service authorisation for ProSe direct services
The UE gets the service authorisation for direct services (i.e. direct
discovery and/or communication) from the ProSe Functions of HPLMN and
optionally from local PLMNs. The authorisation is happening using \"over IP\"
mechanisms and only IP connectivity is required to allow the UE to access this
ProSe Function.
In this signalling flow the following steps are performed:
Step 0: HPLMN configures UE with PLMN list that support direct services.
Step1\~3: If the UE is conditionally authorised for direct services for local
PLMNs, the UE contacts the local ProSe Functions to receive authorization info
applicable to this PLMN. The address of the ProSe Function in local PLMN, can
either be provided from HPLMN or self-constructed by the UE e.g. derived from
PLMN id of the local PLMN.
Step 4: The local ProSe Function obtains authorization info from HPLMN and
merges with own policy.
Step 5: Local ProSe Function provides authorisation info to UE. This
authorisation info applies to this PLMN. The UE stores the authorisation
information obtained from local ProSe Function in a secure way. If needed at
any point the authorization can be revoked by the Local ProSe Function or
ProSe Function in the HPLMN e.g. by sending an OMA DM push message.
5.3 Procedures for direct discovery
5.3.1 Overall procedure for direct discovery
Figure 5.3.1-1: Overall procedure for direct discovery
1\. Service authorisation for ProSe direct services is performed for direct
discovery as defined in clauses 5.2 and 4.5.1.
If the UE is authorised to announce:
> 2a. When the UE is triggered to announce then it sends a discovery request
> for announcing to the ProSe Function in HPLMN as defined in clauses 5.3.2.1
> and 5.3.2.2.
3a. If the request is successful and is provided with ProSe Application Code
then it starts announcing on PC5 interface.
NOTE: More details on the Access Stratum protocol of this step are provided in
RAN specifications.
If the UE is authorised to monitor:
2b. When the UE is triggered to monitor, it sends a discovery request for
monitoring to the ProSe Function as defined in clauses 5.3.2.3 and 5.3.2.4.
3b. If the request is successful and the UE is provided with a Discovery
Filter consisting of ProSe Application Code(s) or mask(s) starts monitoring
for ProSe Application Codes on PC5 interface.
NOTE: More details on the Access Stratum protocol of this step are provided in
RAN specifications.
4b. When the UE detects that one or more ProSe Application Code(s) that match
the filter, it reports the ProSe Application Code(s) to the ProSe Function as
defined in clause 5.3.3.
In the following sections non roaming direct discovery procedures cover the
case where both the HPLMN of \"announcing UE\" and \"monitoring UE\" are from
the same country. Roaming direct discovery procedures cover the cases that
either the \"announcing UE\" or \"roaming UE\" or both are roaming in a
different country.
5.3.2 Discovery request
The discovery request is sent by the \"announcing UE\" or \"monitoring UE\" in
order to be authorised to access the discovery resources and perform
discovery.
5.3.2.1 Announce request (non-roaming)
Figure 5.3.2.1-1: Announce request procedure (non-roaming)
0\. The UE is configured with offline mechanisms with the tree data structure
of the ProSe Application IDs corresponding to HPLMN. This step is performed
using mechanisms out of scope of 3GPP.
1\. If the UE is authorised to announce in HPLMN and is triggered to announce,
it shall establish a secure connection and it shall send a Discovery Request
(ProSe Application ID, UE Identity, announce command, application identity)
message for announcing. The ProSe Application ID indicates what the UE is
interested to announce. The UE Identity identifies the UE subscription and can
be the e.g. IMSI or MSISDN. The application identity represents a unique
identifier of the UE application that has triggered the Discovery Request.
This request is always sent to the ProSe Function in HPLMN.
NOTE: The application identity uniquely identifies the application itself. All
common mobile operating systems have namespaces that identify the applications
within this operating system.
Editor\'s note: It is up to stage-3 to determine whether for the application
identity the operating specific identity would suffice or a namespace needs to
be defined by 3GPP that will be common across all operating systems.
Editor\'s note: The mechanism to establish a secure connection between the UE
and the ProSe Function will be defined by SA WG3.
2\. If there is no associated UE context, the ProSe Function shall check with
HSS the authorisation for discovery and create a new context for this UE that
contains the subscription parameters for this UE.
3\. If the Discovery Request is authorised, then the ProSe Function shall
respond with a Discovery Response (ProSe Application Code, validity timer)
message. ProSe Application Code is provided by the ProSe Function and
corresponds to the ProSe Application ID that was contained in the Discovery
Request. The validity timer indicates for how long this ProSe Application Code
is going to be valid. The UE will be authorised to announce this ProSe
Application Code for the duration of validity timer and if it does not change
its registered or equivalent PLMN. When the validity timer expires or the UE
changes its registered or equivalent PLMN the UE may need to request a new
ProSe Application Code.
4\. The UE may start announcing the provided ProSe Application Code in HPLMN,
using the radio resources authorised and configured by E-UTRAN to be used for
ProSe.
Editor\'s note: The mechanism to protect the discovery message will be defined
by SA WG3.
Editor\'s note: The correct representation of radio resource allocation from
E-UTRAN needs to be revised.
5.3.2.2 Announce request (roaming)
Figure 5.3.2.2-1: Announce request procedure (roaming)
The UE is only allowed to announce in the bands signalled from VPLMN.
0\. The UE is configured using offline mechanisms with the tree data structure
of the ProSe Application IDs corresponding to HPLMN. This step is performed
using mechanisms out of scope of 3GPP.
1\. If the UE is authorised to announce in VPLMN and is triggered to announce,
it shall establish a secure connection with the ProSe Function in HPLMN and it
shall send a Discovery Request (ProSe Application ID, UE Identity, announce
command, application identity) message for announcing. The ProSe Application
ID indicates what the UE is interested to announce. The UE Identity identifies
the UE subscription and can be the e.g. IMSI or MSISDN. The application
identity represents a unique identifier of the UE application that has
triggered the Discovery Request. This request is always sent to the ProSe
Function in HPLMN.
NOTE: The application identity uniquely identifies the application itself. All
common mobile operating systems have namespaces that identify the applications
within this operating system. It is up to stage-3 to determine whether for the
application identity the operating specific identity would suffice or a
namespace needs to be defined by 3GPP that will be common across all operating
systems.
Editor\'s note: The mechanism to establish a secure connection between the UE
and the ProSe Function will be defined by SA WG3.
2\. If there is no associated UE context, the ProSe Function shall check with
HSS the authorisation for discovery and create a new context for this UE that
contains the subscription parameters for this UE. The HSS also provides the
VPLMN id of where the UE is registered.
3\. If the Discovery Request is authorised then the HPLMN ProSe Function shall
inform the ProSe Function in VPLMN. The Announce Authorisation (ProSe
Application ID, ProSe Application Code, UE Identity). The ProSe Application ID
corresponds to the request from the UE, whereas the ProSe Application Code
indicates the assigned code for this request. The request also includes the UE
identity information e.g. IMSI or MSISDN in order to allow the ProSe Function
in VPLMN to perform charging.
4\. The ProSe Function in VPLMN authorizes the UE to perform direct discovery
announcing.
5\. The ProSe Function in HPLMN shall respond with a Discovery Response (ProSe
Application Code, validity timer) message. ProSe Application Code is provided
by the ProSe Function in HPLMN and corresponds to the ProSe Application ID
that was contained in the Discovery Request. The validity timer shall indicate
for how long this ProSe Application Code is going to be valid. The UE will be
authorised to announce this ProSe Application Code for the duration of
validity timer and if it does not access a new PLMN that is not an equivalent
PLMN. When the validity timer expires or the UE access a PLMN that is not an
equivalent PLMN the UE needs to request a new ProSe Application Code.
6\. The UE may start announcing the provided ProSe Application Code in the
VPLMN, using the radio resources authorised and configured by E-UTRAN to be
used for ProSe.
Editor\'s note: The mechanism to protect the discovery message will be defined
by SA WG3.
Editor\'s note: It is FFS if assignment of ProSe Application Code from VPLMN
also needs to be specified.
Editor\'s note: The correct representation of radio resource allocation from
E-UTRAN needs to be revised.
5.3.2.3 Monitor request (non-roaming)
Figure 5.3.2.3-1: Monitor request procedure (non-roaming)
0\. The UE is configured using offline mechanisms with the tree data structure
of the ProSe Application IDs corresponding to PLMNs the UE is authorised to
monitor. This step is performed using mechanisms out of scope of 3GPP.
1\. If the UE is authorised to monitor in at least one PLMN and is interested
to monitor certain ProSe Application ID(s), it shall establish a secure
connection and shall send a Discovery Request (ProSe Application ID(s), UE
Identity, monitor command, application identity) message for monitoring. The
ProSe Application ID(s) indicate what the UE is interested to monitor and they
consist a subset of the tree data structure of the PLMN. The UE Identity
identifies the UE subscription and can be the e.g. IMSI or MSISDN. The
application identity represents a unique identifier of the application that
has triggered the discovery request. This request is always sent to the ProSe
Function in HPLMN.
NOTE 1: The application identity uniquely identifies the application itself.
All common mobile operating systems have namespaces that identify the
applications within this operating system.
Editor\'s note: It is up to stage-3 to determine whether for the application
identity the operating specific identity would suffice or a namespace needs to
be defined by 3GPP that will be common across all operating systems.
Editor\'s note: The mechanism to establish a secure connection between the UE
and the ProSe Function will be defined by SA WG3.
2\. If there is no associated UE context, the ProSe Function shall check with
HSS the authorisation for discovery and create a new context for this UE that
contains the subscription parameters for this UE. The authorisation
information also contains the PLMNs that this UE is allowed to perform
discovery.
If the Discovery Request is authorised and the ProSe Application ID sent by
the UE in step 1 indicates another local PLMN in the same country then steps
3-6 are executed, otherwise steps 5-6 only:
3\. The ProSe Function in HPLMN shall contact other local PLMNs in the same
country in order to resolve the ProSe Application ID Name(s) to mask(s) that
corresponds to this ProSe Application ID Name. The request shall also include
the UE identity information e.g. IMSI or MSISDN in order to allow the ProSe
Function in local PLMN to perform charging.
4\. The ProSe Function of the local PLMN returns the related mask(s) and the
corresponding TTL for each.
5\. The ProSe Function in the HPLMN shall respond with a Discovery Response
(Discovery Filter(s), Filter id) message. The Discovery Filter(s) consists of
the ProSe Application mask(s). The Discovery Filter(s) include the TTL(s). The
TTL(s) in the Discovery Filter(s) indicates for how long the Discovery
Filter(s) is going to be valid.
NOTE 2: he UE can randomize the request for assignment of new Discovery Filter
in order to guard against a peak of Discovery Requests when the TTL expires.
6\. The UE may start monitoring using the Discovery Filter(s) in the radio
resources that are authorized and configured by the PLMN(s)to be used for
ProSe.
Editor\'s note: The correct representation of radio resource allocation from
E-UTRAN needs to be revised.
5.3.2.4 Monitor request (roaming)
Figure 5.3.2.4-1: Monitor request procedure (roaming)
0\. The UE is configured using offline mechanisms with the tree data structure
of the ProSe Application IDs corresponding to PLMNs the UE is authorised to
monitor. This step is performed using mechanisms out of scope of 3GPP.
1\. If the UE is authorised to monitor in at least one PLMN (in the country it
is in) and is interested to monitor certain ProSe Application ID(s), it shall
establish a secure connection with the ProSe Function in HPLMN and it shall
send a Discovery Request (ProSe Application ID(s), UE Identity, monitor
command, application identity) message for monitoring. The ProSe Application
ID(s) indicate what the UE is interested to monitor and they consist a subset
of the tree data structure of the PLMN. The UE Identity identifies the UE
subscription and can be the e.g. IMSI or MSISDN. The application identity
represents a unique identifier of the application that has triggered the
discovery request. This request is always sent to the ProSe Function in HPLMN.
NOTE 1: The application identity uniquely identifies the application itself.
All common mobile operating systems have namespaces that identify the
applications within this operating system.
Editor\'s note: It is up to stage-3 to determine whether for the application
identity the operating specific identity would suffice or a namespace needs to
be defined by 3GPP that will be common across all operating systems.
Editor\'s note: The mechanism to establish a secure connection between the UE
and the ProSe Function will be defined by SA WG3.
2\. If there is no associated UE context, the ProSe Function shall check with
HSS the authorisation for discovery and create a new context for this UE that
contains the subscription parameters for this UE. The authorisation
information also contains the PLMNs that this UE is allowed to perform
discovery. The HSS provides also the VPLMN id where the UE is registered.
If the Discovery Request is authorised and the ProSe Application ID sent by
the UE in step 1 indicates another PLMN and not the HPLMN, then steps 3-6 are
executed, otherwise steps 5-6 only:
3\. The ProSe Function in HPLMN shall contact other PLMNs that are indicated
by the ProSe Application ID(s) sent by the UE, in order to resolve the
corresponding ProSe Application ID Name(s) to mask(s). The request shall also
include the UE identity information e.g. IMSI or MSISDN in order to allow the
ProSe Function in local PLMN to perform charging.
4\. The ProSe Function of the other PLMN returns the related ProSe Application
mask(s) and the corresponding TTL for each. It also includes the PLMN id of
the PLMN that the \"announcing UE\" is registered (if roaming).
5\. The ProSe Function in the HPLMN responds with a Discovery Response
(Discovery Filter(s), Filter id) message. The Discovery Filter(s) consists of
the ProSe Application mask(s). The Discovery Filter(s) include the TTL. The
TTL(s) in the Discovery Filter(s) indicates for how long the Discovery
Filter(s) is going to be valid.
NOTE 2: The UE can randomize the request for assignment of new Discovery
Filter in order to guard against a peak of Discovery Requests when the TTL
expires.
6\. The UE may start monitoring using the Discovery Filter(s) in the radio
resources that are authorized and configured by the PLMN(s) to be used for
ProSe.
Editor\'s note: The correct representation of radio resource allocation from
E-UTRAN needs to be revised.
5.3.3 Discovery reporting
5.3.3.1 Match report (non-roaming)
Figure 5.3.3.1-1: Match report procedure (non-roaming)
1\. If the UE finds ProSe Application Code(s) that matches the Discovery
Filters and does not have ProSe Application ID(s) already locally stored that
correspond to this ProSe Application Code(s), it shall (re)establish a secure
connection and shall send a Match Report (ProSe Application Code(s), Discovery
Filter id(s), UE Identity) to the ProSe Function in HPLMN. The ProSe
Application Code is the code that the corresponding Discovery Filter of the UE
matched. This request is always sent to the ProSe Function in HPLMN.
Editor\'s note: The mechanism to establish a secure connection between the UE
and the ProSe Function will be defined by SA WG3.
2\. If there is no associated UE context, the ProSe Function shall check with
HSS the authorisation for discovery and create a new context for this UE that
contains the subscription parameters for this UE. The authorisation
information also contains the PLMN that this UE is allowed to perform
discovery.
3\. The ProSe Function analyses the ProSe Application Code received from the
UE.
If the PLMN id that assigned the given ProSe Application Code is another local
PLMN in the same country then steps 4-7 are executed, otherwise step 7 only:
4\. The ProSe Function in HPLMN sends a Match Report (ProSe Application
Code(s), UE identity) to the ProSe Function of the PLMN that assigned the
ProSe Application Code. The UE identity information e.g. IMSI or MSISDN can be
used by the ProSe Function in local PLMN to perform charging.
5\. The ProSe Function analyses the ProSe Application Code(s) received from
the UE.
6\. If the ProSe Application Code is confirmed then the ProSe Function in
local PLMN shall send Match Report Acknowledgement (ProSe Application ID
Name(s), validity timer(s)). This message may also contain certain metadata
corresponding to the ProSe Application ID Name e.g. postal address, phone
number, URL etc.
7\. The ProSe Function in HPLMN shall respond to the UE with Match Report
Acknowledgment (ProSe Application ID(s), validity timer(s)). This message may
also contain certain metadata corresponding to the ProSe Application ID Name
e.g. postal address, phone number, URL etc. The validity timer(s)indicate for
how long the ProSe Application ID(s) provided are going to be valid. The UE
may store the mapping of ProSe Application Code(s) and corresponding ProSe
Application ID(s) for the duration of their validity timer.
5.3.3.2 Match reporting (roaming)
Figure 5.3.3.2-1: Match report procedure (roaming)
1\. If the UE finds ProSe Application Code(s) that matches the Discovery
Filters and does not have ProSe Application ID(s) already locally stored that
correspond to this ProSe Application Code(s), it (re)establishes a secure
connection with the ProSe Function in HPLMN and sends a Match Report (ProSe
Application Code(s), Discovery Filter id(s), UE Identity, VPLMN id, Monitored
PLMN id) to the ProSe Function in HPLMN. The ProSe Application Code is the
code that the corresponding Discovery Filter of the UE matched.
Editor\'s note: The mechanism to establish a secure connection between the UE
and the ProSe Function will be defined by SA WG3.
NOTE 1: The Monitored PLMN id is needed in order to cover the case that the
announcing UE that broadcasted the ProSe Application Code was an inbound
roamer in the same country.
2\. If there is no associated UE context, the ProSe Function shall check with
HSS the authorisation for discovery and create a new context for this UE that
contains the subscription parameters for this UE. The authorisation
information also contains the PLMN that this UE is allowed to perform
discovery. The HSS provides also the VPLMN id where the UE is registered.
3\. The ProSe Function analyses the ProSe Application Code received from the
UE to ensure that the ProSe Application Code is authorized to be transmitted
in the monitored PLMN id.
If the PLMN id that assigned the given ProSe Application Code is not the
HPLMN, then steps 4-8 are executed, otherwise steps 7-8 only:
4\. The ProSe Function in HPLMN shall send a Match Report (ProSe Application
Code(s), UE identity, monitored PLMN id) to the ProSe Function of the PLMN
that assigned the ProSe Application Code (i.e. the ProSe Function of the HPLMN
of the \"announcing UE\"). The UE identity information e.g. IMSI or MSISDN can
be used by the ProSe Function in local PLMN to perform charging. The monitored
PLMN id is the registered PLMN of the \"announcing\" UE and is derived from
step 4 of clause 5.3.2.4.
5\. The ProSe Function ensures that the received ProSe Application Code is
authorized to be transmitted on the monitored PLMN. The ProSe Function
analyses the ProSe Application Code(s) received from the UE, and confirms the
ProSe Application Code(s).
6\. The ProSe Function shall send Match Report Acknowledgement (ProSe
Application ID Name(s), validity timer(s)). This message may also contain
certain metadata corresponding to the ProSe Application ID Name e.g. postal
address, phone number, URL, etc.
7\. The ProSe Function in HPLMN shall respond to the UE with Match Report
Acknowledgment (ProSe Application ID(s)). This message may also contain
certain metadata corresponding to the ProSe Application ID Name e.g. postal
address, phone number, URL etc. The validity timer(s) indicate for how long
the ProSe Application ID(s) provided are going to be valid. The UE may store
the mapping of ProSe Application Code(s) and corresponding ProSe Application
ID(s) for the duration of their validity timer.
8\. If in step 4 of clause 5.3.2.4 it was indicated that the \"announcing UE\"
is roaming, the ProSe Function in HPLMN may optionally send a Match Report
Info (ProSe Application ID(s), UE Identity) to the ProSe Function of the
serving PLMN of the \"announcing UE\".
#
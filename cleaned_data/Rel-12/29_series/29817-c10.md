# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
Y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The Technical Report describes solutions for an XML based protocol (e.g. SOAP,
Restful HTTP, etc.) between the AF and the PCRF for the case of non IMS
applications. The scope of this work is to provide an XML based equivalent to
the Diameter based signalling that is presently specified in 3GPP TS 29.214
[5].
This study covers the following alternatives:
\- XML based protocol between AF and PCRF;
\- Adding a new protocol converter (as a stand-alone entity) between PCRF and
AF
Investigate a suitable transport protocol for XML, charging issues in case of
3^rd^ party SPs, security issues.
Roaming in both home routed and local break out and signalling routing aspects
(e.g. DRA handling and others aspects) has also been included.
Necessary changes to 3GPP specifications are identified.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: "Vocabulary for 3GPP Specifications".
[2] 3GPP TS 23.203: "Policy and Charging Control architecture".
[3] 3GPP TS 29.212: "Policy and Charging Control (PCC); Reference points".
[4] 3GPP TS 29.213: "Policy and Charging Control signalling flows and QoS
parameter mapping".
[5] 3GPP TS 29.214: "Policy and Charging Control over Rx reference point ".
[6] IETF RFC 6202: "Known Issues and Best Practices for the Use of Long
Polling and Streaming in Bidirectional HTTP".
[7] IETF RFC 4627: "The application/json Media Type for JavaScript Object
Notation (JSON)".
[8] IETF RFC 3588: "Diameter Base Protocol".
[9] Architectural Styles and the Design of Network-based Software
Architectures, UNIVERSITY OF CALIFORNIA, IRVINE, Roy Thomas Fielding, 2000.
[10] IETF RFC 2616: "Hypertext Transfer Protocol -- HTTP/1.1".
[11] CP-130167: \"WID on Study on XML based access of AF to the PCRF\", CT#59,
Vienna, March 2013.
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**Application Function (AF):** element offering application(s) that use IP
bearer resources
**Protocol Converter (PC):** element converting 3^rd^ party application layer
protocol to Diameter in order to get an access to the PCC architecture
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
AAA Authentication, Authorization, Accounting
AF Application Function
API Application Programming Interface
BBERF Bearer Binding and Event Reporting Function
DRA Diameter Routing Agent
H-PCRF Home PCRF
HTTP HyperText Transfer Protocol
HTTPS Hypertext Transfer Protocol Secure
IP‑CAN IP Connectivity Access Network
JSON JavaScript Object Notation
OFCS Offline Charging System
OCS Online Charging System
PC Protocol Converter
PCC Policy and Charging Control
PCEF Policy and Charging Enforcement Function
PCRF Policy and Charging Rules Function
PDN Packet Data Network
PLMN Public Land Mobile Network
QoS Quality of Service
REST Representational State Transfer
SOAP Simple Object Access Protocol
SPR Subscription Profile Repository
UDR User Data Repository
UE User Equipment
V-PCRF Visited PCRF
XML Extensible Markup Language
# 4 Study area
The study area of the XML based Rx interface is to investigate XML based
protocols between the AF of the 3^rd^ party web application developer and the
PCRF.
## 4.1 Architecture and deployment
The present document considers the following architectures:
1\. Proposal 1: XML based protocol support between AF and PCRF.
2\. Proposal 2: Adding a new interworking entity between PCRF and AF. This
interworking entity (protocol convertor) may integrate additional
functionality. The set of possible functionality (e.g. security, addressing
etc.) is investigated.
The following issues of the architecture and the deployment are considered for
both architectures:
\- The provisioning of the XML interface API to 3^rd^ party applications and
the update impact of the XML based protocol to 3^rd^ party applications.
\- The comparison of the applicable scenarios of the solution 1 and 2 (e.g.
pros and cons).
\- The deployment in relation to the PLMN and Diameter domain).
\- PCRF addressing.
\- Session management (e.g. traffic plane events and the stateless of XML
based protocols.)
## 4.2 Functions
The present document considers , the following issues for the case when the AF
makes an access to the PCC architecture: .
\- For proposal 1: The issues concerning to information provision, charging,
security, routing, etc. in relation the the functional entities (e.g. PCRF,
AF, DRA, etc.) which have to be taken into account for the information
exchange over the Rx interface.
\- For proposal 2: The issues concerning to information provision, charging,
security and routing, resulting out of the introduction of the PC and the
consequences to the existing entity function of PCRF, AF, DRA and etc.
The following information and capabilities over Rx interface are considered.
The AF provides the information to the PCRF including:
\- UE information (IP address, identity).
\- The required service quality for the data transport (e.g. QoS and the
corresponding service data flows).
\- The correlation information between the application traffic and the
corresponding SDFs.
The PCRF provides the information to the AF as a web services information
including:
\- The acceptable authorized resources (e.g. QoS bandwidth) in the
unsuccessful procedure.
\- AF session management including the traffic plane events report.
## 4.3 Protocols and languages
The present document considers the following issues in relation to protocols
and languages:
\- The Rx information and procedures that are required by the 3^rd^ party
application provider based on Rx interface should be considered.
\- The proposed protocols and languages.
The present document studies and compares the following protocols and
languages:
\- SOAP
\- REST
\- XML
\- JSON
The possible candidate languages and protocols will be presented, and the
relationships of these concepts will be clarified. XML and JSON are considered
as languages, SOAP and REST are considered as protocols. The protocols (SOAP
or REST) are specified for exchanging structured information (XML or JSON).
## 4.4 Charging
The existing charging control functions over Rx apply.
## 4.5 Roaming and routing
The present document studies:
  * For proposal 1: The addressing of the PCRF and vice versa.
  * For proposal 2: The routing between the interworking entity and the PCRF.
  * The support of an AF located in a different IP address domain than the PCRF and/or PCEF.
NOTE: For instance, for local breakout and home routed, a 3^rd^ party AF can
be located either in the visited country or region of a roaming user or in
his/her home country/region and can either contact the H-PCRF or V-PCRF.
## 4.6 Security
The security issues including service provider access control, media type and
content authorization, requested service authorization based on contract
between application provider and operators are considered.
## 4.7 New consideration for XML based Rx interface
The XML based protocol (e.g. SOAP, Restful HTTP, etc.) between the AF and the
PCRF has to take into account new basic consideration. The present document
breaks down:
\- A two-way communicationwith which the PCRF can notify the AF of traffic
plane events arising in the RAN/CN (unlike Diameter the PCRF cannot send
requests to the AF without an unextended XML based protocol).
\- The AF status detection of the PCRF and the impact to the Rx based
interface procedures (unlike Diameter, the XML based protocol is a short
connection protocol without heartbeats).
\- The network signalling impact, the kind of applications that are applicable
to access to the PCRF and the procedure limitations of AF session.
# 5 The Rx interface
The Rx interface is used to exchange application level session information
between the Policy and Charging Rules Function (PCRF) and the Application
Function (AF). As a part of PCC architecture, the PCRF uses the session
information over Rx for the PCC decisions. The detailed description for Rx
reference model and functional elements can refer to 3GPP TS 29.214 [5]
subclause 4.2 and 4.3 separately.
Diameter Routing Agent (DRA) shall be involved for PCRF addressing over the Rx
interface in case that multiple PCRFs are deployed per Diameter realm. The
detailed introduction to the DRA can refer to 3GPP TS 29.213 [4] subclause
7.1, 7.2, 7.3 and 7.4.
For the special functionality to support the XML based Rx interface refer to
subclause 4.7 of the present document.
# 6 Architecture of the 3^rd^ party web service based on Rx
## 6.1 General
## 6.2 Protocol converter
### 6.2.1 Architecture description
The Rx reference point is defined between the PCRF and the AF. Protocol
between the PC and AF is based on some Application level protocols, e.g. SOAP.
The PC converts the 3^rd^ party application layer protocol to Diameter for
PCRF. As defined in the stage 2 specifications (3GPP TS 23.203 [2]),
information from AF is part of the input used by the PCRF for the Policy and
Charging Control (PCC) decisions. The PCRF exchanges the PCC rules with the
Policy and Charging Enforcement Function (PCEF) and QoS rules with the Bearer
Binding and Event Reporting Function (BBERF) as specified in 3GPP TS 29.212
[3]. Signalling flows related to the both Rx and Gx interfaces are specified
in 3GPP TS 29.213 [4].
The relationships between the different functional entities involved are
depicted in figure 6.2.1.1.
Figure 6.2.1.1: PC at the PCC architecture with SPR for non-roaming scenario
Figure 6.2.1.2: PC at the PCC architecture with SPR for home routed scenario
Figure 6.2.1.3: PC at the PCC architecture with SPR for local breakout
scenario
NOTE 1: The PCEF may support Application Detection and Control feature.
NOTE 2: When UDC architecture is used, SPR and Sp, whenever mentioned in this
document, are replaced by UDR and Ud.
### 6.2.2 Procedures of protocol converter
#### 6.2.2.1 AF Session Establishment
This clause describes the signalling flow for the AF session establishment
procedure through the PC.
Figure 6.2.2.1.1: Initial AF session request
  1. The AF sends the AF session establishment request to the PC including the UE IP address and the corresponding Service Information. UE identity, PDN information and domain identity may be provided if available.
  2. The PC converts the request to AAR command. The PC provides the service information to the PCRF by sending a Diameter AAR for a new Rx Diameter session.
  3. The PCRF stores the received Service Information, checked the subscription and other related information, sends a Diameter AAA to the protocol converter.
  4. The PC converts the AAA and provides the acknowledge information to the AF.
#### 6.2.2.2 AF Session Modification initiated by AF
This clause describes the signalling flow for the AF session modification
procedure through PC.
Figure 6.2.2.2.1: AF session modification initiated by AF
  1. The AF sends the AF session modification request to the PC including the UE IP address and the corresponding Service Information. UE identity, PDN information and domain identity may be provided if available.
  2. The PC converts the request to AAR command. The PC provides the service information to the PCRF by sending a Diameter AAR for the Rx Diameter session.
  3. The PCRF stores the received Service Information, checked the subscription and other related information, sends a Diameter AAA to the PC.
  4. The PC converts the AAA and provides the acknowledge information to the AF.
#### 6.2.2.3 Gate Related Procedures
This clause describes the signalling flow when the AF initializes the gate
related procedures with the PCRF through the protocol converter.
Depending on the application, in the Service Information provisioning, the AF
may instruct the PCRF when the IP flow(s) are to be enabled or disabled to
pass through the IP-CAN.
The procedures is the same as Figure 6.2.2.2.1, the only difference is
protocol converter should converts the gate status into Flow-Status including
in Media-Component- Description AVP of AAR to PCRF.
#### 6.2.2.4 AF Session Termination
This clause describes the signalling flow for the AF session termination
procedure through the PC.
Figure 6.2.2.4.1: AF Session Termination
  1. The AF sends the remove resource request to the PC including the UE IP address and the corresponding Service Information to terminate the session and remove the related information. UE identity, PDN information and domain identity may be provided if available.
  2. The PC converts the request to STR command. The PC provides the terminated inform for the AF session to the PCRF by sending a Diameter STR for this Rx Diameter session.
  3. When the PCRF receives a ST-Request from the PC, indicating an AF session termination, it shall acknowledge that request by sending a ST-Answer to the protocol converter. Afterwards, the corresponding procedures specified at 3GPP TS 29.214 [5].
  4. The PC converts the STA and provides the acknowledge information to the AF.
#### 6.2.2.5 Subscription to Notification of Signalling Path Status
An AF may subscribe to notifications of the status of the AF Signalling
transmission path. And it will be reported to the AF through the PC when the
subscribe event happened.
Figure 6.2.2.5.1: Subscription to Notification of Signalling Path Status
  1. The AF sends the subscription request to the PC including the UE IP address and the event Information for the subscription. UE identity, PDN information and domain identity may be provided if available.
  2. The PC converts the request to AAR command. The PC provides the subscribe event information to the PCRF by sending a Diameter AAR for a new Rx Diameter session.
  3. The PCRF stores the received Service Information, performs session binding as described in 3GPP TS 29.213 [4] and acknowledge that request by sending an AAA to the PC. Afterwards, the corresponding procedures specified at 3GPP TS 29.214 [5].
  4. .The PC converts the AAA and provides the acknowledge information to the AF.
NOTE: The AF may subscribe other traffic plane events, such as IP-CAN session
termination, IP-CAN type changer and access network charging information
notification, etc. The procedures are similar with the subscription to
Notification of Signalling Path Status.
#### 6.2.2.6 Notification of traffic plane events
This sub-clause describes the procedure for the notification of traffic plane
events.
Figure 6.2.2.6.1: Notification of user plane events
  1. The PCRF detects the occurrence of the traffic plane events.
  2. When the traffic plane events occur, the PCRF notifies the corresponding events to the PC via a Diameter RAR command.
  3. The PC converts the Diameter RAR command and sends the Traffic Plane Events Report message to the AF.
  4. The AF responds the Traffic Plane Events Report Response message to the PC.
  5. The PC converts the Traffic Plane Events Report Response message and sends the Diameter RAA command to the PCRF.
### 6.2.3 Roaming and routing of protocol converter
#### 6.2.3.1 PC located in the PLMN but outside of the PCRF realm
##### 6.2.3.1.1 General
This subclause specifies the roaming and routing when PC is deployed,
including the routing for application level session information between the
PCRF and PC, between the PC and the AF.
Subclause 6.2.3.1.3, routing between the PCRF and the PC, describes the
scenario that multiple and separately addressable PCRFs are present in one
Diameter Realm. The PC may use pre-configured information to find the PCRF for
single addressable PCRF in one Realm scenario.
The principles for PCRF selection and discovery are as the description in 3GPP
TS 23.203[2] clause 7.Within such a deployment, DRA as specified in 3GPP TS
29.213 [4] clause 7 is needed.
The messages between PC and PCRF are based on Diameter protocol as specified
in IETF RFC 3588 [8]. All the procedures between PC and PCRF involve the DRA
functional element. The DRA mode in which it operates (i.e. proxy or redirect)
shall be based on operator\'s requirements.
##### 6.2.3.1.2 Routing between the AF and Protocol converter
The AF may have following parameters: UE IP address, PDN information, user
identity and domain Identity.
The AF may use above parameters to construct the HTTP request URL to the
protocol converter.
The above available parameters shall also be included in the AF session
establishment requests to the protocol converter.
##### 6.2.3.1.3 Routing between the Protocol converter and PCRF
As the description in subclause 6.2.2, the PC as one Diameter client of the
PCRF converts the request from AF to AAR command, and then sends it to DRA for
the PCRF selection to establish the AF session.
In roaming scenario, home routed or local breakout, V-PCRF is selected by the
DRA located in the visited PLMN, and the H-PCRF is selected by the DRA located
in the home PLMN.
If the PC has the realm identification (i.e. FQDN from a UE NAI) and is
located in the H-PLMN, the PC sends the user identity in the Subscription-Id
AVP and PDN information (i.e. APN) if available in the Called-Station-Id AVP
in a Diameter request to the DRA which acts as a Diameter agent. If the PC
does not have proper knowledge about the user identity and the PC is located
in the HPLMN, the PC may use pre-configured information to find the DRA.
The PC shall provide the DRA of the PCRF realm with identity parameters upon
the first interaction between the PC and the PCRF realm.
If redirect agent is used for the DRA, the DRA shall use the redirecting
requests procedure as specified in IETF RFC 3588 [8], and include the PCRF
address (Diameter Identity) in the Redirect-Host AVP in the Diameter reply
sent to the PC.
If proxy agent is used for the DRA, the DRA should use the proxy procedure as
specified in IETF RFC 3588 [8].
The parameters from the PC may comprise the UE IP address in either the
Framed-IP-Address AVP or the Framed-Ipv6-Prefix AVP, PDN information in the
Called-Station-Id AVP, user identity in the Subscription-Id AVP and domain
Identity in the IP-Domain-Id AVP (3GPP TS 23.203 [2]). The AAR command may
also comprise the application service information in the AF-Application-
Identifier AVP (3GPP TS 29.214 [5]).
NOTE: The PC converts the format of domain identity received from the AF to
the format which can be directly recognized by the DRA for the PCRF selection
or by the PCRF for the session binding.
#### 6.2.3.2 PC located in the PCRF realm
##### 6.2.3.2.1 Routing between the AF and Protocol converter
The AF may have following parameters: UE IP address, PDN information, user
identity and domain Identity.
The AF may use above parameters to construct the HTTP request URL to the
protocol converter.
The above available parameters shall also be included in the AF session
establishment requests to the protocol converter.
##### 6.2.3.2.2 Routing between the Protocol converter and PCRF
The protocol converter shall provide the DRA of the PCRF realm with the
parameters translated from the HTTP request.
The parameters from the protocol converter may comprise the UE\'s Ipv4
address, the UE\'s Ipv6 prefix, PDN information, user identity and domain
identity.
NOTE: The UE\'s Ipv4 address is included in the Framed-IP-Address AVP, the
UE\'s Ipv6 prefix is included in the Framed-Ipv6-Prefix AVP, the PDN
information is included in the Called-Station-Id AVP, user identity is
included in the Subscription-Id AVP and domain identity is included in the IP-
Domain-Id AVP. The PC converts the format of domain identity received from the
AF to the format which can be directly recognized by the DRA for the PCRF
selection or by the PCRF for the session binding.
### 6.2.4 Study on location of XML-DIAMETER Protocol Converter
#### 6.2.4.1 General
**Part of the WID on \"Study on XML based access of AF to the PCRF\" [11] is
to investigate the adding of a "**_protocol converter (as a stand-alone
entity) between PCRF and AF_**".**
**The present document proposes some possibilities where this Protocol
Converter might reside and discusses the advantages and disadvantages of the
proposed locations.**
#### 6.2.4.2 Locating the Protocol Converter
##### 6.2.4.2.1 Option A: Protocol Converter within 3GPP PLMN
**In this option the protocol converter is within the 3GPP PLMN.**
In this option it is possible that:
\- there is one logical Protocol Converter per PLMN, see figure 6.2.4.2.1.1;
\- there is one logical Protocol Converter per Diameter realm, see figure
6.2.4.2.1.2;
Figure 6.2.4.2.1.1: Protocol Converter placed within 3GPP PLMN,\ one logical
Protocol Converter to a PLMN
Figure 6.2.4.2.1.2: Protocol Converter placed within 3GPP PLMN,\ one logical
Protocol Converter per Diameter realm
**With Option A, there are the following _Pros _and_ Cons_**.
+----------------------------------+----------------------------------+ | _Pros_ | _Cons_ | +----------------------------------+----------------------------------+ | - No change to 3GPP | - impact to CT3 | | architecture | specifications, total | | | impacts yet to be analyzed | | - Scoped and worked on by 3GPP | and determined | | to 3GPP domain | | | | | | - Quick and easy adoption by | | | 3^rd^ party applications | | | providers | | | | | | - Standardized version of | | | protocol conversion | | | | | | - Operator ease of managing | | | 3^rd^ party providers | | +----------------------------------+----------------------------------+
##### 6.2.4.2.2 Option B: Protocol Converter within AF (3^rd^ party) server
domain
**In this option, the protocol converter is placed within the AF domain, see
Figure 6.2.4.2.2.1.**
Figure 6.2.4.2.2.1: Protocol Converter within 3^rd^ party server domain
**With Option B, there are the following _Pros_ and _Cons_.**
+----------------------------------+----------------------------------+ | _Pros_ | _Cons_ | +----------------------------------+----------------------------------+ | - No likely impacts to CT3 | - Defeats the purpose of | | interfaces and | \'opening\' the Rx to 3rd | | specifications | party application providers | | | familiar with XML | | | | | | - Opens up many | | | (non-standardised) variants | | | of protocol conversion | | | | | | - Increases difficulty for | | | operator\'s to manage 3rd | | | party providers | | | | | | - Fragments market | +----------------------------------+----------------------------------+
##### 6.2.4.2.3 Option C: Protocol Converter between AF domain and 3GPP domain
**For this option, the protocol converter is independently placed to bridge
between the AF and 3GPP domain, see Figure 6.2.4.2.3.1.**
Figure 6.2.4.2.3.1: Protocol Converter bridging AF and 3GPP
**With Option C, there are the following _Pros _and_ Cons_**.
+----------------------------------+----------------------------------+ | _Pros_ | **_Cons_** | +----------------------------------+----------------------------------+ | - No likely impact to CT3 | - Opens up many | | interfaces and | (non-standardized) variants | | specifications | of protocol conversion | | | | | - Facilitate use of XML for | - Increases difficulty for | | 3rd party providers | operator\'s to manage 3rd | | | party providers | | | | | | - Fragments market | +----------------------------------+----------------------------------+
## 6.3 PCRF web server
In this architecture the PCRF looks like an application server from AF point
of view. One of the transport solutions, which are described in subclause 7.1
may be used to exchange complex information between the AF and the PCRF. The
Rx related content may be presented by one of the application level languages
described in subclause 7.2.
PCRF and AF are connected to each other without any protocol converter.
### 6.3.1 Procedures of PCRF web server
#### 6.3.1.1 AF Session Establishment
This clause describes the signalling flow for the AF session establishment
procedure in case PCRF connects to the AF directly via XML based Rx (PCRF web
server).
Figure 6.3.1.1.1: Initial AF session establishment
  1. The AF sends the AF session establishment request to the PCRF web server including the UE IP address and the corresponding Service Information. UE identity, PDN information and domain identity may be provided if available.
  2. The PCRF stores the received Service Information, checked the subscription and other related information, sends the AF session establishment response to the PCRF web server.
#### 6.3.1.2 AF Session Modification
This clause describes the signalling flow for the AF session modification
procedure in case of PCRF web server.
Figure 6.3.1.2.1: AF session modification initiated by AF
  1. The AF sends the AF session modification request to the PCRF web server including the UE IP address and the corresponding Service Information. UE identity, PDN information and domain identity may be provided if available.
  2. The PCRF stores the received Service Information, checked the subscription and other related information, sends the AF session modification response to the PCRF web server.
#### 6.3.1.3 AF Session Termination
This clause describes the signalling flow for the AF session termination
procedure in case of PCRF web server.
Figure 6.3.1.3.1: AF Session Termination
  1. The AF sends the remove resource request to the PCRF web server including the UE IP address and the corresponding Service Information to terminate the session and remove the related information. UE identity, PDN information and domain identity may be provided if available.
  2. When the PCRF web server receives the request from the PCRF web server, indicating an AF session termination, it shall acknowledge that request by sending AF session termination response to the PCRF web server. Afterwards, the corresponding procedures specified at 3GPP TS 29.214 [5].
#### 6.3.1.4 Gate Related Procedures
This clause describes the signalling flow when the AF initializes the gate
related procedures with the PCRF web server.
Depending on the application, in the Service Information provisioning, the AF
may instruct the PCRF web server when the IP flow(s) are to be enabled or
disabled to pass through the IP-CAN.
The procedure is the same as in Figure 6.3.1.2.1.
#### 6.3.1.5 Subscription to notification of traffic plane events
This clause describes the signalling flow for the subscription to the
notification of traffic plane events in case of PCRF web server. When the
subscribed event happens, it will be reported from the PCRF web server to the
AF.
Figure 6.3.1.5.1: Subscription to Notification of traffic plane events
  1. The AF sends the Subscription request to the PCRF web server including the UE IP address and the corresponding Service Information. UE identity, PDN information and domain identity may be provided if available.
  2. The PCRF stores the received Service Information, checks the subscription and other related information, performs session binding as described in 3GPP TS 29.213 [4] and acknowledge that request by sending the Subscription response to the PCRF web server.
#### 6.3.1.6 Notification of traffic plane events
This clause describes the signalling flow for the notification of traffic
plane events in case of PCRF web server.
Figure 6.3.1.6.1: Notification of traffic plane events
  1. The PCRF web server detects the occurrence of the traffic plane events.
  2. When the traffic plane events occur, the PCRF web server sends Traffic Plane Event Report to the AF.
  3. The AF responds the Traffic Plane Events Report Response message to the PCRF web server.
### 6.3.2 PCRF addressing
The existing DRA entity in the 3GPP specifications is used for Diameter based
protocols. In case that multiple PCRF web servers are deployed in the network,
a new entity whose functionality is similar to DRA while supporting XML based
protocols may be introduced for addressing PCRF web server. However, this
requires stage 2 work.
NOTE: When the DRA-like entity with supporting XML based protocols is deployed
in the network, it should interact with the DRA to obtain the same PCRF
address which is selected in Diameter Gx session establishment.
**The potential solutions for PCRF addressing in the PCRF web server
architecture are investigated as follows.**
#### 6.3.2.1 Non-roaming cases
##### 6.3.2.1.1 Solution1: DRA-like entity interacting with DRA to get the
PCRF address based on Diameter protocol
**When the DRA-like entity receives a XML based Rx session establishment
request from the 3^rd^ party AF, it sends a Diameter based request to the DRA
to obtain the PCRF address. The procedure is shown in figure 6.3.2.1.1.1.**
Figure 6.3.2.1.1.1: DRA-like entity interacting with DRA to get the\ PCRF
address based on diameter protocol (non-roaming)
1\. The 3^rd^ party AF sends a XML based Rx session establishment Request to
the DRA-like entity.
2\. The DRA-like entity extracts XML based Rx message and gets user identity
(if available), UE IP address or PDN information (i.e. APN, if available).
3\. The DRA-like entity constructs a Diameter based Rx message (e.g. AAR, (see
NOTE 1)), according to the information obtained in step2 and sends the request
to the DRA.
4\. The steps of Diameter based message interaction are the same as the
current DRA procedures in3GPP TS 29.213. Step4a\~4d correspond to proxy based
mode; Step4A\~4B correspond to redirect based mode.
5\. The DRA-like entity gets the PCRF address.
6\. The DRA-like entity establishes the Rx session with the PCRF in either
proxy based mode or redirect based mode. The steps are similar to the current
DRA procedures in 3GPP TS 29.213 [4]. Proxy based mode refers to step6a\~6c,
and redirect based mode refers to step6A\~6C.
NOTE 1: The Diameter based interaction between the DRA-like entity and the DRA
is to get the PCRF address from the DRA. In proxy based mode, the AAR command
will finally be regarded as error-handling in the PCRF, e.g. to set Rx-
Request-Type AVP to \"UPDATE_RRQUEST\" in the first AAR command.
##### 6.3.2.1.2 Solution 2: DRA-like entity interacting with DRA to get the
PCRF address based on XML based protocol
**When the DRA-like entity receives a XML based Rx session establishment
request, it constructs a XML based PCRF address inquiring request and sends it
to the DRA to obtain the PCRF address. The procedure is shown in figure
6.3.2.1.2.1.**
Figure 6.3.2.1.2.1: DRA-like entity interacting with DRA to get\ PCRF address
based on XML based protocol (non-roaming)
1\. The 3^rd^ party AF sends XML based Rx session establishment Request to the
DRA-like entity.
2\. The DRA-like entity analyzes XML based Rx protocol and gets user identity
(if available), UE IP address or PDN information (i.e. APN, if available), and
decides which Diameter realm UE belongs to.
3\. The DRA-like entity constructs a PCRF address inquiring request according
to the information obtained in step 2 and sends the request to the DRA which
the UE belongs to.
4\. The DRA inquires the PCRF address from the saved PCRF routing information.
5\. The DRA returns the PCRF address to the DRA-like entity in PCRF address
inquiring answer.
**After the DRA-like entity gets the PCRF address, it can establish the Rx
session with the PCRF in either proxy based mode or redirect based mode. The
steps are similar to the current DRA procedures in 3GPP TS 29.213 [4]. Proxy
based mode refers to step 6a\~6c, and Redirect based mode refers to
step6A\~6C.**
##### 6.3.2.1.3 Solution 3: DRA-like entity supporting DRA functionalities
When the DRA-like entity **inherits the whole DRA functionalities with
supporting XML based protocols, the related routing procedures are the same as
in the current procedures in 3GPP TS 29.213 [4] with the adaptation of
protocols over Rx.**
#### 6.3.2.2 Roaming cases
In roaming cases, the V-PCRF establishes S9 session with the H-PCRF to
transmit the service info after it receives the XML based Rx session
establishment Request. The procedures for the V-PCRF to establish S9 session
with the H-PCRF are similar to 6.3.2.1.
##### 6.3.2.2.1 Solution1b: DRA-like entity interacting with DRA to get the
PCRF address based on diameter protocol
Figure 6.3.2.2.1.1: DRA-like entity interacting with DRA to get the\ PCRF
address based on diameter protocol (roaming)
The procedures are the same as in Figure 6.3.2.1.1.1. The difference is that
the V-PCRF may take the URL of the V-PCRF to the H-PCRF in step1/6a or step6B,
which is used by the H-PCRF to initiate Rx session modification request to the
V-PCRF.
##### 6.3.2.2.2 Solution2b: DRA-like interacting with DRA to get the PCRF
address based on XML based protocol
Figure 6.3.2.2.2.1: DRA-like entity interacting with DRA to get the\ PCRF
address based on XML based protocol (roaming)
The procedures are the same as in Figure 6.3.2.1.2.1. The difference is that
the V-PCRF may take the URL of the V-PCRF to the H-PCRF in step1/6a or step 6B
which is used by the H-PCRF to initiate Rx session modification request to the
V-PCRF.
##### 6.3.2.2.3 Solution3b: DRA-like entity supporting DRA functionalities
As described in 6.3.2.1.3, the related routing procedures are the same as in
the current procedures in the roaming scenario.
#### 6.3.2.3 Evaluation
Considering that this solution requires that the PCRF is also a Diameter
server, it is considered that Solution 1 can be resolved with a Protocol
Converter (PC).
Solution 2 (DRA-like entity interacts with DRA to get the PCRF address based
on XML based protocol) needs the stage 2 work to define the interaction
between the DRA-like entity and the DRA via XML based protocols.
Solution 3 (DRA-like entity supporting DRA functionalities) needs the stage 2
work since the DRA-like entity has to provide both Diameter based and XML
based interfaces.
#### 6.3.2.4 Conclusion
For the PCRF web server architecture, considering that it is considered
acceptable that the PCRF web server can also act as a Diameter server and
considering the implications in roaming and routing that are outside stage 3
work, it is proposed to use the Protocol Converter plus the DRA as the way
forward solution for PCRF addressing.
The DRA-like entity would therefore not be required.
## 6.4 Evaluation
Table 6.4.1: Evaluation of Protocol Converter and PCRF Web-server
* * *
                                  *Protocol* Converter                                                                                                                                                                                                      *PCRF* Web-server
Complexity No additional complexity of the PCRF: with this architecture, the
PCRF still sees a Diameter Rx interface. Potential more complexity for the
PCRF to manage both Diameter and XML based interfaces in his network.
Extensibility No need for the PCRF to support the same functionalities over
different protocols. More difficult to evolve since it requires that the PCRF
supports two protocols over the same reference point. Limitations in the
current deployments (e.g. roaming and routing limitations) would make the
evolution more difficult. Consistency The \"consistency\" issue is handled at
the PC level, no additional task for the PCRF (the PC is in charge of securing
translation for messages generated by AF (e.g. correct parameter mapping from
XML to Diameter)). PCRF should check the consistency of the provided
information. Limitation for PCC deployment Multiple PCRFs can be deployed.
Only one PCRF can be deployed (DRA cannot be used to find the PCRF).
* * *
# 7 Rx protocols for 3^rd^ party web application developers
## 7.1 Transport solutions for Rx messages
Rx related information has to be transported between the AF and the PC or the
PCRF web server. It can be transported by different protocols as content on
top of them.
RESTful HTTP and SOAP are interpreted as a transport protocols. Bidirectional
communication has to be possible between the PCRF and the AF.
### 7.1.1 Transport protocols
#### 7.1.1.1 RESTful HTTP
Representational State Transfer (REST) style was developed by W3C Technical
Architecture Group (TAG) in parallel with HTTP/1.1, based on the existing
design of HTTP/1.0. The World Wide Web represents the largest implementation
of a system conforming to the REST architectural style. REST exemplifies how
the Web's architecture emerged by characterizing and constraining the macro-
interactions of the four components of the Web, namely origin servers,
gateways, proxies and clients, without imposing limitations on the individual
participants. As such, REST essentially governs the proper behaviour of
participants.
REST defines a set of architectural principles, which can be used to design
Web services. REST is described in clause 5 of Fielding's dissertation
"Representational State Transfer (REST)" [9] in detail. Therein it is
described as an architectural style consisting of the set of constraints
applied to elements within the architecture that better reflects the desired
properties of a modern Web architecture.
The following constraints can be listed
\- Client-Server
\- Stateless
\- Cacheable
\- Layered system
\- Code on demand
\- Uniform interface
The goals of REST are
\- scalability of component interactions
\- generality of interfaces
\- independent deployment of components
\- reduction of latency, enforce security and encapsulate legacy systems
REST is based on the strict usage of the following main HTTP methods:
\- POST: May create a resource state
\- PUT: May modify a resource state
\- GET: May query a resource state
\- DELETE: May delete a resource state
There is no restriction concerning to the information that the HTTP methods
may transport in comparison to the definition of HTTP in RFC 2616 [10].
Therefore, XML or JSON based Rx information can be transported easily by
RESTful methods.
REST facilitates the transaction between web servers by allowing loose
coupling between different services. REST is less strongly typed than its
counterpart, SOAP. The REST language uses nouns and verbs, and has an emphasis
on readability. Unlike SOAP, REST does not require XML parsing and does not
require a message header to and from a service provider. This ultimately uses
less bandwidth. REST error-handling also differs from that used by SOAP.
RestFul HTTP may be used to design an easy-to-use interface from application
developer point of view.
#### 7.1.1.2 SOAP
SOAP is a W3C recommendation. SOAP, originally defined as Simple Object Access
Protocol, is a protocol specification for exchanging structured information in
the implementation of Web Services. It relies on for its message format, and
uses other Application Layer protocols, which may be the Hypertext Transfer
Protocol (HTTP) or the Simple Mail Transfer Protocol (SMTP), for message
negotiation and transmission.
SOAP can construct the foundation layer of the web service protocol stack for
providing a basic messaging framework upon which web services can be built.
This XML based protocol consists of three parts:
  * an envelope, which defines what is in the message and how to process it
  * a set of encoding rules for expressing instances of application-defined data types
  * a convention for representing procedure calls and responses.
As an example of how SOAP procedures can be used in Rx interface, a SOAP
message is sent to the web site (i.e. the PCRF in this scenario) in which web
services are enabled, with the parameters needed for multiple kinds of
requirements. The PCRF then returns an XML-formatted document with the result
data. The data are returned in a standardized machine-parsable format.
The disadvantage of SOAP is its high complexity. It can be slow due to the
complex XML format. Therefore the complexity may be too high for the Rx
application.
### 7.1.2 HTTP and bidirectional communication
#### 7.1.2.1 Long polling and streaming
Standard HTTP was not defined for bidirectional communication. It uses short
polling. The client sends regular request and in case of no data the server
returns an empty response.
The server cannot initiate a connection with a client and cannot send
unrequested HTTP response to the client. Therefore, clients need to poll the
server periodically. This consumes bandwidth and is not efficient due to
reduction of responsiveness of the application.
Solutions for mechanism that work within the current scope of HTTP 1.0/1.1 are
HTTP long polling or HTTP streaming.
With HTTP long polling the server responds to a request when a particular
event, status or timeout has occurred. The server defers the response and
holds open a long poll request. The server is able to asynchronously initiate
communication.
HTTP streaming keeps a request indefinitely open and never terminates the
request or close the connection after server pushes data to the client.
#### 7.1.2.2 Two connections
In case that the full control of the Diameter Rx application shall be used the
PC or the PCRF web server must be able to sent notifications to the AF. This
could be reached by the definition of a notification URL to which the
notification can be send. In this sense the endpoints can be interpreted as a
server or a client in dependence of the action required. The notification URL
can be created during session set-up. The following shows an example dialogue
in which the notification URL is sent to the PC or the PCRF using the HTTP
POST method:
HTTP POST https://pcrfserver/rxapplication/fullcontrol/settings
> \
>
> \http://notificationserver/rxnotify\
>
> \
The settings dialogue may contain further parameters in order to prepare the
session. The session itself is set-up by a further HTTP POST dialogue, which
may contain a complete Rx message mapped to XML, for example.
## 7.2 Application level protocols and data structures
### 7.2.1 Proposal a: XML
The Extensible Markup Language (XML) is a generally accepted code of practice
developed by W3C. With XML it is possible to describe complex content in a
hierarchical model and it is a format to exchange information between
different applications and platforms. It does not have a defined tag list and
it is expandable. Tags may be defined by Document Type Definitions (DTDs) or
XML schemas.
A part of content of an AA-Request (AAA) command may look like as reflected in
the following figure 7.2.1.1:
{width="6.522916666666666in" height="3.9652777777777777in"}
Figure 7.2.1.1: AAR command (incomplete example) as XML message
This example only shows independent of whether all information is meaningful
or something is missing that XML can be used to transport already defined data
structures between the AF and the PCRF.
The XML schema (XSD) may be used to define the conditions of validity for the
XML document. Thus it defines the data types, elements and attributes that are
allowed to be used in the document.
### 7.2.2 Proposal b: JSON
JSON or JavaScript Object Notation, is a text-based open standard which is
designed for human-readable data interchange format. It is derived from the
JavaScript scripting language for representing simple data structures and
associative arrays, called objects. Despite its relationship to JavaScript, it
is language-independent, with parsers available for many languages.
The JSON format is described in IETF RFC 4627[7]. The official Internet media
type for JSON is application/json. The JSON filename extension is .json.
The JSON format is often used for serializing and transmitting structured data
over a network connection. It is used primarily to transmit data between a
server and web application, serving as an alternative to XML.
An example of a JSON based AA Request (AAR) command is shown in the following:
> { "AAR":
>
> {
>
> "Auth-Application-Id": "Value1",
>
> "Session-Id": "Value2",
>
> "Origin-Host": "Value3"
>
> "Origin- Realm": "Value4"
>
> "Destination- Host": "Value5"
>
> "Destination-Realm": "Value6"
>
> "AF-Application-Identifier": "Value7"
>
> "Media-Component-Description":
>
> {
>
> "Optional": "YES"
>
> "Media-Component-Number": "Value8",
>
> "AF-Application-Identifier": Value9,
>
> "Media-Sub-Component":
>
> {
>
> "Flow-Number": "Value10",
>
> "Flow-Status": "Value11",
>
> "Flow-Usage": "Value12",
>
> "Max-Requested-Bandwidth-UL": Value13,
>
> "Max-Requested-Bandwidth-DL": Value14,
>
> "AF-Signalling-Protocol": "Value15",
>
> "Flow-Description: "Value16",
>
> }
>
> }
>
> }
### 7.2.3 **Data type mapping**
XML is a technology-independent language of data format as Diameter, the main
data types are represented by the two languages as in table 7.2.3.1.
Table 7.2.3.1: Data types in XML and Diameter
* * *
                XML                   Diameter
String String OctetString Integer Int/NegativeInteger Integer/Unsigned Float
Float Float Enumeration Enumerations Enumerated Group Compound types Grouped
* * *
The data types of Float, Enumeration and Group have the same definition in
both languages. And the Integer of XML is a 32-bit signed while the Integer of
Diameter is a 32-bit unsigned. The String of XML is just normal string, and
for Diameter, OctetString specifies octets of binary or textual information.
Different from XML and Diameter, JSON is a data-interchange format. It is
capable of representing numbers, Booleans, strings, null, and arrays (ordered
sequences of values) and objects (string-value mappings) composed of these
values (or of other arrays and objects). It doesn't natively represent more
complex data types like functions, regular expressions, dates, and so on. If
the developers need to preserve such values, they can transform values since
they are serialized, or prior to de-serialization, to enable JSON to represent
additional data types.
## 7.3 Session management
### 7.3.1 General
For the Diameter based Rx interface, both the PCRF and the AF can initiate an
Rx procedure. However, XML based protocols such as SOAP or RESTful are one-way
protocols, which means only one network element can initiate a Rx procedure.
In this case, the AF acts as the client and the PCRF acts as the server and
the interaction request can only be initiated by the client AF.
In the 3GPP TS 29.214 [5], when the traffic plane events happen, PCRF needs to
inform the AF by ASR or RAR messages, and then the AF takes corresponding
actions. However, in context of XML based Rx, the behaviour that the server
(i.e. PCRF) sends requests to the client (i.e. AF) does not fulfil the rules
of SOAP or is treated as un-RESTful. Therefore, the traffic plane events
reporting mechanism should be adapted to XML based protocols.
The keep-alive technology should be applied for messages pushing from the
PCRF. Depending on different pushing mechanism, there are several candidate
solutions to traffic plane events reporting.
### 7.3.2 HTTP streaming
For the stream based solution, the PCRF (or the PC in case the PC is involved)
and the AF are connected by HTTP based protocol (such as SOAP), and the stream
based keep-alive technology is applied for messages pushing from the PCRF/PC.
The client sends a request firstly, and then the server replies multiple
messages as responses. Those responses for the same request can be treated as
a stream without terminating the HTTP connection. The responses will stop when
the connection is released. The one request-multiple responses mode is in
favour of the scenario that the PCRF can detect multiple traffic plane events
and report them to the AF under one HTTP connection without requesting it for
multiple times. The procedure is shown in figure 7.3.2.1:
Figure 7.3.2.1: Procedure of stream based solution
In case that the keep-alive stream based AF session has been established, the
AF initiates traffic plane events reporting procedure by sending a Traffic
plane event reporting request to the PCRF/PC. The PCRF/PC acknowledges the AF
after it receives the request. The PCRF/PC subscribes to the corresponding
event and waits for the occurrence of corresponding traffic plane events. When
the PCRF/PC detects one of the traffic plane events, it responds corresponding
parameters to the AF. After that, the PCRF/PC will keep the connection and
repeat the steps 5 to 6 of traffic plane event reporting. In the end, the
connection is released when the AF session terminates.
### 7.3.3 HTTP long polling
For the solution of long-polling, the PCRF (or the PC in case the PC is
involved) and the AF are connected by HTTP based protocol (such as SOAP), and
the long-polling based keep-alive technology is applied for PCRF messages
pushing. The client sends a request firstly, and the server does not reply the
request immediately, but keeps the connection for a while and then responds
until the preconfigured events happened. The response will stop when the
connection is released. The procedure is shown in figure 7.3.3.1:
Figure 7.3.3.1: Procedure of long-polling based solution
In case that the keep-alive based AF session has been established and the AF
has subscribed to the required traffic plane events, the PCRF/PC will
subscribe to the corresponding traffic plane events in the PCEF/PCRF. The AF
optionally sends HTTP Connection Availability Request to the PCRF/PC, to check
whether the long-polling based HTTP connection between the AF and the PCRF/PC
is available . The PCRF/PC responds the AF by a HTTP Connection Availability
Response message. The AF initiates traffic plane events reporting procedure by
sending a Traffic plane events reporting Request message to the PCRF/PC, and
the PCRF/PC keeps the connection. When the PCRF/PC detects one of the traffic
plane events, it reports corresponding event to the AF. After that, the steps
5 to 7 repeat until the connection is released when the AF session terminates.
NOTE: The mechanism of stream based solution is the same as \"HTTP Streaming\"
mentioned in IETF RFC 6202 [6] clause 3, and the mechanism of long-polling
based solution is the same as \"HTTP Long Polling\" mentioned in IETF RFC 6202
[6] clause 2.
### 7.3.4 Two TCP connections
The PCRF/PC and AF both support the HTTP client and HTTP server role. There
are two TCP connections between the PCRF/PC and the AF. One is initiated by
the AF, while the other is initiated by the PCRF/PC. If the AF establishes an
AF session (i.e. initiates the initial provisioning of session information),
the AF sends the HTTP request to the PCRF/PC. The HTTP request can re-use the
existing TCP connection. The AF assigns an AF session id which is used to
identify the AF session. The PCRF/PC stores the AF session id and service
information, and then responds to the AF. After this transaction, the HTTP
connection can be released but the TCP connection is kept. When the AF
modifies the AF session (i.e. initiates modification of session information),
the AF sends an HTTP request including the AF session id assigned in the AF
session establishment procedure. The PCRF/PC updates stored session
information according to the AF session id. When the PCRF/PC reports the
traffic plane event corresponding to the AF session, the PCRF/PC sends an HTTP
request to the AF. The HTTP request can re-use current existing TCP
connections. The request includes the AF session id assigned by the AF and
stored by the PCRF/PC during AF session establishment.
### 7.3.5 Evaluation
Table 7.3.5.1 summarizes the pros and cons of the solutions for session
management over XML based Rx.
Table 7.3.5.1: Evaluation of HTTP Long Polling/HTTP Streaming and Two TCP
connections
+----------------------+----------------------+----------------------+ | | Pros | Cons | +----------------------+----------------------+----------------------+ | HTTP Long | 1. Simplicity of | 1. In the case | | Polling/HTTP | the entity role | where one TCP | | Streaming | (The AF only | connection | | | acts as HTTP | serves one Rx | | | client and the | session there is | | | PCRF/PC only | a latency | | | acts as HTTP | problem in | | | server). | relation with | | | | delayed HTTP | | | | responses and | | | | the closing of | | | | HTTP connections | | | | where | | | | outstanding | | | | modifications of | | | | the same Rx | | | | session will be | | | | further delayed. | | | | Even procedures | | | | could fail | | | | because of this | | | | delay. | | | | | | | | 2. The maximum | | | | number of | | | | simultaneously | | | | supported Ues is | | | | limited with | | | | regards to the | | | | limited number | | | | of TCP | | | | connections in | | | | the network. | +----------------------+----------------------+----------------------+ | Two TCP connections | 1. The TCP | 1. More complexity | | | resources can be | of the entity | | | well saved and | role (Both the | | | reused on demand | AF and the | | | for all of the | PCRF/PC should | | | Rx sessions with | support the role | | | the provisioning | of HTTP client | | | of two TCP | and HTTP | | | connections for | server). | | | the interaction | | | | of both | | | | directions | | | | between the AF | | | | and the PCRF. | | | | | | | | 2. Low transmission | | | | latency due to | | | | its asynchronous | | | | transmission in | | | | two directions. | | +----------------------+----------------------+----------------------+
### 7.3.6 Conclusion
With the consideration that the TCP resources can be well saved and reused for
multiple end users on demand, it is recommended to use the \"Two TCP
connections\" as the way forward solution of session management.
## 7.4 Void
## 7.5 Evaluation
### 7.5.1 Comparison among XML based technologies
The relationship among several XML based technologies is illustrated in figure
7.5.1.1.
Figure 7.5.1.1: The relationship among XML based technologies
XML or JSON is a technology-independent data format which represents the
information exchanged between two entities in the Internet. SOAP protocol and
REST architectural style are technologies which are used for exchanging the
information formatted by XML. When constructing a XML based communication
solution, SOAP is always tightly coupled with XML while both XML and JSON can
be applied over REST architectural style.
The table below have a summary of comparison among SOAP, REST, XML and JSON.
The following aspects are recommended when evaluating XML based technologies
over Rx.
\- Readability.
\- Complexity of data processing in both the client and the server.
\- Extensibility.
\- Performance.
\- Security.
Table 7.5.1.1: Comparison of XML based technologies
* * *
                                                                    SOAP                                                                                                                      REST                                                      XML                    JSON
Readability Complex REST is easy and understandability. **Simple and almost no
modification of the client.** Complexity of data processing in both the client
and the server Based on any protocol such as HTTP, HTTPS, SMTP (Simple Mail
Transfer Protocol), and even JMS (Java Messaging Service). REST interfaces are
much easier to design and implement Complex Simpler than XML. Extensibility
Tightly coupled with XML High expandability - - Performance Inefficient High
response rate depending on the cache. **Less consumption and more powerful.**
Security Safe **Safer than JSON.** **Less safe than XML.**
* * *
# 8 Charging
The existing charging control functions (e.g. the Sponsored Data Connectivity)
over Rx apply, with the protocol adaptation from Diameter to XML.
# 9 Security
To guarantee the security of the communication over XML based Rx, the
following security issues should be considered:
1\. Client and Server authentication and authorization: The identity of the
3^rd^ party AF and the protocol converter (or PCRF web server) shall be
authenticated. Only a legal and authorized AF can access to the protocol
converter (or PCRF web server).
2\. Confidentiality: The connection between protocol converter (or PCRF web
server) and the AF should be private. The sensitive data transmission via XML
based Rx interface should be confidentiality protected.
3\. Integrity: The connection between protocol converter (or PCRF web server)
and the AF should provide each message with integrity check.
4\. Adaptability: Support of the best known security methods of the day.
HTTP is used within the REST concept and may be used as a transport solution
for SOAP. The most popular secure form of HTTP is HTTPS. Thus HTTP may
optionally be layered over a security layer.
NOTE: 3GPP SA3 is responsible for the definition of security issues.
# 10 Roaming and routing
The roaming and routing of the entities over XML based Rx interface is
described in subclause 6.2.3 for Protocol Converter architecture and in
subclause 6.3.2 for PCRF web server architecture. As a summary,
for the Protocol Converter architecture, in case that the PC is located in the
PLMN but is outside of the PCRF Diameter realm:
  1. If the PC has the realm identification and is located in the H-PLMN, the PC sends the user identity and PDN information if available to the DRA;
  2. If the PC does not have proper knowledge about the user identity and the PC is located in the HPLMN, the PC may use pre-configured information to find the DRA.
For the Protocol Converter architecture, in case that the PC is deployed in
one PCRF Diameter realm, the PC shall provide the DRA with the parameters
received from the AF for addressing the PCRF.
For the PCRF web server architecture, considering that the PCRF may still act
as a Diameter Server, it is proposed to use the Protocol Converter plus the
DRA for the PCRF addressing.
# 11 Conclusion and recommendation
Web application developer may use the 3GPP PCC system as an entry point for
end-to-end service control.\ It is assumed that 3^rd^ party web application
developers do not have a detailed understanding of telecom services and use
telecom services as they would use other web services.
The present document investigates a new interface which can be used by 3^rd^
party web application provider to access PCRF functionality.
## 11.1 Impacts on the PCC architecture
The stage 3 standard does not allow changing the existing PCC architecture
from requirement point of view and is linked to the recommendations of the
stage 2 standard. As a result the stage 3 definition can only provide an
interface to the web application developer community which provides the same
functionality as it is done by the Diameter based Rx interface. This
restriction does not mean that new entities must not be introduced. The
requirement to provide an equivalent to the Rx interface based on Diameter may
be provided by a protocol converter or a kind of web server integrated into
the PCRF. Subclause 6.4 evaluates both architectures in detail. The protocol
converter architecture has the advantage to hide the internal PCC
architecture. A clear disadvantage for the web server architecture is that DRA
cannot be used to find the PCRF.
## 11.2 Transport protocols and languages
The present document distinguishes between transport protocols on application
level which may be used to transport the communication component. The
communication component may use different languages that can be piggybacked on
the transport protocol.
Subclause 7.5 evaluates transport protocols and languages in detail.
On the transport level REST and SOAP are taken into account. The main
advantage of REST is its simplicity and understandability in comparison with
SOAP. It is proposed to use REST as transport protocol.
PCRF and AF can initiate Rx procedures. It is proposed to use the Two TCP
connections solution for bidirectional transport.
On language level XML provides a higher flexibility than JSON. This seems more
future proof.
## 11.3 Impacts on existing 3GPP specifications
It is proposed to define a new 3GPP TS in order to standardize the equivalent
to the Rx interface based on Diameter.
## 11.4 Recommendation for an XML based access of AF to the PCRF
It is recommended to use the following elements to provide an equivalent to
the Diameter based Rx interface:
  * Protocol converter architecture: (1) Protocol converter located in the PCRF realm; (2) Protocol converter located in the PLMN but outside of the PCRF realm; (3) There is only one logic protocol conveter in both above cases.
  * REST as transport solution on application level;
  * HTTP optionally layered over a security layer (HTTPS);
  * Two TCP connections solution for bidirectional transport;
  * XML as language to exchange Rx related information.
NOTE: The procedures of protocol converter by using two TCP connections are
described in Annex C.
Although PCRF web server architecture can be applied as a complementary use
case of XML based Rx in the real network, it's excluded from standardization
effort in the following WI phase due to the deployment restriction and left
for implementation issue.
These elements will enable a 3^rd^ party web application developer to use the
Rx functionality.
###### ### Annex A: Example -- XML schema (example 1)
# A.1 Example -- XML schema (example 1)
Editor's note: The following example XML schema and the analysis leading to it
needs further analysis in CT3 and has not been agreed as technically correct.
What is given herewith can be considered FFS.
## A.1.1 Analysis of Diameter Data Types and XML Schema Data Types
For this anaylsis the Diameter AAR message is considered. From 29.214
(v11.8.0), subclause 5.6.1 the following is the AAR message format:-
\ ::= \
\
{ Auth-Application-Id }
{ Origin-Host }
{ Origin-Realm }
{ Destination-Realm }
[ Destination-Host ]
[ IP-Domain-Id ]
**[ AF-Application-Identifier ]**
***[ Media-Component-Description ]**
**[ Service-Info-Status ]**
**[ AF-Charging-Identifier ]**
**[ SIP-Forking-Indication ]**
***[ Specific-Action ]**
***[ Subscription-Id ]**
***[ Supported-Features ]**
**[ Reservation-Priority ]**
**[ Framed-IP-Address ]**
**[ Framed-Ipv6-Prefix ]**
**[ Called-Station-Id ]**
**[ Service-URN ]**
**[ Sponsored-Connectivity-Data ]**
**[ MPS-Identifier ]**
**[ Rx-Request-Type ]**
***[ Required-Access-Info ]**
[ Origin-State-Id ]
*[ Proxy-Info ]
*[ Route-Record ]
*[ AVP ]
Table A.1.1.1 consider the individual data types of the AVPs of this AAR
command and considers the corresponding XML data type or the closest possible
XML data type.
Table A.1.1.1: Data types of AAR command
* * *
_AVPs_ _AVP CODE_ _DIAMTER DATA TYPE_ _XML SCHEMA DATA TYPE_ SessionId 263
UTF8String String AuthApplication 258 Unsigned32 UnsignedInt OriginHost 264
DiameterIdentity String OriginRealm 296 DiameterIdentity String
DestinationRealm 283 DiameterIdentity String DestinationHost 293
DiameterIdentity String **_IP-Domain-ID_** 537 OctetString String **_AF
Application Identifier_** 504 OctetString String **_Media Component
description_** 517 Grouped Group **_Service Info Status_** 527 Enum Int **_AF
charging identifier_** 505 OctetString String **_SIP-Forking-Indication_** 523
Enum Int **_Specific-Action_** 513 Enum Int **_Subscription-ID_** 443 Grouped
Group **_*Supported Features_** 628 Grouped Group **_Reservation-Priority_**
458 Enum Int **_Framed-IP-Address_** 8 OctetString String **_Framed-
IPv6-Prefix_** 97 OctetString String **_Service-URN_** 525 OctetString String
**Sponsored connectivity data** 530 Grouped Group **MPS Identifier** 528
OctetString String **Rx-Request-Type** 533 Enum Int ***Required Access Info**
536 Enum Int **Origin State ID** 278 Unsigned32 unsignedInt **Proxy Info** 284
Grouped Group **Route-Record** 282 DiameterIdentiy String
* * *
In table A.1.1.1 there are certain AVPs which are of data type group, denoting
embedded AVPs. There are also certain data types that do not match directly to
corresponding XML data types or that such XML data types do not exist. These
are considered and XML data types matches proposed in the following table
A.1.1.2 to table A.1.1.8
Table A.1.1.2 : Media component description AVP
* * *
_MEDIA COMPONENT DESCRIPTION AVP_ _AVP CODE_ _DIAMETER DATA TYPE_ _XML SCHEMA
DATA TYPE_ Media component number 518 Unsigned32 unsignedInt *Media sub
component 519 Grouped Group AFAppIdentifier 504 OctetString String MediaType
520 Enum Int MaxRequestedBWUL 516 Unsigned32 UnsignedInt MaxRequestedBWDL 515
Unsigned32 UnsignedInt FlowStatus 511 Enum Int ReservationPriority 458 Enum
Int RSBW 522 Unsigned32 UnsignedInt RRBW 521 Unsigned32 UnsignedInt *CodecData
524 OctetString String
* * *
Table A.1.1.3: Subscription-ID AVP
* * *
_SUBSCRIPTIONID AVP_ _AVP CODE_ _DIAMETER DATA TYPE_ _XML SCHEMA DATA TYPE_
Sub-ID-Type 450 Enum Int Sub-ID-Data 444 UTF8String String
* * *
Table A.1.1.4: Supported feature AVP
* * *
_SUPPORTED FEATURE AVP_ _AVP CODE (628)_ _DIAMETER DATA TYPE_ _XML SCHEMA DATA
TYPE_ Feature List ID Unsigned32 UnsignedInt Feature List Unsigned32
UnsignedInt
* * *
Table A.1.1.5: Sponsored connectivity data AVP
* * *
_SPONSORED CONNECTIVITY DATA AVP_ _AVP CODE_ _DIAMETER DATA TYPE_ _XML SCHEMA
DATA TYPE_ Sponsor Identity 531 UTF8String String App Service Provider
Identity 532 UTF8String String Granted Service Unit 431 Grouped Group Used
Service Unit 446 Grouped Group
* * *
Table A.1.1.6: Granted service unit AVP
* * *
_GRANTED SERVICE UNIT AVP_ _AVP CODE_ _DIAMETER DATA TYPE_ _XML SCHEMA DATA
TYPE_ Tariff Time Change 451 Time Time CC-Time 420 Unsigned32 UnsignedInt CC-
Money 413 Grouped Group Total Octets 421 Unisgned64 UnsignedInt Input Octets
412 Unisgned64 UnsignedInt Output Octets 414 Unisgned64 UnsignedInt Service
Specific Units 417 Unisgned64 UnsignedInt
* * *
Table A.1.1.7: Used service unit AVP
* * *
_USED SERVICE UNIT AVP_ _AVP CODE_ _DIAMETER DATA TYPE_ _XML SCHEMA DATA TYPE_
Tariff Change Usage 452 Enum Int CC-Time 420 Unsigned32 UnsignedInt CC-Money
413 Grouped Group Total Octets 421 Unisgned64 UnsignedInt Input Octets 412
Unisgned64 UnsignedInt Output Octets 414 Unisgned64 UnsignedInt Service
Specific Units 417 Unisgned64 UnsignedInt
* * *
Table A.1.1.8: Supported feature AVP
* * *
_SUPPORTED FEATURE AVP_ _AVP CODE (628)_ _DIAMETER DATA TYPE_ _XML SCHEMA DATA
TYPE_ Unit Value 445 Decimal Decimal Currency Code 425 Unsigned32 UnsignedInt
* * *
## A.1.2 "AVP Parameters" group
Diameter protocol is a message based protocol with two types of messages i.e.,
request message and answer message.
A diameter AVP (Attribute Value Pair) is a basic unit inside the diameter
message that carries the data. There must be at least one AVP inside the
diameter message. AVP code, AVP flags and AVPLength fields are mandatory
fields for every AVP in an Rx message, see Table A.1.2.1.
Table A.1.2.1: Format of a diameter AVP basic unit
* * *
AVP Code  
AVP Flags AVP Length Vendor Id (Optional)  
Data ..........
* * *
For these recurring three fields, one could group these as an "AVP Parameters"
in XML schema equivalent messages and reference that in every AVP element in
the XML Schema** _._** This will optimize the XML schema representation for
any AVP in the diameter protocol. The XML representation of this "AVP
Parameters" type is as given below:
{width="4.156944444444444in" height="1.4791666666666667in"}
This "AVP Parameters" group (given above) is referenced in every AVP in the
diameter message using the reference attribute. An example of the usage of AVP
parameter group is given below:
{width="4.042361111111111in" height="1.3541666666666667in"}
The above example is for the SessionID AVP included in the AARequest message
(Rx message).The AVP parameter is referenced using the XML ref attribute which
optimising the XML representation for the Rx messages instead of all the three
AVP field being explicitly include for every AVP element represented in the
XML schema.
## A.1.3 XML schema for Diameter AAR applying "AVP Parameters" group
Applying the logic in subclauses A.1.1 and A.1.2, the following XML schema for
the AAR message is derived.
NOTE: The following XML schema has been check and does compile without errors.
### A.1.3.1 Diameter Header
{width="5.625694444444444in" height="2.59375in"}
\
{width="5.759722222222222in" height="2.1979166666666665in"}
### A.1.3.2 AVP Parameter Group
\
{width="4.156944444444444in" height="1.4791666666666667in"}
> **_AVP code, AVP flags and AVPLength fields are mandatory fields for every
> AVP in an Rx message. Hence in the XML equivalent message these three fields
> are grouped as an AVP parameter group and referenced in every AVP element in
> the XML Schema._**
### A.1.3.3 Session ID AVP
> \
>
> {width="4.042361111111111in" height="1.3541666666666667in"}
### A.1.3.4 Auth-Application ID AVP
> \
>
> {width="4.354861111111111in" height="1.34375in"}
### A.1.3.5 Origin Host AVP
> \
>
> {width="5.509722222222222in" height="1.3229166666666667in"}
### A.1.3.6 Origin Realm AVP
> \{width="5.436805555555556in" height="1.3229166666666667in"}
### A.1.3.7 Destination Realm AVP
> \
>
> {width="5.448611111111111in" height="1.3333333333333333in"}
### A.1.3.8 Destination Host AVP
> \
{width="5.469444444444444in" height="1.3229166666666667in"}
### A.1.3.9 IP Domain ID AVP
> \
>
> {width="5.469444444444444in" height="1.34375in"}
### A.1.3.10 AFAppIdentifier AVP
> \
>
> {width="5.520138888888889in" height="1.3229166666666667in"}
### A.1.3.11 Media Component Description AVP
> \
>
> {width="4.780555555555556in" height="2.0208333333333335in"}
>
> **_This AVP is of group type. The mapping of this group type in XML schema
> involves defining a Media Group type defined as follows:_**
>
> {width="6.363888888888889in" height="4.343055555555556in"}
>
> {width="4.749305555555556in" height="3.9993055555555554in"}
>
> {width="4.707638888888889in" height="4.009722222222222in"}
>
> {width="6.4875in" height="1.6875in"}
### A.1.3.12 Service Info Status AVP
> \
>
> {width="3.801388888888889in" height="1.3333333333333333in"}
### A.1.3.13 AF Charging Identifier AVP
> \
>
> {width="5.395138888888889in" height="1.3541666666666667in"}
### A.1.3.14 SIP Forking Indication AVP
> \
{width="3.9069444444444446in" height="1.3645833333333333in"}
### A.1.3.15 Specific Action AVP
> \
{width="4.990277777777778in" height="1.3541666666666667in"}
### A.1.3.16 Subscription ID AVP
> \
{width="4.563194444444444in" height="2.0416666666666665in"}
> **_This AVP is of group type. The mapping of this group type in XML schema
> involves defining a SubscriptionGroup type defined as follows:_**
{width="4.915972222222222in" height="3.3131944444444446in"}
### A.1.3.17 Supported Features AVP
> \
{width="4.895138888888889in" height="1.9895833333333333in"}
> **_This AVP is of group type. The mapping of this group type in XML schema
> involves defining a SupportedFeaturesGroup type defined as follows:_**
{width="5.343055555555556in" height="4.698611111111111in"}
### A.1.3.18 Reservation Priority AVP
> \
>
> {width="3.8131944444444446in" height="1.3333333333333333in"}
### A.1.3.19 Framed IP address AVP
> \
>
> {width="5.490277777777778in" height="1.34375in"}
### A.1.3.20 Framed Ipv6 prefix AVP
> \
>
> {width="5.478472222222222in" height="1.34375in"}
### A.1.3.21 Service URN AVP
> \
>
> {width="5.520138888888889in" height="1.34375in"}
### A.1.3.22 Sponsored Connectivity Data AVP
> \
>
> {width="5.125694444444444in" height="2.0in"}
>
> **_This AVP is of group type. The mapping of this group type in XML schema
> involves defining a SponsoredConnectivityGroup type defined as follows:_**
>
> {width="5.625694444444444in" height="5.177777777777778in"}
>
> {width="5.490277777777778in" height="2.34375in"}
>
> **_The sponsoredConnectivityGroup has further level of nesting with the
> group data type which is grouped as GrantedServiceGroup and UserServiceGroup
> as defined below:_**
>
> {width="5.313194444444444in" height="5.009722222222222in"}
>
> {width="4.499305555555556in" height="4.009722222222222in"}
>
> {width="5.406944444444444in" height="4.656944444444444in"}
>
> {width="4.343055555555556in" height="4.698611111111111in"}
>
> {width="5.406944444444444in" height="2.9993055555555554in"}
>
> **_The GrantedServiceGroup and UserServiceGroup have further level of
> nesting with the group data type which is grouped as MoneyGroup as defined
> below:_**
>
> {width="5.292361111111111in" height="3.3430555555555554in"}
### A.1.3.23 MPS Identifier AVP
> \
{width="5.572222222222222in" height="1.3333333333333333in"}
### A.1.3.24 Rx-Request-Type AVP
> \
{width="4.021527777777778in" height="1.34375in"}
### A.1.3.25 Required- Access- Info AVP
> \
{width="4.093055555555556in" height="1.3854166666666667in"}
### A.1.3.26 Origin State ID AVP
> \
{width="4.363888888888889in" height="1.3541666666666667in"}
### A.1.3.27 Proxy Info AVP
> \
{width="4.584027777777778in" height="1.9791666666666667in"}
> **_This AVP is of group type. The mapping of this group type in XML schema
> involves defining a ProxyInfoGroup type defined as follows:_**
{width="4.936805555555556in" height="3.3430555555555554in"}
### A.1.3.28 Route Record AVP
> \
{width="5.572222222222222in" height="1.34375in"}
###### ### Annex B: Consideration on charging extension
Some further charging functions could be considered in the context of XML
based Rx:
In the current specification, event based charging is only applicable to
predefined PCC rules or PCC rules with an application detection filter (i.e.
application identifier). The PCEF supports either combined volume and event or
combined duration and event based measurement for charging.
The consumer may pay for consuming the content from the 3^rd^ party AF, and
therefore the operator applies more measurement methods for charging the
consumer on behalf of the 3^rd^ party. Duration based or event based charging
may be performed together with the routine volume based charging. The 3^rd^
party AF should indicate the PC/PCRF that the measurement method combines
volume with either duration or event.
The extended measurement method of the 3^rd^ party described above is out of
the scope of this technical report and may be considered in future release.
###### ### Annex C: The procedures of protocol converter by using two TCP
connections
# C.1 General
This annex describes the procedures which use the two TCP connections solution
as defined in clause 7.3.4 to implement the interaction between the AF and the
protocol converter. The AF in the annex C.2, C.3 and C.4 uses one TCP
connection to send the HTTP request message to the protocol converter and the
protocol converter in the annex C.5 and C.6 uses the other TCP connection to
send the HTTP request message to the AF.
# C.2 AF Session Establishment
Figure C.2.1: AF session establishment
  1. The AF sends the HTTP request to the PC including a new AF session id and the parameters described in clause 4.4.1 of 3GPP TS 29.214 [5]. The AF session id uniquely identifies the AF session.
  2. -3. Same as the steps 2-3 in figure 6.2.2.1.1
```{=html}
``` 4\. The PC converts the AAA and provides the acknowledge information to
the AF by sending the HTTP response.
# C.3 AF Session Modification initiated by AF
Figure C.3.1: AF session modification initiated by AF
  1. The AF sends the HTTP request to the PC including AF session id allocated duing the AF session establishment and the parameters described in subclause 4.4.2 of 3GPP TS 29.214 [5].
  2. -3. Same as the steps 2-3 in figure 6.2.2.2.1. The PC includes the Diameter session id corresponding to the AF session id in the AAR command.
```{=html}
``` 4\. The PC converts the AAA and provides the acknowledge information to
the AF by sending the HTTP response.
# C.4 AF Session Termination initiated by the AF
Figure C.4.1: AF Session Termination
  1. The AF sends HTTP request to the PC including the AF session id allocated during the AF session establishment, an indication of AF session termination and the parameters described in subaclause 4.4.4 of 3GPP TS 29.214 [5].
  2. -3. Same as the steps 2-3 in figure 6.2.2.4.1. The PC includes the Dimater Session id corresponding to the AF session id in the STR command.
```{=html}
``` 4\. The PC converts the STA and provides the acknowledge information to
the AF by sending the HTTP response.
# C.5 Notification of traffic plane events
Figure C.5.1: Notification of user plane events
  1. -2. Same as the steps 1-2 of subclause 6.2.2.6.1.
```{=html}
``` 3\. The PC converts the Diameter RAR command and sends the HTTP request to
the AF. The PC includes the AF session id corresponding to the Diameter
session id and corresponding specific actions.
  1. The AF responds the HTTP response to the PC.
  2. Same as step 5 of subclause 6.2.2.6.1.
# C.6 AF Session Termination initiated by the PCRF
Figure C.6.1: AF session termination initiated by the PCRF
  1. The PCRF receives the trigger that the AF session needs to be terminated.
  2. The PCRF sends the ASR command to the protocol converter;
  3. The protocol convert sends the HTTP request message to the AF by including the AF session id corresponding to the Diameter session id to inform the AF that AF session is requested to be terminated.
  4. The AF responds to the PCRF with HTTP response message.
  5. The protocol converter sends the ASA command to the PCRF.
  6. Step 1 to step 4 defined in Figure C.4.1 are performed. If the access network information reporting is not supported over Rx reference point, the step 1 and step 4 defined in Figure C.4.1 are not performed.
#
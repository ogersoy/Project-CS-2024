# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
This document provides the stage 3 specification of the PC2 reference point.
The functional requirements and the stage 2 procedures of the PC2 reference
point are contained in 3GPP TS 23.303 [2]. The PC2 reference point lies
between the ProSe Function and ProSe Application Server.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".
[3] IETF RFC 3588: \"Diameter Base Protocol\".
[4] IETF RFC 791: \"Transmission Control Protocol\".
[5] IETF RFC 4960: \"Stream Control Transmission Protocol\".
[6] 3GPP TS 33.303: \"Proximity-based Services (ProSe); Security aspects\".
[7] 3GPP TS 29.345: \"Inter-Proximity-services (ProSe) Function signalling
aspects; Stage 3\".
[8] IETF RFC 5719: \"Updated IANA Considerations for Diameter Command Code
Allocations\".
[9] IETF RFC 2234: \"Augmented BNF for syntax specifications\".
[10] 3GPP TS 24.334: \"Proximity-services (ProSe) User Equipment (UE) to
Proximity-services (ProSe) Function Protocol aspects; Stage 3\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1]. The term definition in the present document has a
reference to that in 3GPP TS 23.303 [2].
**EPC-level ProSe Discovery:** A ProSe Discovery procedure by which the EPC
determines the proximity of two ProSe-enabled UEs and informs them of their
proximity.
**ProSe Discovery:** A process that identifies that a UE that is ProSe-enabled
is in proximity of another, using E-UTRA (with or without E-UTRAN) or EPC.
**ProSe Function ID:** An FQDN that identifies a ProSe Function.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
ALUID Application Layer User ID
AVP Attribute-Value Pair
EPUID EPC ProSe User ID
PFID ProSe Function ID
ProSe Proximity-based Services
# 4 PC2 reference point
## 4.1 PC2 reference model
Proximity Services (ProSe) are services that can be provided by the 3GPP
system based on UEs being in proximity to each other. The PC2 reference point
is located between the ProSe Application Server and the ProSe Function. It is
used to define the interaction between ProSe Application Server and ProSe
functionality provided by the 3GPP EPS via ProSe Function (e.g. name
translation) for EPC-level ProSe discovery.
The stage 2 level requirements for the PC2 reference point are defined in 3GPP
TS 23.303 [2].The relationships between the functional entities are depicted
in Figure 4.2-1.
NOTE: For EPC-level ProSe discovery the roaming architecture is not specified
in this release.
Figure 4.1.1: PC2 reference point in ProSe Architecture
## 4.2 Functional elements
### 4.2.1 ProSe Function
The ProSe Function is the logical function that is used for network related
actions required for ProSe. The ProSe Function plays different roles for each
of the features of ProSe. In this version of the specification it is assumed
that there is only one logical ProSe Function in each PLMN that supports
Proximity Services.
Over PC2 reference point, the ProSe Function supports EPC-level discovery by
the following functionality:
\- Storage of a list of applications that are authorized to use EPC-level
ProSe Discovery.
\- Handling of EPC ProSe User IDs and Application Layer User IDs;
\- Exchange of signalling with 3^rd^ party Application Servers for application
registration and identifier mapping;
The ProSe Function provides the necessary charging and security functionality
for usage of ProSe via the EPC.
### 4.2.2 ProSe Application Server
The ProSe Application Server supports the following functionality:
\- Storage of EPC ProSe User IDs and ProSe Function IDs;
\- Mapping of Application Layer User IDs and EPC ProSe User IDs.
# 5 PC2 procedures
## 5.1 EPC-level ProSe discovery
### 5.1.1 Application registration for ProSe
#### 5.1.1.1 General Description
The application registration procedure is used by a ProSe Function serving the
originating UE to request the ProSe Application Server to register the UE's
Application Layer User ID (ALUID) with an EPC ProSe User ID (EPUID).
This procedure uses the Diameter commands ProXimity-Action-Request (PXR) and
ProXimity-Action-Answer (PXA) in the Diameter application as specified in
clause 6.
#### 5.1.1.2 Detailed description of the application registration for ProSe
procedure
The ProSe Function of the UE triggering the ProSe EPC-level discovery
application registration procedure shall send the ProXimity-Action-Request
(PXR) command to the ProSe Application Server of the specific application
requested by the UE in its initial Application Registration message. The ProSe
Function shall include in the request the ProSe-Request-Type AVP with the
value APPLICATION_REGISTRATION_FOR_PROSE (0), the Requesting-EPUID AVP with
the EPC ProSe User ID of the originating UE, the Origin-App-Layer-User-Id AVP
with the Application Layer User Identity of the originating UE, and the ProSe-
Function-ID AVP with the ProSe Function Identity of the originating UE.
When receiving a PXR command for application registration from a ProSe
Function, the ProSe Application Server shall process the request and respond
to the ProSe Function with a PXA command.
If the ProSe Application Server accepts the PXR command, it acknowledges the
reception of the PXR command for ProSe application registration and sets the
Result-Code AVP to \"SUCCESS\" in the PXA command. When receiving PXA from the
ProSe Application Server, the ProSe Function of the originating UE checks the
Result-Code AVP. If it indicates SUCCESS, the ProSe Function notifies the
originating UE, according to the ProSe EPC-level discovery application
registration procedure as specified in clause 7.2.3 of 3GPP TS 24.334 [10]. In
case of an unsuccessful application registration request, applicable value
defined in clause 6.7.3 shall be used to indicate the cause.
### 5.1.2 Proximity map request
#### 5.1.2.1 General
The Proximity map request procedure may be used by the ProSe Function to
request the EPC ProSe User identity for a targeted application user for which
the originating UE shall get alerts when in proximity of the targeted UE, and
the identity of the ProSe Function for this targeted UE as well. The identity
of the ProSe Function is used in the execution of the Proximity Request
procedure described in 3GPP TS 29.345 [7].
#### 5.1.2.2 Detailed description of the proximity map request procedure
To apply this procedure, the ProSe Function shall send a ProXimity-Action-
Request (PXR) command including the ProSe-Request-Type AVP with the value
PROSE_MAP_REQUEST (1), the Origin-App-Layer-User-ID AVP indicating the
application layer user identity of the originating UE and the Target-App-
Layer-User-ID AVP indicating the application layer user identity of the
targeted UE.
Upon reception of a PXR command including the Origin-App-Layer-User-ID AVP and
the Target-App-Layer-User-ID AVP, the ProSe Application Server shall determine
whether the originating UE is allowed to discover the targeted UE.
The ProSe Application Server shall then send a ProXimity-Action-Answer (PXA)
command including the Targeted-EPUID AVP and ProSe-Function-ID AVP indicating
the targeted UE and the corresponding ProSe Function ID respectively.\ In case
of an unsuccessful proximity map request, applicable value defined in clause
6.7.3 shall be used to indicate the cause.
# 6 PC2 protocol
## 6.1 Protocol Support
### 6.1.1 Use of Diameter base protocol
The Diameter Base Protocol as specified in IETF RFC 3588 [3] shall apply
except as modified by the defined support of the methods and the defined
support of the commands and AVPs, result and error codes as specified in this
specification. Unless otherwise specified, the procedures specified in IETF
RFC 3588 [3] (including error handling and unrecognised information handling)
shall be used unmodified. Only commands related to peer-to-peer connection are
re-used from the Diameter Base Protocol, i.e. Capabilities-Exchange-Request
(CER), Capabilities-Exchange-Answer (CEA), Disconnect-Peer-Request (DPR),
Disconnect-Peer-Answer (DPA), Device-Watchdog-Request (DWR) and Device-
Watchdog-Answer (DWA).
With regards to the Diameter protocol defined over the PC2 interface, the
ProSe Application Server shall act as the Diameter server, in the sense that
it is the network element that handles action requests. The ProSe Function
shall act as the Diameter client, in the sense that it is the network element
requesting actions.
A Diameter routing table entry can have a different destination based on the
application identifier of the command. The application identifier stored in
the command header must match the value of any application identifier AVPs in
the command body. Diameter agents (relay, proxy, redirection, translation
agents) should use the application identifier in the command header to route
to a suitable destination.
### 6.1.2 Transport protocol
Diameter messages over the PC2 interface shall make use of TCP IETF RFC 791
[4] or SCTP IETF RFC 4960 [5].
### 6.1.3 Advertising Application Support
The Diameter application identifier assigned to the PC2 interface application
is 16777337.
The ProSe Application Server and ProSe Function shall advertise support of the
Diameter PC2 application by including the value of the PC2 application
identifier in the Auth-Application-Id AVP within the Vendor-Specific-
Application-Id grouped AVP of the CER and CEA commands.
The vendor identifier value of 3GPP (10415) shall be included in the
Supported-Vendor-Id AVP of the CER and CEA commands, and in the Vendor-Id AVP
within the Vendor-Specific-Application-Id grouped AVP of the CER and CEA
commands.
The Vendor-Id AVP included in CER and CEA commands that is not included in the
Vendor-Specific-Application-Id AVPs as described above shall indicate the
manufacturer of the Diameter node as per IETF RFC 3588 [3].
## 6.2 Initialization and maintenance of connection and session
A peer-to-peer connection is a connection between ProSe Application Server and
ProSe Function.
A PC2 Diameter session shall consist of a single request and answer pair. The
PC2 Diameter session is terminated after each request and answer pair
interaction. In order to indicate that the session state is not to be
maintained, the Diameter client and server shall include the Auth-Session-
State AVP with the value set to NO_STATE_MAINTAINED (1), in the request and in
the answer messages (see IETF RFC 3588 [3]).
## 6.3 Security over PC2 reference point
Security aspects of ProSe PC2 reference point are defined in 3GPP TS 33.303
[6].
## 6.4 PC2 specific AVPs
### 6.4.1 General
Table 6.4.1-1 describes the Diameter AVPs defined for the PC2 reference point,
their AVP Code values, types and possible flag values. The Vendor-Id header of
all AVPs defined in the present document shall be set to 3GPP (10415).
Table 6.4.1-1: PC2 specific Diameter AVPs
* * *
                                                                                                                                                                                                                                                                                                             AVP Flag rules (Note 1)
Attribute Name AVP Code Clause defined Value Type Must May Should not Must not
Origin-App-Layer-User-Id 3600 6.4.2 UTF8String M,V P  
Target-App-Layer-User-Id 3601 6.4.3 UTF8String M,V P  
ProSe-Function-ID 3602 6.4.4 OctetString M,V P  
ProSe-Request-Type 3603 6.4.5 Unsigned32 M,V P  
NOTE 1: The AVP header bit denoted as \'M\', indicates whether support of the
AVP is required. The AVP header bit denoted as \'V\', indicates whether the
optional Vendor-ID field is present in the AVP header. For further details,
see IETF RFC 3588 [3].
* * *
### 6.4.2 Origin-App-Layer-User-Id AVP
The Origin-App-Layer-User-Id AVP (AVP code 3600) is of type UTF8String, and it
contains an identity identifying an origin user within the context of a
specific application (e.g. alice\@social.net).
### 6.4.3 Target-App-Layer-User-Id AVP
The Target-App-Layer-User-Id AVP (AVP code 3601) is of type UTF8String, and it
contains an identity identifying a target user within the context of a
specific application (e.g. tommy\@social.net).
### 6.4.4 ProSe-Function-ID AVP
The ProSe-Function-ID AVP (AVP code 3602) is of type OctetString, and it
indicates an FQDN that identifies a ProSe Function.
### 6.4.5 ProSe-Request-Type AVP
The ProSe-Request-Type AVP (AVP code 3603) is of type Unsigned32, and contains
the reason for sending the PA-Request message.
The following values are defined:
0 (APPLICATION_REGISTRATION_FOR_PROSE):
The ProXimity-Action-Request message is sent to initiate an application
registration for ProSe procedure.
1 (PROSE_MAP_REQUEST):
The ProXimity-Action-Request message is sent to initiate a Proximity map
request procedure.
## 6.5 PC2 re-used AVPs
Table 6.5.1-1 lists the Diameter AVPs re-used by the PC2 reference point from
existing Diameter Applications, reference to their respective specifications
and a short description of their usage within the PC2 reference point. Other
AVPs from existing Diameter Applications, except for the AVPs from Diameter
base protocol, do not need to be supported. The AVPs from Diameter base
protocol are not included in Table 6.5.1-1, but they are re-used for the PC2
reference point. Unless otherwise stated, re-used AVPs shall maintain their
\'M\', \'P\' and \'V\' flag settings.
Table 6.5.1-1: PC2 re-used Diameter AVPs
* * *
Attribute Name Reference Description Requesting-EPUID 3GPP TS 29.345 [7]
Contains an identifier for EPC-level ProSe Discovery that uniquely identifies
a UE registered for ProSe triggering a Proximity request. Targeted-EPUID 3GPP
TS 29.345 [7] Contains an identifier for EPC-level ProSe Discovery that
uniquely identifies a UE registered for ProSe targeted by a Proximity request.
* * *
## 6.6 PC2 messages
### 6.6.1 Command-Code Values
This section defines the Command-Code values for the PC2 interface application
as allocated by IANA from the vendor-specific namespace defined in IETF RFC
5719 [8]. Every command is defined by means of the ABNF syntax in IETF RFC
2234 [9], and according to the rules in IETF RFC 3588 [3].
The following Command Codes are defined in this specification:
Table 6.6.1.1: Command-Code values for PC2
* * *
Command-Name Abbreviation Code Section ProXimity-Action-Request PXR 8388676
6.6.2 ProXimity-Action-Answer PXA 8388676 6.6.3
* * *
For the commands defined in this specification and reused commands, the
Application-ID field shall be set to 16777337.
### 6.6.2 ProXimity-Action-Request (PXR) command
The PXR command, indicated by the Command-Code field set to 8388676 and the
\'R\' bit set in the Command Flags field, is sent by the ProSe Function to the
ProSe Application Server as part of the application registration or map
request procedure.
Message Format:
\ ::= \
\
{ Auth-Application-Id }
{ Auth-Session-State }
{ Origin-Host }
{ Origin-Realm }
{ Destination-Realm }
[ Destination-Host ]
[ Origin-State-Id ]
*[ Proxy-Info ]
*[ Route-Record ]
{ ProSe-Request-Type }
[ **Origin-** App-Layer-User-Id ]
[ **Target-** App-Layer-User-Id **]**
**[ Requesting-EPUID ]**
[ ProSe-Function-ID ]
*[ AVP ]
### 6.6.3 ProXimity-Action-Answer (PXA) command
The PXA command, indicated by the Command-Code field set to 8388676 and the
\'R\' bit cleared in the Command Flags field, is sent by the ProSe Application
Server to the ProSe Function in response to the PXR command as part of the
application registration or Proximity map request procedure.
Message Format:
\ ::= \
\
{ Auth-Application-Id }
{ Auth-Session-State }
{ Origin-Host }
{ Origin-Realm }
[ Result-Code ]
[ Experimental-Result ]
[ Error-Message ]
[ Error-Reporting-Host ]
*[ Failed-AVP ]
[ Origin-State-Id ]
*[ Redirect-Host ]
[ Redirect-Host-Usage ]
[ Redirect-Max-Cache-Time ]
*[ Proxy-Info ]
{ ProSe-Request-Type }
**[ Targeted-EPUID ]**
[ ProSe-Function-ID ]
*[ AVP ]
## 6.7 PC2 specific Experimental-Result-Code AVP values
### 6.7.1 General
This clause defines result code values that shall be supported by Diameter
implementations that conform to this specification.
### 6.7.2 Success
Result Codes that fall into the Success category are used to inform a peer
that a request has been successfully completed. The Result-Code AVP values
defined in Diameter BASE IETF RFC 3588 [3] are applied.
### 6.7.3 Failures
Errors that fall into the Failures category shall be used to inform the peer
that the request has failed. The Result-Code AVP values defined in Diameter
Base Protocol IETF RFC 3588 [3] are applied. When one of the result codes as
defined below is included in the PXA command, it is included in an
Experimental-Result AVP and the Result-Code AVP is absent.
#### 6.7.3.1 DIAMETER_ERROR_ORIGIN_ALUID_UNKNOWN (5590)
This result code indicates that there is no valid context associated to the
origin ALUID received in the request.
#### 6.7.3.2 DIAMETER_ERROR_TARGET_ALUID_UNKNOWN (5591)
This result code indicates that there is no valid context associated to the
target ALUID received in the request.
#### 6.7.3.3 DIAMETER_ERROR_PFID_UNKNOWN (5592)
This result code indicates that there is no valid ProSe Function associate to
the PFID received in the request.
#### 6.7.3.4 DIAMETER_ERROR_APP_REGISTER_REJECT (5593)
This result code indicates that the ProSe Application Server cannot accept the
application registration request for an unspecific reason.
#### 6.7.3.5 DIAMETER_ERROR_PROSE_MAP_REQUEST_DISALLOWED (5594)
This result code indicates that the ProSe Application Server cannot accept the
map request because the targeted application user is not allowed to be
discovered by the originating application user.
#### 6.7.3.6 DIAMETER_ERROR_MAP_REQUEST_REJECT (5595)
This result code indicates that the ProSe Application Server cannot accept the
map request for an unspecific reason.
###### ## Annex A (informative): Call Flows over PC2
# A.1 Application registration for ProSe
The Application registration for ProSe procedure is used by the UE to register
an application with the ProSe Function to activate ProSe features e.g. EPC-
level ProSe discovery for a specific application.
Figure A.1.1: Application registration for ProSe Procedure
1\. When the ProSe Function have received an application registration request,
as defined in 3GPP**** TS 24.334 [10], from the originating UE and the
requested application is on the stored list of authorised Application IDs, the
ProSe Function sends a PXR command to the ProSe Application Server including
the parameters as defined in clause 5.1.1.
2\. The ProSe Application Server determines whether the registration can be
accepted for the originating UE.
3\. The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in clause 5.1.1.
4\. The ProSe Function send a response message to the originating UE
indicating that the registration was successful (or not) as defined in 3GPP TS
24.334 [10].
# A.2 Proximity map request
The proximity map request procedure is used by the ProSe Function to request
the identity of the ProSe Function for the targeted UE for which the
originating UE shall get alerts when in proximity of the targeted UE.
Figure A.2.1: Proximity map request procedure
1\. When the ProSe Function have received a proximity request, as defined in
3GPP TS 24.334 [10], from the UE the ProSe Function sends a PXR command to the
ProSe Application Server including the parameters as defined in clause 5.1.2.
2\. The ProSe Application Server determines whether the originating UE is
allowed to discover the targeted UE.
3\. The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in clause 5.1.2.
4\. If the mapping is successful, the ProSe Function initialize the proximity
request procedure as defined in 3GPP TS 29.345 [7].
#
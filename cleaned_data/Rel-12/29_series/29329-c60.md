# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document defines a transport protocol for use in the IP multimedia
(IM) Core Network (CN) subsystem based on Diameter.
The present document is applicable to:
\- The Sh interface between an AS and the HSS.
\- The Sh interface between an SCS and the HSS.
Whenever it is possible this document specifies the requirements for this
protocol by reference to specifications produced by the IETF within the scope
of Diameter. Where this is not possible, extensions to Diameter are defined
within this document.
# 2 References
The following documents contain provisions, which through reference in this
text constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 29.328 \"IP Multimedia (IM) Subsystem Sh interface; signalling
flows and message contents\".
[2] 3GPP TS 33.210 \"3G Security; Network Domain Security; IP Network Layer
Security\".
[3] IETF RFC 2960 \"Stream Control Transmission Protocol\".
[4] IETF RFC 3588 \"Diameter Base Protocol\".
[5] IETF RFC 2234 \"Augmented BNF for syntax specifications\".
[6] 3GPP TS 29.229 \"Cx and Dx Interfaces based on the Diameter protocol;
protocol details\".
[7] IETF RFC 3589 \"Diameter Command Codes for Third Generation Partnership
Project (3GPP) Release 5\".
[8] ITU-T Recommendation E.164: \"The international public telecommunication
numbering plan\".
[9] 3GPP TR 33.978 \"Security aspects of early IP Multimedia Subsystem (IMS)
(Release 6)\".
[10] 3GPP TS 29.364 \"IMS Application Server Service Data Descriptions for AS
interoperability\".
[11] 3GPP TS 29.002 \"Mobile Application Part (MAP) specification\".
[12] IETF RFC 7683: \"Diameter Overload Indication Conveyance\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
Refer to IETF RFC 3588 [4] for the definitions of some terms used in this
document.
For the purposes of the present document, the following terms and definitions
apply.
**Attribute-Value Pair** : see IETF RFC 3588 [4], it corresponds to an
Information Element in a Diameter message.
**Server** : SIP-server.
**User data** : user profile data.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
AAA Authentication, Authorization and Accounting
AS Application Server
> ABNF Augmented Backus-Naur Form
AVP Attribute-Value Pair
CN Core Network
HSS Home Subscriber Server
IANA Internet Assigned Numbers Authority
IETF Internet Engineering Task Force
IMS IP Multimedia Subsystem
NDS Network Domain Security
RFC Request For Comment
SCTP Stream Control Transport Protocol
UCS Universal Character Set
URL Uniform Resource Locator
UTF UCS Transformation Formats
# 4 General
The Diameter Base Protocol as specified in IETF RFC 3588 [4] shall apply
except as modified by the defined support of the methods and the defined
support of the commands and AVPs, result and event codes specified in clause 6
of this specification. Unless otherwise specified, the procedures (including
error handling and unrecognised information handling) are unmodified.
# 5 Use of the Diameter base protocol
The same clarifications of section 5 of 3GPP TS 29.229 [6] shall apply to the
Sh interface. An exception is that the application identifier for this
application is defined in chapter 6.
# 6 Diameter application for Sh interface
This clause specifies a Diameter application that allows a Diameter server and
a Diameter client:
\- to download and update transparent and non-transparent user data
\- to request and send notifications on changes on user data
The Sh interface protocol is defined as an IETF vendor specific Diameter
application, where the vendor is 3GPP. The vendor identifier assigned by IANA
to 3GPP ( http://www.iana.org/assignments/enterprise-numbers) is 10415.
The Diameter application identifier assigned to the Sh interface application
is 16777217 (allocated by IANA).
## 6.1 Command-Code values
This section defines Command-Code values for this Diameter application.
Every command is defined by means of the ABNF syntax (as defined in RFC 2234
[5]), according to the rules in IETF RFC 3588 [4]. Whenever the definition and
use of an AVP is not specified in this document, what is stated in 3GPP TS
29.229 [6] shall apply.
The command codes for the Sh interface application are taken from the range
allocated by IANA in IETF RFC 3589 [7] as assigned in this specification. For
these commands, the Application-ID field shall be set to 16777217 (application
identifier of the Sh interface application, allocated by IANA).
The following Command Codes are defined in this specification:
Table 6.1.1: Command-Code values
* * *
Command-Name Abbreviation Code Section User-Data-Request UDR 306 6.1.1 User-
Data-Answer UDA 306 6.1.2 Profile-Update-Request PUR 307 6.1.3 Profile-Update-
Answer PUA 307 6.1.4 Subscribe-Notifications-Request SNR 308 6.1.5 Subscribe-
Notifications-Answer SNA 308 6.1.6 Push-Notification-Request PNR 309 6.1.7
Push-Notification-Answer PNA 309 6.1.8
* * *
### 6.1.1 User-Data-Request (UDR) Command
The User-Data-Request (UDR) command, indicated by the Command-Code field set
to 306 and the 'R' bit set in the Command Flags field, is sent by a Diameter
client to a Diameter server in order to request user data.
Message Format
> \ ::= \
>
> \
>
> { Vendor-Specific-Application-Id }
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> [ Destination-Host ]
>
> { Destination-Realm }
>
> ***[ Supported-Features ]**
>
> **{ User-Identity }**
>
> **[ Wildcarded-Public-Identity ]**
>
> **[ Wildcarded-IMPU ]**
>
> **[ Server-Name ]**
>
> ***[ Service-Indication ]**
>
> ***{ Data-Reference }**
>
> ***[ Identity-Set ]**
>
> **[ Requested-Domain ]**
>
> **[ Current-Location ]**
>
> ***[ DSAI-Tag ]**
>
> **[ Session-Priority ]**
>
> [ User-Name ]
>
> **[ Requested-Nodes ]**
>
> **[ Serving-Node-Indication ]**
>
> **[ Pre-paging-Supported ]**
>
> [ Local-Time-Zone-Indication ]
>
> [ UDR-Flags ]
>
> [ Call-Reference-Info ]
>
> [ OC-Supported-Features ]
*[ AVP ]
*[ Proxy-Info ]
*[ Route-Record ]
### 6.1.2 User-Data-Answer (UDA) Command
The User-Data-Answer (UDA) command, indicated by the Command-Code field set to
306 and the 'R' bit cleared in the Command Flags field, is sent by a server in
response to the User-Data-Request command. The Experimental-Result AVP may
contain one of the values defined in section 6.2 or in 3GPP TS 29.229 [6].
Message Format
> \ ::= \
>
> \
>
> { Vendor-Specific-Application-Id }
>
> [ Result-Code ]
>
> [ Experimental-Result ]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> ***[ Supported-Features ]**
>
> **[ Wildcarded-Public-Identity ]**
>
> **[ Wildcarded-IMPU ]**
>
> **[ User-Data ]**
>
> [ OC-Supported-Features ]
>
> [ OC-OLR ]
>
> *[ AVP ]
>
> *[ Failed-AVP ]
>
> *[ Proxy-Info ]
*[ Route-Record ]
### 6.1.3 Profile-Update-Request (PUR) Command
The Profile-Update-Request (PUR) command, indicated by the Command-Code field
set to 307 and the 'R' bit set in the Command Flags field, is sent by a
Diameter client to a Diameter server in order to update user data in the
server.
Message Format
> \ ::= \ >
>
> \
>
> { Vendor-Specific-Application-Id }
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> [ Destination-Host ]
>
> { Destination-Realm }
>
> ***[ Supported-Features ]**
>
> **{ User-Identity }**
>
> **[ Wildcarded-Public-Identity ]**
>
> **[ Wildcarded-IMPU ]**
>
> [ User-Name ]
>
> * **{** Data-Reference **}**
>
> { User-Data }
>
> [ OC-Supported-Features ]
>
> *[ AVP ]
>
> *[ Proxy-Info ]
>
> *[ Route-Record ]
NOTE: More than one Data-Reference AVP may be present in the message only if
both the AS and the HSS support the Update-Eff-Enhance feature. How the AS
knows whether the HSS supports the Update-Eff-Enhance feature is
implementation issue, e.g. the AS can get the information from a previous PUA
message.
### 6.1.4 Profile-Update-Answer (PUA) Command
The Profile-Update-Answer (PUA) command, indicated by the Command-Code field
set to 307 and the 'R' bit cleared in the Command Flags field, is sent by a
server in response to the Profile-Update-Request command. The Experimental-
Result AVP may contain one of the values defined in section 6.2 or in 3GPP TS
29.229 [6].
Message Format
> \ ::=\
>
> \
>
> { Vendor-Specific-Application-Id }
>
> [ Result-Code ]
>
> [ Experimental-Result ]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> **[ Wildcarded-Public-Identity ]**
>
> **[ Wildcarded-IMPU ]**
>
> **[ Repository-Data-ID ]**
>
> **[** Data-Reference **]**
>
> *[ Supported-Features ]
>
> [ OC-Supported-Features ]
>
> [ OC-OLR ]
>
> *[ AVP ]
>
> *[ Failed-AVP ]
>
> *[ Proxy-Info ]
>
> *[ Route-Record ]
NOTE: The Data-Reference AVP may be present in the message only if both the AS
and the HSS support the Update-Eff-Enhance feature.
### 6.1.5 Subscribe-Notifications-Request (SNR) Command
The Subscribe-Notifications-Request (SNR) command, indicated by the Command-
Code field set to 308 and the 'R' bit set in the Command Flags field, is sent
by a Diameter client to a Diameter server in order to request notifications of
changes in user data.
Message Format
> \ ::= \ 16777217 >
>
> \
>
> { Vendor-Specific-Application-Id }
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> [ Destination-Host ]
>
> { Destination-Realm }
>
> ***[ Supported-Features ]**
>
> **{ User-Identity }**
>
> **[ Wildcarded-Public-Identity ]**
>
> **[ Wildcarded-IMPU ]**
>
> ***[ Service-Indication ]**
>
> **[ Send-Data-Indication ]**
>
> **[ Server-Name ]**
>
> **{ Subs-Req-Type }**
>
> ***{ Data-Reference }**
>
> ***[ Identity-Set ]**
>
> **[ Expiry-Time ]**
>
> ***[ DSAI-Tag ]**
>
> **[One-Time-Notification]**
>
> [ User-Name ]
>
> [ OC-Supported-Features ]
*[ AVP ]
*[ Proxy-Info ]
*[ Route-Record ]
### 6.1.6 Subscribe-Notifications-Answer (SNA) Command
The Subscribe-Notifications-Answer command, indicated by the Command-Code
field set to 308 and the 'R' bit cleared in the Command Flags field, is sent
by a server in response to the Subscribe-Notifications-Request command. The
Result-Code or Experimental-Result AVP may contain one of the values defined
in section 6.2 or in 3GPP TS 29.229 [6].
Message Format
> \ ::= \ 16777217 >
>
> \
>
> { Vendor-Specific-Application-Id }
>
> { Auth-Session-State }
>
> [ Result-Code ]
>
> [ Experimental-Result ]
>
> { Origin-Host }
>
> { Origin-Realm }
>
> **[ Wildcarded-Public-Identity ]**
>
> **[ Wildcarded-IMPU ]**
>
> ***[ Supported-Features ]**
>
> **[ User-Data ]**
>
> **[ Expiry-Time ]**
>
> [ OC-Supported-Features ]
>
> [ OC-OLR ]
>
> *[ AVP ]
>
> *[ Failed-AVP ]
>
> *[ Proxy-Info ]
*[ Route-Record ]
### 6.1.7 Push-Notification-Request (PNR) Command
The Push-Notification-Request (PNR) command, indicated by the Command-Code
field set to 309 and the 'R' bit set in the Command Flags field, is sent by a
Diameter server to a Diameter client in order to notify changes in the user
data in the server.
Message Format
> \ ::= \ 16777217 >
>
> \
>
> { Vendor-Specific-Application-Id }
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> { Destination-Host }
>
> { Destination-Realm }
>
> ***[ Supported-Features ]**
>
> **{ User-Identity }**
>
> **[ Wildcarded-Public-Identity ]**
>
> **[ Wildcarded-IMPU ]**
>
> [ User-Name ]
>
> { User-Data }
>
> *[ AVP ]
>
> *[ Proxy-Info ]
>
> *[ Route-Record ]
### 6.1.8 Push-Notifications-Answer (PNA) Command
The Push-Notifications-Answer (PNA) command, indicated by the Command-Code
field set to 309 and the 'R' bit cleared in the Command Flags field, is sent
by a client in response to the Push-Notification-Request command. The
Experimental-Result AVP may contain one of the values defined in section 6.2
or in 3GPP TS 29.229 [6].
Message Format
> \ ::=\
>
> \
>
> { Vendor-Specific-Application-Id }
>
> [ Result-Code ]
>
> [ Experimental-Result ]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> ***[ Supported-Features ]**
>
> *[ AVP ]
>
> *[ Failed-AVP ]
>
> *[ Proxy-Info ]
>
> *[ Route-Record ]
## 6.2 Result-Code AVP values
This section defines new result code values that must be supported by all
Diameter implementations that conform to this specification. The result codes
defined in 3GPP TS 29.229 [6] are also applicable. When one of the result
codes defined here is included in a response, it shall be inside an
Experimental-Result AVP and Result-Code AVP shall be absent.
### 6.2.1 Success
Result codes that fall within the Success category are used to inform a peer
that a request has been successfully completed.
No result codes within this category have been defined so far.
### 6.2.2 Permanent Failures
Errors that fall within the Permanent Failures category are used to inform the
peer that the request failed, and should not be attempted again.
#### 6.2.2.1 DIAMETER_ERROR_USER_DATA_NOT_RECOGNIZED (5100)
The data received by the AS is not supported or recognized.
#### 6.2.2.2 DIAMETER_ERROR_OPERATION_NOT_ALLOWED (5101)
The requested operation is not allowed for the user
#### 6.2.2.3 DIAMETER_ERROR_USER_DATA_CANNOT_BE_READ (5102)
The requested user data is not allowed to be read.
#### 6.2.2.4 DIAMETER_ERROR_USER_DATA_CANNOT_BE_MODIFIED (5103)
The requested user data is not allowed to be modified.
#### 6.2.2.5 DIAMETER_ERROR_USER_DATA_CANNOT_BE_NOTIFIED (5104)
The requested user data is not allowed to be notified on changes.
#### 6.2.2.6 DIAMETER_ERROR_TOO_MUCH_DATA (5008)
The size of the data pushed to the receiving entity exceeds its capacity. This
error code is defined in 3GPP TS 29.229 [6].
#### 6.2.2.7 DIAMETER_ERROR_TRANSPARENT_DATA OUT_OF_SYNC (5105)
The request to update the repository data at the HSS could not be completed
because the requested update is based on an out-of-date version of the
repository data. That is, the sequence number in the Sh-Update Request
message, does not match with the immediate successor of the associated
sequence number stored for that repository data at the HSS. It is also used
where an AS tries to create a new set of repository data when the identified
repository data already exists in the HSS.
#### 6.2.2.8 DIAMETER_ERROR_FEATURE_UNSUPPORTED (5011)
See 3GPP TS 29.229 [6] clause 6.2.2.11.
#### 6.2.2.9 DIAMETER_ERROR_SUBS_DATA_ABSENT (5106)
The Application Server requested to subscribe to changes to Repository Data
that is not present in the HSS.
#### 6.2.2.10 DIAMETER_ERROR_NO_SUBSCRIPTION_TO_DATA (5107)
The AS received a notification of changes of some information to which it is
not subscribed.
#### 6.2.2.11 DIAMETER_ERROR_DSAI_NOT_AVAILABLE (5108)
The Application Server addressed a DSAI not configured in the HSS.
#### 6.2.2.12 DIAMETER_ERROR_IDENTITIES_DONT_MATCH (5002)
See 3GPP TS 29.229 [6]
### 6.2.3 Transient Failures
Errors that fall within the transient failures category are those used to
inform a peer that the request could not be satisfied at the time that it was
received. The request may be able to be satisfied in the future.
#### 6.2.3.1 DIAMETER_USER_DATA_NOT_AVAILABLE (4100)
The requested user data is not available at this time to satisfy the requested
operation.
#### 6.2.3.2 DIAMETER_PRIOR_UPDATE_IN_PROGRESS (4101)
The request to update the repository data at the HSS could not be completed
because the related repository data is currently being updated by another
entity.
## 6.3 AVPs
The following table describes the Diameter AVPs defined for the Sh interface
protocol, their AVP Code values, types, possible flag values and whether the
AVP may or not be encrypted.
Table 6.3.1: Diameter Multimedia Application AVPs
+-------+-------+-------+-------+------+-----+-------+-------+-------+ | | AVP | | | | | | | | | | Flag | | | | | | | | | | rules | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Attr | AVP | Se | Value | Must | May | S | Must | May | | ibute | Code | ction | Type | | | hould | not | En | | Name | | de | | | | not | | crypt | | | | fined | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Use | 700 | 6.3.1 | Gr | M, V | | | | No | | r-Ide | | | ouped | | | | | | | ntity | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | M | 701 | 6.3.2 | O | M, V | | | | No | | SISDN | | | ctetS | | | | | | | | | | tring | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | User | 702 | 6.3.3 | O | M, V | | | | No | | -Data | | | ctetS | | | | | | | | | | tring | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Data | 703 | 6.3.4 | Enume | M, V | | | | No | | -Refe | | | rated | | | | | | | rence | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Ser | 704 | 6.3.5 | O | M, V | | | | No | | vice- | | | ctetS | | | | | | | Indic | | | tring | | | | | | | ation | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Sub | 705 | 6.3.6 | Enume | M, V | | | | No | | s-Req | | | rated | | | | | | | -Type | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | R | 706 | 6.3.7 | Enume | M, V | | | | No | | eques | | | rated | | | | | | | ted-D | | | | | | | | | | omain | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | C | 707 | 6.3.8 | Enume | M, V | | | | No | | urren | | | rated | | | | | | | t-Loc | | | | | | | | | | ation | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Id | 708 | 6 | Enume | V | | | M | No | | entit | | .3.10 | rated | | | | | | | y-Set | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | E | 709 | 6 | Time | V | | | M | No | | xpiry | | .3.16 | | | | | | | | -Time | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Send- | 710 | 6 | Enume | V | | | M | No | | Data- | | .3.17 | rated | | | | | | | Indic | | | | | | | | | | ation | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | S | 602 | 6.3.9 | UTF8S | M, V | | | | No | | erver | | | tring | | | | | | | -Name | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Sup | 628 | 6 | Gr | V | M | | | No | | porte | | .3.11 | ouped | | | | | | | d-Fea | | | | | | | | | | tures | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Featu | 629 | 6 | Unsig | V | | | M | No | | re-Li | | .3.12 | ned32 | | | | | | | st-ID | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Fe | 630 | 6 | Unsig | V | | | M | No | | ature | | .3.13 | ned32 | | | | | | | -List | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Su | 631 | 6 | Gr | V | | | M | No | | pport | | .3.14 | ouped | | | | | | | ed-Ap | | | | | | | | | | plica | | | | | | | | | | tions | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Publi | 601 | 6 | UTF8S | M, V | | | | No | | c-Ide | | .3.15 | tring | | | | | | | ntity | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | DSA | 711 | 6 | O | M, V | | | | No | | I-Tag | | .3.18 | ctetS | | | | | | | | | | tring | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | W | 634 | 6 | UTF8S | V | | | M | No | | ildca | | .3.19 | tring | | | | | | | rded- | | | | | | | | | | Publi | | | | | | | | | | c-Ide | | | | | | | | | | ntity | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Wildc | 636 | 6 | UTF8S | V | | | M | No | | arded | | .3.20 | tring | | | | | | | -IMPU | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | S | 650 | 6 | Enume | V | | | M | No | | essio | | .3.21 | rated | | | | | | | n-Pri | | | | | | | | | | ority | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | O | 712 | 6 | Enume | V | | | M | No | | ne-Ti | | .3.22 | rated | | | | | | | me-No | | | | | | | | | | tific | | | | | | | | | | ation | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Reque | 713 | 6 | Unsig | V | | | M | No | | sted- | | .3.7A | ned32 | | | | | | | Nodes | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Ser | 714 | 6 | Enume | V | | | M | No | | ving- | | .3.23 | rated | | | | | | | Node- | | | | | | | | | | Indic | | | | | | | | | | ation | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Rep | 715 | 6 | Gr | V | | | M | No | | osito | | .3.24 | ouped | | | | | | | ry-Da | | | | | | | | | | ta-ID | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Seque | 716 | 6 | Unsig | V | | | M | No | | nce-N | | .3.25 | ned32 | | | | | | | umber | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Pre-p | 717 | 6 | Enume | V | | | M | No | | aging | | .3.26 | rated | | | | | | | -Supp | | | | | | | | | | orted | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | L | 718 | 6 | Enume | V | | | M | No | | ocal- | | .3.27 | rated | | | | | | | Time- | | | | | | | | | | Zone- | | | | | | | | | | Indic | | | | | | | | | | ation | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | UDR- | 719 | 6 | Unsig | V | | | M | No | | Flags | | .3.28 | ned32 | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Call | 720 | 6 | Gr | V | | | M | No | | -Refe | | .3.29 | ouped | | | | | | | rence | | | | | | | | | | -Info | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | C | 721 | 6 | O | V | | | M | No | | all-R | | .3.30 | ctetS | | | | | | | efere | | | tring | | | | | | | nce-N | | | | | | | | | | umber | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | AS-N | 722 | 6 | O | V | | | M | No | | umber | | .3.31 | ctetS | | | | | | | | | | tring | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | O | 621 | 6 | Gr | | | | M, V | No | | C-Sup | | .3.32 | ouped | | | | | | | porte | NOTE | | | | | | | | | d-Fea | 3 | | | | | | | | | tures | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | O | 623 | 6 | Gr | | | | M, V | No | | C-OLR | | .3.33 | ouped | | | | | | | | NOTE | | | | | | | | | | 3 | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | NOTE | | | | | | | | | | 1: | | | | | | | | | | The | | | | | | | | | | AVP | | | | | | | | | | h | | | | | | | | | | eader | | | | | | | | | | bit | | | | | | | | | | de | | | | | | | | | | noted | | | | | | | | | | as | | | | | | | | | | 'M', | | | | | | | | | | indi | | | | | | | | | | cates | | | | | | | | | | wh | | | | | | | | | | ether | | | | | | | | | | su | | | | | | | | | | pport | | | | | | | | | | of | | | | | | | | | | the | | | | | | | | | | AVP | | | | | | | | | | is | | | | | | | | | | requ | | | | | | | | | | ired. | | | | | | | | | | The | | | | | | | | | | AVP | | | | | | | | | | h | | | | | | | | | | eader | | | | | | | | | | bit | | | | | | | | | | de | | | | | | | | | | noted | | | | | | | | | | as | | | | | | | | | | 'V', | | | | | | | | | | indi | | | | | | | | | | cates | | | | | | | | | | wh | | | | | | | | | | ether | | | | | | | | | | the | | | | | | | | | | opt | | | | | | | | | | ional | | | | | | | | | | Vend | | | | | | | | | | or-ID | | | | | | | | | | field | | | | | | | | | | is | | | | | | | | | | pr | | | | | | | | | | esent | | | | | | | | | | in | | | | | | | | | | the | | | | | | | | | | AVP | | | | | | | | | | hea | | | | | | | | | | der.\ | | | | | | | | | | For | | | | | | | | | | fu | | | | | | | | | | rther | | | | | | | | | | det | | | | | | | | | | ails, | | | | | | | | | | see | | | | | | | | | | 3GPP | | | | | | | | | | TS | | | | | | | | | | 2 | | | | | | | | | | 9.229 | | | | | | | | | | \ | | | | | | | | | | [6]. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 2: If | | | | | | | | | | the | | | | | | | | | | M-bit | | | | | | | | | | is | | | | | | | | | | set | | | | | | | | | | for | | | | | | | | | | an | | | | | | | | | | AVP | | | | | | | | | | and | | | | | | | | | | the | | | | | | | | | | rec | | | | | | | | | | eiver | | | | | | | | | | does | | | | | | | | | | not | | | | | | | | | | under | | | | | | | | | | stand | | | | | | | | | | the | | | | | | | | | | AVP, | | | | | | | | | | it | | | | | | | | | | shall | | | | | | | | | | r | | | | | | | | | | eturn | | | | | | | | | | a | | | | | | | | | | rejec | | | | | | | | | | tion. | | | | | | | | | | If | | | | | | | | | | the | | | | | | | | | | M-bit | | | | | | | | | | is | | | | | | | | | | not | | | | | | | | | | set | | | | | | | | | | for | | | | | | | | | | an | | | | | | | | | | AVP, | | | | | | | | | | the | | | | | | | | | | rec | | | | | | | | | | eiver | | | | | | | | | | shall | | | | | | | | | | not | | | | | | | | | | r | | | | | | | | | | eturn | | | | | | | | | | a | | | | | | | | | | rejec | | | | | | | | | | tion, | | | | | | | | | | wh | | | | | | | | | | ether | | | | | | | | | | or | | | | | | | | | | not | | | | | | | | | | it | | | | | | | | | | u | | | | | | | | | | nders | | | | | | | | | | tands | | | | | | | | | | the | | | | | | | | | | AVP. | | | | | | | | | | If | | | | | | | | | | the | | | | | | | | | | rec | | | | | | | | | | eiver | | | | | | | | | | u | | | | | | | | | | nders | | | | | | | | | | tands | | | | | | | | | | the | | | | | | | | | | AVP | | | | | | | | | | but | | | | | | | | | | the | | | | | | | | | | M-bit | | | | | | | | | | value | | | | | | | | | | does | | | | | | | | | | not | | | | | | | | | | match | | | | | | | | | | with | | | | | | | | | | the | | | | | | | | | | defin | | | | | | | | | | ition | | | | | | | | | | in | | | | | | | | | | this | | | | | | | | | | t | | | | | | | | | | able, | | | | | | | | | | the | | | | | | | | | | rec | | | | | | | | | | eiver | | | | | | | | | | shall | | | | | | | | | | i | | | | | | | | | | gnore | | | | | | | | | | the | | | | | | | | | | M | | | | | | | | | | -bit. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 3: | | | | | | | | | | The | | | | | | | | | | value | | | | | | | | | | of | | | | | | | | | | these | | | | | | | | | | attri | | | | | | | | | | butes | | | | | | | | | | is | | | | | | | | | | de | | | | | | | | | | fined | | | | | | | | | | in | | | | | | | | | | IETF | | | | | | | | | | RFC | | | | | | | | | | 7683 | | | | | | | | | | [ | | | | | | | | | | 12]. | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+
### 6.3.1 User-Identity AVP
The User-Identity AVP is of type Grouped. This AVP contains either a Public-
Identity AVP or an MSISDN AVP.
AVP format
> User-Identity ::= \
>
> [Public-Identity]
>
> [MSISDN]
>
> *[AVP]
### 6.3.2 MSISDN AVP
The MSISDN AVP is of type OctetString. This AVP contains an MSISDN, in
international number format as described in ITU-T Rec E.164 [8], encoded as a
TBCD-string, i.e. digits from 0 through 9 are encoded 0000 to 1001; 1111 is
used as a filler when there is an odd number of digits; bits 8 to 5 of octet n
encode digit 2n; bits 4 to 1 of octet n encode digit 2(n-1)+1.
### 6.3.3 User-Data AVP
The User-Data AVP is of type OctetString. This AVP contains the user data
requested in the UDR/UDA, SNR/SNA and PNR/PNA operations and the data to be
modified in the PUR/PUA operation. The exact content and format of this AVP is
described in 3GPP TS 29.328 [1] Annex C as Sh-Data.
### 6.3.4 Data-Reference AVP
The Data-Reference AVP is of type Enumerated, and indicates the type of the
requested user data in the operation UDR and SNR. Its exact values and meaning
is defined in 3GPP TS 29.328 [1]. The following values are defined (more
details are given in 3GPP TS 29.328 [1]):
RepositoryData (0)
IMSPublicIdentity (10)
IMSUserState (11)
S-CSCFName (12)
InitialFilterCriteria (13)
This value is used to request initial filter criteria relevant to the
requesting AS
LocationInformation (14)
UserState (15)
ChargingInformation (16)
MSISDN (17)
PSIActivation (18)
DSAI (19)
ServiceLevelTraceInfo (21)
IPAddressSecureBindingInformation (22)
ServicePriorityLevel (23)
SMSRegistrationInfo (24)
UEReachabilityForIP (25)
TADSinformation (26)
STN-SR (27)
UE-SRVCC-Capability (28)
ExtendedPriority (29)
CSRN (30)
ReferenceLocationInformation (31)
IMSI (32)
IMSPrivateUserIdentity (33)
NOTE: Value 20 is reserved.
### 6.3.5 Service-Indication AVP
The Service-Indication AVP is of type OctetString. This AVP contains the
Service Indication that identifies a service or a set of services in an AS and
the related repository data in the HSS. Standardized values of Service-
Indication identifying a standardized service or set of services in the AS and
standardized format of the related repository data are defined in 3GPP TS
29.364 [10].
### 6.3.6 Subs-Req-Type AVP
The Subs-Req-Type AVP is of type Enumerated, and indicates the type of the
subscription-to-notifications request. The following values are defined:
Subscribe (0)
This value is used by an AS to subscribe to notifications of changes in data.
Unsubscribe (1)
This value is used by an AS to unsubscribe to notifications of changes in
data.
### 6.3.7 Requested-Domain AVP
The Requested-Domain AVP is of type Enumerated, and indicates the access
domain for which certain data (e.g. user state) are requested. The following
values are defined:
CS-Domain (0)
The requested data apply to the CS domain.
PS-Domain (1)
The requested data apply to the PS domain.
### 6.3.7A Requested-Nodes AVP
The Requested-Nodes AVP is of type Unsigned32 and it shall contain a bit mask.
The meaning of the bits shall be as defined in table 6.3.7A/1:
Table 6.3.7A/1: Requested-Nodes
* * *
Bit Name Description 0 MME The requested data apply to the MME 1 SGSN The
requested data apply to the SGSN 2 3GPP-AAA-SERVER-TWAN The requested data
apply to the 3GPP AAA Server for TWAN
* * *
### 6.3.8 Current-Location AVP
The Current-Location AVP is of type Enumerated, and indicates whether an
active location retrieval has to be initiated or not:
DoNotNeedInitiateActiveLocationRetrieval (0)
The request indicates that the initiation of an active location retrieval is
not required.
InitiateActiveLocationRetrieval (1)
It is requested that an active location retrieval is initiated.
### 6.3.9 Server-Name AVP
The Server-Name contains a SIP-URL used to identify an AS. See 3GPP TS 29.229
[6] for further description of this AVP.
### 6.3.10 Identity-Set AVP
The Identity-Set AVP is of type Enumerated and indicates the requested set of
IMS Public Identities. The following values are defined:
ALL_IDENTITIES (0)
REGISTERED_IDENTITIES (1)
IMPLICIT_IDENTITIES (2)
ALIAS_IDENTITIES (3)
### 6.3.11 Supported-Features AVP
See 3GPP TS 29.229 [6] clause 6.3.29.
### 6.3.12 Feature-List-ID AVP
See 3GPP TS 29.229 [6] clause 6.3.30.
### 6.3.13 Feature-List AVP
See 3GPP TS 29.229 [6] clause 6.3.31.
### 6.3.14 Supported-Applications AVP
See 3GPP TS 29.229 [6] clause 6.3.32.
### 6.3.15 Public-Identity AVP
The Public-Identity AVP contains a Public User Identity. See 3GPP TS 29.229
[6] for the definition of this AVP.
### 6.3.16 Expiry-Time AVP
The Expiry-Time AVP is of type Time. This AVP contains the expiry time of
subscriptions to notifications in the HSS.
### 6.3.17 Send-Data-Indication AVP
The Send-Data-Indication AVP is of type Enumerated. If present it indicates
that the sender requests the User-Data. The following values are defined:
USER_DATA_NOT_REQUESTED (0)
USER_DATA_REQUESTED (1)
### 6.3.18 DSAI-Tag AVP
The DSAI-Tag AVP is of type OctetString. This AVP contains the DSAI-Tag
identifying the instance of the Dynamic Service Activation Information being
accessed for the Public Identity.
### 6.3.19 Wildcarded-Public-Identity AVP
See 3GPP TS 29.229 [6] clause 6.3.35 for the definition of theWildcarded-
Public-Identity AVP. This AVP only contains a Wildcarded PSI over Sh
interface.
### 6.3.20 Wildcarded-IMPU AVP
See 3GPP TS 29.229 [6] clause 6.3.43.
### 6.3.21 Session-Priority AVP
See 3GPP TS 29.229 [6] clause 6.3.56.
### 6.3.22 One-Time-Notification AVP
The One-Time-Notification AVP is of type Enumerated. If present it indicates
that the sender requests to be notified only one time. The following values
are defined:
ONE_TIME_NOTIFICATION_REQUESTED (0)
This AVP is only applicable to UE reachability for IP (25)
### 6.3.23 Serving-Node-Indication AVP
The Serving-Node-Indication AVP is of type Enumerated. If present it indicates
that the sender does not require any location information other than the
Serving Node Addresses/Identities requested (e.g. MME name, VLR number). Other
location information (e.g. Global Cell ID, Tracking Area ID) may be absent.
The following values are defined:
ONLY_SERVING_NODES_REQUIRED (0)
### 6.3.24 Repository-Data-ID AVP
The Repository-Data-ID AVP is of type Grouped. This AVP shall contain a
Service-Indication AVP and a Sequence-Number AVP.
AVP format
> Repository-Data-ID ::= \
>
> {Service-Indication}
>
> {Sequence-Number}
>
> *[AVP]
### 6.3.25 Sequence-Number AVP
The Sequence-Number AVP is of type Unsigned32. This AVP contains a number
associated to a repository data.
### 6.3.26 Pre-paging-Supported AVP
The Pre-paging-Supported AVP is of type Enumerated. It indicates whether the
sender supports pre-paging or not. The following values are defined:
PREPAGING_NOT_SUPPORTED (0)
PREPAGING_SUPPORTED (1)
If this AVP is not present in the command, the default value is
PREPAGING_NOT_SUPPORTED (0).
### 6.3.27 Local-Time-Zone-Indication AVP
The Local-Time-Zone-Indication AVP is of type Enumerated. If present it
indicates that the Local Time Zone information (time zone and daylight saving
time) of the visited network where the UE is attached is requested with or
without other location information. The following values are defined:
ONLY_LOCAL_TIME_ZONE_REQUESTED (0)
LOCAL_TIME_ZONE_WITH_LOCATION_INFO_REQUESTED (1)
### 6.3.28 UDR-Flags
The UDR-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The
meaning of the bits shall be as defined in table 6.3.28/1:
Table 6.3.28/1: UDR-Flags
+----------------------+----------------------+----------------------+ | Bit | Name | Description | +----------------------+----------------------+----------------------+ | 0 | Location-Infor | This bit, when set, | | | mation-EPS-Supported | indicates that EPS | | | | Location Information | | | | may be sent to the | | | | AS when CS Location | | | | Information is | | | | requested. It may | | | | only be set if CS | | | | Location Information | | | | is requested. | | | | | | | | When set, the HSS | | | | shall indicate to | | | | the MSC/VLR the | | | | support of Location | | | | Information EPS. | +----------------------+----------------------+----------------------+ | 1 | RAT-Type-Requested | This bit, when set, | | | | indicates that RAT | | | | Type is requested as | | | | part of the PS | | | | Location | | | | Information. | +----------------------+----------------------+----------------------+ | NOTE: Bits not | | | | defined in this | | | | table shall be | | | | cleared by the | | | | sender of the | | | | request and | | | | discarded by the | | | | receiver of the | | | | request. | | | +----------------------+----------------------+----------------------+
### 6.3.29 Call-Reference-Info AVP
The Call-Reference-Info AVP is of type Grouped. This AVP shall contain a Call-
Reference-Number AVP and an AS-Number AVP.
AVP format
> Call-Reference-Info ::= \
>
> {Call-Reference-Number}
>
> {AS-Number}
>
> *[AVP]
### 6.3.30 Call-Reference-Number AVP
The Call-Reference-Number AVP is of type OctetString. The exact content and
format of this AVP is described in 3GPP TS 29.002 [11].
### 6.3.31 AS-Number AVP
The AS-Number AVP is of type OctetString. The exact content and format of this
AVP corresponds to the gmsc-address parameter described in 3GPP TS 29.002
[11].
### 6.3.32 OC-Supported-Features
The OC-Supported-Features AVP is of type Grouped and it is defined in IETF RFC
7683 [12]. This AVP is used to support Diameter overload control mechanism.
### 6.3.33 OC-OLR
The OC-OLR AVP is of type Grouped and it is defined in IETF RFC 7683 [12].
This AVP is used to support Diameter overload control mechanism.
## 6.4 Use of namespaces
This clause contains the namespaces that have either been created in this
specification, or the values assigned to existing namespaces managed by IANA.
### 6.4.1 AVP codes
This specification assigns the AVP values from the AVP Code namespace managed
by 3GPP for its Diameter vendor-specific applications. See section 6.3 for the
assignment of the namespace in this specification.
### 6.4.2 Experimental-Result-Code AVP values
This specification has assigned Experimental-Result-Code AVP values 4100-4101
and 5100-5105. See section 6.2.
### 6.4.3 Command Code values
This specification assigns the values 306-309 from the range allocated by IANA
to 3GPP in IETF RFC 3589 [7].
### 6.4.4 Application-ID value
IANA has allocated the value 16777217 for the 3GPP Sh interface application.
# 7 Special Requirements
## 7.1 Version Control
The version control mechanisms specified in 3GPP TS 29.229 [6] clauses 7.1,
7.2 and 7.3 apply to this specification.
The following table of features shall apply to the Sh interface.
Table 7.1.1: Features of feature list 1 used in Sh
+-------------------+-------------------+-----+-------------------+ | Feature bit | Feature | M/O | Description | +-------------------+-------------------+-----+-------------------+ | 0 | Notif-Eff | M | This feature is | | | | | applicable to the | | | | | UDR/UDA, SNR/SNA | | | | | and PNR/PNA | | | | | command pairs. It | | | | | requires support | | | | | in both HSS and | | | | | the AS. | | | | | | | | | | If multiple | | | | | subscriptions to | | | | | notifications are | | | | | associated with a | | | | | Public User | | | | | Identity, the HSS | | | | | may combine the | | | | | notifications for | | | | | multiple Data | | | | | R | | | | | eferences,Service | | | | | Indications and | | | | | Identity Sets | | | | | into a single | | | | | Push-Not | | | | | ification-Request | | | | | message. | | | | | | | | | | Similarly the | | | | | User-Data-Request | | | | | / Answer and the | | | | | Subscribe-Noti | | | | | fications-Request | | | | | / Answer will | | | | | allow multiple | | | | | Data References, | | | | | Service | | | | | Indications and | | | | | Identity Sets. | | | | | The | | | | | User-Data-Answer | | | | | will be able to | | | | | combine | | | | | DataReference | | | | | items resulting | | | | | in the User Data | | | | | AVP including a | | | | | single XML | | | | | document with the | | | | | separable XML | | | | | sections | | | | | populated. | +-------------------+-------------------+-----+-------------------+ | 1 | Update-Eff | O | This feature is | | | | | applicable to the | | | | | PUR/PUA commands. | | | | | If both the HSS | | | | | and the AS | | | | | support this | | | | | feature, a PUR | | | | | command where the | | | | | Data reference | | | | | type is | | | | | Repository Data, | | | | | may contain an | | | | | XML document with | | | | | several | | | | | Repository Data | | | | | instances. | +-------------------+-------------------+-----+-------------------+ | 2 | U | O | This feature is | | | pdate-Eff-Enhance | | an enhancement of | | | | | the Update-Eff | | | | | feature and | | | | | requires | | | | | Update-Eff is | | | | | supported. It is | | | | | applicable to the | | | | | PUR/PUA commands. | | | | | If both the HSS | | | | | and the AS | | | | | support this | | | | | feature, a PUR | | | | | command may | | | | | contain an XML | | | | | document with | | | | | several Data | | | | | instances. | +-------------------+-------------------+-----+-------------------+ | 3 | Additional-MSISDN | O | This feature is | | | | | applicable to | | | | | UDR/UDA commands. | | | | | | | | | | It requires | | | | | support in both | | | | | HSS and AS. | | | | | | | | | | If enabled, it | | | | | extends the | | | | | information | | | | | returned with | | | | | DataReference=17. | | | | | Instead of | | | | | returning only | | | | | MSISDN, it | | | | | includes | | | | | ExtendedMSISDN. | | | | | See 3GPP TS | | | | | 29.328 [1] for | | | | | more information. | +-------------------+-------------------+-----+-------------------+ | Feature bit: The | | | | | order number of | | | | | the bit within | | | | | the | | | | | **S | | | | | upported-Features | | | | | AVP, e.g. "1".** | | | | | | | | | | **Feature: A | | | | | short name that | | | | | can be used to | | | | | refer to the bit | | | | | and to the | | | | | feature, e.g. | | | | | "MOM".** | | | | | | | | | | **M/O: Defines if | | | | | the | | | | | implementation of | | | | | the feature is | | | | | mandatory ("M") | | | | | or optional | | | | | ("O").** | | | | | | | | | | Description: A | | | | | clear textual | | | | | description of | | | | | the feature. | | | | +-------------------+-------------------+-----+-------------------+
The following table shall apply to the Sh interface; the column Application
identifier lists the used application identifiers on Sh and 3GPP.
Table 7.1.2: Application identifiers used in Sh
* * *
Application identifier First applied 16777217 3GPP Rel-5
* * *
#
# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document provides a study of the IMS impacts for providing a
solution for determination of Inter‑IMS Network to Network Interface (II-NNI)
traversal scenario type. The document describes and analyses different II‑NNI
traversal scenarios. The present document describes requirements and
investigates the implementation options to fulfil requirements for
determination of II-NNI traversal scenario type.
Examples of scenarios to study are:
\- the visited to home scenario;
\- the home to visited scenario;
\- the loopback scenario;
\- the invocation of MRB/MRF in visited network from an AS in home network
scenario; and
\- a request sent from the home network on the originating side to the home
network on the terminating side.
The present document includes the study of the existing protocol mechanism and
new protocol mechanism for further evaluation what is needed to identify a
particular II-NNI traversal scenario type.\ The study also considers existing
deployments.
The present document analyses and evaluates different solutions.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document in the same
Release as the present document.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[3] 3GPP TS 24.237: \"IP Multimedia (IM) Core Network (CN) subsystem IP
Multimedia Subsystem (IMS) Service Continuity; Stage 3\".
[4] 3GPP TS 24.292: \"IP Multimedia (IM) Core Network (CN) subsystem
Centralized Services (ICS); Stage 3\".
[5] 3GPP TS 29.280: \"Evolved Packet System (EPS); 3GPP Sv interface (MME to
MSC, and SGSN to MSC) for SRVCC\".
[6] 3GPP TS 29.292: \"Interworking between the IP Multimedia (IM) Core Network
(CN) Subsystem (IMS) and MSC Server for IMS Centralized Services (ICS)\".
[7] 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Subsystem (IMS) charging\".
[8] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging applications\".
[9] 3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".
[10] 3GPP TS 29.165: \"Inter-IMS Network to Network Interface (NNI)\".
[11] 3GPP TR 23.849: \"Study on Stage 2 aspects of Optimised Service Charging
and Allocation of Resources (OSCAR) in the IP Multimedia Subsystem (IMS)
whilst roaming\".
[12] IETF RFC 6809: \"Mechanism to Indicate Support of Features and
Capabilities in the Session Initiation Protocol (SIP)\".
[13] IETF RFC 3455: \"Private Header (P-Header) Extensions to the Session
Initiation Protocol (SIP) for the 3rd-Generation Partnership Project (3GPP)\".
[14] IETF draft-drage-sipping-rfc3455bis-09 (October 2013): \"Private Header
(P-Header) Extensions to the Session Initiation Protocol (SIP) for the 3rd-
Generation Partnership Project (3GPP)\".
[15] IETF RFC 6230: \"Media Control Channel Framework\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**implicit detection of the II-NNI traversal scenario type** : a method to
determine the II-NNI traversal scenario type by analysing the content of a
received dialog creating SIP request or stand-alone SIP request without
relying on an explicit indication of the II-NNI traversal scenario type.
**explicit indication of the II-NNI traversal scenario type:** a method to use
a dedicated protocol element indicating the II-NNI traversal scenario type.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Ici Reference point between an IBCF and another IBCF belonging to a different
IM CN subsystem network.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply.\ An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
ACR Anonymous Communication Rejection
AS Application Server
ATCF Access Transfer Control Function
ATU-STI Access Transfer Update -- Session Transfer Identifier
AVP Attribute Value Pair
B2BUA Back-to-Back User Agent
BGCF Breakout Gateway Control Function
CDR Charging Data Record
DNS Domain Name System
IBCF Interconnection Border Control Function
I-CSCF Interrogating CSCF
ICID IM CN subsystem Charging Identifier
ICS IMS Centralized Services
II-NNI Inter-IMS Network to Network Interface
MIME Multipurpose Internet Mail Extensions
MRB Media Resource Broker
MSC Mobile-services Switching Centre
MSC-S MSC server
OMR Optimal Media Routeing
OSCAR Optimised Service Charging and Allocation of Resources
NNI Network to Network Interface
P-CSCF Proxy CSCF
SBC Session Border Controller
SCC AS Service Centralization and Continuity AS
S-CSCF Serving CSCF
SRVCC Single Radio Voice Call Continuity
STN-SR Session Transfer Number -- Single Radio
TRF Transit and Roaming Function
vSRVCC Single Radio Video Call Continuity
# 4 Scenarios
## 4.1 Introduction
The IBCF participates in a numerous number of II-NNI traversal scenarios but
at the moment there is no safe way for an IBCF to identify the II-NNI
traversal scenario at the II-NNI.
Clause 5 shows a list of requirements that indicates the benefits of
identifying the II-NNI traversal scenario.
The figure 4.1.1 shows the II-NNI reference points within the scope of this
study.
NOTE 1: Any Ici reference point can contain an intermediate transit networks
and are not showed in the figure. The intermediate transit network can either
be a non-IMS transit network using standards outside the scope of 3GPP or an
IMS transit network with or without a transit function as specified in 3GPP TS
24.229 [2].
NOTE 2: An IMS transit network providing application services can include
application services even if IBCF type of functionality is not required.
NOTE 3: The interface between IMS and 3^rd^ party application servers is out
of scope of this study.
Figure 4.1.1: Reference points within the scope of this study
The following high-level II-NNI traversal scenario types can be derived from
the figure 4.1.1:
A) originating side II-NNI traversal scenario types;
B) signalling between originating and terminating side II-NNI traversal
scenario types; and
C) terminating side II-NNI traversal scenario types.
The following clauses further break down the high-level II-NNI traversal
scenario types into more detailed scenarios.
## 4.2 Roaming user on the originating side II-NNI traversal scenario types
### 4.2.1 Overview
This clause describes the details of II-NNI traversal scenarios used between a
home network serving a roaming user on the originating side and a visited
network where the roaming user is registered from.
Figure 4.2.1.1 shows the detailed content of the originating side II-NNI
traversal scenarios with the exception of the registration II-NNI traversal
scenario that is not shown.
NOTE: The intermediate transit network can be a non-IMS network (e.g. an IPX
network) or an IMS network acting as a transit network.
Figure 4.2.1.1: Originating side II-NNI traversal scenarios
The roaming user is either registered in via a P-CSCF or via a MSC server in
the visited network.
The TRF in the visited network is used in a roaming architecture for voice
over IMS with local breakout.
The MRB/MRF in the visited network is handling media resources when the home
network uses media resources in an external network. In this case media
resources in the visited network are used.
The following clauses describe the details of each II-NNI traversal scenario.
### 4.2.2 Dialog creating SIP request and stand-alone SIP requests using the
registration path
The II-NNI traversal scenario is used to establish SIP dialogs (e.g. originate
a call) or to send stand-alone SIP messages associated with the user.
The address of the S-CSCF is included as a URI in the Service-Route header
field in the 200 (OK) response to the REGISTER request.
The URI received in the Service-Route header field is included by the UE in
the Route header field in dialog creating and stand-alone SIP requests.
The procedures for registration of a roaming user and for establishing SIP
dialogs and sending stand-alone SIP requests from a visited network to a home
network are specified in 3GPP TS 24.229 [2], 3GPP 24.292 [4] and 3GPP TS
29.292 [6].
### 4.2.3 Subscription to user\'s registration-state event package
This II-NNI traversal scenario is used when the P-CSCF or the MSC server
enhanced for ICS subscribes to the registration-state event package. The II-
NNI traversal scenario is used to receive notifications of the registration
status of the registered user.
NOTE: Other similar II-NNI traversal scenarios, e.g. the subscription of the
debug event package, are out of scope of this study.
The address of the S-CSCF is the default public user identity retrieved from
the P-Associated-ID header field received in the 200 (OK) response to the
REGISTER request.
The default public user identity is included in the Request-URI and in the
From header field in the SUBSCRIBE request sent to the S-CSCF.
The procedure to subscribe to the reg-event is specified in 3GPP TS 24.229 [2]
clause 5.2.3 for the P-CSCF and in the 3GPP 24.292 [4] clause 6.3.4 for the
MSC server.
### 4.2.4 Initial INVITE request due to SRVCC
This II-NNI traversal scenario is established on a per call bases. The INVITE
request is sent by the MSC server enhanced for ICS supporting CS to PS SRVCC,
the MSC server enhanced for SRVCC using SIP interface or the ATCF and in some
CS to PS dual radio access transfer use cases. The II-NNI traversal scenario
is used for establishing a target access leg when a call is transferred using
PS to CS SRVCC or PS to CS vSRVCC.
The address to the SCC AS is received:
\- from the MME in the PS to PS transfer request as specified in 3GPP TS
29.280 [5] clause 5.2.2. This URI is referred to as the STN-SR in 3GPP TS
24.237 [3] clause 4.3 and included as the Request-URI by the MSC server when
sending the INVITE request due to STN-SR as specified in 3GPP TS 24.237 [3]
clause 12.4.0 and clause 12.6.1.1;
\- from the SCC AS in a MESSAGE request as described in 3GPP TS 24.237 [3]
clause 6.5.3. This URI is referred to as the ATU-STI for PS to CS SRVCC or
ATU-STI for CS to PS SRVCC in 3GPP TS 24.237 [3] clause 4.3 and included as
the Request-URI by the ATCF when sending the INVITE request due to ATU‑STI as
specified in 3GPP TS 24.237 [3] clause 12.7.2.2; or
\- in the Refer-To header field of an REFER request when more than one call is
transferred. This URI is referred to as the additional transferred session SCC
AS URI, the additional transferred session SCC AS URI for PS to CS SRVCC, the
additional transferred session SCC AS URI for CS to PS SRVCC or the additional
transferred session SCC AS URI for PS to CS dual radio in 3GPP TS 24.237 [3]
clause 4.3 and included as the Request-URI by the MSC server when sending the
INVITE request due to additional transferred session as specified in 3GPP TS
24.237 [3] clause 12.4A.
NOTE: In case of vSRVCC, the STN-SR can also be included in the OPTIONS
request.
The procedure for sending the INVITE request is specified in 3GPP TS 24.237
[3] clause 7.
### 4.2.5 MRF/MRB to MRF/MRB
This II-NNI traversal scenario is established on a per call basis. An INVITE
request is sent by an AS, an MRF or an MRB in a home network to a MRF/MRB in
an external network (e.g. a visited network or an enterprise network). The
intention is to make use of media resources in the external network.
The address of the MRF/MRB is either included by the P-CSCF or the MSC server
as a URI in the g.3gpp.mrb feature‑capability indicator in a Feature-Caps
header field or configured in the AS, the MRF or the MRB. The URI identifies
the MRB/MRF in an external network.
The URI is included by the AS, the MRF or the MRB in a Request-URI of an
INVITE request sent to the visited network A.
The procedure for including the MRF/MRB address in the g.3gpp.mrb feature-
capability indicator is specified in 3GPP TS 24.229 [2] clause 5.7.2 and 3GPP
24.292 [4] clause 7.3. The procedure for sending the INVITE request to the
MRF/MRB in the external network is specified in 3GPP TS 24.229 [2] clause
5.7.18.
### 4.2.6 Loopback
This II-NNI traversal scenario is established on a per call basis. The II-NNI
traversal scenario is used for returning an INVITE request to the visited
network where the UE is registered according to the roaming architecture for
voice over IMS with local breakout.
The address of the TRF is either included by the P-CSCF or the MSC server as a
URI in the g.3gpp.trf feature‑capability indicator in a Feature-Caps header
field or configured in the S-CSCF or the BGCF. The URI identifies the TRF.
The URI is included by S-CSCF or BGCF in a Route header field of the INVITE
request towards the visited network.
The procedure for including the TRF address in the g.3gpp.trf feature-
capability indicator is specified in 3GPP TS 24.229 [2] clause 5.2.7.2 and
3GPP 24.292 [4] clause 7.3. The procedure for sending the INVITE request to
the visited network is specified in 3GPP TS 24.229 [2].
## 4.3 Signalling between originating home and terminating home side II-NNI
traversal scenario types
### 4.3.1 Overview
This clause describes the details of II-NNI traversal scenarios used between a
home network serving a non‑roaming user or serving a roaming user on the
originating side and the terminating home network.
Figure 4.3.1.1 shows the detailed content of the home to home II-NNI traversal
scenarios.
NOTE: The intermediate transit network can be a non-IMS network (e.g. an IPX
network) or an IMS network acting as a transit network.
Figure 4.3.1.1: Signalling between originating and terminating side II-NNI
traversal scenarios
The served user is either registered directly to the home network (non-roaming
user) or via a visited network (roaming user).
The home network on the originating side can either route SIP requests via an
IMS transit network or directly to home network serving the user at the
destination (referred to as home routeing in the roaming architecture for
voice over IMS with local breakout.
When the user is roaming the SIP request from the home network on the
originating side can either be routed via an IMS transit network providing
application services for national interconnect or directly to home network
serving the user at the destination. The network serving the user at the
destination can be IMS or PSTN.
The visited network can either route SIP requests via an IMS transit network
providing application services for national interconnect or directly to home
network serving the user at the destination.
### 4.3.2 Dialog creating SIP request and stand-alone SIP requests between
home A and home B
This II-NNI traversal scenario is established on a per call basis. The II-NNI
traversal scenario is used by the home network A to terminate calls towards a
destination identified by an URI in the Request-URI of a dialog creating or
stand-alone SIP requests.
The address of the home network B is retrieved from local databases or the DNS
using the URI in the Request-URI.
The address of the home network B is used to send the SIP request directly to
the address of home network B.
The procedure for sending a SIP request from the originating home network side
to the terminating home network side is specified in 3GPP TS 24.229 [2].
### 4.3.3 Dialog creating SIP request and stand-alone SIP requests between
home A and an IMS transit network providing application services in the
transit network
This II-NNI traversal scenario is established on a per call basis. The II-NNI
traversal scenario is used by the home network A when the home network A wants
to use application services in an IMS transit network.
NOTE: The application services in the transit network can provide services to
the originating home network or to the terminating home network.
The address of the transit function in the IMS transit network providing
application services is configured in the home network A.
The address of the transit function in the IMS transit network is added as a
URI in a Route header field by S‑CSCF, BGCF or the IBCF according to local
policy.
The procedure for sending a SIP request from the originating home network side
to the IMS transit network providing application services is specified in 3GPP
TS 24.229 [2].
### 4.3.4 Dialog creating SIP request between visited A and home B
This II-NNI traversal scenario is established on a per call basis. The II-NNI
traversal scenario is used by the visited network A to terminate calls towards
a destination identified by an URI in the Request-URI of a dialog creating SIP
request.
The address of the home network B is retrieved from local databases or the DNS
using the URI in the Request-URI.
The address of the home network B is used to send the SIP request directly to
the address of home network B.
The procedure for sending a SIP request from the visited network on the
originating side to the terminating home network side is specified in 3GPP TS
24.229 [2].
### 4.3.5 Dialog creating SIP request between visited A and an IMS transit
network providing application services in the transit network
This II-NNI traversal scenario is established on a per call bases. The II-NNI
traversal scenario is used by the visited network A when the visited network A
wants to use application services in an IMS transit network providing
application services.
The address of the transit function in the IMS transit network is configured
in the visited network A. The address of the transit function in the IMS
transit network is added as a URI in a Route header field by the TRF or the
IBCF acting as an exit point according to local policy.
The procedure for sending a SIP request from the visited network on the
originating side to the IMS transit network is specified in 3GPP TS 24.229 [2]
annex I.
### 4.3.6 Dialog creating SIP request and stand-alone SIP requests between IMS
transit network and home B
This II-NNI traversal scenario is established on a per call basis. The II-NNI
traversal scenario is used by the IMS transit network to terminate calls
towards a destination identified by an URI in the Request-URI of a dialog
creating or stand-alone SIP requests.
The address of the home network B is retrieved from local databases, e.g. in
the BGCF, or the DNS using the URI in the Request-URI.
The address of the home network B is used to send the SIP request directly to
the address of home network B.
The procedure for sending a SIP request from the transit function in the IMS
transit network to the terminating home network side is specified in 3GPP TS
24.229 [2] annex I.
## 4.4 Roaming user on the terminating side II-NNI traversal scenario types
### 4.4.1 Overview
This clause describes the details of II-NNI traversal scenarios used between a
home network serving a roaming user on the terminating side and a visited
network where the roaming user is registered from.
Figure 4.4.1.1 shows the detailed content of the terminating side II-NNI
traversal scenarios.
NOTE: The intermediate transit network can be a non-IMS network (e.g. an IPX
network) or an IMS network acting as a transit network.
Figure 4.4.1.1: Terminating side II-NNI traversal scenarios
The roaming user is either registered via a P-CSCF or via a MSC server in a
visited network.
If the visited network supports the use of an ATCF the home network will send
SRVCC information to the ATCF and, if the visited network supports CS to PS
SRVCC, the SCC AS sends SRVCC information to the MSC server.
### 4.4.2 Dialog creating SIP request and stand-alone SIP requests using the
registration path
This II-NNI traversal scenario is established when an UE or a MSC server (on
behalf of the user) registers. This II‑NNI traversal scenario is used to send
dialog creating (e.g. terminating a call) or stand-alone SIP requests to the
UE associated with the registered user.
The address of the P-CSCF or the MSC server is included as a URI in the Path
header field in the REGISTER request.
The URI received in the Path header field is included by the S-CSCF in the
Route header field in dialog creating and stand-alone SIP requests.
The procedures for registration of a roaming user and for establishing SIP
dialogs and sending stand-alone SIP requests from the home network towards the
visited network involving the P-CSCF are specified in 3GPP TS 24.229 [2]. The
procedures for registration of the roaming user and for establishing SIP
dialogs from the home network towards the visited network involving the MSC
server are described in 3GPP TS 24.292 [4] and 3GPP TS 29.292 [6].
### 4.4.3 SRVCC information
This II-NNI traversal scenario is used during PS to CS SRVCC access transfer
registration. A MESSAGE request is used by SCC AS to send the SRVCC-related
information to the ATCF.
The address of the ATCF is included by the ATCF as a URI in the g.3gpp.atcf-
mgmt-uri feature-capability indicator in a Feature-Caps header field. The URI
identifies the ATCF and is referred to as the ATCF management URI in 3GPP TS
24.237 [3] clause 4.3.
The ATCF management URI is included by the SCC AS in the Request-URI in the
MESSAGE request sent directly to the ATCF i.e. not over the path created by
the UE registration.
The procedures for sending the ATCF address to SCC AS and to send the MESSAGE
request containing SRVCC-related information to the ATCF are specified in 3GPP
TS 24.237 [3] clause 6.3.5 and clause 6.5.3.
## 4.5 Usages of information on II-NNI traversal scenario types
### 4.5.1 Screening of SIP signalling
3GPP TS 23.228 [9], clause 4.14 states that the functions provided by an IBCF
include \"_Screening SIP signalling information based on source/destination
and operator policy (e.g. remove information that is of local significance to
an operator) and optionally, for an IBCF located in the home network, policing
the IMS Communication Service ID_ \". Stage 3 screening procedures are
described in 3GPP TS 24.229 [2] clause 5.10.6.
Screening policies can take into account information from 3GPP TS 29.165 [10].
3GPP TS 29.165 [10] keeps apart non-roaming II-NNI, roaming II-NNI between the
visited originating network and the home originating network, loopback II-NNI
traversal scenario, and roaming II-NNI between the visited terminating network
and the home terminating network. IBCFs supporting different II-NNI traversal
scenario types (varying between calls) between two IMS networks could apply a
less restrictive screening, allowing the union set of all SIP capabilities
required for any of those II-NNI types.
As a possible enhancement of the existing procedures, IBCF could alternatively
identify the applicable II-NNI traversal scenario for a call and apply
different screening policies for different II-NNI traversal scenario types
(typically with more restrictive policing on a non-roaming II-NNI). 3GPP TS
23.228 [9] also mentions some policing only applicable at the IBCF located in
the home network.
### 4.5.2 Disallowing communication related to certain II-NNI traversal
scenario types
As a possible enhancement of the existing procedures to protect against
errors, an IBCF can reject requests relating to certain II-NNI types, e.g. if
no corresponding interoperability agreements with peer operators exist.
### 4.5.3 Tracking of interoperability errors
3GPP TS 29.165 [10] also aims to provide guidance for an inspection of SIP
signalling to identify interoperability related errors; this has been one of
the motivations listed for a finalized Rel-10 work item to provide a detailed
\"dynamic view\" of SIP messages in annex B of 3GPP TS 29.165 [10]. The
knowledge of the II-NNI traversal scenario types would allow a more stringent
check for and analysis of interoperability errors.
### 4.5.4 Enabling or disabling of OMR
Requirements that various core IMS nodes can request an IBCF acting as exit
point to provide or remove OMR related signalling information from requests
have already been agreed for the Roaming Architecture for Voice over IMS with
Local Breakout (see clause 4.15a of 3GPP TS 23.228 [9]). Related procedures
are already defined in clause 5.10.9 of 3GPP TS 24.229 [2].
Within the study on Optimised Service Charging and Allocation of Resources
(OSCAR) in 3GPP TR 23.849 [11], it has been concluded that existing
specifications already allow a usage of an MRF in the visited network for
transcoding or for inserting tones and announcements. However, to enable this
functionality a need to apply OMR on the related NNI traversal scenarios has
been identified. Related procedures are not yet defined.
### 4.5.5 Transcoding control
The IBCFs can also apply transcoding control procedures as defined in clause
5.10.7 of 3GPP TS 24.229 [2]. However offering transcoding or modifying codec
information can be harmful for certain types of II-NNI traversal scenarios, in
particular for the media control related NNI used for Optimised Service
Charging and Allocation of Resources (OSCAR) (see 3GPP TR 23.849 [11]). In
addition, to improve speech quality, it is desirable to apply transcoding not
more than one time for a given call. As a possible enhancement of the existing
procedures, operators can only offer transcoding for a certain II-NNI
traversal scenarios, for instance only at the ingress IBCF of home network B.
### 4.5.6 Collection of CDRs
IBCFs can generate charging events that will record the applicable II-NNI
traversal scenario type in CDRs which can be used for inter-operator
accounting. Inter-operator accounting is likely to depend on the applicable
II-NNI traversal scenario, and a collection of related information is
therefore desirable. In 3GPP TS 32.299 [8], an \"NNI‑Type AVP\" that allows to
include the applicable II-NNI traversal scenarios in CDRs is already defined,
but procedures how the IBCF derives the values for this AVP are not described.
### 4.5.7 Allowing the forwarding of incoming communication only to suitable
nodes
As a possible enhancement of existing procedures, IBCFs can check if SIP
requests received from external networks are directed to nodes which are
suitable for the II-NNI traversal scenario types (e.g. TRF for loopback II‑NNI
traversal scenario, or MRF).
## 4.6 Summary of identified issues
### 4.6.1 IBCFs can apply different policies for different II-NNI traversal
types if they are able to identify II-NNI traversal types
IBCF acting as an exit point and IBCF acting as an entry point on each side of
an II-NNI can use the II-NNI traversal scenario type in SIP requests when
determine which local policy to use when handling a received SIP request and
SIP response. Different impacted aspects of the local policy are detailed in
clause 4.5:
\- Screening of SIP signalling;
\- Disallowing communication related to certain II-NNI traversal scenario
types;
\- Tracking of interoperability errors;
\- Enabling or disabling of OMR;
\- Transcoding control;
\- Collection of CDRs; and
\- Allowing the forwarding of incoming communication only to suitable nodes.
SBC at the borders of transit networks can also use the network II-NNI
traversal scenario type in manners as detailed in clause 4.5.
IBCFs and SBC at the borders of transit networks need the ability to determine
the II-NNI traversal type for those purposes.
### 4.6.2 IBCF acting as an exit point and IBCF acting as an entry point
determines incorrect II-NNI traversal scenario type
If an incorrect II-NNI traversal scenario type is used the following problems
can occur:
\- inconsistent charging if one side uses the Request-URI as the base for
charging while the other side uses the Route header field as base for
charging;
\- inconsistent statistics per II-NNI traversal scenario type between
operators;
\- communication is rejected unnecessary e.g. if the incorrect II-NNI
traversal scenario type is not supported; and
\- the related subscription, the SIP dialog state information and the duration
information are not retained, when they could have been.
Regardless if the conclusion of the study results in that an implicit
detection of the II-NNI traversal scenario type or an explicit indication of
the II-NNI traversal scenario type isused the 3GPP TS 24.229 [2] and/or the
3GPP TS 29.165 [10] need to be updated to include:
\- if implicit detection of the II-NNI traversal scenario type is used, the
logic to be used by IBCF; or
\- if explicit indication of the II-NNI traversal scenario type is used, the
procedure to include the explicit indication.
### 4.6.3 Malicious networks
An indirectly connected malicious network can include in dialog creating SIP
requests or in SIP stand-alone requests:
\- information (e.g. a header field or a MIME body) that can be misleading if
implicit detection of II-NNI traversal scenario type is used; or
\- an incorrect II-NNI traversal scenario type indicator if explicit
indication of II-NNI traversal scenario type is used.
To avoid that behaviour of the malicious network results in that the IBCF uses
the wrong local policy when receiving a SIP request, a verification procedure
of the II-NNI traversal scenario type is needed. The verification procedure
will be based on information generated by trusted networks.
# 5 Requirements
## 5.1 Introduction
Based on the scenarios described in the previous clause, the following high
level requirements have been identified:
1) the solution shall enable the IBCF to identify an Inter-IMS Network to
Network Interface (II-NNI) traversal scenario type during the session
establishment and session modification;
2) the solution shall fulfil security consideration aspects (application of
trust policy and/or possibility of fraud shall be minimized);
3) the solution shall enable backward compatibility; and
4) the solution shall reuse or enhance the existing SIP signalling
information.
## 5.2 Interconnection requirements
The following requirements shall apply for determination of Inter-IMS Network
to Network Interface (II-NNI) traversal scenario:
a) the solution shall provide an information on what II-NNI traversal scenario
type the SIP request is part of; and
b) an indication of the II-NNI traversal scenario type shall be available in
dialog creating SIP requests and stand-alone SIP requests.
Inter operator agreement to support a particular the II-NNI traversal scenario
type and the indication of the II-NNI traversal scenario type can be used to
determine:
a) if the screening of SIP signalling shall be applied;
b) if the transcoding control shall be applied; and
c) the media anchoring point.
The indication of the II-NNI traversal scenario type can be used to:
a) identify interoperability related errors;
b) reject communication if no corresponding interoperability agreement with a
peer operator exist; and
c) collect new statistics.
# 6 Charging considerations
The solution for determination of the Inter-IMS Network to Network Interface
(II-NNI) traversal scenario type shall:
1) not interfere with the existing inter-operator accounting by providing the
NNI routeing scenario indication to a CDR;
2) have minimal impact on the IMS interconnection charging described in 3GPP
TS 32.260 [7];
3) have minimal impact on the roaming charging procedures for Roaming
Architecture for Voice over IMS with Local Breakout described in 3GPP TS
32.260 [7]; and
4) be compatible with the existing Rel-11 3GPP Attribute Value Pairs (AVPs):
the NNI-Information AVP and the NNI-Type AVP i.e. values \"non-roaming\",
\"roaming without loopback routing\" or \"roaming with loopback routing\"
which are used for interconnection and roaming and are defined in 3GPP TS
32.299 [8].
# 7 Possible solutions
## 7.1 Introduction
Implicit detection of II-NNI traversal scenario type and explicit indication
of II-NNI traversal scenario type are identified as possible solutions.
Clause 7.2 describes the implicit detection of II-NNI traversal scenario type
and clause 7.3 describes the explicit indication of II-NNI traversal scenario
type. Annex A provides examples of both solutions.
NOTE: Clause 7 describes potential solutions with a language also used in
normative specifications, but is purely informational. The language is used
for the sake of clarity and to simplify the potential transfer of agreed
solutions to normative specifications.
## 7.2 Implicit detection of II-NNI traversal scenario type
### 7.2.1 Procedure
IBCFs analyse existing SIP signalling to identify the applicable II-NNI
traversal scenario type may use the identified II‑NNI traversal scenario type
for the purposes outlined in clause 4.5.
In the following bullet list, some SIP feature capabilities proposed as
potential solutions are evaluated:
\- **\"+g.3gpp.trf\"** \ This feature-capability indicator is used to indicate
visited network support of the roaming architecture for voice over IMS with
local breakout and to transport the TRF address. However, according to clause
5.2.7.2 of 3GPP TS 24.229 [2], it is only optional for a visited P-CSCF to
include the \"g.3gpp.trf\" feature capability indicator even if an agreement
exists with the home network operator to support roaming architecture for
voice over IMS with local breakout. If no such agreement exists, the roaming
P-CSCF will not include this indicator.\ Thus, the presence of the
\"g.3gpp.trf\" feature-capability indicator in an initial INVITE request is a
sufficient, but not a necessary condition, that a dialog creating SIP request
using the registration path relates to a \"Roaming user on the originating
side II-NNI traversal scenario\" (see clause 4.2).
\- **\"+g.3gpp.loopback\"** \ This feature-capability indicator is used to
indicate support of the roaming architecture for voice over IMS with local
breakout and that the INVITE request is a loopback request. The feature-
capability indicator carries a parameter which indicates the identity of the
home network.\ Thus, the presence of the \"g.3gpp.loopback\" feature-
capability indicator in an initial INVITE request is a necessary and
sufficient condition that a dialog creating SIP request using the registration
path relates to a \"Loopback\" II-NNI-Traversal scenario (see clause 4.2.6).
\- **\"+g.3gpp.home-visited\"** \ This feature-capability indicator is used to
indicate the home network supports loopback to the identified visited network
for this session. The loopback is expected to be applied at some subsequent
entity to the insertion point. The feature-capability indicator carries a
parameter which indicates the identity of the visited network.\ The
\"g.3gpp.home-visited\" is only used within the home network of the
originating user. It will not be encountered for any II-NNI traversal
scenario.
\- **\"+g.3gpp.mrb\"** \ This feature-capability indicator can be used by the
visited P-CSCF to indicate visited network support of the media resource
broker functionality for the allocation of multimedia resources in the visited
network (see clause 5.2.7.2 of 3GPP TS 24.229 [2]).\ Thus, the presence of the
\"g.3gpp.mrb\" feature capability indicator in an initial INVITE request is a
sufficient, but not a necessary condition, that a dialog creating SIP request
using the registration path relates to a \"Roaming user on the originating
side II-NNI traversal scenario\" (see clause 4.2).
An analysis of SIP header fields in the INVITE request is provided in the
following bullets:
\- 3GPP TS 29.165 [10], table A.1, lists the following SIP header fields as
mandatory or optional to be supported at the roaming II-NNI and not applicable
at the non-roaming II-NNI: Allow-Events, Authentication‑Info, Authorization,
Flow-Timer, P-Associated-URI, P-Called-Party-ID, P-Preferred-Service,
P-Profile-Key, P‑Served-User, P-Visited-Network-ID, Path, Proxy-Authenticate,
Proxy-Authorization, Service-Route, WWW‑Authenticate. This table does not make
a distinction between the home-to-visited request on roaming II‑NNI and the
visited-to-home request on roaming II-NNI, and does not consider which SIP
header fields are mandatory to be included in a given SIP message.
\- Annex B of 3GPP TS 29.165 [10] provides a distinction between the home-to-
visited request on roaming II‑NNI and the visited-to-home request on roaming
II-NNI, and also considers which SIP header fields are mandatory to be
included in a given SIP message. Table B.7.1 of 3GPP TS 29.165 [10] provides
such information for the INVITE request; none of the SIP header fields listed
above are identified as mandatory to be included and only two SIP header
fields out of those header fields are listed as only applicable for the
visited-to-home request on roaming II-NNI (P-Preferred-Service header field,
P-Served-User header field) and one SIP header fields is listed as only
applicable for the home-to-visited request on roaming II-NNI (\"P‑Called-
Party-ID\").
In the following bullet list, some SIP header fields that allow deriving
certain II-NNI traversal scenarios for the SIP INVITE request are listed:
\- **P-Called-Party-ID header field** \ The presence of this SIP header field
in an initial INVITE request is a sufficient, but not a necessary condition,
that a dialog creating SIP request using the registration path relates to a
\"Roaming user on the terminating side II-NNI traversal scenario\" (see clause
4.4).
\- **P-Preferred-Service header field** \ The presence of this SIP header
field in an initial INVITE request is a sufficient, but not a necessary
condition, that a dialog creating SIP request using the registration path
relates to a \"Roaming user on the originating side II‑NNI traversal
scenario\" (see clause 4.2).
\- **P-Served-User header field** \ The presence of this SIP header field in
an initial INVITE request is a sufficient, but not a necessary condition, that
a dialog creating SIP request using the registration path relates to a
\"Roaming user on the originating side II‑NNI traversal scenario\" (see clause
4.2).
NOTE: The P-Preferred-Service header field is only supported in 3GPP TS 24.229
[2] from Rel-7 onwards. The P-Served-User header field is only supported in
3GPP TS 24.229 [2] from Rel-8 onwards. Network entities compliant to earlier
releases of 3GPP TS 24.229 [2] will not apply specific procedures related to
these SIP header fields and can pass them transparently. As a consequence,
these SIP header fields could also be encountered for other II-NNI traversal
scenarios.
For the SIP REGISTER request, some examples with the identification of some
II-NNI traversal scenarios are provided in Annex A.
To sum up, for the SIP INVITE request existing SIP header fields and SIP
feature capabilities:
\- allow identifying all SIP request relating to the \"II-NNI Loopback\" II-
NNI-Traversal scenario (see clause 4.2.6) via the presence of the
\"+g.3gpp.trf\" feature capability-indicator;
\- allow identifying some, but not all, SIP request relating to \"Roaming user
on the originating side II-NNI traversal scenario\" (see clause 4.2).via the
presence of the \"+g.3gpp.trf\" and/or \"+g.3gpp.mrb\" feature capability
indicators and/or via the presence of the P-Preferred-Service header field
and/or the P-Served-User header field;
\- allow identifying some, but not all, SIP request relating to \"Roaming user
on the terminating side II-NNI traversal scenario\" (see clause 4.4).via the
presence of the P-Called-Party-ID header field; and
\- do not allow identifying SIP request relating to other II-NNI traversal
scenarios.
### 7.2.2 Security aspects of the implicit detection of the II‑NNI traversal
scenario solution
The IBCF acting as the entry point shall only use trusted elements in a
received dialog creating SIP request or stand‑alone SIP request to determine
the II‑NNI traversal scenario.
NOTE: Examples of trusted elements are protocol elements within the trust
domain and protocol elements manipulated, checked or added by a previous hop
secured by network domain security.
## 7.3 Explicit indication of II-NNI traversal scenario type
### 7.3.1 Procedures
An indication about the II-NNI traversal scenario type is added to the SIP
signalling (for the encoding, see clause 7.3.2).
IMS network entities that decide to route the call over an NNI (e.g. S-CSCF,
P-CSCF, AS, TRF, and BGCF) supply the II-NNI traversal scenario type
indication.
An IBCF acting as entry point may use the indicated II-NNI traversal scenario
type for the purposes outlined in clause 4.4 and should forward the indicated
II-NNI traversal scenario type within the SIP call setup signalling without
modifications.
An IBCF acting as exit point:
\- shall check if a indicated II-NNI traversal scenario type is received from
a trusted network and otherwise discard this indication;
\- if no II-NNI traversal scenario type was indicated for a SIP request
outside an existing dialogue, or if the indication was discarded due to a lack
of trust:
a) should try to derive the II-NNI traversal scenario type from analysis of
other parts of the SIP signalling (see clause 7.2); or
b) if the II-NNI traversal scenario type cannot be determined, should assume
the II-NNI traversal scenario type from originating to terminating home
network;
\- may use the indicated II-NNI traversal scenario type for the purposes
outlined in clause 4.4; and
\- shall either remove the indication, or include it the signalling they
forward to core network nodes with subscriber profiles (e.g. I-SCSF, S-CSCF)
and resulting extended capabilities for checking if the indicated II‑NNI
traversal scenario type is permissible.
Core network nodes with extended capabilities for checking if the indicated
II-NNI traversal scenario type is permissible that receive an II-NNI traversal
scenario type indication:
\- should reject SIP requests that are not permissible due to the indicated
II-NNI traversal scenario type; and
\- shall remove the received II-NNI traversal scenario type indication.
### 7.3.2 Encoding Options
#### 7.3.2.1 General
The following clauses describe the possible solutions for the explicit
indication of the II-NNI traversal scenario type.
Protocol requirements for the target protocol are described in clause B.2.3
and the evaluations of compliance with those requirements are described in
clause 7.3.3.
#### 7.3.2.2 New SIP header field
##### 7.3.2.2.1 General
The syntax of the II-NNI-Scenario header field is described as follows:
Table 7.3.2.2.1.1: Syntax of II-NNI-Scenario header field
II-NNI-Scenario = \"II-NNI-Scenario\" HCOLON ii-nni-value
ii-nni-value = \"visited-home-roaming\" / \"home-visited-roaming\" / \"home-
visited-loopback\" / \"home‑as‑to‑visited‑mrb\" / genvalue
NOTE 1: The syntax above have to be updated so that a procedure for reserving
II-NNI traversal scenario type indication values with IANA can be used. The
values above is only included here as examples used in the clause 7.3.2.2.2.
NOTE 2: If the \"new SIP header field\" solution is selected, the final set of
values will be decided during the development of the 3GPP stage 3 technical
specifications in cooperation with IETF.
The II-NNI-Scenario header field parameter with an appropriate II-NNI
traversal scenario type value is included by the node in the beginning of an
II-NNI traversal scenario when sending a dialog creating SIP request or a
stand‑alone SIP request.
This solution requires a new IETF RFC.
##### 7.3.2.2.2 Example of usage of the II-NNI-Scenario header field
This clause illustrates:
\- when the node in the beginning of the II-NNI traversal scenario adds the
II-NNI-Scenario header field with the value \"visited-home-roaming\", the
\"home-visited-roaming\", the \"home-visited-loopback\" or the
\"home‑visited‑as‑to‑mrb\" II-NNI traversal scenario types in the INVITE
request; and
\- when the II-NNI-Scenario header field with the value \"visited-home-
roaming\", the \"home-visited-roaming\", the \"home-visited-loopback\" or the
\"home-visited-as-to-mrb\" is removed by the node in the end of the II‑NNI
traversal scenario.
NOTE 1: The same principles can be applied for other II-NNI traversal scenario
types.
NOTE 2: The illustrated examples are under the assumption that all involved
functional entities are within the same trust domain for the new SIP header
field.
Figure 7.3.2.2.2.1 below illustrates how the II-NNI-Scenario header field with
the value \"visited-home-roaming\" is added by the P-CSCF and removed by the
S-CSCF.
Figure 7.3.2.2.2.1: Usage of the II-NNI-Scenario header field with the value\
\"visited‑home‑roaming\" as II-NNI traversal scenario type
1\. The UE sends an initial INVITE request to the P-CSCF.
2\. The P-CSCF checks the operator agreements and detects that the home
network supports indicating the II‑NNI traversal scenario type. The P-CSCF
adds the II-NNI-Scenario header field with the value \"visited‑home-roaming\".
NOTE 3: P-CSCF need to check a local policy based on bilateral operator
agreements before including the II‑NNI traversal type in a SIP request to
avoid that the S-CSCF with a legacy implementation forwards the II‑NNI
traversal scenario type indication. Intermediate nodes with legacy
implementations are not impacted.
NOTE 4: As an alternative the IBCF acting as an exit point can do the check
and remove the II-NNI-Scenario header field if the home network does not
support removing the II-NNI-Scenario header field. The advantage with this
approach is that the exit IBCF can use the indication instead of a default
value when the home network operator does not support indicating II-NNI
traversal scenario type.
3-5. The INVITE request is sent in the registration path and finally received
by the S-CSCF. Anyone in the registration path can use the II-NNI traversal
scenario type to determine which local policy to apply.
NOTE 5: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes the II-NNI-Scenario header field if present.
6\. Since the home network supports indicating II-NNI traversal scenario, the
S-CSCF removes the II‑NNI‑Scenario header field from the INVITE request before
forwarding the INVITE request.
NOTE 6: As an alternative the IBCF acting as an entry point can remove the II-
NNI-Scenario header field if the S‑CSCF does not support removing the header
field.
Figure 7.3.2.2.2.2 below illustrates how the II-NNI-Scenario header field with
the value \"home-visited-loopback\" is added by the S-CSCF and removed by the
TRF.
Figure 7.3.2.2.2.2: Usage of the II-NNI-Scenario header field with the value
\"home‑visited‑loopback\" as II-NNI traversal scenario type
1\. The S-CSCF receives an initial INVITE request from a served user.
2\. The S-CSCF checks the operator agreements and detects that the visited
network supports indicating the II‑NNI traversal scenario type. The S-CSCF
adds the II-NNI-Scenario header field with the value
\"home‑visited‑loopback\".
NOTE 7: S-CSCF need to check a local policy based on bilateral operator
agreements before including the II‑NNI traversal type in a SIP request to
avoid that the TRF with a legacy implementation forwards the II-NNI traversal
scenario type indication. Intermediate nodes with legacy implementations are
not impacted.
NOTE 8: As an alternative the IBCF acting as an exit point can do the check
and remove the II-NNI-Scenario header field if the visited network does not
support removing the II-NNI-Scenario header field. The advantage with this
approach is that the exit IBCF can use the indication instead of a default
value when the home network operator does not support indicating II-NNI
traversal scenario type.
3-5. The INVITE request is sent in the registration path and finally received
by the TRF. Anyone in the registration path can use the II-NNI traversal
scenario type to determine which local policy to apply.
NOTE 9: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes the II-NNI-Scenario header field if present.
6\. Since the visited network supports indicating II-NNI traversal scenario,
the TRF removes the II-NNI-Scenario header field from the INVITE request
before forwarding the INVITE request.
NOTE 10: As an alternative the IBCF acting as an entry point can remove the
II-NNI-Scenario header field if the TRF does not support removing the header
field.
Figure 7.3.2.2.2.3 below illustrates how the II-NNI-Scenario header field with
the value \"home-as-to-visited-mrb\" is added by an AS.
Figure 7.3.2.2.2.3: Usage of the II-NNI-Scenario header field with the value
\"home‑as‑to‑visited‑mrb\" as II-NNI traversal scenario type
1\. The AS receives an initial INVITE request from the visited network. The
INVITE request can contain a Feature-Capability header field with the
g.3gpp.mrb feature-capability indicator containing a MRF/MRB address or the AS
can have a configured MRF/MRB address available.
2\. The AS decides to use media resources in the visited network and sends the
INVITE request towards the visited network. The AS checks if the visited
network supports indicating II-NNI traversal scenario. Since that is the case,
the AS includes the II-NNI-Scenario header field with the value \"home-as-to-
visited-mrb\" in the Feature‑Caps header field.
NOTE 11: As an alternative the IBCF acting as an exit point can do the check
and remove the II‑NNI‑Scenario header field if the visited network does not
support removing the II-NNI-Scenario header field. The advantage with this
approach is that the exit IBCF can use the indication instead of a default
value when the home network operator does not support indicating II-NNI
traversal scenario type.
3-5. The INVITE request is sent in the registration path and finally received
by MRB/MRF. Anyone in the path between the AS and MRB/MRF can use the II-NNI
traversal scenario type to determine which local policy to apply.
NOTE 12: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes the II-NNI-Scenario header field if present.
6\. Since the final destination is the MRB/MRF for the INVITE request, it is
not necessary to remove the II‑NNI‑Scenario header field.
Figure 7.3.2.2.2.4 below illustrates how the II-NNI-Scenario header field with
the value \"home-visited-roaming\" is added by the S-CSCF and removed by the
P-CSCF.
Figure 7.3.2.2.2.4: Usage of the II-NNI-Scenario header field with the value
\"home‑visited‑roaming\" as II-NNI traversal scenario type
1\. The S-CSCF receives an initial INVITE request from the originating side.
2\. The S-CSCF checks the roaming agreements and detects that the visited
network supports indicating the II‑NNI traversal scenario type. The P-CSCF
adds the II-NNI-Scenario header field with the value \"home‑visited‑roaming\".
NOTE 13: S-CSCF need to check a local policy based on bilateral operator
agreements before including the II‑NNI traversal type in a SIP request to
avoid that the P-CSCF with a legacy implementation forwards the II‑NNI
traversal scenario type indication. Intermediate nodes with legacy
implementations are not impacted.
NOTE 14: As an alternative the IBCF acting as an exit point can do the check
and remove the II‑NNI‑Scenario header field if the visited network does not
support removing the II-NNI-Scenario header field. The advantage with this
approach is that the exit IBCF can use the indication instead of a default
value when the home network operator does not support indicating II-NNI
traversal scenario type.
3-5. The INVITE request is sent in the registration path and finally received
by the P-CSCF. Anyone in the registration path can use the II-NNI traversal
scenario type to determine which local policy to apply.
NOTE 15: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes the II-NNI-Scenario header field if present.
6\. Since the visited network supports indicating II-NNI traversal scenario,
the P-CSCF removes the II‑NNI‑Scenario header field from the INVITE request
before forwarding the INVITE request.
NOTE 16: As an alternative the IBCF acting as an entry point can remove the
II-NNI-Scenario header field if the P‑CSCF does not support removing the
header field.
#### 7.3.2.3 Enhancing P-Charging-Vector SIP header field
##### 7.3.2.3.1 General
The syntax for the P-Charging-Vector header field is described as follows:
Table 7.3.2.3.1.1: Syntax of extension to P-Charging-Vector header field
+----------------------------------------------------------------------+ | P-Charging-Vector = \"P-Charging-Vector\" HCOLON icid-value | | | | *(SEMI charge-params) | | | | charge-params = icid-gen-addr / orig-ioi / term-ioi / transit-ioi / | | related-icid / related-icid-gen-addr / **_ii-nni_** / generic-param | | | | icid-value = \"icid-value\" EQUAL gen-value | | | | icid-gen-addr = \"icid-generated-at\" EQUAL host | | | | orig-ioi = \"orig-ioi\" EQUAL gen-value | | | | term-ioi = \"term-ioi\" EQUAL gen-value | | | | transit-ioi = \"transit-ioi\" EQUAL transit-ioi-list | | | | transit-ioi-list = DQUOTE transit-ioi-param *(COMMA | | transit-ioi-param) DQUOTE | | | | transit-ioi-param = transit-ioi-indexed-value / | | transit-ioi-void-value | | | | transit-ioi-indexed-value = transit-ioi-name DOT transit-ioi-index | | | | transit-ioi-name = ALPHA * (ALPHA / DIGIT) | | | | transit-ioi-index = 1*DIGIT | | | | transit-ioi-void-value = \"void\" | | | | related-icid = \"related-icid\" EQUAL gen-value | | | | related-icid-gen-addr = \"related-icid-generated-at\" EQUAL host | | | | **_ii-nni = \"ii-nni\" EQUAL ii-nni-value_** | | | | **_ii-nni-value = \"visited-home-roaming\" / | | \"home-visited-roaming\" / \"home_** ‑** _visited_** ‑** _loopback\" / | | \"home-as-to-visited-mrb\" / genvalue_** | +----------------------------------------------------------------------+
NOTE: The values of the \"ii-nni\" header field parameter above are just
example values. If the \"enhancing P‑Charging‑Vector SIP header field\"
solution is selected, the final set of values will be decided during the
development of the 3GPP stage 3 technical specifications in cooperation with
IETF in future revisions of IETF draft-drage-sipping-rfc3455bis [14].
The \"ii-nni\" header parameter with an appropriate II-NNI traversal scenario
type value is included in the P‑Charging‑Vector header field by the node in
the beginning of an II-NNI traversal scenario when sending a dialog creating
SIP request or a stand-alone SIP request.
This solution requires an update of the IETF draft-drage-sipping-rfc3455bis
[14].
##### 7.3.2.3.2 Example of usage of the \"ii-nni\" header parameter
This clause illustrates:
\- when the node in the beginning of the II-NNI traversal scenario adds to the
P-Charging-Vector header field the \"ii-nni\" header field parameter with the
\"visited-home-roaming\", the \"home-visited-roaming\", the
\"home‑visited‑loopback\" or the \"home-visited-as-to-mrb\" II-NNI traversal
scenario types in the INVITE request; and
\- when the \"ii-nni\" header field parameter with the \"visited-home-
roaming\", the \"home-visited-roaming\", the \"home-visited-loopback\" or the
\"home-visited-as-to-mrb\" value is removed from the P-Charging-Vector header
field by the node in the end of the II-NNI traversal scenario.
NOTE 1: The same principles can be applied for other II-NNI traversal scenario
types.
NOTE 2: The illustrated examples are under the assumption that all involved
functional entities are within the same trust domain for the P-Charging-Vector
header field.
Figure 7.3.2.3.2.1 below illustrates how the \"ii-nni\" header field parameter
with the value \"visited‑home‑roaming\" is added to the P-Charging-Vector
header field by the P-CSCF and removed by the S-CSCF.
NOTE: For clarity, only the \"ii-nni\" header field parameter in the
P-Charging-Vector (PCV) header field is shown in the signalling flow.
Figure 7.3.2.3.2.1: Usage of \"ii‑nni\" header field parameter in the
P-Charging-Vector header field set to \"visited‑home‑roaming\" as II‑NNI
traversal scenario type
1\. The UE sends an initial INVITE request to the P-CSCF.
2\. The P-CSCF checks the operator agreements and detects that the home
network supports indicating the II‑NNI traversal scenario type. The P-CSCF
adds a P-Charging-Vector header field and includes the mandatory header field
parameters (\"icid\", \"orig-ioi\", etc.) and an \"ii-nni\" header field
parameter set to \"visited-home-roaming\".
NOTE 3: P-CSCF need to check a local policy based on bilateral operator
agreements before including the II‑NNI traversal type in a SIP request to
avoid that S-CSCF with a legacy implementation forwards the II-NNI traversal
scenario type indication. Intermediate nodes with legacy implementations are
not impacted.
NOTE 4: As an alternative the IBCF acting as an exit point can do the check
and remove the \"ii-nni\" header field parameter if the home network does not
support removing the \"ii-nni\" header field parameter. The advantage with
this approach is that the exit IBCF can use the indication instead of a
default value when the home network operator does not support indicating II-
NNI traversal scenario type.
3-5. The INVITE request is sent in the registration path and finally received
by the S-CSCF. Anyone in the registration path can use the II-NNI traversal
scenario type to determine which local policy to apply.
NOTE 5: The above is in principle true. However, conceptual wise the content
of the P-Charging-Vector header field is only available for charging purposes.
IETF RFC 3455 [13] states:\ \ \"The P-Charging-Vector header field is used to
convey charging related information, such as the globally unique IMS charging
identifier (ICID) value.\"
NOTE 6: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes the P-Charging-Vector header field, if present.
6\. Since the home network supports indicating II-NNI traversal scenario, the
S-CSCF removes the \"ii-nni\" header field parameter from the P-Charging-
Vector header field before forwarding the INVITE request.
NOTE 7: As an alternative the IBCF acting as an entry point can remove the
g.3gpp.ii-nni feature-capability indicator if the S-CSCF does not support
removing it.
Figure 7.3.2.3.2.2 below illustrates how the \"ii-nni\" header field parameter
in the P-Charging-Vector header field set to \"home-visited-loopback\" is
added by the S-CSCF and removed by the TRF.
NOTE: For clarity, only the \"ii-nni\" header field parameter in the
P-Charging-Vector (PCV) header field is shown in the signalling flow.
Figure 7.3.2.3.2.2: Usage of the \"ii‑nni\" header field parameter in the
P‑Charging‑Vector header field set to \"home‑visited‑loopback\" as II‑NNI
traversal scenario type
1\. The S-CSCF receives an initial INVITE request from a served user.
2\. The S-CSCF checks the operator agreements and detects that the visited
network supports indicating the II‑NNI traversal scenario type. The S-CSCF
adds a P-Charging-Vector header field and includes the mandatory header field
parameters (\"icid\", \"orig-ioi\", etc.) and an \"ii-nni\" header field
parameter set to \"home-visited-loopback\".
NOTE 8: S-CSCF need to check a local policy based on bilateral operator
agreements before including the II‑NNI traversal type in a SIP request to
avoid that TRF with a legacy implementation forwards the II‑NNI traversal
scenario type indication. Intermediate nodes with legacy implementations are
not impacted.
NOTE 9: As an alternative the IBCF acting as an exit point can do the check
and remove the \"ii-nni\" header field parameter if the visited network does
not support removing the \"ii-nni\" header field parameter. The advantage with
this approach is that the exit IBCF can use the indication instead of a
default value when the visited network operator does not support indicating
II-NNI traversal scenario type.
3-5. The INVITE request is sent in the registration path and finally received
by the TRF. Anyone in the registration path can use the II-NNI traversal
scenario type to determine which local policy to apply.
NOTE 10: The above is in principle true. However, conceptual wise the content
of the P-Charging-Vector header field is only available for charging purposes.
IETF RFC 3455 [13] states:\ \ \"The P-Charging-Vector header field is used to
convey charging related information, such as the globally unique IMS charging
identifier (ICID) value.\"
NOTE 11: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes the P-Charging-Vector header field, if present.
6\. Since the visited network supports indicating II-NNI traversal scenario,
the TRF removes the \"ii-nni\" header field parameter from the P-Charging-
Vector header field before forwarding the INVITE request.
NOTE 12: As an alternative the IBCF acting as an entry point can remove the
g.3gpp.ii-nni feature-capability indicator if the S-CSCF does not support
removing it.
Figure 7.3.2.3.2.3 below illustrates how the \"ii-nni\" header field parameter
in the P-Charging-Vector header field set to \"home-as-to-visited-mrb\" is
added by an AS.
Figure 7.3.2.3.2.3: Usage of the \"ii‑nni\" header field parameter in the
P‑Charging‑Vector header field set to \"home‑as‑to‑visited‑mrb\" as II‑NNI
traversal scenario type
1\. The AS receives an initial INVITE request from the visited network. The
INVITE request may contain a Feature-Capability header field with the
g.3gpp.mrb feature-capability indicator containing a MRF/MRB address or the AS
may have a configured MRF/MRB address available.
2\. The AS decides to use media resources in the visited network and sends an
INVITE request towards the visited network. The AS checks if the visited
network supports indicating II-NNI traversal scenario. Since that is the case,
the AS adds a P-Charging-Vector header field and includes the mandatory header
field parameters (\"icid\", \"orig-ioi\", etc.) and an \"ii-nni\" header field
parameter set to \"home-as-to-visited-mrb\".
NOTE 13: As an alternative the IBCF acting as an exit point can do the check
and remove the \"ii-nni\" header field parameter if the visited network does
not support removing the \"ii-nni\" header field parameter. The advantage with
this approach is that the exit IBCF can use the indication instead of a
default value when the visited network operator does not support indicating
II-NNI traversal scenario type.
3-5. The INVITE request is sent in the registration path and finally received
by MRB/MRF. Anyone in the path between the AS and the MRB/MRF can use the II-
NNI traversal scenario type to determine which local policy to apply.
NOTE 14: The above is in principle true. However, conceptual wise the content
of the P-Charging-Vector header field is only available for charging purposes.
IETF RFC 3455 [13] states:\ \ \"The P-Charging-Vector header field is used to
convey charging related information, such as the globally unique IMS charging
identifier (ICID) value.\"
NOTE 15: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes the P-Charging-Vector header field, if present.
6\. Since the final destination is the MRB/MRF for the INVITE request, it is
not necessary to remove the \"ii‑nni\" header field parameter from the
P-Charging-Vector header field.
Figure 7.3.2.3.2.4 below illustrates how the \"ii-nni\" header field parameter
in the P-Charging-Vector header field set to \"home-visited-roaming\" is added
by the S-CSCF and removed by the P-CSCF.
Figure 7.3.2.3.2.4: Usage of the \"ii‑nni\" header field parameter in the
P‑Charging‑Vector header field set to \"home‑visited‑roaming\" as II‑NNI
traversal scenario type
1\. The S-CSCF receives an initial INVITE request from the originating side.
2\. The S-CSCF checks the roaming agreements and detects that the visited
network supports indicating the II‑NNI traversal scenario type. The S-CSCF
adds a P-Charging-Vector header field and includes the mandatory header field
parameters (\"icid\", \"orig-ioi\", etc.) and an \"ii-nni\" header field
parameter set to \"home-visited-roaming\".
NOTE 16: S-CSCF need to check a local policy based on bilateral operator
agreements before including the II‑NNI traversal type in a SIP request to
avoid that TRF with a legacy implementation forwards the II‑NNI traversal
scenario type indication. Intermediate nodes with legacy implementations are
not impacted.
NOTE 17: As an alternative the IBCF acting as an exit point can do the check
and remove the \"ii-nni\" header field parameter if the visited network does
not support removing the \"ii-nni\" header field parameter. The advantage with
this approach is that the exit IBCF can use the indication instead of a
default value when the visited network operator does not support indicating
II-NNI traversal scenario type.
3-5. The INVITE request is sent in the registration path and finally received
by the P-CSCF. Anyone in the registration path can use the II-NNI traversal
scenario type to determine which local policy to apply.
NOTE 18: The above is in principle true. However, conceptual wise the content
of the P-Charging-Vector header field is only available for charging purposes.
IETF RFC 3455 [13] states:\ \ \"The P-Charging-Vector header field is used to
convey charging related information, such as the globally unique IMS charging
identifier (ICID) value.\"
NOTE 19: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes the P-Charging-Vector header field, if present.
6\. Since the visited network supports indicating II-NNI traversal scenario,
the P-CSCF removes the P‑Charging‑Vector header field before the INVITE
request is forwarded.
NOTE 20: As an alternative the IBCF acting as an entry point can remove the
g.3gpp.ii-nni feature-capability indicator if the P-CSCF does not support
removing it.
#### 7.3.2.4 New value(s) for the SIP Feature-Caps header field
##### 7.3.2.4.1 General
Feature-capability indicator name: g.3gpp.ii-nni
Summary of the feature indicated by this feature-capability indicator:
This feature-capability indicator when used in a Feature-Caps header field of
a SIP request or a SIP response indicates that the functional entity including
the feature-capability indicator in the SIP message supports indicating the
II-NNI traversal scenario.
Feature-capability indicator specification reference:
3GPP TS 24.229 [2], http://www.3gpp.org/ftp/Specs/archive/24_series/24.229/
Values appropriate for use with this feature-capability indicator:
String with an equality relationship.
When used in the Feature-Caps header field, the value follows the syntax as
described in table 7.3.2.4.1.1 for the g.3gpp.ii‑nni feature‑capability
indicator.
Table 7.3.2.4.1.1: ABNF syntax of values of the g.3gpp.ii-nni feature-
capability indicator
g-3gpp-ii-nni = ii-nni-tag \"=\" ii-nni-value
ii-nni-tag = \"ii-nni\"
ii-nni-value = \"visited-home-roaming\" / \"home-visited-roaming\" / \"home-
visited-loopback\" / \"home‑as‑to‑visited‑mrb\" / \"not-indicated\" / genvalue
NOTE 1: The values of the \"ii-nni\" feature-capability indicator above are
just example values. If the \"new value(s) for the SIP Feature-Caps header
field\" solution is selected, the final set of values will be decided during
the development of the 3GPP stage 3 technical specifications.
The feature-capability indicator is intended primarily for use in the
following applications, protocols, services, or negotiation mechanisms: This
feature-capability indicator is used to indicate that the II-NNI traversal
scenario type indication is supported. The feature-capability indicator
carries a parameter which indicates the II-NNI traversal scenario type.
Examples of typical use: A visited network indicating support of II-NNI
traversal scenario type indication.
Security Considerations: Security considerations for this feature-capability
indicator are discussed in clause 9 of IETF RFC 6809 [12].
The mechanism will be backward compatible:
\- If the node in the beginning of an II-NNI traversal scenario knows
according to a local policy that the node addressed in the Request‑URI or in
the Route header field (if the Route header field will be used for routeing a
request) supports indicating the II-NNI traversal scenario type and a received
request does not contain a g.3gpp.ii‑nni feature‑capability indicator, then
the g.3gpp.ii-nni feature-capability indicator with an appropriate II‑NNI
traversal scenario type value is included in dialog creating SIP requests and
in stand-alone SIP requests.
\- If the node in the beginning of an II‑NNI traversal scenario knows
according to a local policy that the node addressed in the Request‑URI or in
the Route header field (if the Route header field will be used for routeing a
request) does not support indicating the II‑NNI traversal scenario type and a
received request does not contain a g.3gpp.ii‑nni feature‑capability
indicator, then the g.3gpp.ii‑nni feature‑capability indicator with the II‑NNI
traversal scenario type value is not included in dialog creating SIP requests
or stand‑alone SIP requests.
NOTE 2: The node in the beginning of an II‑NNI traversal scenario is the node
with the task to insert the feature‑capability indicator (e.g. P-CSCF, S-CSCF,
etc.).
\- If the node addressed in the Request‑URI or in the Route header field (if
the Route header field was used for routeing the request) receives a dialog
creating SIP request or a stand‑alone SIP request containing the g.3gpp.ii‑nni
feature‑capability indicator forwards SIP request and the node knows by local
policy that the next node addressed in the Request‑URI or in a Route header
field supports indicating the II-NNI traversal scenario type, then the value
of g.3gpp.ii‑nni feature-capability indicator is updated to the next II-NNI
traversal scenario type.
\- If the node addressed in the Request‑URI or in the Route header field (if
the Route header field was used for routeing the request) receives a dialog
creating SIP request or a stand-alone SIP request containing the g.3gpp.ii‑nni
feature‑capability indicator forwards the SIP request and the node knows by
local policy that the next node addressed in the Request‑URI or in a Route
header field does not support indicating the II‑NNI traversal scenario type,
then the value of the g.3gpp.ii‑nni feature‑capability indicator is set to
\"not-indicated\".
The new feature-capability indicator requires expert review as part of the
IANA registration procedure.
##### 7.3.2.4.2 Example of usage of the g.3gpp.ii-nni feature capability
indicator
This clause illustrates:
\- when the node in the beginning of the II-NNI traversal scenario adds the
g.3gpp.ii-nni feature capability indicator with the \"visited-home-roaming\",
the \"home-visited-roaming\", the \"home-visited-loopback\" or the \"home-
visited-as-to-mrb\" II-NNI traversal scenario types in the INVITE request; and
\- when the g.3gpp.ii-nni feature capability indicator with the \"visited-
home-roaming\", the \"home‑visited‑roaming\", the \"home-visited-loopback\" or
the \"home-visited-as-to-mrb\" value is removed by the node in the end of the
II-NNI traversal scenario.
NOTE 1: The same principles can be applied for other II-NNI traversal scenario
types.
NOTE 2: The illustrated examples are under the assumption that all involved
functional entities are within the same trust domain for the Feature-Caps
header field.
Figure 7.3.2.4.2.1 below illustrates how the g.3gpp.ii-nni feature capability
indicator with the value \"visited‑home‑roaming\" is added by the P-CSCF and
removed by the S-CSCF.
Figure 7.3.2.4.2.1: Usage of \"g.3gpp.ii‑nni=visited‑home‑roaming\" as II‑NNI
traversal scenario type
1\. The UE sends an initial INVITE request to the P-CSCF.
2\. The P-CSCF checks the operator agreements and detects that the home
network supports indicating the II‑NNI traversal scenario type. The P-CSCF
adds the g.3gpp.ii-nni feature capability indicator with the value
\"visited‑home-roaming\" in a Feature-Caps header field.
NOTE 3: P-CSCF need to check a local policy based on bilateral operator
agreements before including the II‑NNI traversal type in a SIP request to
avoid that S-CSCF with a legacy implementation forwards the II-NNI traversal
scenario type indication. Intermediate nodes with legacy implementations are
not impacted.
NOTE 4: As an alternative the IBCF acting as an exit point can do the check
and change the g.3gpp.ii-nni feature‑capability indicator value to
\"not‑indicated\" if the home network does not support indicating the II‑NNI
traversal scenario type. The advantage with this approach is that the exit
IBCF can use the indication inserted by P-CSCF instead of a default value when
the home network operator does not support indicating II-NNI traversal
scenario type.
3-5. The INVITE request is sent in the registration path and finally received
by the S-CSCF. Anyone in the registration path can use the II-NNI traversal
scenario type to determine which local policy to apply.
NOTE 5: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes the Feature-Caps header field, if present.
6\. Since the home network supports indicating the II-NNI traversal scenario,
the S-CSCF replaces the g.3gpp.ii‑nni feature-capability indicator value in
the Feature-Caps header field before forwarding the INVITE request over the
next II-NNI traversal scenario.
NOTE 6: A removal of the feature-capability indicator breaks the principle of
the IETF RFC 6809 [12] while keeping the feature-capability indicator with a
new value is well in-line with the RFC.
Figure 7.3.2.4.2.2 below illustrates how the g.3gpp.ii-nni feature capability
indicator with the value \"home‑visited‑loopback\" is added by the S-CSCF and
removed by the TRF.
Figure 7.3.2.4.2.2: Usage of \"g.3gpp.ii‑nni=home‑visited‑loopback\" as II‑NNI
traversal scenario type
1\. The S-CSCF receives an initial INVITE request from a served user.
2\. The S-CSCF checks the operator agreements and detects that the visited
network supports indicating the II‑NNI traversal scenario type. The S-CSCF
adds the g.3gpp.ii-nni feature-capability indicator with the value
\"home‑visited-loopback\" in a Feature-Caps header field.
NOTE 7: S-CSCF need to check a local policy based on bilateral operator
agreements before including the II‑NNI traversal type in a SIP request to
avoid that a TRF with a legacy implementation forwards the II-NNI traversal
scenario type indication. Intermediate nodes with legacy implementations are
not impacted.
NOTE 8: As an alternative the IBCF acting as an exit point can do the check
and change the g.3gpp.ii‑nni feature‑capability indicator value to \"not-
indicated\" if the visited network does not support indicating the II‑NNI
traversal scenario type. The advantage with this approach is that the exit
IBCF can use the indication inserted by S-CSCF instead of a default value when
the visited network operator does not support indicating II-NNI traversal
scenario type.
3-5. The INVITE request is sent in the registration path and finally received
by TRF. Anyone in the registration path can use the II-NNI traversal scenario
type to determine which local policy to apply.
NOTE 9: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes the Feature-Caps header field, if present.
6\. Since the visited network supports indicating II-NNI traversal scenario,
the TRF removes the feature‑capability indicator from the INVITE request
before forwarding the INVITE request.
NOTE 10: A removal of the feature-capability indicator breaks the principle of
the IETF RFC 6809 [12] while keeping the feature-capability indicator with a
new value is well in-line with the RFC.
Figure 7.3.2.4.2.3 below illustrates how the g.3gpp.ii‑nnni feature capability
with the value \"home‑as‑to‑visited‑mrb\" is added by an AS.
Figure 7.3.2.4.2.3: Usage of \"g.3gpp.ii‑nni=home‑as‑to‑visited‑mrb\" as
II‑NNI traversal scenario type
1\. The AS receives an initial INVITE request from the visited network. The
INVITE request can contain a Feature-Capability header field with the
g.3gpp.mrb feature-capability indicator containing a MRF/MRB address or the AS
may have a configured MRF/MRB address available.
2\. The AS decides to use media resources in the visited network and sends the
INVITE request towards the visited network. The AS checks if the visited
network supports indicating II-NNI traversal scenario. Since that is the case,
the AS includes the g.3gpp.ii-nni feature-capability indicator with the value
\"home‑as‑to‑visited‑mrb\" in a Feature-Caps header field.
3-5. The INVITE request is sent in the registration path and finally received
by the MRB/MRF. Anyone in the path between the AS and the MRB/MRF can use the
II-NNI traversal scenario type to determine which local policy to apply.
NOTE 11: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes the Feature-Caps header field, if present.
6\. Since the final destination is the MRB/MRF for the INVITE request, it is
not necessary to remove the g.3gpp.ii‑nni feature-capability indicator.
Figure 7.3.2.4.2.4 below illustrates how the g.3gpp.ii-nni feature-capability
indicator with the value \"home‑visited‑roaming\" is added by the S-CSCF and
removed by P-CSCF.
Figure 7.3.2.4.2.4: Usage of \"g.3gpp.ii‑nni=home‑visited‑roaming\" as II‑NNI
traversal scenario type
1\. The S-CSCF receives an initial INVITE request from the originating side.
2\. The S-CSCF checks the roaming agreements and detects that the visited
network supports indicating the II‑NNI traversal scenario type. The P-CSCF
adds the g.3gpp.ii-nni feature-capability indicator with the value
\"home‑visited-roaming\" in a Feature-Caps header field.
NOTE 12: S-CSCF need to check a local policy based on bilateral operator
agreements before including the II‑NNI traversal type in a SIP request to
avoid that P-CSCF with a legacy implementation forwards the II-NNI traversal
scenario type indication. Intermediate nodes with legacy implementations are
not impacted.
NOTE 13: As an alternative the IBCF acting as an exit point can do the check
and change the g.3gpp.ii-nni feature‑capability indicator value to \"not-
indicated\" if the visited network does not support indicating the II‑NNI
traversal scenario type. The advantage with this approach is that the exit
IBCF can use the indication inserted by S-CSCF instead of a default value when
the visited network operator does not support indicating II-NNI traversal
scenario type.
3-5. The INVITE request is sent in the registration path and finally received
by the P-CSCF. Anyone in the registration path can use the II-NNI traversal
scenario type to determine which local policy to apply.
NOTE 14: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes the Feature-Caps header field, if present.
6\. Since the visited network supports indicating II-NNI traversal scenario,
the P-CSCF removes the feature‑capability indicator from the INVITE request
before forwarding the INVITE request outside the trust domain.
NOTE 15: A removal of the feature-capability indicator breaks the principle of
the IETF RFC 6809 [12] while keeping the feature-capability indicator with a
new value is well in-line with the RFC.
#### 7.3.2.5 URI parameters
##### 7.3.2.5.1 General
A SIP URI parameter \"ii-nni\" is introduced. The \"ii-nni\" URI parameter is
included in the Route header field or in the Request-URI:
Table 7.3.2.5.1.1: Syntax of ii-nni URI parameter
uri-parameter = transport-param / user-param / method-param / ttl-param /
maddr-param / lr-param / ii-nni / other-param
ii-nni = ii-nni-tag \"=\" ii-nni-value
ii-nni-tag = \"ii-nni\"
ii-nni-value = \"visited-home-roaming\" / \"home-visited-roaming\" / \"home-
visited-loopback\" / \"home‑as‑to‑visited‑mrb\" / genvalue
NOTE 1: The values of the \"ii-nni\" URI parameter above are just example
values. If the URI parameters solution is selected, the final set of values
will be decided during the development of the 3GPP stage 3 technical
specifications in cooperation with IETF.
The \"ii-nni\" URI parameter with an appropriate II-NNI traversal scenario
type value is included by the node in the beginning of an II-NNI traversal
scenario when sending a dialog creating SIP request or a stand-alone SIP
request.
The URI parameter can be included in the Request-URI or the Route header
field.
NOTE 2: The URI parameter is not expected to be needed in an URI between the
originating home network and the terminating network hence there will be no
problem when I-CSCF converts a URI in the Request‑URI to a canonical form
before the user location query procedure to the HSS. If an II-NNI traversal
type is needed and included in a SIP request, the I-CSCF need to save the URI
parameter and then add the saved URI parameter to the Request-URI before
forwarding the SIP request towards the S‑CSCF.
The new URI parameter requires an IETF RFC.
##### 7.3.2.5.2 Example of usage of the \"ii-nni\" URI parameter
This clause illustrates:
\- when the node in the beginning of the II-NNI traversal scenario adds the
\"ii-nni\" URI parameter with the \"visited-home-roaming\", the \"home-
visited-roaming\", the \"home-visited-loopback\" or the
\"home‑visited‑as‑to‑mrb\" II-NNI traversal scenario types in the INVITE
request; and
\- when the \"ii-nni\" URI parameter with the \"visited-home-roaming\", the
\"home-visited-roaming\", the \"home‑visited‑loopback\" or the \"home-visited-
as-to-mrb\" value is removed by the node in the end of the II‑NNI traversal
scenario.
NOTE 1: The same principles can be applied for other II-NNI traversal scenario
types.
NOTE 2: The illustrated examples are under the assumption that all involved
functional entities are within the same trust domain for the \"ii-nni\" URI
parameter.
Figure 7.3.2.5.2.1 below illustrates how the \"ii-nni\" URI parameter with the
value \"visited-home-roaming\" is added by the P-CSCF and removed by the
S-CSCF.
Figure 7.3.2.5.2.1: Usage of \"ii‑nni=visited‑home‑roaming\" as II‑NNI
traversal scenario type
1\. The UE sends an initial INVITE request to the P-CSCF. The INVITE request
includes the Route header field with the S-CSCF URI received during
registration in the Service-Route header field.
2\. The P-CSCF appends the \"ii-nni\" URI parameter with the value \"visited-
home-roaming\".
NOTE 3: If the home network is using topology hiding, the IBCF acting as an
entry point in the home network can, if required by the home network, move the
URI parameter from the topmost URI identifying the IBCF to the URI identifying
the S-CSCF when the IBCF forwards the INVITE request to the S-CSCF.
3-5. The INVITE request is sent in the registration path and finally received
by the S-CSCF. Anyone in the registration path can use the II-NNI traversal
scenario type to determine which local policy to apply.
NOTE 4: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes any \"ii-nni\" URI parameter of Route header field, if present.
6\. The S-CSCF removes the Route header field in accordance with basic SIP
procedures.
NOTE 5: Since the Route header field that identifies the S-CSCF contains the
URI parameter with the II-NNI traversal scenario indicator is removed in
accordance with basic SIP procedure an S-CSCF with a legacy implementation
will also remove the II-NNI traversal scenario type.
Figure 7.3.2.5.2.2 below illustrates how the \"ii-nni\" URI parameter with the
value \"home-visited-loopback\" is added by S-CSCF and removed by TRF.
Figure 7.3.2.5.2.2: Usage of \"ii‑nni=home‑visited‑loopback\" as II‑NNI
traversal scenario type
1\. The S-CSCF receives an initial INVITE request from the visited network.
The INVITE request contains the Feature-Capability header field with the
g.3gpp.trf feature-capability indicator containing a TRF URI to the P‑CSCF.
2\. The S-CSCF decides to perform a loopback to the visited network and sends
the INVITE request towards the visited network populated with a Route header
field with the TRF URI and with the \"ii-nni\" URI parameter with the value
\"home-visited-loopback\".
3-5. The INVITE request is sent in the registration path and finally received
by TRF. Anyone in the loopback path can use the II-NNI traversal scenario type
to determine which local policy to apply.
NOTE 6: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes any \"ii-nni\" URI parameter of Route header field, if present.
6\. The TRF removes the Route header field in accordance with basic SIP
procedures.
NOTE 7: Since the Route header field that identifies the TRF containing the
URI parameter with the II-NNI traversal scenario indicator is removed in
accordance with basic SIP procedure a TRF with a legacy implementation will
also remove the II-NNI traversal scenario type.
Figure 7.3.2.5.2.3 below illustrates how the \"ii-nni\" URI parameter with the
value \"home-as-to-visited-mrb\" is added by an AS.
Figure 7.3.2.5.2.3: Usage of \"ii‑nni=home‑as‑to‑visited‑mrb\" as II‑NNI
traversal scenario type
1\. The AS receives an initial INVITE request from the visited network. The
INVITE request may contain a Feature-Capability header field with the
g.3gpp.mrb feature-capability indicator containing a MRF/MRB address or the AS
may have a configured MRF/MRB address available.
2\. The AS decides to use media resources in the visited network and sends the
INVITE request towards the visited network where the Request-URI contains the
MRB URI and the \"ii-nni\" URI parameter with the value
\"home‑as‑to‑visited‑mrb\".
3-5. The INVITE request is sent in the registration path and finally received
by the MRB/MRF. Anyone in the path between the AS and the MRB/MRF can use the
II-NNI traversal scenario type to determine which local policy to apply.
NOTE 8: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes any \"ii-nni\" URI parameter of Route header field, if present.
6\. Since the final destination is the MRB/MRF for the INVITE request, it is
not necessary to remove the \"ii‑nni\" URI parameter.
Figure 7.3.2.5.2.4 below illustrates how the \"ii-nni\" URI parameter with the
value \"home-visited-roaming\" is added by the S-CSCF and removed by P-CSCF.
Figure 7.3.2.5.2.4: Usage of \"ii‑nni=home‑visited‑roaming\" as II‑NNI
traversal scenario type
1\. The S-CSCF receives an initial INVITE request from the originating side.
2\. The S-CSCF sends the INVITE request towards the visited network populated
with a Route header field with the P-CSCF URI received from the P-CSCF in the
Path header field during registration and adds the \"ii‑nni\" URI parameter
with the value \"home-visited-roaming\".
NOTE 9: If the visited network is using topology hiding, the IBCF acting as an
entry point in the visited network can, if required by the visited network,
move the URI parameter from the topmost URI identifying the IBCF to the URI
identifying the P-CSCF when the IBCF forwards the INVITE request to the
P-CSCF.
3-5. The INVITE request is sent in the registration path and finally received
by the P-CSCF. Anyone in the signalling path can use the II-NNI traversal
scenario type to determine which local policy to apply.
NOTE 10: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes any \"ii-nni\" URI parameter of Route header field, if present.
6\. The P-CSCF removes the Route header field in accordance with basic SIP
procedures.
NOTE 11: Since the Route header field that identifies the P-CSCF containing
the URI parameter with the II‑NNI traversal scenario indicator is removed in
accordance with basic SIP procedure a TRF with a legacy implementation will
also remove the II-NNI traversal scenario type.
\------
#### 7.3.2.6 Route header field parameter
##### 7.3.2.6.1 General
A Route header field parameter \"ii-nni\" is introduced.
The table 7.3.2.6.1.1 shows the coding of the Route header field parameter.
Table 7.3.2.6.1.1: Syntax of the \"ii-nni\" Route header field parameter
rr-param = \"ii-nni\" / generic-param
ii-nni = ii-nni-tag \"=\" ii-nni-value
ii-nni-tag = \"ii-nni\"
ii-nni-value = \"visited-home-roaming\" / \"home-visited-roaming\" / \"home-
visited-loopback\" / \"home‑as‑to‑visited‑mrb\" / \"homeA--homeB\" / genvalue
NOTE: The values of the \"ii-nni\" header field parameter above are just
example values. If the Route header parameter solution is selected, the final
set of values will be decided during the development of the 3GPP stage 3
technical specifications in cooperation with IETF.
The \"ii-nni\" URI parameter with an appropriate II-NNI traversal scenario
type value is included by the node in the beginning of an II-NNI traversal
scenario when sending a dialog creating SIP request or a stand-alone SIP
request.
The II-NNI traversal scenario is included in the Route header field with the
URI representing the end of the II-NNI traversal scenario. If the end of the
II-NNI traversal scenario is represented by the URI in the Request-URI then
the URI in the Request-URI is copied to a Route header and added to the SIP
request.
The new URI parameter requires an IETF RFC.
##### 7.3.2.6.2 Example of usage of the \"ii-nni\" Route header field
parameter
This clause illustrates:
\- when the node in the beginning of the II-NNI traversal scenario adds the
\"ii-nni\" Route header field parameter with the \"visited-home-roaming\", the
\"home-visited-roaming\", the \"home-visited-loopback\" or the
\"home‑visited‑as‑to‑mrb\" II-NNI traversal scenario types in the INVITE
request; and
\- when the \"ii-nni\" Route header field parameter with the \"visited-home-
roaming\", the \"home-visited-roaming\", the \"home‑visited‑loopback\" or the
\"home-visited-as-to-mrb\" value is removed by the node in the end of the
II‑NNI traversal scenario.
NOTE 1: The same principles can be applied for other II-NNI traversal scenario
types.
NOTE 2: The illustrated examples are under the assumption that all involved
functional entities are within the same trust domain for the \"ii-nni\" Route
header field parameter.
Figure 7.3.2.6.2.1 below illustrates how the \"ii-nni\" Route header field
parameter with the value \"visited-home-roaming\" is added by the P-CSCF and
removed by the S-CSCF.
Figure 7.3.2.6.2.1: Usage of \"ii‑nni=visited‑home‑roaming\" as II‑NNI
traversal scenario type
1\. The UE sends an initial INVITE request to the P-CSCF. The INVITE request
includes the Route header field with the S-CSCF URI received during
registration in the Service-Route header field.
2\. The P-CSCF appends the \"ii-nni\" Route header field parameter with the
value \"visited-home-roaming\".
NOTE 3: If the home network is using topology hiding, the IBCF acting as an
entry point in the home network can, if required by the home network, move the
Route header field parameter from the topmost URI identifying the IBCF to the
URI identifying the S-CSCF when the IBCF forwards the INVITE request to the
S-CSCF.
3-5. The INVITE request is sent in the registration path and finally received
by the S-CSCF. Anyone in the registration path can use the II-NNI traversal
scenario type to determine which local policy to apply.
NOTE 4: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes any \"ii-nni\" Route header field parameter of Route header
field, if present.
6\. The S-CSCF removes the Route header field in accordance with basic SIP
procedures.
NOTE 5: Since the Route header field that identifies the S-CSCF contains the
Route header field parameter with the II-NNI traversal scenario indicator is
removed in accordance with basic SIP procedure, the S-CSCF with a legacy
implementation will also remove the II-NNI traversal scenario type.
Figure 7.3.2.6.2.2 below illustrates how the \"ii-nni\" Route header field
parameter with the value \"home-visited-loopback\" is added by S-CSCF and
removed by TRF.
Figure 7.3.2.6.2.2: Usage of \"ii‑nni=home‑visited‑loopback\" as II‑NNI
traversal scenario type
1\. The S-CSCF receives an initial INVITE request from the visited network.
The INVITE request contains the Feature-Capability header field with the
g.3gpp.trf feature-capability indicator containing a TRF URI to the P‑CSCF.
2\. The S-CSCF decides to perform a loopback to the visited network and sends
the INVITE request towards the visited network populated with a Route header
field with the TRF URI and with the \"ii-nni\" Route header field parameter
with the value \"home-visited-loopback\".
3-5. The INVITE request is sent in the registration path and finally received
by TRF. Anyone in the loopback path can use the II-NNI traversal scenario type
to determine which local policy to apply.
NOTE 6: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes any \"ii-nni\" Route header field parameter from the Route
header field, if present.
6\. The TRF removes the Route header field in accordance with basic SIP
procedures.
NOTE 7: Since the Route header field that identifies the TRF containing the
Route header field parameter with the II-NNI traversal scenario indicator is
removed in accordance with basic SIP procedure, the TRF with a legacy
implementation will also remove the II-NNI traversal scenario type.
Figure 7.3.2.6.2.3 below illustrates how the \"ii-nni\" Route header field
parameter with the value \"home-as-to-visited-mrb\" is added by an AS.
Figure 7.3.2.6.2.3: Usage of \"ii‑nni=home‑as‑to‑visited‑mrb\" as II‑NNI
traversal scenario type
1\. The AS receives an initial INVITE request from the visited network. The
INVITE request may contain a Feature-Capability header field with the
g.3gpp.mrb feature-capability indicator containing a MRF/MRB address or the AS
may have a configured MRF/MRB address available.
2\. The AS decides to use media resources in the visited network and sends the
INVITE request towards the visited network where the Request-URI contains the
MRB URI. In addition the AS adds Route header field with a copy of the URI in
the R-U and appends the \"ii-nni\" Route header field parameter with the value
\"home‑as‑to‑visited‑mrb\".
3-5. The INVITE request is sent in the registration path and finally received
by the MRB/MRF. Anyone in the path between the AS and the MRB/MRF can use the
II-NNI traversal scenario type to determine which local policy to apply.
NOTE 8: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes any \"ii-nni\" Route header field parameter in the Route header
field, if present.
6\. Since the final destination is the MRB/MRF for the INVITE request, it is
not necessary to remove the \"ii‑nni\" Route header field parameter.
Figure 7.3.2.6.2.4 below illustrates how the \"ii-nni\" Route header field
parameter with the value \"homeA-homeB\" is added by the S-CSCF in the home
network A and removed by S-CSCF in home network B.
Figure 7.3.2.6.2.4: Usage of \"ii‑nni=homeA-homeB\" as II‑NNI traversal
scenario type
1\. The S-CSCF receives an initial INVITE request from P-CSCF. The P-CSCF can
be located in the home network of the calling user or in a visited network
when the calling user is roaming.
2\. The S-CSCF sends the INVITE request towards the home network of the called
user. Since the called user is in another operator network, the S-CSCF selects
an IBCF acting as an exit point. The S-CSCF copies the URI in the Request-URI
and adds the copy in a Route header field with the \"ii-nni\" Route header
field parameter with the value \"homeA-homeB\". A Route header with the
selected IBCF URI (i.e. IBCF-1) is added on the top.
NOTE 9: Since the Route header field with the copy of the URI in the Request-
URI needs to be removed by the S-CSCF in home network B to avoid a loop (if
P-CSCF receives an INVITE request with a Route header field the P-CSCF will
send the INVITE request to I-CSCF again), the S-CSCF checks a local policy
based on bilateral agreement whether the homeB supports indicating the II-NNI
traversal scenario or not).
3-5. The INVITE request is routed hop-by-hop, i.e. each nodes tries to find
the most optimal route to the home network B in regards to charging, QoS,
least congested, etc. Anyone in the signalling path can use the II-NNI
traversal scenario type in the bottommost Route header field to determine
which local policy to apply. The node that receives the INVITE request removes
the topmost Route header field with URI identifying itself, according to basic
SIP procedures, and adds a new Route header field on the top with the URI
identifying the next hop.
NOTE 10: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes any \"ii-nni\" Route header field parameter of Route header
field, if present.
6\. The I-CSCF queries the location of the S-CSCF and sends the INVITE request
to the S-CSCF where the called user is registered. The S-CSCF URI is included
in a Route header field and added as a topmost Route header field.
7\. The S-CSCF removes the Route header fields identifying itself and the
bottommost Route header field, i.e. the copy of the URI in the Request-URI
included by the S-CSCF in the home network A.
NOTE 11: Since the Route header field containing the Route header field
parameter with the II‑NNI traversal scenario indicator identifies the called
user basic SIP procedures will not remove this Route header field. That means
that the S-CSCF home network has to support the indication of the II-NNI
traversal type otherwise an endless loop will occur when P-CSCF receives the
INVITE with a Route header field identifying the called user.
Figure 7.3.2.6.2.5 below illustrates how the \"ii-nni\" Route header field
parameter with the value \"home-visited-roaming\" is added by the S-CSCF and
removed by P-CSCF.
Figure 7.3.2.6.2.5: Usage of \"ii‑nni=home‑visited‑roaming\" as II‑NNI
traversal scenario type
1\. The S-CSCF receives an initial INVITE request from the originating side.
2\. The S-CSCF sends the INVITE request towards the visited network populated
with a Route header field with the P-CSCF URI received from the P-CSCF in the
Path header field during registration and adds the \"ii‑nni\" Route header
field parameter with the value \"home-visited-roaming\".
NOTE 12: If the visited network is using topology hiding, the IBCF acting as
an entry point in the visited network can, if required by the visited network,
moves the Route header field parameter from the topmost URI identifying the
IBCF to the URI identifying the P-CSCF when the IBCF forwards the INVITE
request to the P-CSCF.
3-5. The INVITE request is sent in the registration path and finally received
by the P-CSCF. Anyone in the signalling path can use the II-NNI traversal
scenario type to determine which local policy to apply.
NOTE 13: The functional entity which receives the INVITE request needs to
verify whether the request is received from a trust domain or not. If the
request is received from outside of the trust domain, then the functional
entity removes any \"ii-nni\" Route header field parameter of Route header
field, if present.
6\. The P-CSCF removes the Route header field in accordance with basic SIP
procedures.
NOTE 14: Since the Route header field that identifies the P-CSCF containing
the Route header field parameter with the II‑NNI traversal scenario indicator
is removed in accordance with basic SIP procedure, the P-CSCF with a legacy
implementation will also remove the II-NNI traversal scenario type.
### 7.3.3 Evaluation of compliance with the requirements in annex B
The table 7.3.3.1 below shows how well each solution proposed in clause 7.3.2
is compliant with the requirements in clause B.2.3. The requirements from
clause B.2.3 are translated to the corresponding questions. \"Yes\" indicates
that the proposed solution fulfils the requirement. \"No\" indicates that the
requirement is not fulfilled without additional work.
Table 7.3.3.1: Evaluation of compliance with the requirements in annex B
+---------+---------+---------+---------+---------+---------+---------+ | Req no. | The | New SIP | En | New | SIP URI | Route | | i | requ | header | hancing | v | pa | header | | n B.2.3 | irement | in | P-C | alue(s) | rameter | field | | | in | clause | harging | for the | in | pa | | | claus | 7.3.2.2 | -Vector | SIP | clause | rameter | | | e B.2.3 | | SIP | Feature | 7.3.2.5 | | | | tra | | header | cap | | | | | nslated | | field | ability | | | | | to a | | in | in | | | | | q | | clause | dicator | | | | | uestion | | 7.3.2.3 | in | | | | | | | | clause | | | | | | | | | | | | | | | | 7.3.2.4 | | | +---------+---------+---------+---------+---------+---------+---------+ | REQ-1 | Can the | No | Yes | Yes | Yes | No | | | ind | | | | | | | | ication | | | | | | | | be | | | | | | | | tran | | | | | | | | sported | | | | | | | | by the | | | | | | | | RE | | | | | | | | GISTER? | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | REQ-2 | Can the | No | Yes | Yes | Yes | Yes | | | ind | | | | | | | | ication | | | | | | | | be | | | | | | | | tran | | | | | | | | sported | | | | | | | | by a | | | | | | | | dialog- | | | | | | | | forming | | | | | | | | request | | | | | | | | (e.g. | | | | | | | | INVITE | | | | | | | | r | | | | | | | | equest, | | | | | | | | etc.)? | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | REQ-3 | Can the | No | Yes | Yes | Yes | Yes | | | ind | | | | | | | | ication | | | | | | | | be | | | | | | | | tran | | | | | | | | sported | | | | | | | | by a | | | | | | | | stan | | | | | | | | d-alone | | | | | | | | request | | | | | | | | (e.g. | | | | | | | | ME | | | | | | | | SSAGE)? | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | REQ-4 | Can the | No | No | No | Yes | No | | | start | | | | | | | | of the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | include | | | | | | | | an | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | type | | | | | | | | ind | | | | | | | | ication | | | | | | | | without | | | | | | | | making | | | | | | | | any | | | | | | | | assu | | | | | | | | mptions | | | | | | | | that | | | | | | | | end of | | | | | | | | the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | will | | | | | | | | s | | | | | | | | upport, | | | | | | | | or | | | | | | | | und | | | | | | | | erstand | | | | | | | | the | | | | | | | | meaning | | | | | | | | of, the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | type | | | | | | | | indi | | | | | | | | cation, | | | | | | | | or even | | | | | | | | support | | | | | | | | the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | type | | | | | | | | ind | | | | | | | | ication | | | | | | | | me | | | | | | | | chanism | | | | | | | | as a | | | | | | | | whole? | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | REQ-5 | Will | No | No | No | Yes | No | | | the | | | | | | | | entity | | | | | | | | at the | | | | | | | | end of | | | | | | | | the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | remove/ | | | | | | | | replace | | | | | | | | the | | | | | | | | ind | | | | | | | | ication | | | | | | | | without | | | | | | | | the SIP | | | | | | | | entity | | | | | | | | at the | | | | | | | | end of | | | | | | | | the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | s | | | | | | | | upports | | | | | | | | the | | | | | | | | identif | | | | | | | | ication | | | | | | | | of the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | type | | | | | | | | me | | | | | | | | chanism | | | | | | | | as a | | | | | | | | whole? | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | REQ-6 | Can the | Yes | Yes | Yes | Yes | Yes | | | ind | | | | | | | | ication | | | | | | | | be sent | | | | | | | | in the | | | | | | | | sig | | | | | | | | nalling | | | | | | | | path | | | | | | | | even if | | | | | | | | not all | | | | | | | | SIP | | | | | | | | e | | | | | | | | ntities | | | | | | | | do not | | | | | | | | s | | | | | | | | upport, | | | | | | | | or | | | | | | | | und | | | | | | | | erstand | | | | | | | | the | | | | | | | | meaning | | | | | | | | of, the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | type | | | | | | | | indi | | | | | | | | cation, | | | | | | | | or even | | | | | | | | support | | | | | | | | the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | type | | | | | | | | ind | | | | | | | | ication | | | | | | | | me | | | | | | | | chanism | | | | | | | | as a | | | | | | | | whole? | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | REQ-7 | Can a | Yes | Yes | Yes | Yes | Yes | | | SIP | | | | | | | | entity | | | | | | | | that | | | | | | | | does | | | | | | | | not | | | | | | | | support | | | | | | | | an | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | type | | | | | | | | indi | | | | | | | | cation, | | | | | | | | ignore | | | | | | | | the | | | | | | | | indi | | | | | | | | cation? | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | REQ-8 | Can all | Yes | Yes | Yes | Yes | Yes | | | SIP | | | | | | | | e | | | | | | | | ntities | | | | | | | | on the | | | | | | | | sig | | | | | | | | nalling | | | | | | | | path | | | | | | | | inspect | | | | | | | | the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | type | | | | | | | | ind | | | | | | | | ication | | | | | | | | int | | | | | | | | roduced | | | | | | | | by | | | | | | | | other | | | | | | | | en | | | | | | | | tities? | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | REQ-9 | Is the | Yes | Yes | Yes | Yes | Yes | | | ind | | | | | | | | ication | | | | | | | | only | | | | | | | | info | | | | | | | | rmation | | | | | | | | and not | | | | | | | | an | | | | | | | | ind | | | | | | | | ication | | | | | | | | whether | | | | | | | | pro | | | | | | | | cedures | | | | | | | | ass | | | | | | | | ociated | | | | | | | | with | | | | | | | | the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | type | | | | | | | | ind | | | | | | | | ication | | | | | | | | have | | | | | | | | been | | | | | | | | applied | | | | | | | | or not? | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | REQ-10 | Does | No | Yes | Yes | Yes | No | | | the | | | | | | | | s | | | | | | | | olution | | | | | | | | fulfil | | | | | | | | s | | | | | | | | ecurity | | | | | | | | aspects | | | | | | | | and its | | | | | | | | dep | | | | | | | | endency | | | | | | | | of | | | | | | | | trust | | | | | | | | domain | | | | | | | | and/or | | | | | | | | poss | | | | | | | | ibility | | | | | | | | of | | | | | | | | fraud | | | | | | | | min | | | | | | | | imized? | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | REQ-11 | Is a | No | No | Yes | No | No | | | pr | | | | | | | | ocedure | | | | | | | | which | | | | | | | | p | | | | | | | | revents | | | | | | | | name | | | | | | | | col | | | | | | | | lisions | | | | | | | | of | | | | | | | | indi | | | | | | | | cators, | | | | | | | | with | | | | | | | | IANA | | | | | | | | already | | | | | | | | d | | | | | | | | efined? | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | REQ-12 | Can the | No | No | No | Yes | No | | | s | | | | | | | | olution | | | | | | | | be used | | | | | | | | even if | | | | | | | | the end | | | | | | | | point | | | | | | | | ( | | | | | | | | S-CSCF, | | | | | | | | TRF, | | | | | | | | M | | | | | | | | RB/MRF, | | | | | | | | etc.) | | | | | | | | of the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | type | | | | | | | | does | | | | | | | | not | | | | | | | | support | | | | | | | | iden | | | | | | | | tifying | | | | | | | | the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | by | | | | | | | | means | | | | | | | | of an | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | type? | | | | | | +---------+---------+---------+---------+---------+---------+---------+
### 7.3.4 Security aspects of the explicit indication of the II‑NNI traversal
scenario solutions
In any of the explicit indication of the II‑NNI traversal scenario solutions
in clause 7.3.2 the following security aspect needs to be considered:
\- the IBCF acting as an entry point shall never trust an explicit indication
received from an untrusted domain; and
\- the IBCF acting as an exit point may remove the explicit indication from
the SIP request before forwarding the request to an untrusted domain.
When receiving a dialog creating SIP request or a stand‑alone SIP request from
outside the trust domain the IBCF acting as an entry point shall assume
default behaviour or use trusted elements of the SIP request to determine the
II‑NNI traversal scenario type.
NOTE: Examples of trusted elements are protocol elements within the trust
domain and protocol elements manipulated, checked or added by a previous hop
secured by network domain security.
# 8 Other interfaces that requires identification
No other interface has been identified.
# 9 Conclusion
## 9.1 General
This clause provides the choice of solutions based on the study in this
document, which will be followed by the normative / TS work.
Clause 9.2 compares the implicit detection of II-NNI traversal scenario and
explicit indication of II-NNI traversal scenario solutions.
Clause 9.3 compare each solution proposed in clause 7.3 for the explicit
indication of II-NNI traversal scenario.
Clause 9.4 contains the choice of solutions.
## 9.2 Implicit detection of II-NNI traversal scenario -- explicit indication
of II-NNI traversal scenario
**[Implicit detection of II-NNI traversal scenario:]{.underline}**
Pros:
\+ Does not require any IETF work;
\+ Partly already in legacy IMS.
Cons:
\- Not possible to specify (see clause 7.2);
\- Hard to implement in intermediate non-IMS transit networks since the
implicit detection algorithm may be based on who sent the SIP request (e.g. if
P-CSCF sends the SIP request it may be a different II-NNI traversal scenarios
than if S-CSCF sends the SIP request);
\- Hard to extend in a backward compatible way (e.g. if one header field in
one release uniquely identifies an II‑NNI traversal scenario and then the same
header field is used in a later release in another II-NNI traversal scenario
it will not be possible any longer to determine the II-NNI traversal
scenario).
**[Explicit indication of II-NNI traversal scenario:]{.underline}**
Pros:
\+ Simple to specify and can easily be used by intermediate non-IMS transit
networks;
\+ Relative easy to achieve a future proof solution.
Cons:
\- May require an IETF work and the issue is very related to 3GPP
architecture;
\- May require a local policy based on interoperability agreements and use of
trust domain.
## 9.3 Explicit indication of II-NNI traversal scenario solutions
This clause compares the proposed solutions for explicit indication of II-NNI
traversal scenario.
**[New SIP header field:]{.underline}**
Pros:
\+ A dedicated header field makes it simpler to find the II-NNI traversal type
in a SIP request.
Cons:
\- Requires IETF work and the issue is much related to 3GPP architecture.
\- Requires interoperator agreement and use of trust domain.
\- Will not be automatically transported by legacy B2BUA implementations.
\- If the II-NNI traversal scenario is included in a new header field to later
be used in a Route header field, legacy implementation will not automatically
use the II-NNI traversal scenario type in the new header field.
NOTE 1: A mechanism to include the II-NNI traversal scenario in the REGISTER
request or the 200 (OK) response to the REGISTER request could be useful when
later using the URI from the Path header field or the URI from the Service-
Route header field in the Route header field of a dialog creating request or a
stand-alone request.
\- If the URI is configured or included in a XML document (for later use in
specific II-NNI traversal scenarios) a new configuration parameter or XML
parameter is required. This means that legacy implementations will not use the
new configurable parameter or the new XML parameter when later used in the
Route header field of a dialog creating request or a stand-alone request.
**[Enhancing P-Charging-Vector SIP header field:]{.underline}**
Pros:
\+ Copy of an already existing mechanism (the II-NNI traversal scenario type
follows the same rule as \"orig‑ioi\" in regards to when to add and when to
remove).
\+ Trust domain already implemented.
Cons:
\- Requires IETF work and the issue is much related to 3GPP architecture.
\- Breaks the principle of P-Charging-Vector header field. The information in
the P-Charging-Vector is in principle only available for charging purposes.
\- If the II-NNI traversal scenario is included in the P-Charging-Vector SIP
header field to later be used in a Route header field, legacy implementation
will not automatically use the II-NNI traversal scenario type in the
P-Charging-Vector SIP header field.
NOTE 2: A mechanism to include the II-NNI traversal scenario in the REGISTER
request or the 200 (OK) response to the REGISTER request could be useful when
later using the URI from the Path header field or the URI from the Service-
Route header field in the Route header field of a dialog creating request or a
stand-alone request.
\- If the URI is configured or included in a XML document (for later use in
specific II-NNI traversal scenarios) a new configuration parameter or a new
XML parameter is required. This means that legacy implementations will not use
the new configurable parameter or the new XML parameter when later used in the
Route header field of a dialog creating request or a stand-alone request.
**[New value(s) for the SIP Feature-Caps header field:]{.underline}**
Pros:
\+ Using an already existing mechanism.
\+ Trust domain already implemented.
Cons:
\- Requires interoperator agreement.
\- Can be very hard (read: impossible) to convince intermediate non-IMS
transit networks to look for the II-NNI traversal scenario type in a P-header
field of no interest for them.
\- Will not be automatically transported by legacy B2BUA implementations.
If the II-NNI traversal scenario is included as a new value in a Feature-Caps
header field to later be used in a Route header field, legacy implementation
will not automatically use the II-NNI traversal scenario type in the Feature-
Caps header field.
NOTE 3: A mechanism to include the II-NNI traversal scenario in the REGISTER
request or the 200 (OK) response to the REGISTER request could be useful when
later using the URI from the Path header field or the URI from the Service-
Route header field in the Route header field of a dialog creating request or a
stand-alone request.
\- If the URI is configured or included in a XML document (for later use in
specific II-NNI traversal scenarios) a new configuration parameter or a new
XML parameter is required. This means that legacy implementations will not use
the new configurable parameter or the new XML parameter when later used in the
Route header field of a dialog creating request or a stand-alone request.
**[SIP URI parameter:]{.underline}**
Pros:
\+ Backward and forward compatible solution since the II-NNI traversal
scenario type is removed by basic SIP procedures and also by legacy
implementations.
\+ All II-NNI traversal scenarios, except the default scenario (e.g. the home-
home II-NNI traversal scenario) addresses a particular functional entity
identified by a node URI or a PSI/IMRN in the Request line or in one of the
Route header fields. This means that the II-NNI traversal scenario can be seen
as the nature of URI when appending the II-NNI traversal scenario to the URI
identified as the destination.
\+ The \"II-NNI traversal scenario indication\" is naturally consumed when the
addressed functional entity is reached, i.e. no particular action to remove
the \"II-NNI traversal scenario indication\" is needed.
\+ Will be automatically transported by legacy B2BUA implementations.
\+ If the II-NNI traversal scenario is included as a new value in a SIP URI
parameter to later be used in a Route header field, legacy implementation will
automatically use the II-NNI traversal scenario type in the SIP URI parameter.
NOTE 4: A mechanism to include the II-NNI traversal scenario in the REGISTER
request or the 200 (OK) response to the REGISTER request could be useful when
later using the URI from the Path header field or the URI from the Service-
Route header field in the Route header field of a dialog creating request or a
stand-alone request.
\+ If the URI is configured or included in a XML document (for later use in
specific II-NNI traversal scenarios) existing configurable and XML parameters
can be used. This means that legacy implementations will automatically include
the SIP URI parameter in a Route header field when later used in the Route
header field of a dialog creating request or a stand-alone request.
Cons:
\- Requires IETF work and the issue is much related to 3GPP architecture.
**[Route header field parameter:]{.underline}**
Pros:
\+ Will be automatically transported by legacy B2BUA implementations.
Cons:
\- Requires IETF work and the issue is much related to 3GPP architecture.
\- Requires interoperability agreements between operators to avoid loops in
the home -- home II-NNI traversal scenario.
\- If the II-NNI traversal scenario is included in the Path header field or
the Service-Route header field as a header field parameter to later be used in
a Route header field, legacy implementation will not automatically use the II-
NNI traversal scenario type in the header field parameter when using the URI
from the Path header field or Service-Route header field in the Route header
field of a dialog creating request or a stand-alone request.
\- If the URI is configured or included in a XML document (for later use in
specific II-NNI traversal scenarios) a new configuration parameter or XML
parameter is required. This means that legacy implementations will not use the
new configurable parameter or the new XML parameter when later used in the
Route header field of a dialog creating request or a stand-alone request.
## 9.4 Recommendation
Some networks (e.g. existing networks) can find it possible to run using
existing methods of identifying the II‑NNI traversal scenario and can continue
to do so. However, when a standardized method of identifying the II‑NNI
traversal scenario is needed and since the implicit detection of the II‑NNI
traversal scenario type is more complex to specify and hard to extend, the
explicit indication of the II‑NNI traversal scenario type is selected as the
way forward.
Within the explicit indication of the II‑NNI traversal scenario type several
encoding options are proposed in clause 7.3.2. Advantages and disadvantages
with each encoding option are discussed in clause 9.3.
One disadvantage with introducing an explicit indication of the II‑NNI
traversal scenario type is backward compatibility. The new SIP URI parameter
encoding option is the only encoding option that offers backward compatibility
without requiring operator agreements and extensive configuration in all
networks supporting the explicit indication of the II‑NNI traversal scenario
type.
The introduction of an explicit indication of the II‑NNI traversal scenario
type gives the intermediate network a chance to understand the II‑NNI
traversal scenario e.g. for charging purposes. However, it can be costly for
intermediate networks to start looking into a new header field for this type
of information. The new SIP URI parameter and the enhancing P‑Charging‑Vector
SIP header field encoding options are the only encoding options that include
the explicit indication of the II‑NNI traversal scenario type in a header
field that the intermediate network anyway is using and most likely already
today includes in a CDR.
The disadvantage to select the enhancing P‑Charging‑Vector SIP header field
encoding option is that then the explicit indication of the II‑NNI traversal
scenario type is then in principle only available for charging purposes.
Due to the above the new SIP URI parameter encoding option is selected for
encoding the explicit indication of the II‑NNI traversal scenario type.
**Recommendation:** This means that an IETF RFC needs to be specified to
enable the 3GPP stage 3 work.
###### ### Annex A: Determine II-NNI traversal scenario type
# A.1 Scope
This annex contains some examples on how to determine the II-NNI traversal
scenario type in the IBCF acting as an exit point or in the IBCF acting as an
entry point.
# A.2 Introduction
When receiving a dialog creating SIP request or when receiving a stand-alone
SIP request the IBCF acting as an exit point or the IBCF acting as an entry
point need to determine which local policy to use.
Figure A.2.1 illustrates the II-NNI traversal scenarios model used in this
annex.
Figure A.2.1: II-NNI traversal scenarios model
The line between two blue boxes is an Inter-IMS Network to Network Interface
(II-NNI) that needs to be identified by the IBCF on each side of the line.
The following clauses show examples on the logic to determine the II-NNI
traversal scenario type for some SIP requests using either:
\- implicit detection of the II-NNI traversal scenario type; or
\- explicit indication of the II-NNI traversal scenario type.
# A.3 SUBSCRIBE request example
## A.3.1 Introduction to the example
The SUBSCRIBE request is a SIP request that can appear in several II-NNI
traversal scenario types.
In figure A.3.1 the lines between the green marked IBCF acting as an entry
point boxes and the yellow marked IBCF acting as an exit point boxes
represents II-NNI traversal scenario types where a SUBSCRIBE request can be
sent and received. The lines between blue boxes are II-NNI traversal scenario
types outside the scope of this example.
NOTE: An IMS network acting as a transit network can appear at any II-NNI
traversal scenario. In the figure only an IMS network acting as a transit
network between the home A and the home B is shown.
Figure A.3.1: II-NNI traversal scenario types, SUBSCRIBE example
The IBCF resides in a network that can act as the home A, home B, visited X
and visited Y and the same IBCF can participate in any of the II-NNI traversal
scenario types shown in figure A.3.1.
This means that at any point in time the IBCF can be:
\- the IBCF22 or IBCF23 in the \"Subscribe to reg-event\" II-NNI traversal
scenario type between visited X and home A;
\- the IBCF1 or IBCF2 in the \"Dialog creating SIP request and stand-alone SIP
requests using the registration path\" II-NNI traversal scenario type between
visited X and home A;
\- the IBCF12 or IBCF15 in the \"Dialog creating SIP request and stand-alone
SIP requests between home A and home B\" II-NNI traversal scenario type
between home A and home B;
\- the IBCF12 or IBCF13 in the \"Home A to transit Z\" II-NNI traversal
scenario type;
\- the IBCF14 or IBCF15 in the \"Transit Z to home B\" II-NNI traversal
scenario type; and
\- the IBCF16 or IBCF17 in the \"Dialog creating SIP request and stand-alone
SIP requests using the registration path\" II-NNI traversal scenario type
between home B and visited Y.
When the IBCF receives a SUBSCRIBE request the IBCF can use either:
\- implicit detection of the II-NNI traversal scenario type as described in
clause A.3.2; or
\- explicit indication of the II-NNI traversal scenario type as described in
clause A.3.3;
to determine if the tasks related to IBCF22/IBCF23, IBCF1/IBCF2,
IBCF12/IBCF15, IBCF12/IBCF13, IBCF14/IBCF15 or IBCF16/IBCF17 local policy
shall be performed.
For simplicity reasons the examples in the following clauses assumes that
there are no intermediate networks (e.g. an IPX network) involved.
## A.3.2 Implicit detection of the II-NNI traversal scenario type
### A.3.2.1 SUBSCRIBE request content at different II-NNI traversal scenario
types
Table A.3.2.1.1: SUBSCRIBE request content at different II-NNI traversal
scenario types
+---------+---------+---------+---------+---------+---------+---------+ | Header | II-NNI | | | | | | | field | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | type | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | | Su | Dialog | Dialog | Home A | Transit | Dialog | | | bscribe | c | c | to | Z to | c | | | to | reating | reating | transit | home B | reating | | | | SIP | SIP | Z | | SIP | | | re | request | request | | | request | | | g-event | and | and | | | and | | | | stan | stan | | | stan | | | | d-alone | d-alone | | | d-alone | | | | SIP | SIP | | | SIP | | | | r | r | | | r | | | | equests | equests | | | equests | | | | using | between | | | using | | | | the | home A | | | the | | | | regis | and | | | regis | | | | tration | home B | | | tration | | | | path\ | | | | path | | | | ( | | | | | | | | Visited | | | | (Home B | | | | X to | | | | and | | | | home A) | | | | visited | | | | | | | | Y) | +---------+---------+---------+---------+---------+---------+---------+ | Requ | An user | An user | PSI or | PSI or | PSI or | Contact | | est-URI | i | i | an user | an user | an user | address | | | dentity | dentity | i | i | i | be | | | be | be | dentity | dentity | dentity | longing | | | longing | longing | of the | of the | of the | to the | | | to home | to home | user | user | user | visited | | | A | A | be | be | be | network | | | | | longing | longing | longing | Y (e.g. | | | ( | or | to the | to the | to the | an IP | | | NOTE 1) | | home B | home B | home B | a | | | | as | o | o | o | ddress) | | | | sp | perator | perator | perator | | | | | ecified | | | | or | | | | by a | ( | ( | ( | | | | | service | NOTE 1) | NOTE 1, | NOTE 1) | the | | | | | | NOTE 4) | | user | | | | | | | | i | | | | | | | | dentity | | | | | | | | of the | | | | | | | | user | | | | | | | | be | | | | | | | | longing | | | | | | | | to the | | | | | | | | home B | | | | | | | | o | | | | | | | | perator | +---------+---------+---------+---------+---------+---------+---------+ | Route | - | S-CSCF | - | transit | - | P-CSCF | | | | in home | | f | | URI | | (of any | | A URI | | unction | | | | in | | | | | | ( | | terest) | | ( | | | | NOTE 2) | | | | NOTE 2) | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Via | P-CSCF, | P-C | *, | * | *, | *, | | | (ATCF,) | SCF/MSC | S-CSC | | transit | S-CSCF, | | | exit | server | F/BGCF, | ( | f | * | | | IBCF | URI, * | * | NOTE 3) | unction | | | | | | | | | ( | | | | ( | ( | | ( | NOTE 3) | | | | NOTE 3) | NOTE 3) | | NOTE 3) | | +---------+---------+---------+---------+---------+---------+---------+ | P-Ass | P-CSCF | The | An user | An user | An user | An user | | erted-I | URI | reg | i | i | i | i | | dentity | | istered | dentity | dentity | dentity | dentity | | | | user | of the | of the | of the | that | | ( | | i | user | user | user | belong | | NOTE 5) | | dentity | be | be | be | to the | | | | that | longing | longing | longing | A, B, X | | | | can be | to the | to the | to the | or Y | | | | either | home A | home A | home A | o | | | | a SIP | o | o | o | perator | | | | URI a | perator | perator | perator | that | | | | tel URI | | | | can be | | | | | | | | a SIP | | | | | | | | URI or | | | | | | | | a tel | | | | | | | | URI | +---------+---------+---------+---------+---------+---------+---------+ | Event | \"reg\" | - | - | - | - | - | | (of any | | | | | | | | in | | | | | | | | terest) | | | | | | | | | | | | | | | | ( | | | | | | | | NOTE 6) | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | C | - | - | - | - | - | URI of | | alled-P | | | | | | the | | arty-ID | | | | | | called | | | | | | | | party | | | | | | | | that | | | | | | | | can be | | | | | | | | either | | | | | | | | a SIP | | | | | | | | URI or | | | | | | | | a tel | | | | | | | | URI. | +---------+---------+---------+---------+---------+---------+---------+ | NOTE 1: | | | | | | | | The URI | | | | | | | | in the | | | | | | | | Requ | | | | | | | | est-URI | | | | | | | | is used | | | | | | | | as the | | | | | | | | dest | | | | | | | | ination | | | | | | | | in the | | | | | | | | ACR. | | | | | | | | | | | | | | | | NOTE 2: | | | | | | | | The top | | | | | | | | most | | | | | | | | URI in | | | | | | | | the | | | | | | | | Route | | | | | | | | header | | | | | | | | field | | | | | | | | is used | | | | | | | | as the | | | | | | | | dest | | | | | | | | ination | | | | | | | | in the | | | | | | | | ACR. | | | | | | | | | | | | | | | | NOTE 3: | | | | | | | | The | | | | | | | | \"*\" | | | | | | | | rep | | | | | | | | resents | | | | | | | | a | | | | | | | | number | | | | | | | | of URIs | | | | | | | | of no | | | | | | | | i | | | | | | | | nterest | | | | | | | | for | | | | | | | | this | | | | | | | | e | | | | | | | | xample. | | | | | | | | | | | | | | | | NOTE 4: | | | | | | | | The URI | | | | | | | | in the | | | | | | | | Requ | | | | | | | | est-URI | | | | | | | | may be | | | | | | | | a URI | | | | | | | | without | | | | | | | | geogr | | | | | | | | aphical | | | | | | | | signi | | | | | | | | ficance | | | | | | | | that is | | | | | | | | tra | | | | | | | | nslated | | | | | | | | by | | | | | | | | transit | | | | | | | | to | | | | | | | | another | | | | | | | | URI | | | | | | | | with | | | | | | | | geogr | | | | | | | | aphical | | | | | | | | signi | | | | | | | | ficance | | | | | | | | as part | | | | | | | | of the | | | | | | | | appl | | | | | | | | ication | | | | | | | | s | | | | | | | | ervices | | | | | | | | in an | | | | | | | | IMS | | | | | | | | transit | | | | | | | | network | | | | | | | | pr | | | | | | | | oviding | | | | | | | | appl | | | | | | | | ication | | | | | | | | se | | | | | | | | rvices. | | | | | | | | | | | | | | | | NOTE 5: | | | | | | | | In the | | | | | | | | case | | | | | | | | the | | | | | | | | P-Se | | | | | | | | rved-ID | | | | | | | | header | | | | | | | | field | | | | | | | | is | | | | | | | | i | | | | | | | | ncluded | | | | | | | | in a | | | | | | | | SIP | | | | | | | | request | | | | | | | | the | | | | | | | | P-Se | | | | | | | | rver-ID | | | | | | | | header | | | | | | | | field | | | | | | | | ov | | | | | | | | errides | | | | | | | | the | | | | | | | | P-Ass | | | | | | | | erted-I | | | | | | | | dentity | | | | | | | | header | | | | | | | | field. | | | | | | | | | | | | | | | | NOTE 6: | | | | | | | | The | | | | | | | | event | | | | | | | | \"reg\" | | | | | | | | is only | | | | | | | | sign | | | | | | | | ificant | | | | | | | | for | | | | | | | | iden | | | | | | | | tifying | | | | | | | | the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | s | | | | | | | | cenario | | | | | | | | type in | | | | | | | | the | | | | | | | | \"Su | | | | | | | | bscribe | | | | | | | | to | | | | | | | | reg- | | | | | | | | event\" | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | sc | | | | | | | | enario. | | | | | | | | On all | | | | | | | | other | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | sc | | | | | | | | enarios | | | | | | | | any | | | | | | | | event, | | | | | | | | in | | | | | | | | cluding | | | | | | | | the | | | | | | | | \"reg\" | | | | | | | | event, | | | | | | | | can | | | | | | | | occur | | | | | | | | but is | | | | | | | | of no | | | | | | | | i | | | | | | | | nterest | | | | | | | | for | | | | | | | | iden | | | | | | | | tifying | | | | | | | | the | | | | | | | | II-NNI | | | | | | | | tr | | | | | | | | aversal | | | | | | | | sc | | | | | | | | enario. | | | | | | | +---------+---------+---------+---------+---------+---------+---------+
NOTE: The table A.3.2.1.1 does not contain the case when an IMS is acting as a
transit network.
### A.3.2.2 IBCF acting as an exit point
The logic in the IBCF acting as an exit point to determine the II-NNI
traversal scenario type would be:
Figure A.3.2.2.1: IBCF acting as an exit point
NOTE: The use of Called-Party-ID header field to determine the II-NNI
traversal scenario type can cause problems in the future if the Called-Party-
ID header field is used in another context.
### A.3.2.3 IBCF acting as an entry point
The logic in the IBCF acting as an entry point to determine the II-NNI
traversal scenario type would be:
Figure A.3.2.3.1: IBCF acting as an entry point
## A.3.3 Explicit indication of the II-NNI traversal scenario type
### A.3.3.1 The \"Subscribe to reg-event\" II-NNI traversal scenario type
between visited X and home A
When the P-CSCF sends a SUBCRIBE request in order to subscribe to
registration-state event package for a registered user, the P-CSCF adds an
indication in the outgoing SUBSCRIBE request that this is the \"Subscribe to
reg-event\" II‑NNI traversal scenario type.
Both the IBCF22 and IBCF23 uses the indication to perform the tasks associated
with this II-NNI traversal scenario type according to local policy.
### A.3.3.2 The \"Dialog creating SIP request and stand-alone SIP requests
using the registration path\" II-NNI traversal scenario type between visited X
and home A
When the P-CSCF receives a SUBCRIBE request from the UE, the P-CSCF adds an
indication in the outgoing SUBSCRIBE request that this is the \"Dialog
creating SIP request and stand-alone SIP requests using the registration
path\" between visited and home II-NNI traversal scenario type.
When the MSC server enhanced for ICS sends a SUBCRIBE request, the MSC server
enhanced for ICS adds an indication in the outgoing SUBSCRIBE request that
this is the \"Dialog creating SIP request and stand-alone SIP requests using
the registration path\" between visited and home II-NNI traversal scenario
type.
Both the IBCF1 and IBCF2 uses the indication to perform the tasks associated
with this II-NNI traversal scenario type according to local policy.
### A.3.3.3 The \"Dialog creating SIP request and stand-alone SIP requests
between home A and home B\" II-NNI traversal scenario type
When the S-CSCF sends a SUBSCRIBE request towards the destination that is not
an UE or an AS, the S-CSCF adds in the outgoing SUBSCRIBE request that this is
the \"Dialog creating SIP request and stand-alone SIP requests between home A
and home B\" II-NNI traversal scenario type.
Both the IBCF12 and IBCF15 uses the indication to perform the tasks associated
with this II-NNI traversal scenario type according to local policy.
### A.3.3.4 The \"Dialog creating SIP request and stand-alone SIP requests
using the registration path\" II-NNI traversal scenario type between home B
and visited Y
When the S-CSCF sends a SUBSCRIBE request towards an UE, the S-CSCF adds in
the outgoing SUBSCRIBE request that this is the \"Dialog creating SIP request
and stand-alone SIP requests using the registration path\" II-NNI traversal
scenario type between home and visited.
Both the IBCF16 and IBCF17 uses the indication to perform the tasks associated
with this II-NNI traversal scenario type according to local policy.
### A.3.3.5 The \"Home A to transit Z\" II-NNI traversal scenario type
When the BGCF sends the SUBSCRIBE request routed via an IMS transit network
providing application services, the BGCF adds in the outgoing SUBSCRIBE
request that this is the \"Home A to transit Z\" II-NNI traversal scenario
type between home and a transit network.
Both the IBCF12 and IBCF13 uses the indication to perform the tasks associated
with this II-NNI traversal scenario type according to local policy.
### A.3.3.6 The \"Transit Z to home B\" II-NNI traversal scenario type
When the transit function sends the SUBSCRIBE request towards the home B, the
TRF adds in the outgoing SUBSCRIBE request that this is the \"Transit Z to
home B\" II-NNI traversal scenario type between a transit network and a home
network.
Both the IBCF14 and IBCF15 uses the indication to perform the tasks associated
with this II-NNI traversal scenario type according to local policy.
### A.3.3.7 Summary detection of the II-NNI traversal scenario types using
explicit indication for the SUBSCRIBE request
The II-NNI traversal scenario type is added by the P-CSCF, the S-CSCF, the
BGCF and the MSC server.
The IBCF acting as an exit point and the IBCF acting as an entry point uses
the indication to perform the tasks associated with this II-NNI traversal
scenario type according to local policy.
###### ### Annex B: Requirement for an explicit indication of the II-NNI
traversal scenario type
# B.1 Scope
The purpose with this annex is to document the requirement for an explicit
indication solution.
If an explicit indication solution is selected as the result of the study,
this annex can be used as a first input in an IETF draft.
## B.2.1 Use cases
A user can be either attached to its own operator or attached to another
operator. In the latter case the user is referred to as a roaming user. The
services available to a roaming user are based on bilateral agreements between
the operators.
3GPP IMS defines an Inter IMS Network to Network Interface, referred to as II-
NNI. Depending on different routeing methods and existing charging models a
number of use cases are identified.
Below follows a number of important use cases where the SIP signalling and
media path between different operator networks are shown.
**Use case 1: The involved users are not roaming**
> SIP: User A -- home A operator -- home B operator -- user B
>
> Media: User A -- home A operator -- home B operator -- user B
>
> When the user is roaming, i.e. is attached to another operator, the
> signalling and media paths are more complex and can either be home routed,
> loopback routed or loopback routed using media resources in the visited
> network.
**Use case 2: The calling user is roaming and the called user is not roaming**
> SIP: User A -- visited X operator -- home A operator -- home B operator --
> user B
>
> Media: User A -- visited X operator -- home A operator -- home B operator --
> user B
>
> The scenario applies when supplementary services in the home A network
> requires access to media (e.g. for providing tones and announcements or
> providing conference resources) or if the home A network determines that it
> is more cost/resource efficient to route the call directly to the
> destination.
**Use case 3: The calling user is roaming and the call is routed back to the
visited network**
> SIP: User A -- visited X operator -- home A operator -- visited X operator
> -- home B operator -- user B
>
> Media: User A -- visited X operator -- home B operator -- user B
>
> This scenario applies if there are no supplementary services that require
> access to media in the home A operator network and if the home network
> determines that it is more efficient to route the call from the visited X
> network to the called user.
**Use case 4: The calling user is roaming and media resources in the visited
network is used by the home network**
> This scenario applies when supplementary services in the home network
> require access to the media and the visited network, according to bilateral
> agreements between the operators, can provide the necessary media resources.
>
> This use case can be realized in two ways:
**Option 1:**
> SIP (1): User A -- visited X operator -- home A operator -- visited X
> operator -- home B operator -- user B
>
> Media (1): User A -- visited X operator -- visited network X media resource
> -- home B operator -- user B
>
> SIP (2): supplementary service in home A -- visited network X media resource
>
> Media (2): supplementary service in home A -- visited network X media
> resource
>
> The first signalling path, SIP (1), is used to establish the call. The
> second signalling path, SIP (2), is used to establish a media control
> channel in accordance with IETF RFC 6230 [15] between the home A operator
> network and the visited network X media resource.
>
> The first media path, Media (1), is used to for media between the User A and
> User B. The second media path is used to send control signalling established
> by IETF RFC 6230 [15] associated with appropriate packages specified in 3GPP
> TS 24.229 [2] clause 10.2.
**Option 2:**
SIP: User A -- visited X operator -- home A operator -- supplementary service
in home A -- visited network X media resource -- supplementary service in home
A -- home A operator -- visited X operator -- home B operator -- user B
Media: User A -- visited X operator -- visited network X media resource \--
home B operator -- user B
**Use case 5: The calling user is not roaming and the called user is roaming**
> SIP: User A -- home A operator -- home B operator -- visited network Y \--
> user B
>
> Media: User A -- home A operator -- home B operator -- visited network Y --
> user B
>
> Any of the above calling user side uses cases can be combined with any of
> the called user side use cases.
**Use case 6: None of the users are roaming but there is a transit network
between the home A and home B networks**
> Between operators there may be intermediate SIP based networks that
> interconnects operators. The intermediate SIP based networks are referred to
> as transit networks.
>
> SIP: User A -- home A operator -- transit network -- home B operator \--
> user B
>
> Media: User A -- home A operator -- transit network -- home B operator \--
> user B
>
> Transit networks may be involved between any of the operator networks in all
> uses cases in this clause.
>
> Normally dialog creating requests and stand-alone requests between the home
> network and the visited network, where a roaming user is attached, are sent
> following the path created when the user registers. However, there are also
> other use cases where the visited or the home network sends requests outside
> the path created during registration. For the Use case 1 (The involved users
> are not roaming), the paths created when the users register do not traverse
> any transit network.
## B.2.2 II-NNI traversal scenario types
The signalling path in the network between a calling user and a called user
can be divided into smaller parts, referred to as II-NNI traversal scenario
types. Each II-NNI traversal scenario type will have its own characteristics
that can be different from other II-NNI traversal scenario types in the same
call. The directionality in II-NNI traversal scenario types relates to a SIP
request creating a dialogue and stand-alone SIP request; the applicable II‑NNI
traversal scenario type of SIP responses and SIP request inside a dialogue is
determined by the corresponding SIP request creating a dialogue and stand-
alone SIP request.
NOTE: Even if the call is broken up into several II-NNI traversal scenario
types the Call-ID can be the same in all II-NNI traversal scenario types
associated with the call i.e. no B2BUA is needed to change the Call-ID between
the II-NNI traversal scenario types.
Examples of II-NNI traversal scenario types in the uses cases described in
clause 4.1:
**Use case 1: The involved users are not roaming**
> II-NNI traversal scenario 1: home A network -- home B network
**Use case 2: The calling user is roaming and the called user is not roaming**
> II-NNI traversal scenario 1: visited A network -- home A network
>
> II-NNI traversal scenario 2: home A network -- home B network
**Use case 3: The calling user is roaming and the call is routed back to the
visited network**
> II-NNI traversal scenario 1: visited A network -- home A network
>
> II-NNI traversal scenario 2: home A network -- visited X network
>
> II-NNI traversal scenario 3: visited X network -- home B network
**Use case 4: The calling user is roaming and media resources in the visited
network is used by the home network**
> II-NNI traversal scenario 1: visited A network -- home A network
>
> II-NNI traversal scenario 2: home A network -- visited X network (to be used
> for controlling media resources)
>
> II-NNI traversal scenario 3: home A network -- visited X network (for
> setting up the call)
>
> II-NNI traversal scenario 4: visited X network -- home B network
**Use case 5: The calling user is not roaming and the called user is roaming**
> II-NNI traversal scenario 1: home A network -- home B network
>
> II-NNI traversal scenario 2: home B network -- visited Y network
**Use case 6: None of the users are roaming but there is a transit network
between the home A and home B networks**
> II-NNI traversal scenario 1: home A network -- transit network -- home B
> network
>
> The exit/entry points on each side of a II-NNI traversal scenario type
> between two operator networks (e.g. visited and home), applies a local
> policy associated with the II-NNI traversal scenario type (e.g. shall media
> be anchored or not, see also clause 4.5) and the exit point and the entry
> point need to reach a common understanding of the II‑NNI traversal scenario
> type to avoid inconsistencies in a call.
## B.2.3 Requirements
Based on the use cases in clauses 4.1 and 4.2 the following requirements can
be derived:
REQ-1: It MUST be possible for a SIP proxy/B2BUA to indicate, and convey to
other SIP entities in the signalling path of a registration request, an II-NNI
traversal scenario type indication.
REQ-2: It MUST be possible for a SIP proxy/B2BUA to indicate, and convey to
other SIP entities in the signalling path of a dialog-forming request, an II-
NNI traversal scenario type indication.
REQ-3: It MUST be possible for a SIP proxy/B2BUA to indicate, and convey to
other SIP entities in the signalling path of a stand-alone request, an II-NNI
traversal scenario type indication.
REQ-4: A SIP proxy/B2BUA MUST NOT, when adding an II-NNI traversal scenario
type indication make any assumptions that SIP entities in the signalling path
that receive the indication will support, or understand the meaning of, the
II-NNI traversal scenario type indication, or even support the II-NNI
traversal scenario type indication mechanism as a whole.
REQ-5: The mechanism MUST be backward compatible such that the indication of
the II-NNI traversal scenario type is removed by the SIP entity at the end of
the II-NNI traversal scenario without the SIP entity at the end of the II-NNI
traversal scenario supports the identification of the II-NNI traversal
scenario type mechanism as a whole.
REQ-6: A SIP proxy/B2BUA MUST be able to indicate the II-NNI traversal
scenario type to other SIP entities in the signalling path, even if some SIP
entities in the signalling path do not support, or understand the meaning of,
the II-NNI traversal scenario type indication, or even support the II-NNI
traversal scenario type indication mechanism as a whole.
REQ-7: If a SIP entity that does not support the II-NNI traversal scenario
type indication mechanism receives an II-NNI traversal scenario type
indication, it MUST act as if it hadn\'t received the indication.
REQ-8: SIP entities on the path of the SIP message MUST be able to inspect the
II-NNI traversal scenario type indication introduced by other entities.
REQ-9: A II-NNI traversal scenario type indicator MUST only be used to
identify the II-NNI traversal scenario, and MUST NOT be used to indicate
whether procedures associated with the II-NNI traversal scenario type
indication have been applied or not.
REQ-10: The solution MUST fulfil security consideration aspects and
application of trust policy and/or possibility of fraud MUST be minimized.
REQ-11: A procedure for II-NNI traversal scenario type indication values,
which prevents name collisions of indicators, with IANA MUST be defined.
REQ-12: Any solution MUST be backward compatible with existing methods of
identifying the II-NNI traversal scenario type.
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the discovery and network selection procedures
for access to 3GPP Evolved Packet Core (EPC) via non-3GPP access networks and
includes Authentication and Access Authorization using Authentication,
Authorization and Accounting (AAA) procedures used for the interworking of the
3GPP EPC and the non-3GPP access networks.
The present document also specifies the Tunnel management procedures used for
establishing an end-to-end tunnel from the UE to the ePDG to the point of
obtaining IP connectivity and includes the selection of the IP mobility mode.
The non-3GPP access networks considered in this present document are
cdma2000^®^ HRPD and Worldwide Interoperability for Microwave Access (WiMAX),
and any access technologies covered in 3GPP TS 23.402 [6]. The present
document also specifies UE access to PLMN IP-based services via restrictive
non-3GPP access networks covered in 3GPP TS 33.402 [15]. These non-3GPP access
networks can be trusted or untrusted access networks.
The present document is applicable to the UE and the network. In this
technical specification the network is the 3GPP EPC.
NOTE: cdma2000^®^ is a registered trademark of the Telecommunications Industry
Association (TIA-USA).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] Void.
[2A] 3GPP TS 23.002: \"Network architecture\".
[3] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[4] 3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile
Station (MS) in idle mode\".
[5] Void.
_[5A]_ 3GPP TS 23.203: \"Policy and Charging Control Architecture\".
[6] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[7] Void.
[8] Void.
[9] 3GPP TS 24.234: \"3GPP System to Wireless Local Area Network (WLAN)
interworking; WLAN User Equipment (WLAN UE) to network protocols\".
[10] 3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS)\".
[11] 3GPP TS 24.303: \"Mobility management based on Dual-Stack Mobile IPv6\".
[12] 3GPP TS 24.304: \"Mobility management based on Mobile IPv4; User
Equipment (UE) - Foreign Agent interface\".
[13] 3GPP TS 24.312: \"Access Network Discovery and Selection Function (ANDSF)
Management Object (MO)\".
[14] 3GPP TS 25.304: \"User Equipment (UE) procedures in idle mode and
procedures for cell reselection in connected mode\".
[14A] 3GPP TS 25.331: \"Radio Resource Control (RRC); Protocol
Specification\".
[15] 3GPP TS 33.402: \"3GPP System Architecture Evolution: Security aspects of
non-3GPP accesses\".
[16] 3GPP TS 36.304: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
User Equipment (UE) procedures in idle mode\".
[16A] 3GPP TS 45.008: \"Radio Access Network; Radio subsystem link control\".
[16B] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA)
Radio Resource Control (RRC); Protocol specification\".
[17] 3GPP TS 29.273: \"Evolved Packet System; 3GPP EPS AAA Interfaces\".
[18] 3GPP TS 29.275: \"Proxy Mobile IPv6 (PMIPv6) based Mobility and
Tunnelling protocols\".
[19] 3GPP TS 29.276: \"Optimized Handover Procedures and Protocols between
EUTRAN Access and cdma2000 HRPD Access\".
[20] 3GPP2 X.S0057-B v2.0: \"E-UTRAN - HRPD Connectivity and Interworking:
Core Network Aspects\".
[21] 3GPP2 C.S0087-A v4.0: \"E-UTRAN -- HRPD and CDMA2000 1x Connectivity and
Interworking: Air Interface Aspects\".
[22] Void.
[23] 3GPP2 C.S0024-B v3.0: \"cdma2000^®^ High Rate Packet Data Air Interface
Specification\".
[23A] 3GPP2 C.S0016-D v1.0: \"Over-the-Air Service Provisioning of Mobile
Stations in Spread Spectrum Standards\".
[24] WiMAX Forum Network Architecture Release 1.0 version 1.2 -- Stage 2:
\"Architecture Tenets, Reference Model and Reference Points\", November 2007.
[25] WiMAX Forum Network Architecture Release 1.0 version 1.2 -- Stage 3:
\"Detailed Protocols and Procedures\", November 2007.
[26] WiMAX Forum Mobile System Profile Release 1.0 Approved Specification
Revision 1.4.0, April 2007.
[27] IEEE Std 802.16e-2005 and IEEE Std 802.16-2004/Cor1-2005: \"IEEE Standard
for Local and Metropolitan Area Networks, Part 16: Air Interface for Fixed and
Mobile Broadband Wireless Access Systems Amendments 2 and Corrigendum 1\",
February 2006.
[28] IETF RFC 5996 (September 2010): \"Internet Key Exchange Protocol Version
2 (IKEv2)\".
[29] IETF RFC 3748 (June 2004): \"Extensible Authentication Protocol (EAP)\".
[30] IETF RFC 4301 (December 2005): \"Security Architecture for the Internet
Protocol\".
[31] IETF RFC 4555 (June 2006): \"IKEv2 Mobility and Multihoming Protocol
(MOBIKE)\".
[32] IETF RFC 4303 (December 2005): \"IP Encapsulating Security Payload
(ESP)\".
[33] IETF RFC 4187 (January 2006): \"Extensible Authentication Protocol Method
for 3rd Generation Authentication and Key Agreement (EAP-AKA)\"
[34] IETF RFC 3629 (November 2003): \"UTF-8, a transformation format of ISO
10646\".
[35] IETF RFC 1035 (November 1987): \"DOMAIN NAMES - IMPLEMENTATION AND
SPECIFICATION\".
[36] **Void.**
_[37] IETF RFC 6153 (February 2011): \"DHCPv4 and DHCPv6 Options for Access
Network Discovery and Selection Function (ANDSF) Discovery_ \".
_[38] IETF RFC 5448 (May 2009)_ : _\"_ Improved Extensible Authentication
Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-
AKA\')_\"._
[39] OMA-ERELD-DM-V1_2: \"Enabler Release Definition for OMA Device
Management\".
[40] Void
[41] \"Unicode 5.1.0, Unicode Standard Annex #15; Unicode Normalization
Forms\", March 2008. http://www.unicode.org.
[42] 3GPP TS 33.220: \"Generic Authentication Architecture (GAA); Generic
bootstrapping architecture\".
[43] 3GPP TS 29.109: \"Generic Authentication Architecture (GAA); Zh and Zn
Interfaces based on the Diameter protocol\".
[44] 3GPP TS 33.222: \"Generic Authentication Architecture (GAA); Access to
network application functions using Hypertext Transfer Protocol over Transport
Layer Security (HTTPS)\".
[45] 3GPP TS 31.102: \"Characteristics of the Universal Subscriber Identity
Module (USIM) application\".
[46] 3GPP TS 24.008: \"Mobile radio interface Layer 3 specification; Core
network protocols; Stage 3\".
[47] 3GPP TS 33.223: \"Generic Authentication Architecture (GAA); Generic
Bootstrapping Architecture (GBA) Push function\".
[48] 3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General
aspects\".
[49] IETF RFC 4739: \"Multiple Authentication Exchanges in the Internet Key
Exchange (IKEv2) Protocol\".
[50] 3GPP TS 29.274: \"Tunnelling Protocol for Control plane (GTPv2-C)\".
[51] 3GPP TS 24.139: \"3GPP System-Fixed Broadband Access Network
Interworking; Stage 3\".
[52] 3GPP TS 24.109: \"Bootstrapping interface (Ub) and network application
function interface (Ua); Protocol details\".
_[53] IETF RFC_ 2817 _(May_  _2000)_ : _\"_ Upgrading to TLS Within HTTP/1.1
_\"._
_[54] IETF RFC_ 5246 _(August 2008)_ : _\"_ The Transport Layer Security (TLS)
Protocol Version 1.2 _\"._
_[55] IETF RFC_ 6066 _(January 2011)_ : _\"T_ ransport Layer Security (TLS)
Extensions: Extension Definitions _\"._
_[56]_ 3GPP TS 24.244: \"Wireless LAN control plane protocol for trusted WLAN
access to EPC\".
[57] IEEE Std 802.11-2012: \"IEEE Standard for Information technology \-
Telecommunications and information exchange between systems - Local and
metropolitan area networks - Specific requirements - Part 11: Wireless LAN
Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".
[58] IEEE Std 802-2014: \"IEEE Standard for Local and Metropolitan Area
Networks: Overview and Architecture\", 30th June 2014.
[59] Void.
[60] IETF RFC 4284 (January 2006): \"Identity Selection Hints for the
Extensible Authentication Protocol (EAP)\".
[61] IEEE Std 802.1X™-2010: \"IEEE Standard for Information technology \-
Telecommunications and information exchange between systems - Local and
metropolitan area networks - Port-based Network Access Control\".
_[62]_ IETF RFC 4282: \"The Network Access Identifier\".
[63] ITU-T Recommendation E.212: \"The international identification plan for
mobile terminals and mobile users\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
**Access Network Discovery and Selection Function:** In this specification,
Access Network Discovery and Selection Function (ANDSF) is a network element
specified in 3GPP TS 23.402 [6]. Unless otherwise specified, the term ANDSF is
used to refer to both Home and Visited ANDSF.
**ANDSF rules:** In this specification, ANDSF rules refers to the set of ANDSF
policies defined in 3GPP TS 24.312 [13] for WLAN access selection and traffic
routing between E-UTRAN or UTRAN and WLAN. ANDSF rules can contain RAN
validity conditions for RAN-assisted WLAN interworking.
**Emergency session:** In this specification, an emergency session is an
emergency PDN connection established in E-UTRAN and handed over to a S2a based
cdma2000^®^ HRPD access network.
**Equivalent home service provider:** In this specification, equivalent home
service provider is a service provider that is equivalent to HPLMN in regard
to service provider selection over WLAN.
**Equivalent visited service provider:** In this specification, equivalent
visited service provider is a service provider that is equivalent to the
V-PLMN in regard to service provider selection over WLAN.
**Home ANDSF:** In this specification, the Home ANDSF (H-ANDSF) is an ANDSF
element located in the home PLMN of a UE.
**Offload Preference Indicator (OPI):** In this specification, Offload
Preference Indicator (OPI) is a bitmap (i.e. a one-dimensional bit array) that
can be used by UEs in an E-UTRA or UTRA cell to determine when to move certain
traffic (e.g. certain IP flows) to WLAN access or to 3GPP access. The meaning
of each bit in this bitmap is operator specific and is not defined in 3GPP
specifications.
**Offloadable PDN connection** : In this specification, an offloadable PDN
connection is a PDN connection, established in (or previously handed over to)
3GPP access, such that:
\- the WLAN offload indication information element (see 3GPP TS 24.301 [10]
and 3GPP TS 24.008 [46]) last received for the PDN connection has the
\"offloading the traffic of the PDN connection via a WLAN when in S1 mode is
acceptable\" value and the UE is in S1 mode; or
\- the WLAN offload indication information element (see 3GPP TS 24.301 [10]
and 3GPP TS 24.008 [46]) last received for the PDN connection has the
\"offloading the traffic of the PDN connection via a WLAN when in UTRAN Iu
mode is acceptable\" value and the UE is in UTRAN Iu mode.
**Preferred Service Providers List (PSPL):** In this specification, the
Preferred Service Providers List refers to a prioritized list of service
provider realms other than equivalent home service providers preferred by the
UE\'s 3GPP home operator for WLAN.
**Set of Access network discovery information:** In this specification, a set
of Access network discovery information is the access network discovery
information from a single ANDSF**.**
**Set of Inter-system mobility policy:** In this specification, a set of
Inter-system mobility policy is the inter-system policy information received
from a single ANDSF**.**
**Visited ANDSF:** In this specification, the Visited ANDSF (V-ANDSF) is an
ANDSF element located in the visited PLMN of a UE.
**RAN Assistance Information:** In this specification, RAN Assistance
Information refers to the set of thresholds and parameters that can be
provided by E-UTRAN or UTRAN to the UE for assisting WLAN access selection and
traffic routing. The RAN assistance information can include 3GPP access
thresholds, WLAN access thresholds, an Offload Preference Indicator (OPI)
value and WLAN identifiers as defined in 3GPP TS 25.331 [14A] and 3GPP TS
36.331 [16B].
**RAN rules:** In this specification, RAN rules refers to the set of RAN
assistance parameter handling, access network selection and traffic steering
procedures defined in 3GPP TS 36.304 [16] and 3GPP TS 25.304 [14] for steering
traffic between E-UTRAN or UTRAN and WLAN for RAN-assisted WLAN interworking.
**Restrictive non-3GPP access network type I:** a non-3GPP access network
forwarding IP packets of TCP connections initiated by a served UE, with
destination port 443, and with destination address outside of the non-3GPP
access network, and discarding IP packets of some or all other TCP connections
initiated by the served UE, with destination address outside of the non-3GPP
access network.
**Restrictive non-3GPP access network type II:** a non-3GPP access network
discarding IP packets of TCP connections initiated by a served UE, with
destination address outside of the non-3GPP access network, where the non-3GPP
access network contains HTTP proxy supporting HTTP CONNECT method for URIs
with port 443 and with host outside of the non-3GPP access network.
**Restrictive non-3GPP access network:** restrictive non-3GPP access network
type I or restrictive non-3GPP access network type II.
**Firewall traversal tunnel (FTT):** a TCP connection with TLS connection
enabling passing of messages between UE in restrictive non-3GPP access network
and ePDG.
**Firewall traversal tunnel keep-alive time (FTT KAT)** : a maximum time
between two subsequent messages sent by UE in the firewall traversal tunnel.
**WLAN Selection Policy (WLANSP):** In this specification, the WLAN Selection
Policy is a set of operator-defined rules that determine how the UE
selects/reselects a WLAN access network.
**WLAN selection information:** In this specification, WLAN selection
information refers to the information received from ANDSF including WLAN
Selection Policy (WLANSP), rule selection information, Home Network Preference
information and Visited Network Preference information as specified in 3GPP TS
24.312 [13].
**Visited PLMNs with preferred rules** : In this specification, visited PLMNs
with preferred rules included in the rule selection information refers to a
list of identifiers of visited PLMNs provided by HPLMN, so that the UE roaming
in such visited PLMN prefers ISMP, ISRP or WLANSP rules provided by the
visited PLMN over ISMP, ISRP or WLANSP rules provided the HPLMN. In ANDSF MO,
the visited PLMNs with preferred rules correspond to the
ANDSF/RuleSelectionInformation/VPLMNswithPreferredRules interior node.
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.122 [4] apply:
**EHPLMN**
**Home PLMN**
**RPLMN**
**Visited PLMN**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.402 [6] apply:
**IFOM capable UE**
**Inter-APN routing capable UE**
**Local Operating Environment Information**
**MAPCON capable UE**
**S2a**
**S2b**
**S2c**
**Non-seamless WLAN offload capable UE**
**Single-connection mode (SCM)**
**Transparent single-connection mode (TSCM)**
**Multi-connection mode (MCM)**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 29.273 [17] apply:
**STa**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.301 [10] apply:
**Evolved packet core network**
**Evolved packet system**
For the purposes of the present document, the following terms and definitions
given in WiMAX Forum Network Architecture Release 1.0 version 1.2 -- Stage 3
[25] apply:
**Network Access Provider**
**Network Service Provider**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 33.402 [15] apply:
**External AAA server**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.312 [13] apply:
**Active rule**
**Valid rule**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.003 [3] that relate to access to 3GPP evolved packet core
via non-3GPP access networks, apply:
**Alternative NAI**
**Decorated NAI**
**Emergency NAI**
**Fast-Reauthentication NAI**
**Pseudonym Identity**
**Root NAI**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.002 [2A] apply:
**3GPP AAA Proxy**
**3GPP AAA Server**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
AAA Authentication, Authorization and Accounting
ACL Access Control List
AKA Authentication and Key Agreement
ANDSF Access Network Discovery and Selection Function
ANDSF-SN Access Network Discovery and Selection Function Server Name
ANID Access Network Identity
ANQP Access Network Query Protocol
APN Access Point Name
DHCP Dynamic Host Configuration Protocol
DM Device Management
DNS Domain Name System
DSMIPv6 Dual-Stack MIPv6
eAN/PCF Evolved Access Network Packet Control Function
EAP Extensible Authentication Protocol
EPC Evolved Packet Core
ePDG Evolved Packet Data Gateway
EPS Evolved Packet System
ESP Encapsulating Security Payload
FQDN Fully Qualified Domain Name
GAA Generic Authentication Architecture
GBA Generic Bootstrapping Architecture
HA Home Agent
H-ANDSF Home-ANDSF
HRPD High Rate Packet Data
HSGW HRPD Serving Gateway
IEEE Institute of Electrical and Electronics Engineers
IFOM IP Flow Mobility
IKEv2 Internet Key Exchange version 2
IARP Inter-APN Routing Policy
IPMS IP Mobility Mode Selection
ISMP Inter-system Mobility Policy
ISRP Inter-system Routing Policy
IANA Internet Assigned Numbers Authority
I-WLAN Interworking -- WLAN
MAPCON Multi Access PDN Connectivity
MCM Multi-connection mode
MO Management Object
NAI Network Access Identifier
NAP Network Access Provider
NBM Network based mobility management
NSP Network Service Provider
NSWO Non-Seamless WLAN Offload
OMA Open Mobile Alliance
OPI Offload Preference Indicator
PCO Protocol Configuration Options
P-GW PDN Gateway
PDU Protocol Data Unit
PSPL Preferred Service Provider List
SCM Single-connection mode
S-GW Serving Gateway
SPI Security Parameters Index
TSCM Transparent single-connection mode
UE User Equipment
UICC Universal Integrated Circuit Card
V-ANDSF Visited-ANDSF
W-APN WLAN APN
WiMAX Worldwide Interoperability for Microwave Access
WLAN Wireless Local Area Network
WLANSP WLAN Selection Policy
WLCP WLAN Control Protocol
WMF WiMAX Forum
# 4 General
## 4.1 Trusted and untrusted accesses
The HPLMN operator of the EPC selects whether a connected non-3GPP IP access
network is a trusted or untrusted IP access network.
**For a trusted non-3GPP IP access network the communication between the UE
and the EPC is secure. For an untrusted non-3GPP IP access network the
communication between the UE and the EPC is not trusted to be secure.**
For a trusted non-3GPP IP access network, all **communication between the
access network and the EPC is transferred over pre-established secure
links.For an untrusted non-3GPP IP access network** , to secure communication
between the UE and the EPC:
\- a **single IPSec tunnel needs to be established** to the ePDG for all PDN
connections when S2c interface is used; or
\- an IPSec tunnel needs to be established with the same ePDG for each PDN
connection when S2b interface is used.
## 4.2 cdma2000^®^ HRPD Access System
The cdma2000^®^ HRPD system is a wireless mobile system developed under the
auspices of 3GPP2. The cdma2000^®^ HRPD system and its access network
subsystem is compliant with 3GPP2 X.S0057 [20] and 3GPP2 C.S0087 [21], which
define the core network and air interface aspects, respectively.
## 4.3 WiMAX Access System
The WiMAX system is a wireless mobile broadband system developed under the
auspices of the WMF and the IEEE. The WiMAX system and its access network
subsystem are compliant with WiMAX Forum Network Architecture Release 1.0
version 1.2 -- Stage 2 [24]. The protocol architecture and signalling of the
WiMAX system is specified in WiMAX Forum Network Architecture Release 1.0
version 1.2 -- Stage 3 [25] which supports the air interface defined in WiMAX
Forum Mobile System Profile Release 1.0 Approved Specification Revision 1.4.0
[26] specifying selected profiles of IEEE Std 802.16e-2005 and IEEE Std
802.16-2004/Cor1-2005 [27] that are to be supported. **The WiMAX access system
correspond to the WiMAX Access Service Network (ASN) and to relevant
interfaces, as defined in** WiMAX Forum Network Architecture Release 1.0
version 1.2 -- Stage 3 **[25].**
## 4.4 Identities
### 4.4.1 User identities
The user identification shall be either the root NAI, or the decorated NAI,
when the UE accesses the EPC via non-3GPP access networks, and gets
authentication, authorization and accounting services from the EPC. For
handover of an emergency session from E-UTRAN to a S2a based cdma2000^®^ HRPD
access network, if IMSI is not available (i.e. a UE without USIM) or IMSI is
unauthenticated, the IMEI shall be used for the identification, as part of the
emergency NAI as defined.
User identification in non-3GPP accesses may require additional identities
that are out of the scope of 3GPP.
IETF RFC 4187 [33] and 3GPP TS 23.003 [3] provide definitions for UE and user
identities although they use slightly different terms. Similar terms are also
used in 3GPP TS 33.402 [15]. The following list provides term equivalencies
and describes the relation between various user identities.
\- The Root NAI is to be used as the permanent identity as specified in 3GPP
TS 33.402 [15].
\- The Fast-Reauthentication NAI is to be used as the Fast-Reauthentication
Identity or the re-authentication ID as specified in 3GPP TS 33.402 [15].
\- The Pseudonym Identity is to be used as the Pseudonym as specified in 3GPP
TS 33.402 [15].
### 4.4.2 Identification of IP Services/PDN connections
For access to EPC the Access Point Name (APN) is used for identifying IP
services/PDN connections. The detailed definition of APN as used for access to
EPC is specified in 3GPP TS 23.003 [3]. APN is conveyed in the IKEv2 signaling
during tunnel establishment when S2b interface is used for UE to access EPC.
When UE accesses to EPC via S2a using trusted WLAN access network, APN is
conveyed in EAP-AKA\' signaling for single-connection mode (SCM) or in WLAN
Control Protocol (WLCP) signaling (see 3GPP TS 24.244 [56]) for multi-
connection mode (MCM)
### 4.4.3 FQDN for ePDG Selection
An ePDG Fully Qualified Domain Name (ePDG FQDN) is constructed by UE and used
as input to the DNS mechanism for ePDG selection.
The detailed format of this ePDG FQDN is specified in 3GPP TS 23.003 [3].
### 4.4.4 Access Network Identity
For access to EPC through a trusted non-3GPP access network via S2a the UE has
to use the Access Network Identity (ANID) in the key derivation (see 3GPP TS
33.402 [15]). The handling of the Access Network Identity is described in
subclause 6.4.2.4 and the generic format and specific values for the Access
Network Identity are defined in subclause 8.1.1.
### 4.4.5 ANDSF Server Name
The ANDSF Server Name (ANDSF-SN) is used for ANDSF discovery. The detailed
rules are defined in subclause 6.8.2.2.1 and the format of the ANDSF-SN is
specified in 3GPP TS 23.003 [3].
### 4.4.6 Home Agent address(es)
If DSMIPv6 is used, the Home Agent IPv6 address (and optionally an IPv4
address) are needed. Within this specification, Home Agent address(es)
signalling via IKEv2 between the UE and the ePDG is defined in subclause
7.4.1.
### 4.4.7 Security Parameters Index
The Security Parameters Index (SPI, see IETF RFC 4301 [30]) identifies
uniquely a security association between the UE and the ePDG. For the case of
NBM using S2b a one to one mapping between SPI and PDN connection applies.
## 4.5 _Fixed Broadband_ Access System
The _fixed broadband_ _access_ system is a type of high-speed Internet access
for multi-service broadband packet networking. The _fixed broadband_ _access_
system is specified by the Broadband Forum, including addressing
interoperability, architecture and management.
For support of _fixed broadband_ access interworking _,_ the EPC network
procedures are specified in 3GPP TS 24.139 [51].
The UE procedures for support of _fixed broadband_ access are specified in
3GPP TS 24.139 [51] and can be used when the EPC network uses the fixed
broadband access interworking or the fixed broadband access convergence.
The architecture of the _fixed broadband_ access convergence is specified in
3GPP TS 23.203 [5A].
## 4.6 Restrictive non-3GPP access networks
An untrusted non-3GPP access network can be a restrictive non-3GPP access
network. When the UE is served by a restrictive non-3GPP access network, the
UE and the ePDG follow the additional procedures described in the annex F.
# 5 Network Discovery and Selection
## 5.1 Access network discovery and selection procedures
### 5.1.1 General
If PLMN selection specified in 3GPP TS 23.122 [4] is applicable (e.g., at
switch on, recovery from lack of coverage, or user selection of applicable
access technology), the PLMN selection to select the highest priority PLMN
according to these specifications is performed before any access network
discovery. For WLAN access, service provider selection function is specified
in the WLAN specific procedures in subclause 5.2.3.2
In the access network discovery procedure the UE may get from the ANDSF
information on available access networks in its vicinity. The UE may obtain
this information by querying the ANDSF, and may use this information when
determining the presence of operator preferred access networks. Determination
of the presence of access networks requires using radio access specific
procedures, which are not further described here.
The UE determines the presence of several access networks and then selects
between them. If a higher priority access network is found connected to the
selected service provider or a higher priority service provider, the UE will
attempt to attach via that access network.
### 5.1.2 Access network discovery procedure
#### 5.1.2.1 Triggering the discovery of operator preferred access networks
with the ANDSF
The UE may initiate communications with the ANDSF for operator preferred
access network discovery:
\- when conditions set up within the policies available in the UE are met; or
\- when a user requests for manual selection.
NOTE 1: The minimum allowed time interval between two consecutive UE initiated
requests towards the ANDSF can be set by operator policies.
NOTE 2: The UE changing of access networks can override the minimum allowed
time interval setting.
#### 5.1.2.2 Discovering availability of access networks
The UE may apply the techniques specific to the non-3GPP access technologies
to discover available non-3GPP access networks. Such techniques will not be
further described here.
In addition, the UE may signal to the ANDSF to obtain information on operator
preferred access networks. The discovery of the ANDSF by the UE, the
connection to the ANDSF by the UE and the signalling between the UE and the
ANDSF are given in subclause 6.8.
### 5.1.3 Access network selection procedure
#### 5.1.3.1 General
The access network selection may be classified as inter-technology or intra-
technology.
The UE can use information received from ANDSF for inter-technology access
network selection.
If the RAN rules control the WLAN access selection and traffic routing as
described in subclause 6.10.2, the UE uses the information described in
subclause 6.10.4 for inter-technology access network selection.
Other mechanisms for inter-technology access network selection are out of
scope of this specification.
#### 5.1.3.2 Specific intra-technology access network selection
In this release of the specification the use of the following specific intra-
technology access network selection procedures is specified.
##### 5.1.3.2.1 cdma2000^®^ HRPD access network selection
The access network selection process for cdma2000^®^ HRPD access networks
shall follow 3GPP2 X.S0057 [20].
##### 5.1.3.2.2 WiMAX NAP selection
The access network selection process for WiMAX which encompasses the NAP
discovery and access, shall follow the WiMAX Forum Network Architecture
Release 1.0 version 1.2 -- Stage 3 [25].
##### 5.1.3.2.3 WLAN selection
###### 5.1.3.2.3.1 General
The purpose of this procedure is to create a prioritized list of selected
WLAN(s).
The user preferences are used to select between the automatic WLAN selection
procedure or the manual WLAN selection procedure.
The UE shall determine the prioritized list of selected WLAN(s):
1) if user preferences are present, in accordance with the manual mode WLAN
selection procedure (see subclause 5.1.3.2.3.2); and
2) if user preferences are not present, in accordance with the automatic mode
WLAN selection procedure (see subclause 5.1.3.2.3.3).
The UE shall use the prioritized list of selected WLAN(s) to select the
service provider in the procedure in subclause 5.2.3.2.
##### 5.1.3.2.3.2 Manual mode WLAN selection {#manual-mode-wlan-selection .H6}
The UE creates a prioritized list of selected WLAN(s). The creation of the
prioritized list is implementation specific.
##### 5.1.3.2.3.3 Automatic mode WLAN selection {#automatic-mode-wlan-
selection .H6}
If the ANDSF rules control the WLAN access selection and traffic routing as
described in subclause 6.10.2, then the selected WLAN(s) are WLAN(s) that
fulfil the selection criteria with the highest priority configured in the
active ANDSF WLANSP rule.
If the RAN rules control the WLAN access selection and traffic routing as
described in subclause 6.10.2, then the selected WLAN(s) are WLAN(s) matching
WLAN identifiers in an entry of the list of the WLAN identifiers received
along with the move-traffic-to-WLAN indication as described in subclause
6.10.4.
The UE determines the selected WLAN(s) according to the following steps:
1) the UE shall construct prioritized list of available WLANs as follows:
a) if the ANDSF rules control the WLAN access selection and traffic routing as
described in subclause 6.10.2, the UE shall use the procedures specified in
IEEE 802.11-2012 [57] to discover the available WLANs. The UE may perform ANQP
procedures as specified in IEEE 802.11-2012 [57] to discover the attributes
and capabilities of available WLANs. The UE shall compare the attributes and
capabilities of the available WLANs with the highest priority selection
criterion that has not been used yet in the active WLANSP rule, and construct
a prioritized list of available WLANs that fulfil the selection criteria. If
there are multiple highest priority selection criteria, it is up to the UE
implementation which one to use. In particular, if:
\- the group of selection criteria include the HomeNetworkIndication and it is
set to \"1\" (see 3GPP TS 24.312 [13]); and
\- the HomeNetworkPreference:
i) does not include 3GPP_RPLMN_Preferred; or
ii) includes 3GPP_RPLMN_Preferred and it is set to \"0\" (see 3GPP TS 24.312
[13]);
then a WLAN is included, if:
\- the other selection criteria in the active WLANSP rule are met; and
\- the domain name list (see IEEE 802.11-2012 [57]) includes:
i) the home domain name derived from its IMSI; or
ii) any realm in the EquivalentHomeSPs as specified in 3GPP TS 24.312 [13].
The priority of a WLAN in the list is set to the WLAN priority defined in the
preferredSSIDlist of the matching selection criteria.. There may be one or
more selected WLANs in the list; and
b) if the RAN rules control the WLAN access selection and traffic routing as
described in subclause 6.10.2, the UE shall use the procedures specified in
IEEE 802.11-2012 [57] to discover available WLANs. The UE shall construct a
prioritized list of available WLANs and populate it with each discovered WLAN
which matches all WLAN identifiers included in an entry of the list of the
WLAN identifiers received along with the move-traffic-to-WLAN indication as
described in subclause 6.10.4. The priority of a discovered WLAN in the
prioritized list of available WLANs is decided by the UE in an implementation
specific way;
2) if the ANDSF rules control the WLAN access selection and traffic routing as
described in subclause 6.10.2, and if the following conditions are fulfilled:
> \- the UE supports the PDN connection establishment over WLAN using the
> applicable S2a procedures specified in 3GPP TS 23.402 [6];
>
> \- the \"S2a connection preference\" indicator exists and indicates that PDN
> connection establishment over WLAN using the applicable S2a procedures
> specified in 3GPP TS 23.402 [6] is preferred; and
\- one or more WLANs in the list constructed in step 1) support S2a
connectivity;
then the UE considers the WLANs that have the highest priority and indicate
the HPLMN or RPLMN in the PLMN list with S2a connectivity IE (see annex H) as
the selected WLAN(s).
Otherwise, the UE considers the WLAN(s) that has or have the highest priority
as the selected WLAN(s). And
NOTE 1: WLAN advertises PLMN(s) towards which the S2a connectivity is
supported using ANQP-element \"3GPP Cellular Network\" with the PLMN List with
S2a Connectivity IE in the payload, according to annex H.
NOTE 2: Advertising S2a connectivity over a WLAN using EAP signalling is not
supported in this version of the specification.
3) if the ANDSF rules control the WLAN access selection and traffic routing as
described in subclause 6.10.2, if there are no WLAN(s selected in step 2), the
UE may repeat the procedure from step 1) taking into consideration selection
criteria with lower priority from the active WLANSP rule.
NOTE 3: UE implementation can optimize the steps described above, e.g. by
combining the ANQP procedures.
## 5.2 EPC network selection
### 5.2.1 General
The following EPC network selection procedures are defined:
1) WiMAX specific;
2) EPC network selection via cdma2000^®^ HRPD access is given in 3GPP TS
23.122 [4] with any exceptions detailed in subclause 5.3.4;
3) WLAN specific procedures in clause 5 apply: the procedures detail selecting
one or more WLANs and (subsequently) selecting one service provider offering
services via the WLAN. When authentication with the selected service provider
succeeds (see subclause 6.4 and 6.5), the UE follows the procedures defined
for connecting with the EPC. When the UE is connected to EPC through WLAN
access, the tunnel is set-up with the ePDG (as described in clause 7 of this
document) or with the HA (as described in 3GPP TS 24.303 [11]); and
4) generic EPC network selection for other access technologies not listed
above.
The UE can utilize information received from ANDSF to which EPCs an access
network is connected as described in 3GPP TS 24.312 [13]. Additionally, any
technology specific means can be employed to acquire such information, but
these are out of scope of this specification.
NOTE: There are no specific EPC network selection procedures specified for
emergency access in this version of the specification.
### 5.2.2 Generic EPC network selection procedure
#### 5.2.2.1 Identification of the EPC
The identification of EPC shall be based on one of the following:
\- PLMN-Id (i.e. pair of MCC+MNC), as specified in 3GPP TS 23.003 [3]; or
\- Home/Visited Network Realm/Domain, as specified in 3GPP TS 23.003 [3].
#### 5.2.2.2 Selection at switch-on or recovery from lack of coverage
##### 5.2.2.2.1 UE selection modes
Two modes of EPC network selection are defined, manual and automatic.
At switch-on or following recovery from lack of coverage, the UE shall select
the EPC network according to the selected operating mode.
##### 5.2.2.2.2 Manual EPC network selection
The UE shall present the list of available EPC networks, to which connectivity
is provided through the selected non-3GPP access network, to the user. If
UE\'s HPLMN or PLMNs equivalent to it are in this list, they shall be shown in
the highest ranking order. The ordering of the rest of entries in the list is
implementation dependent. If available, the UE should display names and/or
realms/domains.
If multiple equivalent HPLMNs are available, then the display order among them
is UE implementation specific.
##### 5.2.2.2.3 Automatic EPC network selection
The UE may use locally stored data for selecting between EPC networks
available for connectivity via the currently selected non-3GPP access network.
The UE shall select a PLMN according to the PLMN selection procedures of the
selected non-3GPP access network.
Additional criteria are out of scope of this specification and remain
implementation specific.
### 5.2.3 Access technology specific EPC network selection procedures
#### 5.2.3.1 EPC network selection procedures for WiMAX
##### 5.2.3.1.1 Identification of the EPC by the WiMAX access network
With WiMAX as a non-3GPP access network, the WiMAX NSP is mapped onto the EPC
network operator. The NSP indication can be provided to the UE in accordance
to WiMAX Forum Network Architecture Release 1.0 version 1.2 [25]. The WiMAX
access network should advertise the NSP identity of the EPC in the MCC, MNC
format.
##### 5.2.3.1.2 Selection at switch-on or recovery from lack of coverage
##### 5.2.3.1.2.1 UE selection modes {#ue-selection-modes-1 .H6}
There are two modes of network selection, namely, manual network selection and
automatic network selection.
At switch-on or following recovery from lack of coverage, the UE shall follow
one of the following two procedures depending on its operating mode.
##### 5.2.3.1.2.2 Manual EPC network selection {#manual-epc-network-
selection-1 .H6}
The manual network selection for WiMAX access shall follow the WiMAX Forum
Network Architecture Release 1.0 version 1.2 -- Stage 3 [25] with the
following exceptions and additions:
\- When presenting the list of available networks for user selection, the UE
shall provide the network name of the related MCC + MNC pair. If that is not
possible, the UE shall provide the MCC + MNC pair; and
\- If the UE is unable to register to the user selected NSP, further UE action
is implementation dependent.
##### 5.2.3.1.2.3 Automatic EPC network selection) {#automatic-epc-network-
selection-1 .H6}
The automatic network selection for WiMAX access shall follow the WiMAX Forum
Network Architecture Release 1.0 version 1.2 -- Stage 3 [25] without any
exceptions or additions.
#### 5.2.3.2 EPC network selection procedures for WLAN
##### 5.2.3.2.1 UE selection modes
There are two modes of service provider selection, namely, manual service
provider selection and automatic service provider selection.
At switch-on, the UE follows one of the following two procedures defined in
subclause 5.2.3.2.2 and 5.2.3.2.3 depending on its implementation.
The service provider selected in accordance with these procedures determines
the WLAN that is selected. When the selected WLAN is capable of S2a and the
S2a capable UE decides to use S2a, the UE shall derive a NAI from the identity
of the selected service provider and use the NAI as the identity for
authentication and authorization with the service provider and usage of the
WLAN (see subclause 6.4).
##### 5.2.3.2.1A Service provider solicitation
The UE shall determine which service providers are available from the
available list of WLANs as constructed using the WLAN selection procedure
described in subclause 5.1.3.2.3 using following procedures:
i) the UE selects a WLAN from the list of selected WLAN(s) constructed using
the WLAN selection procedure described in subclause 5.1.3.2.3;
ii) if the WLAN selected in step i):
a) supports ANQP specified in IEEE Std 802.11-2012 [57] and if the UE did not
obtain a list of realms using ANQP in subclause 5.1.3.2.3.3 item 1, the UE
sends an ANQP request for a list of realms (i.e. ANQP-elements \"NAI Realm\")
and/or PLMN identities (i.e. ANQP-element \"3GPP Cellular Network\"); and
NOTE 1: The UE uses procedures defined in IEEE Std 802.11-2012 [57] to
determine if the WLAN supports ANQP and to send the ANQP query request for
ANQP-elements \"NAI Realm\" and/or \"3GPP Cellular Network\", as specified in
IEEE Std 802.11-2012 [57].
b) does not support ANQP (see IEEE Std 802.11-2012 [57]) or the UE does not
receive a list of realms in item a), an EAP-Request/Identity is received and
the EAP-request/Identity does not include one or more of realms and/or PLMN
identities of service providers (encoded in accordance with IETF RFC 4284
[60]), the UE supports IEEE 802.1x authentication (see IEEE Std 802.1X™-2010
[61]), the UE shall request a list of realms and/or PLMN identities of service
providers interworking with that WLAN by sending the EAP-Response/Identity
message including as identity the alternative NAI; and
iii) the UE repeats this procedure for all WLANs from the available list of
WLANs as constructed using the WLAN selection procedure described in subclause
5.1.3.2.3.
NOTE 2: The list with realms and/or PLMN identities of service providers
received in accordance with procedures in IETF RFC 4284 [60], is of limited
size and might not contain all the realms and/or PLMN identities of service
providers available via the WLAN.
The UE shall convert any received PLMN identities into PLMN realms using the
rules defined in 3GPP TS 23.003 [3].
##### 5.2.3.2.2 Manual Service Provider selection mode procedure
The UE indicates to the user the service providers which are available for
WLAN. The UE may obtain the service providers available for WLAN using
procedures as described in subclause 5.2.3.2.1A. The UE will select the
service provider based on the user preference.
##### 5.2.3.2.3 Automatic mode service provider selection procedure
The purpose of this procedure is to:
\- select a service provider over WLAN; and
\- construct a NAI for use with authentication signalling with the selected
service provider in order for the UE to be authorised to use the WLAN.
If the RAN rules control the WLAN access selection and traffic routing as
described in subclause 6.10.2:
\- if the RPLMN or an equivalent PLMN (see 3GPP TS 24.301 [10] or 3GPP TS
24.008 [46]) is available as described in subclause 5.2.3.2.1A via a WLAN from
the selected WLAN(s) constructed using the WLAN selection procedure described
in subclause 5.1.3.2.3, the highest priority service provider is the RPLMN or
an equivalent PLMN (see 3GPP TS 24.301 [10] or 3GPP TS 24.008 [46]);
\- if the RPLMN and an equivalent PLMN (see 3GPP TS 24.301 [10] or 3GPP TS
24.008 [46]) are not available as described in subclause 5.2.3.2.1A via a WLAN
from the selected WLAN(s) constructed using the WLAN selection procedure
described in subclause 5.1.3.2.3 and Home PLMN or an EHPLMN is available, the
highest priority service provider is Home PLMN or an EHPLMN; and
\- if the RPLMN, an equivalent PLMN (see 3GPP TS 24.301 [10] or 3GPP TS 24.008
[46]), Home PLMN and an EHPLMN are not available as described in subclause
5.2.3.2.1A via a WLAN from the selected WLAN(s) constructed using the WLAN
selection procedure described in subclause 5.1.3.2.3, the highest priority
service provider is a PLMN selected in an implementation-dependent way.
If the ANDSF rules control the WLAN access selection and traffic routing as
described in subclause 6.10.2, a service provider is the highest priority
service provider if the service provider is available via a WLAN from the
selected WLAN(s) constructed using the WLAN selection procedure described in
subclause 5.1.3.2.3 and if:
i) the service provider is selected in item 3; or
ii) the conditions in item 3 are not met, and:
\- the service provider is the HPLMN;
\- the service provider is an equivalent home service provider (i.e. the
service provider\'s realm matches a realm in the EquivalentHomeSPs as
specified in 3GPP TS 24.312 [13]); or
\- no WLAN of the selected WLAN(s) provides access to a higher priority
service provider.
Until the highest priority service provider is found, the UE shall verify if a
service provider available over a WLAN of the selected WLAN(s) is the highest
priority service provider:
1) Void
2) Using the service providers which are available for WLAN as described in
subclause 5.2.3.2.1A, the UE uses the PLMN realms as the service provider
realms in the remaining steps of this subclause.
3) If the following conditions are fulfilled:
\- the \"3GPP RPLMN preferred\" indicator is configured to prioritize 3GPP
RPLMN; and
\- the realm of the RPLMN or the realm of an equivalent visited service
provider included in the EquivalentVisitedSPs as specified in 3GPP TS 24.312
[13] is included in the list of realms created in subclause 5.2.3.2.1A, step
ii);
then the UE shall select the RPLMN or the equivalent visited service provider.
The RPLMN shall be selected with higher priority than the equivalent visited
service provider. If the RPLMN is selected, the UE shall convert the RPLMN
identity into selected PLMN realm using the rules defined in 3GPP TS 23.003
[3] and use it as the service provider realms in the remaining steps of this
subclause.
4) if the condition in step 3) is not satisfied, the UE shall select a service
provider in the following order:
i) HPLMN matching a realm in the list of realms received in step ii) as
described in subclause 5.2.3.2.1A;
ii) realm found both in the list of realms received in step ii) as described
in subclause 5.2.3.2.1A and in the EquivalentHomeSPs as specified in 3GPP TS
24.312 [13]; and
iii) realm found both in the list of realms received in step ii) as described
in subclause 5.2.3.2.1A and in the PSPL as specified in 3GPP TS 24.312 [13]
with the priority higher than any other service provider\'s priority indicated
as available via the WLAN.
If a UE used the procedures in IETF RFC 4284 [60] (see subclause 5.2.3.2.1A)
to obtain a list of service providers, then the UE is only required to select
the HPLMN (if available) or an available equivalent home service provider.
NOTE 1: A UE using procedures in IETF RFC 4284 [60] to obtain a list of
service providers is only required to select the HPLMN (if available) or an
available equivalent home service provider. If the UE selects another service
provider, the UE could be roaming even though the HPLMN or equivalent home
service provider is available at the access point.
The UE shall select the WLAN providing access to the highest priority service
provider.
If a highest priority service provider could not be determined, the UE
proceeds in implementation-dependent way.
The UE shall construct a NAI for authentication with the highest priority
service provider as described in 3GPP TS 23.003 [3]. Specifically, the UE
constructs the:
a) root NAI corresponding to the HPLMN, if the highest priority service
provider is the HPLMN advertised using a PLMN identity;
b) decorated NAI with double decoration including the realm of the highest
priority service provider and the realm of the RPLMN, if the highest priority
service provider is an equivalent visited service provider; or
c) decorated NAI including the realm of the highest priority service provider,
otherwise.
NOTE 2: UE implementation can optimize the steps described above, e.g. by
combining the ANQP procedures described in subclause 5.2.3.2.1A with the ANQP
procedures in subclause 5.1.3.2.3.3.
## 5.3 Access Network reselection
### 5.3.1 General
The network reselection procedure shall be executed based on the user\'s
request or the operator\'s policy. Such operator policy for supporting network
reselection can be provided by the ANDSF or can be pre-provisioned in the UE.
### 5.3.2 UE procedures
The UE may retrieve information from ANDSF, which includes available access
network and operator\'s policy as specified in subclause 6.8.2.
The information which is retrieved from the ANDSF shall not impact the PLMN
selection and reselection procedures specified in 3GPP TS 23.122 [4]. For WLAN
access, the UE configured with a WLANSP rule specified in 3GPP TS 24.312 [13],
shall use the access network selection procedure and a PLMN selection
procedure defined in this document which are different from and shall not be
used in conjunction with the procedures for I-WLAN access specified in 3GPP TS
24.234 [9].
The network reselection procedure can be in automatic mode or manual mode
dependent on UE configuration settings. For WiMAX access, the manual mode
reselection shall follow the behaviour described in subclause 5.2.3.1.2.2 and
the automatic mode reselection shall follow the behaviour described in
subclause 5.2.3.1.2.3.
If the RAN rules control the WLAN access selection and traffic routing as
described in subclause 6.10.2, if the UE receives move-traffic-to-WLAN
indication, along with the list of the WLAN identifiers as described in
subclause 6.10.4, the UE shall perform the procedure in subclause 6.10.4.
### 5.3.3 EPC procedures
The ANDSF shall send available access network(s) and operator\'s policy to the
UE in response to the UE\'s request or based on the network triggers as
specified in subclause 6.8.2.
### 5.3.4 Periodic EPC network reselection attempts
In automatic mode, when UE is not in its HPLMN or one of its equivalent
HPLMNs, the UE shall make a periodic attempt to return to its HPLMN or one of
its equivalent HPLMNs. For this purpose the timer value given in the
EF~HPPLMN~ as defined in 3GPP TS 31.102 [45] shall be used with the following
exceptions:-
\- For UE accessing the EPC via cdma2000^®^ HRPD access networks, the UE\'s
search for a more preferred system shall abide by the parameters and
procedures defined in 3GPP2 C.S0016 [23a].
\- For UE accessing the EPC via WiMAX access networks, the time period between
periodic network searches is implementation specific.
\- For UE accessing the EPC via any other non-3GPP access networks, unless the
UE has availability to EF~HPPLMN~, the time period between periodic network
searches is implementation specific but shall not be less than 30 minutes.
# 5.4 Data traffic routing of IP flows
### 5.4.1 General
In regards to the routing of IP flows, 3GPP TS 23.402 [6] defines the
following UE capabilities: IFOM capability, inter-APN routing capability, NSWO
capability and MAPCON capability. Any of these capabilities can be enabled and
disabled via UE configuration means outside of the scope of this document. A
capability that exists and has not been disabled is considered as supported. A
capability that does not exist or the existing capability that has been
disabled is considered as not supported.
A UE can have several sets of information about access technologies or access
networks or both to assist in determining the data traffic routing of IP
flows. These sets of information are:
\- the Inter-APN Routing policies. The IARP can be statically provisioned in
the UE. Additionally, the IARP can be provided by the H-ANDSF. The UE shall
ignore the IARP received from the V-ANDSF;
\- the Inter-System Routing policies. The ISRP can be statically provisioned
in the UE or it can be provided by the H-ANDSF or the V-ANDSF or both;
\- the Local Operating Environment Information. The Local Operating
Environment Information can be optionally generated by the UE locally and the
contents of Local Operating Environment Information is implementation
dependant;
\- user preference settings;
\- the RAN assistance information (including OPI);
\- the measurements corresponding to the thresholds in the RAN assistance
information; and
\- indications received from access stratum as described in subclause 6.10.4.
This clause describes the relationship amongst these information sets and how
they are used in order to route data traffic of IP flows. The Local Operating
Environment Information does not apply to MAPCON rules in this version of the
specification.
### 5.4.2 Access technology or access network selection
#### 5.4.2.1 ANDSF rules control the WLAN access selection and traffic routing
This subclause applies if the ANDSF rules control the WLAN access selection
and traffic routing as described in subclause 6.10.2.
When selecting the access technologies or access networks or both to route the
data traffic of IP flows:
1) if a UE supporting IFOM or non-seamless WLAN offload is provided with user
preferences and has IARP rule for NSWO, ISRP or Local Operating Environment
Information or any combination of them, the user preference settings shall
take precedence over IARP rule for NSWO (if present), ISRP (if present) and
Local Operating Environment Information (if present).
2) if a UE supporting IFOM or non-seamless WLAN offload hasIARP rule for NSWO,
ISRP and Local Operating Environment Information and no user preference
settings and if based on the content of Local Operating Environment the UE
decides that an access technology or access network or both do not meet
implementation specific criteria for routing data traffic of a specific IP
flow, the UE may exclude that access technology or access network or both when
deciding on the routing of the data traffic for those IP flows.
3) if a UE supporting IFOM or non-seamless WLAN offload having Local Operating
Environment Information but no available ISRP, IARP rule for NSWO and no user
preference settings, the UE may evaluate the available access technologies or
access networks against the Local Operating Environment Information.
When a UE supporting MAPCON selects the access technologies or access networks
or both, to route the data traffic of a specific APN, the user preference
settings shall take precedence over ISRP (if present) and IARP rule (if
present).
The user preference settings shall take precedence over IARP (if present).
#### 5.4.2.2 RAN rules control the WLAN access selection and traffic routing
Access technology or access network selection procedures in subclause 6.10.4
apply if the RAN rules control the WLAN access selection and traffic routing
as described in subclause 6.10.2.
# 6 UE -- EPC Network protocols
## 6.1 General
## 6.2 Trusted and Untrusted Accesses
### 6.2.1 General
For a UE, the trust relationship of a non-3GPP IP access network is determined
by the home PLMN operator. That trust relationship is indicated to the UE via
the following methods:
\- Pre-configured policies in the UE by the home PLMN operator.
\- Dynamic indication during 3GPP-based access authentication.
**For a trusted non-3GPP IP access network, t** he UE shall follow the access
methods given in subclause 6.4. **For an untrusted non-3GPP IP access network,
the** UE shall follow the access methods given in subclause 6.5.
If the dynamic trust relationship indication is received during 3GPP-based
access authentication, the UE shall rely on the dynamic trust relationship
indication. Otherwise the UE shall follow the pre-configured policies for a
specific non-3GPP access network. If no dynamic indicator is received, and no
pre-configured policy matches a specific non-3GPP access network where the UE
attempts to access, the UE shall follow the procedure defined in subclause
6.2.4.
### 6.2.2 Pre-configured policies in the UE
The following types of policies can be pre-configured on the UE by the home
PLMN operator:
\- Pre-configured trust relationship policies for specific non-3GPP access
technologies and/or PLMNs. For example, the UE may be configured to use the
procedures for trusted access networks as described in subclause 6.4 as
follows:
\- an access network of access technology X1 from PLMN Y1 is trusted; and/or
\- any access network of access technology X2 is trusted; and/or
\- any access network from PLMN Y2 is trusted; and/or
\- any access network is trusted.
The format of the pre-configured policies is not specified in this release of
this specification.
### 6.2.3 Dynamic Indication
If the UE performs 3GPP-based access authentication, the 3GPP AAA server may
send a trust relationship indicator of the non-3GPP access network to the UE
during the EAP-AKA or EAP-AKA\' based access authentication (i.e. EAP-AKA,
EAP-AKA\') as specified in 3GPP TS 33.402 [15]. If non-3GPP access network is
trusted, the 3GPP AAA server shall send this trust relationship indicator as
specified in 3GPP TS 29.273 [17]. The indicator is sent using a AT_TRUST_IND
attribute, by extending the EAP-AKA (and EAP-AKA\') protocol as specified in
subclause 8.2 of IETF RFC 4187 [33]. This attribute is provided in EAP-
Request/AKA-Challenge or EAP- Request/AKA\'-Challenge message payload
respectively. The detailed coding of this attribute is described in subclause
8.2.3.1.
### 6.2.4 No trust relationship information
If no dynamic indicator is received, and no pre-configured policies matches a
specific non-3GPP access network where the UE attempts to access, the UE shall
consider it as untrusted network and operate based on subclause 6.5.
## 6.3 IP Mobility Mode Selection
### 6.3.1 General
The IP mobility mechanisms supported between 3GPP and non-3GPP accesses within
an operator and its roaming partner\'s network may be based on either:
a) Static Configuration; or
b) Dynamic Configuration.
The choice between a) and b) depends upon operators\' preferences or roaming
agreement or both.
### 6.3.2 Static configuration of inter-access mobility mechanism
For networks deploying a single IP mobility management mechanism, the
statically configured mobility mechanism can be access type or roaming
agreement specific or both. The information about the mechanism to be used in
such scenario is expected to be provisioned into the terminal and the network.
In static configuration, if there is a mismatch between the IP mobility mode
mechanism parameters pre-configured in the network and in the UE, the UE may
not be able to access the EPC. If the UE is able to access the EPC even if
there is a mismatch between the IP mobility mode mechanisms, the network may
not be able to provide session continuity for the UE. More details of the
possible cases of mismatch between the IP mobility mode mechanism are
described in the informative annex D.
If the network is configured with a static mobility mechanism and the AAA
server implements protocol extensions for a dynamic IP Mobility Mode Selection
(IPMS) exchange, the AAA server shall send to the UE an AT_RESULT_IND
attribute during the authentication procedure as it is described in subclause
6.3.3.1.2.
### 6.3.3 Dynamic configuration of inter-access mobility mechanism
#### 6.3.3.0 General
Dynamic IP Mobility Mode Selection (IPMS) consists of:
\- IP mobility management protocol selection between Network Based Mobility
(NBM), DSMIPv6 or MIPv4; and
\- Decision on IP address preservation if NBM is selected
Upon initial attachment to a non-3GPP access and upon handoff to non-3GPP
accesses, the UE performs IPMS by providing an indication during network
access authentication for EPC. For trusted access, the indication is provided
before an IP address is allocated to the UE, while in untrusted access
network, the indication is provided during IKEv2 signalling for IPSec tunnel
establishment with the ePDG.
When the UE provides an explicit indication for IPMS, then the network shall
provide the indication to the UE identifying the selected mobility management
mechanism.
When the dynamic IP mobility mode selection is used if the UE does not receive
any indication of a selected mobility protocol after the UE provided an
explicit indication, it is considered as an abnormal case and the UE may not
get connectivity to the EPC.
NOTE: The scenarios for mobility mode selection are described in subclause
4.1.3 of 3GPP TS 23.402 [6].
#### 6.3.3.1 IPMS indication
##### 6.3.3.1.1 IPMS indication from UE to 3GPP AAA server
During network access authentication, UE may provide an explicit indication to
the 3GPP AAA server about the supported mobility protocol by using an
attribute in the EAP-AKA and EAP-AKA\' protocols, to extend these protocols as
specified in subclause 8.2 of IETF RFC 4187 [33]. This attribute is provided
in EAP-Response/AKA-Challenge and corresponding EAP-AKA\' message payload.
The UE may provide the indication for IPMS using AT_IPMS_IND attribute in EAP-
AKA or EAP-AKA\' if the UE receives the AT_RESULT_IND attribute within the
EAP-Request/AKA-Challenge message, or the EAP-Request/AKA\'-Challenge message
(when EAP-AKA\' is used). If the UE provides the AT_IPMS_IND attribute within
the EAP-Response/AKA-Challenge message payload or within the EAP-
Response/AKA\'-Challenge message payload (when EAP-AKA\' is used), the UE
shall also provide the AT_RESULT_IND attribute within the message.
If the UE supports IPMS indication, it shall indicate support for one or more
mobility protocols in AT_IPMS_IND attribute as follows:
\- the UE shall indicate support for DSMIPv6 if the UE supports DSMIPv6; and
\- the UE shall indicate support for MIPv4 if the UE supports MIPv4; and
\- during initial attach, the UE should indicate support for NBM if the UE
supports address preservation based on NBM between the access it is attaching
to and all other accesses that the UE supports.; or
\- upon handover, the UE shall indicate support for NBM if the UE supports
address preservation based on NBM while moving from source access network to
target non-3GPP access network that the UE is attaching to.
NOTE: The UE can be configured not to use IPMS indication, e.g. the UE is
DSMIP capable only.
If the UE does not support any mobility protocol then the UE shall not send
the AT_IPMS_IND attribute to the 3GPP AAA server.
The preference of protocol may be indicated based on the policies configured
on the UE. The detailed coding of this attribute is described in subclause
8.2.1.1.
##### 6.3.3.1.2 IPMS indication from 3GPP AAA server to UE
A 3GPP AAA server supporting IPMS shall include the AT_RESULT_IND attribute
within the EAP-Request/AKA-Challenge and corresponding EAP-AKA\' message
payload.
If the UE provided an explicit indication as described in subclause 6.3.3, the
3GPP AAA server shall inform the UE of its decision on the mobility protocol
and IP preservation mode by invoking an EAP-Request/AKA-Notification dialogue
when EAP-AKA is used or an EAP-Request/AKA\'-Notification dialogue when EAP-
AKA\' is used.
On selecting the mobility protocol based on UE indication, access network
capabilities and network policies, the 3GPP AAA server shall indicate the
selected protocol to the UE by using the AT_IPMS_RES attribute. If the 3GPP
AAA server does not receive any indication from the UE but knows the UE\'s
policies allow the usage of NBM and knows the home and access network supports
NBM, the network shall use NBM shall be used for providing connectivity to the
UE.
If the AT_IPMS_RES attribute indicates DSMIPv6 then the UE shall follow the
procedures defined in 3GPP TS 24.303 [11].
If the AT_IPMS_RES attribute indicates MIPv4 support, then the UE shall follow
the procedures defined in 3GPP TS 24.304 [12].
The detailed coding of this attribute is described in subclause 8.2.1.2.
## 6.4 Authentication and authorization for accessing EPC via a trusted
non-3GPP access network
### 6.4.1 General
For access to the EPC via a trusted non-3GPP access network, a connection
shall be established between the UE and the trusted non-3GPP access network
using signalling procedures specific to the trusted non-3GPP access network,
which are out of scope of this present document.
Access authentication signalling for access to the EPC shall be executed
between the UE and 3GPP AAA server to ensure mutual authentication of the user
and the EPC, with the exception of UEs without IMSI (see subclauses 4.4.1 and
6.6.3.2). Such authentication is based on IETF protocols as specified in 3GPP
TS 33.402 [15].
EAP-AKA\' is used for access authentication in the trusted access network,
according to 3GPP TS 33.402 [15], subclause 6.2. According to 3GPP TS 33.402
[15], subclause 6.1, EAP-AKA\' can be skipped if conditions listed in
subclause 9.2.2.1 of 3GPP TS 33.402 [15] are met.
If the access network does not support EAP-AKA or EAP-AKA\' and the UE
considers the access network as trusted, the UE shall access to the EPC only
via S2c and any authentication method (EAP-based or otherwise) can be used for
access authentication as long as the criteria set in 3GPP TS 33.402 [15],
subclause 9.2.2.1 are met.
During S2c bootstrapping EAP-AKA authentication is performed between the UE
and the PDN-GW as specified in 3GPP TS 24.303 [11] and 3GPP TS 33.402 [15].
### 6.4.1A TWAN connection modes
As part of EAP-AKA\' authentication via TWAN, the UE and the network can
negotiate usage of either the single-connection mode (SCM) or the multi-
connection mode (MCM) as described in 3GPP TS 23.402 [6].
NOTE: UE requesting neither SCM nor MCM acts in transparent single-connection
mode (TSCM). No UE extensions are needed for TSCM.
The negotiation consists of the following steps:
a) The 3GPP AAA server indicates support of TSCM, SCM, MCM or any combination
of them as described in subclause 6.4.3.5.
b) The UE requests usage of SCM or MCM as described in subclause 6.4.2.6.2 and
subclause 6.4.2.6.3, acts in TSCM or aborts the EAP authentication as
described in subclause 6.4.2.6.4.
c) The 3GPP AAA server either accepts or rejects the UE request as described
in subclause 6.4.3.5.
### 6.4.2 UE procedures
#### 6.4.2.1 Identity Management
The user identities to be used by the UE in the authentication and
authorization for accessing EPC via a trusted non-3GPP access are the Root-NAI
(permanent identity), decorated NAI, Fast-Reauthentication NAI (Fast-
Reauthentication Identity) and Pseudonym Identity and these identities are
described in subclause 4.4.
#### 6.4.2.2 EAP-AKA and EAP-AKA\' based Authentication
The UE shall support EAP-AKA based authentication as specified in IETF RFC
4187 [33] and EAP-AKA\' based authentication as specified in _IETF RFC 5448_
_[38]._ 3GPP TS 33.402 [15] specifies the conditions under which one or the
other of these two methods is used.
During network access authentication, the UE may provide an explicit
indication for IPMS by adding an attribute in the EAP-AKA or EAP-AKA\' payload
as defined in subclause 6.3.3.
During network access authentication, the 3GPP AAA server may provide the ANID
to the UE, see subclause 6.4.2.4.
#### 6.4.2.3 Full Authentication and Fast Re-authentication
The UE shall support both full authentication and fast re-authentication for
EAP AKA as specified in IETF RFC 4187 [33] and for EAP-AKA\' as specified in
_IETF RFC 5448_  _[38]_.
Full authentication is performed to generate new keys. The initial
authentication shall be a full authentication as specified in 3GPP TS 33.402
[15]. For a full authentication either the Permanent Identity or the Pseudonym
Identity is used.
According to 3GPP TS 33.402 [15] the fast re-authentication procedure uses the
Fast Re-authentication Identity and is used for renewing the session keys.
The Permanent Identity is based on the IMSI of the UE. The Fast Re-
authentication Identity is provided to the UE by the 3GPP AAA server during
the previous authentication procedure. The UE shall use the Fast Re-
authentication Identity only once. A Pseudonym Identity provided to the UE by
the 3GPP AAA Server during a previous authentication procedure can be reused
in later authentications until the UE receives a new Pseudonym identity from
the 3GPP AAA Server.
NOTE: The 3GPP AAA Server will assign a new Pseudonym Identity with a
frequency dictated by operator\'s policy. The allocation of new pseudonyms is
required to prevent that the user\'s movements are tracked by an unauthorized
party.
If during an authentication request, the UE receives an EAP-Request/AKA-
Identity message containing AT_PERMANENT_ID_REQ, the UE shall return the
Permanent Identity in the AT_IDENTITY attribute of the EAP-
Response/AKA_Identity. If the UE receives an EAP-Request/AKA\'-Identity
message containing AT_PERMANENT_ID_REQ, the UE shall return the Permanent
Identity in the AT_IDENTITY attribute of the EAP- Response /AKA\'-Identity
message.
If during an authentication request, the UE receives an EAP-Request/AKA-
Identity message which contains AT_FULLAUTH_ID_REQ, the UE shall return the
Pseudonym Identity as the AT_IDENTITY within EAP-Response/AKA_Identity message
if available. If the UE receives an EAP-Request/AKA\'-Identity message
containing AT_FULLAUTH_ID_REQ, the UE shall return the Pseudonym Identity as
the AT_IDENTITY within the EAP- Response /AKA\'-Identity message if available.
Otherwise the UE shall return the Permanent Identity.
If during an authentication request, the UE receives an EAP-Request/AKA-
Identity message or EAP-Request/AKA\'-Identity message respectively, which
contains AT_ANY_ID_REQ, the UE shall return the Fast Re-authentication
Identity if available as the AT_IDENTITY. Otherwise the UE shall return the
Pseudonym Identity.
#### 6.4.2.4 Handling of the Access Network Identity
##### 6.4.2.4.1 General
The 3GPP AAA server provides the UE with the ANID in EAP signalling. The UE
can also obtain the ANID by access network specific means, which are out of
scope of the present document. For some access networks the ANID can also be
configured into the UE and the 3GPP AAA server.
NOTE: According to 3GPP TS 33.402 [15], the ANID is used by HSS and UE to
generate transformed authentication vectors and therefore the ANID needs to be
identical in the HSS and in the UE. The trusted non-3GPP access network first
sends the ANID to the 3GPP AAA server via the STa reference point and the 3GPP
AAA server sends the ANID to HSS via the SWx reference point, see 3GPP TS
29.273 [17], and to the UE as specified in this specification.
##### 6.4.2.4.2 ANID indication from 3GPP AAA server to UE
When the 3GPP AAA server sends an EAP Request\' or AKA-Challenge\' message to
the UE, the 3GPP AAA server shall include the ANID to be used when generating
transformed authentication vectors, using the AT_KDF_INPUT attribute as
described in subclause 8.2.2. The value and coding of this attribute is
described in subclause 8.1.1.
##### 6.4.2.4.3 UE check of ANID for HRPD CDMA 2000® access networks
The UE shall apply the rules for comparison of the locally determined ANID and
the one received over EAP-AKA\' as specified in _IETF RFC 5448_ [38]. The UE,
or the user, may use the ANID as a basis for an optional decision whether the
access network is authorized to serve the UE. E.g. the UE may compare the ANID
against a list of preferred or barred ANIDs.
When the UE can locally determine based on physical layer or access network
procedures that the UE is connected to a eHRPD network, the locally determined
ANID is \"HRPD\". If the comparison check is successful and if either the
optional access network authorization decision in the UE is positive or is not
performed, the UE shall proceed; otherwise the UE shall abort the access
procedure.
##### 6.4.2.4.4 UE check of ANID for WiMAX access networks
The UE shall apply the rules for comparison of the locally determined ANID and
the one received over EAP-AKA\' as specified in _IETF RFC 5448_ [38]. The UE,
or the user, may use the ANID as a basis for an optional decision whether the
access network is authorized to serve the UE. E.g. the UE may compare the ANID
against a list of preferred or barred ANIDs.
When the UE can locally determine based on physical layer or access network
procedures that the UE is connected to a WiMAX access network, the locally
determined ANID is \"WIMAX\". If the comparison check is successful and if
either the optional access network authorization decision in the UE is
positive or is not performed, the UE shall proceed; otherwise the UE shall
abort the access procedure.
##### 6.4.2.4.5 UE check of ANID for WLAN access networks
The UE shall apply the rules for comparison of the locally determined ANID and
the one received over EAP-AKA\' as specified in _IETF RFC 5448_ [38]. The UE,
or the user, may use the ANID as a basis for an optional decision whether the
access network is authorized to serve the UE. E.g. the UE may compare the ANID
against a list of preferred or barred ANIDs.
When the UE can locally determine based on physical layer or access network
procedures that the UE is connected to a WLAN network, the locally determined
ANID is \"WLAN\". If the comparison check is successful and if either the
optional access network authorization decision in the UE is positive or is not
performed, the UE shall proceed; otherwise the UE shall abort the access
procedure.
##### 6.4.2.4.6 UE check of ANID for ETHERNET access networks
The UE shall apply the rules for comparison of the locally determined ANID and
the one received over EAP-AKA\' as specified in _IETF RFC 5448_ [38]. The UE,
or the user, may use the ANID as a basis for an optional decision whether the
access network is authorized to serve the UE. E.g. the UE may compare the ANID
against a list of preferred or barred ANIDs.
When the UE can locally determine based on physical layer or access network
procedures that the UE is connected to a Ethernet network, the locally
determined ANID is \"ETHERNET\". If the comparison check is successful and if
either the optional access network authorization decision in the UE is
positive or is not performed, the UE shall proceed; otherwise the UE shall
abort the access procedure.
#### 6.4.2.5 Full name for network and short name for network
When receiving the EAP-Request/AKA-Challenge message when the EAP-AKA is used
or the EAP-Request/AKA\'-Challenge message when the EAP-AKA\' is used, and the
AT_FULL_NAME_FOR_NETWORK attribute, the AT_SHORT_NAME_FOR_NETWORK attribute or
both are included, then the UE may use the contents to update appropriate
information stored within the UE.
#### 6.4.2.6 TWAN connection modes
##### 6.4.2.6.1 General
The UE may support SCM. The UE may support MCM.
NOTE 1: The UE is allowed to support both MCM and SCM. The UE is allowed to
support neither MCM nor SCM.
NOTE 2: No UE extensions are needed for TSCM.
##### 6.4.2.6.2 Usage of single-connection mode (SCM)
If:
a) the UE supports the SCM;
b) the EAP-Request/AKA\'-Challenge message includes the AT_TWAN_CONN_MODE
attribute as described in subclause 8.2.7.1 wherein the message field as
described in subclause 8.1.4.1:
1) contains the message type field indicating CONNECTION_CAPABILITY; and
2) contains the item list field including the CONNECTION_MODE_CAPABILITY item
as described in subclause 8.1.4.8 indicating support of SCM; and
c) the UE requests usage of the SCM;
then the UE:
a) shall include the AT_TWAN_CONN_MODE attribute according to subclause
8.2.7.1 in the EAP-Response/AKA\'-Challenge message. In the message field
according to subclause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute, the UE
shall:
1) set the message type field to SCM_REQUEST; and
2) in the item list field:
A) include a CONNECTIVITY_TYPE item according to subclause 8.1.4.3 indicating
the requested connectivity type - PDN connection, or NSWO; and
B) if a PDN connection is requested:
i) include a ATTACHMENT_TYPE item according to subclause 8.1.4.4 indicating
whether an initial attach or a handover attach is requested;
ii) if a PDN connection for an APN other than the default APN is requested,
include an APN item according to subclause 8.1.4.5 indicating the requested
APN;
iii) if initial attach is requested, include a PDN_TYPE item according to
subclause 8.1.4.6 indicating the requested PDN type;
iv) if handover attach is requested, include a PDN_TYPE item according to
subclause 8.1.4.6 indicating the PDN type supported in the PDN connection to
be handed over; and
v) if the UE wishes to transmit (protocol) data (e.g. configuration
parameters, error codes or messages/events) to the network, include a
PROTOCOL_CONFIGURATION_OPTIONS item according to subclause 8.1.4.9; and
b) if a PDN connection is requested, shall include the AT_RESULT_IND attribute
in the EAP-Response/AKA\'-Challenge message.
NOTE: If the UE does not include the AT_RESULT_IND attribute in the EAP-
Response/AKA\'-Challenge message, in case of successful authentication, then
EAP-Request/AKA\'-Notification message is not received and the UE is only
informed about success using EAP-Success.
Upon receiving the EAP-Request/AKA\'-Notification message including the
AT_TWAN_CONN_MODE attribute as described in subclause 8.2.7.1 wherein the
message field as described in subclause 8.1.4.1:
\- contains the message type field indicating SCM_RESPONSE; and
\- contains the item list field;
the UE:
a) if the AT_NOTIFICATION attribute indicates success, shall determine the
authorized connectivity type in the CONNECTIVITY_TYPE item as described in
subclause 8.1.4.3 included in the item list field. If the authorized
connectivity type is PDN connection, the UE:
1) shall determine the selected APN in the APN item as described in subclause
8.1.4.5 included in the item list field;
2) shall determine the PDN type supported in the PDN connection in the
PDN_TYPE item as described in subclause 8.1.4.6 included in the item list
field;
3) if a PROTOCOL_CONFIGURATION_OPTIONS item as described in subclause 8.1.4.9
is included in the item list field, shall determine the protocol configuration
options in the PROTOCOL_CONFIGURATION_OPTIONS item;
4) if a IPV4_ADDRESS item as described in subclause 8.1.4.11 is included in
the item list field, shall determine the IPv4 address allocated to the UE for
the PDN connection in the IPV4_ADDRESS item;
5) if a IPV6_INTERFACE_IDENTIFIER item as described in subclause 8.1.4.12 is
included in the item list field, shall determine the IPv6 interface identifier
allocated to the UE for the PDN connection in the IPV6_INTERFACE_IDENTIFIER
item and shall use it when building the IPv6 link local address; and
6) shall determine the TWAG user plane MAC address in the TWAG_UP_MAC_ADDRESS
item as described in subclause 8.1.4.14 included in the item list field, and
shall use the TWAG user plane MAC address for encapsulating user plane packets
according to 3GPP TS 23.402 [6]; and
b) if the AT_NOTIFICATION attribute indicates failure:
1) shall determine the cause of failure in the CAUSE item as described in
subclause 8.1.4.10 included the item list field;
2) if the cause of failure is #26 \"Insufficient resources\" and the Tw1 item
is included in the item list field, shall take different actions depending on
the timer value received in the Tw1 item as follows:
i) if the timer value indicates neither zero nor deactivated, shall stop timer
Tw1 associated with the corresponding APN, if it is running. The UE shall
start timer Tw1 (see 3GPP TS 24.244 [56]) with the value provided in the Tw1
value IE and not send another SCM_REQUEST message with the CONNECTIVITY_TYPE
item indicating PDN connection and with APN item indicating the same APN until
timer Tw1 expires, the timer Tw1 is stopped or the USIM is removed;
ii) if the timer value indicates that this timer is deactivated, shall not
send another SCM_REQUEST message with the CONNECTIVITY_TYPE item indicating
PDN connection and with APN item indicating the same APN until the UE is
switched off or the USIM is removed;
iii) if the timer value indicates zero, may send another SCM_REQUEST message
with the CONNECTIVITY_TYPE item indicating PDN connection and with APN item
indicating the same APN; and
iv) if the UE is switched off when the timer Tw1 is running and if the USIM in
the UE remains the same when the UE is switched on, shall behave as follows
when the UE is switched on:
\- let t1 be the time remaining for Tw1 timeout at switch off and let t be the
time elapsed between switch off and switch on. If t1 is greater than t, then
the timer shall be restarted with the value t1 -- t. If t1 is equal to or less
than t, then the timer need not be restarted. If the UE is not capable of
determining t, then the UE shall restart the timer with the value t1; and
3) if the cause of failure is #26 \"Insufficient resources\" and the Tw1 item
is not included in the item list field, may send a SCM_REQUEST message with
the CONNECTIVITY_TYPE item indicating PDN connection and with APN item
indicating the same APN.
##### 6.4.2.6.3 Usage of multi-connection mode (MCM)
If:
a) the UE supports the MCM;
b) the EAP-Request/AKA\'-Challenge message includes the AT_TWAN_CONN_MODE
attribute as described in subclause 8.2.7.1 wherein the message field as
described in subclause 8.1.4.1:
1) contains the message type field indicating CONNECTION_CAPABILITY; and
2) contains the item list field:
A) including the CONNECTION_MODE_CAPABILITY item as described in subclause
8.1.4.8 indicating support of MCM; and
B) including the SUPPORTED_WLCP_TRANSPORTS item as described in subclause
8.1.4.15;
c) at least one WLCP transport indicated as supported in the
SUPPORTED_WLCP_TRANSPORTS item is also supported by the UE; and
d) the UE requests usage of the MCM;
then the UE:
a) shall include the AT_TWAN_CONN_MODE attribute according to subclause
8.2.7.1 in the EAP-Response/AKA\'-Challenge message. In the message field
according to subclause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute, the UE
shall set the message type field to MCM_REQUEST; and
b) shall include the AT_RESULT_IND attribute in the EAP-
Response/AKA\'-Challenge message.
Upon receiving the EAP-Request/AKA\'-Notification message including the
AT_TWAN_CONN_MODE attribute as described in subclause 8.2.7.1 where the
message field as described in subclause 8.1.4.1:
\- contains the message type field indicating MCM_RESPONSE; and
\- contains the item list field;
the UE:
a) if the AT_NOTIFICATION attribute indicates success:
1) shall determine the NSWO authorization in the AUTHORIZATIONS item as
described in subclause 8.1.4.7 included in the item list field;
2) shall determine the TWAG control plane address(es) in the TWAG_CP_ADDRESS
item as described in subclause 8.1.4.13 included in the item list field; and
3) shall derive the WLCP key as described in Annex A.3 in 3GPP TS 33.402 [15];
and
NOTE: After receiving EAP Success message terminating the EAP procedures after
successful authentication and authorization for MCM access to EPC, the UE
establishes a DTLS connection with the TWAG and initiates WLCP procedures
according to 3GPP TS 24.244 [56].
b) if the AT_NOTIFICATION attribute indicates failure, shall determine the
cause of failure in the CAUSE item as described in subclause 8.1.4.10 included
in the item list field.
##### 6.4.2.6.4 Network support not available
If the EAP-Request/AKA\'-Challenge message does not include the
AT_TWAN_CONN_MODE attribute as described in subclause 8.2.7.1, then only TSCM
is available.
If the UE supports SCM, the UE does not support MCM, and the EAP-
Request/AKA\'-Challenge message includes the AT_TWAN_CONN_MODE attribute as
described in subclause 8.2.7.1 wherein the message field as described in
subclause 8.1.4.1:
1) contains the message type field indicating CONNECTION_CAPABILITY; and
2) contains the item list field including the CONNECTION_MODE_CAPABILITY item
as described in subclause 8.1.4.8 not indicating support of SCM;
then only TSCM is available.
If the UE does not support SCM, the UE supports MCM, and the EAP-
Request/AKA\'-Challenge message includes the AT_TWAN_CONN_MODE attribute as
described in subclause 8.2.7.1 wherein the message field as described in
subclause 8.1.4.1:
1) contains the message type field indicating CONNECTION_CAPABILITY; and
2) contains the item list field including the CONNECTION_MODE_CAPABILITY item
as described in subclause 8.1.4.8 not indicating support of MCM;
then only TSCM is available.
If the UE does not support SCM, the UE supports MCM, the EAP-
Request/AKA\'-Challenge message includes the AT_TWAN_CONN_MODE attribute as
described in subclause 8.2.7.1 wherein the message field as described in
subclause 8.1.4.1:
1) contains the message type field indicating CONNECTION_CAPABILITY; and
2) contains the item list field:
A) including the CONNECTION_MODE_CAPABILITY item as described in subclause
8.1.4.8 indicating support of MCM; and
B) including the SUPPORTED_WLCP_TRANSPORTS item as described in subclause
8.1.4.15;
and none of the WLCP transport indicated as supported in the
SUPPORTED_WLCP_TRANSPORTS item is also supported by the UE, then only TSCM is
available.
If only TSCM is available:
a) if the UE is willing to use TSCM, the UE shall act as in TSCM; and
b) if the UE is unwilling to use TSCM, the UE shall send EAP-
Response/AKA\'-Client-Error message.
NOTE: In TSCM, successful EAP-AKA\' authentication triggers creation of a PDN
connection to the default APN. The UE can be unwilling to use the PDN
connection to the default APN e.g. because the UE needs to perform handover of
a PDN connection, because the UE needs to establish a PDN connection to an APN
other than the default APN, because the UE needs to establish multiple PDN
connections, or because the UE has no usage for the PDN connection to the
default APN and wants to avoid any possible charges related to the PDN
connection to the default APN.
### 6.4.3 3GPP AAA server procedures
#### 6.4.3.1 Identity Management
The 3GPP AAA selects the pseudonym identity or the Fast Re-authentication
Identity and returns the identity to the UE during the Authentication
procedure as specified in 3GPP TS 33.402 [15]. The 3GPP AAA server shall
maintain a mapping between the UE\'s permanent identity and the pseudonym
identity and between the UE\'s permanent identity and the Fast Re-
authentication Identity.
#### 6.4.3.2 EAP-AKA and EAP-AKA\' based Authentication
The 3GPP AAA server shall support EAP AKA based authentication as specified in
IETF RFC 4187 [33] and EAP-AKA\' based authentication as specified in _IETF
RFC 5448_  _[38]._ 3GPP TS 33.402 [15] specifies the conditions under which
one or the other of these two methods is used. If the UE provides an explicit
indication for the supported mobility protocols and the network supports
multiple IP mobility mechanisms, the network shall select the protocol to be
used and communicate the decision to the UE as defined in subclause 6.3.3.1.2.
#### 6.4.3.3 Full authentication and Fast Re-authentication
The 3GPP AAA shall support full re-authentication and fast re-authentication
as specified in IETF RFC 4187 [33].
The decision to use the fast re-authentication process is taken by the home
network (i.e. the 3GPP AAA server) and is based on operator policies. If fast
re-authentication is to be used, the home network shall indicate this to the
UE by providing the Fast Re-authentication Identity to the UE during the
authentication process.
When initiating an authentication, the home network shall indicate the type of
authentication required by including either AT_PERMANENT_ID_REQ or
AT_FULLAUTH_ID_REQ for Full authentication and AT_ANY_ID_REQ for Fast re-
authentication in the EAP-Request/AKA_Identity message or the EAP-
Request/AKA\'-Identity message respectively.
The home network (i.e. the 3GPP AAA server) may upon receiving the Fast Re-
authentication Identity in AT_IDENTITY, decide to proceed with the fast re-
authentication or choose instead to initiate a full authentication. This
decision is based on operator policies.
#### 6.4.3.4 Full name for network and short name for network
The 3GPP AAA server may include the AT_FULL_NAME_FOR_NETWORK attribute, the
AT_SHORT_NAME_FOR_NETWORK attribute or both in the EAP-Request/AKA-Challenge
message when the EAP-AKA is used and in the EAP-Request/AKA\'-Challenge
message when the EAP-AKA\' is used.
The detailed coding of the AT_FULL_NAME_FOR_NETWORK attribute and the
AT_SHORT_NAME_FOR_NETWORK is described in subclause 8.2.5.
#### 6.4.3.5 TWAN connection modes
##### 6.4.3.5.1 General
The 3GPP AAA server may support the single-connection mode (SCM).
The 3GPP AAA server may support the multi-connection mode (MCM).
If the network supports SCM, MCM or both, the 3GPP AAA server shall include
the AT_TWAN_CONN_MODE attribute according to subclause 8.2.7.1 and the
AT_RESULT_IND attribute in the EAP-Request/AKA\'-Challenge message. In the
message field according to subclause 8.1.4.1 of the AT_TWAN_CONN_MODE
attribute, the 3GPP AAA server shall:
a) set the message type field to CONNECTION_CAPABILITY; and
b) in the item list field:
1) include a CONNECTION_MODE_CAPABILITY item according to subclause 8.1.4.8
indicating whether the network supports TSCM, SCM, MCM or any combination of
them; and
2) if the network supports MCM, include a SUPPORTED_WLCP_TRANSPORTS item
according to subclause 8.1.4.15 indicating WLCP transport(s) supported by the
TWAG.
##### 6.4.3.5.2 Usage of single-connection mode (SCM)
If
\- the 3GPP AAA server supports SCM;
\- the EAP-Response/AKA\'-Challenge message includes the AT_TWAN_CONN_MODE
attribute as described in subclause 8.2.7.1 wherein the message field as
described in subclause 8.1.4.1 contains the message type field indicating
SCM_REQUEST; and
\- the authentication was successful;
then the 3GPP AAA server triggers the TWAN to establish the connectivity of
the requested connectivity type according to 3GPP TS 23.402 [6].
If:
\- the 3GPP AAA server authorizes the requested connectivity; and
\- the EAP-Response/AKA\'-Challenge message includes the AT_RESULT_IND
attribute;
then the 3GPP AAA server shall invoke an EAP-Request/AKA\'-Notification
dialogue. The 3GPP AAA server shall construct the EAP-
Request/AKA\'-Notification message as follows:
a) indicate success in the AT_NOTIFICATION attribute; and
b) include the AT_TWAN_CONN_MODE attribute described in subclause 8.2.7.1. In
the message field according to subclause 8.1.4.1 of the AT_TWAN_CONN_MODE
attribute, the 3GPP AAA server shall:
1) set the message type field to SCM_RESPONSE; and
2) in the item list field:
A) include a CONNECTIVITY_TYPE item as described in subclause 8.1.4.3
indicating the authorized connectivity type. Only one connectivity type is
indicated; and
B) if a PDN connection was authorized:
i) include an APN item according to subclause 8.1.4.5 indicating the APN of
the authorized PDN connection;
ii) include a PDN_TYPE item according to subclause 8.1.4.6 indicating the PDN
type(s) selected in the authorized PDN connection;
iii) if the 3GPP AAA server wishes to transmit (protocol) data (e.g.
configuration parameters, error codes or messages/events) to the UE, include a
PROTOCOL_CONFIGURATION_OPTIONS item according to subclause 8.1.4.9;
iv) if an IPv4 address is allocated to the UE for the PDN connection, include
a IPV4_ADDRESS item according to subclause 8.1.4.11;
v) if an IPv6 interface identifier is allocated to the UE for the PDN
connection, include a IPV6_INTERFACE_IDENTIFIER item according to subclause
8.1.4.12; and
vi) include a TWAG_UP_MAC_ADDRESS item according to subclause 8.1.4.14.
If the 3GPP AAA server does not authorize the requested connectivity, then the
3GPP AAA server shall invoke an EAP-Request/AKA\'-Notification dialogue. The
3GPP AAA server shall construct the EAP-Request/AKA\'-Notification message as
follows:
a) indicate failure in the AT_NOTIFICATION attribute; and
b) include the AT_TWAN_CONN_MODE attribute described in subclause 8.2.7.1. In
the message field according to subclause 8.1.4.1 of the AT_TWAN_CONN_MODE
attribute, the 3GPP AAA server shall:
1) set the message type field to SCM_RESPONSE;
2) in the item list field, include a CAUSE item according to subclause
8.1.4.10 indicating the cause of failure; and
3) if the cause of failure is #26 \"Insufficient resources\" and a value of
backoff timer is to be provided to the UE for the PDN connection, include a
Tw1 item according to subclause 8.1.4.16.
##### 6.4.3.5.3 Usage of multi-connection mode (MCM)
If:
a) the 3GPP AAA server supports MCM;
b) if the EAP-Response/AKA\'-Challenge message includes:
1) the AT_TWAN_CONN_MODE attribute as described in subclause 8.2.7.1 wherein
the message field as described in subclause 8.1.4.1 contains the message type
field indicating MCM_REQUEST; and
2) the AT_RESULT_IND attribute;
c) the 3GPP AAA server authorizes the request; and
d) the authentication was successful;
then the 3GPP AAA server shall invoke an EAP-Request/AKA\'-Notification
dialogue. The 3GPP AAA server shall construct the EAP-
Request/AKA\'-Notification message as follows:
a) indicate success in the AT_NOTIFICATION attribute; and
b) include the AT_TWAN_CONN_MODE attribute according to subclause 8.2.7.1. In
the message field according to subclause 8.1.4.1 of the AT_TWAN_CONN_MODE
attribute, the 3GPP AAA server shall:
1) set the message type field to MCM_RESPONSE; and
2) in the item list field:
A) include an AUTHORIZATIONS item according to subclause 8.1.4.7 indicating
whether UE is authorized to use NSWO; and
B) include a TWAG_CP_ADDRESS item according to subclause 8.1.4.13 indicating
the TWAG control plane address.
If the 3GPP AAA server does not authorize the request, then the 3GPP AAA
server shall invoke an EAP-Request/AKA\'-Notification dialogue. The 3GPP AAA
server shall construct the EAP-Request/AKA\'-Notification message as follows:
a) indicate failure in the AT_NOTIFICATION attribute; and
b) include the AT_TWAN_CONN_MODE attribute described in subclause 8.2.7.1. In
the message field according to subclause 8.1.4.1 of the AT_TWAN_CONN_MODE
attribute, the 3GPP AAA server shall:
1) set the message type field to MCM_RESPONSE; and
2) in the item list field, include a CAUSE item according to subclause
8.1.4.10 indicating the cause of failure.
##### 6.4.3.5.4 Network support not available
NOTE: If the network does not support a TWAN connection mode and the UE needs
to request usage of the not supported TWAN connection mode, upon sending EAP-
Request/AKA\'-Challenge message, the network receives EAP-
Response/AKA\'-Client-Error message. Handling defined in _IETF RFC 5448_
_[38]_ applies for the EAP-Response/AKA\'-Client-Error message.
### 6.4.4 Multiple PDN support for trusted non-3GPP access
Connectivity to multiple PDNs via trusted non-3GPP access is supported in the
EPS when the network policies, the non-3GPP access and the user subscription
allow it.
NOTE 1: In 3GPP, there is a limitation to the maximum number of simultaneous
PDN connections per UE which is 11 (caused by the EPS bearer identity, see
3GPP TS 24.007 [48]). Not complying with this limitation when accessing
non-3GPP access can lead to unexpected consequences, e.g. connectivity loss in
case of handover to 3GPP access.
If the UE supports dynamic mobility management selection the UE shall use the
same mobility protocol when multiple connections are established, see 3GPP TS
23.402 [6].
When using the S2a interface to establish connections to additional PDNs the
UE shall send a trigger for additional PDN connectivity specific to the
non-3GPP access. The UE shall include an APN in this trigger to connect to the
desired PDN. The UE shall also indicate the Attach Type to the trusted
non-3GPP access during additional PDN connectivity. The Attach Type shall
distinguish between Initial Attach and Handover Attach. For the multi-
connection mode used via trusted WLAN access network, the PDN connection
establishment procedures are specified in 3GPP TS 24.244 [56].
NOTE 2: The indication about Attach Type is non-3GPP access network specific
and its coding is out of scope of this specification.
NOTE 3: The trigger for additional PDN connectivity is non-3GPP access network
specific and its coding is out of scope of this specification.
When using the S2c interface, the UE shall follow the procedures described in
3GPP TS 24.303 [11] to connect to multiple PDNs.
If the UE is handing over from a source access network to a target non-3GPP
access using S2a and the UE has more than one PDN connection to a given APN in
the source access network, the UE shall transfer all the PDN connections for
the given APN to the target trusted non-3GPP access network as specified in
3GPP TS 23.402 [6].
If multiple PDN connections to a single APN are not supported over the target
trusted non-3GPP access network, only one PDN connection to the given APN
shall be established in the target non-3GPP access as specified in 3GPP TS
23.402 [6]. If multiple PDN connection requests to the same APN are received
but the target trusted non-3GPP access network does not support multiple PDN
connections to the same APN, the network shall reject the additional PDN
connection requests to the same APN received from the UE when one PDN
connection to the same APN has already been established. The UE shall
determine which PDN connection is re-established in the non-3GPP access based
on the home address information (i.e. IPv4 address or IPv6 prefix or both)
provided by the network.
NOTE 4: The protocol details of the PDN connection reject procedure is
non-3GPP access network specific and its coding is outside the scope of this
specification. For the multi-connection mode used via trusted WLAN access
network, the protocol details of the PDN connection reject procedure is
specified in 3GPP TS 24.244 [56]
NOTE 5: When UE supporting IP address preservation for NBM with multiple PDN
connections to the same APN hands over to the non-3GPP access network, the UE
can, as an implementation option, prioritise the re-establishment for a
particular PDN connection before re-establishing the remaining PDN
connections. The way a UE prioritizes a particular PDN connection is non-3GPP
access network specific and its coding is out of scope of this specification.
Another implementation option can be to send multiple re-establishment
requests concurrently.
NOTE 6: Any unsuccessful re-establishment of any of the multiple PDN
connections to the same APN can be managed in an implementation specific
manner avoiding UE making repeated re-establishment attempts to the network.
If the UE did not handover all the PDN connections for a given APN to the
target trusted non-3GPP access network, the network may disconnect the
remaining PDN connections for that given APN after an implementation dependent
time.
## 6.5 Authentication and authorization for accessing EPC via an untrusted
non-3GPP access network
### 6.5.1 General
In order to attach to the evolved packet core network (EPC) via untrusted
non-3GPP IP access, the UE first needs to be configured with a local IP
address from the untrusted non-3GPP access network.
During the attach to the untrusted non-3GPP access, the operator of the
non-3GPP access network may optionally require to perform a 3GPP based access
authentication as specified in 3GPP TS 33.402 [15].
Once the UE is configured with a local IP address, the UE shall select the
Evolved Packet Data Gateway (ePDG) as described in subclause 7.2.1 and shall
initiate the IPsec tunnel establishment procedure as described in subclause
7.2.2. During these steps authentication and authorization for access to EPC
shall be performed.
### 6.5.2 Full authentication and authorization
#### 6.5.2.1 General
During the establishment of the IPSec tunnel between the UE and the ePDG, 3GPP
based authentication signalling for untrusted non-3GPP access to the EPC shall
be exchanged between the UE and the 3GPP AAA server in the EPC to ensure
mutual authentication of the user and the EPC.
Authorization of EPC access shall be performed by the 3GPP AAA server upon
successful user authentication.
The access authentication signalling between the UE, the ePDG and the 3GPP AAA
server shall be based on EAP-AKA as specified in IETF RFC 4187 [33] and is
further detailed in 3GPP TS 33.402 [15], 3GPP TS 29.273 [17] and procedural
descriptions in subclauses 6.5.2.2, 6.5.2.4 and 6.5.2.3.
#### 6.5.2.2 UE procedures
##### 6.5.2.2.1 General
When accessing the EPC via the ePDG, the UE shall exchange EAP-AKA signalling
with the 3GPP AAA server as specified in 3GPP TS 33.402 [15].
NOTE: the EAP payload exchanged between UE and 3GPP AAA server is transported
within the IKEv2 messages exchanged with ePDG as described in subclause 7.2.2.
##### 6.5.2.2.2 EAP AKA
###### 6.5.2.2.2.1 Identity management
The support of user identity privacy as defined in IETF RFC 4187 [33] and
based on temporary identity is mandatory for the UE.
As defined in 3GPP TS 33.402 [15], the UE sends the user identity (in the IDi
payload) in the first message of the IKE_AUTH phase. The user identity sent by
the UE in the IDi payload depends on the presence of the temporary identity as
defined in IETF RFC 4187 [33].
\- If valid fast re-authentication identity is available, the UE shall use the
fast re-authentication identity;
\- Otherwise if valid pseudonym is available, the UE shall use the pseudonym;
\- Otherwise the UE shall use the permanent IMSI-based identity.
The temporary identities shall be in the form of a NAI, as specified in 3GPP
TS 23.003 [3] clause 19. IETF RFC 4187 [33] defines the leading digits to
identify the authentication mechanism. The leading digit defined for EAP-AKA
authentication shall be used. The permanent identity shall be in the form of a
NAI in which username is derived from IMSI as defined in 3GPP TS 23.003 [3].
The UE after successful EAP authentication may store the new temporary
identity(ies) received in AT_ENCR_DATA attribute together with the fast re-
authentication parameters (new master key, transient EAP keys and counter
value) in the non-volatile memory of the UE or in the USIM as specified in
3GPP TS 31.102 [45]. In this latter case the pseudonym is stored in the
\"Pseudonym\" data file and the fast re-authentication identity, new master
key, transient EAP keys and counter value in the \"Re-authentication
identity\" data file.
If no new temporary identity was received in AT_ENCR_DATA attribute of a
successful EAP authentication, the stored temporary identity becomes invalid
and the UE shall not send this temporary identity at the next EAP
authentication. In case the temporary identity is stored in the USIM, the UE
shall set the username of the corresponding temporary identity field to the
\"deleted\" value (hexadecimal value FF) to indicate that this temporary
identity is invalid as specified in 3GPP TS 23.003 [3].
###### 6.5.2.2.2.2 Protected result indications
The UE shall support protected result indications (i.e. MAC protected) as
specified in IETF RFC 4187 [33].
#### 6.5.2.3 3GPP AAA server procedures
##### 6.5.2.3.1 General
During the authentication of the UE for accessing the EPC via the ePDG, the
3GPP AAA server shall initiate EAP-AKA based authentication with the UE as
specified in 3GPP TS 33.402 [15].
##### 6.5.2.3.2 EAP-AKA
###### 6.5.2.3.2.1 Identity management
The support of user identity privacy is mandatory for the 3GPP AAA server. The
usage of this feature depends on operator\'s policies.
If user identity privacy is used, the 3GPP AAA server shall send new encrypted
temporary identity (pseudonym and/ or fast re-authentication identity) to the
UE in every EAP authentication procedure. The 3GPP AAA selects the pseudonym
identity or the Fast Re-authentication Identity and returns the identity to
the UE during the Authentication procedure as specified in 3GPP TS 33.402
[15]. The 3GPP AAA server shall maintain a mapping between the UE\'s permanent
identity and the pseudonym identity and between the UE\'s permanent identity
and the Fast Re-authentication Identity.
###### 6.5.2.3.2.2 EAP AKA based authentication
The 3GPP AAA server shall support EAP AKA based authentication as specified in
IETF RFC 4187 [33].
###### 6.5.2.3.2.3 Fast re-authentication
The 3GPP AAA server shall support fast re-authentication as specified in the
IETF RFC 4187 [33]. Fast re-authentication should be enabled in the 3GPP AAA
server. The decision of using fast re-authentication is taken in the 3GPP AAA
server depending on operator\'s policies. The 3GPP AAA server indicates to the
UE the decision of using fast re-authentication by means of sending the fast
re-authentication identity in the EAP authentication procedure (i.e. in EAP-
Request/AKA/Challenge or EAP‑Request/AKA-re-authentication). When the 3GPP AAA
server sends a fast re-authentication identity to the UE, the 3GPP AAA server
shall also include a pseudonym when allowed by the IETF RFC 4187 [33]. In this
way, the UE retains a pseudonym if the 3GPP AAA server defers to full
authentication.
###### 6.5.2.3.2.4 Protected result indications
The 3GPP AAA server should support protected result indications (i.e. MAC
protected) for EAP AKA as specified in IETF RFC 4187 [33]. The usage of this
feature depends on operator\'s policies.
#### 6.5.2.4 ePDG procedures
During the authentication of the UE for accessing the EPC via the ePDG, the
ePDG shall initiate EAP-AKA based authentication between the UE and the 3GPP
AAA server as specified in 3GPP TS 33.402 [15]. The ePDG shall extract the EAP
messages received from the UE over IKEv2, and send them to the 3GPP AAA Server
and shall send the EAP message received from the 3GPP AAA Server to the UE
over IKEv2 messages as defined in 3GPP TS 33.402 [15].
At the reception of the first message of the IKE_AUTH phase from the UE,
indicating to the ePDG that the UE wants to use EAP over IKEv2 (i.e. AUTH
parameter absent), the ePDG sends the Authentication and Authorization request
to the3GPP AAA server including the EAP_resp/Identity in the EAP payload, with
the User Identity retrieved from the IDi payload and the APN information
retrieved from the IDr payload of the incoming message from the UE.
### 6.5.3 Multiple PDN support for untrusted non-3GPP access network
Connectivity to multiple PDNs via untrusted non-3GPP access is supported in
the EPS when the network policies, the non-3GPP access and the user
subscription allow it.
NOTE 1: In 3GPP, there is a limitation to the maximum number of simultaneous
PDN connections per UE which is 11 (caused by the EPS bearer identity, see
3GPP TS 24.007 [49]). Not complying with this limitation when accessing
non-3GPP access can lead to unexpected consequences, e.g. connectivity loss in
case of handover to 3GPP access.
If the UE supports dynamic mobility management selection the UE shall use the
same mobility protocol when multiple connections are established, see 3GPP TS
23.402 [6].
When using the S2b interface to establish additional PDN connections, the UE
shall establish an IPSec tunnel with the same ePDG for each PDN connection.
For each tunnel establishment procedure, the UE shall indicate to the ePDG an
APN to the desired PDN and an attach type indication as specified in subclause
7.2.2.
When using the S2c interface, the UE shall follow the procedures described in
3GPP TS 24.303 [11] when establishing multiple PDN connections. For multiple
PDN connections over the S2c interface, the UE shall establish only one IPsec
tunnel to the ePDG.
If the UE had more than one PDN connection to a given APN in the source access
network and the UE is performing a handover to a target untrusted non-3GPP
access network via an ePDG that supports the S2b interface, the UE shall
transfer all the PDN connections for the given APN to the target untrusted
non-3GPP access network as specified in 3GPP TS 23.402 [6].
If multiple PDN connections to a single APN are not supported over the target
untrusted non-3GPP access network, only one PDN connection to that given APN
shall be established in the target non-3GPP access network as specified in
3GPP TS 23.402 [6] if NBM is used. The UE, if supporting IP address
preservation for NBM, shall include the home address information during the
tunnel establishment procedure as specified in subclause 7.2.2. If multiple
PDN connection requests to the same APN are received but the network does not
support multiple PDN connections to the same APN, the ePDG shall reject the
additional PDN connection requests to the same APN received from the UE as
described in subclause 7.4.1, in the following circumstances:
\- when one PDN connection to the same APN has already been established;
\- only after the network has successfully established one PDN connection in
the case that the additional PDN connections requests were received prior to
the successful establishment of a single PDN connection.
In the above cases, the UE shall determine which PDN connection is re-
established in the non-3GPP access based on the home address information
provided by the network.
The UE behaviour, when PDN connection re-establishment is rejected by the
network during handover to the untrusted non-3GPP access network, is described
in sublause 7.2.2.
NOTE 2: When a UE supporting IP address preservation for NBM with multiple PDN
connections to the same APN hands over to the non-3GPP access network, the UE
can, as an implementation option, prioritise the re-establisment for a
particular PDN connection before re-establishing the remaining PDN
connections. The UE indicates the prioritised PDN connection by including both
the APN in the IDr payload and the home address information in the Handover
Attach indicator as specified in subclause 7.2.2. Another implementation
option can be to send multiple re-establishment requests concurrently.
If the UE did not handover all the PDN connections for a given APN to the
target untrusted non-3GPP access network, the source network may disconnect
the remaining PDN connections for that given APN after an implementation
dependent time.
## 6.6 UE - 3GPP EPC (cdma2000^®^ HRPD Access)
### 6.6.1 General
3GPP2 X.S0057 [20] defines the interworking architecture for access to the EPC
via cdma2000^®^ HRPD access networks. In particular, 3GPP2 X.S0057 [20]
describes support for a UE using the cdma2000^®^ HRPD air interface to access
the EPC architecture defined in 3GPP TS 23.402 [6] by:
\- specifying the use of the interface across the S2a reference point between
the 3GPP2 HRPD Serving Gateway (HSGW) and the PDN Gateway (P-GW) in the EPC by
referencing 3GPP TS 29.275 [18];
\- specifying the use of the interface across the S101 reference point between
the eAN/PCF in the 3GPP2 HRPD access network and the MME in the EPC by
referencing 3GPP TS 29.276 [19];
\- specifying the use of the user plane interface across the S103 reference
point between the EPC Serving Gateway (S-GW) and the HSGW by referencing 3GPP
TS 29.276 [19]; and
\- describing the internal functions and responsibilities of the HSGW.
3GPP2 C.S0087 [21] defines the signalling requirements and procedures for UEs
accessing the EPC via 3GPP2 HRPD access networks using the cdma2000^®^ HRPD
air interface. In particular, 3GPP2 C.S0087 [21]:
\- defines the signalling extensions to the cdma2000^®^ HRPD air interface
defined in 3GPP2 C.S0024 [23] necessary to support interworking with the EPC
and E‑UTRAN; and
\- defines the UE and eAN/PCF procedures and signalling formats to support
bidirectional handoff between E‑UTRAN and cdma2000^®^ HRPD.
### 6.6.2 Non-emergency case
#### 6.6.2.1 General
Subclauses 6.6.2.2 through 6.6.2.7 describe the particular requirements for
access to the EPC via a cdma2000^®^ HRPD access network in support of non-
emergency accesses and services.
#### 6.6.2.2 UE identities
The UE and network shall use the root NAI as specified in 3GPP TS 23.003 [3]
for EPC access authentication when the UE obtains service via a cdma2000^®^
HRPD access network connected to an EPC in the UE\'s HPLMN.
Additionally, the UE and network shall use the Fast-Reauthentication NAI and
the Pseudonym Identity as described in subclause 4.4.
#### 6.6.2.3 cdma2000^®^ HRPD access network identity
The access network identity is described in 3GPP TS 23.003 [3] and in
subclause 6.4.2.4 of this specification. For a cdma2000^®^ HRPD network, the
value and encoding of the access network identity is described in subclause
8.1.1. The 3GPP AAA server, HSS, and any visited network AAA proxy shall use
the access network identity during EAP-AKA\' authentication procedures (see
3GPP TS 33.402 [15]).
#### 6.6.2.4 PLMN system selection
The UE shall rely on information provisioned by the home operator to
facilitate the PLMN system selection process described in 3GPP TS 23.122 [4].
#### 6.6.2.5 Trusted and untrusted accesses
The UE shall determine the trust relationship for access to the EPC via a
cdma2000^®^ HRPD access network as described in subclause 4.1.
#### 6.6.2.6 IP mobility mode selection
The UE and network shall perform IP mobility mode selection as described in
subclauses 6.3.3.1 and 6.4.3.2
#### 6.6.2.7 Authentication and authorization for accessing EPC
The UE and 3GPP AAA server shall perform authentication and authorization
procedures for access to the EPC as defined in 3GPP TS 33.402 [15].
### 6.6.3 Emergency case
#### 6.6.3.1 General
Subclauses 6.6.3.2 through 6.6.3.3 describe the particular requirements for
access to the EPC via a cdma2000^®^ HRPD access network in support of an
emergency session in course of handover from E-UTRAN to HRPD.
In this release of the specification no emergency session related handling
other than the handover of an emergency session from E-UTRAN to an S2a based
cdma2000^®^ HRPD access network is specified.
#### 6.6.3.2 UE identities
When the UE obtains emergency services via a cdma2000^®^ HRPD access network
connected to an EPC in the UE\'s HPLMN, then the UE and the network shall use
the NAI for EPC access authentication as follows:
\- if IMSI is available and authenticated , then the UE and the network shall
use the root NAI;
\- if IMSI is not available or unauthenticated, then the emergency NAI shall
be used.
Additionally, the UE and the network shall use the Fast-Reauthentication NAI
and the Pseudonym Identity as described in subclause 4.4.1.
#### 6.6.3.3 Authentication and authorization for accessing EPC
If IMSI is available, then the authentication and authorization procedures via
STa are executed if the local regulation and network operator option requires
authenticating the UE.
If the authentication and authorization procedures fail, then it depends on
local regulation and network operator option to allow or reject the emergency
services for the UE.
If IMSI is not available, the authentication and authorization procedures via
STa are not executed.
## 6.7 UE - 3GPP EPC (WiMAX Access)
### 6.7.1 General
The WiMAX system and its access network subsystem are described within WiMAX
Forum Network Architecture Release 1.0 version 1.2 -- Stage 2 [24]. The
protocol architecture and signalling of the WiMAX system is specified in WiMAX
Forum Network Architecture Release 1.0 version 1.2 -- Stage 3 [25]. This
protocol architecture and signalling supports the air interface defined in
WiMAX Forum Mobile System Profile Release 1.0 Approved Specification Revision
1.4.0 [26] which specifies selected profiles of IEEE Std 802.16e-2005 and IEEE
Std 802.16-2004/Cor1-2005 [27]**.**
### 6.7.2 Non-emergency case
#### 6.7.2.1 General
Subclauses 6.7.2.2 through 6.7.2.7 describe the particular requirements for
access to the EPC via a WiMAX access network in support of non-emergency
accesses and services.
#### 6.7.2.2 UE identities
The UE and network shall use the root NAI as specified in 3GPP TS 23.003 [3]
for EPC access authentication when the UE obtains service via a WiMAX access
network connected to an EPC in the UE\'s HPLMN.
Additionally, the UE and network shall use the Fast-Reauthentication NAI and
the Pseudonym Identity as described in subclause 4.4.
#### 6.7.2.3 WiMAX access network identity
The access network identity is described in 3GPP TS 23.003 [3] and in
subclause 6.4.2.4 of this specification. For a WiMAX network, the value and
encoding of the access network identity is described in subclause 8.1.1. The
3GPP AAA server, HSS, and any visited network AAA proxy shall use the access
network identity during EAP-AKA authentication procedures (see 3GPP TS 33.402
[15]).
#### 6.7.2.4 **S** election **of the Network Service Provider**
The UE shall use WIMAX-specific procedures described in WiMAX Forum Network
Architecture Release 1.0 version 1.2 -- Stage 3 [25] to discover and select
the highest priority Network Service Provider (NSP) which is available and
allowable.
#### 6.7.2.5 Trusted and untrusted accesses
The UE shall determine the trust relationship for access to the EPC via a
WiMAX access network as described in subclause 4.1.
#### 6.7.2.6 IP mobility mode selection
The UE and network shall perform IP mobility mode selection as described in
subclauses 6.3.3.1 and 6.4.3.2.
#### 6.7.2.7 Authentication and authorization for accessing EPC
NOTE: In line with 3GPP TS 33.402 [15], in this present specification, no
particular security provisions are specified for interworking between WiMAX
and EPS. Any access specific security procedures for WiMAX as a non-3GPP
access network to EPC will be in accordance with WiMAX Forum Network
Architecture Release 1.0 version 1.2 -- Stage 3 [25] and WiMAX Forum Mobile
System Profile Release 1.0 Approved Specification Revision 1.4.0 [26].
### 6.7.3 Emergency case
NOTE: Procedures for handling emergency accesses or services are not
specificed within this release of the specification
## 6.8 Communication over the S14
### 6.8.1 General
In order to assist the UE with performing access network discovery and
selection, ANDSF provides a set of information to the UE. This information
contains:
\- the access network discovery and selection information to assist the UE
with selecting the access network;
\- ISMP to control and assist the UE with performing the inter-system change;
\- ISRP information to control and assist a UE with selecting the access
network to be used for routing different IP flows over different access
networks, establishing PDN connections and identifying IP flows applicable for
non-seamless WLAN offload;
\- IARP information to control and assist a UE with selecting a prioritised
APN which is associated with an existing PDN connection for routing different
IP flows. The IARP provided by ANDSF can also include information for
identifying IP flows applicable for non-seamless WLAN offload.
\- WLAN Selection Policy to assist the UE with selecting the WLAN access
network;
\- Home Network Preference information to assists the UE in selecting a WLAN
and a service provider for 3GPP-based authentication over WLAN;
\- Visited Network Preference information to assist the UE in selecting a WLAN
and a service provider for 3GPP-based authentication over WLAN when the UE is
roaming in a V-PLMN; or
\- Rule selection information to assist the roaming UE with selecting the
active ANDSF rules to be used.
The ANDSF can provide ISRP rules to a UE independently of the UE\'s support
for IFOM, MAPCON, NSWO, RAT differentiation in ISRP or RAN-assisted WLAN
interworking. Handling of ISRP nodes unsupported by the UE is described in
3GPP TS 24.312 [13].
The ANDSF can provide IARP rules to a UE independently of the UE\'s support
for NSWO, Inter-APN routing or RAN-assisted WLAN interworking. Handling of
IARP nodes unsupported by the UE is described in in 3GPP TS 24.312 [13].
This set of information can either be provisioned in the UE by the home
operator, or provided to the UE by the ANDSF over the S14 reference point via
pull or push mechanisms as defined in 3GPP TS 23.402 [6] by means of the
access network discovery and selection procedures as described in subclause
6.8.2. While roaming, the UE can receive a set of information from H-ANDSF or
V-ANDSF or both. The V-ANDSF shall not provide any IARP or rule selection
information to a roaming UE. If the roaming UE receives any IARP or rule
selection information delivered by a V-ANDSF then the roaming UE shall ignore
it.
The UE, located in the home PLMN, needs to discover the H-ANDSF by means of
the discovery procedure as described in subclause 6.8.2.2.1. The UE, located
in the visited PLMN, needs to discover the H-ANDSF or V-ANDSF or both by means
of the discovery procedure as described in subclause 6.8.2.2.1.
Through push mechanisms the ANDSF can provide assistance information to the UE
e.g. if the UE has previously used pull based ANDSF procedure or if OMA-DM
bootstrapping is used as described in subclause 6.8.2.2.1A. Through pull
mechanisms the UE can send a request to the ANDSF in order to get assistance
information for access network discovery and selection.
ANDSF shall comply with local, national and regional requirements regarding
the privacy and confidentiality of location information.
NOTE: The regulation and legislations of the home operator of the ANDSF server
determines whether the ANDSF server can store the user\'s location
information.
If the ANDSF rules control the WLAN access selection and traffic routing as
described in subclause 6.10.2, then the access stratum layer of the 3GPP
access can provide RAN assistance parameters and corresponding (E-)UTRAN
measurements which are used in accordance with the ANDSF MO defined in 3GPP TS
24.312 [13].
### 6.8.2 Interaction with the Access Network Discovery and Selection Function
#### 6.8.2.1 General
The S14 interface enables IP level communication between the UE and ANDSF. The
protocols supported by the S14 interface are realized above the IP level. Both
pull and push mechanisms may be supported for communication between the UE and
the ANDSF. A combination of pull and push mechanisms may also be supported.
The communication security over the S14 interface is specified in 3GPP TS
33.402 [15].
The UE, located in a home PLMN, can communicate securely with the H-ANDSF. The
UE, located in a visited PLMN, can communicate securely with H-ANDSF or
V-ANDSF or both.
The information is transferred between the UE and ANDSF using OMA DM as
defined in OMA-ERELD-DM-V1_2 [39] with the management object as specified in
3GPP TS 24.312 [13].
#### 6.8.2.2 UE procedures
##### 6.8.2.2.1 UE discovering the ANDSF
The IP address of the H-ANDSF can be configured in the UE by the home
operator.
When the UE is in its HPLMN or equivalent HPLMN, the UE may use DNS lookup as
specified in IETF RFC 1035 [35] or DHCP query as specified in IETF RFC 6153
[37] to discover the IP address of the H-ANDSF. If the UE implements DHCP
query, the preference between DNS lookup and DHCP query is UE implementation
dependent. .
When the UE is in a visited PLMN, the UE shall use DNS lookup to discover the
IP address of the ANDSF.
When performing a DNS lookup resolution for ANDSF, the UE shall apply the
following procedures:
\- For the H-ANDSF discovery, the UE shall build a Fully Qualified Domain Name
(FQDN) that shall be set to the ANFSF-SN FQDN as defined in 3GPP TS 23.003 [3]
for the DNS request and select the IP address of the H-ANDSF included in the
DNS response message.
\- For the V-ANDSF discovery, the V-ANDSF IP address by which the UE can
contact the V-ANDSF is obtained by the UE through a DNS lookup by name as
specified in IETF RFC 1035 [35]. The QNAME shall be set to the ANDSF-SN FQDN
and included in the DNS Request as defined in 3GPP TS 23.003 [3], and select
the IP address of the V-ANDSF included in the DNS response message.
##### 6.8.2.2.1A ANDSF communication security
According to 3GPP TS 33.402 [15], for the pull model, the UE and ANDSF shall
use PSK TLS with GBA based shared key-based mutual authentication to establish
a secure connection between UE and ANDSF as specified by subclause 5.4 of 3GPP
TS 33.222 [44].
According to 3GPP TS 33.402 [15], for the push model, the UE and ANDSF shall
use PSK TLS with GBA push based shared key-based mutual authentication to
establish a secure connection between the UE and the ANDSF as specified by
subclause 5.1 of 3GPP TS 33.223 [47].
In accordance with 3GPP TS 29.109 [43], the BSF shall provide either the UE\'s
IMSI or IMPI to NAF, ie the ANDSF server.
OMA-DM\'s application level authentication mechanism does not need to be used
with ANDSF, since mutual security association is already established on
transport level using PSK-TLS as specified in 3GPP TS 33.402 [15]. According
to OMA-ERELD-DM-V1_2 [39], however, each Managed Object (MO) shall have an
access control list (ACL) that lists authorized OMA DM servers. In order to
comply with OMA-ERELD-DM-V1_2 [39], the ANDSF-SN FQDN shall be used as server
name in the ACL list.
If the UE does not support the ANDSF security mechanism as specified in 3GPP
TS 33.402 [15], or if the operator does not implement the GAA bootstrap
framework specified in 3GPP TS 33.220 [42], appropriate communication security
can be established with the ANDSF using OMA-DM\'s bootstrap, secure http
(https) mechanism and WAP Push according to OMA-ERELD-DM-V1_2 [39].
##### 6.8.2.2.2 Role of UE for Push model
The UE shall implement the push model of ANDSF in accordance with OMA-ERELD-
DM-V1_2 [39] using WAP Push, which is applicable for 3GPP access networks
only.
If the UE operates according to the GAA bootstrap framework specified in 3GPP
TS 33.220 [42] and if the UE supports GBA Push as specified in 3GPP TS 33.223
[47], the UE shall accept the SMS as a valid ANDSF notification SMS if:
\- the notification SMS contains valid GBA Push Information (GPI) as specified
in 3GPP TS 24.109 [52],
\- the X-WAP-Application-ID field (Push Application ID) in the WSP header
indicates ANDSF,
\- the WSP payload contains only the header part defined in 3GPP TS 24.109
[52] and the GPI parameter without any additional identifiers and
\- the NAF FQDN in GPI conforms to the ANDSF-SN specified in 3GPP TS 23.003
[3].
The short code for the X-WAP-Application-ID is specified in subclause 8.1.3.
If the UE operates according to OMA DM bootstrap procedures as specified in
OMA DM Enabler Release v.1.2, see OMA-ERELD-DM v1_2 [39], the UE shall accept
the SMS as a valid ANDSF notification SMS if it contains an OMA DM General
Package #0 message according to OMA-ERELD-DM v1_2 [39].
In the push model of communication, if the UE receives a valid ANDSF
notification SMS from the ANDSF, the UE shall establish a secure data
connection using the information received in the notification SMS.
If the UE receives an invalid ANDSF notification SMS it shall be ignored by
the UE.
Upon establishing a secure connection between the UE and ANDSF, the UE may be
provided with updated ISMP, information about available access networks, IARP
and ISRP. The list of the information is described in subclause 6.8.1 and
6.8.2.3.3 and the correspondent ANDSF MO is defined in 3GPP TS 24.312 [13].
##### 6.8.2.2.3 Role of UE for Pull model
In the pull model of communication, the UE sends a query to ANDSF to retrieve
or update inter-system mobility policy or information about available access
networks in its vicinity or inter-APN routing policy or any combination of
them. A UE supporting IFOM, MAPCON, NSWO or any combination of these may also
request ISRP. A UE may request IARP. The UE will wait for an implementation
dependent time for an answer from the ANDSF. If ANDSF does not respond within
that time, further action by the UE is implementation dependent. The UE may
provide to ANDSF the UE\'s location information including, if available, the
location parameters (for example, cell identities or the MAC address of the
WLAN AP) associated with the Radio Access Networks the UE has discovered in
its current location at the time the UE sends a query to ANDSF; the format of
the location information is described as UE_Location in ANDSF MO defined in
3GPP TS 24.312 [13].
After communicating with ANDSF, the UE may be provided with updated inter-
system policy, ISRP and IARP, and information about available access networks.
The list of the information is described in subclause 6.8.1 and 6.8.2.3.3 and
the correspondent ANDSF MO is defined in 3GPP TS 24.312 [13].
The UE may start Pull model communication with ANDSF based upon the
information previously received from the ANDSF (e.g. based on the value of
UpdatePolicy leaf defined in 3GPP TS 24.312 [13]). The UE capable of IFOM,
MAPCON, or non-seamless WLAN offload (or any combination of these
capabilities) can have all these capabilities disabled and have no ISRP. If
the UE enables one (or more) of these capabilities, the UE may start Pull
model communication with ANDSF. The UE capable of IFOM, MAPCON, or non-
seamless WLAN offload (or any combination of these capabilities) can have one
(or more) ofthese capabilities enabled and have no ISMP. If the UE disables
all these capabilities, the UE may start Pull model communication with ANDSF.
If the UE has no IARP, the UE may start Pull model communication with ANDSF.
NOTE: Mechanisms to limit the frequency of queries transmission from the UE to
the ANDSF are implementation dependant.
##### 6.8.2.2.4 UE using information provided by ANDSF
###### 6.8.2.2.4.1 General
ANDSF may provide various types of information to the UE, including access
network discovery information, WLAN selection information, inter-system
mobility policy, the inter-system routing policies and the inter-APN routing
policies. The UE may retain and use these information until new or updated
information is received.
Network detection and selection shall take into account the access network
specific requirements and the UE\'s local policy, e.g. user preference
settings, access history, etc, along with the information provided by the
ANDSF when discovering and selecting an access network. The local policy and
the information provided by the ANDSF shall be used by the UE in an
implementation dependent way to limit the undesired alternating between access
systems, e.g. ping-pong type of inter-system changes. However, the use of such
information from the ANDSF shall not be in contradiction to functions
specified in 3GPP TS 23.122 [4], 3GPP TS 25.304 [14] and 3GPP TS 36.304 [16].
If the UE is roaming in a VPLMN, the UE may receive Inter-system mobility
policies or Access network discovery information or ISRP or combinations of
these from H-ANDSF or V-ANDSF or both. The UE may also receive the IARP from
H-ANDSF. If IARP is received from V-ANDSF, the UE shall ignore it. The UE may
also receive WLAN selection information including WLAN Selection Policy
(WLANSP) from H-ANDSF or V-ANDSF or both, rule selection information, and Home
Network Preference information from H-ANDSF. The UE may receive Visited
Network Preference information from V-ANDSF. The formats of the above
information are defined in 3GPP TS 24.312 [13].
The maximum number of sets of Inter-system mobility polices or Access network
discovery information or ISRP or IARP or combinations of these that the UE may
keep is implementation dependent. However, the UE shall retain at least one
set of Inter-system mobility policies and one set of Access network discovery
information from the same ANDSF. In addition, a UE supporting IFOM, MAPCON, or
non-seamless WLAN offload shall retain at least one ISRP rule from the same
ANDSF. Additionally, a UE shall retain at least one set of IARP from the same
ANDSF.
If a UE supporting IFOM, MAPCON, or non-seamless WLAN offload (or any
combination of these featureshas ISMP and ISRP available, and if the ANDSF
rules control the WLAN access selection and traffic routing as described in
subclause 6.10.2, then ISRP shall be used for the routing of IP traffic. The
relation between ISRP and user preferences is described in subclause 5.4.2.
For a UE with IFOM, MAPCON or non-seamless WLAN offload (or any combination of
these capabilities) enabled, if ISMP, ISRP and IARP are available, and if the
ANDSF rules control the WLAN access selection and traffic routing as described
in subclause 6.10.2, then IARP and ISRP shall be used. In this case, the UE
shall first apply IARP followed by ISRP as follows:
\- If non-seamless WLAN offload is selected by IARP then the IP flow is routed
to the non-seamless WLAN offload and ISRP shall not be used for the routing of
IP traffic.
\- If a certain APN is selected by IARP then the IP flow is routed to the PDN
connections corresponding to this APN. If there is a ForFlowBased ISRP rule
matching the IP flow after the APN is selected, then the UE shall use the
ForFlowBased ISRP rule matching the IP flow to select the access for this IP
flow.
\- If neither certain APN nor non-seamless WLAN offload is selected by IARP or
one or more APNs are restricted by the IARP for routing the IP flow, then ISRP
shall be used for the routing of IP traffic. When one or more APNs are
restricted by the IARP, if a rule for NSWO is matched in the active ISRP rule
that restricts the use of the selected WLAN (or any WLAN) for routing the IP
flow, then the UE selects a not restricted APN to route the IP flow.
The relation between IARP and user preferences is described in subclause
5.4.2.
For a UE not supporting any of IFOM, MAPCON or non-seamless offload
capabilities or with all those capabilities disabled, if ISMP and ISRP are
available, and if the ANDSF rules control the WLAN access selection and
traffic routing as described in subclause 6.10.2, the ISMP shall be used.
For a UE not supporting any of IFOM, MAPCON capabilities or with all those
capabilities disabled, if ISMP, ISRP and IARP are available, and if the ANDSF
rules control the WLAN access selection and traffic routing as described in
subclause 6.10.2, the IARP and ISMP shall be used. In this case, the UE shall
firstly apply ISMP followed by IARP as follows:
\- If the 3GPP access is selected by ISMP policy, then the UE shall use the
active IARP rule to determine if the IP flow is routed to the PDN connection
corresponding to a certain APN. The non-seamless WLAN offload policy, defined
in the IARP, shall not be used for routing of IP traffic; and
\- If the WLAN access is selected by ISMP policy, then the UE shall use the
active IARP rule to determine if the IP flow is routed to the PDN connection
corresponding to a certain APN or using the non-seamless WLAN offload.
This information shall be deleted if there is a change of USIM. This
information may be deleted when UE is switched off.
If the ANDSF rules control the WLAN access selection and traffic routing as
described in subclause 6.10.2, irrespective of whether any rule in ANDSF
policies is \'active\' or not, the UE shall periodically re-evaluate ANDSF
policies. The value of the periodic re-evaluation timer is implementation
dependant. The additional trigger for (re‑)evaluating rules is that the
\'active\' rule becomes invalid (conditions no longer fulfilled), or other
manufacturer specific trigger. When the UE receives ANDSF information it shall
re-evaluate the available rules along with the new information.
###### 6.8.2.2.4.2 Use of Inter-system Mobility Policy
This subclause applies if the ANDSF rules control the WLAN access selection
and traffic routing as described in subclause 6.10.2.
If more than one set of Inter-system mobility policies is available in the UE,
the UE shall only use one set of Inter-system mobility policies at any one
time.
When the UE is roaming and receives Inter-system Mobility Policies from both
H-ANDSF and V-ANDSF, the set of Inter-system Mobility Policies used by the UE
is selected as follows:
\- If there is rule selection information provisioned in the UE by the
H-ANDSF, and if the RPLMN identity is equal to one of the VPLMNs included in
the visited PLMNs with preferred rules, the set of Inter-system Mobility
Policies from V-ANDSF is selected by the UE.
If the preferred access technology according to the Inter-system Mobility
Policy is WLAN access technology, and if there is no WLANs matching the WLANSP
rule(s) from the V-ANDSF, the set of of Inter-system Mobility Policies from
H-ANDSF is selected by the UE. However, if at least one WLAN matching one or
more groups of selection criteria in the VPLMN's WLANSP rule becomes
available, the UE should re-use the WLANSP policies and Inter-system Mobility
Policies from V-ANDSF.
\- If there is rule selection information provisioned in the UE by the
H-ANDSF, and if the RPLMN identity is not equal to any of the VPLMNs included
in the visited PLMNs with preferred rules, the set of Inter-system Policies
from H-ANDSF is selected by the UE.
If the preferred access technology according to the Inter-system Mobility
Policy is WLAN access technology, and if there is no WLANs matching the WLANSP
rule(s) from the H-ANDSF, the set of of Inter-system Mobility Policies from
V-ANDSF is selected by the UE. However, if at least one WLAN matching one or
more groups of selection criteria in the HPLMN's WLANSP rule becomes
available, the UE should re-use the WLANSP policies and Inter-system Mobility
Policies from H-ANDSF.
NOTE: How frequently the UE performs the discovery and reselection procedure
depends on the UE implementation.
The Inter-system Mobility Policy with the highest priority among the set of
Inter-system Mobility Policies selected above is selected as the active Inter-
system Mobility Policy. A UE uses the ISMP to decide if the most preferred
available WLAN based on the WLANSP rule has higher priority than the 3GPP RAT.
If so, the UE shall connect to EPC via WLAN access. Otherwise, the UE shall
connect to EPC via 3GPP access. The prioritized list of WLAN in the active
ISMP rule shall not be used for WLAN selection.
When applying the Inter-system mobility policy the following requirements
apply:-
\- the requirements on periodic network reselection as described in subclause
5.3.4 of the present specification;
\- the PLMN selection rules specified in 3GPP TS 23.122 [4] and in subclause
5.2.3.2;
\- the selection rules specified in 3GPP2 C.P0016-D [23a]; and
\- the 3GPP RAT selection, cell selection and reselection rules specified in
3GPP TS 25.304 [14], 3GPP TS 36.304 [16] and 3GPP TS 45.008 [16a].
###### 6.8.2.2.4.3 Use of Access Network Discovery Information
The UE may use the received Access network discovery information of both the
H-ANSDF and V-ANDSF for network discovery and detection. The Access network
discovery information received from:-
a) the H-ANDSF provides guidance for the UE on access networks that have
connectivity to the HPLMN or equivalent HPLMNs or both; and
b) the V-ANDSF provides guidance for the UE on access networks that have
connectivity to the corresponding VPLMN or equivalent PLMNs or both.
###### 6.8.2.2.4.4 Use of Inter-System Routing Policies
This subclause applies if the ANDSF rules control the WLAN access selection
and traffic routing as described in subclause 6.10.2.
A UE supporting IFOM, MAPCON, or non-seamless WLAN offload (or any combination
of these features) shall use the ISRP if available.
A UE supporting IFOM uses the ISRP to:
\- select an access technology or an access network or both for routing user
plane traffic matching specific IP flows on a specific or any APN identified
in the ISRP. 3GPP RATs can be prioritized with respect to WLAN access but this
prioritization does not influence 3GPP RAT selection; WLAN access networks can
be prioritized with respect to 3GPP RATs but those WLANs do not influence WLAN
selection; and
\- decide if an access technology or access network or both are restricted for
a specific IP flows on a specific or any APN identified in the ISRP.
A UE supporting MAPCON uses the ISRP to:
\- select an access technology or an access network or both for routing user
plane traffic matching a specific APN or any APN identified in the ISRP. 3GPP
RATs can be prioritized with respect to WLAN access but this prioritization
does not influence 3GPP RAT selection; WLAN access networks can be prioritized
with respect to 3GPP RATs but those WLANs do not influence WLAN selection; and
\- decide if an access technology or an access network or both are restricted
for a specific APN or any APN identified in the ISRP.
NOTE: After selecting WLAN access for routing user plane traffic by this
prioritised list of access technologies, a UE can use an implementation
dependent way to prevent the traffic from being routed back to the original
RAT again in a short period of time to avoid ping-pong behaviour.
A UE supporting non-seamless WLAN offload uses the ISRP to:
\- select a WLAN access network for routing, without traversing the EPC, user
plane traffic matching specific IP flows for a specific APN or any APN
identified in the ISRP; WLAN access networks defined in routing rule do not
influence WLAN selection; and
\- decide if the selected WLAN access network is restricted for routing,
without traversing the EPC, a specific IP flows for a specific APN or any APN
identified in the ISRP. If not, the selected WLAN can be used to perform NSWO.
When the UE supporting IFOM identifies an access technology or an access
network or both over which an IP flow can be routed based on the ISRP, the UE
shall apply the IFOM procedures specified in 3GPP TS 24.303 [11] to move an
on-going IP flow from the source access technology or access network to the
identified access technology or access network, if required.
If more than one set of ISRP is available in the UE, the UE shall only use one
ISRP at any one time.
When the UE is roaming and receives Inter-system Routing Policies from both
H-ANDSF and V-ANDSF, the set of Inter-system Routing Policies used by the UE
is selected as follows:
\- If there is rule selection information provisioned in the UE by the
H-ANDSF, and if the RPLMN identity is equal to one of the VPLMNs included in
the visited PLMNs with preferred rules, the set of Inter-system Routing
Policies fromV-ANDSF is selected by the UE.
If there is no WLANs matching the WLANSP rule(s) from the V-ANDSF, the set of
Inter-system Routing Policy from the H-ANDSF is re-selected. However, if at
least one WLAN matching one or more groups of selection criteria in the WLANSP
rule of the VPLMN becomes available, the UE should re-use the WLANSP policies
and Inter-system Routing Policies from V-ANDSF.
\- If there is rule selection information provisioned in the UE by the
H-ANDSF, and if the RPLMN identity is not equal to any of the VPLMNs included
in the visited PLMNs with preferred rules, the set of Inter-system Routing
Policies from H-ANDSF is selected by the UE,
If there is no WLANs matching the WLANSP rule(s) from the H-ANDSF, the set of
Inter-system Routing Policy from the V-ANDSF is be re-selected. However, if at
least one WLAN matching one or more groups of selection criteria in the WLANSP
rule of the HPLMN becomes available, the UE should re-use the WLANSP policies
and Inter-system Routing Policies from H-ANDSF.
NOTE: How frequently the UE performs the discovery and reselection procedure
depends on the UE implementation.
The Inter-system Routing Policy with the highest priority among the set of
Inter-system Routing Policies selected above is selected as the active Inter-
system Routing Policy.
The UE shall periodically re-evaluate the flow distribution rules of the
\'active\' ISRP rule. The value of the periodic re-evaluation timer is
implementation dependant.
###### 6.8.2.2.4.5 Use of Inter-APN Routing Policies
The UE shall use the IARP for APN if available.
The UE shall use the IARP for non-seamless WLAN offload if available, and the
ANDSF rules control the WLAN access selection and traffic routing as described
in subclause 6.10.2.
A UE uses the IARP to:
\- select an APN or non-seamless WLAN offload for routing user plane traffic
matching specific IP flows; and
\- decide if an APN or non-seamless WLAN offload is restricted for routing a
specific IP flows.
An IARP for APN can be applied only when it steers IP traffic to an existing
(i.e. already established) PDN connection. Also, the scenario where multiple
PDN connections via the same access network are associated with the same APN
is not specified in the present document.
When applying IARP the same requirements defined for inter-system mobility
policy in subclause 6.8.2.2.4.2 applies with the exception that the UE shall
apply IARP provided by the H-ANDSF.
If no valid IARP present, then Inter-APN routing policy configuration is UE
implementation dependent.
###### 6.8.2.2.4.6 Use of WLAN selection information
The UE uses the WLAN selection information provided by ANDSF to determine the
selected WLAN and the selected service provider.
The UE first uses WLAN Selection Policy (WLANSP) and the visited PLMNs with
preferred rules to determine the active WLANSP rule. When roaming, if the UE
is configured to prefer WLAN selection rules provided by the HPLMN, WLANSP
provided by HPLMN is used. Otherwise, WLANSP provided by VPLMN is used. The UE
selects the highest priority and valid WLANSP rule as the active WLANSP rule.
During power-up, while the UE has not registered to any PLMN _,_ the UE shall
use WLANSP provided by the HPLMN as valid.
The UE determines the selected WLAN(s) as specified in subclause 5.1.3.2. If
there are no selected WLANs according to active WLANSP rule of the
VPLMN/HPLMN, then the UE uses the WLANSP policies from the HPLMN/VPLMN as
active WLANSP rule. However, if at least one WLAN that matches one or more
groups of selection criteria in the WLANSP rule of the VPLMN or the HPLMN
becomes available, the UE should re-use the WLANSP policies from the VPLMN or
the HPLMN as active WLANSP rule.
NOTE: How frequently the UE performs the discovery and reselection procedure
depends on the UE implementation.
Home Network Preference information and Visited Network Preference information
can be configured in the ANDSF MO to assist the UE in selecting a service
provider over the selected WLAN(s) and constructing an appropriate NAI when
attempting authentication with the selected service provider.
The UE uses the list of selected WLANs and the Home Network Preference
information (or the Visited Network Preference information if available and if
the UE is roaming) to select a WLAN service provider as specified in subclause
5.2.3.2.
#### 6.8.2.3 ANDSF procedures
##### 6.8.2.3.1 General
Both the H-ANDSF and the V-ANDSF can provide information about inter-system
mobility policy or information about available access networks in the vicinity
of the UE or ISRP for the UE or combinations of these. The H-ANDSF may also
provide IARP for the UE. The V-ANDSF shall not provide any IARP to a roaming
UE. The inter-system mobility policies may be organized in a hierarchy and a
priority order among multiple policies may determine which policy has the
highest priority. The policies may indicate preference of one access network
over another or may restrict inter-system mobility to a particular access
network under certain conditions. The ANDSF may also specify validity
conditions which indicate when a policy is valid. Such conditions may be based
on time duration, location, RAN validity condition. The ANDSF may limit the
information provided to the UE. This can be based on UE\'s current location,
UE capabilities other than the capability of routing IP traffic simultaneously
over multiple radio access interfaces (e.g. IFOM capability or MAPCON
capability or non-seamless WLAN offload capability), etc. How the ANDSF
decides how much information to provide to the UE is dependent on network
implementation.
##### 6.8.2.3.2 Role of ANDSF for Push model
If there is no existing valid PSK TLS connection between the UE and ANDSF, the
ANDSF, not implementing GBA Push, may send a notification SMS to the UE,
without establishing a data connection with the UE.
If there is no existing valid PSK TLS connection between the UE and ANDSF, the
ANDSF, implementing GBA Push, shall send a message via SMS to the UE to
establish a secure connection between the UE and ANDSF. The contents of the
message shall contain a GBA Push Information as specified in 3GPP TS 33.223
[47].
After a secure connection is established according to subclause 6.8.2.2.1A, or
if there is a valid PSK TLS connection between the UE and ANDSF, the ANDSF
shall use the connection to provision ANDSF information to the UE.
##### 6.8.2.3.3 Role of ANDSF for Pull model
When the UE connects to an ANDSF, the ANDSF may provide the UE with inter-
system mobility policy or information related to available access networks in
the vicinity of the UE or ISRP or IARP for the UE, or combinations of these.
In case of information about available access networks, the ANDSF provides the
following information about each available access network in the form of a
list containing:
1) Type of Access network (e.g. WLAN, WiMAX);
2) Location of Access Network (e.g. 3GPP location, WLAN location);
3) Access Network specific information (e.g WLAN information, WiMAX
information); and
4) Operator differentiated text field (if supported, e.g. if WNDS MO defined
in 3GPP TS 24.312 [13] is used).
The detailed list of information is described in 3GPP TS 24.312 [13].
## 6.9 Handling of Protocol Configuration Options information
The Protocol Configuration Options (PCO) information element is specified in
3GPP TS 24.008 [46].
The support of PCOs is optional for the UE and the non-3GPP access network.
Except for the trusted WLAN access, the content syntax of PCOs for the
non-3GPP access UE and non-3GPP access network is access network specific and
not in the scope of 3GPP, but if PCO is supported, the UE and the PDN-GW shall
handle the PCO contents in accordance with 3GPP TS 24.008 [46].
PCO information is exchanged between the UE and the PDN-GW, see 3GPP TS 23.402
[6], 3GPP TS 29.274 [50] and 3GPP TS 29.275 [18]. Except for the trusted WLAN
access, the specification of PCO signalling in the non-3GPP access network is
access network specific and not in the scope of 3GPP.
When the UE access EPC via trusted WLAN access network,
\- if SCM is used, the PCO is supported as described in subclause 6.4.2.6,
3GPP TS 29.274 [50] and 3GPP TS 29.275 [18];
\- if MCM is used, the PCO is supported as described in 3GPP TS 24.244 [56],
3GPP TS 29.274 [50] and 3GPP TS 29.275 [18];and
\- if TSCM is used, the PCO is not supported by the UE.
## 6.10 Integration with access stratum layer of 3GPP access
### 6.10.1 General
The subclause describes the additional procedures for integration with access
stratum layer of 3GPP access.
If the RAN assistance information is supported by the UE and the E-UTRAN or
UTRAN, the E-UTRAN or UTRAN can provide RAN assistance information to the UE
as described in 3GPP TS 25.331 [14A] and 3GPP TS 36.331 [16B].
### 6.10.2 Selection of control of WLAN access selection and traffic routing
The WLAN access selection and traffic routing can be controlled either by
ANDSF rules or by RAN rules.
The ANDSF rules control the WLAN access selection and traffic routing if:
a) the UE has ANDSF rules but no RAN rules; or
b) the UE has both ANDSF rules and RAN rules; and:
1) the UE is not capable to simultaneously route IP traffic to both 3GPP
access and WLAN; and:
A) the UE is not roaming and the UE has at least one ISMP rule from HPLMN;
B) the UE is roaming in a VPLMN contained in the visited PLMNs with preferred
rules and the UE has at least one ISMP rule from VPLMN; or
C) the UE is roaming in a VPLMN not contained in the visited PLMNs with
preferred rules and the UE has at least one ISMP rule from HPLMN; or
2) the UE is capable to simultaneously route IP traffic to both 3GPP access
and WLAN; and:
A) the UE is not roaming and the UE has an valid ISRP rule from HPLMN;
B) the UE is roaming in a VPLMN contained in the visited PLMNs with preferred
rules and the UE has a valid ISRP rule from VPLMN; or
C) the UE is roaming in a VPLMN not contained in the visited PLMNs with
preferred rules and the UE has a valid ISRP rule from HPLMN.
The RAN rules control the WLAN access selection and traffic routing if:
a) the UE has RAN rules but no ANDSF rules; or
b) the UE has both ANDSF rules and RAN rules; and:
1) the UE is not capable to simultaneously route IP traffic to both 3GPP
access and WLAN; and:
A) the UE is not roaming and the UE has no ISMP rules from HPLMN;
B) the UE is roaming in a VPLMN contained in the visited PLMNs with preferred
rules and the UE has no ISMP rules from VPLMN; or
C) the UE is roaming in a VPLMN not contained in the visited PLMNs with
preferred rules and the UE has no ISMP rules from HPLMN; or
2) the UE is capable to simultaneously route IP traffic to both 3GPP access
and WLAN, and:
A) the UE is not roaming and the UE has no valid ISRP rule from HPLMN;
B) the UE is roaming in a VPLMN contained in the visited PLMNs with preferred
rules and the UE has no valid ISRP rule from VPLMN; or
C) the UE is roaming in a VPLMN not contained in the visited PLMNs with
preferred rules and the UE has no valid ISRP rule from HPLMN.
### 6.10.3 Additional procedures when WLAN access selection and traffic
routing is controlled by ANDSF rules
If the ANDSF rules control the WLAN access selection and traffic routing as
described in subclause 6.10.2, the access stratum layer of the 3GPP access
provides the received RAN assistance parameters to this layer and the UE shall
store the RAN assistance parameters and then use the RAN assistance
information together with ANDSF rules specified in 3GPP TS 24.312 [13] and
measurements results to make traffic routing decisions to move traffic to WLAN
or to E-UTRAN or UTRAN by:
\- comparing the received RAN assistance thresholds with corresponding
measurement results; and
\- comparing the received OPI value with the provisioned OPI value provided by
the ANDSF.
The following thresholds can be used for traffic routing from E-UTRAN or UTRAN
to WLAN:
\- ThreshServingOffloadWLANLowP;
\- ThreshServingOffloadWLANLowQ;
\- ThreshChUtilWLANLow;
\- ThreshBackhRateDLWLANHigh;
\- ThreshBackhRateULWLANHigh; and
\- ThreshBeaconRSSIWLANHigh.
The following thresholds can be used for traffic routing from WLAN to E-UTRAN
or UTRAN:
\- ThreshServingOffloadWLANHighP;
\- ThreshServingOffloadWLANHighQ;
\- ThreshChUtilWLANHigh;
\- ThreshBackhRateDLWLANLow;
\- ThreshBackhRateULWLANLow; and
\- ThreshBeaconRSSIWLANLow.
Offload Preference Indication (OPI) parameter can be used for traffic routing
in both directions, from E-UTRAN or UTRAN to WLAN or from WLAN to E-UTRAN or
UTRAN.
### 6.10.4 Additional procedures when WLAN access selection and traffic
routing is controlled by RAN rules
This subclause applies if the RAN rules control the WLAN access selection and
traffic routing as described in subclause 6.10.2.
The access stratum layer of the 3GPP access can provide:
1) move-traffic-to-WLAN indication, along with list of WLAN identifiers. An
entry in the list of the WLAN identifiers consists of SSID, BSSID, HESSID, or
any combination of them; and
2) move-traffic-from-WLAN indication.
The user preferences take precedence over the indications provided by the
access stratum layer of the 3GPP access.
Upon:
\- receiving move-traffic-to-WLAN indication, along with the list of the WLAN
identifiers, if the user preferences are not present; or
\- establishment of a new PDN connection in 3GPP access, if the PDN connection
is an offloadable PDN connection, the access stratum indicated move-traffic-
to-WLAN, the access stratum has not indicated the move-traffic-from-WLAN
indication after indicating of the move-traffic-to-WLAN indication and the
user preferences are not present;
and:
\- the UE is capable to simultaneously route IP traffic to both 3GPP access
and WLAN; or
\- the UE is not capable to simultaneously route IP traffic to both 3GPP
access and WLAN, and all the PDN connections of the UE in 3GPP access are
offloadable PDN connections;
the UE:
a) shall perform the procedure in subclause 5.1.3.2.3 and in subclause 5.2.3.2
to select the selected WLAN and the NAI for authentication;
b) if not authenticated yet with the selected WLAN using the NAI for
authentication in subclause 6.4, shall authenticate with the selected WLAN
using the NAI for authentication in subclause 6.4. During authentication, if
the selected WLAN is a trusted WLAN, SCM is supported by both UE and network,
MCM is not supported by UE, network or both, and if:
\- the UE is capable to simultaneously route IP traffic to both 3GPP access
and WLAN; or
\- the UE is not capable to simultaneously route IP traffic to both 3GPP
access and WLAN, and the UE has only one PDN connection;
shall handover one offloadable PDN connection from 3GPP access to the WLAN
access using procedures in subclause 6.4.2.6.2;
NOTE: When the UE already has one PDN connection established via WLAN in SCM,
and if move-traffic-to-WLAN indication is received, it is up to the UE
implementation to determine whether to offload a PDN connection from 3GPP
access to WLAN. In that case, it is also up to the UE implementation to
determine which one of the offloadable PDN connections will be offloaded.
c) if the selected WLAN is a trusted WLAN, and MCM is supported by both UE and
network, shall handover all the offloadable PDN connections from 3GPP access
to the WLAN access using procedures of 3GPP TS 24.244  _[56]_ ;
d) if the selected WLAN is an untrusted WLAN, and if the UE supports access to
EPC via untrusted WLAN, shall handover all the offloadable PDN connections
from 3GPP access to the WLAN access using procedures in subclause 7.2.1 and
subclause 7.2.2; and
e) if the UE has a valid IARP rule for APN, shall use the IARP for APN using
the procedures in subclause 6.8.2.2.4.5.
Upon receiving move-traffic-from-WLAN indication, and if the user preferences
are not present, the UE shall handover all the PDN connections established in
(or previously handed over to) WLAN access to the 3GPP access using procedures
in 3GPP TS 24.301 [10].
# 7 Tunnel management procedures
## 7.1 General
The purpose of tunnel management procedures is to define the procedures for
establishment or disconnection of an end-to-end tunnel between the UE and the
ePDG. The tunnel establishment procedure is always initiated by the UE,
whereas the tunnel disconnection procedure can be initiated by the UE or the
ePDG.
The tunnel is an IPsec tunnel (see IETF RFC 4301 [30]) established via an
IKEv2 protocol exchange IETF RFC 5996 [28] between the UE and the ePDG. The UE
may indicate support for IETF RFC 4555 [31]. **The security mechanisms for
tunnel setup using IPsec and IKEv2 are specified in** 3GPP **TS 33.402 [15].**
## 7.2 UE procedures
### 7.2.1 Selection of the ePDG
For dynamic selection of the ePDG the UE shall support the implementation of
standard DNS mechanisms in order to retrieve the IP address(es) of the ePDG.
The input to the DNS query is an ePDG FQDN as specified in subclause 4.4.3 and
in 3GPP TS 23.003 [3]. The ePDG FQDN contains a PLMN ID as Operator
Identifier. The UE selects the PLMN ID used in the ePDG FQDN based on the
conditions described below.
1\. If the UE is EPS attached or GPRS attached (see 3GPP TS 23.122 [4]) to a
Visited PLMN and:
1a) if the UE is not provided with a list of available PLMN ID(s), the UE
shall use the PLMN identity of the RPLMN or an equivalent PLMN (see 3GPP TS
24.301 [10] or 3GPP TS 24.008 [46]) in the creation of the ePDG FQDN (see 3GPP
TS 23.003 [3]);. If the DNS query with FQDN constructed using RPLMN identity
does not return any IP address, then the UE as an implementation option may
try again with FQDN constructed using an equivalent PLMN.
1b) if the UE is provided with a list of available PLMN ID(s) served by the
access network, e.g. via ANQP using 3GPP Cellular Network ANQP-element
specified in IEEE Std 802.11-2012 [57], and the current RPLMN or an equivalent
PLMN is contained in the list of available PLMN ID(s), the UE shall include
this PLMN identity in the creation of the ePDG FQDN (see 3GPP TS 23.003 [3]);
or
1c) in all other cases, the UE shall include the PLMN identity of the Home
PLMN or EHPLMN in the ePDG FQDN. The HPLMN or EHPLMN shall be chosen based on
the PLMN selection policy for the access network the UE is accessing (see
subclause 5.2.3).
2\. If the UE is EPS attached or GPRS attached to the Home PLMN or EHPLMN and:
2a) if the UE is not provided with a list of available PLMN ID(s), the UE
shall use the PLMN identity of the Home PLMN or EHPLMN in the creation of the
ePDG FQDN; or
2b) if the UE is provided with a list of available PLMN ID(s) served by the
access network e.g. via ANQP using 3GPP Cellular Network ANQP-element
specified in IEEE Std 802.11-2012 [57], and the Home PLMN or EHPLMN is
contained in the list of available PLMN ID(s), then the UE shall use this PLMN
identity in the ePDG FQDN;
2c) in all other cases, the UE behaviour is implementation specific; or
3\. If the UE is not attached to any PLMN, the UE performs PLMN selection as
described in subclause 5.2.1 and:
3a) if the UE is provided with a list of available PLMN ID(s) served by the
access network e.g. via ANQP using 3GPP Cellular Network ANQP-element
specified in IEEE Std 802.11-2012 [57], and neither Home PLMN nor EHPLMN is
contained in the list, use the PLMN identity of the selected PLMN from PLMN
selection in the ePDG FQDN; or
3b) otherwise, the UE shall include the identity of the Home PLMN or EHPLMN in
the ePDG FQDN.
Upon reception of a DNS response containing one or more IP addresses of ePDGs,
the UE shall select an IP address of ePDG with the same IP version as its
local IP address.
The UE shall select only one ePDG also in case of multiple PDN connections.
NOTE: During handover between two untrusted non-3GPP access networks, the UE
can initiate tunnel establishment to another ePDG while still being attached
to the current ePDG.
### 7.2.2 Tunnel establishment
Once the ePDG has been selected, the UE shall initiate the IPsec tunnel
establishment procedure using the IKEv2 protocol as defined in IETF RFC 5996
[28] and 3GPP TS 33.402 [15].
The UE shall send an IKE_SA_INIT request message to the selected ePDG in order
to setup an IKEv2 security association. Upon receipt of an IKE_SA_INIT
response, the UE shall send an IKE_AUTH request message to the ePDG, including
the type of IP address (IPv4 address or IPv6 prefix or both) that needs to be
configured in an IKEv2 CFG_REQUEST Configuration Payload. If the UE requests
for both IPv4 address and IPv6 prefix, it shall send two configuration
attributes in the CFG_REQUEST Configuration Payload, one for the IPv4 address
and the other for the IPv6 prefix. The IKE_AUTH request message shall contain
in \"IDr\" payload the APN and in the \"IDi\" payload the NAI. The UE
indicates a request for the default APN by omitting IDr payload, which is in
accordance with IKEv2 protocol as defined in IETF RFC 5996 [28]. The IKE_AUTH
request message may contain in a notify payload an indication that MOBIKE is
supported by the UE. The UE may also include the INTERNAL_IP6_DNS or the
INTERNAL_IP4_DNS attribute in the CFG_REQUEST Configuration Payload. The UE
can obtain zero or more DNS server addressed in the CFG_REPLY payload as
specified in IETF RFC 5996 [28].
During the IKEv2 authentication and security association establishment, if the
UE supports explicit indication about the supported mobility protocols, it
shall provide the indication as described in subclause 6.3.
During the IKEv2 authentication and tunnel establishment for initial attach,
the UE shall provide an indication about Attach Type, which indicates Initial
Attach. To indicate attach due to initial attach, the UE shall include either
the INTERNAL_IP4_ADDRESS or the INTERNAL_IP6_ADDRESS attribute or both in the
CFG_REQUEST Configuration Payload within the IKE_AUTH request message. The
INTERNAL_IP4_ADDRESS shall contain no value and the length field shall be set
to 0. The INTERNAL_IP6_ADDRESS shall contain no value and the length field
shall be set to 0.
During the IKEv2 authentication and tunnel establishment for handover, the UE
not supporting IP address preservation for NBM shall indicate Initial Attach
as described in the previous paragraph.
During the IKEv2 authentication and security association establishment for
handover, the UE supporting IP address preservation for NBM, shall provide an
indication about Attach Type, which indicates Handover Attach. To indicate
attach due to handover, the UE shall include the previously allocated home
address information during the IPSec tunnel establishment. Depending on the IP
version, the UE shall include either the INTERNAL_IP4_ADDRESS or the
INTERNAL_IP6_ADDRESS attribute or both in the CFG_REQUEST Configuration
Payload within the IKE_AUTH request message to indicate the home address
information which is in accordance with IKEv2 protocol as defined in IETF RFC
5996 [28]. The UE shall support IPSec ESP (see IETF RFC 4303 [32]) in order to
provide secure tunnels between the UE and the ePDG as specified in 3GPP TS
33.402 [15].
The UE may support multiple authentication exchanges in the IKEv2 protocol as
specified in IETF RFC 4739 [49] in order to support authentication and
authorization with an external AAA server allowing the UE to support PAP
authentication procedure, or CHAP authentication procedure, or both, as
described in 3GPP TS 33.402 [15].
If NBM is used and the UE wishes to access an external PDN and therefore needs
to perform authentication and authorization with an external AAA server, the
UE shall:
\- If the IKE_SA_INIT response contains a \"MULTIPLE_AUTH_SUPPORTED\" Notify
payload, then include a \"MULTIPLE_AUTH_SUPPORTED\" Notify payload in the
IKE_AUTH request as described in IETF RFC 4739 [49] and perform the additional
authentication steps as specified in 3GPP TS 33.402 [15]; and
\- If the IKE_SA_INIT response does not contain a \"MULTIPLE_AUTH_SUPPORTED\"
Notify payload, then perform the UE initiated disconnection as defined in
subclause 7.2.4.1. The subsequent UE action is implementation dependent (e.g.
select a new ePDG).
If NBM is used and if the UE receives from the ePDG an IKE_AUTH response
message containing a Notify Payload with a Private Notify Message Type
PDN_CONNECTION_REJECTION as specified in subclause 8.1.2 that includes an IP
address information in the Notification Data field, the UE shall not attempt
to re-establish this PDN connection while connected to the current ePDG and
the UE shall close the related IKEv2 security association states.
If NBM is used and if the UE receives from the ePDG an IKE_AUTH response
message containing a Notify Payload with a Private Notify Message Type
PDN_CONNECTION_REJECTION as specified in subclause 8.1.2 and no Notification
Data field, the UE shall not attempt to establish additional PDN connections
to this APN while connected to the current ePDG. The UE shall close the
related IKEv2 security association states. Subsequently, the UE can attempt to
establishment additional PDN connections to the given APN if one or more
existing PDN connections to the given APN are released. While connected to the
current ePDG, if this PDN connection is the first PDN connection for the given
APN, the UE shall not attempt to establish PDN connection to the given APN.
If NBM is used and if the UE receives from the ePDG an IKE_AUTH response
message containing a Notify Payload with a Private Notify Message Type
MAX_CONNECTION_REACHED as specified in subclause 8.1.2, the UE shall not
attempt to establish any additional PDN connections while connected to the
current ePDG. The UE shall close the related IKEv2 security association
states. Subsequently, the UE can attempt to establishment additional PDN
connections if one or more existing PDN connections are released.
After the successful authentication with the 3GPP AAA server, the UE receives
from the ePDG an IKE_AUTH response message containing a single CFG_REPLY
Configuration Payload including the assigned remote IP address information
(IPv4 address or IPv6 prefix) as described in subclause 7.4.1. Depending on
the used IP mobility management mechanism the following cases can be
differentiated:
\- If DSMIPv6 is used for IP mobility management, the UE configures a remote
IP address based on the IP address information contained in the
INTERNAL_IP4_ADDRESS or INTERNAL_IP6_SUBNET attribute of the CFG_REPLY
Configuration Payload. The UE uses the remote IP address as Care-of-Address to
contact the HA.
\- If NBM is used for IP mobility management and the UE performs an initial
attach, the UE configures a home address based on the address information from
the CFG_REPLY Configuration Payload. Otherwise, if NBM is used and the UE
performs a handover attach, the UE continues to use its IP address configured
before the handover, if the address information provided in the CFG_REPLY
Configuration Payload does match with the UE\'s IP address configured before
the handover. If the UE\'s IP address does not match with the address
information of the CFG_REPLY Configuration Payload, the UE shall configure a
new home address based on the IP address information contained in the
INTERNAL_IP4_ADDRESS or INTERNAL_IP6_SUBNET attribute of the CFG_REPLY
Configuration Payload. In the latter case, the IP address preservation is not
possible.
If the UE supports DSMIPv6, the UE may request the HA IP address(es), by
including a corresponding CFG_REQUEST Configuration Payload containing a
HOME_AGENT_ADDRESS attribute. The HOME_AGENT_ADDRESS attribute content is
defined in subclause 8.2.4.1. The HA IP address(es) requested in this
attribute are for the APN for which the IPsec tunnel with the ePDG is set-up.
In the CFG_REQUEST, the UE sets respectively the IPv6 address field and the
optional IPv4 address field of the HOME_AGENT_ADDRESS attribute to 0::0 and to
0.0.0.0. If the UE can not obtain the IP addresses of the HA via IKEv2
signalling, it uses the home agent address discovery as specified in 3GPP TS
24.303 [11].
In case the UE wants to establish multiple PDN connections and if the UE uses
DSMIPv6 for mobility management, the UE shall use DNS as defined in 3GPP TS
24.303 [11] to discover the HA IP address(es) for the additional PDN
connections after IKEv2 security association was established to the ePDG.
### 7.2.3 Tunnel modification
This procedure is used if MOBIKE as defined in IETF RFC 4555 [31] is supported
by the UE.
When there is a change of local IP address for the UE, the UE shall update the
IKE security association with the new address, and shall update the IPsec
security association associated with this IKE security association with the
new address. The UE shall then send an INFORMATIONAL request containing the
UPDATE_SA_ADDRESSES notification to the ePDG.
If, further to this update, the UE receives an INFORMATIONAL request with a
COOKIE2 notification present, the UE shall copy the notification to the
COOKIE2 notification of an INFORMATIONAL response and send it to the ePDG.
### 7.2.4 Tunnel disconnection
#### 7.2.4.1 UE initiated disconnection
The UE shall use the procedures defined in the IKEv2 protocol (see IETF RFC
5996 [28]) to disconnect an IPsec tunnel to the ePDG. The UE shall close the
incoming security associations associated with the tunnel and instruct the
ePDG to do the same by sending the INFORMATIONAL request message including a
\"DELETE\" payload. The DELETE payload shall contain either:
i) Protocol ID set to \"1\" and no subsequent Security Parameters Indexes
(SPIs) in the payload. This indicates closing of IKE security association, and
implies the deletion of all IPsec ESP security associations that were
negotiated within the IKE security association; or
ii) Protocol ID set to \"3\" for ESP. The Security Parameters Indexes included
in the payload shall correspond to the particular incoming ESP security
associations at the UE for the given tunnel in question.
#### 7.2.4.2 UE behaviour towards ePDG initiated disconnection
On receipt of the INFORMATIONAL request message including \"DELETE\" payload,
indicating that the ePDG is attempting tunnel disconnection, the UE shall:
i) Close all security associations identified within the DELETE payload (these
security associations correspond to outgoing security associations from the UE
perspective). If no security associations were present in the DELETE payload,
and the protocol ID was set to \"1\", the UE shall close the IKE security
association, and all IPsec ESP security associations that were negotiated
within it towards the ePDG; and
ii) The UE shall delete the incoming security associations corresponding to
the outgoing security associations identified in the \"DELETE\" payload.
The UE shall send an INFORMATIONAL response message. If the INFORMATIONAL
request message contained a list of security associations, the INFORMATIONAL
response message shall contain a list of security associations deleted in step
(ii) above.
If the UE is unable to comply with the INFORMATIONAL request message, the UE
shall send INFORMATION response message with either:
i) A NOTIFY payload of type \"INVALID_SPI\", for the case that it could not
identify one or more of the Security Parameters Indexes in the message from
the ePDG; or
ii) A more general NOTIFY payload type. This payload type is implementation
dependent.
## 7.3 3GPP AAA server procedures
The UE -- 3GPP AAA server procedures are as specified in 3GPP TS 29.273 [17]
and 3GPP TS 33.402 [15].
## 7.4 ePDG procedures
### 7.4.1 Tunnel establishment
Upon receipt of an IKE_AUTH request message from the UE requesting the
establishment of a tunnel, the ePDG shall proceed with authentication and
authorization. The basic procedure described in 3GPP TS 33.402 [15], while
further details are given below.
During the UE\'s authentication and authorization procedure, the 3GPP AAA
server provides to the ePDG an indication about the selected IP mobility
mechanism as specified in 3GPP TS 29.273 [17].
The ePDG shall proceed with IPsec tunnel setup completion and shall relay in
the IKEv2 Configuration Payload (CFG_REPLY) of the final IKE_AUTH response
message the remote IP address information to the UE. If NBM is used as IP
mobility mechanism, the ePDG shall assign either an IPv4 address or an IPv6
Home Network Prefix or both to the UE via a single CFG_REPLY Configuration
Payload. If the UE requests for both IPv4 address and IPv6 prefix, but the
ePDG only assigns an IPv4 address or an IPv6 Home Network Prefix due to
subscription restriction or network preference, the ePDG shall include the
assigned remote IP address information (IPv4 address or IPv6 prefix) via a
single CFG_REPLY Configuration Payload. If the ePDG assigns an IPv4 address,
the CFG_REPLY contains the INTERNAL_IP4_ADDRESS attribute. If the ePDG assigns
an IPv6 Home Network Prefix, the CFG_REPLY contains the INTERNAL_IP6_SUBNET
configuration attribute. The ePDG obtains the IPv4 address and/or the IPv6
Home Network Prefix from the PDN GW. If the UE does not provide an APN to the
ePDG during the tunnel establishment, the ePDG shall include the default APN
in the IDr payload of the IKE_AUTH response message. If the UE included the
INTERNAL_IP6_DNS or the INTERNAL_IP4_DNS in the CFG_REQUEST Configuration
payload, the ePDG shall include the same attribute in the CFG_REPLY
Configuration payload including zero or more DNS server addresses as specified
in IETF RFC 5996 [28].
If DSMIPv6 is used as IP mobility mechanism, depending on the information
provided by the UE in the CFG_REQUEST payload the ePDG shall assign to the UE
either a local IPv4 address or local IPv6 address (or a local IPv6 prefix) via
a single CFG_REPLY Configuration Payload. If the ePDG assigns a local IPv4
address, the CFG_REPLY contains the INTERNAL_IP4_ADDRESS attribute. If the
ePDG assigns a local IPv6 address or a local IPv6 prefix the CFG_REPLY
contains correspondingly the INTERNAL_IP6_ADDRESS or the INTERNAL_IP6_SUBNET
attribute. If the UE provided an APN to the ePDG during the tunnel
establishment, the ePDG shall not change the provided APN and shall include
the APN in the IDr payload of the IKE_AUTH response message. An IPsec tunnel
is now established between the UE and the ePDG.
If NBM is used and if the ePDG needs to reject a PDN connection due to
conditions as specified in 3GPP TS 29.273 [17] or the network policies or the
ePDG capabilities to indicate that no more PDN connection request of the given
APN can be accepted for the UE, the ePDG shall include, in the IKE_AUTH
response message, a Notify Payload with a Private Notify Message Type
PDN_CONNECTION_REJECTION as specified in subclause 8.1.2. Additionally if the
IKE_AUTH request message from the UE indicated Handover Attach as specified in
subclause 7.2.2, the Notification Data field of the Notify Payload shall
include the IP address information from the Handover Attach indication. If the
UE indicated Initial Attach, the Notification Data field shall be omitted. If
the ePDG needs to reject a PDN connection due to the network policies or
capabilities to indicate that no more PDN connection request with any APN can
be accepted for the UE, the ePDG shall include in the IKE_AUTH response
message containing the IDr payload a Notify Payload with a Private Notify
Message Type MAX_CONNECTION_REACHED as specified in subclause 8.1.2. If the
ePDG determines that UE is not allowed to access EPC due to reasons specified
in 3GPP TS 29.273 [17], the ePDG shall include, in the IKE_AUTH response
message, a Notify Payload with a Notify Message Type AUTHENTICATION_FAILED as
specified in IETF RFC 5996 [28].
If the UE indicates Handover Attach by including the previously allocated home
address information and the ePDG obtains one or more PDN GW identities from
the 3GPP AAA server, the ePDG shall use these identified PDN GWs in the
subsequent PDN GW selection process. If the UE indicates Initial Attach i.e.
home address information not included, the ePDG may run its initial PDN GW
selection process to determine the PDN GW without using the received PDN GW
identities.
The ePDG shall support IPSec ESP (see IETF RFC 4303 [32]) in order to provide
secure tunnels between the UE and the ePDG as specified in 3GPP TS 33.402
[15].
During the IKEv2 authentication and tunnel establishment, if the UE requested
the HA IP address(es) and if DSMIPv6 was chosen and if the HA IP address(es)
are available, the ePDG shall provide the HA IP address(es) (IPv6 address and
optionally IPv4 address) for the corresponding APN as specified by the \"IDr\"
payload in the IKE_AUTH request message by including in the CFG_REPLY
Configuration Payload a HOME_AGENT_ADDRESS attribute. In the CFG_REPLY, the
ePDG sets respectively the IPv6 Home Agent address field and optionally the
IPv4 Home Agent address field of the HOME_AGENT_ADDRESS attribute to the IPv6
address of the HA and to the IPv4 address of the HA. If no IPv4 HA address is
available at the ePDG or if it was not requested by the UE, the ePDG shall
omit the IPv4 Home Agent Address field. If the ePDG is not able to provide an
IPv6 HA address for the corresponding APN, then the ePDG shall not include a
HOME_AGENT_ADDRESS attribute in the CFG_REPLY.
The ePDG may support multiple authentication exchanges in the IKEv2 protocol
as specified in IETF RFC 4739 [49] in order to support additional
authentication and authorization of the UE with an external AAA server.
If the ePDG supports authentication and authorization of the UE with an
external AAA server, on receipt of an IKE_SA_INIT message the ePDG shall
include a Notify payload of type \"MULTIPLE_AUTH_SUPPORTED\" in the
IKE_SA_INIT response message to the UE.
On successful completion of authentication and authorization procedure of the
UE accessing EPC and on receipt of an IKE_AUTH request containing a Notify
payload of type \"ANOTHER_AUTH_FOLLOWS\", the ePDG shall send an IKE_AUTH
response containing the \"AUTH\" payload.
Upon receipt of a subsequent IKE_AUTH request from the UE containing the user
identity in the private network within the \"IDi\" payload, the ePDG shall:
\- if PAP authentication is required, then send an EAP-GTC request to the UE
within an IKE_AUTH response message. Upon receipt of an EAP-GTC response from
the UE, the ePDG shall use the procedures defined in 3GPP TS 29.275 [18] and
3GPP TS 29.274 [50] to authenticate the user with the external AAA server; and
\- if CHAP authentication is required, then send an EAP MD5-Challenge request
to UE. Upon receipt of EAP MD5-Challenge response within an IKE_AUTH request
message from the UE, the ePDG shall use the procedures defined in 3GPP TS
29.275 [18] and 3GPP TS 29.274 [50] to authenticate the user with the external
AAA server. If the ePDG receives Legacy-Nak response containing EAP--GTC type
from the UE (see IETF RFC 3748 [29]) the ePDG may change the authentication
and authorization procedure. If the ePDG does not change the authentication
and authorization procedure or if the ePDG receives a Legacy-Nak response not
containing EAP-GTC, the ePDG shall send an EAP-Failure to the UE.
NOTE: The signalling flows for authentication and authorization with an
external AAA server are described in 3GPP TS 33.402 [15].
### 7.4.2 Tunnel modification
When receiving an INFORMATIONAL request containing the UPDATE_SA_ADDRESSES
notification, the ePDG shall check the validity of the IP address and update
the IP address in the IKE security association with the values from the IP
header. The ePDG shall reply with an INFORMATIONAL response.
The ePDG may initiate a return routability check for the new address provided
by the UE, by including a COOKIE2 notification in an INFORMATIONAL request and
send it to the UE. When the ePDG receives the INFORMATIONAL response from the
UE, it shall check that the COOKIE2 notification payload is the same as the
one it sent to the UE. If it is different, the ePDG shall close the IKE
security association by sending an INFORMATIONAL request message including a
\"DELETE\" payload.
If no return routability check is initiated by the ePDG, or if a return
routability check is initiated and is successfully completed, the ePDG shall
update the IPsec security associations associated with the IKE security
association with the new address.
### 7.4.3 Tunnel disconnection
#### 7.4.3.1 ePDG initiated disconnection
The ePDG shall use the procedures defined in the IKEv2 protocol (see IETF RFC
5996 [28]) to disconnect an IPsec tunnel to the UE. The ePDG shall close the
incoming security associations associated with the tunnel and instruct the UE
to do likewise by sending the INFORMATIONAL request message including a
\"DELETE\" payload. The DELETE payload shall contain either:
i) Protocol ID set to \"1\" and no subsequent Security Parameter Indexes in
the payload. This indicates that the IKE security association, and all IPsec
ESP security associations that were negotiated within it between ePDG and UE
shall be deleted; or
ii) Protocol ID set to \"3\" for ESP. The SECURITY PARAMETERS INDEXES s
included in the payload shall correspond to the particular incoming ESP
SECURITY ASSOCIATION at the UE for the given tunnel in question.
#### 7.4.3.2 ePDG behaviour towards UE initiated disconnection
On receipt of the INFORMATIONAL request message including \"DELETE\" payload
indicating that the UE is initiating tunnel disconnect procedure, the ePDG
shall:
i) Close all security associations identified within the DELETE payload (these
security associations correspond to outgoing security associations from the
ePDG perspective). If no security associations were present in the DELETE
payload, and the protocol ID was set to \"1\", the ePDG shall close the IKE
security association, and all IPsec ESP security associations that were
negotiated within it towards the UE; and
ii) The ePDG shall delete the incoming security associations corresponding to
the outgoing security associations identified in the \"DELETE\" payload.
The ePDG shall send an INFORMATIONAL response message. This shall contain a
list of security associations deleted in step (ii) above.
If the ePDG is unable to comply with the INFORMATIONAL request message, the
ePDG shall send INFORMATION response message with either:
i) a NOTIFY payload of type \"INVALID_SPI\", for the case that it could not
identify one or more of the SECURITY PARAMETERS INDEXES in the message from
the UE; or
ii) a more general NOTIFY payload type. This payload type is implementation
dependent.
# 8 PDUs and parameters specific to the present document
## 8.0 General
The least significant bit of a field is represented by the lowest numbered bit
of the highest numbered octet of the field. When the field extends over more
than one octet, the order of bit values progressively decreases as the octet
number increases.
Figure 8.0-1 shows an example of a field where the most significant bit of the
field is marked MSB and the least significant bit of the field is marked LSB.
* * *
7 6 5 4 3 2 1 0  
MSB x x x x x x x octet 1 x x x x x x x x  
x x x x x x x LSB octet N
* * *
Figure 8.0-1: Example of bit ordering of a field
NOTE: IETF RFCs adopted different numbering of bits, such that the least
significant bit of a field is represented by the highest numbered bit of the
field.
## 8.1 3GPP specific coding information defined within present document
### 8.1.1 Access Network Identity format and coding
#### 8.1.1.1 Generic format of the Access Network Identity
The Access Network Identity shall take the generic format of an octet string
without terminating null characters. The length indicator for the ANID is 2
bytes long, see _IETF RFC 5448_ [38]. Representation as a character string is
allowed, but this character string shall be converted into an octet string of
maximum length 253 according to UTF-8 encoding rules as specified in IETF RFC
3629 [34] before the Access Network Identity is input to the Key Derivation
Function, as specified in 3GPP TS 33.402 [15], or used in the Access Network
Identity indication from 3GPP AAA server to UE, cf. subclause 8.2.2. The ANID
is structured as an ANID Prefix and none, one or more ANID additional
character strings separated by the colon character \":\". In case additional
ANID strings are not indicated the complete ANID consists of the ANID Prefix
character string only. The ANID shall be represented by Unicode characters
encoded as UTF-8 as specified in IETF RFC 3629 [34] and formatted using
Normalization Form KC (NFKC) as specified in Unicode 5.1.0, Unicode Standard
Annex #15; Unicode Normalization Forms [41].
#### 8.1.1.2 Definition of Access Network Identities for Specific Access
Networks
Table 8.1.1.2 specifies the list of Access Network Identities defined by 3GPP
in the context of non-3GPP access to EPC.
Table 8.1.1.2: Access Network Identities
+----------------------+----------------------+----------------------+ | Access Network | Type of Access | | | Identity | Network | | +----------------------+----------------------+----------------------+ | ANID Prefix | Additional ANID | | | | strings | | +----------------------+----------------------+----------------------+ | \"HRPD\" constant | No additional ANID | cdma2000® HRPD | | character string, | string, see NOTE 2 | access network | | see NOTE 1 and | and NOTE 6 | | | NOTE 2 | | | +----------------------+----------------------+----------------------+ | \"WIMAX\" constant | No additional ANID | WiMAX access network | | character string, | string, see NOTE 3 | | | see NOTE 1 | and NOTE 6 | | +----------------------+----------------------+----------------------+ | \"WLAN\" constant | No additional ANID | WLAN access network | | character string, | string, see NOTE 4 | | | see NOTE 1 | and NOTE 6 | | +----------------------+----------------------+----------------------+ | \"ETHERNET\" | No additional ANID | Fixed access network | | constant character | string, see NOTE 5 | | | string, see NOTE 1 | and NOTE 6 | | +----------------------+----------------------+----------------------+ | All other character | Not applicable | Not defined, see | | strings | | NOTE 6 and Annex B | +----------------------+----------------------+----------------------+ | NOTE 1: The quotes | | | | are not part of the | | | | definition of the | | | | character string. | | | | | | | | NOTE 2: The value of | | | | the ANID Prefix for | | | | cdma2000® HRPD | | | | access networks is | | | | defined in 3GPP2 | | | | X.S0057 [20]. | | | | 3GPP2 is responsible | | | | for specifying | | | | possible additional | | | | ANID strings | | | | applicable to the | | | | \"HRPD\" ANID | | | | Prefix. | | | | | | | | NOTE 3: WiMAX Forum | | | | is responsible for | | | | specifying possible | | | | additional ANID | | | | strings applicable | | | | to the \"WIMAX\" | | | | ANID Prefix. | | | | | | | | NOTE 4: IEEE 802 is | | | | responsible for | | | | specifying possible | | | | additional ANID | | | | strings applicable | | | | to the \"WLAN\" ANID | | | | Prefix. | | | | | | | | NOTE 5: IEEE 802 is | | | | responsible for | | | | specifying possible | | | | additional ANID | | | | strings applicable | | | | to the \"ETHERNET\" | | | | ANID Prefix. | | | | | | | | NOTE 6: Additional | | | | ANID Prefixes and | | | | ANID strings can be | | | | added to this table | | | | following the | | | | procedure described | | | | in the informative | | | | Annex B. | | | +----------------------+----------------------+----------------------+
### 8.1.2 IKEv2 Notify Message Type value
#### 8.1.2.1 Generic
The IKEv2 Notify Message Type is specified in IETF RFC 4306 [28]. The value of
Notify Message Type between 8192 and 16383 is reserved for private Error
usage. Only the private IKEv2 Notify Message Type used for this specification
is specified in this subclause.
#### 8.1.2.2 Private Notify Message - Error Types
The Private Notify Message, Error Types defined in table 8.1.2.2-1 are error
notifications which indicates an error while negotiating an IKEv2 SA for the
PDN connection to the APN requested by the UE. Refer to table 8.1.2.2-1 for
more details on what each error type means.
Table 8.1.2.2-1: Private Error Types
+----------------------------+-------+-----------------------------+ | Notify Message | Value | Descriptions | +----------------------------+-------+-----------------------------+ | PDN_CONNECTION_REJECTION | 8192 | With an IP address | | | | information in Notification | | | | Data field: | | | | | | | | > The PDN connection | | | | > corresponding to the IP | | | | > address information has | | | | > been rejected. | | | | | | | | Without Notification Data | | | | field: | | | | | | | | > The PDN connection | | | | > corresponding to the | | | | > requested APN has been | | | | > rejected. No additional | | | | > PDN connections to the | | | | > given APN can be | | | | > established. | | | | > | | | | > If the rejected PDN | | | | > connection is the first | | | | > PDN connection for the | | | | > given APN, this APN is | | | | > not allowed for the UE. | +----------------------------+-------+-----------------------------+ | MAX_CONNECTION_REACHED | 8193 | The PDN connection has been | | | | rejected. No additional PDN | | | | connections can be | | | | established for the UE due | | | | to the network policies or | | | | capabilities. | | | | | | | | The maximum number of PDN | | | | connections per UE allowed | | | | to be established | | | | simultaneously is 11 due to | | | | a limitation in the network | | | | mobility procedures. | +----------------------------+-------+-----------------------------+
### 8.1.3 ANDSF Push Information
#### 8.1.3.1 General
The values of the ANDSF Push Information sent to the UE using the GAA
bootstrap framework for ANDSF Push as specified in subclause 6.8.2.2.2 are
defined in this subclause.
#### 8.1.3.2 ANDSF Push Information values
The ANDSF Push Information defined in table 8.1.3.2-1 indicates the X-WAP-
Application-ID field (Push Application ID) for ANDSF in the WSP header.
Table 8.1.3.2-1: ANDSF Push Information values
* * *
WSP header attribute Value Short code Descriptions X-WAP-Application-ID
x-3gpp.gba.andsf.ua 0x9071 The application identity indicates ANDSF
* * *
### 8.1.4 PDUs for TWAN connection modes
#### 8.1.4.0 General
The PDUs defined in this subclause are used when SCM, MCM or both are
supported.
The sending entity shall set value of spare bit to zero. The receiving entity
shall ignore value of spare bit
#### 8.1.4.1 Message
The message is coded according to figure 8.1.4.1-1 and table 8.1.4.1-1.
+--------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +--------------+---------+---+---+---+---+---+---+---+ | Message type | octet 1 | | | | | | | | +--------------+---------+---+---+---+---+---+---+---+ | Item list | octet 2 | | | | | | | | | | | | | | | | | | | | octet Z | | | | | | | | +--------------+---------+---+---+---+---+---+---+---+
Figure 8.1.4.1-1: Message
Table 8.1.4.1-1: Message
+----------------------------------------------------------------------+ | Message type field is coded according to table 8.1.4.1-2. When value | | other than those listed in table 8.1.4.1-2 is indicated, the message | | is ignored. | | | | Optional item list field contains sequence of items, each of which | | is coded according to subclause 8.1.4.2. The receiving entity does | | not assume that a certain order of items will be used in the item | | list. When the receiving entity does not recognize an item in the | | item list, that particular item is ignored, and the receiving entity | | continues to process the rest of the items in the item list. The | | item list field includes at maximum one item of each type described | | in subclause 8.1.4.2. | +----------------------------------------------------------------------+
Table 8.1.4.1-2: Message type
* * *
The value is coded as follows.  
7 6 5 4 3 2 1 0  
0 0 0 0 0 0 0 1 CONNECTION_CAPABILITY 0 0 0 0 0 0 1 0 SCM_REQUEST 0 0 0 0 0 0
1 1 SCM_RESPONSE 0 0 0 0 0 1 0 0 MCM_REQUEST 0 0 0 0 0 1 0 1 MCM_RESPONSE
* * *
#### 8.1.4.2 Item
The item is coded according to figure 8.1.4.2-1 and table 8.1.4.2-1:
+--------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +--------+---------+---+---+---+---+---+---+---+ | Type | octet 1 | | | | | | | | +--------+---------+---+---+---+---+---+---+---+ | Length | octet 2 | | | | | | | | +--------+---------+---+---+---+---+---+---+---+ | Value | octet 3 | | | | | | | | | | | | | | | | | | | | octet Z | | | | | | | | +--------+---------+---+---+---+---+---+---+---+
Figure 8.1.4.2-1: Item
Table 8.1.4.2-1: Item
* * *
Type field is coded according to the table 8.1.4.2-2. When the type field
contains a type other than those specified in table 8.1.4.2-2, the item is
ignored. Length field indicates the number of octets in the value field. Value
field contains the value of the parameter indicated by the type field.
* * *
Table 8.1.4.2-2: Types of item
* * *
The type field is coded as follows.  
7 6 5 4 3 2 1 0  
0 0 0 0 0 0 0 0 CONNECTIVITY_TYPE 0 0 0 0 0 0 0 1 ATTACHMENT_TYPE 0 0 0 0 0 0
1 0 APN 0 0 0 0 0 0 1 1 PDN_TYPE 0 0 0 0 0 1 0 0 AUTHORIZATIONS 0 0 0 0 0 1 0
1 CONNECTION_MODE_CAPABILITY 0 0 0 0 0 1 1 0 PROTOCOL_CONFIGURATION_OPTIONS 0
0 0 0 0 1 1 1 CAUSE 0 0 0 0 1 0 0 0 IPV4_ADDRESS 0 0 0 0 1 0 0 1
IPV6_INTERFACE_IDENTIFIER 0 0 0 0 1 0 1 0 TWAG_CP_ADDRESS 0 0 0 0 1 0 1 1
TWAG_UP_MAC_ADDRESS 0 0 0 0 1 1 0 0 SUPPORTED_WLCP_TRANSPORTS 0 0 0 0 1 1 0 1
Tw1
* * *
#### 8.1.4.3 CONNECTIVITY_TYPE item
When the type field of the item according to subclause 8.1.4.2 indicates the
CONNECTIVITY_TYPE, then the length field of the item is set to 1 and the value
field of the item is coded according to table 8.1.4.3-1.
Table 8.1.4.3-1: CONNECTIVITY_TYPE value
The value is coded as follows. |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---  
7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |  |   
0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 |  | PDN connection connectivity type  
0 | 0 | 0 | 0 | 0 | 0 | 1 | 0 |  | NSWO connectivity type  
All other values are interpreted as "PDN connection connectivity type". When received by the 3GPP AAA server, then it indicates that the indicated connectivity type is requested. When received by the UE, then it indicates that the indicated connectivity type is authorized. |  |  |  |  |  |  |  |  |   
#### 8.1.4.4 ATTACHMENT_TYPE item
When the type field of the item according to subclause 8.1.4.2 indicates the
ATTACHMENT_TYPE, then the length field of the item is set to 1 and the value
field of the item is coded according to table 8.1.4.4-1.
Table 8.1.4.4-1: ATTACHMENT_TYPE value
* * *
The value is coded as follows.  
7 6 5 4 3 2 1 0  
0 0 0 0 0 0 0 1 Initial attach 0 0 0 0 0 0 1 0 Handover attach All other
values are interpreted as \"Initial attach\".
* * *
#### 8.1.4.5 APN item
When the type field of the item according to subclause 8.1.4.2 indicates the
APN, then the value field of the item contains the APN as described in 3GPP TS
23.003 [3]. When received by the 3GPP AAA server, it indicates the requested
APN. When received by the UE, it indicates the selected APN.
#### 8.1.4.6 PDN_TYPE item
When the type field of the item according to subclause 8.1.4.2 indicates the
PDN_TYPE, then the length field of the item is set to 1 and the value field of
the item is coded according to table 8.1.4.6-1.
Table 8.1.4.6-1: PDN_TYPE value
* * *
The value is coded as follows.  
7 6 5 4 3 2 1 0
0 0 0 0 0 0 0 1 IPv4 - when received by the 3GPP AAA server, it indicates that
IPv4 is requested. When received by the UE, it indicates that IPv4 is
supported.
0 0 0 0 0 0 1 0 IPv6 - when received by the 3GPP AAA server, it indicates that
IPv6 is requested. When received by the UE, it indicates that IPv6 is
supported.
0 0 0 0 0 0 1 1 IPv4v6 - when received by the 3GPP AAA server, it indicates
that IPv4, IPv6 or both are requested. When received by the UE, it indicates
that both IPv4 and IPv6 are supported. All other values are interpreted as
\"IPv6\".
* * *
#### 8.1.4.7 AUTHORIZATIONS item
When the type field of the item according to subclause 8.1.4.2 indicates the
AUTHORIZATIONS, then the length field of the item is set to 1 and the value
field of the item is coded according to figure 8.1.4.7-1 and table 8.1.4.7-1.
7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |  |   
---|---|---|---|---|---|---|---|---|---  
0 Spare | 0 Spare | 0 Spare | 0 Spare | 0 Spare | 0 Spare | 0 Spare | NSWOA | octet 1 |   
Figure 8.1.4.7-1: AUTHORIZATIONS value
Table 8.1.4.7-1: AUTHORIZATIONS value
* * *
The value is coded as follows:  
UE authorization to use NSWO (NSWOA) (octet 1, bit 0)  
0 UE is not authorized to use NSWO 1 UE is authorized to use NSWO
Bit 1 to bit 7 of octet 1 are spare.
* * *
#### 8.1.4.8 CONNECTION_MODE_CAPABILITY item
When the type field of the item according to subclause 8.1.4.2 indicates the
CONNECTION_MODE_CAPABILITY, then the length field of the item is set to 1 and
the value field of the item is coded according to figure 8.1.4.8-1 and table
8.1.4.8-1.
+-------+-------+-------+-------+-------+-------+------+------+---------+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +-------+-------+-------+-------+-------+-------+------+------+---------+ | 0 | 0 | 0 | 0 | 0 | TSMCI | MCMI | SMCI | octet 1 | | | | | | | | | | | | Spare | Spare | Spare | Spare | Spare | | | | | +-------+-------+-------+-------+-------+-------+------+------+---------+
Figure 8.1.4.8-1: CONNECTION_MODE_CAPABILITY value
Table 8.1.4.8-1: CONNECTION_MODE_CAPABILITY value
* * *
The value is coded as follows:  
Support of SCM (SCMI) (octet 1, bit 0)  
0 SCM is not supported 1 SCM is supported
Support of MCM (MCMI) (octet 1, bit 1)  
0 MCM is not supported 1 MCM is supported
Support of TSCM (TSCMI) (octet 1, bit 2)  
0 TSCM is not supported 1 TSCM is supported
Bit 3 to bit 7 of octet 1 are spare.
* * *
#### 8.1.4.9 PROTOCOL_CONFIGURATION_OPTIONS item
When the type field of the item according to subclause 8.1.4.2 indicates the
PROTOCOL_CONFIGURATION_OPTIONS, then the value field of the item is coded as
the value part (as specified in TS 24.007 [48] for type 4 IE) of the protocol
configuration options information element defined in 3GPP TS 24.008 [46]
subclause 10.5.6.3.
NOTE: The protocol configuration options IEI field and the length of protocol
config. options contents field of the protocol configuration options
information element are not included in the value of the
PROTOCOL_CONFIGURATION_OPTIONS item.
#### 8.1.4.10 CAUSE item
##### 8.1.4.10.1 General
When the type field of the item according to subclause 8.1.4.2 indicates the
CAUSE, then the length field of the item is set to 1 and the value field of
the item is coded according to table 8.1.4.10-1. If the CAUSE item is received
by the 3GPP AAA server, the item is ignored.
Semantic of the values is defined in subclause 8.1.4.10.2.
Table 8.1.4.10-1: CAUSE value
* * *
The value is coded as follows.  
7 6 5 4 3 2 1 0  
0 0 0 0 1 0 0 0 Operator determined barring 0 0 0 1 1 0 1 0 Insufficient
resources 0 0 0 1 1 0 1 1 Unknown APN 0 0 0 1 1 1 0 0 Unknown PDN type 0 0 0 1
1 1 1 0 Request rejected by PDN GW 0 0 0 1 1 1 1 1 Request rejected,
unspecified 0 0 1 0 0 0 0 0 Service option not supported 0 0 1 0 0 0 0 1
Requested service option not subscribed 0 0 1 0 0 0 1 0 Service option
temporarily out of order 0 0 1 0 0 1 1 0 Network failure 0 0 1 1 0 0 1 0 PDN
type IPv4 only allowed 0 0 1 1 0 0 1 1 PDN type IPv6 only allowed 0 1 1 0 1 1
1 1 Protocol error, unspecified All other values received by the UE are
treated as 01101111, \"Protocol error, unspecified\".
* * *
##### 8.1.4.10.2 Causes
Cause #8 - Operator determined barring
This cause is used by the network to indicate that the requested service was
rejected due to operator determined barring.
Cause #26 - Insufficient resources
This cause is used by the network to indicate that the requested service
cannot be provided due to insufficient resources.
Cause #27 - Unknown APN
This cause is used by the network to indicate that the requested service was
rejected because the access point name could not be resolved.
Cause #28 - Unknown PDN type
This cause is used by the network to indicate that the requested service was
rejected by the external packet data network because the PDN type could not be
recognised.
Cause #30 - Request rejected by PDN GW
This cause is used by the network to indicate that the requested service or
operation was rejected by the PDN GW.
Cause #31 - Request rejected, unspecified
This cause is used by the network to indicate that the requested service or
operation was rejected due to unspecified reasons.
Cause #32 - Service option not supported
This cause is used by the network when the UE requests a service which is not
supported by the PLMN.
Cause #33 - Requested service option not subscribed
This cause is sent when the UE requests a service option for which it has no
subscription.
Cause #34 - Service option temporarily out of order
This cause is sent when the network cannot service the request because of
temporary outage of one or more functions required for supporting the service.
Cause #38 - Network failure
This cause is used by the network to indicate that the requested service was
rejected due to an error situation in the network.
Cause #50 - PDN type IPv4 only allowed
This value is used by the network to indicate that only PDN type IPv4 is
allowed for the requested PDN connectivity.
Cause #51 - PDN type IPv6 only allowed
This value is used by the network to indicate that only PDN type IPv6 is
allowed for the requested PDN connectivity.
Cause #111 - Protocol error, unspecified
This value is used to report a protocol error event only when no other value
applies.
This subclause shows the numbers in the decimal numeration system.
#### 8.1.4.11 IPV4_ADDRESS item
When the type field of the item according to subclause 8.1.4.2 indicates the
IPV4_ADDRESS, then the length field of the item is set to 4 and the value
field of the item contains an IPv4 address allocated to the UE for the PDN
connection.
#### 8.1.4.12 IPV6_INTERFACE_IDENTIFIER item
When the type field of the item according to subclause 8.1.4.2 indicates the
IPV6_INTERFACE_IDENTIFIER, then the length field of the item is set to 8 and
the value field of the item contains an IPv6 interface identifier allocated to
the UE for the PDN connection to be used to build the IPv6 link local address.
#### 8.1.4.13 TWAG_CP_ADDRESS item
When the type field of the item according to subclause 8.1.4.2 indicates the
TWAG_CP_ADDRESS, then the value field of the item contains one or two TWAG
control plane addresses and is coded according to figure 8.1.4.13-1 and table
8.1.4.13-1.
+----------------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +----------------------+---------+---+---+---+---+---+---+---+ | TWAG CP address type | octet 1 | | | | | | | | +----------------------+---------+---+---+---+---+---+---+---+ | TWAG CP addresses | octet 2 | | | | | | | | | | | | | | | | | | | | octet Z | | | | | | | | +----------------------+---------+---+---+---+---+---+---+---+
Figure 8.1.4.13-1: TWAG_CP_ADDRESS item value
Table 8.1.4.13-1: TWAG_CP_ADDRESS item value
* * *
The value is coded as follows:
Value of the TWAG CP address type field (octet 1) is coded as follows.  
7 6 5 4 3 2 1 0  
0 0 0 0 0 0 0 1 IPv4 0 0 0 0 0 0 1 0 IPv6 0 0 0 0 0 0 1 1 IPv4IPv6 All other
values of the TWAG CP address type field are interpreted as \"IPv4\".
If the TWAG CP address type field indicates IPv4, then the TWAG CP addresses
field contains one TWAG control plane address consisting of an IPv4 address in
octet 2 to octet 5.
If the TWAG CP address type field indicates IPv6, then the TWAG CP addresses
field contains one TWAG control plane address consisting of an IPv6 address in
octet 2 to octet 17.
If the TWAG CP address type field indicates IPv4IPv6, then the TWAG CP
addresses field contains two TWAG control plane addresses. The first TWAG
control plane address consists of an IPv4 address in octet 2 to octet 5, the
second TWAG control plane address consists of an IPv6 address in octet 6 to
octet 21.
* * *
#### 8.1.4.14 TWAG_UP_MAC_ADDRESS item
When the type field of the item according to subclause 8.1.4.2 indicates the
TWAG_UP_MAC_ADDRESS, then the length field of the item is set to 6 and the
value field of the item contains a TWAG user plane MAC address allocated to
the PDN connection. The MAC address is defined in subclause 8 of IEEE Std 802
[58].
#### 8.1.4.15 SUPPORTED_WLCP_TRANSPORTS item
When the type field of the item according to subclause 8.1.4.2 indicates the
SUPPORTED_WLCP_TRANSPORTS, then the length field of the item is set to 1 and
the value field of the item is coded according to figure 8.1.4.15-1 and table
8.1.4.15-1.
+-------+-------+-------+-------+-------+-------+---------------+---------------+---------+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +-------+-------+-------+-------+-------+-------+---------------+---------------+---------+ | 0 | 0 | 0 | 0 | 0 | 0 | WLCPoUDPoIPv6 | WLCPoUDPoIPv4 | octet 1 | | | | | | | | | | | | Spare | Spare | Spare | Spare | Spare | Spare | | | | +-------+-------+-------+-------+-------+-------+---------------+---------------+---------+
Figure 8.1.4.15-1: SUPPORTED_WLCP_TRANSPORTS value
Table 8.1.4.15-1: SUPPORTED_WLCP_TRANSPORTS value
* * *
The value is coded as follows:
WLCP over UDP over IPv4 support (WLCPoUDPoIPv4) (octet 1, bit 0)  
0 WLCP over UDP over IPv4 is not supported. 1 WLCP over UDP over IPv4 is
supported.
WLCP over UDP over IPv6 support (WLCPoUDPoIPv6) (octet 1, bit 1)  
0 WLCP over UDP over IPv6 is not supported. 1 WLCP over UDP over IPv6 is
supported.
Bit 2 to bit 7 of octet 1 are spare.
* * *
#### 8.1.4.16 Tw1 item
When the type field of the item according to subclause 8.1.4.2 indicates the
Tw1, then the value field of the item is coded as the value part (as specified
in TS 24.007 [48] for type 4 IE) of the GPRS timer 3 information element
defined in 3GPP TS 24.008 [46] subclause 10.5.7.4a.
NOTE: The GPRS Timer 3 IEI field and the length of GPRS Timer 3 contents field
of the GPRS timer 3 information element are not included in the value of the
Tw1 item.
## 8.2 IETF RFC coding information defined within present document
### 8.2.1 IPMS attributes
#### 8.2.1.1 AT_IPMS_IND attribute
+--------------------------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +--------------------------------+---------+---+---+---+---+---+---+---+ | Attribute Type = AT_IPMS_IND | octet 1 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+ | Length = 1 | octet 2 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+ | Value | octet 3 | | | | | | | | | | | | | | | | | | | | octet 4 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+
Figure 8.2.1.1: AT_IPMS_IND attribute
Table 8.2.1.1: AT_IPMS_IND attribute
* * *
Octet 1 indicates the type of attribute as AT_IPMS_IND with a value of 137.  
Octet 2 is the length of this attribute which shall be set to 1 as per IETF
RFC 4187 [33]  
Octet 3 and 4 is the value of this attribute. Octet 3 is reserved and shall be
coded as zero. Octet 4 shall be set as follows. All other values are reserved.  
7 6 5 4 3 2 1 0 Protocol Supported 0 0 0 0 0 0 0 1 DSMIPv6 only 0 0 0 0 0 0 1
0 NBM only 0 0 0 0 0 0 1 1 MIPv4 only 0 0 0 0 0 1 0 0 DSMIPv6 and NBM both
supported 0 0 0 0 0 1 0 1 MIPv4 and NBM both supported 0 0 0 0 0 1 1 0 DSMIPv6
and NBM Supported;DSMIPv6 preferred 0 0 0 0 0 1 1 1 DSMIPv6 and NBM Supported;
NBM preferred 0 0 0 0 1 0 0 0 MIPv4 and NBM supported; MIPv4 preferred 0 0 0 0
1 0 0 1 MIPv4 and NBM supported; NBM preferred 0 0 0 0 1 0 1 0 MIPv4 and
DSMIPv6 supported; MIPv4 preferred 0 0 0 0 1 0 1 1 MIPv4 and DSMIPv6
supported; DSMIPv6 preferred 0 0 0 0 1 1 0 0 MIPv4, DSMIPv6 and NBM supported;
MIPv4 preferred 0 0 0 0 1 1 0 1 MIPv4, DSMIPv6 and NBM supported; DSMIPv6
preferred 0 0 0 0 1 1 1 0 MIPv4, DSMIPv6 and NBM supported; NBM preferred
* * *
#### 8.2.1.2 AT_IPMS_RES attribute
+--------------------------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +--------------------------------+---------+---+---+---+---+---+---+---+ | Attribute Type = AT_IPMS_RES | octet 1 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+ | Length = 1 | octet 2 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+ | Value | octet 3 | | | | | | | | | | | | | | | | | | | | octet 4 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+
Figure 8.2.1.2: AT_IPMS_RES attribute.
Table 8.2.1.2: AT_IPMS_RES attribute
* * *
Octet 1 indicates the type of attribute as AT_IPMS_RES with a value of 138.  
Octet 2 is the length of this attribute which shall be set to 1 as per IETF
RFC 4187 [33]  
Octet 3 and 4 is the value of this attribute. Octet 3 is reserved and shall be
coded as zero. Octet 4 shall be set as follows. All other values are reserved.  
7 6 5 4 3 2 1 0 Protocol Selected 0 0 0 0 0 0 0 1 DSMIPv6 0 0 0 0 0 0 1 0 NBM
0 0 0 0 0 0 1 1 MIPv4
* * *
### 8.2.2 Access Network Identity indication attribute
#### 8.2.2.1 Access Network Identity in the AT_KDF_INPUT attribute
The Access Network Identity is indicated in the Network Name Field of the
AT_KDF_INPUT attribute as specified in _IETF RFC 5448_ [38]. The Network Name
Field shall contain the Access Network Identity as specified in subclause
8.1.1 of this specification.
NOTE: IETF in _IETF RFC 5448_ [38] refers to this specification for the value
of the Network Name field.
### 8.2.3 Trust relationship indication attribute
#### 8.2.3.1 AT_TRUST_IND attribute
+---------------------------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +---------------------------------+---------+---+---+---+---+---+---+---+ | Attribute Type = AT_TRUST_IND | octet 1 | | | | | | | | +---------------------------------+---------+---+---+---+---+---+---+---+ | Length = 1 | octet 2 | | | | | | | | +---------------------------------+---------+---+---+---+---+---+---+---+ | Value | octet 3 | | | | | | | | | | | | | | | | | | | | octet 4 | | | | | | | | +---------------------------------+---------+---+---+---+---+---+---+---+
Figure 8.2.3.1-1: AT_TRUST_IND attribute
Table 8.2.3.1-1: AT_TRUST_IND attribute
* * *
Octet 1 indicates the type of attribute as AT_TRUST_IND with a value of 139.  
Octet 2 is the length of this attribute which shall be set to 1 as per IETF
RFC 4187 [33]  
Octet 3 and 4 is the value of the attribute. Octet 3 is reserved and shall be
coded as zero. Octet 4 shall be set as follows. All other values are reserved.  
7 6 5 4 3 2 1 0 Indicated Trust Relationship 0 0 0 0 0 0 0 1 Trusted 0 0 0 0 0
0 1 0 UnTrusted
* * *
### 8.2.4 IKEv2 Configuration Payloads attributes
#### 8.2.4.1 HOME_AGENT_ADDRESS attribute
The HOME_AGENT_ADDRESS attribute is shown in figure 8.2.4.1-1. The length of
the HOME_AGENT_ADDRESS attribute is 16 or 20 bytes. The IPv4 Home Agent
Address field is optional. The HA\'s IPv6 and IPv4 addresses are laid out
respectively in IPv6 Home Agent Address and IPv4 Home Agent Address fields in
big endian order (aka most significant byte first, or network byte order), see
IETF RFC 5996 [28].
* * *
Bits  
7 6 5 4 3 2 1 0 Octets R Attribute Type 1  
Attribute Type 2  
Length 3, 4  
IPv6 Home Agent Address 5 - 20  
IPv4 Home Agent Address 21 - 24
* * *
Figure 8.2.4.1-1: HOME_AGENT_ADDRESS attribute
The R bit in the first octet is defined in IETF RFC 5996 [28].
The Attribute Type indicating HOME_AGENT_ADDRESS is of the value 19.
### 8.2.5 Full name for network and short name for network
#### 8.2.5.1 AT_FULL_NAME_FOR_NETWORK attribute
The AT_FULL_NAME_FOR_NETWORK attribute is coded according to figure 8.2.5.1-1
and table 8.2.5.1-1.
+-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | Attribute Type = AT_FULL_NAME_FOR_NETWORK | octet 1 | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | Length | octet 2 | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | Full name length | octet 3 | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | Full name value | octet 4 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | Padding | octet n+1 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+
Figure 8.2.5.1-1: AT_FULL_NAME_FOR_NETWORK attribute
Table 8.2.5.1-1: AT_FULL_NAME_FOR_NETWORK attribute
* * *
Octet 1 indicates the type of this attribute as AT_FULL_NAME_FOR_NETWORK with
a value of 141. Octet 2 is the length of this attribute in multiples of 4
octets as specified in RFC 4187 [33]. Octet 3 is the full name length field
and contains the length of the full name value field in octets. The full name
value field starts at octet 4 and its length is indicated by the full name
length field. The full name value field indicates the \"full length name of
the network\" that the network wishes the UE to associate with MCC and MNC in
the realm of the NAI used during authentication. The structure of the full
name value field is the same as the structure of the Network Name defined in
3GPP TS 24.008 [46] subclause 10.5.3.5a except for the Network Name IEI and
the Length of Network Name contents which are not included. The optional
padding field starts after the last octet of the full name value field. Each
octet of this field is set to zero by sending entity and ignored by receiving
entity.
* * *
#### 8.2.5.2 AT_SHORT_NAME_FOR_NETWORK attribute
The AT_SHORT_NAME_FOR_NETWORK attribute is coded according to figure 8.2.5.2-1
and table 8.2.5.2-1.
+------------------------------------------------+-----------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Attribute Type = AT_SHORT_NAME_FOR_NETWORK | octet 1 | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Length | octet 2 | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Short name length | octet 3 | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Short name value | octet 4 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Padding | octet n+1 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+
Figure 8.2.5.2-1: AT_SHORT_NAME_FOR_NETWORK attribute
Table 8.2.5.2-1: AT_SHORT_NAME_FOR_NETWORK attribute
* * *
Octet 1 indicates the type of this attribute as AT_SHORT_NAME_FOR_NETWORK with
a value of 140. Octet 2 is the length of this attribute in multiples of 4
octets as specified in RFC 4187 [33]. Octet 3 is the short name length field
and contains the length of the short name value field in octets. The short
name value field starts at octet 4 and its length is indicated by the short
name length field. The short name value field indicates the \"abbreviated name
of the network\" that the network wishes the UE to associate with MCC and MNC
in the realm of the NAI used during authentication. The structure of the short
name value field is the same as the structure of the Network Name defined in
3GPP TS 24.008 [46] subclause 10.5.3.5a except for the Network Name IEI and
the Length of Network Name contents which are not included. The optional
padding field starts after the last octet of the short name value field. Each
octet of this field is set to zero by sending entity and ignored by receiving
entity.
* * *
### 8.2.6 Handling of the unknown protocol data
If the receiving entity receives an unknown value in a recognized skippable
attribute in an EAP-AKA or EAP-AKA\' message, the receiving entity shall
ignore the attribute and shall handle the rest of the message. The definition
of skippable attribute see the RFC 4187 [33]. The receiving entity handling of
the unrecognized skippable attribute is as specified in RFC 4187 [33].
### 8.2.7 Attributes for TWAN connection modes
#### 8.2.7.1 AT_TWAN_CONN_MODE attribute
The AT_TWAN_CONN_MODE attribute is coded according to figure 8.2.7.1-1 and
table 8.2.7.1-1.
+---------------------------------------+-----------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Attribute type = AT_TWAN_CONN_MODE | octet 1 | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Length | octet 2 | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Padding length | octet 3 | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Message | octet 4 | | | | | | | | | | | | | | | | | | | | octet Y | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Padding | octet Y+1 | | | | | | | | | | | | | | | | | | | | octet Z | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+
Figure 8.2.7.1-1: AT_TWAN_CONN_MODE attribute
Table 8.2.7.1-1: AT_TWAN_CONN_MODE attribute
* * *
Octet 1 indicates the type of attribute as AT_TWAN_CONN_MODE with a value of
144. This attribute is skippable. Octet 2 is the length of this attribute in
multiples of 4 octets as specified in RFC 4187 [33]. Padding length field
contains the length of the padding field. Message field is coded according to
subclause 8.1.4.1. The length of the message field is determined from the
length field and the padding length field. Each octet of the padding field is
set to zero by sending entity and ignored by receiving entity.
* * *
###### ## Annex A (informative): Example signalling flows for inter-system
change between 3GPP and non-3GPP systems using ANDSF
# A.1 Scope of signalling flows
This annex gives examples of signalling flows for mobility between 3GPP and
non-3GPP systems. These signalling flows provide as example detailed
information on Network Discovery and Selection aspects involving the use of
ANDSF.
# A.2 Signalling flow for inter-system change between 3GPP access network and
non-3GPP access network
Figure A1 below shows an inter-system change procedure between 3GPP access
network and non-3GPP access network using information obtained from ANDSF.
In this example the UE uses DHCP query to obtain the IP address of the ANDSF.
In this example flow, the communication between the UE and ANDSF does not
imply use of any specific protocol.
The steps involved in inter-system change between 3GPP access network and
non-3GPP access network are as follows.
Figure A1. Procedure for Inter-system change between 3GPP access and non-3GPP
using ANDSF
**1\. Initial connectivity**
The UE is connected to 3GPP network. The current applications are supported
over the 3GPP access network.
NOTE: The procedure remains the same if the UE is initially connected to
non-3GPP access network and wants to change to 3GPP access network.
**2\. Pre-provisioned policies**
The inter-system mobility policy is pre-provisioned on the UE. Based on pre-
provisioned operator policies the UE has preference for different non-3GPP
networks such as WLAN, and WiMAX. The UE can select these access networks when
they are available.
**3\. ANDSF Discovery**
ANDSF discovery is performed as described in subclause 6.8.2.2.1. The UE can
discover ANDSF using DHCP query options as specified in IETF RFC 6153 [37],
where ANDSF may be identified with a specific sub-option code. Optionally, the
home operator can use OMA-DM\'s bootstrap mechanism as specified in OMA-ERELD-
DM-V1_2 [39] to provide ANDSF information and security parameters for
application layer authentication. Transport security is ensured by
establishing an https tunnel between the UE and ANDSF,
**4\. Policy Update based on Network Triggers**
Based on network triggers the ANDSF sends an updated inter-system mobility
policy to the UE. The inter-system mobility policy includes validity
conditions, i.e. conditions indicating when the policy is valid. Such
conditions can include time duration, location area, etc.
**5\. Evaluate which non-3GPP networks to discover**
The inter-system mobility policies specify the access networks that the UE can
select; the UE has both WLAN and WiMAX radios. In this case, the inter-system
mobility policy provided by the operator allows the UE to select either WLAN
or WiMAX networks under all conditions. The UE, taking into account of the
UE\'s local policy, e.g. user preference settings, access history, obtains
information about availability of both WLAN and WiMAX access networks in its
vicinity.
**6\. Access Network Information Request**
The UE sends a request to ANDSF to get information about available access
networks. The UE also includes its location information in the request. ANDSF
can limit the information sent to UE based on internal settings.
**7\. Access Network Information Response**
The ANDSF sends a response to the UE which includes the list of available
access networks types (in order of operator preferences), access network
identifier and PLMN identifier. In this case the ANDSF responds with
availability of both WLAN and WiMAX network in the vicinity of the UE.
**8\. Evaluate candidate non-3GPP networks**
Based on the received information and UE\'s local policy, the UE evaluates if
it is within the coverage area of the available access networks in the order
of preferences. In this case,based on the history and radio quality of WiMAX,
the UE prefers WiMAX over WLAN access type. The UE powers on the WiMAX radio
and checks for the presence of WiMAX network. The UE can listen to WiMAX
broadcast messages (uplink/downlink channel data messages) and determines the
presence of WiMAX network. Since the WiMAX network is the preferred network
and since the UE has verified the presence of WiMAX network, the UE does not
check for presence of WLAN network.
**9\. Non-3GPP Network Selection**
The UE selects the most preferred available access network for inter-system
mobility. In this case the UE selects the WiMAX access network.
**10\. Inter-system change Procedure**
The UE initiates inter-system change procedure to the selected non-3GPP access
network. The details of the inter-system change procedure are described
elsewhere, see 3GPP TS 23.402 [6].
###### ## Annex B (informative): Assignment of Access Network Identities in
3GPP
This annex describes the recommended assignment procedure of Access Network
Identities within 3GPP.
# B.1 Access Network Identities
According to 3GPP TS 23.003 [3] the encoding of the Access Network Identity is
specified within 3GPP, but the Access Network Identity definition for each
non-3GPP access network is under the responsibility of the corresponding
standardisation organisation respectively.
If a standardisation organisation for a non-3GPP access network determines
they need to define a new Access Network Identity Prefix or additional ANID
strings, they can contact the 3GPP TSG-CT WG 1 via a Liaison Statement and
indicate the specific values of the Access Network Identity Prefixes or the
specific values of, or construction principles for, the additional ANID
strings to be specified by 3GPP and give reference to the corresponding
specification(s) of the requesting organisation. 3GPP TSG CT WG 1 will then
specify the values for the Access Network Identities by updating Table 8.1.1.2
in this specification and inform the requesting standardisation organisation.
###### ## Annex C (informative): Example usage of ANDSF
# C.1 Scope of ANDSF Example
This Annex gives an example of organization of ANDSF database and how it can
be used to discover access network information. In this example the UE is in
3GPP network and is trying to discover available WiMAX networks. The ANDSF
database is provided by the 3GPP operator with PLMN = PLMN_3GPP.
# C.2 Organization of ANDSF Coverage Map for WiMAX Network discovery
Table C1 illustrates the organization of ANDSF database for discovering WiMAX
and WiFi networks. The ANDSF database provides the coverage mapping
information for WiMAX and WiFi networks based on 3GPP cell identifiers. In
this example the UE_Location can be specified either in terms of 3GPP
parameters (PLMN + Cell Identifier) or in terms of geo spatial co-ordinates.
Table C1: ANDSF Database Organization for PLMN = PLMN_3GPP
+--------------------+---------------------+---------------------------+ | UE_Location | AccessType = WiMAX | AccessType = WiFi | | | | | | - 3GPP (CellId) | | | | | | | | - Other (Geopriv) | | | +--------------------+---------------------+---------------------------+ | Locn_1 | NSP-ID= NSP_1: | SSID = WiFi1, BSSID = BS1 | | | | | | Cell_Id = Cell_1 | -NAP_ID = NAP_1 | SSID = WiFi2, BSSID = BS2 | | | | | | | -NAP_ID = NAP_2 | | | | | | | | NSP-ID = NSP_2 | | | | | | | | -NAP_ID = NAP_2 | | | | | | | | -NAP_ID = NAP_3 | | +--------------------+---------------------+---------------------------+ | Locn_2 | NSP-ID = NSP_2 | N/A | | | | | | Cell_Id = Cell_2 | - NAP_ID = NAP_3 | | +--------------------+---------------------+---------------------------+ | Locn_3 | N/A | SSID = WiFi1, BSSID = BS3 | | | | | | Cell_Id = Cell_3 | | SSID = WiFi4, BSSID = BS4 | +--------------------+---------------------+---------------------------+ | ..... | ....... | ....... | +--------------------+---------------------+---------------------------+ | Locn_n | NSP-ID = NSP_1 | SSID = WiFi6, BSSID = BS5 | | | | | | Cell_Id = Cell_n | NAP_ID = NAP_2 | | +--------------------+---------------------+---------------------------+
For WiMAX network the database provides information about WiMAX NSP and NAP
that provide coverage in respective 3GPP cells. Thus for example in 3GPP
Cell_1, WiMAX Service provider NSP_1 provides service to WiMAX radio access
providers NAP_1 and NAP-2. Similarly WiMAX Service Provider NSP_2 provides
service to Network access providers NAP-2 and NAP_3 as well. Similarly in 3GPP
Cell_2 WiMAX Network Service Provider NSP_2 provides service to network Access
Provider NAP_3. Further it can be seen that no WiMAX coverage is available in
3GPP cell Cell_3.
# C.3 Parameters in Pull mode
The UE is currently in 3GPP network. The UE sends a query to OMA ANDSF server
as follows:
ANDSF_Query ( UE_Location, AccessNetworkType=WiMAX )
The UE specifies the UE_Location information in terms of current 3GPP Cell Id
(e.g. Cell_2)
On receipt of the query message the ANDSF looks up the UE_Location (Cell_2) in
the ANDSF database and searches for a prospective WiMAX entry. In this case
the ANDSF retrieves WiMAX Service provider identifier (NSP-ID) NSP_2 and WiMAX
Network Access Provider Identifier (NAP-ID) NAP_3. The ANDSF retrieves the
network parameters for this combination. The ANDSF fills these parameters in
the WNDS MO and sends the information back to the UE.
ANDSF_Response ( UE_Location, AccessNetworkInformationRef MO=WIMAXNDS).
###### ## Annex D (informative): Mismatch of static configuration of mobility
mechanism in the UE and in the network
This annex describes the possible cases of mismatch between the statically
configured mobility mechanisms in the UE and in the EPC as shown in table D1.
Additionally the table shows whether the UE would be able to access EPC
services as a consequence of the mismatch.
Table D1: Mismatch of static configuration of mobility mechanism in the UE and
in the network
+----------------+----------------+----------------+----------------+ | | NBM configured | DSMIPv6 | MIPv4 | | | in the network | configured in | configured in | | | | the network | the network | +----------------+----------------+----------------+----------------+ | NBM configured | No mismatch | Mismatch. The | Mismatch. The | | in the UE | | UE is not able | UE is not able | | | | to access EPC | to access EPC | | | | services | services | | | | because the UE | because the UE | | | | configures a | does not | | | | local IP | support | | | | address and | communication | | | | there is no | with the | | | | connectivity | Foreign Agent | | | | to the PGW in | in the trusted | | | | the EPC. | non-3GPP | | | | Depending on | network. | | | | operator\'s | | | | | policy and | | | | | roaming | | | | | agreements, | | | | | local IP | | | | | access | | | | | services (e.g. | | | | | Internet | | | | | access) can be | | | | | provided in | | | | | the non-3GPP | | | | | network using | | | | | the local IP | | | | | address. | | | | | However, such | | | | | local IP | | | | | access | | | | | services, | | | | | where the user | | | | | traffic does | | | | | not traverse | | | | | the EPC, are | | | | | not described | | | | | in this | | | | | specification. | | +----------------+----------------+----------------+----------------+ | DSMIPv6 | Mismatch. The | No mismatch | Mismatch. The | | configured in | UE can be able | | UE is not able | | the UE | to access EPC | | to access EPC | | | services. | | services | | | After attach | | because the UE | | | to the | | does not | | | non-3GPP | | support | | | network, the | | communication | | | UE is on the | | with the | | | home link and | | Foreign Agent | | | configures an | | in the trusted | | | IP address | | non-3GPP | | | based on the | | network. | | | HNP, however | | | | | in some cases | | | | | the UE cannot | | | | | detect the | | | | | home link. | | | | | Since the UE | | | | | is configured | | | | | with DSMIPv6, | | | | | the UE would | | | | | initiate a | | | | | DSMIPv6 | | | | | bootstrapping: | | | | | | | | | | - If the | | | | | network offers | | | | | a HA function | | | | | to the UE and | | | | | if the | | | | | bootstrapping | | | | | is successful, | | | | | the UE detects | | | | | that it is | | | | | attached to | | | | | the home link. | | | | | Depending of | | | | | the UE | | | | | capabilities | | | | | and the | | | | | network | | | | | configuration, | | | | | the UE can | | | | | access EPC | | | | | services via | | | | | the S2a/S2b | | | | | interface, but | | | | | session | | | | | continuity is | | | | | not supported. | | | | | | | | | | - If the | | | | | network does | | | | | not offer a HA | | | | | function or if | | | | | the | | | | | bootstrapping | | | | | to the HA is | | | | | not | | | | | successful, | | | | | the UE is not | | | | | able to | | | | | receive its | | | | | Home Network | | | | | Prefix and | | | | | hence the UE | | | | | cannot detect | | | | | that it is on | | | | | the home link. | | | | | If no APN | | | | | bound to the | | | | | configured IP | | | | | address was | | | | | received and | | | | | the access | | | | | network does | | | | | not support | | | | | APN delivery, | | | | | the UE would | | | | | not recognize | | | | | the mismatch | | | | | and cannot | | | | | access EPC | | | | | services. If | | | | | the access | | | | | network | | | | | supports APN | | | | | delivery and | | | | | the configured | | | | | IP address is | | | | | bound to an | | | | | APN, the UE | | | | | can access EPC | | | | | services. | | | +----------------+----------------+----------------+----------------+ | MIPv4 | Mismatch. The | Mismatch. The | No mismatch | | configured in | UE is not able | UE is not able | | | the UE | to access EPC | to access EPC | | | | services | services | | | | because no | because no | | | | Foreign Agent | Foreign Agent | | | | functionality | functionality | | | | is supported | is supported | | | | in the | in the | | | | non-3GPP | non-3GPP | | | | access | access | | | | network. | network. | | +----------------+----------------+----------------+----------------+
###### ## Annex E (informative): UE procedures based on preconfigured and
received information
The flow diagrams in figure E-1 and figure E-2 show examples of the procedures
that the UE can follow in order to establish a PDN connection based on
information available to the UE about the authentication method, received or
pre-configured access network trust relationship information or received or
preconfigured IP mobility mode selection information.
The following symbols are used:
AN_TRUST trust relationship between the non-3GPP access network and the 3GPP
EPC, considered to be applicable by the UE
IPMM IP mobility mode, considered applicable by the UE
Initially, at the entry to flow chart the UE has established contact with the
non-3GPP access network, but the UE does not know whether it is in a trusted
or untrusted access network.
Figure E-1. Procedures to be followed by the UE depending on received and
preconfigured information - part 1
Figure E-2. Procedures to be followed by the UE depending on received and
preconfigured information - part 2
###### ## Annex F (Normative): Access to EPC via restrictive non-3GPP access
network
# F.1 General
This annex specifies protocol for access to EPC via restrictive non-3GPP
access network.
The procedures are specified for UE and ePDG. The UE may support the
procedures for access to EPC via restrictive non-3GPP access network. The ePDG
may support the procedures for access to EPC via restrictive non-3GPP access
network.
# F.2 UE -- EPC network protocols
## F.2.1 General
In order to access to EPC via restrictive non-3GPP access network, the UE and
the ePDG shall establish a firewall traversal tunnel (FTT) using the UE
requested FTT establishment procedure according to subclause F.2.2. Once the
FTT is established, the UE shall _initiate establishment of an IPSec tunnel
via an_ IKEv2 protocol exchange according to IETF RFC 5996 [28].
The UE and the ePDG shall construct the IKEv2 messages according to clause 7
and according to subclause F.2.3.
The UE and the ePDG shall send the IKEv2 messages using the IKEv2 message
transport procedure according to subclause F.2.2.3.
The UE and the ePDG shall send the encapsulating security payloads using the
encapsulating security payload transport procedure according to subclause
F.2.2.4.
If the UE has not sent a message over the FTT in the last FTT KAT seconds, the
UE shall perform the UE requested keep-alive procedure according to subclause
F.2.2.5.
When all IKEv2 security associations are closed, the UE shall perform the UE
requested FTT release procedure according to subclause F.2.2.6.
When all IKEv2 security associations are closed, the network can perform the
network requested FTT release procedure according to subclause F.2.2.7.
## F.2.2 FTT protocol
### F.2.2.1 General
The FTT protocol consists of the UE requested FTT establishment procedure, the
IKEv2 message transport procedure, the encapsulating security payload
transport procedure, the UE requested keep-alive procedure, the UE requested
FTT release procedure and the network requested FTT release procedure.
### F.2.2.2 UE requested FTT establishment procedure
#### F.2.2.2.1 General
The purpose of the UE requested FTT establishment procedure is to establish an
FTT between the UE and the ePDG.
#### F.2.2.2.2 UE requested FTT establishment procedure initiation
If the UE is not configured with an HTTP proxy address, the UE shall follow
the procedures in subclause F.2.2.2.3 _._
If the UE is configured with an HTTP proxy address, the UE shall follow the
procedures in subclause F.2.2.2.4 _._
_NOTE: UE configuration of an_ HTTP proxy address is out of scope of 3GPP.
#### F.2.2.2.3 UE requested FTT establishment procedure initiation via
restrictive non-3GPP access network type I
In order to establish an FTT, the UE shall establish a TCP connection _to the
ePDG address and destination port 443. If the ePDG address is a FQDN, the UE
shall include a TLS extension of type \"server_name\" in the TLS client hello
message according to_ IETF RFC 6066  _[55]._
If the TCP connection establishment is successful, the UE shall establish a
TLS connection over the TCP connection according to IETF RFC 5246  _[54]._
_T_ he ePDG shall handle the TCP connection setup and shall handle the TLS
connection establishment according to IETF RFC 5246  _[54]._
#### F.2.2.2.4 UE requested FTT establishment procedure initiation via
restrictive non-3GPP access network type II
If the UE is configured with HTTP proxy address, in order to establish an FTT,
the UE shall send HTTP CONNECT request to the HTTP proxy address according to
IETF RFC 2817  _[53]_. The UE shall populate Request-URI of the HTTP CONNECT
request with the ePDG address and port 443.
_Upon receiving HTTP 2xx response to HTTP CONNECT request, the UE shall
establish_ TLS connection according to IETF RFC 5246  _[54] over the TCP
connection used for the HTTP CONNECT request transport. If the ePDG address is
a FQDN, the UE shall include a TLS extension of type \"server_name\" in the
TLS client hello message according to_ IETF RFC 6066  _[55]._
_T_ he ePDG shall handle the TCP connection setup and the TLS connection
establishment according to IETF RFC 5246  _[54]._
#### F.2.2.2.5 UE requested FTT establishment procedure _accepted by the
network_
_When TLS Finished message is sent over the TCP connection according to_ IETF
RFC 5246  _[54], the ePDG shall use the connection as the FTT._
_When valid TLS Finished message is received over the TCP connection, the UE
shall use the connection as the FTT._
### F.2.2.3 IKEv2 message transport procedure
#### F.2.2.3.1 General
The purpose of the IKEv2 message transport procedure is to transport an IKEv2
message over an FTT.
#### F.2.2.3.2 IKEv2 message transport procedure initiation
In order to send an IKEv2 message, the UE or the ePDG shall create an IKEv2
envelope as described in subclause F.3.2.2, shall populate the Non-ESP marker
field with zero value and shall populate the IKEv2 message field of the IKEv2
envelope with the IKEv2 message.
The UE shall send the IKEv2 envelope as TLS application data according to IETF
RFC 5246  _[54]:_
\- if the IKEv2 message is an IKEv2 request, over an FTT of the UE; and
\- if the IKEv2 message is an IKEv2 response of an IKEv2 request, over the FTT
over which the IKEv2 request was received.
The ePDG shall send the IKEv2 envelope as TLS application data according to
IETF RFC 5246  _[54]:_
\- if the IKEv2 message is an IKEv2 request of an IKEv2 security association,
over the FTT associated with the IKEv2 security association; and
\- if the IKEv2 message is an IKEv2 response of an IKEv2 request, over the FTT
over which the IKEv2 request was received.
#### F.2.2.3.3 IKEv2 message transport procedure accepted
Upon receiving the IKEv2 envelope as TLS application data over the FTT, the
ePDG or the UE shall extract the IKEv2 message from the IKEv2 envelope as
described in subclause F.3.2.2 and shall handle it according to IETF RFC 5996
_[28]._ If the IKEv2 message is a validated IKEv2 packet, the ePDG shall
associate the FTT with the IKEv2 security association of the validated packet
(replacing any FTT previously associated with the IKEv2 security association).
### F.2.2.4 Encapsulating security payload transport procedure
#### F.2.2.4.1 General
The purpose of the encapsulating security payload transport procedure is to
transport an encapsulating security payload over an FTT.
#### F.2.2.4.2 Encapsulating security payload transport initiation
In order to send an encapsulating security payload, the UE or the ePDG shall
create a ESP envelope as described in subclause F.3.2.3 and shall populate the
ESP message field of the ESP envelope with the encapsulating security payload.
The UE shall send the ESP envelope as TLS application data according to IETF
RFC 5246  _[54] over an FTT of the UE._
The ePDG shall send the ESP envelope as TLS application data according to IETF
RFC 5246  _[54] over_ the FTT associated with the IKEv2 security association
which established the child security association of the encapsulating security
payload.
#### F.2.2.4.3 Encapsulating security payload transport accepted
Upon receiving the ESP envelope over the FTT, the ePDG or the UE shall extract
the encapsulating security payload from the ESP envelope as described in
subclause F.3.2.3 and shall handle it according to IETF RFC 4303  _[32]._
### F.2.2.5 UE requested keep-alive procedure
#### F.2.2.5.1 General
The purpose of the UE requested keep-alive procedure is to refresh binding in
firewall (possibly including NAT) deployed between the restrictive non-3GPP
access network and the EPC.
#### F.2.2.5.2 UE requested keep-alive procedure initiation
In order to send a keep-alive, the UE shall create a keep-alive envelope as
described in subclause F.3.2.4.
The UE shall send the keep-alive envelope as TLS application data according to
IETF RFC 5246  _[54] over an FTT of the UE._
#### F.2.2.5.3 UE requested keep-alive procedure _accepted by the network_
The ePDG shall discard any keep-alive envelope received over the FTT.
### F.2.2.6 UE requested FTT release procedure
#### F.2.2.6.1 General
The purpose of the UE requested FTT release procedure is to release an FTT
when all IKEv2 security associations are closed.
#### F.2.2.6.2 UE requested FTT release procedure initiation
In order to release the FTT, the UE shall send TLS close_notify alert
according to IETF RFC 5246  _[54]._
#### F.2.2.6.3 UE requested FTT release procedure _accepted by the network_
_T_ he ePDG shall handle the TLS close_notify alert according to IETF RFC 5246
_[54]._
### F.2.2.7 Network requested FTT release procedure
#### F.2.2.7.1 General
The purpose of the network requested FTT release procedure is to release an
FTT when all IKEv2 security associations are closed.
#### F.2.2.7.2 Network requested FTT release procedure initiation
In order to release the FTT, the ePDG shall send TLS close_notify alert
according to IETF RFC 5246  _[54]._
#### F.2.2.7.3 Network requested FTT release procedure _accepted by the UE_
_T_ he UE shall handle the TLS close_notify alert according to IETF RFC 5246
_[54]._
## F.2.3 Additional IKEv2 procedures when FTT is used
### F.2.3.1 FTT KAT negotiation during tunnel establishment
_The UE shall include the FTT_KAT configuration attribute according to
subclause_  _F.3.3.1 in the IKEv2 CFG_REQUEST configuration payload of the
IKE_AUTH request message sent via FTT._
_If the FTT_KAT configuration attribute is included in the IKEv2 CFG_REQUEST
configuration payload, ePDG shall include the FTT_KAT configuration attribute
according to subclause_  _F.3.3.1 in the IKEv2 CFG_REPLY configuration
payload._
_If the FTT_KAT configuration attribute is not included in the IKEv2 CFG_REPLY
configuration payload, the UE shall determine the firewall traversal tunnel
keep-alive time (FTT KAT) as a random number uniformly distributed between
lower bound and higher bound. The default value for lower bound is 672 seconds
and the default value for higher bound is 840 seconds._
_If the FTT_KAT configuration attribute is included in the IKEv2 CFG_REPLY
configuration payload, the UE shall set the FTT KAT to the value of the Keep-
alive time field of the FTT_KAT configuration attribute._
# F.3 PDUs and parameters specific to the present annex
## F.3.1 Void
## F.3.2 Message types of FTT messages
### F.3.2.1 Generic FTT envelope
Generic FTT envelope is coded according to figure F.3.2.1-1 and table
F.3.2.1-1.
+---------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +---------+---------+---+---+---+---+---+---+---+ | Length | octet 1 | | | | | | | | | | | | | | | | | | | | octet 2 | | | | | | | | +---------+---------+---+---+---+---+---+---+---+ | Payload | octet 3 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +---------+---------+---+---+---+---+---+---+---+
Figure F.3.2.1-1: Generic FTT envelope
Table F.3.2.1-1: Generic FTT envelope
* * *
Length field is in the octet 1 and the octet 2. The Length field indicates the
length of the generic FTT envelope in octets. Payload field is in octets
starting from octet 3 and its value depends on the message type.
* * *
### F.3.2.2 IKEv2 envelope
IKEv2 envelope is coded according to figure F.3.2.2-1 and table F.3.2.2-1.
+----------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +----------------+---------+---+---+---+---+---+---+---+ | Length | octet 1 | | | | | | | | | | | | | | | | | | | | octet 2 | | | | | | | | +----------------+---------+---+---+---+---+---+---+---+ | Non-ESP marker | octet 3 | | | | | | | | | | | | | | | | | | | | octet 6 | | | | | | | | +----------------+---------+---+---+---+---+---+---+---+ | IKEv2 message | octet 7 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +----------------+---------+---+---+---+---+---+---+---+
Figure F.3.2.2-1: IKEv2 envelope
Table F.3.2.2-1: IKEv2 envelope
* * *
Length field is described in subclause F.3.2.1. The Length field value is
bigger than 6. Non-ESP marker field is in the octet 3, the octet 4, the octet
5 and the octet 6. The Non-ESP marker field value is zero. IKEv2 message field
is in octets starting from octet 7. The IKEv2 message contains the IKEv2
message as defined in IETF RFC 5996  _[_ 28 _], section_  _3.1 in format as
for transmission from UDP port 500_.
* * *
### F.3.2.3 ESP envelope
ESP envelope is coded according to figure F.3.2.3-1 and table F.3.2.3-1.
+-------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +-------------+---------+---+---+---+---+---+---+---+ | Length | octet 1 | | | | | | | | | | | | | | | | | | | | octet 2 | | | | | | | | +-------------+---------+---+---+---+---+---+---+---+ | ESP message | octet 3 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +-------------+---------+---+---+---+---+---+---+---+
Figure F.3.2.3-1: ESP envelope
Table F.3.2.3-1: ESP envelope
* * *
Length field is described in subclause F.3.2.1. The Length field value is
bigger than 6. ESP message field is in octets starting from octet 3. The ESP
message contains the encapsulating security payload as defined in IETF RFC
4303 [32], section 2. The SPI field in the ESP header is not a zero value.
* * *
### F.3.2.4 Keep-alive envelope
Keep-alive envelope is coded according to figure F.3.2.4-1 and table
F.3.2.4-1.
+--------------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +--------------------+---------+---+---+---+---+---+---+---+ | Length | octet 1 | | | | | | | | | | | | | | | | | | | | octet 2 | | | | | | | | +--------------------+---------+---+---+---+---+---+---+---+ | Keep-alive payload | octet 3 | | | | | | | | +--------------------+---------+---+---+---+---+---+---+---+
Figure F.3.2.4-1: keep-alive envelope
Table F.3.2.4-1: keep-alive envelope
* * *
Length field is described in subclause F.3.2.1. The Length field value is 3.
Keep-alive payload field is in octet 3. The Keep-alive payload field value is
255.
* * *
## F.3.3 IKEv2 configuration attributes
### F.3.3.1 FTT_KAT configuration attribute
The FTT_KAT configuration attribute is coded according to figure F.3.3.1-1 and
table F.3.3.1-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets R Attribute type 1  
Attribute type 2  
Length 3 - 4  
Keep alive time 5 - 6
* * *
Figure F.3.3.1-1: FTT_KAT configuration attribute
Table F.3.3.1-1: FTT_KAT configuration attribute
* * *
R field is defined in IETF RFC 5996 [28]. Attribute type field has value 22.
Length field is defined in IETF RFC 5996 [28]. When FTT_KAT configuration
attribute is included in the CFG_REQUEST configuration payload of IKEv2
security association, packets of which are transported via FTT, the Keep-alive
time field indicates preferred maximum time in seconds between two envelopes
(any of those described in subclause F.3.2) sent via FTT. When FTT_KAT
configuration attribute is included in the CFG_REPLY configuration payload of
IKEv2 security association, packets of which are transported via FTT, the
Keep-alive time field indicates actual maximum time in seconds between two
envelopes (any of those described in subclause F.3.2) sent via FTT.
* * *
###### ## Annex G (Informative): IANA registrations
# G.1 General
This annex contains information needed for registrations with IANA.
# G.2 EAP-AKA attributes
## G.2.1 General
This subclause contains information needed for registrations of EAP-AKA
attributes with IANA.
## G.2.2 AT_TWAN_CONN_MODE EAP-AKA attribute
In order to register the AT_TWAN_CONN_MODE attribute, the following
information will be inserted in form at http://www.iana.org/cgi-
bin/assignments.pl:
Contact name:
\
Contact Email:
\
What type of assignment/registration are you requesting?
New item in the \"Attribute Types (Skippable Attributes 128-255)\" of the
\"EAP-AKA and EAP-SIM Parameters\" as shown at
http://www.iana.org/assignments/eapsimaka-numbers/eapsimaka-
numbers.xml#eapsimaka-numbers-3 and as specified in RFC 4187.
Which registry are you requesting this assignment/registration be made in?
The \"Attribute Types (Skippable Attributes 128-255)\" of the \"EAP-AKA and
EAP-SIM Parameters\" as shown at http://www.iana.org/assignments/eapsimaka-
numbers/eapsimaka-numbers.xml#eapsimaka-numbers-3 and as specified in RFC
4187.
If possible, please give a brief description of why you need this
assignment/registration:
Further information needs to be provided during authentication using EAP-
AKA\'.
Additional Information. Please include a reference to the specification or RFC
(if available) that defines this number or name space:
RFC 4187 defines the registry for the \"Attribute Types (Skippable Attributes
128-255)\" of the \"EAP-AKA and EAP-SIM Parameters\".
The following attribute is requested to be registered:
\- numbering space: EAP-AKA and EAP-SIM Parameters, Attribute Types (Skippable
Attributes 128-255)
\- attribute description: AT_TWAN_CONN_MODE
\- reference to specification where the attribute is described:
http://www.3gpp.org/ftp/Specs/html-info/24302.htm
\- attribute type: (number to be assigned by IANA)
###### ## Annex H (normative): Definition of generic container for ANQP
payload
# H.1 General
This subclause describes the structure and contents of the generic container
used as the payload in the 3GPP Cellular Network ANQP-element specified in
IEEE 802.11-2012 [57].
# H.2 General structure
## H.2.1 Structure
The general structure of the generic container is shown in figure H.2.1-1.
+----------------------------+-------------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +----------------------------+-------------+---+---+---+---+---+---+---+ | GUD | octet 1 | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | UDHL | octet 2 | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | IEI 1 | octet 3 | | | | | | | | | | | | | | | | | | | | octet 4 | | | | | | | | | | | | | | | | | | | | octet i | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | Length of contents of IE 1 | | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | Contents of IE 1 | | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | IEI 2 | octet i+1* | | | | | | | | | | | | | | | | | | | | octet i+2 | | | | | | | | | | | | | | | | | | | | octet l | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | Length of contents of IE 2 | | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | Contents of IE 2 | | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | ......... | octet l+1* | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | IEI q | octet m+1* | | | | | | | | | | | | | | | | | | | | octet m+2 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | Length of contents of IE q | | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | Contents of IE q | | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+
Figure H.2.1-1 -- Structure of IEEE 802.11-2012 Generic Container
## H.2.2 Generic container User Data (GUD)
Indicates the protocol version of the generic container
00000000 Version 1
00000001
To
11111111 Reserved
## H.2.3 User Data Header Length (UDHL)
Indicates the number of octets in the generic container after the UDHL. This
indication is encoded in binary format.
## H.2.4 Information Elements
### H.2.4.1 Information Element Identity (IEI)
Indicates the information element identity. The following values for IEI are
defined in this version of the specification:
00000000 PLMN List
00000001 PLMN List with S2a connectivity
00000002
To
11111111 Reserved
### H.2.4.2 PLMN List IE
The PLMN List information element is used by the network to indicate the PLMNs
that can be selected from the WLAN. The format of the PLMN List information
element coded according to 3GPP TS 24.007 [48] subclause 11.2.2.1 is shown in
figure H.2.4.2-1.
+------------------------------------+------------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +------------------------------------+------------+---+---+---+---+---+---+---+ | PLMN List IEI | octet 1 | | | | | | | | +------------------------------------+------------+---+---+---+---+---+---+---+ | Length of PLMN List value contents | octet 2 | | | | | | | | +------------------------------------+------------+---+---+---+---+---+---+---+ | Number of PLMNs | octet 3 | | | | | | | | +------------------------------------+------------+---+---+---+---+---+---+---+ | PLMN information, PLMN 1 | octet 4 | | | | | | | | | | | | | | | | | | | | octet 5 | | | | | | | | | | | | | | | | | | | | octet 6 | | | | | | | | +------------------------------------+------------+---+---+---+---+---+---+---+ | | | | | | | | | | +------------------------------------+------------+---+---+---+---+---+---+---+ | PLMN information, PLMN N | octet 3N+1 | | | | | | | | | | | | | | | | | | | | octet 3N+2 | | | | | | | | | | | | | | | | | | | | octet 3N+3 | | | | | | | | +------------------------------------+------------+---+---+---+---+---+---+---+
Figure H.2.4.2-1:  _PLMN List_ information element
The \"Number of PLMNs\" (octet 3) contains the number of PLMN information
items in the list. Bit 7 of octet 3 is the most significant bit and bit 0 of
octet 3 the least significant bit.
The format of the PLMN information item according to 3GPP TS 24.007 [48]
subclause 11.2.2.1 is shown in figure H.2.4.2-2:
* * *
7 6 5 4 3 2 1 0  
MCC digit 2 MCC digit 1 octet X  
MNC digit 3 MCC digit 3 octet X+1  
MNC digit 2 MNC digit 1 octet X+2
* * *
Figure H.2.4.2-2:  _PLMN information_ item of the PLMN List IE
Table H.2.4.2-1 shows the coding of the MCC and MNC in the PLMN information
item.
Table H.2.4.2-1: _PLMN information_ item of PLMN List IE
+----------------------------------------------------------------------+ | **MCC** , Mobile country code (octet X, octet X+1 bits 1 to 4) | | | | The MCC field is coded as in ITU-T Rec. E212 [63], Annex A. | | | | **MNC** , Mobile network code (octet X+2, octet X+1 bits 5 to 8). | | | | The coding of this field is the responsibility of each | | administration but BCD coding shall be used. The MNC shall consist | | of 2 or 3 digits. For PCS 1900 for North America, Federal Regulation | | mandates that a 3-digit MNC shall be used. However a network | | operator may decide to use only two digits in the MNC over the radio | | interface. In this case, bits 5 to 8 of octet X+1 shall be coded as | | \"1111\". Mobile equipment shall accept MNC coded in such a way. | +----------------------------------------------------------------------+
### H.2.4.3 PLMN List with S2a Connectivity IE
The PLMN List with S2a connectivity information element is used by the WLAN to
indicate the PLMNs to which the WLAN provides S2a connectivity.
The format of the PLMN List with S2a Connectivity information element is
identical to the format of the PLMN List information element defined in
subclause H.2.4.2.
#
# Foreword
This Technical Specification has been produced by the 3GPP.
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of this TS, it will be re-released by the TSG with an identifying
change of release date and an increase in version number as follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the specification.
# Introduction
The present document specifies test methods to allow the minimum performance
requirements for the acoustic characteristics of GSM, 3G and LTE terminals
when used to provide narrowband, wideband, super-wideband or fullband
telephony to be assessed.
The objective for narrowband services is to reach a quality as close as
possible to ITU-T standards for PSTN circuits. However, due to technical and
economic factors, there cannot be full compliance with the general
characteristics of international telephone connections and circuits
recommended by the ITU-T.
The performance requirements are specified in TS 26.131; the test methods and
considerations are specified in the main body of the text.
# 1 Scope
The present document is applicable to any terminal capable of supporting
narrowband, wideband, super-wideband or fullband telephony, either as a stand-
alone service or as the telephony component of a multimedia service. The
present document specifies test methods to allow the minimum performance
requirements for the acoustic characteristics of GSM, 3G and LTE terminals
when used to provide narrowband, wideband, super-wideband or fullband
telephony to be assessed.
NOTE For 3G and LTE, acoustic requirements are specified in TS 26.131, test
methods are specified in TS 26.132. For GSM, most acoustic requirements are
specified in TS 43.050, test methods are specified in TS 51.010. These
specifications are in many cases harmonized with or even refer to TS 26.131
and TS 26.132. See TS 43.050 and TS 51.010 for details. The reason for
including GSM, UMTS and LTE terminals within the scope of the present
specification is to avoid, whenever possible, duplication of test method
descriptions for terminals supporting multiple access technologies.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TS 26.131: \"Terminal Acoustic Characteristics for Telephony;
Requirements\".
[2] ITU-T Recommendation B.12 (1988): \"Use of the decibel and the neper in
telecommunications\".
[3] ITU-T Recommendation G.103 (1998): \"Hypothetical reference connections\".
[4] ITU-T Recommendation G.111 (1993): \"Loudness ratings (LRs) in an
international connection\".
[5] ITU-T Recommendation G.121 (1993): \"Loudness ratings (LRs) of national
systems\".
[6] ITU-T Recommendation G.122 (1993): \"Influence of national systems on
stability and talker echo in international connections\".
[7] Void.
[8] ITU-T Recommendation P.11 (1993): \"Effect of transmission impairments\".
[9] ITU-T Recommendation P.38 (1993): \"Transmission characteristics of
operator telephone systems (OTS)\".
[10] ITU-T Recommendation P.50 (1993): \"Artificial voices\".
[11] 3GPP TS 43.058 : \"Digital Cellular Telecommunications System
Characterization test methods and quality assessment for hands-free mobiles\".
[12] IEC Publication 60651: \"Sound Level Meters\".
[13] ITU-T Recommendation P.51 (1996): \"Artificial mouth\".
[14] ITU-T Recommendation P.57 (12/2011): \"Artificial ears\".
[15] ITU-T Recommendation P.58 (05/2013): \"Head and torso simulator for
telephonometry.\"
[16] ITU-T Recommendation P.79 (11/2007) with Annex A: \"Calculation of
loudness ratings for telephone sets.\"
[17] 3GPP TS 46.077 : \"Minimum Performance Requirements for Noise Suppresser
Application to the AMR Speech Encoder\".
[18] ITU-T Recommendation P.64 (11/2007): \"Determination of
sensitivity/frequency characteristics of local telephone systems\".
[19] ITU-T Recommendation P.581 (02/2014): \"Use of head and torso simulator
(HATS) for hands-free and handset terminal testing\".
[20] ITU-T Recommendation P.340 (05/2000): \"Transmission characteristics and
speech quality parameters of hands-free terminals\".
[21] ITU-T Recommendation G.712 (11/2001): \"Transmission performance
characteristics of pulse code modulation channels\".
[22] ITU-T Recommendation P.501 (01/2012): \"Test signals for use in
telephonometry\".
[23] ITU-T Recommendation O.41 (10/1994): \"Psophometer for use on telephone-
type circuits\".
[24] ITU-T Recommendation O.131 (11/1988): \"Quantizing distortion measuring
equipment using a pseudo-random noise test signal\".
[25] Void.
[26] ISO 3745: \"Acoustics - Determination of sound power levels of noise
sources using sound pressure - Precision methods for anechoic and hemi-
anechoic rooms\".
[27] ITU-T Recommendation O.132 (11/1988): \"Quantizing distortion measuring
equipment using a sinusoidal test signal\".
[28] ETSI TS 103 737 (2010-08) V1.1.2: \"Transmission requirements for
narrowband wireless terminals (handset and headset) from a QoS perspective as
perceived by the user\".
[29] ETSI TS 103 738 (2010-09) V1.1.2: \"Transmission requirements for
narrowband wireless terminals (handsfree) from a QoS perspective as perceived
by the user\".
[30] ETSI TS 103 739 (2010-09) V1.1.2: \"Transmission requirements for
wideband wireless terminals (handset and headset) from a QoS perspective as
perceived by the user\".
[31] ETSI TS 103 740 (2010-09) V1.1.2: \"Transmission requirements for
wideband wireless terminals (handsfree) from a QoS perspective as perceived by
the user\".
[32] ITU-T Recommendation P.380 (11/2003): \"Electro-acoustic measurements on
headsets\".
[33] ITU-T Recommendation P.501 Amendment 1 (2012): \"Test signals for use in
telephonometry\".
[34] ETSI TS 103 106(2013-03) V1.2.1: \"Speech Quality performance in the
presence of background noise: Background noise transmission of mobile
terminals-Objective test methods\".
[35] ETSI ES 202 396-1 (2012-10) V1.4.1: \"Speech quality performance in the
presence of background noise; Part 1: Background noise simulation technique
and background noise database\".
[36] ETSI EG 202 396-3 (2011-02) V1.3.1: \"Speech quality performance in the
presence of background noise; Part 3: _Background noise transmission --
objective test methods_ : Background noise simulation technique and background
noise database\".
[37] ITU-T Recommendation P.56 (12/2011): \"Objective measurement of active
speech level\".
[38] IEC 61672: \"Electroacoustics -- sound level meters - part 1:
specifications\".
[39] 3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia Telephony;
Media handling and interaction\".
[40] 3GPP TS 43.050: \"Transmission planning aspects of the speech service in
the GSM Public Land Mobile Network (PLMN) system\".
[41] 3GPP TS 51.010: \"Mobile Station (MS) conformance specification; Part 1:
Conformance specification\".
[42] 3GPP TS 23.203: \"Policy and charging control architecture\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document the terms _narrowband,_ _wideband,
super-wideband and fullband_ refer to signals associated with the
corresponding operating modes of the speech codecs specified in 5.2.
For the purposes of the present document, the terms dB, dBr, dBm0, dBm0p and
dBA, shall be interpreted as defined in ITU-T Recommendation G.100 [42]; the
term dBPa shall be interpreted as the sound pressure level relative to 1
pascal expressed in dB (0 dBPa is equivalent to 94 dB SPL).
A 3GPP softphone is a telephony system running on a general purpose computer
or PDA complying with the 3GPP terminal acoustic requirements (TS 26.131 and
26.132).
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
ADC Analogue to Digital Converter
AMR Adaptive Multi Rate
CSS Composite Source Signal
DAC Digital to Analogue Converter
DRP Eardrum Reference Point
DTX Discontinuous Transmission
EEC Electrical Echo Control
EEP Ear Entrance Point
EL Echo Loss
ERP Ear Reference Point
EVS Enhanced Voice Services
FFT Fast Fourier Transform
HATS Head and Torso Simulator
IMS IP Multimedia Subsystem
LSTR Listener Sidetone Rating
LTE Long Term Evolution
MRP Mouth Reference Point
MS Mobile Station
MTSI Multimedia Telephony Service for IMS
OLR Overall Loudness Rating
PCM Pulse Code Modulation
PDA Personal Digital Assistant
POI Point of Interconnection (with PSTN)
PSTN Public Switched Telephone Network
RLR Receive Loudness Rating
RMS Root Mean Squared
SLR Send Loudness Rating
SS System Simulator
STMR Sidetone Masking Rating
SS System Simulator
TX Transmission
UE User Equipment
UMTS Universal Mobile Telecommunications System
# 4 Interfaces
The interfaces required to define terminal acoustic characteristics are the
acoustic interfaces, the air interface and the point of interconnect (POI),
see Figure 1.
The Air Interfaces for GSM, 3G and LTE are specified by GSM 05, 3GPP 45, 3GPP
25 and 3GPP 36 series specifications. MTSI speech aspects are specified by TS
26.114 [17].
Measurements can be made using a system simulator (SS) comprising the
appropriate radio terminal equipment and speech transcoder. The losses and
gains introduced by the test equipment shall be accounted for.
The POI with the public switched telephone network (PSTN) is considered to
have a relative level of 0 dBr.
Five classes of acoustic interface are considered in this specification:
\- Handset UE including softphone UE used as a handset;
\- Headset UE including softphone UE used with headset;
\- Vehicle Mounted Hands-free UE including softphone UE mounted in a vehicle;
\- Desktop-mounted hands-free UE including softphone UE with external
loudspeaker(s) used in hands-free mode;
\- Hand-held hands-free UE including softphone UE with internal loudspeaker(s)
used in hands-free mode.
(See definition of softphone in Clause 3.1)
NOTE: The test setup for a softphone UE shall be derived according to the
following rules:
\- When using a softphone UE as a handset: the test setup shall correspond to
handset mode.
\- When using a softphone UE with headset: the test setup shall correspond to
headset mode.
\- When a softphone UE is mounted in a vehicle: the test setup shall
correspond to vehicle-mounted hands-free mode.
\- When using a softphone UE in hands-free mode:
\- When using internal loudspeaker(s), the test setup shall correspond to
hand-held hands-free.
\- When using external loudspeaker(s), the test setup shall correspond to
desktop-mounted hands-free.
# 5 Test configurations
This section describes the test setups for terminal acoustic testing.
The configurations are shown for one-channel (mono) operation, configurations
for two-channel (stereo) operation is for further study.
NOTE: If the terminal has several mechanical configurations (e.g., sliding
design open or closed), all manufacturer-defined configurations shall be
tested.
## 5.1 Setup for terminals
The general access to terminals is described in figure 1. The preferred
acoustic access to GSM, 3G and LTE terminals is the most realistic simulation
of the "average" subscriber. This can be made by using HATS (head and torso
simulator), with appropriate ear simulation and appropriate mountings of
handset terminals to the HATS in a realistic but reproducible way. Hands-free
terminals shall use the HATS or free field microphone techniques in a
realistic but reproducible way.
HATS is described in ITU-T Recommendation P.58 [15], appropriate ears are
described in ITU-T Recommendation P.57 [14] (Type 3.3), proper positioning of
handsets in realistic conditions is found in ITU-T Recommendation P.64, and
the test setups for various types of hands-free terminals can be found in
ITU-T Recommendation P.581.
Unless stated otherwise, if a volume control is provided, the setting is
chosen such that the nominal RLR is met as close as possible.
The preferred way of testing is the connection of a terminal to the system
simulator with exact defined settings and access points. The test sequences
are fed in either electrically using a reference codec, using the direct
signal processing approach, or acoustically using ITU-T specified devices.
The system simulator shall simulate the access network and core network
including the speech encoding/decoding specified for the test (e.g. AMR-NB or
AMR-WB) but excluding further transcoding beyond linear PCM, see Figure 1.
Unless specified otherwise for the respective test, the radio conditions on
the air interface shall have a block error rate of 0% and the jitter in the IP
transport for MTSI-based speech shall be ≤ 1 ms.
In case of MTSI-based speech, the reference client shall allow to synchronize
to the clock of the device under test and include a de-jitter buffer to
equalize possible jitter in the signal received from the UE.
When operating with synchronized clock, the de-jitter buffer shall be a static
de-jitter buffer and the jitter buffer management shall not compensate for
clock drift. The reference client shall not lose or discard packets, shall not
trigger retransmission, and shall not use error concealment or time-warping.
The initial jitter buffer size (filling level) shall be higher than the
maximum expected network jitter and the maximum jitter buffer size shall be at
least twice the initial size. During jitter buffer reset, the de-jitter buffer
shall be emptied/filled to the initial buffer size. In case of buffer over- or
underruns, the reference client shall give a warning and it shall be reported.
NOTE 1: A static de-jitter buffer is a first-in-first-out (FIFO) buffer which
at the beginning buffers packets until a given initial buffer size is reached.
Due to changing network delays the filling level of the de-jitter buffer can
change, but the sum of network delay and jitter buffer delay is constant (as
opposed to an adaptive jitter buffer management). The filling level of the de-
jitter buffer represents the de-jitter buffer delay.
For measurements with unsynchronized clock e.g. the measurement of clock
drift, jitter buffer over- and underruns cannot be avoided due to the
unsynchronized clocks. Under the assumption of jitter-free condition the
initial jitter buffer size (filling level) shall be chosen such that the
maximum clock drift can be compensated without any loss of packets for a given
time. For the measurement of clock drifts the jitter buffer size should be
chosen such that for clock drift of up to 100ppm no loss of packets due to
buffer over- or under-run shall occur for a sequence of 160s.
For LTE connections, the system simulator shall be configured for FDD
operation, with a default or dedicated bearer and reference measurement
channel scheduling that provides enough resource block allocation for
transmitting a full speech packet within a transmission time interval of 1ms.
No HARQ re-transmissions shall occur. TDD operation, TTI bundling, connected
DRX and other forms of scheduling (e.g. SPS) are for further study.
The test setup has to ensure proper clock synchronization of the test
equipment to the UE. Clock drift shall be negligible and packet loss shall not
occur during the test.
NOTE 2: Any clock drift may result in improper delay calculation or in wrong
positioning of the analysis window.
{width="5.216666666666667in" height="1.01875in"}
NOTE : Connection to PSTN should include electrical echo control (EEC).
Figure 1: Interfaces (MRP, ERP/DRP..., Air interface and Point of
interconnect) for specification of terminal acoustic characteristics
### 5.1.1 Setup for handset terminals
When using a handset UE, the handset is placed on HATS as described in ITU-T
Recommendation P.64 Annex E [18]. A suitable position shall be defined for
each handset UE and documented in the test report. The artificial mouth shall
conform to ITU-T Recommendation P.58 [15]. The artificial ear shall conform to
ITU-T Recommendation P.57 [14]. Type 3.3 ear shall be used and positioned on
HATS according to ITU-T Recommendation P.58 [15].
**Position and calibration of HATS**
The sending and receiving characteristics shall be tested with the HATS. It
shall be indicated what application force was used. If not stated otherwise in
TS 26.131, an application force of 8 ± 2 N shall be used.
The horizontal positioning of the HATS reference plane shall be guaranteed
within ± 2º.
### 5.1.2 Setup for headset terminals
Recommendations for the setup and positioning of headsets are given in ITU-T
Recommendation P.380. If not stated otherwise, headsets shall be placed in
their recommended wearing position. Some insert earphones might not fit
properly in Type 3.3 ear simulators. For such insert type headsets, an ITU-T
Recommendation P.57 [14] Type 2 ear simulator may be used in conjunction with
the HATS mouth simulator. The HATS should be equipped with two artificial ears
as specified in ITU-T Recommendation P.57 [14]. For binaural headsets two
artificial ears are required.
### 5.1.3 Setup for hands-free terminals
#### 5.1.3.1 Vehicle-mounted hands-free
If not stated otherwise, the artificial head (HATS -- head and torso
simulator, according to ITU‑T Recommendation P.58 [15]) is positioned in the
driver\'s seat for the measurement as shown in figure 3a. The position has to
be in line with the average users' position; therefore, all positions and
sizes of users have to be taken into account. Typically, all except the
tallest 5% and the shortest 5% of the driving population have to be
considered. The size of these persons can be derived, e.g., from the
\'anthropometric data set\' for the corresponding year (e.g., based on data
used by car manufacturers). The position of the HATS (mouth/ears) within the
positioning arrangement is given individually by each car manufacturer. The
position used has to be reported in detail in the test report. If no
requirements for positioning are given the distance from the microphone to the
MRP is defined by the test lab.
By using suitable measures (e.g., marks in the car, relative position to
A-pillar, B-pillar, height from the floor, etc.) an exact reproduction of the
artificial head position must be possible at any later time.
NOTE -- Different positions of the artificial head may greatly influence the
test results. Depending on the application, different positions of the
artificial head may be chosen for the tests. It is recommended to check the
worst-case position, e.g., those positions where the SNR and/or the speech
quality in send may be worst.
Figure 2: void
Figure 3: void
Figure 3a: Test Configuration for vehicle mounted hands-free, using HATS
#### 5.1.3.2 Desktop hands-free
For HATS test equipment, the definition of hands-free terminals and setup for
desktop hands-free terminals can be found in ITU-T Recommendation P.581.
Measurement setup using a free-field microphone and a discrete P.51 [13]
artificial mouth for desktop hands-free terminals can be found in ITU-T
Recommendation P.340.The positioning for different types of desktop hands-free
terminals is given in ETSI TS 103 738 and ETSI TS 103 740.
#### 5.1.3.3 Hand-held hands-free
Either HATS or a free-field microphone with a discrete P.51 [13] artificial
mouth may be used to measure a hand-held hands-free type UE.
If HATS measurement equipment is used, it shall be configured to the hand-held
hands-free UE according to figure 4. The HATS should be positioned so that the
HATS Reference Point is at a distance _d_ ~HF~ from the centre point of the
visual display of the Mobile Station. The distance _d_ ~HF~ is specified by
the manufacturer. A vertical angle θ~HF~ may be specified by the manufacturer.
Where it is not specified, the nominal distance _d_ ~HF~ shall be 42 cm and
θ~HF~ shall be 0º.
NOTE: The nominal distance of 42 cm corresponds to the distance between the
HATS reference point and lip-plane (12 cm) with an additional 30 cm giving a
realistic figure as a reference usage of hand-held terminals.
{width="3.5701388888888888in" height="2.873611111111111in"}
Figure 4: Configuration of hand-held hands-free UE relative to the HATS
If a free-field microphone and a discrete P.51 [13] mouth are used, they shall
be configured to the hand-held hands-free UE according to figure 5 for
receiving measurements and figure 6 for sending measurements. The microphone
should be located at a distance _d_ ~HF~ from the centre of the visual display
of the UE. The mouth simulator should be located at a distance _d_ ~HF~-12 cm
from the centre of the visual display of the UE. The distance _d_ ~HF~ is
specified by the manufacturer. Where it is not specified the nominal distance
_d_ ~HF~ shall be 42 cm.
{width="4.276388888888889in" height="1.8701388888888888in"}
Figure 5: Configuration of hand-held hands-free UE; free-field microphone for
receiving measurements
{width="2.9881944444444444in" height="1.8805555555555555in"}
Figure 6: Configuration of hand-held hands-free UE; discrete P.51 artificial
mouth for sending measurements
#### 5.1.3.4 Softphone including speakers and microphone
This test setup is applicable to laptop computers or similar devices as seen
in figure 7 through figure 11.
Where the manufacturer gives conditions of use, these will apply for testing.
If the manufacturer gives no other requirement, the softphone will be
positioned according the following conditions:
Measurement with artificial ear and microphone:
Artificial mouth (for sending tests)
{width="5.988888888888889in" height="2.7402777777777776in"}
Figure 7: Configuration of a softphone relative to the artificial mouth side
view
Free field microphone (for receiving):
{width="5.99375in" height="2.15625in"}
Figure 8: Configuration of a softphone relative to the free field microphone
side view
Position of a softphone on the table:
{width="5.3597222222222225in" height="5.330555555555556in"}
Figure 9: Configuration of a softphone relative to the free-field microphone
or artificial mouth viewed from above
Measurement with HATS:
{width="5.690972222222222in" height="2.75in"}
Figure 10: Configuration of a softphone relative to the HATS side view
{width="4.069444444444445in" height="3.404861111111111in"}
Figure 11: Configuration of a softphone relative to the HATS viewed from above
#### 5.1.3.5 Softphone with separate speakers
This test setup is applicable to laptop computers or similar devices as seen
in figure 12 through figure 15.
Where the manufacturer gives conditions of use, these will apply for testing.
If the manufacturer gives no other requirement, the softphone will be
positioned according to the following conditions:
Where separate loudspeakers are used, the system will be positioned as in
figure 12 or figure 13.
{width="5.997222222222222in" height="4.172916666666667in"}
Figure 12: Configuration of a softphone using external speakers relative to
microphone or artificial mouth viewed from above
{width="5.995138888888889in" height="6.207638888888889in"}
Figure 13: Configuration of a softphone using external speakers relative to
the HATS viewed from above
Where an external microphone and speakers are used, the system will be
positioned as in figure 14 or figure 15.
{width="5.995138888888889in" height="5.934027777777778in"}
Figure 14: Configuration of a softphone using\ external speakers and a
microphone relative to microphone or artificial mouth viewed from above
{width="4.565972222222222in" height="3.0833333333333335in"}
Figure 15: Configuration of a softphone using\ external speakers and a
microphone relative to the HATS viewed from above
### 5.1.4 Position and calibration of HATS
The horizontal positioning of the HATS reference plane shall be guaranteed
within ± 2° for testing hands-free equipment.
The HATS shall be equipped with a Type 3.3 Artificial Ear. For hands-free
measurements the HATS shall be equipped with two artificial ears. The pinnae
are specified in Recommendation P.57 [14] for Type 3.3 artificial ears. The
pinnae shall be positioned on HATS according to ITU-T Recommendation P.58
[15].
The exact calibration and equalization procedures as well as how to combine
the two ear signals for the purpose of measurements can be found in ITU-T
Recommendation P.581.
If not stated otherwise, the HATS shall be diffuse-field equalized using
values from ITU-T Recommendation P.58 [15]. For 1/3-octave band measurements,
the inverse of the nominal diffuse field curve in P.58 table 3 shall be used.
For 1/12-octave band measurements, the inverse of the nominal diffuse field
curve in P.58 Annex A shall be used. For measurements requiring diffuse-field
correction values for frequencies other than those used in the P.58 tables,
linear interpolation on a log frequency scale from the P.58 Annex A values
shall be used.
For hand-held hands-free UE, the setup corresponding to \'portable hands-
free\' in ITU-T Recommendation P.581 should be used.
### 5.1.5 Test setup for quality in the presence of ambient noise measurements
The setup for simulating realistic ambient noises and the positioning of the
HATS in a lab-type environment is described in ETSI ES 202 396-1 [35].
ETSI ES 202 396-1 [35] contains a description of the recording arrangement for
realistic ambient noises, a description of the setup for a loudspeaker
arrangement suitable to simulate an ambient noise field in a lab-type
environment and a database of realistic ambient noises, part of which is used
for testing the terminal performance with a variety of conditions.
The equalization and calibration procedure for the test setup are given in
detail in ETSI ES 202 396-1 [35].
## 5.2 Setup of the electrical interfaces
### 5.2.1 Codec approach and specification
In this approach, a codec is used to convert the digital input/output bit-
stream of the system simulator to the equivalent analogue values. With this
approach a system simulator simulating the radio link to the terminal under
controlled and error-free conditions is required, unless otherwise specified
for the respective test. The system simulator has to be equipped with a high-
quality codec with characteristics as close as possible to ideal.
Definition of 0 dBr point:
D/A converter - a Digital Test Sequence (DTS) representing the codec
equivalent of an analogue sinusoidal signal with an RMS value of 3,14 dB below
the maximum full‑load capacity of the codec shall generate 0 dBm across a 600
ohm load;
A/D converter - a 0 dBm signal generated from a 600 ohm source shall give the
digital test sequence (DTS) representing the codec equivalent of an analogue
sinusoidal signal with an RMS value of 3,14 dB below the maximum full‑load
capacity of the codec.
**Narrowband telephony testing**
For testing of a GSM, 3G or LTE terminal supporting narrowband telephony, the
system simulator shall use the AMR speech codec as defined in the 3GPP TS 26
series of specifications, at the source coding bit-rate of 12,2 kbit/s.
**Wideband telephony testing**
For testing of a GSM, 3G or LTE terminal supporting wideband telephony, the
system simulator shall use the AMR-WB speech codec as defined in 3GPP TS 26
series of specifications, at the source coding bit-rate of 12,65 kbit/s.
**Super-wideband telephony testing**
For testing of a LTE terminal supporting super-wideband telephony, the system
simulator shall use the EVS speech codec as defined in 3GPP TS 26 series of
specifications at 32 kHz sampling rate, mono, at the source coding bit-rate of
24,4 kbit/s. The system simulator should support all operation modes of EVS
speech codec, the complete EVS RTP payload format, and all SDP attributes as
specified in TS 26.445 Annex A; it should be possible to control all the SDP
attributes declared and negotiated by the system simulator.
**Fullband telephony testing**
For testing of a LTE terminal supporting fullband telephony, the system
simulator shall use the EVS speech codec as defined in 3GPP TS 26 series of
specifications at 48 kHz sampling rate, mono, at the source coding bit-rate of
24,4 kbit/s.
### 5.2.2 Direct digital processing approach
In this approach, the digital input/output bit-stream of the terminal
connected through the radio link to the system simulator is operated upon
directly.
**Narrowband telephony testing**
For testing of a GSM, 3G or LTE terminal supporting narrowband telephony, the
system simulator shall use the AMR speech codec as defined in the 3GPP TS 26
series of specifications, at the source coding bit-rate of 12,2 kbit/s.
**Wideband telephony testing**
For testing of a GSM, 3G or LTE terminal supporting wideband telephony, the
system simulator shall use the AMR-WB speech codec as defined in the 3GPP TS
26 series of specifications, at the source coding bit rate of 12,65 kbit/s.
**Super-wideband telephony testing**
For testing of a LTE terminal supporting super-wideband telephony, the system
simulator shall use the EVS speech codec as defined in 3GPP TS 26 series of
specifications in super-wideband mode, at 32 kHz sampling rate, mono, at the
source coding bit-rate of 24,4 kbit/s. The system simulator should support all
operation modes of EVS speech codec, the complete EVS RTP payload format, and
all SDP attributes as specified in TS 26.445 Annex A; it should be possible to
control all the SDP attributes declared and negotiated by the system
simulator.
**Fullband telephony testing**
For testing of a LTE terminal supporting fullband telephony, the system
simulator shall use the EVS speech codec as defined in 3GPP TS 26 series of
specifications in fullband mode, at 48 kHz sampling rate, mono, at the source
coding bit-rate of 24,4 kbit/s.
## 5.3 Accuracy of test equipment
Unless specified otherwise, the accuracy of measurements made by test
equipment shall exceed the requirements defined in table 1a.
Table 1a: Test equipment measurement accuracy
* * *
Item Accuracy Electrical Signal Power ± 0,2 dB for levels ≥ -50 dBm ± 0,4 dB
for levels \ a) The test signal to be used for the measurements shall be the British-
> English single talk sequence described in ITU-T Recommendation P.501 [22].
> The spectrum of the acoustic signal produced by the artificial mouth is
> calibrated under free-field conditions at the MRP. The test signal level
> shall be -4,7 dBPa measured at the MRP. The test signal level is calculated
> over the complete test signal sequence.
b) The handset terminal is setup as described in clause 5. The sending
sensitivity shall be calculated from each band of the 14 frequencies given in
table 1 of ITU‑T Recommendation P.79 [16], bands 4 to 17. For the calculation,
the averaged measured level at the electrical reference point for each
frequency band is referred to the averaged test signal level measured in each
frequency band at the MRP.
c) The sensitivity is expressed in terms of dBV/Pa and the SLR shall be
calculated according to ITU‑T Recommendation P.79 [16], formula (A-23b), over
bands 4 to 17, using m = 0,175 and the sending weighting factors from ITU‑T
Recommendation P.79 [16], table 1.
#### 7.2.2.2 Receiving loudness rating (RLR)
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
test signal level shall be -16 dBm0 measured at the digital reference point or
the equivalent analogue point. The test signal level is calculated over the
complete test signal sequence.
b) The handset terminal is setup as described in clause 5. The receiving
sensitivity shall be calculated from each band of the 14 frequencies given in
table 1 of ITU‑T Recommendation P.79 [16], bands 4 to 17. For the calculation,
the averaged measured level at each frequency band is referred to the averaged
test signal level measured in each frequency band.
c) The sensitivity is expressed in terms of dBPa/V and the RLR shall be
calculated according to ITU‑T Recommendation P.79 [16], formula (A-23c), over
bands 4 to 17, using m = 0,175 and the receiving weighting factors from table
1 of ITU‑T Recommendation P.79 [16].
d) DRP-ERP correction is used. No leakage correction shall be applied.
### 7.2.3 Connections with desktop and vehicle-mounted hands-free UE
Vehicle-mounted hands-free UE should be tested within the vehicle (for totally
integrated vehicle hands-free systems) or in a vehicle simulator, as described
in 3GPP TS 03.58 [11].
Free-field measurements for vehicle-mounted hands-free are for further study.
#### 7.2.3.1 Sending loudness rating (SLR)
> a) The test signal to be used for the measurements shall be the British-
> English single talk sequence described in ITU-T Recommendation P.501 [22].
> The spectrum of the acoustic signal produced by the artificial mouth is
> calibrated under free-field conditions at the MRP. The test signal level
> shall be -4,7 dBPa measured at the MRP. The test signal level is calculated
> over the complete test signal sequence. The broadband signal level is then
> adjusted to -28,7 dBPa at the HFRP or the HATS HFRP (as defined in ITU-
> Recommendation P.581) and the spectrum is not altered.
>
> The spectrum at the MRP and the actual level at the MRP (measured in
> 1/3-octaves) are used as references to determine the sending sensitivity
> SmJ.
b) The hands-free terminal is setup as described in clause 5. The sending
sensitivity shall be calculated from each band of the 14 frequencies given in
table 1 of ITU‑T Recommendation P.79 [16], bands 4 to 17. For the calculation,
the averaged measured level at the electrical reference point for each
frequency band is referred to the averaged test signal level measured in each
frequency band at the MRP.
c) The sensitivity is expressed in terms of dBV/Pa and the SLR shall be
calculated according to ITU‑T Recommendation P.79 [16], formula (A-23b), over
bands 4 to 17, using m = 0,175 and the sending weighting factors from ITU‑T
Recommendation P.79 [16], table 1.
#### 7.2.3.2 Receiving Loudness Rating (RLR)
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
test signal level shall be -16 dBm0 measured at the digital reference point or
the equivalent analogue point. The test signal level is calculated over the
complete test signal sequence.
b) The hands-free terminal is setup as described in clause 5. If a HATS is
used, then it is free-field equalized as described in ITU-T Recommendation
P.581. The equalized output signal of each artificial ear is power-averaged
over the total duration of the analysis; the right and left artificial ear
signals are voltage-summed for each 1/3-octave frequency band; these
1/3-octave band data are considered as the input signal to be used for
calculations or measurements. The receiving sensitivity shall be calculated
from each band of the 14 frequencies given in table 1 of ITU‑T Recommendation
P.79 [16], bands 4 to 17.
> For the calculation, the averaged measured level at each frequency band is
> referred to the averaged test signal level measured in each frequency band.
c) The sensitivity is expressed in terms of dBPa/V and the RLR shall be
calculated according to ITU‑T Recommendation P.79 [16], formula (A-23c), over
bands 4 to 17, using m = 0,175 and the receiving weighting factors from table
1 of ITU‑T Recommendation P.79 [16].
d) No leakage correction shall be applied. The hands-free correction, as
described in ITU‑T Recommendation P.340 shall be applied. To compute the
receiving loudness rating (RLR) for a hands-free terminal (see also ITU-T
Recommendation P.340), when using the combination of left and right artificial
ear signals from the HATS, the HFL~E~ has to be 8 dB instead of 14 dB. For
further information see ITU-T Recommendation P.581.
### 7.2.4 Connections with hand-held hands-free UE
#### 7.2.4.1 Sending loudness rating (SLR)
> a) The test signal to be used for the measurements shall be the British-
> English single talk sequence described in ITU-T Recommendation P.501 [22].
> The spectrum of the acoustic signal produced by the artificial mouth is
> calibrated under free-field conditions at the MRP. The test signal level
> shall be -4,7 dBPa measured at the MRP. The test signal level is calculated
> over the complete test signal sequence. The broadband signal level is then
> adjusted to -28,7 dBPa at the HFRP or the HATS HFRP (as defined in ITU-T
> Recommendation P.581) and the spectrum is not altered.
>
> The spectrum at the MRP and the actual level at the MRP (measured in
> 1/3-octaves) are used as references to determine the sending sensitivity
> SmJ.
b) The hands-free terminal is setup as described in clause 5. The sending
sensitivity shall be calculated from each band of the 14 frequencies given in
table 1 of ITU‑T Recommendation P.79 [16], bands 4 to 17. For the calculation,
the averaged measured level at the electrical reference point for each
frequency band is referred to the averaged test signal level measured in each
frequency band at the MRP.
c) The sensitivity is expressed in terms of dBV/Pa and the SLR shall be
calculated according to ITU‑T Recommendation P.79 [16], formula (A-23b), over
bands 4 to 17, using m = 0,175 and the sending weighting factors from ITU‑T
Recommendation P.79 [16], table 1.
#### 7.2.4.2 Receiving loudness rating (RLR)
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
test signal level shall be -16 dBm0 measured at the digital reference point or
the equivalent analogue point. The test signal level is calculated over the
complete test signal sequence.
b) The hands-free terminal is setup as described in clause 5. If a HATS is
used, then it is free-field equalized as described in ITU-T Recommendation
P.581. The equalized output signal of each artificial ear is power-averaged
over the total duration of the analysis; the right and left artificial ear
signals are voltage-summed for each 1/3-octave frequency band; these
1/3-octave band data are considered as the input signal to be used for
calculations or measurements. The receiving sensitivity shall be calculated
from each band of the 14 frequencies given in table 1 of ITU‑T Recommendation
P.79 [16], bands 4 to 17.
> For the calculation, the averaged measured level at each frequency band is
> referred to the averaged test signal level measured in each frequency band.
c) The sensitivity is expressed in terms of dBPa/V and the RLR shall be
calculated according to ITU‑T Recommendation P.79 [16], formula (A-23c), over
bands 4 to 17, using m = 0,175 and the receiving weighting factors from table
1 of ITU‑T Recommendation P.79 [16].
d) No leakage correction shall be applied. The hands-free correction as
described in ITU‑T Recommendation P.340 shall be applied. To compute the
receiving loudness rating (RLR) for hands-free terminals (see also ITU-T
Recommendation P.340), when using the combination of left and right artificial
ear signals from the HATS, the HFL~E~ has to be 8 dB instead of 14 dB. For
further information see ITU-T Recommendation P.581.
### 7.2.5 Connections with headset UE
Same as for handset.
## 7.3 Idle channel noise (handset and headset UE)
For idle noise measurements in sending and receiving directions, care should
be taken that only the noise is windowed out by the analysis and the result is
not impaired by any remaining reverberation or by noise and/or interference
from various other sources. Some examples are air-conducted or vibration-
conducted noise from sources inside or outside the test chamber, disturbances
from lights and regulators, mains supply induced noise including grounding
issues, test system and system simulator inherent noise as well as radio
interference from the UE to test equipment such as ear simulators, microphone
amplifiers, etc.
### 7.3.1 Sending
The terminal should be configured to the test equipment as described in
subclause 5.1.
The environment shall comply with the conditions described in subclause 6.1.
The noise level at the output of the SS is measured with psophometric
weighting. The psophometric weighting filter is described in ITU-T
Recommendation O.41.
A test signal may have to be intermittently applied to prevent 'silent mode'
operation of the MS. This is for further study.
The measured part of the noise shall be 170,667 ms (which equals 8192 samples
in a 48 kHz sample rate test system). The spectral distribution of the noise
is analyzed with an 8k FFT using windowing with ≤ 0,1 dB leakage for non bin-
centered signals. This can be achieved with a window function commonly known
as a "flat top window". Within the specified frequency range, the FFT bin that
has the highest level is searched for; the level of this bin is the maximum
level of a single frequency disturbance.
To improve repeatability, the test sequence (optional activation followed by
the noise level measurement) may be contiguously repeated one or more times.
The total noise powers obtained from such repeats shall be averaged. The total
result shall be 10 * log~10~ of this average in dB.
The single frequency maximum powers obtained from such repeats shall be
averaged. The total result shall be 10*log~10~ of this average in dB.
### 7.3.2 Receiving
The terminal should be configured to the test equipment as described in
subclause 5.1.
The environment shall comply with the conditions described in subclause 6.1.
A test signal may have to be intermittently applied to prevent 'silent mode'
operation of the MS. This is for further study.
The noise level shall be measured with A‑weighting at the DRP with diffuse-
field correction. The A-weighting filter is described in IEC 60651.
The measured part of the noise shall be 170,667 ms (which equals 8192 samples
in a 48 kHz sample rate test system). The spectral distribution of the noise
is analyzed with an 8k FFT using windowing with ≤ 0.1 dB leakage for non bin-
centred signals. This can be achieved with a window function commonly known as
a "flat top window". Within the specified frequency range, the FFT bin that
has the highest level is searched for; the level of this bin is the maximum
level of a single frequency disturbance.
To improve repeatability, considering the test sequence (optional activation
followed by the noise level measurement) may be contiguously repeated one or
more times.
The total noise powers obtained from such repeats shall be averaged. The total
result shall be 10*log~10~ of this average in dB.
The single frequency maximum powers obtained from such repeats shall be
averaged. The total result shall be 10*log~10~ of this average in dB.
## 7.4 Sensitivity/frequency characteristics
### 7.4.1 Handset and headset UE sending
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
spectrum of the acoustic signal produced by the artificial mouth is calibrated
under free-field conditions at the MRP. The test signal level shall be -4,7
dBPa measured at the MRP. The test signal level is calculated over the
complete test signal sequence.
b) The handset terminal is setup as described in clause 5. Measurements shall
be made at 1/12-octave intervals as given by the R.40 series of preferred
numbers in ISO 3 for frequencies from 100 Hz to 4 kHz inclusive. For the
calculation, the averaged measured level at the electrical reference point for
each frequency band is referred to the averaged test signal level measured in
each frequency band at the MRP.
c) The sensitivity is expressed in terms of dBV/Pa.
### 7.4.2 Handset and headset UE receiving
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
test signal level shall be -16 dBm0 measured at the digital reference point or
the equivalent analogue point. The test signal level is calculated over the
complete test signal sequence.
b) The handset terminal is setup as described in clause 5. Measurements shall
be made at 1/12-octave intervals as given by the R.40 series of preferred
numbers in ISO 3 for frequencies from 100 Hz to 4 kHz inclusive. For the
calculation, the averaged measured level at each frequency band is referred to
the averaged test signal level measured in each frequency band.
c) The HATS is diffuse-field equalized. The sensitivity is expressed in terms
of dBPa/V. Information about correction factors is available in subclause
5.1.4.
Optionally, the measurements may be repeated with a 2 N and 13 N application
force. For these test cases no normative values apply.
### 7.4.3 Desktop and vehicle-mounted hands-free UE sending
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
spectrum of the acoustic signal produced by the artificial mouth is calibrated
under free-field conditions at the MRP. The test signal level shall be -4,7
dBPa measured at the MRP. The test signal level is calculated over the
complete test signal sequence. The broadband signal level is then adjusted to
-28,7 dBPa at the HFRP or the HATS HFRP (as defined in ITU-T Recommendation
P.581) and the spectrum is not altered.
> The spectrum at the MRP and the actual level at the MRP (measured in
> 1/3-octaves) are used as references to determine the sending sensitivity
> SmJ.
b) The hands-free terminal is setup as described in clause 5. Measurements
shall be made at 1/3-octave intervals as given by the R.40 series of preferred
numbers in ISO 3 for frequencies from 100 Hz to 4 kHz inclusive. For the
calculation, the averaged measured level at each frequency band is referred to
the averaged test signal level measured in each frequency band.
c) The sensitivity is expressed in terms of dBV/Pa.
### 7.4.4 Desktop and vehicle-mounted hands-free UE receiving
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
test signal level shall be -16 dBm0 measured at the digital reference point or
the equivalent analogue point. The test signal level is calculated over the
complete test signal sequence.
b) The hands-free terminal is setup as described in clause 5. If a HATS is
used, then it is free-field equalized as described in ITU-T Recommendation
P.581. The equalized output signal of each artificial ear is power-averaged
over the total duration of the analysis; the right and left artificial ear
signals are voltage-summed for each 1/3-octave frequency band; these
1/3-octave band data are considered as the input signal to be used for
calculations or measurements. Measurements shall be made at 1/3-octave
intervals as given by the R.40 series of preferred numbers in ISO 3 for
frequencies from 100 Hz to 4 kHz inclusive. For the calculation the averaged
measured level at each frequency band is referred to the averaged test signal
level measured in each frequency band.
c) The sensitivity is expressed in terms of dBPa/V.
### 7.4.5 Hand-held hands-free UE sending
> a) The test signal to be used for the measurements shall be the British-
> English single talk sequence described in ITU-T Recommendation P.501 [22].
> The spectrum of the acoustic signal produced by the artificial mouth is
> calibrated under free-field conditions at the MRP. The test signal level
> shall be -4,7 dBPa measured at the MRP. The test signal level is calculated
> over the complete test signal sequence. The broadband signal level then is
> adjusted to -28,7 dBPa at the HFRP or the HATS HFRP (as defined in ITU-T
> Recommendation P.581) and the spectrum is not altered.
>
> The spectrum at the MRP and the actual level at the MRP (measured in
> 1/3-octaves) are used as reference to determine the sending sensitivity SmJ.
b) The hands-free terminal is setup as described in clause 5. Measurements
shall be made at 1/3-octave intervals as given by the R.40 series of preferred
numbers in ISO 3 for frequencies from 100 Hz to 4 kHz inclusive. For the
calculation, the averaged measured level at each frequency band is referred to
the averaged test signal level measured in each frequency band.
c) The sensitivity is expressed in terms of dBV/Pa.
### 7.4.6 Hand-held hands-free UE receiving
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
test signal level shall be -16 dBm0 measured at the digital reference point or
the equivalent analogue point. The test signal level is calculated over the
complete test signal sequence.
b) The hands-free terminal is setup as described in clause 5. If a HATS is
used, then it is free-field equalized as described in ITU-T Recommendation
P.581. The equalized output signal of each artificial ear is power-averaged
over the total duration of the analysis; the right and left artificial ear
signals are voltage-summed for each 1/3-octave band frequency band; these
1/3-octave band data are considered as the input signal to be used for
calculations or measurements. Measurements shall be made at 1/3-octave
intervals as given by the R.40 series of preferred numbers in ISO 3 for
frequencies from 100 Hz to 4 kHz inclusive. For the calculation, the averaged
measured level at each frequency band is referred to the averaged test signal
level measured in each frequency band.
c) The sensitivity is expressed in terms of dBPa/V.
## 7.5 Sidetone characteristics
### 7.5.1 Connections with handset UE
The test signal to be used for the measurements shall be the British-English
single talk sequence described in ITU-T Recommendation P.501 [22]. The
spectrum of the acoustic signal produced by the artificial mouth is calibrated
under free-field conditions at the MRP. The test signal level shall be -4,7
dBPa measured at the MRP. The test signal level is calculated over the
complete test signal sequence.
#### 7.5.1.1 void
#### 7.5.1.2 Connections with handset UE -- HATS method
The handset UE is setup as described in clause 5. The application force shall
be 13 N on the Type 3.3 artificial ear.
Where a user operated volume control is provided, the measurements shall be
carried out at the nominal setting of the volume control. In addition the
measurement is repeated at the maximum volume control setting. It is expected
that for other positions of the volume control setting a consistent behaviour
to that of the nominal and maximum settings should be observed. Additional
measurements for these positions are not required.
Measurements shall be made at 1/12-octave intervals as given by the R.40
series of preferred numbers in ISO 3 for frequencies from 100 Hz to 8 kHz
inclusive. The averaged measured level at each frequency band is referred to
the averaged test signal level measured in each frequency band.
The sidetone path loss (LmeST), as expressed in dB, shall be calculated from
each 1/3^rd^-octave band (ITU-T Recommendation P.79 [16], table B.1, bands 4
to 17). The Sidetone Masking Rating (STMR), expressed in dB, shall be
calculated from formula B-4 of ITU-T Recommendation P.79 [16], using m = 0.225
and the weighting factors in table B.2 (unsealed condition) of ITU-T
Recommendation P.79 [16]. No leakage correction (L~E~) shall be applied. DRP-
ERP correction is used.
In case the STMR is below the limit, the measurement shall be repeated with
the electrical sidetone path disabled and both sets of results shall be
reported. In case the STMR is below the limit also with the electrical
sidetone path disabled, the result shall not be regarded as a failure.
Disconnecting the call is normally disabling the electrical sidetone path;
otherwise the UE can be switched off to enter the wanted state.
### 7.5.2 Headset UE
The test signal to be used for the measurements shall be the British-English
single talk sequence described in ITU-T Recommendation P.501 [22]. The
spectrum of the acoustic signal produced by the artificial mouth is calibrated
under free-field conditions at the MRP. The test signal level shall be -4,7
dBPa measured at the MRP. The test signal level is calculated over the
complete test signal sequence.
Where a user operated volume control is provided, the measurements shall be
carried out at the nominal setting of the volume control. In addition the
measurement is repeated at the maximum volume control setting. It is expected
that for other positions of the volume control setting a consistent behaviour
to that of the nominal and maximum settings should be observed. Additional
measurements for these positions are not required.
Measurements shall be made at 1/12-octave intervals as given by the R.40
series of preferred numbers in ISO 3 for frequencies from 100 Hz to 8 kHz
inclusive. The averaged measured level at each frequency band is referred to
the averaged test signal level measured in each frequency band.
The sidetone path loss (_LmeST_), as expressed in dB, shall be calculated from
each 1/3^rd^-octave band (ITU-T Recommendation P.79 [16], table B.1, bands 4
to 17). The STMR (in dB) shall be calculated from formula B-4 of ITU-T
Recommendation P.79 [16], using m = 0.225 and the weighting factors in table
B.2 (unsealed condition) of ITU-T Recommendation P.79 [16]. No leakage
correction (L~E~) shall be applied. DRP-ERP correction is used.
In case the STMR is below the limit, the measurement shall be repeated with
the electrical sidetone path disabled and both sets of results shall be
reported. In case the STMR is below the limit also with the electrical
sidetone path disabled, the result shall not be regarded as a failure.
Disconnecting the call is normally disabling the electrical sidetone path;
otherwise the UE can be switched off to enter the wanted state.
### 7.5.3 Hands-free UE (all categories)
No requirement other than echo control.
### 7.5.4 Sidetone delay for handset or headset
The handset or headset terminal is setup as described in clause 5.
The test signal is a CS-signal complying with ITU-T Recommendation P.501 using
a PN-sequence with a length, T, of 4 096 points (for a 48 kHz sample rate test
system). The duration of the complete test signal is as specified in ITU-T
Recommendation P.501. The level of the signal shall be ‑4,7 dBPa at the MRP.
The cross-correlation function Φxy(τ) between the input signal Sx(t) generated
by the test system in send direction and the output signal Sy(t) measured at
the artificial ear is calculated in the time domain:
$\Phi_{\text{xy}}(\tau) = \frac{1}{T}\int_{t = \frac{-
T}{2}}^{\frac{T}{2}}S_{x}(t) \cdot S_{y}(t + \tau)$
The measurement window, _T_ , shall be identical to the test signal period, T,
with the measurement window synchronized to the PN-sequence of the test
signal.
The sidetone delay is calculated from the envelope E(τ) of the cross-
correlation function Φxy(τ). The first maximum of the envelope function occurs
in correspondence with the direct sound produced by the artificial mouth; the
second one occurs with a possible delayed sidetone signal. The difference
between the two maxima corresponds to the sidetone delay. The envelope E(τ) is
calculated by the Hilbert transformation H {xy(τ)} of the cross-correlation:
$H\left{ \text{xy}(\tau) \right} = \sum_{u = - \infty}^{+
\infty}\frac{\Phi_{\text{xy}}(u)}{\pi(\tau - u)}$
$E(\tau) = \sqrt{\left\lbrack \Phi_{\text{xy}}(\tau) \right\rbrack^{2} +
\left\lbrack H\left{ \text{xy}(\tau) \right} \right\rbrack^{2}}$
It is assumed that the measured sidetone delay is less than T/2.
## 7.6 Stability loss
Where a user-controlled volume control is provided it is set to maximum.
**Handset UE:** The handset is placed on a hard plane surface with the
earpiece facing the surface.
**Headset UE:** The requirement applies for the closest possible position
between microphone and headset receiver within the intended wearing position.
NOTE: Depending on the type of headset it may be necessary to repeat the
measurement in different positions.
**Hands-free UE (all categories):** No requirement other than echo loss.
Before the actual test a training sequence consisting of the British-English
single talk sequence described in ITU-T Recommendation P.501 [22] is applied.
The training sequence level shall be -16 dBm0 in order to not overload the
codec.
The test signal is a PN-sequence complying with ITU-T Recommendation P.501
with a length of 4 096 points (for a 48 kHz sampling rate system) and a crest
factor of 6 dB instead of 11 dB. The PN-sequence is generated as described in
P.501 with W(k) constant within the frequency range 200-4000 Hz and zero
outside this range. The duration of the test signal is 250 ms. With an input
signal of ‑3 dBm0, the attenuation from input to output of the system
simulator shall be measured under the following conditions:
a) The handset or the headset, with the transmission circuit fully active,
shall be positioned on a hard plane surface with at least 400 mm free space in
all directions; the earpiece shall face towards the surface as shown in figure
15c;
b) The headset microphone is positioned as close as possible to the
receiver(s) within the intended wearing position;
c) For a binaural headset, the receivers are placed symmetrically around the
microphone.
Figure 15a. Void
Figure 15b. Void
{width="6.699305555555555in" height="4.73125in"}
NOTE: All dimensions in mm.
Figure 15c. Test configuration for stability loss measurement on handset or
headset UE
The attenuation from input to output of the system simulator shall be measured
in the frequency range from 200 Hz to 4 kHz. The spectral distribution of the
output signal is analysed with a 4k FFT (for a 48 kHz sample rate test
system), thus the measured part of the output signal is 85.333 ms. To avoid
leakage effects, the frequency resolution of the FFT must be the same as the
frequency spacing of the PN-sequence.
## 7.7 Acoustic echo control
### 7.7.1 General
The echo loss (EL) presented by the GSM, 3G or LTE networks at the POI should
be at least 46 dB during single talk. This value takes into account the fact
that UE is likely to be used in a wide range of noise environments.
### 7.7.2 Acoustic echo control in a hands-free UE
The hands-free UE is setup in a room with acoustic properties similar to a
typical "office-type" room; a vehicle-mounted hands-free UE should be tested
in a vehicle or vehicle simulator, as specified by the UE manufacturer (see
also 3GPP TS 03.58 [11]). The ambient noise level ≤ 70 dBPa(A). The
attenuation from reference point input to reference point output shall be
measured using the compressed real speech signal described in clause 7.3.3 of
ITU-T P.501 Amendment 1 [33].
The TCLw is calculated according to ITU-T Recommendation G.122 [8], annex B,
clause B.4 (trapezoidal rule). For the calculation, the averaged measured echo
level at each frequency band is referred to the averaged test signal level
measured in each frequency band. The first 17,0 s of the test signal (6
sentences) are discarded from the analysis to allow for convergence of the
acoustic echo canceller. The analysis is performed over the remaining length
of the test sequence (last 6 sentences).
The test signal level shall be ‑10 dBm0.
### 7.7.3 Acoustic echo control in handset UE
The handset is set up according to clause 5. The ambient noise level shall be
≤ ‑64 dBPa(A). The attenuation from the reference point input to reference
point output shall be measured using the compressed real speech signal
described in clause 7.3.3 of ITU-T P.501 Amendment 1 [33].
The TCLw is calculated according to ITU-T Recommendation G.122 [8], annex B,
clause B.4 (trapezoidal rule). For the calculation, the averaged measured echo
level at each frequency band is referred to the averaged test signal level
measured in each frequency band. The first 17,0 s of the test signal (6
sentences) are discarded from the analysis to allow for convergence of the
acoustic echo canceller. The analysis is performed over the remaining length
of the test sequence (last 6 sentences).
The test signal level shall be ‑10 dBm0.
### 7.7.4 Acoustic echo control in a headset UE
The headset is set up according to clause 5. The ambient noise level shall be
≤ ‑64 dBPa(A). The attenuation from reference point input to reference point
output shall be measured using the compressed real speech signal described in
clause 7.3.3 of ITU-T P.501 Amendment 1 [33].
The TCLw is calculated according to ITU-T Recommendation G.122 [8], annex B,
clause B.4 (trapezoidal rule). For the calculation, the averaged measured echo
level at each frequency band is referred to the averaged test signal level
measured in each frequency band. The first 17,0 s of the test signal (6
sentences) are discarded from the analysis to allow for convergence of the
acoustic echo canceller. The analysis is performed over the remaining length
of the test sequence (last 6 sentences).
The test signal level shall be ‑10 dBm0.
## 7.8 Distortion
### 7.8.1 Sending distortion
The handset, headset, or hands-free UE is setup as described in clause 5.
The signal used is a sine‑wave signal with a frequency of 1020 Hz. The sine-
wave signal level shall be calibrated to the following RMS levels at the MRP:
5, 0, ‑4,7, ‑10, ‑15, ‑20 dBPa. The test signals have to be applied in this
sequence, i.e., from high levels down to low levels.
The duration of the sine-wave signal is recommended to be 360 ms. The
manufacturer shall be allowed to request tone lengths up to 1 s. The measured
part of the signal shall be 170.667 ms (which equals 2 * 4096 samples in a 48
kHz sample rate test system). The times are selected to be relatively short in
order to reduce the risk that the test tone is treated as a stationary signal.
It is recommended that an optional activation signal be presented immediately
preceding each test signal to ensure that the UE is in a typical state during
measurement. An appropriate speech or speech-like activation signal shall be
chosen from ITU-T Recommendations P.501 or P.50 [10]. A recommendation for the
use of an activation signal as part of the measurement is defined in figure
16. The RMS level of the active parts of this activation signal is recommended
to be equal to the subsequent test tone RMS level. In practice, certain types
of processing may be impacted due to the introduction of the activation
signal. The manufacturer shall be allowed to specify disabling of the
activation signal. It shall be reported whether an activation signal was used
or not, along with the characteristics of the activation signal, as specified
by the manufacturer.
The ratio of the signal to total distortion power of the signal output of the
SS shall be measured with the psophometric noise weighting (see ITU‑T
Recommendations G.712, O.41 and 0.132). The psophometric filter shall be
normalized (0 dB gain) at 800 Hz as specified in ITU-T Recommendation O.41.
The weighting function shall be applied to the total distortion component only
(not to the signal component).
For measurement of the total distortion component an octave-wide band-stop
filter shall be applied to the signal to suppress the sine-wave signal and
associated coding artefacts. The filter shall have a lower passband ending at
0.7071 * f~S~, and an upper passband starting at 1,4142 * f~S~, where f~S~ is
the frequency of the sine-wave signal. The passband ripple of the filter shall
be ≤ 0.2 dB. The attenuation of the band-stop filter at the sine-wave
frequency shall be ≥ 60 dB. Alternatively, the described characteristics can
be implemented by an appropriate weighting on the spectrum obtained from an
FFT. The total distortion component is defined as the measured signal within
the frequency range 200 Hz to 4 kHz, after applying psophometric and stop
filters (hence no correction for the lost power due to the stop filter, known
as "bandwidth correction", shall be applied).
To improve repeatability, considering the variability introduced by speech
coding and voice processing, the test sequence (activation signal followed by
the test signal) may be contiguously repeated one or more times.. The single
signal-to-total-distortion power ratios obtained from such repeats shall be
averaged. The total result shall be 10 * log~10~ of this average in dB.
{width="3.738888888888889in" height="1.9743055555555555in"}
Figure 16: Recommended activation sequence and test signal.
The activation signal consists of a "Bandlimited composite source signal with
speech-like power density spectrum" signal according to ITU-T Recommendation
P.501 with 48,62 ms voiced part (1), 200 ms unvoiced part (2) and 101,38 ms
pause (3), followed by the same signal but polarity inverted (4, 5, 6),
followed by the voiced part only (7). The pure test tone is applied and after
50 ms settling time (8), the analysis is made over the following 170,667 ms
(9).
NOTE 1: Void.
NOTE 2: In order to ensure that the correct part of the signal is analyzed,
the total delay of the terminal and SS may have to be determined prior to the
measurement.
NOTE 3: For hands-free terminals tested in environments defined in subclause
6.1.2, care should be taken that the reverberation in the test room, caused by
the activation signal, does not affect the test results to an unacceptable
degree, referring to subclause 5.3.
### 7.8.2 Receiving
The handset, headset, or hands-free UE is setup as described in clause 5.
The signal used is a sine‑wave signal with frequencies specified in clause 5.8
of 3GPP TS 26.131. The signal level shall be ‑16 dBm0, except for the
sine‑wave signal with a frequency 1020 Hz that shall be applied at the signal
input of the SS at the following levels: 0, ‑3, ‑10, ‑16, ‑20, ‑30, ‑40, ‑45
dBm0. The test signals have to be applied in this sequence, i.e., from high
levels down to low levels.
The duration of the sine-wave signal is recommended to be 360 ms. The
manufacturer shall be allowed to request tone lengths up to 1 s. The measured
part of the signal shall be 170.667 ms (which equals 2 * 4096 samples in a 48
kHz sample rate test system). The times are selected to be relatively short in
order to reduce the risk that the test tone is treated as a stationary signal.
It is recommended that an optional activation signal be presented immediately
preceding each test signal to ensure that the UE is in a typical state during
measurement. An appropriate speech or speech-like activation signal shall be
chosen from ITU-T Recommendations P.501 or P.50 [10]. A recommendation for the
use of an activation signal as part of the measurement is defined in figure
17. The RMS level of the active parts of this activation signal is recommended
to be equal to the subsequent test tone RMS level for low and medium test
levels. To avoid saturation of the SS speech encoder, it is recommended for
high test levels that the activation signal level be adjusted such that its
peak level equals the peak level of the test tone. In practice, certain types
of processing may be impacted due to the introduction of the activation
signal. The manufacturer shall be allowed to specify disabling of the
activation signal. It shall be reported whether an activation signal was used
or not, along with the characteristics of the activation signal, as specified
by the manufacturer.
The ratio of the signal to total distortion power shall be measured at the
applicable acoustic measurement point (DRP with diffuse-field correction for
handset and headset modes; free field for hands-free modes) with psophometric
noise weighting (see ITU‑T Recommendations G.712, O.41 and 0.132). The
psophometric filter shall be normalized to have 0 dB gain at 800 Hz as
specified in ITU-T Recommendation O.41. The weighting function shall be
applied to the total distortion component only (not to the signal component).
For measurement of the total distortion component an octave-wide band-stop
filter shall be applied to the signal to suppress the sine-wave signal and
associated coding artefacts. The filter shall have a lower passband ending at
0,7071 * f~S~, and an upper passband starting at 1,4142 * f~S~, where f~S~ is
the frequency of the sine-wave signal. The passband ripple of the filter shall
be ≤ 0.2 dB. The attenuation of the band-stop filter at the sine-wave
frequency shall be ≥ 60 dB. Alternatively, the described characteristics can
be implemented by an appropriate weighting on the spectrum obtained from an
FFT. The total distortion component is defined as the measured signal within
the frequency range 200 Hz to 4 kHz, after applying psophometric and stop
filters (hence no correction for the lost power due to the stop filter, known
as "bandwidth correction", shall be applied).
To improve repeatability, considering the variability introduced by speech
coding and voice processing, the test sequence (activation signal followed by
the test signal) may be contiguously repeated one or more times. The single
signal-to-total-distortion power ratios obtained from such repeats shall be
averaged. The total result shall be 10 * log~10~ of this average in dB.
{width="3.738888888888889in" height="1.9743055555555555in"}
Figure 17: Recommended activation sequence and test signal.
The activation signal consists of a "Bandlimited composite source signal with
speech-like power density spectrum" signal according to ITU-T Recommendation
P.501 with 48,62 ms voiced part (1), 200 ms unvoiced part (2) and 101,38 ms
pause (3), followed by the same signal but polarity inverted (4, 5, 6),
followed by the voiced part only (7). The pure test tone is applied and after
50 ms settling time (8), the analysis is made over the following 170,667 ms
(9).
NOTE 1: Void.
NOTE 2: In order to ensure that the correct part of the signal is analyzed,
the total delay of the terminal and SS may have to be determined prior to the
measurement.
NOTE 3: For hands-free terminals tested in environments defined in subclause
6.1.2, care should be taken that the reverberation in the test room, caused by
the activation signal, does not affect the test results to an unacceptable
degree, referring to subclause 5.3.
## 7.9 Void
## 7.10 Delay
### 7.10.0 UE Delay Measurement Methodologies
For UMTS circuit-switched operation and MTSI-based speech with LTE access in
error and jitter free conditions, the sum of the UE delays in the sending and
receiving directions (T~S~+T~R~) shall be measured according to the methods
described in clauses 7.10.1 and 7.10.2. In the event that the delays of the
test equipment in send and/or receive directions are not stable between calls
or cannot be accurately determined, the alternative method described in clause
7.10.3 may be used to obtain (T~S~+T~R~) and the measured instability or
inaccuracy observed when the methods described in 7.10.1 and 7.10.2 were
performed shall be recorded in the test report. The test method(s) used and
all results obtained shall also be recorded in the test report.
For MTSI-based speech with LTE access in conditions with simulated packet
arrival time variations, the sum of the UE delays in the sending and receiving
directions (T~S~+T~R-jitter~) and the objective speech quality in the receive
direction shall be measured according to the method described in clause
7.10.4.
For MTSI-based speech with LTE access, prior to the actual measurements, the
clock drift between UE and reference client shall be compensated by adjusting
the clock of the reference client to match the clock of the UE (as stated in
clause 5). The inaccuracy of the clock drift adjustment shall be less than
1ppm measured according to the procedure in Annex D.
It shall be ensured that the packet generation by the reference client and the
packet treatment of the test equipment are free of jitter.
### 7.10.1 Delay in sending direction (Handset UE)
The handset terminal is setup as described in clause 5.1.1.
The UE delay in the sending direction is obtained by measuring the delay
between MRP and the electrical access point of the test equipment and
subtracting the delays introduced by the test equipment from the measured
value.
{width="6.333333333333333in" height="2.2395833333333335in"}
Figure 17b1: Different entities when measuring the delay in sending direction
The delay measured from MRP to the electrical access point of the test
equipment is T~S~ + T~TES~.
T~TES~: The delay between the last bit of a speech frame at the system
simulator antenna and the first electrical event at the electrical access
point of the test equipment.
1\. For the measurements, a Composite Source Signal (CSS) according to ITU-T
Recommendation P.501 [22] is used. The pseudo random noise (pn)-part of the
CSS has to be longer than the maximum expected delay. It is recommended to use
a pn sequence of 32 k samples (with 48 kHz sampling rate). The test signal
level is -4,7 dBPa at the MRP.
2 The reference signal is the original signal (test signal). The setup of the
handset/headset terminal is made corresponding to clause 5.1.
3\. The delay is determined by cross-correlation analysis between the measured
signal at the electrical access point and the original signal. The measurement
is corrected by subtracting the test equipment delay T~TES~.
4\. The delay is measured in ms and the maximum of the cross-correlation
envelope is used for the determination.
For MTSI-based speech with LTE access, a variability of up to 20ms may be
expected between different calls due to the synchronization between the speech
frame processing in the sending UE and the bits of the speech frames at the UE
antenna. This synchronization is attributed to the UE sending delay according
to the definition of the UE delay reference points. Hence, the maximum value
of the UE sending delay obtained from at least 5 individual calls shall be
reported as the UE delay in the sending direction. All values shall be
reported in the test report.
A further variability of up to 20ms may be expected between different calls
due to the synchronization between the speech frames at the UE antenna and the
speech frame processing in the receiving reference client of the test system.
In an end-to-end call this synchronization of the frames will only take place
at the receiver, and this variability of the measurement shall be deduced from
the UE sending delay. Hence, if the reference client of the test equipment
does not adjust for the effect of the speech frame synchronization (as
specified by the manufacturer of the reference client), this maximum
uncertainty shall be subtracted from measured maximum value reported as the UE
sending delay in order to compensate for the uncertainty of the test
equipment. This correction value (i.e. maximum uncertainty) shall be reported
in the test report.
### 7.10.1a Delay in sending direction (headset UE)
The UE delay in the sending direction is obtained by measuring the delay
between MRP and the electrical access point of the test equipment and
subtracting the delays introduced by the test equipment from the measured
value.
{width="7.284027777777778in" height="2.5805555555555557in"}
Figure 17b2: Different entities when measuring the delay in sending direction
with a headset connected via cable
NOTE: The test setup only applies to headsets connected by wire. Wireless
headsets (e.g. connected by Bluetooth) are currently out of scope.
The test method is the same as for handset UE (clause 7.10.1).
### 7.10.2 Delay in receiving direction (handset UE)
The handset terminal is setup as described in clause 5.
The UE delay in the receiving direction is obtained by measuring the delay
between the electrical access point of the test equipment and the DRP and
subtracting the delays introduced by the test equipment from the measured
value.
{width="6.333333333333333in" height="2.25in"}
Figure 17b3: Different entities when measuaring the delay in receiving
direction
The delay measured from the electrical access point of the test equipment to
DRP is T~R~ + T~TER~.
T~TER~: The delay between the first electrical event at the electrical access
point of the test equipment and the first bit of the corresponding speech
frame at the system simulator antenna.
Before the actual test for MTSI-based speech with LTE access a conditioning
sequence consisting of the British-English single talk sequence described in
ITU-T Recommendation P.501 [22] is applied for convergence of the jitter
buffer management of the UE. The conditioning sequence level shall be -16 dBm0
in order to not overload the codec.
1\. For the measurements a Composite Source Signal (CSS) according to ITU-T
Recommendation P.501 [22] is used. The pseudo random noise (pn)-part of the
CSS has to be longer than the maximum expected delay. It is recommended to use
a pn sequence of 32 k samples (with 48 kHz sampling rate).The test signal
level is -16 dBm0 measured at the digital reference point or the equivalent
analogue point.
2 The reference signal is the original signal (test signal). The setup of the
handset/headset terminal is in correspondence to clause 5.1.
3\. The delay is determined by cross-correlation analysis between the measured
signal at the electrical access point and the original signal. The measurement
is corrected by subtracting the test equipment delay T~TER~.
4\. The delay is measured in ms and the maximum of the cross-correlation
envelope is used for the determination.
For MTSI-based speech with LTE access, a variability of up to 20ms may be
expected between different calls due to the synchronization between the bits
of the speech frames at the UE antenna and the speech frame processing in the
receiving UE. This synchronization is attributed to the UE receiving delay
according to the definition of the UE delay reference points. Hence, the
maximum value of the UE receiving delay obtained from at least 5 individual
calls shall be reported as the UE delay in the receiving direction. All values
shall be reported in the test report.
### 7.10.2a Delay in receiving direction (headset UE)
The UE delay in the receiving direction is obtained by measuring the delay
between the electrical access point of the test equipment and the DRP and
subtracting the delays introduced by the test equipment from the measured
value.
{width="7.284027777777778in" height="2.5805555555555557in"}
Figure 17b4: Different entities when measuring the delay in receiving
direction with a headset connected via cable
NOTE: The test setup only applies to headsets connected by wire. Wireless
headsets (e.g. connected by Bluetooth) are currently out of scope.
The test method is the same as for handset UE (clause 7.10.2).
### 7.10.3 Delay in sending + receiving direction using "echo" method (handset
UE)
The UE delay is obtained by measuring the delay between the MRP and the DRP
and subtracting the delays introduced by the test equipment from the measured
value.
{width="5.99375in" height="3.814583333333333in"}
Figure 17b4bis: Different entities when measuring the delay in sending +
receiving direction
The delay measured from MRP to DRP is (T~S~ + T~R~ + T~SS~).
T~SS~: The delay between the last bit of a speech frame at the system
simulator antenna and the first bit of the looped back speech frame at the
system simulator antenna.
Before the actual test for MTSI-based speech with LTE access a conditioning
sequence consisting of the British-English single talk sequence described in
ITU-T Recommendation P.501 [22] is applied for convergence of the jitter
buffer management of the UE. The conditioning sequence level shall be -16 dBm0
in order to not overload the codec.
1\. For the measurements a Composite Source Signal (CSS) according to ITU-T
Recommendation P.501 [22] is used. It is recommended to use a pn sequence of
32 k samples (with 48 kHz sampling rate). The test signal level is -4.7 dBPa
at the MRP.
2\. The system simulator is configured for "loopback" or "echo" operation with
the additional loopback delay as specified below when applicable. In
"loopback" or "echo" operation, the packets in the sending direction are
routed to the receiving direction by the system simulator.
3\. The reference signal is the original signal (test signal). The setup of
the mobile station is in correspondence to clause 5.1.
4\. The mouth-to-ear delay is determined by cross-correlation analysis between
the measured signal at DRP and the original signal. The analysis window for
the cross-correlation shall start at an instant T > 50ms in order to discard
the cross-correlation peaks corresponding to the direct acoustic path from
mouth to ear and possible delayed sidetone signal. The measurement is
corrected by subtracting the system simulator delay T~SS~ to obtain the T~S~ +
T~R~ delay.
5\. The delay is measured in ms and the maximum of the cross-correlation
envelope is used for the determination.
For MTSI-based speech with LTE access, a variability of the UE delay with up
to 20ms in the respective sending and receiving direction may be expected due
to the synchronization of the speech frame processing in the UE to the bits of
the speech frame on the UE antenna. This synchronization is attributed to the
UE delay according to the definition of the UE delay reference points. Hence,
the UE delay shall be reported as the maximum value from at least 5 separate
calls each with a different loopback delay T~SS~ in at least 5 steps of 4ms in
the full range from 0 to 16ms. All values shall be reported in the test
report.
### 7.10.3a Delay in sending + receiving direction using "echo" method
(headset UE)
The UE delay is obtained by measuring the delay between the MRP and the DRP
and subtracting the delays introduced by the test equipment, T~SS~, from the
measured value.
The test method is the same as for handset UE (clause 7.10.3).
### 7.10.4 Delay and speech quality in conditions with packet arrival time
variations and packet loss
#### 7.10.4.1 Delay in sending direction
The UE delay in the sending direction, T~S~, shall be measured in jitter and
error free conditions according to clause 7.10.0.
#### 7.10.4.2 Delay in receiving direction
For this test it shall be ensured that the call is originated from the mobile
terminal (MO).
In receiving direction, the delay between the electrical access point of the
test equipment and the DRP, T~TEAP-DRP~(t) = T~R-jitter~(t) + T~TER,~ is
measured continuously for a speech signal during the inclusion of packet delay
and loss profiles in the receiving direction RTP voice stream.
Packet impairments shall be applied between the reference client and system
simulator eNodeB. The start of the delay profiles must be synchronized with
the start of the downlink speech material reproduction (compensated by the
delay between reproduction and the point of impairment insertion, i.e. the
delay of the reference client) in order to ensure a repeatable application of
impairments to the test speech signal. Tests shall be performed with DTX
disabled in the reference client. The use of DTX enabled for this test is for
further study.
NOTE 1: RTP packet impairments representing packet delay variations and loss
in LTE transmission scenarios are specified in Annex E. Care must be taken
that the system simulator uses a dedicated bearer with no buffering/scheduling
of packets for transmission.
For the speech signal, 8 English test sentences according to ITU-T P.501 Annex
B.3.3, normalized to an active speech level of -16dBm0, are used (2 male, 2
female speakers). The sequences are concatenated in such a way that all
sentences are centered within a 4.0s time window, which results in an overall
duration of 32.0s. The sequences are repeated 5 times, resulting in a test
file 160.0s long. The first 2 sentences are used for convergence of the UE
jitter buffer manager and are discarded from the analysis. Equivalent
implementations of the concatenation by repeating the test sentences in
sequence may be used.
NOTE 2: Two out of the four sentence pairs are not compliant with ITU-T
Recommendation P.863.1.
For the delay calculation, a cross-correlation with a rectangular window
length of 4s, centered at each sentence of the stimulus file, is used. The
process is repeated for each sample. For each cross correlation, the maximum
of the envelope is obtained producing one delay value per sentence.
The UE delay in the receive direction, T~R-jitter~(t), is obtained by
subtracting the delay introduced by the test equipment and the simulated
transport network packet delay introduced by the delay and loss profile (as
specified for the respective profile in Annex E) from the first electrical
event at the electrical access point of the test equipment to the first bit of
the corresponding speech frame at the system simulator antenna, T~TER~, from
the measured T~TEAP-DRP~(t).
For stationary packet delay variation test conditions (test condition 1 and
2), the first 2 sentences are used for convergence of the jitter buffer
management and are discarded from the analysis. The UE delay in the receiving
direction shall be reported as the maximum value excluding the two largest
values of the remaing sequence of the 38 sentence delay values, i.e. the
95-percentile value of T~R-jitter~(t)). The values for all 40 sentences shall
be reported in the test report.
NOTE 3: The synchronization of the speech frame processing in the UE to the
bits of the speech frames at the UE antenna may lead to a variability of up to
20 ms of the measured UE receive delay between different calls. This
synchronization is attributed to the UE receiving delay according to the
definition of the UE delay reference points. The effect of this possible call-
to-call variation is not taken into account in the UE receive delay
measurement in conditions with simulated packet arrival time variations and
packet loss.
#### 7.10.4.3 Speech quality loss in conditions with packet arrival time
variations and packet loss
For the evaluation of speech quality loss in conditions with packet arrival
time variations and packet loss, the test signal described in clause 7.10.4.2
shall be used. The first 2 sentences are used for convergence of the UE jitter
buffer manager and are discarded from the analysis. Two recordings are used to
produce the speech quality loss metric:
  * A recording obtained in jitter and error free conditions with the test signal described in clause 7.10.4.2 (reference condition)
  * A recording obtained during the application of packet arrival time variations and packet loss as described in clause 7.10.4.2 (test condition)
The speech quality of the signal at the DRP with diffuse-field equalization is
estimated using the measurement algorithm described in ITU-T Recommendation
P.863.
A score shall be computed for each 8s speech sentence pair and averaged to
produce a mean MOS-LQO value for the reference and test conditions.
MOS-LQO~REF~$= (\sum_{i = 1}^{\text{19}}{\text{MOS} -
\text{LQO}_{\text{reference}}}(i)\frac{)}{\text{19}}$
MOS-LQO~TEST~$= (\sum_{i = 1}^{\text{19}}{\text{MOS} -
\text{LQO}_{\text{testcondition}}}(i)\frac{)}{\text{19}}$
NOTE: This evaluation of the speech quality requirement is only applicable to
test conditions with a stationary statistic of the packet delay variation.
Evaluation of the speech quality for a test condition with non-stationary
packet delay variations is for further study.
The synchronization between stimuli and degraded condition shall be done by
the test system before applying the P.863 algorithm on each sentence pair.
### 7.10.5 UE send clock accuracy
For further study.
### 7.10.6 UE receiving with clock drift
For further study.
## 7.11 Echo control characteristics
### 7.11.1 Test set-up and test signals
The device is set up according to clause 5. The ambient noise level shall be ≤
‑64 dBPa(A).
The test shall be performed with the British-English "long" double-talk and
conditioning speech sequences from ITU-T Recommendation P.501 [22], with the
signals in the receiving direction band limited according to clause 5.4.
A description of the test stimuli is presented in Table 2a and Table 2b. The
test sequence is composed of an initial conditioning sequence of 23,5 s and a
double talk sequence of 35 s. For the analysis, the double talk sequence is
divided into two segments, a first double-talk sequence with single short
near-end words (0 -- 20 s), and a second double-talk sequence with continuous
double talk (20 -- 35 s).
The sending speech during double-talk and the "near-end speech only" are
recorded individually, with the "near-end speech only" sequence recorded with
silence in the receiving direction. The time-alignment of the two recorded
sequences is performed off-line during the analysis.
Table 2a: Test stimuli for recording of Echo Canceller operation
* * *
                                **Conditioning**                              **Single words (segment 1) and full sentence (segment 2) double talk**
**Far-end signal** **FB_female_conditioning_seq_long.wav**
**FB_male_female_single-talk_seq.wav** **Artificial mouth signal**
**FB_male_conditioning_seq_long.wav** **FB_male_female_double-talk_seq.wav**
* * *
Table 2b: Test stimuli for reference \"near-end speech only\" recording.
* * *
                                **Conditioning**                              **Single words (segment 1) and full sentence (segment 2) double talk**
**Far-end signal** **FB_female_conditioning_seq_long.wav** **silence**
**Artificial mouth signal** **FB_male_conditioning_seq_long.wav**
**FB_male_female_double-talk_seq.wav**
* * *
The level of the signal of the artificial mouth shall be -4,7 dBPa measured at
the MRP. In order to obtain a reproducible time alignment as seen by the UE,
the artificial mouth signal shall be delayed by the amount of the receiving
direction delay. For the purpose of this alignment, the receiving direction
delay for handset and headset modes is defined from the system simulator input
to the artificial ear. For hands-free modes, the downlink delay is defined
from the system simulator input to the acoustic output from the UE
loudspeaker.
The level of the downlink signal shall be -16 dBm0 measured at the digital
reference point or the equivalent analogue point.
### 7.11.2 Test method
The test method measures the duration of any level difference between the
sending signal of a double-talk sequence (where the echo canceller has been
exposed to simultaneous echo and near-end speech) and the sending signal of
the same near-end speech only. The level difference is classified into eight
categories according to Figure 17b5 and Table 2c, representing various degrees
of "Full duplex operation", "Near-end clipping", and "Residual echo".
NOTE 1: The limits for specifying the categories in Figure 17b5 and Table 2c
are provisional pending further analysis and validation.
NOTE 2: The categories in Figure 17b5 and Table 2c are labelled in a
functional order and the subjective impression of the respective categories is
for further study.
NOTE 3: To reduce potential issues associated with low-frequency test room
noise, a [4^th^]-order high-pass filter with a cut-off frequency of [100] Hz
can be applied before the level computation.
Figure 17b5: Classification of echo canceller performance
Table 2c: Categories for echo canceller performance classification
* * *
Category Level difference (ΔL) Duration (D) Description **A1** -4 dB ≤ ΔL \ The spectrum at the MRP and the actual level at the MRP (measured in
> 1/3-octaves) are used as references to determine the sending sensitivity
> SmJ.
b) The hands-free terminal is setup as described in clause 5. The sending
sensitivity shall be calculated from each band of the 20 frequencies given in
table A.2 of ITU‑T Recommendation P.79 Annex A [16], bands 1 to 20. For the
calculation, the averaged measured level at the electrical reference point for
each frequency band is referred to the averaged test signal level measured in
each frequency band at the MRP.
c) The sensitivity is expressed in terms of dBV/Pa and the SLR shall be
calculated according to ITU‑T Recommendation P.79 [16], formula (A-23b), over
bands 1 to 20, using m = 0,175 and the sending weighting factors from ITU‑T
Recommendation P.79 Annex A [16], table A.2.
#### 8.2.3.2 Receiving loudness rating (RLR)
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
test signal level shall be ‑16 dBm0 measured at the digital reference point or
the equivalent analogue point. The test signal level is calculated over the
complete test signal sequence.
b) The hands-free terminal is setup as described in clause 5. If a HATS is
used, then it is free-field equalized as described in ITU-T Recommendation
P.581. The equalized output signal of each artificial ear is power-averaged
over the total duration of the analysis; the right and left artificial ear
signals are voltage-summed for each 1/3-octave frequency band; these
1/3-octave band data are considered as the input signal to be used for
calculations or measurements. The receiving sensitivity shall be calculated
from each band of the 20 frequencies given in table A.2 of ITU‑T
Recommendation P.79 Annex A [16], bands 1 to 20.
> For the calculation, the averaged measured level at each frequency band is
> referred to the averaged test signal level measured in each frequency band.
c) The sensitivity is expressed in terms of dBPa/V and the RLR shall be
calculated according to ITU‑T Recommendation P.79 [16], formula (A-23c), over
bands 1 to 20, using m = 0,175 and the receiving weighting factors from table
A.2 of ITU‑T Recommendation P.79 Annex A [16].
d) No leakage correction shall be applied. The hands-free correction as
described in ITU‑T Recommendation P.340 shall be applied. To compute the
receiving loudness rating (RLR) for a hands-free terminal (see also ITU-T
Recommendation P.340), when using the combination of left and right artificial
ear signals from the HATS, the HFL~E~ has to be 8 dB instead of 14 dB. For
further information see ITU-T Recommendation P.581.
### 8.2.4 Connections with hand-held hands-free UE
#### 8.2.4.1 Sending loudness rating (SLR)
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
spectrum of the acoustic signal produced by the artificial mouth is calibrated
under free-field conditions at the MRP. The test signal level shall be --4,7
dBPa measured at the MRP. The test signal level is calculated over the
complete test signal sequence. The broadband signal level then is adjusted to
--28,7 dBPa at the HFRP or the HATS HFRP (as defined in P.581) and the
spectrum is not altered.
> The spectrum at the MRP and the actual level at the MRP (measured in
> 1/3-octaves) are used as reference to determine the sending sensitivity SmJ.
b) The hands-free terminal is setup as described in clause 5. The sending
sensitivity shall be calculated from each band of the 20 frequencies given in
table A.2 of ITU‑T Recommendation P.79 Annex A [16], bands 1 to 20. For the
calculation the averaged measured level at the electrical reference point for
each frequency band is referred to the averaged test signal level measured in
each frequency band at the MRP.
c) The sensitivity is expressed in terms of dBV/Pa and the SLR shall be
calculated according to ITU‑T Recommendation P.79 [16], formula (A-23b), over
bands 1 to 20, using m = 0,175 and the sending weighting factors from ITU‑T
Recommendation P.79 Annex A [16], table A.2.
#### 8.2.4.2 Receiving loudness rating (RLR)
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
test signal level shall be ‑16 dBm0 measured at the digital reference point or
the equivalent analogue point. The test signal level is calculated over the
complete test signal sequence.
b) The hands-free terminal is setup as described in clause 5. If a HATS is
used, then it is free-field equalized as described in ITU-T Recommendation
P.581. The equalized output signal of each artificial ear is power-averaged
over the total duration of the analysis; the right and left artificial ear
signals are voltage-summed for each 1/3-octave frequency band; these
1/3-octave band data are considered as the input signal to be used for
calculations or measurements. The receiving sensitivity shall be calculated
from each band of the 20 frequencies given in table A.2 of ITU‑T
Recommendation P.79 Annex A [16], bands 1 to 20.
> For the calculation, the averaged measured level at each frequency band is
> referred to the averaged test signal level measured in each frequency band.
c) The sensitivity is expressed in terms of dBPa/V and the RLR shall be
calculated according to ITU‑T Recommendation P.79 [16], formula (A-23c), over
bands 1 to 20, using m = 0,175 and the receiving weighting factors from table
A.2 of ITU‑T Recommendation P.79 Annex A [16].
d) No leakage correction shall be applied. The hands-free correction as
described in ITU‑T Recommendation P.340 shall be applied. To compute the
receiving loudness rating (RLR) for hands-free terminals (see also ITU-T
Recommendation P.340) when using the combination of left and right artificial
ear signals from the HATS the HFL~E~ has to be 8 dB, instead of 14 dB. For
further information see ITU-T Recommendation P.581.
### 8.2.5 Connections with headset UE
Same as for handset.
## 8.3 Idle channel noise (handset and headset UE)
For idle noise measurements in sending and receiving directions, care should
be taken that only the noise is windowed out by the analysis and the result is
not impaired by any remaining reverberation or by noise and/or interference
from various other sources. Some examples are air-conducted or vibration-
conducted noise from sources inside or outside the test chamber, disturbances
from lights and regulators, mains supply induced noise including grounding
issues, test system and system simulator inherent noise as well as radio
interference from the UE to test equipment such as ear simulators, microphone
amplifiers, etc.
### 8.3.1 Sending
The terminal should be configured to the test equipment as described in
subclause 5.1.
The environment shall comply with the conditions described in subclause 6.1.
The noise level at the output of the SS is measured with A‑weighting. The
A-weighting filter is described in IEC 60651.
A test signal may have to be intermittently applied to prevent 'silent mode'
operation of the MS. This is for further study.
The measured part of the noise shall be 170,667 ms (which equals 8192 samples
in a 48 kHz sample rate test system). The spectral distribution of the noise
is analyzed with an 8k FFT using windowing with ≤ 0,1 dB leakage for non bin-
centered signals. This can be achieved with a window function commonly known
as a "flat top window". Within the specified frequency range, the FFT bin that
has the highest level is searched for; the level of this bin is the maximum
level of a single frequency disturbance.
To improve repeatability, the test sequence (optional activation followed by
the noise level measurement) may be contiguously repeated one or more times.
The total noise powers obtained from such repeats shall be averaged. The total
result shall be 10 * log~10~ of this average in dB.
The single frequency maximum powers obtained from such repeats shall be
averaged. The total result shall be 10 * log~10~ of this average in dB.
### 8.3.2 Receiving
The terminal should be configured to the test equipment as described in
subclause 5.1.
The environment shall comply with the conditions described in subclause 6.1.
A test signal may have to be intermittently applied to prevent 'silent mode'
operation of the MS. This is for further study.
The noise shall be measured with A‑weighting at the DRP with diffuse-field
correction. The A-weighting filter is described in IEC 60651.
The measured part of the noise shall be 170,667 ms (which equals 8192 samples
in a 48 kHz sample rate test system). The spectral distribution of the noise
is analyzed with an 8k FFT using windowing with ≤ 0,1 dB leakage for non bin-
centered signals. This can be achieved with a window function commonly known
as a "flat top window". Within the specified frequency range the FFT bin that
has the highest level is searched for; the level of this bin is the maximum
level of a single frequency disturbance.
To improve repeatability, the test sequence (optional activation followed by
the noise level measurement) may be contiguously repeated one or more times.
The total noise powers obtained from such repeats shall be averaged. The total
result shall be 10 * log~10~ of this average in dB.
The single frequency maximum powers obtained from such repeats shall be
averaged. The total result shall be 10 * log~10~ of this average in dB.
## 8.4 Sensitivity/frequency characteristics
### 8.4.1 Handset and headset UE sending
The headset case is similar to the handset one, except for the application
force.
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
spectrum of the acoustic signal produced by the artificial mouth is calibrated
under free-field conditions at the MRP. The test signal level shall be --4,7
dBPa measured at the MRP. The test signal level is calculated over the
complete test signal sequence.
b) The handset terminal is setup as described in clause 5. Measurements shall
be made at 1/12-octave intervals as given by the R.40 series of preferred
numbers in ISO 3 for frequencies from 100 Hz to 8 kHz inclusive. For the
calculation, the averaged measured level at the electrical reference point for
each frequency band is referred to the averaged test signal level measured in
each frequency band at the MRP.
c) The sensitivity is expressed in terms of dBV/Pa.
### 8.4.2 Handset and headset UE receiving
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
test signal level shall be ‑16 dBm0 measured at the digital reference point or
the equivalent analogue point. The test signal level is calculated over the
complete test signal sequence.
b) The handset terminal is setup as described in clause 5. Measurements shall
be made at 1/12-octave intervals as given by the R.40 series of preferred
numbers in ISO 3 for frequencies from 100 Hz to 8 kHz inclusive. For the
calculation, the averaged measured level at each frequency band is referred to
the averaged test signal level measured in each frequency band.
c) The HATS is diffuse-field equalized. The sensitivity is expressed in terms
of dBPa/V. Information about correction factors is available in subclause
5.1.4.
Optionally, the measurements may be repeated with 2 N and 13 N application
force. For these test cases no normative values apply.
### 8.4.3 Desktop and vehicle-mounted hands-free UE sending
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
spectrum of the acoustic signal produced by the artificial mouth is calibrated
under free-field conditions at the MRP. The test signal level shall be --4,7
dBPa measured at the MRP. The test signal level is calculated over the
complete test signal sequence. The broadband signal level is then adjusted to
--28,7 dBPa at the HFRP or the HATS HFRP (as defined in ITU-T Recommendation
P.581) and the spectrum is not altered.
> The spectrum at the MRP and the actual level at the MRP (measured in
> 1/3-octaves) are used as references to determine the sending sensitivity
> SmJ.
b) The hands-free terminal is setup as described in clause 5. Measurements
shall be made at 1/3-octave intervals as given by the R.40 series of preferred
numbers in ISO 3 for frequencies from 100 Hz to 8 kHz inclusive. For the
calculation the averaged measured level at each frequency band is referred to
the averaged test signal level measured in each frequency band.
c) The sensitivity is expressed in terms of dBV/Pa.
### 8.4.4 Desktop and vehicle-mounted hands-free UE receiving
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
test signal level shall be ‑16 dBm0 measured at the digital reference point or
the equivalent analogue point. The test signal level is calculated over the
complete test signal sequence.
b) The hands-free terminal is setup as described in clause 5. If a HATS is
used, then it is free-field equalized as described in ITU-T Recommendation
P.581. The equalized output signal of each artificial ear is power-averaged
over the total duration of the analysis; the right and left artificial ear
signals are voltage-summed for each 1/3-octave frequency band; these
1/3-octave band data are considered as the input signal to be used for
calculations or measurements. Measurements shall be made at 1/3-octave
intervals as given by the R.40 series of preferred numbers in ISO 3 for
frequencies from 100 Hz to 8 kHz inclusive. For the calculation, the averaged
measured level at each frequency band is referred to the averaged test signal
level measured in each frequency band.
c) The sensitivity is expressed in terms of dBPa/V.
### 8.4.5 Hand-held hands-free UE sending
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
spectrum of the acoustic signal produced by the artificial mouth is calibrated
under free-field conditions at the MRP. The test signal level shall be --4,7
dBPa measured at the MRP. The test signal level is calculated over the
complete test signal sequence. The broadband signal level is then adjusted to
--28.7 dBPa at the HFRP or the HATS HFRP (as defined in ITU-T Recommendation
P.581) and the spectrum is not altered.
> The spectrum at the MRP and the actual level at the MRP (measured in
> 1/3-octaves) are used as reference to determine the sending sensitivity SmJ.
b) The hands-free terminal is setup as described in clause 5.1.3.3.
Measurements shall be made at 1/3-octave intervals as given by the R.40 series
of preferred numbers in ISO 3 for frequencies from 100 Hz to 8 kHz inclusive.
For the calculation, the averaged measured level at each frequency band is
referred to the averaged test signal level measured in each frequency band.
c) The sensitivity is expressed in terms of dBV/Pa.
### 8.4.6 Hand-held hands-free UE receiving
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
test signal level shall be ‑16 dBm0 measured at the digital reference point or
the equivalent analogue point. The test signal level is calculated over the
complete test signal sequence.
b) The hands-free terminal is setup as described in clause 5. If a HATS is
used, then it is free-field equalized as described in ITU-T Recommendation
P.581. The equalized output signal of each artificial ear is power-averaged
over the total duration of the analysis; the right and left artificial ear
signals are voltage-summed for each 1/3-octave band frequency band; these
1/3-octave band data are considered as the input signal to be used for
calculations or measurements. Measurements shall be made at 1/3-octave
intervals as given by the R.40 series of preferred numbers in ISO 3 for
frequencies from 100 Hz to 8 kHz inclusive. For the calculation, the averaged
measured level at each frequency band is referred to the averaged test signal
level measured in each frequency band.
c) The sensitivity is expressed in terms of dBPa/V.
## 8.5 Sidetone characteristics
### 8.5.1 Connections with handset UE
The test signal to be used for the measurements shall be the British-English
single talk sequence described in ITU-T Recommendation P.501 [22]. The
spectrum of the acoustic signal shall be produced by the HATS. The test signal
level shall be ‑4,7 dBPa measured at the MRP. The test signal level is
calculated over the complete test signal sequence.
The handset UE is set up as described in clause 5. The application force shall
be 13 N on the Type 3.3 artificial ear.
Where a user operated volume control is provided, the measurements shall be
carried out at the nominal setting of the volume control. In addition the
measurement is repeated at the maximum volume control setting. It is expected
that for other positions of the volume control setting a consistent behaviour
to that of the nominal and maximum settings should be observed. Additional
measurements for these positions are not required,
Measurements shall be made at 1/12-octave intervals as given by the R.40
series of preferred numbers in ISO 3 for frequencies from 100 Hz to 8 kHz
inclusive. The averaged measured level at each frequency band is referred to
the averaged test signal level measured in each frequency band.
The sidetone path loss (LmeST), as expressed in dB, shall be calculated from
each 1/3^rd^-octave band (ITU-T Recommendation P.79 [16], table B.1, bands 1
to 20). The Sidetone Masking Rating (STMR), expressed in dB, shall be
calculated from formula B-4 of ITU-T Recommendation P.79 [16], using m = 0.225
and the weighting factors in table B2 (unsealed condition) of ITU-T
Recommendation P.79 [16]. No leakage correction (L~E~) shall be applied. DRP-
ERP correction is used.
In case the STMR is below the limit, the measurement shall be repeated with
the electrical sidetone path disabled and both sets of results shall be
reported. In case the STMR is below the limit also with the electrical
sidetone path disabled, the result shall not be regarded as a failure.
Disconnecting the call is normally disabling the electrical sidetone path;
otherwise the UE can be switched off to enter the wanted state.
### 8.5.2 Headset UE
The test signal to be used for the measurements shall be the British-English
single talk sequence described in ITU-T Recommendation P.501 [22]. The
spectrum of the acoustic signal produced by the artificial mouth is calibrated
under free-field conditions at the MRP. The test signal level shall be --4,7
dBPa measured at the MRP. The test signal level is calculated over the
complete test signal sequence.
Where a user operated volume control is provided, the measurements shall be
carried out at the nominal setting of the volume control. In addition the
measurement is repeated at the maximum volume control setting. It is expected
that for other positions of the volume control setting a consistent behaviour
to that of the nominal and maximum settings should be observed. Additional
measurements for these positions are not required,
Measurements shall be made at 1/12-octave intervals as given by the R.40
series of preferred numbers in ISO 3 for frequencies from 100 Hz to 8 kHz
inclusive. The averaged measured level at each frequency band is referred to
the averaged test signal level measured in each frequency band.
The sidetone path loss (_LmeST_), as expressed in dB, shall be calculated from
each 1/3^rd^-octave band (ITU-T Recommendation P.79 [16], table B.1, bands 1
to 20). The STMR (in dB) shall be calculated from formula B-4 of ITU-T
Recommendation P.79 [16], using m = 0.225 and the weighting factors in table
B.2 (unsealed condition) of ITU-T Recommendation P.79 [16]. No leakage
correction (L~E~) shall be applied. DRP-ERP correction is used.
In case the STMR is below the limit, the measurement shall be repeated with
the electrical sidetone path disabled and both sets of results shall be
reported. In case the STMR is below the limit also with the electrical
sidetone path disabled, the result shall not be regarded as a failure.
Disconnecting the call is normally disabling the electrical sidetone path;
otherwise the UE can be switched off to enter the wanted state.
### 8.5.3 Hands-free UE (all categories)
No requirement other than echo control.
### 8.5.4 Sidetone delay for handset or headset
The handset or headset terminal is setup as described in clause 5.
The test signal is a CS-signal complying with ITU-T Recommendation P.501 using
a PN-sequence with a length, T, of 4 096 points (for a 48 kHz sample rate test
system). The duration of the complete test signal is as specified in ITU-T
Recommendation P.501. The level of the signal shall be ‑4,7 dBPa at the MRP.
The cross-correlation function Φxy(τ) between the input signal Sx(t) generated
by the test system in send direction and the output signal Sy(t) measured at
the artificial ear is calculated in the time domain:
$\Phi_{\text{xy}}(\tau) = \frac{1}{T}\int_{t = \frac{-
T}{2}}^{\frac{T}{2}}S_{x}(t) \cdot S_{y}(t + \tau)$ (1)
The measurement window, _T_ , shall be identical to the test signal period, T,
with the measurement window synchronized to the PN-sequence of the test
signal.
The sidetone delay is calculated from the envelope E(τ) of the cross-
correlation function Φxy(τ). The first maximum of the envelope function occurs
in correspondence with the direct sound produced by the artificial mouth; the
second one occurs with a possible delayed sidetone signal. The difference
between the two maxima corresponds to the sidetone delay. The envelope E(τ) is
calculated by the Hilbert transformation H {xy(τ)} of the cross-correlation:
$H\left{ \text{xy}(\tau) \right} = \sum_{u = - \infty}^{+
\infty}\frac{\Phi_{\text{xy}}(u)}{\pi(\tau - u)}$ (2)
$E(\tau) = \sqrt{\left\lbrack \Phi_{\text{xy}}(\tau) \right\rbrack^{2} +
\left\lbrack H\left{ \text{xy}(\tau) \right} \right\rbrack^{2}}$ (3)
It is assumed that the measured sidetone delay is less than T/2.
## 8.6 Stability loss
Where a user-controlled volume control is provided it is set to maximum.
**Handset UE:** The handset is placed on a hard plane surface with the
earpiece facing the surface.
**Headset UE:** The requirement applies for the closest possible position
between microphone and headset receiver within the intended wearing position.
NOTE: Depending on the type of headset it may be necessary to repeat the
measurement in different positions.
**Hands-free UE (all categories):** No requirement other than echo loss.
Before the actual test a training sequence consisting of the British-English
single talk sequence described in ITU-T Recommendation P.501 [22] is applied.
The training sequence level shall be ‑16 dBm0 in order to not overload the
codec.
The test signal is a PN-sequence complying with ITU-T Recommendation P.501
with a length of 4 096 points (for a 48 kHz sampling rate system) and a crest
factor of 6 dB instead of 11 dB. The PN-sequence is generated as described in
P.501 with W(k) constant within the frequency range 100-8000 Hz and zero
outside this range. The duration of the test signal is 250 ms. With an input
signal of ‑3 dBm0, the attenuation from input to output of the system
simulator shall be measured under the following conditions:
a) The handset or the headset, with the transmission circuit fully active,
shall be positioned on a hard plane surface with at least 400 mm free space in
all directions. The earpiece shall face towards the surface as shown in figure
17c;
b) The headset microphone is positioned as close as possible to the
receiver(s) within the intended wearing position;
c) For a binaural headset, the receivers are placed symmetrically around the
microphone.
{width="6.6930555555555555in" height="5.0152777777777775in"}
NOTE: All dimensions in mm.
Figure 17c. Test configuration for stability loss measurement on handset or
headset UE
The attenuation from input to output shall be measured in the frequency range
from 100 Hz to 8 kHz. The spectral distribution of the output signal is
analysed with a 4k FFT (for a 48 kHz sample rate test system), thus the
measured part of the output signal is 85,333 ms. To avoid leakage effects the
frequency resolution of the FFT must be the same as the frequency spacing of
the PN-sequence.
## 8.7 Acoustic echo control
### 8.7.1 General
The echo loss (EL) presented by the GSM, 3G or LTE networks at the POI should
be at least 46 dB during single talk. This value takes into account the fact
that UE is likely to be used in a wide range of noise environments.
### 8.7.2 Acoustic echo control in a hands-free UE
The hands-free UE is setup in a room with acoustic properties similar to a
typical "office-type" room; a vehicle-mounted hands-free UE should be tested
in a vehicle or vehicle simulator, as specified by the UE manufacturer (see
also 3GPP TS 03.58 [11]). The ambient noise level shall be ≤ -70 dBPa(A). The
attenuation from reference point input to reference point output shall be
measured using the compressed real speech signal described in clause 7.3.3 of
ITU-T P.501 Amendment 1 [33].
The TCLw is calculated according to ITU-T Recommendation G.122 [8], annex B,
clause B.4 (trapezoidal rule) but using the frequency range of 300 Hz to 6 700
Hz (instead of 300 Hz to 3 400 Hz). For the calculation, the averaged measured
echo level at each frequency band is referred to the averaged test signal
level measured in each frequency band. The first 17,0 s of the test signal (6
sentences) are discarded from the analysis to allow for convergence of the
acoustic echo canceller. The analysis is performed over the remaining length
of the test sequence (last 6 sentences).
The test signal level shall be -10 dBm0.
### 8.7.3 Acoustic echo control in a handset UE
The handset is set up according to clause 5. The ambient noise level shall be
≤ -64 dBPa(A). The attenuation from the reference point input to reference
point output shall be measured using the compressed real speech signal
described in clause 7.3.3 of ITU-T P.501 Amendment 1 [33].
The TCLw is calculated according to ITU-T Recommendation G.122 [8], annex B,
clause B.4 (trapezoidal rule) but using the frequency range of 300 Hz to 6 700
Hz (instead of 300 Hz to 3 400 Hz). For the calculation, the averaged measured
echo level at each frequency band is referred to the averaged test signal
level measured in each frequency band. The first 17,0 s of the test signal (6
sentences) are discarded from the analysis to allow for convergence of the
acoustic echo canceller. The analysis is performed over the remaining length
of the test sequence (last 6 sentences).
The test signal level shall be -10 dBm0.
### 8.7.4 Acoustic echo control in a headset UE
The headset is set up according to clause 5. The ambient noise level shall be
≤ -64 dBPa(A). The attenuation from the reference point input to reference
point output shall be measured using the compressed real speech signal
described in clause 7.3.3 of ITU-T P.501 Amendment 1 [33].
The TCLw is calculated according to ITU-T Recommendation G.122 [8], annex B,
clause B.4 (trapezoidal rule) but using the frequency range of 300 Hz to 6 700
Hz (instead of 300 Hz to 3 400 Hz). For the calculation, the averaged measured
echo level at each frequency band is referred to the averaged test signal
level measured in each frequency band. The first 17,0 s of the test signal (6
sentences) are discarded from the analysis to allow for convergence of the
acoustic echo canceller. The analysis is performed over the remaining length
of the test sequence (last 6 sentences).
The test signal level shall be -10 dBm0.
## 8.8 Distortion
### 8.8.1 Sending distortion
The handset, headset, or hands-free UE is setup as described in clause 5.
The signal used is a sine-wave signal with frequencies specified in clause 6.8
of 3GPP TS 26.131. The sine-wave signal level shall be calibrated to ‑4,7 dBPa
at the MRP for all frequencies, except for the sine-wave with a frequency 1020
Hz which shall be applied at the following levels at the MRP: 5, 0, ‑4,7, ‑10,
‑15, ‑20 dBPa. The test signals have to be applied in this sequence, i.e.,
from high levels down to low levels.
The duration of the sine-wave signal is recommended to be 360 ms. The
manufacturer shall be allowed to request tone lengths up to 1 s. The measured
part of the signal shall be 170,667 ms (which equals 2 * 4096 samples in a 48
kHz sample rate test system). The times are selected to be relatively short in
order to reduce the risk that the test tone is treated as a stationary signal.
It is recommended that an optional activation signal be presented immediately
preceding each test signal to ensure that the UE is in a typical state during
measurement (see Note 1.). An appropriate speech or speech-like activation
signal shall be chosen from ITU-T Recommendations P.501 or P.50 [10]. A
recommendation for the use of an activation signal as part of the measurement
is defined in figure 18. The RMS level of the active parts of this activation
signal is recommended to be equal to the subsequent test tone RMS level. In
practice, certain types of processing may be impacted due to the introduction
of the activation signal. The manufacturer shall be allowed to specify
disabling of the activation signal. It shall be reported whether an activation
signal was used or not, along with the characteristics of the activation
signal, as specified by the manufacturer.
The ratio of the signal to total distortion power of the signal output of the
SS shall be measured with the psophometric noise weighting (see ITU‑T
Recommendations G.712, O.41 and O.132). The psophometric filter shall be
normalized (0 dB gain) at 800 Hz as specified in ITU-T Recommendation O.41.
The weighting function shall be applied to the total distortion component only
(not to the signal component).
For measurement of the total distortion component an octave-wide band-stop
filter shall be applied to the signal to suppress the sine-wave signal and
associated coding artefacts. The filter shall have a lower passband ending at
0.7071 * f~S~, and an upper passband starting at 1.4142 * f~S~, where f~S~ is
the frequency of the sine-wave signal. The passband ripple of the filter shall
be ≤ 0,2 dB. The attenuation of the band-stop filter at the sine-wave
frequency shall be ≥ 60 dB. Alternatively, the described characteristics can
be implemented by an appropriate weighting on the spectrum obtained from an
FFT. The total distortion component is defined as the measured signal within
the frequency range 100 Hz to 6 kHz, after applying psophometric and stop
filters (hence no correction for the lost power due to the stop filter, known
as "bandwidth correction", shall be applied).
To improve repeatability, considering the variability introduced by speech
coding and voice processing, the test sequence (activation signal followed by
the test signal) may be contiguously repeated one or more times. The single
signal-to-total-distortion power ratios obtained from such repeats shall be
averaged. The total result shall be 10 * log~10~ of this average in dB.
{width="3.738888888888889in" height="1.9743055555555555in"}
Figure 18: Recommended activation sequence and test signal.
The activation signal consists of a "Bandlimited composite source signal with
speech-like power density spectrum" signal according to ITU-T Recommendation
P.501 with 48,62 ms voiced part (1), 200 ms unvoiced part (2) and 101,38 ms
pause (3), followed by the same signal but polarity inverted (4, 5, 6),
followed by the voiced part only (7). The pure test tone is applied and after
50 ms settling time (8), the analysis is made over the following 170,667 ms
(9).
NOTE 1: Depending on the type of codec the test signal used may need to be
adapted. If a sine-wave is not usable, an alternative test signal could be a
band-limited noise signal centered on the above frequencies.
NOTE 2: Void.
NOTE 3: Void.
NOTE 4: In order to ensure that the correct part of the signal is analyzed,
the total delay of the terminal and SS may have to be determined prior to the
measurement.
NOTE 5: For hands-free terminals tested in environments defined in subclause
6.1.2, care should be taken that the reverberation in the test room, caused by
the activation signal, does not affect the test results to an unacceptable
degree, referring to subclause 5.3.
### 8.8.2 Receiving
The handset, headset, or hands-free UE is setup as described in clause 5.
The signal used is a sine‑wave signal with frequencies specified in clause 6.8
of 3GPP TS 26.131. The signal level shall be ‑16 dBm0, except for the
sine‑wave signal with a frequency 1020 Hz that shall be applied at the signal
input of the SS at the following levels: 0, ‑3, ‑10, ‑16, ‑20, ‑30, ‑40, ‑45
dBm0. The test signals have to be applied in this sequence, i.e., from high
levels down to low levels.
The duration of the sine-wave signal is recommended to be 360 ms. The
manufacturer shall be allowed to request tone lengths up to 1 s. The measured
part of the signal shall be 170,667 ms (which equals 2 * 4096 samples in a 48
kHz sample rate test system). The times are selected to be relatively short in
order to reduce the risk that the test tone is treated as a stationary signal.
It is recommended that an optional activation signal be presented immediately
preceding each test signal to ensure that the UE is in a typical state during
measurement (see Note 1.). An appropriate speech or speech-like activation
signal shall be chosen from ITU-T Recommendations P.501 or P.50 [10]. A
recommendation for the use of an activation signal as part of the measurement
is defined in figure 19. The RMS level of the active parts of this activation
signal is recommended to be equal to the subsequent test tone RMS level for
low and medium test levels. To avoid saturation of the SS speech encoder, it
is recommended for high test levels that the activation signal level is
adjusted so that its peak level equals the peak level of the test tone. In
practice, certain types of processing may be impacted due to the introduction
of the activation signal. The manufacturer shall be allowed to specify
disabling of the activation signal. It shall be reported whether an activation
signal was used or not, along with the characteristics of the activation
signal, as specified by the manufacturer.
The ratio of the signal to total distortion power shall be measured at the
applicable acoustic measurement point (DRP with diffuse-field correction for
handset and headset modes; free field for hands-free modes) with the
psophometric noise weighting (see ITU‑T Recommendations G.712, O.41 and
O.132). The psophometric filter shall be normalized to have 0 dB gain at 800
Hz as specified in ITU-T Recommendation O.41. The weighting function shall be
applied to the total distortion component only (not to the signal component).
For measurement of the total distortion component an octave-wide band-stop
filter shall be applied to the signal to suppress the sine-wave signal and
associated coding artefacts. The filter shall have a lower passband ending at
0,7071 * f~S~, and an upper passband starting at 1,4142 * f~S~, where f~S~ is
the frequency of the sine-wave signal. The passband ripple of the filter shall
be ≤ 0,2 dB. The attenuation of the band stop filter at the sine-wave
frequency shall be ≥ 60 dB. Alternatively the described characteristics can be
implemented by an appropriate weighting on the spectrum obtained from an FFT.
The total distortion component is defined as the measured signal within the
frequency range 100 Hz to 6 kHz, after applying psophometric and stop filters
(hence no correction for the lost power due to the stop filter, known as
"bandwidth correction", shall be applied).
To improve repeatability, considering the variability introduced by speech
coding and voice processing, the test sequence (activation signal followed by
the test signal) may be contiguously repeated one or more times. The single
signal-to-total-distortion power ratios obtained from such repeats shall be
averaged. The total result shall be 10 * log~10~ of this average in dB.
{width="3.738888888888889in" height="1.9743055555555555in"}
Figure 19: Recommended activation sequence and test signal.
The activation signal consists of a "Bandlimited composite source signal with
speech-like power density spectrum" signal according to ITU-T Recommendation
P.501 with 48,62 ms voiced part (1), 200 ms unvoiced part (2) and 101,38 ms
pause (3), followed by the same signal but polarity inverted (4, 5, 6),
followed by the voiced part only (7). The pure test tone is applied and after
50 ms settling time (8), the analysis is made over the following 170,667 ms
(9).
NOTE 1: Void.
NOTE 2: Void.
NOTE 3: In order to ensure that the correct part of the signal is analyzed,
the total delay of the terminal and SS may have to be determined prior to the
measurement.
NOTE 4: For hands-free terminals tested in environments defined in subclause
6.1.2, care should be taken that the reverberation in the test room, caused by
the activation signal, does not affect the test results to an unacceptable
degree, referring to subclause 5.3.
## 8.9 Void
## 8.10 Delay
### 8.10.0 UE Delay Measurement Methodologies
For UMTS circuit-switched operation and MTSI-based speech with LTE access in
error and jitter free conditions, the sum of the UE delays in the sending and
receiving directions (TS+TR) shall be measured according to the methods
described in clauses 8.10.1 and 8.10.2. In the event that the delays of the
test equipment in send and/or receive directions are not stable between calls
or cannot be accurately determined, the alternative method described in clause
8.10.3 may be used to obtain (TS+TR) and the measured instability or
inaccuracy observed when the methods described in 8.10.1 and 8.10.2 were
performed shall be recorded in the test report. The test method(s) used and
all results obtained shall also be recorded in the test report.
For MTSI-based speech with LTE access in conditions with simulated packet
arrival time variations, the sum of the UE delays in the sending and receiving
directions (T~S~+T~R-jitter~) and the objective speech quality in the receive
direction shall be measured according to the method described in clause
8.10.4.
For MTSI-based speech with LTE access, prior to the actual measurements, the
clock drift between UE and reference client shall be compensated by adjusting
the clock of the reference client to match the clock of the UE (as stated in
clause 5). The inaccuracy of the clock drift adjustment shall be less than
1ppm measured according to the procedure in Annex D.
It shall be ensured that the packet generation by the reference client and the
packet treatment of the test equipment are free of jitter.
### 8.10.1 Delay in sending direction (handset UE)
The handset terminal is setup as described in clause 5.1.1.
The UE delay in the sending direction is obtained by measuring the delay
between MRP and the electrical access point of the test equipment and
subtracting the delays introduced by the test equipment from the measured
value.
Figure 19b1: Different entities when measuring the delay in sending direction
The delay measured from MRP to the electrical access point of **the test
equipment** is T~S~ + T~TES~.
T~TES~: The delay between the last bit of a speech frame at the system
simulator antenna and the first electrical event at the electrical access
point of the test equipment.
1\. For the measurements, a Composite Source Signal (CSS) according to ITU-T
Recommendation P.501 [22] is used. The pseudo random noise (pn)-part of the
CSS has to be longer than the maximum expected delay. It is recommended to use
a pn sequence of 32 k samples (with 48 kHz sampling rate). The test signal
level is -4,7 dBPa at the MRP.
2 The reference signal is the original signal (test signal). The setup of the
handset/headset terminal is made corresponding to clause 5.1.
3\. The delay is determined by cross-correlation analysis between the measured
signal at the electrical access point and the original signal. The measurement
is corrected by subtracting the test equipment delay T~TES~.
4\. The delay is measured in ms and the maximum of the cross-correlation
function is used for the determination.
For MTSI-based speech with LTE access, a variability of up to 20ms may be
expected between different calls due to the synchronization between the speech
frame processing in the sending UE and the bits of the speech frames at the UE
antenna. This synchronization is attributed to the UE sending delay according
to the definition of the UE delay reference points. Hence, the maximum value
of the UE sending delay obtained from at least 5 individual calls shall be
reported as the UE delay in the sending direction. All values shall be
reported in the test report.
A further variability of up to 20ms may be expected between different calls
due to the synchronization between the speech frames at the UE antenna and the
speech frame processing in the receiving reference client of the test system.
In an end-to-end call this synchronization of the frames will only take place
at the receiver, and this variability of the measurement shall be deduced from
the UE sending delay. Hence, if the reference client of the test equipment
does not adjust for the effect of the speech frame synchronization (as
specified by the manufacturer of the reference client), this maximum
uncertainty shall be subtracted from measured maximum value reported as the UE
sending delay in order to compensate for the uncertainty of the test
equipment. This correction value (i.e. maximum uncertainty) shall be reported
in the test report.
### 8.10.1a Delay in sending direction (headset UE)
The UE delay in the sending direction is obtained by measuring the delay
between MRP and the electrical access point of the test equipment and
subtracting the delays introduced by the test equipment from the measured
value.
Figure 19b2: Different entities when measuring the delay in sending direction
with a headset connected via cable
NOTE: The test setup only applies to headsets connected by wire. Wireless
headsets (e.g. connected by Bluetooth) are currently out of scope.
The test method is the same as for handset UE (clause 8.10.1).
### 8.10.2 Delay in receiving direction (handset UE)
The handset terminal is setup as described in clause 5.
The UE delay in the receiving direction is obtained by measuring the delay
between the electrical access point of the test equipment and the DRP and
subtracting the delays introduced by the test equipment from the measured
value.
Figure 19b3: Different entities when measuring the delay in receiving
direction
The delay measured from the electrical access point of the test equipment to
DRP is T~R~ + T~TER~.
T~TER~: The delay between the first electrical event at the electrical access
point of the test equipment and the first bit of the corresponding speech
frame at the system simulator antenna.
Before the actual test for MTSI-based speech with LTE access a conditioning
sequence consisting of the British-English single talk sequence described in
ITU-T Recommendation P.501 [22] is applied for convergence of the jitter
buffer management of the UE. The conditioning sequence level shall be -16 dBm0
in order to not overload the codec.
1\. For the measurements, a Composite Source Signal (CSS) according to ITU-T
Recommendation P.501 [22] is used. The pseudo random noise (pn)-part of the
CSS has to be longer than the maximum expected delay. It is recommended to use
a pn sequence of 32 k samples (with 48 kHz sampling rate).The test signal
level is -16 dBm0 measured at the digital reference point or the equivalent
analogue point.
2 The reference signal is the original signal (test signal). The setup of the
handset/headset terminal is in correspondence to clause 5.1.
3\. The delay is determined by cross-correlation analysis between the measured
signal at the electrical access point and the original signal. The measurement
is corrected by subtracting the test equipment delay T~TER~.
4\. The delay is measured in ms and the maximum of the cross-correlation
function is used for the determination.
For MTSI-based speech with LTE access, a variability of up to 20ms may be
expected between different calls due to the synchronization between the bits
of the speech frames at the UE antenna and the speech frame processing in the
receiving UE. This synchronization is attributed to the UE receiving delay
according to the definition of the UE delay reference points. Hence, the
maximum value of the UE receiving delay obtained from at least 5 individual
calls shall be reported as the UE delay in the receiving direction. All values
shall be reported in the test report.
### 8.10.2a Delay in receiving direction (headset UE)
The UE delay in the receiving direction is obtained by measuring the delay
between the electrical access point of the test equipment and the DRP and
subtracting the delays introduced by the test equipment from the measured
value.
Figure 19b4: Different entities when measuring the delay in receiving
direction with a headset connected via cable
NOTE: The test setup only applies to headsets connected by wire. Wireless
headsets (e.g. connected by Bluetooth) are currently out of scope.
The test method is the same as for handset UE (subclause 8.10.2).
### 8.10.3 Delay in sending + receiving direction using "echo" method (handset
UE)
The UE delay is obtained by measuring the delay between the MRP and the DRP
and subtracting the delays introduced by the test equipment from the measured
value.
Figure 19b4bis: Different entities when measuring the delay in sending +
receiving direction
The delay measured from MRP to DRP is (T~S~ + T~R~+ T~SS~).
T~SS~: The delay between the last bit of a speech frame at the system
simulator antenna and the first bit of the looped back speech frame at the
system simulator antenna.
Before the actual test for MTSI-based speech with LTE access a conditioning
sequence consisting of the British-English single talk sequence described in
ITU-T Recommendation P.501 [22] is applied for convergence of the jitter
buffer management of the UE. The conditioning sequence level shall be -16 dBm0
in order to not overload the codec.
1\. For the measurements a Composite Source Signal (CSS) according to ITU-T
Recommendation P.501 [22] is used. It is recommended to use a pn sequence of
32 k samples (with 48 kHz sampling rate). The test signal level is -4.7 dBPa
at the MRP.
2\. The system simulator is configured for "loopback" or "echo" operation with
the additional loopback delay as specified below when applicable. In
"loopback" or "echo" operation, the packets in the sending direction are
routed to the receiving direction by the system simulator.
3\. The reference signal is the original signal (test signal). The setup of
the mobile station is in correspondence to clause 5.1.
4\. The mouth-to-ear delay is determined by cross-correlation analysis between
the measured signal at DRP and the original signal. The analysis window for
the cross-correlation shall start at an instant T > 50ms in order to discard
the cross-correlation peaks corresponding to the direct acoustic path from
mouth to ear and possible delayed sidetone signal. The measurement is
corrected by subtracting the system simulator delay T~SS~ to obtain the T~S~ +
T~R~ delay.
5\. The delay is measured in ms and the maximum of the cross-correlation
envelope is used for the determination.
For MTSI-based speech with LTE access, a variability of the UE delay with up
to 20ms in the respective sending and receiving direction may be expected due
to the synchronization of the speech frame processing in the UE to the bits of
the speech frame on the UE antenna. This synchronization is attributed to the
UE delay according to the definition of the UE delay reference points. Hence,
the UE delay shall be reported as the maximum value from at least 5 separate
calls each with a different loopback delay TSS in at least 5 steps of 4ms in
the full range from 0 to 16ms. All values shall be reported in the test
report.
### 8.10.3a Delay in sending + receiving direction using "echo" method
(headset UE)
The UE delay is obtained by measuring the delay between the MRP and the DRP
and subtracting the delays introduced by the test equipment, T~SS~, from the
measured value.
The test method is the same as for handset UE (clause 8.10.3).
### 8.10.4 Delay and speech quality in conditions with packet arrival time
variations and packet loss
#### 8.10.4.1 Delay in sending direction
The UE delay in the sending direction, T~S~, shall be measured in jitter and
error free conditions according to clause 8.10.0.
#### 8.10.4.2 Delay in receiving direction
For this test it shall be ensured that the call is originated from the mobile
terminal (MO).
In receiving direction, the delay between the electrical access point of the
test equipment and the DRP, T~TEAP-DRP~(t) = T~R-jitter~(t) + T~TER,~ is
measured continuously for a speech signal during the inclusion of packet delay
and loss profiles in the receiving direction RTP voice stream.
Packet impairments shall be applied between the reference client and system
simulator eNodeB. The start of the delay profiles must be synchronized with
the start of the downlink speech material reproduction (compensated by the
delay between reproduction and the point of impairment insertion, i.e. the
delay of the reference client) in order to ensure a repeatable application of
impairments to the test speech signal. Tests shall be performed with DTX
disabled in the reference client. The use of DTX enabled for this test is for
further study.
NOTE 1: RTP packet impairments representing packet delay variations and loss
in LTE transmission scenarios are specified in Annex E. Care must be taken
that the system simulator uses a dedicated bearer with no buffering/scheduling
of packets for transmission.
For the speech signal, 8 English test sentences according to ITU-T P.501 Annex
B.3.3, normalized to an active speech level of -16dBm0, are used (2 male, 2
female speakers). The sequences are concatenated in such a way that all
sentences are centered within a 4.0s time window, which results in an overall
duration of 32.0s. The sequences are repeated 5 times, resulting in a test
file 160.0s long. The first 2 sentences are used for convergence of the UE
jitter buffer manager and are discarded from the analysis. Equivalent
implementations of the concatenation by repeating the test sentences in
sequence may be used.
NOTE 2: Two out of the four sentence pairs are not compliant with ITU-T
Recommendation P.863.1
For the delay calculation, a cross-correlation with a rectangular window
length of 4s, centered at each sentence of the stimulus file, is used. The
process is repeated for each sample. For each cross correlation, the maximum
of the envelope is obtained producing one delay value per sentence.
The UE delay in the receive direction, T~R-jitter~(t), is obtained by
subtracting the delay introduced by the test equipment and the simulated
transport network packet delay introduced by the delay and loss profile (as
specified for the respective profile in Annex E) from the first electrical
event at the electrical access point of the test equipment to the first bit of
the corresponding speech frame at the system simulator antenna, T~TER~, from
the measured T~TEAP-DRP~(t).
For stationary packet delay variation test conditions (test condition 1 and
2), the first 2 sentences are used for convergence of the jitter buffer
management and are discarded from the analysis. The UE delay in the receiving
direction shall be reported as the maximum value excluding the two largest
values of the remaing sequence of the 38 sentence delay values, i.e. the
95-percentile value of T~R-jitter~(t)). The values for all 40 sentences shall
be reported in the test report.
NOTE 3: The synchronization of the speech frame processing in the UE to the
bits of the speech frames at the UE antenna may lead to a variability of up to
20 ms of the measured UE receive delay between different calls. This
synchronization is attributed to the UE receiving delay according to the
definition of the UE delay reference points. The effect of this possible call-
to-call variation is not taken into account in the UE receive delay
measurement in conditions with simulated packet arrival time variations and
packet loss.
#### 8.10.4.3 Speech quality loss in conditions with packet arrival time
variations and packet loss
For the evaluation of speech quality loss in conditions with packet arrival
time variations and packet loss, the test signal described in clause 8.10.4.2
shall be used. The first 2 sentences are used for convergence of the UE jitter
buffer manager and are discarded from the analysis. Two recordings are used to
produce the speech quality loss metric:
  * A recording obtained in jitter and error free conditions with the test signal described in clause 8.10.4.2 (reference condition)
  * A recording obtained during the application of packet arrival time variations and packet loss as described in clause 8.10.4.2 (test condition)
The speech quality of the signal at the DRP with diffuse-field equalization is
estimated using the measurement algorithm described in ITU-T Recommendation
P.863.
A score shall be computed for each 8s speech sentence pair and averaged to
produce a mean MOS-LQO value for the reference and test conditions.
MOS-LQO~REF~$= (\sum_{i = 1}^{\text{19}}{\text{MOS} -
\text{LQO}_{\text{reference}}}(i)\frac{)}{\text{19}}$
MOS-LQO~TEST~ $= (\sum_{i = 1}^{\text{19}}{\text{MOS} -
\text{LQO}_{\text{testcondition}}}(i)\frac{)}{\text{19}}$
NOTE: This evaluation of the speech quality requirement is only applicable to
test conditions with a stationary statistic of the packet delay variation.
Evaluation of the speech quality for a test condition with non-stationary
packet delay variations is for further study.
The synchronization between stimuli and degraded condition shall be done by
the test system before applying the P.863 algorithm on each sentence pair.
### 8.10.5 UE send clock accuracy
For further study.
### 8.10.6 UE receiving with clock drift
For further study.
## 8.11 Echo control characteristics
### 8.11.1 Test set-up and test signals
The device is set up according to clause 5. The ambient noise level shall be ≤
‑64 dBPa(A).
The test shall be performed with the British-English "long" double-talk and
conditioning speech sequences from ITU-T Recommendation P.501 [22], with the
signals in the receiving direction band limited according to clause 5.4.
A description of the test stimuli is presented in Table 2e and Table 2f. The
test sequence is composed of an initial conditioning sequence of 23,5 s and a
double talk sequence of 35 s. For the analysis, the double talk sequence is
divided into two segments, a first double-talk sequence with single short
near-end words (0 -- 20 s), and a second double-talk sequence with continuous
double talk (20-35 s).
The sending speech during double-talk and the "near-end speech only" are
recorded individually, with the "near-end speech only" sequence recorded with
silence in the receiving direction. The time-alignment of the two recorded
sequences is performed off-line during the analysis.
Table 2e: Test stimuli for recording of Echo Canceller operation
* * *
                                **Conditioning**                              **Single words (segment 1) and full sentence (segment 2) double talk**
**Far-end signal** **FB_female_conditioning_seq_long.wav**
**FB_male_female_single-talk_seq.wav** **Artificial mouth signal**
**FB_male_conditioning_seq_long.wav** **FB_male_female_double-talk_seq.wav**
* * *
Table 2f: Test stimuli for reference \"near-end speech only\" recording.
* * *
                                **Conditioning**                              **Single words (segment 1) and full sentence (segment 2) double talk**
**Far-end signal** **FB_female_conditioning_seq_long.wav** **silence**
**Artificial mouth signal** **FB_male_conditioning_seq_long.wav**
**FB_male_female_double-talk_seq.wav**
* * *
The level of the signal of the artificial mouth shall be - 4.7 dBPa measured
at the MRP. In order to obtain a reproducible time alignment as seen by the
UE, the artificial mouth signal shall be delayed by the amount of the
receiving direction delay. For the purpose of this alignment, the receiving
direction delay for handset and headset modes is defined from the system
simulator input to the artificial ear. For handsfree modes, the downlink delay
is defined from the system simulator input to the acoustic output from the UE
loudspeaker.
The level of the downlink signal shall be -16 dBm0 measured at the digital
reference point or the equivalent analogue point.
### 8.11.2 Test method
The test method measures the duration of any level difference between the
sending signal of a double-talk sequence (where the echo canceller has been
exposed to simultaneous echo and near-end speech) and the sending signal of
the same near-end speech only. The level difference is classified into eight
categories according to Figure 19b5 and Table 2g, representing various degrees
of "Full duplex operation", "Near-end clipping", and "Residual echo".
NOTE: The limits for specifying the categories in Figure 19b5 and Table 2g are
provisional pending further analysis and validation.
NOTE: The categories in Figure 19b5 and Table 2g are labelled in a functional
order and the subjective impression of the respective categories is for
further study.
NOTE: To reduce potential issues associated with low-frequency test room
noise, a [4^th^]-order high-pass filter with a cut-off frequency of [100] Hz
can be applied before the level computation.
Figure 19b5: Classification of echo canceller performance
Table 2g: Categories for echo canceller performance classification
* * *
Category Level difference (ΔL) Duration (D) Description **A1** -4 dB ≤ ΔL \ The spectrum at the MRP and the actual level at the MRP (measured in
> 1/3-octaves) are used as references to determine the sending sensitivity
> SmJ.
b) The hands-free terminal is setup as described in clause 5. Measurements
shall be made at 1/3-octave intervals as given by the R.10 series of preferred
numbers in ISO 3 for frequencies from 100 Hz to 16 kHz inclusive. For the
calculation the averaged measured level at each frequency band is referred to
the averaged test signal level measured in each frequency band.
c) The sensitivity is expressed in terms of dBV/Pa.
### 9.4.4 Desktop and vehicle-mounted hands-free UE receiving
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
test signal level shall be ‑16 dBm0 measured at the digital reference point or
the equivalent analogue point. The test signal level is calculated over the
complete test signal sequence.
b) The hands-free terminal is setup as described in clause 5. If a HATS is
used, then it is free-field equalized as described in ITU-T Recommendation
P.581. The equalized output signal of each artificial ear is power-averaged
over the total duration of the analysis; the right and left artificial ear
signals are voltage-summed for each 1/3-octave frequency band; these
1/3-octave band data are considered as the input signal to be used for
calculations or measurements. Measurements shall be made at 1/3-octave
intervals as given by the R.10 series of preferred numbers in ISO 3 for
frequencies from 100 Hz to 16 kHz inclusive. For the calculation, the averaged
measured level at each frequency band is referred to the averaged test signal
level measured in each frequency band.
c) The sensitivity is expressed in terms of dBPa/V.
### 9.4.5 Hand-held hands-free UE sending
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
spectrum of the acoustic signal produced by the artificial mouth is calibrated
under free-field conditions at the MRP. The test signal level shall be --4,7
dBPa measured at the MRP. The test signal level is calculated over the
complete test signal sequence. The broadband signal level is then adjusted to
--28,3 dBPa at the HFRP or the HATS HFRP (as defined in subclause 9.2.3.1) and
the spectrum is not altered.
> The spectrum at the MRP and the actual level at the MRP (measured in
> 1/3-octaves) are used as reference to determine the sending sensitivity SmJ.
b) The hands-free terminal is setup as described in clause 5.1.3.3.
Measurements shall be made at 1/3-octave intervals as given by the R.10 series
of preferred numbers in ISO 3 for frequencies from 100 Hz to 16 kHz inclusive.
For the calculation, the averaged measured level at each frequency band is
referred to the averaged test signal level measured in each frequency band.
c) The sensitivity is expressed in terms of dBV/Pa.
### 9.4.6 Hand-held hands-free UE receiving
a) The test signal to be used for the measurements shall be the British-
English single talk sequence described in ITU-T Recommendation P.501 [22]. The
test signal level shall be ‑16 dBm0 measured at the digital reference point or
the equivalent analogue point. The test signal level is calculated over the
complete test signal sequence.
b) The hands-free terminal is setup as described in clause 5. If a HATS is
used, then it is free-field equalized as described in ITU-T Recommendation
P.581. The equalized output signal of each artificial ear is power-averaged
over the total duration of the analysis; the right and left artificial ear
signals are voltage-summed for each 1/3-octave band frequency band; these
1/3-octave band data are considered as the input signal to be used for
calculations or measurements. Measurements shall be made at 1/3-octave
intervals as given by the R.10 series of preferred numbers in ISO 3 for
frequencies from 100 Hz to 16 kHz inclusive. For the calculation, the averaged
measured level at each frequency band is referred to the averaged test signal
level measured in each frequency band.
c) The sensitivity is expressed in terms of dBPa/V.
## 9.5 Sidetone characteristics
### 9.5.1 Connections with handset UE
The test method is the same as for wideband (see sub-clause 8.5.1).
### 9.5.2 Headset UE
The test method is the same as for wideband (see sub-clause 8.5.2).
### 9.5.3 Hands-free UE (all categories)
No requirement other than echo control.
### 9.5.4 Sidetone delay for handset or headset
The test method is the same as for wideband (see sub-clause 8.5.4).
## 9.6 Stability loss
Where a user-controlled volume control is provided it is set to maximum.
**Handset UE:** The handset is placed on a hard plane surface with the
earpiece facing the surface.
**Headset UE:** The requirement applies for the closest possible position
between microphone and headset receiver within the intended wearing position.
NOTE: Depending on the type of headset it may be necessary to repeat the
measurement in different positions.
**Hands-free UE (all categories):** No requirement other than echo loss.
Before the actual test a training sequence consisting of the British-English
single talk sequence described in ITU-T Recommendation P.501 [22] is applied.
The training sequence level shall be ‑16 dBm0 in order to not overload the
codec.
The test signal is a PN-sequence complying with ITU-T Recommendation P.501
with a length of 4 096 points (for a 48 kHz sampling rate system) and a crest
factor of 6 dB instead of 11 dB. The PN-sequence is generated as described in
P.501 with W(k) constant within the frequency range 100-16000 Hz and zero
outside this range. The duration of the test signal is 250 ms. With an input
signal of ‑3 dBm0, the attenuation from input to output of the system
simulator shall be measured under the following conditions:
a) The handset or the headset, with the transmission circuit fully active,
shall be positioned on a hard plane surface with at least 400 mm free space in
all directions. The earpiece shall face towards the surface as shown in figure
20;
b) The headset microphone is positioned as close as possible to the
receiver(s) within the intended wearing position;
c) For a binaural headset, the receivers are placed symmetrically around the
microphone.
{width="6.6930555555555555in" height="5.0152777777777775in"}
NOTE: All dimensions in mm.
Figure 20. Test configuration for stability loss measurement on handset or
headset UE
The attenuation from input to output shall be measured in the frequency range
from 100 Hz to 16 kHz. The spectral distribution of the output signal is
analysed with a 4k FFT (for a 48 kHz sample rate test system), thus the
measured part of the output signal is 85,333 ms. To avoid leakage effects the
frequency resolution of the FFT must be the same as the frequency spacing of
the PN-sequence.
## 9.7 Acoustic echo control
### 9.7.1 General
The echo loss (EL) presented by the GSM, 3G or LTE networks at the POI should
be at least 46 dB during single talk. This value takes into account the fact
that UE is likely to be used in a wide range of noise environments.
NOTE: A test method fully adapted to super-wideband acoustic echo control is
for further study
### 9.7.2 Acoustic echo control in a hands-free UE
The hands-free UE is setup in a room with acoustic properties similar to a
typical "office-type" room; a vehicle-mounted hands-free UE should be tested
in a vehicle or vehicle simulator, as specified by the UE manufacturer (see
also 3GPP TS 03.58 [11]). The ambient noise level shall be ≤ -70 dBPa(A). The
attenuation from reference point input to reference point output shall be
measured using the compressed real speech signal described in clause 7.3.3 of
ITU-T P.501 Amendment 1 [33].
The TCLw is calculated according to ITU-T Recommendation G.122 [8], annex B,
clause B.4 (trapezoidal rule) but using the frequency range of 300 Hz to 6 700
Hz (instead of 300 Hz to 3 400 Hz). For the calculation, the averaged measured
echo level at each frequency band is referred to the averaged test signal
level measured in each frequency band. The first 17,0 s of the test signal (6
sentences) are discarded from the analysis to allow for convergence of the
acoustic echo canceller. The analysis is performed over the remaining length
of the test sequence (last 6 sentences).
The test signal level shall be -10 dBm0.
### 9.7.3 Acoustic echo control in a handset UE
The handset is set up according to clause 5. The ambient noise level shall be
≤ -64 dBPa(A). The attenuation from the reference point input to reference
point output shall be measured using the compressed real speech signal
described in clause 7.3.3 of ITU-T P.501 Amendment 1 [33].
The TCLw is calculated according to ITU-T Recommendation G.122 [8], annex B,
clause B.4 (trapezoidal rule) but using the frequency range of 300 Hz to 6 700
Hz (instead of 300 Hz to 3 400 Hz). For the calculation, the averaged measured
echo level at each frequency band is referred to the averaged test signal
level measured in each frequency band. The first 17,0 s of the test signal (6
sentences) are discarded from the analysis to allow for convergence of the
acoustic echo canceller. The analysis is performed over the remaining length
of the test sequence (last 6 sentences).
The test signal level shall be -10 dBm0.
### 9.7.4 Acoustic echo control in a headset UE
The headset is set up according to clause 5. The ambient noise level shall be
≤ -64 dBPa(A). The attenuation from the reference point input to reference
point output shall be measured using the compressed real speech signal
described in clause 7.3.3 of ITU-T P.501 Amendment 1 [33].
The TCLw is calculated according to ITU-T Recommendation G.122 [8], annex B,
clause B.4 (trapezoidal rule) but using the frequency range of 300 Hz to 6 700
Hz (instead of 300 Hz to 3 400 Hz). For the calculation, the averaged measured
echo level at each frequency band is referred to the averaged test signal
level measured in each frequency band. The first 17,0 s of the test signal (6
sentences) are discarded from the analysis to allow for convergence of the
acoustic echo canceller. The analysis is performed over the remaining length
of the test sequence (last 6 sentences).
The test signal level shall be -10 dBm0.
## 9.8 Distortion
### 9.8.1 Sending distortion
The test method is the same as for wideband (see sub-clause 8.8.1).
### 9.8.2 Receiving
The test method is the same as for wideband (see sub-clause 8.8.2, observing
the signal properties for super-wideband described in sub-clause 5.4).
## 9.9 Void
## 9.10 Delay
### 9.10.0 UE Delay Measurement Methodologies
The methodologies are the same as for wideband (see sub-clause 8.10.0).
### 9.10.1 Delay in sending direction (handset UE)
For further study.
### 9.10.1a Delay in sending direction (headset UE)
For further study.
### 9.10.2 Delay in receiving direction (handset UE)
For further study.
### 9.10.2a Delay in receiving direction (headset UE)
For further study.
### 9.10.3 Delay in sending + receiving direction using "echo" method (handset
UE)
For further study.
### 9.10.3a Delay in sending + receiving direction using "echo" method
(headset UE)
For further study.
### 9.10.4 Delay and speech quality in conditions with packet arrival time
variations and packet loss
#### 9.10.4.1 Delay in sending direction
For further study.
#### 9.10.4.2 Delay in receiving direction
For further study.
#### 9.10.4.3 Speech quality loss in conditions with packet arrival time
variations and packet loss
For further study.
### 9.10.5 UE send clock accuracy
For further study.
### 9.10.6 UE receiving with clock drift
For further study.
## 9.11 Echo control characteristics
### 9.11.1 Test set-up and test signals
The test method is the same as for wideband (see sub-clause 8.11.1, observing
the signal properties for super-wideband described in sub-clause 5.4).
### 9.11.2 Test method
The test method is the same as for wideband (see sub-clause 8.11.2, observing
the signal properties for super-wideband described in sub-clause 5.4).
#### 9.11.2.1 Signal alignment
The test method is the same as for wideband (see sub-clause 8.11.2.1).
#### 9.11.2.2 Signal level computation and frame classification
The test method is the same as for wideband (see sub-clause 8.11.2.2).
#### 9.11.2.3 Classification into categories
The test method is the same as for wideband (see sub-clause 8.11.2.3).
## 9.12 Quality (speech quality, noise intrusiveness) in the presence of
ambient noise
For further study.
# 10 Fullband telephony transmission performance test methods
## 10.1 Applicability
The test methods in this clause shall apply when testing a UE that is used to
provide fullband telephony, either as a stand-alone service, or as part of a
multimedia service.
The application force used to apply the handset against the artificial ear
shall be 8 ± 2 N. For the headset case, the application of the headset shall
comply with ITU-T Recommendation P.57 [14].
## 10.2 Overall loss/loudness ratings
### 10.2.1 General
The test method is the same as for super-wideband (see sub-clause 9.2.1).
### 10.2.2 Connections with handset UE
The description is the same as for super-wideband (see sub-clause 9.2.2).
#### 10.2.2.1 Sending loudness rating (SLR)
The test method is the same as for super-wideband (see sub-clause 9.2.2.1).
#### 10.2.2.2 Receiving loudness rating (RLR)
The test method is the same as for super-wideband (see sub-clause 9.2.2.2,
observing the signal properties for fullband described in sub-clause 5.4).
### 10.2.3 Connections with desktop and vehicle-mounted hands-free UE
The description is the same as for super-wideband (see sub-clause 9.2.3).
#### 10.2.3.1 Sending loudness rating (SLR)
The test method is the same as for super-wideband (see sub-clause 9.2.3.1).
#### 10.2.3.2 Receiving loudness rating (RLR)
The test method is the same as for super-wideband (see sub-clause 9.2.3.2,
observing the signal properties for fullband described in sub-clause 5.4).
### 10.2.4 Connections with hand-held hands-free UE
#### 10.2.4.1 Sending loudness rating (SLR)
The test method is the same as for super-wideband (see sub-clause 9.2.4.1).
#### 10.2.4.2 Receiving loudness rating (RLR)
The test method is the same as for super-wideband (see sub-clause 9.2.4.2,
observing the signal properties for fullband described in sub-clause 5.4).
### 10.2.5 Connections with headset UE
The description is the same as for super-wideband (see sub-clause 9.2.5).
## 10.3 Idle channel noise (handset and headset UE)
The test method is the same as for super-wideband (see sub-clause 9.3).
### 10.3.1 Sending
The terminal should be configured to the test equipment as described in
subclause 5.1.
The environment shall comply with the conditions described in subclause 6.1.
The noise level at the output of the SS is measured from 100 Hz to 20 kHz with
A‑weighting. The A-weighting filter is described in IEC 60651.
A test signal may have to be intermittently applied to prevent 'silent mode'
operation of the MS. This is for further study.
The measured part of the noise shall be 170,667 ms (which equals 8192 samples
in a 48 kHz sample rate test system). The spectral distribution of the noise
is analyzed with an 8k FFT using windowing with ≤ 0,1 dB leakage for non bin-
centered signals. This can be achieved with a window function commonly known
as a "flat top window". Within the specified frequency range, the FFT bin that
has the highest level is searched for; the level of this bin is the maximum
level of a single frequency disturbance.
To improve repeatability, the test sequence (optional activation followed by
the noise level measurement) may be contiguously repeated one or more times.
The total noise powers obtained from such repeats shall be averaged. The total
result shall be 10 * log~10~ of this average in dB.
The single frequency maximum powers obtained from such repeats shall be
averaged. The total result shall be 10 * log~10~ of this average in dB.
### 10.3.2 Receiving
The test method is the same as for super-wideband (see sub-clause 9.3.2,
observing the signal properties for fullband described in sub-clause 5.4).
## 10.4 Sensitivity/frequency characteristics
### 10.4.0 General
The sensitivity/frequency characteristics are checked against the tolerances
at the center frequencies of the fractional octave bands used in the
respective test after interpolating the tolerances according to TS 26.131.
### 10.4.1 Handset and headset UE sending
The test method is the same as for super-wideband (see sub-clause 9.4.1).
### 10.4.2 Handset and headset UE receiving
The test method is the same as for super-wideband (see sub-clause 9.4.2,
observing the signal properties for fullband described in sub-clause 5.4).
### 10.4.3 Desktop and vehicle-mounted hands-free UE sending
The test method is the same as for super-wideband (see sub-clause 9.4.3).
### 10.4.4 Desktop and vehicle-mounted hands-free UE receiving
The test method is the same as for super-wideband (see sub-clause 9.4.4,
observing the signal properties for fullband described in sub-clause 5.4).
### 10.4.5 Hand-held hands-free UE sending
The test method is the same as for super-wideband (see sub-clause 9.4.5,
observing the signal properties for fullband described in sub-clause 5.4).
### 10.4.6 Hand-held hands-free UE receiving
The test method is the same as for super-wideband (see sub-clause 9.4.6,
observing the signal properties for fullband described in sub-clause 5.4).
## 10.5 Sidetone characteristics
### 10.5.1 Connections with handset UE
The test method is the same as for super-wideband (see sub-clause 9.5.1).
### 10.5.2 Headset UE
The test method is the same as for super-wideband (see sub-clause 9.5.2).
### 10.5.3 Hands-free UE (all categories)
No requirement other than echo control.
### 10.5.4 Sidetone delay for handset or headset
The test method is the same as for super-wideband (see sub-clause 9.5.4).
## 10.6 Stability loss
Where a user-controlled volume control is provided it is set to maximum.
**Handset UE:** The handset is placed on a hard plane surface with the
earpiece facing the surface.
**Headset UE:** The requirement applies for the closest possible position
between microphone and headset receiver within the intended wearing position.
NOTE: Depending on the type of headset it may be necessary to repeat the
measurement in different positions.
**Hands-free UE (all categories):** No requirement other than echo loss.
Before the actual test a training sequence consisting of the British-English
single talk sequence described in ITU-T Recommendation P.501 [22] is applied.
The training sequence level shall be ‑16 dBm0 in order to not overload the
codec.
The test signal is a PN-sequence complying with ITU-T Recommendation P.501
with a length of 4 096 points (for a 48 kHz sampling rate system) and a crest
factor of 6 dB instead of 11 dB. The PN-sequence is generated as described in
P.501 with W(k) constant within the frequency range 100-20000 Hz and zero
outside this range. The duration of the test signal is 250 ms. With an input
signal of ‑3 dBm0, the attenuation from input to output of the system
simulator shall be measured under the following conditions:
a) The handset or the headset, with the transmission circuit fully active,
shall be positioned on a hard plane surface with at least 400 mm free space in
all directions. The earpiece shall face towards the surface as shown in figure
21;
b) The headset microphone is positioned as close as possible to the
receiver(s) within the intended wearing position;
c) For a binaural headset, the receivers are placed symmetrically around the
microphone.
{width="6.6930555555555555in" height="5.0152777777777775in"}
NOTE: All dimensions in mm.
Figure 21. Test configuration for stability loss measurement on handset or
headset UE
The attenuation from input to output shall be measured in the frequency range
from 100 Hz to 20 kHz. The spectral distribution of the output signal is
analysed with a 4k FFT (for a 48 kHz sample rate test system), thus the
measured part of the output signal is 85,333 ms. To avoid leakage effects the
frequency resolution of the FFT must be the same as the frequency spacing of
the PN-sequence.
## 10.7 Acoustic echo control
### 10.7.1 General
The description is the same as for super-wideband (see sub-clause 9.7.1).
### 10.7.2 Acoustic echo control in a hands-free UE
The test method is the same as for super-wideband (see sub-clause 9.7.2,
observing the signal properties for fullband described in sub-clause 5.4).
### 10.7.3 Acoustic echo control in a handset UE
The test method is the same as for super-wideband (see sub-clause 9.7.3,
observing the signal properties for fullband described in sub-clause 5.4).
### 10.7.4 Acoustic echo control in a headset UE
The test method is the same as for super-wideband (see sub-clause 9.7.4,
observing the signal properties for fullband described in sub-clause 5.4).
## 10.8 Distortion
### 10.8.1 Sending distortion
The test method is the same as for super-wideband (see sub-clause 9.8.1).
### 10.8.2 Receiving
The test method is the same as for super-wideband (see sub-clause 9.8.2,
observing the signal properties for fullband described in sub-clause 5.4).
## 10.9 Void
## 10.10 Delay
### 10.10.0 UE Delay Measurement Methodologies
The methodologies are the same as for super-wideband (see sub-clause 9.10.0).
### 10.10.1 Delay in sending direction (handset UE)
For further study.
### 10.10.1a Delay in sending direction (headset UE)
For further study.
### 10.10.2 Delay in receiving direction (handset UE)
For further study.
### 10.10.2a Delay in receiving direction (headset UE)
For further study.
### 10.10.3 Delay in sending + receiving direction using "echo" method
(handset UE)
For further study.
### 10.10.3a Delay in sending + receiving direction using "echo" method
(headset UE)
For further study.
### 10.10.4 Delay and speech quality in conditions with packet arrival time
variations and packet loss
#### 10.10.4.1 Delay in sending direction
For further study.
#### 10.10.4.2 Delay in receiving direction
For further study.
#### 10.10.4.3 Speech quality loss in conditions with packet arrival time
variations and packet loss
For further study.
### 10.10.5 UE send clock accuracy
For further study.
### 10.10.6 UE receiving with clock drift
For further study.
## 10.11 Echo control characteristics
### 10.11.1 Test set-up and test signals
The test method is the same as for super-wideband (see sub-clause 9.11.1,
observing the signal properties for fullband described in sub-clause 5.4).
### 10.11.2 Test method
The test method is the same as for super-wideband (see sub-clause 9.11.2,
observing the signal properties for fullband described in sub-clause 5.4).
#### 10.11.2.1 Signal alignment
The test method is the same as for super-wideband (see sub-clause 9.11.2.1).
#### 10.11.2.2 Signal level computation and frame classification
The test method is the same as for super-wideband (see sub-clause 9.11.2.2).
#### 10.11.2.3 Classification into categories
The test method is the same as for super-wideband (see sub-clause 9.11.2.3).
## 10.12 Quality (speech quality, noise intrusiveness) in the presence of
ambient noise
For further study.
###### ## Annex A (informative): Void
###### ## Annex B (informative): Reference algorithm for echo control
characteristics evaluation.
# B.1 General
In this annex, a reference algorithm for evaluation of the echo control
characteristics is described in pseudo code. The output of an implementation
of the test method with the stimuli from the file
"echo_control_reference_files.zip" should equal the results presented in Table
3a and Table 3b. To run the verification, the additional file named
"p501-downlink_WB.pcm" in the pseudo code shall be created from the
concatenated full band speech samples FB_female_conditioning_seq_long.wav and
FB_male_female_single-talk_seq.wav from ITU-T Recommendation P.501, and
processed with the following set of commands based on ITU-T Recommendation
G.191:
filter -down HQ3 far_end_signal_48k.pcm far_end_signal_16k.pcm\ filter P341
far_end_signal_16k.pcm p501-downlink_WB.pcm
Table 3a: Characterization of segment 1.
* * *
             Double talk   Single talk
Category Activity Av. Level [dB] Activity Av. Level [dB] **A1** 60,8% -1,2
95,1% 0,1 **A2** 39,2% -5,1 1,4% -4,8 **B** 0,0% 0 0,0% 0 **C** 0,0% 0 0,0% 0
**D** 0,0% 0 0,0% 0 **E** 0,0% 0 0,3% 9,4 **F** 0,0% 0 3,2% 8,7 **G** 0,0% 0
0,0% 0
* * *
Table 3b: Characterization of segment 2.
* * *
             Double talk   Single talk
Category Activity Av. Level [dB] Activity Av. Level [dB] **A1** 50.2% -1.1
93,8% 0,2 **A2** 40.8% -7.3 0,3% -5.6 **B** 1.2% -16,9 0,0% 0 **C** 7.1% -17,2
0,0% 0 **D** 0,0% 0 0,0% 0 **E** 0,0% 0 0,5% 9,5 **F** 0,7% 4.0 5.5% 6,2 **G**
0,0% 0 0,0% 0
* * *
The pseudo-code reference algorithm produces a text file output, and the
implementation of the test method may be tested with the test script on the
data in the file "echo_control_reference_files.zip" for which the result shall
equal
ms01-rec2; segm. 1; Processed signal;
active speech level [dBovl]; -45.8; RMS level [dBovl]; -51.5; speech activity;
0.269
ms01-rec2; segm. 1; Near end signal;
active speech level [dBovl]; -42.6; RMS level [dBovl]; -49.1; speech activity;
0.225
ms01-rec2; segm. 1; Downlink signal;
active speech level [dBovl]; -26.6; RMS level [dBovl]; -27.4; speech activity;
0.823
ms01-rec2; segm. 1; delay 0; DL delay 0;
DT activity 0.100; 0.608; 0.392; 0.000; 0.000; 0.000; 0.000; 0.000; 0.000;
ms01-rec2; segm. 1; delay 0; DL delay 0;
DT level diff; -1.2; -5.1; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;
ms01-rec2; segm. 1; delay 0; DL delay 0;
ST activity 0.664; 0.951; 0.014; 0.000; 0.000; 0.000; 0.003; 0.032; 0.000;
ms01-rec2; segm. 1; delay 0; DL delay 0;
ST level diff; 0.1; -4.8; 0.0; 0.0; 0.0; 9.4; 8.7; 0.0;
ms01-rec2; segm. 2; Processed signal;
active speech level [dBovl]; -42.0; RMS level [dBovl]; -44.4; speech activity;
0.581
ms01-rec2; segm. 2; Near end signal;
active speech level [dBovl]; -40.6; RMS level [dBovl]; -42.7; speech activity;
0.625
ms01-rec2; segm. 2; Downlink signal;
active speech level [dBovl]; -26.5; RMS level [dBovl]; -27.2; speech activity;
0.841
ms01-rec2; segm. 2; delay -1; DL delay 0;
DT activity 0.348; 0.502; 0.408; 0.012; 0.071; 0.000; 0.000; 0.007; 0.000;
ms01-rec2; segm. 2; delay -1; DL delay 0;
DT level diff; -1.1; -7.3; -16.9; -17.2; 0.0; 0.0; 4.0; 0.0;
ms01-rec2; segm. 2; delay -1; DL delay 0;
ST activity 0.362; 0.938; 0.003; 0.000; 0.000; 0.000; 0.005; 0.055; 0.000;
ms01-rec2; segm. 2; delay -1; DL delay 0;
ST level diff; 0.2; -5.6; 0.0; 0.0; 0.0; 9.5; 6.2; 0.0;
# B.2 Test script
\%
\% Set data format
\%
fs = 16000;
conditioningTime = 23.5;
downlinkSystemDelay = 0;
\%
\% Segment the data
\%
offsetDoubleTalk = conditioningTime;
offsetNearEnd = conditioningTime;
segmentDoubleTalkIndex(1) = {[0, 20]};
segmentNearEndIndex(1) = {[0, 20]};
segmentDoubleTalkIndex(2) = {[20, 35]};
segmentNearEndIndex(2) = {[20, 35]};
lengthDoubleTalk = max(cell2mat(segmentDoubleTalkIndex(end)));
lengthNearEnd = max(cell2mat(segmentNearEndIndex(end)));
firstSampleDoubleTalk = round(fs*offsetDoubleTalk) + 1;
firstSampleNearEnd = round(fs*offsetNearEnd) + 1;
lastSampleDoubleTalk = round(fs*(offsetDoubleTalk+lengthDoubleTalk));
lastSampleNearEnd = round(fs*(offsetNearEnd+lengthNearEnd));
indexDoubleTalk = [firstSampleDoubleTalk, lastSampleDoubleTalk];
indexNearEnd = [firstSampleNearEnd, lastSampleNearEnd];
\%
\% Read data from file
\%
fid = fopen(\'ms01_WB_rec2.pcm\', \'r\');
fseek(fid, 2*round(fs*offsetDoubleTalk), \'bof\');
processedData = fread(fid, round(fs*lengthDoubleTalk), \'int16\');
fclose(fid);
fid = fopen(\'ms01_WB_ref.pcm\', \'r\');
fseek(fid, 2*round(fs*offsetNearEnd), \'bof\');
nearendData = fread(fid, round(fs*lengthNearEnd), \'int16\');
fclose(fid);
fid = fopen(\'p501-downlink_WB.pcm\', \'r\');
fseek(fid, 2*round(fs*offsetDoubleTalk), \'bof\');
downlinkData = fread(fid, round(fs*lengthDoubleTalk), \'int16\');
fclose(fid);
\%
\% Evaluate
\%
ecEvaluation(processedData, nearendData, downlinkData, ...
segmentDoubleTalkIndex, segmentNearEndIndex, ...
\'ms01-rec2\', downlinkSystemDelay, ...
fs, \'bitExactTest.txt\');
# B.3 Reference algorithm
## B.3.1 Main algorithm
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\%
\% processedData: processed samples
\% originalData: near-end-only samples
\% downlinkData: down-link (loudspeaker) samples
\% processedSegmentSet: set of indices to processed data segments
\% originalSegmentSet: set of indices to original data segments
\% PROC_FILE: name shown in diagrams
\% downlinkSystemDelayInMs: delay in DL signal from data to acoustic out
\% sampleRate: sampling frequency of the data
\% resultsFile: output file
\%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function ecEvaluation(...
processedData, ...
nearendData, ...
downlinkData, ...
indexProcessed, ...
indexNearend, ...
PROC_FILE, ...
downlinkSystemDelayInMs, ...
sampleRate, ...
resultFile)
fid = fopen(resultFile, \'a\');
\% Define the categories
global D1 D2 D3 D4 L1 L2 L3;
D1 = 25;
D2 = 150;
D3 = 25;
D4 = 150;
L1 = 4;
L2 = -4;
L3 = -15;
global FRAME_LENGTH_MS ...
MAX_DURATION_MS ...
MAX_DURATION_FRAMES ...
MAX_LEVEL_DIFFERENCE ...
MIN_LEVEL_DIFFERENCE ...
HISTOGRAM_RESOLUTION_MS
FRAME_LENGTH_MS = 5;
MAX_DURATION_MS = 200;
MAX_DURATION_FRAMES = MAX_DURATION_MS/FRAME_LENGTH_MS;
MAX_LEVEL_DIFFERENCE = 40;
MIN_LEVEL_DIFFERENCE = -40;
HISTOGRAM_RESOLUTION_MS = FRAME_LENGTH_MS;
\% Main processing loop
frameLengthInSamples = FRAME_LENGTH_MS*sampleRate/1000; % 5ms frames
for segment = 1:length(indexProcessed)
\% Get the data samples for the segment
segmentDataProcessed = cell2mat(indexProcessed(segment));
segmentDataNearend = cell2mat(indexNearend(segment));
index =
(sampleRate*segmentDataProcessed(1)+1):sampleRate*segmentDataProcessed(2);
x = processedData(index);
z = downlinkData(index);
index = (sampleRate*segmentDataNearend(1)+1):sampleRate*segmentDataNearend(2);
y = nearendData(index);
\% Estimate and compensate for delay between processed and near end
[x, y, z, delay] = compensateDelay(x, y, z, 0.5*sampleRate);
\% Compute the signal levels and classify the frames
[Rx, Ry, Rz, doubleTalkFrames, singleTalkFrames] = ...
computeSignalLevels(x, y, z, ...
sampleRate, frameLengthInSamples, ...
downlinkSystemDelayInMs, ...
PROC_FILE, segment, fid);
\% Evaluate double-talk performance
numberOfDoubleTalkFrames =0;
\% Iterate over blocks of consecutive indices
H_dt = [];
doubleTalkFramesBlocks = findConsecutiveBlocks(doubleTalkFrames);
for i = 1:size(doubleTalkFramesBlocks,1)
IdxFrom = doubleTalkFramesBlocks(i,1);
IdxTo = doubleTalkFramesBlocks(i,2);
currentBlockLength = IdxTo - IdxFrom;
if currentBlockLength > 1
[H_dt_Tmp, ld_ax_dt, dur_ax_dt] = levelTimeStatistics(Rx(IdxFrom:IdxTo),
Ry(IdxFrom:IdxTo));
if isempty(H_dt)
H_dt = H_dt_Tmp;
else
H_dt = H_dt + H_dt_Tmp;
end
numberOfDoubleTalkFrames = numberOfDoubleTalkFrames + currentBlockLength;
end
end
[C_dt, L_dt] = evaluateHistogram(H_dt, ld_ax_dt, dur_ax_dt, ...
numberOfDoubleTalkFrames);
activityFactorDoubleTalk = numberOfDoubleTalkFrames/length(Rx);
\% Evaluate single-talk performance
numberOfSingleTalkFrames = 0;
\% Iterate over blocks of consecutive indices
H_st = [];
singleTalkFramesBlocks = findConsecutiveBlocks(singleTalkFrames);
for i = 1:size(singleTalkFramesBlocks,1)
IdxFrom = singleTalkFramesBlocks(i,1);
IdxTo = singleTalkFramesBlocks(i,2);
currentBlockLength = IdxTo - IdxFrom;
if currentBlockLength > 1
[H_st_Tmp, ld_ax_st, dur_ax_st] = levelTimeStatistics(Rx(IdxFrom:IdxTo),
Ry(IdxFrom:IdxTo));
if isempty(H_st)
H_st = H_st_Tmp;
else
H_st = H_st + H_st_Tmp;
end
numberOfSingleTalkFrames = numberOfSingleTalkFrames + currentBlockLength;
end
end
[C_st, L_st] = evaluateHistogram(H_st, ld_ax_st, dur_ax_st, ...
numberOfSingleTalkFrames);
activityFactorSingleTalk = numberOfSingleTalkFrames/length(Rx);
\% Save to result file
writeResultsToFile(fid, ...
PROC_FILE, ...
segment, ...
delay, ...
round(downlinkSystemDelayInMs), ...
activityFactorDoubleTalk, ...
activityFactorSingleTalk, ...
C_dt, ...
C_st, ...
L_dt, ...
L_st);
end
fclose(fid);
## B.3.2 Delay compensation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\%
\% Compensate for delay in processed file
\%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function [x, y, z, delay] = ...
compensateDelay(...
x, ...
y, ...
z, ...
maxLag)
ii = 1:min(1000000, length(x));
r = xcorr(x(ii), y(ii), maxLag);
[\~, delay] = max(abs(r));
delay = delay-maxLag-1;
if (delay > 0)
x = x((delay+1):end);
z = z((delay+1):end);
y = y(1:(end-delay));
elseif (delay \ activeSpeechLevelNearend-15.9);
activeRzFrames = find(Rz > activeSpeechLevelDownlink-15.9);
\% Downlink with added hangover
activeDownlinkSpeechFrames = zeros(size(Rz));
activeDownlinkSpeechFrames(activeRzFrames) = ones(size(activeRzFrames));
activeDownlinkSpeechFrames = conv(activeDownlinkSpeechFrames, ...
ones(DOWNLINK_HANGOVER_FRAMES, 1));
activeDownlinkSpeechFrames = activeDownlinkSpeechFrames(1:length(Rz));
\% Near-end
activeNearEndSpeechFrames = zeros(size(Ry));
activeNearEndSpeechFrames(activeRyFrames) = ones(size(activeRyFrames));
activeNearEndSpeechHtFrames = conv(activeNearEndSpeechFrames, ...
ones(NEAREND_HANGOVER_FRAMES, 1));
activeNearEndSpeechHtFrames = activeNearEndSpeechHtFrames(1:length(Rz));
\% Only evaluate double talk when both rx+hangover and near-end
doubleTalkSpeechFrames = (activeDownlinkSpeechFrames & ...
activeNearEndSpeechFrames);
doubleTalkFrames = find(doubleTalkSpeechFrames > 0);
\% Single talk defined as rx and no near-end including 200 ms hangover
singleTalkSpeechFrames = (activeDownlinkSpeechFrames & ...
\~activeNearEndSpeechHtFrames);
singleTalkFrames = find(singleTalkSpeechFrames > 0);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\%
\% Average speech and noise levels
\%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function [...
activeSpeechLevel, ...
longTermLevel, ...
activityFactor ...
] = ...
speechLevelMeter(x, sampleRate)
SPEECH_LEVEL_HANGOVER_TIME_IN_MS = 200;
\% Filter data
g = exp(-1/(0.03*sampleRate));
p = filter((1-g), [1, -g], abs(x));
q = filter((1-g), [1, -g], abs(p));
\% Add 200ms hangover
hTimeInSamples = SPEECH_LEVEL_HANGOVER_TIME_IN_MS*sampleRate/1000;
qht = q;
for loop = 1:hTimeInSamples
qht = max(qht, [zeros(loop, 1); q(1:end-loop)]);
end
\% Compute cumulative histogram of signal power with hangover
nData = length(x);
cBins = 2.0.\^(0:14)\';
histogramCsum = zeros(size(cBins));
for loop = 1:length(cBins)
histogramCsum(loop) = length(find(qht>cBins(loop)));
end
\% Get the levels
sumSquare = sum(x.\^2);
refdB = 20*log10(32768);
longTermLevel = 10*log10(sumSquare/nData) - refdB;
A = 10*log10(sumSquare./histogramCsum) - refdB;
C = 20*log10(cBins) - refdB;
Diff = A-C;
if ((A(1) == 0) \|\| ((A(1) - C(1)) \ power of maximum square wave signal, 32768
\%
\% 10\^0 = 32768\^2/X => X = 32768\^2
\%
\% Avoid log(0) by using log(max(eps, Rx))
\%
Rx = 10*log10(max(eps, Rx)/32768/32768);
## B.3.4 Level vs time computation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\%
\% Computation of level and time statistics
\%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function [...
levelVsDurationHistogram, ...
levelDifferenceAxis, ...
durationAxis] = ...
levelTimeStatistics(processedLevel, nearEndLevel)
global MAX_DURATION_FRAMES MAX_LEVEL_DIFFERENCE MIN_LEVEL_DIFFERENCE
FIRST_OCCURENCE = 1;
\%
\% Compute level difference
\%
levelDifference = processedLevel - nearEndLevel;
\%
\% Only evaluate in integers (rounded towards 0) of dB and limit to max/min
difference
\%
levelDifference = fix(levelDifference);
levelDifference = min(levelDifference, MAX_LEVEL_DIFFERENCE);
levelDifference = max(levelDifference, MIN_LEVEL_DIFFERENCE);
\%
\% Produce axis
\%
levelDifferenceAxis = MIN_LEVEL_DIFFERENCE:MAX_LEVEL_DIFFERENCE;
durationAxis = 1:(MAX_DURATION_FRAMES+1);
\%
\% Set initial values for computations and loop through all frames
\%
numberOfEvaluatedFrames = length(levelDifference);
levelIncludedInEvaluation = (MAX_LEVEL_DIFFERENCE+1)*...
ones(numberOfEvaluatedFrames, 1);
levelAndRunLength = zeros(numberOfEvaluatedFrames, 4);
levelVsDurationHistogram = zeros(MAX_LEVEL_DIFFERENCE+ ...
(-MIN_LEVEL_DIFFERENCE)+1, ...
MAX_DURATION_FRAMES+1);
previousLevelDifference = 0;
for frame = 1:numberOfEvaluatedFrames-1;
currentLevelDifference = levelDifference(frame);
\%
\% Evaluate all levels from the previous level up to the current level
\%
if currentLevelDifference \ 0)
duration = find(levelDifference(frame+1:end) \ ...
evaluatedLevelDifference, FIRST_OCCURENCE);
end
if (isempty(duration))
duration = numberOfEvaluatedFrames-frame+1;
end
\%
\% Set the frames during duration of the level difference
\% as being evaluated
\%
if (duration > 1)
levelIncludedInEvaluation(frame:(frame+duration-1)) = ...
evaluatedLevelDifference*ones(duration, 1);
end;
\%
\% Add the number of frames in the duration that have
\% absolute level diff greater or equal to evalutedLevel
\%
durationIndex = min(duration, MAX_DURATION_FRAMES);
levelIndex = evaluatedLevelDifference+(-MIN_LEVEL_DIFFERENCE)+1;
levelVsDurationHistogram(levelIndex, durationIndex) = ...
levelVsDurationHistogram(levelIndex, durationIndex) + duration;
end
end
previousLevelDifference = currentLevelDifference;
end
## B.3.5 Categorization
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\%
\% Evaluate the histogram data
\%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function [categories, averageLevelsInCategories] = ...
evaluateHistogram(...
histogramData, ...
levelDiff_ax, ...
duration_ax, ...
numberOfFrames)
global D1 D2 D3 D4 L1 L2 L3 HISTOGRAM_RESOLUTION_MS;
D1_scaled = D1/HISTOGRAM_RESOLUTION_MS;
D2_scaled = D2/HISTOGRAM_RESOLUTION_MS;
D3_scaled = D3/HISTOGRAM_RESOLUTION_MS;
D4_scaled = D4/HISTOGRAM_RESOLUTION_MS;
levelIndex_L1 = find(levelDiff_ax == L1);
levelIndex_L2 = levelDiff_ax == L2;
levelIndex_L3 = find(levelDiff_ax == L3);
duration_A2 = duration_ax;
duration_B = duration_ax\D2_scaled;
duration_E = duration_ax\D4_scaled;
framesInCategoryB = sum(histogramData(levelIndex_L3, duration_B));
framesInCategoryC = sum(histogramData(levelIndex_L3, duration_C));
framesInCategoryD = sum(histogramData(levelIndex_L3, duration_D));
framesInCategoryE = sum(histogramData(levelIndex_L1, duration_E));
framesInCategoryF = sum(histogramData(levelIndex_L1, duration_F));
framesInCategoryG = sum(histogramData(levelIndex_L1, duration_G));
framesInCategoryA2 = sum(histogramData(levelIndex_L2, duration_A2));
framesInCategoryA2 = framesInCategoryA2 - ...
framesInCategoryB - ...
framesInCategoryC - ...
framesInCategoryD;
framesInCategoryA1 = numberOfFrames - ...
framesInCategoryA2 - ...
framesInCategoryB - ...
framesInCategoryC - ...
framesInCategoryD - ...
framesInCategoryE - ...
framesInCategoryF - ...
framesInCategoryG;
categories = [framesInCategoryA1;
framesInCategoryA2;
framesInCategoryB;
framesInCategoryC;
framesInCategoryD;
framesInCategoryE;
framesInCategoryF;
framesInCategoryG]/numberOfFrames;
averageLevelsInCategories = zeros(8, 1);
\% Category A1
index = levelDiff_ax \ L2;
weight = levelDiff_ax(index);
duration = duration_ax;
levelTimesDuration = (weight*histogramData(index, duration)).*duration;
nData = sum(histogramData(index, duration)*duration\');
if (framesInCategoryA1 > 0)
averageLevelsInCategories(1) = sum(levelTimesDuration)/nData;
end
\% Category A2
index = levelDiff_ax \ L3;
weight = levelDiff_ax(index);
duration = duration_ax;
levelTimesDuration = (weight*histogramData(index, duration)).*duration;
nData = sum(histogramData(index, duration)*duration\');
if (framesInCategoryA2 > 0)
averageLevelsInCategories(2) = sum(levelTimesDuration)/nData;
end
\% Category B, C, D
index = find(levelDiff_ax \ 0)
averageLevelsInCategories(3) = sum(levelTimesDuration)/nData;
end
duration = duration_ax(duration_C);
levelTimesDuration = (weight*histogramData(index, duration_C)).*duration;
nData = sum(histogramData(index, duration_C)*duration\');
if (framesInCategoryC > 0)
averageLevelsInCategories(4) = sum(levelTimesDuration)/nData;
end
duration = duration_ax(duration_D);
levelTimesDuration = (weight*histogramData(index, duration_D)).*duration;
nData = sum(histogramData(index, duration_D)*duration\');
if (framesInCategoryD > 0)
averageLevelsInCategories(5) = sum(levelTimesDuration)/nData;
end
\% Category E, F, G
index = find(levelDiff_ax >= L1);
weight = levelDiff_ax(index);
duration = duration_ax(duration_E);
levelTimesDuration = (weight*histogramData(index, duration_E)).*duration;
nData = sum(histogramData(index, duration_E)*duration\');
if (framesInCategoryE > 0)
averageLevelsInCategories(6) = sum(levelTimesDuration)/nData;
end
duration = duration_ax(duration_F);
levelTimesDuration = (weight*histogramData(index, duration_F)).*duration;
nData = sum(histogramData(index, duration_F)*duration\');
if (framesInCategoryF > 0)
averageLevelsInCategories(7) = sum(levelTimesDuration)/nData;
end
duration = duration_ax(duration_G);
levelTimesDuration = (weight*histogramData(index, duration_G)).*duration;
nData = sum(histogramData(index, duration_G)*duration\');
if (framesInCategoryC > 0)
averageLevelsInCategories(8) = sum(levelTimesDuration)/nData;
end
## B.3.6 Auxiliary functions for reporting data
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\%
\% Write the classification to file
\%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function writeResultsToFile(fid, ...
PROC_FILE, ...
segment, ...
delay, ...
downlinkSystemDelay, ...
activityFactorDoubleTalk, ...
activityFactorSingleTalk, ...
C_dt, ...
C_st, ...
L_dt, ...
L_st)
str = sprintf(\'%s; segm. %d; delay %d; DL delay %d; DT activity %1.3f; %1.3f;
%1.3f; %1.3f; %1.3f; %1.3f; %1.3f; %1.3f; %1.3f;\', ...
PROC_FILE, segment, delay, downlinkSystemDelay, activityFactorDoubleTalk, ...
C_dt(1), C_dt(2), C_dt(3), C_dt(4), ...
C_dt(5), C_dt(6), C_dt(7), C_dt(8));
disp(str);
if (fid > -1)
fprintf(fid, [str, \'\n\']);
end;
str = sprintf(\'%s; segm. %d; delay %d; DL delay %d; DT level diff; %1.1f;
%1.1f; %1.1f; %1.1f; %1.1f; %1.1f; %1.1f; %1.1f;\', ...
PROC_FILE, segment, delay, downlinkSystemDelay, ...
L_dt(1), L_dt(2), L_dt(3), L_dt(4), L_dt(5), L_dt(6), L_dt(7), L_dt(8));
disp(str);
if (fid > -1)
fprintf(fid, [str, \'\n\']);
end;
str = sprintf(\'%s; segm. %d; delay %d; DL delay %d; ST activity %1.3f; %1.3f;
%1.3f; %1.3f; %1.3f; %1.3f; %1.3f; %1.3f; %1.3f;\', ...
PROC_FILE, segment, delay, downlinkSystemDelay, activityFactorSingleTalk, ...
C_st(1), C_st(2), C_st(3), C_st(4), ...
C_st(5), C_st(6), C_st(7), C_st(8));
disp(str);
if (fid > -1)
fprintf(fid, [str, \'\n\']);
end;
str = sprintf(\'%s; segm. %d; delay %d; DL delay %d; ST level diff; %1.1f;
%1.1f; %1.1f; %1.1f; %1.1f; %1.1f; %1.1f; %1.1f;\', ...
PROC_FILE, segment, delay, downlinkSystemDelay, ...
L_st(1), L_st(2), L_st(3), L_st(4), L_st(5), L_st(6), L_st(7), L_st(8));
disp(str);
if (fid > -1)
fprintf(fid, [str, \'\n\']);
end;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\%
\% Write the signal levels to file
\%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function writeSpeechLevelsToFile(PROC_FILE, segment, fid, ...
activeSpeechLevelProcessed, ...
activeSpeechLevelNearend, ...
activeSpeechLevelDownlink, ...
longTermLevelProcessed, ...
longTermLevelNearend, ...
longTermLevelDownlink, ...
activityFactorProcessed, ...
activityFactorNearend, ...
activityFactorDownlink)
str = sprintf(\'%s; segm. %d; Processed signal; active speech level [dBovl];
%3.1f; RMS level [dBovl]; %3.1f; speech activity; %1.3f\', ...
PROC_FILE, segment, activeSpeechLevelProcessed, ...
longTermLevelProcessed, activityFactorProcessed);
disp(str);
if (fid > -1)
fprintf(fid, [str, \'\n\']);
end;
str = sprintf(\'%s; segm. %d; Near end signal; active speech level [dBovl];
%3.1f; RMS level [dBovl]; %3.1f; speech activity; %1.3f\', ...
PROC_FILE, segment, activeSpeechLevelNearend, ...
longTermLevelNearend, activityFactorNearend);
disp(str);
if (fid > -1)
fprintf(fid, [str, \'\n\']);
end;
str = sprintf(\'%s; segm. %d; Downlink signal; active speech level [dBovl];
%3.1f; RMS level [dBovl]; %3.1f; speech activity; %1.3f\', ...
PROC_FILE, segment, activeSpeechLevelDownlink, ...
longTermLevelDownlink, activityFactorDownlink);
disp(str);
if (fid > -1)
fprintf(fid, [str, \'\n\']);
end;
## B.3.7 Other helper functions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\%
\% Find & separate blocks with consecutive indices
\%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function [ConsecutiveBlocks] = findConsecutiveBlocks(FrameIndices)
D = diff(FrameIndices);
Changes = find(D > 1);
ConsecutiveBlocks = zeros(length(Changes)+1,2);
ConsecutiveBlocks(1,1) = FrameIndices(1);
for i = 1:length(Changes)
ConsecutiveBlocks(i,2) = FrameIndices(Changes(i));
if i \ the maximum of the cross correlation between measured and source > signal for each time step.
  * The step size of the calculation of the variable delay is 4.0s for > the above test signal, which corresponds to one single sentence of > the source signal.
  * This analysis provides the output signal Y(tn) consisting of one > single delay value for each time step, i.e., for each sentence of > the above source signal.
  * A median filter of length 3 is applied to the delay vs. time series > Y(tn) yielding the time series Ŷ(tn). This smoothes small spikes > without soften the delay jumps.
  * Delay jumps due to jitter buffer over- or underrun are detected as > the time steps where the absolute delay difference abs(Ŷ(tn+1) - > Ŷ(tn)) is larger than a threshold ΔYmax, which is appropriate to > detect a maximum clock drift of 500 PPM.
  * A "continuous" delay vs. time series is generated where the delay > jumps are eliminated, e.g., by cutting out the delay jumps and > "stitching" together the jump-free segments.
  * The clock drift is estimated as the regression coefficient β of the > "continuous" delay vs. time series in parts per million (PPM):\ > {width="1.46875in" height="0.34375in"}
In case of clock drifts higher than 50 ppm the accuracy of the cross-
correlation calculation decreases. In such event it is recommended to take a
two-step approach. In the first step a coarse drift compensation is performed
and the clock of the reference client is adjusted to the ppm derived in the
first step. A fine compensation is performed in the second step by applying
the same procedure. The final clock drift in ppm is the sum of both clock
drifts.
# D.2 Clock drift estimation algorithm
function Drift = EstimatePPM(DelayVsTime, StepSize, DiffMaxPPM=500)
% Difference threshold from which on a difference is assumed to be a packet
% loss or insertion. With larger step sizes, the normal clock drift
% results in higher differences between steps and therefore requires a
% larger threshold.
DelayDiffThreshold = min( max( DiffMaxPPM*1e-6*StepSize, 1e-3 ), 4e-3 );
% Calculate median filter of length 3 to smooth away small spikes without
% soften the steps.
DelayMedian = DelayVsTime(:);
for i = 2:numel(DelayVsTime)-1
DelayMedian(i) = median(DelayVsTime(i-1:i+1));
end
% Calculate delay difference per time step.
DelayDiff = diff( DelayMedian );
% Exclude all indices with high delay differences as well as some
% transition range before and after.
Mask = true(size(DelayDiff));
Jumps = find( abs(DelayDiff) > DelayDiffThreshold );
for i = 1:length(Jumps)
Mask(Jumps(i)-1:Jumps(i)+1) = false;
end
% Generate \"continuous\" delay vs. time series
Delay = [ 0; cumsum( DelayDiff(Mask) ) ];
Time = ( 0:numel(Delay)-1)\';
% Estimate clock drift in PPM as slope of linear regression line
P = polyfit( Time, Delay, 1 );
Drift = P(1) / StepSize * 1e6;
###### ## Annex E (normative): Packet delay and loss profiles for UE delay
testing of MTSI-based speech with LTE access
# E.1 General
This Annex provides packet delay and loss profiles to be inserted on the IP
packets in the test system when testing the UE delay and speech quality for
MTSI-based speech with LTE access in jitter and error conditions. The profiles
are based on the assumption that one IP packet corresponds to 20ms of the
speech sequence. In order to preserve the synchronization of the elements in
the profile and the timing of the speech sequence (e.g. the RTP time stamp)
when the speech codec does not produce one packet every 20ms, e.g. during
speech codec DTX operation, the profiles needs to be sub-sampled in accordance
with the rate of production of the packets containg the speech frames.
The variation in the packet arrival time and the loss rate of the speech
packets experienced by the receiving UE in an LTE connection will vary
depending on several parameters and operating conditions of the LTE network.
Standardized characteristics with respect to Packet Delay Budget (PDB) and
Packet Error Loss Rate (PELR) for different QoS Class Identifiers (QCI) for an
LTE access network are defined in 3GPP TS 23.203 [42]:
  * The PDB of a QCI defines an upper bound for the time that a packet > may be delayed between the UE and the PCEF. For a certain QCI the > value of the PDB is the same in uplink and downlink. The purpose > of the PDB is to support the configuration of scheduling and link > layer functions (e.g. the setting of scheduling priority weights > and HARQ target operating points). The PDB shall be interpreted as > a maximum delay with a confidence level of 98 percent.
  * The PELR of a QCI defines an upper bound for the rate of SDUs (e.g. > IP packets) that have been processed by the sender of a link layer > protocol (e.g. RLC in E‑UTRAN) but that are not successfully > delivered by the corresponding receiver to the upper layer (e.g. > PDCP in E‑UTRAN). Thus, the PELR defines an upper bound for a rate > of non congestion related packet losses. The purpose of the PELR > is to allow for appropriate link layer protocol configurations > (e.g. RLC and HARQ in E‑UTRAN). For a certain QCI the value of the > PELR is the same in uplink and downlink.
The stipulated PDB and PELR as defined in 3GPP TS 23.203 for QCI1 intended for
Conversational Voice services results in that on each link 99 percent of the
packets will be successfully delivered over an LTE air interface with a
maximum delay of less than 80ms with a confidence level of 98 percent.
# E.2 Simulation model for generating packed delay and loss profiles
This clause describes a simulation model that generates packet arrival time
variations and packet loss experienced by the receiving UE for MTSI-based
speech with an end-to-end LTE access.
The model is derived solely for the purpose of testing the UE delay for MTSI-
based speech with LTE access. As discussed in Section E.1, several LTE network
parameters have a significant impact on the packet delay variations
experienced by the UE. This model includes the effect of the DRX cycle, the
BLER on the MAC/PHY layer, and the HARQ re-transmission. In addition, jitter
in the EPC and the effect of the mis-alignment of the DRX-cycle between the
uplink and downlink eNBs are included.
The model is described in Table E.X and operates on the following input
parameters
  * Uplink and downlink block error rate (BLER), respectively.
  * Maximum number of HARQ re-transmissions on uplink and dowblink, respectively.
  * DRX cycle length.
  * Time differnce between the uplink and the downlink eNB DRX cycle.
  * Maximum and minimum network delay between the uplink and the downlink eNB.
The random number generator used in the model produces pseudorandom values
drawn from the standard uniform distribution on the open interval (0, 1).
The model generates packet delay and loss profiles for two different test
system configurations of the UE delay:
  * When the system simulator is transparent in the downlink at the MAC/PHY layer and does not operate in DRX. This approach requires the variations of the delay due to downlink HARQ re-transmissions and mapping to the DRX cycle to be simulated. In this case, the model simulates the delay and jitter profiles for the packets from the antenna of the sending UE to the antenna receiving UE (end-to-end simulation). This is the testing condition used in 3GPP TS 26.132.
  * When the system simulator is configured for error insertion in the downlink at the MAC/PHY layer and DRX operation, and the system simulator implements the HARQ re-transmissions and the mapping of the packets to the DRX cycle time at the downlink. In this case, the model simulates the delay and loss profiles from the sending UE up to the receiving eNB. This testing condition is currently not used in 3GPP TS 26.132.
It should be noted that the model does not fully utilize the PDB for QCI1 as
defined in 3GPP TS 23.203 and does not include temporary variations of the
packet arrival time variation and the loss rate that may be experienced during
e.g. hand-over or congestion. Hence, the packet delay and loss profiles
generated by the model do not fully exercise the conditions that the jitter
buffer management of the UE may be exposed to in LTE systems and the profiles
generated by the model are only intended for the testing of the UE delay in
stationary operating conditions.
Table E.1: Simulation model for generating packet delay and loss profiles for
MTSI-based speech with LTE access
+----------------------------------------------------------------------+ | function [UE1_UE2_dly,UE1_eNB2_dly,plr,comp_e2e,comp] = ... | | | | VoLTEDelayProfile_vPHY(BLER_tx, BLER_rx, max_tx, max_rx, | | drx_cycle_length, mis_eNB1_eNB2, max_net_delay, | | min_net_delay, nFrames, seed) | | | | \% BLER_tx : The block error rate in uplink. | | | | \% BLER_rx : The block error rate in downlink. | | | | \% max_tx : The maximum number of transmission attempts in uplink. | | | | \% max_rx : The maximum number of transmission attempts in | | downlink. | | | | \% drx_cycle_length : The length of the DRX cycle | | | | \% mis_eNB1_eNB2 : Scheduling time mis-alignment between eNB1 and | | eNB2 | | | | \% max_net_delay : The maximum network delay between eNB1 to eNB2 | | | | \% min_net_delay : The minimum network delay between eNB1 to eNB2 | | | | \% nFrames : The number of frames for the simulation | | | | \% seed : Random number generator seed | | | | rng(seed); | | | | UE1_UE2_time = zeros(nFrames, 1); | | | | UE1_eNB2_time = zeros(nFrames,1); | | | | eNB1_eNB2_dly = round(min_net_delay + | | (max_net_delay-min_net_delay).*rand(nFrames,1)); | | | | ack1 = zeros(nFrames,1); | | | | ack2 = zeros(nFrames,1); | | | | wall_clock = 20; | | | | frame = 1; | | | | frame_size = 20; | | | | simulationTime = nFrames*frame_size; | | | | \% Calculate the delay from UE1 speech encoder delivery to eNB2. If | | | | \% transmission to eNB1 is not successful after max_tx attempts, | | dly = 0 (packet loss) | | | | while (wall_clock\0)); | | | | comp=min(UE1_eNB2_dly(UE1_eNB2_dly>0)); | | | | end | | | | \% Calculates the overall packet loss from UE1 to UE2 | | | | pl=0; | | | | for frame=1:nFrames | | | | if UE1_UE2_dly(frame)==0; | | | | pl=pl+1; | | | | end | | | | end | | | | plr=pl/nFrames; | +----------------------------------------------------------------------+
# E.3 Packed delay and loss profiles for simulated stationary operating
conditions with DRX 20 ms and DRX 40 ms
Two delay and loss profiles simulating the packet delay variations and packet
loss that a UE may experience in stationary operating conditions with 20ms and
40ms DRX, respectively, are generated from the model with the parameter
settings as described in Table E.2. The delay profiles are attached as text
files and as binary trace files in the form of TCN network emulator.
Table E.2: Parameter settings for packet delay profile generation.
+----------------+----------------+----------------+----------------+ | Operating | Parameter | System | Delay and Loss | | condition | setting | simulator | profile | | | | operation | | +----------------+----------------+----------------+----------------+ | Stationary DRX | BLER_tx : 0.1 | Transparent | dly_profil | | 20 ms | | system | e_20msDRX_10 | | | BLER_rx : 0.1 | simulator | pct_BLER_e2e | | | | downlink | | | | max_tx : 3 | | | | | | | | | | max_rx : 3 | | | | | | | | | | drx\ | | | | | _cycle_length | | | | | : 20 | | | | | | | | | | m | | | | | is_eNB1_eNB2 | | | | | : 10 | | | | | | | | | | m | | | | | ax_net_delay | | | | | : 33 | | | | | | | | | | m | | | | | in_net_delay | | | | | : 27 | | | | | | | | | | nFrames : 8000 | | | | | | | | | | seed : 0 | | | +----------------+----------------+----------------+----------------+ | | | System | dly_pr | | | | simulator | ofile_20msDRX | | | | generating | _10pct_BLER\ | | | | HARQ | _ue1_to_eNB2 | | | | re | (Not used in | | | | -transmissions | 3GPP TS | | | | and DRX | 26.131) | | | | operation on | | | | | the downlink | | +----------------+----------------+----------------+----------------+ | Stationary DRX | BLER_tx : 0.1 | Transparent | dly_profil | | 40 ms | | system | e_40msDRX_10 | | | BLER_rx : 0.1 | simulator | pct_BLER_e2e | | | | downlink | | | | max_tx : 3 | | | | | | | | | | max_rx : 3 | | | | | | | | | | drx\ | | | | | _cycle_length | | | | | : 40 | | | | | | | | | | m | | | | | is_eNB1_eNB2 | | | | | : 30 | | | | | | | | | | m | | | | | ax_net_delay | | | | | : 33 | | | | | | | | | | m | | | | | in_net_delay | | | | | : 27 | | | | | | | | | | nFrames : 8000 | | | | | | | | | | seed : 0 | | | +----------------+----------------+----------------+----------------+ | | | System | dly_pr | | | | simulator | ofile_40msDRX | | | | generating | _10pct_BLER\ | | | | HARQ | _ue1_to_eNB2 | | | | re | | | | | -transmissions | (Not used in | | | | and DRX | 3GPP TS | | | | operation on | 26.131) | | | | the downlink | | +----------------+----------------+----------------+----------------+
Since the model simulates the packet transmission end-to-end, the delay
profiles include a packet delay component that according to the definition of
the UE delay in 3GPP TS 26.131 [1] is not attributed to the UE delay. This
delay shall be included in the test equipment delay when deriving the UE delay
from the delay measurments based on the cross-correlation of the injected and
measured signals. Values for the compensation attributed to the packet delay
profiles are shown in Table E.3.
Table E.3: Packet delay profiles compensation values.
* * *
Delay and Loss profile Compensation value dly_profile_20msDRX_10pct_BLER_e2e
30 ms
dly_profile_40msDRX_10pct_BLER_e2e 30 ms
* * *
#
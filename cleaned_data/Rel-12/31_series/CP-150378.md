# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
Although some test cases are defined in the RAN5 and CT6 sets of test
specifications, there is no dedicated test specification for terminal
supporting ISIM. In order to assess whether the current test cases provide
sufficient coverage, there is a need to have a clear listing of the
conformance requirements for ISIM-ME Interface testing.
It is proposed that CT6 lists those conformance requirements and indicates
which conformance requirements are already covered by the CT6 test
specifications. The outcome of the work will allow RAN5 and CT6 to review
their existing ISIM-related test cases and enhance them as needed.
# 1 Scope
The present document objective is to develop a technical report listing the
conformance requirements extracted from TS 31.103. This technical report will
then be a basis for a gap analysis of test coverage and the subsequent
development of test cases to verify the conformance of Terminals with features
for the ISIM application.
The conformance requirements should allow:
  * Ensuring that content of the ISIM when available is read and used by the ME
  * Reusing of existing test specifications in 3GPP
  * Providing recommendations when necessary to fulfil the test purpose
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 31.101: \"UICC-terminal interface; Physical and logical
characteristics\".
[3] 3GPP TS 31.102: \"Characteristics of the Universal Subscriber Identity
Module (USIM) application\".
[4] 3GPP TS 31.103: \"Characteristics of the IP Multimedia Services Identity
Module (ISIM) application\".
[5] 3GPP TS 31.121: \"UICC-terminal interface; Universal Subscriber Identity
Module (USIM) application test specification\"
[6] 3GPP TS 31.124: \"Mobile Equipment (ME) conformance test specification;
Universal Subscriber Identity Module Application Toolkit (USAT) conformance
test specification\"
[7] 3GPP TS 34.108: \"Common test environments for User Equipment (UE);
Conformance testing\"
[8] 3GPP TS 34.229: \"Internet Protocol (IP) multimedia call control protocol
based on Session Initiation Protocol (SIP) and Session Description Protocol
(SDP); User Equipment (UE) conformance specification; Part 1: Protocol
conformance specification\".
[9] ISO/IEC 9646‑7: \" ISO/IEC 9646‑7 (1995): \"Information technology \- Open
Systems Interconnection - Conformance testing methodology and framework - Part
7: Implementation Conformance Statements\".
[10] 3GPP TS 24.008: \"Mobile radio interface layer 3 specification; Core
network protocols; Stage 3\"
[11] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\"
[12] 3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service
description; Stage 2\"
[13] 3GPP TS 27.060: \"Mobile Station (MS) supporting Packet Switched
Services\"
[14] 3GPP TS 24.301: \"Technical Specification Group Core Network and
Terminals; Non-Access-Stratum (NAS) protocol for Evolved Packet Systems (EPS):
Stage 3\"
[15] 3GPP TS 23.401: \"GPRS enhancements for E-UTRAN access\"
[16] 3GPP TS 33.203: \"Access security for IP based services\"
[17] ETSI TS 101 220: \"Smart cards; ETSI numbering system for
telecommunication application providers\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
For the purposes of the present document, the terms and definitions given in
TS 34.108 [7] and TS 31.121 [5] apply.
**Application DF (ADF):** entry point to an application
**access technology:** Radio Access Technology of the Terminal (e.g. E-UTRAN,
UTRAN or GSM)
**application:** consists of a set of security mechanisms, files, data and
protocols (excluding transmission protocols)
**Dedicated File (DF):** file containing access conditions and, optionally,
Elementary Files (Efs) or other Dedicated Files (DFs)
**directory:** general term for MF, DF and ADF
**Elementary File (EF):** file containing access conditions and data and no
other files
**file:** directory or an organised set of bytes or records in the UICC
**file identifier:** 2 bytes which address a file in the UICC
**ISIM:** application residing on the UICC, an IC card specified in TS 31.101
[2]\ In particular, TS 31.101 [2] specifies the application independent
properties of the UICC/terminal interface such as the physical characteristics
and the logical structure
The AID of ISIM is defined in ETSI TS 101 220 [17] and is stored in EF~DIR~.
**Master File (MF):** unique mandatory file containing access conditions and
optionally DFs and/or Efs
**terminal:** device into which a UICC can be inserted and which is capable of
providing access to 3GPP system services to users, either alone or in
conjunction with a UICC
**User Equipment (UE):** terminal with a UICC inserted with one or several
Universal Subscriber Identity Module(s) (USIM) available for access either
E-UTRANor UTRAN or GERAN or any combination.
**USIM session:** USIM session is a selectable application session for a USIM
application
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
bx Bit x of byte (leftmost bit is MSB)
Bn Byte No. n
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
AID Application IDentifier
APN Access Point Name
CN Core Network
CSCF Call Session Control Function
DF Dedicated File
EF Elementary File
IARI IMS Application Reference Identifier
ICS Implementation Conformance Statement
IM IP Multimedia
IMPI IM Private Identity
IMPU IM PUblic identity
IMS IP Multimedia Subsystem
IP Internet Protocol
IP-CAN IP-Connectivity Access Networks
ISIM IM Services Identity Module
IXIT Implementation eXtra Information for Testing
P-CSCF Proxy CSCF
PDN Packet Data Network
PDP Packet Data Protocol
P-GW PDN Gateway
PSI Public Service Identity
SIP Session Initiation Protocol
SM Short Message
SS System Simulator
URI Uniform Resource Identifier
## 3.4 Conformance Requirements
The Conformance Requirements clauses in the present document are copy/paste
from the relevant core specification where skipped text has been replaced with
\"...\". References to clauses in the Conformance Requirements section of the
test body refers to clauses in the referred specification, not sections in the
present document.
## 3.5 Applicability
### 3.5.1 Applicability of the present document
The present document applies to terminal equipment supporting the ISIM.
### 3.5.2 Applicability to terminal equipment
The applicability to terminal equipment supporting the ISIM is specified in
table B.1, unless otherwise specified in the specific clause.
### 3.5.3 Applicability of the individual tests
Table B.1 lists the optional, conditional or mandatory features for which the
supplier of the implementation states the support. As pre-condition the
supplier of the implementation shall state the support of possible options in
table A.1.
The \"Release XY ME\" columns shows the status of the entries as follows:
The following notations, defined in ISO/IEC 9646‑7[9], are used for the status
column:
M mandatory -- the capability is required to be supported.
O optional -- the capability may be supported or not.
N/A not applicable -- in the given context, it is impossible to use the
capability.
X prohibited (excluded) -- there is a requirement not to use this capability
in the given context.
O.i qualified optional -- for mutually exclusive or selectable options from a
set. \"i\" is an integer which identifies an unique group of related optional
items and the logic of their selection which is defined immediately following
the table.
Ci conditional -- the requirement on the capability (\"M\", \"O\", \"X\" or
\"N/A\") depends on the support of other optional or conditional items. \"i\"
is an integer identifying an unique conditional status expression which is
defined immediately following the table. For nested conditional expressions,
the syntax \"IF ... THEN (IF ... THEN ... ELSE...) ELSE ...\" shall be used to
avoid ambiguities.
The \"Additional test case execution recommendation\" column shows the status
of the entries as follows:
A applicable - the test is applicable according to the corresponding entry in
the \"Rxx ME\" column
R redundant -- the test has to be considered as redundant when the
corresponding E-UTRAN/EPC related test of the present document has been
validated and successfully executed. In that case the requirement may be
verified by means of the E-UTRAN/EPC functionality only.
AERi Additional test case Execution Recommendation -- with respect to the
above listed definitions of (\"A\") and (\"R\") the test is applicable (\"A\")
or redundant (\"R\") depending on the support of other optional or conditional
items. \"i\" is an integer identifying a unique conditional status expression
which is defined immediately following the table. For nested conditional
expressions, the syntax \"IF ... THEN (IF ... THEN ... ELSE...) ELSE ...\"
shall be used to avoid ambiguities.
##### References to items {#references-to-items .H6}
For each possible item answer (answer in the support column) there exists a
unique reference, used, for example, in the conditional expressions. It is
defined as the table identifier, followed by a solidus character \"/\",
followed by the item number in the table. If there is more than one support
column in a table, the columns shall be discriminated by letters (a, b, etc.),
respectively.
EXAMPLE: A.1/4 is the reference to the answer of item 4 in table A.1.
## 3.6 Table of optional features
Support of several features is optional or release dependent for the terminal
equipment. However, if an ME states conformance with a specific 3GPP release,
it is mandatory for the ME to support all mandatory functions of that release,
as stated in table A.1.
The supplier of the implementation shall state the support of possible options
in table A.1.
Table A.1: Options
* * *
Item Option Status 1 ISIM Application Selection C001 2 ISIM Initialization
C001 3 P-CSCF discovery from ISIM C001 4 Use of ISIM for IMS initial
registration **C001** 5 Initial Registration for three implicit registration
sets **C001** 6 Refresh for ISIM parameters O 7 Terminal supports SM-over-IP-
receiver O 8 Terminal supports reading SMS stored in EF SMS on the ISIM if
USIM and ISIM are present O 9 Terminal supports User-initiated registration
with list of IARIs from ISIM O 10 Incoming IMS data, IMS Registration and Data
available event, IARI list stored on the ISIM O C001 If terminal support IMS
then M else N/A
* * *
## 3.7 Applicability table
Table B.1: Applicability of tests
* * *
Item Description Test sequence(s) ME Release Network Dependency Additional
test case execution recommendation 1 ISIM Application Selection Implicitly
tested in 7, 8, 9 of this document From Rel-8 ME No  
2 ISIM Initialization Implicitly tested in 7, 8, 9 of this document From Rel-8
ME No  
3 P-CSCF discovery from ISIM 7.9 of TS 34.229[8] From Rel-8 ME No Check that
the P-CSCF address is read only if service n°5 of the ISIM Service Table is
available 4 Use of ISIM for IMS initial registration 8.1 of TS 34.229[8] From
Rel-8 ME No Ensure that the information in EF~IMPI~, EF~IMPU~ and EF~DOMAIN~
of the ISIM is different from IMPU, IMPI and Home Domain Name generated from
USIM information. 5 Initial Registration for three implicit registration sets
8.14 of TS 34.229[8] From Rel-8 ME No  
6 Refresh for ISIM parameters 8.15 of TS 34.229[8] From Rel-8 ME No  
7 Correct storage of an SM on the UICC 8.2.4 of TS 31.121[5] Refer to Table
B.1 of TS 31.121[5] Refer to Table B.1 of TS 31.121[5]  
8 Correct reading of a SM on the ISIM if USIM and ISIM are present 8.2.6 of TS
31.121[5] Refer to Table B.1 of TS 31.121[5] Refer to Table B.1 of TS
31.121[5]  
9 Mobile Originating SMS over IMS 18.1 of TS 34.229[8] From Rel-8 ME No It is
proposed to use the test as specified in TS 34.229[8] clause 18.1, while the
test procedure shall explicitly ensure that the PSI of the SC is obtained from
the EF~PSISMSC~ in DF_TELECOM of the ISIM. 10 User-initiated registration with
list of IARIs from ISIM Implicitly tested by 27.22.7.20 of TS 31.124[6] Refer
to Table B.1 of TS 31.124[6] Refer to Table B.1 of TS 31.124[6]  
11 Incoming IMS data, IMS Registration and Data available event, IARI list
stored on the ISIM 27.22.7.20 of TS 31.124[6] Refer to Table B.1 of TS
31.124[6] Refer to Table B.1 of TS 31.124[6]
* * *
# 4 Configurations
## 4.1 Default values for USIM
Depending on the test scenario, for this document the default values for the
USIM configuration is as defined in 3GPP TS 31.121[5] clause 4 or in
34.108[7].
Default values for the USIM configuration is as defined in 3GPP TS 31.121[5]
clause 4 applies to clauses 8.1, 8.2, 8.3, 9.1 and 9.2.
Default values for the USIM configuration is as defined in 3GPP 34.108[7]
applies to clauses 7.1, 7.2, 7.3, 7.4.
## 4.2 Default values for ISIM
For this document the default values for the ISIM configuration is as defined
in 3GPP TS 31.121[5] clause 4.5.
The following EF~IST~ (ISIM Service Table) applies:
Logically:
> (Service 01) P-CSCF Address: available
>
> (Service 02) Generic Bootstrapping: not available
>
> (Service 03) HTTP Digest: not available
>
> (Service 04) GBA Based Local Key Establishment Mechanism: not available
>
> (Service 05) Support for P-CSCF discovery for IMS local breakout: available
>
> (Service 06) Short Message Storage (SMS): available
>
> (Service 07) Short Message Status Reports (SMSR): available
>
> (Service 08) Support for SM-over-IP: available
>
> (Service 09) Communication Control for IMS by ISIM: available
>
> (Service 10) Support of UICC access to IMS: available
>
> (Service 11) URI support by UICC: available
* * *
**Byte** **B1** **B2** Coding: 1111 xxx1 xxxx x111
* * *
  1. 
# 5 ISIM Application Selection
## 5.1 Definition and Applicability
The default configuration of the UICC, in this specification, contains a USIM
and an ISIM. The ISIM information shall be used in order to register to the
IMS, send SMS over IMS, allow UICC access to IMS and perform GBA procedure.
## 5.2 Conformance requirement
[3GPP TS 31.103 clause 5.1.1.1]:
If the Terminal wants to engage in IMS operation, then after UICC activation
(see TS 31.101 [2]), the Terminal shall select an ISIM application, if an ISIM
application is listed in the EF~DIR~ file, using the SELECT by DF name as
defined in TS 31.101 [2].
...
[TS 24.229, clause 5.1.1.1A]:
The ISIM shall always be used for authentication to the IM CN subsystem, if it
is present, as described in 3GPP TS 33.203.
The ISIM is preconfigured with all the necessary parameters to initiate the
registration to the IM CN subsystem. These parameters include:
\- the private user identity;
\- one or more public user identities; and
\- the home network domain name used to address the SIP REGISTER request
The first public user identity in the list stored in the ISIM is used in
emergency registration requests.
...
##### Reference(s) {#references-1 .H6}
3GPP TS 31.103[4] clause 5.1.1.1.
3GPP TS 24.229[11] clause 5.1.1.1A.
## 5.3 Test purpose
To verify that the ISIM is selected when it is present.
## 5.4 References to existing tests
See clauses 7, 8 and 9 of this document.
## 5.5 Recommendations
Though, the ISIM application selection could be implicitly tested by verifying
that the ISIM information when available is used for the referenced tests
instead of the USIM information, it is recommended to perform the test
procedure using a probe between the UICC and the terminal to verify the
conformance of the ISIM application selection procedure as specified in 5.2.
# 6 ISIM initialization
## 6.1 Definition and Applicability
The Terminal is ready for an ISIM session only after successfully completed
the ISIM initialization as defined in TS 31.103 clause 5.1.1.2.
## 6.2 Conformance Requirement
[TS 31.103 clause 5.1.1.2]:
...
If the terminal does not support the languages of EF~PL~, then the terminal
shall use its own internal default selection.
The Terminal then runs the user verification procedure. If the procedure is
not performed successfully, the ISIM initialisation stops.
Then the Terminal performs the administrative information request.
If all these procedures have been performed successfully then the ISIM session
shall start. In all other cases the ISIM session shall not start.
After the previous procedures have been completed successfully, the Terminal
runs the following procedures:
\- IMPI request.
\- IMPU request.
\- SIP Domain request.
\- ISIM Service Table request. If the ISIM Service Table is not present, the
terminal shall assume that no optional services are available.
\- P-CSCF address request
After the ISIM initialisation has been completed successfully, the Terminal is
ready for an ISIM session and shall indicate this to the ISIM by sending a
particular STATUS command.
##### Reference(s) {#references-2 .H6}
3GPP TS 31.103[4] clause 5.1.1.2.
## 6.3 Test purpose
To verify that the Terminal perform the correct initialization procedure as
specified in TS 31.103 clause 5.1.1.2.
## 6.4 References to existing tests
See clauses 7, 8 and 9 of this document.
## 6.5 Recommendations
Though, the ISIM initialization could be implicitly tested by verifying that
the ISIM information when available is used for the referenced tests instead
of the USIM information, it is recommended to perform the test procedure using
a probe between the UICC and the terminal to verify the conformance of the
ISIM initialization procedure as specified in 6.2.
# 7 IMS Registration Related Tests
## 7.1 P-CSCF Discovery from ISIM
### 7.1.1 Definition and applicability
Test to verify that the UE can acquire P-CSCF address(es) in home network from
ISIM while UE is roaming. The test case is applicable for IMS security or
GIBA.
### 7.1.2 Conformance requirement
[TS 24.229 clause B.2.2.1]:
Prior to communication with the IM CN subsystem, the UE shall:
a) perform a GPRS attach procedure as specified in 3GPP TS 24.008 [10];
b) ensure that a PDP context used for SIP signalling according to the APN and
GGSN selection criteria described in 3GPP TS 23.060 [12] and 3GPP TS 27.060
[13] is available. This PDP context shall remain active throughout the period
the UE is connected to the IM CN subsystem, i.e. from the initial registration
and at least until the deregistration. As a result, the PDP context provides
the UE with information that makes the UE able to construct an IPv4 or an IPv6
address;
...
c) acquire a P-CSCF address(es).
The methods for P-CSCF discovery are:
I. ...
II. ...
III. The UE selects a P-CSCF from the list (see 3GPP TS 31.103 [4]) stored in
the ISIM.
IV. ...
...
The UE shall use method III to select the P-CSCF, if:
\- a P-CSCF is to be discovered in the home network;
\- the UE is roaming;
\- either the UE does not contain the IMS management object, or the UE
contains the IMS management object, but the IMS management object does not
contain the P-CSCF list; and
\- the ISIM residing in the UICC supports the P-CSCF list.
[TS 24.229 clause L.2.2.1]:
Prior to communication with the IM CN subsystem, the UE shall:
a) perform a EPS attach procedure as specified in 3GPP TS 24.301 [14];
b) ensure that a EPS bearer context used for SIP signalling according to the
APN and P-GW selection criteria described in 3GPP TS 23.401 [15], is
available. This EPS bearer context shall remain active throughout the period
the UE is connected to the IM CN subsystem, i.e. from the initial registration
and at least until the deregistration. As a result, the EPS bearer context
provides the UE with information that makes the UE able to construct an IPv4
or an IPv6 address;
...
c) acquire a P-CSCF address(es).
The methods for P-CSCF discovery are:
I. ...
II. ...
III. The UE selects a P-CSCF from the list (see 3GPP TS 31.103 [4]) stored in
the ISIM.
IV. ...
...
The UE shall use method III to select the P-CSCF, if:
\- a P-CSCF is to be discovered in the home network;
\- the UE is roaming;
\- either the UE does not contain the IMS management object, or the UE
contains the IMS management object but the IMS management object does not
contain the P-CSCF list; and
\- the ISIM residing in the UICC supports the P-CSCF list.
[TS 31.103 clause 4.2.8]:
A UE supporting IMS Local Breakout shall use this EF only if EF~IST~ indicates
that service n°5 is \"available\".
[TS 31.103 clause 5.2.7]:
P-CSCF address request:
Requirement: ISIM Service n°1 and/or ISIM Service n°5 \"available\".
Request: The ME performs the reading procedure with EF~P-CSCF~.
##### Reference(s) {#references-3 .H6}
3GPP TS 24.229[11], clauses B.2.2.1 and L.2.2.1.
3GPP TS 31.103[4], clauses 4.2.8 and 5.2.7.
### 7.1.3 Test purpose
To verify that the UE is able to discover the P-CSCF address from ISIM if the
UE is roaming and the UE is configured to discover the P-CSCF from the home
network.
### 7.1.4 References to existing tests
[3GPP TS 34.229 clause 7.9.4]:
##### Initial conditions {#initial-conditions .H6}
...
UE is equipped with a UICC that contains ISIM application. ISIM contains the
address of P-CSCF within home network. UE has either EPS bearer context or
GPRS PDP context activated .Within the context activation messaging from the
SS the UE is supplied with a P-CSCF address different from the one that is
found in the ISIM.
...
##### Test procedure {#test-procedure .H6}
1) IMS registration is initiated on the UE. Consequently the UE discovers the
P-CSCF address from ISIM and sends an initial SIP REGISTER request to the
discovered P-CSCF.
...
### 7.1.5 Recommendations
The test as specified in TS 34.229[8] clause 7.9 is not sufficient to ensure
that the P-CSCF address
  * is read from the ISIM, as information could have been present in the terminal,
  * information that is read from the ISIM, is the information used by the terminal as information could have been present in the terminal,
  * is read and used only when service n°5 of ISIM Service Table indicates the service is available.
It is proposed to use the test as specified in TS 34.229[8] clause 7.9, while
the test procedure could
> \- Provide additional scenario to set and reset the value of service n°5 of
> the ISIM Service Table, to verify that the terminal uses the information
> from the ISIM accordingly to TS 31.103[4] clauses 4.2.8 and 5.2.7.
>
> \- use a probe between the UICC and the terminal to verify that the
> information is read from the ISIM
>
> \- provide a test scenario where as the content of the tested information is
> changed in the ISIM, and verify that the new value of the ISIM is read and
> used in the test case.
## 7.2 Use of ISIM for IMS initial registration
### 7.2.1 Definition and applicability
Test to verify that the UE can correctly register to IMS services when
equipped with UICC that contains both ISIM and USIM applications. The process
consists of sending initial registration to S-CSCF via the P-CSCF discovered,
authenticating the user and finally subscribing the registration event package
for the registered default public user identity. The test case is applicable
for IMS security.
### 7.2.2 Conformance requirement
[TS 24.229, clause C.2]:
In case the UE is loaded with a UICC that contains a USIM but does not contain
an ISIM, the UE shall:
\- generate a private user identity;
\- generate a temporary public user identity; and
\- generate a home network domain name to address the SIP REGISTER request to.
All these three parameters are derived from the IMSI parameter in the USIM,
according to the procedures described in 3GPP TS 23.003. Also in this case,
the UE shall derive new values every time the UICC is changed, and shall
discard existing values if the UICC is removed.
NOTE: If there is an ISIM and a USIM on a UICC, the ISIM is used for
authentication to the IM CN subsystem, as described in 3GPP TS 33.203. See
also subclause 5.1.1.1A.
[TS 24.229, clause 5.1.1.1A]:
The ISIM shall always be used for authentication to the IM CN subsystem, if it
is present, as described in 3GPP TS 33.203.
The ISIM is preconfigured with all the necessary parameters to initiate the
registration to the IM CN subsystem. These parameters include:
\- the private user identity;
\- one or more public user identities; and
\- the home network domain name used to address the SIP REGISTER request
The first public user identity in the list stored in the ISIM is used in
emergency registration requests.
In case the UE does not contain an ISIM, the UE shall:
\- generate a private user identity;
\- generate a temporary public user identity; and
\- generate a home network domain name to address the SIP REGISTER request to;
in accordance with the procedures in clause C.2.
The temporary public user identity is only used in REGISTER requests, i.e.
initial registration, re-registration, mobile-initiated deregistration.
The UE shall not reveal to the user the temporary public user identity if the
temporary public user identity is barred. The temporary public user identity
is not barred if received by the UE in the P-Associated-URI header.
If the UE is unable to derive the parameters in this subclause for any reason,
then the UE shall not proceed with the request associated with the use of
these parameters and will not be able to register to the IM CN subsystem.
##### Reference(s) {#references-4 .H6}
3GPP TS 24.229[11], clauses 5.1.1.1A, and C.2.
### 7.2.3 Test purpose
To verify that UE correctly uses the private user identity, a temporary public
user identity and the home network domain name retrieved from ISIM.
### 7.2.4 References to existing tests
[3GPP TS 34.229 clause 8.1.4]:
##### Initial conditions {#initial-conditions-1 .H6}
UE contains either ISIM and USIM applications or only USIM application on
UICC. UE is not registered to IMS services, but has performed the generic test
procedure in Annex C.2 up to step 3.
...
##### Test procedure {#test-procedure-1 .H6}
1) IMS registration is initiated on the UE. SS waits for the UE to send an
initial REGISTER request.
...
### 7.2.5 Recommendations
The test as specified in TS 34.229[8] clause 8.1 is not sufficient (due to
initial conditions) to ensure that the ISIM registration information is used
i.e. IMPI, IMPU and home domain network name stored in EF~IMPI~, EF~IMPU~ and
EF~DOMAIN~ of the ISIM respectively.
It is proposed to use the test as specified in TS 34.229[8] clause 8.1, and it
could additionally be verified in the test procedure that the IMPI, IMPU and
home domain network name are read from EF~IMPI~, EF~IMPU~ and EF~DOMAIN~ of
the ISIM respectively.
It is recommended to:
\- Ensure that the information in EF~IMPI~, EF~IMPU~ and EF~DOMAIN~ of the
ISIM is different from IMPU, IMPI and Home Domain Name that are generated from
USIM information.
\- use a probe between the UICC and the terminal to verify that the
information is read from the ISIM
\- provide a test scenario where as the content of the tested information is
changed in the ISIM, and verify that the new value of the ISIM is read and
used in the test scenario.
## 7.3 Initial Registration for three implicit registration sets
### 7.3.1 Definition and applicability
Test to verify that the UE can correctly register to IMS services when
equipped with UICC that contains ISIM application with multiple IMS public
user identities (IMPU) belonging to three different implicit registration
sets. Test case verifies that the UE is able to register the registration sets
on parallel. The test case is applicable for IMS security.
### 7.3.2 Conformance requirement
[TS 24.229, clause 5.1.1.1A]:
The ISIM shall always be used for authentication to the IM CN subsystem, if it
is present, as described in 3GPP TS 33.203.
The ISIM is preconfigured with all the necessary parameters to initiate the
registration to the IM CN subsystem. These parameters include:
\- the private user identity;
\- one or more public user identities; and
\- the home network domain name used to address the SIP REGISTER request
The first public user identity in the list stored in the ISIM is used in
emergency registration requests.
[TS 24.229, clause 5.1.1.2.1]:
The initial registration procedure consists of the UE sending an unprotected
REGISTER request and, if challenged depending on the security mechanism
supported for this UE, sending the integrity-protected REGISTER request or
other appropriate response to the challenge. The UE can register a public user
identity with any of its contact addresses at any time after it has acquired
an IP address, discovered a P-CSCF, and established an IP-CAN bearer that can
be used for SIP signalling. However, the UE shall only initiate a new
registration procedure when it has received a final response from the
registrar for the ongoing registration, or the previous REGISTER request has
timed out.
##### Reference(s) {#references-5 .H6}
3GPP TS 24.229[11], clauses 5.1.1.1A and 5.1.1.2.1
### 7.3.3 Test purpose
1) To verify that UE is able to register three different IMS public user
identities (IMPU), as found from ISIM, belonging to three different implicit
registration sets.
### 7.3.4 References to existing tests
[3GPP TS 34.229 clause 8.14.4]:
##### Initial conditions {#initial-conditions-2 .H6}
...
UE is equipped with a UICC that contains both ISIM and USIM applications. UE
is not registered to IMS services, but has an active PDP context/ established
EPS default bearer context and has discovered the SS as P-CSCF by executing
the generic test procedure in Annex C.2 up to step 3.
##### Related ICS/IXIT Statement(s) {#related-icsixit-statements .H6}
\- UE supports IPSec ESP confidentiality protection (Yes/No)
\- IMS security (Yes/No)
\- obtaining and using GRUUs in the Session Initiation Protocol (SIP) (Yes/No)
\- UE supports MTSI (Yes/No)
\- UE supports automatic consecutive registration of multiple SIP URI IMPUs
stored on the ISIM (belonging to separate implicit registration sets) (Yes/No)
\- UE supports manual registration of multiple SIP URIs IMPUs stored on the
ISIM (belonging to separate implicit registration sets) (Yes/No)
##### Test procedure {#test-procedure-2 .H6}
1) If the UE supports automatic consecutive registration of multiple SIP URI
IMPUs the UE is made to register all implicit registration sets for the IMPUs
found on ISIM otherwise if the UE supports manual registration of multiple SIP
URIs IMPUs the UE is triggered to register one of the SIP URI IMPUs.
2) The UE executes the procedures of annex C.2 for context activation and
subsequent IMS registration. The registration event sent by the SS indicates
only that IMPU to have been registered, which was explicitly registered by the
UE.
3) If the UE does not support automatic consecutive registration of multiple
SIP URI IMPUs and supports manual registration of multiple SIP URIsIMPUs the
UE is triggered to register another SIP URI IMPU.
4) The UE initiates another registration procedure of annex C.23, in order to
register a second implicit registration set. The registration event sent by
the SS indicates the rest of the two IMPUs within ISIM to have been
registered.
5) If the UE does not support automatic consecutive registration of multiple
SIP URI IMPUs and supports manual registration of multiple SIP URIs IMPUs the
UE is triggered to register a third SIP URI IMPU.
6) The UE initiates a third registration procedure of annex C.23, in order to
register a third implicit registration set. The registration event sent by the
SS indicates all the three IMPUs within ISIM to have been registered.
...
### Recommendations
The test as specified in 3GPP TS 34.229[8] clause 8.14 is not sufficient to
ensure that the UE is able to register three different IMS public user
identities (IMPU), as found from ISIM, belonging to three different implicit
registration sets, as the information could have been present in the terminal
prior to the test e.g. from previous tests,
It is proposed to use the test as specified in TS 34.229[8] clause 8.14, while
it is recommended that the test procedure:
> \- uses a probe between the UICC and the terminal to verify that the
> information is read from the ISIM
>
> \- provides a test scenario whereas the content of the tested information is
> changed in the ISIM, and verify that the new value of the ISIM is read and
> used in the test scenario.
## 7.4 Refresh for ISIM parameters
### 7.4.1 Definition and applicability
Test to verify that the when ISIM parameter values have been updated the UE
will use the new values when registering to IMS the next time.
### 7.4.2 Conformance requirement
[TS 24.229 Annex C.4]:
The 3GPP TS 31.102 and 3GPP TS 31.103 specify the file structure and contents
for the preconfigured parameters stored on the USIM and ISIM, respectively,
necessary to initiate the registration to the IM CN subsystem. Any of these
parameters can be updated via Data Download or a USAT application, as
described in 3GPP TS 31.111. If one or more EFs are changed and a REFRESH
command is issued by the UICC, then the UE reads the updated parameters from
the UICC as specified for the REFRESH command in 3GPP TS 31.111.
In case of changes to EFs, the UE is not required to perform deregistration
but it shall wait for the network-initiated deregistration procedures to occur
as described in subclause 5.4.1.5 unless the user initiates deregistration
procedures as described in subclause 5.1.1.6. From this point onwards the
normal initial registration procedures can occur.
[TS 24.229 clause 5.1.1.7]:
Upon receipt of a NOTIFY request on any dialog which was generated during
subscription to the reg event package as described in subclause 5.1.1.3,
including one or more \ element(s) which were registered by this
UE with:
\- the state attribute set to \"terminated\" and the event attribute within
the \ element belonging to this UE set to \"rejected\" or
\"deactivated\"; or
\- the state attribute set to \"active\" and within the \ element
belonging to this UE, the state attribute set to \"terminated\" and the
associated event attribute set to \"rejected\" or \"deactivated\";
the UE shall remove all registration details relating to these public user
identities. In case of a \"deactivated\" event attribute, the UE shall start
the initial registration procedure as described in subclause 5.1.1.2.
##### Reference(s) {#references-6 .H6}
3GPP TS 24.229[11], clause 5.1.1.7, annex C.4 (release 10)
### 7.4.3 Test purpose
1) To verify that the update of ISIM parameters related to IMS registration
(and consequent REFRESH command) does not cause the UE to immediately
deregister from IMS; and
2) To verify that the UE uses the updated parameter values from ISIM when
registering to IMS again after the network initiated deregistration procedure
### 7.4.4 References to existing tests
[3GPP TS 34.229 clause 8.15.4]:
##### Initial conditions {#initial-conditions-3 .H6}
SS is configured with the old and new home domain name, public and private
user identities (including the public emergency user identity allocated for
the user) together with the shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) that is configured on the UICC card
equipped into the UE. SS is listening to SIP default port 5060 for both UDP
and TCP protocols. SS is able to perform AKAv1-MD5 authentication algorithm
for that IMPI, according to 3GPP TS 33.203 clause 6.1 and RFC 3310.
UE is equipped with a UICC that contains both ISIM and USIM applications. UE
is registered to IMS services, by executing the generic test procedure in
Annex C.2 up to the last step. The Request-URI of SIP REGISTER request sent by
the UE contained the old home domain name and IMS identities as found from
ISIM.
##### Related ICS/IXIT Statement(s) {#related-icsixit-statements-1 .H6}
\- IMS security (Yes/No)
##### Test procedure {#test-procedure-3 .H6}
1) The UICC is made to send a REFRESH command to the UE indicating that
contents of ISIM has been updated.
NOTE: The specific way to trigger the REFRESH command is a test implementation
option.
2) 10 seconds after step 1 SS sends a SIP NOTIFY request in order to terminate
the IMS registration.
3) UE responds the NOTIFY request with 200 OK response.
4) UE initiates a new IMS registration sequence. For SIP REGISTER request the
UE uses the new values of home domain name and/or IMS identities as provided
by ISIM after the update.
...
### 7.4.5 Recommendations
The test as specified in 3GPP TS 34.229[8] clause 8.15 is sufficient:
1) To verify that the update of ISIM parameters related to IMS registration
(and consequent REFRESH command) does not cause the UE to immediately
deregister from IMS; and
2) To verify that the UE uses the updated parameter values from ISIM when
registering to IMS again after the network initiated deregistration procedure
It is recommended to:
\- Use the test as specified in 3GPP TS 34.229[8] clause 8.15 to test the
conformance of the feature
\- Ensure that the information in EF~IMPI~, EF~IMPU~ and EF~DOMAIN~ of the
ISIM is different from IMPU, IMPI and Home Domain Name that are generated from
USIM information.
# 8 SMS-Over-IP related tests
## 8.1 Correct storage of an SM on the UICC
### 8.1.1 Definition and applicability
[TS 31.121 clause 8.2.4.1]:
For IMS: When a SIP MESSAGE request including a short message in the
\"vnd.3gpp.sms\" payload is delivered and the extracted RP-DATA payload
contains a Class 2 SM (USIM specific SM) the terminal shall store the SM on
the USIM or ISIM. For this it is assumed, that at least one relevant SMS field
are available on the USIM or ISIM and they are indicated as empty.
That the UE correctly implemented the role of an SMS-over-IP receiver is
tested in clause 18.2 of TS 34.229­1 [8].
### 8.1.2 Conformance requirement
[TS 31.121 clause 8.2.4.2]:
As TS 31.103[4] and TS 31.102[3] do not indicate in which of both applications
a SM received via IMS shall be stored, the received Class 2 SM received via
IMS shall be stored in EF~SMS~ either on the USIM or on the ISIM. The status
of a received SMS, which has not been read yet, shall be set to \"3\" (SMS to
be read).
\- TS 23.038, clause 4.
\- TS 23.040, subclause 10.1, operation 6;
\- TS 24.011, subclauses 7.3.1.1, 8.2.2, 8.2.3 and 8.2.5.4, Table 8.4 (part 2)
\- TS 31.102 [3], subclauses 4.2.25,
\- TS 31.103 [4], subclauses 4.2.12,
\- TS 34.229 [8], Annexes C.2, C.18 and 18.2.
### 8.1.3 Test purpose
1) To verify that the Terminal stored correctly the class 2 SMS on the USIM or
the ISIM.
2) To verify that the Terminal sets the status of a received, and not yet read
SMS to \"3\" (SMS to be read).
### 8.1.4 References to existing tests
Reference 3GPP TS 31.121[5] clause 8.2.4.
### 8.1.5 Recommendations
The tests specified in 3GPP TS 31.121[5] clause 8.2.4 are sufficient:
1) To verify that the Terminal stored correctly the class 2 SMS on the USIM or
the ISIM.
2) To verify that the Terminal sets the status of a received, and not yet read
SMS to \"3\" (SMS to be read).
## 8.2 Correct reading of a SM on the ISIM
### 8.2.1 Definition and applicability
A SM which is stored but not yet read, is indicated as Status \"3\" (SMS to be
read) on EF~SMS~. The Terminal may indicate the user this status. After the
SMS is read by the user, the status of the SMS shall be changed to \"1\" (SMS
read). This applies to short messages stored on the USIM and to short messages
stored on the ISIM.
### 8.2.2 Conformance requirement
A received SM was stored in EF~SMS~ on the ISIM and another SM was stored in
EF~SMS~ on the USIM. The user shall be able to read short messages stored on
the ISIM. At the time the SMS is read by the user, the status of a received
SMS, shall be changed to \"1\" (SMS read).
\- TS 23.038, clause 4.
\- TS 23.040;
\- TS 31.102 [3], subclauses 4.2.25 and 4.2.28,
\- TS 31.103 [4], subclauses 4.2.12 and 4.2.13.
### 8.2.3 Test purpose
1) To verify that the Terminal correctly reads the SMS on the ISIM if the USIM
and ISIM are both present.
2) To verify that the Terminal changes the status of a read SMS to \"1\" (SMS
read) of the message read from the ISIM.
### 8.2.4 References to existing tests
Reference 3GPP TS 31.121[5] clause 8.2.6.
### 8.2.5 Recommendations
The test specified in 3GPP TS 31.121[5] clause 8.2.6 is sufficient:
1) To verify that the Terminal correctly reads the SMS on the ISIM if the USIM
and ISIM are both present.
2) To verify that the Terminal changes the status of a read SMS to \"1\" (SMS
read) of the message read from the ISIM.
It is recommended to use the referenced tests to verify the conformance of the
feature.
## 8.3 Mobile Originating SMS over IMS
### 8.3.1 Definition and applicability
Test to verify that the UE is able to send a Mobile Originating SMS over IMS
and to receive a status report. The test case is applicable for IMS security
or early IMS security.
### 8.3.2 Conformance requirement
[TS 24.341, clause 5.3.1.2]:
When an SM-over-IP sender wants to submit an SM over IP, the SM-over-IP sender
shall send a SIP MESSAGE request with the following information:
a) the Request-URI, which shall contain the PSI of the SC of the SM-over-IP
sender;
NOTE 1: The PSI of the SC can be SIP URI or tel URI based on operator policy.
The PSI of the SC can be obtained using one of the following methods in the
priority order listed below:
1) provided by the user;
2) if UICC is used, then:
\- if present in the ISIM, then the PSI of the SC is obtained from the
EF~PSISMSC~ in DF_TELECOM of the ISIM as per 3GPP TS 31.103 [4];
\- if not present on the ISIM, then the PSI of the SC is obtained from the
EF~PSISMSC~ in DF_TELECOM of the USIM as per 3GPP TS 31.102 [3]; or
\- if neither present on the ISIM nor on the USIM, then the PSI of the SC
contains the **_TS‑Service-Centre-Address_** stored in the EF~SMSP~ in
DF_TELECOM as per 3GPP TS 31.102 [3]. If the PSI of the SC is based on the
E.164 number from the **_TS‑Service-Centre-Address_** stored in the EF~SMSP~
in DF_TELECOM then the URI constructed can be either a tel URI or a SIP URI
(using the \"user=phone\" SIP URI parameter format).
3) if SIM is used instead of UICC, then the PSI of the SC contains the
**_TS‑Service Centre Address_** stored in the EF~SMSP~ in DF_TELECOM as per
3GPP TS 51.011 [20]. If the PSI of the SC is based on the E.164 number from
the **_TS‑Service-Centre-Address_** stored in the EF~SMSP~ in DF_TELECOM then
the URI constructed can be either a tel URI or a SIP URI (using the
\"user=phone\" SIP URI parameter format); or
4) if neither the UICC nor SIM is used, then how the PSI of the SC is
configured and obtained is through means outside the scope of this
specification.
b) the From header, which shall contain a public user identity of the SM-over-
IP sender;
NOTE 2: The IP-SM-GW will have to use an address of the SM-over-IP sender that
the SC can process (i.e. an E.164 number). This address will come from a tel
URI in a P-Asserted-Identity header (as defined in RFC 3325) placed in the SIP
MESSAGE request by the P-CSCF or S-CSCF.
NOTE 3: The SM-over-IP sender has to store the Call-ID of the SIP MESSAGE
request, so it can associate the appropriate SIP MESSAGE request including a
submit report with it.
c) the To header, which shall contain the SC of the SM-over-IP sender;
d) the Content-Type header, which shall contain \"application/vnd.3gpp.sms\";
and
e) the body of the request shall contain an RP-DATA message as defined in 3GPP
TS 24.011, including the SMS headers and the SMS user information encoded as
specified in 3GPP TS 23.040.
NOTE 4: The address of the SC is included in the RP-DATA message content. The
address of the SC included in the RP-DATA message content is stored in the
EF~SMSP~ in DF_TELECOM of the (U)SIM of the SM-over-IP sender.
NOTE 5: The SM-over-IP sender will use content transfer encoding of type
\"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.
NOTE 6: Both the address of the SC and the PSI of the SC can be configured in
the EF~PSISMSC~ in DF_TELECOM of the USIM and ISIM respectively using the USAT
as per 3GPP TS 31.111.
The SM-over-IP sender may request the SC to return the status of the submitted
message. The support of status report capabilities is optional for the SC.
When a SIP MESSAGE request including a submit report in the \"vnd.3gpp.sms\"
payload is received, the SM-over-IP sender shall:
\- if SM-over-IP sender supports In-Reply-To header usage and the In-Reply-To
header indicates that the request corresponds to a short message submitted by
the SM-over-IP sender, generate a 200 (OK) SIP response according to RFC 3428.
if SM-over-IP sender supports In-Reply-To header usage and the In-Reply-To
header indicates that the request does not correspond to a short message
submitted by the SM-over-IP sender, a 488 (Not Acceptable here) SIP response
according to RFC 3428.
\- if SM-over-IP sender does not support In-Reply-To header usage, generate a
200 (OK) SIP response according to RFC 3428; and extract the payload encoded
according to 3GPP TS 24.011 for RP-ACK or RP-ERROR.
[TS 24.341 clause 5.3.1.3]:
When a SIP MESSAGE request including a status report in the \"vnd.3gpp.sms\"
payload is delivered, the SM-over-IP sender shall:
\- generate a SIP response according to RFC 3428;
\- extract the payload encoded according to 3GPP TS 24.011 for RP-DATA; and
\- create a delivery report for the status report as described in subclause
5.3.2.4. The content of the delivery report is defined in 3GPP TS 24.011.
[TS 24.341 clause 5.3.2.4]:
When an SM-over-IP receiver wants to send an SM delivery report over IP, the
SM-over-IP receiver shall send a SIP MESSAGE request with the following
information:
a) the Request-URI, which shall contain the IP-SM-GW;
NOTE 1: The address of the IP-SM-GW is received in the P-Asserted-Identity
header in the SIP MESSAGE request including the delivered short message.
b) the From header, which shall contain a public user identity of the SM-over-
IP receiver.
c) the To header, which shall contain the IP-SM-GW;
b) the Content-Type header shall contain \"application/vnd.3gpp.sms\"; and
c) the body of the request shall contain the RP-ACK or RP-ERROR message for
the SM delivery report, as defined in 3GPP TS 24.011.
NOTE 2: The SM-over-IP sender will use content transfer encoding of type
\"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.
##### Reference(s) {#references-7 .H6}
3GPP TS 24.341, clauses 5.3.1.2, 5.3.1.3 and 5.3.2.4.
### 8.3.3 Test purpose
1) To verify that the PSI of the SC is obtained from the EF~PSISMSC~ in
DF_TELECOM of the ISIM.
### 8.3.4 References to existing tests
[3GPP TS 34.229 clause 18.1.4]:
##### Initial conditions {#initial-conditions-4 .H6}
UE contains either ISIM and USIM applications or only USIM application on
UICC. UE has activated a PDP context, discovered P-CSCF, and registered to IMS
services.
SS is configured with the shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE. SS has performed AKAv1-MD5 authentication with the UE and accepted the
registration.
##### Related ICS/IXIT Statement(s) {#related-icsixit-statements-2 .H6}
Support for initiating a session (Yes/No)
IMS security (Yes/No)
Early IMS security (Yes/No)
Support for MO SMS over IMS (Yes/No)
##### Test procedure {#test-procedure-4 .H6}
1) Sending of a Mobile Originating SMS over IMS is initiated at the UE. The SS
waits for the UE to send a SIP MESSAGE request including a vnd.3gpp.sms
payload that contains the short message.
2) The SS responds to the SIP MESSAGE request with a 202 Accepted response.
3) The SS sends a SIP MESSAGE request to the UE including a vnd.3gpp.sms
payload that contains a short message submission report indicating a positive
acknowledgement of the short message sent by the UE at Step 1).
4) The SS waits for the UE to respond to the SIP MESSAGE request with a 200 OK
response.
5) The SS sends a SIP MESSAGE request to the UE including a vnd.3gpp.sms
payload that contains a status report.
6) The SS waits for the UE to respond to the SIP MESSAGE request with a 200 OK
response.
7) The SS waits for the UE to send a SIP MESSAGE request including a
vnd.3gpp.sms payload that contains a delivery report for the status report
received at Step 5).
8) The SS responds to the SIP MESSAGE request with a 202 Accepted response.
...
### 8.3.5 Recommendations
The test as specified in TS 34.229[8] clause 18.1 is not sufficient (due to
initial conditions) to ensure that the PSI of the SC obtained from the
EF~PSISMSC~ in DF_TELECOM of the ISIM as per 3GPP TS 31.103 [4] is used.
It is proposed to use the test as specified in TS 34.229[8] clause 18.1, while
the test procedure shall explicitly ensure that the PSI of the SC is obtained
from the EF~PSISMSC~ in DF_TELECOM of the ISIM.
Thus, it is proposed to use the test as specified in TS 34.229[8] clause 18.1,
while the test procedure could
> \- use a probe between the UICC and the terminal to verify that the
> information is read from the ISIM
>
> \- provide an additional test scenario whereas the content of the tested
> information EF~PSISMSC~ in DF_TELECOM of the ISIM is changed, and verify
> that the new value of the ISIM is read and used in the test case.
# 9 UICC access to IMS with ISIM
## 9.1 User-initiated registration with list of IARIs from ISIM
### 9.1.1 Definition and applicability
A list of IARIs associated with active applications installed on the UICC, is
stored in EF~UICCIARI~ file in the ISIM.
The test verifies that the UE includes in the REGISTER request the list of
IARIs contained in EF~UICCIARI~ from ISIM when performing the user-initiated
registration procedure.
This test is applicable for UE that supports the UICC access to IMS USAT
feature as defined in 3GPP TS 31.111.
Applicability see 3GPP TS 31.124 clause 3.2.
### 9.1.2 Conformance requirement
[TS 24.229 clause C.3A]:
If the UE supports the UICC access to IMS USAT feature defined in 3GPP TS
31.111 the following procedures in addition to the UE procedures in this
specification apply.
If the EF~UICCIARI~ contains a list of IARIs associated with active
applications installed on the UICC in either the USIM or the ISIM, then when
performing the user-initiated registration procedure as described in subclause
5.1.1.2 the UE shall include in the REGISTER request the list of IARIs
associated with active applications installed on the UICC in addition to any
IARI values for active applications installed on the ME in g.3gpp.iari-ref
media feature tag(s) in the Contact header field of the REGISTER request as
defined in subclause 7.9.3 and RFC 3840.
If the UE receives from the UICC an initial request for a dialog or a
standalone transaction then after decapsulating the request as specified in
3GPP TS 31.111 the UE shall send the request to the IM CN subsystem as
specified in subclause 5.1.2A. When the UE receives from the UICC subsequent
requests or responses related to dialogs or transactions already established
for UICC applications then after decapsulating the request or response as
specified in 3GPP TS 31.111 [15D] the UE shall send the request or response to
the IM CN subsystem as specified in subclause 5.1.2A.
NOTE: The encapsulated requests and responses transferred between the UICC and
UE are complete and valid SIP requests and responses compliant with RFC 3261.
When sending requests or responses received from the UICC to the IM CN
subsystem the UE shall modify or include any header fields necessary (such as
Route, Via, Contact) in order to conform with the procedures in this
specification.
[TS 31.103 clause 4.2.16]:
As specified in TS 24.229 [11] a ME includes the list of IARIs for the IMS
applications it intends to use when sending an initial registration or when
sending subsequent registrations to the IMS in the form of a SIP REGISTER
request.
This EF contains a list of IARIs associated with active applications installed
on the UICC that are included in the SIP REGISTER request in accordance with
the procedures of TS 24.229 [11].
NOTE: If this file is present in both the USIM and the ISIM, the file in the
ISIM is used. It is assumed that the presence of this file in the USIM when an
ISIM is present on the UICC is an incorrect configuration of the UICC.
The procedures and command for \"UICC access to IMS\" are defined in TS
31.111. An ME supporting UICC access to IMS shall perform the reading
procedure with EF~UICCIARI~ prior to sending a registration to the IMS.
Reference(s)
3GPP TS 24.229, clause C.3A.
3GPP TS 31.103, clauses 4.2.16 and 5.3.3.
### 9.1.3 Test purpose
To verify that the UE includes in the REGISTER request the list of IARIs
contained in EF~UICCIARI~ in the ISIM when performing the user-initiated
registration procedure.
### 9.1.4 References to existing tests
[TS 31.124 clause 27.22.7.20]:
Initial conditions:
The ME is connected to the USIM Simulator and the Network Simulator (NWS).
The ME shall be powered on and perform the PROFILE DOWNLOAD procedure.
The ME activates the required bearer, discovers P-CSCF and registers with the
value from the ISIM to IMS services. The ME has registered the IARI associated
with active applications installed on the UICC, stored in EF_UICCIARI on the
ISIM.
The channel identifier value used for these tests is set to 1 as an example.
This channel identifier is dependent on the ME's default channel identifier as
declared in table A.2/27.
The E-UTRAN/EPC ISIM-UICC with the following exceptions is used:
**EF~IST~ (ISIM Service Table)**
EF**~IST~** shall be configured as defined in 27.22.2C.3.2 with the exception
that Service 10 \"Support of UICC access to IMS\" is available.
**EF~UICCIARI~ (UICC IARI list)**
Record 1 :
Logically: urn:ur-7:3gpp-application.ims.iari.uicctest
* * *
Byte: B01 B02 B03 B04 B05 B06 B07 B08 B09 B10 Coding: 80 2B 75 72 6E 3A 75 72
2D 37 B11 B12 B13 B14 B15 B16 B17 B18 B19 B20 3A 33 67 70 70 2D 61 70 70 6C
B21 B22 B23 B24 B25 B26 B27 B28 B29 B30 69 63 61 74 69 6F 6E 2E 69 6D B31 B32
B33 B34 B35 B36 B37 B38 B39 B40 73 2E 69 61 72 69 2E 75 69 63 B41 B42 B43 B44
B45 B46 B47 B48 B49 B50 63 74 65 73 74 FF FF FF FF FF
* * *
...
### 9.1.5 Recommendations
The test purpose is covered implicitly by the test to verify the correct
support of Incoming IMS data with list of IARIs in ISIM as specified in 3GPP
TS 31.124 clause 27.22.7.20.
It is assumed that the test on Incoming IMS data with list of IARIs in ISIM
requires correct registration of the IARIs associated with active applications
installed on the UICC.
## 9.2 Incoming IMS data with list of IARIs in ISIM
### 9.2.1 Definition and applicability
The test verifies that the ME informs the UICC that an Event: Incoming IMS
data has occurred using the ENVELOPE (EVENT DOWNLOAD -- Incoming IMS data)
command when the ME received a SIP message for the card, including an UICC
IARI.
Applicability see 3GPP TS 31.124 clause 3.2.2.
### 9.2.2 Conformance requirement
The ME shall support:
  * the EVENT Incoming IMS DATA as defined in:
\- TS 31.111 [15] clause 4.7, clause 5.2, clause 6.4.16, clause 7.5, clause
8.7, clause 8.25, clause 8.110.
  * the EVENT: IMS Registration as defined in:
  * \- TS 31.111 [15] clause 4.7, clause 5.2, clause 6.4.16, clause 7.5, clause 8.7, clause 8.25, clause 8.111, clause 8.112.the EVENT: Data available as defined in:
> \- TS 31.111 [15] clause 4.7, clause 5.2, clause 6.4.16, clause 7.5, clause
> 8.7, clause 8.25, clause 8.56, clause 8.57.
  * the Open Channel for IMS and Event Download -- IMS Registration Event commands as defined in:
> \- TS 31.111[15] clauses 5.2, clauses 6.4.27 and 6.6.27, clause 8.6, clause
> 8.7, clause 8.55, clause 8.110
>
> \- TS 31.102 [14] clauses 4.2.8, 4.2.95
The ME shall support the EF~UICCIARI~ reading procedure as defined in:
\- TS 31.103 [35] clause 4.2.16
Additionally the ME shall be able to carry out the IMS registration procedure
according to TS 34.229-1 [36], Annex C.2.
### 9.2.3 Test purpose
To verify that the ME informs the UICC that an Event: Incoming IMS data has
occurred using the ENVELOPE (EVENT DOWNLOAD -- Incoming IMS data) command when
the ME received a SIP message for the card, including an UICC IARI.
### 9.2.4 References to existing tests
3GPP TS 31.124 clause 27.22.7.20.
### 9.2.5 Recommendations
The test as specified in 3GPP TS 31.124 clause 27.22.7.20 is sufficient to
cover the test purpose relative to Incoming IMS data with list of IARIs in
ISIM.
It is recommended to use the referenced tests to verify the conformance of the
feature.
# 10 Conclusion
## 10.1 Coverage of the document
The present document has listed the conformance requirements extracted from TS
31.103[4]. This technical has found gaps in the existing tests and provided
subsequent recommendations to verify the conformance of Terminals with
features for the ISIM application.
The conformance requirement recommendations in this document:
  * ensure that content of the ISIM when available is read and used by the ME;
  * reuse existing test specifications in 3GPP i.e. TS 31.121[5], TS 31.124[6] and TS 34.229[8];
  * provide recommendations when necessary to fulfil the test purpose.
Conformance to GBA procedures as defined in TS 31.103[4] has not been
addressed in this document.
## 10.2 Test coverage
Generally, the test scenario as specified in TS 34.229[8] cannot ensure that
the information actually comes from the ISIM.
For the tests relative to the ISIM specified in TS 34.229[8], in order to
ensure a complete test coverage:
  * the test scenario could be performed with a probe on the interface between the terminal and the UICC, to verify the information is read from the ISIM, and in order to ensure that the reading procedure is performed by the terminal.
  * test sequences could be modifed whereas the information in the ISIM is modified, and which ensure that the new information in the ISIM is used by the terminal.
The following table provides test coverage and specific recommendations.
* * *
Description **Section** **Test purpose coverage** **Specific Recommendations**
ISIM Application Selection 5 Implicitly covered It is recommended to use a
probe between the terminal and the UICC to verify the conformance of the ISIM
application selection procedure. ISIM Initialization 6 Implicitly covered It
is recommended to use a probe between the terminal and the UICC to verify the
conformance of the ISIM initialization procedure. P-CSCF discovery from ISIM
7.1 Partially covered It is proposed to use the test as specified in TS
34.229[8] clause 7.9, while the test procedure shall explicitly indicate that
the P-CSCF address is read only if service n°5 of the ISIM Service Table is
available i.e. by setting/resetting the value of service n°5 of the ISIM
Service Table and verify the behaviour of the terminal accordingly. Use of
ISIM for IMS initial registration 7.2 Partially covered It is proposed to use
the test as specified in TS 34.229[8] clause 8.1, and it could additionally be
verified in the test procedure that the IMPI, IMPU and home domain network
name are read from EF~IMPI~, EF~IMPU~ and EF~DOMAIN~ of the ISIM
respectively.: It is recommended that the information in EF~IMPI~, EF~IMPU~
and EF~DOMAIN~ of the ISIM be different from IMPU, IMPI and Home Domain Name
generated from USIM information. Initial Registration for three implicit
registration sets 7.3 Partially covered It is proposed to use the test as
specified in 3GPP TS 34.229[8] clause 8.14 Refresh for ISIM parameters 7.4
Partially covered It is proposed to use the test as specified in 3GPP TS
34.229[8] clause 8.15 Correct storage of an SM on the UICC 8.1 Covered It is
proposed to use the test as specified in 3GPP TS 31.121[5] clause 8.2.4
Correct reading of a SM on the ISIM if USIM and ISIM are present 8.2 Covered
It is proposed to use the test as specified in 3GPP TS 31.121[5] clause 8.2.6
Mobile Originating SMS over IMS 8.3 Partially covered It is proposed to use
the test as specified in TS 34.229[8] clause 18.1, while the test procedure
shall explicitly ensure that the PSI of the SC is obtained from the
EF~PSISMSC~ in DF_TELECOM of the ISIM. User-initiated registration with list
of IARIs from ISIM 9.1 Covered implicitly It is proposed to use the test as
specified in 3GPP TS 31.124 clause 27.22.7.20 Incoming IMS data, IMS
Registration and Data available event, IARI list stored on the ISIM 9.2
Covered It is proposed to use the test as specified in 3GPP TS 31.124 clause
27.22.7.20
* * *
# Annex A (informative): Change history
* * *
**Change history**  
**Date** **TSG #** **TSG Doc.** **CR** **Rev** **Subject/Comment** **Old**
**New**
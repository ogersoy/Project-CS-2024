# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document contains the outcome of the study on the charging
architecture for the one-to-many \"ProSe Direct Communication for ProSe-
enabled Public Safety UEs\".
The study covers the \"ProSe Direct Communication for Public Safety use\" as
specified in TS 23.303 [238], in order to meet the charging requirements
specified in TS 22.115 [101].
The present document makes recommendations for the following aspects of ProSe
Direct Communication for Public Safety use:
\- charging requirements and principles;
\- charging architecture and charging scenarios, with the support of delayed
reporting;
\- charging interfaces; and
\- recommendations to CT1 on UE reporting configuration and usage information
elements.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] - [51] Void.
[52] 3GPP TS 32.297: \"Telecommunication management; Charging management;
Charging Data Record (CDR) file format and transfer\".
[53] Void.
[54] 3GPP TS 32.295: \"Telecommunication management; Charging management;
Charging Data Record (CDR) transfer\".
[55] - [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[102] - [199] Void.
[200] - [237] Void.
[238] 3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".
[239] 3GPP TS 36.300: \" Evolved Universal Terrestrial Radio Access (E-UTRA)
and Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall
description; Stage 2\".
[240] 3GPP TS 33.303: \"Proximity-based Services (ProSe); Security aspects\".
[241] 3GPP TS 24.333: \"Proximity-services (ProSe) Management Objects (MO)\".
[242] 3GPP TS 32.277: \"Proximity-based Services (ProSe) charging\".
[243] - [299] Void.
[300] - [400] Void.
[401] IETF RFC 3588 (2003): \"Diameter Base Protocol\".
[402] - [499] Void.
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [100] and the following apply.\ A term defined in the present
document takes precedence over the definition of the same term, if any, in TR
21.905 [100].
**ProSe Direct Communication:** A communication between two or more UEs in
proximity that are ProSe-enabled, by means of user plane transmission using
E-UTRA technology via a path not traversing any network node. In this release
of the specification, the direct communication is only for public safety use.
**ProSe-enabled Public Safety UE:** A UE that the HPLMN has configured to be
authorized for Public Safety use, and which is ProSe-enabled and supports
ProSe procedures and capabilities specific to Public Safety. The UE may, but
need not, have a USIM with one of the special access classes {12, 13, 14}.
**ProSe Function:** The ProSe Function is the logical function that is used
for network related actions required for ProSe. The ProSe Function plays
different roles for each of the features of ProSe. In this version of the
specification it is assumed that there is only one logical ProSe Function in
each PLMN that supports Proximity Services.\ The ProSe Function contains three
main sub-functions: Direct Provisioning Function (DPF), Direct Discovery Name
Management Function, and EPC-level Discovery Function. The ProSe Function
provides the necessary charging functionality for usage of ProSe.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
PC3 Reference point between UE and the ProSe Function
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[100] and the following apply.\ An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in TR 21.905 [100].
DPF Direct Provisioning Function
ProSe Proximity-based Services
# 4 Architecture considerations
## 4.1 ProSe one-to-many Direct Communication scenarios and assumptions
### 4.1.1 ProSe one-to-many Direct Communication scenarios
ProSe one-to-many Direct Communication is a mode of communication whereby a
group of UEs can communicate with each other directly over the PC5 interface
defined in TS 23.303 [238]. This communication mode is supported when the UE
is served by E-UTRAN and when the UE is outside of E-UTRA coverage.
Table 4.1.1.1 shows scenarios for ProSe Direct Communication when UE1 and UE2
are located in-coverage /out-of-coverage of a cell. When UE A has a role of
transmission, UE A sends message and UE B receives it. UE A and UE B can
change their transmission and reception role. The transmission from UE A can
be received by one or more UEs like UE B.
Table 4.1.1.1: ProSe one-to-many Direct Communication scenarios
* * *
# Description UE A UE B Example 1A Out-of-Coverage Out-of-Coverage Out-of-
Coverage  
1B Partial-Coverage In-Coverage Out-of-Coverage  
1C In-Coverage-Single-Cell In-Coverage In-Coverage  
1D In-Coverage-Multi-Cell In-Coverage In-Coverage
* * *
Different types of Public Safety services are expected to be supported by the
ProSe one-to-many Direct Communication, e.g. voice, location, low speed data,
etc. Examples of the Public Safety use cases are presented in annex A.4 of TR
36.843 [239].
As indicated in clause 1 and clause 4.5.1.1.2.3.3 of TS 23.303 [238], ProSe
UE-to-Network Relays and one-to-one direct communication are not applicable in
Release 12.
For a configured UE, the ProSe one-to-many Direct Communication does not have
to involve the E-UTRAN.\ As specified in TS 23.303 [238], the UE uses the
network signalled resources for communication when it is served by E-UTRAN,
and uses the configured radio resources when not served by E-UTRAN.
Figure 4.1.1.1 illustrates the procedures involved in the transmission for the
ProSe Direct Communication.
Figure 4.1.1.1: One-to-many ProSe Direct Communication transmission
Figure 4.1.1.2 illustrated the procedures involved in the reception for the
ProSe Direct Communication.
Figure 4.1.1.2: One-to-many Direct Communication reception
It is noted that the group context (e.g. ProSe Layer 2 Group ID, Group IP
multicast address, Security material, etc.) is based on the configured
parameters. There is no specification in this release for dynamic group
formation and management.
### 4.1.2 ProSe one-to-many Direct Communication assumptions
In Release 12, One-to-many ProSe Direct Communication is applicable only to
ProSe-enabled Public Safety UEs, as indicated in clause 5.4.1 of TS 23.303
[238].
One-to-many ProSe Direct Communication has the following characteristics:
\- One-to-many ProSe Direct Communication is connectionless. Thus there is no
signalling over PC5 control plane.
\- There is no QoS support apart from priority handling.
\- The radio layer provides a user plane communication service for
transmission of IP packets between UEs engaged in direct communication.
\- Members of a group share a secret from which a group security key may be
derived to encrypt all user data for that group.
\- Authorization for one-to-many ProSe Direct Communication is configured in
the UE by the ProSe Function using PC3 reference point.
\- ProSe UE configuration parameters (e.g. including ProSe Group IP multicast
addresses, ProSe Group IDs, Group security material, radio related parameters)
are configured in the UE.
### 4.1.3 RAN aspects of ProSe one-to-many Direct Communication assumptions
According to working assumptions documented in TS 36.300 [239], following
assumptions are relevant to the ProSe one-to-many Direct Communication
charging:
\- Public Safety one-to-many D2D broadcast communication should be possible
irrespective of availability of infrastructure coverage.
\- It is assumed that one-to-many D2D broadcast communication should be
supported both on a dedicated carrier and on the same carrier as regular LTE.
\- When transmitting UEs are in-coverage, the UE may use eNB scheduled
resources (Mode 1) or UE autonomous selected resources (Mode 2) based one
configuration from eNB.\ The UE may use Mode 2 in coverage under exceptional
cases, e.g. fail to establish RRC connection, even if eNB configures it to use
Mode 1.
\- When transmitting UEs are out-of-coverage, the resources used for D2D
broadcast data are selected from a resource pool. The resource pool can be
pre-configured, or semi-statically configured.
\- No Access Stratum signalling is required for group formation and Group ID
allocation at access stratum level (Group IDs could e.g. be preconfigured or
configured via higher layers.
### 4.1.4 Requirements for ProSe one-to-many Direct Communication charging
support
TS 22.115 [101] requires that for the ProSe one-to-many Direct Communication,
the EPS should be able to collect charging data for this communication
including:
\- activation/deactivation, which is controlled by the service authorization
process defined in clause 5.2 of TS 23.303 [238];
\- initiation/termination, which is controlled by the public safety
application on the UE;
\- duration and amount of data transferred;
\- QoS, if via E-UTRAN (e.g. levels of availability, allocated resource);
\- inter-operator communication;
\- inter-operator signalling.
Following additional requirement considerations are derived based on
assumptions in clause 4.1.2 and clause 4.1.3:
\- QoS information does not apply to one-to-many Direct Communication, as the
communication is not going via E-UTRAN and there is no QoS support apart from
priority handling;
\- inter-operator signalling does not apply to one-to-many Direct
Communication, as there is no NAS signalling involved;
\- charging data collection mechanism should support the out-of-coverage one-
to-many Direct Communication, i.e. delayed reporting of the data;
\- charging data collection should include the radio resources utilized for
the one-to-many Direct Communication, since the UE may utilize different
resources when in-coverage and out-of-coverage.
## 4.2 Charging architecture for ProSe one-to-many Direct Communication
### 4.2.1 General principles
The following principles apply to the ProSe one-to-many Direct Communication
charging architecture:
\- The charging operation results should not affect the UE\'s use of the ProSe
Direct Communication service.
NOTE 1: For Public Safety use the UE is able to use ProSe Direct Communication
service even if there are errors in usage information collection or reporting;
\- In the ProSe Direct Communication charging architecture, the Accounting
Metrics Collection (AMC) functional block of the CTF is located in the UE, and
the Accounting Data Forwarding (ADF) functional block of the CTF is in ProSe
Function.
\- The ProSe Direct Communication usage information is stored securely in the
UE and is uploaded to a location configured by the ProSe Function securely
over PC3 using the mechanism defined in TS 33.303 [240].
\- The ProSe Function is able to control the UE uploading behaviour using
service authorization and provisioning mechanism defined in TS 23.303 [238].
The configuration parameters are defined in TS 24.333 [241].
\- When the UE is in coverage, it accesses the ProSe Function in HPLMN as
defined in TS 23.303 [238].
\- When the UE is out of coverage, it uses pre-stored configuration, e.g. from
ME or UICC, or configuration received while in coverage, for the usage logging
and uploading control.
\- In the roaming case, inter-PLMN accounting is supported.
NOTE 2: The data transfer for inter-PLMN accounting support is handled outside
of 3GPP.
### 4.2.2 Offline charging architecture for ProSe Direct Communication
Figure 4.2.2.1 illustrates the options for offline charging architecture for
the ProSe Direct Communication.
Figure 4.2.2.1: Options of offline charging architecture for ProSe Direct
Communication
The offline charging architecture for ProSe Direct Communication is based on
the general offline charging architecture defined in figure 4.2.1 of TS 32.277
[242]. The difference is the splitting of the CTF, and placing the Accounting
Metrics Collection (AMC) function block in the UE. The AMC sends usage
information collected to the Accounting Data Forwarding (ADF) function block
of the CTF in ProSe Function over the PC3 reference point defined in TS 23.303
[238].
The PC3 protocol should allow the following deployment options for the Prose
Function CTF (ADF) for ProSe Direct Communication depicted in figure 4.2.2.1:
\- The ProSe Function CTF (ADF) for ProSe Direct Communication may be deployed
in the same system as any combination of the Prose Function components defined
in clause 4.4.1 of TS 23.303 [238] (i.e. Direct Provisioning Function, Direct
Discovery Name Management Function, EPC-level Discovery Function).
\- The ProSe Function CTF (ADF) for ProSe Direct Communication may be deployed
in a logically or physically separate system from the ProSe Function
components defined in clause 4.4.1 of TS 23.303 [238]. To support this
deployment scenario, the PC3 protocol for usage information report delivery
should not require interaction with any other ProSe Function component for
successful and complete processing.
The network ensures that the UE can have IP access to its HPLMN ProSe
Function, in non-roaming and roaming case, as defined in TS 23.303 [238].
When the UE is out of coverage, PC3 reference point is not available. UE will
store the logged information and upload to the ProSe Function once the PC3
becomes available and the reporting criteria are met. UE\'s reporting of usage
information is only visible to the ProSe Function.
It is mandatory to support at least one of the Rf, Ga or Bx interfaces from
the ProSe Function as described in the options of figure 4.2.2.1.
### 4.2.3 Online Charging architecture for ProSe Direct Communication
There is no requirement for any online control for the use of ProSe Direct
Communication, which is for Public Safety use. The Public Safety regulators
also have requirements that the charging control should not prevent the UE
from using the ProSe Direct Communication for Public Safety, which can operate
in coverage or out of coverage.
# 5 Charging principles and scenarios for ProSe one-to-many Direct
Communication
## 5.1 Basic charging principles
### 5.1.1 General
In Release-12, the ProSe Direct Communication covers only one-to-many
communication for Public Safety use.\ The ProSe Direct Communication is
applicable when UE is under E-UTRAN coverage or out of E-UTRA coverage.
### 5.1.2 Requirements
The ProSe Direct Communication charging system needs to satisfy the following
requirements:
\- delayed reporting of information on the direct communication out of E-UTRAN
coverage is supported, with the UE making the information available to ProSe
Function only when the UE returns to coverage;
\- the one-to-many communication is connectionless and group oriented, and
thus the charging information needs to include the identity of the group
involved in the one-to-many communication;
\- the charging information needs to include the transmission and reception
usage from reporting UE point of view;
\- the charging information should identify the periods of communication under
E-UTRAN coverage and out of E-UTRAN coverage with associated radio resources
information;
\- the charging information should identify the location of the communication
when in coverage;
\- the charging information should provide information to track the UE
location;
\- in Release 12, online charging is not applicable to ProSe Direction
Communication for Public Safety usage, due to the support of out-of-coverage
cases and the lack of control procedures involving the network.
## 5.2 Charging operation and scenarios
### 5.2.1 Basic principles
#### 5.2.1.1 General
Based on the usage information reported by the UE, the ProSe Functions in
HPLMN produces CDRs or reports charging events for CDRs generation by CDF. The
CDRs or charging events are generated for the ProSe one-to-many Direct
Communication for Public Safety use (PF-DC-CDR).
When the CDF is implemented as a separate entity (than the ProSe Function),
the charging events triggering and handling are described in clause 5.2.2.
For ProSe one-to-many Direct Communication charging, either event based
charging or session based charging can be used, depending on configuration of
the ProSe Function and CDF.
NOTE: The charging session does not correspond to any ProSe one-to-many Direct
Communication session, as there is no session concept defined for the group
communication in TS 23.303 [238].
#### 5.2.1.2 ProSe one-to-many Direct Communication charging
When a charging event is reported to the CDF, it includes relevant information
as listed in clause 5.3.
The following chargeable events are defined for ProSe one-to-many Direct
Communication charging:
\- Received Direct Communication Usage Report (for a group).
If event based charging is used, upon this event, a Charging Data
Request[Event] for a specific group is generated.
If session based charging is used, either a Charging Data Request[Start],
Charging Data Request[Interim], or Charging Data Request[Stop] for a specific
group is generated.
The triggering conditions for the corresponding charging events are defined in
clause 5.2.2.1.1.
### 5.2.2 Rf message flows
#### 5.2.2.1 Offline charging message flow for ProSe one-to-many Direct
Communication
##### 5.2.2.1.1 Triggers for charging events at ProSe Function
###### 5.2.2.1.1.1 Triggers for charging events at ProSe Function for event
based charging
This reporting is achieved by sending Charging Data Request[event] from the
ProSe Function to the CDF.
The Received Direct Communication Usage Report event for a group is triggered
by the ProSe Function receiving a usage information report from the UE for the
group over PC3. The ProSe Function goes through the reported usage
information, and if it contains valid ProSe Direct Communication usage data
for a specific group, the ProSe Function sends the events to the CDF, which
triggers the generation of the PF-DC-CDR for a specific group. It is possible
that a single UE usage information report triggers multiple Received Direct
Communication Usage Report events, each for a particular group.
The ProSe charging operation flows in the following subclauses are based on
the above triggers and the procedures defined in TS 23.303 [238].
###### 5.2.2.1.1.2 Triggers for charging events at ProSe Function for session
based charging
The ProSe Function may be configured to use session based charging in order to
reduce the number of CDRs generated.
The Charging Data Request[Start] is sent when the ProSe Function receives a
Received Direct Communication Usage Report event, and there is no open
charging session for the group.
The Charging Data Request[Interim] is sent when the ProSe Function receives a
Received Direct Communication Usage Report event, and there is an open
charging session for the group.
The Charging Data Request[Stop] is sent when the ProSe Function decides one of
the following conditions is met:
\- operator configured maximum number of reports, or
\- operator configured maximum time limit.
##### 5.2.2.1.2 Message flow for ProSe one-to-many Direct Communication when
the UE is under coverage of E-UTRAN (event based)
Figure 5.2.2.1.2.1 depicts the message flow for ProSe one-to-many Direct
Communication for non-roaming and roaming case, when UE is under coverage of
E-UTRAN.
Figure 5.2.2.1.2.1: Offline Charging for ProSe one-to-many Direct
Communication
1\. The ProSe Function in HPLMN configures the UE on the usage information
collection and reporting using the Service authorization and provisioning
mechanism defined in TS 23.303 [238]. The configuration parameters are
delivered as defined in TS 24.333 [241].
> This step is optional, as the UE can be pre-configured with the
> corresponding information.
2-3. UE performs one-to-many Direct Communication as defined in TS 23.303
[238].
4\. When the UE decides that reporting criteria are met, according to the
configuration in step 1, and the connection to the ProSe Function is
available, the UE triggers the usage reporting procedure.
NOTE 1: The UE has a connection to the HPLMN ProSe Function when any PDN
Connection is available, as specified in TS 23.303 [238].
5\. UE sends the usage information report to the ProSe Function, according to
the configuration in step 1.
When the usage information report in step 5 includes information for multiple
groups, step 6 to 8 are repeated for each of the group.
6\. Upon reception of direct communication usage information report, the ProSe
Function triggers the Charging Data Request[Event] . The ProSe Function sends
the Charging Data Request[Event] to the corresponding CDF.
7\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is generated by CDF for the UE.
8\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
NOTE 2: The delivery of the charging data to the VPLMN in roaming case is
handled outside of 3GPP.
NOTE 3: The procedure applies to UE1 to UE3 independently, i.e. each of the UE
sends the respective usage information reports about the group communication
to the network using either the under coverage procedure or out of coverage
procedure.
##### 5.2.2.1.3 Message flow for ProSe one-to-many Direct Communication when
the UE is out of coverage of E-UTRAN (event based)
Figure 5.2.2.1.3.1 depicts the message flow for ProSe one-to-many Direct
Communication for non-roaming and roaming case, when UE is out of coverage of
E-UTRAN.
Figure 5.2.2.1.3.1: Offline Charging for ProSe one-to-many Direct
Communication (out of coverage)
1\. When the UE is out of coverage of the E-UTRAN, it makes use of the pre-
configured resources in USIM or ME for the ProSe one-to-many Direct
Communication for public safety use. The mechanism to decide on the resources
to use is defined in TS 23.303 [238].
2-3. UE performs one-to-many Direct Communication as defined in TS 23.303
[238].
4\. When the UE decides that reporting criteria are met, according to the pre-
configuration, the UE create the corresponding usage information report.
5\. The UE stores the usage information, when the UE is out of E-UTRAN
coverage and has no connection to the HPLMN ProSe Function.
NOTE 1: The usage information is stored in a secure environment in the UE.
6\. When the UE comes back to E-UTRAN coverage, it will trigger the reporting
of the usage information.
7\. UE sends the usage information report to the ProSe Function, according to
the pre-configuration or new configuration from the HPLMN ProSe Function.
When the usage information report in step 7 includes information for multiple
groups, step 8 to 10 are repeated for each of the group. When the usage
information report in step 7 includes multiple reports for a group, e.g. the
UE has been out of coverage for a long time, step 8 to 10 are repeated for
each of the report.
8\. Upon reception of direct communication usage information report, the ProSe
Function triggers the Charging Data Request[Event] for each of the group in
the report. The ProSe Function sends the Charging Data Request[Event] to the
corresponding CDF.
9\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is generated by CDF for the UE.
10\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
NOTE 2: The procedure applies to UE1 to UE3 independently, i.e. each of the UE
sends the respective usage information reports about the group communication
to the network using either the under coverage procedure or out of coverage
procedure.
##### 5.2.2.1.4 Message flow for ProSe one-to-many Direct Communication when
the UE is under coverage of E-UTRAN (session based)
Figure 5.2.2.1.4.1 depicts the message flow for session based charging for
ProSe one-to-many Direct Communication for non-roaming and roaming case, when
UE is under coverage of E-UTRAN.
Figure 5.2.2.1.4.1: Offline Charging for ProSe one-to-many Direct
Communication\ (under coverage, session based charging)
1\. The ProSe Function in HPLMN configures the UE on the usage information
collection and reporting using the Service authorization and provisioning
mechanism defined in TS 23.303 [238]. The configuration parameters are
delivered as defined in TS 24.333 [241].
> This step is optional, as the UE can be pre-configured with the
> corresponding information.
2-3. UE performs one-to-many Direct Communication as defined in TS 23.303
[238].
4\. When the UE decides that reporting criteria are met, according to the
configuration in step 1, and the connection to the ProSe Function is
available, the UE triggers the usage reporting procedure.
NOTE 1: The UE is provided a connection to the HPLMN ProSe Function as
specified in TS 23.303 [238].
5\. UE sends the usage information report to the ProSe Function, according to
the configuration in step 1.
When the usage information report in step 5 includes information for multiple
groups, step 6 to 8 are repeated for each of the group.
6\. If the ProSe Function is configured to use session based charging, upon
reception of direct communication usage information report for a group, the
ProSe Function triggers the Charging Data Request[Start] when there is no open
charging session for the group, according to 5.2.2.1.1.2. The ProSe Function
sends the Charging Data Request[Start] to the corresponding CDF, and starts a
charging session for the group.
7\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is opened by CDF for the UE.
8\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
9\. UE triggers the usage reporting procedure when the reporting criteria are
met.
10\. UE sends the usage information report to the ProSe Function.
When the usage information report in step 10 includes information for multiple
groups, step 11 to 13 are repeated for each of the group.
11\. If there is a charging session for the group, upon reception of direct
communication usage information report for the group, the ProSe Function
triggers the Charging Data Request[Interim], according to clause 5.2.2.1.1.2.
The ProSe Function sends the Charging Data Request[Interim] to the
corresponding CDF.
12\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is updated by CDF for the UE.
13\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
NOTE 2: Step 9 to 13 may happen multiple times before step 14.
14\. UE triggers the usage reporting procedure when the reporting criteria are
met.
15\. UE sends the usage information report to the ProSe Function.
When the usage information report in step 15 includes information for multiple
groups, step 16 to 18 are repeated for each of the group.
16\. The ProSe Function decides that the charging session should be closed,
according to clause 5.2.2.1.1.2, and triggers the Charging Data Request[Stop].
The ProSe Function sends the Charging Data Request[Stop] to the corresponding
CDF.
17\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is closed by CDF for the UE.
18\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
NOTE 3: The procedure applies to UE1 to UE3 independently, i.e. each of the UE
sends the respective usage information reports about the group communication
to the network using either the under coverage procedure or out of coverage
procedure.
##### 5.2.2.1.5 Message flow for ProSe one-to-many Direct Communication when
the UE is out of coverage of E-UTRAN (session based)
Figure 5.2.2.1.5.1 depicts the message flow for session based charging for
ProSe one-to-many Direct Communication for non-roaming and roaming case, when
UE is out of coverage of E-UTRAN.
Figure 5.2.2.1.5.1: Offline Charging for ProSe one-to-many Direct
Communication\ (out of coverage, session based)
1\. When the UE is out of coverage of the E-UTRAN, it makes use of the pre-
configured resources in USIM or ME for the ProSe one-to-many Direct
Communication for public safety use. The mechanism to decide on the resources
to use is defined in TS 23.303 [238].
2-3. UE performs one-to-many Direct Communication as defined in TS 23.303
[238].
4\. When the UE decides that reporting criteria are met, according to the pre-
configuration, the UE create the corresponding usage information report.
5\. The UE stores the usage information, when the UE is out of E-UTRAN
coverage and has no connection to the HPLMN ProSe Function.
NOTE 1: The usage information is stored in a secure environment in the UE.
6\. When the UE comes back to E-UTRAN coverage, it will trigger the reporting
of the usage information.
7\. UE sends the usage information report to the ProSe Function, according to
the pre-configuration or new configuration from the HPLMN ProSe Function.
When the usage information report in step 7 includes information for multiple
groups, step 8 to 10 are repeated for each of the group.
8\. If the ProSe Function is configured to use session based charging, upon
reception of direct communication usage information report for a group, the
ProSe Function triggers the Charging Data Request[Start] when there is no open
charging session for the group, according to clause 5.2.2.1.1.2. The ProSe
Function sends the Charging Data Request[Start] to the corresponding CDF, and
starts a charging session for the group.
9\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is opened by CDF for the UE.
10\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
When the usage information report in step 7 includes multiple reports for a
group, e.g. the UE has been out of coverage for a long time, step 12 to 14 and
16 to 18 may be triggered without step 11 or 15.
11\. UE sends the usage information report to the ProSe Function when the
reporting criteria are met.
When the usage information report in step 11 includes information for multiple
groups, step 12 to 14 are repeated for each of the group.
12\. If there is a charging session for the group, upon reception of direct
communication usage information report for the group, the ProSe Function
triggers the Charging Data Request[Interim], according to clause 5.2.2.1.1.2.
The ProSe Function sends the Charging Data Request[Interim] to the
corresponding CDF.
13\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is updated by CDF for the UE.
14\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
15\. UE sends the usage information report to the ProSe Function when the
reporting criteria are met.
When the usage information report in step 15 includes information for multiple
groups, step 16 to 18 are repeated for each of the group.
16\. The ProSe Function decides that the charging session should be closed,
according to clause 5.2.2.1.1.2, and triggers the Charging Data Request[Stop].
The ProSe Function sends the Charging Data Request[Stop] to the corresponding
CDF.
17\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is closed by CDF for the UE.
18\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
NOTE 2: The procedure applies to UE1 to UE3 independently, i.e. each of the UE
sends the respective usage information reports about the group communication
to the network using either the under coverage procedure or out of coverage
procedure.
### 5.2.3 CDR generation
#### 5.2.3.1 Triggers for PF-DC-CDR creation and closure
##### 5.2.3.1.1 General
A PF-DC-CDR is used to collect charging information related to the ProSe
Direct Communication for a specific group. Multiple direct communication data
containers can be included in the PF-DC-CDR.
When a direct communication usage information report for a group is received
from the UE, a PF-DC-CDR should be opened if no open PF-DC-CDR for this group
exists.
When event based charging is used, the corresponding containers are added, and
the PF-DC-CDR is closed upon receiving the direct communication usage report.
When session based charging is used, the PF-DC-CDR is closed as described in
clause 5.2.2.1.1.2.
##### 5.2.3.1.2 Triggers for PF-DC-CDR charging information addition
The \"List of direct communication data\" attribute of the PF-DC-CDR consists
of a set of containers, which are added when the following triggering
conditions are encountered.
Any of the following should result in a set of \"List of direct communication
data\" containers being added to the PF-DC-CDR:
\- receipt of a usage information report;
\- change of location in the usage information report (e.g. change of cell);
\- change of coverage status in the usage information report (e.g. go out of
coverage, come back to coverage).
The CDR closure should result in all active \"List of direct communication
data\" container to be added to the PF-DC-CDR.
Details of the container is defined in clause 5.2.6.
##### 5.2.3.1.3 Triggers for PF-DC-CDR closure
The PF-DC-CDR should be closed on encountering any of the following trigger
conditions:
\- When event based charging is used, and the usage information report for the
group is received from UE.
\- When session based charging is used, and the charging session is closed as
described in clause 5.2.2.1.1.2. In this case, a further PF-DC-CDR is opened
when another usage information report for the group is received from the UE.
### 5.2.4 Ga record transfer flows
Details of the Ga protocol application are specified in TS 32.295 [54].
### 5.2.5 Bx CDR file transfer
Details of the Bx protocol application are specified in TS 32.297 [52].
### 5.2.6 Direct Communication Data Container definition
The \"List of Direct Communication Data\" attribute of the Direct
Communication Data CDR consists of a set of containers, which are added to CDR
when specific trigger conditions are met, as defined in clause 5.2.3.1. Each
container identifies the configured counts (volume separated for transmitting
and receiving) of the same ProSe communication group.
For each time trigger conditions are met, active container is added to CDR and
a new container is created, i.e. several containers may be added based on one
usage information report.
The components of the Direct Communication Data Container are defined in
following table.
Table 5.2.6.1: Structure of the Direct Communication Data Container
* * *
Information Element Category Description Local Sequence Number Oc The sequence
number of the Direct Communication data container, which is increased by 1 for
each container closed Time of First Usage Oc The time when collection of
charging data in this container is started, i.e. the first one-to-many
communication transmission/reception. Time of Last Usage Oc The time when
collection of charging data in this container is stopped, i.e. the last one-
to-many communication transmission/reception. Change Time Oc The time when the
container is closed and reported due to ProSe charging condition change.
Coverage status Oc Whether UE is served by E-UTRAN or not, i.e. in coverage,
out of coverage. User Location Information Oc The locations of the UE, e.g.
ECGIs Data Volume Transmitted Oc Amount of data transmitted by UE. Data Volume
Received Oc Amount of data received by UE. Change Condition Oc ProSe specific
reason for closing the container, e.g. change of Cell, go out of coverage,
come back to coverage. VPLMN Identifier Oc Indentifier of PLMN which UE
visits. Usage information report sequence number Oc The sequence number of
usage information report, which is used to generate the container.
* * *
## 5.3 Data selection for one-to-many Direct Communication charging support
### 5.3.1 Agreed principles and working assumptions
The usage information for ProSe Direct Communication is collected based on the
configuration defined in TS 24.333 [241]. The usage information is collected
and recorded associated with the IMSI.
When the UE is in E-UTRAN coverage, if the usage information recorded for the
current collection period is not empty, it should report the usage information
as configured when the earlier one of the following criteria are met:
\- a configured collection period has elapsed; the end of an associated
configured reporting window has not been reached; and the UE temporarily
switches to RRC CONNECTED mode; or
\- a configured collection period has elapsed and the end of an associated
configured reporting window has been reached.
When the UE is out of E-UTRAN coverage, the UE should generate reports from
the recorded usage information every collection period and store the non-empty
reports in a non-volatile memory, and send the reports once the UE returns to
coverage.
The storage of the usage information and the execution of the reporting
procedure should be in a secure environment in the UE that is trusted by the
operator.
NOTE 1: The secured storage and execution of the reporting procedure do not
guarantee that the recording of the usage information is trusted.
NOTE 2: When the UE operates out of coverage for a long time, the stored
reports may reach the limit of the memory. The handling of such situation is
determined by UE implementation.
If a replacement of USIM occurs when UE is out of coverage, the usage
information for a given IMSI should remain stored on the UICC or ME as long as
the UE does not use the USIM associated with that IMSI.
### 5.3.2 Usage information to be collected
Following usage information for the ProSe Direct Communication should be
collected, and be included in the usage information report if configured by
the network:
\- UE identity, e.g. IMSI;
\- For every reporting period:
\- Sequence number of the report. .
\- List of the locations of the UE when in coverage, e.g. ECGIs, and the
corresponding timestamps.
\- Radio Parameters used for the ProSe Direct Communication, as defined in TS
24.333 [241].
\- List of timestamps of when the UE goes in/out of E-UTRAN coverage.
\- For every ProSe Direct Communication Group (identified by ProSe L2 Group
ID):
\- Group Parameters used for the ProSe Direct Communication, as defined in TS
24.333 [241], e.g. ProSe L2 Group ID, IP Multicast Address, Source IP address,
etc.
\- Timestamp of the first one-to-many communication transmission/reception.
\- Identities of the transmitters in the one-to-many communication session,
e.g. Source L2 ID and IP address.
\- List of non-zero amount of data transmitted by UE.
\- List of amount of data transmitted by UE when in E-UTRAN coverage at each
location, with ECGI and the corresponding timestamps.
\- List of amount of data transmitted by UE for each out of E-UTRAN coverage
period and the corresponding timestamps.
\- List of non-zero amount of data received by UE.
\- List of amount of data received by UE when in E-UTRAN coverage at each
location, with ECGI and the corresponding timestamps.
\- Amount of data received by UE for each out of E-UTRAN coverage period and
the corresponding timestamps.
\- Application specific data, e.g. application specific session floor control
information, Application layer User ID of group members in the communication.
The network should be able to configure the UE with information to be included
in the usage information report as per following:
\- Whether the Group Parameters need to be reported.
\- Whether timestamps of the first transmission/reception need to be reported.
\- Whether the amount of data transmitted by UE needs to be reported, and
whether with location information.
\- Whether the amount of data received by UE needs to be reported, and whether
with location information.
\- Whether the list of locations of the UE when in E-UTRAN coverage needs to
be reported.
\- Whether the list of timestamps of when UE goes in/out of E-UTRAN coverage
need to be recorded.
# 6 Recommendations
It is recommended that the architecture captured in clause 4.2 and charging
principles and scenarios captured in clause 5 are used as the basis for ProSe
Direct Communication charging specifications, to be incorporated into TS
32.277.
#
# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, I.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document contains a study of the security aspects of Proximity
Services (ProSe) and an evaluation of possible technical solutions needed to
support such services. The Stage 1 requirements for these services are defined
in SA1 TS 22.278 [2] and TS 22.115 [3]. These requirements include a list of
general requirements on ProSe Security, Authorization and Privacy (TS 22.278
[2] clause 9.4), which are taken into consideration when developing the
security key issues, security requirements and security solutions in the
present document.\ Different possible Stage 2 solutions for Proximity Services
are studied in SA2 TR 23.703 [4].
Normative provisions/requirements are included in the present specification
solely for the purposes of studying solutions and are not to be considered as
implying normative requirements on 3GPP entities.
NOTE: Lawful Interception (LI) aspects are covered under the Rel-12 Lawful
Interception (LI12) work item (UID_570032).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.278: \"Service requirements for the Evolved Packet System (EPS)
\".
[3] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[4] 3GPP TR 23.703: \"Study on architecture enhancements to support Proximity
Services (ProSe)\".
[5] 3GPP TS 33.222: \"Generic Authentication Architecture (GAA); Access to
network application functions using Hypertext Transfer Protocol over Transport
Layer Security (HTTPS)\".
[6] 3GPP TS 33.220: \"Generic Authentication Architecture (GAA); Generic
Bootstrapping Architecture (GBA)\".
[7] 3GPP TS 33.223: \"Generic Authentication Architecture (GAA); Generic
Bootstrapping Architecture (GBA) Push function\".
[8] ETSI TS 102 225: \"Smart Cards; Secured packet structure for UICC based
applications (Release 9)
[9] ETSI TS 102 226: \"Smart cards; Remote APDU structure for UICC based
applications (Release 6)\"
[10] 3GPP TS 31.115: \"Secured packet structure for (Universal) Subscriber
Identity Module (U)SIM Toolkit applications\".
[11] 3GPP TS 31.116: \"Remote APDU Structure for (U)SIM Toolkit
applications\".
[12] IETF RFC 6509: \"MIKEY-SAKKE: Sakai-Kasahara Key Encryption in Multimedia
Internet KEYing (MIKEY)\".
[13] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC); Protocol specification\".
[14] IETF RFC 3830: \"MIKEY: Multimedia Internet KEYing\", August 2004.
[15] IETF RFC 6507: \"Elliptic Curve-Based Certificateless Signatures for
Identity-Based Encryption (ECCSI)\".
[16] 3GPP TS 33.328: \"IP Multimedia Subsystem (IMS) media plane security\".
[17] IETF RFC 6043: \"MIKEY-TICKET: Ticket-Based Modes of Key Distribution in
Multimedia Internet KEYing (MIKEY)\".
[18] 3GPP TS 33.210: \"3G security; Network Domain Security (NDS); IP network
layer security\".
[19] 3GPP TS 33.310: \"Network Domain Security (NDS); Authentication Framework
(AF)\".
[20] 3GPP TS 23.303: \"Proximity based Services (ProSe); Stage 2\".
[21] 3GPP TS 33.401: \"3GPP System Architecture Evolution (SAE); Security
architecture\".
[22] IETF RFC 3550: \"RTP: A Transport Protocol for Real-Time Applications\".
[23] IETF RFC 3711: \"The Secure Real-time Transport Protocol (SRTP)\".
[24] NIST FIPS 186-4: \"Digital Signature Standard (DSS)\"
[25] BSI TR-03111: \"Technical Guideline TR-03111; Elliptic Curve
Cryptography\"
[26] IETF RFC 5639: \"Elliptic Curve Cryptography (ECC) Brainpool Standard;
Curves and Curve Generation\"
[27] IETF RFC 3339: \"Date and Time on the Internet: Timestamps\"
[28] IETF RFC 5280: \"Internet X.509 Public Key Infrastructure Certificate and
Certificate Revocation List (CRL) Profile\"
[29] NIST FIPS 180-4: \"Secure Hash Standard (SHS)\"
[30] Open Mobile Alliance, OMA AD SUPL: \"Secure User Plane Location
Architecture\", (http://www.openmobilealliance.org).
[31] 3GPP TR 22.803: \"Feasibility study for Proximity Services (ProSe)\".
[32] ETSI TS 102 223: \"Smart Cards; Card Application Toolkit (CAT)\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply.\ A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**Open ProSe Discovery** : is ProSe Discovery without explicit permission from
the UE being discovered.
**ProSe Application Identity** : An identity identifying application related
information for the ProSe enabled UE.\ There can exist more than one ProSe
Application Identities per UE.
**ProSe Application Key** : A key associated with a ProSe Application
Identity, meant to be used for restricted discovery.
**ProSe Discovery** : A process that identifies that a ProSe-enabled UE is in
proximity of another, using E-UTRA (with or without E-UTRAN) or EPC.
**ProSe Direct Discovery:** A procedure employed by a ProSe-enabled UE to
discover other ProSe-enabled UEs in its vicinity by using only the
capabilities of the two UEs with Rel-12 E-UTRA technology.
**EPC-level ProSe Discovery:** A process by which the EPC determines the
proximity of two ProSe-enabled UEs and informs them of their proximity.
**ProSe UE-to-Network Relay** : is a form of relay in which a Public Safety
ProSe-enabled UE acts as a ProSe E-UTRA communication relay between a Public
Safety ProSe-enabled UE and the ProSe-enabled network using E-UTRA.
**ProSe UE-to-UE Relay** : is a form of relay in which a Public Safety ProSe-
enabled UE acts as a ProSe E-UTRA Communication relay between two other Public
Safety ProSe-enabled UEs.
**ProSe-enabled UE:** An UE that fulfils ProSe requirements for ProSe
Discovery and/or ProSe Communication. Unless explicitly stated otherwise, a
ProSe-enabled UE refers to any ProSe-enabled UE (I.e. Public Safety or not).
**ProSe-enabled Network** : A network that supports ProSe Discovery and/or
ProSe Communication. Unless explicitly stated otherwise in the present
document, a network refers to a ProSe-enabled Network.
**ProSe Communication:** A communication between two or more ProSe-enabled UEs
in proximity by means of a ProSe Communication path. Unless explicitly stated
otherwise, the term \"ProSe Communication\" refers to any/all of the
following:
  * ProSe E-UTRA Communication between only two ProSe-enabled UEs; or
  * ProSe Group Communication or ProSe Broadcast Communication among Public Safety ProSe-enabled UEs; or
  * ProSe-assisted WLAN direct communication
**ProSe Broadcast Communication:** An One-to-all ProSe E-UTRA Communication,
between all authorized Public Safety ProSe-enabled UEs in proximity, by means
of a common ProSe E-UTRA Communication path established between these UEs.
**ProSe Group Communication:** An One-to-many ProSe E-UTRA Communication,
between more than two Public Safety ProSe-enabled UEs in proximity, by means
of a common ProSe E-UTRA Communication path established between the Public
Safety ProSe-enabled UEs.
**ProSe UE Identity** : An unique identity allocated by EPS which identifies
the ProSe enabled UE. It can be assigned to a UE at any moment in time for a
configurable duration, can be stored at the UE, but its value cannot be
assigned by the user, and is subject to operator assignment and re-assignment.
**Proximity:** is determined (\"a UE is in proximity of another UE\") when
given proximity criteria are fulfilled. Proximity criteria can be different
for discovery and communication.
**Restricted ProSe Discovery** : A ProSe Discovery that only takes place with
explicit permission from the UE being discovered.
**EPC ProSe User ID** : An identifier for EPC-level ProSe Discovery and EPC
support for WLAN direct communication that uniquely identifies a UE registered
for ProSe. This identifier can be occasionally reassigned by the ProSe
Function.
Editor\'s Note: The above definitions need to be checked for alignment with
SA1 and SA2.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
ProSe Proximity Services
# 4 Proximity Services (ProSe)
## 4.1 Overview of Proximity Services (ProSe)
### 4.1.1 ProSe Discovery
ProSe Discovery is a process which determines that ProSe-enabled UEs are in
proximity of each other. Its use shall be authorized by the operator, and the
authorization can be on a \"per UE\" basis, or a \"per UE per application\"
basis. Similarly, the operator may also provide configuration data, e.g. the
proximity criteria, for the use of ProSe Discovery, to a ProSe-enabled UE. The
network controls the use of E-UTRAN resources used for ProSe Discovery for a
ProSe-enabled UE served by E-UTRAN. ProSe Discovery can be used as a
standalone process (I.e. it is not necessarily followed by ProSe
Communication) or as an enabler for other services.
There are two different types of Prose Discovery, namely open and restricted.
In open discovery, a UE may be discovered without explicit permission, while
restricted discovery only takes place with explicit permission from the UE
that is being discovered.
## 4.1.2 ProSe Communication
ProSe Communication enables establishment of new communication paths between
two or more ProSe-enabled UEs. The use of ProSe Communication shall be
authorized by the operator and it may take place over E-UTRA or WLAN.
The network controls the use of E-UTRAN resources used for ProSe Communication
for a ProSe-enabled UE served by E-UTRAN. In particular, according to policy a
UE\'s communication path can be switched between an EPC path and a ProSe
Communication path and a UE can also have concurrent EPC and ProSe
Communication paths.
In addition there are several scenarios that only apply to Public Safety
usage:
  * ProSe Communication can start without the use of ProSe Discovery;
```{=html}
``` \- Public Safety ProSe-enabled UEs establishing the communication path
directly between them, regardless of whether the Public Safety ProSe-enabled
UE is served by E-UTRAN;
  * Public Safety ProSe-enabled UEs may participate in ProSe Group Communication or ProSe Broadcast Communication. ProSe Communication is also facilitated by the use of a ProSe UE-to-Network Relay, which acts as a relay between E-UTRAN and UEs not served by E-UTRAN. The use of this relay function is controlled by the operator;
  * ProSe Communication can also take place over a ProSe UE-to-Network Relay, which acts as a relay between\ E-UTRAN and UEs not served by E-UTRAN.
### 4.1.3 Scope of ProSe
The scope of ProSe in Rel-12 is as follows:
• Configuration of ProSe-enabled UEs;
• Open ProSe Direct Discovery (in network coverage);
• One-to-many communication for Public Safety UEs;
• EPC-level ProSe Discovery;
• EPC support for WLAN Direct Communication.
## 4.2 Architecture for ProSe
The high level ProSe architecture is given here for SA3 to study security
threats, requirements and solution in the present document. This architecture
is based on the Non-Roaming Reference Architecture (Figure 4.2-1), Inter-PLMN
Reference Architecture (Figure 4.2-2), and Roaming Reference Architecture
(Figure 4.2-3) of TS 23.303 [20].
{width="6.688888888888889in" height="4.6194444444444445in"}Figure 4.2-1: Non-
Roaming Reference Architecture (TS 23.303 [20])
{width="5.924305555555556in" height="9.205555555555556in"}
Figure 4.2-2: Inter-PLMN Reference Architecture (TS 23.303 [20])
{width="6.145138888888889in" height="5.358333333333333in"}
Figure 4.2-3: Roaming Reference Architecture (TS 23.303 [20])
For Discovery and Direct Communication, SA3 should study the security of the
reference points given below:
**PC1** : The reference point between the ProSe application in the UE and in
the ProSe Application Server.\ It is used to define application level
signalling requirements. This reference point is not described in Rel-12 of
the present document.
Editor\'s Note: It is FFS if this is in scope of 3GPP SA3.
**PC2** : The reference point between the ProSe Application Server and the
ProSe Function. It is used to define the interaction between ProSe Application
Server and ProSe functionality provided by the 3GPP EPS via ProSe Function
(e.g. name translation) for EPC-level ProSe Discovery.
**PC3** : The reference point between the UE and the ProSe Function. PC3
relies on EPC user plane for transport (I.e. an \"over IP\" reference point).
It is used to authorize ProSe Direct Discovery and EPC-level ProSe Discovery
requests, and perform allocation of ProSe Application Codes corresponding to
ProSe Application Identities used for ProSe Direct Discovery. It is used to
define the authorization policy per PLMN for ProSe Direct Discovery (for
Public Safety and non -Public Safety) and communication (for Public Safety
only) between UE and ProSe Function.
**PC4a** : The reference point between the HSS and ProSe Function. It is used
to provide subscription information in order to authorize access for ProSe
Direct Discovery and ProSe Direct Communication on a per PLMN basis.\ It is
used by the ProSe Function (EPC-level ProSe Discovery Function) for retrieval
of EPC-level ProSe Discovery related subscriber data.
**PC4b** : The reference point between the SUPL Location Platform (SLP)
defined in OMA AD SUPL [30] and the ProSe Function. PC4b is used by the ProSe
Function (EPC-level ProSe Discovery Function) (in the role of LCS client to
query the SLP defined in OMA AD SUPL [30].
**PC5** : The reference point between ProSe-enabled UEs used for control and
user plane for ProSe Direct Discovery, ProSe Direct Communication and ProSe
UE-to-Network Relay.
**PC6** : When the UE is not roaming, the reference point between the ProSe
Function in the HPLMN and the ProSe Function in a different PLMN. It is used
to authorize ProSe Direct Discovery requests, and perform allocation of ProSe
Application Identity Codes and ProSe Application Identity Names from the
HPLMN. It is used for HPLMN control of ProSe Service Authorization.
**PC7** : When the UE is roaming, the reference point between the ProSe
Function in the HPLMN and the ProSe Function in the VPLMN or ProSe Function in
another PLMN. It is used to authorize ProSe Direct Discovery requests, and
perform allocation of ProSe Application Identity Codes and ProSe Application
Identity Names from the HPLMN.\ It is used for HPLMN control of ProSe Service
Authorization.
**S6a** : In addition to the relevant functions defined in TS 23.401 [5] for
S6a, in case of ProSe S6a is used to download ProSe related subscription
information to MME during E UTRAN attach procedure or to inform MME that
subscription information in the HSS has changed.
**S1-MME:** In addition to the relevant functions defined in TS 23.401 [5] for
S1-MME, in case of ProSe it is also used to provide an indication to eNB that
the UE is authorized to use ProSe Direct Discovery.
Editor\'s Note: It is proposed to reuse the existing security mechanisms as
much as possible for above interfaces.
# 5 Key Issues for Rel-12
Editor\'s note: Some of the below key issues may be combined together by
future contributions.
Editor\'s note: For discovery whether the UE-reporting data can be considered
a trusted source of information to base accounting procedures on or whether
other solutions need to be developed is FFS.
## 5.1 Key Issues on Configuration
### 5.1.1 Key Issue #1.1: Configuration of ProSe-enabled UEs
#### 5.1.1.1 Key issue details
In order to utilise ProSe features, e.g. ProSe Discovery and/or ProSe
Communication, the operator needs to be able to configure the ProSe enabled
UEs.
Configuration data may include e.g. proximity criteria as well as PLMN
sensitive radio resource configuration.\ A Public Safety ProSe UE, when in
coverage, will receive resource configuration by the registered PLMN, whereas
when out-of-coverage will use resource configuration obtained by the last
registered PLMN (before loosing E-UTRAN coverage) or, as a backup, resources
pre-configured (by the HPLMN operator). It is then crucial that these data are
not prone to manipulation by anybody else than the registered PLMN (as a
Public Safety ProSe UE transmitting on unauthorized bands could represent a
serious source of radio interference).
Configuration data for LTE network operations shall be provided only by
Operators (either HPLMN or VPLMN).\ Third party are not allowed to provide
such parameters.
NOTE: The requirement above does not apply to all types of configuration data.
For example, a parameter for how often an NSPS device shall poll a Certificate
Revocation List server is something that indirectly impacts network
operations: If there are many NSPS UEs in a certain area, the network may have
to adapt to a higher traffic load at the times they request CRLs. The
parameter setting this frequency may be an application layer parameter (ProSe
APP parameter) and hence not directly related to the network operations, but
it still may have impact on the network operation.
Editor\'s Note: The scenario when the configuration data for the ProSe APP
layer is provided by a provisioning server controlled by a different entity
than the 3GPP operator, needs to be considered as well.
#### 5.1.1.2 Security threats
There are several threats to the downloading of configuration data to the UE.
  * An attacker pretending to be a configuration server may maliciously configure the UE with false configuration data, thus causing improper UE operation.
  * An attacker pretending to be a configuration server may maliciously delete the UE configuration data, rendering the UE unable to operate in ProSe mode.
  * Similarly the authorized ProSe configuration server will want to know the identity of the ProSe-enabled UE that is requesting configuration information, as otherwise it is not possible to download correct information to the UE.
  * An attacker may manipulate of modify the configuration data being transmitted between the UE and the configuration server, thus adversely affecting the ProSe configuration.
  * An attacker may eavesdrop on transmitted configuration data and further distribute it to unauthorized parties for improper use.
  * An attacker may replay an intercepted configuration data thus affecting an expected configuration state at the ProSe-enabled UE and/or a configuration server.
  * An attacker may manipulate of modify the configuration data while stored on the UE.
#### 5.1.1.3 Security requirements
The only entities entitled to provide configuration data impacting the network
operations (e.g. radio resource allocation) to the ProSe-enabled UE shall be
operators. 3rd parties shall not be allowed to provide such parameters.
NOTE: The requirement above does not apply to all types of configuration data.
For example, a parameter for how often an NSPS device shall poll a Certificate
Revocation List server is something that indirectly impacts network
operations: If there are many NSPS UEs in a certain area, the network may have
to adapt to a higher traffic load at the times they request CRLs. The
parameter setting this frequency may be an application layer parameter (ProSe
APP parameter) and hence not directly related to the network operations, but
it still may have impact on the network operation.
Editor\'s Note: The scenario when the configuration data for the ProSe APP
layer is provided by a provisioning server controlled by a different entity
than the 3GPP operator, needs to be considered as well.
The ProSe-enabled UE and the entity providing the configuration data shall
mutually authenticate each other.
The transmission of configuration data between the authorized ProSe
configuration server in the network and the ProSe-enabled UE shall be
integrity protected.
The transmission of configuration data between the authorized ProSe
configuration server in the network and the ProSe-enabled UE shall be
confidentiality protected
The transmission of configuration data between the authorized ProSe
configuration server in the network and the ProSe-enabled UE shall be
protected from replays
The configuration data shall be stored in the UE in a protected way to prevent
modification.
Some configuration data may be required to be stored in the UE in a protected
way to prevent eavesdropping.
## 5.2 Key Issues on Discovery
### 5.2.1 Key Issue #2.1: Direct Request and Response Discovery
#### 5.2.1.1 Key issue details
In the solutions for discovery procedure in TR 23.703 [4] (clause 6.1 ProSe
Discovery) there are two ways to perform discovery:
1) Without network interaction: UE sends a message directly to other UEs for
discovery without any network interaction.
2) With network interaction: UE sends a message to other UEs via a network
entity.\ Options for network entities are ProSe Function, PDCF and eNB and/or
MME.
NOTE: The messages for discovery purpose are named differently in SA2
solutions in TR 23.703 [4], clause 6.1. SA3 categorizes them into (1)
Discovery Request and (2) Discovery Response for the present study.
#### 5.2.1.2 Security threats
The following addresses the threats when discovery is carried by sending
discovery request and response messages.
  1. UE may randomly or maliciously send discovery request and/or discovery response messages. This could also include malicious UE sending messages to those UEs that are not authorized for ProSe service.\ This can lead to resource depletion of other UEs.
  2. The message discovery request and response messages may be modified during transmission, this can cause various issues including incorrect discovery.
  3. The discovery request or response messages could be replayed. This could lead to various attacks like unauthorized UE using the ProSe Discovery service that in turn leads to fraudulent charging.
#### 5.2.1.3 Security requirements
The discovery request and discovery response messages should be integrity
protected.
The entity which receives the discovery request or discovery response message
should be able to verify the source authenticity.
Replay protection on discovery request and response messages should be
provided.
Authorization and verification of UE that requests or responds for discovery
should be provided.
### 5.2.2 Key Issue #2.2: Security analysis for Open Direct Discovery
#### 5.2.2.1 Key Issue Details
In the existing SA3 TR, security threat, requirements and solution are
addressing restricted discover (cf. Key issues #3 and solution 2). In Key
issue #A1.2 the clause A.1.2.2 \'Security Threats\' mentions impersonation as
one of the security threat. However the clause A.1.2.3 \'Security
requirements\' does not capture impersonation attack as one of the security
requirements. Further, replay attack and impersonation attack are applicable
to open discover also, especially for standalone service enabler (e.g.
advertisements by a store). Excerpt from TR 23.703 (clause 6.1.1.2.3) which
specifies the standalone service enabler:
> _ProSe Discovery can be a standalone service enabler that could for example
> use information from the discovered UE for certain applications in the UE
> that are permitted to use this information e.g. \"find a taxi nearby\",
> \"find me police officer X\". Additionally depending on the information
> obtained ProSe Discovery can be used for subsequent actions e.g. to initiate
> direct communication._
Discovering a specific restaurant/shop by a discovering UE in a place where
they do not exist (or are not in proximity) or discovering a friend by a
discovering UE when the friend is not in proximity should not be the outcome
of replayed/faked direct discovery.
#### 5.2.2.2 Security Threats
In the absence of any protection for the open discovery, a rogue UE can easily
receive the discovery information announced by the ProSe UEs and can easily
mount replay attack. Further, a ProSe UE can easily impersonate another ProSe
UE, so that the discovering ProSe UEs will find the discoverable UEs even when
they are not there or will receive wrong standalone service (like, receiving
advertisements which are not valid, as to destroy reputation).
The security threat on open discovery is, impersonation by a monitoring Prose
UE, who is authorized to receive and understood discovery information
transmitted, by replaying the received discovery message or transmitting a new
discovery message as receiving UE has all information of the transmitting UE.
Network controlled ProSe Discovery service under consideration in solution D13
in the SA2 TR 23.307, allows ProSe enabled UEs to send the collected
ProSe_Code(s) through NAS message, for which the ProSe Application Identity(s)
match is found. Authenticated and authorized ProSe enabled UEs creating NAS
traffic arbitrarily based on discovery message from other malicious or
compromised UEs may lead to mounting DoS attack on the MME.
Editor\'s note: Whether DoS attack using fake discovery message is possible or
not is FFS
#### 5.2.2.3 Security requirements
The system shall support a method to mitigate the replay and impersonation
attack for ProSe open discovery.
### 5.2.3 Key Issue #2.3: Security analysis for registration in Network based
ProSe Discovery
#### 5.2.3.1 Key issue details
A ProSe enabled UE shall first initiate a registration process before it gets
ProSe ID to communicate with other ProSe enabled UEs. In solution D8 from TR
23.703 [4], UE has to perform LTE attach procedure after power on, and the EPS
layer in UE sends a ProSe registration request NAS signalling to the ProSe
Server via RRC signalling. Then the ProSe server verifies the subscription of
the UE to see whether the indicated Open/Restrictive ProSe service is
subscribed.\ If the UE is subscribed, the ProSe Server will assign a ProSe ID
to the UE for this application instance.
#### 5.2.3.2 Security threats
There exists such a threat that an attacker can utilize the registration
procedure to send many signalling to ProSe Server to fake a legal UE, which
can cause ProSe server huge consumption. The details of this attack are as
below.
When the attacker is not subscribed to ProSe server, it still sends
registration request NAS signalling by a ProSe-enabled device to the ProSe
Server via eNodeB and MME. Since the eNodeB and MME have no capability to
check the UE\'s limits of authority and the eNB and MME just send this
signalling forward to the ProSe Server, the ProSe server finally deals with
the check. When it finds out the UE is not subscribed, the ProSe server shall
refuse to allocate ProSe ID.
Then the attacker will continually sends registration request signalling and
the ProSe server has to reply this request and continually check and refuse
this request. As a result, this process will bring DoS attack and performance
degradation in ProSe Server, even bring down the network.
#### 5.2.3.3 Security requirements
The network should take measures to detect the DoS attack so that the impact
from the attacker to ProSe server can be decreased.
NOTE: Existing security mechanism shall be reused whenever possible and
appropriate.
### 5.2.4 Key Issue #2.4: Application Registration for ProSe
#### 5.2.4.1 Key issue details
The following text replicates the procedure of Application Registration for
ProSe depicted in Annex I of TR 23.703 [4].
Editor\'s note: Annex I of TR 23.703 is a temporary home for this, so
reference will need to be updated later
When a user registers with a 3rd party application server (App Server), it is
designated an Application Layer User ID (e.g. ALUID_A for user A). This
procedure is out of 3GPP specification scope. Then to activate ProSe features
such as EPC-level ProSe Discovery for a specific application, the UE registers
the application with the ProSe Function, as illustrated in Figure 5.2.4.1-1
(copied from TR 23.703[4]).
{width="6.434722222222222in" height="2.2069444444444444in"}
Figure 5.2.4.1-1: Application registration for ProSe
> 1\. UE A sends Application Registration Request (EPUID_A, Application ID,
> ALUID_A) message to ProSe Function A to register an application for ProSe.
> EPSID_A is the EPC ProSe Subscriber ID for UE A. The Application ID is used
> to identify the 3^rd^ party App Server platform. EPUID_Ais user A\'s
> Application Layer User ID.
>
> 2\. ProSe Function A retrieves user\'s EPC ProSe Subscriber ID (EPUID_A).
> ProSe Function A may interact with the HSS in order to check whether the UE
> is authorized to register this application for ProSe. Alternatively, all
> user settings related to authentication and authorization for ProSe may be
> configured locally in ProSe Function A, in which case the interaction with
> the HSS is not needed.
>
> 3\. ProSe Function A sends a ProSe Registration Request (ALUID_A, EPUID_A,
> PFID_A) message to the App Server indicating that a user of this application
> (identified as ALUID_A) has requested to use ProSe for that application.
> PFID_A is the ProSe Function ID of ProSe Function A. If the App Server
> accepts the request, it stores the user\'s Application Layer User ID
> (ALUID_A) and EPC ProSe Subscriber ID (EPUID_A) together with the PFID_A.
>
> 4\. The App Server sends a ProSe Registration Response message to ProSe
> Function A indicating that the registration was successful (or not).
>
> 5\. ProSe Function A sends Application Registration Response (Allowed Range)
> message to UE A indicating that the registration was successful (or not).
> The Allowed Range parameter contains the set of range classes that are
> allowed for this application.
The following is the SA3 interpretation of this process:
  1. The EPUID is used by the ProSe function to verify user\'s authorization to use ProSe services, possibly with the assistance of the EPS HSS.
  2. The ALUID is assigned to the application user by the App server. Authentication and authorization of the ALUID forwarded by the ProSe function to the App server is a responsibility of the App server.
  3. When registering an Application for ProSe, App Server gets the EPUID and ProSe Function ID of the user and stores it in association with the ALUID. When the UE A later makes a Proximity Request for the targeted UE B, App Server is queried with ALUID_B and in response returns the EPUID and ProSe Function of UE B.
#### 5.2.4.2 Security threats
Since the ALUID is not part of a 3GPP user profile, it is not permanently
stored either in any HSS profile data or as a \"buddy list\" in ProSe
Function. The ALUID is only temporary stored in the ProSeFunction for the
duration in which the Application is registered in the ProSe Function.
Therefore App Server can\'t rely on the correctness of ALUID_A in message 3:
ProSe Registration Request. The ProSe UE, not otherwise authorized to use
selected application service resources, may maliciously use someone else\'s
ALUID in order to fraudulently obtain these resources.
#### 5.2.4.3 Security requirements
Security means have to be in place to ensure that the EPSID and the ALUID
belong to the same user.
## 5.3 Key Issues on One-to-many communications
### 5.3.1 Key Issue #3.1: One-to-many communications between Public Safety UEs
#### 5.3.1.1 Key issue details
There is a requirement for Public Safety ProSe UEs to be able to communicate
in a one-to-many fashion. Relating to this there is a requirement in TS 22.278
[2] for UEs to be able to start communication without first discovering the
receiving UE(s). This means that a UE shall unilaterally be able to start
sending encrypted one-to-many data packets that may be successfully decrypted
by other group members without knowing in advance which group members can
actually receive the data.
Groups may be very large, sometimes including hundreds of UEs. Interactions
with GCSE Group Communications may also need to be considered.
#### 5.3.1.2 Security threats
The following threats are identified as data is exchanged between any of the
UEs;
A passive attacker may intercept the data packets exchanged by the two UEs and
may be able to obtain their true/original content.
An active attacker may modify the data packets sent by a UE without detection
by either the sender UE or any of the receiver UEs.
Due to the one-to-many nature of the communication scenario at hand, it may
not be possible to fully protect against replay attacks of one-to-many
communications. For example, if a group member does not hear a particular
transmission, then it may well be possible to replay that transmission later
and have the UE accept this as a fresh transmission.
The threats against data integrity in one-to-many configuration do not seem to
be different from the threats for user plane between the UE and eNB. In
addition, encryption may also provide some additional level of protection
against sensible modifications. If we assume that no integrity protection is
used, and that the outsider attacker does not have a correct encryption key
used by the members in the one-to-many Group, then the received data packet
will most likely be discarded after decryption as either: corrupted,
meaningless or out-of-context, at the upper layers.
If NSPS organizations are not able to accept a one-to-many communication with
no integrity protection on PDCP user plane, then required integrity protection
should be provided at session layer (e.g. in SRTP) or at application layer.
#### 5.3.1.3 Security requirements
The system shall support providing the Public Safety ProSe UEs with the all
the necessary keying material and chosen algorithms that will be used protect
the data sent between the Public Safety ProSe UE(s). This material shall be
provided without requiring interaction between the Public Safety ProSe UEs.
Confidentiality of one-to-many communications should be provided for both the
in-coverage and out-of-coverage cases. Its use would be a configuration option
related to network operations and should hence be under control of the network
operator.
Integrity protection of one-to-many communications in PDCP layer is agreed to
not be supported.
Editor\'s note: Requirements on integrity protection and replay of the data on
application/session layer are FFS
Security mechanisms shall scale effectively to large groups, and be compatible
with rapid setup of group communications.
### 5.3.2 Key Issue #3.2: key distribution for group communications
#### 5.3.2.1 Key issue details
Several scenarios of SA2 TR 23.703 [4] require the presence of a security
mechanism to generate and distribute keys that could be shared by different
members of a ProSe Group. These shared keys could be used for one-to-many
communication when the ProSe-enabled UEs are in or out of network coverage. It
is possible to have a network-supported key distribution for group
communications.
For out of coverage scenario, when establishing ProSe one-to-many
communications in group owner mode it is necessary for the group owner to
generate a session key and distribute it to the group members, In
decentralized mode the group members will already have a common pre-shared key
but it is still desirable to use session keys to secure the communications in
order to limit the exposure of the pre-shared key. The group member initiating
the communication will need to generate and distribute the session key in this
case.
#### 5.3.2.2 Security threats
There are several threats related to key distribution for group
communications:
> In case that an attacker could eavesdrop a key to be shared between ProSe-
> enabled UEs then the attacker would be able to eavesdrop and/or modify all
> the communications protected with this shared key.
>
> In case that an attacker could modify or spoof a key to be shared between
> ProSe-enabled UEs then we could have the following impacts:
  * The different ProSe-enabled UEs of a ProSe Group may not share the same key and they could no longer communicate with each other. This attack could be considered as Denial of Service attack.
  * The different ProSe-enabled UEs may share a key chosen by the attacker. The attacker could take care to choose a weaker key. Then, the attacker could eavesdrop and/or modify all the communications protected with the chosen key.
> It is also possible for an attacker to perform replay attacks.
>
> In case that a key would be distributed to an unauthorized ProSe-enabled UE,
> this unauthorized ProSe-enabled UE could participate in all the
> communications within the ProSe group. The unauthorized member would know
> all the sensitive information exchanged between the members of the ProSe
> Group. He could also provide false information to the other members of the
> ProSe Group, which could have serious impacts.
If a ProSe group member does not receive the shared key or session key then
they will not be able to communicate with the other group members. This can
happen when:
\- The UE is out of network coverage during an update of the shared key.
\- The UE attempts to join a group communication already in progress.
#### 5.3.2.3 Security requirements
The shared keys and session keys, when used for out of coverage scenario,
shall be protected in integrity and confidentiality during their distribution.
Editor\'s Note: The type of key to be protected is FFS.
Only authorized ProSe-enabled UEs shall receive the shared keys.
It should be possible to authenticate the network entity distributing the
shared keys or the group member distributing the session keys.
Note: expired keys may need to be kept.
It should be possible for the UE to store shared keys for past and future
cryptoperiods.
The mechanism for distributing session keys should support late entry to group
communications.
### 5.3.3 Key issue #3.3: ProSe one-to-many communication in decentralized
mode
#### 5.3.3.1 Key issue details
It is proposed to pre-provision the security key in all the group members for
the group communication in TR 23.703 for c5, c6, c8. This pre-shared key may
used directly or as basis for one-to-many communication of decentralized
mode.\ The authentication between ProSe UEs may be implicit in this
decentralized mode communication to reduce the number of authentication
procedures.
The security key for group members needs to be able to be distributed or
updated to support creation and modifications of groups. This modification or
distribution process needs to be straight-forward and efficient to allow
groups in a public safety network to be reasonably dynamic.
NOTE：Pre-provisioned key is one option for security and it does not exclude
any other options.
#### 5.3.3.2 Security threats
The pre-shared key is the basis of the group communication. In case the
attacker gets hold of the pre-shared key stored in the ProSe UEs, then the
attacker would be able to eavesdrop and/or modify the communication data on
multicast mode which is protected using this pre-shared key.
In case the key is used for a sufficient long time, the attacker may deduce
some information on security key from the received protected data. Then the
attacker may obtain the original content sent in multicast mode.
#### 5.3.3.3 Security requirements
The pre-provisioned key should be securely stored in the ProSe UE.
The security key should not be used when required by the group manager, its
lifetime expires or when it is considered to be not secure any more.
### 5.4 Key Issues on other areas
### 5.4.1 Key Issue #4.1: ProSe enabled UE security aspects
#### 5.5.1.1 Key issue details
Generally speaking, in the internal architecture of a ProSe-enabled UE various
layers can be identified (e.g. EPS layer, Operating System layer, Application
layer).
Depending on the solution chosen, ProSe functionalities can be implemented in
a ProSe enabled UE at the EPS layer and/or involving upper layers. Examples of
such ProSe functionalities are: authorization of starting discovery
(announce/monitor) by the application, allocation of codes to be announced,
detection and processing of codes.
UE procedures at EPS layer are subject to 3GPP conformance tests, whereas
Operating System and application layer logic are not tested by 3GPP.
The implementation of ProSe functionalities at a layer that is not subject to
3GPP conformance tests may lead to unpredictable UE (mis)behaviour, depending
on different device implementations.
#### 5.4.1.2 Security threats
Preventing possible attacks to the Operating System and/or to the Application
layer might be very difficult, if not potentially impossible. Moreover,
functionalities implemented at Application /OS layers are not subject to 3GPP
conformance tests and thus their operations cannot be predictable.
#### 5.4.1.3 Security requirements
Void
### 5.4.2 Key Issue #4.2: Ensuring a trusted and reliable accounting
#### 5.4.2.1 Key issue details
A trusted and reliable accounting is a crucial point for the relationship
between MNOs and end users.
Referring to the ProSe service, this applies in general, both for Public
Safety ProSe UEs and for the non-Public Safety ProSe UEs.
According to the Rel-12 prioritization, non-Public Safety ProSe UEs will
operate always \"in-coverage\", whilst Public Safety ProSe UEs may operate
(e.g. for the \"one-to-many communication\" ProSe feature) both \"in
coverage\" or \"out of coverage\".
Since non network based accounting mechanisms are deemed to more prone to
possible attacks, there is no justification to deviate from the existing
principle of a trusted and reliable network-based accounting, wherever
possible (e.g. for\ \"in coverage\" ProSe scenarios). However, \"out of
coverage\" Public Safety ProSe (one-to-many communications are in the scope of
Rel-12) will probably require non network-based accounting mechanisms that
rely on ProSe UEs, since network is not involved in the communication.
Credit control (especially prepaid) and usage information for post-paid
charging are of commercial interest for the ProSe scenarios, but there are
cases where a network-based accounting mechanism can not be performed (e.g.
potentially for the Public Safety ProSe \"out of coverage\" scenario of
Rel-12). The security issue with the non network-based charging is that
charging information provided from compromised/malicious UEs might be subject
to manipulation (under report).
#### 5.4.2.2 Security threats
Non network based accounting mechanisms are deemed to more prone to possible
attacks/manipulation as they might be exploited by the ProSe end
user/application to perform security violations against the MNO such as theft
of service, e.g. by tampering the UE to properly manipulate (under-report) the
accounting information.
#### 5.4.2.3 Security requirements
For a trusted and reliable accounting, the VPLMN/HPLMN shall be able to
produce CDRs for ProSe services.
For \"out of coverage\" (Public Safety) ProSe scenarios CDRs created based on
possible non-network based accounting mechanisms shall be trusted and
reliable.
Charging information shall be securely collected and communicated by the ProSe
enabled UE to the network, so that the operator may trust the accounting
information.
### 5.4.3 Key Issue #4.3: Data communication security between ProSe network
entities
#### 5.4.3.1 Key issue details
ProSe network entities will be required to communicate with each other.
#### 5.4.3.2 Security threats
There are several threats to the communication between ProSe network entities
including forged or replayed messages and eavesdropping on the contents of the
messages.
#### 5.4.3.3 Security requirements
The ProSe network entities shall be able to authenticate the source of the
received data communications.
The transmission of data between ProSe network entities shall be integrity
protected.
The transmission of data between ProSe network entities shall be
confidentiality protected.
The transmission of data between ProSe network entities shall be protected
from replays.
> Note: The requirements of this clause do not apply to ProSe UEs and ProSe
> UE-to-Network Relays.
### 5.4.4 Key Issue #4.4: Protection of UE identity for ProSe direct discovery
#### 5.4.4.1 Key issue details
A ProSe enabled UE sends a Discovery Request message to announce, monitor and
report match of direct discovery.\ As specified in the TS 23.303 (clause
5.3.3), the Discovery Request message includes a UE identity parameter that
identifies the UE subscription and can be the e.g. IMSI or MSISDN.
IMSI is the permanent identity of subscriber and is subject to privacy of
subscriber. MSISDN is configurable by end user or applications of a UE (e.g.
using OMA DM or user\'s manual configuration).
#### 5.4.4.2 Security threats
If IMSI is used to identify the UE subscription , an attacker may intercept
the data packets of Discovery Request messages and is able to obtain the IMSI
of the requesting UE.
If MSISDN is used to identify the UE subscription, the end user or
applications of the ProSe enabled UE may manipulate the MSISDN to be sent to
the ProSe Function, thus causing improper Discovery Request.
#### 5.4.4.3 Security requirements
The transmission of UE identity shall be confidentiality protected.
The transmission of UE identity shall be integrity protected.
Editor\'s Note: The solution of the protection of the UE identity is FFS.
### 5.4.5 Key Issue #4.5: Security for EPC support WLAN direct discovery and
communication
#### 5.4.5.1 Key issue details
The EPC support WLAN direct discovery and communication consist of the
following procedures based on TS 23.303 [20].
> 1\. WLAN direct Group setup with assistance information from EPC
>
> 2\. WLAN direct group establishment and WLAN direct communication between
> UEs
#### 5.4.5.2 Security threats
There are several threats to the communication between ProSe-enabled UEs and
Prose Function, or to the communication between ProSe-enabled UEs, such as
eavesdropping and replay attack.
#### 5.4.5.3 Security requirements
Procedure 1 includes traffic between Prose UE and Prose Functions ProSe-
enabled UEs and Prose Function, therefore the requirements in clause 5.3.2 for
configuration of ProSe-enabled UEs shall be applied to this case.
Procedure 2 includes traffic between the ProSe-enabled UEs. Therefore, the
following requirements have to be satisfied;
The communication data between ProSe UEs should be protected. UEs, therefore,
the communication data between ProSe-enabled UEs should be protected.
# 6 Solutions for Rel-12
## 6.1 Solutions for configuration data transfer
### 6.1.1 Solution #6.1: Security for configuration data transfer
#### 6.1.1.1 General
This solution addresses key issue #1.1 in the current specification and is the
security part of solution D1 in TR 23.703 [4].
#### 6.1.1.2 Overview of solution
In solution D1 from TR 23.703 [4], the UE gets the authorization for direct
services from the DPFs of the local PLMNs. The UE and local DPF use TLS to
protect the traffic between them. Standard GBA/GAA authentication can be used
to for authentication between the UE and local DPF (NAF) with a TLS-PSK
ciphersuite to protect the traffic\ (see TS 33.222 [5]). For Public-safety UEs
that support certificates, mutual certificate based authentication in TLS
should be used. It is assumed that in this case the UE would be pre-
provisioned with the relevant certificates to use with the local PDF.
### 6.1.2 Solution #6.2: Security for configuration data transfer
#### 6.1.2.1 General
This solution addresses key issue #1.1 in the current specification and
protects reference point PC3 in TR 23.303 [20]. The solution does hence not
cover the case of provisioning ProSe APP configuration data directly from the
ProSe APP server to the UE; a separate solution is needed to cover that case
as well. This solution can solve the case when the ProSe APP server delegates
the provisioning of its parameters to the ProSe Function. The ProSe APP server
then transfers its ProSe APP configuration data to the ProSe Function over
PC2, and the ProSe Function forwards also the ProSe APP configuration data to
the UE over the PC3 reference points.
#### 6.1.2.2 Overview of solution
The UE is authenticated by using Authentication and Key Agreement (AKA). The
UE and ProSe Function are mutually authenticated using AKA procedures. After
UE is authenticated, the reference point between UE and Prose Function is
protected by IPSec.
For Public-safety UEs that support certificates, mutual certificate based
authentication in TLS should be used.\ It is assumed that in this case the UE
would be pre-provisioned with the relevant certificates to use with the local
PDF.
Editor\'s note: Relationship between AKA and IPsec needs to explained.
The applicability to visited networks can be referred to the TS 23.303 Figure
4.2-3 roaming reference architecture, and ProSe function in the visited
network can retrieve the AV needed for AKA from the ProSe function in the home
network.
#### 6.1.2.3 Solution description: keys establishment procedure for PC3
The ProSe function can interact with the HSS to retrieve the authentication
data in order to authenticate the UE for ProSe service. The ProSe function
retrieves the ProSe AV from the HSS and performs AKA with ProSe UE to share
IK\', CK\' with the Prose UE, and uses the IK\'\|\|CK\' as the integrity
protection and encryption keys needed for PC3 security protection. The content
of the ProSe AV includes {RAND, XRES, IK\', CK\', AUTN}.
{width="5.6097222222222225in" height="2.4715277777777778in"}
**Figure 6.1.2.3-1: PC3 security protection keys establishment procedure**
1\. The ProSe UE sends its IMSI to the ProSe Function in the registration
request message.
2\. The ProSe Function includes UE\'s IMSI and the ProSe Function\'s ID in the
ProSe authentication data request message to the HSS to retrieve the ProSe
authentication vector.
3\. After the HSS derives CK, IK, the HSS derives CK\'\|\|IK\' =KDF (CK\|\|IK,
Prose Function ID,SQN⊕ AK).
4\. The HSS sends the AV including CK\', IK\' to the ProSe Function.
5\. The ProSe function sends ProSe authentication request to the ProSe UE,
6\. The ProSe UE authenticates the network, derives CK, IK, and then the UE
derives CK\'\|\|IK\'=KDF(CK\|\|IK, Prose Function ID,SQN⊕ AK)
7\. The ProSe UE sends ProSe authentication response to the ProSe function,
which authenticates the UE.
8\. The ProSe Function sends the registration response message.
Editor\'s note: The Synchronization issue of the SQN and the HSS load are FFS.
#### 6.1.2.4 Solution evaluation
GBA framework could also be used to protect the reference point between the UE
and the ProSe Function.\ The ProSe Function would play the role of the NAF as
defined in GBA framework specified in 3GPP TS 33.220.\ After the establishment
of the NAF key (Ks_(ext/int)_NAF) between the UE and the ProSe function, PSK-
TLS procedure could be performed between the UE and the ProSe function.
The solution described in this clause relies on a direct interface between the
ProSe Function and the HSS, and the usage of such a direct interface to the
HSS was discussed several times in 3GPP SA3. When GBA was under definition
several architectures were discussed and analyzed to lead to GBA architecture.
HSS-related design guidelines for a security architecture was provided and the
BSF (Bootstrapping Server Function) of GBA was created to avoid direct
interface between Application Servers and the HSS.
Direct access to the HSS should be avoided when an alternative solution,
already specified, is available and fulfils the requirements.
#### 6.1.2.5 Solution Analysis
Editor\'s note: For AKA solution, the impact of synchronization errors between
UICC and HSS is FFS
Editor\'s note: For AKA solution, since for each authentication request a
request to the HLR will be made, load on HSS is FFS
Editor\'s note: For AKA solution, how will roaming be done, when the ProSe
server is residing in another operator network, is FFS
The benefits of this solution are analyzed as the following:
1\. No extra network entity is required for the AKA-based solution
Editor\'s note: For AKA solution, the security risks by adding an additional
interface to HLR/HSS are FFS.
> As shown in the Fig. 6.1.2.5-1, on the network side, for the AKA-based
> solution, the key distribution is from the HSS to the ProSe Function
> utilizing the PC4a interface, but for the GBA-based solution, the BSF is
> needed for the purpose of the key distribution.
{width="5.522916666666666in" height="2.928472222222222in"}
Fig. 6.1.2.5-1 Network entities and interfaces involved for different
solutions
2\. Evaluation of interface for AKA based solution
> For the AKA-based solution, the ProSe Function utilizes the existing network
> interface. As described in the TS 23.303, the interface between the ProSe
> Function and the HSS is PC4a, and it is used to provide subscription
> information in order to authorize access for ProSe Direct Discovery and
> ProSe Direct Communication on a per PLMN basis. It is used by the ProSe
> Function (EPC-level ProSe Discovery Function) for retrieval of EPC-level
> ProSe Discovery related subscriber data. Therefore, for security purpose,
> the PC4a interface can be reused to provide key material for PC3 interface.
>
> The design purpose of GBA is to limit the number of different types of
> interfaces to the HSS. One raison is to keep the complexity of the HSS low.
> The GBA base solution for configuration data security does not avoid the
> PC4a interface between the ProSe function and the HSS.
>
> For the GBA-based solution, the ProSe function entity needs to support the
> extra interface Zn to the BSF, in order to receive the keys, as shown in the
> Fig. 6.1.2.5-1. The presence of the BSF allows to decrease the consumption
> of Authentication Vectors by deriving a bootstrapped key.
3\. Evaluation of HSS handling for ProSe service for AKA solution
> As described in the TS 23303, the authorization information and the
> subscriber data for ProSe service is provided from the HSS to the ProSe
> Function through PC4a interface, and the above information and data request
> security protection, so as the ProSe AV.
### 6.1.3 Solution #6.3: Security for configuration data transfer
#### 6.1.3.1 General
This solution addresses key issue #1.1 in ProSe scenarios when the
configuration data of ProSe-enabled UE are stored in the UICC. After
deployment of the ProSe-enabled UE the configuration parameters stored in the
UICC may need to be updated to reflect the changes in the configuration
applied by the operator.
Editor\'s note: it needs to be clarified if the configuration data is only for
network operations or also ProSe APP configuration data. If it is also the
latter it needs to be clarified under which circumstances it is applicable to
store it on the UICC.
#### 6.1.3.2 Overview of solution
In case that configuration data of ProSe-enabled UE are stored in the UICC,
the UICC OTA mechanism (as specified in ETSI TS 102 225 [8] / TS 102 226 [9]
and 3GPP TS 31.115 [10] / TS 31.116 [11]) is used to secure the transfer of
the configuration data to be updated in the UICC.
## 6.2 Solutions for Discovery
### 6.2.1 Solution #2.1: Security for ProSe discovery
#### 6.2.1.1 General
This clause provides a security solution for ProSe discovery procedure in Key
issue #2.1.
#### 6.2.1.2 Solution description
Potential security solutions for security requirements given in clause 5.2.1.3
are discussed below.
  1. Without network interaction, as shown in Figure 6.2.1.2-1:
a. UEs participating in discovery can share a pre-configured secret. The UEs
can derive session keys from the secret to protect and verify the discovery
request and response messages.
b. UE may be allocated a certificate for discovery use which can be verified
by the other UEs with or without network support.
{width="2.66875in" height="2.216666666666667in"}
Figure 6.2.1.2-1: Secure discovery procedure, without network interaction
Editor\'s note: If certificates are used, then revocation etc., need to be
considered.
  1. With network interaction, as shown in Figure 6.2.1.2-2:
a. UE and network entity (e.g. ProSe Function) share a secret such that UE and
the network entity can perform integrity protection and verification of the
discovery request and response messages.
UE and ProSe Function should perform mutual authentication at registration
phase. Such mutual authentication was agreed in clause 6.1.2, and registration
to ProSe Function can be found in SA2 TR 23.703 [4] solution D4, D8 and D11.
After the mutual authentication, UE and ProSe Function can share a secret,
from which UE and ProSe function can derive subkeys. The subkeys will be used
for Discovery Request and Discovery Response integrity protection and
verification, in case of discovery with network interaction.
NOTE: when UE only interacts with eNB and/or MME, the current SAE/LTE security
may be sufficient.
{width="3.8319444444444444in" height="2.625in"}
Figure 6.2.1.2-2: Secure discovery procedure, with network interaction
Editor\'s note: This clause may need to be aligned with SA2 and RAN2 decisions
once these are made.
### 6.2.2 Solution #2.2: Security for Direct Discovery
Editor\'s note: Applicability to which SA2 solutions is FFS
#### 6.2.2.1 Using Asymmetric Cryptography and Timestamp for Direct Discovery
Potential solution to prevent replay and impersonation attack is to digitally
sign the discovery message using private key of the transmitting Prose UE
along with time stamp, as shown in Fig 6.2.2.1-1. Announcing ProSe UE signs
the discovery information using its Private Key and time stamp of radio frame.
Monitoring ProSe UE verifies the received discovery information using the
Public key of the announcing UE and time stamp of radio frame in which the
digitally signed discovery information is received. If verification is
successful, then discovery information is sent to upper layer otherwise it is
discarded.
The time stamp used in this solution, is the time stamp of the radio frame in
which the discovery message is transmitted (additionally subframe number can
also be used, one radio frame has 10 subframes and discovery message is
transmitted in one of the subframe), which will be in sync between the
announcing and monitoring Prose UEs (by using the \'TimeInfoUTC\' field in SIB
16 of the macro eNB, see TS 36.331[13]). Discovery information protection and
verification is performed at the AS layer. The AS layer decides the radio
frame and the subframe in which discovery information is transmitted, as the
AS layer has the time stamp information of the radio frame. By using the
Timestamp of the radio frame and may also sub-frame number, the overhead
introduced to carry the absolute time stamp in the discovery message is
avoided and also use of non-sync system time of the ProSe UE is avoided.
Asymmetric security keys can provide protection against impersonation by
monitoring ProSe UE, especially for one to many communication scenarios.
Public Key of the ProSe UE or application is provided to ProSe server securely
and ProSe server distributes the Public Key to the authorized ProSe UEs for
discovery information verification.\ Once the Prose UE get authorized and
configured for ProSe discover, then the ProSe UE starts sending its
announcement for other UEs to discover it. The announcement message is
digitally signed using its private key and the announcement message carries
the digital signature. When this announcement is received by other prose UEs
which are in interest to communicate with this UE, would have obtained public
key of this UE from the ProSe Server.\ So the monitoring ProSe UEs verifies
the authenticity of the announcement message. This mechanism is applicable for
both Open and Restricted discovery in order to protect a discovery message
against replay and impersonation attacks. Further this solution provide option
to the network to restrict the discovery announcements by distributing only
authorized UE\'s public key to other Prose UEs.
Editor Notes: Mechanism to distribution Public Key is FFS. Requirement for the
mechanism for dynamic distribution of public keys is FFS. Details of the
solution when roaming are FFS
{width="5.145833333333333in" height="2.607638888888889in"}
Figure 6.2.2.1-1: Security mechanism for Direct Discovery
Editor\'s note: It is FFS how this solution is applicable for confidentiality
protected Discovery Information in restricted discovery
Editor\'s note: Details of on the message size and how it fits into discovery
frames is FFS
### 6.2.3 Solution #2.3: Solution against DOS attack in registration procedure
#### 6.2.3.1 General
This solution addresses key issue #2.3 in the current specification and gives
the security solution of the registration process in ProSe discovery.
A ProSe enabled UE first initiate a registration process before it gets ProSe
ID to communicate with other ProSe enabled UEs. Then the ProSe server verifies
the subscription of the UE to see whether the indicated Open/Restrictive ProSe
service is subscribed.
There is a threat in this procedure. An attacker can utilize the registration
procedure to send many signalling to ProSe Server to fake a subscribed UE,
which can cause ProSe Server huge consumption.
There are two options to deal with this attack.
6.2.3.2 Option1: Blacklist:
In this solution, when there are more than one registration requests from the
same UE, the ProSe Server will check how much requests this UE has sent before
in a period of time. If the amount of requests exceeds the preset threshold
(based on a local policy), the ProSe Server might decide to ignore all such
request from the same UE for a period of time.\ The ProSe Server will set a
blacklist which keeps a list of the misbehaving UEs,. In order to set and
maintain this blacklist the ProSe Server collects information from which UE
the requests are sent. The subscription ID or UE ID could be a part of the
registration request message or could be added by other network entities e.g.
MME. When the ProSe Server receives a registration request, it will first
check whether this UE is in the blacklist. The request from the UE which is in
the blacklist will be discarded. UEs\' ID that stayed in blacklist for more
than n hours without trying to re-register might be deleted from the list.
Editor\'s note: It is FFS whether this solution leads to a new DoS
vulnerability.
#### 6.2.3.3 Option 2: Captcha
In this solution, the UE who sends a ProSe registration request to the ProSe
Server receives a captcha from the ProSe Server instructing the UE of the
minimum allowable delay between any two consecutive ProSe registrations.
This method can stretch the time between the UE attempts to send two
consecutive registrations to the ProSe server and avoiding the DOS attack from
the terminal side.
{width="6.686111111111111in" height="3.9256944444444444in"}
Fig 6.2.3.3-1: procedure of registration against DOS attack
  1. The attacker uses a ProSe-enabled device to perform LTE attach procedure after power on and establishes a PDN connection to PGW.
  2. The application running in this UE asks the EPS layer in UE to send the request message that includes application id and open/restrictive indication to the ProSe Server.
  3. The EPS layer in UE sends a ProSe registration request the ProSe server. The registration request includes the application identity, and the open/restrictive indication.
  4. The ProSe server determines based on the UE\'s subscription and behaviour, if captcha is required.
  5. If yes, the ProSe server sends the captcha request to the UE. The captcha is presented to the user.
  6. The UE sends back the captcha response to the ProSe server
  7. The ProSe server verifies captcha response, verifies and authorizes the registration.
### 6.2.4 Solution #2.4: Security for discovery with network checking
#### 6.2.4.1 General
This solution addresses key issues #1.1, #2.2 and #4.3 in the current document
and is the security part of solution in clause 5.3 of TS 23.303 [20].
#### 6.2.4.2 Overview of solution
The solution proposed in clause 5.3 of TS 23.303 [20] describes several
procedures. These are the following:
1\. The Service Authorization procedure: The UE contacting the ProSe
function(s) in the network in order to obtain authorization to use direct
discovery in the various PLMNs. This step also includes the ability of the
network to revoke authorization with via a push message.
2\. The Discovery Request procedure: This allows an announcing and monitoring
UE to obtain the necessary configuration information to be able to announce a
code or monitor for codes on a particular PLMN. Among other things, the
configuration information includes the codes to be announced or monitored for
and for announcing UE only the key that is used to integrity protected the
code during its announcement.
3\. The Discovery procedure: The code is announced by the announcing UE and
received by the monitoring UE
4\. The Match Report procedure: This allows a code received by the monitoring
UE to be checked and confirmed by the network. As part of this procedure the
network checks the integrity protection on the received code and also provides
the UE with the ProSe App Id Name of that code and possibly the meta-data
corresponding to the that code.
1, 2 and 4 above all include the possibility to exchange traffic between ProSe
functions in different PLMNs.\ Analyzing the above procedures 1, 2, and 4
require the security requirements in Key issue #1.1 on protecting
configuration data to be satisfied (strictly 4 is not about configuration data
but has the same requirements).\ Steps 1, 2 and 4 also require the protection
of traffic between network entities and hence require the security requirement
in key issue #4.3.\ Finally, for open discovery the security requirements in
key issue #2.2 needs to be satisfied.
The following subclauses detail the proposed security solution to each of the
key issue above.
#### 6.2.4.3 Security procedures
##### 6.2.4.3.1 Protection of Interface between the UE and ProSe Function
using GBA
For UE initiated messages, PSK TLS with GBA based shared key-based mutual
authentication shall be used between UE and ProSe Function as specified by
clause 5.4 of TS33.222 [5].
The ProSe Function (NAF) shall request USSs from the BSF when requesting the
Ks_(ext/int)_NAF key and the ProSe Function shall check in the USS if the USIM
is authorized to be used for ProSe services. If the authorization in the ProSe
Function fails then the ProSe Function shall release the PSK-TLS connection
with the UE.
For network initiated messages one of the following mechanisms shall be used:
> \- If a PSK TLS connection has been established as a part of a pull message
> and is still available, the available PSK TLS session shall be used.
>
> \- Otherwise, PSK TLS with GBA push based shared key-based mutual
> authentication between the UE and the ProSe Function shall be used. GBA push
> is specified in TS 33.223 [7]. The ProSe Function (pushNAF) shall requests
> USSs from the BSF when requesting a GPI, and the ProSe Function shall check
> in the USS if the USIM is authorized to be used for ProSe services. If the
> authorization in the ProSe Function fails then the ProSe Function shall
> refrain from establish PSK TLS with GBA push.
NOTE: If a TLS connection is released, it can only be re-established by the
client side, I.e. UE, even though the TLS session including security
association would be alive on both sides. TLS connection, in turn, is
dependent on the underlying TCP connection.
##### 6.2.4.3.2 Interface between network elements
For all interfaces between network elements,
> • TS 33.210 [18] shall be applied to secure signalling messages on the
> reference points unless specified otherwise, and
>
> • TS 33.310 [19] may be applied regarding the use of certificates with the
> security mechanisms of TS 33.210 [18] unless specified otherwise in the
> present document.
NOTE: For the case of an interface between two entities in the same security
domain, TS 33.210 [18] does not mandate the protection of the interface by
means of IPsec.
##### 6.2.4.3.3 Integrity protection and validation of the transmitted code
for open discovery
###### 6.2.4.3.3.1 Open discovery security flows
The announced code is integrity protected as shown in the following flow which
includes only the additional security parameters. The system is assumed to
ensure that there is a UTC based time counter parameter that is known to both
the announcing and monitoring UEs, as clarified in the latest LS (see
S3-140566). The message flows apply when both the UEs are roaming or when one
or both are in the HPLMN.
Note that integrity protection via this MIC furthermore enables the ProSe
Function to verify that the announcing UE was indeed authorized to announce
this ProSe App Code at that time instance.
Figure: 6.2.4.3.3.1-1: Integrity protection of the transmitted code
1\. The Announcing UE sends a Discovery Request message containing the ProSe
Application ID name to the ProSe Function in its HPLMN in order to be allowed
to announce a code on its serving PLMN (either VPLMN or HPLMN).
2./3. The ProSe Functions in the HPLMN and VPLMN of the announcing UEs
exchange Announce Auth. messages. There are no changes to these messages for
the purpose of protecting the transmitted code for open discovery.\ If the
Announcing UE is not roaming, these steps do not take place.
4\. The ProSe Function in HPLMN of the announcing UE returns the ProSe App
Code that the announcing UE can announce and a 128-bit Discovery Key
associated with it. The ProSe Function stores the Discovery Key with the ProSe
App Code. In addition, the ProSe Function provides the UE with a CURRENT_TIME
parameter, which contains the current UTC-based counter at the ProSe Function
and a MAX_OFFSET parameter, which indicates the maximum counter difference
between the counter held in the UE (\"UE clock\") and the UTC based counter
value associated with the discovery slot. The UE sets its clock to the value
of CURRENT_TIME UTC based counter and stores the MAX_OFFSET parameter,
overwriting any previous values.
NOTE: The MAX_OFFSET defines the size of the window during which the announced
code could be replayed.
5\. The UE starts announcing. In each slot that it announces, if the UTC based
counter provided by the system for the discovery slot is within the MAX_OFFSET
of the announcing UE\'s clock, the announcing UE calculates a 32-bit Message
Integrity Check (MIC) to include with the ProSe App Code in the discovery
message. The MIC is calculated as described in subclause 6.2.5.3.3.2.
6\. The Monitoring UE sends a Discovery Request message containing the ProSe
Application ID name to the ProSe Function in its HPLMN in order to get the
ProSe App Code(s) that it wants to listen for.
7/8. The ProSe Functions in the HPLMN of the monitoring UE and VPLMN of the
announcing UEs exchange Monitor Req./Resp. messages. There are no changes to
these messages for the purpose of protecting the transmitted code for open
discovery.
9\. The ProSe Function returns the ProSe App Code(s) along with the
CURRENT_TIME, UTC based counter, and the MAX_OFFSET parameters. The UE sets
its clock to CURRENT_TIME and stores the MAX_OFFSET parameter, overwriting any
previous values.
10\. The Monitoring UE listens for a discovery message that contains a ProSe
App Code that it is interested in.
11\. On hearing such a discovery message, if the UTC based counter provided by
the system for that discovery slot is within the MAX_OFFSET of the monitoring
UE\'s clock, the Monitoring UE sends a Match Report message to the ProSe
function containing the UTC based counter parameter related to the slot where
it heard the announcement and the discovery message including the ProSe App
Code and MIC.
12\. The ProSe Function in the HPLMN of the monitoring UE passes the discovery
and associated UTC based counter time parameter to the ProSe Function in the
VPLM of the announcing UE in the Match Report message.
13\. The ProSe Function in the HPLMN of the announcing UE checks the MIC is
valid. The relevant Discovery Key is found using the ProSe App Code.
14\. The ProSe Function in the HPLMN of the announcing UE acknowledges a
successful check of the MIC to the ProSe Function in the HPLMN of the
monitoring UE in the Match Report Ack message.
15\. The ProSe Function in the HPLMN of the monitoring UE returns an
acknowledgement that the integrity checked passed to the Monitoring UE. The
ProSe function returns the parameter ProSe Application ID name to the UE.\ It
also provides the CURRENT_TIME, UTC based counter parameter, by which the UE
(re)sets its clock.
6.2.4.3.3.2 Calculation of the MIC value
When calculating a MIC using the Discovery Key, the following parameters shall
be used to form the input S to the KDF that is specified in Annex B of TS
33.220 [6].
> \- FC = to be allocated if there is normative work here
>
> \- P0 = Time parameter provided by the network for that discovery slot
>
> \- L0 = length of above (which is FFS)
>
> \- P1 = Contents of the discovery message excluding the MIC
>
> \- L1 = length of above (which is FFS)
The Discovery Key, Time parameter and discovery message follow the encoding
also specified in Annex B of TS 33.220 [6].
Editor\'s note: The discovery messages contain all the parameters transmitted
over the air as it is expected that all of these need to be included the MIC
calculation. Whether it is better to have just discovery message or encode the
separate parameters in the discovery message as distinct Pi parameters in the
above KDF is FFS.
### 6.2.5 Solution #2.5: Security for discovery response
#### 6.2.5.1 General
This solution addresses key issue #2.1 in the current document. Direct
Discovery procedure is described in SA2 TS 23.303 [20] for Rel-12. Note that
no signalling flows have been provided to the SA2 TS 23.303 [20] for Model B.
This solution is therefore based on some assumptions on possible combinations
of broadcasted identities in Direct Discovery Request message and Direct
Discovery Response message.
#### 6.2.5.2 Overview of solution
In the discussion below the term \'Discoverer UE\' could be mapped to either a
\'Discoverer UE\' as defined in Model B in TS 23.303 [20] or an \'Announcing
UE\' as defined in Model A in TS 23.303 [20].
In the discussion below the term \'Discoveree UE\' could be mapped to either a
\'Discoveree UE\' as defined in Model B in TS 23.303 [20] or an \'Monitoring
UE\' as defined in Model A in TS 23.303 [20].
When the Discoverer UE wishes to discover users in vicinity, it broadcasts a
Direct Discovery Request message.
The Discoveree UE process the Direct Discovery Request message and based on
the information in the Direct Discovery Request message the Discoveree UE\'s
may decide to respond with a Direct Discovery Response message.
When the Discoverer UE receives the Direct Discovery Response message, then
the Discoverer UE:
  * Needs to ensure that the Discoveree UE is authentic and that the Direct Discovery Response message is not replayed by a false UE, and
  * Needs to ensure that the Discoveree UE is authorized by the ProSe Function in the network to respond to the announced Direct Discovery Request message.
This solution proposes that a Token is included in the Direct Discovery
Response message from the Discoveree UE to the Discoverer UE.
Figure 6.2.5.2-1: Generation of Token
The Token is calculated by the ProSe Function in the network and provided to
the Discoveree UE. The Discoveree UE includes the Token in the Direct
Discovery Response message back to the Discoverer UE.
The Discoverer UE calculates the Token and compares it with the broadcasted
Token in the Direct Discovery Response message. If the Tokens are equal then
the Discoverer UE knows that the Discoveree UE is authentic and authorized to
respond and the Direct Discovery Response message is not a replayed Direct
Discovery Response message.
#### 6.2.5.3 Signalling flows
An example of a detailed signalling flow can be found below in the Figure
6.2.5.3-1 below.
Figure 6.2.5.3-1: Security for Model B
  1. The Discoverer UE sends a Discovery Request message to the ProSe Function in the network in order to request to be allowed to announce a ProSe code on that PLMN. The ProSe Function returns the Discovery Response message containing a ProSe App Code that the Discoverer UE can announce and a Discovery Key associated with it. The ProSe Function stores the Discovery Key with the Discovery Request message.
  2. The Discoverer UE starts announcing the Direct Discovery Request message.
  3. The Discoveree UE sends a Discovery Request message to the ProSe Function in the network in order to get the ProSe App Code that it wants to listen to. The ProSe Function in the network returns the ProSe App Code to the Discoveree UE.
  4. The Discoveree UE listens for announced codes that contain a ProSe App Code that it is interested in.
  5. On hearing such an announced code, the Discoveree UE sends a Match Request containing the \'timevalue\' parameter related to the slot it heard the announcement and the announced code, I.e. the ProSe App Code and MIC, together with any other potential included identity in the Direct Discovery Request message.\ The Discoveree UE also sends an indication that it wants to announce a Direct Discovery Response message if the match is successful.
  6. The ProSe Function in the network verifies the received ProSe App Code and MIC and if verification is successful, then the ProSe Function in the network generates a Token.
  7. The ProSe Function in the network provides the Token to the Discoveree UE.
  8. The Discoveree UE starts to broadcast the Direct Discovery Response message including the Token.
  9. The Discoverer UE listens for Direct Discovery Response message and receives the Direct Discovery Response message which it is interested in.
  10. The Discoverer UE verifies the Token using the Discovery Key. If the verification is successful then the Discoverer UE knows that authentic Discoveree UE is within proximity.
#### 6.2.5.4 Token
Token = MAC (First parameter, Second parameter, Third parameter, Fourth
parameter)
The First parameter could provide some freshness. Example of parameters which
could provide this:
  * ProSe App Code. The ProSe App Code included in the Direct Discovery Request message, which could provide freshness in a time window. The ProSe App Code is constructed by the ProSe Function in the network and has an associated validity timer. When the validity timer expires then the ProSe App Code is no longer valid.
  * Time stamp or time value.
The Second parameter could make it difficult to forge tokens. Example of
parameter which could be used:
  * Discovery security key. The Discovery security key can be shared by the Discoverer UE and the ProSe Function in the network.
The Third parameter could make the token unique per Discoveree UE. Example of
parameter which could be used:
  * Discoveree UE identity as ProSe UE identity.
The Fourth parameter could map the Direct Discovery Response to the Direct
Discovery Request. Example of parameter which could be used:
  * ProSe App Code. The ProSe App Code included in the Direct Discovery Request message. Note that if ProSe App Code has been used in the First parameter then it would not be needed to include it twice.
Editor\'s Note: Other possible parameters of the Token are FFS.
### 6.2.6 Solution #2.6: Security for proximity request authentication and
authorization
#### 6.2.6.1 General
The following solution addresses the key issue #2.2.
The ProSe Function of two UEs may belong to different PLMNs and, according to
the current version of TS 23.303 [20], the application server is the entity
which discloses the EPUID of a particular target UE to a ProSe Function so
that it can request to the Prose Function managing that target UE the sending
of its location information for a particular period of time.
However, no mechanism currently exist to ensure that the ProSe Function
requesting the location information of that particular target UE has genuinely
been requested by the UE itself, not the ProSe UE.
The risk is that it would take just one Proximity Request from the UE for the
ProSe Function to actually keep a record of [ALUID_B, EPUID_B, PFID_B] mapping
and have the capability to later send a proximity request (step 4 of Proximity
Request procedure in clause 5.5.5 of [20]) although the UE didn\'t actually
send a proximity request at all (step 4 of Proximity Request procedure in
clause 5.5.5 of [20]). This could lead to massive surveillance of users by
other PLMNs that may be very difficult to detect by the PLMN which serves
particular ProSe UEs.
{width="5.982638888888889in" height="3.3118055555555554in"}
Figure 6.2.6.1-1: extract from 3GPP TS 23.303 [20],\ Proximity Request
Procedure (clause 5.5.5)
#### 6.2.6.2 UE-signed proximity request
UE A signs all the proximity requests sent to its ProSe Function A over the
PC3 interface.
The UE\'s signature key can be provided by the application server over the PC1
interface. Or the UE could generate a signature and verification key pair,
securely stores the signature key in its memory and export the verification
key to the Application Server.
The UE\'s verification key is provided to ProSe Function B by the Application
Server over the PC2 interface. ProSe Function B is assured of the authenticity
of the proximity request received from ProSe Function A over the PC6 interface
by verifying a cryptographic signature with a verification key from the U.E.
The procedure below further defines the Proximity Request procedure in clause
5.5.5 of TS 23.303 [20] to support authenticity of the request.
Figure 6.2.6.2-1: UE-signed Proximity Request
0\. UE A and the Application Server perform a key establishment ceremony,
which results in having a signature key in UE_A and a verification key in the
Application Server. The communication between UE A and the application shall
be end-to-end secured over the PC1 interface.
1\. UE A sends as part of the Proximity Request the following additional data:
a signature UEA_signature of the cryptographic hash of the concatenation of
the EPUID_A, the ALUID_A, the ALUID_B and a timestamp value to ProSe Function
A. Theses should therefore be transmitted to the Application Server and the
ProSe function B so that both may verify the cryptographic signature with the
UE\'s verification key.
2\. ProSe Function A sends as part of the Map Request message the following
additional data: the UEA_signature and the timestamp provided by UE A to the
Application Server.
3\. The Application Server verifies the UEA_signature with the verification
key of ALUID_A. An error message is returned if the verification fails. If the
verification is successful, the Application Server may optionally add in the
Map Response the associated certificate of ALUID_A\'s verification key.
4\. ProSe Function A sends as part of the Proximity Request to ProSe Function
B the following additional data: the UEA_signature, ALUID_A, ALUID_B and the
timestamp, the Application ID and optionally the ALUID_A\'s certificate.
5\. If ALUID_A\'s certificate or verification key wasn\'t part of the
Proximity request, ProSe Function B sends a Verification Key fetching requests
to Application Server (identifiable from its Application ID) ALUID_A\'s
verification key.
6\. The Application Server returns the verification key of ALUID_A.
7\. If the verification of UEA_signature is successful then the procedure
continues the procedure from step 5 in clause 5.5.5 of 3GPP TS 23.303 [20].
#### 6.2.6.3 Application Server-signed proximity request
UE A doesn\'t sign the proximity requests sent to its ProSe Function A, but
trusts the Application Server to control the authorization of the proximity
request sent on its behalf.\ The authorization criteria can be based on
detection mechanisms of very high volume of incoming proximity requests from a
ProSe Function that doesn\'t match with the frequency usage of the ProSe
Application by the users, or it can be based on a presence detection mechanism
over the PC1 interface.\ ProSe Function A requests an authorization to the
Application Server for each proximity request it should transmit over the PC2
interface. The Application Server returns parameter which specifies which
operations are authorized\ (e.g. authorized to send only one request,
authorized to send X requests until particular date, etc.).\ ProSe Function B
is assured of the authenticity of the proximity request received from ProSe
Function A by verifying the signature with a verification key from the
Application server.\ The token verification key is fetched over the PC2
interface between the ProSe Function B and the Application Server.
The procedure below further defines the Proximity Request procedure in clause
5.5.5 of TS 23.303 [20] to support authenticity of the request.
{width="5.794444444444444in" height="3.2395833333333335in"}
Figure 6.2.6.3-1: Application Server-signed Proximity Request
1\. Same as Step 1 of procedure in clause 5.5.5 of [20]
2\. Same as Step 2 of procedure in clause 5.5.5 of [20]
3\. The Application Server returns as part of the Map Response following
additional data: the authorized operations\ (e.g. authorized to send only one
request, authorized to send X requests until particular date, etc.), a
timestamp,\ the signature AS_signature of the cryptographic hash of the
concatenation of the ALUID_A, the ALUID_B,\ the authorized operations and the
timestamp value, and optionally the associated certificate CertKey_AS of
Application Server\'s verification key
4\. ProSe Function A sends as part of the Proximity Request to ProSe Function
B the following additional data:\ the AS_signature, ALUID_A, ALUID_B, the
timestamp, the authorized operations, the Application ID and optionally the
CertKey_AS\'s certificate.
5\. If the CertKey_AS\'s certificate wasn\'t part of the Proximity request, or
that either the CertKey_AS\'s certificate or verification key wasn\'t stored
in internal memory, then ProSe Function B sends a Verification Key fetching
requests to Application Server Application ID\'s verification key
(identifiable from its Application ID).
6\. The Application Server returns the verification key.
7\. If the verification of signature from the Application Server is successful
then the procedure continues the procedure from step 5 in clause 5.5.5 of TS
23.303 [20].
#### 6.2.6.4 Proximity request digital signature algorithms and key strength
The cryptographic length of the signing asymmetric keys should have at least a
key strength equivalent to a 128-bits symmetric key. The following digital
signature algorithms may be used:
  * RSA as specified in FIPS 186-4 [24]: the minimum key length should be 3072 bits. The minimal size for the hash function shall at least be SHA-256 which should be used as specified by NIST [29].
  * DSA as specified in FIPS 186-4 [24]: the minimum key length should be 256 bits.
  * ECDSA as specified in BSI TR-03111 [25]: the minimum key length should be 256 bits, the elliptic curve domain parameters should be selected among those available in RFC 5639 [26]. The corresponding hash function should be chosen depending on the previously selected elliptic curve domain parameters (cf. clause 5 in RFC 5639 [26]).
#### 6.2.6.5 Proximity request hash input format
The input to the hash function should be encoded as specified in Annex B.1 of
TS 33.220 [6] and should consist of the concatenation of proximity request
parameters and their respective lengths:
  * FC = TBD
  * P0 = EPUID_A
  * L0 = Length of P0 value
  * P1 = ALUID_A
  * L1 = Length of P1 value
  * P2 = ALUID_B
  * L2 = Length of P2 value
  * P3 = Timestamp. It should use the date-time format as defined in clause 5.6 of RFC 3339 [27] and should be encoded according to Annex B.2.1.2 of TS 33.220 [6]
  * L3 = Length of P3 value
#### 6.2.6.5 Verification key format
The following should be supported by the Application Server and the ProSe
function:
For the UE-signed proximity request case, the verification key of the
initiating ProSe UE is directly transmitted from the Application server to the
ProSe function of the target UE.
For the Application Server-signed proximity request case, the verification key
of the Application Server is directly transmitted from the Application server
to the ProSe function of the target UE.
The verification key should be formatted like the \"Subject Public Key Info\"
element of a X.509 certificate. The \"Subject Public Key Info\" is specified
in clause 4.1.2.7 of RFC 5280 [28]. RFC 5639 [26] should also be supported in
order to include ECDSA with Brainpool elliptic curve domain parameters.
#### 6.2.6.6 Profile for Application Server and Application UE certificate
The following may be supported by the Application Server and the ProSe
function:
For the UE-signed proximity request case, the certificate is transmitted from
the Application Server over the requesting ProSe function of the initiating
ProSe UE to the ProSe function of the target ProSe UE. It may also be
transmitted
It is optional to use certificates for the verification of the proximity
request signature. If however used, the following should apply:
Certificates used for authentication of the Proximity Request should meet the
certificate profiles given in TS 33.310 [19] as follows: clause 6.1.3, for SEG
certificates should apply to ALUID-associated certificates, and clause 6.1.4
for SEG CA certificates should apply to any CA certificates used in a chain to
validate the certificates, with the following additions and exceptions:
\- Mandatory critical key usage: only digitalSignature should be set
## 6.3 Solutions for One-to-many Communications
### 6.3.1 Solution #3.1: Security for ProSe Group Communications
#### 6.3.1.1 General
This solution address key issue #A3.2 in the current document and is aimed to
provide the security solution for solutions C1, C5, C6, C7 and C8 in TR 23.703
[4]. It is primarily aimed at meeting the public safety user requirements for
group communications out-of-network coverage, but can also be applied for in-
coverage scenarios.
#### 6.3.1.2 IDENTITY Security Solution
##### 6.3.1.2.1 General
The IDENTITY solution provides a flexible end-to-end security solution capable
of setting up secure one-to-one or group sessions without requiring a
connection to network infrastructure. It is intended for use by public-safety
users who require direct one-to-one or group connections when a connection to
the network does not exist. It provides a solution to perform authentication
and key-agreement for direct one-to-one communications (C3 and C4) and for
group communications (C1, C5, C6, C7, C8) as specified in TR 23.703 [4].
The IDENTITY solution allows information to be encrypted to a given UE using
solely their public identity (alongside pre-provisioned domain-level
information). Only a UE with this identity (alongside private keys provisioned
by the network infrastructure) is able to decrypt information encrypted to the
identity and sign information as this identity.\ As a result, provisioning
shall either occur prior to deployment or while users are connected to the
network infrastructure, but secure connections may be established without
access to network infrastructure.\ The security mechanism which achieves this
uses the MIKEY-SAKKE protocol as specified in RFC 6509 [12].
6.3.1.2.2 IDENTITY KMS
IDENTITY is a security protocol rooted and managed at the domain level. Each
domain supporting IDENTITY secure communications requires an IDENTITY Key
Management Server (KMS). The KMS controls the security of IDENTITY
communications within the domain, including the key period, the User IDs which
a user may use and the domains with which a user may securely communicate.
The KMS issues a public certificate for the domain for which it manages
communication security.\ To securely communicate with users in a domain, the
single KMS public certificate for the domain is required.\ The KMS issues its
own KMS public certificate to its users, along with KMS public certificate for
other domains KMS, allowing secure, inter-domain communications. Individual
users do not require certificates.
6.3.1.2.3 Use of User IDs within IDENTITY
6.3.1.2.3.1 General
To secure communications with a specific user, the initiator shall compose the
IDENTITY User ID (UID) to which the message will be encrypted. It is intended
that the format of the UID should be defined by the KMS. As a result, there is
flexibility on the choice of UID depending on the requirements of the specific
user group. The only constraint is that UID shall be well-defined and derived
by the initiator of the communication unambiguously.
For example, for IMS communications, the UID is likely to contain the user\'s
IMPU (e.g. alice\@domain.com), or in other contexts, perhaps the MSISDN.
However, for most domains, the UID used for IDENTITY communications will also
contain a reference to the current year, and perhaps also the current month or
week within the year. This defines the length of time a particular UID is
used, and also the key period for the key associated with the User ID.
The format for the UID for users within a domain is specified within the KMS
public certificate. For example,
> #uri?uidyear=#year&uidmonth=#month />
In this case, the initiator would construct a UID for a user within the KMS
domain by replacing \'#uri\' with the recipient\'s URI, \'#year\' with the
current year and \'#month\' with the current month. For example:
alice\@domain.com?uidyear=2014&uidmonth=03
It is recommended that the KMS issues keys for a new month prior to the
beginning of the month.\ This allows the two month\'s UIDs to both be valid
for use on the month boundary.
6.3.1.2.3.2 Group UIDs
Just as users are able to communicate independently of the network using
IDENTITY, groups may be managed independently of the network using group UIDs.
In this case, the KMS provisions a UID to the Group Manager using the URI for
the group. For example, for pre-configured groups the following may be
appropriate:
group.antipolis.police\@domain.com?uidyear=2014&uriusage=group;
Or, if a user is allowed to create their own ad-hoc group, they could be
provisioned with a UID for this purpose:
group.alice\@domain.com?uidyear=2014&uriusage=group;
The Group Manager may sign group management messages using the group UID
corresponding to the URI for the group. The group members are able to
authenticate the validity of the management message as only the Group Manager
is provisioned by the KMS to use the group UID. It is recommended to include
the attribute \'uriusage=group\' in the IDENTITY UID to ensure separation
between group UIDs and user UIDs.
6.3.1.2.4 IDENTITY UE Provisioning
6.3.1.2.4.2 General
To securely communicate using IDENTITY, each public safety UE needs to be
provisioned with keys corresponding to the public safety UE\'s UIDs, along
with domain specific information such as KMS\'s public certificate.
To be configured, the UE creates a secure connection to the KMS, and as part
of this process, the KMS verifies the identity of the UE. Within the secure
connection, the UE makes a request to the KMS which responds with domain
information and key material appropriate to the request and local domain
policy.
6.3.1.2.4.2 Pre-Provisioning
Prior to provisioning, the public safety UE requires the address (e.g. URL) of
the domain\'s KMS.
Public-safety UEs may also be pre-provisioned with additional security
parameters where required. For some user groups, such as UEs which may always
be outside of network coverage, the UE may be entirely provisioned prior to
deployment.
6.3.1.2.4.3 UE to KMS connection security
To be provisioned, the public safety UE shall establish a secure connection to
the KMS. If security credentials have already been agreed between the KMS and
UE (e.g. due to a previous GBA connection, a secure IMS tunnel or pre-
provisioned parameters), an HTTPS connection is established using these
credentials. However the secure connection is established, the KMS shall be
able to verify the identity of the UE.
Otherwise, the KMS acts as a NAF and directs the UE to perform a GBA
bootstrapping procedure as described in TS 33.220 [6] and depicted in Figure
6.3.1.2.4.3-1. To achieve this, a BSF and the UE\'s HSS are used. As a result
of this procedure, the KMS knows the identity of the UE and a shared key, Ks,
is established between the KMS and UE to protect the HTTPS connection between
them.
{width="4.875in" height="3.1458333333333335in"}
Figure 6.3.1.2.4.3-1: Bootstrap architecture for IDENTITY Provisioning
Should the KMS require keys to be updated outside of the normal schedule, a
GBA push procedure may be started by the KMS to establish a connection between
the KMS and the UE for key transfer.
6.3.1.2.5 Procedures for UE Configuration to use IDENTITY
6.3.1.2.5.1 General
This clause specifies the key management procedures between the KMS and the UE
that allows the UE to be configured to use the IDENTITY solution. It describes
the security procedures for the following processes:
> \- IDENTITY Provisioning Request
>
> \- IDENTITY Authorize Request
>
> \- IDENTITY Information Request
6.3.1.2.5.2 IDENTITY Provisioning Request
This procedure registers a public safety UE within a specific domain. The
public safety UE shall send a provisioning request to the KMS in the message-
body of a HTTP GET request. The Request-URI shall indicate the type of the
message. Upon successful request, KMS shall return indication of success.
It is assumed that this request is made and responded to over an established
secure connection as described in clause 6.3.1.2.4. Figure 6.3.1.2.5.2-1
describes the procedure.
Figure 6.3.1.2.5.2-1: IDENTITY Provisioning Request
The provisioning shown in Figure 6.3.1.2.5.2-1 is as follows:
  1. The public safety UE sends the HTTP GET (Provision) to the KMS.
a. The Request-URI of the GET request contains a URI parameter \"requesttype\"
that is set to \"prov\" I.e. Request-URI takes the form of
\"/keymanagement/mikeysakke?requesttype=prov\".\ The GET request may contain
other URI parameters and headers as required.
  2. The KMS checks that the HTTP GET is valid, and extracts the request for further processing. During processing, the KMS shall ensure the public safety UE\'s identity is verified and apply the domain policy on assigning UIDs to the UE.
  3. After successful processing, the KMS returns a HTTP 200 OK to the public safety UE. The KMS populates the HTTP response with XML containing all information required to provision the UE. The contents of XML response may be signed by the KMS using the KMS public certificate. The response will include key material corresponding to the UE\'s UIDs. It may also include:
a. The KMS public certificate.
b. Public certificate of other KMS domains with which the UE may securely
communicate.
c. Domain policies (e.g. frequency of provisioning, or use KMS certificate A
to communicate with users in domain Z).
d. If the UE is able to create groups, key material corresponding to the group
UIDs.
For most user groups, the public safety UE will periodically (e.g. monthly)
make the provisioning request to the KMS.
##### 6.3.1.2.5.3 IDENTITY Authorize Request {#identity-authorize-request .H6}
Where the public safety UE receives a MIKEY-SAKKE I_MESSAGE using a UID for
which the private key has not been provisioned by the KMS, the public safety
UE may request the private key for this UID from the KMS. The UE sends an HTTP
GET (Authorize) request to the KMS. The Request-URI indicates the type of the
message and the UID required. Upon successful request, KMS returns an
indication of success.
It is assumed that this request is made and responded to over an established
secure connection as described in clause 6.3.1.2.4. The signalling flow of the
request is shown in Figure 6.3.1.2.5.3-1.
Figure 6.3.1.2.5.3-1: IDENTITY Authorize Request
The UID authorization procedure shown in Figure 6.3.1.2.5.3-1 follows:
  1. The public safety UE sends the HTTP GET (Authorize) to the KMS.
a. The Request-URI contains an URI parameter \"requesttype\" that is set to
\"idrequest\" and the Request-URI contains an URI parameter \"userid\" that
shall be set to the URL-encoding of the User ID required. For example,
Request-URI takes the form of \"/keymanagement/mikeysakke?requesttype=
idrequest&userid=alice%40operator.example%3FP-Year%3D2013%26P-Month%3D09\";
  2. The KMS checks that the HTTP GET is valid, and extracts the request for further processing. During processing, the KMS shall ensure the public safety UE\'s identity is verified and the UE is authorized to use the User ID requested.
  3. After successful processing, the KMS returns a HTTP 200 OK to the public safety UE. The KMS populates the HTTP response with XML containing key material corresponding to the requested UE\'s User ID.\ The contents of XML response may be signed by the KMS using the KMS public certificate.
6.3.1.2.5.4 IDENTITY Information Request
Where the public safety UE would like to send a MIKEY-SAKKE I_MESSAGE to a
public safety URI for which it does not know or have the KMS public
certificate corresponding to the URI, the UE may request this information from
the KMS or appropriate public server hosting KMS public certificates. The
Request-URI indicates the type of the message and the URI for which
information is required. Upon successful request, KMS returns indication of
success.
This request may be made without a security association between the server and
the UE, however the response from the server should be authenticated by the
UE\'s KMS. The signalling flow for this procedure can be seen in Figure
6.3.1.2.5.4-1.
Figure 6.3.1.2.5.4-1: IDENTITY Information Request
The URI information procedure is as follows:
  1. The public safety UE sends the HTTP GET (Information) request to the server.
a. The Request-URI contains a URI parameter \"requesttype\" that shall be set
to \"inforequest\" and the Request-URI contains a URI parameter \"uri\" that
is set to the URL-encoding of the public safety URI for which information is
required. For example, Request-URI takes the form of:
\"/keymanagement/mikeysakke?requesttype=inforequest&uri=alice%40operator.another\";
b. Where the server is not the user\'s KMS, the Request-URI may also contain a
URI parameter \"certuri\" that shall be set to the URL-encoding of the domain
certificate URI that the public safety UE trusts. The Information Server may
then respond with domain information signed using this Certificate URI. For
example: \"certuri=domaincert1.kms.operator.example\".
  2. If the request is valid and can be fulfilled by the server, it returns a HTTP 200 OK to the public safety UE. The server populates the HTTP response with XML containing the relevant domain certificate and domain policies provided by the public safety UE\'s KMS. The contents of XML response may be signed by the public safety UE\'s KMS.
6.3.1.2.6 Key Storage
It is assumed that the UE includes a secure storage. The secure storage may be
realized on the ME or on the UICC and should be used to store the key material
provisioned by KMS and any other long term key material (e.g. group master
key).
#### 6.3.1.3 IDENTITY Group Communications
##### 6.3.1.3.1 General
This clause describes how security associations for group communications can
be created and used to secure direct one-to-many communications. The same
procedures also apply to network-routed, one-to-many communications.
The procedures provide support for two different types of group:
  * Pre-configured groups, which are setup using the network prior to communication. It is expected that the majority of groups will be of this type.
  * Ad-hoc groups, which are created by UEs as required, and can also be created without network connectivity.
The architecture for pre-configured groups is shown in Figure 6.3.1.3.1-1.
Figure 6.3.1.3.1-1: IDENTITY security architecture for Pre-Configured Group
Communications
Figure 6.3.1.3.1-1 describes the IDENTITY security architecture to create pre-
configured group communications for ProSe. The architecture uses the IDENTITY
public safety solution to distribute group keys and authenticate group
communications. At the top of the diagram, a public safety UE is provisioned
by a KMS with key material associated with its identity. If required, GBA is
used to bootstrap the security of the connection between the UE and the KMS.\
The KMS also provisions the Group Manager with keying material for the
identity of groups which it manages (if the group manager is a UE, the group
identity may be related to the identity of the public safety UE). This process
is described in clause 6.3.1.2.
For pre-configured groups, the Group Manager is responsible for advertising
the group and distributing Group Master Keys (GMKs) to UEs within the group.
This process, to configure the security association for a pre-configured
group, is described in clause 6.3.1.3.2.
Once a Group Master Key has been shared for the pre-configured group, UEs are
able to setup group communications. The initiating UE generates, encrypts and
transmits a Group Session Key (GSK) to the group members.\ This transmission
is encrypted using the GMK and may be authenticated, allowing the origin of
the transmission to be verified. The distribution process may also be
performed over a direct transmission. This process is described in clause
6.3.1.3.3.
With a Group Session Key shared, it is then used to protect data transmitted
directly between UEs. Communication security is described in clause 6.3.1.3.5.
It is anticipated that the majority of groups will be pre-configured. However,
this approach does not support all group communications requirements. For
example, pre-configured groups cannot be managed without network connectivity,
cannot support the dynamic setup of groups and cannot support \'Out-Of-The-
Box\' group communications. As a result, the IDENTITY solution supports the
creation of ad-hoc groups for this purpose.
For ad-hoc groups, the group is created by a single UE without a central
distribution function. The UE generates and distributes a group session key
encrypted to specific identities using the IDENTIY solution. As a separate
message shall be created by the UE for each user, this mechanism does not
scale to large groups, but supports highly flexible group creation. This
mechanism for distributing group session keys is described in clause
6.3.1.3.4.
##### 6.3.1.3.2 Pre-configured Group Security Configuration
###### 6.3.1.3.2.1 General
Pre-configured groups are managed by a Group Manager. This is likely to be a
central server whose role is to create, advertise and share a security
association for the group. To create the group\'s security association, a
Group Master Key (GMK) is distributed to pubic safety group members.
The security associations are setup using group notification or advertisement
messages, created by the Group Manager. The group advertisement messages
notify users of the existence of the group, but also provide the GMK encrypted
for the user. Using the IDENTITY solution, the GMK is encrypted to the public
safety user\'s identity and signed using the (key associated with the) group
identity, an identity which the group manager is authorized to use by the KMS.
In this way, the group manager\'s management messages are authenticated.
Figure 6.3.1.3.2.1-1: Overview of Pre-Configured Group Security Configuration
###### 6.3.1.3.2.2 Security Procedures for Pre-configured Group Security
Configuration
This procedure distributes a Group Master Key (GMK) from the group manager to
the public safety UEs within the group.
It is assumed that for a group within the network there will be a local
participating group server which manages communications with group members.
For pre-configured groups, it is also assumed that there exists a group
manager, which is a server (e.g. in the public safety control room) with the
authority to manage a specific pre-configured group. The security association
for the group is created via a group notification/advertisement message sent
from the group manager to public safety UEs within the group.
Figure 6.3.1.3.3.2.2-1 shows the security procedures for creating a security
association for a pre-configured group.
Figure 6.3.1.3.2.2-1: Security Configuration for Pre-Configured Groups
A description of the procedures depicted in Figure 6.3.1.3.3.2.2-1 follows:
  1. Prior to beginning this procedure it is assumed that all the public safety UEs within the group have been provisioned by an IDENTITY KMS as described in clause 6.3.1.2. The group manager should also be securely provisioned by the KMS to use the identities of the group(s) that it manages.
  2. A UE registers with its serving signalling server to use communication services. As part of this mechanism the public safety UEs registers with a group server and group manager. There are no additional security procedures associated with the registration process, although as a consequence, the group server obtains address information for local public safety UEs.
  3. The group manager notifies/advertises the group to public safety users within the group (e.g. using a SIP Group Advertisement message). It transfers the notification message to the participating local group servers.\ The message contains a MIKEY-SAKKE I_MESSAGE as specified in RFC 6509 [12]. The I_MESSAGE encapsulates the new GMK for the public safety UE. It is encrypted to the identity of the UE group member and signed using the (key associated with the) group identity. The message also contains the GMK key id and period of use.
> NOTE: Only a Group Manager authorized by a trusted KMS knows the private key
> associated with the group identity and is able to sign a message. All group
> members are able to verify the signature and hence can confirm the group
> manager is authorized to manage this group.
>
> NOTE: If there is a requirement to multicast the group notification message,
> the group manager may send the group notification message to a URI-List, and
> include a different I_MESSAGE for each UE.\ This will only be feasible where
> the group is small.
  1. The local group server forwards the group advertisement to the user\'s serving signalling server.
  2. The serving signalling server forwards the message to the public safety UE. The UE authenticates the sender and extracts the new GMK from the I_MESSAGE. The UE uses the last received GMK as the current group key (based on the timestamp in the I_MESSAGE).
  3. Upon successful receipt and processing, the public safety UE confirms receipt of the group advertisement message (e.g. within SIP OK) to its serving signalling server. The confirmation contains no security information.
  4. The serving signalling server forwards the confirmation to the local group server.
  5. The local group server forwards the confirmation to the group manager.
Should rekeying of the GMK be required, the Group manager may repeat the above
procedure.
NOTE: It is anticipated that the Group Manager will be a network entity.
However, it could also be a privileged UE without impacting the above security
procedures. The group manager does not require an on-going interaction with
the KMS to create a security association for a pre-configured group.
##### 6.3.1.3.3 Session Key Distribution for Pre-Configured Groups
###### 6.3.1.3.3.1 General
Group communications within a session are protected using a Group Session Key
(GSK). Hence, prior to beginning a communication, a session key is generated
by the session initiator and be shared with the group members.\ For pre-
configured groups, the Group Master Key (GMK) is used to protect the
distribution of the GSK. The GSK may also be signed using the initiator\'s
IDENTITY UID.
This process is summarised in Figure 6.3.1.3.3.1-1.
{width="6.690277777777778in" height="2.5506944444444444in"}
Figure 6.3.1.3.3.1-1: Overview of Session Key Distribution for Pre-Configured
Groups
###### 6.3.1.3.3.2 Session key distribution for pre-configured groups (network
connected)
These procedures assume the existence of a group controller. The group
controller is aware of which UEs are members of the group and is also
responsible for routing signalling and media traffic to the members of the
group.\ The group controller need not be a member of the group or have access
to the media that it routes. If this entity requires access to the group
communication to fulfil its function, it should be treated as a member of the
group and be provisioned with the Group Master Key by the group manager.
Figure 6.3.1.3.3.2-1 demonstrates the signalling flow for session key
distribution.
{width="5.566666666666666in" height="4.766666666666667in"}
Figure 6.3.1.3.3.2-1: Security Procedures for Session Key Distribution for\
Pre-Configured Groups (network connected)
The procedure in Figure 6.3.1.3.3.2-1 is now described step-by-step:
  1. Prior to beginning this procedure it is assumed that the security association for the pre-configured group has been created, as described in clause 6.3.1.3.2.
  2. Public safety UE 1 generates a GSK and sends a session creation notification (e.g. SIP INVITE) to the group controller, via a serving signalling server and local group server. Within the SDP Offer of this message, UE 1 includes a MIKEY Pre-Shared-Key message, as specified in RFC 3830 [14]. The MIKEY-PSK message shall encapsulate the session key with the Group Master Key (GMK) which shall be denoted by a key identifier.\ The MIKEY message may be signed using the (key associated with the) identity of UE 1 by attaching a ECCSI SIGN payload, as defined in RFC 6509 [12] and RFC 6507 [15].
NOTE: This message may be pre-generated to increase the efficiency of the
communication.
  1. The group controller notifies UE 1 that it received the message (e.g. SIP TRY). This message does not contain any security information.
  2. The group controller sends a session creation notification (e.g. SIP INVITE) to each public safety UE within the group, via each UEs local group server and signalling server. The SDP Offer of the message provided by public safety UE 1 is duplicated within each message, including the MIKEY-PSK content. The message is routed via each public safety UE\'s local group server and serving signalling server.
  3. Each member of the group uses the key identifier to find the GMK used by UE 1 and extracts the Group Session Key. The public safety UEs notify the group controller that they received the message. This message does not contain any security information.
  4. Further messages are sent to setup the group session. These messages contain no security information.
As a result of this procedure, the members of the group will created a group
session and shared a Group Session Key (GSK) to protect media within the
session.
###### 6.3.1.3.3.3 Session key distribution for pre-configured groups (network
independent)
This security mechanism is expected to be included as part of the procedures
to create a media session over a one-to-many direct communication.
From a security perspective, this procedure follows exactly the same security
mechanism as for network connected group communications described in clause
6.3.1.3.3.2, though the routing differs. In this case, the SDP Offer is
broadcast by the initiating UE and no response is expected. The SDP Offer
contains the Group Session Key (GSK) protected by the Group Master Key (GMK).
Following the broadcast of the SDP Offer, the media is broadcast over the one-
to-many direct link, protected under the GSK.
Figure 6.3.1.3.3.3-1 describes the procedure. As there are no responses or
acknowledgements, this procedure shall proceed on a \'best-endeavour\' basis.
{width="4.466666666666667in" height="3.6666666666666665in"}
Figure 6.3.1.3.3.3-1: Security Procedures for Session Key Distribution for\
Pre-Configured Groups (network independent)
The procedure in Figure 6.3.1.3.3.3-1 is now described step-by-step.
  1. Prior to beginning this procedure it is assumed that the security association for the pre-configured group have been created, as described in clause 6.3.1.3.3.2.3.
  2. Public safety UE 1 generates a GSK and broadcasts a \'media session creation message\' containing an SDP Offer. Within the SDP Offer, UE 1 includes a MIKEY Pre-Shared-Key message, as specified in RFC 3830 [14].\ The MIKEY PSK message shall encapsulate the session key with the Group Master Key (GMK) and shall be denoted by a key identifier. The MIKEY message may be signed using the (key associated with the) identity of UE 1 by attaching a ECCSI SIGN payload, as defined in RFC 6509 [12] and RFC 6507 [15].
> NOTE: This message may be pre-generated to increase the efficiency of the
> communication.
  1. Each member of the group uses the key identifier to find the GMK used by UE 1 and extracts the Group Session Key. Further messages are sent by UE 1 to setup the one-to-many broadcast media session. These messages contain no security information.
As a result of this procedure, the members of the group will have shared a
Group Session Key (GSK) which is used to protect the media.
##### 6.3.1.3.4 Session Key Distribution for Ad-Hoc Groups
###### 6.3.1.3.4.1 General
Ad-hoc groups are designed to support edge cases that are not supported by
pre-configured groups. For ad-hoc groups, the user selects a set of users and
invites them into a group session. Unlike in clause 6.3.1.3.3, there is no
prior\ pre-arrangement of the group by a Group Manager and no GMK.
As it operates entirely independently of a group manager it allows any public-
safety UE to setup a group with any set of other public-safety UEs. This
allows group to be created dynamically. This mechanism also supports group
creation for UEs which have never had access to the network (out-of-the-box
group creation).
The solution is intended for small groups of handsets (at most 20) which wish
to dynamically setup a new group.\ It is not suitable for large groups, due to
the number of individual MIKEY-SAKKE I_MESSAGEs required.\ As it is able to
operate entirely without network connectivity, it is also well suited to
supporting public safety UEs in highly remote locations which are unlikely to
ever have access to the network.
{width="6.947916666666667in" height="2.970138888888889in"}Figure
6.3.1.3.4.1-1: Overview of ad-hoc group session key distribution
Ad-hoc groups are created by a single UE. The UE distributes the same Group
Session Key (GSK) to each user within its own MIKEY-SAKKE I_MESSAGE, though
these I_MESSAGEs may be transmitted within a single session setup request.
Figure 6.3.1.3.4.1-1 provides an overview of the security process for
distributing session keys for ad-hoc groups.
> NOTE: An ad-hoc group containing two users (initiator and terminating user)
> is equivalent to an IDENTITY one-to-one connection as described in RFC 6509
> [12].
For an ad-hoc group to be created, no prior security association need exist
between the UEs. However, all UEs in the group shall be provisioned as
described in clause 6.3.1.2.
###### 6.3.1.3.4.2 Session key distribution security procedures for ad-hoc
groups (network connected)
Figure 6.3.1.3.4.2-1 describes the procedures for distributing a session key
among ad-hoc group members via the signalling network.
{width="5.5625in" height="5.416666666666667in"}
**Figure 6.3.1.3.4.2-1: Security Procedures for Session Key Distribution for\
Ad-Hoc Groups (network connected)**
The procedure in Figure 6.3.1.3.4.2-1 is now described step-by-step.
  1. Prior to beginning this procedure it is assumed that all the public safety UEs within the group have been provisioned by an IDENTITY KMS as described in clause 6.3.1.2.
  2. Prior to beginning this procedure it is assumed that the public safety UE has registered with its serving signalling server and local group server.
  3. Public safety UE 1 generates a GSK and sends a session creation notification (e.g. SIP INVITE) to the group controller, via a serving signalling server and local group server. This message contains a URI List of the group members. Within the SDP Offer of this message, UE 1 includes a set of MIKEY-SAKKE I_MESSAGEs as defined in RFC 6509 [12]. A different I_MESSAGE is included for each member of the ad-hoc group, encapsulating the GSK separately for each public safety UE. Each I_MESSSAGE encrypts the GSK to the IDENTITY UID of the UE group member and is signed using (the key associated with) UE 1\'s UID.
NOTE: This message may be pre-generated to increase the efficiency of the
communication.
  1. The group controller notifies UE 1 that it received the message. This message does not contain any security information.
  2. The group controller sends a session creation notification (e.g. SIP INVITE) to each public safety UE within the group. This message may list the other members of the group. For each public safety UE within the group, the message sent by the group controller contains an SDP Offer containing one MIKEY-SAKKE I_MESSAGE received from UE 1 and designated for the UID of the UE group member. The message is routed via each public safety UE\'s local group server and serving signalling server.
  3. Each member of the group extracts the GSK encapsulated by UE 1 and checks the signature on the message using keys provisioned by the KMS. The public safety UEs notify the group controller that they received the message. This message does not contain any security information.
  4. Further messages may be sent to setup the group session. These messages contain no security information.
As a result of this procedure, the members of the group will have shared a
Group Session Key (GSK).\ This is used to protect the media transmitted by
group members.
NOTE: Using a similar signalling flow, the initiator can add members to the
group using an appropriate message (e.g. SIP REFER) containing a MIKEY-SAKKE
I_MESSAGE for this user.
###### 6.3.1.3.4.3 Session key distribution security procedures (network
independent)
This security mechanism is part of a procedure to create a media session over
a one-to-many direct communication.
From a security perspective, this procedure follows exactly the same security
mechanism as for network-connected group communications described in clause
6.3.1.3.4.2. In this use case, the SDP Offer is broadcast by the initiating UE
and no response is expected. The SDP Offer contains a set of MIKEY-SAKKE
I_MESSAGEs protecting the Group Session Key (GSK). Following the broadcast of
the SDP Offer, the media is broadcast over the one-to-many direct link,
protected under the GSK.
Figure 6.3.1.3.4.3-1 describes the procedure. As there are no responses or
acknowledgements, this procedure shall proceed on a \'best-endeavour\' basis.
{width="4.466666666666667in" height="3.6666666666666665in"}
**Figure 6.3.1.3.4.3-1: Security Procedures for Session Key Distribution for\
Ad-Hoc Groups (network independent)**
The procedure in Figure 6.3.1.3.4.3-1 is now described step-by-step.
  1. Prior to beginning this procedure it is assumed that all the public safety UEs within the group have been provisioned by an IDENTITY KMS as described in clause 6.3.1.2.
  2. Public safety UE 1 generates a GSK and broadcasts a \'media session creation message\' containing a URI list of group members and an SDP Offer. Within the SDP Offer, UE 1 includes a set of MIKEY-SAKKE I_MESSAGEs as defined in RFC 6509 [12]. A different I_MESSAGE is included for each member of the ad-hoc group, encapsulating the GSK separately for each public safety UE. Each I_MESSSAGE encrypts the GSK to the IDENTITY UID of the UE group member and is signed using (the key associated with) UE 1\'s UID.
NOTE: This message may be pre-generated to increase the efficiency of the
communication.
  1. Each member of the group extracts the GSK from the I_MESSAGE containing their identity and checks the signature on the message using keys provisioned by the KMS. Further messages may be sent by UE 1 to setup the one-to-many broadcast media session. These messages contain no security information.
As a result of this procedure, the members of the group will have shared a
Group Session Key (GSK).\ This is used to protect the media transmitted
directly as part of this session.
###### 6.3.1.3.4.4 Using ad-hoc groups to meet the \'Out-of-the-box\'
requirement
The key distribution mechanism used to setup ad-hoc groups, may also be used
to allow groups of public safety UEs to begin group calls \'out-of-the-box\',
and in particular, prior to a network connection.
To achieve this, separate security credentials shall be installed on each ME
during the deployment process. Each ME is pre-configured with a unique
IDENTITY UID per ME (e.g. public safety IMEI) and related private keys. This
identity and related keys are fixed within the ME and absolutely tied to the
ME. The ME is also pre-configured with a maximum key-period for ad-hoc groups.
\'Out-of-the-box\' groups can now be setup using the security procedures in
clause 6.3.1.3.4.3. A group member creates the group by listing every ME
identity (public safety IMEI) in the group, ensuring that only uncompromised
MEs are listed. A GSK is shared using these security procedures and group
communications can begin. This process operates entirely independently of the
network.
##### 6.3.1.3.5 Media Stream Protection
The following mechanism shall be used to protect one-to-many communications
which use the Real-Time Transport Protocol (RTP) or the RTP Control Protocol
(RTCP), cf. RFC 3550 [22].
The integrity and confidentiality protection for one-to-many communications
using RTP shall be achieved by using the Secure Real-Time Transport Protocol
(SRTP),RFC 3711 [23]. The integrity and confidentiality protection for one-to-
many communications using RTCP shall be achieved by using the Secure RTCP
protocol (SRTCP), RFC 3711 [23].
The key management mechanism for SRTP and SRTCP is described in clause
6.3.1.3.3 or 6.3.1.3.4. As a result of this mechanism, the group members will
have shared a GSK as part of the session setup procedure. The shared GSK shall
be used as the SRTP and SRTCP master key. This applies regardless of whether
the group members are within an ad-hoc or pre-configured group. The session
may only last for a single transmission, or may be maintained for a period to
allow many members of the group to efficiently communicate.
If late-entry to the media session is required, the transmitted SDP offer,
described in clause 6.3.1.3.3 and 6.3.1.3.4, may be periodically resent (e.g.
every 5 seconds within a SIP REFER).
### 6.3.2 Solution #3.2: Network-supported key distribution for group
communications
#### 6.3.2.1 General
This solution addresses key issue #3.2 in the current document and takes place
when the ProSe-enabled UEs are under network coverage.
#### 6.3.2.2 GBA-based key distribution for group communications
##### 6.3.2.2.1 General
This solution relies on GBA framework to generate and distribute a shared key
among members of a ProSe Group. Several GBA-based solutions models exist to
distribute the shared key.
##### 6.3.2.2.2 GBA-based key distribution for group communications with
invitation
{width="6.43125in" height="6.448611111111111in"}
**[Pre-requisites]{.underline}**
  * The ProSe-enabled UEs, involved in the procedure to retrieve a shared key, support GBA and GBA PUSH mechanisms as specified in TS 33.220 [5] and TS 33.223 [6].
  * The ProSe-enabled UEs involved in the procedure have established NAF-key with the NAF-ProSe Key Establishment as specified in TS 33.220 [5] and TS 33.223 [6].
**[Procedure]{.underline}**
  1. The User_GO (Group Owner) initiates the creation of a group and sends to the NAF-ProSe Key Establishment server a request to create a key gp_ID . The B-TID of User_GO is associated to the request. The request is signed with User_GO NAF key shared with the server.
Editor\'s Note: The details for signature are FFS.
  1. NAF-ProSe Key Establishment server verifies the signature and creates a key for gp_ID associated to User_GO.
  2. NAF-ProSe Key Establishment server sends to User_GO the key associated to the gp_ID thanks to GBA PUSH mechanism.
  3. The User_GO stores the key for gp_ID
  4. The User_GO asks a User_n if he wants to join the Group (User_n was identified thanks to discovery procedure). An invitation for User_n, signed with User_GO NAF key, is joined to the request.
Editor\'s Note: It should be checked whether Man-in-the-Middle attack is
possible.
  1. User_n sends a request to join to NAF-ProSe Key Establishment server, the invitation of User_GO is included in the request. The request is signed with User_n NAF key shared with the server.
  2. NAF-ProSe Key Establishment server verifies the signatures of request and invitation
  3. After successful signature verifications, the NAF sends the key associated to the gp_ID thanks to GBA PUSH mechanism.
  4. For any other user allowed to join the group, the steps 5 to 8 are executed.
  5. In case of need to refresh the key for gp_ID, the steps 9 to 11 could be executed for all the members of the ProSe Group who share a key.
Editor\'s Note: It is FFS whether mechanism specified in 3GPP TS 33.259 could
be reused.
Editor\'s Note: It is FFS whether this solution presents some scalability
issue.
##### 6.3.2.2.3 GBA-based key distribution for group key communications with
white list
{width="6.43125in" height="6.448611111111111in"}
**[Pre-requisites]{.underline}**
  * The ProSe-enabled UEs, involved in the procedure to retrieve a shared key, support GBA and GBA PUSH mechanisms as specified in TS 33.220 [5] and TS 33.223 [6].
  * The ProSe-enabled UEs involved in the procedure have established NAF-key with the NAF-ProSe Key Establishment as specified in TS 33.220 [5] and TS 33.223 [6].
  * Whenever there is a change about the white list, GO needs to send a refreshed white list to NAF_ProSe, so the NAF_ProSe can always keep the accurate list.
NOTE: If one UE had already got the group key before being removed, then only
after the re-keying, the removed UE will be actually banned from the group.
**[Procedure]{.underline}**
  1. The User_GO (Group Owner) initiates the creation of a group and sends to the NAF-ProSe Key Establishment server a request to create a key gp_ID . The B-TID of User_GO is associated to the request with a white list of users allowed to join gp_ID. The request is signed with User_GO NAF key shared with the server.
Editor\'s Note: The details for signature are FFS.
  1. NAF-ProSe Key Establishment server verifies the signature, creates a key for gp_ID associated to User_GO, and stores the white list associated to gp_ID.
  2. NAF-ProSe Key Establishment server sends to User_GO the key associated to the gp_ID thanks to GBA PUSH mechanism.
  3. The User_GO stores the key associated to the group.
  4. The User_n asks the NAF-ProSe Key Establishment server to join the gp_ID and retrieve the corresponding key. The request is signed with User_n NAF key shared with the server.
Editor\'s Note: It is FFS to determine if the request needs to be signed.
  1. NAF-ProSe Key Establishment server checks the signature and that the User_n is among the white list of the gp_ID.
  2. If the verification is successful, then the NAF sends the key associated to the gp_ID thanks to GBA PUSH mechanism.
  3. For any other user allowed to join the group, the steps 5 to 7 are executed.
  4. In case of need to refresh the key for gp_ID, the steps 8 to 10 could be executed for all the members of the ProSe Group who share a key.
Editor\'s Note: It is FFS whether mechanism specified in 3GPP TS 33.259 could
be reused.
Editor\'s Note: It is FFS whether this solution presents some scalability
issue.
### 6.3.3 Solution #3.3: security for D2D communications based on overlay
Editor\'s Note: The signalling to establish security for the ProSe APP layer
and ProSe EPS layer is FFS.
Editor\'s Note: It needs to be identified which of the solutions in TR 23.703
this applies to.
#### 6.3.3.1 Introduction
The ProSe architecture shows the existence of two separate layers, the ProSe
EPS layer and the ProSe APP layer.\ The ProSe APP layer contains the ProSe APP
function in the UE, the ProSe APP server and the PC1, PC2 and PC5 reference
points. The functions of the ProSe APP server may be out of scope for 3GPP as
described in clause 4.3.3 of TR 23.703 [4]; however, the function related to
security will still be required. The ProSe EPS layer consists of the rest of
the mobile network functions required for ProSe, I.e., what is required to
provide IP connectivity between UEs and QoS guarantees for the connection.
#### 6.3.3.2 Use cases analysis
##### 6.3.3.2.1 NSPS users
When ProSe is used by, e.g., National Security and Public Safety (NSPS)
organizations, there may be different requirements on security than what is
provided by regular LTE. There may, for example, be requirements on non-3GPP
encryption algorithms or real end-to-end encryption. Real end-to-end
encryption here means that not even the operator is able to decrypt the
traffic sent between the UEs. This implies that the session keys used for
encryption cannot be based on K~ASME~ or any key derived from the UICC.
Instead, there needs to be a separate root of trust for the session keys,
controlled by the operator of the ProSe APP server. When security is applied
to the ProSe APP layer, it is unnecessary to provide confidentiality and
integrity protection for the user plane data no on the EPS layer.
Editor\'s Note: If there are EPS layer control plane functions that still
require confidentiality or integrity protection for NSPS use cases is FFS.
Assume that two NSPS UEs are in LTE coverage, communicate over the regular LTE
IP access, and that they have established a secure end-to-end connection. As
noted in the previous paragraph, this cannot always rely only on normal LTE
security. On high level, there are two alternatives for establishing the
security. Either the security protection - based on non-3GPP credentials - is
constructed as an extension to the EPS protocols (e.g., NAS, RRC and PDCP),
or, the security protection is applied on a higher layer. If the protection is
provided on a higher layer, it can be made largely independent from the normal
EPS protocols and procedures.
If an NSPS UE switches between a ProSe bearer and a normal EPS bearer during a
secure communication with another NSPS UE, a security solution relying on EPS
layer security either have establish security for the ProSe bearers and EPS
bearers every time they switch, or there needs to be some form of caching of
security context in the UEs. Both these alternatives imply a higher degree of
complexity compared to a solution based on higher layer security. A solution
based on higher layer security could, for instance, work even if there is no
security provided on the ProSe bearer; such a solution would keep its security
context on a higher layer regardless of which bearer is used.
ProSe also includes the possibility that a UE shall provide relay services to
NSPS UEs that are out of coverage as depicted in Figure 6.3.3.2.1-1. To enable
true end-to-end security based on credentials controlled by the NSPS
organization in this situation, the security processing has to be applied
above the PDCP layer. It could be applied on the IP layer, the transport layer
or the application layer.
{width="6.689583333333333in" height="2.692361111111111in"}
**Figure 6.3.3.2.1-1: Example where security is applied above the EPS layer**
##### 6.3.3.2.2 Conclusions
From the above, it seems that it makes sense to separate the security
requirements between the ProSe APP layer and the ProSe EPS layer. The ProSe
EPS layer should provide the same, or very similar, security functions as
normal LTE does. For users with stronger security requirements, the ProSe APP
layer can take care of these. Parts of the ProSe APP layer may be specified by
3GPP in form of enablers that will aid the ProSe APP servers and functions to
establish secure and reliable communications. Figure 6.3.3.2.2-1 below shows
several examples of the two different layers of security.
{width="5.981944444444444in" height="2.897222222222222in"}
**Figure 6.3.3.2.2-1: The two layers of security in ProSe and\ their relations
in three example configurations**
One option to realize the ProSe APP layer security could be to use IMS media
security as defined in TS 33.328 [16].\ If the KMS based solution is used for
key distribution, an NSPS organization can run the KMS themselves, to ensure
that they control the trust anchor for their private overlay network. The KMS
based solution described in TS 33.328 [16] does not work in offline mode. The
operator can offer IMS infrastructure, in addition to the ProSe EPS layer, as
a service the NSPS organization.
Another option is to use an IPsec or TLS VPN.
In both cases there is less work to do for 3GPP, so the ProSe work can be
completed quicker than if 3GPP have to design and specify the security for
this layer as well.
#### 6.3.3.3 Structure of the PC5 reference point
The ProSe EPS layer, at the bottom of the protocol stack, is comparable to the
LTE-Uu reference point between the UE and the eNB. This can provide similar
security functions as the LTE-Uu reference point, integrity for potential
control plane traffic and encryption for both user plane and control plane
traffic. These security functions provide sufficient protection for regular
users.
The ProSe EPS layer may, in addition to the security functions of LTE-Uu,
provide some NSPS enabler functions.\ An example of these enabler functions is
prioritization of traffic to provide NSPS UEs with better quality of service.
Even if NSPS enabler functions are added, this layer does not provide stronger
confidentiality or integrity protection functions such as end-to-end
encryption or mutual authentication between devices.
On top of the ProSe EPS layer, the ProSe APP layer provides stronger security
functions such as end-to-end encryption. The ProSe APP layer also makes it
possible to allow the trust anchor to belong to the NSPS organization, which
is likely to make ProSe more attractive to NSPS organizations.
Establishing security for the ProSe APP layer over the PC5 reference point may
require signalling over PC1, PC2 and PC3 reference points. Security may also
be established using pre-configured security parameters.
### 6.3.4 Solution #3.4: Security for one-to-many communication
#### 6.3.4.1 General
This solution addresses key issues #A2.1, #3.1 and #3.3 in the current
document. It is aimed to provide the security solution for one-to-many direct
communication solution described in 5.4.1, TS 23.303 [20].\ The one-to-many
direct communication solution has the following characteristics about
security:
\- Members of a group share a secret from which a group security key may be
derived to encrypt all user data for that group.
\- Authorization for one-to-many ProSe Direct Communication is configured in
the UE by the ProSe Function using PC3 reference point.
\- ProSe UE configuration parameters (e.g. including ProSe Group IP multicast
addresses, ProSe Group IDs, Group security material, radio related parameters)
are configured in the UE.
The overall procedure is as follows:
{width="6.6875in" height="3.7069444444444444in"}
Fig. 6.3.4.1-1: Security procedure for one-to-many direct communication
solution
#### 6.3.4.2 Solution for configuration
From SA2 agreements, a configuration procedure is performed to provision the
security material, which is the shared group secret. From this group secret,
SA3 may develop security solution for one-to-many ProSe Direct Communication.
The security solution for configuration data transfer is specifically defined
in clause 6.1.\ Either solution defined could be used here to protect the
configuration procedure.
#### 6.3.4.3 Solution for ProSe UE direct communication
There is no signalling over PC5 control plane, so only protection for user
data should be considered. For en/de-crypting the user data, ProSe UEs of the
same group should share group ID, the group encryption key, the group key
identifier, the encryption algorithm and a validity timer, all of which are
configured to ProSe UE as group secret.
The ProSe Function directly configures the ProSe UE with the group encryption
key. This means no derivation is performed for ProSe UE, and there is no need
to synchronise parameter(s) for key derivation between ProSe UEs either. If
the valid timer of the group encryption key expires, the ProSe Function
reconfigures the updated group key to ProSe UEs.
The ProSe UEs are authenticated by the ProSe Function during the configuration
procedure. Only authenticated UEs are provided with the group secret. So the
mutual authentication between UEs could be implicit by possessing the shared
group secret. Then the ProSe UEs start communication protected by the
configured key and algorithm.
#### 6.3.4.4 Key management
When the group en/de-cryption key is configured to the ProSe UE, it should be
securely stored in the UICC or in the ME. The pre-configured key shall never
leave the secure environment within the UICC or ME.
The confidentiality key used to protect the communication data are the
configured key and sent to the ProSe layer in the UE. The ProSe UE directly
uses this key and the configured encryption algorithm to protect all the user
data.
Once the confidentiality key used to protect the communication data expires or
is not secure, the ProSe Function should reconfigure ProSe UEs with new key
and algorithm.
As the basis of secure group communication is the safety of the pre-configured
key, it should be refreshed when it is expired or when it is not secure any
more. In case the pre-configured key is stored in UICC, it could be refreshed
by OTA. The configuration/reconfiguration procedure could be used to update
the group key As TS 23.303 [20] specified, OMA DM is used as the protocol to
authorize and provision the UE via PC3, OMA DM can also be used to update the
group key of ProSe UE.
If a ProSe UE intents to join the group, it should communicate with the group
manager to get authentication and authorization. In this phase the shared
group security material is configured into the ProSe UE.\ The configuration
may be performed online or manually.
### 6.3.5 Solution #3.5: Security for one-to-many security
#### 6.3.5.1 General
This solution addresses key issue #1.1, #3.1 and #3.2 in the current document
and is a security proposal for the one-to-many communication in TS 33.303
[20].
#### 6.3.5.2 Solution description
##### 6.3.5.2.1 Security keys and their lifetimes
A UE needs to have algorithm identities and a PGK (ProSe Group Key)
provisioned for each group that they belong to. From this key, a UE that
wishes to broadcast some encrypted data shall first generate a PTK (ProSe
Traffic Key).\ The parameters used in this generation ensure that PTKs are
unique for each UE and the parameters need to be transferred to the receiving
UE in the header of the user data packet (see below for more information).
From the PTK, a UE firstly derives the needed ProSe Encryption Key (PEK)
depending on whether the traffic is to be encrypted.
NOTE: Integrity protection could be added to this solution at a later phase if
requirements change.
The UE shall then protect the data to be sent with the relevant keys and
algorithms. at the bearer level (see below for more details). A receiving UE
would need to derive the PTK using the information in the bearer header and
from this the PEK used to decrypt the data.
When the PGKs are provided to the UE (either through initial provisioning or
from the ProSe Key Management Function (see subclause 6.2.6.2.3)), they shall
be provided with an Expiry Time. The Expiry Times of the PGK need to be set in
such that the later PGK keys have longer expire time before they expire.
When a PGK key expires in the sending UE and receiving UE, all related keys as
PTK and PEK derived from the expired PGK shall be deleted.
When protecting data that is to be sent, the UE uses the first of the PGKs
that has not expired to derive the PTK etc. When receiving protected data the
UE shall only use a PGK that has not expired or the PGK that has most recently
expired. All other PGK should be deleted.
Editor\'s note: The validity of this key management for PS purposes needs to
be confirmed.
##### 6.3.5.2.2 Identities
The PGKs are specific to a particular group and hence have a Group Identity
associated with them. In addition each PGK associated with a group has PGK
Identity to identify it. This allows several PGKs for a group to be held
simultaneously as each can be uniquely identified. This means that the
combination of Group Identity and PGK identity uniquely identifies a PGK. The
Group Identity is the Layer 2 destination identity of the group.
Each member of a group has a unique Group Members Identity. This is used a
part of the PTK derivation to ensure each user generates unique PTKs for
protecting the data that they send. The Group Members Identity is the Layer 2
source address when the UE sends data.
The PTK identity shall be set to a unique value in the sending UE that has not
been previously used together with the same PGK and PGK identity in the UE.
Editor note: It\'s FFS how the PTK Identity is updated.
It is necessary for each group member to be able to ensure keystream
freshness.
NOTE: The PTK identity part is not needed to ensure freshness but does provide
a way of limiting the amount of material protected directly by a specific key
Taking all the above into account, a PTK is uniquely identified by the
combination of Group Identity, PGK Identity, Group Member Identity of the
sending UE and PTK identity.
The Counter is used under a particular PTK to ensure keystream freshness in
the same way that the PDCP Counter or NAS Counters are used in regular LTE,
I.e. each Counter value shall be used only once with a particular PTK.
Editor\'s note: The difference between PDCP sequence number in legacy PDCP
protocol and Counter needs to be explained.
Editor\'s note: The exact size of the above parameters requires further study
to ensure that the fit with PS needs.
If the Counter is about to wrap around in the sending UE then a new PTK
Identity shall be selected (which has not been previously used together with
the same PGK and PGK identity in the UE), and a new PTK key shall be derived
from the PGK key taking the new PTK Identity into use. A new PEK shall be
derived from the new PTK key as well.\ The old PTK key shall be deleted
together with the corresponding old PEK derived from the old PTK key.
If the receiving UE receives a PDCP packet with a new PTK Identity that has
not been previously used with the same PGK and PGK identity in the receiving
UE, then the receiving UE shall delete any old PTK key kept for the same PGK
and PGK identity and also delete the corresponding old PEK derived from the
old PTK key.
Editor\'s note: Its FFS whether the sending UE at UE power off needs to store
the PTK Identities that has been used with a specific PGK and PGK Identity in
order to avoid key-stream reuse at UE power on.
##### 6.3.5.2.3 Security flows
The protection of one-to-many communication proceeds as shown in the figure
below.
Figure 6.3.5.2.3-1: One-to-many security flows
0a or 0b: If needed the UE is configured with any private keys, associated
certificates or root certificate that they may need for contacting the ProSe
Key Management Function to allow the keys to be kept secret from the operator.
If none are provided, then the USIM credentials will be used to protect that
interface.\ The [UE]{.underline} may also be pre-configured with the address
of the ProSe Key Management Function.
0c and 0d: The ProSe Function needs to be configured with which subscriptions
(either mobile subscriptions or identities in certificates) are member of
which groups.
1a or 1b: The UE fetches the one-to-many communication parameters from the
ProSe Function. As part of this procedure the UE get their Group Identity (see
TS 23.303 [20]). In addition the UE may be provided with the address of the
ProSe Key Management Function that it will use for obtaining keys for this
group.
2a.i or 2b.i: The UE sends the Key Request message to the ProSe Key Management
Function including the Group Identity of the group for which it wants to fetch
keys and UE security capabilities (including the set of security algorithms
the UE supports).
2a.ii or 2b.ii: The ProSe Key Management Function checks whether the group
security algorithms are supported by the UE according to the UE security
capabilities, I.e. whether the group security algorithms are included by the
set of security algorithms the UE supports.
2a.iii or 2b.iii: The ProSe Key Management Function responds with the Key
Response message. If the check of step 2a.ii or 2b.ii is successful, this
message contains an ordered set of key information made of ProSe Group Key
Identity, ProSe Group Key, Expiry Time, the UE\'s Group Member Identity and
the confidentiality algorithm that the UE should use when sending or receiving
protected data. Otherwise, this message contains an indicator of algorithms
support failure as the UE does not support the required algorithm.
3a or 3b: The UE calculates the PTK and PEK as necessary to protect the
traffic it will send to the group. It does this by selecting the PGK as
described in subclause 6.3.6.2.1 and uses the next unused combination of PTK
Identity and Counter. It then protects the data using the algorithm given in
step 2x.ii.
4a or 4b: A receiving UE gets the Group Identity and Group Member Identity
from the layer 2 header. It then uses the PGK Identity provided to first check
that the PGK is valid (see subclause 6.3.5.2.1) and if so calculates the PTK
and PEK as needed to process the received message.
##### 6.3.5.2.4 Protection of traffic between UE and ProSe network entities
using GBA
Between the UE and ProSe Function,
> for UE initiated messages, PSK TLS with GBA based shared key-based mutual
> authentication shall be used as specified by clause 5.4 of TS33.222 [5].
>
> The ProSe Function (NAF) shall request USSs from the BSF when requesting the
> Ks_(ext/int)_NAF key and the ProSe Function shall check in the USS if the
> USIM is authorized to be used for ProSe services. If the authorization in
> the ProSe Function fails then the ProSe Function shall release the PSK-TLS
> connection with the UE.
>
> for network initiated messages one of the following mechanisms shall be
> used:
>
> \- If a PSK TLS connection has been established as a part of a pull message
> and is still available, the available PSK TLS session shall be used.
>
> \- Otherwise, PSK TLS with GBA push based shared key-based mutual
> authentication between the UE and the ProSe Function shall be used. GBA push
> is specified in TS 33.223 [7]. The ProSe Function (pushNAF) shall requests
> USSs from the BSF when requesting a GPI, and the ProSe Function shall check
> in the USS if the USIM is authorized to be used for ProSe services. If the
> authorization in the ProSe Function fails then the ProSe Function shall
> refrain from establish PSK TLS with GBA push.
NOTE: If a TLS connection is released, it can only be re-established by the
client, I.e. UE, even though the TLS session including security association
would be alive on both sides. TLS connection, in turn, is dependent on the
underlying TCP connection.
Between the UE and ProSe Key Management Server, if the USIM credentials are to
be used then the same security procedures as above are used. If the USIM
credentials are not used, mutual certificate based authentication in TLS shall
be used using the private key and certificates provisioned on the UE. In both
case, a ciphersuite using non-null encryption shall be used.
##### 6.3.5.2.5 Protection of traffic between UEs
###### 6.3.5.2.5.1 Key derivation
When calculating a PTK from PGK, the following parameters shall be used to
form the input S to the KDF that is specified in Annex B of TS 33.220 [6].
> \- FC = to be allocated if there is normative work here
>
> \- P0 = Group Member Identity (I.e. the Layer 2 source address of the
> sending UE)
>
> \- L0 = length of above (which is FFS)
>
> \- P1 = PTK Identity
>
> \- L1 = length of above (which is FFS)
When calculating a PEK from PTK, the following parameters shall be used to
form the input S to the KDF that is specified in Annex B of TS 33.220 [6].
\- FC = to be allocated if there is normative work here
\- P0 = algorithm type distinguisher (similar to TS 33.401 [21])
\- L0 = length of algorithm type distinguisher (I.e. 0x00 0x01)
\- P1 = algorithm identity
\- L1 = length of algorithm identity (I.e. 0x00 0x01)
The parameters follow the encoding also specified in Annex B of TS 33.220 [6].
###### 6.3.5.2.5.2 Protection of data
The LTE ciphering algorithms (see TS 33.401 [21]) are used with the following
modifications;
Direction is always set to 0;
Bearer[0] to Bearer[4] are set to zero
COUNTER is pre-pended with 0s to make it 32 bits long and it is input into
COUNT[0] to COUNT[31]
###### 6.3.5.2.5.3 Packet Format
In terms of signalling between the UEs, e.g. to indicate the correct PTK to
use, the header and payload of the PDCP packet for user plane data will need
to look similar to the below:
Figure 6.3.5.2.5.3-1: Proposed PDCP packet format for user plane data
NOTE: The Group ID and Group member ID are parameters present in the MAC
header.
### 6.3.6 Solution #3.6: Public safety security layered over network security
#### 6.3.6.1 General
This solution provides a general approach to key issue #3.1 in the current
document.
#### 6.3.6.2 Overview of solution
Public safety users may be viewed as requiring a similar service to a standard
user, but requiring additional security features. The following are
advantageous for public safety users:
  * Able to harness the functionality available to a standard user.
  * Difficult to distinguish from a standard user.
  * Protection of privacy of identifiers from a local eavesdropper.
These desirable properties imply that a public safety solution should be a
solution designed for a standard user, but with public safety security
additions built on top. Another advantage of this approach is that it prevents
public safety security requirements impacting the normal user.
At present it appears that solutions aimed at general users are being defined
at the network layer (e.g. encryption of payload within PDCP packets) whereas
public safety solutions are being defined at the session layer (e.g.
encryption of RTP packets). It is also clear that the network layer may not be
able to provide enhanced security features that the public safety user may
require, such as cryptographic authentication, due to efficiency constraints
and packet lengths. Hence this solution proposes that two security solutions
are required for ProSe under the following model:
Figure 6.3.6.2-1: Multiple security layers for Public Safety Services
While this double layered approach may seem to introduce redundancy, it is
equivalent to the approach used for media layer security, where the network
layer is encrypted to the base station and within that the session is
encrypted as SRTP.
Another way of viewing this model is that eventually the MNO may wish to treat
ProSe as a commercial service, and public safety users as an isolated user
group within that service. Whether the MNO is simply providing access to the
transport network/spectrum, or the managing entire service, the MNO stays in
control of the use of ProSe at the network layer. At the same time, the burden
on the MNO is reduced. Network layer configuration to support public safety
users will be minimal, with intelligent group management occurring at the
(entirely software-based) session layer.
Figure 6.3.6.2-2 describes this approach to ProSe security. The MNO manages
access to the public safety services via network layer security, the service
provider manages dynamic subgroups via session layer security.
Figure 6.3.6.2-2: Group separation over two layers
As part of this approach, it is essential to define the security processes at
both the network layer, and the session layer. Only with both components
defined will it be possible to setup secure group communications between UEs,
as required by SA1.
#### 6.3.6.3 General Security Procedures
This clause describes general procedures to setup and use a public safety one-
to-many communication.
##### 6.3.6.3.1 Network Operator Setup Procedures
The network operator is responsible for controlling which UEs are allowed
access to public safety services.\ Upon request by the service provider, the
network operator may enable public safety ProSe services (among other
additional features). As part of the process of enabling the service, the MNO
will add the user to the \'public safety group\' and provision keying material
appropriately to allow the user to decrypt traffic at the network layer.
NOTE: At the same time, the MNO may similarly allow discovery of public safety
users.
At this point, the user can now view sessions (including identities) created
at the session layer but will not be able to read traffic at that layer.
##### 6.3.6.3.2 Service Provider Setup Procedures
Once a user has been allowed access to the public safety services by the MNO,
the service provider (which may also be the MNO) can configure the public
safety groups which the user can access and keying material associated with
those groups. This configuration may be more dynamic than that used at the
network layer.
##### 6.3.6.3.3 One-to-many Communications
Once configured, one-to-many communications are secured with all traffic
encrypted at the network layer (using a generally-applicable network-layer
security solution) and RTP traffic encrypted at the session layer (using a
security solution for public safety users).
### 6.3.7 Solution #3.7: Security for One-to-many ProSe Direct Communication
#### 6.3.7.1 General
This solution addresses key issues on one-to-many in the current specification
and protects reference point PC5 in TS 23.303 [20].
#### 6.3.7.2 Authentication for One-to-many ProSe Direct Communication
The ProSe enabled UEs for One-to-many communication should be authenticated to
get the Group ID and Group Key. After the UEs for One-to-many ProSe Direct
communication are authenticated and registered ProSe Function, UEs can get
Prose Group Key. For public safety UE, UE sends the value to HSS to get
verification for public safety.\ After provisioning or verification, public
safety UE can perform Prose One-to-many Prose Direct Communication.\ To
authenticate each other for ProSe Group members, mutual authentication should
be used.
Figure 6.3.7.2-1: Overview of security for one-to-many ProSe direct
communication
#### 6.3.7.3 Key generation for One-to-many ProSe Direct Communication
After the UE is authenticated and registered ProSe Function, UE can receive
the group join request or broadcast message for Prose Group communication. The
Group Key is generated or provisioned in HSS as subscription data, and it can
be registered to ProSe function.
### 6.3.8 Conclusion on one-to-many security
#### 6.3.8.1 Summary of ProSe one-to-many communication solutions
Clause 6.3 contains four solutions which aim to meet the requirement for ProSe
one-to-many communications; solution #3.1, #3.4, #3.5 and #3.7.\ Solutions
#3.3 and #3.6 are relevant but describe a generic approach rather than a full
solution.\ Solution #3.2 provides solutions for group owner mode and hence
these cannot be directly compared as they apply to a different ProSe
architecture.\ Table 6.3.8.1-1 summarizes the features of the four solutions.
Table 6.3.8.1-1 Summary of solutions for ProSe one-to-many communications
* * *
                                                  Solution \#3.1                                                                                       Solution \#3.4                                                                              Solution \#3.5                                                                                                                               Solution \#3.7
**Configuration requirements** IDENTITY user key configuration by KMS. The
encryption key, the encryption algorithm and group ID are configured to the
ProSe UE. Group identities and group key IDs. Potentially also the address and
certificates (or keys) for connecting to the key management function. ProSe UE
should be authenticated. **Group Key Distribution process** Group key sent
inside a Group Notification message. As part of configuration process (clause
6.1) Direct connection to key management function delivering a key response
The Group Key is generated or provisioned in HSS as subscription data.
**Confidentiality of Group Key Distribution** Group Key encrypted to UserID.
As part of configuration process (clause 6.1) TLS-PSK connection to group
manager keyed by GBA or shared certificates - **Authentication of Group Key
Distribution** Group Key is signed by Group UserID. As part of configuration
process (clause 6.1) Either GBA or shared certificates provide authentication
of tunnel. - **Group Key Update/ Revoke mechanism** Repeat group key
distribution process. Revocation implicit as latest group key is used. Rekeyed
over OTA or OMA DM. Uses existing connection or GBA push mechanism. Keys have
lifetime and expire. - **Generation of traffic encryption keys** Generation
process is performed by UE, but process is undefined. Not required. Traffic
key appears to be the Group key. Generated directly from group key using KDF,
traffic key ID and algorithm ID. - **Group key storage** Inside secure storage
(ME or USIM). Inside secure storage (ME or USIM). - - **Traffic Key
distribution** Distributed during setup and protected by group key. No traffic
key distribution. Traffic key appears to be the Group key. No traffic key
distribution required. Traffic key ID sent in PDCP packet header. -
**Encryption algorithms** SRTP algorithms. Defined as part of configuration
process (clause 6.1) LTE ciphering algorithms. - **Replay protection**
Provided by SRTP. PDCP count by default. - - **Layer at which encryption is
applied** SRTP (over UDP/IP) PDCP or application layer PDCP - **Data
encrypted** All RTP data routed over ProSe. May also be applied to other use
cases. User data All data routed over ProSe link. - **Initiating UE
Authentication** Setup may be signed by initiator No authentication due to
lack of integrity protection. No authentication due to lack of integrity
protection. Mutual authentication should be used **Privacy of user
information.** User IDs available. These may be anonymized (e.g. \'User1234\')
where greater privacy is required. User data encrypted. Share group ID and
group key identifier. Group ID and Group member ID are parameters present in
the MAC header. Group key ID and traffic key ID in PDCP header. -
* * *
#### 6.3.8.2 Evaluation against requirements
Clause 6.3 contains four solutions which aim to meet the requirement for ProSe
one-to-many communications (decentralized-mode). These are Solution #3.1,
#3.4, #3.5 and #3.7. Solutions #3.3 and #3.6 are relevant but describe a
generic approach rather than a full solution. Solution #3.2 provides solutions
for group owner mode and hence these cannot be directly compared as they apply
to a different ProSe architecture.
Clause 5.3 lists requirements on these solutions resulting from key issues.
This clause evaluates the solutions against the requirements.
At this time, Solution #3.7 does not contain sufficient detail to evaluate it
against the requirements and hence has not been included in the table.
**Table 6.3.8.2-1 Evaluation of solutions against requirements**
* * *
                                                                               Solution \#3.1                                           Solution \#3.4                                   Solution \#3.5
Necessary keying material provided without UE-to-UE interaction Yes, provided
within Group Notification Yes, provided as part of configuration process Yes,
provided over TLS-PSK connection Confidentiality provided both in and out of
coverage. Yes, via SRTP No detail on encryption of user data. Yes, via PDCP
encryption Security mechanism is scalable Yes, centrally keyed Yes, centrally
keyed Yes, centrally keyed Allows rapid setup of group communications Yes No
detail on encryption of user data. Yes, once group has been keyed Keys shall
be integrity and confidentiality protected during transmission. Yes, integrity
protection provided via MIKEY signature Dependent on configuration solution
Yes, inside TLS-PSK tunnel. Only authorized UEs shall receive keys Yes, keys
encrypted to authorized user identity. Dependant on configuration solution
Yes, only authorized UEs can establish TLS-PSK tunnel. Key distribution entity
shall be authenticated Yes, via MIKEY signature on key Dependant on
configuration solution Yes, via authentication of TLS-PSK tunnel. Keys can be
stored for past and future cryptoperiods Yes Yes Yes Late entry shall be
supported. Yes, though not explicitly described. No detail on encryption of
user data. Yes, though not explicitly described. Key shall be securely stored
in UE. Yes Yes Yes, but not explicitly described. Key should not be used when
required (revoked) or its lifetime expires. Keys can be revoked / updated and
have a cryptoperiod. May be revoked via OTA or OMA DM, Keys have a
cryptoperiod. Revocation mechanism not explicitly described.
* * *
Table 6.3.8.2-1 demonstrates that solution #3.1 and #3.5 are able to meet the
requirements placed upon the solutions.\ At the present time there is not
sufficient detail to establish if solution #3.4 or solution #3.7 will meet the
requirements.
The following are advantages of solution #3.1:
  * Flexible group management. Group information need not be configured as part of operator configuration.\ Group keyed/revoked via single message per user. Allows for asynchronous keying of group members.
  * Enhanced security such as caller authentication during initiation of connection and group key revocation.
  * Solution provides group RTP encryption and hence may be applicable to a wide variety of public safety use cases.
  * More closely related to media security mechanisms
The following are advantages of solution #3.5:
  * Encrypts entire packet sent by UE and hence able to control access to all ProSe communication resources.
  * More closely related to LTE air-interface security mechanisms.
Solution #3.1 and #3.5 are very different, independent approaches to meeting
the requirement which operate at different layers. As discussed in Solution
#3.6, if run in tandem the advantages for both solutions could be realised at
the same time and, in addition, there is the further advantage that the
granularity of group management could differ for each solution. For example,
Solution #3.5 could manage access security to ProSe communications, meaning
that the group in this case will be the entire user group, whereas Solution
#3.1 could manage the day-to-day, fine-grained manipulation of public safety
groups.
#### 6.3.8.3 Conclusion to evaluation of one-to-many communication solutions
At this stage, Solution #3.1 and #3.5 are the only two fully formed solutions
for one-to-many communications.\ These two solutions both meet all the
requirements listed in the key issues. In direct comparison, Solution #3.5 has
the advantage that it encrypts the entire packet, and hence can provide access
control to all ProSe communication features, whereas Solution #3.1 has the
advantage of enhanced security, flexible group management and, potentially,
wider applicability. Both solutions are entirely independent and can operate
concurrently.
As discussed in Solutions #3.3 and #3.6 of clause 6.3 of the TR, there are
advantages to layering security solutions for public safety users to better
meet these user\'s enhanced security requirements. In mirroring the approach
to media security (where SRTP is layered over LTE network security) layering
SRTP over a PDCP security will enhance security, maintain control with the
MNO, while allowing the public safety users the flexibility to manage their
own groups.
In conclusion, these are complementary solutions which meet the user\'s
requirements and provide additional benefits when used concurrently. Hence
both should be specified in the ProSe TS 33.303 [20], Solution #3.1 providing
media plane security and Solution #3.5 providing network layer security.
### 6.4 Solutions for other areas
### 6.4.1 Solution #4.1: ProSe accounting
#### 6.4.1.1 UICC based ProSe Accounting
In order to confirm sufficient level of trust, UICC should impose accounting
limits for ProSe communication.\ Involving UICC allows the operators to
control and also collect the data on the amount of authorized
transmission/receptions. By linking security mechanism with charging
functions, an acceptable level of trust is achieved for ProSe accounting.
Potential mechanism would be to allow the UICC to perform accounting based on
the number of security keys issued to the device or the time allowed for ProSe
direct communication.
The ProSe accounting related parameters are included and configured in the
UICC by the ProSe Function using PC3 reference point, along with the
provisioning parameters for ProSe Direct Communication (TS 23.303 [20]).\ The
UICC that has been configured for ProSe have the accounting capabilities and
may be provisioned with a credit limit based on network policy and/or
subscription (prepaid or post-paid). The credit limit and accounting
information are based on the number of keys to be provided (which is related
to number of messages received/transmitted) by the UICC to the device for
ProSe Direct Communication.
Linking of security mechanism with charging function is achieved by making the
ME to obtain parameters needed for its security context (Group Session Key)
from the UICC always, so that the ME performs communicates with other UEs
securely. Eventually when exhausting the security context after particular
volume of data transmission, the ME needs to obtain fresh session key in order
to further communicate with other UEs, when requested for new key by the ME,
the UICC will account the number of keys issued to the ME and provides the new
session key. By doing so, the UICC can collect the information on the number
of keys received by the ME over a period of time and/or control the number of
key to be issues based on the preconfigured credit limit. The operator
retrieves the accounting information from the UICC directly which operator can
trust the information for generation of the Charging Data Records (CRDs).
Optionally the operator may also authorize some maximum amount of key to be
retried (e.g. prepaid) in the UICC, to control the credit limits.
Most of the solution in the present document for ProSe Direct communication
uses group pre-shared key provisioned by the network and securely storage in
the UICC and group session key is derived from the group pre-shared key to
protect the group communication data traffic. Since the UICC provides the
session key for limited volume of data, the UICC can account the volume of
data based on the number of keys issued and report the accounting data to the
network to generate CRD for the UE. Below clauses details the two possible
charging mechanisms namely volume based charging and time based charging for
the ProSe direct communication involving the UICC.
Editor Notes: Integrity of the volume parameter and time parameter received
from ME should be ensured.
##### 6.4.1.1.1 Volume based charging
Figure 6.4.1.1.1-1 below details the flow for volume based charging aspects
for Prose direct communication (one-to-many communications).
Figure 6.4.1.1.1-1 : UICC based ProSe Accounting
  1. Service authorization for ProSe direct services is performed for ProSe Direct Communication and UE is configured with the related information for one-to-many ProSe Direct Communication.\ The UE obtains the necessary group context including the ProSe accounting information.\ The accounting information may include the credit limit Volume~Threshold~.
  2. The provisioning of accounting parameters for ProSe Direct Communication may be configured in the UICC.
  3. The originating UE finds the appropriate radio resource to conduct one-to-many ProSe Direct Communication.
  4. Most of the solution in the present document for ProSe Direct communication uses group pre-shared key provisioned by the network and securely stored in the UICC and group session key is derived from the group pre-shared key to protect the data traffic. Since the UICC provides the session key for limited volume of data, the UICC can account the volume of data based on the number of keys issued. The group session key is derived from the group pre-shared key as follows:
> K~Group-ProSe-Session~ = KDF {K~Group-Pre-shared~, UE-a ID,
> Volume~Threshold-UE-a~}
  * K~Group-ProSe-Session~ : Key used to protect the group data. This key is valid only till the data transfer reaches the threshold value (Volume~Threshold~UE-x)
  * K~Group-Pre-shared~ : Provisioned by the network as part of group information.
  * UE-a ID : Identity of the originating Prose device
  * Volume~Threshold~UE-a : Provide by UICC based on the permitted Volume threshold value. Volume~ThresholdUE-a~ value will be less than or equal to Permitted Threshold value. UICC decides on the splitting of permitted threshold values as to refresh session key, so that session key will not be used for long time. Volume~Threshold-UE-a~ value may not be the permitted value (pre-paid capacity), it can be random within the total credit limit. The UICC will not provide new Volume~Threshold-UE-a~ and the session key (charging key), if the Volume~Threshold-UE-a~ reached the permitted threshold value.\ Since the permitted Threshold value is not known to the device and Volume~Threshold~ is required to refresh the session key, complete control on the charging can be achieved by the security mechanism. Since Volume~Threshold~ is used for key derivation, any tampering or faking by the originating ME will lead to wrong key generation in the other UEs.
  * ProSe Direct communication confidentiality is performed as shown below in the figure. Volume~COUNT~ and Volume~Threshold~ are used to ensure and enforce, that the other party in communication expects new fresh key once the Volume~COUNT~ reaches the Volume~Threshold~. For every key establishment (including Key refresh), the Volume~COUNT~ value is initialized to \"0\" and increment for every packet. Alternatively, the Volume~COUNT~ will be increment based on the application data size. The Volume~COUNT~ value is carried along with the message. Volume~COUNT~ can be PDCP COUNT, if ProSe uses the PDCP layer. Since the permitted Threshold value is not known to the device and it is required to refresh the session key for every intermediate Volume~Threshold~, device always depends on the threshold value and the session key.
{width="6.105555555555555in" height="3.3048611111111112in"}
Figure 6.6.1.1.1-2 : Ciphering of ProSe direct communication data
  1. When the ME performs communicates with other UEs, eventually exhausts the security context after particular volume of data transmission. Then the ME needs to obtain fresh session key in order to further communicate with other UEs, when requested by the ME for new key, the UICC will account the number of keys issued to the ME. By doing so, the UICC can collect the information on the number of keys received by the ME and/or control the number of key to be issues based on the credit limit. The MEs when requesting for new key or when closing the group communication, provide the key usage details (volume count details) to the UICC, to make note of it for accounting.
  2. The originating UE then provides the new Volume~Threshold~ to others UEs to refresh the key K~Group-ProSe-Session~
  3. Other UEs in the group request the respective UICC to provide refreshed keys by providing the originating UE-ID and the Volume~Threshold~ value. The UICC provides new key and updates it in the accounting information.
  4. Data Transfer resumes with new session key protection (increments Count value for each packet transfer).
  5. and 11. UEs reports the accounting details (number of key issued to ME, IDs of the other ProSe UEs, Time information, volume of data transmitted/received (in terms of Volume~Thresholds~)) to the ProSe Function securely through management protocols, periodically or when UE establish communication with the network..\ The accounting detail contains its information and also other UEs information it communicates with.\ For Public Safety UEs in \"out of network coverage\" cases, the ProSe session accounting data is reported to the network, when the UEs go back into coverage (offline accounting). Therefore, delayed reporting of the ProSe session accounting data is possible.
```{=html}
``` 12\. The ProSe function consolidates the report received from different
UEs and prepares the CRDs.\ A fraudulent use of keys could be detected by
means of discrepancies (more data was received from a UE than it claims to
have sent) among the reports from the listening UEs.
Editor\'s Note: Complete mechanism to be developed in alignment with the
direct communication security mechanism and charging architecture.
Editor\'s Note: If the group context, ProSe configuration and related
credentials are stored in the secure environment of the ME, then the secure
environment performs the ProSe accounting mechanism detailed in this clause.
##### 6.4.1.1.2 Time based charging
The ProSe Function provisioning the configuration data provides Prose
configuration with its lifetime (how long it is valid) for prepaid scenario.
The ProSe configuration along with its lifetime is stored in the UICC and then
provided to the device, based on request from the device. Once the validity
time is expired, the UICC and device deletes the configuration. Based on the
authorized subscription and credits/credentials available for the particular
subscriber, the network renews the ProSe configuration in the UICC. Before the
lifetime expires, either the network provides configuration along with new
validity time or alternatively, the device contacts the network to obtain
validity time extensions. This allows an operator to define a limited use
policy for the UE.
In case of post-paid scenario, the UICC may also include the \"TIMER
MANAGEMENT\" proactive command along with the ProSe direct communication
configuration (c.f. ETSI TS 102 223 [32]) to the device, so that the device
replies back for the proactive command, the time period the configuration was
used, for the UICC to performing accounting.\ Then the network obtains the
accounting information from the UICC and creates CRD for the UE.
###### ### Annex A: Possible post-Rel-12 Key Issues
## A.1 Key Issues on Discovery
### A.1.1 Key Issue #A1.1: Security analysis for restricted ProSe discovery
#### A.1.1.1 Issue Detail
In TR 22.803 [31] clause 5.1.1 restricted ProSe discovery use case, 3 users
with proximity-enabled UEs are involved. Mary has authorized John\'s UE to
discover her UE and vice versa. At the same time, John has authorized Peter\'s
UE to discover his UE and vice versa. But Mary\'s UE is not authorized to
discover that Peter\'s UE is in its proximity.
In other words, a UE shall be not able to discover other UEs which are not
authorized to be discovered.
#### A.1.1.2 Security Threats
Based on SA1\'s description, the discovery could be either using direct radio
signals or EPC based. Mary\'s UE does not detect Peter\'s UE because there is
no authorization given by Peter\'s to Mary\'s discovering him. However, if
Mary\'s UE is compromised, it could try to discover all Proximity-enabled UE
near her, including the UEs not authorized to be detected, e.g. Peter\'s UE.
If there is no mechanism in the ProSe system (either on network side or on UE
side) to prevent unauthorized discovery, Mary\'s UE may be able to discover
Peter\'s UE. It will break the principle of restricted discovery.
#### A.1.1.3 Security requirements
The following security requirement fits for non-public safety use cases only:
  * the network should allow a UE to discover only other proximity-enabled UEs which it is currently authorized to discover in case of EPC-level ProSe discovery.
  * the ProSe system should allow a UE to discover only other proximity-enabled UEs which it is currently authorized to be discover in case of ProSe direct discovery.
Editor\'s note: These cases are not considered for public safety UE in Rel-12
### A.1.2 Key Issue #A1.2: Restricted ProSe Direct Discovery
#### A.1.2.1 Key issue details
One of the key capabilities of a ProSe-enabled UE is to be able to discover
other ProSe-enabled UEs in its vicinity by using direct (UE-to-UE) signalling
with E-UTRA technology. As part of the normative requirements in TS 22.278 [3]
there are two types of discovery: open and restricted. Open applies where
there is no explicit permission that is needed from the UE being discovered,
while restricted discovery only takes place with explicit permission from the
UE that is being discovered.
#### A.1.2.2 Security threats
In direct discovery, a ProSe-enabled UE broadcasts an identity that can be
received by other Pro-enabled UEs that are in range to hear these broadcast
identities. The receiving UE can analyze received identities in order to
decide if any UEs it is wanting to discover are in its proximity.
As noted above there are two types of discovery, open and restricted. With
open discovery, there is no requirement for the one UE to be authorized to
discover the other UE. This means that the identity that is broadcast for this
type of discovery is assumed to be knowable to all UEs (this is true whether
the actual identity is broadcast or some well known mapping of the identity is
broadcast).
With restricted discovery, a UE needs to be authorized to be able to discover
a particular UE. In particular the broadcast identities should prevent the
discovery of a UE without their explicit permission. This threat also extends
to the ability to track such a broadcasting UE even if it is not known who the
UE belongs to by the broadcast identity. Clearly anyone with the permission to
discover the UE would be able to track them, as this is effectively part of
the permission to discover in the first place.
A final security threat is that of unauthorized announcements (e.g.,
impersonation and replay threats). This may cause a receiver to believe that
the other UE is in proximity when it currently isn\'t, and hence take whatever
action discovering that UE would involve. For restricted discovery case, only
a UE authorized to discover that UE should know the identity that will be
broadcast.
#### A.1.2.3 Security requirements
The system shall prevent impersonation attacks.
The identities announced on the air interface shall be able to be protected
from being understood by a currently unauthorized UEs, in order to support
restricted discovery. Furthermore, the tracking of UEs based on their
announced identities over time should be minimized.
The opportunity for replay attacks on identities announced over the air
interface should be prevented.
## A.2 Key Issues on One-to-many communications
### A.2.1 Key Issue #A2.1: Mutual authentication of ProSe enabled devices in
group owner mode
#### A.2.1.1 Key issue details
In network coverage scenarios UEs are mutually authenticated to the network.
Currently UE to UE authentication is not standardized. Mutual authentication
of public safety UEs in group owner mode without network coverage cannot be
performed with AKA. Authentication credentials have to be securely stored in
the UE in order to be available in the UE even without network coverage.
Depending on the sensitiveness of the credentials secure storage e.g. in the
UICC could be required. Also for maintenance it could be beneficial to store
the configuration data inclusive credentials on a removable UICC.
Editor\'s Note: The scenario when the configuration data is provided by a
provisioning server controlled by a different entity than the 3GPP operator,
needs to be considered as well. For example, the credentials may need to be
managed by an NSPS organization, and storage of the configuration data in the
UE needs to be considered also in this scenario.
#### A.2.1.2 Security threats
Device theft is a security threat; especially if there is an extensive effort
needed to exclude a single device. This was the case if e.g. the same pre-
shared secret for multiple devices is used. Such an authentication mechanism
is not scalable. If one device is compromised all communication of other
devices with the same shared secret is compromised with it.
#### A.2.1.3 Security requirements
The system should support mutual authentication of public safety UEs out of
network coverage.
Compromise of a single UE should not affect the security of the others.
Authentication credentials should be securely stored in UE.
### A.2.2 Key Issue #A2.2: ProSe Communications in Group Owner Mode
#### A.2.2.1 Key issue details
A key capability of ProSe-enabled UEs is to engage in one-to-one
communications with another UE directly over the air interface or in one-to-
many communication with other UEs over the Group Owner .
#### A.2.2.2 Security threats
All security threats in subclause A.3.2.2 apply to ProSe Communications in
Group Mode. Additionally the following threats also exist;
The man-in-the-middle attack may exist if the communication is not protected
between the first UE to the GO and between the GO and the second UE.
Though the traffic sent by an ordinary ProSe Group member is delivered in
unicast mode to the GO, which subsequently distributes it to one or all ProSe
Group members, the distribution from the GO can be in either unicast or
multicast mode. A passive attacker may eavesdrop the data packets exchanged
between the two UEs. If the GO communicates to group members in multicast mode
without applying protection to the original content, other group members in
proximity may obtain the original content broadcast by GO..
#### A.2.2.3 Security requirements
All security requirements in subclause 5.4.2.3 apply to ProSe Communications
in Group Mode. Following security requirements are for Group Mode ProSe
communication.
ProSe UEs should be authenticated by GO;
The communication data between ProSe UEs should be protected.
The data distributed by GO to all members in the same group in multicast mode
should be protected from eavesdropping by other UEs who are do not belong to
the same group as the GO.
### A.3 Key Issues on One-to-one Communications
### A.3.1 Key Issue #A3.1: Security analysis for ProSe communication
#### A.3.1.1 Issue Detail
Based on SA1\'s requirement, the system shall ensure the confidentiality of
user data and network signalling over the direct link to a level comparable
with that provided by the existing 3GPP system. Now the security context is
separate for different UE in existing 3GPP system. So it requires that the
separate security context usage in ProSe system.
#### A.3.1.2 Security Threats
When the user plane ciphering is applied, a security issue would be raised
that a ProSe-enabled UE can decrypt the communication between two other ProSe-
enabled UEs if the same security contexts are used. The attack details are
shown in the following scenario.
There are three ProSe-enabled UEs, e.g. Mary\'s UE, Peter\'s UE, John\'s UE.
When Mary, Peter, and John are communicating through the 3GPP network, there
is no common security context between them. Peter\'s UE can\'t get any plain
information between Mary\'s UE and John\'s UE. If the security context for the
communication between Mary\'s UE and Peter\'s UE was the same as for Mary\'s
UE and John\'s UE, Peter\'s UE would be able to decipher the communication
between Mary\'s UE and John\'s UE when the encrypted data is eavesdropped by
Peter\'s UE. Peter\'s UE could get the information between Mary\'s and John\'s
UE.
But in existing 3GPP, Peter\'s UE can\'t get the information between Mary\'s
and John\'s UE, specifically, when Mary\'s UE communicates with Peter\'s and
John\'s UE in LTE network. Based on LTE security architecture, Peter\'s UE and
John\'s UE will use different security context to protect the communication
with eNBs, and eNB will forward the decrypted UP data to core network and
finally send to Mary\'s UE with the protection by using other security context
between Mary\'s UE and eNB. So in this case, it doesn\'t followSA1\'s
requirement. Therefore, the SA1 requirements can be fulfilled only when
Mary\'s UE use separate contexts communicating with different UEs.
#### A.3.1.3 Security requirements
A ProSe-enabled UE should use different security contexts for ProSe one-to-one
communication with different ProSe-enabled UEs.
### A.3.2 Key Issue #A3.2: One-to-One Direct Communications using E-UTRA
#### A.3.2.1 Key issue details
A key capability of ProSe-enabled UEs is to engage in one-to-one
communications with another UE directly over the air interface.
#### A.3.2.2 Security threats
There are the following threats to the data as it is exchanged between the
UEs;
> A passive attacker may intercept the data packets exchanged by the two UEs
> and is able to obtain their true/original content.
>
> An active attacker may modify the data packets exchanged by the two UEs
> without detection by either UE.
#### A.3.2.3 Security requirements
Direct link signalling ciphering may be provided. Direct link signalling
ciphering is a configuration option.
Direct link user plane ciphering may be provided.
Direct link signalling integrity protection and replay protection shall be
provided.
Direct link user plane packets between UEs shall not be integrity protected.
Establishment of the security between the UEs shall be protected from man-in-
the-middle attacks.
Editor\'s note: Whether there is a split between user plane and signalling is
FFS
### A.3.3 Key Issue #A3.3: Mutual authentication of ProSe enabled devices for
public safety in out of coverage scenario
#### A.3.3.1 Key issue details
In network coverage scenarios UEs are mutually authenticated to the network.
Currently UE to UE authentication is not standardized. Mutual authentication
of public safety UEs without network coverage cannot be performed with AKA.
Authentication credentials have to be securely stored in the UE in order to be
available in the UE even without network coverage. It is beneficial to use an
authentication method that is suitable to generate and distribute session keys
for a secure direct link in order to provide confidentiality and integrity
protection for the communication after the authentication procedure succeeded.
Depending on the sensitiveness of the credentials secure storage e.g. in the
UICC could be required. Also for maintenance it could be beneficial to store
the configuration data inclusive credentials on a removable UICC.
Editor\'s Note: The scenario when the configuration data is provided by a
provisioning server controlled by a different entity than the 3GPP operator,
needs to be considered as well. For example, the credentials may need to be
managed by an NSPS organization, and storage of the configuration data in the
UE needs to be considered also in this scenario.
#### A.3.3.2 Security threats
Device theft is a security threat; especially if there is an extensive effort
needed to exclude a single device. This was the case if e.g. the same pre-
shared secret for multiple devices is used. Such an authentication mechanism
is not scalable. If one device is compromised all communication of other
devices with the same shared secret is compromised with it. Since entropy from
network initiated challenge response procedure is not available sufficient
entropy is needed for session key generation. Session keys can\'t be
distributed via network.
#### A.3.3.3 Security requirements
The system should support mutual authentication of public safety UEs out of
network coverage.
Compromise of a single UE should not affect the security of the others.
Authentication credentials should be securely stored in UE.
It should be possible to establish session keys securely between the UEs.
###### ### Annex B: Possible post-Rel-12 Solutions
## B.1 Solutions for Discovery
### B.1.1 Solution #A1.1: Security for discovery
#### B.1.1.1 General
This solution addresses key issue #A1.2 in the current document and is the
security part of solution D1 in TR 23.703 [4].
#### B.1.1.2 Tracking of UEs using restricted discovery identifiers
The risk of tracking of a UE by passive receivers in proximity exists if the
same announced ProSe identifier, I.e. ProSe UE Identity or ProSe Application
Identity), is sent OTA time and again in periodic announcements.
To mitigate against this attack, and also against the attack of clause
B.1.1.3, the ProSe identifiers announced/broadcasted over the air by a UE
should change from announcement to announcement, in a manner not easily
predictable by any passive receiver. Naturally, given this is restricted
discovery, the UEs that have been authorized to discover a UE are able to
understand the next OTA ProSe identifier the UE in question uses.
#### B.1.1.3 Impersonation/replay attacks on of restricted discovery
identifiers
The risk of impersonating a UE by passive receivers in proximity exists if the
same announced ProSe identifier (I.e. ProSe UE Identity or ProSe Application
Identity) is sent OTA time and again in periodic announcements.\ An announced
ProSe identifier could thus be replayed by another UE at a later time.
To address the impersonation/replay attack risk, same solution as for the
tracking risk can be employed. Furthermore with restricted discovery, the
ProSe Identifier will only be available to a known set of other users and
hence could only be transmitted by such users. However amongst a known set of
other users, the risk of impersonation attacks is of concern and to be
addressed. For some actions following discovery, e.g. ProSe communications,
there may be some authentication signalling exchanged, whereby impersonation
can be detected before any user data is actually exchanged. But if there is no
authentication following the discovery procedure, then there is impersonation
attack risk.
> Editor Note: How this solution can be used to address the impersonation
> attack mounted by known set of users (friends) needs to be detailed.
#### B.1.1.4 Protecting restricted discovery identifiers
A class of solutions that readily suggest themselves involve using a
fresh/non-repeatable known value in order to generate new and different ProSe
identifiers used over the air (OTA) from the ProSe identifiers and/or ProSe
Application keys given by the higher layers. Necessarily, the construction of
OTA identifiers shall be non-reversible, I.e. a passive attacker should not be
able to determine the underlying higher-layer ProSe identifier and/or ProSe
Application key only from the knowledge of the OTA identifier.
The requirement on non-reversible construction of OTA IDs suggests using a
one-way function. This can be applied for example at the MAC layer, taking
input directly from the application. To summarize, the MAC layer should apply
a one-way hash, such as HMAC-SHA1, to the ProSe ID and/or ProSe Application
key from the application, and only use its output for OTA announcements (the
output is part of the discovery frame defined by RAN2). The inputs to this
function depend on the next requirement.
The requirement on non-repeatability suggests using either an explicitly-sent
or an implicitly-known _fresh value_.\ This value can be augmented with a
\"internal-clock\" time value that each UE can be expected to have. Of course,
this internal clock time value may be inaccurate but it can probably be
assumed to be known within a reasonably short time, e.g. it could be
synchronised via several means (e.g., as part of authorization to use
discovery, via eNB configuration or even GPS signals). This internal clock can
serve the purpose of ensuring non-repeatability of OTA information.
The MAC layer computes the information to be used in OTA announcements as
follows: Input to the hash function: the ProSe ID provided by the application
layer as clear text input, and the fresh value mentioned above, padded with
zeros, as key.
The following are options for the fresh value:
**Option 1:** Explicitly send a nonce. An announcing UE concatenates the OTA
ProSe ID to a fresh nonce it generates for each announcement. The OTA ProSe ID
is computed from the Application ProSe ID and/or ProSe Application key as
follows:
For a fixed OTA discovery frame, there is a trade-off between the size of the
Nonce parameter and likelihood of collisions with other transmitted ProSe IDs.
Replay protection in this case is provided by the \"internal clock\".
**Option 2:** Use known system time data. What is broadcast over the air
consists only of the output of the hash function, and changes with system
time.
It is expected that a system time/counter(s) or another such value(s) are
known to all UEs while in network coverage, as it is provided by the eNB(s)
and are necessary for discovery to work in the first place. For Public Safety
UEs out of coverage, some form of timing synchronization is required. This
subject has been extensively discussed in RAN1, the current conclusion being
that some timing information is available to UEs both in and out of coverage.\
Details on the availability and properties of system time or other like values
are in scope of RAN1 and RAN2.
Editor\'s note: This will need to be reviewed as the RAN groups make more
progress on their work
Editor\'s note: Implications on time synchronization are FFS.
The receiver of such OTA ProSe ID shall compare it to locally-generated OTA
ProSe IDs corresponding to all the ProSe IDs/Keys that are of interest to that
UE. The receiving UE has the exact same information to generate the OTA ProSe
ID as the announcer UE (this includes Time values).
Editor Note: The benefits of the proposed solution should be weighed against
the cost of increased computation at the receiver UE.
Editor Note: The overhead introduced by OTA ProSe ID and the Nonce Value in
the discovery message needs to be considered against the size limit of the
discovery message.
Given the advantage of Option 2, we propose to use this option, provided
RAN1/RAN2 can provide suitable system time. Further refinements/clarifications
will be added once RAN2 decides on the format/length of the discovery message,
and RAN1 conveys system time details.
#### B.1.1.5 UE to UE authorization for restricted discovery
In restricted discovery, the ProSe identifier used by the UE to be discovered
should only be meaningful to a select set of other UEs.
A simple way to achieve the access control required by restricted discovery
involves obtaining ProSe IDs (that is, ProSe UE Identities, ProSe Application
Identities, and/or ProSe Application Keys) for OTA announcements, and
disseminating those only to the specified set of UEs. A network function
provides a UE with the ProSe ID it can use to be discovered. This ProSe ID is
a sensitive parameter and may not/should not be correlated with the
application user ID and/ or subscriber IDs.
In order to revoke discovery access of a UE (e.g. \"unfriend\" operation in
social networking applications), a new ProSe ID for that application can be
obtained in the same way that the original ProSe ID was obtained, and then
disseminated as before to all the UEs in the current set of authorized UEs --
which obviously no longer includes the revoked UE.
A periodic retrieval of the current ProSe IDs of the UEs of interest is
necessary in order to ensure that the announcer and monitoring UE are in sync
for discovery.
There are several approaches to this dissemination operation. From SA3
perspective, the requirement is only that the process of dissemination should
ensure that these sensitive parameters are not disclosed to untrusted third
parties, since their knowledge constitutes a grant of access.
## B.2 Solutions for One-to-many Communications
### B.2.1 Solution #A2.1: Security for ProSe communication in group owner mode
#### B.2.1.1 Authentication by GO
The ProSe UE should be authenticated by GO when it joins to the communication
group. All the group members, e.g. ProSe UEs and GO, may be out of coverage,
the authentication credential should be pre-configured and securely stored in
the ProSe UE. As the group may be dynamic when the group members joins in or
leave the group, which means the group member and GO is not fixed, the
credential should be valid in a large-scale. Certificate could be competent to
be the required credential.
The authentication conforms to the following steps:
ProSe UE enrols certificate from its HPLMN. To support the roaming scenario, a
list of other PLMN\'s root certificate may be also enrolment;
GO authenticates with the ProSe UE when the UE joins to the group. CRL stored
in GO and ProSe UE is used to verify the certificate validity. CRL updates
whenever the ProSe UE or GO connects to the network;
#### B.2.1.2 Key generation and for ProSe communication
Before direct communication can be established between two or multiple ProSe-
enabled UEs, these UEs need to become members of the same _ProSe Group_.
When ProSe UE joins a group, the UE first authenticates with the GO. Then GO
generates Kunicast and Kmulticast for the unicast communication and multicast
communication. The Kunicast and Kmulticast are ProSe group specified, so group
ID could be used as input parameter to derive the keys Kunicast and
Kmulticast.
Editor\'s Note: The details of certificate validation are FFS.
#### B.2.1.3 Key distribution to ProSe UE from GO
The keys to protect the message/traffic between ProSe UE and GO are generated
by GO, and need to securely distribute to ProSe UE. The public key of the
ProSe UE could be used to encrypt the keys. The encryption ensures that only
ProSe UE can obtain the keys and those keys is not useful for users which
don\'t have the private key.
The security algorithms can be negotiated along with the key distribution
procedure. The message/traffic should be confidentially protected and
integrity protected after this procedure.
## B.3 Solutions for One-to-one communications
### B.3.1 Solution #A3.1: Security for direct one-to-one connections
#### B.3.1.1 General
This solution addresses key issue #A3.2 in the current document and is the
security part of solutions C3 and C4 in TR 23.703 [4].
#### B.3.1.2 Overview of solution
##### B.3.1.2.1 General
One major difference between the security of direct communication between LTE
UEs and regular LTE communications between the UE and network is that in the
former there is only one endpoint for the signalling, which brings into
question the need for replicating the two layers of LTE security for direct
communications.
NOTE: The above is not claiming that there will not be in effect two types of
signalling between UEs, e.g. a ;\'NAS\'-like layer that could be considered
independent of the radio layer and radio layer that might be dependent on the
actual radio being used. It is merely saying that if there is no need for more
than one layer of security, as the termination point for possible signalling
layers are in the same entity.
For this reason, this solution proposes to have only one layer of security
that is identical to or at least very similar to the RAN layer security that
is in standard LTE.
> Editor\'s note: This will need to be reviewed as the RAN groups make more
> progress on their work
One consequence of the above decision is that there can be no protection of
the initial message (post radio connection establishment). This is not a
problem as the proposed context of those messages is only connection
identifiers and security establishment parameters.
Another consequence of not having a NAS security in ProSe is the derivation of
fresh keys for the RAN security can not use NAS COUNTs. It is proposed to
replace these with NONCEs from both sides.
Another difference is that each side issues a connection identity to the other
in order to ensure privacy in the same way that S-TMSI can be used to prevent
tracking of UEs.
Like in standard LTE, there is will be a key set identifier, called a DKSI
associated with the D2D root key, called K~D~, of the security context that
play the same roles as eKSI and K~ASME~ in standard LTE. K~D~ is generated per
pair of UEs.
##### B.3.1.2.2 Difference between network independent and network authorized
cases
As described in solutions C3 and C4 of TR 23.703 [4], there are two possible
connection cases, network independent and network authorized. The only
difference from a security perspective is in the way that K~D~ is generated.
In the network authorized case, the UEs are connected to the network and they
rely on assistance from the network to generate the keys. In the network
independent case (which applies to public safety only-- solution C3 in TR
23.703 [4]), it is assumed that the UEs are pre-provisioned with some private
keys and associated certificates and these are used to generate a mutually
shared key K~D~.
Figure B.3.1.2.2-1 gives a high level flow for network independent connection
establishment
{width="5.819444444444445in" height="4.186111111111111in"}
Figure B.3.1.2.2-1: Network independent connection establishment
**In the network independent connection establishment, an initial Direct
Connection Request message is sent directly between the UEs. The UEs then (if
needed) perform a key generation between them using their private keys and
certificates (see clause B.3.1.4.3.1) and then run the Direct security mode
procedure to start the security (see clause B.3.1.4.4). Finally new connection
identities are exchanged (if needed) in the Direct Connection
Response/Complete (see clause B.3.1.4.2) to allow a connection to be re-
established without using a permanent identity.**
Figure B.3.1.2.2-2 gives a high level flow for network authorized connection
establishment.
{width="5.819444444444445in" height="3.988888888888889in"}
Figure B.3.1.2.2-2: Network authorized connection establishment
**In the network authorized connection establishment, the first stage is for
the UEs to generate keying material for their direct connection using their
respective MMEs (see clause B.3.1.4.3.2.1). Then an initial Direct Connection
Request message is sent directly between the UEs. The UEs then run the Direct
security mode procedure to start the security (see clause B.3.1.4.4). Finally
new connection identities are exchanged (if needed) in the Direct Connection
Response/Complete (see clause B.3.1.4.2) to allow a connection to be re-
established without using a permanent identity.**
#### B.3.1.3 Security parameters
This clause contains a description of the security parameters used and the
purpose of that parameter. The list of security parameters is broken down into
three sets to reflect the parameters needed for the following states (each
state is in respect to a particular other UE):
  * D2D-Null: the UE has everything it needs to start the process of communicating with another UE, but no security parameters or any info about the other UE.
  * D2D-Idle: the UE has connected to another UE and retained some security parameters for use with that UE
  * D2D-Connected: the UE is actually connected to another UE and transmitting data
Stored parameters while in D2D-Null
  * D2D authorization parameters that give the UE permission to use D2D direct communications
  * Expressions it will announce, listen to and/or accept direct communication on
Editor\'s note: More details on relationship between expression and security
contexts is needed
  * Set of security algorithm that it is willing to use for direct connections -- this may be reduced from complete set supported by the UE by the authorization parameters ruling out some algorithms, e.g. Null confidentiality only
  * For UEs using autonomous connections, the private key/certificate pairs that relate to the various expression it is using
Stored parameters while in D2D-Idle
  * Everything from D2D-Null
  * Connection identities: Uni-directional identities (I.e. a local and remote pair) that play the role of S-TMSI in providing privacy for the UE . The remote connection id is assigned by the peer UE to ensure that they are unique at that peer UE.
  * Key set identifier, DKSI, which plays the role of eKSI in LTE
  * D2D Root key, K~D~, which plays of the role of K~ASME~ in LTE
  * List of expression used with this security context
Stored parameters while in D2D-Connected
  * Everything from D2D-Idle
  * (At least held implicitly), a pair of NONCES (local and remote), one for each UE that are used to calculate K~D-sess\ :~
  * K~D-SESS~, the session key to be used for deriving further keys to protect the traffic between UE -- this is the equivalent of K~eNB~ from LTE
  * The confidentiality and integrity algorithms that are chosen to protect the traffic between UEs
  * The keys that are used in the above algorithms
  * The PDCP counts or ProSe equivalent parameters that are used at the RAN layer as inputs to the ciphering and integrity algorithms
#### B.3.1.4 Security procedures
##### B.3.1.4.1 General
There are four different security procedures required for direct
communications;
  * Allocating a Connection identity
  * Establishing an DKSI, K~D~ pair at each UE
  * Direct-security mode procedure
  * Direct re-keying procedure
The procedures are described in the following subclauses. Each procedure
contains a description of when it can be run and how it fits with other
security. For details of how each procedure fits in overall connection etc.,
see solutions C3 and C4 in TR 23.703 [4].
##### B.3.1.4.2 Allocating a connection identity
When creating a direct communications link between two UEs, the UEs may both
pass a connection identity to each other. The connection identity needs to be
unique at the UE that created it. At a later re-connection attempt the
previously negotiated security can be used if still stored by the initiating
UE by sending the other UE the connection identity it has previously sent.
Connection identities may be re-allocated during connection set-ups or during
network assisted keying. This allows a connection identity to be only used
once if so desired by the UEs in order to protect their privacy.
{width="5.819444444444445in" height="2.2569444444444446in"}
Figure B.3.1.4.2.1-1: Connection identity allocation
  1. UE_1 sends UE_2 a new connection identity that UE_2 should use next time it communicates with UE_1 either
> a Directly in Direct-Connection-Response/Complete messages; or
>
> b Through signalling via their respective MMEs (for more details see the
> messages flow described in figure B.3.1.4.3.2-1).
##### B.3.1.4.3 Establishing a shared key
###### B.3.1.4.3.1 Network independent case
This procedure may only be run after receiving a Direct Connection Request
(see solution C3 in TR 23.703 [4]) or a Direct Rekeying Request message (see
subclause B.3.1.4.5 of this specification). This case is only for public
safety UEs (see solution C3 in TR 23.703 [4]). It results in the UEs sharing a
DKSI and K~D~ pair.
{width="6.075694444444444in" height="3.595833333333333in"}
Figure B.3.1.4.3.1-1: Network independent key establishment
  1. UE_1 sends UE-2 either a Direct-Connection-Request (see SA2 specification) or Direct-Rekeying-Request (see subclause B.3.1.4.5).
> Note: Either UE can send a Direct-Rekeying-Request when they are connected
> to each other
  1. \-- 4. UEs exchange messages to result in a shared DSKI and K~D~ pair
Editor\'s note: The details of the key establishment need to be added. How to
ensure associated certificates point to the same root certificate? How to
ensure validity of the certificate? OCSP needs the involvement of the network.
There is the problem of clock synchronisation in UEs. If the clock of one UE
isn\'t correct, the UE may wrongly treat its peer\'s certificated as expired
###### B.3.1.4.3.2 Network authorized case
This procedure may only be run prior to sending a Direct Connection Request or
after a Direct Rekeying Request when it is desired by one UE to use a fresh
K~D~ as opposed to a fresh K~D-sess~. The Direct-Rekeying-Request can only be
sent when the UEs are already directly connected. The following flow shows the
security part of the relevant SA2 flow (see TR 23.703 [4]).
Figure B.3.1.4.3.2-1: Network authorized key establishment
  1. Either
a. UE_1 has received a Direct-Connection-Request or Direct-Rekeying-Request
and want to generate a new K~D~; or.
b. UE_1 wants to establish a connection with UE_2 using network authorized
connection procedure
  2. UE_1 sends an Extended Service Request (ESR) indicating direct connection to MME_1. It contains connection identity given it by UE_2 previously if it has one or the EXP code that is or wants to communicate with. Other parameters are FFS
  3. MME_1finds out the address of MME_2 (this is FFS in rekeying case) and sends it a Direct-Keying-Request. It includes the connection identity or EXP code that was received in message 1. It also includes Keying_material_1. Other parameters are FFS.
  4. MME_2 sends UE_2 the connection identity or EXP code that was received in message 2. Other parameters are FFS.
  5. UE_2 sends a new connection identity if there was not one in message 3 or it wants to refresh its connection identity. It also selects a DKSI that will be associated with the calculated K~D~. Other parameters are FFS.
  6. MME_2 sends MME_1 the parameters received in message 2 and Keying_material_2. Other parameters are FFS.
  7. MME_1 sends UE_1 the parameters received in message 2. Other parameters are FFS.
  8. Both UEs establish the final K~D~ from the received keying material parameters and parameters held locally.
Editor\'s note: The details of the key establishment protocol need to be
added. What\'s the life time of this security context of D2D?
##### B.3.1.4.4 Direct security mode procedure
This procedure is run in response to a Direct Connection Request in order to
establish a secure connection between the UEs.
UE_2 may initiate one of the procedures described in 6.4.1.4.3 to establish a
key. These may be run between the UEs before the start of the D2D security
mode procedure if a K~D~ is needed or UE_2 wants to establish a new K~D~
{width="5.819444444444445in" height="4.186111111111111in"}
Figure B.3.1.4.4-1: Direct Security mode procedure
  1. UE_1 has sent a Direct-Connection-Request to UE_2. This message includes Nonce_1 (for session key generation), Supported_algs (the list of algorithms that UE_1 is OK to use in this connection) and Key_creation_data (information needed to determine the method of key generation - the details of this are FFS). The UEs have also agreed on a DKSI and K~D~ pair either at step 0a or 0c.
  2. UE_2 sends the Direct-Security-Mode-Command to UE_1. It includes the DKSI to indicate which K~D~ to use, Nonce_2 to allow a session key to be calculated and the chosen_algs parameter to indicate which security algorithms the UEs will use to protect the data. UE_2 also returns the Supported_algs parameter and part of the Key_creation_data to protect them from man-in-the-middle attacks. UE_1 will not accept a Direct-Security-Mode-Command if there are different what it sent. UE_2 calculates K~D-Sess~ from K~D~ and Nonce_1 and Nonce_2 and then derives the confidentiality and integrity keys based on the chosen algorithms (see subclause 6.4.1.6.1). It integrity protect the Direct-Security-Mode-Command before sending it to UE_1. UE_1 performs the same key calculation and checks the integrity of the message before accepting it.
  3. UE_1 send an integrity protected Direct-security-mode-complete message to UE-2. After this all messages are integrity and confidentiality protected except possibly rekeying messages (see subclause 6.4.1.4.5).
##### B.3.1.4.5 Direct re-keying procedure
This procedure can be run at any time and initiated be either UE. It results
in a new K~D-sess~ being used to protect the traffic between the UEs. The new
K~D-sess~ can either be calculated from the current K~D~ or a new K~D~
established during this procedure using the appropriate procedure from
6.4.1.4.2.
{width="5.819444444444445in" height="3.595138888888889in"}
Figure B.3.1.4.5-1: D2D re-keying procedure
  1. UE_1 sends UE_2 a Direct-Rekeying-Request message when they are already directly connected and UE_1 wants to refresh the keys. This message includes a parameter (this is FFS) to enable MME_2 to find MME_1 and get signalling to UE_1 via the network, a flag to indicate whether a refresh of K~D~ is requested and Nonce_1.
  2. A DKSI and K~D~ pair are generated if request by UE_1 or desired by UE_2 using the procedures in subclause 6.
  3. UE_2 sends UE_1 a Direct-Rekey-command message. It includes DKSI and Nonce_2. Along with Nonce_1 these allow the calculation of a new K~D-sess~. The message needs to be at least integrity protected.
  4. UE_2 responds with a Direct-Rekey-complete message that is at least integrity protected
### B.3.2 Solution #A3.2: Security for direct one-to-one connections
#### B.3.2.1 General
This solution addresses key issue #A3.2 in the current document and is the
security part of solution C4 in TR 23.703 [4]. It is best suited to solution
D5 in TR 23.703 [4], where direct communications are treated as a new IMS
service, though the solutions could also be applied outside of IMS.
#### B.3.2.2 Overview of solution
##### B.3.2.2.1 D2D Authentication and Key Agreement using IMS E2E security
solutions
Securing a direct one-to-one connection requires setting up a security context
between two end-point devices.\ In addition, the security context should be
unique per UE to UE connection, and not obtainable by any other entities.\ A
number of other requirements may also apply such as the ability to refresh a
security context, protect private identities and support LI.
In reality, any successful solution to this challenge will provide a generic
end-to-end security context between two UEs. This assertion is clear as there
are only these two devices involved in a direct one-to-one connection, and the
security solution cannot rely on any security provided by the transport
mechanism.
It is noted that solving the challenge of producing an end-to-end security
context between two UEs has already been addressed in other environments. In
particular, IMS media-plane security as specified by TR 33.328 [16] provides
two end-to-end security solutions, SDES and MIKEY-TICKET, which are both able
to setup a shared session key at each end-point to secure a session. Within TR
33.328 [16], this session key is used to secure an RTP media session, however,
the same mechanisms could be used to securely and successfully share a session
key for any e2e security requirement.
This solution proposes that the security for a direct one-to-one connection is
setup using the same techniques as an IMS e2e media service. In other words,
SDES and MIKEY-TICKET are both able to share a session key between two end
points and authenticate both end-points for RTP streams. It is proposed that
we re-use these solutions to share a session key between two end-points for
direct one-to-one communications.
The advantages of using either of the two IMS e2e security solutions for
direct one-to-one connections are as follows:
  * These solutions have already been specified and their security analysed thus agreeing their use may speed up the specification of a ProSe security solution.
  * A consistent approach to media security will be achieved regardless of the type of network access provided (trusted access, untrusted access, direct connection).
  * LI support of these solutions has already been assessed.
It is noted that these two solutions do not specify how to support network-
independent direct communications, hence this only provides a solution for C4
in TR 23.703 [4]. We view the requirement for Solution C3 in TR 23.703 [4] as
a specialised use-case, applicable only to public safety users where a network
does not exist. The solution that will be required by the majority of users is
C4, I.e. to setup direct communications where a network can be accessed.\ This
solution is described in clause B.3.2.3.
Both the defined IMS e2e security solutions currently require a connection to
the network in order to operate.\ In the majority of use cases, including all
commercial use cases, this will not be a concern as a network connection will
exist or be required to setup a direct one-to-one connection. In the
restricted use-case of public safety use without network connectivity, direct
communications may be required when the UEs are operating independently of the
network. The solution described does not address this requirement and we
believe a new solution will be required.
#### B.3.2.3 D2D authentication and key-agreement using IMS E2E security
solutions
##### B.3.2.3.1 General
This clause defines how to adapt the two end-to-end solutions defined in TR
33.328 [16] for use as authentication and key-agreement solutions for direct
one-to-one communications.
There are two possible outcomes on of the ProSe architecture study.
  * It is agreed that ProSe should be an IMS service (Solution D5 as defined in TR 23.703 [4])
  * It is decided ProSe will not be an IMS service.
In the following subclauses, the D2D authentication and key-agreement
mechanism is defined for these two possible outcomes.
In terms of this security solution, the first outcome is preferred as it
simplifies defining the security solution. If ProSe is an IMS service, end-to-
end security solutions are already defined for IMS so integration is easy to
specify.
##### B.3.2.3.2 D2D authentication and key-agreement within IMS-managed ProSe
As described in TR 23.703 [4], if Solution D5 is agreed, direct communications
are setup using IMS. The D2D communication is setup by routing the SIP
signalling via the network. Attached to the SIP signalling, the D2D
authentication and key-agreement can also be performed. With SIP signalling
complete, the D2D authentication and key-agreement process is also complete
and a D2D traffic keys can be derived to create a shared security context.
With an identical security context created at both UEs, it is possible to
begin a secure D2D communication.
{width="4.275in" height="2.09375in"}
Figure B.3.2.3.2-1: Simplified session setup with IMS support
Figure B.3.2.3.2-1 describes a simplified session setup using IMS. Both SDES
and MIKEY-TICKET attach security parameters to SDP Offer and SDP Answer
messages. These messages are attached to the SIP exchange for setting up a D2D
connection.
B.3.2.3.2.1 D2D authentication and key-agreement security procedures for SDES
The following are the security procedures for SDES
> 1\. D2D UE A sends a SIP INVITE to D2D UE B via the IMS, indicating the D2D
> interface for the media. The INVITE also contains an SDP Offer with
> appropriate additional SDES crypto attributes as specified in the SDES e2e
> security procedures (TR 33.328 [16]). In particular, the SDES crypto
> attributes shall contain at least one master key, K1.
>
> 2\. D2D UE B replies with an SDP Answer for a D2D media stream. The SDP
> Answer shall include the SDES crypto attributes containing at least one
> master key,K2.
>
> 3\. The exchanged keys, K1 and K2, are combined via a KDF to create the D2D
> session key, K~D~. In both UEs, this session key is used to create the D2D
> traffic keys forming the full security context. Secure media communication
> is then setup directly between D2D UE A and D2D UE B via the specified D2D
> interface.
B.3.2.3.2.2 D2D authentication and key-agreement security procedures for KMS
The following are the security procedures for the MIKEY-TICKET KMS e2e
security solution. As specified in TR 33.328 [16], D2D UE A will either
interact with the KMS to obtain keys and a MIKEY-TICKET Ticket usable for D2D
communications with UE B, or it will create the ticket by itself.
> 1\. D2D UE A sends a SIP INVITE to D2D UE B via the IMS, indicating the D2D
> interface for the media.\ The INVITE also contains an SDP Offer containing
> the obtained/generated MIKEY-TICKET ticket.
>
> 2\. D2D UE B checks if it is authorized to resolve the ticket and if that is
> the case IMS UE B interacts with the KMS to resolve the ticket and receive
> keys. D2D UE B replies with an SDP answer, including a MIKEY-TICKET
> response.
>
> 3\. As a consequence of the exchange, MIKEY-TICKET produces a TEK as
> specified in RFC 6043 [17].\ The output MIKEY-TICKET TEK is used as the D2D
> session key, K~D~. In both UEs, this session key is used to create the D2D
> traffic keys forming the full security context. Secure media communication
> is then setup directly between D2D UE A and D2D UE B via the specified D2D
> interface.
B.3.2.3.3 D2D authentication and key-agreement within IMS-independent ProSe
If IMS is not used as part of a D2D setup procedure, the defined security
methodologies behind SDES and MIKEY-TICKET may still be applied. Both
protocols require a single SDP message to be passed in each direction.\ To
achieve this independently of IMS, the (information within the) SDP Offer is
attached to the Direct Connection Request and the (information within the) SDP
Answer is attached to the Direct Connection Accept.
{width="6.125in" height="2.9270833333333335in"}
Figure B.3.2.3.3-1: D2D connection establishment
This exchange is displayed in Figure B.3.2.3.3-1. For SDES, the Direct
Connection Request and Direct Connection Accept contain SDES crypto attributes
containing K1 and K2 respectively. For KMS, the Direct Connection Request and
Direct Connection Accept contain MIKEY-TICKET tickets. The D2D traffic keys
should be derived from the session key as in the IMS-integrated case.
The Direct Connection Request and Accept messages should be sent via the
network for SDES, but may be sent either via the network or directly for KMS.
### B.3.3 Solution #A3.3: Security for ProSe one-to-one communications
#### B.3.3.1 General
This solution addresses key issue A3.2 in the present document, and is aimed
to provide the security solution for solutions C3, C4 in TR 23.703 [4]. It is
primarily aimed at meeting the public safety user requirements for one-to-one
communication out-of-network coverage, but can also be applied for in-coverage
scenarios.
#### B.3.3.2 IDENTITY Security Solution
##### B.3.3.2.1 General
The IDENTITY solution provides a flexible end-to-end security solution capable
of setting up secure one-to-one or group sessions without requiring a
connection to network infrastructure. It is intended for use by public-safety
users who require direct one-to-one or group connections when a connection to
the network does not exist. It provides a solution to perform authentication
and key-agreement for direct one-to-one communications (C3 and C4) and for
group communications (C1, C5, C6, C7, C8) as specified in TR 23.703 [4].
The IDENTITY solution allows information to be encrypted to a given UE using
solely their public identity (alongside pre-provisioned domain-level
information). Only a UE with this identity (alongside private keys provisioned
by the network infrastructure) is able to decrypt information encrypted to the
identity and sign information as this identity.\ As a result, provisioning
shall either occur prior to deployment or while users are connected to the
network infrastructure, but secure connections may be established without
access to network infrastructure. The security mechanism which achieves this
uses the MIKEY-SAKKE protocol as specified in RFC 6509 [12].
Full details of the IDENTITY solution, including procedures for provisioning
of IDENTITY UEs, can be found in clause 6.3.1.2 of this document.
#### B.3.3.3 IDENTITY One-to-One communications
##### B.3.3.3.1 General
This clause describes the generic setup of an IDENTITY one-to-one
authentication and key-agreement procedure between two UEs. IDENTITY one-to-
one communications are very similar to ad-hoc group communications detailed in
clause 6.3.1.3.4. Ad-hoc group communications may be viewed as the creation of
multiple simultaneous one-to-one communications with group members. Like for
ad-hoc groups, for one-to-one group communications, a user of a public safety
UE selects a public safety UE with which to securely communicate. The UE then
generates a session key and securely transmits this key to the terminating
UE\'s IDENTITY using a MIKEY-SAKKE I_MESSAGE. The session key is used to
protect media in the session.
Figure 6.4.3.3.1-1 provides an overview of the security process for
distributing session keys for one-to-one communications.
Figure 6.4.3.3.1-1: Overview of one-to-one session key distribution
For a one-to-one session to be created, no prior security association need
exist between the UEs. However, all UEs in the group shall be provisioned as
described in clause 6.3.1.2.
##### B.3.3.3.2 Configuration
The solution requires that public safety UEs have a public identity (e.g.
IMPU). The network configures each public safety UE with security parameters
associated with the IDENTITY solution as detailed in clause 6.3.1.2 of this
document.
##### B.3.3.3.3 One-to-one security procedures for session key distribution
using IDENTITY (network connected)
Figure B.3.3.3.3-1 shows the set-up procedures for one direct one-to-one
connection session using IDENTITY authentication and key-agreement.
Figure B.3.3.3.3-1: One-to-one security procedures for session key
distribution\ using IDENTITY (network connected)
The procedure in Figure B.3.3.3.3-1 is now described step-by-step. 1. Prior to
beginning this procedure it is assumed that the public safety UEs have been
provisioned by a IDENTITY KMS as described in clause 6.3.1.2.
2\. Prior to beginning this procedure it is assumed that the public safety UE
has registered with its serving signalling server and local group server.
3\. The initiating public safety UE generates a session key and sends a
session initialisation message (e.g. SIP INVITE) to the terminating public
safety UE. This message is routed via the signalling servers of the initiating
UE and terminating UE. Within the SDP Offer of this message, UE 1 includes a
MIKEY-SAKKE I_MESSAGEs as defined in RFC 6509 [12]. The I_MESSAGE encapsulates
the session key for the terminating public safety UE, encrypting the key to
the IDENTITY UID of the terminating UE and is signed using (the key associated
with) the initiating UE\'s UID.
NOTE 1: This message may be pre-generated to increase the efficiency of the
communication.
4\. The terminating UE receives the message, checks the signature on the
message and extracts the session key using keys provisioned by the IDENTITY
KMS. The terminating UE returns an acknowledgement (e.g. SIP 183) containing
an SDP Answer. Optionally, the response may contain another MIKEY-SAKKE
I_MESSAGE returning the session key.
NOTE 2: The optional return of an I_MESSAGE is not required to create a secure
session, but allows explicit authentication of the terminating user and
confirmation that the session key has been successfully extracted.
5\. Further messages are sent to setup the group session. These messages
contain no security information.
With a session key shared between the initiating and terminating users, the
media communicated between the UEs may be protected with this session key.
##### B.3.3.3.4 One to one security procedures for session key distribution
using IDENTITY (network independent)
This clause assumes that the IDENTITY authentication and key-agreement
procedure occurs directly, rather than via the network. This is designed to
accommodate public-safety users who wish to establish connectivity when a
connection to the network does not exist. This solution assumes that the
public safety UEs have established connectivity sufficiently to transport a
Direct Connection Request/Accept exchange containing MIKEY-SAKKE I_MESSAGEs.
The procedure could also be performed via a relay.
From a security perspective, this procedure follows exactly the same security
mechanism as for network-connected group communications described in clause
6.3.1.3.4.2. In this use case, the SDP Offer is broadcast by the initiating UE
and no response is expected. The SDP Offer contains a set of MIKEY-SAKKE
I_MESSAGEs protecting the Group Session Key (GSK). Following the broadcast of
the SDP Offer, the media is broadcast over the one-to-many direct link,
protected under the GSK.
Figure 6.3.1.3.4.3-1 describes the procedure. As there are no responses or
acknowledgements, this procedure shall proceed on a \'best-endeavour\' basis.
{width="4.46875in" height="3.65625in"}
Figure B.3.3.3.4-1: One-to-one security procedures for session key
distribution\ using IDENTITY (network independent)
The procedure in Figure 6.3.1.3.4.3-1 is now described step-by-step.
  1. Prior to beginning this procedure it is assumed that the public safety UEs have been provisioned by an IDENTITY KMS as described in clause 6.3.1.2.
  2. Public safety UE 1 generates a session key and broadcasts a \'session initialisation message\' containing the URI of the terminating UE and an SDP Offer. Within the SDP Offer, the initiating UE includes a MIKEY-SAKKE I_MESSAGEs as defined in RFC 6509 [12], encapsulating the session key. The session key is encrypted to the IDENTITY UID of the terminating UE signed using (the key associated with) the initiating UE\'s UID.
NOTE: This message may be pre-generated to increase the efficiency of the
communication.
  1. The terminating UE extracts the session key from the I_MESSAGE and checks the signature on the message. Further messages may be sent to setup the one-to-one direct media session. These messages contain no security information.
As a result of this procedure, the UEs will have shared a session key. This is
used to protect the media transmitted directly as part of this session.
B.3.3.3.5 Media Stream Protection
As a result of completing a security procedure described in clause B.4.3.3.3
or B.4.3.3.4, the public safety UEs will have shared a session key as part of
the session setup procedure. All transmitted media within this session will
now be protected under this session key (e.g. to key an SRTP stream). The
session may only last for a single transmission, or may be maintained for a
period to allow on-going efficient communications.
This applies whether the media is transmitted directly, via a relay or via
signalling servers in the network.
### B.3.4 Solution #A3.4: Network assisted key establishment for one-to-one
communication
#### B.3.4.1 General
This solution addresses the network assisted key establishment procedure
between two ProSe enabled UEs (UE1 and UE2). UE1 and UE2 are served by the
MME1 and MME2, respectively. It is assumed that UE1 (UE2) has already been
attached to MME1 (MME2, respectively). The shared keys (e.g. Kasme) between
UE1 and MME1, as well as between UE2 and MME2 are used in the key
establishment procedure.
#### B.3.4.2 Procedure
The procedure of the solution in Figure B.3.4.2-1 is described as follows:
Figure B.3.4.2-1: Network assisted key establishment for one-to-one
communication
> 1\. UE1 selects a parameter p1 (e.g. a random parameter), and sends p1 to
> MME1 in a NAS message, which is protected by NAS security mechanism;
>
> 2\. MME1 derives a key p2=KDF(Kasme1, p1) using the secret key Kasme1 shared
> between MME1 and UE1;
>
> 3\. MME1 sends p2 to MME2, which is protected by NDS mechanism;
>
> 4\. MME2 sends p2 to UE2 in a NAS message, which is protected by NAS
> security mechanism;
>
> 5\. UE2 selects a parameter p3 (e.g. a random parameter), and sends p3 to
> MME2 in a NAS message, which is protected by NAS security mechanism.
>
> 6\. MME2 derives a key p2=KDF(Kasme2, p3) using the secret key Kasme2 shared
> between MME2 and UE2;
>
> 7-8. MME2 sends p4 to UE1 via MME1, which is protected by NDS/NAS security
> mechanism;
>
> 9\. UE1 derives a key p2=KDF(Kasme1, p1); similarly, UE2 derives a key
> p4=KDF(Kasme2, p3). Both UE1 and UE2 derive a session key K~D~=KDF(p2, p4);
>
> Therefore, now both UE1 and UE2 share the same session key K~D~ between
> them.
Editor\'s Notes: The use of KDF and Kasme is FFS.
## B.4 Solutions for Relays
### B.4.1 Solution #A4.1: Security for ProSe communication through UE-to-
Network relay with network authorization
#### B.4.1.1 Security procedure for Relay UE
Relay UE connects to network and establishes IP connection across eNB. The
security for Relay UE is the same as normal LTE UE, e.g. AKA procedure is used
for authenticating between relay UE and MME and NAS/AS SMC procedure is used
to activate NAS/AS security.
{width="4.475in" height="2.811111111111111in"}
Fig.B.4.1.1-1 Security Procedure for Relay UE
#### B.4.1.2 Security procedure for remote UE
In ProSe communication through UE-to-Network relay with network authorization,
remote UE connects to relay UE with D2D setup procedure.
{width="6.3375in" height="3.365972222222222in"}
Fig.B.4.1.2-1 Security Procedure for Remote UE
Step 1. Remote UE connects to relay UE;
Step 2. The relay UE acts as non-3GPP AP and triggers the Remote UE
authentication procedure. The AAA server and the UE perform the mutual
authentication using I.e. EAP-AKA ^(\')^ protocol. The Relay UE and the AAA
proxy transfer the authentication message between the AAA server and the
remote UE.
A key identifier KSI~D2D~ and a pair of shared keys, MSK and EMSK is generated
after the authentication procedure in remote UE and AAA server. The KSI~D2D~
and MSK is shared between remote UE and relay UE.
Editor\'s Note: It is FFS where the AAA client is located and which entity is
the EAP authenticator.
Editor\'s Note: What protocol to use (Radius or Diameter) between Relay UE and
AAA is FFS and is within the scope of SA2.
Editor\'s Note: Which protocol is used to transport the EAP signalling between
the UE and Relay is FFS.
Editor\'s Note: How P-GW distinguishes EAP signalling from regular user plane
traffic is FFS.
Step 3. A procedure to generate synchronized security context between remote
UE and relay UE.\ After this step, the keys to protect sessions between remote
UE and relay UE are setup.
Step 4. Remote UE completes the IP address assignment procedure.
Step 5. The Remote UE can transfer the data packet via the Relay UE. The Relay
UE selects the PDN connection based on the bearer mapping, I.e. the mapping
between PC5 bearer and the Relay PDN connection). The network can also
transfer the unicast data packet to the Remote UE via the Relay UE.
### B.4.2 Solution #A4.2: Security for relays using one-to-many security
#### B.4.2.1 General
This solution is the security part of solution in TS 23.303 [20].
#### B.4.2.2 Overview of solution
##### B.4.2.2.1 Solution description
This solution follows the solution 3.6 for one-to-many security except as
described below. The security solution proceeds as in the following flow.
Figure B.4.2.2.1-1: Security flows for relays
1\. The UE that wishes to communicate with relay nodes fetches the relevant
parameters from the ProSe Function
2\. The UE also fetches the ProSe App Codes, Group Member Identity,
Algorithms, PRK and PRK ID from the ProSe Key Mgmt Function from the ProSe Key
Mgmt Function
> Note: After completing step 2, the UE needs to have the ProSe App code of
> the relays it may connect to, and an associated Group Member Identity, PRK
> and PRK identity. It is FFS whether the former three parameters are provided
> at steps 1 or 2.
3\. The relay fetches the authorization/configuration parameter(s) it needs to
act as a relay
4\. The relay broadcasts its discovery message containing a ProSe Relay ID
5\. The UE hears the discovery message and decides it wants to connect to the
relay. It calculates the relevant PRGK for the relay node
6\. Using the next available PTK to both integrity and confidentiality protect
the messages, the UE initiates the relevant IP address assignment process. The
relay fetches the relevant PRGK using the Group Identity and Group Member
Identity used by the UE if needed and the relay and UE complete the IP address
assignment procedures
7\. The UE and relay exchange encrypted data as in the one-to-many security
solution.
##### B.4.2.2.2 Security Keys
In the one-to-many case, each UE in a group is given a ProSe Group Key (PGK)
that is used to derive the ProSe Traffic Keys (PTK) which actually protects
the transmitted data. For the proposed relay solution, each UE can be viewed
as being part of a group of 2 with the relays it can connect to. Instead of
provisioning the UE with a key for each relay that the UE may communicate
with, a UE is provisioned with a single ProSe Relay Key (PRK) from which it
can derive all the necessary ProSe Relay Group Keys (PRGK)s for any relay. In
addition, the relay may fetch the necessary PRGKonly if needed, I.e. after the
UE has communicated with it, rather than needing to be provisioned in advance.
NOTE: Knowledge of PRGKs does not allow either a UE or Relay to calculate a
PGK or vice versa.
##### B.4.2.2.3 Identities
Along with the PRK, the UE is provided with a PRK identity, that also becomes
the PRGK identity of any PRGK derived from it. The UE is also given a group
member identity associated with the PRK that becomes it Group Member identity
for all communications with relays. The relay has a Group Member identity of
all zeros. The Group identity is the ProSe Relay ID (which is layer 2
destination identity of the relay) that the relay broadcasts in a discovery
message.
##### B.4.2.2.4 Key Derivation and Data Protection
The derivation of the PRGK from the PRK is as follows:
PRGK = F_1(PRK, ProSe Relay ID )
The other key derivations and protection of data follow the one-to-many
security solution, except the PTK is generated using PRGK rather than PGK.
The initial IP address assignment messages between the UE and relay are
integrity protected. By using a new PTK for each session with the same relay,
replay protection is enabled between these different sessions. This is
achieved by each side keeping the largest PTK Identity that was used to
successfully establish a session between them and always ensuring any new
session uses a larger PTK identity. This requires one change from the one-to-
many case in that a receiving entity needs to know if a particular message is
integrity protected.
##### B.4.2.2.5 Packet Format
In terms of signalling between the UE and relay, the correct PTK to use and
whether the data is integrity protected or not, the header and payload of the
PDCP packet will need to look as below:
Figure B.4.2.2.5-1: Proposed PDCP packet format
This is the same as in the one-to-many solution except the flag to indicate
whether integrity protection is applied or not.
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document provides a Session Initiation Protocol (SIP) based
protocol framework that serves as a means of user configuration of
supplementary services in the IP Multimedia (IM) Core Network (CN) subsystem.
The protocol framework relies upon the contents of the Request-URI in a SIP
INVITE request to enable basic configuration of services without requiring use
of the Ut interface.
The present document is applicable to User Equipment (UE) and Application
Servers (AS) which are intended to support user configuration of supplementary
services.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or nonâ€‘specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 24.173: \"IMS multimedia telephony communication service and
supplementary services; Stage 3\".
[3] 3GPP TS 24.229: \"IP Multimedia Call Control Protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[4] RFC 4967 (July 2007): \"Dial String Parameter for the Session Initiation
Protocol Uniform Resource Identifier\".
[5] RFC 3966 (December 2004): \"The tel URI for Telephone Numbers\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
# 4 SIP based user configuration
## 4.1 General description
SIP-based protocol framework serves as a means of user configuration of
supplementary services in the IM CN subsystem specified in 3GPP TS 24.173 [2].
The contents of the Request-URI in a SIP INVITE request is used to convey the
configuration code to the Application Server that hosts the supplementary
service. The \"user=\" parameter within the Request-URI is set by the UE to
value \"dialstring\" as described in RFC 4967 [4]. Upon session initiation,
the contents of the Request-URI are delivered by means of normal session setup
signalling, as described in 3GPP TS 24.229 [3] to an Application Server. The
Application Server then acts upon the Request-URI contents to effect the
desired configuration data change (e.g., register and activate Communication
Forwarding unconditional).
## 4.2 Syntax requirements
The precise digit sequences within the Request-URI that comprise the effective
dialstrings for user configuration are defined by the IM CN subsystem service
provider and are not subject to standardisation.
NOTE 1: The digit sequence corresponding to the feature code can begin with a
special character such as \"#\" or \"*\" according to network operator
preferences. The length of the digit sequence is also defined by the network
operator.
The digit sequences corresponding to the feature code shall be transported to
the AS in the Request-URI of a SIP INVITE request as follows:
  * as a SIP URI dial string conforming to RFC 4967 [4] where the \"phone-context\" parameter is set to the home network domain name and the \"user\" parameter is set to \"dialstring\";
  * as a SIP URI that is not a GRUU and with the user part starting with a + and the \"user\" parameter equals \"phone\". The domain is set to the home network domain; or
  * as a tel-URI with a \"phone-context\" parameter set to the home network domain as defined in RFC 3966 [5].
## 4.3 Signalling requirements
### 4.3.1 General
Two roles are recognized for the implementation of SIP-based user
configuration:
1) UE (SIP-based user configuration client); and
2) Application Server.
### 4.3.2 Actions at the originating UE (SIP-based user configuration client)
When performing SIP-based user configuration, the UE shall create a SIP URI,
as described in RFC 4967 [4], with:
a) a dialstring, set to either the concatenation of feature code and the
number to be provisioned or the feature code alone if no number information
needs to be provided for the service; and
b) a \"phone-context\" parameter, set to the home network domain name.
The UE shall construct and initiate an appropriate INVITE in accordance with
3GPP TS 24.229 [3] with the Request-URI set to the URI created above.
### 4.3.3 Actions at the AS serving the originating UE
Upon receiving an INVITE request with Request-URI containing a SIP URI
including a "phone-context" parameter equal to the home network domain name, a
\"user=\" parameter set to value \"dialstring\", and a dialstring representing
a feature code or a concatenation of feature code and number to be
provisioned, the AS shall:
a) accept the INVITE request following the procedures specified for AS acting
as a terminating UA in 3GPP TS 24.229 [3]; and
b) perform service activation, deactivation, or configuration data
modification based on the recognized contents of the Request-URI.
Based on the outcome of the service configuration operation, the AS may play
an appropriate announcement to notify the user of the result of the operation.
NOTE: The Request-URI of the received INVITE request can contain a SIP URI
with the \"user=\" parameter set to value \"phone\" or a Tel-URI. The AS can
treat this Request-URI as a dialstring.
###### ## Annex A (informative): Signalling flows
# A.1 User provisioning by SIP-based user configuration
The signalling flow below illustrates the use of the SIP-based user
configuration capability. This basic capability is used for activation,
deactivation and configuration data modification.
Figure A-1: User provisioning using feature code
1-9. UE-1 establishes a call with the provisioning AS following normal call
setup procedure. UE-1 sends the provisioning information as part of the
Request URI.
Table A.1-1: INVITE request (UE-1 to P-CSCF)
> INVITE sip:*12345;phone-context=home1.net;user=dialstring SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> Accept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Supported: precondition, 100rel, gruu
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;comp=sigcomp;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept: application/sdp; application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
Request-URI: in this example, the configuration feature code is set to *12345
and is represented as a dialstring.
SDP: the SDP is included for audio media, facilitating possible usage of audio
announcements, DTMF tones and IVR interaction depending on how the network
operator deploys the service configuration.
10\. The AS performs feature activation, deactivation or configuration data
modification based on the information received from the UE.
11\. The AS can also, by interaction with an MRFC, announce the result of the
configuration operation to UE-1.
12-17. After the provisioning is completed, UE-1 sends a BYE request to
terminate the call with the AS.
#
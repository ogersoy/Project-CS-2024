# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
IMS is foreseen to provide all the services, current and future, that existing
mobile networks provide. IMS may allow operators to develop new value added
applications as well as to enhance their existing solutions. These IMS-based
applications may be located in the UE. Furthermore, additional IMS-based
applications could reside and be executed in the UICC. This will lead to new
opportunities and allows for example the development of operator-specific IMS-
based applications that require a high level of security and portability.
# 1 Scope
This Technical Report will identify technical solutions in order to provide
the necessary mechanism in the UICC and the UE to make use of IMS
functionalities implemented in the UE.
The selected solution should allow
  * discovery of the support of the feature by each other (UE-UICC)
  * discovery of the supported capability by the UE
  * UICC registration to IMS network through the UE.
  * the UICC to participate to an IMS session (i.e. receive messages > pushed by an IMS application server)
  * the UICC to set up an IMS session (i.e. send messages to an IMS > application server)
  * the UICC to be notified when IMS de-registration occurs
  * the identification of a message for which the destination is a UICC > application
  * routing messages from and to UICC applications
  * UICC applications to be identified by other applications in the IMS > network
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\"
[3] 3GPP TS 23.228:\"IP Multimedia Subsystem (IMS); stage 2\"
[4] 3GPP TS 31.111:\"USIM Application Toolkit (USAT)\"
[5] 3GPP TS 23.003:\"Numbering, addressing and identification\"
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**UICC application Id** : a unique identifier allowing UICC application to be
identified in IMS network.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
\|\| Concatenation
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
**BIP:** Bearer Independent Protocol
**IARI:** IMS Application Reference ID
**IMPI:** IMS Private user Identity.
**IMPU:** IMS Public User Identity.
**IP:** Internet Protocol
**OTA:** Over The Air
**SCWS:** Smart Card Web Server
# Use cases and problem description
Currently the UICC cannot send and receive SIP traffic to an IMS network. This
feature is required in order to enable OTA updates to the UICC. This can be
done through both a push data mechanism and a pull data mechanism.
This section contains a list of use cases for the UICC access to IMS.
NOTE: Use cases are listed for the sole purpose of illustrating scenarios in
which the UICC will make use of IMS functionalities implemented on the ME. The
use cases below are informative, and are not functional description of
requirements.
[]{.underline}
**[Use Case 1: Over-The-Air Remote management of single-user-multiple-
UICC]{.underline}**
Today when an operator needs to update the subscriber's UICC contents, it uses
the OTA remote management platform. The OTA platform would send SMS messages
containing the commands that the UICC would execute at the reception of the
messages. It is based on a point-to-point concept, in particular with the OTA
server sending messages to a single UICC. When the user has multiple devices,
the OTA platform would need in this case to send several sets of messages to
the deferent user's UICC. The OTA management of these UICCs could be optimized
if a single OTA management message could reach all the UICCs of a specific
user.
**[Use Case 2: Over-The-Internet UICC remote management]{.underline}**
Some operators are offering \"unified\" communication package to corporate
users or small business users. Such offers bundle a mobile phone subscription
and VoIP & Messaging PC/Laptop applications, and are typically deployed inside
a USB dongle. These USB dongles are secured by a USIM (user authentication at
access and service level). These USIM cannot be addressed by SMS (no 3GPP
modem), but still need to be managed as a conventional USIM. The management of
such devices could benefit from the use of the SIP/IMS capabilities by
allowing the management platform to send/receive SIP/IMS messages to/from the
USIM.
**[Use Case 3: UICC based Rich Communication Suite (RCS) Client]{.underline}**
RCS is a communication package that allows user to communicate via instant-
messaging, chat, whiteboard, to share documents, videos, pictures and be
always in contact with its social network. More and more GSMA RCS pilots are
launched worldwide. GSMA RCS is based on IMS. Today, more and more handsets
are sold with SCWS technology support. Some operators may want to deploy RCS
Client on UICCs supporting both SCWS and \"UICC Access to IMS\" features.
These UICC-based RCS Clients would provide a default RCS client to a mobile
user without the need to install a full-fledged RCS client on the handset.
This would allow the user to access directly the RCS service and have a fast
and first flavour of the service prior to downloading the full-fledged RCS
client.
**[Use Case 4: User Authentication to Internet Services]{.underline}**
Some operators are looking at providing Identity Management service to their
users. As an example, a mobile user benefiting from such service would receive
an authentication message from his mobile operator, asking him to enter a PIN,
every time he is logging into his Internet banking service on his PC for
instance. This system is making use of the GBA Push mechanism. For a single
device user situation, the message asking for the PIN, is sent inside an SMS
to the user's UICC. The UICC then sends a STK command to the Handset asking
the handset to display a text and requesting the user to enter his PIN. The
PIN is checked by the UICC locally and the UICC then sends an answer back to
the operator with the results of the user verification process. In a multiple
device environment, the message should be sent to all the user's devices, and
the user would pick up the message on the most convenient device at the moment
he receives that message. This is possible if the UICCs have access to the
device IMS capabilities.
# Solutions overview
**[Solution 1 : explicit IMPU registration based solution]{.underline}**
In this solution, the UICC application identifier is an IMPU. The UICC
registers to the IMS network by sending explicitly a registration command to
the ME. The ME, upon reception of the command, will initiate a registration
procedure, and register IMPU provided by UICC. This implies that the ME
supports registration of several IMPU at different points in time, since the
registration request form UICC can come anytime.
**[Solution 2 : implicit IMPU registration based solution]{.underline}**
In this solution, the UICC application identifier is an IMPU. The IMPU stored
in ME and the IMPU for UICC will belong to the same implicitly registered ID
set, as defined in TS 23.228 [3]. With implicit registration based solution,
the ME does not need to trigger an IMS registration when requested by UICC, if
ME has already registered.
**[Solution 3 : IARI routing based solution]{.underline}**
One possible solution to enable IMS access to the UICC is to use the IMS
Application Reference ID (IARI). This solution would enable active
applications hosted on the UICC to register their IARIs to the IMS network.
Like applications installed in the ME, these applications would receive all
relevant SIP traffic associated with their IARIs directed to them using the
IARI in the Accept-Contact header in the SIP request. This solution would also
allow the ME to register all known active IARI regardless of their location
(ME or UICC) in a single SIP REGISTER message sent to the IMS network.
[]{.underline}
**[Usage of BIP mechanism]{.underline}**
The Above solutions will reuse BIP mechanism defined in 3GPP TS 31.111 [4] in
terminal-UICC interface
  * discovery of supported features using USAT mechanism
  * establishment of a channel dedicated to IMS
  * allocation of buffers, channel id, using BIP mechanism
  * usage of SEND DATA RECEIVE DATA to convey SIP messages
Extension or modification to existing BIP mechanism may be needed, depending
on the solution selected.
## 5.1 Discovery of the supported features
### 5.1.1 IMPU explicit registration based solution
A ME supporting UICC access to IMS based on IMPU explicit registration will
support the BIP OPEN CHANNEL for IMS proactive command. The support of this
command will be indicated in TERMINAL PROFILE, using mechanism defined in 3GPP
TS 31.111 [4].
### 5.1.2 IMPU implicit registration based solution
A ME supporting UICC access to IMS based on IMPU implicit registration will
support the BIP OPEN CHANNEL for IMS proactive command. The support of this
command will be indicated in TERMINAL PROFILE, using mechanism defined in 3GPP
TS 31.111 [4].
### 5.1.3 IARI SIP Routing to the UICC
#### 5.1.3.1 Discovery of the UICC's IARIs
In order to reduce the amount of SIP REGISTER [2] messages to indicate the
IARIs associated with active applications on the UE, the UICC advertises at
boot-up (or initialisation) the IARIs associated with active UICC hosted
applications to the ME.
## 5.2 Registration and authentication
### 5.2.1 IMPU explicit registration based solution
#### 5.2.1.1 UICC Identifiers
The UICC is allocated with an IMS public identity (UICC IMPU).
This UICC IMPU is provided to the ME during registration, as part of BIP Open
Channel for IMS proactive command.
#### 5.2.1.2 Explicit registration
The UICC will provide to the ME in OPEN CHANNEL for IMS command all necessary
parameters to register to IMS.
Upon receiving this command, the ME will attempt a registration of the IMS
Public user identity contained in the OPEN CHANNEL for IMS parameter field to
IMS network, as specified in 3GPP TS 24.229 [2].
If the IMPU is already registered by ME, the ME is expected to return an
error.
Upon successful registration, the ME returns to the UICC the ME IP address
bound with the IMPU.
#### 5.2.1.5 De-Registration
> \- IMS network initiated de-registration:
>
> The ME sends an ENVELOPE (Event download - channel status) to indicate the
> UICC that IMPU is de-registered.
>
> \- User initiated de-registration
>
> The UICC sends a CLOSE CHANNEL command to indicate that the User de-
> registered the IMPU. Upon reception of a CLOSE CHANNEL command, the ME
> executes an IMS de-registration process, as specified in TS 24.229 [2].
### 5.2.2 IMPU implicit registration based solution
#### 5.2.2.1 UICC Identifiers
The UICC is allocated with an IMS public identity (UICC IMPU).
This UICC IMPU is deduced using a function **F** (IMPI), private identity
associated with the subscription
(ISIM IMPI if ISIM is present, temporary IMPI deduced from IMSI either).
_Note: this function_ _F_ _is not to be standardized._
#### 5.2.2.2 Implicit registration
**The implicit registration feature described in TS 23.228 [3] is used to
associate the UICC IMPU to other public identities of the subscription.**
**When an ISIM is present, the IMPU for the UICC is associated with the first
Public User Identity of the ISIM in an implicitly registered ID set.**
**When an ISIM is not present, the IMPU for the UICC is associated with the
IMPU derived from the IMSI.**
[]{.underline}
[]{.underline}
Figure 5.1: Relationship of Public User Identities when implicitly registered
#### 5.2.2.3 Registration
See TS 24.229 [2]
When the UICC requests a USAT \"BIP Open channel for IMS\" command
\- If the ME already registered to IMS the user public identity (ies) then the
**IMPU for UICC is implicitly registered, the ME can directly return
successful command status**
\- If the ME has not already registered to IMS, it is up to the ME to trigger
the standard IMS registration as stated in TS 24.229 [2], using this first
IMPU of EF~IMPU~. In case the ME implements this registration, the ME will
manage re-registration
It is expected that no extra code is needed for the ME and that there is a
minimum impact onto its registration state machine in this solution.
#### 5.2.2.4 Authentication
See TS 24.229 [2].
#### 5.2.2.5 De-Registration
Two possible de-registration causes are handled in the following way:
> \- IMS network initiated de-registration:
>
> In this case the ME sends an ENVELOPE (Event download - channel status) to
> indicate to the UICC that its implicit public ID is de-registered.
>
> NOTE: It is not possible for the network to directly ask for UICC de-
> registration, as the side effect would be user de-registration.
>
> **-** First IMPU de-registration by the ME:
>
> In this case the ME sends an ENVELOPE (Event download - channel status) to
> indicate to the UICC that its implicit public ID is de-registered.
### 5.2.3 IARI SIP Routing to the UICC
The initial SIP REGISTER [2] request sent by the ME contains the IARIs
associated with active applications hosted on the UICC along with the active
applications hosted on the ME. If the list of IARIs associated with active
applications on the UICC changes, the UICC indicates this change to the ME.
The ME then sends the necessary SIP REGISTER [2] request containing the UICC
hosted IARIs and ME hosted IARIs to reflect this change.
The ME sends the list of registered IMPUs as received from the IM CN Subsystem
in response to the IMS registration as an indication to the UICC that the IMS
registration has been completed successfully and that the UICC IARIs have been
registered associated with these IMPUs.
After the successful registration the ME forwards to the UICC all SIP requests
containing an Accept-Contact header field containing the IARIs associated with
the active applications hosted on the UICC. The ME also forwards to the UICC
any SIP responses or subsequent SIP requests received that are part of the
same dialog or standalone transaction as an initial SIP request forwarded to
the UICC or received from the UICC.
## 5.3 Message flow
### 5.3.1 Message flow for IMPU explicit registration based solution
#### 5.3.1.1 Registration
Upon reception of OPEN CHANNEL for IMS command, the ME will initiate a
registration process with the parameters provided by the UICC.
Figure 5.2: explicit registration
#### 5.3.1.2 De-Registration
Initiated by the user:
Figure 5.3: user initiated de-registration
Initiated by the Network (i.e. administrative de-registration). In this case
Figure 5.4: Network initiated de-registration
#### 5.3.1.3 SIP Message from UICC
**Same as for \"IMPU implicit registration based solution\"**
#### 5.3.1.4 SIP Message to UICC
**Same as for \"IMPU implicit registration based solution\"**
### 5.3.2 Message flow for IMPU implicit registration based solution
#### 5.3.2.1 Registration
If the ME has not already registered to IMS, it is up to the ME to trigger the
standard IMS registration as stated in TS 24.229, using this first IMPU of
EF~IMPU~:
Figure 5.5: User IMPU not already registered
If the ME already registered to IMS the user public identity (ies) then the
**IMPU for UICC is implicitly registered, the ME can directly return
successful command status:**
Figure 5.6: User IMPU already registered
#### 5.3.2.2 De-Registration
Initiated by the ME:
Figure 5.7: Mobile initiated de-registration
Initiated by the Network (i.e. administrative de-registration). In this case
Figure 5.8: Network initiated de-registration
#### 5.3.2.3 SIP Message from UICC
**After a successful** \"BIP OPEN CHANNEL for IMS\" command
\- the UICC IMPU is IMS registered
\- the UICC knows the IP address used by the ME for IMS signalling.
> **UICC can then build SIP messages and send them encapsulated in a SEND DATA
> command, the ME is in charge to de-capsulate the SEND DATA and to send the
> SIP message to the P-CSCF**
Figure 5.9: SIP message from UICC, i.e. : session INVITE
#### 5.3.2.4 SIP Message to UICC
After a successful \"BIP OPEN CHANNEL for IMS\" command, the ME is aware of
the UICC IMPU. The ME is then able to trigger an Event Data available for the
UICC to retrieve the SIP message encapsulated in a RECEIVE DATA command
Figure 5.10: SIP message to UICC
### 5.3.3 IARI SIP Routing to the UICC
#### 5.3.3.1 Discovery of the UICC's IARIs and Registration
Figure 5.11: Discovery of the UICC's IARIs and Registration
The UICC can provide a list of active IARIs to the ME using an EF. This EF can
be part of the ISIM or USIM or DF TELECOM.
The UICC registers for the IMS Registration event with the ME. The ME
registers the IARIs associated with all of the UICCs active applications.
Once the registration is complete and successful, the ME sends the IMPU list
included in the P-Associated-URI of the SIP 200 (OK) response [2] to the UICC
as part of the IMS Registration Event. The UICC now knows the state of the IMS
Registration and can send an Open Channel command to the ME when it needs to
transmit or receive its SIP data.
For the UICC to change its active applications and trigger a subsequent
registration it triggers a Refresh command on its list of Active IARIs. The ME
will identify the change and transmit the necessary SIP REGISTER request [2]
to reflect that change to the network.
#### 5.3.3.2 Notification of Incoming IMS data
Figure 5.12: Notification of incoming IMS data
The UICC Registers for the incoming IMS data event. When the ME receives a SIP
INVITE request [2]) containing an Accept-Contact header field containing an
IARI associated with an active application hosted on the UICC, the ME sends
the incoming IMS data event to inform the UICC of the pending data.
The UICC then opens a channel for the application associated with the IARI and
receive the incoming SIP request. The UICC will complete its SIP data transfer
session and then close the channel for the application associated with the
IARI.
####
#### 5.3.3.3 UICC originating a SIP INVITE
####
Figure 5.13: UICC originating a SIP INVITE
To initiate a SIP session, the UICC can open a channel for the application
associated with the IARI and transmit the SIP request. After the termination
of a SIP dialog or completion of a SIP standalone transaction the UICC closes
the channel for the application associated with the IARI.
#### 5.3.3.4 Discovery of an IMS Registration error
Figure 5.14: IMS Registration Error Event
The UICC can provide a list of active IARIs to the ME using an EF. This EF can
be part of the ISIM or USIM or DF TELECOM.
The UICC registers for the IMS Registration Error event with the ME. The ME
registers the IARIs associated with all of the UICCs active applications.
If there is an error during the IMS Registration procedure, the ME notifies
the UICC of the error by providing the status code received from the network
in response to the SIP REGISTER message. The ME may want to choose to inform
the UICC of the status codes that represent more \"permanent\" failures.
It is feasible for this event registration to be combined with the IMS
Registration Event described in 5.3.3.1.
## 5.4 Impact on IMS Core network
### 5.4.1 Explicit IMPU registration based solution
No impact on the HSS.
Optionally, an IMPU address range can be allocated on the HSS side to mark the
IMPU associated with UICC.
No impact identified on P-CSCF, I-CSCF, S-CSCF.
### 5.4.2 Implicit IMPU registration based solution
The derivation function **F** () is used in the HSS to compute IMPU_UICC from
the IMPI stored in the ISIM.
  * The derivation function is not described in TS 31.111
  * Can be pre-computed, and HSS pre-provisioned
  * Can be computed on the fly
It is assumed that the implicit registration set is maintained properly in
HSS, to avoid potential synchronization problem.
If no ISIM is present in the UICC, temporary IMPI / IMPU are derived from IMSI
following the rules defined in TS 23.003 [5]. The derivation function F( )
will be applied to temporary IMPI to compute IMPU_UICC.
Since the UICC will own its own IMPI / IMPU, these values will be stored in
the HSS and bound to the UICC.
No impact identified on P-CSCF, I-CSCF, S-CSCF.
### 5.4.3 IARI SIP Routing to the UICC
There are no impacts to the IMS Core network as the UE's IMPU is still in use
for addressing the user and the UE and all the network-based application
server needs to do is include the appropriate IARI in the Accept-Contact
header field of the SIP request. This is in-line with the current IMS
architecture for routing to installed applications on the UE.
## 5.5 Impact on the Mobile Equipment
### 5.5.1 IMPU explicit registration based solution
> \- The support of BIP OPEN CHANNEL for IMS proactive command will be
> indicated in TERMINAL PROFILE, using mechanism defined in 3GPP TS 31.111
> [4].
>
> \- A ME triggers a Registration procedure as described in TS 24.229 when
> receiving BIP OPEN CHANNEL for IMS from the UICC
>
> \- A ME acts as a gateway between SEND DATA / RECEIVE DATA BIP protocol with
> the UICC and SIP messages with P-CSCF for signalling based on UICC IMPU
>
> \- The ME needs to maintain the SIP registration state (timers etc) for the
> SIP registration transmissions coming from the UICC and its own SIP stack in
> order to avoid potential conflicts when accessing the IMS network.
### 5.5.2 IMPU implicit registration based solution
> \- The support of BIP OPEN CHANNEL for IMS proactive command will be
> indicated in TERMINAL PROFILE, using mechanism defined in 3GPP TS 31.111
> [4].
>
> \- A ME may trigger a Registration procedure as described in TS 24.229 when
> receiving BIP OPEN CHANNEL for IMS from UICC
>
> \- A ME acts as a gateway between SEND DATA / RECEIVE DATA BIP protocol with
> UICC and SIP messages with P-CSCF for signalling based on UICC IMPU
>
> \- The ME needs to maintain the SIP registration state (timers etc) for the
> SIP registration transmissions coming from the UICC and its own SIP stack in
> order to avoid potential conflicts when accessing the IMS network.
### 5.5.3 IARI based solution
The ME needs to support the necessary additional USAT commands along with the
necessary ISIM or USIM files to support this feature:
  * Open Channel for IMS/IARI
  * Setup Event List and Event download for IMS Registrations
  * Setup Event List and Event download for incoming IMS requests
  * An ISIM or USIM EF that contains all IARIs associated with active applications hosted on the UICC
# 6 Conclusion
Three solutions have been identified; their respective mechanisms are
described in section 5.
In this section, the pros and cons of the three solutions are discussed.
## 6.1 Solution 1 explicit IMPU based solution, pros and cons
Cons:
\- This solution has the greatest impact on the handset amongst the 3
solutions. This solution also has some impact on the network (carrier IMPU
management).
Pros:
  * The UICC IMS application can trigger explicit IMS registration using an Open Channel proactive command..
## 6.2 Solution 2 implicit IMPU based solution, pros and cons
Cons:
> \- There is an impact on the HSS related to provisioning of the implicitly
> registered IMPU.
Pros:
  * This solution has the lowest impact on the handset implementation amongst the three solutions.
## 6.3 Solution 3 IARI based routing solution, pros and cons
Cons:
  * The UICC applications can not trigger an IMS registration using an USAT proactive command.
Pros:
\- This solution will impact the handset implementation; the amount of work
required is considered to be inferior to solution 6.1. This solution also has
no impact on the network (IMS) implementation.
\- This solution enables significant optimisations around IMS registration by
allowing for IMS SIP signalling consolidation. This solution also maintains
the ME's responsibility of identifying all active applications that require
IMS access.
## 6.4 Selected solution
6.3 was selected as the preferred solution. This solution provides a means for
IMS to address the UICC uniquely using what was agreed as a more appropriate
identifier for this purpose. Additionally the resulting UE to IMS interaction
remains unchanged while the ME to UICC interaction remains closely aligned to
previously specified mechanisms.
###### ### Annex A (Informative): Explicit IMPU registration SIP REGISTER
content example
For explicit IMPU registration, the ME constructs the initial unprotected SIP
REGISTER message as defined in 3GPP TS 24.229 [2]. The parameters list looks
as follows:
+------------------+------------------------+------------------------+ | **Field name** | **Content** | **Comment** | +------------------+------------------------+------------------------+ | Request-URI | SIP URI of the domain | Home network domain | | | name of the home | name retrieved by ME | | | network | from ISIM or derived | | | | by ME from USIM as | | | | described in 3GPP TS | | | | 24.229 [2], | | | | subclause 5.1.1.1A | +------------------+------------------------+------------------------+ | From | SIP URI that contains | IMS Public user | | | IMS public user | identity contained in | | | identity to be | OPEN CHANNEL for IMS | | | registered. | parameter field | +------------------+------------------------+------------------------+ | To | SIP URI that contains | IMS Public user | | | IMS public user | identity contained in | | | identity to be | OPEN CHANNEL for IMS | | | registered. | parameter field | +------------------+------------------------+------------------------+ | Contact | SIP URI containing the | ME parameter | | | IP address or FQDN of | | | | the ME | | | | | | | | Used for address | | | | binding. | | +------------------+------------------------+------------------------+ | Via | IP address or FQDN of | ME parameter | | | the ME | | +------------------+------------------------+------------------------+ | Route (optional) | Set to P-CSCF address | ME parameter | +------------------+------------------------+------------------------+
#
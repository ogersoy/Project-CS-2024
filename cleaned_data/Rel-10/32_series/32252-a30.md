# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document is part of a series of documents that specify charging
functionality and charging management in GSM/UMTS networks. The GSM/UMTS core
network charging architecture and principles are specified in 3GPP TS 32.240
[1], which provides an umbrella for other charging management documents that
specify:
\- the content of the CDRs per domain and subsystem (offline charging);
\- the content of real-time charging messages per domain / subsystem (online
charging);
\- the functionality of online and offline charging for those domains and
subsystems;
\- the interfaces that are used in the charging framework to transfer the
charging information (i.e. CDRs or charging events).
The complete document structure for these TSs is defined in 3GPP TS 32.240
[1].
The present document specifies the Offline and Online Charging description for
the 3GPP interworked Wireless LAN (WLAN), based on the functional stage 2
description of 3GPP WLAN interworking in 3GPP TS 23.234 [201] as well as the
Charging support and Charging differentiation for Mobility between 3GPP-
Wireless Local Area Network (WLAN) interworking and 3GPP systems, based on the
functional stage 2 description of mobility between 3GPP-WLAN and 3GPP systems
in 3GPP TS 23.327 [202]. This charging description includes the offline and
online charging architecture and scenarios specific to the 3GPP interworked
WLAN, as well as the mapping of the common 3GPP charging architecture
specified in 3GPP TS 32.240 [1] onto the 3GPP interworked WLAN. It further
specifies the structure and content of the CDRs for offline charging, and the
charging events for online charging. The present document is related to other
3GPP charging TSs as follows:
\- The common 3GPP charging architecture is specified in 3GPP TS 32.240 [1].
\- The parameters, abstract syntax and encoding rules for these CDR types are
specified in 3GPP TS 32.298 [51].
\- A transaction based mechanism for the transfer of CDRs within the network
is specified in 3GPP TS 32.295 [54].
\- The file based mechanism used to transfer the CDRs from the network to the
operator\'s billing domain (e.g. the billing system or a mediation device) is
specified in 3GPP TS 32.297 [52].
\- The 3GPP Diameter application that is used for WLAN offline and online
charging is specified in 3GPP TS 32.299 [50].
All terms, definitions and abbreviations used in the present document, that
are common across 3GPP TSs, are defined in the 3GPP Vocabulary, 3GPP TR 21.905
[100]. Those that are common across charging management in GSM/UMTS domains or
subsystems are provided in the umbrella document 3GPP TS 32.240 [1] and are
copied into clause 3 of the present document for ease of reading. Finally,
those items that are specific to the present document are defined exclusively
in the present document.
Furthermore, requirements that govern the charging work are specified in 3GPP
TS 22.115 [102].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging architecture and principles\".
[2] - [10] Void.
[11] 3GPP TS 32.251: \"Telecommunication management; Charging management;
Packet Switched (PS) domain charging\".
[12] - [49] Void.
[50] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging applications\".
[51] 3GPP TS 32.298: \"Telecommunication management; Charging management;
Charging Data Record (CDR) parameter description\".
[52] 3GPP TS 32.297: \"Telecommunication management; Charging management;
Charging Data Records (CDR) file format and transfer\".
[53] Void.
[54] 3GPP TS 32.295: \"Telecommunication management; Charging management;
Charging Data Record (CDR) transfer\".
[55] - [70] Void.
[71] 3GPP TS 23.125: \"Overall high level functionality and architecture
impacts of flow based charging; Stage 2\".
[72] - [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] - [199] Void.
[200] 3GPP TS 22.934: \"Feasibility study on 3GPP system to Wireless Local
Area Network (WLAN) interworking\".
[201] 3GPP TS 23.234: \"3GPP system to Wireless Local Area Network (WLAN)
interworking; System description\".
[202] 3GPP TS 23.327: \"Mobility between 3GPP-Wireless Local Area Network
(WLAN) interworking and 3GPP systems\".
[203] Void
[204] 3GPP TS 29.234: \"3GPP system to Wireless Local Area Network (WLAN)
interworking; Stage 3\".
[205] - [400] Void.
[401] IETF RFC 3588 (2003): \"Diameter Base Protocol\".
[402] IETF RFC 4006 (2005): \"Diameter Credit-Control Application\".
[403] Void
[404] IETF RFC 4005 (2005): \"Diameter Network Access Server Application\".
[405] IETF RFC 5580 (2009): \"Carrying Location Objects in RADIUS and
Diameter\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [50], 3GPP TS 32.240 [1], 3GPP TS 22.934 [200], 3GPP TS 23.234
[201] and the following apply:
**Billing Domain (BD):** part of the operator network, which is outside the
core network that receives and processes charging information from the core
network charging functions.\ It includes functions that can provide billing
mediation and billing end applications.
**Interworking WLAN (I-WLAN):** a WLAN that interworks with a 3GPP system**.**
**Offline Charging:** charging mechanism where charging information **does
not** affect, in real-time, the service rendered.
**Online Charging:** charging mechanism where charging information can affect,
in real-time, the service rendered and therefore a direct interaction of the
charging mechanism with bearer/session/service control is required.
**PS based services: in WLAN interworking, PS based service is a general term
to refer to the services provided by a PLMN using IP bearer capability between
WLAN UEs and the PLMN in scenario 3 and upwards\** They include all services
provided by 3G PS domain that use the IP bearer service (e.g. IMS, Internet
access, Corporate IP network access), and other services (e.g., SMS and LCS).
**WLAN:** Wireless LAN.
**WLAN-attach status:** indicates whether a UE is WLAN-attached or not\ A WLAN
UE is \"WLAN-attached\" after successful authentication and WLAN Access
Authorization. A WLAN UE is \"WLAN-detached\" after its disconnection, or its
authentication or WLAN access authorisation being cancelled.
**Home Agent Access Point Name (HA-APN)** : is used to identify a specific PDN
and a point of interconnection to that network (Home Agent).
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Rf Offline charging reference point between a 3G network element and the CDF
Ro Online charging reference point between a 3G network element and the OCS
D\' Reference point between a pre-R6 HSS/HLR and a 3GPP AAA Server
Dw Reference point between a 3GPP AAA Server and an SLF
Gr\' Reference point between a pre-R6 HSS/HLR and a 3GPP AAA Server
Wa Reference point between a WLAN Access Network and a 3GPP AAA Server/Proxy
(charging and control signalling)
Wd Reference point between a 3GPP AAA Proxy and a 3GPP AAA Server (charging
and control signalling)
Wf Reference point between an Offline Charging System and a 3GPP AAA
Server/Proxy
Wg Reference point between a 3GPP AAA Server/Proxy and WAG
Wi Reference point between a Packet Data Gateway and an external IP Network
Wm Reference point between a Packet Data Gateway and a 3GPP AAA Server or 3GPP
AAA proxy
Wn Reference point between a WLAN Access Network and a WLAN Access Gateway
Wp Reference point between a WLAN Access Gateway and a Packet Data Gateway
Wo Reference point between a 3GPP AAA Server and an OCS
Wu Reference point between a WLAN UE and a Packet Data Gateway
Wx Reference point between an HSS and a 3GPP AAA Server
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations defined in 3GPP TR
21.905 [50], 3GPP TS 22.934 [200], 3GPP TS 23.234 [201], 3GPP TS 23.934 (see
bibliography), 3GPP TS 32.240 [1] and the following apply:
3GPP 3^rd^ Generation Partnership Project
BD Billing Domain
CDR Charging Data Record
EPS Evolved Packet Systems
GGSN Gateway GPRS Support Node
GTP GPRS Tunnelling Protocol
I-WLAN Interworking WLAN
IP Internet Protocol
LAN Local Area Network
PDG Packet Data Gateway
PDP Packet Data Protocol, e.g. IP
PS Packet Switched
SGSN Serving GPRS Support Node
TS Technical Specification
TTG Tunnel Termination Gateway
UMTS Universal Mobile Telecommunications System
WLAN Wireless LAN
# 4 Architecture considerations
## 4.1 High level WLAN architecture
The WLAN - 3GPP interworking architecture is specified in 3GPP TS 23.234
[201]. It distinguishes between two interworking scenarios:
\- WLAN Access, Authentication and Authorization, which provides for access to
the WLAN and the locally connected IP network (e.g. Internet) to be
authenticated and authorized through the 3GPP System. Access to a locally
connected IP network from the WLAN, is referred to as WLAN Direct IP Access.
\- WLAN 3GPP IP Access, which allows the WLAN UEs to establish connectivity
with External IP networks, such as 3G operator networks, corporate Intranets
or the Internet via the 3GPP system.
\- WLAN Access Authentication and Authorisation and WLAN 3GPP IP Access are
technically independent.
Figure 4.1.1 illustrates the basic WLAN networks from the point of view of
3GPP interworking.
Figure 4.1.1: Simplified WLAN Network Model\ (the shaded area refers to WLAN
3GPP IP Access functionality)
The Packet Data Gateway supports WLAN 3GPP IP Access to External IP networks.
The WLAN includes WLAN access points and intermediate AAA elements. It may
additionally include other devices such as routers. The WLAN User Equipment
(WLAN UE) includes all equipment that is in possession of the end user, such
as a computer, WLAN radio interface adapter, etc.
Editor\'s note: Appropriate mappings in clause 4 are needed, i.e. mapping
between the logical charging functions as defined in 3GPP TS 32.240 and the
WLAN charging entities.
Figure 4.1.2 depicts the non-roaming WLAN inter-working reference model for
both Direct IP Access and 3GPP IP Access.
NOTE: The shaded area refers to WLAN 3GPP IP Access functionality.
Figure 4.1.2: Non Roaming Reference Model
Figure 4.1.3 depicts the roaming WLAN inter-working reference model where 3GPP
PS based services are provided by the home PLMN based on 3GPP IP Access.
NOTE: The shaded area refers to WLAN 3GPP IP Access functionality.
Figure 4.1.3: Roaming reference model - 3GPP PS based services provided\ via
the 3GPP Home Network
Finally, figure 4.1.4 shows the case of the 3GPP IP Access PS based services
being provided by the visited PLMN. Note that there is no difference between
figures 4.3 and 4.4 for the case of WLAN Access, Authentication and
Authorisation.
NOTE: The shaded area refers to WLAN 3GPP IP Access functionality.
Figure 4.1.4: Roaming reference model - 3GPP PS based services provided\ via
the 3GPP Visited Network
Detailed descriptions of nodes and reference points in figures 4.1.2, 4.1.3
and 4.1.4 are provided in 3GPP TS 23.234 [201]. Following is a short
description of each. Coloured nodes and reference points are relevant for
charging thus explained in more detail.
**WLAN UE:** a WLAN UE is the User Equipment using a UICC card utilized by a
3GPP subscriber to access the WLAN network for 3GPP interworking purpose.
**WLAN Access Network (WLAN AN):** WLAN AN provides the wireless IP
connectivity to the WLAN UE. It generates per user charging information about
the WLAN AN usage. WLAN AN is outside of 3GPP scope.
**3GPP AAA Proxy:** the 3GPP AAA Proxy represents a proxying and filtering
function that resides in the Visited 3GPP Network, i.e. it exists only in the
roaming case. For charging purposes the 3GPP AAA Proxy functions include:
\- relaying the AAA information between WLAN and the 3GPP AAA Server;
\- reporting per-user charging/accounting information to the VPLMN offline
charging system for roaming users;
\- protocol conversion when the Wa and Wd reference points do not use the same
protocol. This function is dependent on inter-operator agreements;
For WLAN 3GPP IP Access only:
\- Receiving per-tunnel charging information based on the tunnel identifier
from the WAG and mapping of a user identifier and a tunnel identifier from the
PDG; generating per user charging records for roaming users.
**3GPP AAA Server:** the 3GPP AAA server is located within the 3GPP HPLMN. It
performs the AAA functions and may also act as an AAA proxy. For WLAN 3GPP IP
Access it provides authorization, policy enforcement and routing information
to the PDG, WAG and WLAN AN. For charging the 3GPP AAA Server:
\- generates and reports per-user charging/accounting information to the HPLMN
CDF;
\- performs online charging control for the WLAN AN.
**WLAN Access Gateway (WAG):** the WAG applies to a WLAN 3GPP IP Access
enabled system. It is a gateway via which the data to/from the WLAN Access
Network is routed via the PLMN to provide a WLAN UE with 3G PS based services
in a WLAN 3GPP IP Access enabled system. The WLAN Access Gateway resides in
the VPLMN in the roaming case, and in the HPLMN in the non-roaming case. From
charging point of view the WLAN Access Gateway:
\- allows VPLMN to generate charging information for users accessing via the
WLAN AN in the roaming case;
\- performs collection of per tunnel accounting information, e.g. volume count
(byte count) and elapsed time, to be used e.g. for inter-operator settlements.
NOTE 1: Per tunnel accounting generation in the WAG is not required when the
WAG and PDG are in the same network.
**Packet Data Gateway:** the Packet Data Gateway (PDG) applies to a WLAN 3GPP
IP Access enabled system. 3GPP PS based services are accessed via a PDG in the
user\'s Home Network or a PDG in the selected VPLMN. 3GPP PS based services
may be accessed via a PDG in the user\'s HPLMN or a PDG in the selected VPLMN.
From charging point of view the Packet Data Gateway:
\- generates charging information related to user data traffic for offline and
online charging purposes;
\- may apply IP flow based bearer level charging, e.g. in order to
differentiate or suppress WLAN bearer charging for 3GPP PS based services.
Editor\'s Note: PDG functionality may be provided by re-using the existing
GGSN functionality. The current working assumption is that the TPF is a
logical function allocated to the PDG providing IP flow based bearer level
charging capabilities.
Following is a functional description of the reference points depicted in the
above figures.
**Wa:** the Wa reference point connects the WLAN Access Network, possibly via
intermediate networks, to the 3GPP Network (i.e. the 3GPP AAA Proxy in the
roaming case and the 3GPP AAA server in the non-roaming case). The prime
purpose of the protocols crossing this reference point is to transport
authentication, authorization and charging-related information in a secure
manner. The reference point has to accommodate also legacy WLAN Access
Networks.
**Wz:** this reference point is used by the PDG for transfer of offline
charging records from the PDG CDF to the CGF. The prime purpose of the
protocols crossing this reference point is to transport/forward charging
information towards 3GPP operator\'s offline charging system, located in the
VPLMN or HPLMN.
**Wy:** this reference point is an intra-operator interface used by the PDG to
communicate with the Online Charging System. Wy is present when the PDG is
located in the HPLMN (in the non-roaming case as described in figure 4.1.2 or
in the roaming case with 3GPP PS based services provided via the 3GPP home
network as described in figure 4.1.3). Wm, Wd, Wo are used instead in the
roaming case with 3GPP PS based services provided via the 3GPP visited network
as described in figure 4.1.4. The prime purpose of the protocol(s) crossing
this reference point is to transport online charging related information so as
to perform credit control for the online charged subscriber. This reference
point applies the common 3GPP online charging interface as specified in 3GPP
TS 32.299 [50].
Wm: this reference point applies to WLAN 3GPP IP Access.
The Wm reference point is located between
  * 3GPP AAA Server and Packet Data Gateway when the PDG is located in the HPLMN (in the non-roaming case as described in figure 4.1.2 or in the roaming case with 3GPP PS based services provided via the 3GPP home network as described in figure 4.1.3)
  * respectively between 3GPP AAA Proxy and Packet Data Gateway when the PDG is located in the VPLMN (in the roaming case with 3GPP PS based services provided via the 3GPP visited network as described in figure 4.1.4).
The functionalities of this reference point are described in 3GPP TS 23.234
[201].
**Wo:** the Wo reference point is used by the 3GPP AAA Server to communicate
with 3GPP Online Charging System (OCS). The prime purpose of the protocol(s)
crossing this reference point is to transport online charging related
information so as to perform credit control for the online charged subscriber.
This reference point applies the common 3GPP online charging interface as
specified in 3GPP TS 32.299 [50].
**Wf:** the Wf reference point is located between the 3GPP AAA Server and 3GPP
offline charging system. The prime purpose of the protocols crossing this
reference point is to transport/forward charging information towards 3GPP
operator\'s offline charging system, located in the VPLMN or HPLMN, so as to
generate CDRs for offline charged subscribers and to calculate inter-operator
accounting.
The components of the \"offline charging system\" are further explained in
clause 4.2.
This reference point applies the 3GPP Diameter based offline charging
interface as specified in 3GPP TS 32.299 [50].
**Wd:** the Wd reference point applies to roaming cases only. The Wd reference
point connects the 3GPP AAA Proxy, possibly via intermediate networks, to the
3GPP AAA Server. The prime purpose of the protocols crossing this reference
point is to transport authentication, authorisation and related information.
The functionality of the reference point is to transport AAA messages
including charging signalling per WLAN user used for purging a user from the
WLAN access for immediate service termination.
NOTE 2: Throughout the rest of the present current document, \'Rf\' is used in
place of \'Wf\', and, \'Ro\' is used in place of \'Wo\' and \'Wy\' for reasons
explained in 3GPP TS 32.240 [1].
## 4.2 WLAN offline charging architecture
As described in 3GPP TS 32.240 [1], the CTF (an integrated component in each
charging relevant NE) generates charging events and forwards them to the CDF.
The CDF, in turn, generates CDRs which are then transferred to the CGF.
Finally, the CGF creates CDR files and forwards them to the Billing Domain.
The following WLAN network elements are involved in WLAN charging process -
the WLAN Access Network, the WLAN AAA Proxy/Server, and the PDG, implying that
they have an integrated CTF. The distribution of the CDF and CGF logical
functions differs from network element to network element. For the purposes of
this TS, the distributions in figure 4.2 are considered.
WLAN AN: The CTF is integrated in to the WLAN AN. The CDF and the CGF are
external to the WLAN AN.
**Editor\'s note: The CTF ... TBD**
3GPP AAA Proxy: The 3GPP AAA Proxy proxies the charging information received
from the WLAN AN over the Wa reference point to a CDF in the visited network
over a Wf reference point, and, to a 3GPP AAA Server in the subscriber\'s home
network over the Wd reference point. The 3GPP AAA Proxy is relevant only in a
roaming case.
3GPP AAA Server: A 3GPP AAA Server proxies the charging information received
from the WLAN AN over the Wa reference point (in a non-roaming case) or
charging information received from the 3GPP AAA Proxy Server located in a
visited network over the Wd reference point (in a roaming case) to the CDF
over the Wf reference point.
WLAN PDG: The CTF and CDF are integrated in the PDG; however, the CGF may
exist as a physically separate entity or integrated to the PDG. If the CGF is
external to the PDG, then the CDF forwards the CDRs to the CGF across the Ga
interface.
{width="4.354861111111111in" height="3.10625in"}
NOTE 1: This is a purely function architecture and it does not distinguish
between a roaming and non-roaming case.
NOTE 2: Any physical co-location of CGF, CDF and AAA Server / Proxy is
possible.
Figure 4.2: Functional WLAN offline charging architecture
The Diameter based Rf interface on which the Wf interfaces are based on is
described in 3GPP TS 32.299 [50].
## 4.3 WLAN online charging architecture
WLAN online charging based on the AAA and PDG functions utilise the Ro
interface (Wy reference point) and application as specified in 3GPP TS 32.299
[50]. The WLAN online charging architecture is depicted in figure 4.3.
{width="3.5652777777777778in" height="2.354861111111111in"}
NOTE: The online charging system is always a part of the subscriber\'s home
network.
**Figure 4.3: Functional WLAN online charging architecture**
The Ro reference point includes the functionality defined for the Gy reference
point (required for the TPF) in 3GPP TS 23.125 [70]. Refer to clause 5.2.1.3,
TS 32.240 [1] and TS 23.125 [70] for further details on FBC.
Details on the interfaces and functions can be found in 3GPP TS 32.240 [1] for
the general architecture components, 3GPP TS 32.296 [53] for the OCS, and TS
32.299 [50] for the 3GPP accounting and credit control application.
# 5 WLAN charging principles and scenarios
The following functionality and requirements have been identified for
charging:
\- The WLAN Access Network shall be able to report the WLAN access usage to
the appropriate 3GPP system (i.e. VPLMN in the roaming case and HPLMN in the
non-roaming case).
\- It shall be possible for the 3GPP system to control a specific ongoing WLAN
access session for online charging purposes.
\- It shall be possible for an operator to maintain a single prepaid account
for WLAN, PS, CS, and IMS for a user.
\- The 3GPP system shall be able to process the WLAN access resource usage
information, and convert it into the format used in 3GPP networks (e.g. CDR).
\- It shall be possible to correlate charging and accounting records generated
in WLAN Access related nodes and records generated in 3GPP nodes.
\- It shall be possible to apply offline charging and online charging
mechanisms for the WLAN interworking with 3GPP network.
Additionally, for WLAN 3GPP IP Access:
\- It shall be possible to generate per user charging information in the HPLMN
and in the VPLMN irrespective of whether the service is provided in the HPLMN
or in the VPLMN.
## 5.1 WLAN charging principles
WLAN charging comprises of: the WLAN Direct IP Access charging and WLAN 3GPP
IP Access charging. WLAN Direct IP Access charging is always on when a user is
connected to the WLAN Access Network. WLAN 3GPP IP Access charging is
performed only when 3G PS services are used.
The WLAN Direct IP Access offline charging is based on the charging
information received from the WLAN AN. In the roaming case the 3GPP AAA Proxy,
depending on the protocol at the Wa reference point, either forwards the
Accounting Requests over the Wd reference point or performs Radius-Diameter
translation. 3GPP AAA Proxy also translated and forwards the Accounting
Messages over the Wf reference point to the visited CDF. The 3GPP AAA Server
at the home network supports both Wa and Wd reference points for non-roaming
and roaming scenarios respectively. The 3GPP AAA Server may translate and
forward the Accounting Requests to the home CDF over the Wf reference point.
The Wa and Wd reference points and related protocol conversions are specified
in the 3GPP TS 29.234 [204]. Wf reference point is based on Rf interface
specified in 3GPP TS 32.299 [50].
The user is identified by MSISDN and IMSI, while a unique identifier generated
by the PDG (PDG Charging Id) is used to determine the bearer in PDG. PDG
Charging Id is also forwarded to the AAA server and AAA server is returning
unique WLAN Session Id so as to allow correlation of AAA server charging data
with the matching PDG charging data in the BD. The PDG shall use the Charging
Characteristics to determine charging profile to be used. The Charging
Characteristics contains the index to certain charging profile configured in
PDG. Multiple charging profiles may be configured on the PDG to allow
different sets of trigger values. The PDG should use W-APN Charging
Characteristics if available. If W-APN Charging Characteristics is not
available Subscribed Charging Characteristics should be used. If no Charging
Characteristics is available default charging profile shall be used.
Editor\'s Note: In case a WLAN UE accessing local services offered by the WLAN
AN and simultaneously establishing a connection to an external IP network via
its HPLMN network. In this scenario we assume that both the AAA server and the
PDG shall generate charging information . The WLAN AN shall report all the
traffic generated by the WLAN UE to the AAA server (i.e.: traffic to the local
connection in the WLAN AN and to the PDG) and the PDG shall report the
online/offline systems all the traffic routed so in this case: shall the
traffic routed through the PDG be charged twice?. How could this situation be
avoided?.
Editor\'s Note: SA5 SWG-B agrees that the following shall be replaced as
follows:\ Wo with Ro\ Wy with Ro\ Wf with Rf\ Wz & Gz with Ga
Editor\'s Note: Take input from 32.270. Remove all occurrences of protocols
from this specification.
Editor\'s Note: Include basic principles as described for PS from TS 32.251.
### 5.1.1 WLAN Direct IP Access charging
WLAN AN is responsible for generating per user charging data and monitoring
usage for WLAN Direct IP Access. Charging data is sent, possibly via 3GPP AAA
Proxy (roaming case) to the 3GPP AAA Server. The 3GPP AAA Server connects to
the appropriate charging system. In case of roaming, the 3GPP AAA Proxy sends
the charging information also to the CDF at the visited network for roaming
settlement purposes. WLAN Direct IP Access charging uses the capabilities of
the WLAN AN to report the uplink and downlink data volumes and the duration of
the session.
### 5.1.2 WLAN 3GPP IP Access charging
Packet Data Gateway is responsible for collecting and reporting usage of WLAN
3GPP IP Access. PDG shall collect charging information like session usage
times and data volumes. PDG shall report charging information per user and per
bearer (per connection). Furthermore, to be able to report charging
information per service data flow or per rating group, Flow Based Charging
(FBC) is supported by the PDG by the integration of a TPF, see 3GPP TS 23.125
[71].
Charging rules for FBC may be pre-defined in TPF or dynamically provisioned to
the TPF over Gx reference point.
Editor\'s Note: The role of the WAG for end user charging is TBD. Potentially
it is only used by the visited network to identify the amount of data relayed
between the WLAN AN and the HPLMN and used for roaming settlement. Note that
the charging information from the WLAN AN does not differentiate the user data
transferred between the WLAN AN and PDG and between the WLAN AN and IP network
directly connected to the WLAN AN. Hence, WLAN AN information can not be used
to identify how much data the VPLMN has relayed.
Editor\'s Note: It is necessary to verify if the proposed correlation
mechanism would work in case the WLAN UE establishes several simultaneous
Ipsec tunnels against the same or different PDGs (connections to different IP
networks requesting different WAPNs): How shall the AAA server differentiate
the charging data from the WLAN AN and associate it with the correct charging
identifier received from the PDGs for each WAPN?.
Editor\'s Note: Procedure needs to be verified from CN4. The following
description needs to be clarified: Correlation of PDG and WLAN AN charging
data is enabled by exchanging correlation identifiers. When the PDG requests
tunnel authorisation over the Wm reference point, it sends the PDG Charging
Identifier to the 3GPP AAA Server. In the response the 3GPP AAA Server sends
the WLAN Session ID back to the PDG. PDG includes the WLAN Session ID to the
PDG charging data. 3GPP AAA Server includes the PDG Charging Identifier to the
WLAN AN charging data.
## 5.2 WLAN offline charging scenarios
### 5.2.1 Basic principles
#### 5.2.1.1 Direct IP Access
Editor\'s Note: Detail the chargeable events here as for 3GPP IP Access below.
Offline charging protocol conversions and related functionality are
illustrated in the figures 5.2.1 and 5.2.2.
Figure 5.2.1: Offline Charging Accounting Requests - Wa based on Radius
Figure 5.2.2: Offline Charging Accounting Requests - Wa based on Diameter.
Editor\'s Note: The physical mapping of CDF / CGF and the supported
configurations are for further study. Options are to integrate CDF and CGF
(implementing only Wf interface) or to integrate 3GPP AAA Server/Proxy and CDF
(implementing Ga-like interface towards CGF), or to integrate 3GPP AAA
Server/Proxy, CDF and CGF (typical AAA infrastructure deployment).
#### 5.2.1.2 3GPP IP Access
When 3GPP IP Access is used, PDG is collecting and reporting charging data.
The following chargeable events are defined for PDG:
\- Start of bearer in PDG. Upon encountering this event, a new WLAN-CDR for
this context is created.
\- Start of service data flow. A volume count for this service data flow is
started if service data flow specific reporting is required. If rating group
specific reporting is required a new volume count is started only if this is
the first service data flow using that specific rating group.
\- Termination of service data flow. If reporting is done per service data
flow, the service data flow volume counters are closed. If reporting is done
per rating group the volume counters are closed only if this is the last
service data flow using that particular rating group.
\- End of bearer in the PDG. The WLAN-CDR is closed upon encountering this
trigger.
\- Expiry of an operator configured time limit for bearer. This event closes
the WLAN-CDR, and a new one is opened if the bearer is still active.
\- Expiry of an operator configured data volume limit for bearer. This event
closes the WLAN-CDR, and a new one is opened if the bearer is still active.
\- Change of charging condition: e.g. tariff time change. When this event is
encountered, all current volume counts are captured and new volume counts for
all active service data flows are started.
\- Expiry of an operator configured container limit per CDR. This event closes
the WLAN-CDR, and a new one is opened if the bearer is still active.
Management intervention may also force trigger a chargeable event.
### 5.2.2 Wf message flows
The flows described in the present document specify the charging
communications between WLAN access network and the CDF for different charging
scenarios.
#### 5.2.2.1 Message Flows - WLAN session when WLAN access network supports
accounting
Figure 5.2.2.1 shows the Charging Data transactions that are required between
3GPP AAA server and CDF during a WLAN session were the WLAN access network
support RADIUS or Diameter accounting.
Figure 5.2.2.1: Message Sequence Chart for WLAN session when WLAN AN supports
accounting
Editors Note: Change names on 3GPP AAA server to CDF messages.
1\. The WLAN UE establishes a WLAN session.
2\. The WLAN access networks starts accounting with a charging data start
request.
3\. The 3GPP AAA converts the accounting request to a Charging Data request
message and sends it to CDF.
4\. CDF opens a WLAN CDR with information in the Charging Data request
message.
5\. CDF acknowledges the Charging Data request with a Charging Data response
message.
6\. 3GPP AAA server converts the Charging Data response message to charging
data answer message. It sends the accounting answer to the WLAN access
network.
7\. The WLAN access networks updates accounting with a charging data interim
request.
8\. The 3GPP AAA server converts the charging data message to a Charging Data
request message sends it to CDF.
9\. CDF updates the WLAN CDR with information in the Charging Data request
message.
10\. CDF acknowledges the Charging Data request with a Charging Data response
message.
11\. 3GPP AAA server converts the Charging Data response message to charging
data answer message. It sends the accounting answer to the WLAN access
network.
12\. The WLAN access networks stops accounting with a charging data stop
request.
13\. The 3GPP AAA server converts the accounting message to a Charging Data
request message send it to CDF
14\. CDF updates the WLAN CDR with information in the Charging Data request
message. CDF also closes the CDR.
15\. CDF acknowledges the Charging Data request with a Charging Data response
message.
16\. 3GPP AAA server converts the Charging Data response message to accounting
answer message. It sends the accounting answer to the WLAN access network.
NOTE: There can be more then one interim accounting transactions within a WLAN
session. CDF/3GPP AAA server defines the interim report interval.
#### 5.2.2.2 Message Flows - WLAN session when WLAN access network does not
support accounting
Figure 5.2.2.2 shows the Charging Data transactions that are required between
3GPP AAA server and CDF during a WLAN session when the WLAN access network
doesn\'t support RADIUS or Diameter accounting.
Figure 5.2.2.2: Message Sequence Chart for WLAN session when WLAN AN don\'t
support accounting
1\. The WLAN UE establishes a WLAN session.
2\. The 3GPP AAA generates a Charging Data request message based on
information from authentication/authorization and sends it to CDF.
3\. CDF opens a WLAN CDR with information in the Charging Data Request
message.
4\. CDF acknowledges the Charging Data request with a Charging Data response.
5\. The 3GPP AAA server generates an Charging Data request stop message based
on session end information from WLAN AN and send it to CDF.
6\. CDF updates the WLAN CDR with information in the Charging Data request
message. CDF also closes the CDR.
7\. CDF acknowledges the Charging Data request with a Charging Data response.
NOTE: In this case will up/down link volume counters not be present in the
CDRs.
### 5.2.3 WLAN-AN-CDR generation
In Direct IP Access Charging CDF/CGF generates WLAN-AN-CDR to collect charging
information.
Charging profile includes information whether CDR generation is activated. If
CDR generation is activated, WLAN‑AN-CDRs are generated for the Direct IP
Access session based on the Accounting-Messages originated from the WLAN AN.
WLAN-AN-CDR is generated upon session termination. Intermediate WLAN-AN-CDRs
may be generated upon an arrival of an intermediate Accounting-Message for a
session. It shall be possible to define separate trigger conditions values per
charging profile for WLAN-AN-CDR generation for the following triggers:
\- Upon each intermediate Accounting-Message.
\- Upon intermediate Accounting-Message when data volume limit is exceeded.
\- Upon intermediate Accounting-Message when time limit (duration) is
exceeded.
Editor\'s Note: Whether CDRs may be generated by CDF, CGF or both is FFS. If
Ga interface is omitted, the combined CDF/CGF generates the CDR files.
### 5.2.4 WLAN-CDR generation
In 3GPP IP Access Charging PDG generates WLAN-CDR to collect charging
information that is subsequently transferred to the Charging Gateway Function
(CGF).
Charging profile includes information whether CDR generation is activated. If
CDR generation is activated, it shall be possible to define separate trigger
conditions values per charging profile for the following triggers:
\- data volume limit for the bearer (i.e. for the mirror SDF);
\- time (duration limit) for the bearer (i.e. for the mirror SDF);
\- maximum number of containers.
The following clauses describe the trigger conditions for the chargeable
events described in clause 5.2.1. In 3GPP IP Access offline charging, these
chargeable events correspond to the triggers for collection of charging
information and WLAN-CDR generation by the PDG.
#### 5.2.4.1 Triggers for WLAN-CDR charging information collection
WLAN-CDR is used to collect charging information related to the 3GPP IP Access
connection for a UE in the PDG, where the data volumes within each WLAN-CDR
are separately counted per defined service data flow or rating group.
Many \"List of Service Data Volumes\" containers per bearer can be active
simultaneously and each container includes charging data of one particular
service data flow or several service data flows belonging to the same rating
group. A new container is activated when traffic for a defined service data
flow or new rating group is detected. A container is closed when the
termination of the service data flow is detected and reporting is per service
data flow. If reporting is per rating group, service data volume container is
closed only if this is the last service data flow using that particular rating
group.
If, according to the Charging Characteristics, CDR generation is activated a
WLAN-CDR shall be opened at bearer activation. When a change of charging
condition occurs, all service data flow volume counts are added to the WLAN-
CDR and new counts are started.
The subsequent clauses identify in detail the conditions for adding
information to, and closing the WLAN-CDR for delivery towards the CGF.
##### 5.2.4.1.1 Triggers for WLAN-CDR Charging Information Addition
The \"List of Service Data Volumes\" attribute of the WLAN-CDR consists of a
set of containers. Each container includes volume counters per a service data
flow or per rating group. Each container identifies the volume count within
the same bearer separated for uplink and downlink. Figure 5.2.4.1.1
identifies, which conditions are supported to trigger WLAN-CDR charging
information addition.
Table 5.2.4.1.1: Triggers for WLAN-CDR charging information addition
* * *
Trigger Conditions Description/Behaviour Tariff Time Change On reaching the
Tariff Time Change a set of \"List of Service Data Volumes\" containers, i.e.
all containers, shall be added to the CDR. Service data flow Change A \"List
of Service Data Volumes\" container is closed when termination of service data
flow is detected and reporting is per service data flow. If reporting is per
rating group \"List of Service Data Volumes\" container is closed only if this
was the last service data flow for that rating group. CDR Closure All active
\"List of Service Data Volumes\" containers shall be added to the WLAN-CDR.
* * *
##### 5.2.4.1.2 Triggers for WLAN-CDR closure
The WLAN-CDR shall be closed on encountering some trigger conditions. Table
5.2.4.1.2 identifies which conditions are supported to permit closure of the
WLAN-CDR.
Table 5.2.4.1.2: Triggers for WLAN-CDR closure
+------------------------------+--------------------------------------+ | Closure Conditions | Description/Behaviour | +------------------------------+--------------------------------------+ | End of bearer within the PDG | Deactivation of the bearer shall | | | result the CDR being closed. The | | | trigger condition covers: | | | | | | > \- termination of bearer; | | | > | | | > \- any abnormal release. | +------------------------------+--------------------------------------+ | Partial Record Reason | O&M reasons permit the closure of | | | the CDR for internal reasons. The | | | trigger condition covers: | | | | | | > \- data volume limit for the | | | > bearer; | | | > | | | > \- time (duration) limit for the | | | > bearer; | | | > | | | > \- maximum number of containers; | | | > | | | > \- management intervention. | +------------------------------+--------------------------------------+
The Partial Record generation trigger thresholds are those associated with the
Charging Characteristics. The Partial Record generation trigger thresholds are
PDG configuration parameters defined per charging profile by the operator
through O&M means. Data volume and time limit trigger thresholds are for the
mirror SDF only i.e. for the bearer.
In the event that the WLAN-CDR is closed and the PDP context remains active, a
further WLAN-CDR is opened with an incremented Sequence Number in the WLAN.
All containers, which were open when WLAN-CDR was closed, shall be re-created
only when traffic for certain service data flow or rating group is detected
next time.
### 5.2.5 Ga record transfer flows
Editor\'s note: It is FFS whether Ga interface is used for WLAN Direct IP
Access charging.
In PDG, both fully qualified partial WLAN-CDR (FQPC) and reduced partial WLAN-
CDR (RPC), as specified in 3GPP TS 32.240 [1] may be supported on the Ga
interface. The support of FQPCs is mandatory and the support of RPCs is
optional. For further details on the Ga protocol application refer to 3GPP TS
32.295 [54].
### 5.2.6 B~w~ CDR file transfer
Editor\'s note: It is FFS.
## 5.3 WLAN online charging scenarios
### 5.3.1 Basic principles
Editor\'s note: This clause should be moved into clause 5.1.
Editor\'s note: The description below doesn\'t allow volume based online
charging.
The WLAN Direct IP Access online charging is to be based on Authentication-
Authorisation (AA) Requests and quota allocation mechanism. . The AA-Requests
are terminated at the home 3GPP Server. Home 3GPP Server initiates Diameter
Credit Control procedures over Wo reference point as defined 3GPP TS 32.299
[50].
Editor\'s Note: The AA messaging based online charging mechanism would require
that WLAN AN implements RADIUS prepaid extensions (only valid in figure
5.3.1.1, no Diameter prepaid extensions available in figure 5.3.1.2) or
similar functionality thus imposes requirements to WLAN domain. If such
requirements can not be imposed, the online charging mechanism needs to be
based on the accounting requests used in offline charging. This means that
reliable and credit risk free online charging can not be implemented.
Editor\'s Note: The Diameter AA-application selection for Wd is defined in
CN4. Diameter EAP is assumed.
Editor\'s note: The correlation of charging information is a valid point for
both, offline and online charging scenarios and should be described in the
basic principles.
Editor\'s note: However, the procedure description below (same as in offline
charging) cannot be applied in online charging (remove this note when deleting
the text in deleted clause 5.3.2.1).
Online charging protocol conversions and related functionality are illustrated
in figures 5.3.1.1 and 5.3.1.2.
Figure 5.3.1.1: Online Charging AA-Requests - Wa based on Radius
Figure 5.3.1.2: Online Charging AA-Requests - Wa based on Diameter
Editor\'s Note: The Diameter Credit Control Application (CCA) proposes a
mechanism for Radius - NASREQ conversion. This should be clarified!
Editor\'s note: The figures 5.3.1.1 and 5.3.1.2 reflect not all possible
protocol options.
When 3GPP IP Access is used, PDG is collecting and reporting charging data.
3GPP IP Access online charging is performed in the PDG using the common Ro
based credit control application specified in 3GPP TS 32.299 [50] when the PDG
is located in the HPLMN (in the non-roaming case as described in figure 4.1.2
or in the roaming case with 3GPP PS based services provided via the 3GPP home
network as described in figure 4.1.3).
Access online charging is performed using Wm, Wd & Wo as described in figure
5.3.1.3 when the PDG is located in the VPLMN (in the roaming case with 3GPP PS
based services provided via the 3GPP visited network as described in figure
4.1.4).
Figure 5.3.1.3: Online Charging AA-Requests from PDG -- Roaming reference
model - 3GPP PS based services provided via the 3GPP Visited Network
Only session based online charging (SCUR) is required in the PDG. The Credit
Control Requests (CCR) and Credit Control Answers (CCA) specified for SCUR in
3GPP TS 32.299 [50] (initial/update/termination) are issued towards the OCS /
received from the OCS when certain conditions (chargeable events) are met. The
PDG specific contents and purpose of each of these messages, as well as the
chargeable events that trigger them, are described in the following clauses.\
A detailed formal description of the online charging parameters defined in the
present document is to be found in 3GPP TS 32.299 [50]. Further information on
the general principles of the common 3GPP online charging application can also
be found in 3GPP TS 32.299 [50] and 3GPP TS 32.240 [1].
The following chargeable events are defined for PDG:
\- Start of bearer. Upon encountering this event, a CCR initial, indicating
the start of the bearer, is sent towards the OCS.
\- Start of service data flow. If no appropriate OCS granted quota is
available, a CCR update is sent towards the OCS. The service data flow is
allowed only if there is granted quota, otherwise service data flow is not
allowed.
\- End of bearer. Upon encountering this event, a CCR termination, indicating
the end of the bearer, is sent towards the OCS together with the final used
units.
\- Expiry of certain usage limit for the DCC session set by OCS: e.g. Validity
Time or Time Quota Threshold. When this event is encountered, all current unit
counts are captured and sent towards the OCS with a CCR update.
\- Change of charging condition: Re-authorisation trigger is met. When this
event is encountered, all current unit counts are captured and sent towards
the OCS with a CCR update.
\- Change of charging condition: Tariff time change. When this event is
encountered, all current unit counts are captured. Sending CCR Update
immediately after tariff time change is not required, see TS 32.299 [50].
Management intervention may also force trigger a chargeable event.
### 5.3.2 Wo message flows
The flows described in the present document specify the charging
communications between WLAN access network and the OCS for different charging
scenarios.
#### 5.3.2.1 Message Flows - WLAN session were WLAN access network support
Diameter Credit Control
Figure 5.3.2.1 shows the Diameter transactions that are required between 3GPP
AAA server and OCS during a WLAN session were the WLAN access network support
Diameter Credit Control Application.
Figure 5.3.2.1: Message Sequence Chart for WLAN session when WLAN AN support
DCC
1\. The WLAN UE request a WLAN session.
2\. The WLAN access networks starts a Diameter Credit Control session with the
3GPP AAA server.
3\. The 3GPP AAA starts a Reserve Unit session with OCS based on the Credit
Control Request.
4\. OCS performs credit control (rating/reservation of quota).
5\. OCS replies with a Reserve Unit Response with a quota (if granted by OCS).
6\. 3GPP AAA replies to the WLAN access network with a CCA.
7\. If OCS granted quota then WLAN access network will grant the WLAN session.
8\. When the quota has expired then WLAN access network send a new CCR for
reserving more quota to 3GPP AAA server.
9\. The 3GPP AAA sends a Reserve Unit Request message, based on the Credit
Control Request, to OCS.
10\. OCS performs credit control (rating/reservation of quota).
11\. OCS replies with a Reserve Unit Response with a quota (if granted by
OCS).
12\. 3GPP AAA replies to the WLAN access network with a CCA.
13\. When the WLAN session ends, then WLAN access network send a CCR (stop) to
the 3GPP AAA server.
14\. The 3GPP AAA sends a Reserve Unit Request message, based on the Credit
Control Request, to OCS.
15\. OCS performs credit control (updates the account/return back unused
quota).
16\. OCS replies with a Reserve Unit Response.
17\. 3GPP AAA replies to the WLAN access network with a CCA.
NOTE: There can be more then one DCC update transactions within a WLAN
session. OCS defines the update report interval depending on the reserved
quota.
#### 5.3.2.2 Message Flows - WLAN session were WLAN access network support
RADIUS/Diameter accounting (version 1)
Figure 5.3.2.2 shows the Diameter transactions that are required between 3GPP
AAA server and OCS during a WLAN session were the WLAN access network support
RADIUS/Diameter Accounting.
NOTE 1: the 3GPP AAA server always has a possibility to stop a WLAN session
based on requirements on the Wa interface. This functionality can be useful in
an online charging case when the user is running out of credit.
NOTE 2: The proposed solution must be further investigated if session timeout
can be handled in this way or if it must be art of the
authentication/authorization command.
NOTE 3: This solution only support credit control when charging is based on
time. Charging based on volume is also possible, but credit control will not
be fully possible. The credit risk can be decreased if short time reservations
are used.
Figure 5.3.2.2: Message Sequence Chart for WLAN session when WLAN AN support
Accounting
1\. The WLAN UE request a WLAN session.
2\. The WLAN access networks starts an accounting session with the 3GPP AAA
server.
3\. The 3GPP AAA initiates a Reserve Unit Request message to OCS.
4\. OCS performs credit control (rating/reservation of quota).
5\. OCS replies with a Reserve Unit Response with a quota (if granted by OCS).
6\. 3GPP AAA server acknowledges the accounting session to WLAN access
network.
7\. 3GPP AAA server set the session timeout (and termination action to new
request) for the WLAN session based on the time quota assigned by OCS.
8\. WLAN access network re-authenticates when the timeout has expired.
9\. WLAN access network also send an interim ACA to 3GPP AAA server.
10\. Based in the ACA and re-authentication messages, AAA server prepares a
new Reserve Unit Request and sends it to OCS.
11\. OCS performs credit control (rating/reservation of quota).
12\. OCS replies with a Reserve Unit Response with a quota (if granted by
OCS).
13\. 3GPP AAA server acknowledges the accounting session to WLAN access
network.
14\. 3GPP AAA server set the session timeout (and termination action to new
request) for the WLAN session based on the time quota assigned by OCS.
15\. When the WLAN session ends, then WLAN access network send a ACR (stop) to
the 3GPP AAA server.
16\. The 3GPP AAA server prepares a Reserve Unit Request message with
information from the ACR and sends it to OCS.
17\. OCS performs credit control (updates the account/return back unused
quota).
18\. OCS replies with a Reserve Unit Response message as acknowledgement.
19\. 3GPP AAA server acknowledges the accounting session with an ACA.
NOTE: There can be more then one Reserve Unit update transactions within a
WLAN session. OCS defines the interim report interval depending on the
reserved quota.
#### 5.3.2.3 Message Flows - WLAN session were WLAN access network support
RADIUS/Diameter accounting (version 2)
Figure 5.3.2.3 shows the Diameter transactions that are required between 3GPP
AAA server and OCS during a WLAN session were the WLAN access network support
RADIUS/Diameter Accounting.
NOTE 1: The 3GPP AAA server always has a possibility to stop a WLAN session
based on requirements on the Wa interface. This functionality can be useful in
an online charging case when the user is running out of credit.
NOTE 2: This solution only support credit control when charging is based on
time. Charging based on volume is also possible, but credit control will not
be fully possible. The credit risk can be decreased if short time reservations
are used.
Figure 5.3.2.3: Message Sequence Chart for WLAN session when WLAN AN support
Accounting
1\. The WLAN access networks starts authentication/authorization with the 3GPP
AAA server.
2\. The 3GPP AAA initiates a Reserve Unit Request to OCS.
3\. OCS performs credit control (rating/reservation of quota).
4\. OCS replies with a Reserve Unit Response with a quota (if granted by OCS).
5\. 3GPP AAA server responses to the WLAN access network for
authentication/authorization with a session timeout (and termination action to
new request) based on the reserved quota.
6\. WLAN access network starts an accounting session.
7\. 3GPP AAA servers acknowledge the accounting message.
8\. WLAN access network re-authenticates when the timeout has expired.
9\. Based on the re-authentication messages, AAA server prepares a new Reserve
Unit Request message and sends it to OCS.
10\. OCS performs credit control (rating/reservation of quota).
11\. OCS replies with a Reserve Unit Response message with a quota (if granted
by OCS).
12\. 3GPP AAA server responses to the WLAN access network for
authentication/authorization with a session timeout (and termination action to
new request) based on the reserved quota.
13\. WLAN access network sends an accounting interim report to 3GPP AAA
server.
14\. 3GPP AAA servers acknowledge the accounting message.
15\. When the WLAN session ends, then WLAN access network send an ACR (stop)
to the 3GPP AAA server.
16\. The 3GPP AAA server prepares a Reserve Unit Request message with
information from the ACR and sends it to OCS.
17\. OCS performs credit control (updates the account/return back unused
quota).
18\. OCS replies with a Reserve Unit Response message as acknowledgement.
19\. 3GPP AAA server acknowledges the accounting session with an ACA.
NOTE: There can be more then one Reserve Unit update transactions within a
WLAN session. OCS defines the interim report interval depending on the
reserved quota.
#### 5.3.2.4 Message Flows - WLAN session were WLAN access network don\'t
support RADIUS/Diameter accounting
Figure 5.3.2.4 shows the Diameter transactions that are required between 3GPP
AAA server and OCS during a WLAN session were the WLAN access network don\'t
support RADIUS/Diameter Accounting.
NOTE 1: This solution only support online charging when the charging model is
based on time. The WLAN user can be over charged because 3GPP AAA server and
OCS will never know when the WLAN session ends. OCS will stop change when the
last re-authentication timeout has expired.
Figure 5.3.2.4: Message Sequence Chart for WLAN session\ when WLAN AN do not
support Accounting
1\. The WLAN access networks starts authentication/authorization with the 3GPP
AAA server.
2\. The 3GPP AAA initiates a Reserve Unit Request to OCS.
3\. OCS performs credit control (rating/reservation of quota).
4\. OCS replies with a Reserve Unit Response message with a quota (if granted
by OCS).
5\. 3GPP AAA server responses to the WLAN access network for
authentication/authorization with a session timeout (and termination action to
new request) based on the reserved quota.
6\. WLAN access network re-authenticates when the timeout has expired.
7\. Based on the re-authentication messages, AAA server prepares a new Reserve
Unit Request and sends it to OCS.
8\. OCS performs credit control (rating/reservation of quota).
9\. OCS replies with a Reserve Unit Response with a quota (if granted by OCS).
10\. 3GPP AAA server responses to the WLAN access network for
authentication/authorization with a new session timeout (and termination
action to new request) based on the reserved quota.
11\. When the authentication timeout expires and new re-authentication has
been performed, then the WLAN session will be handled as closed.
12\. The 3GPP AAA server prepares a Reserve Unit Request (stop), with used
units as the authentication timeout, and sends it to OCS.
13\. OCS performs credit control (updates the account/return back unused
quota).
14\. OCS replies with a Reserve Unit Response as acknowledgement.
NOTE 2: There can be more then one interim DCC transactions within a WLAN
session. OCS defines the interim report interval depending on the reserved
quota.
NOTE 3: To be sure that the WLAN session ends when the Authentication Lifetime
expires, the 3GPP AAA server can stop the session over the Wa interface.
Editor\'s Note: Add flow for PDG - OCS.
# 6 Definition of charging information
## 6.1 Data description for WLAN offline charging
### 6.1.1 Rf message contents
The WLAN nodes generate accounting information that can be transferred from
the CTF to the CDF. For this purpose, WLAN offline charging utilises the
_Charging Data Transfer_ operation that is specified in the 3GPP accounting
application in 3GPP TS 32.299 [50].
### 6.1.1.1 WLAN Direct IP Access Charging message contents
The accounting message contents at Wa and Wd reference points are specified in
3GPP TS 29.234 [204].
The accounting information exchanged on the interface (Wf reference point)
shall be the same as specified in 3GPP TS 32.299 [50] (reference point Rf).
The Wf reference point shall transport the accounting Information Elements
arriving over the Wa/Wd reference point. If the Wa/Wd reference point is
RADIUS based, the RADIUS accounting messages and Information Elements shall be
translated to Diameter accounting messages AVPs as defined in RFC 3588 [401]
and in RFC 4005 [404]. If Wa/Wd reference point is Diameter incoming messages
shall be passed on.
Editor\'s Note: When Wf interface is based on the Rf interface, it is FFS if
there is a need for Diameter - Diameter translation. Alternatively, Wf could
be based on Wa/Wd.
The _Charging Data Transfe_ r operation employs the _Charging Data Request_
and _Charging Data Response_ messages. Table 6.1.1.1 describes the use of
these messages in WLAN direct IP access offline charging.
Table 6.1.1.1: Offline Charging Messages Reference Table
* * *
Message Source Destination _Charging Data Request_ WLAN AN CDF _Charging Data
Response_ CDF WLAN AN
* * *
##### 6.1.1.1.1 _Charging Data_ Request Message
Table 6.1.1.1.1 illustrates the basic structure of the _Charging Data Request_
message as used for WLAN direct IP access offline charging.
Table 6.1.1.1.1: Charging Data Request Message Contents
* * *
Field Category Description Session Identifier M This field identifies the
operation session. Originator Node-Id M This field contains the identification
of the source point of the operation and the realm of the operation
originator. Originator Domain M This field contains the realm of the operation
originator. Operation Type M This field defines the transfer type: event for
event based charging and start, interim, stop for session based charging.
Operation Number M This field contains the sequence number of the transferred
messages. Operation Token O~M~ This field identifies the domain, subsystem or
service and release. Service Information OM This field holds the 3GPP specific
WLAN parameter.
* * *
##### 6.1.1.1.2 Charging Data Response Message
Table 6.1.1.1.2 illustrates the basic structure of a _Charging Data Response_
message as used for WLAN direct IP access offline charging.
Table 6.1.1.1.2: Charging Data Response Message
* * *
Field Category Description Session Identifier M This field identifies the
operation session. Result
* * *
### 6.1.2 GTP\' message contents
GTP\' is used between CDF and CGF on Wz reference point.
Editor\'s note: more description needed
### 6.1.3 CDR Description on the Bw Interface
Dedicated types of CDRs can be generated in the service domain for WLAN by the
WLAN AN/PDG/AAA Servers. The content of each CDR type is defined in one of the
tables that are part of this clause. For each CDR type the parameter
definition includes the parameter name, description and category.
#### 6.1.3.1 CDR Field Types
The following Standard CDR content and format are considered:
  * WLAN-AN-CDR generated based on information from the WLAN AN handled > by 3GPP AAA Server.
  * WLAN-PDG-CDR generated based on information from the PDG.
The content of each CDR type is defined in the tables 6.1.3.2.1 and 6.1.3.2.2.
For each CDR type the field definition includes the field name, category and
description. The CDF provides the CDRs at the Bw interface in the format and
encoding described in 3GPP TS 32.298 [51]. Additional CDR formats and contents
may be available at the interface to the billing system to meet the
requirements of the billing system, these are outside of the scope of 3GPP
standardisation.
#### 6.1.3.2 CDR Content
Editor\'s Note: Contents of the CDRs are for further study.
##### 6.1.3.2.1 WLAN Direct IP Access CDR (WLAN-AN-CDR)
NOTE: This CDR should contain a WLAN-Radio-Container as defined in \"WLAN
Information\".
Table 6.1.3.2.1 WLAN Direct IP Access CDR (WLAN-AN-CDR)
* * *
Field Category Description
Record Type M WLAN Direct IP Access CDR
Record Sequence Number C Partial record sequence number. Only present in case
of partial records
Served IMSI M IMSI of the served party
Served IMEI C The IMEI of the ME, if available
Operator Name M Hot Spot Operator Name as defined in IETF RFC 5580 [405]
Location Information C Location information regarding the hotspot operator as
defined in IETF RFC 5580 [405]
Location Data C Location data regarding the hotspot operator as defined in
IETF RFC 5580 [405]
Charging ID M Accounting Session-ID from WLAN AN
NAS Port C NAS Port of WLAN AN
NAS Port-Id C NAS Port-Id of WLAN AN
NAS Port Type C NAS-Port-Type of WLAN AN
NAS-IP address C IPv4 address of the hot-spot
NAS-Ipv6 address C IPv6 address of the hot-spot
Local IP Address OC Local IP address of the served IMSI, i.e. IPv4 or IPv6
Data Volume Downlink C Downlink data volume for WLAN UE
Data Volume Uplink C Uplink data volume for WLAN UE
Record Opening Time M Time stamp when WLAN session is activated or record
opening time on subsequent partial records
Local Record Sequence Number OM Consecutive record number created by this
node. The number is allocated sequentially including all CDR types
Duration M Duration of this record
Cause for Record Closing M The reason for closure of the record
Node ID OM Name of the recording entity
Service Context Id O~M~ Holds the context information to which the CDR
belongs. The information is obtained from the Operation Token of the Charging
Data Request message
Record Extensions OC A set of network operator/manufacturer specific
extensions to the record\ Conditioned upon the existence of an extension
* * *
##### 6.1.3.2.2 WLAN 3GPP IP Access charging message contents
The content of WLAN 3GPP IP Access CDR is defined in the table 6.1.3.2.2. The
field definition includes the field name, category and description. The
detailed field descriptions are provided in 3GPP TS 32.298 [51].
If the collection of CDR data is enabled then the PDG shall make available the
following data available for each WLAN 3GPP IP Access connection.
Table 6.1.3.2.2 : Wz interface CDR content (WLAN-CDR)
* * *
Field Category Description Record Type M WLAN PDG record. Served IMSI M IMSI
of the served party. Served MSISDN OM The primary MSISDN of the subscriber.
PDG Address used M IP address of the PDG used. Node ID OM Name of the
recording entity. Serving WAG Address M Serving WAG address used during this
record. WAG PLMN Identifier OM WAG PLMN Identifier (MCC and MNC) used during
this record. Serving AAA Server/proxy Address M Serving AAA Server/Proxy
address. WLAN UE remote IP address OC  
WLAN UE Local IP address OC  
Charging ID M PDG charging identifier used to correlate WLAN AN generated
information to PDG generated information WLAN session id M WLAN session
identifier used to correlate WLAN AN generated information to PDG generated
information Access Point Name Network Identifier OM The logical name of the
connected access point to the external packet data network (network identifier
part of APN). Charging Characteristics? M The Charging Characteristics applied
to the PDP context.? Charging Characteristics Selection Mode? OM Holds
information about how Charging Characteristics were selected. Record Opening
Time M Time stamp when End-to-end Tunnel is activated in this PDG? or record
opening time on subsequent partial records. Duration M Duration of this record
in the PDG. Cause for Record Closing M The reason for the release of record
from this PDG. Record Sequence Number C Partial record sequence number, only
present in case of partial records. Local Record Sequence Number OM
Consecutive record number created by this node. The number is allocated
sequentially including all CDR types. Diagnostics OM A more detailed reason
for the release of the connection. Record Extensions OC A set of network
operator/manufacturer specific extensions to the record. Conditioned upon the
existence of an extension.
* * *
## 6.2 Data description for WLAN online charging
Editor\'s Note: To be completed
### 6.2.1 Ro message contents
#### 6.2.1.1 WLAN Direct IP Access Charging message contents
The WLAN nodes generate debit/reserve unit information that can be transferred
from the CTF to the OCF. For this purpose, WLAN online charging utilises the
_Debit Unit and Reserve Unit_ procedure that is specified in the 3GPP credit
control application in 3GPP TS 32.299 [50].
The _Debit/Reserve Unit_ procedure employs the _Debit/Reserve Unit Request_
and _Debit/Reserve Unit Response_ messages. Table 6.2.1.1 describes the use of
these messages in WLAN Direct IP Access online charging.
Table 6.2.1.1: Online Charging Messages Reference Table
* * *
Command-Name Source Destination Debit/Reserve Unit Request 3GPP AAA Server OCS
Debit/Reserve Unit Response OCS 3GPP AAA Server
* * *
##### 6.2.1.1.1 Debit/Reserve Unit Request message
Table 6.2.1.1.1 illustrates the basic structure of the _Debit/Reserve Unit
Request_ message as used for WLAN direct IP access online charging.
Table 6.2.1.1.1: Debit/Reserve Units Request Content
+----------------------------+----------+----------------------------+ | Debit/Reserve Units | Category | Description | | Request | | | +----------------------------+----------+----------------------------+ | Session Identifier | M | This field identifies the | | | | operation session. | +----------------------------+----------+----------------------------+ | Originator Node-Id | M | This field contains the | | | | identification of the | | | | source point of the | | | | operation. | +----------------------------+----------+----------------------------+ | Originator Domain | M | This field contains the | | | | realm of the operation | | | | originator. | +----------------------------+----------+----------------------------+ | Operation Token | M | This field is an unique | | | | operation identifier. | +----------------------------+----------+----------------------------+ | Operation Type | M | This field defines the | | | | transfer type: event for | | | | event based charging and | | | | start, interim, stop for | | | | session based charging. | +----------------------------+----------+----------------------------+ | Operation Number | M | This field contains the | | | | sequence number of the | | | | transferred messages. | +----------------------------+----------+----------------------------+ | Subscriber Address | OC | This field contains the | | | | identification of the | | | | mobile subscriber (i.e. | | | | MSISDN) that uses the | | | | requested service. | +----------------------------+----------+----------------------------+ | Service Token | OC | This field is a unique | | | | service identifier. | +----------------------------+----------+----------------------------+ | Cause of Termination | OC | This field contains the | | | | termination reason of the | | | | service. | +----------------------------+----------+----------------------------+ | Service Units Requested | OC | This field contains the | | | | amount of requested | | | | service units. | +----------------------------+----------+----------------------------+ | Service Units Used | OC | This field contains the | | | | amount of used service | | | | units. | +----------------------------+----------+----------------------------+ | Multiple Operation | OC | This field indicate the | | | | occurrence of multiple | | | | operations. | +----------------------------+----------+----------------------------+ | Multiple Unit Operation | OC | This field contains the | | | | parameter for the quota | | | | management. | +----------------------------+----------+----------------------------+ | Subscriber Equipment | OC | This field contains the | | Number | | identification of the | | | | mobile device (i.e. IMEI) | | | | that uses the subscriber. | +----------------------------+----------+----------------------------+ | Service Information | OM | This field holts | | | | additional 3GPP service | | | | specific parameter: | | | | | | | | > \- PS Information; | | | | > | | | | > \- WLAN Information; | | | | > | | | | > \- IMS Information; | | | | > | | | | > \- LCS Information; | | | | > | | | | > \- PoC Information; | | | | > | | | | > \- MBMS Information. | +----------------------------+----------+----------------------------+
#### 6.2.1.1.2 Debit/Reserve Unit Response message
Table 6.2.1.1.2 illustrates the basic structure of the _Debit/Reserve Unit
Response_ message as used for WLAN direct IP access online charging.
Table 6.2.1.1.2: Debit/Reserve Units Response Content
* * *
Debit/ Reserve Units Response Category Description Session Identifier M This
field identifies the operation session. Operation Result M This field
identifies the result of the operation. Originator Node-Id M This field
contains the identification of the source point of the operation. Originator
Domain M This field contains the realm of the operation originator. Operation
Type M This field defines the transfer type: event for event based charging
and start, interim, stop for session based charging. Operation Number M This
field contains the sequence number of the transferred messages. Service Units
Granted OC This filed contains the amount of used service units. Unit Validity
Time OC This field contains the time for the validity of the granted service
units. Extended Information OC This field holds the 3GPP specific information.
* * *
#### 6.2.1.2 WLAN 3GPP IP Access Charging message contents
The _Debit/Reserve Unit_ procedure employs the _Debit/Reserve Unit Request_
and _Debit/Reserve Unit Response_ messages. Table 6.2.1.2 describes the use of
these messages in WLAN 3GPP IP Access online charging.
Table 6.2.1.2 Online Charging Messages Reference Table
* * *
Command-Name Source Destination Debit/Reserve Unit Request PDG/3GPP AAA Server
OCS Debit/Reserve Unit Response OCS PDG/3GPP AAA Server
* * *
#### 6.2.1.2.1 Debit/Reserve Unit Request message
Table 6.2.1.2.1 illustrates the basic structure of the _Debit/Reserve Unit
Request_ message as used for WLAN 3GPP IP access online charging.
Table 6.2.1.2.1 Debit/Reserve Units Request Content
+----------------------------+----------+----------------------------+ | Debit/Reserve Units | Category | Description | | Request | | | +----------------------------+----------+----------------------------+ | Session Identifier | M | This field identifies the | | | | operation session. | +----------------------------+----------+----------------------------+ | Originator Node-Id | M | This field contains the | | | | identification of the | | | | source point of the | | | | operation. | +----------------------------+----------+----------------------------+ | Originator Domain | M | This field contains the | | | | realm of the operation | | | | originator. | +----------------------------+----------+----------------------------+ | Operation Token | M | This field is an unique | | | | operation identifier. | +----------------------------+----------+----------------------------+ | Operation Type | M | This field defines the | | | | transfer type: event for | | | | event based charging and | | | | start, interim, stop for | | | | session based charging. | +----------------------------+----------+----------------------------+ | Operation Number | M | This field contains the | | | | sequence number of the | | | | transferred messages. | +----------------------------+----------+----------------------------+ | Subscriber Address | OC | This field contains the | | | | identification of the | | | | mobile subscriber (i.e. | | | | MSISDN) that uses the | | | | requested service. | +----------------------------+----------+----------------------------+ | Service Token | OC | This field is a unique | | | | service identifier. | +----------------------------+----------+----------------------------+ | Cause of Termination | OC | This field contains the | | | | termination reason of the | | | | service. | +----------------------------+----------+----------------------------+ | Service Units Requested | OC | This field contains the | | | | amount of requested | | | | service units. | +----------------------------+----------+----------------------------+ | Service Units Used | OC | This field contains the | | | | amount of used service | | | | units. | +----------------------------+----------+----------------------------+ | Multiple Operation | OC | This field indicate the | | | | occurrence of multiple | | | | operations. | +----------------------------+----------+----------------------------+ | Multiple Unit Operation | OC | This field contains the | | | | parameter for the quota | | | | management. | +----------------------------+----------+----------------------------+ | Subscriber Equipment | OC | This field contains the | | Number | | identification of the | | | | mobile device (i.e. IMEI) | | | | that uses the subscriber. | +----------------------------+----------+----------------------------+ | Service Information | OM | This field holts | | | | additional 3GPP service | | | | specific parameter: | | | | | | | | > \- PS Information; | | | | > | | | | > \- WLAN Information; | | | | > | | | | > \- IMS Information; | | | | > | | | | > \- LCS Information; | | | | > | | | | > \- PoC Information; | | | | > | | | | > \- MBMS Information. | +----------------------------+----------+----------------------------+
#### 6.2.1.2.2 Debit/Reserve Unit Response message
Table 6.2.1.2.2 illustrates the basic structure of the _Debit/Reserve Unit
Response_ message as used for WLAN 3GPP IP access online charging.
Table 6.2.1.2.2 Debit/Reserve Units Response Content
* * *
Debit/ Reserve Units Response Category Description Session Identifier M This
field identifies the operation session. Operation Result M This field
identifies the result of the operation. Originator Node-Id M This field
contains the identification of the source point of the operation. Originator
Domain M This field contains the realm of the operation originator. Operation
Type M This field defines the transfer type: event for event based charging
and start, interim, stop for session based charging. Operation Number M This
field contains the sequence number of the transferred messages. Service Units
Granted OC This filed contains the amount of used service units. Unit Validity
Time OC This field contains the time for the validity of the granted service
units. Extended Information OC This field holds the 3GPP specific information.
* * *
#### 6.2.2 Detailed Message Formats
FFS.
##### 6.2.2.1 WLAN Direct IP Access Charging message contents
FFS.
##### 6.2.2.2 WLAN 3GPP IP Access Charging message contents
FFS.
## 6.3 WLAN Charging specific parameters
The WLAN-Information parameter used for WLAN online charging is provided in
the Service-Information parameter.
#### 6.3.1.1 WLAN charging information assignment for Service-Information
The components in the Service-Information that are use for WLAN charging can
be found in table 6.3.1.1.
Table 6.3.1.1: Service-Information used for WLAN Charging
* * *
Field Category Description
Service-Information OM This is a structured field and holds the 3GPP specific
parameter as defined in 3GPP TS 32.299 [50].\ For WLAN Charging the WLAN-
Information is used.
WLAN-Information OM This is a structured field and holds the WLAN specific
parameters.\ The details are defined in clause 6.3.1.2.
* * *
#### 6.3.1.2 Definition of WLAN Information
WLAN specific charging information is provided within the WLAN-Information.
The fields of the WLAN-Information which are different coved in several WLAN
network notes are indicated by the note specific type.
The detailed structure of the WLAN-Information parameter can be found in table
6.3.1.2.
Table 6.3.1.2 Structure of the WLAN-Information
* * *
Field Category Description PDG-Charging-Id OC TBD WLAN-Session-Id OC TBD PDG-
Address OC TBD PDG-IPv6-Address OC TBD WAG-Address OC TBD WAG-IPv6-Address OC
TBD WAG-PLMN-Id OC TBD AAA-Server/Proxy-Address OC TBD AAA-Server/Proxy-
Ipv6-Address OC TBD Framed-IP-Address OC TBD Framed-IPv6-Prefix OC TBD WLAN-
UE-Local-IP-Address OC TBD WLAN-UE-Local-Ipv6-Address OC TBD 3GPP-CG-Address
OC TBD 3GPP-CG-IPv6-Address OC TBD Called-Station-Id (See note) OC TBD 3GPP-
Session-Stop-Indicator OC TBD 3GPP-Charging-Characteristics OC TBD Charging-
Rule-Base-Name OC TBD WLAN-Radio-Container OC TBD Operator-Name OC TBD
Location-Data OC TBD Location-Information OC TBD WLAN-Technology OC TBD
* * *
NOTE: This field contains the identifier of the access point (APN) the user is
connected to
### 6.3.2 Formal WLAN charging parameter description
#### 6.3.2.1 WLAN charging information for CDRs
The detailed definitions, abstract syntax and encoding of the WLAN CDR
parameters are specified in TS 32.298 [51].
#### 6.3.2.2 Definition of the WLAN charging events
The detailed event parameter definitions are specified in TS 32.299 [50].
###### ## Annex A (informative): Bibliography
**a) The 3GPP charging specifications**
\- 3GPP TS 32.250: \"Telecommunication management; Charging management;
Circuit Switched (CS) domain charging\".
\- 3GPP TS 32.251: \"Telecommunication management; Charging management; Packet
Switched (PS) domain charging\".
\- 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Subsystem (IMS) charging\".
\- 3GPP TS 32.270: \"Telecommunication management; Charging management;
Multimedia Messaging Service (MMS) charging\".
\- 3GPP TS 32.271: \"Telecommunication management; Charging management;
Location Services (LCS) charging\".
\- 3GPP TS 32.296: \"Telecommunication management; Charging management; Online
Charging System (OCS): Applications and interfaces\".
**b) Other charging specifications**
\- ITU-T Recommendation D.93: \"Charging and accounting in the international
land mobile telephone service (provided via cellular radio systems)\".
**c) Common 3GPP specifications**
\- 3GPP TS 22.101: \"Service aspects; Service principles\".
\- 3GPP TS 22.115: \"Service aspects; Charging and billing\".
\- 3GPP TS 23.002: \"Network architecture\".
\- 3GPP TS 23.003: \"Numbering, addressing and identification\".
\- 3GPP TS 27.001: \"General on Terminal Adaptation Functions (TAF) for Mobile
Stations (MS)\".
**d) other Domain and Service specific 3GPP / ETSI specifications**
\- 3GPP TR 23.934: \"3GPP system to Wireless Local Area Network (WLAN)
interworking; Functional and architectural definition\".
\- 3GPP TS 24.234: \"3GPP System to Wireless Local Area Network (WLAN)
interworking; User Equipment (UE) to network protocols; Stage 3\".
**e) Relevant ITU Recommendations**
\- ITU-T Recommendation D.93: \"Charging and accounting in the international
land mobile telephone service (provided via cellular radio systems)\".
\- ITU-T Recommendation E.164: \"The international public telecommunication
numbering plan\".
\- ITU-T Recommendation Q.767: \"Application of the ISDN user part of CCITT
signalling System No.7 for international ISDN interconnections\".
\- ITU-T Recommendation X.25: \"Interface between Data Terminal Equipment
(DTE) and Data Circuit-terminating Equipment (DCE) for terminals operating in
the packet mode and connected to public data networks by dedicated circuit\".
\- ITU-T Recommendation X.121: \"International numbering plan for public data
networks\".
**f) Relevant IETF RFCs**
\- IETF RFC 959 (1985): \"File Transfer Protocol\".
\- IETF RFC 783 (1981): \"Trivial File Transfer Protocol (TFTP)\".
###### ## Annex B (normative): Re-using the GGSN charging functions to
implement the PDG charging functions
This annex does not introduce new charging requirements for the Packet Data
Gateway (PDG).
# B.1 General
3GPP TS 23.234 [201] depicts a PDG implementation that re-uses GGSN
functionality. Existing GGSN deployments may be re-used to implement the PDG
functionality via using a subset of the Gn reference point (Gn'). A Tunnel
Termination Gateway (TTG) is used to cover all aspects of the PDG that are not
covered by the GGSN. In such implementation, the GGSN charging gateway
interfaces are used to provide charging gateway interfaces of the PDG. The
following figure depicts a PDG implementation that re-uses GGSN charging
functionality. The Ga reference point between the GGSN and the CGF is used to
transfer offline charging records from the PDG CDF to the CGF (Wz reference
point). The Gy reference point between the GGSN and the OCS is used to
transfer online charging messages between the PDG CTF and the OCS (Wy
reference point).
Figure B.1: PDG implementation re-using GGSN charging functionality
# B.2 No re-use of policy control in the GGSN
The end-to-end tunnel between the WLAN UE and the PDG is setup according to
the procedure described in 3GPP TS 23.234 [208]. In a configuration when the
Gn\' reference point is used, the end-to-end tunnel setup between the WLAN UE
and the PDG is terminated by the TTG of the PDG, and the setup of GTP
tunnel(s) is triggered towards the GGSN part of the PDG. In such
configuration, end-to-end tunnel is mapped one-to-one to a GTP tunnel, as
illustrated in the figure B.2.
{width="6.575694444444444in" height="1.9194444444444445in"}
Figure B.2: Mapping between end-to-end tunnel and single GTP tunnel
NOTE: When the policy control in the GGSN is used, the mapping between end-to-
end and GTP tunnel may not be one-to-one. This configuration is FFS.
## B.2.1 Offline charging
In this configuration, the GGSN collects charging data related to the PDP
contexts in the G-CDR, as described in the Rel-7 GGSN charging (3GPP TS 32.251
[2]). Charging information for WLAN 3GPP IP access (WLAN CDR) shall be
collected by the GGSN in the G-CDR according to the following mapping table:
Table B.2.1.1 : Mapping between WLAN CDR and G-CDR fields
+-------------------------+----------------+-------------------------+ | G-CDR field | G-CDR Category | WLAN-CDR mapping | | | | guidance | +-------------------------+----------------+-------------------------+ | Record Type | M | Record Type | +-------------------------+----------------+-------------------------+ | Network initiated PDP | OC | _Not applicable in this | | context | | 3GPP relase_ | +-------------------------+----------------+-------------------------+ | Served IMSI | M | Served IMSI | +-------------------------+----------------+-------------------------+ | Served IMEISV | OC | _Not applicable in this | | | | 3GPP 3GPP relase_ | +-------------------------+----------------+-------------------------+ | GGSN Address used | M | PDG Address used | +-------------------------+----------------+-------------------------+ | Charging ID | M | Charging ID | +-------------------------+----------------+-------------------------+ | SGSN Address | M | Serving WAG address | +-------------------------+----------------+-------------------------+ | Access Point Name | OM | Access Point Name | | Network Identifier | | Network Identifier | +-------------------------+----------------+-------------------------+ | PDP Type | OM | _Not applicable in this | | | | relase_ | +-------------------------+----------------+-------------------------+ | Served PDP Address | OC | WLAN UE remote IP | | | | address | +-------------------------+----------------+-------------------------+ | Dynamic Address Flag | OC | _Not applicable in this | | | | 3GPP relase_ | +-------------------------+----------------+-------------------------+ | List of Traffic Data | OM | _Can be used to record | | Volumes | | the data volume of the | | | | PDP context, which | | | | should be equivalent to | | | | the volume of the | | | | end-to-end tunnel._ | | | | | | | | _NOTE: In case of | | | | I-WLAN mobility | | | | architecture and HA | | | | co-located with GGSN, | | | | the volume shall be | | | | collected as if it was | | | | collected by the HA._ | +-------------------------+----------------+-------------------------+ | Record Opening Time | M | Record Opening Time | +-------------------------+----------------+-------------------------+ | MS Time Zone | OC | _Not applicable in this | | | | 3GPP relase_ | +-------------------------+----------------+-------------------------+ | Duration | M | Duration | +-------------------------+----------------+-------------------------+ | Cause for Record | M | Cause for Record | | Closing | | Closing | +-------------------------+----------------+-------------------------+ | Diagnostics | OM | Diagnostics | +-------------------------+----------------+-------------------------+ | Record Sequence Number | C | Record Sequence Number | +-------------------------+----------------+-------------------------+ | Node ID | OM | Node ID | +-------------------------+----------------+-------------------------+ | Record Extensions | OC | Record Extensions | +-------------------------+----------------+-------------------------+ | Local Record Sequence | OM | Local Record Sequence | | Number | | Number | +-------------------------+----------------+-------------------------+ | APN Selection Mode | OM | APN Selection Mode | +-------------------------+----------------+-------------------------+ | Served MSISDN | OM | Served MSISDN | +-------------------------+----------------+-------------------------+ | User Location | OC | _Not applicable in this | | Information | | 3GPP relase_ | +-------------------------+----------------+-------------------------+ | Charging | M | Charging | | Characteristics | | Characteristics | +-------------------------+----------------+-------------------------+ | Charging | OM | Charging | | Characteristics | | Characteristics | | Selection Mode | | Selection Mode | +-------------------------+----------------+-------------------------+ | IMS Signalling Context | OC | _Not applicable in this | | | | 3GPP relase_ | +-------------------------+----------------+-------------------------+ | External Charging | OC | _Not applicable in this | | Identifier | | 3GPP relase_ | +-------------------------+----------------+-------------------------+ | SGSN PLMN Identifier | OM | WAG PLMN identifier | +-------------------------+----------------+-------------------------+ | CAMEL Information | OC | _Not applicable_ | +-------------------------+----------------+-------------------------+ | RAT Type | OC | _Can be used to | | | | differentiate G-CDR | | | | used for 3GPP access | | | | from G-CDR for WLAN | | | | access._ | +-------------------------+----------------+-------------------------+
NOTE: The "Serving AAA server/Proxy address" and "WLAN session ID" fields are
not covered by the G-CDR.
## B.2.2 Online charging
In the configuration where the PDG is implemented by GGSN/TTG, the GGSN
performs online charging as described in TS 32.251 [11].
#
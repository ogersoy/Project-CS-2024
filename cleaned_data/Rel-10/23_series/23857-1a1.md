# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
# 1 Scope
The present document contains the study on EPC nodes failure and restoration.
This document will consider any necessary operational protocol recovery
mechanisms in the EPS in order to restore the subscriber service in the event
of EPC node failure or clean up the hanging resource in other EPC nodes if the
recovery of the failed node is not possible. The document will address the
following aspects:
\- list the different network failure scenarios to be analyzed for EPC nodes:
MME, S4-SGSN, SGW and PGW;
\- identify precisely the problems resulting from the current definition of
the standards;
\- list various possible solutions;
\- identify pros and cons of possible solutions;
\- conclude on potential enhancements to the standards (depending on gains vs
complexity).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.007: \"Restoration procedures\".
[3] 3GPP TS 29.274: \"Evolved General Packet Radio Service (GPRS) Tunnelling
Protocol for Control plane (GTPv2-C); Stage 3\".
[4] 3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS)\".
[5] 3GPP TS 24.008: \"Mobile Radio Interface Layer 3 specification; Core
Network Protocols; Stage 3\".
[6] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
> [7] 3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service
> description\".
[8] 3GPP TS 23.272: \"Circuit Switched (CS) fallback in Evolved Packet System
(EPS); Stage 2\".
[9] 3GPP TS 29.118:\"Mobility Management Entity (MME) -- Visitor Location
Register (VLR) SGs interface specification\".
[10] 3GPP TS 23.018: \"Basic call handling; Technical realization\".
[11] 3GPP TS 23.236: \"Intra Domain Connection of RAN Nodes to Multiple CN
Nodes\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
EPC Evolved Packet Core
EPS Evolved Packet System
GTP GPRS Tunnelling Protocol
MME Mobility Management Entity
PGW PDN Gateway
SGW Serving Gateway
# 4 Requirements analysis and assumptions
The following are the requirements considered as the criteria for developing
solutions provided in this study.
\- The impact or degradation of the service affect on the user shall be
minimised.
\- The solution shall not cause overload or congestion in the Core Network and
RAN.
\- The solution shall support pre-Rel10 UEs but not necessary with the same
level of efficiency and performance to that provided for UEs from Rel-10
onwards.
\- The solution should minimise the resource reservation in the Core Network
and RAN.
\- The impact for the hPLMN by EPC node failure of vPLMN shall be minimised.
\- The deployment of LTE/EPC and SGs interface shall not impair the delivery
of Mobile Terminated CS services (e.g. CS call, SMS).
# 5 Failure scenarios
## 5.1 Introduction
The following figure shows the network elements of the EPC. According to this
the targets for the study are coloured red in the following figure.
Figure 5.1-1: Network elements to be considered in the study
The following clauses cover each of the possible failure cases and indicate
how they affect service.
## 5.2 MME failure
### 5.2.1 Introduction
This section will analyse the scenarios for MME failure and corresponding
consequences according to the current procedures.
MME failure will be detected by the SGW as per restart procedure specified in
3GPP TS 23.007 [2]. MME failure will take place in the following scenarios:
\- MME failure with Restart;
\- MME failure without Restart.
### 5.2.2 MME failure with Restart
According to the current mechanism described in 3GPP TS 23.007 [2], when an
SGW detects that a peer MME has restarted, it shall delete all PDN connection
table data/MM bearer contexts associated with the peer node that fails as well
as freeing any internal SGW resources associated with those PDN connections.
Since there are no bearer/MM contexts in the SGW, the mobile terminated
service cannot be delivered to the UE for long time. The UE will reattach to
the network only when the UE has uplink signalling or data to send.
### 5.2.3 MME failure without Restart
Editor's Note: to be completed
#### 5.2.3.1 Outage of CS services
With the deployment of LTE in mobile networks, there is the risk that mobile
terminated CS services (e.g. CS calls, SMS, Mobile termination Location
request) cannot be successfully delivered to the subscriber for a long period
(up to the periodic Tracking Area Update timer e.g. 1 hour) after an MME
failure without restart or a long MME failure.
A UE under LTE that requires support of CS or/and SMS services performs a
combined attach procedure to attach for both EPS and non-EPS services (i.e. CS
services), or both EPS services and \"SMS only\" services, and a combined
tracking area update procedure to update the registration of the actual
tracking area (see 3GPP TS 23.401 [6] and 3GPP TS 24.301 [4]). During those
procedures, the serving MME initiates a location update for non-EPS services
procedure towards the VLR providing the CS or/and SMS services, thereby
establishing an SGs association between the MME and VLR (see 3GPP TS 23.272
[8] and 3GPP TS 29.118 [9]). Upon receipt of a subsequent CS terminated
service (e.g. MT CS call or SMS), the VLR sends an SGs Paging Request message
to the serving MME with a \"CS call indicator\" or an \"SMS indicator\" which
triggers a CS Fallback procedure or SMS transfer via LTE (see 3GPP TS 23.272
[8] and 3GPP TS 29.118 [9]).
Restoration procedures are defined in 3GPP TS 29.118 [9] (see in particular
clause 5.1.3) to maintain mobile terminated CS services (e.g. CS call or SMS)
when an MME fails but restarts. They essentially rely on the principle that
MME accepts SGs-paging request received for unknown UEs for a certain period
after the MME restart whose duration typically covers the largest tracking
area update timer assigned to UEs. During that period, the MME sets a system-
wide parameter MME-reset to true. After that period, the MME sets the MME-
reset parameter to false and stops accepting SGs paging request for unknown
UEs.
But if the MME fails without restart, or if the MME fails for a long duration,
it is no longer possible for the VLR to page the UE via the MME. Since UEs in
idle mode are not aware of the MME failure until they need to send some uplink
data or signalling (e.g. periodic Tracking Area Update), they remain under LTE
but cannot receive any more mobile terminated services.
### 5.2.4 MME Partial failure
According to the current mechanism described in 3GPP TS 23.007 [2], when an
SGW receives a GTPv2 Delete PDN Connection Set Request message from a MME as
the result of a partial failure in the MME, it shall retrieve all the PDN
connections corresponding to each of the FQ-CSID(s) present in the message and
shall delete all the retrieved PDN connections and the associated resources.
Since there are no bearer/MM contexts in the SGW, the mobile terminated
service cannot be delivered to the affected UEs for long time, i.e. up to
Periodic TAU timer expiry. The UE will reattach to the network only when the
UE has uplink signalling or data to send.
According to current mechanisms in 23.007 [2], when a SGW receives a Delete
Connection Set request from MME, it shall forward the Delete PDN Connection
Set request to PDN GW. The PDN GW also deletes the PDN Connections locally
corresponding to the CS-ID received in the Delete PDN connection Set Request.
For ISR activated UEs, the SGSN and MME both share the UE context. Since the
SGSN is not aware of the partial failure in the MME, SGSN is also unaware that
the PDN connections have been lost. Therefore the UE in SGSN service area may
face service interruption for a period of time till it uplink NAS signalling
triggers interaction with Serving GW for the UE.
## 5.3 SGSN failure
### 5.3.1 Introduction
This section will analyse the scenarios for SGSN failure and corresponding
consequences according to the current procedures.
SGSN failure will be detected by the SGW as per restart procedure specified in
3GPP TS 23.007 [2]. SGSN failure will take place in the following scenarios:
\- SGSN failure with Restart;
\- SGSN failure without Restart.
### 5.3.2 SGSN failure with Restart
According to the current mechanism described in 3GPP TS 23.007 [2], when an
SGW detects that a peer SGSN has restarted, it shall delete all PDN connection
table data/MM bearer contexts associated with the peer node that fails as well
as freeing any internal SGW resources associated with those PDN connections.
Since there are no bearer/MM contexts in the SGW, the mobile terminated
service cannot be delivered to the UE for long time. The UE will reattach to
the network only when the UE has uplink signalling or data to send.
### 5.3.3 SGSN failure without Restart
Editor's Note: to be completed
## 5.4 SGW failure
### 5.4.1 Introduction
This section will analyse the scenarios for SGW failure and corresponding
consequences according to the current procedures.
SGW failure will be detected by the PGW, MME and SGSN as per restart procedure
specified in 3GPP TS 23.007 [2]. SGW failure will take place in the following
scenarios:
\- SGW failure with Restart;
\- SGW failure without Restart.
### 5.4.2 SGW failure with Restart
According to the current mechanism described in 3GPP TS 23.007 [2], when a
PGW/MME/SGSN detects that a peer SGW has restarted, it shall delete all PDN
connection table data/MM bearer contexts associated with the peer node that
fails as well as freeing any internal PGW/MME/SGSN resources associated with
those PDN connections. Since there are no bearer/MM contexts in the PGW, the
mobile terminated service cannot be delivered to the UE for long time. If the
MME/SGSN performs implementation specific action to cleanup external
resources, including at eNodeB/RNC and UE, the UE will be reattached to the
network and the EPS services will be restored. Otherwise the UE will be
reattached to the network only when the UE has uplink signalling or data to
send.
### 5.4.3 SGW failure without Restart
Editor's Note: to be completed
### 5.4.4 SGW Partial failure
According to the current mechanism described in 3GPP TS 23.007 [2], when an
MME/PGW receives a GTPv2 Delete PDN Connection Set Request message from a SGW
as the result of a partial failure in the SGW, MME/PGW shall retrieve all the
PDN connections corresponding to each of the FQ-CSID(s) present in the message
and shall delete all the retrieved PDN connections and the associated
resources. Since there are no bearer/MM contexts in the PGW, the mobile
terminated service cannot be delivered to the UE for long time. If the MME
performs implementation specific action to cleanup external resources,
including at eNodeB and UE, the UE will be reattached to the network and the
EPS services will be restored. Otherwise the UE will be reattached to the
network only when the UE has uplink signalling or data to send.
## 5.5 PGW failure
### 5.5.1 Introduction
This section will analyse the scenarios for PGW failure and corresponding
consequences according to the current procedures.
PGW failure will be detected by the SGW as per restart procedure specified in
3GPP TS 23.007 [2]. PGW failure will take place in the following scenarios:
\- PGW failure with Restart;
\- PGW failure without Restart.
### 5.5.2 PGW failure with Restart
According to the current mechanism described in 3GPP TS 23.007 [2], when a SGW
detects that a peer PGW has restarted, it shall delete all PDN connection
table data/MM bearer contexts associated with the peer node that fails as well
as freeing any internal SGW resources associated with those PDN connections.
Since there are no bearer/MM contexts in the PGW, the mobile terminated
service cannot be delivered to the UE for long time. In Rel-10, if the SGW
detects the PGW has restarted, the SGW may send a PGW Restart Notification
message to the MME/S4-SGSN. When the MME/S4-SGSN receives the PGW Restart
Notification message, it should delete all PDN connection table data
associated with the restarted PGW. If the MME/SGSN performs implementation
specific action to cleanup external resources, including at eNodeB/RNC and UE,
the UE may reattach to the network again.
### 5.5.3 PGW failure without Restart
According to the current mechanism described in 3GPP TS 23.007 [2], mobile
terminated services cannot be delivered to the UE for a long time if a PGW
fails without restart. The PGW cannot send downlink data to the SGW.
Additionally when detecting a path failure with the peer PGW, the SGW deletes
the affected PDN connections immediately or a bit later if the path is still
down after an operator configurable maximum path failure duration.
The SGW cannot signal the PGW failure to the MME/S4-SGSN either, which
prevents the MME/S4-SGSN to restore PDN connections (via alternative PGWs).
### 5.5.4 PGW Partial failure
According to the current mechanism described in 3GPP TS 23.007 [2], when an
SGW receives a GTPv2 Delete PDN Connection Set Request (or PMIP6 Binding
Revocation Indication with G bit set) message from a PGW as the result of a
partial failure in the PGW, the SGW shall retrieve all the PDN connections
corresponding to each of the FQ-CSID(s) present in the message and shall
delete all the retrieved PDN connections and the associated resources. The SGW
shall also send a S11 GTPv2 Delete PDN Connection Set Request message
containing the FQ-CSID(s) provided by the PGW to MME peers supporting the
feature. Since there are no bearer/MM contexts in the PGW, the mobile
terminated service cannot be delivered to the UE for long time. If the MME
performs implementation specific action to cleanup external resources,
including at eNodeB and UE, the UE may be requested to re-establish the PDN
connection. Otherwise the UE will re-establish the PDN connection only when
the UE has uplink signalling or data to send.
# 6 Alternative solutions
## 6.1 Alternative Solutions for MME failure
### 6.1.1 Solution 1 Down Link Data Triggered Attach (DLDTA)
#### 6.1.1.1 Description
The Down Link Data Triggered Attach (DLDTA) is an optional feature for MME,
S4-SGSN and SGW.
##### **6.1.1.1.1** Down Link Data Triggered Attach (DLDTA) procedure
The DLDTA enables UEs to make the re-attach to the EPS possible triggered by
an arrival of the downlink packet after the MME has restarted. The DLDTA is
composed of the following components.
a) The MME marks an EPS bearer as the subject for the DLDTA:
When EPS bearer is established, based on the operator policy the MME marks an
EPS bearer as the subject for the DLDTA by setting the DLDTA flag in the EPS
bearer Context. The MME may activate the DLDTA for all EPS bearers or based on
QCI, Priority Level or/and APN.
NOTE1: MME may activate the DLDTA for minimal number of EPS bearers. For
example, in order to make the IMS terminating call to be a trigger for the UE
re-attachment, the DLDTA is only activated for those of EPS bearers which has
the QCI=5 (IMS Signalling).
b) The SGW maintains the IMSI, latest TA-list per UE:
If the UE has at least one EPS bearer that has the DLDTA flag active and the
latest TA list is changed , for example due to the mobility management
procedure, the MME transfers the latest TA list to the corresponding SGW by
the Create Session Request message or/and the Modify Bearer Request message.
> If the SGW receives the dedicated Modify Bearer Request message from the MME
> only for the purpose of updating the latest TA list, the SGW shall not
> forward the Modify Bearer Request message to the PGW. Instead, the SGW sends
> the Modify Bearer Response message to the MME.
NOTE2: The TA list is essential in case of MME restart since it allows
avoiding the IMSI page for the entire coverage of an MME (which is extremely
stressful for the EPS system, since a large number of eNBs is typically
covered by one MME). To minimize any extra S11 signalling during Intra-MME
Intra-SGW relocations, the MME may store in the SGW a list of TAIs (or a
Paging Area ID representing such list) which is a superset of the actual list
of TAIs returned to the UE during the Attach / TAU procedures. It should be up
to each MME implementation to decide which exact TAIs list to store in the
SGW.
c) The SGW maintains the S5/S8 bearers after the MME has restarted:
> If the SGW detects the MME restart by referring to the increase of the
> restart counter, instead of removing associated resources, the SGW maintains
> the S5/S8 bearers if the DLDTA flag is active. This makes it possible for
> the SGW to receive a down link packet from the PGW.
>
> When SGW starts maintaining the S5/S8 bearers, SGW starts the DLDTA timer
> for corresponding MME. If the DLDTA timer expires, the maintained resources
> due to the DLDTA shall be locally deleted. This treatment is required in
> case the other SGW is chosen when UE re-attaches to the EPC after the MME
> failure. A value of the DLDTA timer may be equal to the periodic tracking
> area update timer (timer T3412) as specified in the 3GPP TS 24.301 [4].
> There is one DLDTA timer in the SGW.
NOTE 3: From Rel-10 onwards, operators may configure subscriber\'s specific
Periodic TAU/RAU timer in the HLR/HSS. See 3GPP TS 23.401 [6] subclause
4.3.17.3. It is however sufficient to use a single DLDTA timer in the SGW.
This timer may be set e.g. to the largest TAU timer allocated to subscribers
with DLDTA.
> When SGW receives the Create Session Request message from the UE while the
> DLDTA timer is running, the SGW deletes all DLDTA related resources for the
> UE and then proceeds with the Create Session Request message handling.
d) Downlink data packet/ Control signal message arrives to the SGW while the
DLDTA timer is running:
> When SGW receives the downlink data packet/ Control signal message from the
> PGW using the EPS bearer that has the DLDTA flag active, the SGW sends the
> enhanced Downlink Data Notification message with the IMSI and TA list to the
> MME in order to page UE. The TA list on the enhanced Downlink Data
> Notification message is used by MME for sending the page message over the
> S1-MME interface if the MME does not have a valid UE context.
>
> The SGW shall reject the control message received from the PGW with an
> appropriate cause value.
>
> If the MME receives the Downlink Data Notification message with the IMSI to
> a UE either who has the valid UE context or the MME has received the Cancel
> Location Request message for that UE after the MME restarted, the MME does
> not send page message over the S1-MME interface and replies the Downlink
> Data Notification Acknowledge to the SGW with cause value \"Re-Attach
> Success\". In this case, the SGW releases the corresponding internal
> resources and may perform bearer deactivation procedure toward the P-GW
> according to 3GPP TS 23.007[2].
NOTE 4: In case the HSS sends the Cancel Location Request message to the MME
while MME is being failed (out of service), the Downlink Data Notification
message with the IMSI triggers the IMSI page unfortunately.
> Upon receiving a page message with IMSI, UE starts the re-attach procedure
> as specified in subclause 5.6.2.2.2 of the 3GPP TS 24.301 [4].
e) The SGW pages UE again if MME cannot find the UE context when the Data
Notification message is received:
> When the SGW receives the Downlink Data Notification Acknowledge message
> with error cause \"context not found\" from the MME for the EPS bearer that
> has the DLDTA flag active, then the SGW re-sends the enhanced Down Link Data
> Notification with IMSI and TA list. This procedure is required in case the
> downlink packet arrives from the PGW right before the SGW detects the MME
> restart.
f) The other mobility related procedures:
> When the MME is changed due to the mobility management, source MME shall
> forward the DLDTA flag in the EPS bearer Context to new MME.
>
> When the SGW is changed due to the mobility management, the latest TA list
> is informed to new SGW.
g) The ISR related procedures:
> If the ISR is active, the SGW maintains both the latest TA list and the
> latest RAI.
The procedure d) in this subclause can be executed per S4/S11 interface
independently irrespective of the ISR activation status. The figure 6.1.1-1
outlines the overall DLDTA procedure.
Figure 6.1.1.1.1-1: The overall DLDTA procedure
#### 6.1.1.2 Evaluation
##### 6.1.1.2.1 Pros
This subclause lists the pros of solution 1 DLDTA as following:
> **EPS Service after MME Restart: This approach enables UEs to make the re-
> attach to the EPS possible triggered by an arrival of the downlink packet
> after the MME has restarted;**
>
> **No inter PLMN dependency: This approach does not require any support from
> the EPC node across PLMNs. The approach only requires support in the SGW and
> MME;**
>
> **IMSI paging in the latest TAI list:** This approach performs the IMSI
> paging in the latest TAI list which is stored in the SGW. This can avoid
> paging in all TAI list served by the MME and save some radio resource.
##### 6.1.1.2.2 Cons
This subclause lists the cons of solution 1 DLDTA as following:
> **Extra signalling over S11 interface:** This approach requires the TAI list
> for each UE to be stored in the SGW in order to avoid sending the paging
> request for the UE in all the TAI lists supported by the MME. Hence, the
> change in TAI list needs to be updated by sending extra signalling message
> over the S11 interface in the intra MME intra SGW TAU procedure. This extra
> signalling can however be minimized by storing in the SGW a list of TAIs (or
> a Paging Area ID representing such list) which is a superset of the actual
> list of TAIs returned to the UE during the Attach / TAU procedures.
>
> **Resources maintained in the SGW after the MME restart detection:** This
> approach requires reservation of UE resource (IMSI, S5/S8 bearer contexts
> and TAI list) until downlink packets arrives for the UE or DLDTA timer
> expires;
>
> **UE movement before old SGW receives the downlink packets on the maintained
> bearers:** If the UE moves to new MME area, it would reattach to the network
> through the new MME. If the UE has already reattached to another MME and the
> old SGW receives the downlink packets on the maintained bearers to trigger
> the IMSI paging. e.g. if the UE establishes a new PDN connection to a
> different APN which was used by the UE before the MME restarts. This will
> cause UE to reattach to the network again.
>
> **Mobile Terminated Service which triggers the paging will fail:** The SGW
> receives the downlink packets on the maintained bearers which will trigger
> the paging. However the downlink packets will be dropped by the SGW and
> cannot be delivered to the UE.
### 6.1.2 Solution 2 for MME failure by reattachment with HSS interaction
#### 6.1.2.1 Description
This solution enables the UE to reattach to EPS triggered by downlink data
packets or signalling after MME restarts. This solution includes the following
steps:
1) The SGW maintains the IMSI and S5/S8 bearers after detection of MME restart
> If the SGW detects the MME restarts by referring to restart counter, instead
> of removing associated resources, the SGW maintains the S5/S8 bearers. This
> makes it possible for the SGW to receive downlink data packets or signalling
> from the PGW. How to maintain the S5/S8 bearers is based on the maintaining
> policy which is decided by the MME or PCRF during the bearer establishment
> procedure.
>
> When SGW starts maintaining the S5/S8 bearers, SGW starts a timer for
> corresponding restarted MME. The timer value may be equal to periodic
> tracking area update timer (timer T3412) as specified in 3GPP TS 24.301 [4].
> If the timer expires, the maintained resources shall be locally deleted.
>
> When SGW receives the Create Session Request message for the UE while the
> timer is running, the SGW deletes all maintained resources for the UE and
> then proceeds with the Create Session Request message handling as specified
> in 3GPP TS 29.274 [3].
2) Downlink data packets or signalling arrives to the SGW while the timer in
the step1) is still running.
> When the SGW receives the downlink data packets on the maintaining bearer or
> signalling for establishing new bearers, the SGW shall reject the signalling
> message received from the PGW with an appropriate cause value and sends an
> enhanced Downlink Data Notification message including IMSI to the associated
> MME.
3) The MME will check whether the UE has been registered to another MME.
> After the MME receives enhanced Downlink Data Notification message including
> IMSI, the MME will check whether the UE has been registered to another MME
> by sending enhanced Update Location Request including IMSI and restoration
> indication to the HSS. If the UE has not been registered to another MME, the
> HSS will send Update Location Response including subscription data.
> Otherwise the HSS will reject Update Location Request with appropriate
> cause.
NOTE: This step can avoid double IMSI paging if the UE has already reattached
to another MME and the old SGW receives the downlink packets on the maintained
bearers, e.g. if the UE establishes a new PDN connection to a different APN
which was used by the UE before the MME restarts.
4) The MME pages the UE in the MME serving area using the IMSI if the UE has
not been registered to another MME.
> Upon receiving a page message with IMSI, UE starts the reattach procedure as
> specified in subclause 5.6.2.2.2 of 3GPP TS 24.301 [4].
#### 6.1.2.2 Evaluation
##### 6.1.2.2.1 Pros
This subclause lists the pros of solution 2 MME failure by reattachment with
HSS interaction as following:
> **EPS Service after MME Restart: This approach enables UEs to make the re-
> attach to the EPS possible triggered by an arrival of the downlink packet
> after the MME has restarted;**
>
> **No extra signalling over S11 interface:** This approach requires to send
> the paging request for the UE in all the TAI lists served by the MME. Hence,
> there is no extra signalling message over the S11 interface in the intra MME
> intra SGW TAU procedure;
>
> **Double IMSI paging can be avoided if the UE has already reattached to
> another MME:** After the MME receives enhanced Downlink Data Notification
> message including IMSI, the MME will check whether the UE has been
> registered to another MME. This can avoid double IMSI paging if the UE has
> already reattached to another MME and the old SGW receives the downlink
> packets on the maintained bearers.
##### 6.1.2.2.2 Cons
This subclause lists the cons of solution 2 MME failure by reattachment with
HSS interaction as following:
> **Resources maintained in the SGW after the MME restart detection:** This
> approach requires reservation of UE resource (IMSI, S5/S8 bearer contexts)
> until downlink packets arrives for the UE or the timer as specified in the
> step 1) in subclause 6.1.2.1 expires;
>
> **Mobile Terminated Service which triggers the paging will fail:** The SGW
> receives the downlink packets on the maintained bearers which will trigger
> the paging. However the downlink packets will be dropped by the SGW and
> cannot be delivered to the UE.
>
> **IMSI paging in the MME serving area:** The MME performs the IMSI paging in
> all TAI lists served by the MME. Some radio resources for IMSI paging will
> be consumed.
>
> **PLMN dependency for inbound roaming UE:** the MME will check whether the
> UE has been registered to another MME by sending enhanced Update Location
> Request including IMSI and restoration indication to the HSS. The HSS in the
> HPLMN will be enhanced for the inbound roaming UE.
### 6.1.3 Solution 3 Pro-active Paging based approach for MME Failure
#### 6.1.3.1 Description
In the event of failure of the MME, the network may initiate the paging for
EPS services using the IMSI as specified in 3GPP TS 24.301 [3]. Network
initiating paging using the IMSI as soon as the MME failure is detected is
termed as Pro-active paging. The trigger for this type of paging is detection
of the failure of the MME.
Following terms are used for the depiction of this solution.
**Anchor MME** \-- The MME which has the UE's Bearer/MM context, and hence
anchoring the UE before the failure, is termed as Anchor MME.
**Paging MME** \-- The MME which is selected by the SGW to perform IMSI based
paging procedure is termed as Paging MME. If the SGW is not configured within
an MME pool then the Anchor MME and Paging MME are the same. In the case of
MME pools, the SGW can select any MME or set of MMEs from the MME pool as
Paging MME(s).
##### 6.1.3.1.1 General
The Pro-active paging approach based on UE Context Reestablishment (UCR) is
divided into following two phases:
  * Preparation phase: During this phase, the MME is in good health and has a valid UE context. The Anchor MME prepares the SGW to assist the MME to reestablish the UE's context in the event of the Anchor MME's failure. This phase is characterized by the following functions.
i. Based on various criteria, the Anchor MME decides to enable/disable the
context reestablishment for a particular UE, which is referred as \"UE
Requiring Context Reestablishment\" (URCR) status. The URCR status \"enabled\"
indicates that the UE is subjected to context reestablishment. The UE's URCR
status is provided by the Anchor MME to the associated SGW.
ii. For the UE with URCR status enabled, the Anchor MME provides the
associated SGW with the Data to Assist IMSI Paging (DAIP). The associated SGW
stores the URCR status and the latest DAIP for each UE as provided by the
Anchor MME.
  * Execution phase: This phase is executed only when the SGW detects failure of the Anchor MME. If the SGW is configured with the MME pool, this phase can be triggered as soon as the SGW detects failure of the Anchor MME. However, in the absence of the MME pool, this phase can be triggered only on the detection of the Anchor MME restart. This phase is characterized by the following functions.
i. For UEs with URCR status enabled, the SGW provides DAIP to the Paging MME
for each UE. In case of the MME pool, the SGW can select a different Paging
MME for the different UEs and hence the IMSI based paging procedure can be
done in parallel. If the MME has failed with a Restart, the SGW may select the
anchor MME as paging the MME; otherwise, if the MME has failed without a
Restart, the SGW shall select an MME different from the failed MME in the MME
pool as paging the MME.
ii. On the reception of the UE's DAIP, the MME initiates \"Paging for EPS/GPRS
services using IMSI\" as specified in 3GPP TS 24.301 [4].
iii. On reception of the \"Paging using IMSI\", the UE initiates \"Initial
Attach\" procedure and hence reattaches to the network. As the UE's context is
reestablished in the network, the EPS services can be delivered to the UE.
##### 6.1.3.1.2 Preparation phase
Figure 6.1.3.1.2-1: UE Context Reestablishment procedures, Preparation phase
1) During session establishment and session modification procedures, the
Anchor MME decides to enable/disable URCR status of the UE based on various
criteria as given below.
> \- Subscription profile e.g. High priority users;
>
> \- Currently active PDN connection, currently active bearer's QCI/ARP values
> etc;
>
> \- Operator's local policy;
>
> Based on the above criteria, the Anchor MME can decide to change the current
> URCR status to \"enabled\" or \"disabled\". Hence the previously \"enabled\"
> URCR status can be \"disabled\" dynamically by the Anchor MME; the
> previously \"disabled\" URCR status can be \"enabled\" by the Anchor MME
> based on the EPS services currently activated by the UE.
>
> MME may activate URCR status of the UE for minimal number of UEs based on
> QCI, Priority Level or/and APN of UE's PDN connections. For example, in
> order to make the IMS terminating call to be a trigger for the UE re-
> attachment, the URCR is only enabled for those of UE which has the QCI=5
> bearer (IMS Signalling). Or in order to allow the high priority user to re-
> attach to the network, the URCR is only activated for the high priority
> users.
2) During the existing/additional S11 interface signalling for the session
establishment and/or session modification, the MME sends the URCR status to
the associated SGW. If the URCR status is \"enabled\", the Anchor MME may
provide the latest DAIP to the SGW. The DAIP is a container to hold UE paging
related information, which can be used by the Paging MME to initiate IMSI
based paging request message to the UE in the event of Anchor MME failure.
From the SGW point of view, the DAIP is just transparent container whose
content is specific to the implementation of the Anchor MME and Paging MME.
> 3) The SGW shall store the URCR status and latest DAIP for the UE, if it
> receives from Anchor MME. If the latest DAIP is not provided then the SGW
> assumes old value of DAIP as the latest value of DAIP. The Anchor MME shall
> provide the DAIP when the URCR status for a particular UE is enabled for the
> first time.
##### 6.1.3.1.3 Execution phase
Figure 6.1.3.1.3-1: UE Context Reestablishment procedures, Execution phase
1) The SGW detects failure of the associated Anchor MME as specified in 3GPP
TS 23.007 [2] section 18 and 3GPP TS 29.274 [3] section 7.8.
> 2) On the detection of the failure of the Anchor MME, the SGW performs
> restoration procedure as specified in 3GPP TS 23.007 [2] section 16.1.1.
> Additionally, the SGW checks the URCR status of the affected UEs. If the
> URCR status of the UE is enabled then the SGW sends \"Paging Indication
> Request\" message to the Paging MME. The SGW shall provide the latest DAIP
> to the Paging MME in \"Paging Indication Request\" message.
>
> In case of the MME pool, the selection of the Paging MME(s) is left to the
> SGW implementation. The simplest approach can be to select different MMEs as
> Paging MMEs (from the MME pool) for the different UEs in round robin cycle.
> The Paging MME(s) in the MME pool automatically acts as a load balancing
> MMEs and helps in executing the IMSI based paging procedure simultaneously.
> 3) The Paging MME acknowledges the reception of the Paging Indication
> message by sending \"Paging Indication Response\" message to SGW. The SGW
> shall distinguish the scenarios of the MME failure, if the MME has failed
> with a restart, the SGW may select the anchor MME as the paging MME;
> otherwise, if the MME has failed without a Restart, the SGW shall select an
> MME different from the failed MME, from the MME pool, as the paging MME.
>
> 4) The Paging MME initiates IMSI based paging based on the information
> received in the DAIP for the specified IMSI. Please refer to 3GPP TS 24.301
> [4] for IMSI based paging procedure.
>
> 5) On reception of the paging request message with IMSI as UE identity, the
> UE shall deactivate any EPS bearer context(s) locally and initiates
> \"Initial Attach\" procedure. On the successful completion of the initial
> attach procedure the UE is reattached to the network and hence able to
> receive any EPS services.
#### 6.1.3.2 Evaluation
##### 6.1.3.2.1 Pros
> **EPS Service Delivery after MME Restart/Failure:** This approach initiates
> the re-establishment of the UE's context as soon as the restart/failure of
> the MME is detected. Once the UE is re-attached to the network, at the most
> paging procedure may be initiated (if the UE is in idle mode) to delivery
> EPS services to the UE. Since the paging procedure is less resource
> intensive and has predictably lower latency value, this approach is
> guaranteed to deliver EPS services with reasonable low latency.
>
> **No inter PLMN dependency** : This approach does not require any support
> from the EPC node across PLMNs. The approach only requires support in the
> SGW and MME.
>
> **No/Minimal Resource Reservation in EPC nodes post MME restart/failure** :
> Post MME failure, this approach requires reservation of the UE related
> resources (DAIP in SGW) for a comparatively short time, till the related
> information is provided to the paging MME, and hence has no or negligible
> impact on capacity of the EPC nodes.
>
> **No dependency on any session/mobility related parameter** : The pro-active
> paging has no dependency upon the session/mobility parameters (such as TAU
> timer value). Hence, pro-active paging approach is well suited for present
> and future types of EPS services.
##### 6.1.3.2.2 Cons
> **Extra signalling over S11 interface** : The approach requires latest value
> of the TAI list to be updated in the SGW in order to avoid sending the
> paging request for the UE in all the TAI lists supported by the MME. Hence,
> the change in TAI list needs to be updated by sending extra Modify Bearer
> Request message over S11 interface, in case there session management
> signalling.
>
> **UE movement before the paging MME sends paging request message** : If the
> UE moves to new MME area, it would reattach to the network through the new
> MME and enter the connected mode. If the UE inactivity timer is short, the
> UE may enter the idle mode in the new MME. If the paging MME has not
> initiated the paging request, before the UE enters idle mode under new MME,
> the paging request would cause UE to reattach to the network again.
>
> **Possible overload of Radio and Core Network Nodes:** This approach
> initiates paging towards all the UE for which the URCR status is enabled, as
> soon as the MME restart/failure is detected. Depending upon various
> parameters, such as: number of UEs for which URCR status is enabled, number
> of eNBs handled by the failed/restarted MME, the attach procedure processing
> rate of the MME, number of MMEs in the MME pool, number of AF servers etc,
> this approach may cause overload of radio and/or core network. For in-bound
> roamers, the IMS nodes in HPLMN may be impacted.
>
> **Resource Reservation in EPC nodes pre MME restart/failure:** Pre MME
> restart/failure, this approach requires reservation of the UE related
> resources (DAIP) in SGW.
### 6.1.4 Solution 4 for MME Failure by using the MME self-stored paging
information
#### 6.1.4.1 Description
This solution enables the UE to reattach to EPS triggered by downlink data
packets or signalling after MME restarts. This solution includes the following
steps:
1) The SGW maintains the IMSI and S5/S8 bearers after detection of MME restart
> If the SGW detects the MME restarts by referring to restart counter, instead
> of removing associated resources, the SGW maintains the S5/S8 bearers. This
> makes it possible for the SGW to receive downlink data packets or signalling
> from the PGW. Which S5/S8 bearer contexts to be maintained are based on the
> local operator\'s configuration in SGW such as APN, QCI and ARP. SGW should
> delete bearer contexts which are not supposed maintained.
>
> When SGW starts maintaining the S5/S8 bearers, SGW starts a timer for
> corresponding restarted MME. The timer value may be equal to periodic
> tracking area update timer (timer T3412) as specified in 3GPP TS 24.301 [4].
> If the timer expires, the maintained resources shall be locally deleted.
>
> When SGW receives the Create Session Request message for the UE while the
> timer is running, the SGW deletes all maintained resources for the UE and
> then proceeds with the Create Session Request message handling as specified
> in 3GPP TS 29.274 [3].
2) Downlink data packets or signalling arrives to the SGW while the timer in
the step1) is still running.
> When the SGW receives the downlink data packets on the maintaining bearer or
> signalling for establishing new bearers, the SGW shall reject the signalling
> message received from the PGW with an appropriate cause value and sends an
> enhanced Downlink Data Notification message including IMSI to the associated
> MME.
>
> After SGW sends enhanced downlink data notification, if the corresponding
> Create Session Request message for this IMSI is not received within a
> configurable timer (which is a rather short timer), the SGW can then assume
> the UE has attached to other MME and other SGW, thus SGW can safely delete
> all maintained bearer contexts for this UE.
3) The MME pages the UE using S-TMSI and TAI list which were stored together
with IMSI and possible other parameters in non-volatile memory before the MME
restart. Such paging information (S-TMSI, TAI list, IMSI, SGW FQDN and PGW
FQDN) should be kept in the non-volatile memory after MME restarts for a
configurable timer e.g. Periodic TAU timer or UE is re-attached before it can
release the resource. How to implement the non-volatile memory is implement
specific; this may be e.g. local MME non-volatile memory or an external backup
system.
> Paging information stored in an external backup system can be used when MME
> fails without restart. When an alternative MME in the MME pool receives the
> Downlink Data Notification with IMSI, it can use this stored paging
> information from the failed MME to page UEs. How to retrieve and utilize
> this paging information is implementation specific.
NOTE 1: As one of example, if the number of UEs (e.g. UEs with QCI=5 IMS PDN
connections) to be recovered are 500K and 200 bytes per UE (should be
sufficient to contain TAI List + STMSI + IMSI + SGW FQDN + PGW FQDN etc), the
amount of paging information to be stored in non-volatile memory is about
100Mbyte uncompressed data.
4) For those UEs which are not yet attached to other MMEs will response the
Paging message and start with Service Request procedure, the Service Request
will be rejected by MME using cause codes #10 (Implicitly detached) which then
trigger UE to perform a new attach procedure as specified in subclause 5.6.1
of 3GPP TS 24.301 [4]. For those UE which are attached to other MMEs will not
response the paging message.
#### 6.1.4.2 Evaluation
##### 6.1.4.2.1 Pros
This subclause lists the pros of solution 4 as following:
> **EPS Service after MME Restart: This approach enables UEs to make the re-
> attach to the EPS possible triggered by an arrival of the downlink packet
> after the MME has restarted;**
>
> **No inter PLMN dependency: This approach does not require any support from
> the EPC node across PLMNs. The approach only requires support in the SGW and
> MME;**
>
> **No extra signalling over S11 interface:** This approach requires some
> information to avoid sending the paging request for the UE in all the TAI
> lists served by the MME. However those are stored in non-volatile memories
> of MME, therefore there is no extra signalling message over the S11
> interface in the intra MME intra SGW TAU procedure to pass those from MME to
> S-GW during normal operation.
>
> **No extra information in SGW:** Based on the same reason above, this
> approach doesn't need to store extra information in SGW for normal operation
> which are already stored in MME.
>
> **Paging with S-TMSI in the latest TAI list:** This approach performs,
> rather than IMSI paging, paging with S-TMSI in the latest TAI list which is
> stored in the non-volatile memory of MME. This approach can limit the
> scope/target of paging and can avoid paging in all TAI list served by the
> MME. This saves some radio resource. Additionally paging with S-TMSI forces
> UE to finally reattach to the same MME (for MME failure with restart)
> /SGW/PGW that are connected before MME fails.
##### 6.1.4.2.2 Cons
This subclause lists the cons of solution 4 as following:
> **Resources maintained in the SGW/MME after the MME restart detection:**
> This approach requires reservation of UE resource (S5/S8 bearer contexts)
> until downlink packets arrives for the UE or timer set in S-GW expires. And
> also IMSI, TAI list and S-TMSI are required storing in MME during normal
> operation.
>
> **Mobile Terminated Service which triggers the paging will fail:** The SGW
> receives the downlink packets on the maintained bearers which will trigger
> the paging. However the downlink packets will be dropped by the SGW and
> cannot be delivered to the UE.
>
> **Non-volatile storage is required:** This approach requires MME to store
> some information for paging UE in non-volatile storage/external system.
>
> **Require extra radio signalling:** After UE receives paging with S-TMSI,
> extra radio signalling "Service Request and Rejection" are required before
> UE initiates attach process.
## 6.2 Alternative Solutions for SGSN failure
### 6.2.1 Solution 1 Down Link Data Triggered Attach (DLDTA)
#### 6.2.1.1 Description
The Down Link Data Triggered Attach (DLDTA) is an optional feature for MME,
S4-SGSN and SGW.
##### **6.2.1.1.1** Down Link Data Triggered Attach (DLDTA) procedure
This alternative is described in the sub-clause 6.1.1.1.1 for MME failure.
Refer to the sub-clause 6.1.1.1.1, with appropriate substitution of
terminology as shown below.
\- MME ïƒ S4-SGSN;
\- TA list ïƒ  RAI (No substitution is required in the ISR related procedures.);
\- timer (timer T3412) as specified in the 3GPP TS 24.301 [4] ïƒ  timer (timer
T3312);
\- UE starts the re-attach procedure as specified in subclause 5.6.2.2.2 of
the 3GPP TS 24.301 [4] ïƒ  UE starts the re-attach procedure as specified in
subclause 4.7.9.1.2 of the 3GPP TS 24.008 [5];
\- S1-MME interface ïƒ  Iu PS interface.
#### 6.2.1.2 Evaluation
This pros and cons of the solution 1 DLDTA for S4-SGSN restart is similar to
the pros and cons of the solution 1 DLDTA for MME restart as specified in
section 6.1.1.2.
### 6.2.2 Solution 2 for SGSN failure by reattachment with HSS interaction
#### 6.2.2.1 Description
This solution is described in the sub-clause 6.1.2.1 for MME failure. Refer to
the sub-clause 6.1.2.1, with appropriate substitution of terminology as shown
below.
\- MME ïƒ  S4-SGSN;
\- tracking area update timer (timer T3412) as specified in 3GPP TS 24.301 [4]
ïƒ  routing area update timer (timer T3312) as specified in 3GPP TS 24.008 [5];
\- UE starts the re-attach procedure as specified in subclause 5.6.2.2.2 of
the 3GPP TS 24.301 [4] ïƒ  UE starts the re-attach procedure as specified in
subclause 4.7.9.1.2 of the 3GPP TS 24.008 [5];
#### 6.2.2.2 Evaluation
This pros and cons of the solution 2 for S4-SGSN failure by reattachment with
HSS interaction is similar to the pros and cons of solution 2 for MME failure
by reattachment with HSS interaction as specified in section 6.1.2.2.
### 6.2.3 Solution 3 Pro-active Paging based approach for S4-SGSN Failure
#### 6.2.3.1 Description
This pro-active paging based approach for S4-SGSN failure is similar to the
pro-active paging based approach for MME failure as specified in section
6.1.3.
#### 6.2.3.2 Evaluation
This pros and cons of the pro-active paging based approach for S4-SGSN
failure/restart is similar to the pros and cons of the pro-active paging based
approach for MME failure/restart as specified in section 6.1.3.2.
### 6.2.4 Solution 4 for SGSN failure by using the SGSN self-stored paging
information
#### 6.2.4.1 Description
This solution is described in the sub-clause 6.1.4.1 for MME failure. Refer to
the sub-clause 6.1.4.1, with appropriate substitution of terminology as shown
below.
\- MME ïƒ  S4-SGSN;
\- tracking area update timer (timer T3412) as specified in 3GPP TS 24.301 [4]
ïƒ  routing area update timer (timer T3312) as specified in 3GPP TS 24.008 [5];
\- S-TMSI ïƒ  P-TMSI;
\- TAI list ïƒ  RAI;
\- UE starts the service request procedure and subsequently initial attach
procedure as specified in subclause 5.6.1 of the 3GPP TS 24.301 [4] ïƒ  UE
starts the service request procedure and subsequently attach procedure in case
of Iu Mode as specified in subclause 4.7.9.1.1 and 4.7.13 of the 3GPP TS
24.008 [5] or send any LLC frame to response paging request and subsequently
attach procedure in case of A/Gb mode as specified in subclause 8.1.4 of the
3GPP TS 23.060 [7];
#### 6.2.4.2 Evaluation
This pros and cons of the solution 4 for S4-SGSN failure by using SGSN self-
stored paging information is similar to the pros and cons of solution 4 for
MME failure by using MME self-stored paging information as specified in
section 6.1.4.2.
## 6.3 Alternative Solutions for SGW failure
### 6.3.1 Solution 1 for SGW failure by MME/S4-SGSN re-establishing resources
with a new SGW or to the old SGW after its recovery
#### 6.3.1.1 Description
This solution enables to restore the PDN connections affected by an SGW
failure with or without restart without requiring corresponding UEs to
reattach to the EPS. The solution only impacts MME/S4-SGSN and PGW, and relies
on the following principles:
1) The MME/S4-SGSN and PGW maintain the bearers and MM contexts after
detection of SGW failure
> Upon MME/S4-SGSN detecting an SGW failure with or without restart (relying
> on the restart counter or implementation, e.g. preconfigured path failure
> timer), the MME/S4-SGSN and PGW maintain the bearers and MM contexts for PDN
> connections eligible for restoration, instead of removing these resources as
> per existing procedures.
>
> The PDN connections eligible for restoration are determined by the
> MME/S4-SGSN and PGW based on same operator\'s policies e.g. based on QCI,
> ARP and/or APN.
>
> The MME/S4- SGSN and PGW know by local configuration whether this SGW
> restoration procedure is supported in the PLMN, i.e. by peer PGWs or
> MME/S4-SGSNs. The PGW assumes that either all or none of the MMEs/S4-SGSNs
> in the PLMN support this procedure.
>
> This makes it possible for the MME/S4-SGSN to restore these bearers by
> selecting a new or the restarted SGW for the UE within an operator
> configurable period locally provisioned on MME/S4-SGSN and PGW that by
> default should cover the periodic TAU/RAU timer. After the expiry of such
> timer the MME/S4-SGSN and the PGW should delete any EPS bearer contexts that
> have not been relocated to a new or to the restarted SGW.
>
> This SGW restoration procedure only applies to PDN connections established
> between MME/S4-SGSN and PGW of the same PLMN, i.e. for non-roaming and
> roaming scenarios with local breakout. Service Level Agreements may be set
> up to extend the use of this procedure to PDN connections established
> between MME/S4-SGSN and PGW pertaining to different PLMNs, i.e; for roaming
> scenarios with home routed traffic, but this is further considered as out of
> scope of 3GPP. Consequently MME/S4-SGSN and PGW behave as per existing
> restoration procedure, i.e. release resources (see 3GPP TS 23.007 [2]
> clauses 14.1A.1 & 17.1A.1), for PDN connections established between nodes of
> different PLMNs, i.e. as if the remote peer does not support this SGW
> restoration procedure.
NOTE 1: The PGW\'s capability of supporting SGW failure solution is stored on
per PDN, per UE by the serving MME/S4-SGSN. For the UE with multiple active
PDN connections, it is possible that some of the PGWs support the SGW failure
solution while others do not support the same. E.g. SGW restoration is
supported for a PDN connection with local breakout while not supported for
another PDN connection with home routed traffic. The existing restoration
procedures upon SGW failure (see 3GPP TS 23.007 [2] clauses 14.1A.1 & 17.1A.1)
apply to for the PDN connections for which the SGW restoration procedure is
not supported or not applicable.
NOTE 2: The use of this procedure is restricted to PDN connections established
between MME/S4-SGSN and PGW in the same PLMN to ensure, simply by local
configuration, that MME/S4-SGSN and PGWs apply the same logic i.e. same
operator\'s policies when determining whether and which PDN connections should
be restored. This enables to restore in particular IMS PDN connections (even
in roaming scenarios, for which local break out is used) and PDN connections
of non roaming UEs.
2) The MME/S4-SGSN selects a new SGW or the restarted SGW for the
ECM_IDLE/PMM-IDLE/GPRS STANDBY UE.
> The MME/S4-SGSN should prioritize the SGW relocation for those UEs that are
> engaged in a Service Request or other mobility procedures, e.g. TAU/RAU/HO
> over the UEs that are not engaged in any mobility procedure and therefore do
> not have signalling connection to MME/S4-SGSN. The MME/S4-SGSN selects a new
> SGW or the restarted SGW for the ECM_IDLE/PMM-IDLE/GPRS STANDBY UE based on
> the last visited TAI/RAI. Then MME/S4-SGSN sends a Create Session Request
> message to the new SGW or the restarted SGW to establish the bearer
> contexts. The new SGW or the restarted SGW will send a Modify Bearer Request
> message for GTP based S5 interface or a Proxy Binding Update message for
> PMIP based S5 interface to the PGW to update the bearer context in the PGW.
> As a result of the Modify Bearer Request, the PGW may initiate signalling
> towards the PCRF as already specified in 3GPP TS 23.401[6]. The SGW
> relocation signalling corresponds to Steps 8-11 in Section 5.3.3.1 in 3GPP
> TS 23.401[6].
>
> The MME/S4-SGSN should perform pro-active SGW relocation for all the UEs
> affected by the SGW failure, i.e. including UEs in idle mode not engaged in
> any Service Request or other mobility procedure. The MME/S4-SGSN controls
> the priority of the UEs and the pace of the pro-active SGW relocation to
> avoid core network node overload. This is to allow these UEs to be
> reconnected to the network in a relatively short time (that is function of
> the speed of the SGW relocations that the MME/S4-SGSN performs, based on
> implementation and the network load) so that downlink packets may be
> delivered to the UEs with minimum service interruption.
3) The MME/S4-SGSN releases S1/Iu/radio resources and selects a new SGW or the
restarted SGW for the ECM_CONNECTED/PMM-CONNECTED/GPRS READY UE.
> The MME/S4-SGSN firstly releases S1/Iu/radio resources of ECM_CONNECTED/PMM-
> CONNECTED/GPRS READY UE. Then the MME/S4-SGSN will handle the UE as the same
> way for the ECM_IDLE/PMM-IDLE/GPRS STANDBY UE. If the eNodeB detects the SGW
> failure or restart, the eNodeB may request the MME to release the S1-U
> resource.
NOTE 3: For EUTRAN or UTRAN with direct tunnel, the MME/S4-SGSN may not need
to perform an explicit S1/Iu release procedure towards the eNodeB/RNC because
eNodeB and RNC will also detect the SGW failure or restart.
NOTE 4: For UTRAN without direct tunnel and GERAN, the S4-SGSN may perform the
SGW relocation even for UE is in PMM-CONNECTED/GPRS-READY state because S4
user plane is used. In other words the SGW restart will not be visible to the
radio network.
4) For a UE who is in ECM-IDLE/PMM-IDLE/GPRS STANDBY state and initiates
Service Request procedure, the MME/S4-SGSN shall perform the SGW relocation
procedure first and then continue with Service Request procedure since
MME/S4-SGSN has no valid SGW F-TEID to be included in Initial Context Setup
Request towards the eNodeB or in RAB Assignment Request message towards RNC if
Direct Tunnel is used.
5) For a UE who initiates an intra MME or an intra S4-SGSN or a periodic
TAU/RAU during/after the SGW failure/restart, the MME/S4-SGSN, upon the NAS
TAU/RAU Request message, performs the SGW relocation procedure. If the TAU/RAU
signalling involves an MME/S4-SGSN change, and both the source and target
MME/S4-SGSNs support this SGW restoration procedure, the source MME/S4-SGSN
should indicate to the target MME/S4-SGSN in GTPv2 Context Response message
that an SGW relocation procedure is needed due to the SGW failure/restart.
Upon reception of such indication the target MME/S4-SGSN performs TAU/RAU with
SGW relocation procedures. The source MME/S4-SGSN may relocate the SGW before
responding to the Context Response if the target MME/S4-SGSN does not support
the SGW restoration procedure, e.g. during inter-PLMN RAU/TAU procedures when
the target PLMN does not support SGW restoration procedure.
6) The source MME/S4-SGSN rejects Handover Required/Relocation Required
messages received from the RAN for UEs with PDN connection(s) affected by an
earlier SGW failure that have not been restored yet; the MME/S4-SGSN then
releases the S1/Iu/radio resources of these UEs to force them to enter idle
mode and proceed with idle mode mobility procedures.
NOTE 5: Per step 3 above, S1/Iu/radio resources of UEs in ECM-CONNECTED/PMM-
CONNECTED state affected by an SGW failure are released very shortly after the
SGW failure. Therefore only very few UEs affected an SGW failure and with PDN
connections not restored yet may be subject to a handover, e.g. handovers
taking place just after the SGW failure before the eNB/RNC or the MME/SGSN
release the S1/Iu resources. Thus it is not deemed necessary to support SGW
relocation during Intra/Inter-CN handover procedures.
7) The PGW discards downlink packets received for a PDN connection maintained
after an SGW failure that has not been restored yet. The PGW shall stop
charging for PDN connections maintained after an SGW failure which have not
been restored yet.
Editor\'s Note: potential impacts of the SGW restoration procedure to the PCC
procedures are ffs. It is intended to try to hide the SGW failure to the PCRF
when possible e.g. for the existing PCC rules, but it is ffs how to handle
e.g. new or modified PCC rules. Besides for PMIP based S5, for which the SGW
failure is visible to the PCRF, it is ffs how to restore the Gxc session when
the SGW is relocated.
#### 6.3.1.2 Evaluation
##### 6.3.1.2.1 Pros
This subclause lists the pros of solution 1 by MME/S4-SGSN re-establishing
resources with a new SGW or the restarted SGW:
**Re-establishments of resources in SGW transparent to the UE:** The
MME/S4-SGSN performs the SGW relocation signalling within the network nodes.
In other nodes, unless PGW/PCRF changes any bearer or its properties, the SGW
relocation signalling due to SGW failure/restart does not require any
signalling between the UE and the network.
##### 6.3.1.2.2 Cons
This subclause lists the cons of solution 1 by MME/S4-SGSN re-establishing
resources with a new SGW or the restarted SGW:
> **Maintained resources in the MME/S4-SGSN and PGW after SGW failure or
> restart detection:** The MME/S4-SGSN and PGW maintain resources (MM contexts
> and bearer contexts) for each UE after SGW failure or restart detection
> during the procedure of re-establishing resources with a new or the
> restarted SGW in comparison with the existing requirement that the affected
> PDN connections are deleted. However comparing the network resources
> allocated for the affected UEs before and after the SGW failure or restart,
> the network (PGW and MME/S4-SGSN) doesn\'t allocate any extra resource;
>
> **SGW restoration not supported for roaming with home routed traffic:** to
> support this scenario, the MME/S4-SGSN would need to know whether the PGW in
> the HPLMN supports the capability to maintain the old PDN connection after
> SGW failure or restarts, and vice versa; also the MME/S4-SGSN in the VPLMN
> and the PGW in HPLMN would need to apply the same logic or same
> configuration when determining which PDN connection should be maintained
> after detecting SGW restart. This may be supported via Service Level
> Agreement between PLMNs, but not further specified within 3GPP
> specifications.
### 6.3.2 Solution 2 for SGW failure by PGW initiated paging request at
receiving downlink data/signalling
#### 6.3.2.1 Description
The solution enables to restore the PDN connection of a UE that has been
affected by an earlier SGW failure and not restored yet, upon receipt of
downlink data packets or signalling for that PDN connection. This enables to
deliver to the user terminating services such as IMS voice after an SGW
failure with or without restart.
The solution may be used as supplement to solution 1 as specified in subclause
6.3.1 of this TR. The solution includes the following steps on top of the
solution 1:
1) During normal mode of operation (i.e. before SGW failure with/without
restart)
> The MME/S4-SGSN supporting this solution shall include a new MME/S4-SGSN
> identifier IE and the SGW supporting this solution shall forward it in
> existing signalling over S11/S4 and S5 interfaces, i.e. in
  * Create Session Request messages over S11/S4 and S5 interface during an E-UTRAN Initial Attach, a UE requested PDN connectivity, and a PDP Context Activation procedure;
  * Create Session Request message over S11/S4 and Modify Bearer Request over S5 during TAU/RAU/X2 handover/Enhanced SRNS relocation procedures with a SGW change;
  * Modify Bearer Request message over S11/S4 and S5 during Inter-RAT Handover procedures with/without a SGW change;
  * Modify Bearer Request message over S11/S4 and S5 during Intra-RAT handover procedure with a SGW change;
  * Modify Bearer Request message over S11/S4 and S5 during Inter-RAT TAU/RAU procedures without a SGW change;
> \- Modify Bearer Request message over S11/S4 and S5 if the message is deemed
> to be sent to the PGW due to other reasons, e.g. reporting ULI, time zone.
>
> \- Create Session Request message and Modify Bearer Request during X2 and
> Enhanced SRNS relocation...
>
> If the PGW receives a MBR without MME/SGSN identifier, it shall delete the
> stored MME/SGSN identifier.
>
> This allows the PGW to have the serving MME/S4-SGSN address, whenever there
> is S5 signalling message. However, this cannot ensure that the PGW is always
> aware of the currently serving MME/S4-SGSN address. E.g. during inter-
> MME/inter-S4-SGSN HO without SGW change, the current serving MME/S4-SGSN
> address will not be propagated to the PGW if there is no S5 signalling.
>
> Whether this solution is supported in the PLMN is known by local
> configuration. When supported in the PLMN, the PGW supporting this solution
> is configured with alternative(s) SGW(s) supporting this solution and the
> PGW assumes that all the MMEs/S4-SGSNs in the PLMN network support the
> solution. It is recommended that all MMEs/S4-SGSNs in the MME/S4-SGSN pool
> support the feature when the feature is deployed.
2) Downlink Data packets or signalling arrives at the PGW and the PGW detects
that the corresponding PDN connection is associated with the failed SGW and
has not been restored yet
> **For GTPv2 based S5, the following applies:**
>
> The PGW selects a SGW which supports this solution, based on local
> configuration, to send a PGW Downlink Triggering Notification message
> including IMSI, and an MME/S4-SGSN identifier when it is available, if the
> PDN connection receiving downlink data or signalling is eligible for PGW
> initiated Downlink triggering based on operator\'s policies, e.g. for IMS
> PDN Connection. The PGW should not send new PGW Downlink Triggering
> Notification message in very short time at receiving subsequent downlink
> data on the same PDN connection. It is implementation option how many
> times/how frequently the PGW should send PGW Downlink Triggering
> Notification message before discarding the downlink packets.
NOTE 1: To ensure the delivery of downlink data, it is implementation specific
whether the PGW buffers or not the downlink data until the PDN connection is
restored. The application functions e.g. P-CSCF for IMS, may take care of the
retransmission of the data packets.
> The SGW forwards PGW Downlink Triggering Notification message to the
> associated MME/S4-SGSN if MME/S4-SGSN identifier is present in the PGW
> Downlink Triggering Notification message. If the MME/S4-SGSN identifier is
> not present, the SGW forwards PGW Downlink Triggering Notification message
> to all MME/S4-SGSN within the MME/S4-SGSN pool as known by local
> configuration. The SGW shall then send PGW Downlink Triggering Notification
> Acknowledge message back to the PGW with an acceptance cause code.
>
> If the MME/S4-SGSN, which receives PGW Downlink Triggering Notification
> message including IMSI and the MME/S4-SGSN identifier, cannot find UE
> context corresponding to the IMSI, it shall send a PGW Downlink Triggering
> Notification Acknowledge message with the rejection cause code \"Context Not
> Found\", with the IMSI and the MME/S4-SGSN identifier to the SGW. The SGW
> then sends PGW Downlink Triggering Notification message, including IMSI
> only, to all MME/S4-SGSN within the MME/S4-SGSN pool as known by local
> configuration. Otherwise, the MME/S4-SGSN performs S-TMSI/P-TMSI paging as
> per step3 below and sends PGW Downlink Triggering Notification Acknowledge
> message back to the SGW with an acceptance cause code.
>
> If the MME/S4-SGSN, which receives PGW Downlink Triggering Notification
> message only including IMSI, cannot find UE context corresponding to the
> IMSI, it shall send a PGW Downlink Triggering Notification Acknowledge
> message only with rejection cause code, e.g. Context Not Found, to the SGW.
> If the MME/S4-SGSN, which receives PGW Downlink Triggering Notification
> message only including IMSI, can find UE context corresponding to the IMSI,
> it performs S-TMSI/P-TMSI paging in the step3 and sends PGW Downlink
> Triggering Notification Acknowledge message back to the SGW with an
> acceptance cause code.
>
> The MME/S4-SGSN may expose more than one IP address on S11/S4, but the PGW
> Downlink Triggering Notification should be sent only once per MME/S4-SGSN
> per local configuration in the SGW.
>
> The broadcasting of the paging message can be avoided by using proprietary
> mechanism and configuring a default MME/SGSN per vendor per pool in the SGW.
NOTE 2: The MME/S4-SGSN receiving a PGW Downlink Triggering Notification
message may use proprietary mechanisms to retrieve the current serving
MME/S4-SGSN of the UE and forward to it the PGW Downlink Triggering
Notification, when it does not know itself the UE context corresponding to the
IMSI. If so, the SGW may be configured with a default MME/S4-SGSN per vendor
per pool, and send the PGW Downlink Triggering Notification message only to
these default MME/S4-SGSNs instead of sending a PGW Downlink Triggering
Notification message to all MME/S4-SGSNs.
> **For PMIPv6 based S5, the following applies:**
>
> The same principles as for GTP based S5 apply with the following
> differences:
>
> \- in lieu of the PGW Downlink Triggering Notification message over GTP
> based S5, the PGW sends over S5 an enhanced PMIP message e.g. Binding
> Revocation Indication with new Mobility options, e.g. Operation Indication
> to indicate it is PGW initiated Paging request message, the IMSI and
> MME/S4-SGSN Identifier when it is available.
NOTE 3: It is FFS which PMIP message over S5 interface is used for PGW
downlink triggering.
Editor\'s Note: for PMIP-based S5, it is FFS for the impact on the PCRF, e.g.
it is not possible to send the updated QoS rule since all Gateway Control
sessions associated with the restarted SGW are deleted.
3) The MME/S4-SGSN performs Network Initiated Service Request procedure as
specified in subclause 5.3.4.3 of 3GPP TS 23.401 [6] and in subclause 6.12.1A
of 3GPP TS 23.060 [7] with the following deviations:
> After the MME/S4-SGSN receives NAS message Service Request, it shall perform
> the SGW relocation procedure as specified in the solution 1 in subclause
> 6.3.1of this TR.
#### 6.3.2.2 Evaluation
##### 6.3.2.2.1 Pros
> **The terminating services can be delivered to the idle UEs** : The PGW
> triggered paging request upon receiving downlink data at the SGW restart or
> failure makes sure the terminating services can be delivered to the idle
> UEs.
>
> **Avoid potential signalling overload in the network due to SGW failure:**
> This solution which based on the received downlink traffic can spread
> signalling traffic for restoration of EPS Service over the time. The
> MME/S4-SGSNs which are associated the failed SGW can make use of the Service
> Request, which is the result of paging request triggered by PGW, to perform
> SGW relocation. For those Idle UEs, e.g. without performing service request,
> TAU/RAU, the SGW relocation procedure could be performed until next Periodic
> TAU/RAU.
##### 6.3.2.2.2 Cons
This subclause lists the cons of solution 2 by PGW initiated paging request at
receiving downlink data/signalling as following:
> **Extra Signalling due to broadcasted paging when SGW failed:** When the
> current MME/S4-SGSN Identifier is not available or not accurate, the SGW
> needs to forward the paging request without any MME/S4-SGSN identifier to
> all MMEs/S4-SGSNs under the SGW, based on local configuration. The
> configuration between MME/S4-SGSN, SGW and PGW needs to be coordinated. The
> main drawback of paging broadcast is the massive increase in signalling.
>
> **Extra Processing and Memory needed in PGW during normal mode of
> operation** : The PGW needs to process and store MME/S4-SGSN identifier per
> PDN connection.
>
> **PMIP Impact:** the PMIP protocol need to be enhanced to let PGW send
> paging request message and let SGW optionally include the MME/S4-SGSN id.
> The Cons described above also applies to the PMIP based solution.
## 6.4 Alternative Solutions for PGW failure
### 6.4.1 Solution 1 for PGW failure with restart
#### 6.4.1.1 Description
When the MME/S4-SGSN detects the PGW has restarted, the MME should release the
PDN connections. If the UE has multiple PDN connections, the MME/S4-SGSN may
send the release cause \"reactivation required\" to the UE. If the UE has only
one PDN connections, the MME/S4-SGSN may send the release cause \"explicit
detach with reattach required\" to the UE.
#### 6.4.1.2 Evaluation
##### 6.4.1.2.1 Pros
This subclause lists the pros of solution 1 for PGW failure as following:
> **Service recovery soon:** The service will be recovered soon if the release
> cause \"reactivation required\" or \"explicit detach with reattach
> required\" is sent to UE.
##### 6.4.1.2.2 Cons
This subclause lists the cons of solution 1 for PGW failure as following:
> **Possible RAN overload:** When the MME/S4-SGSN detects the PGW has
> restarted, the MME/S4-SGSN may perform cleanup external resources including
> at eNodeB/RNC and UE. This may cause RAN overload.
### 6.4.2 Solution 2 for PGW failure without restart
#### 6.4.2.1 Description
If the optional feature PGW Restart Notification is supported by the SGW and
MME/S4-SGSN, the SGW may also send a PGW Restart Notification message to the
MME or S4-SGSN if the SGW detects that a peer PGW has failed and not
restarted. The PGW Restart Notification message shall include the control
plane IP address of the PGW, the control plane IP address of the SGW on the
S11/S4 interface and the cause value \"PGW not responding\". It is an
implementation matter how an SGW becomes aware that a PGW has failed and has
not restarted, e.g. the SGW detects a signalling path failure with the PGW for
a duration exceeding the maximum path failure duration timer (see 3GPP TS
23.007 [2] clause 20.2.1).
#### 6.4.2.2 Evaluation
##### 6.4.2.2.1 Pros
> **Same as for PGW failure with restart**
##### 6.4.2.2.2 Cons
> **Same as for PGW failure with restart**
## 6.5 EPC restoration procedure if the ISR is activated
### 6.5.1 Introduction
ISR function provides a mechanism to limit signalling during the inter RAT
cell reselection for the idle mode UE, which is specified in 3GPP TS 23.401
[6]. If the ISR is activated, the MME maintains the SGSN control plane IP
address and TEID, the SGSN maintains the MME control plane IP address and
TEID, and the SGW maintains control plane IP addresses and TEIDs of the MME
and the SGSN.
This section analyses the procedures for EPC node failure if the ISR is
activated.
### 6.5.2 Alternative Solutions for MME/SGSN failure
#### 6.5.2.1 Solution 1 for MME/SGSN Failure Without Restoration: Providing
Complete Service in non-failed node service area
##### 6.5.2.1.1 Description
When the MME/S4-SGSN detects that in the ISR associated CN node (i.e.
S4-SGSN/MME) has restarted, the MME/S4-SGSN shall remove the restarted CN node
control plane address and TEID and mark the UE context as ready for ISR
deactivation.During the UE performing a common or periodic TAU/RAU, the
MME/S4-SGSN shall disable the ISR by not indicate ISR activated in the TAU/RAU
Accept message and inform the SGW that the ISR was deactivated in the UE as
specified in 3GPP TS 23.401 [6] or 3GPP TS 23.060[7]. When receiving the
TAU/RAU Accept message, the UE shall set its TIN to \"GUTI\" or \"P-TMSI\" as
no ISR activated is indicated.
The non-failed MME/SGSN may initiate GUTI Relocation/P-TMSI Relocation
Procedure to force the UE to perform the TAU/RAU procedure for ISR
deactivation (e.g. the current TAI is not included in the new allocated TAI
List during the GUTI Relocation procedure).
When the SGW detects that an in the ISR associated CN node (i.e. MME or
S4-SGSN) has restarted:
1) The SGW maintains the UE contexts:
> Instead of removing associated resources, the SGW maintains the UE contexts
> after the detection of CN node restart if ISR is activated.
>
> When SGW starts maintaining the UE bearers, SGW starts a timer for
> corresponding restarted S4-SGSN/MME, e.g. ISR deactivate timer. The timer
> value may be equal to or bit longer than the periodic routing area update
> timer (timer T3312) as specified in 3GPP TS 24.008 [5] or periodic tracking
> area update timer (timer T3412) as specified in 3GPP TS 24.301 [4]. If the
> timer expires, the ISR resources (i.e. restarted CN node control plane
> address and TEID) shall be locally deleted. When SGW receives the Create
> Session Request message for the UE, the SGW deletes all maintained resources
> for the UE and then proceeds with the Create Session Request message
> handling as specified in 3GPP TS 29.274 [3]. Upon receiving indication that
> ISR is deactivated in the UE from MME/S4-SGSN, the SGW shall stop the timer
> and delete any ISR resources for the UE.
2) Downlink data packets or signalling arrives to the SGW while the timer in
the step1) is still running.
> When the SGW receives a downlink user plane or control plane packet on a
> maintained S5/S8 bearer, the SGW shall initiate the network triggered
> service request procedure towards the non-failed CN node as specified in
> 3GPP TS 23.401 [6] subclause 5.3.4.3. In addition, if the S5/S8 bearer is
> eligible for network initiated service restoration, the SGW shall also
> immediately send an enhanced Downlink Data Notification message including
> IMSI to the restarted CN node (i.e. S4-SGSN/ MME).
>
> The S5/S8 bearers eligible for network initiated service restoration are
> determined by the SGW based on operator\'s policy e.g. based on the QCI
> and/or ARP and/or APN.
3) The restarted CN node (i.e. S4-SGSN/MME) pages the UE and forces the UE to
re-attach to the network, and the normal MME/S4-SGSN pages the UE in the TAI
List using S-TMSI or pages the UE in the RAI using the P-TMSI.
> When UE camps in the restarted CN node related network, the paging procedure
> and UE behaviour upon receiving the paging message is as specified in the
> subclause 24 \"network triggered service restoration procedure\" of the 3GPP
> TS 23.007 [5].
>
> When UE camps on the normal CN node related network, the UE behaviour upon
> receiving the paging message is as specified in subclause 5.6.1 of the 3GPP
> TS 24.301 [4] or subclause 4.7.9.1.1 of the 3GPP TS 24.008 [5] or subclause
> 8.1.4 of the 3GPP TS 23.060 [7].
For the mobility procedure with MME/SGSN restart, the behavior of ISR
associated SGW and SGSN/MME is the same as the existing behavior as specified
in 3GPP TS 23.401 [6].
##### 6.5.2.1.2 Evaluation
###### 6.5.2.1.2.1 Pros
This subclause lists the pros of solution 1 for MME/SGSN Failure without
Restoration as following:
> **No inter PLMN dependency:** This approach does not require any support
> from the EPC node across PLMNs. The approach only requires support in the
> SGW and MME/SGSN.
>
> **UE can be paged even when UE camps in the restarted MME/SGSN service
> area:** When the SGW detects a restarted in the MME/SGSN, and the UE is
> activated in SGSN/MME or in idle state, SGW shall maintain the associated
> bearer contexts including the ISR resource. When UE camps in the restarted
> MME/SGSN service area, if MT service is initiated, the IMSI paging will be
> performed in restarted MME/SGSN side, and the UE starts the reattach
> procedure.
>
> **Mobile Terminated Service:** When The SGW receives the downlink packets on
> the maintained bearers which will trigger the paging, if UE activated in the
> ISR associated MME/SGSN side instead of the restarted SGSN/MME side, an
> S-TMSI paging or P-TMSI paging will performed in the non-failed MME/SGSN
> side to keep the service continuity.
###### 6.5.2.1.2.2 Cons
This subclause lists the cons of solution 1 for MME/SGSN Failure without
Restoration as following:
> **Resources maintained in the SGW and ISR associated SGSN/MME after the
> MME/SGSN restart detection:** This approach requires reservation of UE
> resource in SGW and ISR associated SGSN/MME, e.g. SGW maintains the
> restarted MME/SGSN control planes address and TEID the until the timer as
> specified in the step 1) in subclause 6.1.2.1.1 expires.
#### 6.5.2.2 Solution 2 for MME/SGSN Failure Without Restoration: IMSI paging
in all accesses
##### 6.5.2.2.1 Description
When the SGW detects the failure of an MME or S4-SGSN for an ISR enabled UE,
the SGW instead of removing all the PDN connection data should maintain the
PDN connection table and MM bearer contexts for some specific S5/S8 bearer
contexts eligible for network initiated service restoration procedure and
initiate the deletion of the remaining S5/S8 bearer contexts. Additionally,
when the SGSN detects the failure for the ISR associated CN node, the SGSN
also deletes all the UE contexts.
When the SGW detects a failure in the ISR associated CN node (i.e. MME or
S4-SGSN has restarted) for an UE:
1) The SGW maintains the UE contexts:
> When SGW starts maintaining the UE bearers, SGW starts a timer for
> corresponding failure S4-SGSN/MME, e.g. ISR deactivate timer. The timer
> value may be equal to or bit longer than the periodic routing area update
> timer (timer T3312) as specified in 3GPP TS 24.008 [5] or periodic tracking
> area update timer (timer T3412) as specified in 3GPP TS 24.301 [4]. When SGW
> receives the Create Session Request message for the UE while the timer is
> running, the SGW deletes all maintained resources for the UE and then
> proceeds with the Create Session Request message handling as specified in
> 3GPP TS 29.274 [3].
2) Downlink data packets or signalling arrives to the SGW while the timer in
the step1) is still running.
> When the SGW receives a downlink user plane or control plane packet on a
> maintained bearer, the SGW shall send an enhanced Downlink Data Notification
> message including IMSI to both the ISR associated CN nodes (i.e. S4-SGSN/
> MME) associated for the UE.
3) The CN nodes (i.e. S4-SGSN/MME) page the UE and force the UE to re-attach
to the network.
> The paging procedure and UE behavior upon receiving the paging message is as
> specified in the subclause 24 \"network triggered service restoration
> procedure\" of the 3GPP TS 23.007 [5].
##### 6.5.2.2.2 Evaluation
###### 6.5.2.2.2.1 Pros
This subclause lists the pros of solution 2 for MME/SGSN Failure without
Restoration as following:
> **No inter PLMN dependency:** This approach does not require any support
> from the EPC node across PLMNs. The approach only requires support in the
> SGW and MME/SGSN.
>
> **UE can be paged even when UE camps on the failed MME/SGSN:** When the SGW
> detects a failure in the MME/SGSN, and the UE is activated in SGSN/MME or in
> idle state, SGW shall maintain the associated bearer contexts including the
> ISR resource. If MT service is initiated, the IMSI paging will be performed
> in the both in MME and SGSN, and the UE starts the reattach procedure.
>
> **Implementation Complexity in SGW:** The SGW behaves uniformly towards both
> failed node and the non-failed node. This reduces the implementation
> complexity of SGW.
###### 6.5.2.2.2.2 Cons
This subclause lists the cons of solution 2 for MME/SGSN Failure without
Restoration as following:
> **Mobile Terminated Service Interruption:** When The SGW receives the
> downlink packets on the maintained bearers which will trigger the paging,
> the UE is forced to reattach even if the UE is in the area of non-failed
> node. Thus UE service may be impacted.
#### 6.5.2.3 Solution 3 for MME/SGSN Restart: TMSI paging in both accesses
##### 6.5.2.3.1 Description
When the MME/S4-SGSN detects a restart in the ISR associated CN node (i.e.
S4-SGSN/MME), the MME/S4-SGSN shall remove the failed CN node control plane
TEID, maintain the IP address of the failed CN node and mark the UE context as
ready for ISR deactivation. During the UE performing a common or periodic
TAU/RAU, the MME/S4-SGSN shall disable the ISR by not indicate ISR activated
in the TAU/RAU Accept message which is a regular ISR functionality as
specified in 3GPP TS 23.401 [6] or 3GPP TS 23.060[7]. When receiving the
TAU/RAU Accept message, the UE shall set its TIN to \"GUTI\" or \"P-TMSI\" as
no ISR activated is indicated. Upon receiving the ISR disabled indication from
MME/S4-SGSN, the SGW shall delete any ISR resources for the UE which is a
regular ISR functionality as specified in 3GPP TS 23.401 [6].
NOTE: The MME/S4-SGSN may initiate GUTI/P-TMSI relocation procedure with new
TAI list/ RA to trigger the UE to perform TAU/RAU procedure.
When the SGW detects a restart in the ISR associated CN node (i.e. MME or
S4-SGSN) for an UE:
1) The SGW and the normal healthy CN node maintain the UE contexts:
> The SGW removes the IP address and TEID of the failed CN node and maintains
> other UE contexts after the detection of CN node restart if ISR is
> activated. Note that the SGW still maintains the ISR status and start a
> timer. If the timer expires, the ISR status shall be removed.
>
> The normal healthy CN node removes the TEID of the failed CN node and
> maintains the IP address of the failed CN node and other UE contexts after
> the detection of the CN node restart if ISR is activated. When the IP
> address of the failed CN node is maintained in the normal healthy CN node,
> the normal healthy CN node starts a timer (e.g. ISR deactivate timer).
2) Downlink data packets and signalling arrive at the SGW while the timer in
the SGW in the step1) is still running.
> When the SGW receives a downlink user plane or control plane packet on a
> maintained bearer, the SGW shall send normal Downlink Data Notification
> message to the normal healthy CN node (i.e. S4-SGSN/ MME). The healthy CN
> node sends the Context Transfer and Paging Triggering message to the failed
> CN node.
3) The failed CN node and normal healthy CN node (i.e. S4-SGSN/MME) pages the
UE in the TAI List using S-TMSI or pages the UE in the RAI using the P-TMSI.
> The S-TMSI and TAI list, or P-TMSI and RAI is stored in the external back-up
> system or the non-volatile memory. The UE behavior upon receiving the paging
> message is as specified in subclause 5.6.1 of the 3GPP TS 24.301 [4] or
> subclause 4.7.9.1.1 of the 3GPP TS 24.008 [5] or subclause 8.1.4 of the 3GPP
> TS 23.060 [7].
>
> If the UE camps on the failed CN node related side and the Service Request
> will be received by the failed CN node, the failed CN shall perform an
> authentication procedure and send an Update Location Request to HSS to
> retrieve the subscriber data. The ISR should be maintained by sending Modify
> Bearer Request with ISR activated from the failed node to the SGW if the UE
> camps on the failed CN related side. If the UE camps on the healthy CN node
> related side, the ISR may be deactivated in the next TAU/RAU accept message.
##### 6.5.2.3.2 Evaluation
###### 6.5.2.3.2.1 Pros
This subclause lists the pros of solution 3 for MME/SGSN Failure without
Restoration as following:
> **No inter PLMN dependency:** This approach does not require any support
> from the EPC node across PLMNs. The approach only requires support in the
> SGW and MME/SGSN.
>
> **UE can be paged even when UE camps on the failed MME/SGSN:** When the SGW
> detects a failure in the MME/SGSN, and the UE is activated in SGSN/MME or in
> idle state, SGW shall maintain the associated bearer contexts including.
> When UE camps on the failed MME/SGSN, if MT service is initiated, the TMSI
> paging will be performed in the both in MME and SGSN, and the UE starts the
> Service Request procedure.
>
> **Continuity of Mobile Terminated Service:** When The SGW receives the
> downlink packets on the maintained bearers which will trigger the paging, if
> UE activated in the failed SGSN/MME, a S-TMSI paging or P-TMSI paging will
> be performed to keep the service continuity.
###### 6.5.2.3.2.2 Cons
This subclause lists the cons of solution 3 for MME/SGSN Failure without
Restoration as following:
> **Resources maintained in the SGW and ISR status after the MME/SGSN restart
> detection:** This approach requires reservation of UE resource in SGW and
> ISR status until the timer as specified in the step 1) in subclause
> 6.5.2.3.1 expires.
>
> **Non-volatile storage is required:** This approach requires MME/S4-SGSN to
> store some information for paging UE in non-volatile storage/external
> system.
>
> **Complexity is added:** This approach requires supporting new GTPv2
> procedures to transfer the context and trigger the paging; this approach
> also additionally requires new HSS interaction for UE subscription data
> retrieval.
### 6.5.3 Alternative Solutions for SGW failure
#### 6.5.3.1 Solution 1 for SGW failure: Deactivated ISR state
##### 6.5.3.1.1 Description
When the MME detects a SGW restart and if ISR is activated, the MME behaves as
described below:
\- For ECM-CONNECTED state UEs: The MME should perform the GUTI Reallocation
procedure with a new TAI list as specified in 3GPP TS 23.401 [6] and the UE
will initiate a TAU procedure during which ISR can be deactivated in the UE.
At this point, the MME also deactivates ISR locally. The MME may send (newly
defined) \"UE Active RAT Notification\" message over S3 interface to S4-SGSN.
On reception of this message, the S4-SGSN releases the UE session locally. The
MME also removes the S4-SGSN S3 control plane address and TEID. Then the MME
performs the restoration procedure as specified in subclause 6.3.
\- For the ECM-IDLE state UEs: The MME shall first page the UE to bring the UE
to ECM-CONNECTED. If the paging is successful and the UE enters the ECM-
CONNECTED state, the MME follows the procedure defined for ECM-CONNECTED state
UEs to complete the SGW restoration. If paging the UE fails, the MME should
adjust its paging retransmission strategy (e.g. limit the number of short
spaced retransmissions) to take into account the fact that the UE might be in
GERAN/UTRAN coverage. If the MME receives \"UE Active RAT Notification\" from
S4-SGSN, the MME releases the UE session locally. Otherwise after retrying the
paging procedure, the MME may release the PDN connection context and UE MM
context assuming the UE is in GERAN/UTRAN coverage area.
NOTE: The MME should only perform the SGW reselection for the UEs camping on
the LTE, ISR activated UEs may camp in the 2G/3G, so paging is needed.
When the S4-SGSN detects a SGW restart and if ISR is activated, the S4-SGSN
behaves as described below:
\- For PMM-CONNECTED state UEs: The S4-SGSN should perform the P-TMSI
Reallocation procedure with a new RAI as specified in 3GPP TS 23.060 [7] and
the UE will initiate a RAU procedure during which ISR can be deactivated in
the UE. At this point, the S4-SGSN also deactivates ISR locally. The S4-SGSN
may send (newly defined) \"UE Active RAT Notification\" message over S3
interface to MME. On reception of this message, the MME releases the UE
session locally. The S4-SGSN also removes the MME S3 control plane address and
TEID. The S4-SGSN then performs the restoration procedure as specified in
subclause 6.3.
\- For the PMM-IDLE UEs: The S4-SGSN shall first page the UE to bring the UE
to PMM-CONNECTED. If the paging is successful and the UE enters the PMM-
CONNECTED state, the S4-SGSN follows the procedure defined for PMM-CONNECTED
state UEs to complete the SGW restoration. If paging the UE fails, the S4-SGSN
should adjust its paging retransmission strategy (e.g. limit the number of
short spaced retransmissions) to take into account the fact that the UE might
be in E-UTRAN coverage. If the MME receives \"UE Active RAT Notification\"
from MME, the S4-SGSN releases the UE session locally. Otherwise after
retrying the paging procedure, and the S4-SGSN may release the PDN connection
context and UE MM context assuming the UE is in E-UTRAN coverage area.
##### 6.5.3.1.2 Evaluation
###### 6.5.3.1.2.1 Pros
This subclause lists the pros of solution 1 for SGW failure as following:
> **EPS Service after SGW failure:** This approach enables to re-select a new
> SGW after the failure of the SGW.
###### 6.5.3.1.2.2 Cons
This subclause lists the cons of solution 1 for SGW failure as following:
> **Maintained resources in the MME/SGSN and PGW after SGW failure
> detection:** The MME/ SGSN and PGW maintain related bearer resources after
> SGW failure detection during the procedure of re-establishing resources with
> a new SGW.
>
> **PLMN dependency for inbound roaming UE:** The MME/SGSN needs to know
> whether the PGW in the HPLMN supports the capability to maintain the old PDN
> connection after SGW failure, vice versa.
>
> **Possible overload of Radio and Core Network Nodes:** When the MME/SGSN
> detects a failure of SGW, the MME/SGSN shall page all the related idle UE
> anchored in the failure SGW, this approach may cause overload of radio and
> core network. Additionally, if the MME/S4-SGSN sends \"UE Active RAT
> Notification\" message over S3 interface, it may lead to overload of
> S4-SGSN/MME.
#### 6.5.3.2 Solution 2 for SGW failure: Maintain the ISR state
##### 6.5.3.2.1 Description
This solution proposes to maintain the ISR state for those ISR activated UEs
after an SGW restart or failure. The solution includes the following steps as
illustrated in the following figure 6.5.3.2.1, which are on top of Solution 1
for SGW failure by MME/S4-SGSN re-establishing resources with a new SGW as
described in section 6.3.1:
Figure: 6.5.3.2.1-1
1) (1a, 1b) When the MME or the S4-SGSN receives uplink NAS message from UE,
e.g. Service Request, it performs SGW selection procedure and then it sends an
S3 message carrying the new SGW\'s FQDN as result of SGW selection procedure
to the other mobility management node (S4-SGSN or MME) where the ISR was
activated. The capability to support this solution shall be negotiated between
the MME and S4-SGSN beforehand.
2) (2a, 2b, 2c and 2d)The ISR associated mobility management node then sends a
GTPv2 Create Session Request message to the SGW selected as part of SGW
relocation procedure.
3) (3a)When the ISR associated mobility management node receives the GTPv2
Create Session Response message as result of SGW relocation procedure, it
sends an S3 message to the other ISR associated node to indicate the SGW has
been selected. When there is any failure during SGW relocation, e.g. receiving
the rejection in the Create Session Response, the ISR associated mobility
management node indicates that failure in the S3 message and the ISR is going
to be deactivated, so that the other ISR associated node, i.e. the mobility
management node that receives uplink NAS message, continues the step below
without activating ISR, i.e. not sending the S3 message to indicate ISR
activated to the ISR associated node.
4) (4a, 4b, 4c. 4d and 4e) The other ISR associated node, i.e. the > mobility
management node that receives uplink NAS message sends > Modify Bearer Request
message based on Step 9 of section 5.3.3.2 > of 3GPP TS 23.401[6] or Step 7 of
section 5.3.3.3 of 3GPP TS > 23.401 [6] to activate ISR. After that, the node
sends an S3 > message to the ISR associated node to indicate ISR has been >
activated.
NOTE 1: The S3 message that carries SGW FQDN and F-TEID information as well as
its response message can either be the existing ones or new messages that may
allow carrying necessary ISR information for multiple UEs. It is up to Stage-3
to decide.
> During/after the SGW failure/restart, if the UE does a inter MME/S4-SGSN
> TAU/RAU to a new MME/S4-SGSN, where ISR cannot be activated, ISR needs to be
> deactivated in both old MME and old S4-SGSN. After the either the old MME or
> the old S4-SGSN transferred the UE context to the new MME or S4-SGSN, the
> old MME/S4-SGSN informs the old ISR associated mobility management node, to
> deactivate ISR and remove the PDN connections of the UE.
NOTE 2: The new S3 messages may need to allow the old MME or S4-SGSN to inform
the old ISR associated mobility management node, to deactivate ISR and remove
the PDN connections of the UE. This new message may reuse the one introduced
in the step 1.
> During/after the SGW failure/restart, if the MME/S4-SGSN received a PGW
> Downlink Triggering Notification containing MME Identifier or S4-SGSN
> Identifier from the PGW (relayed by a SGW) for those UEs of which PDN
> Connections are associated with failed SGW, in this case, either MME or
> S4-SGSN will receive PGW Downlink Triggering Notification, the MME or the
> S4-SGSN shall proceed the paging and also forward the page request over S3
> interface to the ISR associated node; if the MME/S4-SGSN received a PGW
> Downlink Triggering Notification without MME or SGSN Identifier, which means
> the SGW has broadcasted the paging request from the PGW, therefore both the
> MME and S4-SGSN will receive PGW Downlink Triggering Notification, the MME
> and S4-SGSN shall perform the paging independently. Upon receiving the
> Service Request as the result of paging, either the MME or the S4-SGSN
> starts the SGW relocation procedure together with the above steps 1 in
> addition. For rest of affected UEs which don't perform TAU/RAU or Service
> request initially, and no downlink data for them, the MME/S4-SGSN can wait
> to relocate a new SGW together with the above steps 1 in addition, until the
> UEs perform Periodic TAU/RAU.
##### 6.5.3.2.2 Evaluation
###### 6.5.3.2.2.1 Pros
This subclause lists the pros of solution 2 SGW failure: Maintain the ISR
state as following:
> **EPS Services can be delivered to those ISR activated UE** : The solution
> solves problem that ISR state is unsynchronized between network and UE, and
> it makes sure that EPS Services can be delivered to those ISR activated UEs
> which have been relocated to a new SGW.
###### 6.5.3.2.2.2 Cons
This subclause lists the cons of solution 2 SGW failure: Maintain the ISR
state as following:
**Extra Signalling introduced in the network:** Extra signalling over S3 to
request the ISR associated mobility management node to select the same SGW to
maintain ISR activated for each affected UEs due to SGW restart or failure;
Extra signalling over S3 to request the ISR associated mobility management
node to remove UE context when UE has moved to another MME or S4-SGSN. Extra
signalling over S5/Gx to report the RAT change during re-activate ISR. However
it reduces signalling over Radio and Core Network when UE perform next
TAU/RAU.
**Increasing the latency for the NAS procedures:** Because of CN signalling to
re-establish ISR, the latency for the NAS procedures, e.g. the service request
and the TAU is increased, UE may need to re-try the same procedure if the
timers, e.g. T3410(15s), T3417(5s), are expired.
#### 6.5.3.3 Solution 3 for SGW failure with ISR
##### 6.5.3.3.1 Description
The solution 3 enables the mobile terminating service such as IMS voice or
mobile originating service can be delivered even after SGW failure or restart.
The solution could be used as standalone solution to the SGW failure with ISR
including the following steps:
###### 6.5.3.3.1.1 Mobile Terminating service handling.
The solution makes it possible that the mobile terminating service such as IMS
voice could be delivered to the UE even after SGW failure with or without
restart. The solution includes the following steps:
1) The MME/S4-SGSN supporting the PGW triggered SGW restoration procedure
shall include the MME/S4-SGSN identifier IE in existing signalling over the
S11/S4 interface:
> This step handling can be referred to solution 2 for SGW failure without ISR
> in subclause 6.3.2.
2) Downlink Data packets or signalling arrives at the PGW
> This step handling can be referred to solution 2 for SGW failure without ISR
> in subclause 6.3.2. In addition, if the MME/S4-SGSN received a PGW Downlink
> Triggering Notification message containing MME Identifier or S4-SGSN
> Identifier from the SGW for those UEs of which PDN Connections are
> associated with failed SGW, the MME/S4-SGSN shall process the PGW Downlink
> Triggering Notification message and send the Paging Indication message
> (newly defined) over S3 interface to the ISR associated S4 SGSN/MME over the
> existing GTP-C tunnel between S4 SGSN and MME
>
> The ISR associated S4-SGSN/MME, which receives Paging Indication message,
> performs P-TMSI/S-TMSI paging in the step3.
3) The MME and S4-SGSN perform Network Initiated Service Request procedure as
specified in subclause 5.3.4.3 of 3GPP TS 23.401[6] and in subclause 6.12.1A
of 3GPP TS 23.060[7] with the following:
> After the MME/S4-SGSN receiving NAS message Service Request, the MME/S4-SGSN
> may send \"ISR deactivation Indication\" (newly defined) message to the ISR
> associated S4-SGSN/MME and the MME/S4-SGSN shall perform the GUTI/P-TMSI
> Reallocation procedure with a new TAI list/RAI as specified in 3GPP TS
> 23.401 [6] and 3GPP TS 23.060 [7] and the UE will initiate the TAU/RAU
> procedure during which ISR can be deactivated in the UE. At this point, the
> MME/S4-SGSN also deactivates ISR locally. On reception of the \"ISR
> deactivation Indication\" message, the ISR associated S4-SGSN/MME releases
> the UE sessions locally. The MME/S4-SGSN then start the SGW restoration
> procedure as specified in subclause 6.3.
###### 6.5.3.3.1.2 Mobile Originating Service handling
1) When receiving the UE initiated TAU Request/RAU Request message, if it is
intra MME/S4-SGSN TAU/RAU, the MME/S4 SGSN performs the SGW relocation
procedure as specified in subclause 6.3, and informs the UE in the related
TAU/RAU Accept message to disable ISR as specified in 3GPP TS 23.401[19] and
3GPP TS 23.060 [5]. Else if the MME/S4-SGSN is changed, the ISR shall be
deactivated in the UE by the new MME/S4-SGSN, and the old MME or the old
S4-SGSN notifies the new MME or S4-SGSN to perform the SGW relocation
procedure as specified in subclause 6.3.
2) When receiving the UE initiated Service Request message, the MME/S4 SGSN
performs the SGW relocation procedure as specified in subclause 6.3, and
initiates the GUTI Relocation or P-TMSI Relocation Procedure with a non-
broadcast TAI or RAI to force the UE to perform the TAU/RAU procedure for ISR
deactivation.
3) SGW relocation in Handover procedure is handled according to the definition
in subclause 6.3, and the ISR will be deactivated in the UE during the Service
request/TAU/RAU procedure as described in the above steps.
In these MO procedures, the MME/S4-SGSN may send \"ISR deactivation
Indication\" message to the ISR associated S4-SGSN/MME to deactivate ISR and
remove the UE sessions.
##### 6.5.3.3.2 Evaluation
###### 6.5.3.3.2.1 Pros
> **The mobile terminating services can be delivered to the idle UEs** : The
> PGW triggered paging request upon receiving downlink data at the SGW restart
> or failure makes sure the terminating services can be delivered to the idle
> UEs.
>
> **Avoid potential signalling overload in the network due to SGW failure:**
> This solution which based on the received downlink traffic can spread
> signalling traffic for restoration of EPS Service over the time. The
> MME/S4-SGSNs which are associated the failed SGW can make use of the Service
> Request, which is the result of paging request triggered by PGW, to perform
> SGW relocation. For those Idle UEs, e.g. without performing service request,
> TAU/RAU, the SGW relocation procedure could be performed until next Periodic
> TAU/RAU.
>
> **The mobile originating services will be not affected:** The MME/S4 SGSN
> performed SGW relocation procedure and triggered the UE deactivate the ISR
> state on receiving the NAS message.
###### 6.5.3.3.2.2 Cons
> **Extra Signalling introduced in the network:** Extra signalling over S4/S11
> interface when the SGW forwards paging request without MME/S4-SGSN
> identifier from PGW. Extra signalling over S3 to request the ISR associated
> mobility management node to page the UE.
>
> **Extra Processing and Memory needed in PGW during normal mode of
> operation** : The PGW needs to process and store MME/S4-SGSN identifier per
> PDN connection.
#### 6.5.3.4 Solution 4: Preconfigured Node to restore SGW
##### 6.5.3.4.1 Description
The solution is based on Solution 1 of SGW restoration without ISR. This
involves MME or SGSN sending Create Session Request proactively to new SGW
which then in turn sends Modify Bearer Request to PGW. The SGW and PGW behave
as if inter-SGW HO has occurred. However because ISR is active, the UE may be
in SGSN or MME service area and may trigger Service Request for uplink data.
If the UE is not in the node which in triggering Create Session Requests then
handling of such a request is tricky as a race condition can occur which can
cause the PGW to receive modify Bearer Requests from 2 different SGWs one
chosen by MME and other chosen by SGSN. The solution below describes how to
resolve the race condition:
1) Configuration:
> The operator configures either the MME or SGSN to take lead of choosing SGW
> and sending the Create Session Requests. For ease of description we call
> such a node configured to initiate SGW restoration as Configured Node and
> the other ISR associated node as Non-configured node.
2) Restoration by Configured Node:
> When SGW failure is detected and Service Restoration procedure is triggered,
> the Configured Node initiates the process of SGW restoration as described in
> Solution 1 for non-ISR case (section 6.3.1). Additionally when ISR is
> activated, the Configured Node sends an S3 message carrying the new SGW\'s
> FQDN and the S4/S11 SGW F-TEID information to the other mobility management
> node (S4-SGSN or MME) where the ISR was activated.
>
> When SGW failure is detected by the MME/SGSN and PGW, the MME/SGSN and PGW
> start a timer for all the PDN connections impacted by the failure. Upon
> expiry of the timer, the MME/SGSN and PGW shall delete all the non-restored
> PDN connections.
3) Handling of UE initiated Service Request Procedure and TAU/RAU procedure:
> During the time between SGW failure and SGW Restoration, there is a
> possibility that UE triggers a service request procedure and/or TAU/RAU
> procedure. If the UE is in the service area of the Configured Node, the node
> behaves as described in Step 1 of Section 6.5.3.2.1 (i.e. it relocates the
> SGW before informing the non-Configured node of SGW FQDN etc).
>
> If the UE is in the service area of non-Configured Node, the non-Configured
> Node rejects the NAS signalling with 'Cause #9: UE Identity cannot be
> derived by the network' which triggers the UE to reattach.
>
> Additionally, the Non-Configured Node sends Detach Notification with cause
> 'Complete Detach' to the Configured Node. This triggers the Configured Node
> to locally delete the UE context. If the SGW restoration is completed for
> such a UE, the Configured Node shall delete the PDN connections for the UE.
> The PDN connections for such UEs which have been locally deleted will remain
> in PGW till the timer configured (as defined in step 1 of 6.3.1.1) expires.
> If the Configured Node has already restored the session when it receives the
> Detach Notification, the Configured Node should send Delete Session Request
> to clean up the PDN connections.
>
> When an ISR enabled UE performs an inter-SGSN RAU or inter-MME TAU
> procedure, the context request for an RAU is sent to the ISR associated SGSN
> while the context request for TAU is sent to ISR associated MME. If the
> context request is received by the Non-Configured Node before the SGW
> restoration is completed by Configured Node, the context request should be
> rejected by the non-Configured Node with cause 'context not found'. This
> forces the UE to reattach in the target node. Additionally, the non-
> Configured Node also sends Detach Notification to the Configured Node as
> described earlier.
>
> If the context request is received by the Configured Node before the SGW
> restoration is completed, the context response contains an indication
> specifying that the 'SGW Restoration is pending'. This indication will
> ensure that the target node will restore the SGW before accepting RAU/TAU.
> Additionally, the Configured Node should not indicate 'ISR capability', thus
> forcing the UE to be ISR disabled after the TAU/RAU procedure. In such a
> case the Configured Node deletes the UE context (as described in TAU
> procedure of 23.401 or RAU procedure of 23.060). However the UE context in
> the Non-Configured Node is deleted only after the SGW Restoration timer
> expires (as described in step 1).
##### 6.5.3.4.2 Evaluation
###### 6.5.3.4.2.1 Pros
This subclause lists the pros of solution 6.5.3.4 as following:
> **Minimized interruption of Network Triggered Services** : When the SGW
> fails the MT services are impacted as UP packets cannot be tunneled to
> eNodeB. However, when MME or SGSN triggers the service restoration by
> relocating SGW, the service interruption is reduced. .
###### 6.5.3.4.2.2 Cons
This subclause lists the cons of solution 4 as following:
> **Some UEs are forced to reattach:** When the UEs initiate Service Request
> in non-Configured Node, the UE is forced to reattach which delays the UE
> initiated service request by the duration required for re-attach. However
> this only happens for those UEs which are ISR enabled UEs and which are
> impacted by SGW failure and which initiate UE initiated Service Request
> before the Configured Node could trigger SGW restoration. This leads to a
> delay in MO service request for such UEs.
>
> **Hanging PDN connections:** It is possible that the same PDN GW is not
> chosen by the non-configured node. In this case the old PDN GW will be left
> with some hanging PDN connections which will have to be deleted by having a
> idle timer.
>
> **MT Call service interruption:** The MT services cannot be delivered to the
> UE for the period between the SGW failure and SGW restoration by configured
> node or service request by the UE.
## 6.6 Restoration of CS services after MME failure
### 6.6.1 Introduction
This clause investigates possible solutions preventing failure of Mobile
Terminated CS services upon an MME failure without restart or restarting after
delay. See clause 5.2.3.1 \"Outage of CS services\".
### 6.6.2 Alternative Solutions for Restoration of CS services after MME
failure
#### 6.6.2.1 Solution 1 -- MT CS services delivery via an alternative MME in
MME pool
##### 6.6.2.1.1 Description
This solution enables the network to continue delivering MT CS services (e.g.
CSFB or SMSoSGs) to UEs via an alternative MME in the MME pool where the UE is
located.
This solution includes the following steps:
1) The VLR gets the knowledge of the identities of alternative MMEs in the MME
pool.
> During normal operations, the VLR may learn the set of MMEs pertaining to
> the same MME pool by checking the MME Group ID within the MME name that MMEs
> signal to the VLR in the SGsAP-LOCATION-UDATE-REQUEST, SGsAP-RESET-
> INDICATION or SGsAP-RESET-ACK messages..
>
> Alternatively the VLR may be pre-configured with the set of MME identities
> pertaining to the same MME pool.
2) Upon receipt of mobile terminated CS services (e.g. CS call), the VLR
selects one of these alternative MMEs if it detects that the MME serving the
UE is no longer in service and sends a SGs paging request to this (single)
alternative MME with a new \'restoration indicator\' flag in the message. The
VLR should load-balance the paging requests among the available MMEs in the
pool during the restoration procedure.
> The VLR may detect that an MME is no longer in service if there is no more
> SCTP associations in service with that MME.
NOTE 1: Semi-permanent SCTP associations shall be established between the MME
and VLR, i.e. the SCTP associations shall remain up under normal
circumstances.
> The VLR includes a new \'restoration indicator\' flag in the SGs paging
> request it sends to the alternative MME to force the receiving MME to accept
> the SGs paging request and to proceed with the CSFB or SMS procedure even if
> the IMSI is unknown to this MME and even if the MME has not restarted
> recently, i.e. even in the \'MME-reset = false\' state.
NOTE 2: Without the new \'restoration indicator\', the receiving MMEs (not
having restarted recently) would reject the SGs paging requests, as per
existing specifications, for unknown UEs.
NOTE 3: This restoration procedure (MT CS services delivery via an alternative
MME in MME pool) works regardless of whether the VLR has restarted recently or
not. In the former case, the restarted VLR initiates the existing CS
restoration procedure upon receipt of the mobile terminated CS service, during
which it retrieves the identity of the MME where the UE is currently
registered; if the VLR detects that this MME is no longer in service, it
selects an alternative MME to deliver the CS service.
NOTE 4: The VLR needs to adjust its paging retransmission delay to avoid
requesting again the UE to re-attach before the restoration procedure
completes.
3) Upon receipt of an SGs paging request including the new \'restoration
indicator\' flag, the MME proceeds with the existing procedures specified in
3GPP TS 29.118 [9] in clause 5.1.3 for the case where it has restarted
recently, but regardless of its own \'MME-reset\' value:
\- if the SG PAGING-REQUEST message includes the Location area identifier
information element, the MME shall page the UE in all the tracking areas
served by the MME that can be mapped to the location area indicated in the
Location area identifier information element; or
\- if the SGsAP-PAGING-REQUEST message does not include the Location area
identifier information element, the MME may either page the UE in all the
tracking areas served by the MME or in the tracking areas served by the MME
and by the VLR, or reject the paging request per operator policy.
> The MME initiates the paging procedure using IMSI with the CN domain
> indicator set to \"PS\" to request the UE to re-attach as described in 3GPP
> TS 24.301 [4].
NOTE 5: Paging the UE with the CN domain indicator set to \"CS\" would lead
the UE to send an Extended Service Request procedure that would be forwarded
to the MME that had allocated the UE\'s S-TMSI or, if not in service, that
would be rejected with a cause leading the UE to re-attach. Besides, CSFB with
IMSI paging would not allow GERAN to route the paging response (including
IMSI) to the right MSC/VLR if Intra Domain Connection of RAN Nodes to Multiple
CN Nodes is deployed for GERAN (see 3GPP TS 23.236 [11]).
4) The UE initiates the attach procedure to one MME of the pool (that may not
be necessarily the MME that initiated the paging procedure towards the UE).
During that procedure, the MME establishes a new SGs association with the VLR.
This may be a different VLR than the VLR that initiated the SGs paging
procedure, e.g. if Intra Domain Connection of RAN Nodes to Multiple CN Nodes
is deployed for GERAN or UTRAN (see 3GPP TS 23.236 [11]).
NOTE 6: In the specific circumstance where the SCTP associations failure
between a VLR and an MME is due to reasons other than the MME being down (e.g.
IP network failure), i.e. where the UE is still served by the original MME
(MME 1), this step leads a UE in idle mode to re-attach to the network and
thus to some slight extra signalling in the network. A UE in connected mode
would not respond to the paging request, i.e. on-going PS sessions would not
be interrupted or handed over to 2G/3G and the MT CS service would not be
delivered to the UE. This scenario remains unlikely thanks to SCTP multihoming
(i.e. the ability for a single SCTP endpoint to support multiple IP addresses,
allowing each side to be connected to the other through different physical
interfaces and/or different IP networks). The VLR may also start delivering MT
CS services via an alternative MME only after the SCTP failure exceeds a
minimum duration.
5) If the new SGs association is established towards the same VLR, that VLR
can repeat the SGs paging request after the UE has re-attached to non-EPS
services. The MT CS service or SMS is then delivered according to existing
procedures (nominal scenario).\ \ If the new SGs association is established
towards a different VLR, the MT CS service may be delivered via the new VLR
using Mobile Terminating Roaming Retry or Mobile Terminating Roaming
Forwarding (see 3GPP TS 23.018 [10]); the on-going MT SMS is retransmitted by
the SMS-SC using the existing SMS procedures (SMS alert).\ \ Subsequent MT CS
services are delivered as per existing nominal procedures.
The procedure is illustrated in the following figure.
{width="6.53125in" height="5.077083333333333in"}
Figure 6.6.2.1.1-1: MT CS services delivery via an alternative MME in MME pool
NOTE 7: Steps 1 and 7 in the figure cover the complete attach procedure for
EPS and non-EPS services (including TMSI reallocation if the VLR allocates a
new TMSI) as specified in subclause 5.2 of 3GPP TS 23.272 [8], although only a
subpart of the procedure is depicted in the call flow for the sake of clarity.
NOTE 8: A UE with ISR active before the MME failure and using GERAN or UTRAN
radio access will not receive the paging request sent by a restarted or
alternative MME. The VLR can deliver the MT CS service by paging the UE on the
A/Iu interface as per existing principles of 3GPP TS 29.118 [9] when the UE
does not respond to a first paging on the SGs interface. Paging the UE on the
A interface fails if the network operates in NMO I and the UE is in PS
connected mode in GERAN.
##### 6.6.2.1.2 Evaluation
###### 6.6.2.1.2.1 Pros
> **MT CS Service after MME Restart: This approach enables the network to
> deliver CS services via EPS/LTE via an alternative MME in the MME pool;**
>
> **Minimal impacts in VLR and MME:** **This solution has minimal impacts on
> the MME (essentially one new 'restoration flag' to support, which if
> received lead to apply existing procedure when IMSI is unknown and MME-reset
> = false) and small VLR impacts (sending SGs paging request to an alternative
> MME);**
###### 6.6.2.1.2.2 Cons
> **First MT CS call may fail:** The first MT CS call fails if during the re-
> attachment of the UE the SGs association is established with a different VLR
> and MTRF/MTRR is not supported.
## 6.7 Detection of EPC Node failure without Restart
### 6.7.1 Introduction
This clause investigates possible solutions to detect EPC node failure without
restart.
### 6.7.2 Solution 1 -- Using Path Management messages
#### 6.7.2.1 Description
The method describes the SGW detection of the MME failure without restart. The
SGW and MME nodes are used as an example for the simplicity of understanding.
In general, the same method can be used by any GTPv2 control plane entity to
detect the failure of the peer node without restart, with replacement of
relevant terminology.
Following counters and configurations at the SGW are used for this method.
**T-Echo-Interval** : The time interval between two echo request messages over
S11 interface. This parameter is configured at the SGW.
**N-Echo-Failure** : Per MME N-Echo-Failure counter is maintained by the SGW
to count the consecutive number of echo request failure, which are not
responded by the MME.
**N-MME-Max-Echo-Failure** : This is maximum allowed consecutive echo request
failure (i.e. echo requests which are not responded by the MME), per MME
before the MME can be considered as failed without restart. This value is
configured at the SGW depending upon the Echo-Interval, the MME node\'s
unscheduled downtime estimation and based on the reliability of the IP layer
connectivity. This value is configured higher, accounting for the loss of
messages depending upon the reliability of IP layer connectivity
{width="6.499305555555556in" height="4.754861111111111in"}
Figure 6.7.2.1-1: Using Path Management messages to detect MME failure without
restart
1) MME is in healthy condition and capable of handling session management and
path management procedures for the new and existing subscriber session. We
term this as MME in \"Active\" state. N-Echo-Failure count is set to \"0\".
2) The SGW initiates path management procedures and sends \"echo request\"
message to the MME S11 interface IP address, after configured time interval --
\"T-Echo-Interval\". Please refer to section 20 of 3GPP TS 23.007 [2].
3) If the MME is \"Active\", it shall respond to the \"echo request\" by
sending \"echo response\" message to the SGW.
4) If the \"echo response\" or \"echo request\" message is received from the
MME, SGW compares the \"restart counter\" value as received in the message.
> The change in the \"restart counter\" value signifies MME has failed and
> restarted. The corresponding procedure to handle \"MME failure with
> restart\" is executed by the SGW. Once completed, the procedure from step 1
> is executed by the SGW.
If there is no change in the \"restart counter\" value, then the MME is in
healthy condition and there is no MME failure. The procedure from step 1 is
executed by the SGW.
5) If SGW does not receive any \"echo response\" or \"echo request\" message,
the N-Echo-Failure count is incremented.
6) The N-Echo-Failure count value is compared with the N-MME-Max-Echo-Failure
count value. If limit is not reached, the SGW executes procedure from step 2.
7) If the N-Echo-Failure count has exceeded the configured value of N-MME-Max-
Echo-Failure count, the MME failure without restart is detected by the SGW.
## 6.8 EPC Node Restoration for Partial Failure of EPC nodes
### 6.8.0 Solutions for general enhancement to the Partial Failure when ISR is
active
#### 6.8.0.1 Solution 1 : Keep MME FQ-CSID in the PGW when UE is ISR activated
##### 6.8.0.1.1 Description
The preconditions of this solution are:
1) The MME, the SGW and the PGW support Partial failure feature;
2) The SGW, the MME and the S4-SGSN support ISR feature, and ISR will be
activated for the UEs.
The solution makes it possible that the MME can still retrieve the affected
PDN connection indicated by PGW FQ-CSID included in Delete PDN Connection Set
Request message sent from the SGW to the MME if the PGW FQ-CSID is not changed
or has been updated in the MME when the PGW experiences a Partial failure.
The solution also makes it possible that the MME can still retrieve the
affected PDN connection indicated by SGW FQ-CSID included in Delete PDN
Connection Set Request message sent from the SGW to the MME if the SGW FQ-CSID
is not changed or has been updated in the MME when the SGW experiences a
Partial failure.
The solution consists in following enhancements:
  1. During an inter MME to S4-SGSN RAU procedure, or an inter SGSN to MME TAU procedure, the ISR will be activated. When the SGW receives the Modify Bearer Request message where ISR is indicated to be activated, the SGW shall include the MME FQ-CSID and a new flag called RIPI (Restriction Indication for Partial failure when ISR active) in the Modify Bearer Request over S5/S8 to the PGW, where the RIPI flag indicates that some restrictions as below in the bullets c and d shall be applied for the PGW.
  2. After RAU/TAU procedure and as long as the ISR is activated, the following apply:
a. The SGW shall not change SGW FQ-CSID assigned before ISR activation if the
undergoing procedure does not to involve the MME and the PGW, because the MME
and the PGW cannot updated the SGW FQ-CSID.
b. The SGW shall include either the existing MME FQ-CSID or a new MME FQ-CSID
in a message sent over S5/S8 when the SGW FQ-CSID is to be included; The SGW
shall also include and set the RIPI flag in a message to the PGW as long as
ISR is activated.
c. The PGW shall keep the MME FQ-CSID and the PGW shall not change PGW FQ-CSID
assigned before receiving the first Modify Bearer Request message with the
RIPI flag set until it receives a message without RIPI flag set.
d. When Delete PDN Connection Set request message including the stored MME FQ-
CSID is received and if for the UE with RIPI flag set, the PGW shall only
delete the stored MME FQ-CSID but not the associated PDN connection; for other
UEs without RIPI flag set, the PGW delete the corresponding PDN connection as
specified in 3GPP TS 23007 [2].
e. When the MME deactivates ISR, e.g. when SGSN restarts, the SGW shall send
Modify Bearer Request message or Update PDN connection set request message
when using Modify Bearer Request is not possible without setting the RIPI
flag.
f. When the SGSN deactivates ISR, e.g. when MME restarts, the SGW shall send
Modify Bearer Request message or Update PDN connection set request message
when using Modify Bearer Request is not possible without setting the RIPI flag
and MME FQ-CSID.
  3. When the UE further moves to another SGSN, where the ISR will be deactivated, the SGW shall use Modify Bearer Request message or Update PDN Connection Set Request message when using Modify Bearer Request is not possible, without providing MME FQ-CSID and without setting the RIPI flag to remove the stored MME FQ-CSID in the PGW. When the UE further moves to another MME, where the ISR will be deactivated, the SGW shall use Modify Bearer Request message or Update PDN Connection Set Request message when using Modify Bearer Request is not possible, together with the new MME FQ-CSID to update the old MME FQ-CSID in the PGW, the RIPI flag shall not be set.
##### 6.8.0.1.2 Evaluation
###### 6.8.0.1.2.1 Pros
This subclause lists the pros of solution 1 - Keep MME FQ-CSID in the PGW when
UE is ISR activatedas following:
> **The advantage of using Partial failure will remain even when ISR is
> activated** : The solution solves problem that when ISR is activated,
> unsynchronized FQ-CSID(s) leads Partial failure feature cannot be utilised,
> i.e. massive signalling over S11 and S5/S8 at EPC node partial failure.
###### 6.8.0.1.2.2 Cons
This subclause lists the cons of solution 1- Keep MME FQ-CSID in the PGW when
UE is ISR activated as following:
> **The SGW and PGW cannot change the FQ-CSID assigned before ISR
> activation:** In certain cases, the SGW and PGW cannot change the FQ-CSID
> assigned before ISR activation since the MME may not be able to update those
> changes.
### 6.8.1 Alternative Solutions for MME Partial Failure
#### 6.8.1.1 Solution 1: S4-SGSN Clean up when SGW or MME does not support
Network Triggered Restoration for MME partial failure
##### 6.8.1.1.1 Description
This solution is to solve the case when the MME and/or SGW does not support
Network Triggered Restoration procedure and SGW receives a Delete PDN
Connection Set Request from MME containing FQ-CSID corresponding to partial
failure.
###### 6.8.1.1.1.1 Clean-up initiated by SGW procedure
When the MME or SGW does not support Network Triggered Restoration, the SGW
upon receipt of Delete Connection Set Request from the MME:
1) Retrieves all the PDN connections corresponding to each of the MME FQ-
CSID(s). The SGW shall send S5/S8 Delete PDN Connection Set Request (or PMIPv6
Binding Revocation Indication with the G bit set) containing the FQ-CSID(s)
received from the MME to PDN GW as described in 3GPP TS 23.007 [2].
2) Initiates Delete Bearer Request towards ISR associated S4-SGSN associated
with the UE for all the retrieved PDN connections affected by the partial
failure in MME. All the PDN connections for the UE would be deleted. When the
UE initiates a Service Request/RAU procedure, the UE would be forced to
reattach to the PDN connections.
3) SGW also locally deletes all the PDN connections as indicated by the MME
FQ-CSID(s) and also forward the Delete PDN connection request to PDN GW.
##### 6.8.1.1.2 Evaluation
###### 6.8.1.1.2.1 Pros
This subclause lists the pros of solution 1:
> **Works with legacy S4-SGSNs: This solution does not expect any additional
> support for S4-SGSN;**
###### 6.8.1.1.2.2 Cons
This subclause lists the cons of solution 1:
> **May cause signalling overload on S4 interface:** Since individual sessions
> have to be deleted from SGSN, the procedure can cause signalling overload on
> S4 interface.
Editor's Note: The interaction of MME partial failure and ISR may need further
analysis. This may impact the solutions described below when ISR is enabled.
#### 6.8.1.2 Solution 2 -- Based on Network Triggered Service Restoration for
complete MME failure w/o sending Delete PDN Connection Set Request to PGW
##### 6.8.1.2.1 Description
The solution for network triggered service restoration is same as explained in
Section 25 of 3GPP TS 23.007 [2] where the PDN connection which are associated
with the FQ-CSID received in delete PDN connection set request which are
eligible for network restoration. The SGW processes Delete Connection Set
request received from the MME but does not relay it to the PDN GW.
The SGW starts a timer upon receipt of the Delete PDN Connection Set request.
When this timer expires, the SGW locally deletes all the PDN connections
affected by the MME partial Failure which were not restored. The SGW may
additionally clean up the PDN GW context by sending Delete Session Requests
for individual PDN connections.
NOTE: The timer in SGW is the same timer as explained in Clause 25 of 3GPP TS
23.007[2].
##### 6.8.1.2.2 Evaluation
###### 6.8.1.2.2.1 Pros
> **Works with pre-rel-11 MME and PGW: Since this procedure does not change
> the behavior in MME and PGW, this procedure will work with Rel-10 MME which
> supports Network Triggered Restoration and a Rel-8 PGW.;**
>
> **EPS Service after MME Partial failure: This approach enables UEs to make
> the re-attach to the EPS possible triggered by an arrival of the downlink
> packet after the MME has partial failed**
###### 6.8.1.2.2.2 Cons
> **Hanging resources or signalling overload in the SGW and PGW:** If SGW does
> not send Delete Session Requests for individual PDN connections, this
> mechanism causes hanging PDN connection in PDN GW. Else it may cause
> signalling overload in SGW and PGW.
>
> **Maintained resources in the SGW and PGW after MME Partial failure
> detection:** This approach requires reservation of UE resource (S5/S8 bearer
> contexts) until downlink packets arrives for the UE or timer set in SGW
> expires. However comparing the network resources allocated for the affected
> UEs before and after the MME partial failure, the network (SGW and PGW)
> doesn\'t allocate any extra resource.
>
> **Delayed Deletion for PDN connection not eligible for restoration** : If
> same CSID is used by the MME for the PDN connections which are eligible for
> restoration and those not eligible for restoration, the PDN connections not
> eligible for restoration will only get deleted after the SGW timer expires.
#### 6.8.1.3 Solution 3 -- Based on Network Triggered Service Restoration for
complete MME failure with delayed sending of Delete PDN Connection Set Request
to PGW
##### 6.8.1.3.1 Description
The solution for network triggered service restoration is same as explained in
Section 25 of 3GPP TS 23.007[2] where the PDN connection which are associated
with the FQ-CSID received in delete PDN connection set request which are
eligible for network restoration. The SGW processes Delete Connection Set
Request received from the MME but does not relay to the PDN GW.
The SGW starts a timer is started upon receipt of the Delete PDN Connection
Set Request. When this timer expires, the SGW sends a delete PDN Connection
Set Request along with the FQ-CSID received from the MME to PDN GW. The
solution requires that the MME does not reallocate the same CSID to new PDN
connections established after the MME partial failure before the SGW timer
expiry. Once the PDN GW receives the Delete PDN Connection Set Request, all
the PDN Connections related to the failed FQ-CSID are deleted.
The impacted UEs which performed a TAI or service request procedure before the
timer expired, would have re-established the PDN connections (with new MME FQ-
CSID(s)). The other UEs which perform RAU in SGSN area after the TAI timer in
the UE expired would have ISR disabled.
The UE for which the TAU timer has expired starts implicit detach timer. Once
the implicit detach timer expires while the UE is still in SGSN service area,
the UE disables the ISR. When RAU timer expires for the ISR disabled UE, the
SGSN sends Modify Bearer Request with ISRAI bit not set.
An SGW which receives a Modify Bearer request from the SGSN without ISRAI set,
shall deregister the MME FQ-CSID which is registered for the UE by sending
Modify Bearer Request message or Update PDN Connection Set Request. This
clears the MME FQ-CSID in the PDN GW. Thus these UEs PDN connections will not
get deleted when SGW forwards the Delete PDN Connection Set Request.
NOTE: The value of the timer in SGW may be equal to the periodic tracking area
update timer (timer T3412) as specified in the 3GPP TS 24.301 [4]. There is
one DLDTA timer in the SGW. When ISR has been enabled in the network, the
value of the timer in SGW may be equal to twice the value of the periodic
tracking area timer or periodic routing area timer (whichever is higher).
##### 6.8.1.3.2 Evaluation
###### 6.8.1.3.2.1 Pros
> **No Hanging PDN connection in PDN GW or Signalling overload: Since no
> individual session level signalling is done for cleaning up of resources,
> there are no hanging PDN connections or risk of signalling overload (once
> the timer in SGW expires).**
>
> **EPS Service after MME Partial failure: This approach enables UEs to make
> the re-attach to the EPS possible triggered by an arrival of the downlink
> packet after the MME has partial failed**
###### 6.8.1.3.2.2 Cons
> **Maintained resources in the SGW and PGW after MME Partial failure
> detection:** This approach requires reservation of UE resource (S5/S8 bearer
> contexts) until downlink packets arrives for the UE or timer set in SGW
> expires. However comparing the network resources allocated for the affected
> UEs before and after the MME partial failure, the network (SGW and PGW)
> doesn\'t allocate any extra resource.
>
> **Delayed Deletion for PDN connection not eligible for restoration:** If
> same CSID is used by the MME for the PDN connections which are eligible for
> restoration and those not eligible for restoration, the PDN connections not
> eligible for restoration will only get deleted after the SGW timer expires.
### 6.8.2 Alternative Solutions for SGW Partial failure
#### 6.8.2.1 Solution 1 : SGW relocation at the SGW Partial Failure
##### 6.8.2.1.1 Description
The solution makes it is possible that the terminating service such as IMS
voice could be delivered to the affected UE(s) even after SGW partial failure
and the solution also enables those affected UE due to the SGW partial failure
need not perform re-attach to the EPS to allow the service continuity. The
MME, SGW and PGW can use the existing Partial Failure procedures to exchange
the capability to support this solution and as well as related information to
make sure that the solution works with the same logic.
NOTE 1: Inclusion of the related information is optional, where the PGW could
indicate to the MME at the first time to contact, based what criteria e.g. the
value of ARP, QCI and APN, the affected PDN connection should be maintained.
By default, all affected PDN connection will be maintained.
Editor's Note: The interaction between MME and PGW to decide of which effected
PDN connection are applicable to the solution need further study.
The solution consists in applying the Solution 1 for SGW failure by
MME/S4-SGSN re-establishing resources with a new SGW or to the old SGW after
its recovery as specified in the subclause 6.3.1 of the present document, and
Solution 2 for SGW failure by PGW initiated paging request at receiving
downlink data/signalling as specified in 6.3.2 of the present document, only
to the PDN connections affected by the SGW partial failure, with the following
differences:
1) The MME and PGW detect the SGW partial failure by receiving Delete PDN
Connection Set Request message.
2) The PGW always include the MME identifier when sending the new Paging
Request message.
##### 6.8.2.1.2 Evaluation
###### 6.8.2.1.2.1 Pros
This subclause lists the pros of solution 1 - SGW relocation at the SGW
Partial Failure as following:
> **Re-establishments of resources in SGW transparent to the UE:** The MME
> performs the SGW relocation signalling within the network nodes. In other
> nodes, unless PGW/PCRF changes any bearer or its properties, the SGW
> relocation signalling due to SGW partial failure does not require any
> signalling between the UE and the network.
>
> **The terminating services can be delivered to the idle UEs** : The PGW
> triggered paging request upon receiving downlink data at the SGW partial
> failure makes sure the terminating services can be delivered to the idle
> UEs.
###### 6.8.2.1.2.2 Cons
This subclause lists the cons of solution 1- SGW relocation at the SGW Partial
Failure as following:
> **Maintained associated resources in the MME and PGW after SGW partial
> failure detection:** The MME and PGW maintain resources (MM contexts and
> bearer contexts) for the affected UE(s) after SGW partial failure detection
> during the procedure of re-establishing resources with a SGW in comparison
> with the existing requirement that the affected PDN connections are deleted.
> However comparing the network resources allocated for the affected UEs
> before and after the SGW partial failure, the network (PGW and MME) doesn\'t
> allocate any extra resource.
#### 6.8.2.2 Solution 2 : SGW relocation at the SGW Partial Failure when ISR
is active
##### 6.8.2.2.1 Description
The solution makes it is possible that the terminating service such as IMS
voice could be delivered to the affected UE(s) even after SGW partial failure
and the UEs are ISR activated, and the solution also enables those affected UE
due to the SGW partial failure need not perform re-attach to the EPS to allow
the service continuity. The solution assumes both ISR and Partial failure
feature are deployed and activated in the network. In the present solution,
the SGW is required to not change SGW FQ-CSID assigned before ISR activation
if the undergoing procedure need not to contact the MME, i.e. MME cannot
updated the SGW FQ-CSID.
Editor's Note : Whether there are more preconditions for this solution is FFS.
The MME, SGW and PGW can use the existing Partial Failure procedures to
exchange the capability to support this solution and as well as related
information to make sure that the solution works with the same logic. In
addition, the MME and S4-SGSN can use Context Transfer procedure or the
procedure for the Notification of supported features between peer GTP-C
entities, to exchange the capability to support this solution and as well as
related information to make sure that the solution works with the same logic.
NOTE 1: Inclusion of the related information is optional, where at the first
time to contact, the information that based on what criteria e.g. the value of
ARP, QCI and APN, the affected PDN connection should be maintained can be
exchanged. The receiver of such related information may not attempt to change
such information. By default, all affected PDN connection will be maintained.
Editor's Note : The interaction between MME/S4-SGSN and PGW to decide of which
effected PDN connection are applicable to the solution need further study.
The solution consists in applying the Solution 2 for SGW failure: Maintain the
ISR state as specified in the subclause 6.5.3.2 of the present document, only
to the PDN connections affected by the SGW partial failure, with the following
differences:
1) The MME and PGW detect the SGW partial failure by receiving Delete PDN
Connection Set Request message.
2) The MME informs the ISR associated node S4-SGSN about the SGW had a Partial
failure and also if the solution should be carried out with per UE message,
which is indicating the affected PDN connections.
3) The PGW always include the MME identifier (part of MME FQ-CSID) when
sending the new Paging Request message.
##### 6.8.2.2.2 Evaluation
###### 6.8.2.2.2.1 Pros
This subclause lists the pros of solution 2 - SGW relocation at the SGW
Partial Failure when ISR is active as following:
> **EPS Services can be delivered to those ISR activated UE** : The solution
> solves problem that ISR state is unsynchronized between network and UE, and
> it makes sure that EPS Services can be delivered to those ISR activated UEs
> which have been relocated to a new SGW.
###### 6.8.2.2.2.2 Cons
This subclause lists the cons of solution 2- SGW relocation at the SGW Partial
Failure when ISR is active as following:
> **Extra Signalling introduced in the network:** Extra signalling over S3 to
> request the ISR associated mobility management node to select the same SGW
> to maintain ISR activated for each affected UEs due to SGW Partial failure;
> Extra signalling over S3 to request the ISR associated mobility management
> node to remove UE context when UE has moved to another MME or S4-SGSN; Extra
> signalling over S3 to allow the MME inform the ISR associated node S4-SGSN
> about the SGW partial failure.
>
> **Some UEs are forced to reattach:** Before the S4-SGSN gets notified about
> SGW had a Partial failure by the MME, and if the UE send any uplink NAS
> messages which leads S4-SGSN to contact the SGW, the UE will be forced to
> re-attach to the network, however services are still restored.
###
### 6.8.3 Alternative Solutions for PGW failure
#### 6.8.3.1 Solution 1 for PGW partial failure
##### 6.8.3.1.1 Description
When ISR is not active and the MME detects the PGW has a Partial failure by
receiving Delete PDN Connection Set Request containing PGW FQ-CSID from the
SGW, the MME should release corresponding the PDN connections. If the UE has
multiple PDN connections, the MME may send the release cause \"reactivation
required\" to the UE. If the UE has only one PDN connections, the MME may send
the release cause \"explicit detach with reattach required\" to the UE.
##### 6.8.3.1.2 Evaluation
###### 6.8.3.1.2.1 Pros
This subclause lists the pros of solution 1 for PGW Partial failure as
following:
> **Service recovery soon:** The service will be recovered soon if the release
> cause \"reactivation required\" or \"explicit detach with reattach
> required\" is sent to UE.
###### 6.8.3.1.2.2 Cons
This subclause lists the cons of solution 1 for PGW Partial failure as
following:
> **Possible RAN overload:** When the MME detects the PGW has a partial
> failure, the MME may perform cleanup external resources including at eNodeB
> and UE. This may cause RAN overload.
## 6.9 EPC Node Restoration for Partial Failure of EPC nodes when ISR is
active
### 6.9.0 General
Solutions in this clause are on top of Solution 1 for Keeping MME FQ-CSID in
the PGW when UE is ISR activated as described in section 6.8.0.1.
### 6.9.1 Alternative Solutions for MME Partial Failure
#### 6.9.1.1 Solution1 : IMSI paging in E-UTRAN access and TMSI paging in
other access
##### 6.9.1.1.1 Description
The preconditions of this solution are 1) The MME, the SGW and the PGW support
partial failure feature; 2) The SGW, the MME and the S4-SGSN support ISR
feature, and ISR will be activated for the UEs; 3) The MME and the SGW support
the network triggered service restoration procedure as explained in Section 25
of 3GPP TS 23.007 [2].
When partial failure happened in the MME, the MME sends the Delete PDN
Connection Set Request message to the SGW, FQ-CSIDs are included to identify
the impacted PDN Connections. When the SGW receives this message:
1) The SGW maintains the UE contexts:
> After receiving the Delete PDN Connection Set request from the MME, the SGW
> does not relay it to the PDN GW. And instead of removing associated
> resources, the SGW maintains the UE contexts after the detection of partial
> failure in the MME.
>
> When SGW starts maintaining the UE bearers, SGW starts a timer for
> corresponding MME, e.g. ISR deactivate timer. The timer value may be equal
> to or bit longer than the periodic tracking area update timer (timer T3412)
> as specified in 3GPP TS 24.301 [4]. If the timer expires, the ISR resources
> (i.e. MME control plane address and TEID) shall be locally deleted. When SGW
> receives the Create Session Request message for the UE, the SGW deletes all
> maintained resources for the UE and then proceeds with the Create Session
> Request message handling as specified in 3GPP TS 29.274 [3]. Upon receiving
> indication that ISR is deactivated in the UE from MME/S4-SGSN, the SGW shall
> stop the timer and delete any ISR resources for the UE.
2) The SGW notifies the SGSN about the partial failure:
> The SGW sends new message(s) including the identity of the impacted Users to
> the S4-SGSN, this step can also be executed by the MME. S4-SGSN replies the
> notification message(s) and deactivates ISR for the users. This can be
> achieved by only one message including multiple users' identities, or one
> message per UE.
3) The S4-SGSN deactivates ISR in the GPRS Ready/PMM_CONNECTED UE:
> The S4-SGSN should perform the P-TMSI Reallocation procedure with a new RAI
> as specified in 3GPP TS 23.060 [7] and the UE will initiate a RAU procedure
> during which ISR can be deactivated in the UE.
4) Downlink data packets or signalling arrives to the SGW for the UE in
GPRS_STANDBY/PMM_IDLE state while the timer in the step1) is still running.
> When the SGW receives a downlink user plane or control plane packet on a
> maintained S5/S8 bearer, the SGW shall initiate the network triggered
> service request procedure towards the SGSN as specified in 3GPP TS 23.401
> [6] subclause 5.3.4.3. In addition, if the S5/S8 bearer is eligible for
> network initiated service restoration, the SGW shall also immediately send
> an enhanced Downlink Data Notification message including IMSI to the MME.
>
> The S5/S8 bearers eligible for network initiated service restoration are
> determined by the SGW based on operator\'s policy e.g. based on the QCI
> and/or ARP and/or APN.
5) The MME pages the UE and forces the UE to re-attach to the network, and the
normal S4-SGSN pages the UE in the RAI using the P-TMSI.
> When UE camps in the MME related network, the paging procedure and UE
> behaviour upon receiving the paging message is as specified in the subclause
> 25 \"network triggered service restoration procedure\" of the 3GPP TS 23.007
> [5].
>
> When UE camps on the S4-SGSN related network, the UE behaviour upon
> receiving the paging message is as specified in subclause 4.7.9.1.1 of the
> 3GPP TS 24.008 [5] or subclause 8.1.4 of the 3GPP TS 23.060 [7].
6) If the UE initiates the RAU, ISR is deactivated during this procedure. If
the Service Request procedure is initiated, the S4-SGSN should perform the
P-TMSI Reallocation procedure with a new RAI as specified in 3GPP TS 23.060
[7] after the service request procedure and the UE will initiate a RAU
procedure during which ISR can be deactivated in the UE.
##### 6.9.0.1.2 Evaluation
###### 6.9.0.1.2.1 Pros
This subclause lists the pros of solution 1 for MME partial failure when ISR
is active as following:
> **No inter PLMN dependency:** This approach does not require any support
> from the EPC node across PLMNs. The approach only requires support in the
> SGW and MME/SGSN.
>
> **UE can be paged even when UE camps in the MME service area:** When the SGW
> detects the partial failure in the MME, and the UE is activated in SGSN/MME
> or in idle state, SGW shall maintain the associated bearer contexts
> including the ISR resource. When UE camps in the MME service area, if MT
> service is initiated, the IMSI paging will be performed in MME side, and the
> UE starts the reattach procedure.
>
> **Mobile Terminated Service:** When the SGW receives the downlink packets on
> the maintained bearers which will trigger the paging, if UE activated in the
> SGSN side instead of the MME side, an S-TMSI paging or P-TMSI paging will
> performed in the SGSN side to keep the service continuity.
>
> **ISR deactivation in the UE:** When the UE camps in the MME service area,
> ISR can be deactivated by the re-attach procedure. When the UE camps in the
> SGSN service area, ISR can be deactivated by the initiated/triggered RAU
> procedure.
###### 6.9.0.1.2.2 Cons
This subclause lists the cons of solution 1 for MME partial failure when ISR
is active as following:
> **Resources maintained in the SGW and ISR associated SGSN after the MME
> partial failure detection:** This approach requires reservation of UE
> resource in SGW and ISR associated SGSN, e.g. SGW maintains the restarted
> MME control planes address and TEID the until the timer as specified in the
> step 1) in subclause 6.9.0.1.1 expires.
# 7 Conclusions and recommendations
## 7.1 MME restoration
### 7.1.1 Comparison of proposed solutions
Table 7.1.1-1 comparison of each solution proposed in subclause 6.1
+-------------+-------------+-------------+-------------+-------------+ | | Solution 1 | Solution 2 | Solution 3 | Solution 4 | | | | | | | | | Down Link | r | Pro-active | using the | | | Data | eattachment | Paging | MME | | | Triggered | with HSS | based | self-stored | | | Attach | interaction | approach | paging | | | (DLDTA) | | | information | +-------------+-------------+-------------+-------------+-------------+ | Background | Reactive | Reactive | Proactive | Reactive | | | solution to | solution to | solution to | solution to | | | reattach | reattach | reattach | reattach | | | the UE when | the UE when | the UE | the UE when | | | the first | the first | after the | the first | | | downlink | downlink | MME failure | downlink | | | data packet | data packet | is | data packet | | | is received | is received | detected, | is received | | | for the UE, | for the UE, | by IMSI | for the UE, | | | by IMSI | by IMSI | paging the | by S-TMSI | | | paging the | paging the | UE over the | paging the | | | UE over the | UE over the | last known | UE over the | | | last known | entire MME | location | last known | | | TAI list | area, after | information | TAI list | | | maintained | HSS | maintained | maintained | | | in SGW. | i | in SGW. | in | | | | nteraction. | | n | | | | | | on-volatile | | | | | | memory of | | | | | | MME. | +-------------+-------------+-------------+-------------+-------------+ | Entity | SGW when it | SGW when it | MME when | SGW when it | | triggering | receives | receives | SGW detects | receives | | the UE | downlink | downlink | MME | downlink | | paging | data packet | data packet | failure, | data packet | | | on a bearer | on a | for UEs | on a bearer | | | with e.g. | specific | marked as | with e.g. | | | special | bearer (MME | URCR, e.g. | special | | | value of | or PCRF | based on | value of | | | QCI, APN | policy). | s | QCI, APN | | | (MME | | ubscription | (SGW | | | policy). | | profile, | policy). | | | | | QCI/ARP, | | | | | | operator's | | | | | | policy (MME | | | | | | policy). | | +-------------+-------------+-------------+-------------+-------------+ | EPC nodes | MME | MME | MME | MME | | impacted | | | | | | | SGW | SGW | SGW | SGW | | | | | | | | | | HSS | | | +-------------+-------------+-------------+-------------+-------------+ | Existing | Extra | None. | Extra | None. | | EPC | information | | information | | | procedure | TA list is | | URCR status | | | impacted | required to | | and "DAIP" | | | | pass for | | (MME | | | | each UE in | | imp | | | | the session | | lementation | | | | mobility | | specific | | | | procedures | | container | | | | between SGW | | for | | | | and MME. | | subsequent | | | | Intra MME | | IMSI | | | | intra SGW | | paging) are | | | | TAU may | | required to | | | | require S11 | | pass in the | | | | signalling. | | session | | | | | | mobility | | | | | | procedures | | | | | | between SGW | | | | | | and MME. | | | | | | Intra MME | | | | | | intra SGW | | | | | | TAU may | | | | | | require S11 | | | | | | signalling. | | +-------------+-------------+-------------+-------------+-------------+ | Existing | Node | Node | Node | Node | | EPC | Features | Features | Features | Features | | procedure | n | n | n | n | | dependency | otification | otification | otification | otification | | | (NOTE2, | (NOTE3) | (NOTE2, | (NOTE3) | | | NOTE3) | | NOTE3) | | +-------------+-------------+-------------+-------------+-------------+ | Existing | Signalling | Signalling | Extra | Signalling | | EPC | for paging | for paging | signalling | for paging | | signalling | n | n | for paging | n | | impacted | otification | otification | n | otification | | | (depending | (depending | otification | (depending | | | on | on | between SGW | on | | | terminating | terminating | and MME | terminating | | | traffic) | traffic) | when the | traffic) | | | between SGW | between SGW | MME restart | between SGW | | | and MME | and MME | is | and MME | | | when the | when the | detected. | when the | | | downlink | downlink | This is | downlink | | | data packet | data packet | bulk | data packet | | | arrives | arrives | n | arrives | | | after MME | after MME | otification | after MME | | | restarts as | restarts as | message. | restarts as | | | this is | this is | | this is | | | done per | done per | | done per | | | UE. | UE. | | UE. | +-------------+-------------+-------------+-------------+-------------+ | new EPC | intra MME, | Enhanced | intra MME, | None. | | signalling | intra SGW | Update | intra SGW | | | required | TAU may | Location | TAU may | | | | require S11 | Request | require S11 | | | | signalling | including | signalling | | | | | IMSI and | | | | | | Response | | | | | | are | | | | | | required to | | | | | | support for | | | | | | interaction | | | | | | between MME | | | | | | and HSS. | | | +-------------+-------------+-------------+-------------+-------------+ | Additional | SGW running | SGW running | SGW keeping | SGW running | | EPC | extra timer | extra timer | the extra | extra timer | | resources | to remove | to remove | information | to remove | | required | the hanging | the hanging | "DAIP" for | the hanging | | | PDN | PDN | specific | PDN | | | connections | connections | UEs (as | connections | | | if no | if no | directed by | if no | | | downlink | downlink | MME). | downlink | | | data packet | data packet | | data packet | | | is | is | | is | | | received. | received. | | received. | | | | | | | | | SGW keeping | | | MME stores | | | extra | | | S-TMSI, TAI | | | information | | | list, IMSI | | | TA list for | | | and | | | each UE. | | | possible | | | | | | other | | | | | | parameters | | | | | | in the MME | | | | | | n | | | | | | on-volatile | | | | | | memories. | +-------------+-------------+-------------+-------------+-------------+ | Restarted | Depends on | Depends on | Since the | Depends on | | MME | Terminating | Terminating | proactive | Terminating | | overload | traffic | traffic | paging is | traffic | | impacts | | | done, the | | | | | | MME may | | | | | | need to | | | | | | IMSI page | | | | | | for all | | | | | | URCR | | | | | | enabled | | | | | | UEs. That | | | | | | may cause | | | | | | MME | | | | | | overload. | | +-------------+-------------+-------------+-------------+-------------+ | RAN | the IMSI | Paging in | Since the | Paging with | | resources | paging in | all TA | proactive | S-TMSI, TAI | | impacts | the latest | served by | paging is | list and | | | TAI list | the MME may | done, the | IMSI can | | | can avoid | cause heavy | MME may | limit the | | | paging in | impacts for | need to | scope of | | | all TA | radio | IMSI page | paging that | | | served by | resource. | for all | means can | | | the MME and | | URCR | save RAN | | | save some | | enabled | resource. | | | radio | | UEs. That | | | | resource | | may impact | | | | | | heavy RAN | | | | | | resources | | | | | | | | | | | | the IMSI | | | | | | paging in | | | | | | the latest | | | | | | TAI list | | | | | | can avoid | | | | | | paging in | | | | | | all TA | | | | | | served by | | | | | | the MME and | | | | | | save some | | | | | | radio | | | | | | resource | | +-------------+-------------+-------------+-------------+-------------+ | Impacts on | The first | The first | MO and MT | The first | | EPC | call after | call after | calls will | call after | | services | restart | restart | fail until | restart | | after MME | will fail | will fail | the UE is | will fail | | rest | (IMS voice | (IMS voice | reattached | (IMS voice | | art/failure | , CSFB) | , CSFB) | | , CSFB) | | | until the | until the | | until the | | | UE is | UE is | | UE is | | | reattached | reattached | | reattached | +-------------+-------------+-------------+-------------+-------------+ | Roaming | None | The HSS in | None | None | | impacts | | the HPLMN | | | | | | is required | | | | | | to be | | | | | | enhanced | | | | | | for the | | | | | | inbound | | | | | | roaming UE. | | | +-------------+-------------+-------------+-------------+-------------+ | Covering | Failure | Failure | Failure | Failure | | Scenario | with and | with and | with and | with and | | | without | without | without | without | | Failure | restart | restart | restart | restart | | with | | | | | | Restart/ | | | | | | | | | | | | Failure | | | | | | without | | | | | | Restart/ | | | | | | | | | | | | Failure | | | | | | with and | | | | | | without | | | | | | Restart | | | | | +-------------+-------------+-------------+-------------+-------------+ | Other | | No need to | | No need to | | merits | | pass any | | pass any | | | | extra | | extra | | | | information | | information | | | | on S11 and | | on S11 and | | | | stored in | | stored in | | | | S-GW for | | S-GW for | | | | preparation | | preparation | | | | | | | | | | Double IMSI | | Paging with | | | | paging can | | S-TMSI can | | | | be avoided | | avoid | | | | if the UE | | meaningless | | | | has already | | re-attach | | | | reattached | | process | | | | to another | | e.g. caused | | | | MME | | by IMSI | | | | | | paging even | | | | | | after UE | | | | | | already | | | | | | attached to | | | | | | the | | | | | | different | | | | | | MME. | +-------------+-------------+-------------+-------------+-------------+ | Other | The PDN | The PDN | During the | | | drawbacks | connection | connection | time when | | | | in SGW, PGW | in SGW, PGW | the MME is | | | | may remain | may remain | down, the | | | | hanging if | hanging if | UE may get | | | | the UE | the UE | attached to | | | | attaches to | attaches to | network via | | | | the network | the network | different | | | | via | via | MME, SGW | | | | different | different | and PGW. | | | | (than the | (than the | | | | | original) | original) | Some | | | | MME, SGW | MME, SGW | solution | | | | and PGW | and PGW | might be | | | | until timer | until timer | required to | | | | set on S-GW | set on S-GW | avoid | | | | expired. | expired. | paging for | | | | | | such UE | | | | | Benefit of | when the | | | | | HSS | MME | | | | | interaction | restarts. | | | | | for | | | | | | avoiding | Additional | | | | | double IMSI | mechanism | | | | | paging | to pace the | | | | | might be | UE paging | | | | | limited. | is required | | | | | Most of the | to avoid | | | | | case if UE | Core | | | | | already | network and | | | | | attach to | RAN | | | | | the | resource | | | | | different | impacts. | | | | | MME, few | Re-attach | | | | | down link | process | | | | | packet | includes | | | | | comes to | impact for | | | | | old | EPC | | | | | network. | nodes/IMS | | | | | | nodes/AS | | | | | | for all | | | | | | URCR | | | | | | enabled UEs | | | | | | are | | | | | | occurred. | | | | | | | | | | | | Once UE | | | | | | could not | | | | | | respond | | | | | | IMSI paging | | | | | | e.g. | | | | | | temporally | | | | | | u | | | | | | nreachable, | | | | | | UE cannot | | | | | | receive | | | | | | services | | | | | | until | | | | | | periodic | | | | | | TAU if UE | | | | | | camps on | | | | | | the same TA | | | | | | before and | | | | | | after | | | | | | unreachable | | | | | | because | | | | | | IMSI paging | | | | | | should not | | | | | | be | | | | | | re-tried. | | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: MME | | | | | | does not | | | | | | generate | | | | | | extra | | | | | | signalling | | | | | | towards SGW | | | | | | if SGW does | | | | | | not support | | | | | | this | | | | | | restoration | | | | | | solution. | | | | | | | | | | | | NOTE 2: SGW | | | | | | does not | | | | | | maintain | | | | | | bearers | | | | | | after | | | | | | detecting | | | | | | MME restart | | | | | | if MME does | | | | | | not support | | | | | | this | | | | | | restoration | | | | | | solution. | | | | | +-------------+-------------+-------------+-------------+-------------+
### 7.1.2 Conclusion
Through the preceding technical investigation within this technical report, it
is concluded that certain serious misoperations can occur upon MME failure
with the procedures currently specified in 3GPP, e.g. a subscriber may not be
able to receive any IMS terminating call until other procedure (such as TAU)
makes the UE reattach to the network.
It is recommended to standardize the following compromise solution to provide
service resiliency after an MME failure with restart.
This compromise solution enables the UE to reattach to the EPS triggered by
downlink data packets or signalling after the MME restarts. This solution
includes the following steps:
1) The SGW maintains the IMSI and S5/S8 bearers after detection of an MME
restart
> If the SGW detects that the MME has restarted (i.e. SGW receives the
> incremented restart counter from the MME), instead of removing associated
> resources, the SGW marks and maintains the corresponding S5/S8 bearers
> configured to be maintained. This makes it possible for the SGW to receive
> downlink data packets or signalling from the PGW or PCRF in case of PMIP
> based S5/S8. Which S5/S8 bearers are to be maintained/marked in the SGW
> after an MME restart is based on the operator\'s policy.
>
> When an SGW marks the S5/S8 bearers, the SGW shall start a timer. The timer
> value is based on the preconfiguration. The value may be equal to the
> periodic tracking area update timer (timer T3412) as specified in 3GPP TS
> 24.301 [4]. If the timer expires, the maintained resources shall be locally
> deleted.
>
> If the SGW receives the Create Session Request message for the UE while the
> timer is running, the SGW shall delete all bearers for this UE and then
> proceeds with the Create Session Request message handling as specified in
> 3GPP TS 29.274 [3].
2) Downlink data packets or signalling arrives at the SGW while the timer in
the step1) is still running.
> If the SGW receives a downlink data packet or a control plane message on the
> marked bearer, the SGW shall send an enhanced Downlink Data Notification
> message including the IMSI to the associated MME. The SGW shall discard the
> received downlink data packet or reject the signalling message (received
> from the PGW or PCRF in case of PMIP based S5/S8) with an appropriate cause
> value.
3) The MME pages and forces the UE to re-attach to the network. The paging
area and subscriber\'s identity i.e. IMSI or S-TMSI used during the paging
procedure is implementation dependent. Upon receiving a page message with the
IMSI, the UE starts the reattach procedure as specified in subclause 5.6.2.2.2
of 3GPP TS 24.301 [4]. Upon receiving a page message with the S-TMSI, the UE
starts the Service Request procedure, this will be rejected by the MME which
triggers the UE to reattach to the network as specified in subclause 5.6.2.2.1
of 3GPP TS 24.301 [4].
NOTE 1: Paging in the MME serving area will cause excessive use of radio
resources. How to reduce the impact on the radio resources is implementation
dependent. As an example, the MME can send the paging area in the Private
Extension IE to the SGW in an existing S11 message. After MME restarts, **the
SGW can send the paging area in the Private Extension IE in the Downlink Data
Notification message with the IMSI to the MME. Then the MME can page the UE in
this paging area contained in the Private Extension IE. This may enable a
reduction in the size of the paging area to be addressed. As another example,
the MME may store and recover the IMSI, S-TMSI, TAI list, SGW/PGW FQDN and
other necessary information in a proprietary way (e.g. in an internal non-
volatile memory or in an external proprietary server, etc.**
NOTE 2: If a UE re-attaches to another MME, whilst this MME has failed (out of
service) and some DL user plane packet are still received on the old
maintained S5/S8 bearers, paging the UE with the IMSI forces the UE (if in
idle mode) to re-attach once more to the EPS.
It is further recommended that Stage 2 and Stage 3 work be specified within
existing specifications as defined within Annex A.
## 7.2 SGSN Restoration
### 7.2.1 Conclusion
Through the preceding technical investigation within this technical report, it
is concluded that certain serious misoperations can occur upon SGSN failure
with the procedures currently specified in 3GPP, e.g. a subscriber may not be
able to receive any IMS terminating call until other procedure (such as RAU)
makes the UE reattach to the network.
It is recommended to adopt the solution included in chapter 7.1.2 for MME
restoration with appropriate substitution of terminology as shown below for
the SGSN failure:
\- MME ïƒ  S4-SGSN;
\- tracking area update timer (timer T3412) as specified in 3GPP TS 24.301 [4]
ïƒ  routing area update timer (timer T3312) as specified in 3GPP TS 24.008 [5];
\- S-TMSI ïƒ  P-TMSI;
\- TAI list ïƒ  RAI;
\- Upon receiving a page message with the IMSI, the UE starts the reattach
procedure as specified in subclause 5.6.2.2.2 of 3GPP TS 24.301 [4]. ïƒ  Upon
receiving a page message with the IMSI, the UE starts the reattach procedure
as specified in subclause 4.7.9.1.2 of the 3GPP TS 24.008[5].
\- Upon receiving a page message with the S-TMSI, the UE starts the Service
Request procedure, this will be rejected by the MME which triggers the UE to
reattach to the network as specified in subclause 5.6.2.2.1 of 3GPP TS 24.301
[4]. ïƒ  Upon receiving a page message with the P-TMSI, UE starts the service
request procedure and subsequently attach procedure in case of Iu Mode as
specified in subclause 4.7.9.1.1 and 4.7.13 of the 3GPP TS 24.008 [5] or send
any LLC frame to response paging request and subsequently attach procedure in
case of A/Gb mode as specified in subclause 8.1.4 of the 3GPP TS 23.060 [7].
It is further recommended that Stage 2 and Stage 3 work be specified within
existing specifications as defined within Annex A.
## 7.3 SGW restoration
### 7.3.1 Comparison of proposed solutions for SGW failure
Table 7.3.1-1 comparison of each solution proposed in subclause 6.3
+----------------------+----------------------+----------------------+ | | Solution 1: | Solution 2: PGW | | | MME/S4-SGSN | initiated paging | | | re-establishing | request at receiving | | | resources with a new | downlink | | | SGW or to the old | data/signalling | | | SGW after its | | | | recovery | | +----------------------+----------------------+----------------------+ | Background | The MME/S4-SGSN | Downlink | | | selects a new SGW or | data/signalling | | | a recovered SGW for | triggers the | | | the Idle UEs. | MME/S4-SGSN to page | | | | the UE. When the | | | The MME/S4-SGSN | MME/S4-SGSN | | | should prioritize | initiates the NAS | | | the SGW relocation | message, the | | | for those UEs that | MME/S4-SGSN will | | | are engaged in a | select a new SGW or | | | Service Request or | the recovered SGW. | | | other mobility | | | | procedures | | +----------------------+----------------------+----------------------+ | EPC nodes impacted | MME/S4-SGSN, PGW | MME/S4-SGSN, SGW, | | | | PGW | +----------------------+----------------------+----------------------+ | Existing EPC | Context Response | Same impact may be | | procedure impacted | message in the inter | applied with | | | SGSN/MME TAU/RAU | solution 1 | | | procedure may be | | | | impacted | | | | | | | | Service Request | | | | procedure may be | | | | impacted | | | | | | | | Inter SGSN/MME | | | | handover procedure | | | | may be impacted | | +----------------------+----------------------+----------------------+ | Existing EPC | None | None | | procedure dependency | | | +----------------------+----------------------+----------------------+ | Existing EPC | None | None | | signalling impacted | | | +----------------------+----------------------+----------------------+ | new EPC signalling | None | Paging Request is | | required | | sent from PGW to | | | | SGW. | | | | | | | | DDN message | | | | including IMSI with | | | | TEID 0 is sent on | | | | the S4/S11 | | | | interface. | +----------------------+----------------------+----------------------+ | Additional EPC | The MME/S4-SGSN and | The MME/S4-SGSN and | | resources required | PGW maintain the | PGW maintain the | | | bearers and MM | bearers and MM | | | context after | context after | | | detection of SGW | detection of SGW | | | restart; | restart; | | | | | | | MME/S4-SGSN stores | MME/S4-SGSN stores | | | the PGW's capability | the PGW's capability | | | per PDN or per-UE | per PDN or per-UE; | | | | | | | | The PGW selects a | | | | SGW based on the | | | | local configuration | | | | or DNS procedure. | | | | | | | | PGW may buffer the | | | | DL packets | | | | | | | | The PGW should avoid | | | | repeating the paging | | | | requests to SGW | | | | shortly after | | | | sending the paging | | | | request and receives | | | | additional DL | | | | packets. | +----------------------+----------------------+----------------------+ | RAN resources | None | None | | impacts | | | +----------------------+----------------------+----------------------+ | Impacts on EPC | The DL packets may | None | | services after SGW | be dropped if the | | | restart/failure | PDN connection has | | | | not recovered. | | +----------------------+----------------------+----------------------+ | Roaming impacts | The MME/S4-SGSN | The MME/S4-SGSN | | | needs to know | needs to know | | | whether the PGW in | whether the PGW in | | | the HPLMN supports | the HPLMN supports | | | the capability to | the capability to | | | maintain the old PDN | maintain the old PDN | | | connection after SGW | connection after SGW | | | failure or restarts, | failure or restarts, | | | vice versa; | vice versa; | +----------------------+----------------------+----------------------+ | PMIP Impacted if | None | New PMIP mobility | | PMIP based S5/S8 | | options need be | | interface is used | | defined | +----------------------+----------------------+----------------------+ | Other merits | None | None | +----------------------+----------------------+----------------------+ | Other drawbacks | The MME/S4-SGSN may | The PGW may need | | | overload if there | some method to | | | are too many UE | select alternative | | | impacted | SGW if the SGW fails | | | | without restart. | +----------------------+----------------------+----------------------+
### 7.3.2 Conclusion
Through the preceding technical investigation within this technical report, it
is concluded that certain serious misoperations can occur upon SGW failure
(with or without restart) with the procedures currently specified in 3GPP,
e.g. a subscriber may not be able to receive any IMS terminating call until
other procedures make the UE reattach to the network, which introduces extra
signalling over radio network.
It is recommended to standardize the solution 1 on the SGW failure as
specified in subclause 6.3.1 as the baseline solution and solution 2 as
specified in subclause 6.3.2 as an optional add-on solution. It is further
recommended that Stage 2 and Stage 3 work be specified within existing
specifications as defined within Annex A.
## 7.4 PGW restoration
Through the preceding technical investigation within this technical report, it
is concluded that certain serious misoperations can occur upon PGW failure
with the procedures currently specified in 3GPP, e.g. a subscriber may not be
able to receive any downlink data packets until other procedure (such as
Service Request) makes the UE reattach to the network.
It is recommended to standardize the enhancements documented in subclause
6.4.1.1 and 6.4.2.1 to provide service resiliency after a PGW failure with or
without restart.
This solution enables the UE to initiate the PDN Connection establishment or
PDP Context Activation procedure with same APN.
It is further recommended that Stage 2 and Stage 3 work be specified within
existing specifications as defined within Annex A.
## 7.5 EPC restoration when ISR is active
### 7.5.1 MME/SGSN restoration when ISR is active
#### 7.5.1.1 Conclusion
Serious misoperations similar to those described in subclauses 7.1.2 and 7.2.1
can occur upon an MME or SGSN failure when ISR is active. It is therefore
recommended to standardize the solution documented in subclause 6.5.2.1 to
provide similar service resiliency after an MME or SGSN failure when ISR is
active:
\- the SGW maintains all S5/S8 bearers after detecting an MME/S4-SGSN restart;
\- when receiving subsequent DL user plane packet or control plane signalling,
the SGW initiates the network trigger service request procedure towards the CN
node that did not fail (i.e. normal Downlink Data Notification message), and
sends an enhanced Downlink Data Notification message with IMSI to the node
that restarted;
\- the restarted node forces the UE to re-attach to the EPC; the node that did
not fail performs a normal paging procedure.
The restoration procedure assumes that the MMEs and SGSNs homogeneously
support network triggered service restoration with ISR. Scenarios with
heterogeneous support of that feature (e.g. MME, SGSN and SGW support ISR, but
only MME and SGW support network triggered service restoration) are for
further study.
It is further recommended that Stage 2 and Stage 3 work be specified within
existing specifications as defined within Annex A.
### 7.5.2 SGW Restoration procedure if ISR is activated
#### 7.5.2.1 Comparison of proposed solutions for SGW failure if ISR is
activated
Table 7.5.2.1-1 comparison of each solution proposed in subclause 6.5.3
* * *
                                                      Solution 1: Deactivate ISR state                                                                                                       Solution 2: Maintain ISR state                                                                          Solution 3:                                                                                                                                                  Solution 4:
Background In this solution, the ISR will be deactivated in the TAU/RAU
procedure which was triggered by the P-TMSI/GUTI Reallocation procedure The
ISR can be maintained by sending an alternative SGW information to the
associated MME/S4-SGSN. In this solution, the ISR will be deactivated in the
TAU/RAU procedure which was triggered by the P-TMSI/GUTI Reallocation
procedure for the connected UE. In this solution, the Configured Node
initiates the SGW restoration. If UE initiates service request in non-
configured node, the UE is forced to re-attach. EPC nodes impacted
MME/S4-SGSN, PGW MME/S4-SGSN, SGW, PGW MME/S4-SGSN, SGW, PGW MME/S4-SGSN, PGW
Existing EPC procedure impacted None None None None Existing EPC procedure
dependency None None None None Existing EPC signalling impacted None None None
None new EPC signalling required None The S3 message that carries SGW FQDN and
F-TEID information as well as its response message is needed None The S3
message that carries SGW FQDN and F-TEID information as well as its response
message is needed. Additional EPC resources required None None None Additional
PDN resources due to hanging PDN connections. RAN resources impacts Possible
RAN Overload None None None Impacts on EPC services after SGW restart/failure
None None None None Roaming impacts PGW need maintain the UE context after SGW
restart/failure PGW need maintain the UE context after SGW restart/failure PGW
need maintain the UE context after SGW restart/failure PGW need maintain the
UE context after SGW restart/failure Other merits None None None None Other
drawbacks There may be some hanging PDN connections in the associated
MME/SGSN. None None Those ISR enabled UEs which perform Service Request and
TAU/RAU in non-configured node between the time of SGW failure and SGW
restoration may have to reattach
* * *
#### 7.5.2.2 Conclusion
Through the preceding technical investigation within this technical report, it
is concluded that certain serious misoperations similar to those described in
subclause 7.3.2 can occur upon an SGW failure (with or without restart) when
ISR is active.
It is recommended to standardize the solutions documented in subclause 6.5.3.1
and subclause 6.5.3.3 to provide similar service resiliency after a SGW
failure when ISR is active.
It is further recommended that Stage 2 and Stage 3 work be specified within
existing specifications as defined within Annex A.
## 7.6 Restoration of CS services after MME failure
### 7.6.1 Conclusion
Through the preceding technical investigation within this technical report, it
is concluded that certain serious misoperations can occur upon MME failure
with the procedures currently specified in 3GPP, e.g. a subscriber may not be
able to receive any CS terminating call until other procedure (such as
periodic TAU) makes the UE reattach to the network.
It is recommended to standardize the solution documented in subclause 6.6.2.1
to provide service resiliency after an MME failure without restart or a long
MME failure.
This solution enables the network to continue delivering mobile terminated CS
services to UEs via an alternative MME in the MME pool where the UE is located
when the MME to which the UE was registered fails without restart or fails for
a long duration.
It is further recommended that Stage 2 and Stage 3 work be specified within
existing specifications as defined within Annex A.
###### ## Annex A (informative): Impacts to Specifications
Table A.1 identifies the existing specifications within CT Working Groups that
require modification to define the MME/S4-SGSN Node Restoration procedure
recommended by this feasibility study.
Table A.1 Impacts for MME/S4-SGSN restoration with or w/o ISR
+------------------------+----------------+-------------------------+ | Existing Specification | Responsible WG | Brief summary of | | | | impacts | +------------------------+----------------+-------------------------+ | 3GPP TS 23.007 | CT4 | Without ISR: | | | | | | | | The steps 1, 2 and 3 in | | | | the subclause 7.1.2 | | | | will be specified. | | | | | | | | The possible examples | | | | in the NOTE1 to reduce | | | | the impact on the radio | | | | resources will NOT be | | | | specified in TS 23.007 | | | | | | | | With ISR: | | | | | | | | The principles | | | | described in subclause | | | | 6.5.2.1.1 will be | | | | specified. | +------------------------+----------------+-------------------------+ | 3GPP TS 29.274 | CT4 | A supported feature is | | | | defined for the | | | | Downlink Data | | | | Notification with TEID | | | | "0" | | | | | | | | Extension to TEID "0" | | | | Downlink Data | | | | Notification message to | | | | contain the IMSI. | | | | | | | | With ISR: | | | | | | | | The Modify Bearer | | | | Request message shall | | | | be sent as part of the | | | | network triggered | | | | service restoration | | | | procedure with ISR | | | | during an intra MME TAU | | | | and an intra S4-SGSN | | | | RAU procedure for UEs | | | | that had ISR active | | | | before either the MME | | | | or the S4-SGSN has | | | | restarted. | | | | | | | | The Serving Network and | | | | Rat Type IEs are sent | | | | within the Modify | | | | Bearer Request message | | | | during the TAU/RAU | | | | without MME/SGSN and | | | | SGW change. | +------------------------+----------------+-------------------------+
No new specifications are required.
Table A.2 identifies the existing specifications within CT Working Groups that
require modification to define the SGW Restoration procedure recommended by
this feasibility study.
Table A.2 Impacts for SGW restoration with or without ISR
+------------------------+----------------+-------------------------+ | Existing Specification | Responsible WG | Brief summary of | | | | impacts | +------------------------+----------------+-------------------------+ | 3GPP TS 23.007 | CT4 | Without ISR: | | | | | | | | Define the stage 2 | | | | requirements along with | | | | the conclusion | | | | documented in subclause | | | | 7.3.2 | | | | | | | | With ISR: | | | | | | | | Define the stage 2 | | | | requirements along with | | | | the conclusion | | | | documented in subclause | | | | 7.5.2.2. | +------------------------+----------------+-------------------------+ | 3GPP TS 29.274 | CT4 | **Solution 1:** | | | | | | | | The CSR and MBR message | | | | shall be sent as part | | | | of the MME/S4-SGSN | | | | triggered SGW | | | | restoration procedure. | | | | | | | | The Context Response | | | | message does not | | | | include SGW F-TEID IEs | | | | if the SGW has failed | | | | and SGW relocation is | | | | to be done by the new | | | | MME/S4-SGSN. | | | | | | | | **Solution 2:** | | | | | | | | New PGW Downlink | | | | Triggering | | | | Notification/ACK | | | | messages are specified | | | | over the S4/S11 and S5 | | | | interface and shall be | | | | sent as part of the PGW | | | | triggered SGW | | | | restoration procedure. | | | | | | | | The MME/S4-SGSN id is | | | | included in the | | | | existing signalling if | | | | the solution 2 is | | | | supported. | | | | | | | | With ISR: | | | | | | | | The new message on S3 | | | | interface is sent as | | | | part of the SGW failure | | | | with ISR. | +------------------------+----------------+-------------------------+ | 3GPP TS 29.275 | CT4 | Solution 2: | | | | | | | | The MME/S4-SGSN id is | | | | included in the | | | | existing signalling if | | | | the solution 2 is | | | | supported. | | | | | | | | The enhanced PMIP | | | | message shall be sent | | | | as part of the PGW | | | | triggered SGW | | | | restoration procedure. | +------------------------+----------------+-------------------------+
No new specifications are required.
Table A.3 identifies the existing specifications within CT Working Groups that
require modification to define the PGW Restoration procedure recommended by
this feasibility study.
Table A.3 Impacts for PGW restoration
* * *
Existing Specification Responsible WG Brief summary of impacts 3GPP TS 23.007
CT4 Define the stage 2 enhancement along with the principle documented in
subclause 6.4.1.1 and 6.4.2.1. 3GPP TS 29.274 CT4 Extend the PGW Restart
Notification message with a new Cause IE allowing the SGW to notify the
MME/S4-SGSN that the peer PGW has failed and not restarted.
* * *
No new specifications are required.
Table A.4 identifies the existing specifications within CT Working Groups that
require modification to define the procedure to restore CS services after an
MME failure recommended by this feasibility study.
Table A.4 Impacts for Restoration of CS services after an MME failure
* * *
Existing Specification Responsible WG Brief summary of impacts 3GPP TS 23.007
CT4 Define stage 2 requirements along the principles documented in subclause
6.6.2.1. 3GPP TS 29.118 CT1 Define stage 3 requirements along the principles
documented in subclause 6.6.2.1. 3GPP TS 23.018 CT4 The VLR may signal MTRF
support in the MAP Update Location request it signals to the HLR upon the
establishment of the SGs association.
* * *
No new specifications are required.
#
# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
NOTE: This clause will not be transferred to TS 23.204.
This Technical Report is used to gather agreed changes for the stage 2 aspects
of the WID \"IP-SM-GW enhancements for CPM-SMS Interworking\". When the
Technical Report is approved, the agreed changes are transferred in block to
TS 23.204, excluding this introduction, Annex Y, and Annex Z \"Change
history\".
The Technical Report copies the structure of TS 23.204, if an agreed change
adds a new clause to the Technical Report, and thus to TS 23.204, a note
indicates that at the beginning of the clause.
If the Technical Report does not propose any change for a specific clause of
TS 23.204, then the content of that clause is not copied from TS 23.204 to the
Technical Report, only a note is added indicating that no change identified
for that clause. If the Technical Report proposes a change for a specific
clause of TS 23.204, then [Underlined-Red text]{.underline} identifies the new
text compared to TS 23.204, ~~Strikethrough Red text~~ (if any) identifies
text to be deleted from TS 23.204.
# 1 Scope
The present document specifies the new capabilities and enhancements needed to
support SMS over a generic IP Connectivity Access Network (IP-CAN) using IMS
capabilities (TS 23.228 [9]). These include (but are not limited) to:
1 Enhancements to the HSS;
2 Communication between the SMS-GMSC/SMS-IWMSC and the HSS;
3 Authentication of service usage and registration;
4 Transfer of UE Terminated SMS, UE Originated SMS, and Delivery reports;
5 Mechanisms to handle SMS when there is more than one IP connection active
with the UE, etc.
The document also specifies the capabilities and enhancements needed to
support the service level interworking for the Short Message service as
defined in the TS 23.040 [2] and in this specification and the Instant
Messaging service as defined in OMA-TS-SIMPLE_IM-V1_0-20070816-C [12]. The
features supported from the IM specification are limited to the exchange of
short or large immediate messages in pager mode.
NOTE: The page-mode immediate message as defined in TS 24.247[14] is
considered as a subset of OMA-TS-SIMPLE-IM-V1_0-20070816-C [12].
[The service requirements are described in TS 22.340 [18].]{.underline}
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.040: \"Technical realization of the Short Message Service (SMS)
Point to Point (PP)\".
[3] Void.
[4] Void.
[5] Void.
[6] 3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".
[7] Void.
[8] Void.
[9] 3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".
[10] Void.
[11] Void.
[12] OMA: \"Instant Messaging using SIMPLE\", OMA-TS-
SIMPLE_IM-V1_0-20070816-C,\
http://member.openmobilealliance.org/ftp/Public_documents/MWG/IM/Permanent_documents/OMA-
TS-SIMPLE_IM-V1_0-20070816-C.zip.
[13] IETF [RFC 5438]{.underline}~~draft, draft-ietf-simple-imdn-04~~:
\"Instant Message Disposition Notification\", February, 2009.
[14] 3GPP TS 24.247: \"Messaging service using the IP Multimedia (IM) Core
Network (CN) subsystem; Stage 3\".
[[15] OMA: \"CPM Requirements\", OMA-RD-CPM-V1_0-20091218-D,
http://member.openmobilealliance.org/ftp/Public_documents/MWG/MWG-
CPM/Permanent_documents/OMA-RD-CPM-V1_0-20091218-D.zip]{.underline}
[[16] OMA: \"CPM Architecture\", OMA-AD-CPM-V1_0-20091222-D,
http://member.openmobilealliance.org/ftp/Public_documents/MWG/MWG-
CPM/Permanent_documents/OMA-AD-CPM-V1_0-20091222-D.zip]{.underline}
[[17] OMA: \"CPM Conversation Functions\", OMA-TS-
CPM_Conv_Fnct-V1_0-20091222-D,
http://member.openmobilealliance.org/ftp/Public_documents/MWG/MWG-
CPM/Permanent_documents/OMA-TS-CPM_Conv_Fnct-V1_0-20091222-D.zip]{.underline}
[[18] 3GPP TS 22.340: \"IP Multimedia System (IMS) messaging; Stage
1\".]{.underline}
[[19] IETF RFC 4975: \"The Message Session Relay Protocol (MSRP)\", September
2007.]{.underline}
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following definitions apply. A term defined in the
present document takes precedence over the definition of the same term, if
any, in TR 21.905 [1]:
[**Converged IP Messaging** : as defined in OMA-RD-CPM-V1_0-20091218-D [15].
Converged IP Messaging supports one-to-one, one-to-many personal
communications, and also communication with Applications.]{.underline}
[**CPM Message** : as defined in OMA-RD-CPM-V1_0-20091218-D [15]: Information
that is sent to one or more recipients. A CPM Message can contain several
discrete Media (e.g. text, images, audio-clips, video-clips).]{.underline}
[**CPM AS** : An application server supporting the functionality of a CPM
Participating Function and/or a CPM Controlling Function as defined in OMA-RD-
CPM-V1_0-20091218-D [15].]{.underline}
**IM origination:** origination of an Instant Message by an IMS UE.
**IM termination:** termination of an Instant Message by an IMS UE.
**IMS core:** refers to the core session control elements of the IM CN
Subsystem, i.e. the CSCFs, and the IBCF.
**Instant Message:** an Instant Message as defined in the OMA-TS-
SIMPLE_IM-V1_0-20070816-C [12] and TS 24.247 [14]. [The term Instant Message
is also used to designate a CPM Message.]{.underline}
[**Interworking Selection Function** : as defined in OMA-AD-
CPM-V1_0-20091222-D [16]. The Interworking Selection Function selects an
Interworking Function that should perform the actual interworking between CPM
and SMS.]{.underline}
**SIMPLE IM service:** the Instant Messaging Service as defined in the OMA-TS-
SIMPLE_IM-V1_0-20070816-C [12].
**SM origination:** origination of a Short Message (including SMS over IP) by
an SMS capable UE, as defined in TS 23.040 [2] and this specification.
**SM termination:** termination of a Short Message (including SMS over IP) by
an SMS capable UE, as defined in TS 23.040 [2] and this specification.
**SMS:** the Short Message Service as defined in the TS 23.040 [2].
**SMSIP MESSAGE:** an immediate message as defined in TS 23.228 [9], which
encapsulates a SM in its text body.
**SMSIP UE:** a UE which supports SMSIP MESSAGE.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply:
[CPM Converged IP Messaging]{.underline}
IM Instant Message
IMDN Instant Message Disposition Notification
IP‑SM‑GW IP-Short-Message-Gateway
[ISF Interworking Selection Function]{.underline}
SM Short Message
# 4 Void
NOTE: No change identified for this clause.
# 4a Architecture Requirements
## 4a.1 General
The SMS-IP architecture supports the following:
\- Notification shall be sent to the HSS that a previously unreachable UE is
now reachable.
\- Functionality is required to be able to select the domain for message
delivery between IMS and CS/PS, and to have the message delivered to the
selected domain.
\- Functionality is required to determine whether to transform the message
format or not, and to perform the transformation of the message format when
determined.
\- The interworking function shall generate the appropriate charging-related
information and provide the appropriate online charging mechanism (if it is
applied for the Short Message Service and/or SIMPLE IM services [and/or CPM
based services]{.underline}) for the interworking services.
## 4a.2 Transport-level interworking
NOTE: No change identified for this clause.
## 4a.3 Service-level interworking
For service-level interworking, the architecture allows for the following:
> \- The service-level interworking is a value added service which requires
> service subscription. In addition, it shall also take the operator\'s
> policy, if available, into account, e.g. checking on the barring setting of
> the subscriber to determine whether to provide this interworking or not, so
> the service authorisation shall be supported before the interworking is
> executed.
>
> \- The service-level interworking applies as a fallback only if the users
> cannot communicate with each other using their chosen messaging service
> according to the user preference and operator policy. The location of the
> interworking service can be in the originating network and in the
> terminating network.
>
> \- The service-level interworking shall support interworking between OMA
> SIMPLE IM service as defined in OMA-TS-SIMPLE_IM-V1_0-20070816-C [12] and
> Short Message Service, as defined in the TS 23.040 [2] and in the current
> specification.
>
> [- The service-level interworking shall support interworking between OMA CPM
> service as defined in OMA-TS-CPM_Conv_Fnct-V1_0-20091222-D [17] and Short
> Message Service, as defined in the TS 23.040 [2] and in the current
> specification.]{.underline}
\- The service-level interworking shall take the capability of the terminating
UE into account when possible.
\- The service level interworking shall be transparent to the end user.
\- The service-level interworking shall minimize the impact on the IMS
architecture.
\- The service-level interworking shall not impact existing functionality of
the Short Message Service as described in TS 23.040 [2] or of the SIMPLE IM
service enabler as described in OMA-TS-SIMPLE_IM-V1_0‑20070816‑C [12] [or of
the CPM service enabler as described in OMA‑TS‑CPM_Conv_Fnct-V1_0‑20091222-D
[17]]{.underline}. Existing security mechanisms for ~~both~~ the SIMPLE IM
service[, the Converged IP Messaging service]{.underline} and the Short
Message Service shall be reused.
\- The interworking function shall be aware if the message should be
interworked or not, e.g. specific types of Short Messages such as an over the
air configuration message, shall not be interworked at service-level, but
shall be instead transported as a Short Message via IMS, CS or PS.
\- If an SMS user requests an SMS status report that the message was delivered
to the recipient, then an SMS status report shall be generated when the
message is delivered using Instant Message.
\- If an IMS user requests a notification that the message was delivered to
the recipient and the Instant Message is interworked to Short Message on the
originating side, an SMS status report shall be interworked to a delivery
notification when the message is delivered.
  * The interworking functionality shall be executed in the following cases:
\- Originating network:
\- The sender is an IM user [or a CPM user]{.underline} who has subscribed to
the interworking function and the recipient is not routable in IMS;
\- The operator policy on the originating side has been set to send the
Instant Messages via Short Message Service.
\- Terminating network:
\- The user preferences and/or the operator policy of the recipient have been
set to receive the incoming Instant Messages via Short Message Service;
\- The received message is a Short Message and the recipient is an IM user [or
a CPM user]{.underline} and has subscribed to the interworking service.
NOTE: For ensuring the integrity of the response messages from the IM UE [or
the CPM UE]{.underline}, it is strongly recommended that in networks where the
IP-SM-GW is deployed, no intermediate nodes modify or terminate the message
between the IP-SM-GW and the terminating IM UE [or CPM UE]{.underline}. If
intermediate nodes are deployed, they can send response messages that do not
reflect the final response from the IM UE [or CPM UE]{.underline}. Final
responses from the IM UE [or CPM UE]{.underline} are necessary to ensure
correct charging and delivery reports on the Short Message Service side.
# 5 Architecture model and reference points
## 5.1 Reference architecture
Figure 5.1 below shows the overall architecture for providing SMS over a
generic IP CAN.
Figure 5.1: Architecture for providing SMS over a generic IP-CAN
[NOTE: Nodes specific to the CPM functions such as ISF are either collocated
with the IP-SM-GW or else are not shown.]{.underline}
## 5.2 Reference points
### 5.2.1 General
NOTE: No change identified for this clause.
### 5.2.2 C interface
NOTE: No change identified for this clause.
### 5.2.3 Interface between the IP-SM-GW and the HLR/HSS
NOTE: No change identified for this clause.
### 5.2.4 E/Gd interface
NOTE: No change identified for this clause.
### 5.2.5 ISC interface
NOTE: No change identified for this clause.
### 5.2.6 Void
NOTE: No change identified for this clause.
## 5.3 Functional entities
### 5.3.1 IP-Short-Message-Gateway (IP-SM-GW)
#### 5.3.1.1 General
NOTE: No change identified for this clause.
#### 5.3.1.2 Transport-level interworking
NOTE: No change identified for this clause.
#### 5.3.1.3 Service-level interworking
The additional functions of the IP-SM-GW when service-level interworking is
done between Short Messages and Instant Messages in IMS are:
\- to determine whether to transform the message format or not, and to perform
the transformation of the message format when determined.
\- to use the SC address retrieved either as part of the subscriber data from
the HSS at registration or as provisioned by configuration, when transforming
the Instant Message into Short Message.
\- to perform the authorization for service-level interworking.
[The additional functions of the IP-SM-GW when service-level interworking is
done between Short Messages and CPM Messages in IMS are the same as functions
performed for Instant Messages in IMS and additionally:]{.underline}
[- to translate a chat session invitation to a short message including
instructions for the SMS user how to react (accept/reject) the chat session
invitation, if operator policy mandates the consent of the SMS user. Otherwise
the IP-SM-GW shall respond a chat session invitation on behalf of the SMS user
(accept/reject), according to operator policy;]{.underline}
[- to translate the SMS user\'s answer to a chat session invitation to a
proper response for the chat session invitation request;]{.underline}
[- to inform SMS user about the changes of group chat session
parameters;]{.underline}
[- to translate a chat session teardown request to a short message, if
operator policy mandates it; and]{.underline}
[- to translate the SMS user\'s request to leave a chat session to a proper
CPM request.]{.underline}
### 5.3.2 HSS
NOTE: No change identified for this clause.
# 6 Procedures
## 6.0 General
The clause describes the procedures for the support of transport-level
interworking between Short Message service and encapsulated Short Message via
IP service, for the support of the service-level interworking for the Short
Message service and Instant Messaging service as defined in OMA-TS-
SIMPLE_IM-V1_0-20070816-C [12] [and for the support of the service-level
interworking for the Short Message service and Converged IP Messaging service
as defined in OMA-TS-CPM_Conv_Fnct-V1_0-20091222-D [17]]{.underline}. Clauses
only applying to either transport-level interworking or service-level
interworking are indicated as such.
NOTE: In the procedures in the following clauses, the I‑CSCF, P‑CSCF and ASs
such as IM AS, [as well as nodes specific to CPM functions such as
ISF,]{.underline} are not shown in the figures.
## 6.1 Registration procedure
NOTE: No change identified for this clause.
## 6.2 De-registration procedure
### 6.2.1 UE initiated
NOTE: No change identified for this clause.
### 6.2.2 Network initiated
NOTE: No change identified for this clause.
## 6.3 Transport-level interworking: Successful encapsulated Short Message
origination procedure
NOTE: No change identified for this clause.
## 6.4 Transport-level interworking: Successful encapsulated Short Message
termination procedure
NOTE: No change identified for this clause.
## 6.5 Transport-level interworking: Delivery Report procedure
NOTE: No change identified for this clause.
## 6.5a Unsuccessful SM termination procedure
NOTE: No change identified for this clause.
## 6.5b Alert Service Centre procedure when UE is available
When a Short Message is received in the IP-SM-GW for delivery to an IMS
subscriber, the IP-SM-GW shall verify the registration status of the UE. If
the UE is not registered in IMS, or is registered in IMS but does not
advertise the [Converged IP Messaging,]{.underline} SIMPLE IM or SMSIP
capability, the Short Message shall not be interworked; neither at service
level nor at transport level. Based on operator policy and user preferences,
either the message is sent over CS/PS or an error indication is sent back to
the SMS-SC. In the latter case, when the UE registers in IMS advertising the
[Converged IP Messaging,]{.underline} SIMPLE IM and/or the SMSIP capability at
a later time, this information is sent to the SMS-SC and the delivery is
attempted at that time, as an Instant Message or an encapsulated Short Message
as appropriate.
NOTE: The service level or transport level interworking of a message is
prohibited as identified in the above scenario in order to prevent the
possibility of the message being deferred in the terminating network.
## 6.6 Transport-level interworking: Alert service centre procedure when
memory capacity is available
NOTE: No change identified for this clause.
## 6.7 Service-level Interworking: IM [or CPM]{.underline} capable UE sends an
Instant Message to an SMS user
Figure 6.7: Successful IM origination to SMS procedure
1) The UE registers to S-CSCF according the IMS registration procedure.
> 2) UE submits the Instant Message to the S-CSCF using an appropriate SIP
> method. The UE may request to hide its Public User Identity from the
> recipient within the Instant Message, as described in
> OMA‑TS‑SIMPLE_IM‑V1_0‑20070816‑C [12] [or in OMA-TS-
> CPM_Conv_Fnct-V1_0-20091222-D [17]]{.underline}.
3) S-CSCF forwards the Instant Message to IP-SM-GW based on stored iFC.
NOTE 1: Subscribers with no subscription for service level interworking will
not be provided with the relevant iFCs.
> 4) The IP-SM-GW shall decide whether to perform service-level interworking
> depending on SIP request header (e.g. Request-URI), operator policy, when
> the Instant Message is not routable in the IMS. [If an ISF is deployed in
> the network, the ISF may take the decision to interwork using SMS and sends
> the message to the IP-SM-GW to perform the interworking.]{.underline} If IP-
> SM-GW decided to perform service-level interworking, the IP-SM-GW performs
> service authorization based on the stored subscriber data retrieved from the
> HLR/HSS at the time of the registration procedure as specified in clause
> 6.1. The IP-SM-GW shall check whether the originating subscriber is
> authorised to use the interworking service. If the result of service
> authorization is negative, the IP-SM-GW shall not forward the message, and
> shall return the appropriate error information to the UE in a failure
> report. Otherwise, the IP-SM-GW shall use the SC Address in the subscriber
> data retrieved from the HSS at registration or provisioned by configuration
> and translates the Instant Message to a Short Message (SMS- SUBMIT) carrying
> SC Address, then forwards it towards SMS-SC (SC Address) via the SMS-IWMSC
> (as described in TS 23.040 [2]). If the size of the content of the Instant
> Message is larger than the size of the content that one Short Message could
> transfer, the IP-SM-GW shall split the content of the Instant Message into
> several parts, translate them to concatenated Short Messages, and forward
> the concatenated Short Messages to the SMS-SC as described in TS 23.040 [2].
> If the sender of the Instant Message requests to hide its Public User
> Identity from the recipient and operator policy allows for this, the IP-SM-
> GW shall anonymize the identity of the user to the recipient. Otherwise, if
> operator policy prohibits this, the IP SM GW shall return an appropriate
> error to the user.
5) If service authorization is successful, the IP-SM-GW acknowledges the
Instant Message.
6) Instant Message acknowledgement is forwarded by S-CSCF to UE.
NOTE 2: Steps 5 and 6 can occur anytime after the subscriber authorization
check has been performed by the IP‑SM‑GW.
7) The SMS-IWMSC forwards the Short Message (SMS- SUBMIT) to the SMS-SC (see
TS 23.040 [2]).
8) The SMS-SC sends a Submit report (SMS-SUBMIT REPORT) to the SMS-IWMSC (see
TS 23.040 [2]).
9) SMS-IWMSC sends a Submit report to IP-SM-GW (see TS 23.040 [2]).
NOTE 3: The procedure can end in step 9. Steps 10 to 13 occur only if the IM
user requested a processing notification in the Instant Message sent in step
2, as described in IETF IMDN [RFC 5438]{.underline}~~draft-ietf-simple-imdn~~
[13].
10) IP-SM-GW translates the received Submit report to an appropriate Instant
Message, and forwards it to the S‑CSCF. If the IP‑SM‑GW sent concatenated
Short Messages to SMS-SC in step 4, the IP‑SM‑GW should wait for the last
Submit report, and translate the last Submit report to an appropriate Instant
Message, and forward it to the S‑CSCF.
11) S-CSCF sends the translated Instant Message to the UE.
12) UE acknowledges the translated Instant Message.
13) Acknowledgement of the translated Instant Message is forwarded by S-CSCF
to IP-SM-GW.
## 6.8 Interaction between transport-level and service-level Interworking
### 6.8.1 General
The interaction between transport-level interworking (between SMS over CS/PS
and SMS over IMS) and service-level interworking (between Instant Messaging
and SMS) depends on the user subscription and authorisation, on the UE
capabilities, and on operator policy.
If a user is only subscribed to either transport-level interworking or
service-level interworking, only procedures defined for the subscribed
interworking may be performed.
If a user is subscribed to both transport-level interworking and service-level
interworking, but the user is only authorised for one of the interworking when
the message is processed, only the authorised interworking may be performed.
If a user is subscribed to both transport-level interworking and service-level
interworking, and is authorised for both, the behaviour of the IP-SM-GW
depends on the specific scenario, on the registered capabilities of the UE,
and finally is defined by operator policy and user preferences.
For a user subscribed to service-level interworking, two Application Servers
in the network are normally called upon to handle an Instant Message:
\- the IM AS, defined in OMA-TS-SIMPLE_IM-V1_0-20070816-C [12] [or the CPM AS,
defined in OMA-TS-CPM_Conv_Fnct-V1_0-20091222-D [17]]{.underline};
\- the IP-SM-GW.
The following clauses describe the different interaction scenarios.
### 6.8.2 IMS Originating
In the originating network, a UE sends a SIP MESSAGE (Encapsulated Short
Message or Instant Message). The originating S‑CSCF forwards the SIP MESSAGE
to the IP-SM-GW based on the iFC. The subscription of the transport level
interworking and the service level interworking applies for different iFC.
However, the SIP MESSAGE is forwarded to the IP-SM-GW if the user subscribes
to one of the interworking services. If there is no subscription for the
interworking service, the S‑CSCF continues with the subsequent iFC check.
After all the originating iFC triggers have been handled, the S‑CSCF attempts
to route the message to the terminating IMS network. If it fails, an error is
returned to the sender.
NOTE 1: if an IM AS [or a CPM AS]{.underline} is present in the network,
Instant Messages are routed to it before going to the IP-SM-GW.
NOTE 2: An encapsulated Short Message uses the PSI of the SC as the Request-
URI. If the user is not subscribed to transport-level interworking and the IP-
SM-GW is not invoked, the ENUM query fails, and an error is returned to the
sender.
When the IP-SM-GW receives the SIP MESSAGE, it shall decide which interworking
should be performed based on the content of the received SIP MESSAGE, as the
IP-SM-GW can distinguish between an encapsulated Short Message and an Instant
Message. If an encapsulated Short Message is received and if the subscriber is
authorised for the service, the IP-SM-GW maps the encapsulated Short Message
to a Short Message. Similarly, when an Instant Message is received, the IP-SM-
GW considers performing the service-level interworking if the service is
authorized: the IP‑SM‑GW shall decide whether to send the SIP MESSAGE via
interworking service based on SIP request header (e.g., R‑URI), operator
policy, when the Instant Message is not routeable in the IMS [or when the IP-
SM-GW is selected to handle the message]{.underline}.
Figure 6.8.2.1: Performing interworking service on originating side
### 6.8.3 IMS Terminating
When the IP-SM-GW receives a Short Message from the legacy network on the
terminating side, it performs the domain selection to determine the preferred
domain to transfer the short message. If the selected network is IMS, the IP-
SM-GW will determine whether the transport level interworking or the service
level interworking is to be preformed based on the users\' subscription and
authorisation, and on the UE capability as indicated during IMS registration.
If the user has subscribed to both services, is authorised for both and the UE
has indicated its capability to receive both encapsulated Short Messages and
Instant messages, the priority between the transport-level interworking and
the service-level interworking is based on operator policy and user
preferences.
NOTE 1: If the incoming Short Message is interworked to an Instant Message,
the resulting Instant Message could be routed to the IM AS [or CPM
AS]{.underline} before being sent to the UE.
Figure 6.8.3.1: Performing interworking service on terminating side for an
incoming Short Message
When the IP-SM-GW receives an Instant Message, based on user subscription and
authorisation for service-level interworking, on operator policy and user
preferences, and on UE capability indicated during IMS registration, the
IP‑SM‑GW may perform service-level interworking to transform the message
format to SMS and deliver the message to the UE. If the user is subscribed and
authorised for transport-level interworking, and based on UE capability
indicated during IMS registration, and on operator policy and user
preferences, the message may be delivered as an encapsulated Short Message to
the UE over IMS. Otherwise, the Short Message is delivered over CS/PS.
## 6.9 Service-level Interworking: Concatenated Short Messages delivered as a
large Instant Message
An IMS registered user with IM service [or CPM service]{.underline} receives a
concatenated short message delivered as two or more short messages. The
information below describes the behaviour when the received concatenated Short
Message exceeds the maximum payload size of an Instant Message.
Editor\'s Note: The rest of the clause 6.9 is identical to what is in TS
23.204 clause 6.9.
## 6.10 Service-level interworking: Status Report procedure for Instant
Message to Short Message interworking
NOTE: No change identified for this clause.
## 6.11 IM [or CPM]{.underline} user sends an Instant Message to an SMSIP UE
An IMS registered user with SIMPLE IM service [or CPM service]{.underline}
sends an Instant Message via service-level interworking as an encapsulated
Short Message to an SMSIP UE, which did not indicate support for SIMPLE IM [or
CPM]{.underline} when registering to IMS.
NOTE 1: Based upon user subscription and depending on network deployment,
other Application Servers could be processing the incoming Instant Message
before the IP-SM-GW. The behaviour of the IM AS is described in OMA-TS-
SIMPLE_IM-V1_0-20070816-C [12]. [The behaviour of the CPM AS is described in
OMA-TS-CPM_Conv_Fnct-V1_0-20091222-D [17].]{.underline}
Figure 6.11: Successful UE termination Instant Message to encapsulated Short
Message procedure
Editor\'s Note: The figure above has been changed from the original version in
TS 23.204.
1) IM [or CPM]{.underline} UE sends an Instant Message to the S-CSCF#1. The UE
may request to hide its Public User Identity from the recipient within the
Instant Message, as described in OMA‑TS‑SIMPLE_IM‑V1_0‑20070816‑C [12] [and in
OMA-TS-CPM_Conv_Fnct-V1_0-20091222-D [17]]{.underline}.
2) The S-CSCF#1 forwards the Instant Message to the S-CSCF#2.
3) The S-CSCF#2 forwards the Instant Message to the IP-SM-GW based on iFC.
4) Based on user subscription and authorisation for service-level
interworking, on operator policy and user preferences, and on UE capability
indicated during IMS registration, the IP-SM-GW shall decide whether to
perform service-level interworking. If the user is subscribed and authorised
for transport-level interworking, and based on UE capability indicated during
IMS registration, and on operator policy and user preferences, the message may
be delivered as an encapsulated Short Message to the UE over IMS. Otherwise,
the Short Message is delivered over CS/PS, as described in clause 6.13. If the
sender of the Instant Message requests to hide its Public User Identity from
the recipient and operator policy allows for this, the IP‑SM‑GW shall
anonymise the identity of the user to the recipient. Otherwise, if operator
policy prohibits this, the IP‑SM‑GW shall return an appropriate error to the
user.
NOTE 2: If a delivery notification was requested in the message sent by the UE
in step 1 as described in IETF IMDN [RFC 5438]{.underline}~~draft-ietf-simple-
imdn~~ [13], the procedure for delivery report described in clause 6.12
applies. Otherwise IP-SM-GW will just acknowledge, at the SIP level, the
Delivery report received from the SMSIP UE.
5) The IP-SM-GW forwards the encapsulated Short Message to the S-CSCF#2.
6) The S-CSCF#2 forwards the encapsulated Short Message to the SMSIP UE.
7) The SMSIP UE acknowledges the translated encapsulated Short Message.
8) The S-CSCF forwards the acknowledgement of the translated encapsulated
Short Message to the IP-SM-GW.
9-11) The IP-SM-GW forwards the acknowledgement of the translated encapsulated
Short Message to the originating IM UE [or CPM UE]{.underline}.
## 6.12 Delivery report for an Instant Message delivered as encapsulated Short
Message
This procedure follows the procedure described in clause 6.11, when the
original Instant Message included a delivery notification request.
Figure 6.12: Delivery report after a successful Instant Message to
encapsulated Short Message procedure
Editor\'s Note: The figure above has been changed from the original version in
TS 23.204.
NOTE: An encapsulated Short Message has been sent successfully according to
the procedure described in clause 6.11 before the procedure below can be
performed.
1-2) The SMSIP UE has received the Short Message as described in clause 6.11
and sends a Delivery report (SMS-DELIVER-REPORT) to the IP-SM-GW via the
S-CSCF.
3-4) The IP-SM-GW acknowledges, at the SIP level, the Delivery report to the
SMSIP UE via the S-CSCF.
5-7) The IP-SM-GW sends a Delivery Notification to the IM UE [or CPM
UE]{.underline}.
8-10) The IM UE [or CPM UE]{.underline} acknowledges the reception of the
Delivery Notification.
## 6.13 Service-level interworking: IM [or CPM]{.underline} capable UE sends
an Instant Message to an SMS user with Interworking in the terminating side
This procedure describes the delivery of an Instant Message to a registered or
an un-registered IMS subscriber. For the unregistered case, the S‑CSCF
forwards the Instant Message to the IP‑SM‑GW based on the unregistered iFC of
the subscriber.
Figure 6.13: Successful IM terminating to SMS procedure with Interworking in
the Terminating Side
Editor\'s Note: The figure above has been changed from the original version in
TS 23.204.
1) UE submits an Instant Message, destined to another IM user [or CPM
user]{.underline} in another IMS domain, using an appropriate SIP method. The
UE may request to hide its Public User Identity from the recipient within the
Instant Message, as described in OMA‑TS‑SIMPLE_IM‑V1_0‑20070816‑C [12] [and in
OMA-TS-CPM_Conv_Fnct-V1_0-20091222-D [17]]{.underline}.
2) The S-CSCF resolves the destination domain and routes the message towards
the S-CSCF in the terminating network (\"Terminating S-CSCF\").
3) The terminating S-CSCF forwards the Instant Message to the IM AS
(\"Terminating IM AS\") [or to the CPM AS (\"Terminating CPM
AS\")]{.underline} based on stored iFC.
NOTE: Depending on iFC configuration, it is possible that the IM AS [or CPM
AS]{.underline} is not triggered for the unregistered subscribers.
4) The terminating IM AS [or CPM AS]{.underline} invokes terminating IM or CPM
services as applicable for the destination IM [or CPM]{.underline} user.
5) The IM AS [or CPM AS]{.underline} can forward the Instant Message back to
the terminating S-CSCF, e.g. the terminating IM user is offline [or the CPM
user has no terminating interworking user preferences]{.underline}.
6) The terminating S-CSCF forwards the Instant Message to the IP-SM-GW, e.g.
based on stored iFC.
7) If the user is authorized, the IP-SM-GW performs service-level interworking
by converting the Instant Message to Short Message. The IP-SM-GW shall obtain
the routeing information for the UE from the HLR/HSS and deliver the message
to the UE. If the sender of the Instant Message requests to hide its Public
User Identity from the recipient and operator policy allows for this, the
IP‑SM‑GW shall anonymise the identity of the user to the recipient. Otherwise,
if operator policy prohibits this, the IP‑SM‑GW shall return an appropriate
error to the user.
8) The IP-SM-GW obtains the routeing information for the destination UE from
the HLR/HSS.
9) The IP-SM-GW sends the Forward Short Message message to the target MSC.
10) The MSC sends the Short Message to the UE.
11) The UE acknowledges the receipt of the Short Message.
12) The MSC sends a Delivery report (SMS-DELIVER-REPORT) to the IP-SM-GW.
13) The IP-SM-GW sends OK response to the terminating S-CSCF.
14) The S-CSCF forwards the OK to the terminating IM AS [or CPM
AS]{.underline}.
15) The terminating IM AS [or CPM AS]{.underline} forwards the OK response
back to the terminating S-CSCF.
16) The terminating S-CSCF forwards the OK back towards the originating
S-CSCF.
17) The originating S-CSCF forwards the OK to the originating UE.
## 6.14 Service-level interworking: IM [or CPM]{.underline} user receives
Short Message from an SMS user
An IMS registered user with SIMPLE IM [or CPM]{.underline} service receives a
Short Message formatted via service-level interworking to an Instant Message.
Editor\'s Note: The rest of the clause 6.14 is identical to what is in TS
23.204 clause 6.14.
## 6.15 Service-level Interworking: CPM capable UE sends a Chat session
invitation to an SMS user
NOTE: This is a new sub-clause to be added to TS 23.204.
### 6.15.1 IP-SM-GW in the originating network
Figure 6.15.1: Chat session invitation to SMS user and Message data exchange
(IP-SM-GW in originating network)
1) The UE registers to S-CSCF according to the IMS registration procedure.
2) The UE sends a session invitation request for a chat session to the S-CSCF,
using the appropriate SIP method. The UE may request to hide its Public User
Identity from the recipient within the session invitation.
3) S-CSCF forwards the session invitation to the IP-SM-GW based on stored iFC.
NOTE 1: Subscribers with no subscription for service level interworking will
not be provided with the relevant iFCs.
4) The IP-SM-GW performs service authorization based on the stored subscriber
data retrieved from the HLR/HSS at the time of the registration procedure as
specified in clause 6.1. The IP-SM-GW shall check whether the originating
subscriber is authorised to use the interworking service. If the result of
service authorization is negative, the IP-SM-GW shall not forward the message,
and shall return the appropriate error information to the UE in a failure
report. If the sender of the session invitation asks to hide its Public User
Identity from the recipient and operator policy allows for this, the IP-SM-GW
shall anonymise the identity of the user in all messages it sends to the
recipient. If operator policy prohibits anonymity, the IP-SM-GW shall not
perform interworking and shall send back an appropriate response.
NOTE 2: Steps 5 to 7 are only executed if the operator policy is to check back
with the SMS user before accepting the invitation on behalf of the SMS user.
Otherwise, the process continues with step 8, as if the SMS user has responded
with an acceptance of the chat session invitation.
5) Otherwise, the IP-SM-GW correlates an MSISDN to this chat session. Any SMS
sent from the SMS user to this MSISDN should be interworked into the chat
session with which this MSISDN is correlated. The IP-SM-GW shall use the SC
Address in the subscriber data retrieved from the HSS at registration or
provisioned by configuration and translates the chat session invitation
request to a Short Message (SMS- SUBMIT) carrying an SC Address, then forwards
it towards the SMS-SC (SC Address) via the SMS-IWMSC (as described in TS
23.040 [2]). The text in the Short Message is defined by the operator and
should convey information to the SMS user that he is invited to send and
receive messages in the context of a chat session, and include instructions on
how to accept, reject and end the session. If no response is received in time,
the IP-SM-GW will consider the session rejected and send an appropriate
response to the session invitation.
NOTE 3: The MSISDN used as the sender of the Short Message is either the
MSISDN of the CPM user or one that is assigned by the IP-SM-GW, depending on
operator configuration.
6) The SMS-IWMSC forwards the Short Message (SMS- SUBMIT) to the SMS-SC and
the SMS is delivered to the SMS user using standard SMS procedures (see TS
23.040 [2]).
7) A Short Message is sent by the SMS user via the SMS-GMSC to the IP-SM-GW in
accordance to steps 2 to 4 and steps 10 to 13 from clause 6.14.
8) If the answer is positive, the IP-SM-GW acknowledges the session
invitation. Otherwise the IP-SM-GW will consider the session rejected and send
back an appropriate response.
9) Session invitation acknowledgement is forwarded by S-CSCF to the CPM UE.
NOTE 4: The following steps are executed only if an SMS with a positive answer
is received from the SMS user or if the operator policy indicated that the
session is accepted without SMS user interaction. If a negative response to
the invitation is received or if no response from the SMS user is received
within an operator defined time, the IP-SM-GW will send a negative response to
the chat invitation.
NOTE 5: Steps 10 to 12 are repeated for each message sent from the CPM user
towards the SMS user, and steps 13 to 14 are repeated for each message sent
from the SMS user towards the CPM user.
10) The CPM user sends a message within the chat session containing data to
the recipient SMS user.
11) The IP-SM-GW transforms the received message into a Short Message and
sends a Short Message (SMS- SUBMIT) carrying the SC Address, then forwards it
towards the SMS-SC (SC Address) via the SMS-IWMSC (as described in TS 23.040
[2]). According to operator policy, each SMS generated for the SMS user may
include text instructions on how to leave the chat session.
12) The SMS-IWMSC forwards the Short Message (SMS- SUBMIT) to the SMS-SC and
the SMS is delivered to the SMS user using standard SMS procedures (see TS
23.040 [2]).
13) A Short Message is sent by the SMS user via the SMS-GMSC to the IP-SM-GW
in accordance to steps 2 to 13 from clause 6.14.
NOTE 6: Step 5 of the flow in clause 6.14 becomes this: The IP-SM-GW
identifies that a session exists between the SMS user and the CPM user.
### 6.15.2 IP-SM-GW in the terminating network
The SMS user (SMS UE B) in this flow is a CPM user (CPM user B) whose
preferences are set in his home network to receive his incoming chat sessions
as Short Messages.
Figure 6.15.2: Chat session invitation to SMS user and message data exchange
(IP-SM-GW in terminating network)
1) The originating network for CPM user A sends a session invitation request
for a chat session to a CPM user (CPM user B) in another IMS domain, using the
appropriate SIP method. The UE may request to hide its Public User Identity
from the recipient within the session invitation. The originating S-CSCF (not
shown) resolves the destination domain and routes the session invitation
towards the S-CSCF in the terminating network (\"terminating S-CSCF\").
2) The terminating S-CSCF forwards the session invitation to the IP-SM-GW
based on stored iFC.
NOTE 1: Subscribers with no subscription for service level interworking will
not be provided with the relevant iFCs.
3) Authorization to continue is checked. If the sender of the session
invitation asks to hide its Public User Identity from the recipient and
operator policy allows for this, the IP‑SM‑GW shall anonymise the identity of
the user in all messages it sends to the recipient. If operator policy
prohibits anonymity, or if the IP-SM-GW cannot identify the sending party and
the operator prohibits session invitations from unidentified users, the
IP‑SM‑GW shall not perform interworking and send back an appropriate response.
NOTE 2: Steps 5 to 7 are only executed if the operator policy is to check back
with the SMS user before accepting the invitation on behalf of the SMS user.
Otherwise, the process continues with step 8, as if the SMS user has responded
with an acceptance of the chat session invitation.
4) The IP-SM-GW performs service-level interworking by converting the chat
session invitation request to a Short Message. The IP-SM-GW obtains the
routeing information for the destination UE from the HLR/HSS.
5) The IP-SM-GW sends the Forward Short Message message to the target MSC. The
IP-SM-GW assigns an MSISDN representing the chat session to ensure that the
reply to this SMS is sent back to this particular IP-SM-GW. Any SMS sent from
the SMS user to this MSISDN should be interworked into the chat session with
which this MSISDN is correlated. The text in the Short Message is defined by
the operator and should convey information to the SMS user that he is invited
to send and receive messages in the context of a chat session, and include
instructions on how to accept, reject and end the session. The identity of the
original sender (CPM user or group) is included as part of the operator
provided invitation text. If no response is received in time, the IP-SM-GW
will consider the session rejected and send an appropriate response to the
session invitation.
6) The MSC sends the Short Message to the SMS user.
7) A Short Message is received via the SMS-GMSC from the SMS user by the IP-
SM-GW, in accordance to steps 2 to 4 and steps 10 to 13 of clause 6.14,
indicating the response to the chat session invitation. The message is
targeted to the MSISDN representing the chat session which was assigned in
step 5.
8) If the answer is positive, the IP-SM-GW acknowledges the session
invitation. Otherwise the IP-SM-GW will consider the session rejected and send
back an appropriate response.
9) The session invitation acknowledgement is forwarded by S-CSCF to the CPM
UE.
NOTE 3: The following steps are executed only if an SMS with a positive answer
is received from the SMS user or if the operator policy indicated that the
session is accepted without SMS user interaction. In case a negative response
to the invitation is received or if no response from the SMS user is received
within an operator defined time, the IP-SM-GW will send a negative response to
the chat invitation.
NOTE 4: Steps 10 to 13 are repeated for each message sent from the CPM user
towards the SMS user, and step 14 is repeated for each message sent from the
SMS user towards the CPM user.
10) The CPM user sends a message within the chat session containing data to
the recipient SMS user.
11) The IP-SM-GW transforms the received message into a Short Message and
obtains the routeing information for the destination UE from the HLR/HSS.
12) The IP-SM-GW sends a Short Message (SMS- DELIVER) towards the MSC, as
described in TS 23.040 [2]. The IP-SM-GW inserts the MSISDN representing the
chat session as the sender of the message, to ensure that the reply to this
SMS is sent back to it.
13) The MSC forwards the Short Message (SMS- DELIVER) to the SMS user, and the
SMS is delivered to the SMS user using standard SMS procedures as described in
TS 23.040 [2]).
14) A Short Message is received via the SMS-GMSC from the SMS user by the IP-
SM-GW, in accordance to steps 2 to 13 from clause 6.14. The message is
targeted to the MSISDN representing the chat session which was assigned in
step 5.
NOTE 5: Step 5 of the flow in clause 6.14 becomes this: \"The IP-SM-GW
identifies that a session exists between the SMS user and the CPM user\".
## 6.16 Service-level Interworking: CPM capable UE tearing down a Chat session
between a CPM user and an SMS user
NOTE: This is a new clause to be added to TS 23.204.
### 6.16.1 IP-SM-GW in the originating network
Figure 6.16.1: Chat session teardown request to SMS (IP-SM-GW in originating
network)
1) The CPM UE sends a SIP BYE for an ongoing session to the S-CSCF.
2) S-CSCF forwards the session teardown request to the IP-SM-GW. The IP-SM-GW
performs service-level interworking by converting the session teardown request
to a Short Message (SMS-SUBMIT) carrying the SC Address and including operator
provided teardown text. The IP-SM-GW uses the SC Address in the subscriber
data retrieved from the HSS at registration or provisioned by configuration.
3) The IP-SM-GW forwards the Short Message towards the SMS-SC (SC Address) via
the SMS-IWMSC (as described in TS 23.040 [2]). The text in the Short Message
is defined by the operator and should convey information to the SMS user that
the chat session is ending.
NOTE 1: The MSISDN used as the sender of the Short Message is either the
MSISDN of the CPM user or one that was assigned by the IP-SM-GW at session
establishment, depending on operator configuration.
4) The SMS-IWMSC forwards the Short Message (SMS- SUBMIT) to the SMS-SC (see
TS 23.040 [2]).
NOTE 2: Steps 3 to 4 are only executed if the operator policy requires that
the SMS user be told the session is being torn down. Otherwise, the process
continues with step 5.
5) The IP-SM-GW acknowledges the session teardown request and tears down the
associated resources.
6) The session teardown acknowledgement is forwarded by the S-CSCF to the CPM
UE.
### 6.16.2 IP-SM-GW in the terminating network
The SMS user (SMS user B) in this flow is a CPM user (CPM user B) who has set
his preferences in his home network to receive his incoming chat sessions as
Short Messages.
Figure 6.16.2: Chat session teardown request to SMS (IP-SM-GW in terminating
network)
1) The CPM user\'s originating network sends a session teardown request for an
ongoing chat session to the terminating S-CSCF.
2) The terminating S-CSCF forwards the session teardown request to the IP-SM-
GW serving the SMS user. The IP-SM-GW performs service-level interworking by
converting the session teardown request to a Short Message including operator
provided teardown text.
3) The IP-SM-GW obtains the routeing information for the destination UE from
the HLR/HSS.
4) The IP-SM-GW sends the Forward Short Message to the target MSC. The IP-SM-
GW inserts the MSISDN it had previously assigned to represent this chat
session as the sender of the message.
NOTE: Steps 3 to 5 are only executed if the operator policy requires that the
SMS user be told the session is being torn down. Otherwise, the process
continues with step 6.
5) The MSC sends the Short Message to the SMS user.
6) The IP-SM-GW acknowledges the session teardown request and tears down the
associated resources.
7) The session teardown acknowledgement is forwarded by S-CSCF towards the CPM
user\'s originating network.
## 6.17 Service-level Interworking: SMS user requesting the IP-SM-GW to tear
down the Chat session between a CPM user and an SMS user
NOTE: This is a new sub-clause to be added to TS 23.204.
### 6.17.1 IP-SM-GW in the originating network
Figure 6.17.1: Chat session teardown request to CPM UE (IP-SM-GW in
originating network)
1) A message is received from the SMS user via the SMS-GMSC by the IP-SM-GW,
in accordance to steps 2 to 4 and steps 10 to 13 of clause 6.14, with the
operator defined Short Message indicating the SMS user wants to leave the chat
session.
2) The IP-SM-GW performs service-level interworking by recognizing that the
Short Message corresponds to the operator defined teardown text indicating the
SMS user wants to leave the chat session, so the IP-SM-GW sends a chat session
teardown request.
3) The session teardown request is forwarded by S-CSCF to the CPM UE.
4) The CPM UE acknowledges the session teardown request.
5) The acknowledgement is forwarded by the S-CSCF to the IP-SM-GW.
### 6.17.2 IP-SM-GW in the terminating network
The SMS user in this flow is a CPM user who has set his preferences in his
home network to receive his incoming chat sessions as Short Messages.
Figure 6.17.2: Chat session teardown request to CPM UE (IP-SM-GW in
terminating network)
1) A message is received from the SMS user via the SMS-GMSC by the IP-SM-GW,
in accordance to steps 2 to 4 and steps 10 to 13 of clause 6.14, with the
operator provided teardown text indicating the SMS user wants to leave the
chat session.
2) The IP-SM-GW performs service-level interworking by recognizing that the
Short Message corresponds to the operator provided teardown text indicating
the SMS user wants to leave the chat session, so the IP-SM-GW sends a chat
session teardown request.
3) The session teardown request is forwarded by the S-CSCF towards the CPM
user\'s originating network.
4) The CPM user\'s originating network acknowledges the session teardown
request and tears down the associated resources.
5) The acknowledgement is forwarded by the S-CSCF to the IP-SM-GW.
## 6.18 Service-level interworking: Status Report procedure for chat session
message to Short Message interworking
Figure 6.18: Status report procedure for chat session message to Short Message
interworking
1) A chat session message from the UE is successfully delivered to the SMS
user after service-level interworking according to clause 6.15. The chat
session message requested a success or failure delivery report.
NOTE 1: A Request for success or failure delivery report can be requested in a
chat session message sent by the UE as described in IETF RFC 4975 [19].
2) The SMS-SC sends a Status report to the SMS-GMSC.
NOTE 2: The Status report, from the SMS-GMSC\'s point of view, will be treated
as any SM termination.
NOTE 3: The Status report is an optional message.
3a) The SMS GMSC interrogates the HLR/HSS to retrieve routeing information.
Based on the pre-configured IP-SM-GW address for the user, the HLR/HSS
forwards the request to the corresponding IP-SM-GW.
3b) The HLR/HSS returns the IMSI and the address(es) of the current MSC and/or
SGSN to the IP-SM-GW for delivery of the Short Message in CS/PS domain.
3c) The IP-SM-GW creates a MT Correlation ID as per TS 23.040 [2], which
associates the Routing Info retrieval with the subsequent Forward Short
Message messages(s), and stores this along with the IMSI of the receiving
subscriber. The IP-SM-GW returns to the SMS-GMSC the address of itself, along
with the MT Correlation ID in the IMSI field, as routeing information.
Alternatively, the IP-SM-GW may return the address(es) of the current MSC
and/or SGSN, in which case, the subsequent procedure to forward the message is
the same as defined in TS 23.040 [2].
4) The SMS-GMSC sends the status report in the Forward Short Message to the
IP-SM-GW.
5) The IP-SM-GW translates and maps the Status report in the Forward Short
Message into a report request as described in MSRP IETF RFC 4975 [19].
6) The IP-SM-GW sends a Delivery report (SMS-DELIVER-REPORT) to the SMS-GMSC.
7) The SMS-GMSC sends an acknowledgement back to the SMS-SC.
8-9) The IP-SM-GW sends a success of failure report based on the value in the
status report.
NOTE 4: Step 6 and 8 can happen independently of each other.
###### ### Annex A: Service-level interworking: IM [or CPM]{.underline} user
sends an Instant Message to a group list including SMS users
Figure A.1: IM user sends an Instant Message to a group list via service-level
interworking
1) The UE registers to S-CSCF according the IMS registration procedure.
2) UE generates Instant Message which includes group information, e.g. Group
identifier in the Request-URI and/or recipient list in the body of the Instant
Message. UE submits the Instant Message to the S-CSCF using an appropriate SIP
method.
3) Based on the stored iFC, S-CSCF forwards the Instant Message to an AS in
charge of the group delivery, e.g. the controlling function server defined in
OMA-TS-SIMPLE_IM-V1_0-20070816-C [12] [or the controlling function server
defined in OMA-TS-CPM_Conv_Fnct-V1_0-20091222-D [17]]{.underline}.
4) The group delivery AS replicates per Instant Message for per recipient
according to the group information it obtains acting as a B2BUA. See detail in
OMA-TS-SIMPLE_IM-V1_0-20070816-C [12] [or in OMA-TS-
CPM_Conv_Fnct-V1_0-20091222-D [17].]{.underline}
5) The group delivery AS sends the generated multiple Instant Messages to
S-CSCF (e.g., the Instant Messages can be delivered as what the list server
does defined in the TS 24.247 [14]).
6) The S-CSCF forwards the Instant Messages to the IP-SM-GW based on the
stored iFC.
7) The IP-SM-GW shall decide whether to perform service-level interworking
depending on SIP request header (e.g. Request-URI), operator policy, when the
Instant Message is not routeable in the IMS. If IP-SM-GW decided to perform
service-level interworking, the IP-SM-GW performs service authorization based
on the stored subscriber data retrieved from the HLR/HSS at the time of the
third party registration procedure as described in the clause 6.1. The IP-SM-
GW shall check whether the originating subscriber is authorised to use the
interworking service .If the result of service authorization is negative, the
IP-SM-GW shall not forward the message, and shall return the appropriate error
information to the UE in a failure report. Otherwise, the IP-SM-GW shall
translate the IMS message to a Short Message (SMS- SUBMIT) and forwards it
towards the SMS-SC (SC Address) via the SMS-IWMSC (as described in TS 23.040
[2]).
8) If service authorization is successful, the IP-SM-GW acknowledges the
Instant Messages.
9-11) Instant Message acknowledgement is forwarded by S-CSCF to UE.
12) The SMS-IWMSC forwards the Short Messages (SMS- SUBMIT) to the SMS-SC (see
TS 23.040 [2]).
13) The SMS-SC sends multiple Submit reports (SMS-SUBMIT REPORT) to SMS-IWMSC
(see TS 23.040 [2]).
14) SMS-IWMSC sends the Submit reports to IP-SM-GW (see TS 23.040 [2]).
15) IP-SM-GW translates the received Submit reports to appropriate IMS
delivery notifications defined in [RFC 5438]{.underline}~~draft-ietf-simple-
imdn~~ [13], and forwards the IMS delivery notifications to the S-CSCF.
16) The S-CSCF forwards the IMS delivery notifications to the group delivery
AS.
17) The group delivery AS aggregates the delivery notifications of the same
type from different recipients into a single delivery notification.
18) The group delivery AS sends the delivery notification to the S‑CSCF.
19) The S-CSCF forwards the delivery notification to the UE.
20-23) Acknowledgement of the delivery notification is forwarded by S-CSCF to
IP-SM-GW.
###### ### Annex B: Group chat sessions
NOTE: This is a new annex to be added to TS 23.204.
# B.1 Service-level interworking: IM or CPM user initiates a group chat and
sends an Instant Message to a group list including SMS users
The flow in this clause is the same as that described in clause 6.15.1 with
the difference that it is required that the IP-SM-GW assign an MSISDN for this
group chat session so that it is clear for the SMS user that any message sent
to the assigned MSISDN will be delivered to the group chat session
participants, not just to the CPM UE that invited the SMS user.
In this flow, the IP-SM-GW is in the PLMN of the CPM UE, but it could also be
in the PLMN of the SMS user if that user was also a CPM user and had
terminating user preferences to deliver the session invitation via SMS.
Figure B.1: CPM user initiates a group chat and messages are exchanged within
the group chat via service-level interworking
1) The UE registers to S-CSCF according the IMS registration procedure.
2) The UE generates a chat session invitation which includes group
information, e.g. Group identifier in the Request-URI and/or recipient list in
the body of the chat session invitation. UE submits the Instant Message to the
S-CSCF using an appropriate SIP method.
3) Based on the stored iFC, S-CSCF forwards the session invitation to an AS in
charge of handling group chat requests, e.g., the controlling function server
defined in OMA-TS-SIMPLE_IM-V1_0-20070816-C [12] or the controlling function
server defined in OMA-TS-CPM_Conv_Fnct-V1_0-20091222-D [17].
4) The group chat AS replicates a session invitation per recipient according
to the group information it obtains acting as a B2BUA. See details in OMA-TS-
SIMPLE_IM-V1_0-20070816-C [12] or in OMA-TS-CPM_Conv_Fnct-V1_0-20091222-D
[17].
5) The group chat AS sends the generated multiple session invitations to the
S-CSCF.
6) The group chat AS forwards one of the chat session invitations to the IP-
SM-GW according to normal routing procedures (e.g., via S-CSCF).
NOTE 1: Nodes specific to the CPM functions such as ISF are either collocated
with the IP-SM-GW or else are not shown.
7) The IP-SM-GW translates the chat session invitation request to a Short
Message (SMS- SUBMIT) and forwards it towards the group chat SMS-SC (SC
Address) via the SMS-IWMSC (as described in TS 23.040 [2]). The IP-SM-GW
assigns an MSISDN representing the group chat session to ensure that the reply
to this SMS is sent back to this particular IP-SM-GW. Any SMS sent from the
SMS user to this MSISDN will be interworked into the group chat session with
which this MSISDN is correlated. The text in the Short Message is defined by
the operator and conveys information to the SMS user that he is invited to
send and receive messages in the context of a group chat session, and includes
instructions on how to accept, reject and end the session. The identity of the
original sender (CPM user or group) is included as part of the operator
provided invitation text.
8) The SMS-IWMSC forwards the Short Messages (SMS- SUBMIT) to the group chat
SMS-SC and the SMS is delivered to the SMS user using standard SMS procedures
(see TS 23.040 [2]).
9) A Short Message is received from the SMS user via the SMS-GMSC by the IP-
SM-GW, in accordance to steps 2 to 4 and steps 10 to 13 from clause 6.14,
indicating the response to the group chat session invitation. The message is
targeted to the MSISDN representing the group chat session which was assigned
in step 7.
10) If the answer is positive or if operator policy is to accept the session
invitation on behalf of the SMS user, the IP-SM-GW acknowledges the session
invitation. Otherwise the IP-SM-GW will consider the session rejected and send
back an appropriate response.
11) The session invitation acknowledgement is forwarded by S-CSCF to the group
chat AS.
12-13) The group chat AS responds back to the group chat session initiator
once the first user joins the group chat session.
NOTE 2: The following steps are executed only if an SMS with a positive answer
is received from the SMS user or if the operator policy indicated that the
session is accepted without SMS user interaction. In case a negative response
to the invitation is received or if no response from the SMS user is received
within an operator defined time, the IP-SM-GW shall send a negative response
to the chat invitation.
14-17) The IP-SM-GW subscribes to the participant information changes.
NOTE 3: Steps 18 to 21 are repeated for each message sent from any group chat
session participant towards the SMS user, and steps 22 to 24 are repeated for
each message sent from the SMS user towards the group chat session
participants.
18) The CPM UE (or any group chat session participant) sends a message
containing data to the group chat AS.
19) For the group chat session participant who is an SMS user, the message is
routed towards the IP-SM-GW.
20) The IP-SM-GW identifies that a session exists between the SMS user and
group chat AS and transforms the received message into a Short Message and
sends a Short Message (SMS- SUBMIT) carrying the SC Address, then forwards it
towards the group chat SMS-SC (SC Address) via the SMS-IWMSC (as described in
TS 23.040 [2]). The IP-SM-GW inserts the address representing the group chat
session as the sender of the message to ensure that the reply to this SMS is
sent back to this particular IP-SM-GW.
21) The SMS-IWMSC forwards the Short Message (SMS- SUBMIT) to the group chat
SMS-SC and the SMS is delivered to the SMS user using standard SMS procedures
(see TS 23.040 [2]).
22) A Short Message is received from the SMS user via the SMS-GMSC by the IP-
SM-GW, in accordance to steps 2 to 13 from clause 6.14. The message is
targeted to the MSISDN representing the group chat session which was assigned
in step 7.
NOTE 4: Step 5 of the flow in clause 6.14 becomes this: The IP-SM-GW
identifies that a session exists between the SMS user and the CPM user. Steps
6 and 7 of the flow in clause 6.14 are replaced by steps 23 and 24 in this
flow.
> 23) The IP-SM-GW identifies that a session exists between the SMS user and
> the group chat AS and transforms the received message into message data and
> sends it within the session towards the group chat AS.
>
> 24) The group chat AS forwards the message to all group chat participants.
# B.2 Service-level interworking: CPM user extends a one-to-one chat session
into a group chat session
This flow is the same as that described in clause 6.15.1 with the difference
that it is required that the IP-SM-GW assign an MSISDN when this group chat
session starts if one was not assigned before, so that it is clear for the SMS
user that any message sent to the assigned MSISDN will be delivered to the
group chat session participants, not just to the CPM UE that invited the SMS
user.
In this flow, the IP-SM-GW is in the PLMN of the CPM UE, but it could also be
in the PLMN of the SMS user if that user was also a CPM user and had
terminating user preferences to deliver the session invitation via SMS.
Figure B.2: CPM user modifies a one-to-one chat session into a group chat
session
1) A one-to-one chat session is established between the CPM user and the SMS
user.
2) The UE generates a chat session invitation which includes a recipient list
in the body of the chat session invitation. The original SMS user who is part
of the one-to-one chat session is included in that list An indication is added
for the original SMS user in the list that the existing one-to-one session is
to be replaced by the new session. The UE submits the chat session invitation
to the S-CSCF.
3) Based on the stored iFC, S-CSCF forwards the session invitation to an AS in
charge of handling group chat requests, e.g., the controlling function server
defined in OMA-TS-SIMPLE_IM-V1_0-20070816-C [12] or the controlling function
server defined in OMA-TS-CPM_Conv_Fnct-V1_0-20091222-D [17].
4) The group chat AS replicates a session invitation per recipient according
to the group information it obtains acting as a B2BUA. See details in OMA-TS-
SIMPLE_IM-V1_0-20070816-C [12] or in OMA-TS-CPM_Conv_Fnct-V1_0-20091222-D
[17].
5) The group chat AS sends the generated multiple session invitations to the
S-CSCF.
6) The group chat AS sends one of the chat session invitations to the IP-SM-GW
according to normal routing procedures (e.g., via S-CSCF). The chat session
invitation will indicate that the existing session is to be replaced with a
new session.
7) The IP-SM-GW translates the chat session invitation request to a Short
Message (SMS- SUBMIT) and forwards it towards the group chat SMS-SC (SC
Address) via the SMS-IWMSC (as described in TS 23.040 [2]). The IP-SM-GW
assigns an MSISDN representing the group chat session, if one was not assigned
for the one-to-one chat session, to ensure that the reply to this SMS is sent
back to this particular IP-SM-GW. Any SMS sent from the SMS user to this
MSISDN will be interworked into the group chat session with which this MSISDN
is correlated. The text in the Short Message is defined by the operator and
conveys information to the SMS user that the one-to-one session has been
transformed into a group session and that he is invited to send and receive
messages in the context of a group chat session, and includes instructions on
how to accept, reject and end the session. The identity of the original sender
(CPM user or group) is included as part of the operator provided invitation
text.
8) The SMS-IWMSC forwards the Short Messages (SMS- SUBMIT) to the group chat
SMS-SC and the SMS is delivered to the SMS user using standard SMS procedures
(see TS 23.040 [2]).
9) A Short Message is received from the SMS user via the SMS-GMSC by the IP-
SM-GW, in accordance to steps 2 to 4 and steps 10 to 13 from clause 6.14,
indicating the response to the group chat session invitation. The message is
targeted to the MSISDN representing the group chat session which was assigned
in step 7.
10) If the answer is positive or if operator policy is to accept the session
invitation on behalf of the SMS user, the IP-SM-GW acknowledges the session
invitation. Otherwise the IP-SM-GW will consider the session rejected and
sends back an appropriate response.
11) The session invitation acknowledgement is forwarded by S-CSCF to the group
chat AS.
12-13) The group chat AS responds back to the group chat session initiator
once the first user joins the group chat session.
# B.3 Service-level interworking: IP-SM-GW informs SMS users about group chat
participant changes
In this flow, the IP-SM-GW is in the PLMN of the CPM UE, but it could also be
in the PLMN of the SMS user if that user was also a CPM user and had
terminating user preferences to deliver the session invitation via SMS.
Figure B.3: Sending participant information changes to an SMS user in a group
chat session
1) A group chat session including SMS user(s) set up by an IM or CPM user as
described in clause B.1 steps 1-17.
2) The group chat AS detects change in participants of the group chat session
(e.g. participant added or left the group chat session, that event is not
shown in the flow).
3-4) As the IP-SM-GW has subscribed to participant information changes, the
group chat AS notifies the IP-SM-GW about the participant change through the
S-CSCF using an appropriate SIP method.
5-6) The IP-SM-GW acknowledges the notification.
7) According to operator policy, the IP-SM-GW translates the participant
change notification to a Short Message (SMS- SUBMIT) and forwards it towards
the group chat SMS-SC (SC Address) via the SMS-IWMSC (as described in TS
23.040 [2]). The text in the Short Message is defined by the operator and
conveys appropriate information to the SMS user.
8) The SMS-IWMSC forwards the Short Messages (SMS- SUBMIT) to the group chat
SMS-SC and the SMS is delivered to the SMS user using standard SMS procedures
(see TS 23.040 [2]).
###### ### Annex Y: Checklist of service requirements for CPM - SMS
interworking
NOTE: The contents of this Annex will not be transferred to TS 23.204.
The following table lists the service requirements specified in TS 22.340 [s],
clause 11.3 and clarifies how they are fulfilled by the present TR.
Table Y.1
+----+-------------------------------+-------------------------------+ | # | Service requirement | Requirement fulfilled? | +----+-------------------------------+-------------------------------+ | 1 | **Pre Release 10 UE** shall | **Yes** : the solution | | | be supported by SMS-Session | detailed in this TR has no | | | based messaging service-level | impact on the UE. | | | interworking | | +----+-------------------------------+-------------------------------+ | 2 | it shall be possible for a | **Yes** : covered in clause | | | session based messaging user | 6.15 | | | to send a messaging **session | | | | invitation** to an SMS user | | +----+-------------------------------+-------------------------------+ | 3 | When interworking from a | **Yes** : covered in clause | | | Session based message to an | 6.15. | | | SMS message, the network | | | | should deliver all content | | | | types in the **Session based | | | | message to equivalent SMS** | | | | content types where they | | | | exist | | +----+-------------------------------+-------------------------------+ | 4 | When interworking from an SMS | **Yes** : covered in clause | | | message to a Session based | 6.15. | | | message, the network should | | | | deliver all content types in | | | | an **SMS message to | | | | equivalent Session based | | | | message** content types where | | | | they exist | | +----+-------------------------------+-------------------------------+ | 5 | If an SMS user requests an | **Yes** : An SMS status report | | | SMS status report, then an | is based on information | | | **SMS status report** should | received in the SMS Delivery | | | be generated when the message | report and SMS Delivery | | | is delivered using Session | reports for session based | | | based message and a success | messages are covered in | | | or failure delivery | clause 6.14. | | | notification has been | | | | received from the Session | | | | based message user | | +----+-------------------------------+-------------------------------+ | 6 | If a Session based message | **Yes** : covered in clause | | | user requests a notification | 6.18. | | | that the message was | | | | delivered to the recipient, | | | | an SMS status report should | | | | be generated when the message | | | | is delivered to the SMS | | | | user\'s client; an SMS status | | | | report should be communicated | | | | to a Session based message | | | | user as a **delivery | | | | notification** | | +----+-------------------------------+-------------------------------+ | 7 | A session invitation sent | **Yes** : covered in clause | | | towards an SMS user is | 6.15 | | | handled in one of 3 ways | | | | (dependent on service | | | | provider policies): | | | | | | | | 1. The session invitation is | | | | **accepted** by the network | | | | on behalf of the SMS user. | | | | | | | | 2. The session invitation is | | | | **denied** by the network on | | | | behalf of the SMS user. | | | | | | | | 3. The SMS user is asked for | | | | **consent** for accepting the | | | | session invitation | | +----+-------------------------------+-------------------------------+ | 8 | The **user experience** shall | **Yes**. | | | be consistent with the SMS | | | | and Session based messaging | | | | service level expectations to | | | | as large an extent as | | | | possible | | +----+-------------------------------+-------------------------------+ | 9 | For session based messaging | **Yes**. | | | the **session based | | | | connectivity should be | Participation of the SMS user | | | maintained for the SMS user** | in the session: covered in | | | so that the SMS user could | clause 6.15. | | | | | | | - **participate** in the | Exit: covered in clause 6.16 | | | session (i.e. exchange | | | | messages) | | | | | | | | - **exit** the session (no | | | | more message exchange) | | | | according to the instruction | | | | embedded in the SMS message | | +----+-------------------------------+-------------------------------+ | 10 | When interworking a session | **Yes** : covered in clause | | | invitation from a Session | 6.15.2. | | | based messaging service to an | | | | SMS message and a form of | | | | anonymity has been requested | | | | by the sending party and the | | | | **operator of the | | | | interworking function cannot | | | | identify the sending party** , | | | | subject to operator policy, | | | | interworking shall be | | | | suppressed for that session | | | | invitation. Subject to | | | | operator policy and / or the | | | | ability to identify the | | | | sending party, the sending | | | | party may be informed that | | | | the session invitation could | | | | not be delivered | | +----+-------------------------------+-------------------------------+ | 11 | When interworking a session | **Yes** : covered in clause | | | invitation from a Session | 6.15 | | | based messaging service to an | | | | SMS message, it shall be | | | | possible for the sender of | | | | the session invitation to | | | | request to **hide its public | | | | ID** from the recipient (e.g. | | | | be an anonymous sender). In | | | | this case the sender\'s | | | | public ID shall not be | | | | delivered to the recipient | | | | subject to operator policy | | +----+-------------------------------+-------------------------------+ | 12 | It shall be possible to | **Yes** : no change required | | | generate the appropriate | for SA2. | | | **charging** -related | | | | information and provide the | | | | appropriate online charging | | | | mechanism (if it is applied | | | | for the SMS and/or Session | | | | based messaging services) for | | | | the interworking services. | | | | Such charging related | | | | information shall take into | | | | account the one-to-many | | | | relationship of messages sent | | | | to a session | | +----+-------------------------------+-------------------------------+
#
# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
This document specifies the stage 2 system description for providing mobility
between 3GPP Wireless Local Area Network Interworking (I‑WLAN) and 3GPP
Systems. It is to define a technical solution based on the working principles
of DSMIPv6 (see RFC 5555 [7]) with necessary enhancement of the I‑WLAN
architecture for supporting mobility and roaming between 3GPP‑WLAN
Interworking system and 3GPP Systems so that ongoing 3GPP PS based services
can be maintained with minimal impact on the end‑user\'s perceived quality on
the services at a change of the access network (between I‑WLAN and 3GPP Access
Systems.
The specification includes both non‑roaming and roaming scenarios and covers
all aspects, including mobility between 3GPP Systems and I‑WLAN with access
authentication and charging.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.234: _\"_ 3GPP Systems to Wireless Local Area Network (WLAN)
Interworking; System Description _\"_.
[3] 3GPP TS 23.060: _\"General Packet Radio Service (GPRS); Service
Description; Stage 2\"_.
[4] 3GPP TS 23.203: \"Policy and Charging Control Architecture\".
[5] 3GPP TS 33.234: \"3G security; Wireless Local Area Network (WLAN)
interworking security\".
[6] 3GPP TS23.402: \"Architecture Enhancements for non-3GPP accesses\".
[7] IETF RFC 5555: \"Mobile IPv6 support for dual stack Hosts and Routers
(DSMIPv6)_\"_.
[8] IETF RFC 3775: \"Mobility Support in IPv6\".
[9] IETF RFC 4306, \"Internet Key Exchange Protocol Version 2\".
[10] IETF RFC 3748: \"Extensible Authentication Protocol (EAP)\".
[11] IETF RFC 4877: \"Mobile IPv6 Operation with IKEv2 and the Revised IPsec
Architecture\".
[12] IETF RFC 4739: \"Multiple Authentication Exchanges in the Internet Key
Exchange (IKEv2) Protocol\".
[13] 3GPP TS 29.061: \"Interworking between the Public Land Mobile Network
(PLMN) supporting Packet Based Services and Packet Data Networks (PDN)\".
# 3 Definitions and Abbreviations
## 3.1 Definitions
For the purposes of the present document, the definition given in TR 21.905
[1] and the following apply. A definition given in the present document takes
precedence over the same definition, if any, in TR 21.905 [1].
**Home Agent Access Point Name** (HA-APN): Is used to identify a specific PDN
and a point of interconnection to that network (Home Agent).
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
APN Access Point Name
CoA Care-of-address
DHCP Dynamic Host Configuration Protocol
DNS Domain Name System
DSMIPv6 Dual-Stack MIPv6
EPS Evolved Packet Systems
GGSN Gateway GPRS Support Node
GTP GPRS Tunnelling Protocol
HA Home Agent
I‑WLAN Interworking WLAN
MIP Mobile IP
MIPv6 Mobile IP version 6
MN Mobile Node
PDP Packet Data Protocol, e.g. IP
SGSN Serving GPRS Support Node
UE User Equipment
# 4 High-Level Requirements and Principles
## 4.1 General Requirements
\- Access to 3GPP and internet services shall be supported.
\- Smooth migration from legacy network with minimal impacts on dual mode UEs,
I‑WLAN and 3GPP systems shall be possible.
\- Architecture, functions and procedures described in I-WLAN interworking TS
23.234 [2] and GPRS TS 23.060 [3] shall be re-used as basis.
## 4.2 Architecture Requirements
‑ Mobility for PDG based I‑WLAN architecture shall be supported.
‑ Both IPv4 and IPv6 addresses shall be supported
‑ Quality of service shall be supported when the UE moves between I‑WLAN and
3GPP systems
‑ I‑WLAN and 3GPP QoS mechanisms defined in TS 23.234 [2] TS 23.060 [3] and TS
23.203 [4] shall be re‑used. Additionally, the Home Agent shall be able to
provide transport IP QoS e.g. DiffServ support similarly as defined for PDG in
TS 23.234 [2].
## 4.3 Mobility Requirements
‑ Service continuity between 3GPP packet switched network and I‑WLAN with IP
address (es) preservation shall be supported.
‑ Multiple parallel sessions under the same APN shall be maintained when the
UE moves between 3GPP PS network and I‑WLAN. Also the mobility for the UE with
multiple PDN connectivity should be supported.
‑ Interruption time of the operators\' services or applications being provided
to the end user shall be minimized.
‑ It shall be possible to notify to the user the change of the access
networks, 3GPP PS system or I‑WLAN.
‑ It shall be possible to disable the mobility function where applicable to
the operators\' needs.
## 4.4 Roaming Requirements
\- Mobility with re-use of roaming architecture interface(s) and protocol(s)
in a visited PLMN shall be possible.
## 4.5 Charging Requirements
‑ It shall be possible to re‑use existing policy control and charging (PCC)
rules and mechanisms as defined in TS 23.203 [4].
‑ Charging differentiation capability based on radio access type shall be
enabled.
‑ Use of common billing system for 3GPP PS system and the I‑WLAN access shall
be possible.
## 4.6 Security Requirements
\- Existing security measures taken by the end users and the operators shall
not be compromised.
\- It shall be possible for operators to apply common access control based on
TS 33.234 [5] regardless of the change of the accesses by the UEs.
\- The operators shall be able to apply legal interception.
# 5 Concepts and Architecture Model
This specification is based on the architectural/functional/procedural
definitions described in (WLAN Interworking) TS 23.234 [2] and (GPRS) TS
23.060 [3].
I‑WLAN Mobility solution shall allow the operator to configure a type of
access (e.g. 3GPP access) as the \"home link\" for DSMIPv6 purposes.
## 5.1 General Concepts
## 5.2 Architecture Reference Model
### 5.2.1 Home Mobility Service Architecture
The _Home Mobility Service architecture_ refers to the case where the Home
Agent function locates at HPLMN. Whether the user is roaming or not roaming in
the underlying access system and/or whether the illustrated H3 reference point
spans across different administrative domains is not relevant for this
specification.
Figure 5.2.1-1: Home Mobility Service Architecture for I-WLAN Mobility
NOTE: The architecture is compatible with pre-Release 8 PDG and GGSN.
### 5.2.2 Visited Mobility Service Architecture
The Visited Mobility service _architecture_ refers to the case where the Home
Agent function locates outside of the HPLMN. Whether the user is roaming or
not roaming in the underlying access system and/or whether the illustrated H3
reference point spans across different administrative domains is not relevant
for this specification.
Figure 5.2.2-1: Visited Mobility Service Architecture for I-WLAN Mobility
## 5.3 High Level Functions
### 5.3.1 General
The WLAN Interworking Mobility solution described in this TS provides a
DSMIPv6 (see RFC 5555 [7]) based inter-system mobility solution on top of 3GPP
I‑WLAN, TS 23.234 [2] and 3GPP PS domain, TS 23.060 [3]. The inter-system
mobility solution is compatible with pre‑Release 8 TS 23.060 [3] systems and
with pre‑Release 8 TS 23.234 [2] systems.
The inter-system mobility solution provides the following functions:
\- HA discovery.
\- Security association establishment between UE and HA, including the
required AAA interactions.
\- DSMIPv6 signalling and user data transfer between UE and HA.
The inter-system mobility solution has the following limitations:
\- No support for Network Initiated Service Request procedures.
\- No support for PCRF -HA interactions.
\- No updates to the existing PCRFs.
\- No updates to the existing PCC signalling.
\- No updates to the existing PCEF functionality in GGSN and PDG.
NOTE: This means that the PCEF in GGSN and PDG can not operate on service data
flows inside the tunnel between UE and HA.
Extending DSMIPv6 based inter-system mobility, to avoid the above limitations,
requires deployment of EPS PDN GW. EPS PDN GW and its interactions with other
3GPP system nodes are specified in TS 23.402 [6].
Further EPS migration aspects are described in Annex A of this specification.
### 5.3.2 Home Agent Discovery
DSMIPv6 requires that the UE knows the HA IP address in order to establish the
security association with home agent and then, to proceed to binding updates.
This address is made known to the UE with one of the following ways:
1) The IP address of the home agent is statically configured in UE, typically
through a manual method, and is permanent until manually changed.
2) The IP address of the home agent can be retrieved from DNS.
3) The IP address of the home agent can be delivered to the UE via PCO.
4) The PDG may return the IP address of the home agent in IKEv2 configuration
payload to the UE.
NOTE: The underlying IP access network may support other ways of configuring
the HA IP address to the UE, but this is out of the scope of this
specification.
### 5.3.3 Home Link Detection
The DSMIPv6 Home Link Detection Function is used by the UE to detect, if for a
specific PDN, an access interface is the Home Link from DSMIPv6 perspective.
It is up to the UE\'s configuration to decide when to trigger the home link
detection function for a specific PDN connection. Before performing DSMIPv6
registration over any PDN connection, the UE must determine that it is not on
its home link.
The home link detection function compares:
\- IPv6 prefix associated with a specific access interface of the UE; and
\- Home Network Prefix (HNP) allocated to the PDN connection.
If the two prefixes match, the UE detects it is in the home link for this
specific PDN over the access interface. Otherwise, the UE detects it is not in
the home link for this specific PDN over the access interface.
NOTE 1: The UE knows the IPv6 prefix associated with a specific access system
interface via IP address allocation mechanisms applied in that access system.
The UE knows the HNP allocated to the PDN connection from:
\- the IPsec security association bootstrap with the HA; or
\- the PCO delivered to UE at 3GPP attach during the PDP context creation
procedure to the GGSN in 2G/3G; or
\- from the IKEv2 sent to the UE during the IPsec tunnel establishment to the
PDG in I-WLAN.
The GGSN and PDG can get the HNP of the UE by means such as DHCP or AAA.
NOTE 2: The HNP may also be pre-configured in the UE.
## 5.4 Network Elements
**Home Agent (HA):**
The Home Agent communicates with the UE and exchanges DSMIPv6 related
signalling to keep track of the access network the UE is recently camping on.
This signalling is transparent to the Access Routers (AR) (GGSN and PDG).
HA functionality may be implemented as a stand-alone HA entity, or co-located
with GGSN or PDG. The special considerations of the HA‑GGSN and HA‑PDG
co‑location are described in Annex B of this specification. Configuring the
GPRS system as the home link also for a standalone HA is not precluded. The
home link is the link on which the UE\'s home subnet prefix is defined (see
RFC 3775 [8]).
**UE:**
The UE contains a DSMIPv6 Client to enable the DSMIPv6 based signalling and
user data transfer towards the Home Agent.
## 5.5 Reference Points
**HGi:** This reference point defines the interface from the HA to external
PDN
**H1:** This is the reference point for signalling and user data transfer
between UE and HA.
NOTE: H1 may be transported over IP connectivity provided by I‑WLAN or 3GPP
access system.
**H2:** This reference point defines the interface between HA and 3GPP AAA
infrastructure (3GPP AAA server or 3GPP AAA proxy) and is used to transport
authentication, authorization and charging-related information in a secure
manner.
**H3:** This is the IP transport reference point to carry the end-to-end UE-HA
signalling and user data between Access Router and HA. Since there is no
direct signalling messages between these two entities this is simple IP
transport reference point, which does not require additional specification.
# 6 Functional Description and Information Flows
## 6.1 H1 PDN Attach
H1 PDN Attach is triggered by the UE to initialize the I‑WLAN Mobility service
towards a specific PDN. For each PDN connection, the H1 PDN Attach has to be
performed separately.
NOTE 1: The H1 PDN Attach is creating a PDN specific H1 instance between a UE
and a HA.
NOTE 2: To execute H1 PDN Attach via GPRS, the UE shall have Primary PDP
context to GGSN from which the discovered HA can be reached via H3.
When connected over the UE home link (e.g. 3GPP access), the UE may be
configured not to trigger the establishment of IKEv2 SA. In this case, H1 PDN
Attach is triggered when the UE moves to I‑WLAN. During the Handover the UE
keeps using the source 2G/3G) access (i.e. make‑before‑break).
.
Figure 6.1: H1 PDN Attach
1\. The UE discovers the Home Agent as defined in the clause 5.3.2, _Home
Agent Discovery_.
2\. A security association is established between UE and HA to secure the
DSMIPv6 messages related to this PDN connection between the UE and the HA. The
UE initiates the establishment of the security association using IKEv2 [9];
EAP [10] is used over IKEv2 for authentication purposes. The HA communicates
with the AAA infrastructure in order to complete the authentication.
During this step an IPv6 home network prefix is assigned by the HA to the UE
as defined in RFC 4877 [11] and RFC 4306 [9]. During this step the UE may
include the APN of the PDN it wants to access (in the IKE AUTH message using
the IDr payload in similar manner as specified for I‑WLAN in TS 23.234 [2])
and it can also request a specific IPv6 home network prefix as defined in RFC
4877 [11] in order to influence the IP network prefix assignment procedure.
After the IPv6 home network prefix is assigned, UE constructs a home address
from it via auto-configuration.
In this step, the HA may be either in the HPLMN or in the VPLMN. When the HA
is in the VPLMN, the interaction between the HA in the VPLMN with the AAA/HSS
in the HPLMN may involve a 3GPP AAA Proxy in the VPLMN as specified in TS
23.234 [2].
If the PDN requires an additional authentication and authorization with an
external AAA Server additional authentication is executed in this step.
Details on these multiple authentications are specified in RFC 4739 [12] and
in TS 23.234 [2] for I‑WLAN (Private Network Access (PNA)).
3\. In case a Binding Update is required to establish the desired PDN
connectivity (e.g. UE is not at it\'s home link), the UE sends the DSMIPv6
Binding Update message to the HA as specified in RFC 5555 [7]. The UE shall
inform the HA that IP address preservation shall be maintained for the whole
home network prefix.
The HA processes the Binding Update. During the processing the HA performs
local authentication and authorization of the message using the IPsec security
association established in step 2. If the UE does not have an IPv4 HoA
already, it may request for the IPv4 home address from the HA as defined in
RFC 5555 [7] in this step. This request for the IPv4 home address may
alternatively be done in any subsequent Binding Update.
4\. The HA sends the DSMIPv6 Binding Ack to the UE. In this step the HA may
include an IPv4 home address as specified in RFC 5555 [7] if requested by the
UE in step 3. In case GPRS is configured to act as the home link for the PDN
connection, the HA should also include an APN through which it is possible for
the UE to gain GPRS home link connectivity.
5\. The HA may additionally trigger the creation of a child IPsec Security
Association for protecting the traffic sent via the H1 reference point. The
child SA is created as specified in RFC 4877 [22]. Child SA can be used for H1
IP flow integrity protection and may be used also for H1 IP flow encryption.
NOTE 1: The child SA can be established and/or released by HA at any time
after the IKEv2 bootstrap and not only just after step 4.
NOTE 2: In a roaming scenario, the usage of the child SA for H1 IP flow
encryption by HPLMN HA may be restricted by the policies in the roaming
agreement between the VPLMN and the HPLMN.
## 6.2 H1 PDN Detach
The H1 PDN Detach is clearing the PDN specific H1 instance between a UE and a
HA. This H1 PDN detach has no impact to the status of possibly existing other
H1 based PDN connections nor to the underlying IP access connectivity state
e.g. within GPRS system.
### 6.2.1 UE Initiated Detach
The Detach procedure when initiated by the UE is illustrated below.
Figure 6.2-1: UE Initiated Detach Procedure
1\. If a Binding exists, the UE sends the DSMIPv6 Binding Update message to
the HA as specified in RFC 5555 [7]. UE indicates Binding Lifetime as 0. The
HA processes the Binding Update. During the processing the HA performs local
authentication and authorization of the message using the existing IPsec
security association.
2\. The HA sends the DSMIPv6 Binding Ack to the UE.
3\. UE triggers the tear down of the security association between UE and HA
using IKEv2 [9]. The HA acknowledges the security association removal.
4\. The HA communicates with the AAA infrastructure in order to tear down the
H2 session (unless needed to be maintained for other purposes).
In this step, the HA may be either in the HPLMN or in the VPLMN. When the HA
is in the VPLMN, the interaction between the HA in the VPLMN with the AAA/HSS
in the HPLMN may involve a 3GPP AAA Proxy in the VPLMN as specified in TS
23.234 [2].
### 6.2.2 HA Initiated Detach
The detach procedure when initiated by the HA is illustrated below.
**Figure 6.2-2:** HA Initiated Detach Procedure
1\. In the explicit detach procedure the HA shall send a detach request
message as specified. In the implicit detach procedure this step is omitted.
2\. In the explicit detach procedure, the UE shall acknowledge the detach
request. In the implicit detach procedure this step is omitted.
NOTE: How the detach request and acknowledge messages are implemented is a
stage 3 detail.
3\. UE triggers the tear down of the security association between UE and HA
using IKEv2 [9]. The HA acknowledges the security association removal.
4\. The HA communicates with the AAA infrastructure in order to tear down the
H2 session (unless needed to be maintained for other purposes).
In this step, the HA may be either in the HPLMN or in the VPLMN. When the HA
is in the VPLMN, the interaction between the HA in the VPLMN with the AAA/HSS
in the HPLMN may involve a 3GPP AAA Proxy in the VPLMN as specified in TS
23.234 [2].
### 6.2.3 AAA Initiated Detach
The Detach procedure when initiated by the AAA is illustrated below.
Figure 6.2-3: AAA Initiated Detach Procedure
1\. If the AAA wants to request the immediate termination of an H1 session for
a given UE, it shall send a Session Termination message to the HA. In the
roaming case signalling may be routed via a 3GPP AAA Proxy in the VPLMN.
2\. The HA initiated detach procedure is performed as defined in clause 6.2.2,
Figure 6.2-2.
## 6.3 Handover
### 6.3.1 H1 Reference Point Procedure
This procedure is used to bind access specific Care-of Address with the Home
Address. This procedure is performed to either refresh an existing binding or
to change the binding from one Care-of Address to another when the Care-of
Address changes e.g., due to movement between GPRS and I‑WLAN. When this
procedure is triggered it is assumed that the UE already has an IP address
from the underlying IP access system.
In this procedure it is assumed that the UE is already H1 PDN Attached.
Figure 6.3.1-1: Binding Update Procedure
1\. The UE sends the DSMIPv6 Binding Update message to the HA as specified in
RFC 5555 [7]. HA performs local authentication and authorization of the
Binding Update message using the existing IPsec security association. The UE
shall inform the HA that IP address preservation shall be maintained for the
whole home network prefix.
2\. The HA sends the DSMIPv6 Binding Ack to the UE as specified in RFC 5555
[7].
### 6.3.2 Handover Signalling Flows
#### 6.3.2.1 Handover from 3GPP I-WLAN to 3GPP access
The information flow represents a handover scenario from 3GPP I‑WLAN access to
3GPP access for both the home mobility service and the visited mobility
service cases (HSS and 3GPP AAA server are left out for simplicity).
Figure 6.3.2.1-1: Handover from 3GPP I‑WLAN access to 3GPP access
1\. While connected over I-WLAN, the UE discovers the 3GPP GPRS coverage and
determines to transfer its current sessions from the currently used 3GPP
I‑WLAN access to the discovered 3GPP access system.
2\. The GPRS attach procedure including GGSN selection, IP address assignment
to the UE, etc., is involved as specified in TS 23.060 [3]. The GTP tunnel
between UE and GGSN is finally established and the UE can transfer data via
3GPP access.
3\. The UE sends the DSMIPv6 Binding Update message to the HA as specified in
RFC 5555 [7].
A. If the UE is on the home link, the UE sends a BU with LIFETIME==0. The UE
shall inform the HA that IP address preservation shall be maintained for the
whole home network prefix.
B. If the UE is not on the home link, the UE sends a regular BU. The UE shall
inform the HA that IP address preservation shall be maintained for the whole
home network prefix.
4\. The HA sends the DSMIPv6 Binding Ack to the UE as specified in RFC 5555
[7]. The DSMIPv6 tunnelling is modified accordingly.
#### 6.3.2.2 Handover from 3GPP access to 3GPP I-WLAN access
The information flow represents a handover scenario from 3GPP access to 3GPP
I‑WLAN access for both the home mobility service and the visited mobility
service cases (HSS and 3GPP AAA server are left out for simplicity).
Figure 6.3.2.2-1: Handover from 3GPP access to 3GPP I‑WLAN access
1\. The UE discovers the 3GPP I‑WLAN coverage and determines to transfer its
current sessions from the currently used 3GPP GPRS access to the discovered
3GPP I‑WLAN access system.
2\. The UE establishes an IPsec tunnel with PDG according to TS 23.234 [2].
3\. If H1 PDN attach is not already executed, UE triggers H1 PDN attach via
I‑WLAN. If H1 PDN attach is already executed the UE triggers a Binding Update
via I‑WLAN. The UE shall inform the HA that IP address preservation shall be
maintained for the whole home network prefix.
4\. As the result of H1 PDN attach or Binding Update, DSMIPv6 tunnel is
established/re-established between UE and HA, and UE can transfer data via
3GPP I‑WLAN access.
## 6.4 Accounting
H2 reference point supports transfer of accounting related information between
the HA and 3GPP AAA infrastructure. The accounting related functionality in H2
reference point is based on accounting functionality for the Wa reference
point specified in TS 23.234 [2].
As stated in the requirement section, It should be possible to perform
charging differentiation based on radio access type the user is connected for
collocated GGSN/HA and for separate GGSN and HA based architecture. The
charging system may use the UE IP address to correlate the IP session between
GPRS and I-WLAN and the NAS ID / NAS-IP address which correspond either to the
GGSN or PDG or HA to derive the radio access type the user is connected to.
NOTE: How the charging differentiation based on radio access type the user is
implemented is a stage 3 detail.
## 6.5 Interactions with Other Services
When the UE moves between I‑WLAN and GPRS network, as the same IP address is
kept, there is no need to re-register with the IMS network. There is no impact
to the IMS services.
NOTE 1: A new registration to inform the network of changes of the access
radio link (e.g. different capability) may be needed. In this case, because
the P‑CSCF has already been discovered in source access system, the
re‑registration in from the target access system is according to standard IMS
registration.
NOTE 2: Current P‑CSCF discovery mechanisms described in TS 23.228 are re-
used.
## 6.6 IPv4 Home Address Release Procedure
This procedure is initiated by the UE to release an IPv4 Home Address
previously registered at the HA.
Figure 6.6-1: IPv4 Home Address Release Procedure
1\. The UE sends a Binding Update (IPv6 HoA, IPv4 HoA, lifetime=0, IPv4 only
indication) message to the HA with lifetime value set to zero, indicating de-
registration for the IPv4 Home Address only. The indication for IPv4 only
informs the UE that only the IPv4 address from BCE is to be deleted.
2\. The PDN GW modifies the existing entry to delete the IPv4 home address
implied in the Binding Update message from its Binding Cache and releases all
associated resources, and then sends a Binding Ack (lifetime=0, IPv4 only
indicator) message to the UE.
###### ## Annex A (Normative): EPS Migration Considerations
Extension of the DSMIPv6 based inter-system mobility with additional
functionality, such as PCRF interactions, requires deployment of EPS PDNGW,
containing the HA functionality. EPS PDN GW and its interactions with other
3GPP system nodes are specified in TS 23.402 [6].
The intention is not to extend the introduced HA entity to support these
additional release 8 functions of PDN GW. Thus enabling these additional
functions requires migration to EPS.
Figure A-1. illustrates a possible migration path to EPS.
Figure A-1: A possible migration to EPS
Reference point considerations:
\- The H1 should be a subset of S2c.
\- The HGi should be a subset of SGi.
\- The H2 should be a subset of S6b.
###### ## Annex B (Normative): Information on implementation options
# B.1 Co-located HA and GGSN functions
It shall be possible to configure the GPRS access system as the DSMIPv6 \"home
link\". In this case the IP address allocated to the UE by the GPRS system (as
specified in TS 23.060 [3]) is used as the Home Address for DSMIPv6 and so,
DSMIPv6 user plane encapsulation is not used over the GPRS system.
## B.1.1 I-WLAN Mobility System Architecture with Co-located HA-GGSN
The _I-WLAN mobility architecture_ in integrated scenario refers to the case
where the Home Agent function logically locates within the GGSN.
The UE access the operator\'s PS Services via the radio interface labelled Um
in A/Gb mode and Uu in Iu mode for mobile access.
The UE access the operator PS Services via the radio interface labelled Ww for
I‑WLAN access.
_PDP contexts each of them using one unique PDP address are independent to
each other. The terminating access points of these different primary PDP
contexts could be located in the same or in different GGSN/HA\'s._
Figure B-1: Co-located HA and GGSN architecture
## B.1.2 Home Link Discovery for the Co-located HA and GGSN
This section introduces the usage of Protocol Configuration Options (PCO) for
the home link discovery when UE attaches to GPRS which is configured as UE\'s
home link. If the home link information is available in the GGSN, the GGSN
shall send the home link information to the UE in the PCO. The home link
information includes the HA IP address and the HNP.
## B.1.3 3GPP Attachment
In the collocated GGSN/HA I-WLAN mobility architecture, the Mobile Node is in
the home link in 2G/3G. In this case, it does not need to use mobile IP
signalling and encapsulation and it will use the PDP Address as the Home
Address (HoA).
The 3GPP attachment procedure is unchanged. The 2G/3G network is assumed to be
the home link therefore H1 PDN-Attach is not performed.
The following procedure describes the attach procedure over 2G/3G for the GGSN
and HA collocated scenario.
Figure B-2: PDP Context Activation with mobility
1\. The UE initiates the attach procedure at power on. The UE is authenticated
and authorized to access the 2G/3G network according to TS 23.060 [3]. SGSN
may interact with the HLR for Authentication.
2\. The SGSN interacts with the HLR and updates the mobile node\'s location
area as it is specified in TS 23.060 [3]. SGSN receives the Subscriber Data
from HLR.
3\. The UE initiates the PDP context activation procedure as it is specified
in TS 23.060 [3] to obtain the IP address. The Access Point Name (APN)
specified by the service provider may be passed as a parameter. The UE shall
leave the PDP Address empty to request a dynamic PDP address.
4\. The SGSN performs the GGSN selection as it is specified in TS 23.060 [3].
5\. The SGSN requests the selected GGSN to set up a PDP context for the UE as
it is specified in TS 23.060 [3].
6\. If the GGSN can assign an address for the UE locally, it assigns the
address and the GGSN creates a TEID for the requested PDP context. Otherwise
the GGSN uses External PDN Address Allocation mechanism as it is specified in
TS 23.060 [3] and in TS 29.061 [13]. The GGSN obtain a PDP address from the
PDN by means of protocols such as DHCP or RADIUS and creates a TEID for the
requested PDP context.
7\. The GGSN responds back to the SGSN, indicating completion of the PDP
context activation procedure as it is specified in TS 23.060 [3]. The PDP
address, which is sent back to the UE, is the Home Address. In addition to the
GPRS specification TS 23.060 [3], if the Home Link information is available,
the GGSN shall return the HA IP address and the HNP via the PCO to the UE.
8\. The SGSN replies back to the UE as it is specified in TS 23.060 [3]. This
signals completion of the PDP context activation and the IP address allocated
corresponds also to its HoA. The UE stores the information for future use.
NOTE 1: As the UE is on the home link, H1 PDN‑Attach is not performed. How the
UE detects that it is on the home link is described in Home link discovery
section.
NOTE 2: The HA address may be returned to the UE in PCO.
## B.1.4 I-WLAN Attachment
The UE powers on over I‑WLAN and performs I‑WLAN attach procedure according to
TS 23.234 [2] and H1 PDN Attach to the HA according to this specification. The
DSMIPv6 BU/BA to the Home Agent is triggered by the UE.
NOTE: How the UE discovers the HA is defined in HA discovery section (see
clause 5.3.2 Home Agent Discovery).
Figure B-3: I-WLAN Attach with mobility service
1\. The WLAN UE selects a WLAN Access Network and establishes the WLAN
connection with a WLAN technology specific procedure. The UE gets allocated a
local IP address and optionally WLAN Access Authentication and Authorization
which may depend on the home operator policy as well as the policy of the
provider of the WLAN AN according to TS 23.234 [2].
2\. I-WLAN attachment and IPsec tunnel setup is executed according to TS
23.234 [2]. In addition to the procedure defined in TS 23.234 [2]. The PDG may
return the HA address in IKEv2 configuration payload to the UE.
3\. The method by which HA is known to the UE is defined in HA discovery
clause 5.3.2 The UE must know the HA in order to perform BU/BA. This step is
required only if HA address was not discovered via IKEv2 configuration payload
in the previous steps.
4\. H1 PDN-Attach procedure is performed as it is specified in clause 6.1.
5\. The UE can send and receive packet.
## B.1.5 Handover from 3GPP access to I-WLAN
Figure B-4: Handover from 3GPP access to I-WLAN
1\. The precondition of this flow is that the UE is attached to a 3GPP access
and has active PDP context(s) with a GGSN/HA node. There is a GTP tunnel
between the SGSN and the GGSN.
2\. The UE needs to handover to a WLAN access network. The HO decision
mechanism could be based on local policy in the UE.
3\. I-WLAN attachment and IPsec tunnel setup is executed according to TS
23.234 [2]. In addition to the procedure defined in TS 23.234 [2] the UE may
also obtain the Home Agent information via IKEv2 configuration payload if not
already available in the UE.
4\. The UE perform IKEv2/IPsec security association setup procedure with the
Home Agent for DSMIPv6.
5\. The UE sends a binding update to its home agent to update the binding
cache entry at the home agent. The UE will use its IP address used in 3GPP
access as its Home Address. This address will be preserved unless further
indication from the 3GPP access. The UE uses the address configured from the
PDG as the care-of address. The care-of address may be an IPv4 or IPv6
address.
6\. The Home Agent responds with a binding acknowledgement if the binding
update process was successful. The Home Agent also creates the binding cache
entry with the new care-of address of the UE. In this message, the HA also
includes the APN corresponding to the home link for the UE to store.
7\. The successful exchange of binding update and binding acknowledgement
results in a Mobile IP tunnel between the UE and the home agent over the IPsec
tunnel between the UE and the PDG. Data packets are now routed by Home Agent
to UE\'s Care-of-Address via I-WLAN.
8\. During this procedure, bearer resources reserved for the UE are released.
## B.1.6 Handover from I-WLAN to 3GPP Access
The handover may take place when the source network is no longer able to
provide the required user-to-PDN connection service or based on operator
policies.
Figure B-5: Handover from I‑WLAN to 3GPP Access
1\. The precondition of this flow is that he UE is attached over I‑WLAN with
mobility support. There is a Mobile IP tunnel between the UE and the Home
Agent over an IPsec tunnel between the UE and the PDG.
2\. The UE may need to handover to 3GPP access network because I‑WLAN is no
longer able to provide the required user-to-PDN connection service or based on
operator policies. The UE attaches to 3GPP access according to TS 23.060 [3].
In order to generate an APN to be used when activating a PDP context in the
GPRS access, the UE uses the APN information received in the BA during H1 PDN
attach as described in clause 1.6. If no APN is received in the Binding
Acknowledgement message during H1 PDN attach, the UE shall use the pre-
configured APN, if available
3\. The UE initiates PDP context setup according to TS 23.060 [3]. The UE
provides an APN corresponding to the combined GGSN/HA used in the source
access. This results in a PDP context setup with a GTP tunnel between the SGSN
and the GGSN. GGSN returns a PDP address to the UE which is same as the HoA
the UE used in WLAN access in step 1. In case of IPv6, the prefix associated
with the PDP context is the same as the one for HoA (i.e. HNP).
4\. The GGSN/HA interacts with the AAA server for mobility service
authentication and authorization according to TS 29.061 [13].
5\. The UE detects that the HoA and the PDP address are same, so the UE
considers itself in home link. The UE sends a Binding Update to its home agent
with lifetime=0, and CoA=HoA to delete the binding cache entry at the home
agent.
6\. The Home Agent responds with a Binding Acknowledgement if the binding
update process (binding deletion) was successful.
7\. With the Binding Update and binding acknowledgement exchange the HA
recognizes that the UE has returned home and deletes the binding cache. There
is no Mobile IP tunnel between the UE and the home agent however a GTP tunnel
is established between the SGSN and the GGSN.
8\. Bearer Resources on the I-WLAN access system are released according to TS
23.234 [2]. For that the UE detaches from I-WLAN if it has not happened
before.
# B.2 Co-located HA and PDG functions
It shall be possible to co-locate the HA and PDG. The GERAN/UTRAN may still
acts as the home link. In this case the IP address allocated to the UE by the
GPRS system is used as HoA for DSMIPv6.
## B.2.1 H1 PDN Attach
The H1‑ PDN Attach procedure for co-located PDG and HA is based on the attach
procedure described in clause 6.1. When attached to the co-located PDG+HA, the
UE may be on the home link. How the UE finds it\'s in the home link is
described in clause 5.3.3 Home Link Detection.
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the User Plane data transport protocols used
between BSSs and the Core Network (MGWs) across the A interface. The main
purpose of the present document is the AoIP description, however for the sake
of completeness the AoTDM case is described as well.
Figure 1.1: CS core network logical architecture
Note that the present document does not preclude any Core Network Session
Control Protocol implementation (BICC or SIP-I).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] IETF RFC 791: \"Internet Protocol (IP)\".
[3] IETF RFC 2460: \"Internet Protocol, Version 6 (IPv6)\".
[4] IETF RFC 768: \"User Datagram Protocol. (UDP)\".
[5] IETF RFC 3550: \"RTP: A Transport Protocol for Real Time Applications\".
[6] 3GPP TS 29.414: \"Core network Nb Interface data transport and transport
signalling\".
[7] IETF RFC 3551: \"RTP Profile for Audio and Video Conference with Minimal
Control\".
[8] 3GPP TR 29.814: \"Feasibility Study on Bandwidth Savings at Nb Interface
with IP transport\".
[9] IETF RFC 4040: \"RTP Payload Format for a 64 kbits/s Transparent Call\"
[10] IETF RFC 4867: \"RTP Payload Format and File Storage Format for the
Adaptive Multi-Rate (AMR) and Adaptive Multi-Rate Wideband (AMR-WB) Audio
Codecs\"
[11] IETF RFC 2198: \"RTP Payload for redundant Audio Data\"
[12] 3GPP TR 43.903 A-Interface over IP Study (AINTIP)
[13] 3GPP TS 48.001 \"Base Station System -- Mobile-services Switching Centre
(BSS - MSC) interface; General aspects\"
[14] ITU-T Recommendation G.705: \"Characteristics of plesiochronous digital
hierarchy (PDH) equipment functional blocks\".
[15] ANSI T1.102-1993: \"Digital Hierarchy - Electrical Interface\".
[16] ITU-T Recommendation G.711: \"Pulse Code Modulation (PCM) of voice
frequencies\".
[17] 3GPP TS 48.020: \"Rate adaption on the Base Station System - Mobile-
services Switching Centre (BSS - MSC) interface\".
[18] IETF RFC 5993 (2010) \"RTP Payload Format for Global System for Mobile
Communications Half Rate (GSM-HR)\".
[19] 3GPP TS 48.008: \"Mobile Switching Centre - Base Station System (MSC-BSS)
interface; Layer 3 specification\".
[20] 3GPP TS 26.102: \"Adaptive Multi-Rate (AMR) speech codec; Interface to
Iu, Uu and Nb\".
[21] 3GPP TS 23.284: \"Local Call Local Switch; Stage 2\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply.
Intra-BSS call: A mobile to mobile voice call involving two mobile stations
connected to the same BSS.
Local call: An Intra-BSS call that can be locally switched by the BSS. For
details on the Local Switch Service see 3GPP TS 23.284 [21].
Access MGW: The MGW interfacing to the Radio Access Network
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
AoIP A (interface) over IP
AoTDM A (interface) over TDM
APP APPlication
BICC Bearer Independent Call Control
BSS Base Station Subsystem
CS Circuit-Switched
CSData CS Data and fax
IETF Internet Engineering Task Force
IP Internet Protocol
IPv4 Internet Protocol version 4
IPv6 Internet Protocol version 6
ITU-T International Telecommunications Union-Telecommunication sector
MGW Media GateWay
PCM Pulse-Coded Modulation
RFC Request For Comment
RTP Real-Time Transport Protocol
RTCP Real-Time Transport Control Protocol
SIP-I Session Initiation Protocol with encapsulated ISUP
SSRC Synchronisation Source
SVC Switched Virtual Circuit
TDM Time-Division Multiplexing
UDP User Datagram Protocol
UP User Plane
# 4 Transport over TDM
## 4.1 General
The present chapter describes the transport on the A Interface UP over E1/T1
interface; for more information see 3GPP TS 48.001 [13]. Figure 4.1 shows the
protocol stack for the transport network user plane on the A interface.
* * *
Payload\ (PCM encoded speech or CSData)
E1 or T1
* * *
Figure 4.1: TDM Protocol stack for the A interface user plane
Layer 1 shall utilise digital transmission:
\- at a rate of 2 048 kbit/s with a frame structure of 32 x 64kbit/s time
slots, as specified in ITU-T Recommendation G.705 [14] clause 3 for E1
interface; or
\- at a rate of 1 544 kbit/s with a frame structure of 24 x 64 kbit/s time
slots, as specified in T1.102 specification for T1 interface [15].
The payload is either PCM encoded speech (see ITU-T Recommendation G.711 [16])
or CSData (see 3GPP TS 48.020 [17]).
## 4.2 Transport during local switching
When a local switch path is established in the BSS for a local call, the user
plane between the BSS and the Access MGWs for both the call legs in uplink and
downlink shall not be released.
# 5 Transport over IP
## 5.1 General
The present chapter describes the transport of the A-Interface User Plane
Payload by RTP/UDP/IP. Figure 5.1 shows the protocol stack.
* * *
Payload (PCM-coded speech, or compressed speech or CSData) RTP UDP IPv4 or
IPv6
* * *
Figure 5.1: IP Protocol stack for the A-Interface user plane
The specific carrying way at physical/link layer of the IP protocol is not
limited by the present document; if Ethernet is adopted, link layer will be
MAC protocol while if IPoE1 or POS is adopted, link layer will be PPP
protocol. Nevertheless at least Ethernet should be supported.
## 5.2 IP
IPv4 (RFC 791 [2]) shall be supported
IPv6 (RFC 2460 [3]) may be supported as an option.
One BSS/MGW pair may be connected via several IP interfaces.
## 5.3 UDP
The UDP Protocol (see RFC 768 [4]) shall be applied.
Two consecutive port numbers shall be used at each BSS/MGW for the RTP
connection and for the optional RTCP connection that corresponds to a single A
interface UP connection. Two such consecutive port numbers are termed \"port
number block\" in what follows. The first port number shall be even and shall
be assigned to the RTP protocol. For a given BSS/MGW, the same port shall be
used to send and to receive RTP PDUs. The next port number shall be assigned
to the RTCP protocol. This port shall be reserved even if the optional RTCP
protocol is not used.
If multiplexing is applied with or without header compression, the source UDP
port number shall indicate the local termination used to combine the
multiplexed packet and the destination UDP port number shall indicate the
remote port number where PDUs are demultiplexed. The negotiation of whether
multiplexing is applied and of the destination UDP port is described in sub-
clause 5.5.3.2. If multiplexing was negotiated for an A interface UP user
plane connection, the BSS/MGW may apply multiplexing by sending all packets of
the user plane connection (multiplexed with other user plane connections
packets) towards the negotiated destination UDP port.
## 5.4 Transport without RTP multiplexing
### 5.4.1 Introduction
User Plane transport without RTP multiplexing is default and shall be
supported. It shall be applied after call setup, until a User Plane transport
with RTP-multiplexing is negotiated via RTCP, see clause 5.5. RTCP, see RFC
3550 [5] may be applied in AoIP, it is optional. A BSS or MSC may ignore
incoming RTCP packets on AoIP.
### 5.4.2 RTP
The RTP protocol (see RFC 3550 [5]) shall be applied.
#### 5.4.2.1 RTP Header
The RTP Header Fields shall be used as described in the following sub-clauses:
##### 5.4.2.1.1 Version
RTP Version 2 shall be used.
##### 5.4.2.1.2 Padding
Padding shall not be used.
##### 5.4.2.1.3 Extension
The RTP Header extension shall not be used.
##### 5.4.2.1.4 Contributing Source (CSRC) count
There is zero CSRC.
##### 5.4.2.1.5 Marker Bit
The marker bit shall be used as specified for the RTP profile applicable for
the used payload. If AMR or AMR-WB speech is received via the GSM radio
interface, then an ONSET frame precedes the first speech frame. This ONSET
Frame is transported in a separate RTP packet and shall also have the Marker
Bit set to \"1\". Also the next RTP packet, which contains the first speech
frame of the talkspurt, shall have the Marker Bit set to \"1\". In case of
lost speech frames due to radio errors or due to FACCH frame stealing the
Marker bit shall not be set in the first speech frame after that interruption.
##### 5.4.2.1.6 Payload Type
See sub-clause 5.4.2.2.
##### 5.4.2.1.7 Sequence Number
The sequence number shall be supplied by the source (BSS or MGW) of an RTP
packet. **_RTP sequence numbering is based on sent RTP packets, not on
expected speech frames. If frames are lost or stolen on the radio interface
and the codec does not support Bad or No_Data frame types, no RTP packet is
sent in uplink direction and_** the RTP Sequence Number is not incremented,
until a next frame is sent in RTP. This ensures that the receiver of the RTP
stream can detect lost RTP packets by inspecting the RTP Sequence Number.
##### 5.4.2.1.8 Timestamp
The timestamp shall be supplied by the source (BSS or MGW) of a RTP PDU.
Depending of the (pseudo) codec used a clock frequency of either 8 or 16 kHz
shall be used, as described in sub-clause 5.4.2.2. In case of lost or stolen
frames on the radio interface or in case of an interruption of the RTP stream
due to handover, the RTP Timestamp shall be incremented as if no frame would
have been lost. This ensures that the receiver of the RTP stream can
regenerate the time signal correctly.
**NOTE:** IETF RFC 3550 [5] specifies that the RTP timestamp is based on the
sampling instant of the source Encoder. In case of a circuit switched radio
interface the source Encoder for the uplink is within the mobile station. But
the radio interface does not support the transfer of a RTP Timestamp. The
clock synchronisation between mobile station and BSS is, however, very precise
and so the BSS can take the role of the source Encoder and provide the RTP
time stamp.
##### 5.4.2.1.9 Synchronisation Source (SSRC)
The source (BSS or MGW) of a RTP PDU shall supply a SSRC. The receiver of a
RTP PDU may ignore the SSRC if it does not use RTCP.
##### 5.4.2.1.10 CSRC list
This list is empty, i.e. not present.
#### 5.4.2.2 RTP Payload
The packing of the RTP Payload for each Speech Codec Type is specified in TS
26.102 [20].
When defined as such by IETF for a given Speech Codec (see RFC 3550 [5]) and
RFC 3551 [7]) the \"Static\" Payload Type is used; otherwise for RTP profiles
for which IETF defines the Payload Type as \"Dynamic\" (e.g. for AMR codecs,
see RFC4867 [10]) a fixed Payload Type is defined for AoIP in the range of the
dynamic Payload Types, see below.
The mapping between transported RTP payloads and their associated Payload Type
is as follows:
Table 5.4.2.2.1: Type of data transported versus RTP Payload Type
+----------------+----------------+----------------+----------------+ | Type of data | RTP Payload | Clock | | | transported | Type | frequency | | +----------------+----------------+----------------+----------------+ | PCM -law | 0 (see RFC | 8 kHz (see RFC | | | encoded speech | 3551 [7]) | 3551 [7]) | | | (G.711) | | | | +----------------+----------------+----------------+----------------+ | PCM A-law | 8 (see RFC | 8 kHz (see RFC | | | encoded speech | 3551 [7]) | 3551 [7]) | | | (G.711) | | | | +----------------+----------------+----------------+----------------+ | Compressed | GSM FR codec | 3 (see RFC | 8 kHz (see RFC | | | | 3551 [7]) | 3551 [7]) | | Speech | (3GPP TS | | | | | 46.010) | | | +----------------+----------------+----------------+----------------+ | | GSM EFR codec | 110 | 8 kHz (see RFC | | | | | 3551 [7]) | | | (3GPP TS | | | | | 46.060) | | | +----------------+----------------+----------------+----------------+ | | GSM HR codec | 111 | 8 kHz (see | | | | | [18]) | | | (3GPP TS | | | | | 46.020) | | | +----------------+----------------+----------------+----------------+ | | Narrow Band | 112 | 8 kHz (see | | | AMR codecs | | RFC4867 | | | (i.e. FR AMR, | | [10]) | | | HR AMR and OHR | | | | | AMR codecs) | | | | | | | | | | (3GPP TS | | | | | 29.190) | | | +----------------+----------------+----------------+----------------+ | | Wide Band AMR | 113 | 16 kHz (see | | | codecs (i.e. | | RFC4867 | | | AMR-WB, OFR | | [10]) | | | AMR-WB and OHR | | | | | AMR-WB codecs) | | | | | | | | | | (3GPP TS | | | | | 29.190) | | | +----------------+----------------+----------------+----------------+ | CSData (Clear | Without RTP | 120 | 8 kHz (see RFC | | Mode | redundancy | | 4040 [9]) | | pseudo-codec | (redundancy | | | | -- see RFC | level = 1) | | | | 4040 [9]) | | | | | | (3GPP TS | | | | | 48.008 and TS | | | | | 48.020) | | | +----------------+----------------+----------------+----------------+ | | With RTP | 121 | 8 kHz (see RFC | | | redundancy | | 4040 [9] and | | | (redundancy | | RFC 2198 | | | level = 2 or | | [11]) | | | 3) | | | | | | | | | | (3GPP TS | | | | | 48.008 and TS | | | | | 48.020) | | | | | | | | | | See sub-clause | | | | | 5.6 for the | | | | | format | | | | | description | | | +----------------+----------------+----------------+----------------+
#### 5.4.2.3 RTP Packetization Time
The RTP Packetization Time is not negotiated for AoIP, but set to a predefined
fixed value, see TS 26.102 [20].
For compressed speech on the A-Interface the Packetization Time is identical
to the Speech Frame length and that is 20ms for all 3GPP Codec Types.
For PCM-coded speech (ITU-T G.711, A-law and -law) the Packetization Time is
predefined to 20ms for AoIP.
For CSData the Packetization Time is predefined to 20ms, when no redundancy is
used. In case of RTP Redundancy more than one consecutive data block are
included in one RTP packet. But for each of these data blocks the
Packetization Time is predefined to 20ms.
### 5.4.3 RTCP
RTCP (see RFC 3550 [5]) may be applied. The use of the RTCP protocol is
optional.
A BSS/MGW may ignore incoming RTCP PDUs.
## 5.5 Transport with RTP multiplexing
### 5.5.1 Introduction
This sub-clause specifies an optional transport format for the A interface and
IP transport that allows transporting several RTP payload PDUs of different
user plane connections within one UDP/IP packet, and the corresponding
backward compatible signalling extensions required to negotiate the use of
this transport option. Use of this transport format saves bandwidth in the IP
network (bandwidth gains for the Nb interface are evaluated in 3GPP TR 29.814
[8]).
Bandwidth saving is achieved by multiplexing several RTP payload PDUs within
one UDP/IP packet. As an option, the RTP header may be compressed in addition.
Two transport formats are specified accordingly.
As specified in sub-clause 5.5.3.1 RTP multiplexing shall not be applied if
RTP redundancy has been negotiated.
### 5.5.2 RTP
#### 5.5.2.1 Transport format for multiplexing without RTP header compression
Several RTP payload PDUs sent to the same IP address are multiplexed within
one single UDP/IP packet over the A interface. If DiffServ is applied, all
multiplexed PDUs also need to share the same Diffserv class. The multiplexing
shall only be used with RTP packets. RTCP shall be transported normally by
UDP/IP packets.
Use of multiplexing shall be negotiated between BSS and MGW, as specified in
sub-clause 5.5.3.2.
Before each multiplexed RTP/codec payload PDU inserted into the UDP/IP packet
a \"Multiplex Header\", which identifies the multiplexed packet, shall be
inserted.
* * *
Bits Number of Octets  
7 6 5 4 3 2 1 0  
Source IP, Dest IP, ... 20/40 IP  
Source Port, Dest Port = \, Length 8 UDP  
T=0 Mux ID = 2 Multiplex Header  
(Destination UDP Port of non-multiplexed PDU) /2  
Length Inidicator (LI) = n  
R Source ID = 2  
(Source UDP Port of non-multiplexed PUD) /2  
Full RTP packet n RTP header  
RTP Payload  
Multiplex Header 5 Multiplex Header  
Full RTP packet m RTP Header  
RTP Payload  
...
* * *
Figure 5.5.2.1.1: UDP/IP Packet with multiplexed RTP payload PDUs without RTP
header compression
The Multiplex Header includes:
\- T bit.
The field has two possible values, 0 for indicating full packet and 1 for
indicating compressed packet. Value 0 shall be used for an uncompressed RTP
header, as described in the present sub-clause.
\- Mux ID, 15 bits.
For identification of different user plane connections. The value shall be the
UDP destination port of the corresponding non-multiplexed RTP packet divided
by two (only even numbered ports are used for RTP sessions).
\- Length Indicator (LI), 8 bits, unsigned integer.
Gives the length of the multiplexed RTP PDU packet (RTP header + RTP Payload)
in bytes (the last byte of the RTP PDU is padded to the next byte boundary if
necessary). Maximum length is 255 bytes. This LI allows calculating where the
next Multiplex Header for the next multiplexed RTP PDU packet starts.
\- R bit.
Reserved for future use. Shall be set to 0 by the sending entity and be
ignored by the receiving entity.
\- Source ID, 15 bits.
For identification of the different connections. The value shall be the source
UDP port of the corresponding non-multiplexed RTP PDU packet divided by two
(only even numbered ports are used for RTP sessions). This information is
transferred to permit the receiving node to optionally detect and filter
illegitimate packets (e.g. packets received from the peer termination
previously associated to the receiving termination).
The multiplexed RTP payload PDU shall be inserted in the IP/UDP packet
directly after the corresponding Multiplex Header. The multiplexed RTP payload
PDU shall consist of the full RTP header and the RTP payload. If the
multiplexed RTP payload PDU does not end at a byte boundary, then the
remaining bits of its last byte shall be padded with zeros.
#### 5.5.2.2 Transport format for multiplexing with RTP header compression
To achieve even better bandwidth savings, the RTP header may optionally be
compressed. This is possible since the RTP header includes many static fields
that remain unchanged during an RTP session (see sub-clause 5.4.2.).
Use of RTP header compression shall be negotiated between BSS and MGW, as
specified in sub-clause 5.5.3.2.
At least the first two RTP packets of each RTP session shall be sent with
their full RTP header to allow the receiver to store the full header and use
it in decompression. RTP packets shall also be sent with their full RTP header
till receipt of a RTCP packet from the peer indicating support of RTP header
compression. Subsequent packets may be sent with a compressed RTP header. If a
BSS/MGW does not receive any of the initial RTP packets with a full RTP
header, the BSS/MGW shall assume that the fields of the RTP header other than
those present in the compressed RTP header are set as defined in sub-clause
5.4.2, and shall therefore not consider this as an error.
Before each multiplexed RTP payload PDU inserted into the UDP/IP packet a
Multiplex Header, which identifies the multiplexed packet, shall be inserted.
* * *
Bits Number of Octets  
7 6 5 4 3 2 1  
Source IP, Dest IP, ... 20/40 IP  
Source Port, Dest Port=\, Length, ... 8 UDP  
T=1 Mux ID = 2 Multiplex Header  
(Destination UDP Port of non-multiplexed PDU) / 2  
Length Indicator (LI) = n + 4 1  
R Source ID = 2  
(Source UDP Port of non-multiplexed PDU) /2  
Sequence Number (SN) 1 Compressed RTP header  
Timestamp (TS) 2  
M Payload Type (PT) 1  
RTP payload n RTP Payload  
Multiplex Header 5 Multiplex Header  
Compressed RTP header 4 Compressed RTP header  
RTP payload m RTP payload  
...
* * *
Figure 5.5.2.2.1: UDP/IP Packet with multiplexed RTP payload PDUs with RTP
header compression
The Multiplex Header shall be used as described in sub-clause 5.4.3.2.
However, the T bit shall be set for a compressed RTP header, as described in
the present sub-clause. The Length Indicator gives the length of the
multiplexed RTP PDU packet in bytes (compressed RTP header \+ RTP Payload).
The multiplexed RTP payload PDU shall be inserted in the IP/UDP packet
directly after the corresponding Multiplex Header. The multiplexed RTP payload
PDU shall consist of the compressed RTP header described below followed by the
full RTP payload, as for sub-clause 5.4.2.1. If the multiplexed RTP payload
PDU does not end at a byte boundary, then the remaining bits of its last byte
shall be padded with zeros.
The compressed RTP header shall include the following fields taken from the
uncompressed RTP header:
\- Sequence number (SN), 8 bits.
The field is the least significant byte of the original RTP sequence number
(RFC 3550 [29]), hence the sequence number is shortened from 16 bits to 8 bits
(which allows to identify 256 consecutive packets). Sub-clause 5.4.2.1.7 is
applicable.
\- Timestamp (TS), 16 bits.
The TS field is the two least significant bytes of the original RTP timestamp
(RFC 3550 [5]), hence the length is half of the original resulting in modulo
of 8 seconds (resp 4 seconds) with 8 kHz (resp 16 kHz) clock reference. Sub-
clause 5.4.2.1.8 is applicable.
\- Marker bit, 1 bit (see sub-clause 5.4.2)
\- Payload Type, 7 bits (see sub-clause 5.4.2)
NOTE: These RTP fields may change during a connection and thus need to be
transferred within each packet for RTP payload. All other RTP fields do not
change (see sub-clause 5.4.2).
### 5.5.3 RTCP
#### 5.5.3.1 General
A BSS/MGW wishing to apply RTP multiplexing shall use RTCP (see RFC 3550 [5])
to negotiate multiplexing.
RTCP shall be used separately for each user plane connection. RTCP shall be
transported by UDP/IP packets as described in sub-clause 5.4.3. and not
included in IP/UDP packets using the multiplexing format described above.
Multiplexing negotiation shall not be performed for user plane connections for
which RTP redundancy is used.
#### 5.5.3.2 Multiplexing negotiation via RTCP
RTCP shall be used to negotiate the use of multiplexing. A 3GPP-specific RTCP
Multiplexing packet is specified in sub-clause 5.5.3.3. for this purpose, and
may be sent as a non-compound RTCP packet. It may also be added to compound
RTCP packets following the principles of RFC 3550 [5]. The Multiplexing RTCP
packet indicates:
\- if multiplexing without RTP header compression is supported ;
\- if multiplexing with RTP header compression is supported ;
\- the local UDP port where to receive multiplexed data streams,
\- if multiplexing is selected.
When setting up a new user plane connection, both peer BSS and MGW of an UP
connection shall start to send data without applying multiplexing and may
indicate their readiness to receive multiplexed data streams by including the
new RTCP Multiplexing packet in the initial and all subsequent RTCP packets
they send. A BSS/MGW shall always announce the same multiplexing capabilities
and the same UDP port where to receive multiplexed data streams in all the
RTCP Multiplexing packets it sends for a given RTP session. BSS/MGW should
preferably send their initial RTCP packet at the very beginning of the RTP
session to be able to apply multiplexing as soon as possible, and may repeat
it with shorter interval than regular RTCP transmission interval in the
beginning to provide resilience against packet loss. A BSS/MGW sending a
Multiplexing packet indicating support of multiplexing shall be ready to
receive multiplexed packets at the announced UDP port. A single UDP port for
multiplexing shall be used per destination IP address.
A BSS/MGW receiving an RTCP packet, where the peer indicated its readiness to
receive multiplexed data streams, may apply multiplexing to send the
corresponding RTP data streams towards the sender of the RTCP packet. If the
BSS/MGW decides to apply multiplexing, it can immediately start sending
multiplexed data streams towards the corresponding UDP multiplexing port
announced in the received RTCP Multiplexing packet. The BSS/MGW shall indicate
in subsequent RTCP Multiplexing packets if it applies multiplexing with or
without header compression for the given user connection
A BSS/MGW that does not receive RTCP or receives RTCP without the RTCP
Multiplexing packet shall continue to send data for the user connection
without applying multiplexing.
A BSS/MGW that does not support multiplexing will ignore the unknown received
RTCP Multiplexing packet according to RTCP procedures and will continue to
send data for the user connection without applying multiplexing.
Sending of a RTCP Multiplexing packet indicating readiness to receive
multiplexed data streams does not necessarily mean that the BSS/MGW is ready
to send multiplexed data streams, i.e. multiplexing may be applied on a single
or on both directions for a given RTP session.
#### 5.5.3.3 RTCP Multiplexing packet
The format of the RTCP Multiplexing packet is specified in figure 5.5.3.3.1.
* * *
Bits Number of Octets  
7 6 5 4 3 2 1 0  
V=2 P subtype 1 APP packet header  
PT=APP=204 1  
Length 2  
SSRC/CSRC 4  
Name(ASCII) 4  
MUX CP Selection Reserved=0000 2 Application dependent data  
Reserved=00000000  
Reserved=0 Local MUX UDP port /2 2
* * *
Figure 5.5.3.3.1: RTCP Multiplexing packet
The APP packet header includes :
\- version (V), 2 bits
Identifies the version of RTP, which is the same in RTCP packets as in RTP
data packets. RTP Version 2 shall be used.
\- padding (P), 1 bit
As specified in RFC 3550 [4].
\- subtype, 5 bits.
The following subtype value shall be used :
00001 : RTCP Multiplexing packet
\- packet type (PT), 8 bits.
Shall contains the constant 204 to identify this as an RTCP APP packet
\- length, 16 bits.
As specified in RFC 3550 [4]. The length of this RTCP packet in 32-bit words
minus one, including the header and any padding. (The offset of one makes zero
a valid length and avoids a possible infinite loop in scanning a compound RTCP
packet, while counting 32-bit words avoids a validity check for a multiple of
4.)
\- SSRC/CSRC, 32 bits.
As specified in RFC 3550 [4].
\- name, 32 bits.
Shall be set to \"3GPP\"
The application-dependent data includes :
\- multiplexing bit (MUX), 1 bit
Indicates whether multiplexing without RTP header compression is supported or
not by the sender of the RTCP packet : set to 0 if not supported, set to 1 if
supported.
\- multiplexing with RTP header compression bit (CP), 1 bit
Indicates whether multiplexing with RTP header compression is supported or not
by the sender of the RTCP packet : set to 0 if not supported, set to 1 if
supported.
\- Selection bits, 2 bits
Indicates whether the sender of the RTCP packet has selected to apply
multiplexing with or without header compression for the user plane packets
that it sends on this connection. The following values are defined:
00: no multiplexing is applied
01: multiplexing is applied without RTP header compression
10: multiplexing is applied with RTP header compression
11: reserved
\- Local MUX UDP port, 15 bits :
Local UDP port where the sender demands to receive multiplexed data streams.
The value shall be the same as the local MUX UDP port divided by two. This
parameter shall be ignored by the receiver of the RTCP Multiplexing packet if
the MUX and CP bits indicate that multiplexing is not supported.
\- Reserved bits:
Extension bits may be added in the RTCP Multiplexing packet in future
releases. Reserved bits shall be set to 0 in sent RTCP Multiplexing packet of
this release and shall be ignored in incoming RTCP Multiplexing packets.
Extension fields may be added in the RTCP Multiplexing packet in future
releases. They shall be ignored by a BSS/MGW implementing an earlier version
of the specification.
## 5.6 Transport of CSData
### 5.6.1 Introduction
The transport of Circuit Switched Data (CSData) across the A-Interface User
Plane over IP uses per default no redundancy. A constant bit stream of 64kbps
is transported in RTP packets, one every 20ms, with 160 octets payload each.
RFC 4040 [9] is used as basis. It is expected that most IP networks provide a
sufficiently low RTP packet loss rate and redundancy is not needed, because
the errors introduced by the imperfect radio transmission dominate the service
performance by far.
Figure 5.6.1.1: No Redundancy (redundancy level = 1)
RTP redundancy may be used for CSData calls in AoIP in networks with
noticeable RTP packet losses in order to reduce the data loss rate and improve
the success rate of sensitive CSData services (e.g. fax). RTP redundancy
increases the transmission delay noticeably and the bandwidth demand across
the A-Interface substantially. RTP redundancy shall not be used for speech
calls on AoIP. RFC 2198 [11] is used as basis.
RTP redundancy increases the size of RTP packets substantially and is
therefore not compatible with RTP multiplexing. On the other hand RTP
Multiplexing would not gain much due to the already low overhead caused by
this packet size.
RTP redundancy for CSData is negotiated per call between MSC and BSS in
BSSMAP, see TS 48.008 [19]. **RTP redundancy is always used symmetrically,
i.e. the same redundancy level is used in both directions across the
A-Interface for a given call. The negotiated RTP redundancy is exactly known
to sender and receiver in AoIP.**
For RTP redundancy, several successive data blocks are usually packed (except
for start and stop) into one RTP packet. The number of RTP packets is not
increased (or only marginally due to start/stop effects). The normal number of
successive data blocks in one RTP packet is defined as \"redundancy level\".
Redundancy level 1 denotes the transmission without redundancy (Figure
5.6.1.1).
When RTP redundancy is used, the redundancy level can be either 2 (Figure
5.6.1.2) or 3 (Figure 5.6.1.3).
Figure 5.6.1.2: RTP packets with redundant data with redundancy level = 2
Figure 5.6.1.3: RTP packets with redundant data with redundancy level = 3
Each RTP packet with redundancy consists of the \"primary\" data block and one
or two \"redundant\" data blocks. The Time Stamp of the RTP packet is
identical to the Time Stamp of the primary data block. The redundant data
blocks have Time Stamp values lower than the primary data block (except when
wrap around of timestamp occurs). Note that also RTP packets without redundant
data blocks are used in start and stop, when redundancy has been negotiated.
### 5.6.2 Transport formats for CSData
#### 5.6.2.1 Transport format for CSData without redundancy
If RTP redundancy is not used, then RTP multiplexing may be applied. The
following text describes the RTP packet format for CSData on AoIP without RTP
multiplexing.
The RTP packet format for CSData is defined in RFC 4040 [9]). For AoIP the RTP
Payload Type \"120\" identifies this RTP Packet as \"RTP packet without
redundancy\". The RTP sequence number is \"n\". It is incremented by the
sender by 1 with every newly sent RTP packet, regardless of the Time Stamp.
The Time Stamp of the RTP Packet is \"Tn\". It is incremented by the sender as
appropriate. Since for AoIP the Packetization Time is fixed to 20ms and the
Sampling Clock is fixed to 8000, the Time Stamp is incremented typically by
160.
Due to the fixed Packetization time and Sampling Clock one data block in
CSData for AoIP has 160 octets (O1 to O160). The length of the data block is
not explicitly given within the RTP packet; it can be derived from the size of
the RTP packet minus the overhead (12 octets).
Here the example for one RTP packet for CSData in AoIP with no redundancy (4
octets in one row):
* * *
Octet 1 (5, 9, ...) Octet 2 (6, 10, ...) Octet 3 (7, 11, ...) Octet 4 (8, 12,
...)  
V=2 P X CC=0 M PT = 120 Sequence number of primary data block: n Time Stamp of
primary data block: Tn  
Synchronisation Source Identifier (SSRC)  
O1 of CSData (primary=Tn) O2 of CSData (Tn) O3 of CSData (Tn) O4 of CSData
(Tn)  
... ... ...  
... ... ... O160 of CSData (Tn)
* * *
Figure 5.6.2.1.1: RTP packetisation for CSData without redundancy
#### 5.6.2.2 Transport format for CSData with redundancy
If RTP redundancy is used, then RTP multiplexing shall not be applied. When
RTP redundancy is used (redundancy level = 2 or 3) the RTP packet format is
further defined in RFC 2198 [11]).
The RTP Payload Type of \"121\" in AoIP identifies this RTP packet as \"RTP
packet with redundancy\".
RFC 2198 introduces just after the main RTP header (first 12 octets) a sub-
header as (example RED=3):
* * *
Octet 1 (5, 9) Octet 2 (6) Octet 3 (7) Octet 4 (8)  
F=1 Block-PT (n-2) = 120 Timestamp-offset of block (n-2) = 320 Block-length
(n-2) = 160  
F=1 Block-PT (n-1) = 120 Timestamp-offset of block (n-1) = 160 Block-length
(n-1) = 160  
F=0 Block-PT (n) = 120
* * *
Figure 5.6.2.2.1: RTP sub-header for CSData with redundancy
This sub-header includes:
**F bi** t: 1 bit; set to\ 1, if this is a redundant data block and another
data block follows\ 0, if this is the last (primary) data block
**Block-Payload Type** : 7 bits; set to 120 in case of CSData on AoIP.
**Timestamp-Offset:** 14 bits;\ unsigned integer; specifies the offset with
respect to the (main) Time Stamp of the RTP packet.\ It allows to compute the
actual timestamp of the corresponding redundant data block, which equals\ Time
Stamp (data block) = Timestamp (RTP packet) -- Timestamp-Offset (data block).
**Block Length** : 10 bits\ unsigned integer; specifies the size of the data
block in octets.
The Block-Payload Type (\"120\" for AoIP) identifies that the primary and
redundant data are packed according to RFC 4040, see above, as specified for
AoIP. The Time Stamp of the RTP Packet is identical to the Time Stamp of the
primary data block (n), which comes last in the RTP packet. The redundant data
block (n-1), which comes before the primary data block, has 160 octets, its
Time Stamp (Tn-160) is defined relative to the Time Stamp of the primary data
block, i.e. Timestamp-offset = 160\. The block-length of the redundant data
(n-1) block is specified.
The length of the primary data block is not explicitly included, it can be
derived from the size of the RTP packet minus the overhead minus the size of
the redundant data blocks.
Here the example for one RTP packet with RED=2:
* * *
Octet 1 (5, 9, ...) Octet 2 (6, 10, ...) Octet 3 (7, 11, ...) Octet 4 (8, 12,
...)  
V=2 P X CC=0 M Main-PT = 121 Sequence number of primary data block: n Time
Stamp of primary data block: Tn  
Synchronisation Source Identifier (SSRC)  
1 Block-PT = 120 Timestamp-offset of block n-1 = 160 Block-length (n-1) = 160  
0 Block-PT = 120 O1 of CSData (red=Tn-160) O2 of CSData (red=Tn-160) O3 of
CSData (red=Tn-160)  
... ... ... ...  
O160 of CSData (red=Tn-160) O1 of CSData (prim=Tn) ... ...  
... ... ... ...  
O160 of CSData (Tn)
* * *
Figure 5.6.2.2.2: RTP packetisation for CSData with redundancy RED=2
Here the example for one RTP packet with RED=3:
* * *
Octet 1 (5, 9, ...) Octet 2 (6, 10, ...) Octet 3 (7, 11, ...) Octet 4 (8, 12,
...)  
V=2 P X CC=0 M Main-PT = 121 Sequence number of primary data block: n Time
Stamp of primary data block: Tn  
Synchronisation Source Identifier (SSRC)  
1 Block-PT = 120 Timestamp offset of block n-2 = 320 Block-length (n-2) = 160  
1 Block-PT = 120 Timestamp offset of block n-1 = 160 Block-length (n-1) = 160  
0 Block-PT = 120 O1 of CSData (red=Tn-320) O2 of CSData (red=Tn-320) O3 of
CSData (red=Tn-320)  
... ... ... ...  
O160 of CSData (Tn-320) O1 of CSData (red=Tn-160) ... ...  
... ... ... ...  
O160 of CSData (Tn-160) O1 of CSData (prim=Tn) ... ...  
... ... ... ...  
O160 of CSData (Tn)
* * *
Figure 5.6.2.2.3: RTP packetisation for CSData with redundancy RED=3
#### 5.6.2.3 Start and Stop of RTP streams with redundancy
For the first RTP packet in a stream of RTP packets with redundancy only one
data block exists: the primary data block. Therefore this first RTP packet
looks like:
* * *
Octet 1 (5, 9, ...) Octet 2 (6, 10, ...) Octet 3 (7, 11, ...) Octet 4 (8, 12,
...)  
V=2 P X CC=0 M Main-PT = 121 Sequence number of primary data block: n Time
Stamp of primary data block: Tn  
Synchronisation Source Identifier (SSRC)  
0 Block-PT = 120 O1 of CSData (prim=Tn) O2 of CSData (Tn) O3 of CSData (Tn)  
... ... ... ...  
O160 of CSData (Tn)
* * *
Figure 5.6.2.3.1: RTP packetisation for CSData with redundancy RED=3
The (main-) Payload Type of the RTP Packet is set to \"121\" to indicate the
redundancy. But the sub-header specifies only one data block with Paylaod Type
\"120\" and no further redundant data blocks. So this RTP packet is different
to the one for no redundancy, although only one data block is included. The
second RTP packet looks always like shown in the example above for RED=2. If
RED=2 is negotiated, then all following RTP packets are identical in design to
the second one. If RED=3 is negotiated, then the third and all following RTP
packets look like shown in the example above for RED=3. Since the primary data
block is always the last in the RTP packet and is defining the Time Stamp for
the RTP packet, this Time Stamp is always incrementing by 160.
For the last RTP packets in a stream of RTP packets with redundancy the packet
content is again redunced from 3 to 2 to 1 data block and so the very last RTP
packet is designed like the very first one, then last-1 like the second and
the last-2 like the third. But at the end no new primary data blocks are
added, the last block in the RTP packet is then already a redundant data block
and therefore the Time Stamp of the RTP packet does not longer increment (but
the RTP sequence number does increment).
The start of the RTP stream is important at call setup and handover. The end
of the RTP stream is important at handover, maybe less important at the end of
the call.
## 5.7 Transport during local switching
When a local switch path is established in the BSS for a local call, the
UDP/IP endpoints at the BSS and the Access MGWs for both the call legs in
uplink and downlink shall not be released.
#
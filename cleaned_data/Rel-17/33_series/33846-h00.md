# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The scope of the present document is the following:
\- key issues, potential security requirements and solutions of how to enhance
the authentication process to ensure the security of session anchor keys in
case the long-term key is leaked.
\- key issues, potential security requirements and solutions of how to
mitigate the linkability attacks.
\- key issues, potential security requirements and solutions of how to
mitigate the impacts of potential DDoS threats due to concealing the SUPI.
\- key issues, potential security requirements and solution of how to mitigate
the leaking of SQN values during AKA re-synchronisation.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 33.501: \"Security architecture and procedures for 5G system\".
[3] 3GPP TS 33.102: \"Security architecture\".
[4] Ravishankar Borgaonkar (published online: July 2019), \"New Privacy Threat
on 3G, 4G, and Upcoming 5G AKA Protocols\",
https://eprint.iacr.org/2018/1175.pdf.
[5] 3GPP TS 29.503: \"5G System; Unified Data Management Services\".
[6] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
[7] 3GPP TS 33.220: \"Generic Authentication Architecture (GAA); Generic
Bootstrapping Architecture (GBA)\".
[8] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[9] Krawczyk, Hugo. \"SIGMA: The \'SIGn-and-MAc\'approach to authenticated
Diffie-Hellman and its use in the IKE protocols.\" Annual International
Cryptology Conference. Springer, Berlin.
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
## 3.2 Symbols
Void
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
# 4 Current status of the primary authentication procedure in the 5G System
## 4.1 General
Primary authentication in 5GS is specified in TS 33.501 [2] clause 6.1. The
purpose of the primary authentication and key agreement procedures is to
enable mutual authentication between the UE and the network and provide keying
material that can be used between the UE and the serving network in subsequent
security procedures.
Primary authentication is initiated by the serving network as a response to a
UE action such as a Registration Request. The serving network contacts the
home network in order to retrieve authentication vectors as well as the
authentication method. Currently two authentication methods are supported in
5GS: 5G AKA specified in TS 33.501 [2], clause 6.1.3.2 and EAP-AKA\' specified
in TS 33.501 [2] clause 6.1.3.1.
Primary authentication in 5G also includes increased home control specified in
TS 33.501 [2], clause 6.1.4. As part of the home control, the serving network
notifies the home network about the success of the primary authentication on
the serving network and the home network also verifies the success of the
procedure from a home point of view. The serving network is notified with the
home network authentication decision. As part of the increased home control
the home network maintains of the authentication status on a UE and authorizes
subsequent procedures.
# 5 Key issues
## 5.1 Key issues on anchor keys security
### 5.1.0 General
No key issues were agreed for the topic of anchor key security.
## 5.2 Key issues on resilience against identifier linkability
### 5.2.1 Key Issue #2.1: Linkability by distinguishing MAC failure and
synchronization failure
#### 5.2.1.1 Issue details
In 5G, 5G AKA and EAP AKA\' are subjected to the linkability attacks like UMTS
AKA because they inherit the error messages (MAC failure, Synch failure) from
UMTS AKA. Further, tracing a UE may also be possible due to distinguishment of
other interactions.
In this linkability attack, the attacker can detect the presence of a victim
subscriber, in one of his monitored areas, an active attacker just needs to
have previously intercepted one legitimate authentication request message
containing the pair (RAND,AUTN) sent by the network to UE. The captured
authentication request can now be replayed by the adversary each time he wants
to check the presence of UE in a particular area. In fact, thanks to the error
messages, the adversary can distinguish any UE from the one the authentication
request was originally sent to. On reception of the replayed authentication
challenge and authentication vectors (RAND, AUTN), the victim UE successfully
verifies the MAC and sends a synchronization failure message. However, the MAC
verification fails when executed by any other UE, and as a result a MAC
failure message is sent. The implementation of few false base station would
then allow an attacker to trace the movements of a victim UE, resulting in a
breach of the subscriber\'s untraceability.
The attacker could distinguish the MAC failure and synchronization failure
using the several methods, such as according to the failure cause embedded in
the authentication failure message sent by the victim UE, or according the
difference between the length of the response for MAC failure and the length
of the response for SYNC failure. Hence, the mechanism used for mitigating the
linkability attack takes all the above methods into consideration.
NOTE 1: The attacker could also distinguish other interaction differences
between the UE and the network to trace the victim UE, such as whether NAS SMC
is triggered, Registration Accept/Reject, or the other message length
differences. However, these types of linkability attacks are not in focus of
this key issue.
NOTE 2: For the linkability attack where the attacker replays legitimate
authentication requests, there will not be subsequent NAS messages from AMF.
#### 5.2.1.2 Security Threats
In case the linkability attack occurs, it represents a breach of the user\'s
untraceability, the attacker can establish the traceability of a subscriber
based on the study of the failure messages and can detect subscriber\'s
presence in a specific area by replaying one old legitimate authentication
vector including (RAND and AUTN).
#### 5.2.1.3 Potential security requirements
The 5G system shall support mechanisms to mitigate the linkability attacks.
### 5.2.2 Key Issue #2.2: SUCI based attacks
#### 5.2.2.1 Key issue details
##### 5.2.2.1.0 General
This key issue addresses SUCI replay attacks.
A specific SUCI linkability attack and a DoS attack related to SUCI replay are
described in the following.
NOTE: KI#2.1 holds the related generic requirement for mitigation of
linkability attacks, but this key issue holds specific requirements related to
SUCI usage.
##### 5.2.2.1.1 Linkability attack
###### 5.2.2.1.1.1 Linkability by SUCI replay
The SUCI can be used for a linkability attack, i.e. an attack by which it is
possible to find out whether a UE observed at some location/time X is
identical to a UE observed at some location/time Y. For this, an attacker
records a SUCI that is used over the radio interface by a UE_A.
As the UE uses a 5G-GUTI rather than a SUCI in most cases, the attacker may
also execute an active attack, such as corrupting the 5G-GUTI when it is sent
by the UE, which leads with a significant probability to an identity request,
so the UE will send a SUCI subsequently in an identity response. An attacker
may catch many SUCIs by this method from location/time X.
The attacker can set up a base station at a different location and actively
changes the registration request of users registering to this base station.
The linkability attack works then like this: If some UE_B makes _a
registration request_ to this false base station operated as a relay by the
same attacker, the attacker can modify UE_B\'s _registration request_ message
by exchanging the SUCI used in this request by the previously captured SUCI of
UE_A or in case of 5G GUTI being used forcing the UE first to respond to an
identity request and then modifying the registration request. The modified
request is forwarded to the network. Note, this is possible, because UE B\'s
first message is unsecured pre-authentication traffic.
Subsequently, the attacker observes whether a successful AKA run is performed,
and the _registration request_ is accepted by the network. If so, then UE_ B
needs to be the same as UE_A. Thus the location and time of a UE moving from
one tracking area to another can be linked and may compromise the privacy of
the owner of the UE.
Note that this attack cannot by mitigated by hiding only the content of the
AKA response, because the attacker can detect from the subsequent messages
(e.g. RRC SMC procedure, repetition of the AKA, or RRC release) whether the
AKA run was successful or not. If the content of the AKA response is not
hidden that could be used directly to determine the UE under attack is
present.
###### 5.2.2.1.1.2 Linkability by generation of different SUCIs
In contrasts to above scenario where replaying a previously captured SUCI to
the network, i.e. replacing a SUCI that a UE sends to the network in some NAS
message (e.g. registration request, identity response) with the previously
captured SUCI, and observing whether the authentication is successful was
addressed, this key issue shows that the linkability attack is also possible
without SUCI replay.
This SUCI-based linkability attack does not use a previously captured SUCI but
uses a SUCI generated by the attacker from a SUPI. This is possible, if an
attacker has gained knowledge of the SUPI of a subscriber, e.g. by IMSI
catching in 4G. Or, if an attacker wants to trace a specific person, e.g. the
leader of a country or the CEO of a company, from whom the SUPI is known. This
attack only applies to scenarios where the SUCI calculation is to be performed
by the ME. For scenarios where the SUCI calculation is to be performed by the
USIM, the home network public key is never available to the ME and cannot be
retrieved by an attacker.
##### 5.2.2.1.2 DoS attack
The current ECIES scheme is vulnerable to replay attacks because it does not
have the mechanisms in the network side to justify whether the received SUCI
was the previous one sent by the UE to the network or not.
If an attacker launches the replay attack multiple times, the UDM and the UE
have to spend a lot of resources to process the replayed SUCI and the
_authentication request message_ respectively because these messages are
legitimate. This raises a DoS attack on the UDM and the UE respectively.
#### 5.2.2.2 Potential threats
##### 5.2.2.2.1 Linkability attack
In case of SUCI replay attack: An attacker observes whether a successful AKA
run is performed with a replayed SUCI, i.e. if the registration request is
accepted by the network. If so, the attacker can link a UE observed in one
location with a UE observed in another location. If done at several location,
even though UE may still be anonymous, the tracking profile of the same UE
being in different location may compromise privacy.
Based on the response to the valid AUTN and RAND from the UE _,_ the attacker
could trace the UE with some confidence even though its SUPI is unknown to the
attacker.
In case of linkability attack by generating different SUCIs: An attacker
operating a false base station can detect a known subscriber\'s presence in a
specific area and a specific time by linking authentication responses for
different requests, if different SUCIs were generated from the same SUPI/IMSI.
In case this linkability attack occurs, traceability of a subscriber becomes
possible. The attacker observes that the UE under attack is receiving a
response to a registration request. This allows to locate a UE in different
cells and therefore allows correlation. Thus, it represents a breach of the
user\'s untraceability, thus, this attack compromises privacy.
##### 5.2.2.2.2 DoS _attack_
Replaying the same SUCI many times could lead to a DoS attack on the UDM and
the UE respectively. A DoS attack on the UE may result in a decrease in the
processing capability of the UE and a rapid consumption of the battery. A DoS
attack on UDM will cause the processing power of the UDM to decrease and the
response to the request of the legitimate UE to be slow.
#### 5.2.2.3 Potential security requirements
The 5G system should support mechanisms to mitigate SUCI based attacks.
## 5.3 Key issues on availability aspects of SUCI usage
### 5.3.1 Key Issue #3.1: Attack due to expired authentication result in the
UDM
#### 5.3.1.1 Key issue details
TS 33.501 [2] clause 6.1.4 specifies that the authentication result will be
stored by the UDM after the successful authentication, and can be used to link
authentication confirmation to the subsequent procedures, in order to prevent
certain types of fraud, e.g. fraudulent Nudm_UECM_Registration Request for
registering the subscriber\'s serving AMF in UDM while the subscriber is not
actually present in the visited network.
However, in the case of UE/network-initiated deregistration procedure or SMC
failure after AKA in the registration procedure, UDM still has the
authentication result, according to TS 29.503 [5]. This may cause security
issues. Fraudulent UDM service request like fraudulent Nudm_UECM_ Registration
service request sent by the AMF may be accepted by the UDM, and the UDM may
store the AMF ID as the current AMF serving for the UE, even though the UE is
already deregistered from the serving network. Therefore, in the
deregistration or NAS SMC failure case described above, the authentication
result is removed, considering the authentication result usage specified in TS
33.501 [2] clause 6.1.4.
NOTE: The clarification with respect to the alignment of this key issue with
the objectives of the study is not addressed in the present document.
#### 5.3.1.2 Security threats
In case of UE-initiated deregistration procedure, or network-initiated
deregistration, or SMC failure after AKA during the registration procedure,
the fraudulent service request can be initiated by an attacker to tamper, or
steal the UE data, or subscribe the service from the UDM if the authentication
result stored in the UDM is not removed. For example, fraudulent Nudm_UECM_
Registration service request can be sent by the attacker, and accepted by the
UDM to store the AMF ID as the current AMF which is serving for the UE.
Fraudulent Nudm_SDM_Get service may be used by the attacker to steal the data
from the UDM.
#### 5.3.1.3 Potential security requirements
The fraudulent attack due to expired authentication result in the UDM shall be
mitigated.
### 5.3.2 Key Issue #3.2: SUPI guessing attacks
#### 5.3.2.1 Key issue details
It is plausible that the attacker knows the network\'s public key provisioned
in the attacker-controlled SIM card and uses this information to guess SUPIs.
The attacker could launch a SUPI guessing attack as follows.
It generates a guessed SUPI and converts it into SUCI by using network\'s
public key. The attacker operates a false base station and forwards the
fabricated _Registration Request_ message containing the SUCI. Up on receipt
of a _Registration Request_ message, the network decrypts SUCI and obtains the
SUPI. If SUPI is valid, the network sends an _Authentication Request_ message;
otherwise, the network issues a _Registration Reject_ message. The attacker
observes in its false base station the network response. Thus the attacker can
ascertain that the guessed SUPI is valid if the _Authentication Request_
message is sent by the network. After a great number of SUPI guessing attacks,
the adversary could figure out the whole database of SUPIs for a dedicated
network.
The attacker further could determine whether the valid SUPI belongs to a
dedicated victim or not. It forwards the received _Authentication Request_
message to the victim. If the victim replies with the _Authentication Failure_
message, then the valid SUPI does not match the victim. If the victim responds
with _Authentication Response_ message, then the victim with the valid SUPI is
found.
This attack only applies to scenarios where the SUCI calculation is to be
performed by the ME. For scenarios where the SUCI calculation is to be
performed by the USIM, the home network public key is never available to the
ME and cannot be retrieved by an attacker.
#### 5.3.2.2 Security threats
The attacker is able to determine whether a SUPI belongs to a given network.
The attacker can make an association between the SUPI and a pair of AUTN and
RAND. Based on the AUTN and RAND, the attacker could determine whether the
victim UE is in the vicinity or not. With this association, an attacker could
continuously trace a dedicated victim.
#### 5.3.2.3 Potential security requirements
The 5G system should provide the mechanism to mitigate SUPI guessing attacks.
## 5.4 Key issues on re-synchronisation in AKA
### 5.4.1 Key Issue #4.1: Protection of SQN during AKA re-synchronisations
#### 5.4.1.1 Key issue details
The freshness parameter for the calculation of AK (the keystream that protects
the SQN returned to the network) during a re-synchronisation in AKA is the
random number RAND from the challenge. An attacker can force the re-use of
RAND and hence the keystream AK may be used multiple times to protect
different SQNs [4]. The attacker could leverage the feedback from the network
side and conduct an activity monitoring attack to break subscribers\' privacy.
It is preferable to avoid such keystream re-use.
#### 5.4.1.2 Security threats
The re-use of key stream allows an attacker to obtain the XORes value between
two different SQNs. It has been shown in [4] how this property in conjunction
with issuing fresh challenges can enable an attacker to estimate the least
significant bits of SQN. Hence some information about SQN can leak despite the
encryption of SQN, which lead to the privacy leakage of the subscribers.
#### 5.4.1.3 Potential security requirements
The protection of SQN during AKA re-synchronisations should prevent the
information leakage of SQN values.
# 6 Solutions
## 6.0 Mapping of solutions to key issues
Table 6.0-1: Mapping of solutions to key issues
+--------+--------+-------+-------+-------+-------+-------+---+---+ | Sol | Key | | | | | | | | | utions | Issues | | | | | | | | +========+========+=======+=======+=======+=======+=======+===+===+ | | #1.X | #2.1 | #2.2 | #3.1 | #3.2 | #4.1 | | | | | | | | | | | | | | | | | | *) | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | Sol | | | | | | | | | | utions | | | | | | | | | | for | | | | | | | | | | anchor | | | | | | | | | | ** | | | | | | | | | | keys**| | | | | | | | | | se | | | | | | | | | | curity | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | No | | | | | | | | | | so | | | | | | | | | | lution | | | | | | | | | | so far | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ |** Sol | | | | | | | | | | utions | | | | | | | | | | for | | | | | | | | | | resi | | | | | | | | | | lience | | | | | | | | | | a | | | | | | | | | | gainst | | | | | | | | | | iden | | | | | | | | | | tifier | | | | | | | | | | l | | | | | | | | | | inkabi | | | | | | | | | | lity**| | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #2.1: | | | | | | x | | | | Ha | | | | | | | | | | ndling | | | | | | | | | | of | | | | | | | | | | Sync | | | | | | | | | | f | | | | | | | | | | ailure | | | | | | | | | | by | | | | | | | | | | AUTS | | | | | | | | | | encr | | | | | | | | | | yption | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #2.2: | | x | | | | x | | | | Encr | | | | | | | | | | yption | | | | | | | | | | of | | | | | | | | | | au | | | | | | | | | | thenti | | | | | | | | | | cation | | | | | | | | | | f | | | | | | | | | | ailure | | | | | | | | | | m | | | | | | | | | | essage | | | | | | | | | | types | | | | | | | | | | by UE | | | | | | | | | | with | | | | | | | | | | new | | | | | | | | | | keys | | | | | | | | | | d | | | | | | | | | | erived | | | | | | | | | | from | | | | | | | | | | K | | | | | | | | | | _AUSF | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #2.3: | | x | | | | | | | | U | | | | | | | | | | nified | | | | | | | | | | au | | | | | | | | | | thenti | | | | | | | | | | cation | | | | | | | | | | re | | | | | | | | | | sponse | | | | | | | | | | m | | | | | | | | | | essage | | | | | | | | | | by UE | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #2.4: | | x | | | | x | | | | MAC-S | | | | | | | | | | based | | | | | | | | | | so | | | | | | | | | | lution | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #2.5: | | x | | | | x | | | | Encr | | | | | | | | | | yption | | | | | | | | | | of | | | | | | | | | | au | | | | | | | | | | thenti | | | | | | | | | | cation | | | | | | | | | | f | | | | | | | | | | ailure | | | | | | | | | | m | | | | | | | | | | essage | | | | | | | | | | with | | | | | | | | | | SUCI | | | | | | | | | | method | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #2.6: | | x | | | | x | | | | Certi | | | | | | | | | | ficate | | | | | | | | | | based | | | | | | | | | | encr | | | | | | | | | | yption | | | | | | | | | | of | | | | | | | | | | u | | | | | | | | | | nicast | | | | | | | | | | NAS | | | | | | | | | | m | | | | | | | | | | essage | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #2.7: | | | x | | | | | | | Miti | | | | | | | | | | gation | | | | | | | | | | a | | | | | | | | | | gainst | | | | | | | | | | the | | | | | | | | | | SUCI | | | | | | | | | | replay | | | | | | | | | | attack | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #2.8: | | | x | | | | | | | As | | | | | | | | | | suring | | | | | | | | | | SUCI | | | | | | | | | | gene | | | | | | | | | | ration | | | | | | | | | | by | | | | | | | | | | Legi | | | | | | | | | | timate | | | | | | | | | | SUPI | | | | | | | | | | owner | | | | | | | | | | using | | | | | | | | | | K | | | | | | | | | | ~SUCI~ | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #2.9: | | x | | | | | | | | MAC, | | | | | | | | | | SYNCH | | | | | | | | | | f | | | | | | | | | | ailure | | | | | | | | | | cause | | | | | | | | | | conce | | | | | | | | | | alment | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | So | | | x | | | | | | | lution | | | | | | | | | | to Key | | | | | | | | | | Issue | | | | | | | | | | #2.2: | | | | | | | | | | SUCI | | | | | | | | | | replay | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | So | | | x | | | | | | | lution | | | | | | | | | | \ | | | | | | | | | | #2.11: | | | | | | | | | | Mi | | | | | | | | | | tigate | | | | | | | | | | the | | | | | | | | | | SUCI | | | | | | | | | | replay | | | | | | | | | | based | | | | | | | | | | on | | | | | | | | | | UE\'s | | | | | | | | | | public | | | | | | | | | | key | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | So | | x | x | | x | x | | | | lution | | | | | | | | | | \ | | | | | | | | | | #2.12: | | | | | | | | | | Adding | | | | | | | | | | rand | | | | | | | | | | omness | | | | | | | | | | and | | | | | | | | | | MAC | | | | | | | | | | calcu | | | | | | | | | | lation | | | | | | | | | | on the | | | | | | | | | | UE | | | | | | | | | | side | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ |** Sol | | | | | | | | | | utions | | | | | | | | | | for | | | | | | | | | | availa | | | | | | | | | | bility | | | | | | | | | | a | | | | | | | | | | spects | | | | | | | | | | of | | | | | | | | | | SUCI | | | | | | | | | | u | | | | | | | | | | sage**| | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | So | | | x | | x | x | | | | lution | | | | | | | | | | #3.1: | | | | | | | | | | Miti | | | | | | | | | | gation | | | | | | | | | | of | | | | | | | | | | SUPI | | | | | | | | | | gu | | | | | | | | | | essing | | | | | | | | | | and | | | | | | | | | | SUCI | | | | | | | | | | replay | | | | | | | | | | attack | | | | | | | | | | using | | | | | | | | | | long | | | | | | | | | | term | | | | | | | | | | key | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | So | | | | | x | | | | | lution | | | | | | | | | | #3.2: | | | | | | | | | | Adding | | | | | | | | | | Check | | | | | | | | | | Value | | | | | | | | | | behind | | | | | | | | | | SUPI | | | | | | | | | | to | | | | | | | | | | mi | | | | | | | | | | tigate | | | | | | | | | | the | | | | | | | | | | SUPI | | | | | | | | | | gu | | | | | | | | | | essing | | | | | | | | | | a | | | | | | | | | | ttacks | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | So | | | | | x | | | | | lution | | | | | | | | | | #3.3: | | | | | | | | | | Miti | | | | | | | | | | gation | | | | | | | | | | of | | | | | | | | | | SUPI | | | | | | | | | | gu | | | | | | | | | | essing | | | | | | | | | | attack | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ |** Sol | | | | | | | | | | utions | | | | | | | | | | on | | | | | | | | | | re-syn | | | | | | | | | | chroni | | | | | | | | | | sation | | | | | | | | | | in | | | | | | | | | | AKA** | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #4.1: | | | | | | x | | | | Using | | | | | | | | | | MACS | | | | | | | | | | as | | | | | | | | | | fre | | | | | | | | | | shness | | | | | | | | | | in the | | | | | | | | | | calcu | | | | | | | | | | lation | | | | | | | | | | of AK | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #4.2: | | | | | | x | | | | Using | | | | | | | | | | sym | | | | | | | | | | metric | | | | | | | | | | encr | | | | | | | | | | yption | | | | | | | | | | fu | | | | | | | | | | nction | | | | | | | | | | to | | | | | | | | | | p | | | | | | | | | | rotect | | | | | | | | | | SQN | | | | | | | | | | during | | | | | | | | | | a | | | | | | | | | | re-syn | | | | | | | | | | chroni | | | | | | | | | | sation | | | | | | | | | | pro | | | | | | | | | | cedure | | | | | | | | | | in AKA | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #4.3: | | | | | | x | | | | SQN | | | | | | | | | | prot | | | | | | | | | | ection | | | | | | | | | | by | | | | | | | | | | conce | | | | | | | | | | alment | | | | | | | | | | with | | | | | | | | | | SUPI | | | | | | | | | | in | | | | | | | | | | USIM | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #4.4: | | | | | | x | | | | SQN | | | | | | | | | | prot | | | | | | | | | | ection | | | | | | | | | | during | | | | | | | | | | re-syn | | | | | | | | | | chroni | | | | | | | | | | sation | | | | | | | | | | pro | | | | | | | | | | cedure | | | | | | | | | | in AKA | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #4.5: | | | | | | x | | | | AUTS | | | | | | | | | | S | | | | | | | | | | QN~MS~ | | | | | | | | | | so | | | | | | | | | | lution | | | | | | | | | | for | | | | | | | | | | 5GS | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #4.6: | | | | | | x | | | | Using | | | | | | | | | | time | | | | | | | | | | -based | | | | | | | | | | or | | | | | | | | | | partly | | | | | | | | | | time | | | | | | | | | | -based | | | | | | | | | | SQN | | | | | | | | | | gene | | | | | | | | | | ration | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | #4.7: | | | | | | x | | | | SQN | | | | | | | | | | prot | | | | | | | | | | ection | | | | | | | | | | by | | | | | | | | | | conce | | | | | | | | | | alment | | | | | | | | | | with | | | | | | | | | | SUPI | | | | | | | | | | with | | | | | | | | | | f5* | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+ | NOTE: | | | | | | | | | | *) | | | | | | | | | | #KI | | | | | | | | | | 3.1 | | | | | | | | | | was | | | | | | | | | | con | | | | | | | | | | cluded | | | | | | | | | | to | | | | | | | | | | have | | | | | | | | | | no | | | | | | | | | | nor | | | | | | | | | | mative | | | | | | | | | | work. | | | | | | | | | +--------+--------+-------+-------+-------+-------+-------+---+---+
## 6.1 Solutions for anchor keys security
### 6.1.0 General
No solutions were agreed for the topic of anchor key security since no key
issues were agreed.
## 6.2 Solutions for resilience against identifier linkability
### 6.2.1 Solution #2.1: Handling of Sync failure and MAC failure by
AUTS/random number encryption and failure code
#### 6.2.1.1 Introduction
This solution addresses the key issue #4.1 Protection of SQN during AKA re-
synchronisations. The AUSF and UE stores the K~AUSF~ during successful
authentication. When MAC or sync failure occurred, the UE uses the K~AUSF~
stored during previously successful authentication to encrypt the AUTS/random
number and failure code, and the AUSF uses the K~AUSF~ stored during
previously successful authentication to decrypt the AUTS/random number and
failure code.
Note: The security risk of using a fixed key is not addressed here.
If no stored K~AUSF~, the KEY is a 256-bit binary string of all 0s.
#### 6.2.1.2 Solution details
##### 6.2.1.2.0 Authentication procedure
Figure 6.2.1.2: Authentication procedure for 5G AKA
The authentication procedure of 5G AKA in 6.1.3.2.0 of TS 33.501 [2] is
followed with the modifications:
Step 3: The AUSF shall store the XRES* temporarily together with the received
SUCI or SUPI. The AUSF shall store the K~AUSF~.
Step 8: The UE shall return RES* to the SEAF in a NAS message Authentication
Response. The UE shall store the K~AUSF~.
Step 11:When the AUSF receives as authentication confirmation the
Nausf_UEAuthentication_Authenticate Request message including a RES* it may
verify whether the AV has expired. If the AV has expired, the AUSF may
consider the authentication as unsuccessful from the home network point of
view, and in this case the AUSF shall remove the K~AUSF~ stored in step 2.
AUSF shall compare the received RES* with the stored XRES*. If the RES* and
XRES* are equal, the AUSF shall consider the authentication as successful from
the home network point of view, and in this case the AUSF shall remove the old
K~AUSF~ stored during previously successful authentication if exists. AUSF
shall inform UDM about the authentication result (see clause 6.1.4 of the
present document for linking with the authentication confirmation).
The handling of Sync failure in 6.1.3.3 of TS 33.501 [2] is followed with the
modifications in bold:
##### 6.2.1.2.1 Synchronization failure or MAC failure
###### 6.2.1.2.1.1 Synchronization failure or MAC failure in USIM
This clause describes synchronisation failure or MAC failure in USIM.
In step 7 in Figure 6.1.3.2-1 when 5G AKA is used; or in step 5 in Figure
6.1.3.1-1 when EAP-AKA\' is used, at the receipt of the RAND and AUTN, if the
verification of the AUTN fails, then the USIM indicates to the UE the reason
for failure and in the case of a synchronisation failure passes the AUTS
parameter (see TS 33.102 [9]) to the UE.
If 5G AKA is used: The ME responds with NAS message Authentication Failure
with a CAUSE value indicating the reason for failure. In case of a
synchronisation failure of AUTN (as described in TS 33.102 [9]), **the UE
should also include encrypted AUTS that the plaintext AUTS was provided by the
USIM.** **In case of a MAC failure, the UE should generate and encrypt a
random number as same length as the AUTS. Upon receipt of an authentication
failure message from AUSF, the AMF/SEAF may initiate new authentication
towards the UE.**
**The AUTS and failure code encryption is done by following: The UE generates
a keystream by computing HMAC-SHA-256 with a KEY and RAND as input. If the UE
has stored a K~AUSF~, the KEY is the KAUSF, otherwise the KEY is 256-bit
string of all 0s. The UE uses a bit per bit binary addition of failure code,
the AUTS and the keystream.**
If EAP-AKA\' is used: The UE proceeds as described in RFC 4187 [21] and RFC
5448 [12] for EAP-AKA\'.
###### 6.2.1.2.1.2 Synchronization failure recovery and MAC failure in Home
Network
Upon receiving an authentication failure message _with_ **encrypted
AUTS/random number and failure code** from the UE, the SEAF sends a
Nausf_UEAuthentication_Authenticate Request message with **the encrypted
AUTS/random number and failure code** to the AUSF. **The AUSF generates a
keystream by computing HMAC-SHA-256 with a KEY and RAND sent to the UE in the
preceding Authentication Request as input. If the AUSF has stored a K~AUSF~
that generated during previously successful authentication, the KEY is the
KAUSF, otherwise the KEY is 256-bit string of all 0s. The AUSF uses a bit per
bit binary addition of the encrypted AUTS/random number and failure code and
the keystream to get the plaintext AUTS/random number and failure code.**
**Note: if the KEY is the K~AUSF~ and the failure code is not synchronization
failure or MAC failure, the KEY is changed into 256-bit string of all 0s for
decrypting the encrypted AUTS/random number and failure code.**
**If the failure code is synchronization failure, the AUSF then sends a
Nudm_UEAuthentication_Get Request message to the UDM/ARPF, together with the
following parameters:**
**_\- RAND_ sent to the UE in the preceding Authentication Request, and**
**\- Plaintext AUTS.**
**Else, the AUSF sends Nausf_UEAuthentication_Authenticate Response message
with failure code to the SEAF, and the SEAF may send identity request to UE
(see TS 24.501[35]).**
An SEAF will not react to unsolicited \"synchronisation failure indication\"
messages from the UE.
The SEAF does not send new authentication requests to the UE before having
received the response to its Nausf_UEAuthentication_Authenticate Request
message with a \"_synchronisation failure indication_ \" from the AUSF (or
before it is timed out).
When the UDM/ARPF receives an Nudm_UEAuthentication_Get Request message with a
\"_synchronisation failure indication_ \" it acts as described in TS 33.102
[9], clause 6.3.5 where ARPF is mapped to HE/AuC. The UDM/ARPF sends an
Nudm_UEAuthentication_Get Response message with a new authentication vector
for either EAP-AKA\' or 5G-AKA depending on the authentication method
applicable for the user to the AUSF. The AUSF runs a new authentication
procedure with the UE according to clauses 6.1.3.1 or 6.1.3.2 depending on the
authentication method applicable for the user.
#### 6.2.1.3 Evaluation
The protection of SQN will only work over 5G network.
The use of key of 256-bit string of all 0s may cause linkability attack.
The solution impacts the SEAF/AMF.
### 6.2.2 Solution #2.2: Encryption of authentication failure message types by
UE with new keys derived from K_AUSF
#### 6.2.2.1 Introduction
This solution addresses the key issue#2.1 and key issue #4.1.
#### 6.2.2.2 Solution details
The basic idea of the solution is that the UE sends only one encrypted message
to the network to indicate the error message type (MAC_FAIL, SYNC_FAIL) if the
UE authentication network fails. This message is protected by using the
encryption key K~E~ and the integrity key K~M~, which are derived from the
session anchor key K~AUSF~ that is known to the UE and the network. Since this
message is encrypted, the attacker cannot get the content of this message, and
cannot initiate a linkability attack. Moreover, the SQN is not disclosed even
if the key stream to encrypt the SQN is reused, since the AUTS which is the
XORes value between SQN and the key stream is encrypted with the key KE. The
procedure of the proposal is illustrated in the figure 6.2.2-1.
Figure 6.2.2-1
The steps of the proposal are as follows.
1\. The network authenticates the UE using the selected authentication
protocol.
2\. The UE verifies the network. If the verification fails, an _Authentication
Response_ message is generated, which includes FAIL_CAUSE, Nonce, SUPI, and
RES_DATA. The value of FAIL_CAUSE can be MAC_FAIL, SYNC_FAIL. Nonce is a one-
time random number that makes the ciphertext of the Authentication Response
message different each time to prevent the attacker from guessing the actual
value of FAIL_CAUSE. The SUPI of the UE may be optionally sent to the network
in this message to prevent the SEAF from initiating an _Identity Request_
message to the UE. In this way, SEAF could only send an _Authentication
Request_ message to the UE regardless of whether it is MAC_FAIL or SYNC_FAIL,
thereby avoiding the linkability attack raised by that the SEAF acknowledges
the UE with different actions after receiving the different _Authentication
Response_ message specified in reference [3]. If the value of FAIL_CAUSE is
SYNC_FAIL and RES_DATA is AUTS, it is generated according to reference [2] for
restoring SQN synchronization between UE and network. If the value of
FAIL_CAUSE is MAC_FAIL, RES_DATA is a random number whose length is the same
as that of AUTS. This _Authentication Response_ message is encrypted by using
the encryption key K~E~, and its MAC is generated by using the integrity key
K~M~. The generation of the keys K~E~ and K~M~ is carried out in accordance
with the key derivation function KDF of TS 33.220 [7] Appendix B, which is
calculated as K~E~=KDF (K~AUSF~, RAND \|\| length of RAND â€– Nonce â€– length of
Nonce â€– \"Encryption Key\"â€– Length of \"Encryption Key\"), K~M~=KDF (K~AUSF~,
RAND \|\| length of RAND â€– Nonce â€– length of Nonce â€– \"MAC Key\"â€–Length of
\"MAC Key\"). Here \"â€–\" represents the string concatenation. The
authentication failure message for the first UE registration is left
unencrypted, i.e. the initial value of KAUSF is set to zero.
3\. The UE sends an _Authentication Response_ message to the SEAF.
4\. The SEAF forwards the _Authentication Response_ message to the AUSF in the
message Nausf_UE Authentication_Authenticate request.
5\. Like UE, the AUSF derives the encryption key K~E~ and the integrity key
K~M~ from the session anchor key K~AUSF~. Further the AUSF verifies the MAC
using the integrity key K~M~, and if the verification is successful, decrypts
the message using the encryption key K~E~.
6\. If FAIL_CAUSE is SYNC_FAIL, the AUSF sends a Nudm_UEAuthentication_Get
request message to the UDM with the following parameters: RAND and AUTS. The
UDM synchronizes the SQN of the network with the SQN of the UE according to
AUTS and RAND.
7\. The AUSF sends FAIL_CAUSE and the SUPI of the UE to the SEAF.
#### 6.2.2.3 Evaluation
The protection of SQN will only work over 5G network _._
The solution has impact on the serving network when 5G AKA is used.
The solution requires changes to the serving network for 5G AKA.
FAIL CAUSE encryption: the authentication failure message for the first UE
registration is left unencrypted, i.e. the initial value of K~AUSF~ is set to
zero.
SUPI could lead to linkability attacks when SUPI is sent in the Authentication
Response Message: Because a weaker encryption key K~E~ is used to conceal
SUPI, it could make it easier for the attacker to get the SUPI by
cryptoanalysis. This is, because K~E~ can be generated by anyone, if KAUSF is
zero, since RAND is known value (in clear) received along with AUTN and the
rest of the parameters is no secret information. If SUPI (optional field) is
not included as part of Authentication response, then it does not lead to
linkability attack.
It is necessary to specify the encryption and MAC algorithms used to protect
Authentication Response message. Algorithms from the ECIES Profile (see [2]
Annex C) may be used.
### 6.2.3 Solution #2.3: Unified authentication response message by UE
#### 6.2.3.1 Introduction
This solution addresses the aspect of \"breach of the user\'s untraceability\"
in Key Issue #3.1 \"Mitigation against the linkability attack\".
#### 6.2.3.2 Solution details
The authentication response message has the uniform format to protect the user
privacy.
Figure 6.2.3.2-1: Authentication procedure for 5G AKA
When the UE receives the authentication request message from the AMF/SEAF, it
sends unified authentication response message with same format in the
following scenarios. The message includes three part: RES*, AUTS, and a cause
value. The cause value in these three cases can be the same value.
Cause A: If the verification of the AUTN passes, the UE generates the
authentication response message containing a RES* calculated according to
Annex A.4 in TS 33.501 [2], in which a pseudo AUTS and a cause value are also
included. The pseudo AUTS is generated with random numbers.
Case B: If the UE determines the SQN to not be in the correct range, it
generates the authentication response message containing an AUTS calculated
according to Clause 6.3.3 in TS 33.102 [3], in which a pseudo parameter RES*
and a cause value are also included. The pseudo RES* is generated with random
numbers.
Case C: If the MAC failure occurs, the UE generates the authentication
response message containing a cause value, in which a pseudo RES* and AUTS are
also included. The pseudo RES* and AUTS are generated with random numbers.
The above authentication response message with the same format is then sent to
the AMF/SEAF. The cause value parameter is used to notify AMF/SEAF to only
consider the three possible cases \"successful, MAC failure, synch failure\".
Once the AMF/SEAF receives the authentication response message, it interacts
with the AUSF according to the verification of authentication response
message, which is as specified in the following:
\- If the AMF/SEAF determines the HRES* is correct, it sends a
Nausf_UEAuthentication_Authenticate Request message containing the parameter
RES* to the AUSF. The following procedure is performed according to Clause
6.1.3.2 in TS 33.501 [2].
\- Otherwise, the AMF/SEAF sends a Nausf_UEAuthentication_Authenticate Request
message containing the AUTS to the AUSF. The AUSF then sends a
Nudm_UEAuthentication_Get Request to the UDM containing the AUTS. If the
verification of AUTS passes, the UDM updates the SQN and generate a new AV,
and then send it back to the AMF/SEAF. If the AMF/SEAF receives this new AV,
it neglects the cause value in the authentication response message received
from the UE and launch the reauthentication procedure; Or, if the AMF/SEAF
receives a response indicating the failure of AUTS verification from the UDM,
it sends a reject message to UE based on the cause value in the authentication
response message. For MAC failure, the UDM sends the confirmation result back
to AMF. AMF handle the case as the existing handling defined in TS 24.501 [6].
#### 6.2.3.3 Evaluation
This solution enables the network to mitigate one kind of Linkability attacks
which are based on recognising the different authentication responses.
When the UE receives the authentication request message, UE generates
authentication response with unified format for successful authentication, MAC
failure and sync failure. Successful authentication can be distinguished
through verification of RES* in AMF. MAC failure and sync failure can be
differentiated through verification of AUTS in UDM. This solution modifies the
original authentication response message as described in TS 24.501 [6] with
the idea to provide in failure and success case no evidence of the outcome of
authentication that an attacker can see at the air interface.
The attackers are unable to get the failure type with the authentication
response message (by not using authentication failure message).
This solution impacts the visited network.
### 6.2.4 Solution #2.4: MAC-S based solution
#### 6.2.4.1 Introduction
This solution addresses the key issues #2.1 and #4.1.
#### 6.2.4.2 Solution details
The procedure works as follow when the USIM detects a MAC failure or a
synchronisation failure during the authentication procedure.
Figure 6.2.4.2-1: Mitigation against linkability issue
> 1\. The home network sends an authentication request.
>
> 2\. The SEAF sends the authentication request to the UE.
>
> 3\. The USIM verifies the freshness of the 5G authentication vector by
> checking whether the AUTN can be accepted.
If the USIM detects a MAC failure, then the USIM returns a synchronisation
failure message (AUTS) consisting of a random number.
If the USIM detects a synchronisation failure, then the USIM generates a
random value RAND_SQN, returns an AUTS containing RAND_SQN instead of the
SQN~MS~ and the corresponding MAC-S based on RAND_SQN.
> 4\. The UE sends the authentication response to the SEAF.
>
> 5\. The SEAF sends to the home network a Nausf_UEAuthentication_Authenticate
> Request with a synchronization failure indication.
>
> 6\. The home network checks the MAC-S value send by the USIM.
If the MAC-S verification is successful, then the home network knows that the
failure corresponds to a synchronization failure. Otherwise, the home network
concludes that the failure corresponds to a MAC failure.
The home network can take the decision to create a new authentication vector
either to run a new authentication procedure or to run an authentication
procedure for resynchronisation in order to retrieve the SQN~MS~ value from
the UE.
In case of authentication procedure for resynchronisation
7\. The home network decides to perform authentication procedure.
The home network retrieves RAND_SQN from the AUTS previously sent by the USIM,
generates a new random RAND_SVR and computes RAND_Sync, where RAND_Sync =
RAND_SQN \|\| RAND_SVR
The home network computes an authentication vector built with RAND_Sync, sets
AMF field to indicate a resynchronization procedure, and sends the
authentication vector to the SEAF.
> 8\. The home network sends an authentication request.
>
> 9\. The SEAF sends the authentication request to the UE.
>
> 10\. The USIM verifies the freshness of the 5G authentication vector by
> checking whether the AUTN can be accepted.
If the MAC is valid and if the AMF field indicates a resynchronization
procedure, then the USIM verifies that the received RAND_Sync has been
generated based on the USIM Random_SQN previously sent. If the verification of
the RAND_Sync is successful, then the USIM computes AK = f5~K~ (RAND_Sync) and
returns AUTS (SQN~MS~ âŠ• AK \|\| MAC-S). If the verification of the RAND_Sync
is unsuccessful, then the USIM returns a synchronisation failure message as
defined for MAC failure in step 3.
> 11\. The UE sends the Authentication response to the SEAF.
>
> 12\. The SEAF sends to the home network a
> Nausf_UEAuthentication_Authenticate Request with a synchronization failure
> indication.
>
> 13\. The home network checks the MAC-S value sent by the USIM.
>
> If the MAC-S verification is successful, then the home network knows that
> the failure corresponds to a synchronization failure. Additionally, the home
> network knows that an authentication procedure for resynchronisation
> procedure is ongoing. Consequently, the home network uses RAND_Sync to
> compute AK and retrieves SQN~MS~.
Additionally, in order to improve the security, the following steps can take
place:
\- The USIM records all authentication errors (MAC and Sequence Number
errors).
\- The USIM informs the user of potential attack when counter reaches a pre-
defined threshold.
\- Once the connection is established, the USIM reports the attack location
and attack scenario.
The solution impacts only the USIM and the home network. The solution requires
change of the USIM.
#### 6.2.4.3 Evaluation
##### 6.2.4.3.1 Active attack
The solution protects against linkability attacks based on recognizing MAC /
synchronization failures on the radio interface, and protects the procedure
for resynchronization thanks to the addition of new parameter RAND_Sync.
##### 6.2.4.3.2 Modification of failure message
The solution proposed that both MAC failure message and Sync failure has same
format, only one of them includes the MAC. The attacker could modify any of
them to make the MAC verification failed.
\- If the failure message is MAC failure message, it contains a random number
instead of the MAC-S in AUTS. Supposing the attacker tamper the content, then
after the network verify the MAC-S, it will fail, then the network take this
failure message as the MAC failure.
\- If the failure message is Sync failure message, it contains a MAC-S in
AUTS. Supposing the attacker tampers the MAC-S, then after the network verify
the MAC-S, it will fail, then the network takes this failure message as the
MAC failure, which is incorrect.
This could lead to attack in which all the failure message will be taken as
the MAC failure, and the original MAC failure is tampered while the network is
not aware, then upon receipt of an authentication failure message, the
AMF/SEAF may initiate new authentication towards the UE.
But, this attack is not new, it already exists in AKA.
##### 6.2.4.3.3 Unified failure message
The solution proposes a unified format for MAC failure and synchronisation
failure since the key issue on \"resilience against identifier linkability\"
(key issue in clause 5.2) results from the fact that an attacker could
distinguish the MAC failure and the synchronization failure sent by the UE.
The solution does not propose to have a unified authentication response to
cover scenarios where 1- the verification of the AUTN successful, or 2- there
is MAC failure, or 3- there is synchronization failure since the integration
of the RES in the unified format would have implied substantial changes to the
AMF.
##### 6.2.4.3.4 Authentication for resynchronization
The changes to the authentication procedure with addition of RAND_SQN improves
the security since the presence of RAND_SQN, generated by the USIM, ensures
that the RAND_Sync value (RAND_Sync = RAND_SQN \|\| RAND_SVR) used for the
authentication for resynchronization is not a RAND value corresponding to
previous successful authentications. Additionally, thanks to the use of the
AMF field sent by the home network to indicate a resynchronization in the
authentication request of step 8, the USIM knows that the resynchronization is
requested by the home network.
The solution impacts the SEAF/AMF.
### 6.2.5 Solution #2.5: Encryption of authentication failure message with
SUCI method
#### 6.2.5.1 Introduction
This solution addresses key issue #2.1: \"Mitigation against the linkability
attack\" and key issue #4.1: \"Protection of SQN during AKA re-
synchronizations\".
#### 6.2.5.2 Solution details
Figure 6.2.5-1: Signalling flow of mitigation against the linkability attack
1\. In the authentication procedure, the AMF sends the authentication request
message, which contains AUTN and RAND, to the UE.
2\. After receiving the authentication request message, the UE verifies the
MAC and the SQN in the AUTN. If the verification fails, the UE encrypts the
authentication failure cause value (MAC failure or Synch failure) by using the
method of calculating the SUCI,as specified in the following:
\- If the authentication failure cause is MAC failure, the UE constructs a
scheme-input including 5GMM Cause (MAC failure) AUTS consisting of a random
number.
\- If the authentication failure cause is Synch failure, the UE constructs a
scheme-input including 5GMM Cause (Synch failure) and AUTS.
> The UE executes the protection scheme (Profile A or Profile B) with the
> constructed scheme-input as input and take the output as the encrypted cause
> (indicated by \"Enc(Cause)\"). The encryption of the authentication failure
> cause value is calculated in either USIM or ME.
3\. The UE sets the 5GMM Cause in the message to the newly defined \"MAC
failure or synch failure\", to indicate that the authentication failure is
caused by MAC failure or Synch failure. The UE sends the newly defined 5GMM
Cause and the encrypted authentication failure cause to the AMF within the
authentication failure message.
4\. Upon receive of the authentication failure message, the AMF parses the
5GMM Cause IE in the message. If the 5GMM Cause IE is the newly defined \"MAC
failure or synch failure\", the AMF decides to send the encrypted
authentication failure cause to the UDM for decryption.
5\. The AMF sends the Enc(Cause) and RAND to the AUSF through
Nausf_UEAuthentication_Authenticate Request.
6\. The AUSF sends the Enc(Cause) and RAND to the UDM through
Nudm_UEAuthentication_Get Request.
7\. UDM decrypts the Enc(Cause). The UDM decrypts the Enc(Cause) by using the
method of decrypting the SUCI, and obtains the specific authentication failure
cause. The UDM determines the subsequent procedures (e.g. re-authentication or
notifying the AMF of the authentication failure cause) based on the decrypted
authentication failure cause.
8a. If the authentication failure cause is Synch failure, the UDM acts as
described in TS 33.501 [2], clause 6.1.3.3.2, where a new authentication
procedure with UE will be initiated. The Step 9 to Step 10 is omitted.
8b. If the authentication failure cause is MAC failure, the UDM sends the
decrypted authentication failure cause to the AUSF through
Nudm_UEAuthentication_Get Response.
9\. The AUSF sends the decrypted authentication failure cause to the AMF
through Nausf_UEAuthentication_Authenticate Response.
10\. The AMF may initiate new authentication towards the UE based on the
authentication failure cause.
#### 6.2.5.3 Evaluation
In this solution, the UE encrypts the authentication failure cause value (MAC
failure or Synch failure) by using the method of calculating the SUCI and
sends it to the core network. Only the NF in the core network can decrypt and
obtains the specific failure cause. Thus, the attacker cannot distinguish the
specific authentication failure cause, thereby preventing the breach of the
user\'s untraceability and mitigating the linkability attack.
The solution fulfils the potential security requirements from Key Issue #2.1:
\"The 5G system supports mechanisms to mitigate the Linkability attacks\". The
solution only addresses one kind of linkability attacks which are based on
recognising SYNC and MAC failures.
The visited network is impacted, and backward compatible.
The UE constructs a scheme-input including 5GMM Cause (MAC failure), the
length of which may exceed the current maximum length of MAC failure message.
Hence the size of the MAC failure message may be impacted.
This solution relies on the availability of SUCI mechanism. If the 5GS or the
UE does not support the SUCI mechanism, the solution cannot work.
If AUTS is encrypted, it is clear that the adversary cannot obtain any
information about SQN~MS~, so the solution can also address key issue #4.1.
### 6.2.6 Solution #2.6: Certificate based encryption of unicast NAS messages
#### 6.2.6.1 Introduction
This solution addresses the following key issues:
Key Issue #2.1: Mitigation against the linkability attack.
Key Issue #4.1: Protection of SQN during AKA re-synchronisations.
This solution provides certificate-based encryption to unicast NAS messages
during authentication.
The core network and UEs can encrypt unicast NAS signalling messages during
authentication. The core network and UEs accepts the messages after the
message is successfully decrypted.
#### 6.2.6.2 Solution details
##### 6.2.6.2.1 Provisioning and certificate distribution
This solution requires the network to support PKI (Public Key Infrastructure),
which needs the Mobile Network Operator (MNO) to have one or more Certificate
Authorities (CAs) as the root of the trust chain. UE has the capability to
support storing more than one CA Root certificate, which can be stored in USIM
or other implementation-dependent way that can provide secure storage.
NOTE 1: The vendor can provision a list of Root certificates into the UEs, the
length of the list depends on the capability of the UE. When the
certificate(s) needs to be changed or updated, then the update can be pushed
to UEs, like a software update.
Each UDM is provisioned to have stored certificates for all authorized UEs,
and each UE to have the UDM\'s certificate.
Note 2: It is not addressed here for the associated security requirement(s)
for UDMs on storage and processing the keys/certificates.
##### 6.2.6.2.2 Provisioning Process
The core network and UEs use PKI principles to perform mutual authentication.
The following method is used to provision the certificates into the UEs.
UEs are pre-loaded with X.509 certificates with signed public keys for the UDM
in which they are allowed to connect. The UDM would likewise be pre-loaded
with certificates of eligible UEs.
\- Each UDM has a public and private key pair (UDM_PUB_Key, UDM_PRI_Key).
\- UEs have a corresponding public and private key pair (UE_PUB_Key,
UE_PRI_Key).
\- Each core network shares its public key (UDM_PUB_Key) with all UEs with a
certificate. The certificate has a subject name that ties with the UDM ID.
\- UEs share their public keys (UE_PUB_Key) with a certificate with the core
network.
##### 6.2.6.2.3 Call Flows
##### 6.2.6.2.3.0 General {#general-4 .H6}
The call flow procedures are illustrated below.
##### 6.2.6.2.3.1 Scenario 1 for valid SUPI: {#scenario-1-for-valid-supi .H6}
1\. AMF sends the registration request message to the UDM. The UDM retrieves
the corresponding subscription information for the UE including the
UE_PUB_Key.
2\. For the UDM, if the SUPI is valid, the UDM encrypts the authentication
request message using UE_PUB_Key and sends it to the AMF. The AMF sends the
encrypted authentication request message to the UE.
3\. After receiving the encrypted authentication request message, the UE uses
the UE_PRI_Key to decrypt the message and then verifies the MAC and the SQN in
the AUTN.
4a. If the verification succeeds, the UE encrypts the authentication response
message by using UDM_PUB_Key, and then execute step 5a.
4b. If the verification fails, the UE encrypts the authentication failure
message regardless of the 5GMM cause (e.g. MAC failure or Synch failure) by
using UDM_PUB_Key, and then execute step 5b. (Note: The authentication failure
message has the same size regardless of the 5GMM cause. See Table 8.2.4.1.1:
AUTHENTICATION FAILURE message content in TS24.501.)
5a. The UE sends the encrypted authentication response message to the AMF.
5b. The UE sends the encrypted authentication failure message with 5GMM cause
to the AMF.
6\. Upon receiving of the encrypted authentication response message or
authentication failure message, the AMF sends the message to UDM for
decryption.
7\. The UDM uses the UDM_PRI_Key to decrypt the authentication response
message or the authentication failure message. The UDM determines the
subsequent procedures as described in TS 33.501 [2].
##### 6.2.6.2.3.2 Scenario 2 for invalid SUPI: {#scenario-2-for-invalid-supi
.H6}
1\. AMF sends the registration request message to the UDM. The UDM retrieves
the corresponding subscription information for the UE including the
UE_PUB_Key.
2\. For the UDM, if the SUPI is invalid, the UDM encrypts the registration
reject message using UE_PUB_Key and sends it to the AMF. The AMF sends the
encrypted registration reject message to the UE.
3\. After receiving the encrypted registration reject message, the UE uses the
UE_PRI_Key to decrypt the message. The UE determines the subsequent procedures
as described in TS 24.501 [6]
Note: The authentication procedure includes the AUSF. Sequence flows and
explanation showing the AUSF behaviour is needed.
#### 6.2.6.3 Evaluation
In this solution, the UE encrypts NAS messages during authentication by
leveraging PKI certificates and public / private key pair. Only the UDM in the
core network can decrypt and obtain the contents of these messages. The
decryption of the encrypted SUPI for every Registration request adds much load
to the UDM and will create more congestion at UDM.
For the linkability attack, the attacker cannot distinguish the specific
authentication failure cause in the authentication failure message, thereby
preventing the breach of the user\'s untraceability and mitigating the
linkability attack.
The solution fulfils the security requirements from Key Issue #2.1: \"The 5G
system supports mechanisms to mitigate the linkability attacks\".
For the attack of SQN during AKA re-synchronisations, the contents of the
authentication failure message (with an authentication failure message _with
synchronisation failure_ [AUTS]) is encrypted, where the AUTS is a function of
the protected SQN (using f5 and key stream [RAND]). As a result, the attacker
is not able to exploit the AUTS for breaking the protection of SQN inside.
The solution fulfils the security requirements from Key Issue #4.1: \"The 5G
system supports mechanisms to mitigate the attacks of SQN during AKA re-
synchronisations\".
It is not backward compatible.
There is minimal overhead for the messages due to the nature of public key
encryption; however, there is processing cost.
This solution relies on the availability of PKI architecture.
Note 1: It is not addressed how provisioning of certificates to all UE and UDM
works.
Note 2: It is not addressed for the impact to the visited network.
Note 3: It is not addressed to evaluate the complexity of PKI for Key
Issue#2.1 and Key Issue #4.1.
Note 4: It is not addressed how to securely update the root CA(s) in all the
UEs in case that the root CA is common to different operators.
Note 5: The impact on the solution of multiple UDM instances in the PLMN is
not addressed here
### 6.2.7 Solution #2.7: Mitigation against the SUCI replay attack
#### 6.2.7.1 Introduction
This solution addresses the key issue #2.2 SUCI replay.
#### 6.2.7.2 Solution details
_Current usage of ECIES for concealment of SUPI can be expanded to accommodate
MESSAGE_TIME and SUPI. The MESSAGE_TIME represents the UTC-based time when the
message is sent. Maximum allowed size of cipher text from concealment of
protection scheme output is 3000 digits. SUPI utilizes only few bytes of those
maximum allowed digits and still can adapt MESSAGE_TIME._
#### 6.2.7.3 Adaptation of proposal in TS 33.501
The following sequence chart illustrates the text already specified in TS
33.501 [2] clause 6.1.2 for the case of initiation of authentication and
selection of authentication method. Changes are marked in **bold**.
Figure 6.2.7.3-1: Illustration of UE and HE is sharing MESSAGE_TIME along with
SUCI
_1\. During the primary authentication procedure, USIM concatenates SUPI and
MESSAGE_TIME. The MESSAGE_TIME represents the_ current UTC-based time (number
of UTC seconds in 10 ms units since 00:00:00 on Gregorian calendar date 1
January, 1900 _)_ , similar to the mechanism used in _ProSe Discovery
protection_ TS 33.303  _[3]_. The UE may obtain UTC time from any sources
available, e.g. the RAN (via SIB, as in LTE via SIB16), NITZ, NTP, GPS
(depending on which is available). MESSAGE_TIME is provided by the ME to the
USIM. _The concatenated plain text block is encrypted using ECIES method. New
value is introduced for \"SUPI Type\", for e.g. Value 4 represents SUCI
encoded with SUPI plus MESSAGE_TIME._
NOTE 0: When the null scheme is used, the scheme input to the SUCI calculation
is only the SUPI and not the SUPI plus the MESSAGE_TIME.
Note a: The UTC time in UE and the UDM may be different because of different
source or other errors, and the synchronization mechanism is not addressed
here.
_2\. UE_ uses _SUCI containing MESSAGE_TIME in Registration request message,
which is sent to AMF/SEAF._
_3._ AMF/SEAF invokes the Nausf_UEAuthentication service by sending a
Nausf_UEAuthentication_Authenticate Request message to the AUSF whenever the
AMF/SEAF wishes to initiate an authentication.
The Nausf_UEAuthentication_Authenticate Request message contain seither:
\- SUCI containing _MESSAGE_TIME_ , as defined in the present document, or
\- SUPI, as defined in TS 33.501 [2].
The AMF/SEAF includes the SUPI in the Nausf_UEAuthentication_Authenticate
Request message in case the AMF/SEAF has a valid 5G-GUTI and re-authenticates
the UE. Otherwise the SUCI containing _MESSAGE_TIME_ is included in
Nausf_UEAuthentication_Authenticate Request. SUPI/SUCI structure is part of
stage 3 protocol design.
The Nausf_UEAuthentication_Authenticate Request furthermore contains:
\- the serving network name, as defined in clause 6.1.1.4 of the present
document.
4\. Upon receiving the Nausf_UEAuthentication_Authenticate Request message,
the AUSF checks that the requesting AMF/SEAF in the serving network is
entitled to use the serving network name in the
Nausf_UEAuthentication_Authenticate Request by comparing the serving network
name with the expected serving network name. The AUSF stores the received
serving network name temporarily. If the serving network is not authorized to
use the serving network name, the AUSF responds with \"serving network not
authorized\" in the Nausf_UEAuthentication_Authenticate Response.
The Nudm_UEAuthentication_Get Request sent from AUSF to UDM includes the
following information:
\- SUCI containing _MESSAGE_TIME_ or SUPI;
\- the serving network name;
5\. Upon reception of the Nudm_UEAuthentication_Get Request, the UDM invokes
SIDF if a SUPI type is SUPI plus _MESSAGE_TIME_ , then SIDF de-conceals SUCI
to gain SUPI and _MESSAGE_TIME_ before UDM can process the request.
a. If SUCI containing _MESSAGE_TIME_
The UDM compares the received MESSAGE_TIME and the current UTC-based time
which obtained from the same UTC source as UE.
If the received MESSAGE_TIME is less than the current UTC-based time minus
MAX_DELAY, UDM discard the message. MAX_DELAY represents the maximum
transmission time threshold.
If the received MESSAGE_TIME is greater than or equal to the current UTC-based
time minus MAX_DELAY, and less than the current UTC-based time, UDM selects
the authentication method based on SUPI and generates AV.
b. If SUPI,
UDM selects the authentication method based on SUPI and generates AV.
NOTE 1: The Nudm_UEAuthentication_Get Response in reply to the
Nudm_UEAuthentication_Get Request and the Nausf_UEAuthentication_Authenticate
Response message in reply to the Nausf_UEAuthentication_Authenticate Request
message are described as part of the authentication procedures in clause 6.1.3
in TS 33.501 [2].
NOTE 2: The solution is restricted to 5G.
The Authentication procedure (considering example of 5G AKA) is the same as TS
33.501 [2] clause 6.1.3.2.0. The solution does not impact the existing call
flow.
Note 2a: The value of MAX_DELAY is not addressed here to avoid replay attack
within the timer buffer.
NOTE 3: UE might re-send the same SUCI with earlier time stamp if T3519 timer
is running. To avoid discarding a lot of legitimate authentication requests,
the value of MAX_DELAY should be larger than T3519.
#### 6.2.7.4 Solution summary
The solution adds a new SUPI type in TS 23.003 [8] clause 2.2B.
Encryption and decryption on ECIES consider plain text block as \"SUPI and
MESSAGE_TIME\" at UE and UDM / ARPF in TS 33.501 [2].
Registration request is sent with SUPI **concatenate** MESSAGE_TIME.
UDM need to compare the received MESSAGE_TIME and the current time.
Note: Backward compatibility analysis is needed.
#### 6.2.7.5 Evaluation
The solution mitigates the SUCI replay attack.
The solution requires changes on the USIM and the UDM.
At USIM, during ECIES procedure of primary authentication, New SUPI type is
added, MESSAGE_TIME is concatenated with SUPI (plain text block).
At UDM, when the SUPI indicates \'SUPI plus MESSAGE_TIME\' the de-concealment
needs to disassociate SUPI and MESSAGE_TIME. UDM compares the current time and
the received MESSAGE_TIME to decide whether there is a SUCI replay attack.
MAX_DELAY is used to avoid discarding a large number of legitimate
authentication requests. It may be set based on local policy, network status,
MNO configuration.
Note: Further evaluation is needed.
### 6.2.8 Solution #2.8: Assuring SUCI generation by Legitimate SUPI owner
using K~SUCI~
#### 6.2.8.1 Introduction
This solution addresses Key Issue #2.2: SUCI based attacks (Linkability by
generation of different SUCIs).
This solution proposed to use a specific key, called K~SUCI~ when generating
the SUCI. By this it is assured that the generated SUCI can only be created by
the user to whom the long-term key K belongs to.
#### 6.2.8.2 Solution details
The solution follows the SUCI generation scheme, but the MAC tag is generated
out of a _new MAC key_ , which is the result of an additionally introduced
one-time function taking the Ephemeral MAC key and K~SUCI~ as input. The rest
of the known SUCI generation scheme is not touched.
KSUCI is generated by considering long term key K, FC and newly generated
RAND~SUCI~. UE can share the scheme output of SUCI to UDM as \"Final output =
Eph. public key \|\| **RAND~SUCI~** \|\| Ciphertext \|\| MAC tag [\|\| any
other parameter]\".
During SUCI generation, after the Ephemeral MAC key has been generated
(according to the scheme described in Annex A of TS 33.501), a new one-way
function f is applied. f is using the generated KSUCI as additional input to
the ephemeral MAC key. The result is used as the **_new MAC key_** : MAC key f
(K~SUCI~, Ephemeral MAC key). The USIM always performs the computation of the
key K~SUCI~, even in case of SUCI calculation in the ME.
With the _new MAC key_ , the computation of the SUCI is continued as specified
in TS 33.501 [2].
{width="6.696527777777778in" height="3.678472222222222in"}
Figure 6.2.8.2-1: SUCI derivation using K~SUCI~
#### 6.2.8.3 Evaluation
This solution works for calculation of SUCI at both USIM and ME.
This _new MAC key_ cannot be generated by an attacker, unless he would be in
possession of the individual long-term key K and its derivative K~SUCI~ of the
subscriber. The USIM always performs the computation of the key K~SUCI~, even
in case of SUCI calculation in the ME. Thus, it is assured that only the
UE/UICC where the long-term key K is stored can create SUCI, which renders the
attack of linkability creating different SUCIs out of a known SUPI.
### 6.2.9 Solution #2.9: MAC, SYNCH failure cause concealment
#### 6.2.9.1 Introduction
This solution addresses Key Issue #2.1: Mitigation against the linkability
attack.
In the present document, there are many solutions available like solution#4.3,
solution #4.5, solution #4.7, solution#3.1 for study to prevent SQN leakage
(Key Issue#4.1) by sharing the SQNMS value in various forms in Registration
request message to UDM. This removes the necessity of sending SQNMS value in
AUTS during synch failure or MAC failure cause in Authentication failure
message.
This solution proposes to conceal the failure cause to avoid the linkability
attack.
#### 6.2.9.2 Solution details
{width="6.696527777777778in" height="3.2916666666666665in"}
Figure 6.2.9.2-1: Cause concealment (5GS) in case of authentication failure
The initial Registration procedure is triggered from UE and the procedure is
the same as described in clause 6.1.2 of TS 33.501 [2]. Only step 7 varies by
creating a new 5GMM cause value.
Step 0: SQNms is shared from UE to UDM in registration request message.
Concealed format of SQNms (could be encrypted separately or sent as AUTN or
embedded in SUCI).
Step 1: UDM generates authentication vector, derives KAUSF and calculates
XRES*. UDM/ARPF will create 5G HE AV from RAND, AUTN, XRES* and KAUSF.
Step 2: UDM will return 5G HE authentication vector to AUSF to be used for 5G
AKA in Nudm_UEAuthentication_Get Response. UDM will include SUPI in the SUPI
in the Nudm_UEAuthentication_Get Response after deconcealment of SUCI by SIDF.
Step 3: AUSF will store the XRES* temporarily together with the received SUCI
or SUPI.
Step 4: AUSF will then generate 5G authentication vector from the 5G HE
authentication vector received from the UDM/ARPF by computing the HXRES* from
XRES* and KSEAF from KAUSF, and replacing the XRES* with the HXRES* and KAUSF
with KSEAF in the 5G.
Step 5: AUSF will remove the K~SEAF~ and return the 5G SE authentication
vector (RAND, AUTN, HXRES*) to the SEAF in a
Nausf_UEAuthentication_Authenticate Response.
Step 6: SEAF will send RAND, AUTN to the UE in a NAS message Authentication
Request. This message will also include ngKSI that will be used by UE and AMF
to identify the KAMF and the partial native security context that is created
if the authentication is successful. This message will also include the ABBA
parameter. ME will forward the RAND and AUTN received in NAS message
Authentication Request to the USIM.
Step 7: These three steps are followed at USIM after reception of RAND and
AUTN.
7.1. USIM computes XMAC and compares this with received MAC from AUTN. If they
are different, then it results in **MAC failure**. If it is same, then it
continues to step 7.2.
7.2. USIM verifies if the received sequence number SQN is in correct range or
not. If it is not in correct range, then it results in **Synchronisation
failure**. If it is in correct range, then it continues to step 7.3.
7.3. As MAC verification and sequence number range is verified, USIM computes
RES to be included in authentication response.
For MAC failure or Synchronisation failure, the cause value is taken as input
for concealment in AUTSCAUSE.
The generation of MAC-S, AK and Cause concealment is shown below.
MAC-S = f1*K(Cause value \|\| RAND \|\| AMF)
AK = f5*K(RAND)
Conc(Cause value) = Cause value âŠ• AK
AUTSCAUSE = Conc(Cause value) \|\| MACâ€‘S
NOTE 1: AUTSCAUSE containing cause value will be sent for both MAC and Synch
failure. USIM conceals the cause values in AUTSCAUSE and forwards it to ME.
Step 8: Authentication failure message is sent from UE to SEAF with new 5GMM
cause value as generic \"authentication failure cause\" along with AUTSCAUSE.
Step 9: Upon receiving an authentication failure message with AUTSCAUSE from
the UE, the SEAF sends a Nausf_UEAuthentication_Authenticate Request message
with a \"synchronisation failure indication\" to the AUSF.
Step 10: AUSF sends a Nudm_UEAuthentication_Get Request message to the
UDM/ARPF, together with the following parameters:
\- RAND sent to the UE in the preceding Authentication Request, and
\- AUTSCAUSE received by the SEAF in the response from the UE to that request.
Step 11: UDM retrieves cause value from AUTS~CAUSE~ using RAND value.
Step 12: In case of MAC failure cause value, UDM updates SEAF with MAC failure
for the Authentication procedure. Rest of the procedures of how MAC failure is
treated remains the same (as described in TS 33.501[V] & TS 24.501[W]
5.4.1.3.6 & 5.4.1.3.7 item c.).
In case of Synch failure, a new Authentication vector is generated in UDM and
the AKA challenge is sent to UE. Below figure 6.2 shows the concealed cause
value in AUTS~CAUSE~ generation at step 7 in USIM and related 5GS procedures.
NOTE 2: In order to handle the attack scenario, where the attacker repeats the
same RAND and AUTN in 5G AKA challenge and retrieves the \"cause value\",
which is concealed (similar to SQN leakage key issue), USIM generated 128 bits
of RAND (RAND~MS~ / RAND~SQN~ as described in solution #4.5 or #4.7) is used
in initial registration request message to conceal the SQNMS at UE / UDM.
When registration request is sent with RAND~MS~ / RAND~SQN~, USIM stores only
LSB of 128 bits for future verification purposes and UDM uses received RAND
(RAND~MS~ / RAND~SQN~) to concatenate with newly generated random value at UDM
(Note, only LSB of 128 bits RAND~MS~ / RAND~SQN~ is concatenated). AKA
challenge is sent with concatenated RAND, so USIM can verify the received RAND
by checking the LSB from stored RAND~MS~/RAND~SQN~. After verification, USIM
deletes previously stored RAND~MS~ / RANDSQN. An attacker cannot repeat the
same RAND and AUTN, as LSB of random number does not exist in USIM and
verification of RAND fails.
#### 6.2.9.3 Evaluation
The USIM needs to conceal a MAC or Sync cause value.
Solution works only when SQNms is already shared in Registration request
message.
Solution has an impact of serving network (AMF) as home network decrypts cause
value and updates serving network, in case of MAC failure. The solution also
has an impact on USIM and UDM.
### 6.2.10 Solution to Key Issue #2.2: SUCI replay.
#### 6.2.10.1 Introduction
The solution is proposed to solve Key Issue #2.2: SUCI replay.
#### 6.2.10.2 Solution details
When a UDM receives a SUCI from the AUSF, the UDM de-conceals the SUCI to
SUPI. **The UDM stores the SUCI and** the timestamp when the SUCI was received
for the SUPI. The UDM initiates the authentication procedure.
When the UDM receives the SUCI again, then it calculates the time period T
between the first time the SUCI was received and the latest time the SUCI was
received, if the T is less than or equal to T3519 then the UDM initiates
authentication procedure otherwise the UDM determines either the UE is fake or
there is man in the middle on receiving SUCI 1 and the UDM rejects the
authentication procedure as SUCI retransmission is not expected after T3519.
The UDM stores the time stamp of first time the SUCI was received for a SUPI
for period of time (e.g. 24 hours or 48 hours or longer).
{width="6.815277777777778in" height="3.9347222222222222in"}
{width="7.065277777777778in" height="3.7381944444444444in"}
Figure 6.2.10.2-1: Procedure to handle SUCI parameter in the UDM
The detailed steps of the solution is as described below.
1\. The UE is registered to the network for the first time by sending SUCI-1
in the registration procedure. The UE has been assigned 5G-GUTI 1\. The UDM
stores the SUCI 1 and the time stamp when the SUCI 1 was received. The UDM
stores the time stamp when the SUCI was received for the very first time per
SUPI for period of time (e.g. 24 hours or 48hours or longer).
2-3. The UE initiates an initial NAS procedure including the 5G-GUTI 1 in an
initial NAS message. The MITM corrupts the 5G-GUTI 1. The context is not found
in the AMF and the AMF initiates the identification procedure requesting SUCI.
4\. Upon receiving the identity request message with identity type = SUCI, the
UE calculates a new SUCI, SUCI 2, as the timer T3519 expires in the UE and
sends SUCI 2 in the identity response message. The MITM replaces SUCI 2 with
SUCI 1. The AMF on receiving the identity response message initiate
authentication procedure towards the UDM for SUCI 1.
5\. The UDM deconceals the SUCI 1 to SUPI. The UDM calculates the time period
T from the time when the SUCI 1 was received first time using the time stamp
stored for the SUCI 1 in step 0-d. If T is less than or equal to T3519 then
the step 6a takes place otherwise step 6b takes place.
6a. If the timer T is running for the SUCI 1 then the UDM initiates
authentication procedure as described in sub clause 6.1.3 of TS 33.501. After
successful registration procedure, the UDM stops the timer T.
6b If the timer T has expired then the UDM rejects the authentication
procedure as SUCI retransmission is not expected after T3519.
#### 6.2.10.3 Evaluation
The solution is very simple which has no UE, AMF, SEAF, AUSF impact. A minor
change in the UDM as proposed in the UDM can easily and effectively solves
this issue.
The UDM needs to run a timer T and to store the SUCI for a certain period.
These will consume network resources.
There is a chance, if a legitimate UE sends a SUCI in Registration Request
message to the network within 60 seconds of initiation of MiTM attack, the
legitimate UE can be detected at cell level but the chances of sending SUCI in
Registration Request message by the legitimate UE is very low within 60
seconds.
### 6.2.11 Solution #2.11: Mitigate the SUCI replay based on UE\'s public key
#### 6.2.11.1 Introduction
This solution addresses key issue #2.2: SUCI replay attack.
#### 6.2.11.2 Solution details
In order to identify a real SUCI replay attack and not break the SUCI
retransmission mechanism, UDM applies the message queue of the storage data
unit (DU), together with the database storing public key, to determine whether
the received SUCI is a replay attack. The structure of Data Unit (DU: Data
Unit) is DU={SUCI, SUPI, Timestamp}. During the timer T~UDM~ whose value is
set to T3519, the DU will be used as a comparison tag to identify whether the
received SUCI is a SUCI retransmitted by a legitimate user. That is, the SUCI
received subsequently will be compared with the SUCI in the DU. If the same,
the received SUCI will not be discarded and will be processed further. If they
are different, the public key in the SUCI is applied to judge whether the SUCI
is a replay attack. The concrete steps are as follows.
1\. After receiving SUCI, UDM sets timestamp to the time when SUCI is
received, and searches for SUCI in the message queue of the stored DUs. If
SUCI is found and the timestamp in the corresponding DU is within TUDM time,
UDM gets SUPI in the corresponding DU. UDM obtains the long-term key of the UE
according to SUPI, generates an authentication vector and returns it to the
UE.
2\. UDM removes the DUs whose time is before 60s in the message queue
according to the timestamp.
3\. If UDM does not find SUCI in the message queue, it extracts the UE\'
public key from the received SUCI.
UDM searches for the public key corresponding to the SUCI in the database. If
found, it confirms that the SUCI is a replay attack, and the connection is
interrupted; if it is not found, it confirms that the SUCI is not a replay
attack. Then UDM deconceals SUCI to obtain SUPI. Based on the long-term key of
the UE corresponding to the SUPI, an authentication vector is generated and
returned to the UE. UDM constructs the data unit DU={SUCI, SUPI, Timestamp}
and moves it into the message queue.
Note 1: It is not addressed whether the proposed scheme is subject to the
poisoning attack.
NOTE 2: How many public keys are stored in UDM is up to the operator\'s
policy.
The components in the UDM used for anti-replay attack are shown in the
following figure.
Figure 6.2.11.2-1 Components in the UDM
#### 6.2.11.3 Evaluation
The proposed method does not have an impact on current standardized SUPI
protection scheme. It also does not need any change on the UE and the serving
network. The only change required is that the UDM has to store the received
UE\'s public key after determining that the SUCI is not a replay message.
The proposed method prevents the linkablity attack as it can identify the
replay attack without returning the RAND and AUTN to the attacker. The
possible DoS attack is also mitigated as it does not invoke the computation
heavy ECIES algorithm before determining whether the SUCI is a replay message
or not.
The proposed method does not have an impact on the SUCI retransmission
mechanism in the UE.
### 6.2.12 Solution #2.12: A**dding randomness on both sides to mitigate all
replay-attacks and assuring SUCI generation by legitimate entity using MAC
calculation on secret key**
#### 6.2.12.1 Introduction
The solution is declared to address key issue #2.1 (LFM attack), key issue
#2.2 (SUCI based attacks), key issue #3.2 (SUPI guessing attacks) and key
issue #4.1 (AMA attack).
#### 6.2.12.2 Solution details
The steps of the proposal are as follows (see Figure 6.2.12.2-1):
.1 During the primary authentication procedure, the UE sends the Registration
Request message with a REQUEST value which is generated as follows (the
REQUEST value is sent instead of SUCI):
REQUEST = SUCI, RAND~MS~,MAC~0~,
where RAND~MS~ is a 128-bit random number, MAC~0~ = f~0~ (K, SUCI, RAND~MS~)
is a key-based MAC function.
2\. After receiving the Registration Request message, the HN de-conceals SUCI
to obtain SUPI and checks the MAC~0~ value using the secret key K and
RAND~MS~.
3\. If MAC is incorrect, the HN sends the _Registration Reject_ message and
terminates the authentication procedure.
If MAC is correct, the HN sends the Authentication Request message with an
authentication vector AV = (RAND~HE~, AUTN) calculated as follows:
\- Generate RAND~HE~;
\- MAC = f1(K, SQN~HE~, RAND~HE~, RAND~MS~);
\- AK = f5(K, RAND~HE~, RAND~MS~);
\- AUTN $=$ SQN~HE~ âŠ• AK, MAC.
4\. After receiving the Authentication Request message, the UE de-conceals
SQN~HE~ and checks the MAC value:
If MAC is correct and SQN~HE~ is in correct range, authentication protocol
continues in the standard mode.
If MAC is incorrect, UE sends the Authentication Response message with
MAC_failure to HN.
If MAC is correct and SQN~HE~ is not in a correct range, the UE sends the
Authentication Response message with SYNC_failure and AUTS value calculated as
follows:
\- MAC* = f1*(K, SQN~MS~, RAND~HE~, RAND~MS~);
\- AK* = f5*(K, RAND~HE~, RAND~MS~);
\- AUTS $=$ SQN~MS~ âŠ• AK*, MAC*.
{width="6.731944444444444in" height="6.208333333333333in"}
Figure 6.2.12.2-1
#### 6.2.12.3 Evaluation
The solution suggests changes to the calculation of functions: f1, f1*, f5,
f5*. Also, the ECIES scheme should be slightly updated. This variant of the
protocol follows the accepted paradigm of constructing SigMa-like protocols
[9], on which many modern protocols (e.g., TLS and IPSec) are based.
Binding to the random numbers of **both** parties is needed, as this is
required for the authentication property.
If no binding is done, it is not guaranteed the freshness of the answer, and
this can potentially lead to the various sophisticated (but practical!) replay
attacks.
NOTE 1: To optimize calculations the MAC calculation step can be excluded from
the ECIES scheme, as the integrity of the SUCI value is already guaranteed by
MAC~0~ calculation (MAC~0~ = f~0~ (K, SUCI, RAND~MS~)).
NOTE 2: To optimize calculations the UE public ephemeral key from the ECIES
scheme can be used to generate RAND~MS~ value.
The proposed scheme has impact on the USIM and UDM.
## 6.3 Solutions for availability aspects of SUCI usage
### 6.3.1 Solution #3.1: Mitigation of SUPI guessing and SUCI replay attack
using long term key
#### 6.3.1.1 Introduction
This solution addresses key issue #4.1 Protection of SQN during AKA re-
synchronisations, key issue #2.2 on SUCI replay and Key issue #3.2 to mitigate
the SUPI guessing attacks. For this key issues, one same cause for the attacks
is to forge or replay the registration request message. To mitigate the
attacks, the basic idea is to use long term key to protect the registration
request message to avoid unnecessary response messages.
#### 6.3.1.2 Solution details
Figure 6.3.1.2-1: Procedure for mitigating SUPI guessing and SUCI replay
attack
Step 1: The SEAF may initiate an authentication with the UE during any
procedure establishing a signalling connection with the UE, according to the
SEAF\'s policy. If the authentication is initiated, UE generates a _Random_
and encrypts the _SQN_ using long term key _K_ of UE to produce the output
ciphertext _enc_SQN._ In addition, the SUCI, _SQN and Random_ is also
integrity protected using _K_ and the output is represented as _MAC_.
Step 2: UE sends SUCI, _Random, enc_SQN_ and _MAC_ in the registration request
message. _Random, enc_SQN_ and _MAC_ are included in SUCI in the _any other
parameter_ part _._ The capability indicator is also included in SUCI and
integrity-protected with SUCI scheme _._ The capability indicator represents
the UE is upgraded.
Step 3: The SEAF invokes the Nausf_UEAuthentication service by sending a
Nausf_UEAuthentication_Authenticate Request message to the AUSF containing
SUCI, _Random,_ _enc_SQN_ and _MAC_.
Step 4: AUSF sends the Nudm_UEAuthentication_Get Request to UDM including
SUCI, _Random,_ _enc_SQN_ and _MAC_.
Step 5: Upon reception of the Nudm_UEAuthentication_Get Request, the UDM de-
conceals SUCI to gain SUPI before UDM can process the request. _Random,_
_enc_SQN_ and _MAC_ are required if capability indicator is received. If
_Random, enc_SQN_ and _MAC_ are deleted by attackers, the attack will be
detected. Based on SUPI, UDM decrypts _enc_SQN_ to acquire _SQN_ using the
corresponding long-term key. The integrity protection is also verified through
comparing _MAC_ and _MAC\'. MAC\'_ is calculated in the same way as UE side.
If verification is successful, UDM stores the _Random_ related to the _SQN_.
UDM deletes the _Random_ related to the obsolete _SQN_. If verification fails,
the message is discarded.
_SQN_ and _Random_ are two fresh parameters, which are sent from UE to UDM. In
UDM side, the _SQN_ will be used for AUTN calculation. After that, if the same
_SQN_ is received, UDM checks the freshness of _Random_. UDM only responses to
UE if _Random_ is fresh. Otherwise, UDM will discard the message and regard it
as replayed message.
Step 6: Continue with the authentication procedure.
: Whether the solution works for the Registration Request with a 5G-GUTI is
not addressed.
#### 6.3.1.3 Evaluation
Note a: The usage of the long-term key for other uses is not addressed here.
The selected symmetric algorithm used in this contribution needs more
evaluation to avoid security issue.
The usage of the long term key K is dedicated to authentication and key
agreement (AKA) procedure for which the long term key K has been introduced in
the 3GPP security architecture. Security risk due to the usage of the long
term key to encrypt the SQN needs to be evaluated by ETSI SAGE.
The solution depends on the availability of the SUCI mechanism and is only
applicable to 5G.
NOTE 1: To optimize calculations the MAC calculation step can be excluded from
the ECIES scheme, as the integrity of the SUCI value is already guaranteed by
MAC calculation (MAC (SUCI, _Random, enc_SQN_)).
NOTE 2: To optimize calculations the UE public ephemeral key from the ECIES
scheme can be used to generate RAND~MS~ value.
### 6.3.2 Solution #3.2: Adding Check Value behind SUPI to mitigate the SUPI
guessing attacks
#### 6.3.2.1 Introduction
This solution addresses the key issue #3.2 Key issue to mitigate the SUPI
guessing attacks.
#### 6.3.2.2 Solution details
This solution proposes to introduce a new parameter Check Value behind SUPI to
mitigate the SUPI guessing attacks.
Figure. 6.3.2.2-1 shows a structure of the IMSI and Check Value (IMSICV). the
IMSICV comprises the respective features of the IMSI, namely a Mobile Country
Code (MCC), a Mobile Network Code (MNC) and a Mobile Subscriber Identification
Number (MSIN). In addition, as shown in Figure. 6.3.2.2-1, the Check Value is
used to verify the validity of the IMSI (SUPI) or MSIN. The length of the
Check Value depends on the network operator. The Check Value may be updated by
the home network through the way update routing indicator in SUCI.
Figure 6.3.2.2-1: Structure of IMSI and Check Value
Figure 6.3.2.2-2 shows the procedure of mitigating the SUPI guessing attacks,
the IMSICV are stored at the UE and the UDM/ARPF.
Figure 6.3.2.2-2: The procedure of mitigating the SUPI guessing attacks
1\. The UE sends the Registration Request message to the AMF/SEAF containing
SUCI, and the SUCI includes SUPI Type, Home Network Identifier, Routing
Indicator, Protection Scheme Identifier, Home Network Public Key Identifier
and Scheme Output. The Cipher value text in Scheme Output is the encryption of
MSIN and Check value.
2\. The SEAF invokes the Nausf_UEAuthentication service by sending a
Nausf_UEAuthentication_Authenticate Request message containing the SUCI to the
AUSF.
3\. The Nudm_UEAuthentication_Get Request containing SUCI is sent from AUSF to
UDM.
4\. Upon reception of the Nudm_UEAuthentication_Get Request, the UDM invokes
SIDF (Subscriber Identity De-concealing Function) to de-conceal the SUCI to
obtain (e.g. determine) the SUPI and the Check Value. The UDM determines
whether the SUPI is stored in the database. If the SUPI is found in the
database of the UDM, the UDM determines whether the Check Value is stored in
the database as well.
5\. If SUPI and Check Value are both found in the database of the UDM, the UDM
selects the authentication method according to the SUPI. Then, the UDM
generates the authentication data including authentication vector and sends it
to AUSF in the Nudm_UEAuthentication_Get Response message with \"200 OK\". If
SUPI or Check Value are not found in the database, the UDM returns \"404 Not
Found\" with \"USER_NOT_FOUND\" in the Nudm_UEAuthentication_Get Response
message.
6\. Upon reception of \"200 OK\", the AUSF sends \"201 Created\" to AMF/SEAF
with UEAuthentictionCtx containing authentication vector in the
Nausf_UEAuthentication_Authenticate Response message. Upon reception of \"404
Not Found\", the AUSF sends \"404 Not Found\" to AMF/SEAF with
\"USER_NOT_FOUND\".
7\. The AMF/SEAF sends RAND and AUTN to the UE in the Authentication Request
message in the case of \"201 Created\". Otherwise, the AMF/SEAF sends the
Registration Reject message with Cause#3 to the UE in the case of \"404 Not
Found\".
#### 6.3.2.3 Evaluation
The solution mitigates the SUCI guessing attack by introducing a new parameter
Check Value behind SUPI.
The solution requires changes on the USIM and the UDM.
The length of the Check Value depends on the network operator. The Check Value
may be updated by the home network through the way update routing indicator in
SUCI. There is an impact on the UICC and the UE Parameter Update (UPU)
procedure if the network needs to support the update of the Check Value via
UPU.
### 6.3.3 Solution #3.3: Mitigation of SUPI guessing attack
#### 6.3.3.1 Introduction
This solution addresses Key issue #3.2 to mitigate the SUPI guessing attack.
The basic idea is to use the same response message for valid and invalid
subscriber.
#### 6.3.3.2 Solution details
{width="6.511805555555555in" height="4.49375in"}
Figure 6.3.3.2-1: Procedure for mitigating SUPI guessing attack
Step 1-4: The initiation of the primary authentication is defined in TS 33.501
[2] clause 6.1.2.
Step 5a-7a: If the SUPI is valid, the authentication procedure is performed as
defined in TS 33.501 [2] clause 6.1.3.
Step 5b: If the SUPI is invalid, UDM sends error response to AUSF with failure
cause.
Step 6b: AUSF send error response to SEAF with failure cause. Step 7b: When
the error response indicating invalid SUPI is received, SEAF generates Auth
request message including the RAND and AUTN. RAND and AUTN are randomly
generated.
Step 8: SEAF sends the generated Auth request message to UE. Afterwards, if UE
with an invalid SUPI returns an auth response with RES* or synch failure, SEAF
responses with authentication failure. If the attacker returns a MAC failure,
SEAF may initiate the identification procedure as define in TS 24.501 [6].
With the proposed method, the attacker cannot ascertain that the guessed SUPI
is valid or not with the Authentication Request message sent by the network.
#### 6.3.3.3 Evaluation
This solution addresses Key issue #3.2 to mitigate the SUPI guessing attack.
The solution only requires changes on the SEAF. There is no change to any
entities if the SUPI is valid. For illegitimate UEs with invalid SUPI, SEAF
sends authentication response instead of registration reject. SEAF could mark
the UE as illegal and respond to the UE with the appropriate message as
described in the solution.
## 6.4 Solutions on re-synchronisation in AKA
### 6.4.1 Solution #4.1: Using MACS as freshness in the calculation of AK
#### 6.4.1.1 Introduction
This solution addresses the key issue #4.1.
#### 6.4.1.2 Solution details
This solution adds MACS as an input parameter to the calculation of AK in the
case of synchronisation failure for AKA.
NOTE 1: As MACS is calculated using SQN~MS~, this ensures that a fresh input
is used for the calculation of AK in a re-synchronisation.
NOTE 2: The use of MACS would be up to the operator as it is used in their
HLR/HSS/ARPF and UISM.
The calculation of the AUTS parameter for re-synchronisation is described in
clauses 6.3.3 and 6.3.5 of TS 33.102 [3]. In terms of the modifying that
clause, this solution would require replacing the concealed value of the
counter SQN~MS~, i.e. Conc(SQN~MS~), as follows;
Conc(SQN~MS~) = SQN~MS~ âŠ• f5*~K~(RAND, [MAC-S])
and also modify the figure in clause 6.3.3 to the figure below.
Figure 6.4.1.2-1: Modified construction of the parameter AUTS
For re-synchronisation procedure, when the HE/AuC receives an authentication
data request with a \"synchronisation failure indication\" and AUTS, the
detailed procedure is defined as follows:
\- MAC-S and SQN~MS~âŠ• AK are retrieved from AUTS.
\- AK is calculated using f5 function with MAC-S as one input.
\- SQN~MS~ is retrieved by computing SQN~MS~âŠ• AKâŠ• AK.
\- MAC-S is verified with MAC-S\', where MACâ€‘S\' = f1*K(SQN~MS~ \|\| RAND \|\|
AMF).
It means MAC-S is one of the inputs to retrieve SQN~MS~. SQN~MS~ is one of the
inputs to verify MAC-S.
The home network knows whether to use MAC-S to calculate AK based on the
subscription identifier, e.g. IMSI or SUPI.
#### 6.4.1.3 Evaluation
The solution addresses the key issue by providing a fresh input to the
calculation of AK to ensure that the same AK is not used to protected two
different SQNs.
This solution requires changing the USIM and the HSS/HLR/UDM. The change is
essentially updating these to support a new authentication and key agreement
algorithm, although in this case the change could be a small change to an
existing algorithm.
The solution does not affect any entity between the USIM and home network.
The solution is a deployment option for the home operator. The solution is not
needed if time-based SQN generation is used.
Deploying this protects the use of AKA for all usage scenarios, e.g. it is not
specific to 5G.
### 6.4.2 Solution #4.2: Using symmetric encryption function to protect SQN
during a re-synchronisation procedure in AKA
#### 6.4.2.1 Introduction
This solution addresses the key issue #4.1.
#### 6.4.2.2 Solution details
This solution proposes to use symmetric encryption function to protect SQN
with input key of AK in the case of synchronisation failure for AKA.
The calculation of the AUTS parameter for re-synchronisation is described in
clauses 6.3.3 and 6.3.5 of TS 33.102 [3]. In terms of the modifying that
clause, this solution would require adding a new function f*6 and replacing
the concealed value of the counter SQN~MS~, i.e. Conc(SQN~MS~), as follows;
Conc(SQN~MS~) = f6*~AK~(SQN~MS~)
f6* is the symmetric encryption function used to encrypt SQN~MS~ using AK as
input key. f6*~AK~(SQN~MS~) is the encrypted value of the counter SQN~MS~ in
the MS. The figure in clause 6.3.3 of [3] is modified to the figure below.
Figure 6.4.2.2-1: Modified construction of the parameter AUTS
To decrease the complexity, the f5* function can be replaced by XOR.
#### 6.4.2.3 Evaluation
Solution requires a major change of authentication algorithms, and the
examples defined in 3GPP (Milenage and TUAK).
Solution requires change of USIM
The solution is not needed if time-based SQN generation is used.
### 6.4.3 Solution #4.3: SQN protection by concealment with SUPI in USIM
#### 6.4.3.1 Introduction
This solution addresses the key issue #4.1 Protection of SQN during AKA re-
synchronisations.
#### 6.4.3.2 Solution details
_Current usage of ECIES for concealment of SUPI can be expanded to accommodate
SQNMS and SUPI. Maximum allowed size of cipher text from concealment of
protection scheme output is 3000 digits. SUPI utilizes only few bytes of those
maximum allowed digits and still can adapt SQNMS._
{width="6.696527777777778in" height="3.410416666666667in"}
**Figure** 6.4.3.2-**1** Encryption based on ECIES at UE
_Figure_ **6.4.3.2-**_1 shows the encryption based on ECIES at UE side, where
SUPI is concatenated with SQNMS and taken as one plain text block for
symmetric encryption. In case of SUPI type as IMSI, then MSIN (9 to 10 digits)
and_ SQN~MS~ _(48 bits: 6 bytes) is concatenated in UE._
{width="6.690277777777778in" height="3.38125in"}
**Figure** 6.4.3.2-**2:** Decryption based on ECIES at home network
_Figure_ **6.4.3.2-**_2 shows the decryption based on ECIES at home network,
where SUPI and SQNMS is dissociated after the symmetric decryption._
Figure 6.4.3.2-3: Structure of SUCI
Figure 6.4.3.2-3 shows the structure of SUCI with SUPI Type, which consists
values in the range 0 to 7 as specified in clause 2.2B of TS 23.003 [8]. SUPI
Type identifies the type of the SUPI concealed in the SUCI.
For this solution, the encoding of SUCI for \'SUPI plus SQN~MS~\' will be
represented by a new SUPI Type value, e.g. value 4.
\- 0: IMSI
\- 1: Network Specific Identifier
\- 2: Global Line Identifier (GLI)
\- 3: Global Cable Identifier (GCI)
**\- 4: SUPI plus SQNMS**
\- 5 to 7: spare values for future use.
#### 6.4.3.3 Adaptation of authentication procedures
##### 6.4.3.3.0 General
The following sequence charts illustrate the text already specified in TS
33.501 [2], clause 6.1.2 for the case of initiation of authentication and
selection of authentication method including the additional changes needed for
this solution. Changes are marked in **bold**.
##### 6.4.3.3.1 Initiation of authentication and selection of authentication
method
Figure 6.4.3.3.1-1: Illustration of UE and HE is sharing SQN~MS~ along with
SUCI
1) During the primary authentication procedure, USIM concatenates SUPI and
SQNMS. The concatenated plain text block is encrypted using ECIES method. New
value is introduced for \"SUPI Type\", for e.g. Value 4 represents SUCI
encoded with SUPI plus SQNMS.
2) UE uses SUCI containing SQNMS in Registration request message, which is
sent to AMF/SEAF.
3) AMF/SEAF invokes the Nausf_UEAuthentication service by sending a
Nausf_UEAuthentication_Authenticate Request message to the AUSF whenever the
AMF/SEAF wishes to initiate an authentication.
The Nausf_UEAuthentication_Authenticate Request message contains either:
\- SUCI containing SQN~MS~, as defined in the present document, or
\- SUPI, as defined in TS 23.501 [6].
The AMF/SEAF includes the SUPI in the Nausf_UEAuthentication_Authenticate
Request message in case the AMF/SEAF has a valid 5G-GUTI and re-authenticates
the UE. Otherwise the SUCI containing _SQNMS_ is included in
Nausf_UEAuthentication_Authenticate Request. SUPI/SUCI structure is part of
stage 3 protocol design.
The Nausf_UEAuthentication_Authenticate Request furthermore contains:
\- the serving network name, as defined in clause 6.1.1.4 of TS 33.501 [2].
4) Upon receiving the Nausf_UEAuthentication_Authenticate Request message, the
AUSF checks that the requesting AMF/SEAF in the serving network is entitled to
use the serving network name in the Nausf_UEAuthentication_Authenticate
Request by comparing the serving network name with the expected serving
network name. The AUSF stores the received serving network name temporarily.
If the serving network is not authorized to use the serving network name, the
AUSF responds with \"serving network not authorized\" in the
Nausf_UEAuthentication_Authenticate Response.
The Nudm_UEAuthentication_Get Request sent from AUSF to UDM includes the
following information:
\- SUCI containing SQN~MS~ or SUPI;
\- the serving network name.
5) Upon reception of the Nudm_UEAuthentication_Get Request, the UDM invokes
SIDF if a SUPI type is SUPI plus _SQN~MS~_ , then SIDF de-conceals SUCI to
gain SUPI and _SQN~MS~_ before UDM can process the request. Based on SUPI, the
UDM/ARPF chooses the authentication method. SQN~MS~ _is temporarily stored in
UDM for future use. At UDM, Authentication vector is generated with existing_
SQN~HE~.
The solution is restricted to 5G.
NOTE 1: The Nudm_UEAuthentication_Get Response in reply to the
Nudm_UEAuthentication_Get Request and the Nausf_UEAuthentication_Authenticate
Response message in reply to the Nausf_UEAuthentication_Authenticate Request
message are described as part of the authentication procedures in TS 33.501
[2], clause 6.1.3.
NOTE 2: SQNMS is not considered for Authentication vector generation on
purpose.
##### 6.4.3.3.2 Successful Authentication case
In success case the Authentication procedure (considering example of 5G AKA)
is the same as TS.33.501 [2], clause 6.1.3.2.0. The solution does not impact
the existing call flow. In case of successful AKA, success means SQN~MS~ and
SQNHE are already aligned hence temporarily stored SQN~MS~ is deleted.
Figure 6.4.3.3.2-1: Authentication procedure for 5G AKA (success case)
##### 6.4.3.3.3 Authentication failure case
Figure 6.4.3.3.3-1: Authentication procedure for 5G AKA (Failure case)
Figure **6.4.3.3.3-1** shows the failure case of Authentication procedure
(considering example of 5G AKA). Changes are shown in **bold**.
1\. For each Nudm_Authenticate_Get Request, the UDM/ARPF creates a 5G HE AV.
The UDM/ARPF does this by generating an AV with the Authentication Management
Field (AMF) separation bit set to \"1\" as defined in TS 33.102 [3]. The
UDM/ARPF then derives K~AUSF~ (as per Annex A.2 of TS 33.102 [3]) and
calculate XRES* (as per Annex A.4 of TS 33.102 [3]). Finally, the UDM/ARPF
creates a 5G HE AV from RAND, AUTN, XRES*, and K~AUSF~.
2\. The UDM then returns the 5G HE AV to the AUSF together with an indication
that the 5G HE AV is to be used for 5G-AKA in a Nudm_UEAuthentication_Get
Response. In case SUCI was included in the Nudm_UEAuthentication_Get Request,
UDM will include the SUPI in the Nudm_UEAuthentication_Get Response.
3\. The AUSF stores the XRES* temporarily together with the received SUCI or
SUPI.
4\. The AUSF then generates the 5G AV from the 5G HE AV received from the
UDM/ARPF by computing the HXRES* from XRES* (according to TS 33.501 [2] Annex
A.5) and K~SEAF~ from K~AUSF~(according to TS 33.501 [2]Annex A.6), and
replacing the XRES* with the HXRES* and K~AUSF~ with K~SEAF~ in the 5G HE AV.
5\. The AUSF then removes the K~SEAF~ return the 5G SE AV (RAND, AUTN, HXRES*)
to the SEAF in a Nausf_UEAuthentication_Authenticate Response.
6\. The SEAF sends RAND, AUTN to the UE in a NAS message Authentication
-Request. This message also includes the ngKSI that will be used by the UE and
AMF to identify the K~AMF~ and the partial native security context that is
created if the authentication is successful. This message also includes the
ABBA parameter. The SEAF sets the ABBA parameter as defined in Annex A.7.1 of
TS 33.102 [3]. The ME forwards the RAND and AUTN received in NAS message
Authentication Request to the USIM.
7\. At receipt of the RAND and AUTN, the USIM verifies the freshness of the 5G
AV by checking whether AUTN can be accepted as described in TS 33.102 [3]. If
the verification of the AUTN fails, then the USIM indicates to the ME the
reason for failure.
8\. The ME responds with NAS message Authentication Failure **only with a
CAUSE value indicating the reason for failure (as SQN failure/mismatch). AUTS
is not calculated by the UE and not shared to network.**
9\. Upon receiving an authentication failure message from the UE, the SEAF
sends an Nausf_UEAuthentication_Authenticate Request message to the AUSF.
10\. AUSF sends an Nudm_UEAuthentication_Get Request message to the UDM/ARPF.
11\. When the UDM/ARPF receives an Nudm_UEAuthentication_Get Request message
it acts as described in TS 33.102 [3], clause 6.3.5 where ARPF is mapped to
HE/AuC. The UDM/ARPF sends an Nudm_UEAuthentication_Get Response message with
a new authentication vector **by considering the _SQNMS_ from database (i.e.
_SQNMS_ received in Nudm_UEAuthentication_ Get Request)**. UDM synchronizes
its SQN~HE~ value, i.e. SQN~HE~ = SNQ~MS~. The AUSF runs a new authentication
procedure with the UE according to clauses 6.1.3.1 or 6.1.3.2 of TS 33.501 [2]
depending on the authentication method applicable for the user.
#### 6.4.3.4 Solution summary
The solution adds a new SUPI type in TS 23.003 [8], clause 2.2B.
Encryption and decryption on ECIES consider plain text block as \"SUPI and
SQN~MS~\" at USIM and UDM / ARPF in 3GP TS 33.501 [2].
Registration request is sent with SUPI plus SQN~MS~.
Sync failure during AKA challenge sends only failure cause and no AUTS is sent
to the network.
Note: It is not addressed if this solution works for synchronization failure
when AMF receives 5G-GUTI and decides to initiate authentication.
#### 6.4.3.5 Evaluation
The solution protects the sequence number in 5GS and ensures the freshness of
the SUCI generated as current as the last successful primary authentication.
The solution requires changes on the USIM and the UDM. Since HPLMN owns the
subscription, both USIM changes and UDM changes can be synchronised by the
HPLMN operator at the same time.
The solution does not work if the SUCI calculation is performed by the ME.
At USIM, during ECIES procedure of primary authentication, New SUPI type is
added, SQNMS is concatenated with SUPI (plain text block).
At UDM, when the SUPI indicates \'SUPI plus SQN~MS~\' the de-concealment needs
to disassociate SUPI and SQN~MS~. UDM stores SQN~MS~ temporarily until the
success or failure of the authentication is known.
There is no change to any entities if the authentication succeeds.
If there is authentication failure at the UE, UE sends only Authentication
failure message to the HE with SQN failure cause code (new value), without
AUTS.
At the UDM, if an authentication failure message with cause code (SQN failure)
is received, the temporarily stored value of SQN~MS~ received at the very
first step is processed. UDM synchronizes its value of SQN, i.e. SQN~HE~ =
SQN~MS~. Sequence number management profiles detailed in Annex C in TS 33.102
[3] are kept intact.
### 6.4.4 Solution #4.4: SQN protection during re-synchronisation procedure in
AKA
#### 6.4.4.1 Introduction
This solution addresses the key issue #4.1.
The following sequence chart illustrates what is already specified in TS
33.501 [2] clause 6.1.3.3 for the case of authentication request that results
in a synchronization failure. Additions are in step 5 and step 9. The
description is applicable when 5G AKA is used. However, the proposed mechanism
of setting AUTS to all zeros is not limited to the use of 5G AKA but is also
applicable if EAP-AKA\' is used. Further, the solution would be also
applicable to older generations than 5G.
#### 6.4.4.2 Solution details
Figure 6.4.4.2-1: Illustration of UE and HE synchronization failure detection
handling
1\. Authentication vector is generated during authentication procedure in
UDM/ARPF.
2\. Nudm_UEAuthentication_Get Request carrying the AUTN, RAND value in 5G HE
AV from UDM/ARPF to AUSF.
3\. Nausf_UEAuthentication_Authenticate Response carries the AUTN, RAND value
in 5G SE AV from AUSF to AMF/SEAF.
4\. AMF/SEAF sends AUTN, RAND value to UE in NAS Authentication Request
message.
5\. After the receipt of Authentication Request message, when there is no
synchronization failure, the UE computes an answer as described in TS 33.501
[2]. If, however the USIM detects a synchronization failure, it checks whether
the current RAND value is stored on the USIM as a received RAND value. If this
is not the case, it stores the RAND value in the USIM as a received RAND value
and computes AUTS as specified in TS 33.102 [3]. Otherwise, it sets AUTS to
all zeros.
NOTE: According to this, only RAND values of challenges that result in a
synchronization failure are stored on the USIM. The number of RAND values that
the USIM stores is entirely up to the operator and the choice of the value
affects only the USIM. The USIM can discard the oldest stored RAND value in
case there is otherwise no more room to store a new RAND value.
6\. UE includes AUTS provided by USIM in Authentication failure message to
AMF/SEAF.
7\. Upon receiving an authentication failure message with AUTS from the UE,
the AMF/SEAF sends an Nausf_UEAuthentication_Authenticate Request message with
a \"synchronisation failure indication\" to the AUSF.
8\. AUSF sends a Nudm_UEAuthentication_Get Request message to the UDM/ARPF
with RAND (sent to UE in preceding Authentication Request) and AUTS (received
from AMF/SEAF).
9\. UDM/ARPF receives the AUTS. If AUTS is all zeros, UDM/ARPF proceeds by
sending a Nudm_UEAuthentication_Get Response message with a new authentication
vector with a new RAND value. Otherwise, UDM/ARPF proceeds as specified in TS
33.501 [2] in case of a synchronisation failure.
#### 6.4.4.3 Solution summary
The solution would need to introduce in TS 33.102 [3], clause 6.3.5, a new
step 0 which checks for AUTS. If AUTS received is all zeros, then HE/AuC
continues with step (6), otherwise it continues with step (1).
Note, this solution cannot fully avoid the discovery of SQN~MS~ values, but it
provides a means for limiting the probability of SQN~MS~ leakage by
recommending a high RAND storage in USIM.
#### 6.4.4.4 Evaluation
The proposed solution has impact on the USIM and UDM.
The solution prevents the attacker from retrieving any SEQ~MS~ information
from UE in a way that the existing AK (Anonymity Key) used in AUTS is enough
to protect SEQ~MS~ without the need for changes of the protocol messages or
the cryptographic operations.
By setting AUTS to all zeros in case of RAND-reusage, a sniffer or active
attacker on the radio interface does not get any information from the
synchronization failure, except the fact that there was a RAND repetition. In
case the RAND repetition is due to a false base station replaying an
authentication request, which the network has previously sent to a UE, to this
same UE, the attacker is anyway aware that this is a RAND repetition. In
regular traffic, on the other hand, it is highly unlikely that two
authentication requests that cause a synchronization failure will have the
same RAND. If this still happens, and the network receives an all zeros AUTS,
the network gets no proof that this AUTS really comes from the UE, and the
network will not be able to synchronize the SEQ~HE~ with the SEQ~MS~. In this
case it is still clear for the network that something went wrong with the
authentication procedure, so the authentication procedure needs to be
repeated. The network repeats the authentication request until it creates a
RAND that has not been used to compute an AUTS before.
A potential attack on recording RAND values could estimate the number of RAND
values stored on the USIM by trial-and-error. Once an attacker has filled the
RAND storage and can repeat previously sent RANDs, the solution no longer
provides significantly more effective protection of the SQN than a USIM
without such RAND storage. The difficulty of the attack can be increased by
configuring the USIM with high RAND storage.
Note: The limitation of RAND storage in USIM is not addressed.
### 6.4.5 Solution #4.5: AUTS SQN~MS~ solution for 5GS
#### 6.4.5.1 Introduction
This solution addresses the key issue #4.1 and is applicable in 5GS.
#### 6.4.5.2 Solution details
If an attacker is able to retrieve the SQN~MS~ details by having the database
built with RAND and AUTN (captured from network) and use those against a
victim UE with repetition of RAND and AUTN values, privacy of the victim UE is
compromised. Such an attack can be carried out with control of RAND and AUTN.
The following solution is applicable to EPS and prevents such attack, even
with repeated RAND or AUTN. This can be achieved, if SQN~MS~ is never sent in
Authentication failure. Instead USIM calculates AUTS during the registration
step using a newly generated RAND~MS~ value. The new RAND~MS~ will be used
only for AUTS calculation and sent to home network along with AUTS (i.e. with
the Registration request message). In the home network, after deconcealing
SQN~MS~ (from AUTS), RAND~MS~ will be deleted and SQN~MS~ is stored
temporarily in UDM for future use.
Later after AKA challenge, when there is synch failure, then only the cause
value is sent to network. A new AV is generated with the previously stored
SQN~MS~ and re-synch procedure begins.
{width="6.886805555555555in" height="4.065277777777778in"}
Figure 6.4.5.2-1: SQN~MS~ shared to SN in Registration Request (5GS)
Figure 6.4.5.2-1: depicts the solution of SQN~MS~ shared in Registration
request in AUTS from USIM to HSS.
1\. At USIM, new RAND~MS~ is generated and SQN~MS~ retrieved (fetch the
highest previously accepted sequence number anywhere in the array). AUTS is
calculated at USIM (according to clause 6.3.3 of TS 33.102 [3]) and the
registration request is sent from UE to AMF/SEAF with AUTS, RAND~MS~ and SUCI
or 5G-GUTI.
2\. Authentication request is sent from SEAF to AUSF with SUCI or SUPI, SN-
name, AUTS and RAND~MS~.
3\. AUSF forwards the same content in Authentication Get Request message to
UDM.
4\. SIDF performs the deconcealment of SUCI and Authentication method is
selected. UDM tries to retrieve SQN~MS~ from AUTS, stores SQN~MS~ temporarily
and deletes RAND~MS~. A new Authentication vector is generated using the
existing SQN~HE~.
5\. The Authentication get response message is sent with the newly generated
5G AV.
6\. AUSF forwards the 5G SE AV in Nausf_UEAuthentication_Authenticate Response
to SEAF.
7\. SEAF forwards the RAND and AUTN in Authentication request message to UE.
8\. In USIM(UE), MAC will be verified followed by it, the SQN will be checked
against the correct range.
9\. Success case: Authentication is successful, as HRES* is verified in
Serving network and RES* is verified in home environment. When Authentication
results are updated from AUSF to UDM, SQN~MS~ will be deleted as home
environment and UE are synchronized.
10\. Failure case: Authentication failure message is sent from UE to SEAF with
only new failure cause for sync failure. SEAF forwards the failure message to
AUSF and AUSF forwards it to UDM. UDM begins to re- synchronize using SQN~MS~
received at step 4. SQN~HE~ is updated with SQN~MS~.
NOTE: This solution can also be adapted for EPS as follows. USIM generates a
new RANDMS and calculates AUTS. AUTS and RANDMS is used in Attach request sent
to HSS. Using RANDMS, SQNMS is retrieved from AUTS in HSS and RANDMS is
deleted. The new Authentication vectors are generated with existing SQNHE and
sent to MME along with SQNMS. MME stores SQNMS for future use. Both the
generated RAND and AUTN is sent in Authentication request message to UE. In
case of success, MME deletes SQNMS. In case of failure, AUTS is not calculated
in USIM and only sync failure cause is shared to MME. MME shares the SQNMS in
Authentication data request message to HSS and HSS starts re- synchronization
procedure with SQNMS received before. Also, HSS updates SQNHE with SQNMS.
In the scenario of UE triggered service request, authentication may be
performed. AMF gets AUTS and RAND~MS~ from UE and send them in authentication
request to AUSF.
{width="6.690277777777778in" height="2.8333333333333335in"}
Figure 6.4.5.2-2: UE Triggered Service Request procedure (AUSF get AUTS,
RAND~MS~ from UE)
Figure 6.4.5.2-2 depicts the procedure of UE triggered service request.
1\. UE to (R)AN: AN message (AN parameters, Service Request (List Of PDU
Sessions To Be Activated, List Of Allowed PDU Sessions, security parameters,
PDU Session status, 5G-S-TMSI, [NAS message container], Exempt Indication),
AUTS and RAND~MS~).
2\. (R)AN to AMF: N2 Message (N2 parameters, Service Request, AUTS and
RAND~MS~).
After receiving the Service Request message, the AMF may perform
authentication.
3\. Authentication request is sent from SEAF to AUSF with SUCI or SUPI, SN-
name, AUTS and RAND~MS~.
4\. The further steps of the authentication procedure are as step 5 to 10 in
figure 6.4.5.2-1.
5\. Subsequent service request procedure is as described in sub-clause 4.2.3.2
of TS 23.502.
After the establishment of the signalling connection to an AMF, the UE or
network may send signalling messages, e.g. PDU Session establishment from UE
to the SMF, via the AMF.
#### 6.4.5.3 Evaluation
_In the solution, SQN~MS~ is not sent in Authentication failure, which prevent
the leakage of SQN~MS~ even_ with repeated RAND or AUTN. Instead USIM
calculates AUTS during the registration step using a newly generated RAND~MS~
value.
The solution requires changes on UE, AMF and UDM.
_The solution may be applicable to EPS._
### 6.4.6 Solution #4.6: Using time-based or partly time-based SQN generation
#### 6.4.6.1 Introduction
This solution addresses is related to the key issue #4.1 Protection of SQN
during AKA re-synchronisations and shows that the problem would not exist, if
one of the following SQN generation schemes are used.
#### 6.4.6.2 Solution details
As specified in Annex C.3 in TS 33.102 [3], if the generation of sequence
number is time-based or partly time-based, the value of SQN does not allow to
trace the user over longer periods. Therefore, there may be no need to conceal
SQN by an anonymity key as specified in clause 6.3, TS 33.102 [3]. If the
time-based or partly time-based SQN generation is used, the AK is not used and
the SQN does not need protected.
Therefore, this solution propose to use time-based or partly time-based SQN
generation to resolve this key issue.
#### 6.4.6.3 Evaluation
This solution use time-based schemes to resolve the key issue#4.1 without
impact on USIM and UDM. It does not work for non-time based schemes. In case
that a home operator would decide to move from non-time based SQN generation
to time-based or partly time-based SQN generation, then the USIM on the field
would be impacted since some parameters of the USIM, such as choice of âˆ† or
limit L, would have to be configured differently depending on the new type of
profile (management of sequence numbers) and [associated]{.underline} security
policy of the home network. An inadequate configuration in the USIM of the
parameters (e.g. âˆ†) results in a procedure of verification of sequence numbers
in the USIM involving increase of re-synchronization procedures, and possibly
impossibility to re-synchronize the system.
### 6.4.7 Solution #4.7: SQN protection by concealment with SUPI with f5*
#### 6.4.7.1 Introduction
This solution addresses the key issue #4.1 Protection of SQN during AKA re-
synchronisations.
#### 6.4.7.2 Solution details
_This solution is based on solution #4.3 (from_ TR 33.846 _), which proposes
that the USIM is concealing SQNMS and SUPI together, to protect SQN during AKA
re-synchronisation. The solution described in the following works for SUCI
concealment in ME or in the USIM. The solution also applies for other schemes
than null scheme._
UE calculates the SUCI, _according to TS_  _33.501_  _[2] clause 6.12.2, i_ f
the operator\'s decision is to do so. In case of SUCI concealment in ME _,_
the ME reads the SUCI calculation information from the USIM, including the
SUPI, the SUPI Type, the Routing Indicator, the Home Network Public Key
Identifier, the Home Network Public Key and the list of protection scheme
identifiers.
To allow the UE doing SQN protection by concealment with SUPI according to
solution #4.3, UE also needs to include _SQNMS in the SUCI calculation.
However,_ it has to be assured that the SQN~MS~ does not leave USIM in the
clear. It is therefore proposed that USIM conceals SQN~MS~. For this, a new
RAND~SQN~ value is generated in the USIM. For SUCI concealment in the ME or in
the USIM the following steps are performed:
1\. At USIM, using a newly generated RAND~SQN~ value and counter value
SQN~MS~, the concealed value Conc(SQN~MS~) is generated with the existing key
generating function f5*, i.e. Conc(SQN~MS~) = SQN~MS~ Ã… f5*K(RAND~SQN~). In
case of SUCI concealment in the ME, both Conc(SQN~MS~) and RAND~SQN~ value are
sent from the USIM to ME, together with SUPI, for SUCI calculation.
2\. At UE, SUCI is then generated from SUPI, Conc(SQN~MS~) and RAND~SQN~. The
SUPI type is marked as SUPI plus SQN~MS~ (e.g. value 4).
3\. At the home network UDM/ARPF/SIDF, after SUCI de-concealment, SUPI,
Conc(SQN~MS~) and RAND~SQN~ are retrieved. Further, SQN~MS~ is retrieved from
Conc(SQN~MS~) (similar to step 1 of TS 33.102 clause 6.3.5). The Home
Environment temporarily stores SQN~MS~ and RAND~SQN~ is deleted. UDM/ARPF
retrieves with SUPI the existing SQN~HE~ and generates an authentication
vector AV.
4\. At UE, for a success case, if there is neither a MAC failure nor a
synchronization failure, the Authentication response message is sent back to
AMF/SEAF. At UDM, since the SQN~MS~ and SQN~HE~ are already aligned, the
temporarily stored SQN~MS~ in UDM is deleted.
5\. At UE, for a failure case, if there is synchronization failure, then pre-
agreed AUTS or freshly generated dummy AUTS value is sent. Since UDM already
holds the SQN~MS~ temporarily till 5G AKA is finalized, AUTS received in the
failure message is ignored, i.e. SQN~MS~ is not needed to be sent in the
failure message. When Authentication failure message is received by UDM, a new
AV is generated from the already available SQN~MS~ (received in Registration
request as part of SUCI). In this case, UDM also synchronizes SQN~HE~ with
SQN~MS~. AUSF provides (RAND, AUTN) to AMF/SEAF, which will send another
challenge to UE. This fresh challenge cannot have SQN synchronisation failure
anymore, because UDM has synchronized SQN~HE~ and SQN~MS~ already.
NOTE: The pre-agreed or dummy AUTS is not processed by the UDM to derive the
SQN~MS~, pre-agreed or dummy AUTS just helps the serving network nodes to
behave transparently in the synchronization failure scenario.
#### 6.4.7.3 Evaluation
Solution works if SUCI computation is performed in the USIM/ME. Changes are
restricted to UE and UDM only. In case of SUCI computation in the USIM, there
is no impact on the ME.
# 7 Conclusions
## 7.0 Overall evaluation aspects
### 7.0.1 Assessment of attack risk
Table 7.0.1-1
+----------------------+----------------------+----------------------+ | Key Issues | Security threats | Comments | | | | | | | | (e.g. likelihood, | | | | level of severity) | +======================+======================+======================+ | Key Issue #2.1: | Traceability of the | | | Linkability by | user/victim | | | distinguishing MAC | | | | failure and | IMSI-probing is when | | | synchronization | an attacker tries to | | | failure | find out whether the | | | | subscriber with this | | | | identity is present | | | | in a given area. | | +----------------------+----------------------+----------------------+ | Key Issue #2.2: | Traceability of the | 1. The likelihood | | Linkability by SUCI | user/victim | of this issue is | | replay | | extremely low. | | | IMSI-probing is when | | | | an attacker tries to | 2. The actual | | | find out whether the | identity of the user | | | subscriber with this | cannot be revealed | | | identity is present | by a SUCI so there | | | in a given area. | is no threat to the | | | | user as the user can | | | | not be identified. | +----------------------+----------------------+----------------------+ | Key Issue #2.2: | Traceability of the | This attack only | | Linkability by | user/victim | applies to scenarios | | generation of | | where the SUCI | | different SUCIs | IMSI-probing is when | calculation is to be | | | an attacker tries to | performed by the ME. | | | find out whether the | | | | subscriber with this | | | | identity is present | | | | in a given area. | | +----------------------+----------------------+----------------------+ | Key Issue #2.2: DoS | DoS attack on UDM | | | attack | | | +----------------------+----------------------+----------------------+ | Key Issue #3.1: | N/A | | | Attack due to | | | | expired | | | | authentication | | | | result in the UDM | | | +----------------------+----------------------+----------------------+ | Key Issue #3.2: | Privacy threat | This attack only | | SUPI guessing | | applies to scenarios | | attacks | | where the SUCI | | | | calculation is to be | | | | performed by the ME. | +----------------------+----------------------+----------------------+ | Key Issue #4.1: | Privacy leakage of | | | Protection of SQN | subscribers | | | during AKA | | | | re-synchronisations | Keystream re-use in | | | | the AKA protocol. | | | | Leakage of | | | | information on the | | | | sequence number in | | | | AKA | | | | re-synchronisations. | | | | Leaked sequence | | | | number information | | | | possibly provides | | | | information on the | | | | number of | | | | authentications | | | | performed. | | +----------------------+----------------------+----------------------+
### 7.0.2 Impact of solutions
Table 7.0.2-1: Comparison table of UE and network impacts per solution
+-------------+-------------+-------------+-------------+-------------+ | | **UE |** Network | * | | | | impacts**| impacts** | _comments_ _| | +=============+=============+=============+=============+=============+ | ** | | AMF/ | UDM/ | | | Solutions_ _| | | | | | | | SEAF | ARPF | | +-------------+-------------+-------------+-------------+-------------+ |__Solutions | | | | | | for | | | | | | resilience | | | | | | against | | | | | | identifier | | | | | | li | | | | | | nkability_ _| | | | | +-------------+-------------+-------------+-------------+-------------+ | #2.1: | ME | X | X | Risk of | | Handling of | | | | linkability | | Sync | | | | attack. | | failure by | | | | | | AUTS | | | | | | encryption | | | | | +-------------+-------------+-------------+-------------+-------------+ | #2.2: | Probably ME | X | X | Aut | | Encryption | | | | hentication | | of | | | | failure | | aut | | | | message for | | hentication | | | | the first | | failure | | | | UE | | message | | | | r | | types by UE | | | | egistration | | with new | | | | is left | | keys | | | | unencrypted | | derived | | | | | | from | | | | | | K_AUSF | | | | | +-------------+-------------+-------------+-------------+-------------+ | #2.3: | USIM | X | X | | | Unified | | | | | | aut | | | | | | hentication | | | | | | response | | | | | | message by | | | | | | UE | | | | | +-------------+-------------+-------------+-------------+-------------+ | #2.4: | USIM | X | X | | | MAC-S based | | | | | | solution | | | | | +-------------+-------------+-------------+-------------+-------------+ | #2.5: | USIM or ME | X | X | This | | Encryption | | | | solution | | of | | | | relies on | | aut | | | | the | | hentication | | | | a | | failure | | | | vailability | | message | | | | of SUCI | | with SUCI | | | | mechanism. | | method | | | | | +-------------+-------------+-------------+-------------+-------------+ | #2.6: | USIM and ME | X | X | This | | Certificate | | | | solution | | based | | | | relies on | | encryption | | | | the | | of unicast | | | | a | | NAS message | | | | vailability | | | | | | of PKI | | | | | | ar | | | | | | chitecture, | | | | | | and there | | | | | | is | | | | | | companion | | | | | | list of | | | | | | open | | | | | | questions. | +-------------+-------------+-------------+-------------+-------------+ | #2.7: | USIM and ME | | X | | | Mitigation | | | | | | against the | | | | | | SUCI replay | | | | | | attack | | | | | +-------------+-------------+-------------+-------------+-------------+ | #2.8 | USIM and ME | | X | The | | Assuring | | | | security | | SUCI | | | | risk to | | generation | | | | derive new | | by | | | | key from | | legitimate | | | | long term | | SUPI owner | | | | key for any | | using | | | | new | | K~SUCI~ | | | | purposes | | | | | | (example: | | | | | | during | | | | | | KSUCI | | | | | | derivation) | | | | | | different | | | | | | from the | | | | | | ones | | | | | | already | | | | | | specified | | | | | | for AKA | | | | | | procedure | | | | | | needs to be | | | | | | evaluated | | | | | | by ETSI | | | | | | SAGE | +-------------+-------------+-------------+-------------+-------------+ | #2.9: MAC, | USIM | X | X | | | SYNCH | | | | | | failure | | | | | | cause | | | | | | concealment | | | | | +-------------+-------------+-------------+-------------+-------------+ | #2.10: | | | X | | | Solution to | | | | | | key Issue | | | | | | #2.2: SUCI | | | | | | replay | | | | | +-------------+-------------+-------------+-------------+-------------+ | #2.11: | | | X | | | Mitigate | | | | | | the SUCI | | | | | | replay | | | | | | based on | | | | | | UE\'s | | | | | | public key | | | | | +-------------+-------------+-------------+-------------+-------------+ | Solution | USIM | | X | | | #2.12: | | | | | | Adding | | | | | | randomness | | | | | | and MAC | | | | | | calculation | | | | | | on the UE | | | | | | side | | | | | +-------------+-------------+-------------+-------------+-------------+ |__Solutions | | | | Usage of | | for | | | | the long | | a | | | | term key K | | vailability | | | | for other | | aspects of | | | | uses. | | SUCI | | | | | | usage_ _| | | | | +-------------+-------------+-------------+-------------+-------------+ |__#3.1: | USIM and ME | X | X | Security | | Mitigation | | | | issue due | | of SUPI | | | | to the use | | guessing | | | | of the long | | and SUCI | | | | term key K | | replay | | | | for other | | attack | | | | purpose | | using long | | | | than AKA. | | term key_ _| | | | | +-------------+-------------+-------------+-------------+-------------+ |__#3.2: | USIM | | X | | | Adding | | | | | | Check Value | | | | | | behind SUPI | | | | | | to mitigate | | | | | | the SUPI | | | | | | guessing | | | | | | attacks_ _| | | | | +-------------+-------------+-------------+-------------+-------------+ |__#3.3: | | X | | | | Mitigation | | | | | | of SUPI | | | | | | guessing | | | | | | attack_ _| | | | | +-------------+-------------+-------------+-------------+-------------+ |__Solutions | | | | | | on | | | | | | re-sync | | | | | | hronisation | | | | | | in AKA_ _| | | | | +-------------+-------------+-------------+-------------+-------------+ | #4.1: | USIM | | X | | | Using MACS | | | | | | as | | | | | | freshness | | | | | | in the | | | | | | calculation | | | | | | of AK | | | | | +-------------+-------------+-------------+-------------+-------------+ | #4.2: | USIM | | X | This | | Using | | | | solution | | symmetric | | | | requires | | encryption | | | | the | | function to | | | | definition | | protect SQN | | | | of a new | | during a | | | | function | | re-sync | | | | f6* for | | hronisation | | | | AKA | | procedure | | | | procedure | | in AKA | | | | | +-------------+-------------+-------------+-------------+-------------+ | #4.3: SQN | USIM | X | X | Solution | | protection | | | | works if | | by | | | | SUCI | | concealment | | | | computation | | with SUPI | | | | is | | in USIM | | | | performed | | | | | | in the | | | | | | USIM. | +-------------+-------------+-------------+-------------+-------------+ | #4.4: SQN | USIM and ME | | X | Limitation | | protection | | | | of SQN~MS~ | | during | | | | leakage | | re-sync | | | | depends on | | hronisation | | | | RAND | | procedure | | | | storage in | | in AKA | | | | the USIM. | +-------------+-------------+-------------+-------------+-------------+ | #4.5: AUTS | USIM and ME | X | X | TBD | | SQN~MS~ | | | | | | solution | | | | | | for 5GS | | | | | +-------------+-------------+-------------+-------------+-------------+ | #4.6: | | | | Solution | | Using | | | | requires | | time-based | | | | time based | | or partly | | | | SQN | | time-based | | | | generation | | SQN | | | | | | generation | | | | | +-------------+-------------+-------------+-------------+-------------+ | #4.7: SQN |__In case | | X | Solution | | protection | of SUCI | | | works if | | by | computation | | | SUCI | | concealment | in ME: USIM | | | computation | | with SUPI | and ME_ _| | | is | | with f5* | | | | performed | | |__In case | | | in the | | | of SUCI | | | USIM/ME. | | | computation | | | Changes are | | | in_ _| | | restricted | | | | | | to UE and | | |__USIM_ *: | | | UDM only. | | | USIM | | | | +-------------+-------------+-------------+-------------+-------------+
NOTE: A mapping table on which solution is addressing which key issue is
provided in clause 6.0.
## 7.1 Conclusion on key issue #2.1: Linkability by distinguishing MAC failure
and synchronization failure
No normative work will be specified to address key issue #2.1.
## 7.2 Conclusion on key issue #2.2: SUCI based attacks
No normative work will be specified to address the linkability attacks given
in key issue #2.2.
## 7.3 Conclusion on key issue #3.1: Attack due to expired authentication
result
No normative work is needed for the key issue #3.1 since stage 3
specifications have already addressed the issue of removing the authentication
result stored in the UDM in the scenarios described in the key issue details.
## 7.4 Conclusion on key issue #3.2: SUPI guessing attacks
The SUPI guessing attack only applies to scenarios where the SUCI calculation
is to be performed by the ME. And, just knowing that an IMSI is valid reveals
that the IMSI is assigned to someone, but it does not reveal anything about
that person.
Consequently, it is proposed to conclude as follows:
\- No normative work is needed for the key issue #3.2.
## 7.5 Conclusion on key issue #4.1: Protection of SQN during AKA re-
synchronisations
For key issue #4.1, solution #4.1 is chosen to be described in an informative
annex as an optional to deploy solution.
#
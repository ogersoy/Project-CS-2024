# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
The present document has been produced by the 3GPP TSG SA to standardise
Lawful Interception of telecommunications. The present document describes
protocols and procedures for Lawful Interception based on 3GPP specifications.
These protocols and procedures cover both internal 3GPP interfaces (those
required to intercept communications and manage interception within a 3GPP
network) and external handover interfaces (those used for delivery of
intercepted communications to Law Enforcement, or handling of warrants).
Lawful Interception needs to be done in accordance with the applicable
national or regional laws and technical regulations. Such national laws and
regulations define the extent to which capabilities in the present document
are applicable in specific jurisdictions.
# 1 Scope
The present document specifies the protocols and procedures required to
perform Lawful Interception within a 3GPP network. The present document
addresses both internal interfaces used internally with a 3GPP network and
external handover interfaces used to handover intercepted communications to
law enforcement.
The present document describes the detailed targeting of communications in
each point of interception within a 3GPP network and the information that a
point of interception needs to be able to capture. Furthermore, the detailed
data formats for both the internal and external interfaces are also defined.
National regulations determine the applicable set of information that needs to
be handed over or excluded from handover to law enforcement for a given 3GPP
operator service.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System\".
[3] 3GPP TS 33.126: \"Lawful Interception Requirements\".
[4] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[5] 3GPP TS 33.127: \"Lawful Interception (LI) Architecture and Functions\".
[6] ETSI TS 103 120: \"Lawful Interception (LI); Interface for warrant
information\".
[7] ETSI TS 103 221-1: \"Lawful Interception (LI); Internal Network
Interfaces; Part 1: X1\".
[8] ETSI TS 103 221-2: \"Lawful Interception (LI); Internal Network
Interfaces; Part 2: X2/X3\".
[9] ETSI TS 102 232-1: \"Lawful Interception (LI); Handover Interface and
Service-Specific Details (SSD) for IP delivery; Part 1: Handover specification
for IP delivery\".
[10] ETSI TS 102 232-7: \"Lawful Interception (LI); Handover Interface and
Service-Specific Details (SSD) for IP delivery; Part 7: Service-specific
details for Mobile Services\".
[11] 3GPP TS 33.501: \"Security Architecture and Procedures for the 5G
System\".
[12] 3GPP TS 33.108: \"3G security; Handover interface for Lawful Interception
(LI)\".
[13] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System
(5GS)\".
[14] 3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General
Aspects\".
[15] 3GPP TS 29.244: \"Interface between the Control Plane and the User Plane
nodes\".
[16] 3GPP TS 29.502: \"5G System; Session Management Services; Stage 3\".
[17] 3GPP TS 29.571: \"5G System; Common Data Types for Service Based
Interfaces; Stage 3\".
[18] 3GPP TS 23.040: \"Technical realization of the Short Message Service
(SMS)\".
[19] 3GPP TS 23.003: \"Numbering, addressing and identification \".
[20] OMA-TS-MLP-V3_5-20181211-C: \"Open Mobile Alliance; Mobile Location
Protocol, Candidate Version 3.5\",
https://www.openmobilealliance.org/release/MLS/V1_4-20181211-C/OMA-TS-
MLP-V3_5-20181211-C.pdf.
[21] 3GPP TS 29.540: \"5G System; SMS Services; Stage 3\".
[22] 3GPP TS 29.518: \"5G System; Access and Mobility Management Services;
Stage 3\".
[23] 3GPP TS 38.413: \"NG Application Protocol (NGAP)\".
[24] 3GPP TS 29.572: \"Location Management Services; Stage 3\".
[25] 3GPP TS 29.503: \"5G System; Unified Data Management Services\".
[26] IETF RFC 815: \"IP datagram reassembly algorithms\".
[27] IETF RFC 2460: \"Internet Protocol, Version 6 (IPv6) Specification\".
[28] IETF RFC 793: \"Transmission Control Protocol\".
[29] IETF RFC 768: \"User Datagram Protocol\".
[30] IETF RFC 4340: \"Datagram Congestion Control Protocol (DCCP)\".
[31] IETF RFC 4960: \"Stream Control Transmission Protocol\".
[32] IANA (www.iana.org): Assigned Internet Protocol Numbers, \"Protocol
Numbers\".
[33] IETF RFC 6437: \"IPv6 Flow Label Specification\".
[34] IETF RFC 791: \"Internet Protocol\".
[35] Open Geospatial Consortium OGC 05-010: \"URNs of definitions in ogc
namespace\".
[36] 3GPP TS 33.107: \"3G security; Lawful interception architecture and
functions\".
[37] 3GPP TS 37.340: \"Evolved Universal Radio Access (E-UTRA) and NR-Multi-
connectivity; Stage 2\".
[38] 3GPP TS 36.413: \"S1 Application Protocol (S1AP)\".
[39] OMA-TS-MMS_ENC-V1_3-20110913-A: \"Multimedia Messaging Service
Encapsulation Protocol\".
[40] 3GPP TS 23.140: \"Multimedia Messaging Protocol. Functional Description.
Stage 2\".
[41] 3GPP TS 38.415: \"NG-RAN; PDU Session User Plane Protocol\".
[42] 3GPP TS 23.273: \"5G System (5GS) Location Services (LCS); Stage 2\".
[43] IETF RFC 4566: \"SDP: Session Description Protocol\".
[44] 3GPP TS 24.193: \"Stage 3: Access Traffic Steering, Switching and
Splitting (ATSSS)\".
[45] 3GPP TS 29.509: \"5G System; Authentication Server Services; Stage 3\".
[46] 3GPP TS 24.011: \"Point-to-Point (PP) Short Message Service (SMS) support
on mobile radio interface\".
[47] 3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".
[48] 3GPP TS 29.504: \"5G System; Unified Data Repository Services; Stage 3\".
[49] 3GPP TS 29.505: \"5G System; Usage of the Unified Data Repository
services for Subscription Data; Stage 3\".
[50] 3GPP TS 23.401 \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[51] 3GPP TS 24.301 \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS), Stage 3\".
[52] 3GPP TS 23.271 \"Functional stage 2 description of Location Services
(LCS)\".
[53] 3GPP TS 29.172 \"Evolved Packet Core (EPC) LCS Protocol (ELP) between the
Gateway Mobile Location Centre (GMLC) and the Mobile Management Entity (MME);
SLg interface\".
[54] 3GPP TS 29.171 \"LCS Application Protocol (LCS-AP) between the Mobile
Management Entity (MME) and Evolved Serving Mobile Location Centre (E-SMLC);
SLs interface\".
[55] 3GPP TS 24.379: \"Mission Critical Push to Talk (MCPTT) call control;
protocol specification\".
[56] OMA-TS-PoC-System_Description-V2_1-20110802-A: \"OMA PoC System
Description\".
[57] 3GPP TS 29.541: \"5G System; Network Exposure (NE) function services for
Non-IP Data Delivery (NIDD); Stage 3\".
[58] 3GPP TS 29.522: \"5G System; Network Exposure Function Northbound APIs;
Stage 3\".
[59] 3GPP TS 29.338: \"Diameter based protocols to support Short Message
Service (SMS) capable Mobile Management Entities (MMEs); Stage 3\".
[60] 3GPP TS 29.337: \"Diameter-based T4 interface for communications with
packet data networks and applications\".
[61] 3GPP TS 24.250: \"Protocol for Reliable Data Service; Stage 3\".
[62] 3GPP TS 29.128: \"Mobility Management Entity (MME) and Serving GPRS
Support Node (SGSN) interfaces for interworking with packet data networks and
applications\".
[63] 3GPP TS 29.122: \"T8 reference point for Northbound APIs\".
[64] 3GPP TS 29.598: \"5G System; Unstructured Data Storage Services;
Stage3\".
[65] 3GPP TS 33.535: \"Authentication and Key Management for Applications
(AKMA) based on 3GPP credentials in the 5G System (5GS)\".
[66] IETF RFC 5246: \"The Transport Layer Security (TLS) Protocol Version
1.2\".
[67] GSMA IR.88: \"IR.88 LTE and EPC Roaming Guidelines\".
[68] GSMA NG.114 \"IMS Profile for Voice, Video and Messaging over 5GS\".
[69] IETF RFC 8225: \"PASSporT: Personal Assertion Token\".
[70] IETF RFC 8224: \"Authenticated Identity Management in the Session
Initiation Protocol (SIP)\".
[71] IETF RFC 8588: \"Personal Assertion Token (PaSSporT) Extension for
Signature-based Handling of Asserted information using toKENs (SHAKEN)\".
[72] 3GPP TS 24.196: \"Enhanced Calling Name (eCNAM)\".
[73] IETF draft-ietf-stir-passport-rcd-17: \"PASSporT Extension for Rich Call
Data\".
NOTE: The above document cannot be formally referenced until it is published
as an RFC.
[74] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[75] IANA Session Initiation Protocol (SIP) Parameters:
https://www.iana.org/assignments/sip-parameters/sip-parameters.xhtml
[76] IETF RFC 8946: \"Personal Assertion Token (PASSporT) Extension for
Diverted Calls\".
[77] 3GPP TS 23.204: \"3rd Generation Partnership Project; Technical
Specification Group Services and System Aspects; Support of Short Message
Service (SMS) over generic 3GPP Internet Protocol (IP) access; Stage 2\".
[78] GSMA RCC.07: \"Rich Communication Suite -- Advanced Communications
Services and Client Specification\".
[79] IETF RFC 4975: \"The Message Session Relay Protocol (MSRP)\".
[80] IETF RFC 3862: \"Common Presence and Instant Messaging (CPIM): Message
Format\".
[81] IETF RFC 5438: \"Instant Message Disposition Notification (IMDN)\".
[82] OMA-TS-CPM_System_Description-V2_2-20170926-C: \"OMA Converged IP
Messaging System Description\".
[83] IETF RFC 4566: \"SDP: Session Description Protocol\".
[84] 3GPP TS 36.455: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
LTE Positioning Protocol A (LPPa) \".
[85] 3GPP TS 37.355: \"LTE Positioning Protocol (LPP) \".
[86] 3GPP TS 38.455: \"NG-RAN; NR Positioning Protocol A (NRPPa)\".
[87] 3GPP TS 29.274: \"3GPP Evolved Packet System (EPS); Evolved General
Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C);
Stage 3\".
[88] 3GPP TS 29.513: \"5G System; Policy and Charging Control signalling flows
and QoS parameter mapping\".
[89] 3GPP TS 29.512: \"5G System; Session Management Policy Control Service;
Stage 3\".
[90] 3GPP TS 29.508: \"5G System; Session Management Event Exposure Service;
Stage 3\".
[91] 3GPP TS 29.514: \"5G System; Policy Authorization Service; Stage 3\".
[92] 3GPP TS 29.214: \"Policy and Charging Control over Rx reference point\".
[93] 3GPP TS 24.008: \"Mobile radio interface Layer 3 specification; Core
network protocols; Stage 3\".
[94] 3GPP TS 29.551: \"5G System; Packet Flow Description Management Service;
Stage 3\".
[95] 3GPP TS 24.341: \"Support of SMS over IP networks, Stage 3\".
[96] 3GPP TS 29.272 \" Mobility Management Entity (MME) and Serving GPRS
Support Node (SGSN) related interfaces based on Diameter protocol\".
[97] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging applications\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
\ \
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
ADMF LI Administration Function
CC Content of Communication
CSP Communication Service Provider
CUPS Control and User Plane Separation
DNAI Data Network Access Identifier
ICF Identity Caching Function
IEF Identity Event Function
IQF Identity Query Function
IRI Intercept Related Information
LALS Lawful Access Location Services
LEA Law Enforcement Agency
LEMF Law Enforcement Monitoring Facility
LI Lawful Interception
LICF Lawful Interception Control Function
LI_HI1 LI_Handover Interface 1
LI_HI2 LI_Handover Interface 2
LI_HI3 LI_Handover Interface 3
LI_HI4 LI_Handover Interface 4
LI_HIQR Lawful Interception Handover Interface Query Response
LIPF Lawful Interception Provisioning Function
LIR Location Immediate Request
LI_SI Lawful Interception System Information Interface
LISSF Lawful Interception State Storage Function
LI_ST Lawful Interception State Transfer Interface
LI_X1 Lawful Interception Internal Interface 1
LI_X2 Lawful Interception Internal Interface 2
LI_X3 Lawful Interception Internal Interface 3
LI_XEM1 Lawful Interception Internal Interface Event Management Interface 1
LI_XER Lawful Interception Internal Interface Event Record
LI_XQR Lawful Interception Internal Interface Query Response
LTF Location Triggering Function
MDF Mediation and Delivery Function
MDF2 Mediation and Delivery Function 2
MDF3 Mediation and Delivery Function 3
MM Multimedia Message
MMS Multimedia Message Service
NAT Network Address Translation
NPLI Network Provided Location Information
O&M Operations and Management
POI Point Of Interception
RCS Rich Communication Suite
SDP Session Description Protocol
SIP Session Initiation Protocol
SIRF System Information Retrieval Function
SOI Start Of Interception
TF Triggering Function
TNGF Trusted Non-3GPP Gateway Function
TWIF Trusted WLAN Interworking Function
xCC LI_X3 Communications Content.
xIRI LI_X2 Intercept Related Information
# 4 General
## 4.1 Introduction
The present document provides details of the internal and external interfaces
required for a network operator, access provider and/or service provider to
provide the necessary information to a Law Enforcement Agency (LEA) required
to meet LI requirements. LI requirements for 3GPP networks and services are
given in TS 33.126 [3].
The high-level architecture that defines the necessary interfaces is specified
in TS 33.127 [5]. The generic high-level architecture is as follows:
Figure 4.1-1: High-level architecture diagram with key point-to-point LI
interfaces
The specification of the interfaces is split into two parts:
\- Internal interfaces used between an operator's network functions are
described in clause 4.2.
\- External interfaces used in communicating with a LEA are described in
clause 4.3.
## 4.2 Basic principles for internal interfaces
This clause lists the internal interfaces shown in clause 4.1, indicates the
protocol used to realise each interface, and gives a reference to the relevant
clauses of the present document that specify how the protocol is to be used
for the given interface.
Table 4.2-1: Internal interfaces and related protocols
* * *
Interface Description Protocol used to realise interface Usage LI_ADMF Used to
pass intercept provisioning information form the LICF to the LIPF. Out of
scope of the present document.  
LI_IQF Used to pass information related to IEFs and ICF to IQF. Out of scope
of the present document.  
LI_MDF Used by MDF2 and MDF3 in interactions necessary to correctly generate
CC and IRI from xCC and xIRI. Out of scope of the present document.  
LI_SI Used to provide system information to the LIPF from the SIRF. Out of
scope of the present document.  
LI_ST Used to transfer LI state information to and from the LISSF. 3GPP TS
29.598 [64]. See clauses 5.10 and 6.2.3.10 LI_T2 Used to pass triggering
information from the IRI-TF to a Triggered IRI-POI. ETSI TS 103 221-1 [7]. See
clause 5.2.4 LI_T3 Used to pass triggering information from a CC-TF to a
Triggered CC-POI. ETSI TS 103 221-1 [7]. See clause 5.2.4 LI_X1 Used to
configure and audit Directly-provisioned POIs, TFs and MDFs. ETSI TS 103 221-1
[7]. See clause 5.2.2 LI_X1 (Management) Used to audit Triggered POIs. ETSI TS
103 221-1 [7]. See clause 5.2.3 LI_X2 Used to pass xIRI from IRI-POIs to the
MDF2. ETSI TS 103 221-2 [8]. See clause 5.3.2 LI_X3 Used to pass xCC from CC-
POIs to the MDF3. ETSI TS 103 221-2 [8]. See clause 5.3.3 LI_XEM1 Used by the
LICF/LIPF to manage IEFs and ICF. ETSI TS 103 221-1 [7]. See clause 5.2.7
LI_XER Used to pass identifier association event records from IEFs to ICF. See
Clause 5.9. See clause 5.9 LI_XQR Used to pass queries from IQF to ICF and
responses from ICF to IQF. ETSI TS 103 221-1 [7]. See clause 5.8
* * *
## 4.3 Basic principles for external handover interfaces
This clause lists the external handover interfaces shown in clause 4.1,
indicates the protocol used to realise each interface, and gives a reference
to the relevant clauses of the present document that specify how the protocol
is to be used for the given interface.
Table 4.3-1: External handover interfaces and related protocols
+-----------+-----------------+-----------------+----------------+ | Interface | Description | Protocol used | Usage | | | | to realise | | | | | interface | | +-----------+-----------------+-----------------+----------------+ | LI_HI1 | Used to send | ETSI TS 103 120 | See clause 5.4 | | | warrant and | [6] shall be | | | | other | supported. | | | | interception | | | | | request | Other methods | | | | information | (e.g. manual | | | | from LEA to | exchange) may | | | | operator. | be used | | | | | depending on | | | | | national | | | | | regulatory | | | | | requirements. | | +-----------+-----------------+-----------------+----------------+ | LI_HI2 | Used to send | ETSI TS 102 | See clause 5.5 | | | IRI from the | 232-1 [9] and | | | | MDF2 to the | ETSI TS 102 | | | | LEMF. | 232-7 [10] | | | | | shall be | | | | | supported. | | +-----------+-----------------+-----------------+----------------+ | LI_HI3 | Used to send CC | ETSI TS 102 | See clause 5.5 | | | from the MDF3 | 232-1 [9] and | | | | to the LEMF. | ETSI TS 102 | | | | | 232-7 [10] | | | | | shall be | | | | | supported. | | +-----------+-----------------+-----------------+----------------+ | LI_HI4 | Used to send LI | ETSI TS 102 | See clause 5.6 | | | notification | 232-1 [9] and | | | | information | ETSI TS 102 | | | | from MDF2/3 to | 232-7 [10] | | | | LEMF. | shall be | | | | | supported. | | +-----------+-----------------+-----------------+----------------+ | LI_HIQR | Used to send | ETSI TS 103 120 | See clause 5.7 | | | warrant and | [6] shall be | | | | other | supported. | | | | identifier | | | | | association | | | | | query | | | | | information | | | | | from LEA to CSP | | | | | and used by the | | | | | CSP to send | | | | | query responses | | | | | to the LEA. | | | +-----------+-----------------+-----------------+----------------+
## 4.4 Service scoping
### 4.4.1 General
The interception product shall be delivered to the LEMF over LI_HI2 and
LI_HI3, observing the service scoping described in the following clauses.
### 4.4.2 CSP service type
The LIPF shall be able to provision the POIs, TFs and MDF2/MDF3 according to
the requirements of the warrant with the following CSP service type(s):
\- Voice.
\- Data.
\- Messaging (e.g. SMS/MMS).
\- Push-to-Talk (including MCPTT).
\- LALS (the Target Positioning service, per TS 33.127 [5], clause 7.3.3.2).
\- RCS.
When multiple service types are applicable to a target due to multiple
warrants, the MDF2/MDF3 shall be able to deliver interception product to each
LEMF based on the CSP service type(s) of the respective warrant.
When no service type is provisioned, the POIs shall generate and deliver
applicable interception product for all services specified for the NF where
the POI is located.
When no service type is provisioned, the MDF2/MDF3 shall deliver all
interception product it receives from the POIs.
### 4.4.3 Delivery type
\- IRI.
\- CC.
\- IRI and CC.
The LIPF shall be able to provision the POI, TF and the MDF2/MDF3 according
the delivery type(s) applicable to a warrant.
When different delivery types are applicable to a target due to multiple
warrants, the MDF2/MDF3 shall be able to deliver IRI/CC to each LEMF based on
the delivery type(s) of the respective warrant.
### 4.4.4 Location Reporting
The LIPF shall be able to provision the POIs and MDF2 according to the
requirements of the warrant with the following location reporting types:
\- Report location only at the beginning and end of a session.
\- Do not report location.
When no location reporting type is provisioned, the POIs and MDF2/MDF3 shall
report location every time the target location information is received at the
POI (including location update with no physical change of location).
When different location reporting types are applicable to a target due to
multiple warrants, then POI may be provisioned as if the reporting of all
location information occurrences at the POI is required, with MDF2 restricting
the delivery of location to the LEMF as per the provisioned information for a
warrant.
### 4.4.5 LALS Triggering
\- This option is used to activate the LALS triggered location service (TS
33.127 [5], clause 7.3.3.3) for the target.
The LIPF shall be able to provision the LTF associated with a POI or MDF2 with
the LALS triggered location service parameters provided in the warrant or use
a default set of parameters.
### 4.4.6 Roaming Interception
\- Stop interception when the target is roaming outbound internationally.
NOTE 1: The definition of international roaming for LI purposes could vary per
jurisdiction.
NOTE 2: The method used to achieve the roaming related service scoping is not
described in the present document.
# 5 Transport and Communications Protocol
## 5.1 General
This clause describes the protocols used for each of the interfaces at a level
which is agnostic of the subject service or network. Additional specific
fields or behaviours are given in the relevant parts of clauses 6 and 7.
## 5.2 Protocols for LI_X1 and LI_T interfaces
### 5.2.1 General usage of ETSI TS 103 221-1
Functions having an LI_X1, LI_T2 or LI_T3 interface shall support the use of
ETSI TS 103 221-1 [7] to realise the interface.
In the event of a conflict between ETSI TS 103 221-1 [7] and the present
document, the terms of the present document shall apply.
The LIPF and MDF2/3 shall maintain a mapping between internal interception
identifiers (XIDs) and external interception identifiers (LIIDs), as defined
by ETSI TS 103 221-1 [7] clause 5.1.2. In case of multiple interceptions for a
single target identifier, it is an implementation decision for the LIPF/TF
whether multiple XIDs are used (i.e. a one-to-one mapping between XID and LIID
is maintained) or whether the single XID is used and mapped to multiple LIIDs
at the MDF2/3. Clauses 6 and 7 give further details for specific networks or
services (e.g. minimum supported target identifier formats).
In the event of a request issued over the interface fails, or an error is
reported, the LIPF should raise an alert in the appropriate LI Operations and
Management (O&M) system. Further procedures (e.g. retrying a failed request)
are left to CSP policy to define.
A failure of LI shall not impact the target\'s or other users\' services.
In general, and unless otherwise specified, the function playing the role of
the NE (i.e. IRI-POI, IRI-TF, CC-TF, CC-POI, MDF2 or MDF3) shall:
\- Accept CreateDestination and ModifyDestination messages regardless of the
DeliveryType.
\- Reject ActivateTask/ModifyTask messages that contain destination
identifiers (DIDs) that reference Destinations that have not been created via
a CreateDestination message; Destinations shall be created before they are
used.
\- Reject ActivateTask/ModifyTask messages that do not result in at least one
valid DID for their DeliveryType (e.g. at least one valid DID for an X2
delivery destination for an \"X2Only\" Task). Additional DIDs for Destinations
of other DeliveryTypes (e.g. a DID for an X3 Destination for an \"X2Only\"
Task) shall be accepted, but a ReportTaskIssue message may be sent to indicate
the mismatch.
### 5.2.2 Usage for realising LI_X1
For the purposes of realising LI_X1 between the LIPF and a POI, MDF or TF, the
LIPF plays the role of the ADMF as defined in ETSI TS 103 221-1 [7] reference
model (clause 4.2), and the POI, MDF or TF plays the role of the NE.
In general, and unless otherwise specified, the ADMF shall:
\- When the provisioning of an IRI-POI/IRI-TF/MDF2 is needed to meet the
requirements of the warrant, send an ActivateTask (and subsequent ModifyTask
if/as needed) with the DeliveryType set to \"X2Only\" and the ListOfDIDs
containing at least one DID for an X2 or LI_HI2 delivery destination over
LI_X1 to each of the relevant functions.
\- When the provisioning of a CC-POI/CC-TF/MDF3 is needed to meet the
requirements of the warrant, send an ActivateTask (and subsequent ModifyTask
if/as needed) with the DeliveryType set to \"X3Only\" and the ListOfDIDs
containing at least one DID for X3 or LI_HI3 delivery destination over LI_X1
to each of the relevant functions.
When both the above are required to meet the requirements of the warrant, the
ADMF shall send each independently to each relevant function.
When it is required to cease interception, the ADMF shall send a
DeactivateTask message to each relevant function, unless the Task has already
been removed by other means (e.g. by the use of the
ImplicitDeactivationAllowed flag, see ETSI TS 103 221-1 [7] clause 6.2.1.2).
Other deployments compliant with ETSI TS 103 221-1 [7] may be used subject to
local agreement.
### 5.2.3 Usage for realising LI_X1 (management)
For the purposes of realising LI_X1 between the LIPF and a triggered POI, the
LIPF plays the role of the "ADMF" as defined in ETSI TS 103 221-1 [7]
reference model (clause 4.2), and the triggered POI plays the role of the
"NE".
### 5.2.4 Service scoping
The LIPF shall be able to provision the POI, TFs and the MDF2/MDF3 according
to the service scoping (see clause 4.4) applicable to a warrant as described
in clause 6.2.1.2 and Annex C of ETSI TS 103 221-1 [7].
If there is a need to explicitly identify specific CSP service types to be
intercepted by the task, the LIPF shall include the ListOfServiceTypes
parameter in the TaskDetails of the provisioning message sent to the POIs/TFs.
If no service type is provisioned, the POIs shall generate and deliver
applicable interception product for all services specified for the NF where
the POI is located as described in clause 4.4.2.
If there is a need to explicitly identify specific CSP service types to be
delivered by the task, the LIPF shall populate the ServiceType in the
ServiceScoping parameter in the MediationDetails of the provisioning message
sent to the MDF2/MDF3. If the LIPF includes the ListOfServiceTypes parameter
in the TaskDetails of the provisioning message sent to the MDF2/MDF3, the
MDF2/MDF3 shall ignore this parameter.
### 5.2.5 Usage for realising LI_T2
For the purposes of realising LI_T2 between an IRI-TF and a triggered IRI-POI,
the IRI-TF plays the role of the \"ADMF\" as defined in the ETSI TS 103 221-1
[7] reference model (clause 4.2), and the triggered IRI-POI plays the role of
the \"NE\".
In case the IRI-TF receives from the triggered IRI-POI an error in the answer
to a triggering message, the IRI-TF shall send a ReportTaskIssue message to
the LIPF. In such case, the failure of LI shall not impact the target\'s or
other users\' services.
Unless otherwise specified, an IRI-TF shall set the Product ID field in any
ActivateTask or ModifyTask message issued to a triggered IRI-POI (see ETSI TS
103 221-1 [7] clause 6.2.1.2). The IRI-TF shall set the Product ID to the XID
of the Task object associated with the interception at the IRI-TF in order to
allow correlation of LI product at the MDF2.
Unless otherwise specified, the TF shall include the MDF2 as the X2 delivery
destination in the trigger sent using the ActivateTask/ModifyTask with
\"X2Only\".
When the IRI-TF determines that it is required to remove a Task at a
particular IRI-POI (e.g. having detected the end of a session) it shall send a
DeactivateTask message for the relevant Task to that IRI-POI, unless the Task
has already been removed by other means (e.g. by the use of the
ImplicitDeactivationAllowed flag, see ETSI TS 103 221-1 [7] clause 6.2.12).
When the IRI-TF receives a DeactivateTask message or ModifyTask message from
the LIPF, the IRI-TF shall send DeactivateTask or ModifyTask messages to all
applicable triggered IRI-POIs for all tasks associated to the Task object in
the message from the LIPF.
### 5.2.6 Usage for realising LI_T3
For the purposes of realising LI_T3 between a CC-TF and a triggered CC-POI,
the CC-TF plays the role of the \"ADMF\" as defined in the ETSI TS 103 221-1
[7] reference model (clause 4.2), and the triggered CC-POI plays the role of
the \"NE\".
In case the CC-TF receives from the triggered CC-POI an error in the answer to
a triggering message, the CC-TF shall send a ReportTaskIssue message to the
LIPF. In such case, the failure of LI shall not impact the target\'s or other
users\' services.
Unless otherwise specified, a CC-TF shall set the Product ID field in any
ActivateTask or ModifyTask message issued to a triggered CC-POI (see ETSI TS
103 221-1 [7] clause 6.2.1.2). The CC-TF shall set the Product ID to the XID
of the Task object associated with the interception at the CC-TF in order to
allow correlation of LI product at the MDF3.
Unless otherwise specified, the TF shall include MDF3 as the X3 delivery
destination in the trigger sent using the ActivateTask/ModifyTask with
\"X3Only\".
When the CC-TF determines that it is required to remove a Task at a particular
CC-POI (e.g. having detected the end of a session) it shall send a
DeactivateTask message for the relevant Task to that CC-POI, unless the Task
has already been removed by other means (e.g. by the use of the
ImplicitDeactivationAllowed flag, see ETSI TS 103 221-1 [7] clause 6.2.12).
When the CC-TF receives a DeactivateTask message or ModifyTask message from
the LIPF, the CC-TF shall send DeactivateTask or ModifyTask messages to all
applicable triggered CC-POIs for all tasks associated to the Task object in
the message from the LIPF.
### 5.2.7 Usage for realising LI_XEM1
For the purposes of realising LI_XEM1 between the LIPF and an IEF, the LIPF
plays the role of the ADMF as defined in ETSI TS 103 221-1 [7] reference model
(clause 4.2), and the IEF plays the role of the NE.
The IEF shall be enabled by sending the following ActivateTask message from
the LIPF.
NOTE: The terms identifier and identity are used interchangeably in clause
5.2.7.
Table 5.2.7-1: ActivateTask message for activating an IEF
* * *
ETSI TS 103 221-1 field name Description M/C/O XID Shall be set to a value
assigned by the LIPF. M TargetIdentifiers Shall contain a single Target
Identifier of type \"IdentityAssociation\" (see table 5.2.7-2) M DeliveryType
Set to \"X2Only\". M ListOfDIDs Shall give the DID of the delivery endpoint of
the ICF(s) to which identity association events should be delivered. These
delivery endpoints are configured using the CreateDestination message as
described in ETSI TS 103 221-1 [7] clause 6.3.1 prior to the task activation.
M
* * *
The following Target Identifier Type is defined for the use of LI_XEM1. Unless
otherwise specified, use of any other Target Identifier Type (including adding
a target identifier more than once) shall result in the ActivateTask message
being rejected with the appropriate error.
Table 5.2.7-2: Target Identifier Type for LI_XEM1
* * *
Identifier type Owner ETSI TS 103 221-1 [7] TargetIdentifier type Definition
IdentityAssociationTargetIdentifier 3GPP TargetIdentifierExtension /
IdentityAssociationTargetIdentifier Empty tag (see XSD schema)
* * *
The IEF may be reconfigured to send identity associations to a different ICF
using a ModifyTask message to modify the delivery destinations.
The IEF shall be disabled by sending the following DeactivateTask message from
the LIPF.
Table 5.2.7-3: DeactivateTask message for de-activating an IEF
* * *
ETSI TS 103 221-1 field name Description M/C/O XID Shall be set to the value
assigned by the LIPF M
* * *
The LIPF should send one ActivateTask command to each IEF.
NOTE: The IEF may receive multiple ActivateTask messages conforming to table
5.2.7-1, each of which can be independently deactivated. The IEF shall remain
active as long as at least one valid Task remains active.
## 5.3 Protocols for LI_X2 and LI_X3
### 5.3.1 General usage of ETSI TS 103 221-2
Functions having an LI_X2 or LI_X3 interface shall support the use of ETSI TS
103 221-2 [8] to realise the interface.
In the event of a conflict between ETSI TS 103 221-2 [8] and the present
document, the terms of the present document shall apply.
The xIRI and the xCC sent using ETSI TS 103 221-2 [8] shall contain the
appropriate XID as received in the relevant LI_X1 provisioning message (or
LI_T2/3 triggering message, as appropriate).
### 5.3.2 Usage for realising LI_X2
The POI sending xIRI over the LI_X2 interface shall set the PDU type field
within the xIRI to \"X2 PDU\". (see ETSI TS 103 221-2 [8] clause 5.1).
Where a single xIRI is sent as a result of a network procedure (i.e. as result
of several signaling messages exchanged between the target UE and the
network), the POI sending the xIRI shall set the Payload Direction field (see
ETSI TS 103 221-2 [8] clause 5.2.6) based on the initiator of the network
procedure.
Unless otherwise specified by the relevant clause, the payload shall consist
of a BER-encoded TS33128Payloads.XIRIPayload structure. The payload format
(see ETSI TS 103 221-2 [8] clause 5.4) shall be set according to the relevant
clause of the present document (the value 2 is used for TS
33128Payloads.XIRIPayload).The TLS transport profile (see ETSI TS 103 221-2
[8] clause 6) shall be supported and used by default.
Unless otherwise specified, xIRI shall include the timestamp and sequence
number conditional attribute fields, with the timestamp value set to the time
at which the event occurred.
Unless otherwise specified, the \"Matched Target Identifier\" conditional
attribute shall be set to indicate what target identity was matched to
generate the xIRI (see ETSI TS 103 221-2 [8] clause 5.3.18).
Unless otherwise specified, the \"Other Target Identifier\" conditional
attribute shall be set with all other target identities present at the NF that
contains the POI (see ETSI TS 103 221-2 [8] clause 5.3.19).
Unless otherwise specified, the NFID conditional attribute (see ETSI TS 103
221-2 [8] clause 5.3.7) should be set to indicate the NF that contains the
POI. The NFID is defined as a unique identifier assigned to the NF by the
network (e.g. FQDN) per carrier implementation and referred to in the
following clauses.
Unless otherwise specified, the IPID (see ETSI TS 103 221-2 [8] clause 5.3.8)
should be set to indicate the POI (within the NF) that generated the xIRI for
the conditional attribute field.
### 5.3.3 Usage for realising LI_X3
The POI sending xCC over the LI_X3 interface shall set the PDU type field in
the xCC to \"X3 PDU\" (see ETSI TS 103 221-2 [8] clause 5.1).
The payload format shall be specified according to the relevant clause of the
present document.
Unless otherwise specified, the NFID conditional attribute (see ETSI TS 103
221-2 [8] clause 5.3.7) should be set to indicate the NF that contains the
POI. The NFID is defined as a unique identifier assigned to the NF by the
network (e.g. FQDN) per carrier implementation and referred to in the
following clauses.
Unless otherwise specified, the IPID (see ETSI TS 103 221-2 [8] clause 5.3.8)
should be set to indicate the POI (within the NF) that generated the xCC for
the conditional attribute field.
NOTE: ETSI TS 103 221-2 [8] specifies in clause 6 a default profile which is
mandatory to support, but allows further profiles to be defined. In scenarios
where it may not be possible to achieve the necessary LI data rates based on
the default profile, alternative profiles may be considered (e.g. based on
UDP, multi path TCP or other protocols). Any alternative profile needs to
ensure that LI reliability, security and completeness requirements as
specified in TS 33.126 [3] are met.
### 5.3.4 Service scoping
When applicable, the POIs shall deliver the xIRIs/xCC to MDF2/MDF3 over
LI_X2/LI_X3 according to the service scoping as provisioned by the LIPF to
them (see clause 5.2.4).
## 5.4 Protocols for LI_HI1
### 5.4.1 General
Functions having an LI_HI1 interface shall support the use of ETSI TS 103 120
[6] to realise the interface.
In the event of a conflict between ETSI TS 103 120 [6] and the present
document, the terms of the present document shall apply.
### 5.4.2 Service scoping
Functions having an LI_HI1 interface (i.e. the ADMF) shall be able to receive
the service scoping as applicable to the warrant from the LEA over the LI_HI1
interface (see clause 4.4).
## 5.5 Protocols for LI_HI2 and LI_HI3
### 5.5.1 General
Functions having an LI_HI2 or LI_HI3 interface shall support the use of ETSI
TS 102 232-1 [9] and ETSI TS 102 232-7 [10] to realise the interface.
In the event of a conflict between either specification and the present
document, the terms of the present document shall apply.
### 5.5.2 Usage for realising LI_HI2
The IRI messages sent over LI_HI2 are structured as a header and a payload.
The header contains general information like LIID, timestamp, correlation
information (as for example defined in ETSI TS 102 232-1 [9]). The payload
contains intercept related information based on information that the MDF2 has
received from sources in the network, such as the IRI-POI as described in
clauses 6 and 7 of the present document. Details of the IRI messages can be
found in Annex A of the present document. Messages defined as passing over the
LI_HI2 interface shall be passed as the payload of the threeGPP33128DefinedIRI
field (see TS ETSI 102 232 -7 [10] clause 15).
If the LI_X2 contains the NFID conditional attribute (see ETSI TS 103 221-2
[8] clause 5.3.7), this shall be mapped into the PSHeader
networkFunctionIdentifier (see ETSI TS 102 232-1 [9] clause 5.2.14 and ETSI TS
102 232-7 [10] clause 15.3).
If the LI_X2 contains the IPID conditional attribute (see ETSI TS 103 221-2
[8]), the EIPID parameter (see ETSI TS 102 232-1 [9] clause 5.2.13) shall be
populated by the MDF2 with the IPID value.
### 5.5.3 Usage for realising LI_HI3
The CC sent over LI_HI3 is structured as a header and a payload. The header
contains general information like LIID, timestamp, correlation information (as
for example defined in ETSI TS 102 232-1 [9]). The payload contains content of
communication based on information that the MDF3 has received from sources in
the network, such as the CC-POI as described in clauses 6 and 7 of the present
document. Details of the CC can be found in Annex A of the present document.
CC defined as passing over the LI_HI3 interface shall be passed as the payload
of the threeGPP33128DefinedCC field (see ETSI TS 102 232-7 [10] clause 15).
If the LI_X3 contains the NFID conditional attribute (see ETSI TS 103 221-2
[8] clause 5.3.7), this shall be mapped into the PSHeader
networkFunctionIdentifier (see ETSI Ts 102 232-1 [9] clause 5.2.14 and ETSI TS
102 232-7 [10] clause 15.3).
If the LI_X3 contains the IPID conditional attribute (see ETSI TS 103 221-2
[8]), the EIPID parameter (see ETSI TS 102 232-1 [9] clause 5.2.13) shall be
populated by the MDF3 with the IPID value.
NOTE: ETSI TS 102 232-1 [9] specifies in clause 6.4 a transport layer based on
TCP. However, based on agreement between network operator and LEA, in
scenarios where it may not be possible to achieve the necessary LI data rates
based on the transport layer based on single TCP connection, alternative
profiles may be considered (e.g. based on UDP, multi path TCP or other
protocols). Any alternative profile needs to ensure that LI reliability,
security and completeness requirements as specified in TS 33.126 [3] are met.
### 5.5.4 Service scoping
The MDF2 and MDF3 shall be able to deliver the IRI messages and the CC to the
LEMF over LI_HI2 and LI_HI3 respectively, according to the provisioned service
scoping (see clause 5.2.4).
### 5.5.5 IRI Target Identifiers
The MDF shall populate the TargetIdentifiers field of the IRIPayload defined
in Annex A with all Target Identifiers available at the MDF. For all
Identifiers received in the LI_X2 \"Matched Target Identifier\" conditional
attribute (see clause 5.3.2), the MDF shall include the relevant Identifier
with the provenance set to \"matchedOn\". For all Identifiers received in the
the LI_X2 \"Other Target Identifier\" conditional attribute (see clause
5.3.2), the MDF shall include the relevant Identifier with the provenance set
to \"other\". For all Identifiers present in the xIRI payload, the MDF shall
include the relevant Identifier with the provenance set to \"observed\". For
all Identifiers present in the provisioning message received over X1, the MDF
shall include the relevant Identifier with the provenance set to
\"lEAProvided\". For all Identifiers present in the MDF that are not reported
as other TargetIdentifiers, the MDF shall include the relevant Identifier with
the provenance set to \"other\".
## 5.6 Protocols for LI_HI4
### 5.6.1 General
Functions having an LI_HI4 shall support the use of ETSI TS 102 232-1 [9] to
realise the interface.
In the event of a conflict between ETSI TS 102 232-1 [9] and the present
document, the terms of the present document shall apply.
### 5.6.2 Usage for realising LI_HI4
The LI Notification messages sent over LI_HI4 are structured as a header and a
payload. The header contains general information like LIID, timestamp (as for
example defined in ETSI TS 102 232-1 [9]). The payload contains the
administrative information such as notification. Details of the LI
Notification messages can be found in Annex B of the present document.
Where the LI_HI4 interface is present alongside an LI_HI2 interface or LI_HI3
interface, the LI Notification messages shall be transmitted along the same
connection as the IRI messages or CC. Where ETSI TS 102 232-1 [9] is used for
LI_HI2 or LI_HI3, messages defined as passing over the LI_HI4 interface shall
be passed in the hI4Payload sequence.
The MDF2/MDF3 shall support generation LI Notification messages for at least
the following events:
\- Activation of an interception at the MDF2/MDF3 via LI_X1.
\- Modification of an interception at the MDF2/MDF3 via LI_X1.
\- Deactivation of an interception at the MDF2/MDF3 via LI_X1.
## 5.7 Protocols for LI_HIQR
### 5.7.1 General
Functions having an LI_HIQR interface shall support the use of ETSI TS 103 120
[6] to realise the interface.
In the event of a conflict between ETSI TS 103 120 [6] and the present
document, the terms of the present document shall apply.
NOTE: The terms identifier and identity are used interchangeably in clause
5.7.
### 5.7.2 Usage for realising LI_HIQR
#### 5.7.2.1 Request structure
LI_HIQR requests are represented by issuing a CREATE request for an
LDTaskObject (see ETSI TS 103 120 [6] clause 8.3), populated as follows:
Table 5.7.2-1: LDTaskObject representation of LI_HIQR request
Field Value M/C/O
* * *
Reference Reference to the authorization under which the request is made. The
format of this field, and any procedures for allocating or validating it, are
for national agreement. M DesiredStatus Shall be set to
\"AwaitingDisclosure\". M RequestDetails Set according to table 5.7.2-2 below.
M DeliveryDetails Shall be set to indicate the delivery destination for the
LI_HIQR records (see clause 5.7.2.3 and ETSI TS 103 120 [6] clause 8.3.6.2)
unless the delivery destination is known via other means. C
The use of any other LDTaskObject parameter is outside the scope of the
present document.
Table 5.7.2-2: RequestDetails structure
+---------------+--------------------------------------------+-------+ | Field | Value | M/C/O | +===============+============================================+=======+ | Type | Shall be set to one of the RequestType | M | | | values as defined in table 5.7.2-3. | | +---------------+--------------------------------------------+-------+ | ObservedTime | When the RequestValues provides a | C | | | temporary identity, this field shall be | | | | set to the observation time of that | | | | temporary identity. | | | | | | | | When the RequestValues provides a | | | | permanent identity, this is the time at | | | | which the LEA requires that the permanent | | | | to temporary association is applicable. | | | | | | | | Shall not be present for requests of type | | | | \"OngoingIdentityAssociation\". | | +---------------+--------------------------------------------+-------+ | RequestValues | Set to the target identifier plus | M | | | additional information required (see | | | | clause 5.7.2.2). | | +---------------+--------------------------------------------+-------+
NOTE: If the observed time is in the past, providing a successful query
response is subject to associations still being available in the cache when
the query is made to the ICF.
Table 5.7.2-3: RequestType Dictionary for LI_HIQR
Dictionary Owner Dictionary Name
* * *
3GPP RequestType
Defined DictionaryEntries  
Value Meaning IdentityAssociation A request for a single
IdentityResponseDetails response to the query provided.
OngoingIdentityAssociation A request for an ongoing series of
IdentityResponseDetails responses matching the query provided. May only be
used when the RequestValues contains a permanent identifier. The request shall
be terminated by updating the LDTaskObject DesiredStatus to \"Disclosed\".
Table 5.7.2-3 is formatted in accordance with ETSI TS 103 120 [6] Annex F.
#### 5.7.2.2 Request parameters
The RequestValues field shall contain one of the following:
\- SUPI, given in either SUPIIMSI or SUPINAI formats as defined in ETSI TS 103
120 [6] clause C.2.
\- SUCI, given as defined in table 5.7.2-4 below.
\- 5G-S-TMSI, given as defined in table 5.7.2-4 below.
\- 5G-GUTI, given as defined in table 5.7.2-4 below.
If the RequestType is \"OngoingIdentityAssociation\" (see table 5.7.2-3), SUPI
is the only valid identity type in the RequestValues field. If the RequestType
is \"OngoingIdentityAssociation\" and any other identity type is provided, the
IQF shall signal the error by setting the LDTaskObject Status to \"Invalid\"
(see ETSI TS 103 120 [6] clause 8.3.3).
If a temporary identity is provided, the following shall also be present as
RequestValues:
\- NRCellIdentity, given as defined in table 5.7.2-4 below.
\- TrackingAreaCode, given as defined in table 5.7.2-4 below.
The following RequestValue FormatTypes (see ETSI TS 103 120 [6] clause
8.3.5.4) are defined (which are not otherwise defined elsewhere).
Table 5.7.2-4: RequestValue FormatType extensions for LI_HIQR Requests
+--------------+----------------+----------------+----------------+ | Format Owner | Format Name | Description | Format | +==============+================+================+================+ | 3GPP | SUCI | Subscription | TS 29.509 | | | | Concealed | [45] clause | | | | Identifier as | 6.1.6.3.2 | | | | per TS 23.003 | | | | | [19] clause | | | | | 2.2B. | | +--------------+----------------+----------------+----------------+ | 3GPP | 5GSTMSI | Shortened form | Matches | | | | of the 5G-GUTI | regular | | | | as defined in | expression: | | | | TS 23.003 | | | | | [19] clause | \^(5gstmsi- | | | | 2.11. Given as | ([0-3][0-9A | | | | a | -Fa-f]{2})-(\ | | | | hy | [0-3][0-9A-F | | | | phen-separated | a-f])-([0-9A | | | | concatenation | -Fa-f]{8}))\$ | | | | of: | | | | | | | | | | - The string | | | | | \"5gstmsi\". | | | | | | | | | | - The AMF Set | | | | | ID given as | | | | | three | | | | | hexadecimal | | | | | digits (10 | | | | | bits). | | | | | | | | | | - The AMF | | | | | Pointer given | | | | | as two | | | | | hexadecimal | | | | | digits (6 | | | | | bits). | | | | | | | | | | - The 5G-TMSI | | | | | given as eight | | | | | hexadecimal | | | | | digits (32 | | | | | bits) | | +--------------+----------------+----------------+----------------+ | 3GPP | 5GGUTI | As defined in | Matches | | | | TS 23.003 | regular | | | | [19] clause | expression: | | | | 2.10. Given as | | | | | a hyphen | \ | | | | separated | ^(5gguti-([0- | | | | concatenation | 9]{3})-([0-9 | | | | of: | ]{2,3})-([0- | | | | | 9A-Fa-f]{2})- | | | | - The string | ([0-3][0-9A | | | | \"5gguti\". | -Fa-f]{2})-(\ | | | | | [0-3][0-9A-F | | | | - MCC given | a-f])-([0-9A | | | | as a three | -Fa-f]{8}))\$ | | | | decimal | | | | | digits. | | | | | | | | | | - MNC given | | | | | as a two or | | | | | three digit | | | | | decimal digits | | | | | | | | | | - AMF Region | | | | | ID given as | | | | | two | | | | | hexadecimal | | | | | digits (8 | | | | | bits). | | | | | | | | | | - The AMF Set | | | | | ID, AMF | | | | | Pointer and | | | | | 5G-TMSI as | | | | | defined above | | | | | in 5GSTMSI | | +--------------+----------------+----------------+----------------+ | 3GPP | NRCellIdentity | NR Cell ID | TS 29.571 | | | | (NCI), as | [17] clause | | | | defined in TS | 5.4.2 | | | | 23.003 [19] | | | | | clause 19.6A | | +--------------+----------------+----------------+----------------+ | 3GPP | Tr | Tracking area | TS 29.571 | | | ackingAreaCode | code as | [17] clause | | | | defined in TS | 5.4.2 | | | | 23.003 [19] | | | | | clause | | | | | 19.4.2.3 | | +--------------+----------------+----------------+----------------+
The LDTaskObject may also contain the \"IncludeNCGIInResponse\" LDTask flag
(see table 5.7.2-4A). If this flag is present for such a query, then the
response shall contain the NR Cell Global Identity associated with the SUPI at
the time of association (see table 5.7.2-5).
Table 5.7.2-4A: LDTaskFlags for LI_HIQR Requests
Dictionary Owner Dictionary Name
* * *
3GPP LIHIQRFlags Defined DictionaryEntries  
Value Meaning IncludeNCGIInResponse A request for returning the NCGI in the
response.
#### 5.7.2.3 Response structure
The LI_HIQR request is used to generate a request to the ICF over LI_XQR (see
clause 5.8). The response received over LI_XQR is then transformed into an
LI_HIQR response.
LI_HIQR responses and updates are represented as XML following the
IdentityResponseDetails type definition (see Annex E).
Responses and updates are delivered within a DELIVER Request (see ETSI TS 103
120 [6] clause 6.4.10) containing a DeliveryObject (see ETSI TS 103 120 [6]
clause 10).
IdentityResponseDetails contain IdentityAssociation records. The fields of
each IdentityAssociationRecord shall be set as follows:
Table 5.7.2-5: IdentityAssociationRecord
Field Value M/C/O
* * *
SUPI SUPI associated with the provided identity. M SUCI SUCI associated with
the provided identity, if available. C 5G-GUTI 5G GUTI associated with the
provided identity, provided in the form given in the request (see table
5.7.2-4). M PEI PEI associated with the provided identity during the
association period, if known. C AssociationStartTime The time that the
association between the SUPI and the temporary identity became valid. (see
NOTE). M AssociationEndTime The time that the association between the SUPI and
the temporary identity ceased to be valid. Shall be omitted if the association
is still valid (see NOTE). C FiveGSTAIList List of tracking areas associated
with the registration area within which the UE was or is registered in the
lifetime of the reported association, if available. See clause 7.6.2.4 for
details. C GPSI GPSI associated with the provided identity during the
association period, if known. C NCGI NR Cell Global Identity associated with
the SUPI at the time of association between the SUPI and the temporary
identity. Shall be sent if the \"IncludeNCGIInResponse\" flag is set. C NOTE:
The AssociationStartTime and AssociationEndTime represent the lifespan of the
SUPI to 5G-GUTI association. When a SUCI is present, the AssociationStartTime
also represents the time of the SUCI\'s validity.
If no association is found which matches the criteria provided in the LI_XQR
request, then the LI_XQR response contains zero IdentityAssociationRecords.
Similarly, the LI_HIQR response contains zero IdentityAssociationRecords.
For responses or updates providing a currently valid SUPI to 5G-GUTI identity
association, the AssociationEndTime shall be absent. The AssociationStartTime
shall indicate when the 5G-GUTI became associated with the SUPI. The SUCI
field shall be populated if it was present in the IEF record for the
association (see clause 6.2.2A.2.1). The PEI and TAI List fields may be
populated as well, see clause 7.6.2.4 for details.
In the case of ongoing updates, the presence of the AssociationEndTime
indicates the SUPI to 5G-GUTI identity disassociation. Such updates shall only
happen when no new association is replacing the outgoing one.
The DeliveryObject Reference field (see ETSI TS 103 120 [6] clause 10.2.1)
shall be set to the Reference of the LDTaskObject used in the request, to
provide correlation between request and response. The DeliveryID,
SequenceNumber and LastSequence fields shall be set according to ETSI TS 103
120 [6] clause 10.2.1.
The content manifest (see ETSI TS 103 120 [6] clause 10.2.2) shall be set to
indicate the present document, using the following Specification Dictionary
extension.
Table 5.7.2-6: Specification Dictionary
Dictionary Owner Dictionary Name
* * *
3GPP ManifestSpecification.
Defined DictionaryEntries  
Value Meaning LIHIQRResponse The delivery contains IdentityResponseDetails
(see Annex E)
## 5.8 Protocols for LI_XQR
### 5.8.1 General
LI_XQR requests are realised using ETSI TS 103 221-1 [7] to transport the
IdentityAssociationRequest and IdentityAssociationResponse messages (which are
derived from the X1RequestMessage and X1ResponseMessage definitions in ETSI TS
103 221-1 [7]) as described in Annex E.
NOTE: The terms identifier and identity are used interchangeably in clause
5.8.
### 5.8.2 Identity association requests
For requests with RequestType \"IdentityAssociation\" (see table 5.7.2-3), the
IQF issues an IdentityAssociationRequest message populated with a
RequestDetails structure as follows:
Table 5.8-1: RequestDetails structure for LI_XQR
ETSI TS 103 221-1 [7] field name Description M/C/O
* * *
Type Shall be set to the RequestType value \"IdentityAssociation\" as defined
in Table 5.7.2-3. M ObservedTime Observation time as provided over LI_HIQR
(see clause 5.7.2). M RequestValues Set to the target identifier plus
additional information specified in the LI_HIQR request (see clause 5.7.2). M
Successful LI_XQR responses are returned using the IdentityAssociationResponse
message. Error conditions are reported using the normal error reporting
mechanisms described in TS 103 221-1 [7].
LI_XQR query responses are represented in XML following the
IdentityAssociationResponse schema (see Annex E). The fields of the
IdentityAssociationResponse record shall be populated as described in Table
5.7.2-5.
### 5.8.3 Ongoing identity association requests
For requests with RequestType \"OngoingIdentityAssociation\", the IQF shall
activate a request for ongoing updates at the ICF by sending it an
ActivateOngoingIdentityAssociationUpdates message populated as follows:
Table 5.8-2: ActivateAssociationUpdates message for LI_XQR
* * *
Field name Description M/C/O OngoingAssociationTaskID Unique identifier for
this request allocated by the IQF. M SUPI Permanent identifier for which
ongoing identity association updates shall be issued. M
* * *
The ICF shall acknowledge the receipt of the ActivateAssociationUpdates
message by responding with an ActivateAssociationUpdatesAcknowledgement
response (see Annex E) containing an IdentityAssociationRecord representing
the association active at the time the ICF receives the
ActivateAssociationUpdates message. If no such active association exists, the
ActivateAssociationUpdatesAcknowledgement response shall not contain an
IdentityAssociationRecord. Error conditions are reported using the normal
error reporting mechanisms described in ETSI TS 103 221-1 [7].
When a request with RequestType \"OngoingIdentityAssociation\" is terminated
over LI_HIQR (see table 5.7.2-3), the IQF shall issue a
DeactivateAssociationUpdates message (see Annex E) with the appropriate
OngoingAssociationTaskID populated. On termination of the request, the ICF
shall respond with a DeactivateAssociationUpdatesAcknowledgement message.
While a request with RequestType \"OngoingIdentityAssociation\" is active, the
ICF shall generate an IdentityAssociationUpdate message every time the ICF
receives an IEFAssociationRecord or IEFDeassociationRecord over LI_IEF for the
relevant identifier. The message shall contain an IdentityAssociationRecord as
described in table 5.7.2-5, and the relevant OngoingAssociationTaskID. The
IdentityAssociationUpdate message is sent to the IQF over LI_XQR with the ICF
becoming the \"requester\" as defined in ETSI TS 103 221-1 [7] clause 4.2. The
IQF shall respond with an IdentityAssociationUpdateAcknowledgement message.
## 5.9 Protocols for LI_XER
LI_XER records are realised using a TLS connection as defined in clause
6.2.2A.2.3, with records BER-encoded as defined in Annex F.
## 5.10 Protocols for LI_ST interface
### 5.10.1 Overview
LI_ST shall be realised using a dedicated separate instance of the
Nudsf_DataRepository service as defined in TS 29.598 [64] subject to the
following terms.
The LISSF shall adopt the role of the NF Service Provider as described in TS
29.598 [64] clause 5.2.1. The LISSF may be realised as a standalone function
or within the ADMF. In either case it shall meet the requirements set out in
TS 33.127 [5] clause 6.2.3.8.
An LI function may only store state over LI_ST using an LISSF identified by
the LIPF via LI_X0. The LIPF shall provide the necessary details for
connection, including the relevant apiRoot, apiVersion, realmId and storageId
values (see TS 29.598 [64] clause 6.1.3.1) and any necessary keys for
authentication.
### 5.10.2 Storage
When an LI function wishes to store LI state in the LISSF, it shall perform
the Record Create service operation as described in TS 29.598 [64] clause
5.2.2.3.1. Unless otherwise specified, the recordId shall be a randomly-
assigned UUID. The record metadata shall include at least the following
information as tag value pairs (see TS 29.598 [64] clause 6.1.6.2.3)
Table 5.10.2-1: Minimum information elements for RecordMeta structure
* * *
Field Name Description M/C/O NFInstanceID The NF instance ID associated with
the NF in which the LI function is located, if applicable (see TS 29.571 [17]
clause 5.3.2). C NEID The LI_X1 identifier associated with the LI function. M
XID XID for the task that the state is associated with, if applicable. C DID
DID for the destination that the state is associated with, if applicable. C
* * *
Further details on the contents of the Record Blocks is given in the relevant
clauses.
The LIPF shall always be able to store records in the LISSF.
### 5.10.3 Retrieval
When an LI function wishes to retrieve records from the LISSF and knows the
RecordID of the relevant state information, it shall perform a Record
Retrieval operation as described in TS 29.598 [64] clause 5.2.2.2.2. If the LI
function does not know the RecordID, it shall perform a search as described in
TS 29.598 [64] clause 5.2.2.2.6 using appropriate search criteria. The details
for choosing search criteria are specific to each LI function and are
therefore given in later clauses specific to that LI function.
The LIPF shall always be able to retrieve records from the LISSF.
### 5.10.4 Removal
When an LI function wishes to remove records from the LISSF, it shall perform
a Record Delete service operation as described in TS 29.598 [64] clause
5.2.2.5.
The LIPF shall always be able to remove records from the LISSF.
# 6 Network Layer Based Interception
## 6.1 Introduction
This clause describes any remaining fields, behaviours or details necessary to
implement the required LI interfaces for specific 3GPP-defined network
deployments which are not described in clauses 4 and 5.
## 6.2 5G
### 6.2.1 General
This clause describes the LI interfaces specific to LI for 5G networks.
### 6.2.2 LI at AMF
#### 6.2.2.1 Provisioning over LI_X1
The IRI-POI present in the AMF is provisioned over LI_X1 by the LIPF using the
X1 protocol as described in clause 5.2.2.
The POI in the AMF shall support the following target identifier formats in
the ETSI TS 103 221-1 [7] messages (or equivalent if ETSI TS 103 221-1 [7] is
not used):
\- SUPIIMSI.
\- SUPINAI.
\- PEIIMEI.
\- PEIIMEISV.
\- GPSIMSISDN.
\- GPSINAI.
Table 6.2.2-0A shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the IRI-POI in the AMF.
Table 6.2.2-0A: ActivateTask message for the IRI-POI in the AMF
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. | M | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One of the target | M | | | identifiers listed in the | | | | paragraph above. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to \"X2Only\". | M | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints for | M | | | LI_X2 for the IRI-POI in | | | | the AMF. These delivery | | | | endpoints are configured | | | | using the CreateDestination | | | | message as described in | | | | ETSI TS 103 221-1 [7] | | | | clause 6.3.1 prior to the | | | | task activation. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | This field shall be | C | | | included if the IRI POI is | | | Iden | required to generate | | | tifierAssociationExtensions | AMFIdentifierAssociation | | | | records (see clause | | | | 6.2.2.2.1). If the field is | | | | absent, | | | | AMFIdentifierAssociation | | | | records shall not be | | | | generated. | | +-----------------------------+-----------------------------+-------+ | ListOfServiceTypes | Shall be included when the | C | | | explicit identification of | | | | specific CSP service types | | | | to be intercepted by the | | | | task as described in clause | | | | 5.2.4 is required. This | | | | parameter is defined in | | | | ETSI TS 103 221-1 [7], | | | | clause 6.2.1.2, table 4. | | +-----------------------------+-----------------------------+-------+
Table 6.2.2-0B: IdentifierAssociationExtensions Parameters
+-----------------+------------------------------------------+-------+ | Field Name | Description | M/C/O | +-----------------+------------------------------------------+-------+ | EventsGenerated | One of the following values: | M | | | | | | | - IdentifierAssociation | | | | | | | | - All | | | | | | | | See clause 6.2.2.2.1 for the | | | | interpretation of this field. | | +-----------------+------------------------------------------+-------+
#### 6.2.2.2 Generation of xIRI over LI_X2
##### 6.2.2.2.1 General
The IRI-POI present in the AMF shall send the xIRIs over LI_X2 for each of the
events listed in TS 33.127 [5] clause 6.2.2.4, the details of which are
described in the following clauses.
If the AMF receives one or more cell IDs in an N2 message (as specified in TS
38.413 [23]), the IRI-POI in the AMF shall report all of them.
The IRI-POI in the AMF shall only generate xIRI containing
AMFIdentifierAssociation records when the IdentifierAssocationExtensions
parameter has been received over LI_X1 (see clause 6.2.2.1). The IRI-POI in
the AMF shall generate records according to the value of the EventsGenerated
sub-parameter (see table 6.2.2-0B) as follows:
\- IdentifierAssociation: AMFIdentifierAssociation and AMFLocationUpdate
records shall be generated. No other record types shall be generated for that
target.
\- All: All AMF record types shall be generated.
##### 6.2.2.2.2 Registration
The IRI-POI in the AMF shall generate an xIRI containing an AMFRegistration
record when the IRI-POI present in the AMF detects that a UE matching one of
the target identifiers provided via LI_X1 has successfully registered to the
5GS via 3GPP NG-RAN or non-3GPP access. Accordingly, the IRI-POI in the AMF
generates the xIRI when the following event is detected:
\- AMF sends a N1: REGISTRATION ACCEPT message to the target UE and the UE 5G
Mobility Management (5GMM) state for the access type (3GPP NG-RAN or non-3GPP
access) within the AMF is changed to 5GMM-REGISTERED.
Table 6.2.2-1: Payload for AMFRegistration record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | registrationType | Specifies the type of | M | | | registration, see TS 24.501 | | | | [13] clause 9.11.3.7. | | | | This is derived from the | | | | information received from | | | | the UE in the REGISTRATION | | | | REQUEST message. | | +-----------------------------+-----------------------------+-------+ | registrationResult | Specifies the result of | M | | | registration, see TS 24.501 | | | | [13] clause 9.11.3.6. | | +-----------------------------+-----------------------------+-------+ | slice | Provide, if available, one | C | | | or more of the following: | | | | | | | | - allowed NSSAI (see TS | | | | 24.501 [13] clause | | | | 9.11.3.37). | | | | | | | | - configured NSSAI (see TS | | | | 24.501 [13] clause | | | | 9.11.3.37). | | | | | | | | - rejected NSSAI (see TS | | | | 24.501 [13] clause | | | | 9.11.3.46). | | | | | | | | This is derived from the | | | | information sent to the UE | | | | in the REGISTRATION ACCEPT | | | | message. | | +-----------------------------+-----------------------------+-------+ | sUPI | SUPI associated with the | M | | | registration (see clause | | | | 6.2.2.4). | | +-----------------------------+-----------------------------+-------+ | sUCI | SUCI used in the | C | | | registration, if available. | | +-----------------------------+-----------------------------+-------+ | pEI | PEI provided by the UE | C | | | during the registration, if | | | | available. | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI obtained in the | C | | | registration, if available | | | | as part of the subscription | | | | profile. | | +-----------------------------+-----------------------------+-------+ | gUTI | 5G-GUTI provided as outcome | M | | | of initial registration or | | | | used in other cases, see TS | | | | 24.501 [13] clause | | | | 5.5.1.2.2. | | +-----------------------------+-----------------------------+-------+ | location | Location information | C | | | determined by the network | | | | during the registration, if | | | | available. | | | | | | | | Encoded as a _userLocation_ | | | | parameter | | | | (_location >l | | | | ocationInfo>userLocation_) | | | | and, when Dual Connectivity | | | | is activated, as an | | | | _additionalCellIDs_ | | | | parameter | | | | (_location >locatio | | | | nInfo>additionalCellIDs_), | | | | see Annex A. | | +-----------------------------+-----------------------------+-------+ | non3GPPAccessEndpoint | UE\'s local IP address used | C | | | to reach the N3IWF, TNGF or | | | | TWIF, if available. IP | | | | addresses are given as 4 | | | | octets (for IPv4) or 16 | | | | octets (for IPv6) with the | | | | most significant octet | | | | first (network byte order). | | +-----------------------------+-----------------------------+-------+ | fiveGSTAIList | List of tracking areas | C | | | associated with the | | | | registration area within | | | | which the UE is current | | | | registered, see TS 24.501 | | | | [13] clause 9.11.3.9 (see | | | | NOTE) | | +-----------------------------+-----------------------------+-------+ | sMSoverNASIndicator | Indicates whether SMS over | C | | | NAS is supported. Provide, | | | | if included in | | | | registrationResult, see TS | | | | 24.501 [13] clause | | | | 9.11.3.6. | | +-----------------------------+-----------------------------+-------+ | oldGUTI | GUTI or 5G-GUTI, if | C | | | provided in the | | | | REGISTRATION REQUEST | | | | message, see TS 24.501 | | | | [13] clause 5.5.1.2.2. | | +-----------------------------+-----------------------------+-------+ | eMM5GRegStatus | UE Status, if provided in | C | | | the REGISTRATION REQUEST | | | | message, see TS 24.501 | | | | [13] clause 9.11.3.56. | | +-----------------------------+-----------------------------+-------+ | nonIMEISVPEI | MACAddress or EUI-64 used | C | | | as UE equipment identity if | | | | IMEI or IMEISV based PEI is | | | | not available. Provide if | | | | known, see TS 24.501 [13] | | | | clause 8.2.26.4. | | +-----------------------------+-----------------------------+-------+ | mACRestIndicator | Indicates whether the | C | | | non-IMEISV PEI MACAddress | | | | can be used as an equipment | | | | identifier. Required if | | | | non-IMEISVPEI is used, see | | | | TS 24.501 [13] clause | | | | 9.11.3.4. | | +-----------------------------+-----------------------------+-------+ | pagingRestrictionIndicator | Indicates if paging is | C | | | restricted or the type of | | | | paging allowed, Include if | | | | sent in the REGISTRATION | | | | REQUEST message. Encoded | | | | per TS 24.501 [13] clause | | | | 9.11.3.77.2, omitting the | | | | first two octets. | | +-----------------------------+-----------------------------+-------+ | rATType | RAT Type shall be present | C | | | if known by the AMF. RAT | | | | Type is determined by the | | | | AMF during registration. | | | | See TS 23.501 [2] clause | | | | 5.3.2.3 | | +-----------------------------+-----------------------------+-------+ | NOTE: List shall be | | | | included each time there is | | | | a change to the | | | | registration area. | | | +-----------------------------+-----------------------------+-------+
##### 6.2.2.2.3 Deregistration
The IRI-POI in the AMF shall generate an xIRI containing an AMFDeregistration
record when the IRI-POI present in the AMF detects that a UE matching one of
the target identifiers provided via LI_X1 has deregistered from the 5GS over
at least one access type. Accordingly, the IRI-POI in AMF generates the xIRI
when any of the following events is detected:
> \- For network initiated de-registration, when the AMF receives the N1:
> DEREGISTRATION ACCEPT message from the target UE or when implicit
> deregistration timer expires; and in both cases the UE 5GMN state for the
> access type (3GPP NG-RAN or non-3GPP access) within the AMF is changed to
> 5GMM-DEREGISTERED.
>
> \- For UE initiated de-registration, when the AMF sends the N1:
> DEREGISTRATION ACCEPT message to the target UE or when the AMF receives the
> N1: DEREGISTRATION REQUEST message from the target UE with deregistration
> type value of "switch off"; and in both cases the UE 5GMN state for the
> access type (3GPP NG-RAN or non-3GPP access) within the AMF is changed to
> 5GMM-DEREGISTERED.
>
> \- For network initiated AMF UE relocation, the AMFDeregistration xIRI shall
> not be sent unless the 5GMM COMMON PROCEDURE INITIATED (see TS 24.501 [13]
> clause 5.1.3.2.3.3) results in deregistration.
Table 6.2.2-2: Payload for AMFDeregistration record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | deregistrationDirection | Indicates whether the | M | | | deregistration was | | | | initiated by the network or | | | | by the UE. | | +-----------------------------+-----------------------------+-------+ | accessType | Indicates the access for | M | | | which the deregistration is | | | | handled, see TS 24.501 | | | | [13] clause 9.11.3.20. | | +-----------------------------+-----------------------------+-------+ | sUPI | SUPI associated with the | C | | | deregistration (see clause | | | | 6.2.2.4), if available. | | +-----------------------------+-----------------------------+-------+ | sUCI | SUCI used in the | C | | | deregistration, if | | | | available (see NOTE). | | +-----------------------------+-----------------------------+-------+ | pEI | PEI used in the | C | | | deregistration, if | | | | available (see NOTE). | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI associated to the | C | | | deregistration, if | | | | available as part of the | | | | subscription profile. | | +-----------------------------+-----------------------------+-------+ | gUTI | 5G-GUTI used in the | C | | | deregistration, if | | | | available, see TS 24.501 | | | | [13] clause 5.5.2.2.1 | | | | (see NOTE). | | +-----------------------------+-----------------------------+-------+ | cause | Indicates the 5GMM cause | C | | | value for network-initiated | | | | deregistration, see TS | | | | 24.501 [13] clause | | | | 9.11.3.2. | | +-----------------------------+-----------------------------+-------+ | location | Location information | C | | | determined by the network | | | | during the deregistration, | | | | if available. | | | | | | | | Encoded as a _userLocation_ | | | | parameter | | | | (_location >lo | | | | cationInfo>userLocation_), | | | | see Annex A. | | +-----------------------------+-----------------------------+-------+ | switchOffIndicator | Indicates whether the | C | | | deregistration type is | | | | normal or switch off, if | | | | available, see TS 24.501 | | | | [13] clause 9.1.3.20.1. | | +-----------------------------+-----------------------------+-------+ | reRegRequiredIndicator | Indicates whether UE | C | | | re-registration is required | | | | in the DEREGISTRATION | | | | REQUEST message, if | | | | available, see TS 24.501 | | | | [13] clause 9.1.3.20.1. | | +-----------------------------+-----------------------------+-------+ | NOTE: At least one among | | | | SUCI, PEI and GUTI shall be | | | | provided. | | | +-----------------------------+-----------------------------+-------+
##### 6.2.2.2.4 Location update
The IRI-POI in the AMF shall generate an xIRI containing an AMFLocationUpdate
record each time the IRI-POI present in an AMF detects that the target's UE
location is updated due to target UE mobility or as a part of an AMF service
procedure and the reporting of location information is not restricted by
service scoping. The generation of such separate xIRI is not required if the
updated UE location information is obtained as a part of a procedure producing
some other xIRIs (e.g. mobility registration). In that case the location
information is included into the respective xIRI.
The UE mobility events resulting in generation of an AMFLocationUpdate xIRI
include the _N2 Path Switch Request_ (_Xn based inter NG-RAN handover_
procedure described in TS 23.502 [4] clause 4.9.1.2) and the _N2 Handover
Notify_ (_Inter NG-RAN node N2 based handover_ procedure described in TS
23.502 [4] clause 4.9.1.3).
The AMFLocationUpdate xIRI is also generated when the AMF receives an NG-RAN
NGAP _PDU Session Resource Modify Indication_ message as a result of Dual
Connectivity activation/release for the target UE, as described in TS 37.340
[37] clause 10.
Optionally, based on operator policy, other NG-RAN NGAP messages that do not
generate separate xIRI but carry location information (e.g. RRC INACTIVE
TRANSITION REPORT) may trigger the generation of an xIRI AMFLocationUpdate
record.
Additionally, based on regulatory requirements and operator policy, the
location information obtained by AMF from NG-RAN or LMF in the course of some
service operation (e.g. emergency services, LCS) may generate xIRI
AMFLocationUpdate record. The AMF services providing the location information
in these cases include the AMF Location Service (ProvideLocInfo,
ProvidePosInfo, NotifiedPosInfo and EventNotify service operations) and the
AMF Exposure Service (AmfEventReport with LOCATION_REPORT) (see TS 29.518
[22]). Additionally, the AMF Communication Service
(Namf_Communication_N1MessageNotify service operation) may be monitored to
capture the location information in the scenarios described in TS 23.273 [42]
clause 6.3.1. Also, in the case of Mobile Originated LCS service invoked by
the target, the location information may be derived from a
Nlmf_Location_DetermineLocation Response to AMF (see TS 23.273 [42] clause
6.2).
Table 6.2.2-3: Payload for AMFLocationUpdate record
+---------------------+--------------------------------------+-------+ | Field name | Description | M/C/O | +---------------------+--------------------------------------+-------+ | sUPI | SUPI associated with the location | M | | | update (see clause 6.2.2.4). | | +---------------------+--------------------------------------+-------+ | sUCI | SUCI associated with the location | C | | | update, if available, see TS 24.501 | | | | [13]. | | +---------------------+--------------------------------------+-------+ | pEI | PEI associated with the location | C | | | update, if available. | | +---------------------+--------------------------------------+-------+ | gPSI | GPSI associated with the location | C | | | update, if available as part of the | | | | subscription profile. | | +---------------------+--------------------------------------+-------+ | gUTI | 5G-GUTI associated with the location | C | | | update, if available, see TS 24.501 | | | | [13]. | | +---------------------+--------------------------------------+-------+ | location | Updated location information | M | | | determined by the network. | | | | | | | | Depending on the service or message | | | | type from which the location | | | | information is extracted, it may be | | | | encoded in several forms (Annex A): | | | | | | | | 1) as a _userLocation_ parameter | | | | (_lo | | | | cation >locationInfo>userLocation_) | | | | in the case the information is | | | | obtained from an NGAP message, | | | | except the LOCATION REPORT message | | | | (see TS 38.413 [23]); | | | | | | | | 2) as a _locationInfo_ parameter | | | | (_location >locationInfo_) in the | | | | case the information is obtained | | | | from a **ProvideLocInfo** (TS 29.518 | | | | [22] clause 6.4.6.2.6); | | | | | | | | 3) as a _locationPresenceReport_ | | | | parameter | | | | (_location >locationPresenceReport_) | | | | in the case the information is | | | | obtained from an **AmfEventReport** | | | | (TS 29.518 [22] clause 6.2.6.2.5) | | | | with event type **Location-Report** | | | | or **Presence-In-AOI-Report;** | | | | | | | | 4) as a _positionInfo_ parameter | | | | (_locat | | | | ion >positioningInfo>positionInfo_) | | | | in the case the information is | | | | obtained from a **ProvidePosInfo** | | | | (TS 29.518 [22] clause 6.4.6.2.3) | | | | or a **NotifiedPosInfo** (TS 29.518 | | | | [22] clause 6.4.6.2.4). | | +---------------------+--------------------------------------+-------+ | sMSoverNASIndicator | No longer used in present version of | C | | | this specification. | | +---------------------+--------------------------------------+-------+ | oldGUTI | No longer used in the present | C | | | version of the specification. | | +---------------------+--------------------------------------+-------+
##### 6.2.2.2.5 Start of interception with registered UE
The IRI-POI in the AMF shall generate an xIRI containing an
AMFStartOfInterceptionWithRegisteredUE record when the IRI-POI present in the
AMF detects that interception is activated on a UE that has already been
registered in the 5GS (see clause 6.2.2.4 on identity privacy). A UE is
considered already registered to the 5GS when the 5GMM state for the access
type (3GPP NG-RAN or non-3GPP access) for that UE is 5GMM-REGISTERED.
Therefore, the IRI-POI present in the AMF shall generate the xIRI
AMFStartOfInterceptionWithRegisteredUE record when it detects that a new
interception for a UE is activated (i.e. provisioned by the LIPF) and the 5G
mobility management state for the access type (3GPP NG-RAN or non-3GPP access)
within the AMF for that UE is 5GMM-REGISTERED. If the UE is registered over
both 3GPP NG-RAN and non-3GPP access, the IRI-POI present in the AMF shall
generate an xIRI containing an AMFStartOfInterceptionWithRegisteredUE record
for each access type.
Table 6.2.2-4: Payload for AMFStartOfInterceptionWithRegisteredUE record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | registrationResult | Specifies the result of | M | | | registration, see TS 24.501 | | | | [13] clause 9.11.3.6. | | +-----------------------------+-----------------------------+-------+ | registrationType | Specifies the type of | C | | | registration, see TS 24.501 | | | | [13] clause 9.11.3.7, if | | | | available. | | +-----------------------------+-----------------------------+-------+ | slice | Provide, if available, one | C | | | or more of the following: | | | | | | | | - allowed NSSAI (see TS | | | | 24.501 [13] clause | | | | 9.11.3.37). | | | | | | | | - configured NSSAI (see TS | | | | 24.501 [13] clause | | | | 9.11.3.37). | | +-----------------------------+-----------------------------+-------+ | sUPI | SUPI associated with the | M | | | target UE. | | +-----------------------------+-----------------------------+-------+ | sUCI | SUCI used in the | C | | | registration, if available. | | +-----------------------------+-----------------------------+-------+ | pEI | PEI associated with the | C | | | target UE, if available. | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI associated with the | C | | | target UE, if available. | | +-----------------------------+-----------------------------+-------+ | gUTI | Latest 5G-GUTI assigned to | M | | | the target UE by the AMF. | | +-----------------------------+-----------------------------+-------+ | location | Location information | C | | | associated with the access | | | | type for the target UE, if | | | | available. | | | | | | | | Encoded as a _userLocation_ | | | | parameter | | | | (_location >l | | | | ocationInfo>userLocation_) | | | | and, when Dual Connectivity | | | | is activated, as an | | | | _additionalCellIDs_ | | | | parameter | | | | (_location >locatio | | | | nInfo>additionalCellIDs)_, | | | | see Annex A. | | +-----------------------------+-----------------------------+-------+ | non3GPPAccessEndpoint | UE\'s local IP address used | C | | | to reach the N3IWF, TNGF or | | | | TWIF, if available. IP | | | | addresses are given as 4 | | | | octets (for IPv4) or 16 | | | | octets (for IPv6) with the | | | | most significant octet | | | | first (network byte order). | | +-----------------------------+-----------------------------+-------+ | timeOfRegistration | Time at which the last | C | | | registration occurred, if | | | | available. This is the time | | | | stamp when the REGISTRATION | | | | ACCEPT message was sent to | | | | the UE or (when applicable) | | | | when the REGISTRATION | | | | COMPLETE was received from | | | | the UE. | | | | | | | | Shall be given qualified | | | | with time zone information | | | | (i.e. as UTC or offset from | | | | UTC, not as local time). | | +-----------------------------+-----------------------------+-------+ | fiveGSTAIList | List of tracking areas | C | | | associated with the target | | | | UE for the access type. | | +-----------------------------+-----------------------------+-------+ | sMSoverNASIndicator | Indicates whether SMS over | C | | | NAS is supported. Provide, | | | | if included in the UE | | | | Context. | | +-----------------------------+-----------------------------+-------+ | oldGUTI | Latest GUTI or 5G-GUTI | C | | | received from the target UE | | | | if different than the | | | | latest GUTI assigned by the | | | | AMF and the target UE has | | | | not acknowledged the latest | | | | GUTI assignment. | | +-----------------------------+-----------------------------+-------+ | eMM5GRegStatus | UE Status, if this | C | | | parameter can be derived | | | | from information available | | | | in the UE Context at the | | | | AMF. | | +-----------------------------+-----------------------------+-------+ | NOTE: The values of the | | | | parameters in the table | | | | above are derived from the | | | | UE Context at the AMF, see | | | | TS 23.502 clause 5.2.2.2.2. | | | +-----------------------------+-----------------------------+-------+
The IRI-POI present in the AMF generating an xIRI containing an
AMFStartOfInterceptionWithRegisteredUE record shall set the Payload Direction
field in the PDU header to _not applicable_ (Direction Value 5, see ETSI TS
103 221-2 [8] clause 5.2.6).
##### 6.2.2.2.6 AMF unsuccessful procedure
The IRI-POI in the AMF shall generate an xIRI containing an
AMFUnsuccessfulProcedure record when the IRI-POI present in the AMF detects an
unsuccessful procedure for a UE matching one of the target identifiers
provided via LI_X1.
Accordingly, the IRI-POI in the AMF generates the xIRI when any of the
following events is detected:
\- AMF sends a N1: REGISTRATION REJECT message to the target UE and the UE 5G
Mobility Management (5GMM) state for the access type (3GPP NG-RAN or non-3GPP
access) within the AMF is changed to 5GMM-DEREGISTERED.
\- AMF aborts a registration procedure before the UE 5G Mobility Management
(5GMM) state for the access type (3GPP NG-RAN or non-3GPP access) within the
AMF is changed to 5GMM-REGISTERED.
\- AMF sends a SERVICE REJECT message to the target UE including a PDU session
establishment reject message type.
\- AMF aborts a UE-initiated NAS transport procedure with payload container
type IE set to \"SMS\".
Unsuccessful registration shall be reported only if the target UE has been
successfully authenticated.
Table 6.2.2-5: Payload for AMFUnsuccessfulProcedure record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +=============================+=============================+=======+ | failedprocedureType | Specifies the procedure | M | | | which failed at the AMF. | | +-----------------------------+-----------------------------+-------+ | failureCause | Provides the value of the | M | | | 5GSM or 5GMM cause, see TS | | | | 24.501 [13] clauses | | | | 9.11.3.2 and 9.11.4.2. | | +-----------------------------+-----------------------------+-------+ | requestedSlice | Slice requested for the | C | | | procedure, if available, | | | | given as a NSSAI (a list of | | | | S-NSSAI values as described | | | | in TS 24.501 [13] clause | | | | 9.11.3.37). | | +-----------------------------+-----------------------------+-------+ | sUPI | SUPI associated with the | C | | | procedure, if available | | | | (see NOTE). | | +-----------------------------+-----------------------------+-------+ | sUCI | SUCI used in the procedure, | C | | | if applicable and if | | | | available (see NOTE). | | +-----------------------------+-----------------------------+-------+ | pEI | PEI used in the procedure, | C | | | if available (see NOTE). | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI used in the procedure, | C | | | if available (see NOTE). | | +-----------------------------+-----------------------------+-------+ | gUTI | 5G-GUTI used in the | C | | | procedure, if available, | | | | see TS 24.501 [13] clause | | | | 9.11.3.4 (see NOTE). | | +-----------------------------+-----------------------------+-------+ | location | Location information | C | | | determined during the | | | | procedure, if available. | | | | | | | | Encoded as a _userLocation_ | | | | parameter | | | | (_location >lo | | | | cationInfo>userLocation_), | | | | see Annex A. | | +-----------------------------+-----------------------------+-------+ | NOTE: At least one identity | | | | shall be provided, the | | | | others shall be provided if | | | | available. | | | +-----------------------------+-----------------------------+-------+
##### 6.2.2.2.7 AMF identifier association
The IRI-POI present in the AMF shall generate an xIRI containing an
AMFIdentifierAssociation record when the IRI-POI present in the AMF detects a
new identifier association for a UE matching one of the target identifiers
provided via LI_X1. Generation of this record is subject to this record type
being enabled for a specific target (see clause 6.2.2.2.1).
Table 6.2.2-6: Payload for AMFIdentifierAssociation record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +=============================+=============================+=======+ | sUPI | SUPI associated with the | M | | | procedure (see NOTE 1). | | +-----------------------------+-----------------------------+-------+ | sUCI | SUCI used in the procedure, | C | | | if applicable and if | | | | available. | | +-----------------------------+-----------------------------+-------+ | pEI | PEI used in the procedure, | C | | | if available (see NOTE 1). | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI used in the procedure, | C | | | if available (see NOTE 1). | | +-----------------------------+-----------------------------+-------+ | gUTI | 5G-GUTI used in the | M | | | procedure, see TS 24.501 | | | | [13] clause 9.11.3.4. | | +-----------------------------+-----------------------------+-------+ | location | Location information | M | | | available when identifier | | | | association occurs. | | | | | | | | Encoded as a _userLocation_ | | | | parameter | | | | (_location >l | | | | ocationInfo>userLocation_) | | | | and, when Dual Connectivity | | | | is activated, as an | | | | _additionalCellIDs_ | | | | parameter | | | | (_location >locatio | | | | nInfo>additionalCellIDs_), | | | | see Annex A. | | +-----------------------------+-----------------------------+-------+ | fiveGSTAIList | List of tracking areas | C | | | associated with the | | | | registration area within | | | | which the UE is current | | | | registered, see TS 24.501 | | | | [13], clause 9.11.3.9. | | | | (see NOTE 2) | | +-----------------------------+-----------------------------+-------+ | NOTE 1: SUPI shall always | | | | be provided, in addition to | | | | the warrant target | | | | identifier if different to | | | | SUPI. Other identifiers | | | | shall be provided if | | | | available. | | | | | | | | NOTE 2: List shall be | | | | included each time there is | | | | a change to the | | | | registration area. | | | +-----------------------------+-----------------------------+-------+
The IRI-POI present in the AMF generating an xIRI containing an
AMFIdentifierAssociation record shall set the Payload Direction field in the
PDU header to _not applicable_ (Direction Value 5, see ETSI TS 103 221-2 [8]
clause 5.2.6).
##### 6.2.2.2.8 Positioning info transfer
The IRI-POI present in the AMF shall generate an xIRI containing an
AMFPositioningInfoTransfer when the IRI-POI present in the AMF detects one of
the following events :
> \- an NRPPa (see TS 38.455 [86]) message related to a target UE has been
> exchanged between the LMF and NG-RAN via the AMF.
>
> \- a LPP (see TS 37.355 [85]) message related to a target UE has been
> exchanged between the LMF and the target UE via the AMF.
Accordingly, the IRI-POI in AMF generates the xIRI when any of the following
events is detected:
> \- AMF receives an Namf_Communication_N1N2MessageTransfer (see TS 29.518
> [22]) from LMF to request the transfer of a NRPPa request to the serving NG-
> RAN node for a target UE as part of a UE associated NRPPa positioning
> activity. The NRPPa request may be E-CID MEASUREMENT INITIATION REQUEST or
> OTDOA INFORMATION REQUEST.
>
> \- AMF sends a Namf_Communication_N2InfoNotify [22] to the LMF to forward
> the NRPPa response or report received from the NG-RAN for a target UE. The
> NRPPa response or report may be E-CID MEASUREMENT INITIATION RESPONSE, E-CID
> MEASUREMENT REPORT or OTDOA INFORMATION RESPONSE.
>
> \- AMF receives an Namf_Communication_N1N2MessageTransfer ([22]) from LMF to
> request the transfer of a LPP message to a target UE as part of a LPP
> positioning activity.
>
> \- AMF sends an Namf_Communication_N1MessageNotify ([22]) to LMF to forward
> a LPP message received from the target UE.
Table 6.2.2-6A: Payload for AMFPositioningInfoTransfer record
Field name Description M/C/O
* * *
sUPI SUPI associated with the procedure (see NOTE 1 in table 6.2.2-6). M sUCI
SUCI used in the procedure, if applicable and if available. C pEI PEI used in
the procedure, if available (see NOTE 1 in table 6.2.2-6). C gPSI GPSI used in
the procedure, if available (see NOTE 1 in table 6.2.2-6). C gUTI 5G-GUTI used
in the procedure, see TS 24.501 [13] clause 9.11.3.4. C nRPPaMessage Any UE
associated NRPPa message exchanged between the LMF and NG-RAN via AMF. C
lPPMessage Any LPP message exchanged between the LMF and the target UE via
AMF. C lcsCorrelationId LCS correlation ID (see TS 29.572 [24] clause
6.1.6.3.2) related to a location session, found in the
Namf_CommunicationN1N2MessageTransfer and corresponding
Namf_Communication_N2InfoNotify or Namf_CommunicationN1MessageNotify. All the
AMFPositioningInfoTransfer records related to the same location session have
the same lcsCorrelationId. M
##### 6.2.2.2.9 UE Configuration Update
The IRI-POI in the AMF shall generate an xIRI containing a
AMFUEConfigurationUpdate record when the IRI-POI present in the AMF detects
that a UE matching one of the target identifiers provided via LI_X1 has been
commanded to update its configuration. Accordingly, the IRI-POI in the AMF
generates the xIRI when the following event is detected:
\- AMF sends a CONFIGURATION UPDATE COMMAND message to the target UE.
Table 6.2.2-6B: Payload for AMFUEConfigurationUpdate record
+---------------------+--------------------------------------+-------+ | Field name | Description | M/C/O | +---------------------+--------------------------------------+-------+ | userIdentifiers | List of identifiers, including the | M | | | target identifier, associated with | | | | the target UE registration stored in | | | | the AMF context. See TS 29.518 | | | | [22] clause 6.1.6.2.25. | | +---------------------+--------------------------------------+-------+ | gUTI | Current 5G-GUTI associated with the | M | | | UE context. If the AMF includes a | | | | new 5G-GUTI as a part of the | | | | configuration update, this parameter | | | | shall be set to the new GUTI and the | | | | oldGUTI parameter shall be | | | | populated, see TS 24.501 [13] | | | | clause 8.2.19.3. | | +---------------------+--------------------------------------+-------+ | oldGUTI | Old 5G-GUTI associated with the UE | C | | | context. If the AMF includes a new | | | | 5G-GUTI as a part of the | | | | configuration update, this parameter | | | | shall be set to the old GUTI. | | +---------------------+--------------------------------------+-------+ | fiveGSTAIList | List of tracking areas associated | C | | | with the registration area within | | | | which the UE is current registered, | | | | see TS 24.501 [13] clause | | | | 9.11.3.9. Shall be included each | | | | time there is a change to the | | | | registration area and omitted if the | | | | registration area does not change. | | +---------------------+--------------------------------------+-------+ | slice | Provide, if available, one or more | C | | | of the following: | | | | | | | | - allowed NSSAI (see TS 24.501 | | | | [13] clause 9.11.3.37). | | | | | | | | - configured NSSAI (see TS 24.501 | | | | [13] clause 9.11.3.37). | | | | | | | | - rejected NSSAI (see TS 24.501 | | | | [13] clause 9.11.3.46). | | | | | | | | This is derived from the information | | | | sent to the UE in the CONFIGURATION | | | | UPDATE COMMAND message. | | +---------------------+--------------------------------------+-------+ | serviceAreaList | Includes a list of allowed service | C | | | areas or non-allowed service areas, | | | | encoded per TS 24.501 [13] clause | | | | 9.11.3.49, omitting the first two | | | | octets. Shall be included if present | | | | in the CONFIGURATION UPDATE COMMAND | | | | message, see TS 24.501 [13] clause | | | | 8.2.19. | | +---------------------+--------------------------------------+-------+ | registrationResult | Specifies the result of | C | | | registration, see TS 24.501 [13] | | | | clause 9.11.3.6. Shall be included | | | | if present in the CONFIGURATION | | | | UPDATE COMMAND message, see TS | | | | 24.501 [13] clause 8.2.19. | | +---------------------+--------------------------------------+-------+ | sMSoverNASIndicator | Indicates whether SMS over NAS is | C | | | supported. Shall be present if the | | | | SMS indication is present in the | | | | CONFIGURATION UPDATE COMMAND | | | | message, see TS 24.501 [13] clause | | | | 8.2.19. | | +---------------------+--------------------------------------+-------+
#### 6.2.2.3 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in AMF, the MDF2 shall
generate the corresponding IRI message and deliver over LI_HI2 without undue
delay. The IRI message shall contain a copy of the relevant record received in
the xIRI over LI_X2. This record may be enriched with any additional
information available at the MDF (e.g. additional location information).
The timestamp field of the PSHeader structure shall be set to the time at
which the AMF event was observed (i.e. the timestamp field of the X2 PDU).
The IRI type parameter (see ETSI TS 102 232-1 [9] clause 5.2.10) shall be
included and coded according to table 6.2.2-7.
Table 6.2.2-7: IRI type for IRI messages
IRI message IRI type
* * *
AMFRegistration REPORT AMFDeregistration REPORT AMFLocationUpdate REPORT
AMFStartOfInterceptionWithRegisteredUE REPORT AMFUnsuccessfulProcedure REPORT
AMFIdentifierAssociation REPORT AMFPositioningInfoTransfer REPORT
AMFUEConfigurationUpdate REPORT
These IRI messages shall omit the CIN (see ETSI TS 102 232-1 [9] clause
5.2.4).
The threeGPP33128DefinedIRI field in ETSI TS 102 232-7 [10] clause 15 shall be
populated with the BER-encoded IRIPayload.
When an additional warrant is activated on a target UE and the LIPF uses the
same XID for the additional warrant, the MDF2 shall be able to generate and
deliver the IRI message containing the AMFStartOfInterceptionWithRegisteredUE
record to the LEMF associated with the additional warrant without receiving a
corresponding xIRI. The payload of the AMFStartOfInterceptionWithRegisteredUE
record is specified in table 6.2.2-4.
If the MDF2 did not receive from the IRI-POI the value of timeOfRegistration
parameter in a previous corresponding AMFStartOfInterceptionWithRegisteredUE
for the same registration, the MDF2 shall include in that parameter the time
provided in the timestamp previously received in the header of the related
AMFRegistration xIRI.
#### 6.2.2.4 Identity privacy
The AMF shall ensure for every registration (including re-registration) that
SUPI has been provided by the UDM to the AMF and that the SUCI to SUPI mapping
has been verified as defined in TS 33.501 [11]. This shall be performed
regardless of whether the SUPI is a target of interception, and whether the
null encryption algorithm is used for the SUCI. The AMF shall maintain the
SUPI to SUCI mapping for at least the lifetime of the registration in order to
allow interception based on SUPI after the initial registration.
### 6.2.2A Identifier Reporting for AMF
#### 6.2.2A.1 Activation of reporting over LI_XEM1
The IEF in the AMF is activated and deactivated over LI_XEM1 by the LIPF using
the LI_XEM1 protocol described in clause 5.2.7.
NOTE: Since the IEF reports association events for all UEs registered in the
IEF's parent AMF, unlike POIs there is no concept of provisioning an IEF with
target identifiers.
Upon receiving a valid activate task message over LI_XEM1, the IEF shall start
generating records as defined in clause 6.2.2A.2.
Upon receiving a valid deactivate task message over LI_XEM1, the IEF shall
stop generating records as defined in clause 6.2.2A.2.
#### 6.2.2A.2 Generation of records over LI_XER
6.2.2A.2.1 Events
The IEF in the AMF shall generate an IEFIdentifierAssociation record whenever
the IEF present in the AMF detects a change in association between a SUPI and
a 5G-GUTI for any UE registered with the AMF. The IEF shall send the
IEFIdentifierAssociation records to the ICF over LI_XER as defined in clause
5.9.
Accordingly, the IEF in the AMF generates IEFIdentifierAssociation records
when any of the following events are detected:
\- IEFAssociationRecord: Association of a 5G-GUTI to a SUPI, (this may also
include SUCI to SUPI association).
\- IEFDeassociationRecord: De-association of a 5G-GUTI from a SUPI.
NOTE1: The de-association of 5G-GUTI from a SUPI event record is only
generated if a new 5G-GUTI is not allocated to a SUPI to update a previous
association (e.g. at inter-AMF handover).
NOTE 2: As SUCIs are single use and only valid for a single authentication,
they are only valid at the single point in time when the association event is
detected and reported to the ICF by the IEF.
In addition, when an IEF is activated as per clause 6.2.2A.1, the IEF shall
generate associations event for all SUPIs which are registered in the AMF,
where those identifier associations allocated prior to IEF activation remain
current and are still available in the AMF (See NOTE 2).
NOTE 3: Only identifier associations which have been maintained by the AMF as
part of normal network operations will be available.
In the case where the IEF in the AMF detects that a REGISTRATION ACCEPT
message or a CONFIGURATION UPDATE (5G-GUTI) message as defined in TS 24.501
[13] has been sent by the AMF towards a UE, the IEF shall immediately generate
an IEFIdentifierAssociation record. This record shall be generated regardless
of whether the CONFIGURATION UPDATE (5G-GUTI) or REGISTRATION ACCEPT procedure
is subsequently successfully completed or not.
##### 6.2.2A.2.2 Association Events
For each association event, the IEF shall create an IEFAssociationRecord, as
defined below.
Table 6.2.2A-1: Payload for IEFAssociationRecord
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +=============================+=============================+=======+ | sUPI | SUPI associated with | M | | | detected association event. | | +-----------------------------+-----------------------------+-------+ | fiveGGUTI | 5G-GUTI shall be provided. | M | | | Encoded as per TS 24.501 | | | | [13] figure 9.11.3.4.1, | | | | omitting the first four | | | | octets. | | +-----------------------------+-----------------------------+-------+ | timeStamp | Time at which the | M | | | identifier association | | | | event occurred. | | | | | | | | Shall be given qualified | | | | with time zone information | | | | (i.e. as UTC or offset from | | | | UTC, not as local time). | | +-----------------------------+-----------------------------+-------+ | tAI | Last known TAI associated | M | | | with the SUPI. Encoded as | | | | per TS 24.501 [13] clause | | | | 9.11.3.8, omitting the | | | | first octet. | | +-----------------------------+-----------------------------+-------+ | nCGI | Last known nCGI(s) | M | | | available when identifier | | | | association event detected. | | | | Given as a sequence of | | | | PLMNID (encoded as per TS | | | | 38.413 [23] clause | | | | 9.3.3.5) and NCI (encoded | | | | as per TS 38.413 [23] | | | | clause 9.3.1.7). | | +-----------------------------+-----------------------------+-------+ | nCGITime | ueLocationTimestamp(s) of | M | | | nCGIs if available in AMF | | | | as per TS 29 .571 [17] | | | | clause 5.4.4.9. | | | | | | | | If ueLocationTimestamp(s) | | | | is not available, shall be | | | | populated with timeStamp(s) | | | | of when last known nCGI(s), | | | | were obtained and stored by | | | | the AMF. | | +-----------------------------+-----------------------------+-------+ | sUCI | SUCI shall be provided when | C | | | event is triggered by | | | | association of a SUCI to a | | | | SUPI. Encoded as per TS | | | | 24.501 [13] clause | | | | 9.11.3.4, omitting the | | | | first 3 octets. | | +-----------------------------+-----------------------------+-------+ | pEI | PEI, (see NOTE 1). | C | +-----------------------------+-----------------------------+-------+ | fiveGSTAIList | List of tracking areas | C | | | associated with the | | | | registration area within | | | | which the UE is current | | | | registered, see TS 24.501 | | | | [13], clause 9.11.3.9. | | | | (see NOTE 2) | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI, (see NOTE 1). | C | +-----------------------------+-----------------------------+-------+ | NOTE 1: Shall be provided | | | | in first association record | | | | to ICF after PEI or GPSI is | | | | available and following any | | | | change of PEI or GPSI. | | | | | | | | NOTE 2: As a minimum, list | | | | of tracking areas shall be | | | | included in the first | | | | association event for each | | | | SUPI registered (per UE | | | | session) with the AMF and | | | | additionally whenever the | | | | TAI list changes due to a | | | | change in registration | | | | area. | | | +-----------------------------+-----------------------------+-------+
For each de-association event, the IEF shall create an IEFDeassociationRecord,
as defined below.
**Table 6.2.2A-2: Payload for IEFDeassociationRecord**
+----------------+---------------------------------------+-----------+ | **Field name** | **Description** | **M/C/O** | +================+=======================================+===========+ | sUPI | SUPI associated with detected | M | | | de-association event. | | +----------------+---------------------------------------+-----------+ | fiveGGUTI | 5G-GUTI shall be provided. Encoded as | M | | | per TS 24.501 [13] figure | | | | 9.11.3.4.1, omitting the first four | | | | octets. | | +----------------+---------------------------------------+-----------+ | timeStamp | Time at which the identifier | M | | | de-association event occurred. | | | | | | | | Shall be given qualified with time | | | | zone information (i.e. as UTC or | | | | offset from UTC, not as local time). | | +----------------+---------------------------------------+-----------+ | nCGI | Last known nCGI(s) available when | M | | | identifier de-association event | | | | detected. Given as a sequence of | | | | PLMNID (encoded as per TS 38.413 | | | | [23] clause 9.3.3.5) and NCI | | | | (encoded as per TS 38.413 [23] | | | | clause 9.3.1.7). | | +----------------+---------------------------------------+-----------+ | nCGITime | ueLocationTimestamp(s) of nCGIs if | M | | | available in AMF as per TS 29 .571 | | | | [17] clause 5.4.4.9. | | | | | | | | If ueLocationTimestamp(s) is not | | | | available, shall be populated with | | | | timeStamp(s) of when last known | | | | nCGI(s), were obtained and stored by | | | | the AMF. | | +----------------+---------------------------------------+-----------+
##### 6.2.2A.2.3 Transmission to the ICF
When activated (see clause 5.2.7), the IEF shall establish a TLS connection to
the ICF as given over LI_XEM1. If the IEF fails to establish a TLS connection,
it shall report an error over LI_XEM1 using the error reporting mechanisms
described in ETSI TS 103 221-1 [7] and attempt to reconnect after a
configurable period of time.
When a record has been generated as described in clause 6.2.2A.2.2, the IEF
shall encode the IEFAssociationRecord or IEFDeassociationRecord as a BER-
encoded IEFMessage structure, following the ASN.1 schema given in Annex F, and
transmit it to the ICF over the established TLS connection.
The IEF may transmit a keepalive request using the keepalive record defined in
Annex F. Upon receiving a keepalive request, the ICF shall respond with a
keepaliveResponse record containing the same sequence number used in the
request. The circumstances under which the IEF transmits keepalive requests is
out of scope of the present document.
### 6.2.3 LI for SMF/UPF
#### 6.2.3.1 Provisioning over LI_X1
##### 6.2.3.1.1 General
If the warrant is for IRI and CC, then the IRI-POI and the CC-TF in the SMF
shall be provisioned in accordance with clause 6.2.3.1.2, the MDF2 shall be
provisioned in accordance with clause 6.2.3.1.3, and the MDF3 shall be
provisioned in accordance with clause 6.2.3.1.4.
If the warrant is for IRI only, the IRI-POI in the SMF shall be provisioned in
accordance with clause 6.2.3.1.2 and the MDF2 shall be provisioned in
accordance with clause 6.2.3.1.3.
If approach 1 described in clause 6.2.3.9 is used for packet header
information reporting, the IRI-TF in the SMF shall be provisioned in
accordance with clause 6.2.3.1.2 and the MDF2 shall be provisioned in
accordance with clause 6.2.3.1.3. If approach 2 described in clause 6.2.3.9 is
used for packet header information reporting, the CC-TF in the SMF shall be
provisioned in accordance with clause 6.2.3.1.2, the MDF2 shall be provisioned
in accordance with clause 6.2.3.1.3, and the MDF3 shall be provisioned in
accordance with clause 6.2.3.1.4.
If the SMF is part of a combined SMF+PGW-C, the requirements in clause 6.3.3
shall apply.
##### 6.2.3.1.2 Provisioning of the IRI-POI, IRI-TF and CC-TF in the SMF
The IRI-POI, IRI-TF and CC-TF present in the SMF are provisioned over LI_X1 by
the LIPF using the X1 protocol as described in clause 5.2.2.
The POI/TF in the SMF shall support the following target identifier formats in
the ETSI TS 103 221-1 [7] messages (or equivalent if ETSI TS 103 221-1 [7] is
not used):
\- SUPIIMSI.
\- SUPINAI.
\- PEIIMEI.
\- PEIIMEISV.
\- GPSIMSISDN.
\- GPSINAI.
Table 6.2.3-0A shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the IRI-POI, in the SMF.
Table 6.2.3-0A: ActivateTask message for SMF IRI-POI, CC-TF and IRI-TF
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. If | M | | | the CC-TF or IRI-TF is also | | | | being tasked for the same | | | | interception, the same XID | | | | shall be used. | | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One or more of the target | M | | | identifiers listed in the | | | | paragraph above. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X2Only", "X3Only" | M | | | or "X2andX3" as needed to | | | | meet the requirements of | | | | the warrant. (NOTE: | | | | \"X2Only\" for IRI-POI, | | | | IRI-TF and \"X3Only\" for | | | | CC-TF can also be used). | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | Header reporting-specific | C | | | tag to be carried in the | | | HeaderReporting | _TaskDetailsExtensions_ | | | | field of ETSI TS 103 221-1 | | | | [7]. See table | | | | 6.2.3.9.2-1. Unless there | | | | is a CSP/LEA agreement to | | | | not report packet header | | | | information, this field | | | | shall be present to enable | | | | packet header information | | | | reporting. | | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints of | M | | | LI_X2 or LI_X3. These | | | | delivery endpoints shall be | | | | configured using the | | | | _CreateDestination_ message | | | | as described in ETSI TS 103 | | | | 221-1 [7] clause 6.3.1 | | | | prior to first use. | | +-----------------------------+-----------------------------+-------+ | ListOfServiceTypes | Shall be included when the | C | | | task should only intercept | | | | specific CSP service types | | | | as described in clause | | | | 5.2.4. This parameter is | | | | defined in ETSI TS 103 | | | | 221-1 [7], clause | | | | 6.2.1.2, table 4. | | +-----------------------------+-----------------------------+-------+
To enable packet header information reporting, parameters specified in table
6.2.3.9.2-1: PDHRReportingExtensions parameters shall be provided as the
TaskDetailsExtensions/HeaderReporting field of the LI_X1 provisioning message.
##### 6.2.3.1.3 Provisioning of the MDF2
The MDF2 listed as the delivery endpoint for xIRI generated by the IRI-POI in
the SMF or the IRI-POI in the UPF shall be provisioned over LI_X1 by the LIPF
using the X1 protocol as described in clause 5.2.2. Table 6.2.3-0B shows the
minimum details of the LI_X1 ActivateTask message used for provisioning the
MDF2.
The MDF2 shall support the following target identifier formats in the ETSI TS
103 221-1 [7] messages (or equivalent if ETSI TS 103 221-1 [7] is not used):
\- SUPIIMSI.
\- SUPINAI.
\- PEIIMEI.
\- PEIIMEISV.
\- GPSIMSISDN.
\- GPSINAI.
Table 6.2.3-0B: ActivateTask message for MDF2
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. | M | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One or more of the target | M | | | identifiers listed in the | | | | paragraph above. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X2Only", "X3Only" | M | | | or "X2andX3" as needed to | | | | meet the requirements of | | | | the warrant. (Ignored by | | | | the MDF2). | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | Header reporting-specific | C | | | tag to be carried in the | | | HeaderReporting | _TaskDetailsExtensions_ | | | | field of ETSI TS 103 221-1 | | | | [7]. See table | | | | 6.2.3.9.2-1. Unless there | | | | is a CSP/LEA agreement to | | | | not report packet header | | | | information, this field | | | | shall be present to enable | | | | packet header information | | | | reporting. | | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints of | M | | | LI_HI2. These delivery | | | | endpoints shall be | | | | configured using the | | | | _CreateDestination_ message | | | | as described in ETSI TS 103 | | | | 221-1 [7] clause 6.3.1 | | | | prior to first use. | | +-----------------------------+-----------------------------+-------+ | ListOfMediationDetails | Sequence of Mediation | M | | | Details, See table | | | | 6.2.3-0C. | | +-----------------------------+-----------------------------+-------+
Table 6.2.3-0C: Mediation Details for MDF2
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | LIID | Lawful Intercept ID | M | | | associated with the task. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to \"HI2Only\". | M | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Details of where to send | C | | | the IRI for this LIID. | | | | Shall be included if | | | | deviation from the | | | | ListofDIDs in the | | | | ActivateTask message is | | | | necessary. If included, the | | | | ListOfDIDs in the Mediation | | | | Details shall be used | | | | instead of any delivery | | | | destinations authorised by | | | | the ListOfDIDs field in the | | | | ActivateTask Message. | | +-----------------------------+-----------------------------+-------+ | ServiceScoping | Shall be included to | C | | | Identify the service(s) and | | | | associated service-related | | | | delivery settings for this | | | | LIID. May include more than | | | | one instance of this | | | | parameter to allow for | | | | different combinations of | | | | subparameters associated | | | | with a single LIID. This | | | | parameter is defined in | | | | ETSI TS 103 221-1 [7] | | | | Annex C table C.2. | | +-----------------------------+-----------------------------+-------+ | MediationDetailsExtensions/ | Header reporting-specific | C | | | tag to be carried in the | | | HeaderReporting | MediationDetailsExtensions | | | | field of ETSI TS 103 221-1 | | | | [7]. See table | | | | 6.2.3.9.2-1. This field | | | | shall be included if | | | | deviation from the | | | | taskDetails HeaderReporting | | | | TaskDetailsExtensions is | | | | required. If included, the | | | | details shall be used | | | | instead of the | | | | HeaderReporting | | | | instructions specified in | | | | the HeaderReporting field | | | | in the TaskDetails | | | | structure. | | +-----------------------------+-----------------------------+-------+
##### 6.2.3.1.4 Provisioning of the MDF3
The MDF3 listed as the delivery endpoint for the xCC generated by the CC-POI
in the UPF shall be provisioned over LI_X1 by the LIPF using the X1 protocol
as described in clause 5.2.2. Table 6.2.3-0D shows the minimum details of the
LI_X1 ActivateTask message used for provisioning the MDF3. If packet header
information reporting is authorised and approach 2 described in clause
6.2.3.9.1 is used, the endpoint for the MDF3 shall be the MDF2 over LI_MDF.
The MDF3 shall support the following target identifier formats in the ETSI TS
103 221-1 [7] messages (or equivalent if ETSI TS 103 221-1 [7] is not used):
\- SUPIIMSI.
\- SUPINAI.
\- PEIIMEI.
\- PEIIMEISV.
\- GPSIMSISDN.
\- GPSINAI.
Table 6.2.3-0D: ActivateTask message for MDF3
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. | M | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One or more of the target | M | | | identifiers listed in the | | | | paragraph above. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X2Only", "X3Only" | M | | | or "X2andX3" as needed to | | | | meet the requirements of | | | | the warrant. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | Header reporting-specific | C | | | tag to be carried in the | | | HeaderReporting | _TaskDetailsExtensions_ | | | | field of ETSI TS 103 221-1 | | | | [7]. See table | | | | 6.2.3.9.2-1. Unless there | | | | is a CSP/LEA agreement to | | | | not report packet header | | | | information, this field | | | | shall be present to enable | | | | packet header information | | | | reporting is. | | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints of | M | | | LI_HI3 or LI_MDF. These | | | | delivery endpoints shall be | | | | configured using the | | | | _CreateDestination_ message | | | | as described in ETSI TS 103 | | | | 221-1 [7] clause 6.3.1 | | | | prior to first use. | | +-----------------------------+-----------------------------+-------+ | ListOfMediationDetails | Sequence of Mediation | M | | | Details, see table | | | | 6.2.3-0E. | | +-----------------------------+-----------------------------+-------+
Table 6.2.3-0E: Mediation Details for MDF3
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | LIID | Lawful Intercept ID | M | | | associated with the task. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to \"HI3Only\". | M | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Details of where to send | C | | | the CC for this LIID. Shall | | | | be included if deviation | | | | from the ListofDIDs in the | | | | ActivateTask message is | | | | necessary. If included, the | | | | ListOfDIDs in the Mediation | | | | Details shall be used | | | | instead of any delivery | | | | destinations authorised by | | | | the ListOfDIDs field in the | | | | ActivateTask Message. | | +-----------------------------+-----------------------------+-------+ | ServiceScoping | Shall be included to | C | | | Identify the service(s) and | | | | associated service-related | | | | delivery settings for this | | | | LIID. May include more than | | | | one instance of this | | | | parameter to allow for | | | | different combinations of | | | | subparameters associated | | | | with a single LIID. This | | | | parameter is defined in | | | | ETSI TS 103 221-1 [7] | | | | Annex C table C.2. | | +-----------------------------+-----------------------------+-------+ | MediationDetailsExtensions/ | Header reporting-specific | C | | | tag to be carried in the | | | HeaderReporting | MediationDetailsExtensions | | | | field of ETSI TS 103 221-1 | | | | [7]. See table | | | | 6.2.3.9.2-1. This field | | | | shall be included if | | | | deviation from the | | | | taskDetails HeaderReporting | | | | TaskDetailsExtensions is | | | | required. If included, the | | | | details shall be used | | | | instead of the | | | | HeaderReporting | | | | instructions specified in | | | | the HeaderReporting field | | | | in the TaskDetails | | | | structure. | | +-----------------------------+-----------------------------+-------+
#### 6.2.3.2 Generation of xIRI at IRI-POI in SMF over LI_X2
##### 6.2.3.2.1 General
The IRI-POI present in the SMF shall send the xIRIs over LI_X2 for each of the
events listed in TS 33.127 [5] clause 6.2.3.3, the details of which are
described in the following clauses. In the case where the SMF is part of a
combined SMF+PGW-C, the details of the events are specified in clause 6.3.3.2.
The IRI-POI present in the SMF shall also send a SeparatedLocationReporting
xIRI (as described in clause 7.3.4.1) when the IRI-POI provisioned in the
H-SMF detects that the V-SMF has sent location data via the HsmfUpdateData
service operation to the H-SMF that does not otherwise trigger an existing SMF
record type.
As specified in TS 23.501 [2] clause 5.6.1, a PDU session may support either a
single-access PDU Connectivity Service (referred to as a single-access PDU
Session) or a multi-access PDU Connectivity Service (referred to as a Multi-
Access PDU (MA PDU) session).
The details of the messages for single-access PDU sessions are provided below
in clauses 6.2.3.2.2, 6.2.3.2.3, 6.2.3.2.4, 6.2.3.2.5 and 6.2.3.2.6.
The details of the messages for multi-access PDU sessions are provided below
in clauses 6.2.3.2.7 and 6.2.3.2.8.
##### 6.2.3.2.2 PDU session establishment
The IRI-POI in the SMF shall generate an xIRI containing an
SMFPDUSessionEstablishment record when the IRI-POI present in the SMF detects
that a single-access PDU session has been established for the target UE. The
IRI-POI present in the SMF shall generate the xIRI for the following events:
\- For a non-roaming scenario, the SMF (or for a roaming scenario, V-SMF in
the VPLMN), sends the N1 NAS message (via AMF) PDU SESSION ESTABLISHMENT
ACCEPT to the UE and the 5G Session Management (5GSM) state within the SMF is
changed to PDU SESSION ACTIVE (see TS 24.501 [13]).
\- For a home-routed roaming scenario, the SMF in the HPLMN (i.e. H-SMF) sends
the N16: Nsmf_PDU_Session_Create response message with n1SmInfoToUe IE
containing the PDU SESSION ESTABLISHMENT ACCEPT (see TS 29.502 [16]).
If the Npcf_SMPolicyControl_Create response received from the PCF for the
target UE in response to Npcf_SMPolicyControl_Create request includes PCC
rules in which the traffic control policy data contains either a routeToLocs
IE or trafficSteeringPolIdDl IE and/or trafficSteeringPolIdUl IE, then the SMF
shall include those PCC rules in the xIRI. These PCC rules correspond to
policies that influence the target UE\'s traffic flows (see TS 29.513 [88]
clause 5.5.3).
Table 6.2.3-1: Payload for SMFPDUSessionEstablishment record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | sUPI | SUPI associated with the | C | | | PDU session (e.g. as | | | | provided by the AMF in the | | | | associated | | | | Nsmf_PD | | | | U_Session_CreateSMContext | | | | service operation). Shall | | | | be present except for | | | | PEI-only unauthenticated | | | | emergency sessions (see | | | | NOTE). | | +-----------------------------+-----------------------------+-------+ | sUPIUnauthenticated | Shall be present if a SUPI | C | | | is present in the message | | | | and set to "true" if the | | | | SUPI has not been | | | | authenticated, or "false" | | | | if it has been | | | | authenticated. | | +-----------------------------+-----------------------------+-------+ | pEI | PEI associated with the PDU | C | | | session if available (see | | | | NOTE). | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI associated with the | C | | | PDU session if available | | | | (see NOTE). | | +-----------------------------+-----------------------------+-------+ | pDUSessionID | PDU Session ID See TS | M | | | 24.501 [13] clause 9.4. | | +-----------------------------+-----------------------------+-------+ | gTPTunnelID | Contains the F-TEID | M | | | identifying the UPF | | | | endpoint of the GTP tunnel | | | | used to encapsulate the | | | | traffic derived from the UL | | | | NG-U UP TNL Information | | | | (see TS 38.413 clause | | | | 9.3.4.1), as defined in TS | | | | 29.244 [15] clause 8.2.3. | | | | Non-GTP encapsulation is | | | | for further study. | | +-----------------------------+-----------------------------+-------+ | pDUSessionType | Identifies selected PDU | M | | | session type, see TS 24.501 | | | | [13] clause 9.11.4.11. | | +-----------------------------+-----------------------------+-------+ | sNSSAI | Slice identifiers | C | | | associated with the PDU | | | | session, if available. See | | | | TS 23.003 [19] clause | | | | 28.4.2 and TS 23.501 [2] | | | | clause 5.15.2. | | +-----------------------------+-----------------------------+-------+ | uEEndpoint | UE endpoint address(es) | C | | | assigned to the PDU Session | | | | if available (see TS 29.244 | | | | [15] clause 5.21). | | +-----------------------------+-----------------------------+-------+ | non3GPPAccessEndpoint | UE\'s local IP address used | C | | | to reach the N3IWF, TNGF or | | | | TWIF, if available. IP | | | | addresses are given as 4 | | | | octets (for IPv4) or 16 | | | | octets (for IPv6) with the | | | | most significant octet | | | | first (network byte order). | | +-----------------------------+-----------------------------+-------+ | location | Location information | C | | | provided by the AMF or | | | | present in the context at | | | | the SMF, if available. | | +-----------------------------+-----------------------------+-------+ | dNN | Data Network Name requested | M | | | by the target UE, as | | | | defined in TS 23.003[19] | | | | clause 9A and described in | | | | TS 23.502 [4] clause | | | | 4.3.2.2. Shall be given in | | | | dotted-label presentation | | | | format as described in TS | | | | 23.003 [19] clause 9.1. | | +-----------------------------+-----------------------------+-------+ | aMFID | Identifier of the AMF | C | | | associated with the target | | | | UE, as defined in TS 23.003 | | | | [19] clause 2.10.1 if | | | | available. | | +-----------------------------+-----------------------------+-------+ | hSMFURI | URI of the Nsmf_PDUSession | C | | | service of the selected | | | | H-SMF, if available. See TS | | | | 29.502 [16] clause | | | | 6.1.6.2.2. | | +-----------------------------+-----------------------------+-------+ | requestType | Type of request as | M | | | described in TS 24.501 | | | | [13] clause 9.11.3.47 | | | | provided within the | | | | Nsmf_PD | | | | U_Session_CreateSMContext | | | | Request (TS 29.502 [16]) | | | | message shall be reported. | | | | | | | | In the case where the | | | | network does not support | | | | Multi Access (MA) PDU | | | | sessions, but receives a MA | | | | PDU session request, a | | | | request type of "Initial | | | | request" shall be reported. | | | | | | | | In the case where the | | | | network does not provide a | | | | request type value for a | | | | non-MA PDU session, a | | | | request type of "initial | | | | request", according to TS | | | | 24.501 [13] clause | | | | 6.4.1.2 shall be reported. | | +-----------------------------+-----------------------------+-------+ | accessType | Access type associated with | C | | | the session (i.e. 3GPP or | | | | non-3GPP access) if | | | | provided by the AMF (see TS | | | | 24.501 [13] clause | | | | 9.11.2.1A). | | +-----------------------------+-----------------------------+-------+ | rATType | RAT Type associated with | C | | | the access if provided by | | | | the AMF as part of session | | | | establishment (see TS | | | | 23.502 [4] clause 4.3.2). | | | | Values given as per TS | | | | 29.571 [17] clause | | | | 5.4.3.2. | | +-----------------------------+-----------------------------+-------+ | sMPDUDNRequest | Contents of the SM PDU DN | C | | | Request container, if | | | | available, as described in | | | | TS 24.501 [13] clause | | | | 9.11.4.15. | | +-----------------------------+-----------------------------+-------+ | uEEPSPDNConnection | This IE shall be present, | C | | | if available, during an EPS | | | | to 5GS Idle mode mobility | | | | or handover using the N26 | | | | interface. If present, it | | | | shall contain the EPS | | | | bearer context(s) | | | | information present in the | | | | uEEPSPDNConnection | | | | parameter of the | | | | intercepted | | | | SmContextCreateData | | | | message. (see TS 29.502 | | | | [16] clause 6.1.6.2.2). | | +-----------------------------+-----------------------------+-------+ | ePS5GSComboInfo | Provides detailed | C | | | information about PDN | | | | Connections associated with | | | | the reported PDU Session. | | | | Shall be included if the | | | | AMF has selected a | | | | SMF+PGW-C to serve the PDU | | | | session. This parameter | | | | shall include the | | | | additional IEs in Table | | | | 6.2.3-1A, if present. | | +-----------------------------+-----------------------------+-------+ | selectedDNN | Shall be present if a DNN | C | | | other than the UE requested | | | | DNN is selected for the PDU | | | | Session. Shall be given in | | | | dotted-label presentation | | | | format as described in TS | | | | 23.003 [19] clause 9.1. | | +-----------------------------+-----------------------------+-------+ | servingNetwork | PLMN ID of the serving core | C | | | network operator, and, for | | | | a Non-Public Network (NPN), | | | | the NID that together with | | | | the PLMN ID identifies the | | | | NPN. Shall be present if | | | | this IE is in the | | | | SMContextCreateData or | | | | PDUSessionCreateData | | | | message sent to the SMF or | | | | the PDU Session Context or | | | | SM Context at the SMF (see | | | | TS 29.502 [16] clauses | | | | 6.1.6.2.2, 6.1.6.2.9 and | | | | 6.1.6.2.39). | | +-----------------------------+-----------------------------+-------+ | oldPDUSessionID | Shall be present if this IE | C | | | is in the | | | | SMContextCreateData or | | | | PDUSessionCreateData | | | | message sent to the SMF or | | | | the PDU Session Context or | | | | SM Context at the SMF (see | | | | TS 29.502 [16] clauses | | | | 6.1.6.2.2, 6.1.6.2.9 and | | | | 6.1.6.2.39). | | +-----------------------------+-----------------------------+-------+ | handoverState | Indicates whether the PDU | C | | | Session Establishment being | | | | reported was due to a | | | | handover. Shall be present | | | | if this IE is in the | | | | SMContextCreatedData sent | | | | by the SMF (see TS 29.502 | | | | [16] clause 6.1.6.2.3). | | +-----------------------------+-----------------------------+-------+ | gTPTunnelInfo | Contains the information | M | | | for the User Plane GTP | | | | Tunnels for the PDU Session | | | | (see TS 29.502 [16] | | | | clauses 6.1.6.2.2, | | | | 6.1.6.2.9 and 6.1.6.2.39). | | | | See Table 6.2.3-1B. | | +-----------------------------+-----------------------------+-------+ | pCCRules | Set of PCC rules related to | C | | | traffic influence. Each PCC | | | | rule influences the routing | | | | of a given traffic flow. If | | | | several flows are | | | | concerned, then several PCC | | | | rules shall be handled by | | | | the SMF. Traffic influence | | | | policies are originated by | | | | an AF. PCF translates these | | | | rules into PCC rules for | | | | traffic influence. The | | | | payload of a PCC rule for | | | | traffic influence is | | | | defined in Table 6.2.3-1E. | | +-----------------------------+-----------------------------+-------+ | eP | Provides details about PDN | C | | SPDNConnectionEstablishment | Connections when the | | | | SMFPDUSessionEstablishment | | | | xIRI message is used to | | | | report PDN Connection | | | | establishment. See Table | | | | 6.3.3-1 and clause | | | | 6.3.3.2.2. | | +-----------------------------+-----------------------------+-------+ | NOTE: At least one of the | | | | SUPI, PEI or GPSI fields | | | | shall be present. | | | +-----------------------------+-----------------------------+-------+
Table 6.2.3-1A: Payload for ePS5GSComboInfo
* * *
ePSInterworkingIndication Indicates whether and how the PDU Session may be
moved to EPS. Shall be derived from the EpsInterworkingIndication associated
with the PDU Session at the SMF+PGW-C(see TS 29.502 [16] clause 6.1.6.3.11). M
ePSSubscriberIDs Includes the Subscriber Identities associated with the EPS
PDN Connection in the UE Context sent from the MME to the AMF or known in the
context at the SMF+PGW-C.See TS 29.274 [87] clause 7.2.1 and TS 23.502 [4]
clause 4.11.1. M ePSPdnCnxInfo Shall be present if there are any EPS PDN
connections associated to the PDU Session in the SM Context or PDU Session
Context at the SMF+PGW-C. Contains information about the EPS PDN connection
associated with the PDU Session. See TS 29.502 [16] clause 6.1.6.2.31. C
ePSBearerInfo Shall be present if there are any EPS Bearers associated to the
PDU Session in the SM Context or PDU Session Context at the SMF+PGW-C.
Contains information about the EPS Bearer context(s) associated with the PDU
Session. See TS 29.502 [16] clause 6.1.6.2.4. C
* * *
Table 6.2.3-1B: gTPTunnelInfo field
Field name Description M/C/O
* * *
fiveGSGTPTunnels Shall include the 5GS GTP Tunnels (See Table 6.2.3-1C) when
the xIRI message is used to report PDU Session related events. C ePSGTPTunnels
Shall include the information for the User Plane GTP Tunnels for the bearer
context if present in the Request or Response (see TS 29.274 [87] clauses
7.2.2, 7.2.4 and 8.15) or known at the context at the SGW or PGW (see TS
23.401 [50] clause 5.6.4) when the xIRI message is used to report PDN
Connection related events. See Table 6.3.3-6. C
Table 6.2.3-1C: fiveGSGTPTunnels field
* * *
Field name Description M/C/O uLNGUUPTunnelInformation Shall include the F-TEID
for the UPF endpoint of the NG-U transport bearer (See TS 38.413 [23] clause
9.3.4.1). C additionalULNGUUPTunnelInformation Shall include the F-TEID for
the UPF endpoint of any additional NG-U transport bearers (See TS 38.413 [23]
clause 9.3.4.1). C dLRANTunnelInformation Shall include the RAN tunnel and QOS
Flow information for the PDU Session (See TS 29.502 [16] clause 6.1.6.2.39 and
TS 38.413 [23] clause 9.3.4.1). See Table 6.2.3-1D. C
* * *
Table 6.2.3-1D: dLRANTunnelInformation field
* * *
Field name Description M/C/O dLQOSFlowTunnelInformation Shall include the
F-TEID NG-RAN endpoint of the NG-U transport bearer together with associated
QoS flows (See TS 38.413 [23] clause 9.3.4.2 and TS 29.502 [16] clause
6.1.6.2.39). C additionalDLQOSFlowTunnelInformation Shall include the F-TEID
NG-RAN endpoint of any additional NG-U transport bearers together with
associated QoS flows (See TS 38.413 [23] clause 9.3.4.2 and TS 29.502 [16]
clause 6.1.6.2.39). C redundantDLQOSFlowTunnelInformation Shall include the
F-TEID NG-RAN endpoint of redundant NG-U transport bearers together with
associated QoS flows (See TS 38.413 [23] clause 9.3.4.2 and TS 29.502 [16]
clause 6.1.6.2.39). C additionalredundantDLQOSFlowTunnelInformation Shall
include the F-TEID NG-RAN endpoint of any additional redundant NG-U transport
bearers together with associated QoS flows (See TS 38.413 [23] clause 9.3.4.2
and TS 29.502 [16] clause 6.1.6.2.39). C
* * *
Each PCC rule for traffic influence has the payload defined in Table 6.2.3-1E.
Table 6.2.3-1E: Payload of PCCrule for traffic influence
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +=============================+=============================+=======+ | pCCRuleID | Policy rule identifier. | M | | | This IE is defined in TS | | | | 29.512 [89], table | | | | 5.6.2.6-1. | | +-----------------------------+-----------------------------+-------+ | appId | Identifies an application | C | | | (NOTE 1). This IE is | | | | defined in TS 29.512 | | | | [89], table 5.6.2.6-1 | | | | (NOTE 1), if available. | | +-----------------------------+-----------------------------+-------+ | pFD | Packet flow description | C | | | (PFD) associated with the | | | | appId. It is defined in TS | | | | 29.551 [94] table | | | | 5.6.2.5-1 (NOTE 1). | | +-----------------------------+-----------------------------+-------+ | flowInfos | A set of flow information, | C | | | if available. A flow | | | | information is an Ethernet | | | | or IP flow packet filter | | | | information (NOTE 1). This | | | | IE is defined in TS 29.512 | | | | [89], table 5.6.2.6-1 | | | | (NOTE 1). FlowInfos may be | | | | IP flow or Ethernet flow. | | | | IP flow is specified in TS | | | | 29.214, section 5.3.8 | | | | [92]. Ethernet Flow is | | | | specified in TS 29.514 | | | | [91] Table 5.6.2.17-1. | | +-----------------------------+-----------------------------+-------+ | appReloc | Indicates that the | C | | | application cannot be | | | | relocated once a location | | | | of the application is | | | | selected by the 5GC when it | | | | is included and set to | | | | \"true\". The default value | | | | is \"false\". | | +-----------------------------+-----------------------------+-------+ | simConnInd | Indication of simultaneous | C | | | connectivity temporarily | | | | maintained for the source | | | | and target PSA (PDU Session | | | | Anchor). If it is included | | | | and set to \"true\", | | | | temporary simultaneous | | | | connectivity should be | | | | kept. The default value | | | | \"false\" applies, if the | | | | IE is not present. This IE | | | | is defined in TS 29.512 | | | | [89], table 5.6.2.9-1. | | +-----------------------------+-----------------------------+-------+ | simConnTerm | Indication of the minimum | C | | | time interval to be | | | | considered for inactivity | | | | of the traffic routed via | | | | the source PSA during the | | | | edge re-location procedure. | | | | It may be included when the | | | | \"simConnInd\" attribute is | | | | set to true. This IE is | | | | defined in TS 29.512 | | | | [89], table 5.6.2.9-1. | | +-----------------------------+-----------------------------+-------+ | maxAllowedUpLat | Indicates the target user | C | | | plane latency in units of | | | | milliseconds used by SMF to | | | | decide whether edge | | | | relocation is needed to | | | | ensure that the user plane | | | | latency does not exceed the | | | | value. This IE is defined | | | | in TS 29.512 [89], table | | | | 5.6.2.9-1. | | +-----------------------------+-----------------------------+-------+ | routeToLocs | A set of traffic routes. A | C | | | traffic route provides | | | | information to route | | | | to/from a DNAI. This IE is | | | | defined in TS 29.512 | | | | [89], table 5.6.2.9-1 | | | | (NOTE 2). | | +-----------------------------+-----------------------------+-------+ | trafficSteeringPolIdDl | Traffic steering policy for | C | | | downlink traffic at the | | | | SMF, if available. This IE | | | | is defined in TS 29.512 | | | | [89], table 5.6.2.9-1 | | | | (NOTE 2). | | +-----------------------------+-----------------------------+-------+ | trafficSteeringPolIdUl | Traffic steering policy for | C | | | downlink traffic at the | | | | SMF, if available. This IE | | | | is defined in TS 29.512 | | | | [89], table 5.6.2.9-1 | | | | (NOTE 2). | | +-----------------------------+-----------------------------+-------+ | sourceDNAI | No longer used in present | C | | | version of the present | | | | document. | | +-----------------------------+-----------------------------+-------+ | targetDNAI | No longer used in present | C | | | version of the present | | | | document. | | +-----------------------------+-----------------------------+-------+ | dNAIChangeType | No longer used in present | C | | | version of the present | | | | document. | | +-----------------------------+-----------------------------+-------+ | sourceUEIPAddress | No longer used in present | C | | | version of the present | | | | document. | | +-----------------------------+-----------------------------+-------+ | targetUEIPAddress | No longer used in present | C | | | version of the present | | | | document. | | +-----------------------------+-----------------------------+-------+ | eASIPReplaceInfos | Contains EAS IP replacement | C | | | information for a Source | | | | and a Target EAS, if | | | | available. This IE is | | | | defined in TS 29.571 | | | | [17], table 5.4.4.79. | | +-----------------------------+-----------------------------+-------+ | NOTE 1: Either appId/pFD or | | | | flowInfos shall be | | | | supplied. | | | | | | | | NOTE 2: | | | | TrafficSteeringPolIdDl | | | | attribute and/or | | | | trafficSteeringPolIdUl | | | | attribute and routeToLocs | | | | attribute are mutually | | | | exclusive. | | | +-----------------------------+-----------------------------+-------+
##### 6.2.3.2.3 PDU session modification
The IRI-POI in the SMF shall generate an xIRI containing an
SMFPDUSessionModification record when the IRI-POI present in the SMF detects
that a single-access PDU session has been modified for the target UE. The IRI-
POI present in the SMF shall generate the xIRI for the following events:
\- For a non-roaming scenario, the SMF (or for a roaming scenario, V-SMF in
the VPLMN), receives the N1 NAS message (via AMF) PDU SESSION MODIFICATION
COMPLETE from the UE and the 5GSM state within the SMF is returned to PDU
SESSION ACTIVE (see TS 24.501 [13]). This applies to the following two cases:
\- UE initiated PDU session modification.
\- Network initiated PDU session modification.
\- For a non-roaming scenario, the SMF (or for a roaming scenario, V-SMF in
the VPLMN), sends the N1 NAS message (via AMF) PDU SESSION ESTABLISHMENT
ACCEPT to the UE and the 5GSM state within the SMF remains in the PDU SESSION
ACTIVE (see TS 24.501 [13]). This applies to the following case:
\- Handover from one access type to another access type happens (e.g. 3GPP to
non-3GPP).
\- For a home-routed roaming scenario, the SMF in the HPLMN (i.e. H-SMF)
receives the N16: Nsmf_PDU_Session_Update Response message with n1SmInfoFromUe
IE containing the PDU SESSION MODIFICATION COMPLETE (see TS 29.502 [16]). This
applies to the following three cases:
\- UE initiated PDU session modification.
\- Network (VPLMN) initiated PDU session modification.
\- Network (HPLMN) initiated PDU session modification.
\- For a home-routed roaming scenario, the SMF in the HPLMN (i.e. H-SMF) sends
the N16: Nsmf_PDU_Session_Create Response message with n1SmInfoToUe IE
containing the PDU SESSION ESTABLISHMENT ACCEPT (see TS 29.502 [16]) while it
had received a N16 Nsmf_PDU_Session_Create Request message with an existing
PDU Session Id with access type being changed. This applies to the following
case:
\- Handover from one access type to another access type happens (e.g. 3GPP to
non-3GPP) where the V-SMF is used for the PDU session on the new access type
only.
\- For a home-routed roaming scenario, the SMF in the HPLMN (i.e. H-SMF) sends
the N16: Nsmf_PDU_Session_Update Response message with n1SmInfoToUe IE
containing the PDU SESSION ESTABLISHMENT ACCEPT (see TS 29.502 [16]) while it
had received a N16 Nsmf_PDU_Session_Update Request message with an existing
PDU Session Id with access type being changed. This applies to the following
case:
\- Handover from one access type to another access type happens (e.g. 3GPP to
non-3GPP) where the same V-SMF is used for the PDU session on both access
types.
\- For a non-roaming scenario, SMF sends a Nsmf_EventExposure_Notify request
to the NEF or AF for the target UE for the event \"UP Path Change\" related to
a corresponding subscription from AF (see TS 29.508 [90] clause 4.2.2).
\- For a non-roaming scenario, SMF sends a
Nsmf_EventExposure_AppRelocationInfo response to the NEF or AF for the target
UE in response to Nsmf_EventExposure_AppRelocationInfo request sent by NEF or
AF to SMF (see TS 29.508 [90] clause 4.2.5).
\- For a non-roaming scenario, SMF receives a Nnef_PFDManagement_Fetch
response from the NEF for the target UE in response to
Nnef_PFDManagement_Fetch request sent by SMF to NEF (see TS 29.551 [94] clause
4.2.2).
If the Npcf_SMPolicyControlUpdateNotify response sent to the PCF for the
target UE in response to an Npcf_SMPolicyControlUpdateNotify request includes
PCC rules in which the traffic control policy data contains either a
routeToLocs IE or trafficSteeringPolIdDl IE and/or trafficSteeringPolIdUl IE,
then the SMF shall include those PCC rules in the xIRI. These PCC rules
correspond to policies that influence the target UE's traffic flows (see TS
29.513 [88] clause 5.5.3).
Table 6.2.3-2: Payload for SMFPDUSessionModification record
* * *
Field name Description M/C/O sUPI SUPI associated with the PDU session (e.g.
as provided by the AMF in the associated Nsmf_PDU_Session_CreateSMContext
service operation). Shall be present except for PEI-only unauthenticated
emergency sessions. C sUPIUnauthenticated Shall be present if a SUPI is
present in the message and set to "true" if the SUPI was not authenticated, or
"false" if it has been authenticated. C pEI PEI associated with the PDU
session if available. C gPSI GPSI associated with the PDU session if
available. C sNSSAI Slice identifier associated with the PDU session, if
available. See TS 23.003 [19] clause 28.4.2 and TS 23.501 [2] clause 5.15.2. C
non3GPPAccessEndpoint UE\'s local IP address used to reach the N3IWF, TNGF or
TWIF, if available. IP addresses are given as 4 octets (for IPv4) or 16 octets
(for IPv6) with the most significant octet first (network byte order). C
location Location information provided by the AMF or present in the context at
the SMF, if available. C requestType For both a UE- as well as a network-
requested PDU session the POI (SMF) shall set the request type parameter to
\"modification request\". M accessType Access type associated with the session
(i.e. 3GPP or non-3GPP access) if provided by the AMF (see TS 24.501 [13]
clause 9.11.2.1A). C rATType RAT type associated with the access, if
available. Values given as per TS 29.571 [17] clause 5.4.3.2. C pDUSessionID
PDU Session ID See TS 24.501 [13] clause 9.4. This parameter is conditional
only for backwards compatibility. C ePS5GSComboInfo Provides detailed
information about PDN Connections associated with the reported PDU Session.
Shall be included when the AMF has selected a SMF+PGW-C to serve the PDU
session. This parameter may include the additional IEs in Table 6.2.3-1A, when
available. C uEEndpoint UE IP address(es) assigned to the PDU Session if
available (See TS 29.244 [15] clause 5.21). C servingNetwork Shall be present
if this IE is in the SMContextUpdateData, HsmfUpdateData or message sent to
the SMF or the PDU Session Context or SM Context at the SMF (see TS 29.502
[16] clauses 6.1.6.2.3, 6.1.6.2.11 and 6.1.6.2.39). C handoverState Indicates
whether the PDU Session Modification being reported was due to a handover.
Shall be present if this IE is in the SMContextUpdatedData or sent by the SMF
(see TS 29.502 [16] clause 6.1.6.2.3). C gTPTunnelInfo Contains the
information for the User Plane GTP Tunnels for the PDU Session (see TS 29.502
[16] clauses 6.1.6.2.2, 6.1.6.2.9 and 6.1.6.2.39). See Table 6.2.3-1B. M
pCCRules Set of PCC rules related to traffic influence. Each PCC rule
influences the routing of a given traffic flow. If several flows are
concerned, then several PCC rules shall be handled by the SMF. Traffic
influence policies are orginated by an AF. PCF translates these rules into PCC
rules for traffic influence. The payload of a PCC rule for traffic influence
is defined in Table 6.2.3-1E. C ePSPDNConnectionModification Provides details
about PDN Connections when the SMFPDUSessionModification xIRI message is used
to report PDN Connection Modification. See Table 6.3.3-8 and clause 6.3.3.2.3.
C uPPathChange Notification of the UPPathChange event, if available. This IE
is defined in TS 29.508 [90], Table 5.6.2.5-1. C pFDDataForApp Represents the
packet flow descriptions (PFDs) for an application identifier (AppId), if
available. This IE is defined in TS 29.551 [94], Table 5.6.2.2-1. C
* * *
Table 6.2.3-2A: Payload of UPPathChange
* * *
Field name Description M/C/O sourceDNAI Source DNAI, if the DNAI has changed.
DNAI represents the location of applications towards which the traffic routing
should apply. C targetDNAI Target DNAI if the DNAI has changed. C
dNAIChangeType Type of a DNAI change. Possible values are \"early\", \"late\"
and \"earlyAndLate\" notification of UP path reconfiguration. C
sourceUEIPAddress The IPv4 Address of the served UE for the source DNAI, if
available. C targetUEIPAddress The IPv4 Address of the served UE for the
target DNAI, if available. C sourceTrafficRouting N6 traffic routing
information for the source DNAI, if available. C targetTrafficRouting N6
traffic routing information for the target DNAI, if available. C mACAddress
The MAC address of the served UE, if available. C
* * *
Table 6.2.3-2B: Payload of PFDDataForApp
* * *
Field name Description M/C/O appId Identifier of an application M pFDs PFDs
for an application identifier, if available. PFD is defined in TS 29.551 [94],
Table 5.6.2.5-1. C
* * *
Table 6.2.3-2C: Payload of PFD
* * *
Field name Description M/C/O pFDId PFD identifier M pFDflowDescription
Represents a set of 3-tuple with protocol, server IP address and server port
for UL/DL application traffic, if available. C uRLs Represents a set of URL,
if available. C domainNames Represents a set of FQDN, if available. C
dnProtocol Indicates the additional protocol and protocol field for domain
names to be matched, if available. This IE is defined in 29.122 [63], Table
5.14.2.2.4-1. C
* * *
##### 6.2.3.2.4 PDU session release
The IRI-POI in the SMF shall generate an xIRI containing an
SMFPDUSessionRelease record when the IRI-POI present in the SMF detects that a
single-access PDU session has been released. The IRI-POI present in the SMF
shall generate the xIRI for the following events:
\- For a non-roaming scenario, the SMF (or for a roaming scenario, V-SMF in
the VPLMN), receives the N1 NAS message (via AMF) PDU SESSION RELEASE COMPLETE
from the UE and the 5GSM state within the SMF is changed to PDU SESSION
INACTIVE (see TS 24.501 [13]). This applies to the following two cases:
\- UE initiated PDU session release.
\- Network initiated PDU session release.
\- For a non-roaming scenario, the SMF (or for a roaming scenario, V-SMF in
the VPLMN), receives the N1 NAS message (via AMF) STATUS from the UE with the
cause values listed in TS 24.501 [13], clause 6.5.3 and the 5GSM state within
the SMF is changed to PDU SESSION INACTIVE. One of the cases where this
applies is of UE finding that the PDU session ID received in a PDU SESSION
MODIFICATION COMMAND is invalid.
\- For a non-roaming scenario, the SMF (or for a roaming scenario, the V-SMF
in the VPLMN) sends the Nsmf_PDUSession_ReleaseSMContext Response to the AMF
(see TS 29.502 [16], clause 5.2.2.4). This applies to the case where the PDU
session is released without any N1 or N2 messages (e.g. AMF initiates the PDU
session release when it finds that the PDU session is no longer associated
with the UE, see TS 23.502 [4], clause 4.2.2.4).
\- For a non-roaming scenario, the SMF (or for a roaming scenarios, V-SMF in
the VPLMN) sends Nsmf_PDUSession_SMContextStatusNotify (see TS 29.502 [16],
clause 6.1.6.2.8) with RELEASED in the ResourceStatus IE (see TS 29.502 [16],
clause 6.1.6.3.1) to the AMF. This applies to the case where PDU session
release is neither initiated by a NAS message nor by
Nsmf_PDUSessionReleaseSMContext Request message (see TS 29.502 [16], clause
5.2.2.5).
\- For a home-routed roaming scenario, the SMF in the HPLMN (i.e. H-SMF)
receives the N16: Nsmf_PDU_Session_Update response message with n1SmInfoFromUe
IE containing the PDU SESSION RELEASE COMPLETE (see TS 29.502 [16]) from the
V-SMF. This applies to the following three cases:
\- UE initiated PDU session release.
\- Network (VPLMN) initiated PDU session release.
\- Network (HPLMN) initiated PDU session release.
\- For a roaming scenario, H-SMF in the HPLMN sends the
Nsmf_PDUSession_Release Response to the V-SMF (see TS 29.502 [16], clause
5.2.2.9). This applies to the case where the PDU session is released without
any N1 or N2 messages (e.g. AMF in the VPLMN initiates the PDU session release
when it finds that the PDU session is no longer associated with the UE, see TS
23.502 [4], clause 4.3.4.3).
\- For a roaming scenario, H-SMF in the HPLMN sends a
Nsmf_PDUSession_StatusNotify (see TS 29.502 [16], clause 6.1.6.2.17) with
RELEASED in the ResourceStatus IE (see TS 29.502 [16], clause 6.1.6.3.1) to
the V-SMF. This applies to the case where PDU session release is neither
initiated by a NAS message nor by Nsmf_PDUSessionRelease Request message (see
TS 29.502 [16], clause 5.2.2.9).
Table 6.2.3-3: Payload for SMFPDUSessionRelease record
* * *
Field name Description M/C/O sUPI SUPI associated with the PDU session. M pEI
PEI associated with the PDU session if available. C gPSI GPSI associated with
the PDU session if available. C pDUSessionID PDU Session ID as assigned by the
AMF. M timeOfFirstPacket Time of first packet for the PDU session. C
timeOfLastPacket Time of last packet for the PDU session. C uplinkVolume
Number of uplink octets for the PDU session. C downlinkVolume Number of
downlink octets for the PDU session. C location Location information, if
available. C cause Indicates the NF Service Consumer cause for the requested
PDU session release (see TS 29.502 [16] clause 6.1.6.3.8 for enumerated cause
information). Include if known. C ePS5GSComboInfo Provides detailed
information about PDN Connections associated with the reported PDU Session.
This parameter may include the additional IEs in Table 6.2.3-1A, when
available. C nGAPCause Indicates the NGAP cause for the requested SM context
release (see TS 29.502 [16] clause 6.1.6.2.6). Shall be derived as described
in TS 29.571 [17] clause 5.4.4.12. C fiveGMMCause Indicates the 5GMM cause for
a PDU Session released due to any 5GMM failure (see 29.502 [16] clause
6.1.6.2.6). Shall be sent as an integer derived as described in TS 29.571 [17]
clause 5.4.2. C pCCRuleIDs PCC rule IDs of the PCC rules related to traffic
influence that are associated to the PDU session and active at the time the
PDU session is released. C ePSPDNConnectionRelease Provides details about PDN
Connections when the SMFPDUSessionRelease xIRI message is used to report PDN
Connection Release. See Table 6.3.3-13 and clause 6.3.3.2.4. C
* * *
##### 6.2.3.2.5 Start of interception with an established PDU session
The IRI-POI in the SMF shall generate an xIRI containing an
SMFStartOfInterceptionWithEstablishedPDUSession record when the IRI-POI
present in the SMF detects that a single-access PDU session has already been
established for the target UE when interception starts.
In a non-roaming scenario, the IRI-POI in the SMF (or in a roaming scenario,
the IRI-POI in the V-SMF in the VPLMN) shall generate the xIRI containing the
SMFStartOfInterceptionWithEstablishedPDUSession record when it detects that a
new interception for a UE is activated (i.e. provisioned by the LIPF) for the
following case:
\- The 5GSM state within the SMF for that UE is 5GSM: PDU SESSION ACTIVE or
PDU SESSION MODIFICATION PENDING.
NOTE: The above trigger happens when the SMF (V-SMF in VPLMN) had not sent an
N1 NAS message PDU SESSION RELEASE COMMAND to the UE for a PDU session and the
SMF (V-SMF in the VPLMN) had previously sent an N1 NAS message PDU SESSION
ESTABLISHMENT ACCEPT to that UE for the same PDU session.
In a home-routed roaming scenario, the IRI-POI in the H-SMF shall generate the
xIRI containing the SMFStartOfInterceptionWithEstablishedPDUSession record
when it detects that a new interception for a UE is activated (i.e.
provisioned by the LIPF) for the following case:
\- The H-SMF had not sent a Nsmf_PDU_Session_Update Request (n1SmInfoToUe: PDU
SESSION RELEASE COMMAND) to the V-SMF for a PDU session and H-SMF had
previously sent a Nsmf_PDU_Session_Create response (n1SmInfoToUE: PDU SESSION
ESTABLISHMENT ACCEPT) to the V-SMF for that PDU session.
The IRI-POI in the SMF shall generate the xIRI containing the
SMFStartOfInterceptionWithEstablishedPDUSession record for each of the PDU
sessions (that meets the above criteria) associated with the newly identified
target UEs.
Table 6.2.3-4: Payload for SMFStartOfInterceptionWithEstablishedPDUSession
record
* * *
Field name Description M/C/O
sUPI SUPI associated with the PDU session (e.g. as provided by the AMF in the
associated Nsmf_PDU_Session_CreateSMContext service operation). Shall be
present except for PEI-only unauthenticated emergency sessions. C
sUPIUnauthenticated Shall be present if a SUPI is present in the message and
set to "true" if the SUPI has not been authenticated, or "false" if it has
been authenticated. C
pEI PEI associated with the PDU session if available. C
gPSI GPSI associated with the PDU session if available. C
pDUSessionID PDU Session ID as assigned by the AMF, as defined in TS 24.007
[14] clause 11.2.3.1b. M
gTPTunnelID Contains the F-TEID identifying the UPF endpoint of the GTP tunnel
used to encapsulate the traffic derived from the UL NG-U UP TNL Information
(see TS 38.413 clause 9.3.4.1), as defined in TS 29.244 [15] clause 8.2.3.
Non-GTP encapsulation is for further study. M
pDUSessionType Identifies selected PDU session type, see TS 24.501 [13] clause
9.11.4.11. M
sNSSAI Slice identifier associated with the PDU session, if available. See TS
23.003 [19] clause 28.4.2 and TS 23.501 [2] clause 5.15.2. C
uEEndpoint UE endpoint address(es) if available. IP addresses are given as 4
octets (for IPv4) or 16 octets (for IPv6) with the most significant octet
first (network byte order). MAC addresses are given as 6 octets with the most
significant octet first (see TS 29.244 [15] clause 5.21). C
non3GPPAccessEndpoint UE\'s local IP address used to reach the N3IWF, TNGF or
TWIF, if available. IP addresses are given as 4 octets (for IPv4) or 16 octets
(for IPv6) with the most significant octet first (network byte order). C
location Location information provided by the AMF at session establishment or
present in the context at the SMF, if available. C
dNN Data Network Name associated with the target traffic, as defined in TS
23.003 [19] clause 9A and described in TS 23.502 [4] clause 4.3.2.2. Shall be
given in dotted-label presentation format as described in TS 23.003 [19]
clause 9.1. M
aMFID Identifier of the AMF associated with the target UE, as defined in TS
23.003 [19] clause 2.10.1, if available. C
hSMFURI URI of the Nsmf_PDUSession service of the selected H-SMF, if
available. See TS 29.502 [16] clause 6.1.6.2.2. C
requestType Type of request as initially set within the PDU SESSION
ESTABLISHMENT as described in TS 24.501 [13] clause 9.11.3.47.\ M If the
initial value is no longer available the request type shall be set to
"existing PDU session".
accessType Access type associated with the session (i.e. 3GPP or non-3GPP
access) if provided by the AMF (see TS 24.501 [13] clause 9.11.2.1A). C
rATType RAT type associated with the access if provided by the AMF as part of
session establishment (see TS 23.502 [4] clause 4.3.2). Values given as per TS
29.571 [17] clause 5.4.3.2. C
sMPDUDNRequest Contents of the SM PDU DN request container, if available, as
described in TS 24.501 [13] clause 9.11.4.15. C
timeOfSessionEstablishment Time at which the session establishment occurred,
if available. Shall be given qualified with time zone information (i.e. as UTC
or offset from UTC, not as local time). C
ePS5GSComboInfo Provides detailed information about PDN Connections associated
with the reported PDU Session. Shall be included when the AMF has selected a
SMF+PGW-C to serve the PDU session. This parameter may include the additional
IEs in table 6.2.3-1A, if available. C
uEEPSPDNConnection This IE shall be present, if available, during an EPS to
5GS Idle mode mobility or handover using the N26 interface. If present, it
shall contain the EPS bearer context(s) information present in the
uEEPSPDNConnection parameter of the intercepted SmContextCreateData message.
(see TS 29.502 [16] clause 6.1.6.2.2). C
servingNetwork Indicates the serving core network operator PLMN, and for an
SNPN, the NID. Shall be present if present in the PDU Session Context or SM
Context at the SMF (see TS 29.502 [16] clause 6.1.6.2.39). C
gTPTunnelInfo Contains the information for the User Plane GTP Tunnels for the
PDU Session (see TS 29.502 [16] clauses 6.1.6.2.2, 6.1.6.2.9 and 6.1.6.2.39).
See Table 6.2.3-1B. M
pCCRules Set of PCC rules related to traffic influence. Each PCC rule
influences the routing of a given traffic flow. If several flows are
concerned, then several PCC rules shall be handled by the SMF. Traffic
influence policies are orginated by an AF. PCF translates these rules into PCC
rules for traffic influence. The payload of a PCC rule for traffic influence
is defined in Table 6.2.3-1E. C
ePSStartOfInterceptionWithEstablishedPDNConnection Provides details about PDN
Connections when the SMFStartOfInterceptionWithEstablishedPDUSession xIRI
message is used to report the start of interception on a target who already
has existing PDN Connections. See Table 6.3.3-14 and clause 6.3.3.2.5. C
pFDDataForApps Represents a set of associations between application identifier
and packet flow descriptions (PFDs). C
* * *
The IRI-POI present in the SMF generating an xIRI containing a
SMFStartOfInterceptionWithEstablishedPDUSession record shall set the Payload
Direction field in the PDU header to _not applicable_ (Direction Value 5, see
ETSI TS 103 221-2 [8] clause 5.2.6).
##### 6.2.3.2.6 SMF unsuccessful procedure
The IRI-POI in the SMF shall generate an xIRI containing an
SMFUnsuccessfulProcedure record when the IRI-POI present in the SMF detects an
unsuccessful procedure or error condition for a UE matching one of the target
identifiers provided via LI_X1.
Accordingly, the IRI-POI in the SMF generates the xIRI when one of the
following events are detected:
\- SMF sends a PDU SESSION ESTABLISHMENT REJECT message to the target UE.
\- SMF sends a PDU SESSION MODIFICATION REJECT message to the target UE.
\- SMF sends a PDU SESSION RELEASE REJECT message to the target UE.
\- SMF receives a PDU SESSION MODIFICATION COMMAND REJECT message from the
target UE.
\- An ongoing SM procedure is aborted at the SMF, due to e.g. a 5GSM STATUS
message sent from or received by the SMF.
Table 6.2.3-5: Payload for SMFUnsuccessfulProcedure record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +=============================+=============================+=======+ | failedProcedureType | Specifies the procedure | M | | | which failed or is aborted | | | | at the SMF. | | +-----------------------------+-----------------------------+-------+ | failureCause | Provides the value of the | M | | | 5GSM cause, see TS 24.501 | | | | [13] clause 9.11.4.2. In | | | | case the procedure is | | | | aborted due to a 5GSM | | | | STATUS message, the 5GSM | | | | cause is the one included | | | | in the 5GSM status message. | | +-----------------------------+-----------------------------+-------+ | requestedSlice | Slice requested for the | C | | | procedure, if available, | | | | given as a NSSAI (a list of | | | | S-NSSAI values as described | | | | in TS 24.501 [13] clause | | | | 9.11.3.37). | | +-----------------------------+-----------------------------+-------+ | initiator | Specifies whether the | M | | | network (SMF) or the UE is | | | | initiating the rejection or | | | | indicating the failure. | | +-----------------------------+-----------------------------+-------+ | sUPI | SUPI associated with the | C | | | procedure, if available | | | | (see NOTE). | | +-----------------------------+-----------------------------+-------+ | sUPIUnauthenticated | Shall be present if a SUPI | C | | | is present in the message | | | | and set to "true" if the | | | | SUPI has not been | | | | authenticated, or "false" | | | | if it has been | | | | authenticated. | | +-----------------------------+-----------------------------+-------+ | pEI | PEI used in the procedure, | C | | | if available (see NOTE). | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI used in the procedure, | C | | | if available (see NOTE). | | +-----------------------------+-----------------------------+-------+ | pDUSessionID | PDU Session ID See clause | C | | | 9.4 of TS 24.501 [13], if | | | | available. | | +-----------------------------+-----------------------------+-------+ | uEEndpoint | UE endpoint address(es) if | C | | | available. | | +-----------------------------+-----------------------------+-------+ | non3GPPAccessEndpoint | UE\'s local IP address used | C | | | to reach the N3IWF, TNGF or | | | | TWIF, if available. | | +-----------------------------+-----------------------------+-------+ | location | Location information | C | | | provided by the AMF or | | | | present in the context at | | | | the SMF, if available. | | +-----------------------------+-----------------------------+-------+ | dNN | Data Network Name | C | | | associated with the target | | | | traffic, as defined in TS | | | | 23.003 [19] clause 9A and | | | | described in TS 23.501 | | | | [2] clause 4.3.2.2, if | | | | available. Shall be given | | | | in dotted-label | | | | presentation format as | | | | described in TS 23.003 | | | | [19] clause 9.1. | | +-----------------------------+-----------------------------+-------+ | aMFID | Identifier of the AMF | C | | | associated with the target | | | | UE, as defined in TS 23.003 | | | | [19] clause 2.10.1 when | | | | available. | | +-----------------------------+-----------------------------+-------+ | hSMFURI | URI of the Nsmf_PDUSession | C | | | service of the selected | | | | H-SMF, if available. See TS | | | | 29.502 [16] clause | | | | 6.1.6.2.2. | | +-----------------------------+-----------------------------+-------+ | requestType | Type of request as | C | | | described in TS 24.501 | | | | [13] clause 9.11.3.47, if | | | | available. | | | | | | | | Otherwise depending on the | | | | REJECT event the following | | | | request type shall be | | | | reported:\ | | | | PDU SESSION ESTABLISHMENT | | | | REJECT: The request type | | | | shall be set to the one | | | | reported within the PDU | | | | SESSION ESTABLISHMENT or if | | | | there hasn\'t been one | | | | reported or is no longer | | | | available it should be set | | | | to \"initial request\".\ | | | | PDU SESSION MODIFICATION | | | | REJECT: \"modification | | | | request".\ | | | | PDU SESSION RELEASE REJECT: | | | | no request type shall be | | | | set.\ | | | | PDU SESSION MODIFICATION | | | | COMMAND REJECT: | | | | \"modification request". | | +-----------------------------+-----------------------------+-------+ | accessType | Access type associated with | C | | | the session (i.e. 3GPP or | | | | non-3GPP access) if | | | | provided by the AMF (see TS | | | | 24.501 [13] clause | | | | 9.11.2.1A). | | +-----------------------------+-----------------------------+-------+ | rATType | RAT Type associated with | C | | | the access if provided by | | | | the AMF as part of session | | | | establishment (see TS | | | | 23.502 [4] clause 4.3.2). | | | | Values given as per TS | | | | 29.571 [17] clause | | | | 5.4.3.2. | | +-----------------------------+-----------------------------+-------+ | sMPDUDNRequest | Contents of the SM PDU DN | C | | | Request container, if | | | | available, as described in | | | | TS 24.501 [13] clause | | | | 9.11.4.15. | | +-----------------------------+-----------------------------+-------+ | NOTE: At least one identity | | | | shall be provided, the | | | | others shall be provided if | | | | available. | | | +-----------------------------+-----------------------------+-------+
##### 6.2.3.2.7 MA PDU sessions
##### 6.2.3.2.7.1 General {#general-12 .H6}
In the present document, an MA PDU session will include two general types of
PDU sessions as defined below:
\- MA-Confirmed: This is an MA PDU session where the UE signals Upgrade
Allowed to MA and the network immediately upgrades the session to an MA PDU
session or the UE explicitly requests an MA PDU session (using a Request Type
of MA PDU).
\- MA-Upgrade-Allowed: This is a PDU session where the UE indicated that
upgrade to an MA PDU session is allowed, but the network does not immediately
confirm the upgrade. The network may at some later point upgrade the session
to an MA PDU session.
NOTE: The above terms are not defined or used in other 3GPP Stage 2 or Stage 3
specifications, but have been introduced here to clarify and distinguish LI
event reporting for the respective situations.
An MA-Confirmed MA PDU session may be established over a single access or over
multiple accesses. The establishment over multiple accesses may occur
concurrently or may occur at different points in time.
An MA-Upgrade-Allowed MA PDU session is established over a single access and
nearly all aspects appears to be an ordinary non-MA PDU session with the key
difference that the network may upgrade the session to an MA-confirmed MA PDU
session.
##### 6.2.3.2.7.2 MA PDU session establishment {#ma-pdu-session-establishment
.H6}
The IRI-POI in the SMF shall generate an xIRI containing an
SMFMAPDUSessionEstablishment record when the IRI-POI present in the SMF
detects that a PDU session has been established for the target UE that is an
MA PDU session (Request Type set to MA PDU session or upgraded at
establishment), or where the upgrade allowed parameter is set to upgrade
allowed and session is established as an ordinary PDU session (not upgraded at
establishment, but may occur later on). The IRI-POI present in the SMF shall
generate the xIRI for the following events:
\- For a non-roaming scenario , the SMF sends the N1 NAS message (via AMF) PDU
Session Establishment Accept to the UE for a new PDU session and the 5G
Session Management (5GSM) state within the SMF is changed to PDU SESSION
ACTIVE (see TS 24.501 [13]) in response to a PDU Session Establishment request
received along with:
\- PDU Session ID which does not identify an existing PDU session, and
\- Request Type = MA PDU request, or
\- Request Type = initial request and MA PDU session information set to \"MA
PDU session network upgrade is allowed\", with either upgrade occuring at
establishment or upgrade does not occur at establishment but may occur later.
\- For a home-routed roaming scenario, the SMF in the HPLMN (i.e. H-SMF) sends
the N16: Nsmf_PDU_Session_Create response message with n1SmInfoToUe IE
containing the PDU SESSION ESTABLISHMENT ACCEPT (see TS 29.502 [16]) for a new
PDU session in response to a PDU Session Establishment request received along
with:
\- PDU Session ID which does not identify an existing PDU session, and
\- Request Type = MA PDU request, or
\- Request Type = initial request and MA PDU session information set to \"MA
PDU session network upgrade is allowed\", with either upgrade occuring at
establishment or upgrade does not occur at establishment but may occur later.
If the Npcf_SMPolicyControl_Create response received from the PCF for the
target UE in response to Npcf_SMPolicyControl_Create request includes PCC
rules in which the traffic control policy data contains either a routeToLocs
IE or trafficSteeringPolIdDl IE and/or trafficSteeringPolIdUl IE, then the SMF
shall include those PCC rules in the xIRI. These PCC rules correspond to
policies that influence the target UE's traffic flows (see TS 29.513 [88]
clause 5.5.3).
Table 6.2.3-5A: Payload for SMFMAPDUSessionEstablishment record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | sUPI | SUPI associated with the | C | | | PDU session (e.g. as | | | | provided by the AMF in the | | | | associated | | | | Nsmf_PD | | | | U_Session_CreateSMContext | | | | service operation). Shall | | | | be present except for | | | | PEI-only unauthenticated | | | | emergency sessions (see | | | | NOTE). | | +-----------------------------+-----------------------------+-------+ | sUPIUnauthenticated | Shall be present if a SUPI | C | | | is present in the message | | | | and set to "true" if the | | | | SUPI has not been | | | | authenticated, or "false" | | | | if it has been | | | | authenticated. | | +-----------------------------+-----------------------------+-------+ | pEI | PEI associated with the PDU | C | | | session if available (see | | | | NOTE). | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI associated with the | C | | | PDU session if available | | | | (see NOTE). | | +-----------------------------+-----------------------------+-------+ | pDUSessionID | PDU Session ID See clause | M | | | 9.4 of TS 24.501 [13]. | | | | Identifies a new PDU | | | | session. | | +-----------------------------+-----------------------------+-------+ | pDUSessionType | Identifies selected PDU | M | | | session type, see TS 24.501 | | | | [13] clause 9.11.4.11. | | +-----------------------------+-----------------------------+-------+ | accessInfo | Identifies the access(es) | M | | | associated with the PDU | | | | session including the | | | | information for each | | | | specific access (see table | | | | 6.2.3-5B) | | +-----------------------------+-----------------------------+-------+ | sNSSAI | Slice identifiers | C | | | associated with the PDU | | | | session, if available. See | | | | TS 23.003 [19] clause | | | | 28.4.2 and TS 23.501 [2] | | | | clause 5.15.2. | | +-----------------------------+-----------------------------+-------+ | uEEndpoint | UE endpoint address(es) | C | | | assigned to the PDU Session | | | | if available (see TS 29.244 | | | | [15] clause 5.21). | | +-----------------------------+-----------------------------+-------+ | location | Location information | C | | | provided by the AMF or | | | | present in the context at | | | | the SMF, if available. | | +-----------------------------+-----------------------------+-------+ | dNN | Data Network Name requested | M | | | by the target UE, as | | | | defined in TS 23.003 [19] | | | | clause 9A and described in | | | | TS 23.502 [4] clause | | | | 4.3.2.2. Shall be given in | | | | dotted-label presentation | | | | format as described in TS | | | | 23.003 [19] clause 9.1. | | +-----------------------------+-----------------------------+-------+ | aMFID | Identifier of the AMF | C | | | associated with the target | | | | UE, as defined in TS 23.003 | | | | [19] clause 2.10.1 when | | | | available. | | +-----------------------------+-----------------------------+-------+ | hSMFURI | URI of the Nsmf_PDUSession | C | | | service of the selected | | | | H-SMF, if available. See TS | | | | 29.502 [16] clause | | | | 6.1.6.2.2. | | +-----------------------------+-----------------------------+-------+ | requestType | Type of request as | M | | | described in TS 24.501 | | | | [13] clause 9.11.3.47 | | | | provided within the | | | | Nsmf_PD | | | | U_Session_CreateSMContext | | | | Request (TS 29.502 [16]) | | | | message shall be reported. | | | | | | | | In the case where the | | | | network does not provide a | | | | request type value for a MA | | | | PDU session and the network | | | | does support MA PDU | | | | sessions, the request type | | | | shall be set to "MA PDU | | | | request" according to TS | | | | 24.501 [13] clause | | | | 6.4.1.2. | | +-----------------------------+-----------------------------+-------+ | sMPDUDNRequest | Contents of the SM PDU DN | C | | | Request container, if | | | | available, as described in | | | | TS 24.501 [13] clause | | | | 9.11.4.15. | | +-----------------------------+-----------------------------+-------+ | servingNetwork | PLMN ID of the serving core | M | | | network operator, and, for | | | | a Non-Public Network (NPN), | | | | the NID that together with | | | | the PLMN ID identifies the | | | | NPN. | | +-----------------------------+-----------------------------+-------+ | oldPDUSessionID | The old PDU Session ID | C | | | received from the UE. See | | | | TS 23.502 [4] clauses | | | | 4.3.2.2.1 and 4.3.5.2 and | | | | TS 24.501 [13] clause | | | | 6.4.1.2. Shall be present | | | | if this IE is in the | | | | SMContextCreateData or | | | | PDUSessionCreateData | | | | message sent to the SMF or | | | | the PDU Session Context or | | | | SM Context at the SMF (see | | | | TS 29.502 [16] clauses | | | | 6.1.6.2.2, 6.1.6.2.9 and | | | | 6.1.6.2.39). | | +-----------------------------+-----------------------------+-------+ | mAUpgradeIndication | Indicates whether the PDU | C | | | session is allowed to be | | | | upgraded to MA-Confirmed MA | | | | PDU session (see | | | | TS 23.502 [4] clause | | | | 4.22.3). Include if known. | | +-----------------------------+-----------------------------+-------+ | ePSPDNCnxInfo | Indicates if the PDU | C | | | session may be moved to EPS | | | | during its lifetime (see TS | | | | 29.502 [16] clause | | | | 6.1.6.2.31). Include if | | | | known. | | +-----------------------------+-----------------------------+-------+ | mAAcceptedIndication | Indicates that a request to | M | | | establish an MA PDU session | | | | was accepted or if a single | | | | access PDU session request | | | | was upgraded into a MA PDU | | | | session (see | | | | TS 23.502 [4] clauses | | | | 4.22.2 and 4.22.3). | | | | | | | | It shall be set as follows: | | | | | | | | - true: MA-Confirmed MA | | | | PDU session was established | | | | | | | | - false: single access | | | | MA-Upgrade-Allowed MA PDU | | | | session was established | | | | that may be upgraded to an | | | | MA-Confirmed MA PDU | | | | session. | | +-----------------------------+-----------------------------+-------+ | aTSSSContainer | Identifies the steering, | C | | | switching, and splitting | | | | features for the | | | | MA-Confirmed MA PDU | | | | session. Also indicates | | | | whether MPTCP or ATSSS-LL | | | | is to be used for ATSSS. | | | | See TS 24.501[13] clause | | | | 9.11.4.22. | | +-----------------------------+-----------------------------+-------+ | uEEPSPDNConnection | This IE shall be present, | C | | | if available, during an EPS | | | | to 5GS Idle mode mobility | | | | or handover using the N26 | | | | interface. If present, it | | | | shall contain the EPS | | | | bearer context(s) | | | | information present in the | | | | uEEPSPDNConnection | | | | parameter of the | | | | intercepted | | | | SmContextCreateData | | | | message. (see TS 29.502 | | | | [16] clause 6.1.6.2.2). | | +-----------------------------+-----------------------------+-------+ | ePS5GSComboInfo | Provides detailed | C | | | information about PDN | | | | Connections and PDU | | | | Sessions during EPS to 5GS | | | | idle mode mobility or | | | | handover using the N26 | | | | interface. Shall be | | | | included if the AMF has | | | | selected a SMF+PGW-C to | | | | serve the PDU session. This | | | | parameter shall include the | | | | additional IEs in Table | | | | 6.2.3-1A, if present. | | +-----------------------------+-----------------------------+-------+ | selectedDNN | Shall be present if a DNN | C | | | other than the UE requested | | | | DNN is selected for the PDU | | | | Session. Shall be given in | | | | dotted-label presentation | | | | format as described in TS | | | | 23.003 [19] clause 9.1. | | +-----------------------------+-----------------------------+-------+ | handoverState | Indicates whether the PDU | C | | | Session Establishment being | | | | reported was due to a | | | | handover. Shall be present | | | | if this IE is in the | | | | SMContextCreatedData sent | | | | by the SMF (see TS 29.502 | | | | [16] clause 6.1.6.2.3). | | +-----------------------------+-----------------------------+-------+ | pCCRules | Set of PCC rules related to | C | | | traffic influence. Each PCC | | | | rule influences the routing | | | | of a given traffic flow. If | | | | several flows are | | | | concerned, then several PCC | | | | rules shall be handled by | | | | the SMF. Traffic influence | | | | policies are orginated by | | | | an AF. PCF translates these | | | | rules into PCC rules for | | | | traffic influence. The | | | | payload of a PCC rule for | | | | traffic influence is | | | | defined in Table 6.2.3-1E. | | +-----------------------------+-----------------------------+-------+ | eP | Provides details about PDN | C | | SPDNConnectionEstablishment | Connections when the | | | | S | | | | MFMAPDUSessionEstablishment | | | | xIRI message is used to | | | | report PDN Connection | | | | establishment. See Table | | | | 6.3.3-1 and clause | | | | 6.3.3.2.2. | | +-----------------------------+-----------------------------+-------+ | NOTE: At least one of the | | | | SUPI, PEI or GPSI fields | | | | shall be present. | | | +-----------------------------+-----------------------------+-------+
Table 6.2.3-5B: Contents of Access Info parameter
* * *
Field name Description M/C/O accessType Access type associated with the
session (i.e. 3GPP or non-3GPP access) as provided by the AMF (see TS 24.501
[13] clause 9.11.2.1A). M rATType RAT Type associated with the access as
provided by the AMF as part of session establishment (see TS 23.502 [4] clause
4.3.2). Values given as per TS 29.571 [17] clause 5.4.3.2. C gTPTunnelID
Contains the F-TEID identifying the GTP tunnel used to encapsulate the
traffic, as defined in TS 29.244 [15] clause 8.2.3. Non-GTP encapsulation is
for further study. M non3GPPAccessEndpoint UE\'s local IP address used to
reach the N3IWF, TNGF or TWIF, if available. IP addresses are given as 4
octets (for IPv4) or 16 octets (for IPv6) with the most significant octet
first (network byte order). C establishmentStatus Indicates whether the access
type is established or released. M aNTypeToReactivate Indicates the Access
Network Type for which the UP connection is requested to be re-activated, for
an MA PDU session. Applicable to session modification reporting. C
gTPTunnelInfo Contains the information for the User Plane GTP Tunnels for the
PDU Session (see TS 29.502 [16] clauses 6.1.6.2.2, 6.1.6.2.9 and 6.1.6.2.39).
See Table 6.2.3-1B. M
* * *
##### 6.2.3.2.7.3 MA PDU session modification {#ma-pdu-session-modification
.H6}
The IRI-POI in the SMF shall generate an xIRI containing an
SMFMAPDUSessionModification record when the IRI-POI present in the SMF detects
that an MA PDU session has been modified for the target UE. The IRI-POI
present in the SMF shall generate the xIRI for the following events:
\- For a non-roaming scenario, the SMF (or for a roaming scenario, V-SMF in
the VPLMN), receives the N1 NAS message (via AMF) PDU SESSION MODIFICATION
COMPLETE from the UE and the 5GSM state within the SMF is returned to PDU
SESSION ACTIVE (see TS 24.501 [13]). This applies to the following cases for
an MA-Upgrade-Allowed PDU session:
\- UE initiated MA PDU session modification.
\- Network initiated MA PDU session modification.
\- For a non-roaming scenario, the SMF (or for a roaming scenario, V-SMF in
the VPLMN), receives the N1 NAS message (via AMF) PDU SESSION RELEASE COMPLETE
from the UE in response to a PDU SESSION RELEASE COMMAND message containing an
Access type IE identifying a single access to be released of an MA PDU session
which was established over both accesses and the 5GSM state within the SMF
remains in the PDU SESSION ACTIVE (see TS 24.501 [13]). This applies to the
following case:
\- A single access type is released from an MA PDU session, but the MA PDU
session continues.
\- For a non-roaming scenario, the SMF (or for a roaming scenario, V-SMF in
the VPLMN), sends the N1 NAS message (via AMF) PDU SESSION ESTABLISHMENT
ACCEPT to the UE and the 5GSM state within the SMF remains in the PDU SESSION
ACTIVE (see TS 24.501 [13]). This applies to the following cases:
\- Handover from one access type to another access type happens (e.g. 3GPP to
non-3GPP) for an MA-Upgrade-Allowed MA PDU session.
\- MA PDU Session establishment over second access type.
\- For a home-routed roaming scenario, the SMF in the HPLMN (i.e. H-SMF)
receives the N16: Nsmf_PDU_Session_Update Response message with n1SmInfoFromUe
IE containing the PDU SESSION MODIFICATION COMPLETE (see TS 29.502 [16]). This
applies to the following cases for an MA-Upgrade-Allowed PDU session:
\- UE initiated MA PDU session modification.
\- Network (VPLMN) initiated MA PDU session modification.
\- Network (HPLMN) initiated MA PDU session modification.
\- For a non-roaming scenario, SMF sends a Nsmf_EventExposure_Notify request
to the NEF or AF for the target UE for the event \"UP Path Change\" related to
a corresponding subscription from AF (see TS 29.508 [90] clause 4.2.2).
\- For a non-roaming scenario, SMF sends a
Nsmf_EventExposure_AppRelocationInfo response to the NEF or AF for the target
UE in response to Nsmf_EventExposure_AppRelocationInfo request sent by NEF or
AF to SMF (see TS 29.508 [90] clause 4.2.5).
\- For a non-roaming scenario, SMF receives a Nnef_PFDManagement_Fetch
response from the NEF for the target UE in response to
Nnef_PFDManagement_Fetch request sent by SMF to NEF (see TS 29.551 [94] clause
4.2.2).
\- For a home-routed roaming scenario, the SMF in the HPLMN (i.e. H-SMF)
receives the N16: Nsmf_PDU_Session_Update Response message with n1SmInfoFromUe
IE containing the PDU SESSION RELEASE COMPLETE message, a response to a PDU
SESSION RELEASE COMMAND message containing an Access type IE identifying a
single access to be released of an MA PDU session which was established over
both accesses and the 5GSM state within the SMF remains in the PDU SESSION
ACTIVE (see TS 29.502 [16]). This applies to the following cases:
\- A single access type is released from an MA PDU session, but the MA PDU
session continues.
\- For a home-routed roaming scenario, the SMF in the HPLMN (i.e. H-SMF) sends
the N16: Nsmf_PDU_Session_Create Response message with n1SmInfoToUe IE
containing the PDU SESSION ESTABLISHMENT ACCEPT (see TS 29.502 [16]) while it
had received an N16 Nsmf_PDU_Session_Create request message with an existing
PDU Session Id with access type being changed. This applies to the following
cases:
\- Handover from one access type to another access type happens (e.g. 3GPP to
non-3GPP) for an MA-Upgrade-Allowed PDU session. In this case, the V-SMF is
used for the PDU session on the new access type only.
\- MA PDU Session establishment over second access type.
\- For a home-routed roaming scenario, the SMF in the HPLMN (i.e. H-SMF) sends
the N16: Nsmf_PDU_Session_Update Response message with n1SmInfoToUe IE
containing the PDU SESSION ESTABLISHMENT ACCEPT (see TS 29.502 [16]) while it
had received a N16 Nsmf_PDU_Session_Update Request message with an existing
PDU Session Id with access type being changed. This applies to the following
cases:
\- Handover from one access type to another access type happens (e.g. 3GPP to
non-3GPP) where the same V-SMF is used for the PDU session on both access
types.
\- MA PDU Session establishment over second access type.
For a non-roaming scenario, SMF sends a Npcf_SMPolicyControlUpdateNotify
response to the PCF for the target UE in response to an
Npcf_SMPolicyControlUpdateNotify request sent by PCF to SMF including PCC
rules which traffic control policy data contains either a routeToLocs IE or
trafficSteeringPolIdDl IE and/or trafficSteeringPolIdUl IE. These PCC rules
correspond to policies that influence the target UE's traffic flows (see TS
29.513 [88] clause 5.5.3).
Table 6.2.3-5C: Payload for SMFMAPDUSessionModification record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | sUPI | SUPI associated with the | C | | | PDU session (e.g. as | | | | provided by the AMF in the | | | | associated | | | | Nsmf_PD | | | | U_Session_CreateSMContext | | | | service operation). Shall | | | | be present except for | | | | PEI-only unauthenticated | | | | emergency sessions. | | +-----------------------------+-----------------------------+-------+ | sUPIUnauthenticated | Shall be present if a SUPI | C | | | is present in the message, | | | | and set to "true" if the | | | | SUPI was not authenticated, | | | | or "false" if it has been | | | | authenticated. | | +-----------------------------+-----------------------------+-------+ | pEI | PEI associated with the PDU | C | | | session if available. | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI associated with the | C | | | PDU session if available. | | +-----------------------------+-----------------------------+-------+ | pDUSessionID | PDU Session ID, see TS | M | | | 24.501 [13] clause 9.4. | | +-----------------------------+-----------------------------+-------+ | accessInfo | Identifies the access(es) | C | | | associated with the PDU | | | | session including the | | | | information for each | | | | specific access (see table | | | | 6.2.3-5B) being modified. | | +-----------------------------+-----------------------------+-------+ | sNSSAI | Slice identifier associated | C | | | with the PDU session, if | | | | available. See TS 23.003 | | | | [19] clause 28.4.2 and TS | | | | 23.501 [2] clause 5.15.2. | | +-----------------------------+-----------------------------+-------+ | location | Location information | C | | | provided by the AMF or | | | | present in the context at | | | | the SMF, if available. | | +-----------------------------+-----------------------------+-------+ | requestType | For both a UE- as well as a | C | | | network-requested PDU | | | | session, the POI (SMF) | | | | shall set the request type | | | | parameter to \"modification | | | | request\". | | +-----------------------------+-----------------------------+-------+ | servingNetwork | PLMN ID of the serving core | M | | | network operator, and, for | | | | a Non-Public Network (NPN), | | | | the NID that together with | | | | the PLMN ID identifies the | | | | NPN. | | +-----------------------------+-----------------------------+-------+ | oldPDUSessionID | The old PDU Session ID | C | | | received from the UE. See | | | | TS 23.502 [4] clauses | | | | 4.3.2.2.1 and 4.3.5.2 and | | | | TS 24.501 [13] clause | | | | 6.4.1.2. Shall be present | | | | if this IE is in the | | | | SMContextCreateData or | | | | PDUSessionCreateData | | | | message sent to the SMF or | | | | the PDU Session Context or | | | | SM Context at the SMF (see | | | | TS 29.502 [16] clauses | | | | 6.1.6.2.2, 6.1.6.2.9 and | | | | 6.1.6.2.39). | | +-----------------------------+-----------------------------+-------+ | mAUpgradeIndication | Indicates whether the PDU | C | | | session is allowed to be | | | | upgraded to MA PDU session | | | | (see TS 23.502 [4] clause | | | | 4.22.3). Include if known. | | +-----------------------------+-----------------------------+-------+ | ePSPDNCnxInfo | Indicates if the PDU | C | | | session may be moved to EPS | | | | during its lifetime (see TS | | | | 29.502 [16] clause | | | | 6.1.6.2.31). Include if | | | | known. | | +-----------------------------+-----------------------------+-------+ | mAAcceptedIndication | Indicates that a request to | M | | | establish an MA PDU session | | | | was accepted or if a single | | | | access PDU session request | | | | was upgraded into a MA PDU | | | | session (see clauses 4.22.2 | | | | and 4.22.3 of | | | | TS 23.502 [4]). | | | | | | | | It shall be set as follows: | | | | | | | | - true: MA-Confirmed MA | | | | PDU session was established | | | | | | | | - false: single access | | | | MA-Upgrade-Allowed MA PDU | | | | session was established | | | | that may be upgraded to an | | | | MA-Confirmed MA PDU | | | | session. | | +-----------------------------+-----------------------------+-------+ | aTSSSContainer | Identifies the steering, | C | | | switching, and splitting | | | | features for the | | | | MA-Confirmed MA PDU | | | | session. Also indicates | | | | whether MPTCP or ATSSS-LL | | | | is to be used for ATSSS. | | | | See clause 9.11.4.22 of TS | | | | 24.501 [13]. | | +-----------------------------+-----------------------------+-------+ | uEEPSPDNConnection | This IE shall be present, | C | | | if available, during an EPS | | | | to 5GS Idle mode mobility | | | | or handover using the N26 | | | | interface. If present, it | | | | shall contain the EPS | | | | bearer context(s) | | | | information present in the | | | | uEEPSPDNConnection | | | | parameter of the | | | | intercepted | | | | SmContextCreateData message | | | | (see TS 29.502 [16] | | | | clause 6.1.6.2.2). | | +-----------------------------+-----------------------------+-------+ | ePS5GSComboInfo | Provides detailed | C | | | information about PDN | | | | Connections and PDU | | | | Sessions during EPS to 5GS | | | | idle mode mobility or | | | | handover using the N26 | | | | interface. Shall be | | | | included if the AMF has | | | | selected a SMF+PGW-C to | | | | serve the PDU session. This | | | | parameter shall include the | | | | additional IEs in Table | | | | 6.2.3-1A, if present. | | +-----------------------------+-----------------------------+-------+ | handoverState | Indicates whether the PDU | C | | | Session Establishment being | | | | reported was due to a | | | | handover. Shall be present | | | | if this IE is in the | | | | SMContextCreatedData sent | | | | by the SMF (see TS 29.502 | | | | [16] clause 6.1.6.2.3). | | +-----------------------------+-----------------------------+-------+ | pCCRules | Set of PCC rules related to | C | | | traffic influence. Each PCC | | | | rule influences the routing | | | | of a given traffic flow. If | | | | several flows are | | | | concerned, then several PCC | | | | rules shall be handled by | | | | the SMF. Traffic influence | | | | policies are orginated by | | | | an AF. PCF translates these | | | | rules into PCC rules for | | | | traffic influence. The | | | | payload of a PCC rule for | | | | traffic influence is | | | | defined in Table 6.2.3-1E. | | +-----------------------------+-----------------------------+-------+ | uPPathChange | Notification of the | C | | | UPPathChange event, if | | | | available. This IE is | | | | defined in TS 29.508 | | | | [90], Table 5.6.2.5-1. | | +-----------------------------+-----------------------------+-------+ | pFDDataForApp | Represents the packet flow | C | | | descriptions (PFDs) for an | | | | application identifier | | | | (AppId), if available. This | | | | IE is defined in TS 29.551 | | | | [94], Table 5.6.2.2-1. | | +-----------------------------+-----------------------------+-------+ | e | Provides details about PDN | C | | PSPDNConnectionModification | Connections when the | | | | SMFMAPDUSessionModification | | | | xIRI message is used to | | | | report PDN Connection | | | | Establishment or | | | | Modification. See Table | | | | 6.3.3-8 and clause | | | | 6.3.3.2.3. | | +-----------------------------+-----------------------------+-------+
##### 6.2.3.2.7.4 MA PDU session release {#ma-pdu-session-release .H6}
The IRI-POI in the SMF shall generate an xIRI containing an
SMFMAPDUSessionRelease record when the IRI-POI present in the SMF detects that
an MA PDU session has been released. The IRI-POI present in the SMF shall
generate the xIRI for the following events:
\- For a non-roaming scenario, the SMF (or for a roaming scenario, V-SMF in
the VPLMN), receives the N1 NAS message (via AMF) PDU SESSION RELEASE COMPLETE
from the UE and the 5GSM state within the SMF is changed to PDU SESSION
INACTIVE (see TS 24.501 [13]) for a PDU session that is either MA-Confirmed or
MA-Upgrade-Allowed. This applies to the following two cases:
\- UE initiated MA PDU session release.
\- Network initiated MA PDU session release.
\- For a roaming scenario, V-SMF in the VPLMN receives the N1 NAS message (via
AMF) PDU SESSION RELEASE COMPLETE from the UE and the 5GSM state within the
V-SMF is changed to PDU SESSION INACTIVE (see TS 24.501 [13]) for a PDU
session that is either MA-Confirmed or MA-Upgrade-Allowed. This applies to the
following two cases:
\- UE initiated PDU session release of a single access for an MA PDU session;
(VPLMN considers MA PDU session fully released while HPLMN considers MA PDU
session active).
\- Network initiated PDU session release of a single access for an MA PDU
session; (VPLMN considers MA PDU session fully released while HPLMN considers
MA PDU session active).
\- For a non-roaming scenario, the SMF (or for a roaming scenario, V-SMF in
the VPLMN), receives the N1 NAS message (via AMF) STATUS from the UE with the
cause values listed in TS 24.501 [13], clause 6.5.3 and the 5GSM state within
the SMF is changed to PDU SESSION INACTIVE for a PDU session that is either
MA-Confirmed or MA-Upgrade-Allowed. One of the cases where this applies is of
UE finding that the PDU session ID received in a PDU SESSION MODIFICATION
COMMAND is invalid.
\- For a non-roaming scenario, the SMF (or for a roaming scenario, the V-SMF
in the VPLMN) sends the Nsmf_PDUSession_ReleaseSMContext Response to the AMF
(see TS 29.502 [16], clause 5.2.2.4) for a PDU session that is either MA-
Confirmed or MA-Upgrade-Allowed. This applies to the case where the MA PDU
session is released without any N1 or N2 messages (e.g. AMF initiates the PDU
session release when it finds that the PDU session is no longer associated
with the UE, see TS 23.502 [4], clause 4.2.2.4).
\- For a non-roaming scenario, the SMF (or for a roaming scenarios, V-SMF in
the VPLMN) sends Nsmf_PDUSession_SMContextStatusNotify (see TS 29.502 [16],
clause 6.1.6.2.8) with RELEASED in the ResourceStatus IE (see TS 29.502 [16],
clause 6.1.6.3.1) to the AMF for a PDU session that is either MA-Confirmed or
MA-Upgrade-Allowed. This applies to the case where MA PDU session release is
neither initiated by a NAS message nor by Nsmf_PDUSessionReleaseContext
Request message (see TS 29.502 [16], clause 5.2.2.5).
\- For a home-routed roaming scenario, the SMF in the HPLMN (i.e. H-SMF)
receives the N16: Nsmf_PDU_Session_Update response message with n1SmInfoFromUe
IE containing the PDU SESSION RELEASE COMPLETE (see TS 29.502 [16]) from the
V-SMF. This applies to the following three cases for an MA PDU session that is
either MA-Confirmed or MA-Upgrade-Allowed:
\- UE initiated PDU session release.
\- Network (VPLMN) initiated PDU session release.
\- Network (HPLMN) initiated PDU session release.
\- For a roaming scenario, H-SMF in the HPLMN sends the
Nsmf_PDUSession_Release Response to the V-SMF (see TS 29.502 [16], clause
5.2.2.9) for a PDU session that is either MA-Confirmed or MA-Upgrade-Allowed.
This applies to the case where the MA PDU session is released without any N1
or N2 messages (e.g. AMF in the VPLMN initiates the PDU session release when
it finds that the PDU session is no longer associated with the UE, see TS
23.502 [4], clause 4.3.4.3).
\- For a roaming scenario, H-SMF in the HPLMN Nsmf_PDUSession_StatusNotify
(see TS 29.502 [16], clause 6.1.6.2.17) with RELEASED in the ResourceStatus IE
(see TS 29.502 [16], clause 6.1.6.3.1) to the V-SMF for a PDU session that is
either MA-Confirmed or MA-Upgrade-Allowed. This applies to the case where MA
PDU session release is neither initiated by a NAS message nor by
Nsmf_PDUSessionRelease Request message (see TS 29.502 [16], clause 5.2.2.9).
Table 6.2.3-5D: Payload for SMFMAPDUSessionRelease record
* * *
Field name Description M/C/O sUPI SUPI associated with the PDU session. M pEI
PEI associated with the PDU session if available. C gPSI GPSI associated with
the PDU session if available. C pDUSessionID PDU Session ID as assigned by the
AMF. M timeOfFirstPacket Time of first packet for the PDU session. C
timeOfLastPacket Time of last packet for the PDU session. C uplinkVolume
Number of uplink octets for the PDU session. C downlinkVolume Number of
downlink octets for the PDU session. C location Location information, if
available. C cause Indicates the NF Service Consumer cause for the requested
PDU session release (see TS 29.502 [16] clause 6.1.6.3.8 for enumerated cause
information). Include if known. C nGAPCause Indicates the NGAP cause for the
requested SM context release (see TS 29.502 [16] clause 6.1.6.2.6). Shall be
derived as described in TS 29.571 [17] clause 5.4.4.12. C fiveGMMCause
Indicates the 5GMM cause for a PDU Session released due to any 5GMM failure
(see 29.502 [16] clause 6.1.6.2.6). Shall be sent as an integer derived as
described in TS 29.571 [17] clause 5.4.2. C pCCRulesIDs PCC rule IDs of the
PCC rules related to traffic influence that are associated to the PDU session
and active at the time the PDU session is released. C ePSPDNConnectionRelease
Provides details about PDN Connections when the SMFMAPDUSessionRelease xIRI
message is used to report PDN Connection Release. See Table 6.3.3-13 and
clause 6.3.3.2.4. C
* * *
##### 6.2.3.2.7.5 Start of interception with an established MA PDU session
{#start-of-interception-with-an-established-ma-pdu-session .H6}
The IRI-POI in the SMF shall generate an xIRI containing an
SMFStartOfInterceptionWithEstablishedMAPDUSession record when the IRI-POI
present in the SMF detects that a MA PDU session has already been established
for the target UE when interception starts.
In a non-roaming scenario, the IRI-POI in the SMF (or in a roaming scenario,
the IRI-POI in the V-SMF in the VPLMN) shall generate the xIRI containing the
SMFStartOfInterceptionWithEstablishedMAPDUSession record when it detects that
a new interception for a UE is activated (i.e. provisioned by the LIPF) for
the following case for an MA PDU session that is either MA-Confirmed or MA-
Upgrade-Allowed:
\- The 5GSM state within the SMF for that UE is 5GSM: PDU SESSION ACTIVE or
PDU SESSION MODIFICATION PENDING.
NOTE: The above trigger happens when the SMF (V-SMF in VPLMN) had not sent an
N1 NAS message PDU SESSION RELEASE COMMAND to the UE to release the entire MA
PDU session and the SMF (V-SMF in the VPLMN) had previously sent an N1 NAS
message PDU SESSION ESTABLISHMENT ACCEPT to that UE for the same MA PDU
session.
In a home-routed roaming scenario, the IRI-POI in the H-SMF shall generate the
xIRI containing the SMFStartOfInterceptionWithEstablishedMAPDUSession record
when it detects that a new interception for a UE is activated (i.e.
provisioned by the LIPF) for the following case for an MA PDU session that is
either MA-Confirmed or MA-Upgrade-Allowed:
\- The H-SMF had not sent an Nsmf_PDU_Session_Update Request (n1SmInfoToUe:
PDU SESSION RELEASE COMMAND to release the entire MA PDU session) to the V-SMF
for a PDU session and H-SMF had previously sent an Nsmf_PDU_Session_Create
response (n1SmInfoToUE: PDU SESSION ESTABLISHMENT ACCEPT) to the V-SMF for
that PDU session.
The IRI-POI in the SMF shall generate the xIRI containing the
SMFStartOfInterceptionWithEstablishedMAPDUSession record for each of the MA
PDU sessions (that meets the above criteria) associated with the newly
identified target UEs.
The IRI-POI present in the SMF generating an xIRI containing a
SMFStartOfInterceptionWithEstablishedMAPDUSession record shall set the Payload
Direction field in the PDU header to not applicable (Direction Value 5, see
ETSI TS 103 221-2 [8] clause 5.2.6).
Table 6.2.3-5E: Payload for SMFStartOfInterceptionWithEstablishedMAPDUSession
record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | sUPI | SUPI associated with the | C | | | PDU session (e.g. as | | | | provided by the AMF in the | | | | associated | | | | Nsmf_PD | | | | U_Session_CreateSMContext | | | | service operation). Shall | | | | be present except for | | | | PEI-only unauthenticated | | | | emergency sessions. | | +-----------------------------+-----------------------------+-------+ | sUPIUnauthenticated | Shall be present if a SUPI | C | | | is present in the message | | | | and set to "true" if the | | | | SUPI has not been | | | | authenticated, or "false" | | | | if it has been | | | | authenticated. | | +-----------------------------+-----------------------------+-------+ | pEI | PEI associated with the PDU | C | | | session if available. | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI associated with the | C | | | PDU session if available. | | +-----------------------------+-----------------------------+-------+ | pDUSessionID | PDU Session ID as assigned | M | | | by the AMF, as defined in | | | | TS 24.007 [14] clause | | | | 11.2.3.1b. | | +-----------------------------+-----------------------------+-------+ | pDUSessionType | Identifies selected PDU | M | | | session type, see TS 24.501 | | | | [13] clause 9.11.4.11. | | +-----------------------------+-----------------------------+-------+ | accessInfo | Identifies the access(es) | M | | | associated with the PDU | | | | session including the | | | | information for each | | | | specific access (see table | | | | 6.2.3-5B). | | +-----------------------------+-----------------------------+-------+ | sNSSAI | Slice identifier associated | C | | | with the PDU session, if | | | | available. See TS 23.003 | | | | [19] clause 28.4.2 and TS | | | | 23.501 [2] clause 5.15.2. | | +-----------------------------+-----------------------------+-------+ | uEEndpoint | UE endpoint address(es) if | C | | | available. IP addresses are | | | | given as 4 octets (for | | | | IPv4) or 16 octets (for | | | | IPv6) with the most | | | | significant octet first | | | | (network byte order). MAC | | | | addresses are given as 6 | | | | octets with the most | | | | significant octet first | | | | (see TS 29.244 [15] | | | | clause 5.21). | | +-----------------------------+-----------------------------+-------+ | location | Location information | C | | | provided by the AMF at | | | | session establishment or | | | | present in the context at | | | | the SMF, if available. | | +-----------------------------+-----------------------------+-------+ | dNN | Data Network Name | M | | | associated with the target | | | | traffic, as defined in TS | | | | 23.003 [19] clause 9A and | | | | described in TS 23.502 | | | | [4] clause 4.3.2.2. Shall | | | | be given in dotted-label | | | | presentation format as | | | | described in TS 23.003 | | | | [19] clause 9.1. | | +-----------------------------+-----------------------------+-------+ | aMFID | Identifier of the AMF | C | | | associated with the target | | | | UE, as defined in TS 23.003 | | | | [19] clause 2.10.1, if | | | | available. | | +-----------------------------+-----------------------------+-------+ | hSMFURI | URI of the Nsmf_PDUSession | C | | | service of the selected | | | | H-SMF, if available. See TS | | | | 29.502 [16] clause | | | | 6.1.6.2.2. | | +-----------------------------+-----------------------------+-------+ | requestType | Type of request as | C | | | initially set within PDU | | | | SESSION ESTABLISHMENT as | | | | described in TS 24.501 | | | | [13] clause 9.11.3.47. | | | | | | | | If the initial value is no | | | | longer available the | | | | request type shall be set | | | | to "existing PDU session". | | +-----------------------------+-----------------------------+-------+ | sMPDUDNRequest | Contents of the SM PDU DN | C | | | request container, if | | | | available, as described in | | | | TS 24.501 [13] clause | | | | 9.11.4.15. | | +-----------------------------+-----------------------------+-------+ | servingNetwork | PLMN ID of the serving core | M | | | network operator, and, for | | | | a Non-Public Network (NPN), | | | | the NID that together with | | | | the PLMN ID identifies the | | | | NPN. | | +-----------------------------+-----------------------------+-------+ | oldPDUSessionID | The old PDU Session ID | C | | | received from the UE. See | | | | TS 23.502 [4] clauses | | | | 4.3.2.2.1 and 4.3.5.2 and | | | | TS 24.501 [13] clause | | | | 6.4.1.2. Include if known. | | +-----------------------------+-----------------------------+-------+ | mAUpgradeIndication | Indicates whether the PDU | C | | | session is allowed to be | | | | upgraded to MA PDU session | | | | (see TS 23.502 [4] clause | | | | 4.22.3). Include if known. | | +-----------------------------+-----------------------------+-------+ | ePSPDNCnxInfo | Indicates if the PDU | C | | | session may be moved to EPS | | | | during its lifetime (see TS | | | | 29.502 [16] clause | | | | 6.1.6.2.31). Include if | | | | known. | | +-----------------------------+-----------------------------+-------+ | mAAcceptedIndication | Indicates that a request to | M | | | establish an MA PDU session | | | | was accepted or if a single | | | | access PDU session request | | | | was upgraded into an MA PDU | | | | session (see | | | | TS 23.502 [4] clauses | | | | 4.22.2 and 4.22.3). | | | | | | | | It shall be set as follows: | | | | | | | | - true: MA-Confirmed MA | | | | PDU session was | | | | established. | | | | | | | | - false: single access | | | | MA-Upgrade-Allowed MA PDU | | | | session was established | | | | that may be upgraded to an | | | | MA-Confirmed MA PDU | | | | session. | | +-----------------------------+-----------------------------+-------+ | aTSSSContainer | Identifies the steering, | C | | | switching, and splitting | | | | features for the | | | | MA-Confirmed MA PDU | | | | session. Also indicates | | | | whether MPTCP or ATSSS-LL | | | | is to be used for ATSSS. | | | | See TS 24.501 [13] clause | | | | 9.11.4.22. | | +-----------------------------+-----------------------------+-------+ | ePS5GSComboInfo | Provides detailed | C | | | information about PDN | | | | Connections and PDU | | | | Sessions during EPS to 5GS | | | | idle mode mobility or | | | | handover using the N26 | | | | interface. Shall be | | | | included when the AMF has | | | | selected a SMF+PGW-C to | | | | serve the PDU session. This | | | | parameter may include the | | | | additional IEs in table | | | | 6.2.3-1A, if available. | | +-----------------------------+-----------------------------+-------+ | uEEPSPDNConnection | This IE shall be present, | C | | | if available, during an EPS | | | | to 5GS Idle mode mobility | | | | or handover using the N26 | | | | interface. If present, it | | | | shall contain the EPS | | | | bearer context(s) | | | | information present in the | | | | uEEPSPDNConnection | | | | parameter of the | | | | intercepted | | | | SmContextCreateData | | | | message. (see TS 29.502 | | | | [16] clause 6.1.6.2.2). | | +-----------------------------+-----------------------------+-------+ | pCCRules | Set of PCC rules related to | C | | | traffic influence. Each PCC | | | | rule influences the routing | | | | of a given traffic flow. If | | | | several flows are | | | | concerned, then several PCC | | | | rules shall be handled by | | | | the SMF. Traffic influence | | | | policies are orginated by | | | | an AF. PCF translates these | | | | rules into PCC rules for | | | | traffic influence. The | | | | payload of a PCC rule for | | | | traffic influence is | | | | defined in Table 6.2.3-1E. | | +-----------------------------+-----------------------------+-------+ | pFDDataForApps | Represents a set of | C | | | associations between | | | | application identifier and | | | | packet flow descriptions | | | | (PFDs), if available. | | +-----------------------------+-----------------------------+-------+ | ePSStartOfInterceptionW | Provides details about PDN | C | | ithEstablishedPDNConnection | Connections when the | | | | SMFStartOfInterception | | | | WithEstablishedMAPDUSession | | | | xIRI message is used to | | | | report the start of | | | | interception on a target | | | | who already has existing | | | | PDN Connections. See Table | | | | 6.3.3-14 and clause | | | | 6.3.3.2.5. | | +-----------------------------+-----------------------------+-------+
##### 6.2.3.2.7.6 SMF MA unsuccessful procedure {#smf-ma-unsuccessful-
procedure .H6}
The IRI-POI in the SMF shall generate an xIRI containing an
SMFMAUnsuccessfulProcedure record when the IRI-POI present in the SMF detects
an unsuccessful procedure or error condition for a UE matching one of the
target identifiers provided via LI_X1.
Accordingly, the IRI-POI in the SMF generates the xIRI when one of the
following events are detected:
\- SMF sends a PDU SESSION ESTABLISHMENT REJECT message to the target UE for
MA-Confirmed and MA-Upgrade-Allowed MA PDU sessions.
\- SMF sends a PDU SESSION MODIFICATION REJECT message to the target UE for
MA-Confirmed and MA-Upgrade-Allowed MA PDU sessions.
\- SMF sends a PDU SESSION RELEASE REJECT message to the target UE for MA-
Confirmed and MA-Upgrade-Allowed MA PDU sessions.
\- SMF receives a PDU SESSION MODIFICATION COMMAND REJECT message from the
target UE for MA-Confirmed and MA-Upgrade-Allowed MA PDU sessions.
\- An ongoing SM procedure is aborted at the SMF, due to e.g. a 5GSM STATUS
message sent from or received by the SMF for MA-Confirmed and MA-Upgrade-
Allowed MA PDU sessions.
Table 6.2.3-5F: Payload for SMFMAUnsuccessfulProcedure record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +=============================+=============================+=======+ | failedProcedureType | Specifies the procedure | M | | | which failed or is aborted | | | | at the SMF. | | +-----------------------------+-----------------------------+-------+ | failureCause | Provides the value of the | M | | | 5GSM cause, see TS 24.501 | | | | [13], clause 9.11.4.2. In | | | | case the procedure is | | | | aborted due to a 5GSM | | | | STATUS message, the 5GSM | | | | cause is the one included | | | | in the 5GSM status message. | | +-----------------------------+-----------------------------+-------+ | requestedSlice | Slice requested for the | C | | | procedure, if available, | | | | given as a NSSAI (a list of | | | | S-NSSAI values as described | | | | in TS 24.501 [13] clause | | | | 9.11.3.37). | | +-----------------------------+-----------------------------+-------+ | initiator | Specifies whether the | M | | | network (SMF) or the UE is | | | | initiating the rejection or | | | | indicating the failure. | | +-----------------------------+-----------------------------+-------+ | sUPI | SUPI associated with the | C | | | procedure, if available | | | | (see NOTE). | | +-----------------------------+-----------------------------+-------+ | sUPIUnauthenticated | Shall be present if a SUPI | C | | | is present in the message | | | | and set to "true" if the | | | | SUPI has not been | | | | authenticated, or "false" | | | | if it has been | | | | authenticated. | | +-----------------------------+-----------------------------+-------+ | pEI | PEI used in the procedure, | C | | | if available (see NOTE). | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI used in the procedure, | C | | | if available (see NOTE). | | +-----------------------------+-----------------------------+-------+ | pDUSessionID | PDU Session ID, see TS | C | | | 24.501 [13] clause 9.4, | | | | if available. | | +-----------------------------+-----------------------------+-------+ | accessInfo | Identifies the access(es) | M | | | associated with the PDU | | | | session including the | | | | information for each | | | | specific access (see table | | | | 6.2.3-5B). | | +-----------------------------+-----------------------------+-------+ | uEEndpoint | UE endpoint address(es) if | C | | | available. | | +-----------------------------+-----------------------------+-------+ | location | Location information | C | | | provided by the AMF or | | | | present in the context at | | | | the SMF, if available. | | +-----------------------------+-----------------------------+-------+ | dNN | Data Network Name | C | | | associated with the target | | | | traffic, as defined in TS | | | | 23.003 [19] clause 9A and | | | | described in TS 23.501 | | | | [2] clause 4.3.2.2, if | | | | available. Shall be given | | | | in dotted-label | | | | presentation format as | | | | described in TS 23.003 | | | | [19] clause 9.1. | | +-----------------------------+-----------------------------+-------+ | aMFID | Identifier of the AMF | C | | | associated with the target | | | | UE, as defined in TS 23.003 | | | | [19] clause 2.10.1 when | | | | available. | | +-----------------------------+-----------------------------+-------+ | hSMFURI | URI of the Nsmf_PDUSession | C | | | service of the selected | | | | H-SMF, if available. See TS | | | | 29.502 [16] clause | | | | 6.1.6.2.2. | | +-----------------------------+-----------------------------+-------+ | requestType | Type of request as | C | | | described in TS 24.501 | | | | [13] clause 9.11.3.47, if | | | | available. | | | | | | | | Otherwise depending on the | | | | REJECT event the following | | | | request type shall be | | | | reported: | | | | | | | | PDU SESSION ESTABLISHMENT | | | | REJECT: The request type | | | | shall be set to the one | | | | reported within the PDU | | | | SESSION ESTABLISHMENT or if | | | | there hasn\'t been one | | | | reported it should be set | | | | to \"MA PDU request\". | | | | | | | | PDU SESSION MODIFICATION | | | | REJECT: \"modification | | | | request". | | | | | | | | PDU SESSION RELEASE REJECT: | | | | no request type shall be | | | | set. | | | | | | | | PDU SESSION MODIFICATION | | | | COMMAND REJECT: | | | | \"modification request". | | +-----------------------------+-----------------------------+-------+ | sMPDUDNRequest | Contents of the SM PDU DN | C | | | Request container, if | | | | available, as described in | | | | TS 24.501 [13] clause | | | | 9.11.4.15. | | +-----------------------------+-----------------------------+-------+ | NOTE: At least one identity | | | | shall be provided, the | | | | others shall be provided if | | | | available. | | | +-----------------------------+-----------------------------+-------+
##### 6.2.3.2.8 PDU to MA PDU session modification
The IRI-POI in the SMF shall generate an xIRI containing an
SMFPDUtoMAPDUSessionModification record when the IRI-POI present in the SMF
detects that an existing PDU session for the target UE has been successfully
modified to an MA PDU session using the PDU session modification procedures as
described in TS 24.501 [13]. A PDU session is considered to be successfully
modified to a MA PDU session, when all of the following are true:
1\. The UE is registered to both 3GPP access and non-3GPP access:
\- In the same PLMN (non-roaming UE).
\- In the different PLMNs (roaming UE).
2\. SMF receives the PDU SESSION MODIFICATION REQUEST from the UE (TS 24.501
[13] clause 8.2.10) that includes one of the following:
\- _modification request_ and includes MA PDU session information IE set to
_MA PDU session network upgrade allowed_.
\- _MA PDU request_.
3\. SMF sends a PDU SESSION MODIFICATION COMMAND to the UE that includes the
ATSSS IE (TS 24.501 [13] clause 6.4.2.3).
4\. SMF receives the PDU SESSION MODIFICATION COMPLETE from the UE (TS 24.501
[13] clause 8.3.10.1).
5\. The 5GSM state within the SMF is PDU Session Active.
Once the SMFPDUtoMAPDUSessionModification record has been generated by the
IRI-POI in the SMF, the IRI-POI shall follow clause 6.2.3.2.7 of the present
document for further reporting for this MA PDU session.
Table 6.2.3-5G: Payload for SMFPDUtoMAPDUSessionModification record
* * *
Field name Description M/C/O sUPI SUPI associated with the PDU session (e.g.
as provided by the AMF in the associated Nsmf_PDU_Session_CreateSMContext
service operation). Shall be present except for PEI-only unauthenticated
emergency sessions. C sUPIUnauthenticated Shall be present if a SUPI is
present in the message and set to _true_ if the SUPI was not authenticated, or
_false_ if it has been authenticated. C pEI PEI associated with the PDU
session if available. C gPSI GPSI associated with the PDU session if
available. C sNSSAI Slice identifier associated with the PDU session, if
available. See TS 23.003 [19] clause 28.4.2 and TS 23.501 [2] clause 5.15.2. C
non3GPPAccessEndpoint UE\'s local IP address used to reach the N3IWF, TNGF or
TWIF, if available. IP addresses are given as 4 octets (for IPv4) or 16 octets
(for IPv6) with the most significant octet first (network byte order). C
location Location information provided by the AMF or present in the context at
the SMF, if available. C requestType In accordance with the request type as
described in TS 24.501 [13] clause 6.4.2.2 and clause 9.11.3.47 a request type
of "modification request" shall be reported. M accessType Access type
associated with the session (i.e. 3GPP or non-3GPP access) if provided by the
AMF (see TS 24.501 [13] clause 9.11.2.1A). C rATType RAT type associated with
the access, if available. Values given as per TS 29.571 [17] clause 5.4.3.2. C
pDUSessionID PDU Session ID, see TS 24.501 [13] clause 9.4. M
requestIndication Indicates the request type for PDU session modification as
indicated by the requestIndication sent in the PDU SESSION MODIFICATION
REQUEST (see TS 29.502 [16] clause 6.1.6.3.6). M aTSSSContainer Identifies the
steering, switching, and splitting features for the MA-Confirmed MA PDU
session. Also indicates whether MPTCP or ATSSS-LL is to be used for ATSSS. See
TS 24.501 [13] clause 9.11.4.22. M uEEndpoint UE IP address(es) assigned to
the PDU Session if available (See TS 29.244 [15] clause 5.21). C
servingNetwork Shall be present if this IE is in the SMContextUpdateData,
HsmfUpdateData or message sent to the SMF or the PDU Session Context or SM
Context at the SMF (see TS 29.502 [16] clauses 6.1.6.2.3, 6.1.6.2.11 and
6.1.6.2.39). C handoverState Indicates whether the PDU Session Modification
being reported was due to a handover. Shall be present if this IE is in the
SMContextUpdatedData or sent by the SMF (see TS 29.502 [16] clause 6.1.6.2.3).
C gTPTunnelInfo Contains the information for the User Plane GTP Tunnels for
the PDU Session (see TS 29.502 [16] clauses 6.1.6.2.2, 6.1.6.2.9 and
6.1.6.2.39). See Table 6.2.3-1B. M ePSPDNConnectionModification Provides
details about PDN Connections when the SMFPDUtoMAPDUSessionModification xIRI
message is used to report PDN Connection Modification. See Table 6.3.3-8 and
clause 6.3.3.2.3. C
* * *
#### 6.2.3.3 Triggering of the CC-POI from CC-TF over LI_T3
##### 6.2.3.3.1 LI_T3 interface specifics
When interception of communication contents is authorised or the delivery of
packet header information is authorised and approach 2 described in clause
6.2.3.5 is used, the CC-TF present in the SMF sends a trigger to the CC-POI
present in the UPF over the LI_T3 interface.
When the CC-TF in the SMF detects that a PDU session is being established
(i.e. when the SMF sends the N4: PFCP Session Establishment Request to the
UPF, see TS 29.244 [15], clause 6.3.2) for a target UE, it shall send an
activation message to the CC-POI in the UPF over the LI_T3 interface. The
activation message shall contain the correlation identifiers that the CC-POI
in the UPF shall use with the xCC. This can be achieved by sending an
ActivateTask message as defined in ETSI TS 103 221-1 [7] clause 6.2.1 with the
following details.
Table 6.2.3-6: ActivateTask message for triggering the CC-POI in the UPF
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | Allocated by the CC-TF as | M | | | per ETSI TS 103 221-1 | | | | [7]. | | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | Packet detection criteria | M | | | as determined by the CC-TF | | | | in the SMF, which enables | | | | the UPF to isolate target | | | | traffic. The CC-POI in the | | | | UPF shall support at least | | | | the identifier types given | | | | in table 6.2.3-7. | | | | | | | | NOTE: This value is the | | | | target identifier for the | | | | CC-POI in the UPF and may | | | | be different from the | | | | target identifier specified | | | | in the warrant. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X3Only". | M | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints for | M | | | LI_X3. These delivery | | | | endpoints shall be | | | | configured by the CC-TF in | | | | the SMF using the | | | | CreateDestination message | | | | as described in ETSI TS 103 | | | | 221-1 [7] clause 6.3.1 | | | | prior to first use. | | +-----------------------------+-----------------------------+-------+ | CorrelationID | Correlation ID to assign to | M | | | X3 PDUs generated by the | | | | CC-POI in the UPF. This | | | | field is populated with the | | | | same CorrelationID the | | | | IRI-POI in the SMF uses for | | | | the associated xIRI. | | +-----------------------------+-----------------------------+-------+ | ProductID | Shall be set to the XID of | M | | | the Task Object associated | | | | with the interception at | | | | the CC-TF. This value shall | | | | be used by the CC-POI in | | | | the UPF to fill the XID of | | | | X3 PDUs. | | +-----------------------------+-----------------------------+-------+
The CC-TF in the SMF shall not send the ListOfServiceTypes parameter of the
ActivateTask message to the CC-POI in the UPF.
Table 6.2.3-7: Target Identifier Types for LI_T3
* * *
Identifier type Owner ETSI TS 103 221-1 [7] TargetIdentifier type Definition
GTP Tunnel ID 3GPP gtpuTunnelId F-TEID (see XSD schema) UE IP Address ETSI
IPv4Address or IPv6Address See ETSI TS 103 221-1 [7] UE TCP/UDP Port ETSI
TCPPort or UDPPort See ETSI TS 103 221-1 [7] PFCP Session ID 3GPP
TargetIdentifierExtension / FSEID F-SEID (see XSD schema) PDR ID 3GPP
TargetIdentifierExtension / PDRID 32 bit unsigned integer (see XSD schema) QER
ID 3GPP TargetIdentifierExtension / QERID 32 bit unsigned integer (see XSD
schema) Network Instance 3GPP TargetIdentifierExtension / NetworkInstance
Octet string (see XSD schema) GTP Tunnel Direction 3GPP
TargetIdentifierExtension / GTPTunnelDirection Enumeration (see XSD schema)
* * *
When the CC-TF in the SMF detects that a targeted PDU session is changing
(i.e. when the SMF sends the N4: PFCF Session Modification Request to the UPF,
see TS 29.244 [15], clause 6.3.3) in a way that requires changes to the
interception already activated by the CC-POI in the UPF, the CC-TF shall
modify the interception at the CC-POI in the UPF over the LI_T3 interface.
This is achieved by sending a ModifyTask message as defined in ETSI TS 103
221-1 [7] clause 6.2.2. The ModifyTask message contains the same details as
the ActivateTask message with the following fields updated as appropriate.
Table 6.2.3-8: Parameters that may be changed in a ModifyTask message when
updating interception at the CC-POI in the UPF
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | Updated packet detection | M | | | criteria as determined by | | | | the CC-TF in the SMF. | | | | | | | | NOTE: See notes on | | | | TargetIdentifiers in table | | | | 6.2.3-6. | | +-----------------------------+-----------------------------+-------+
When the CC-TF in the SMF detects that a targeted PDU session is changing
(i.e. when the SMF sends the N4: PFCF Session Modification Request to the UPF,
see TS 29.244 [15], clause 6.3.3) for which the interception had not been
previously activated in the CC-POI in the UPF (e.g. in case of previous
unsuccessful LI activation at the CC-POI in the UPF by the CC-TF in the SMF),
the CC-TF shall send an activation message to the CC-POI in the UPF over the
LI_T3 interface. The activation message shall contain the correlation
identifiers that the CC-POI in the UPF shall use with the xCC. This can be
achieved by sending an ActivateTask message as defined in ETSI TS 103 221-1
[7] clause 6.2.1 with the details provided by Table 6.2.3-6.
When the CC-TF in the SMF detects that the PDU session has been released (i.e.
when the SMF sends the N4: PFCF Session Deletion Request to the UPF, see TS
29.244 [15], clause 6.3.4) for a target UE, it shall send a deactivation
message to the CC-POI in the UPF over the LI_T3 interface. When using ETSI TS
103 221-1 [7] this is achieved by sending a DeactivateTask message with the
XID field set to the XID associated with the interception, as described in
ETSI TS 103 221-1 [7] clause 6.2.3.
By default, interception shall occur at the anchor UPF as described in clause
6.2.3.3.3.
When a warrant that includes the service scoping of CC is activated for a
target UE with an established PDU session and when the IRI-POI present in the
SMF generates the xIRI containing an
SMFStartOfInterceptionWithEstablishedPDUSession record (see clause 6.2.3.2.5),
the CC-TF present in the SMF shall send an activation message to the CC-POI
present in the UPF to generate the xCC.
##### 6.2.3.3.2 CC interception with multi-homed PDU session
When a target UE accesses multiple Data Networks (DNs) via a multi-homed PDU
session (see TS 23.501 [2] clause 5.6.4.3), multiple UPFs are involved in
providing the PDU Session Anchors, with one UPF providing the Branching Point
functionality. The Branching Point UPF may, or may not, be a PDU Session
Anchor UPF (see TS 33.127 [5] Annex A3.2). The CC-TF present in the SMF shall
send the CC intercept trigger to the CC-POI present in an UPF if and only if
that UPF is selected to provide the CC-POI functions.
When the target UE is involved in multi-homed PDU session, the CC-TF present
in the SMF (i.e. in the SMF that establishes the PDU session) shall determine
which UPF(s) is(are) more suitable to provide the CC-POI functions adhering to
the following requirements specified in TS 33.127 [5]:
\- All applicable user plane packets are captured and delivered.
\- Duplicate delivery of CC is suppressed to the extent possible.
This clause assumes that a PDU session contains only one Branching Point UPF
(with N3 reference point toward the target UE) and one PDU Session Anchor UPF
for each DN connection.
Since the present document requires the interception of all DN connections,
the SMF may choose either all the PDU Session Anchor UPFs or the Branching
Point UPF to provide the CC-POI functions.
The Branching Point UPF may be chosen when all user plane packets pass through
the Branching Point UPF, and the CC-TF present in the SMF may choose the
Branching Point UPF to provide the CC-POI function and accordingly, send the
CC interception trigger to the CC-POI present in the Branching Point UPF. The
CC intercept trigger shall include the packet detection rules. An example of
these rules is:
\- Generate the xCC from all the incoming and outgoing user plane packets to
the target UE.
In this case, the CC-TF present in the SMF shall not select any of the PDU
Session Anchor UPFs to provide the CC-POI functions.
When a Branching Point UPF is chosen to provide the CC-POI functions, and if
the Branching Point UPF is removed from the user plane path during a PDU
session, then the CC POI functions will have to be moved to the PDU Session
Anchor UPFs.
The xCC delivered to the MDF3 shall be correlated to the PDU session related
xIRI. The use of Correlation Id shall be on a user-plane path basis, which
means that the xCC generated at different UPFs that belong to different PDU
sessions may need to have separate Correlation IDs, each correlating to their
own PDU session related xIRI.
##### 6.2.3.3.3 CC Interception only at PDU Session Anchor UPFs
An option is to intercept a copy of the packets sent and received on the N6
interface [2] side of the PDU Anchor UPF (for each UL classifier in case of
selective routing or _Service and Session Continuity_ mode 3) for all DNs the
subject is connected to. In the in-bound roaming case for home-routed roaming,
the CSP shall deliver a copy of the packets sent and received on the N9 side
of the PDU Anchor UPF towards the serving network.
#### 6.2.3.4 IRI-POI in UPF triggering over LI_T2
When interception of packet header information is authorised, if approach 1
described in clause 6.2.3.9.1 is used for packet header information reporting,
the IRI-TF in the SMF shall send a trigger to the IRI-POI in the UPF over the
LI_T2 interface when the IRI-TF in the SMF detects that a PDU session has been
established (i.e. when the SMF sends the N4: PFCP Session Establishment
Request to the UPF, see TS 29.244 [15], clause 6.3.2) for a target UE. The
activation message shall contain the correlation ID that the IRI-POI in the
UPF shall use when generating xIRI. This shall be achieved by sending an
ActivateTask message as defined in TS 103 221-1 [7] clause 6.2.1 with the
following details.
Table 6.2.3-9: ActivateTask message for triggering the UPF IRI-POI
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | Allocated by the IRI-TF as | M | | | per ETSI TS 103 221-1 | | | | [7]. | | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | Packet detection criteria | M | | | as determined by the IRI-TF | | | | in the SMF, which enable | | | | the UPF IRI-POI to isolate | | | | target traffic. The IRI-POI | | | | in the UPF shall support at | | | | least the identifier types | | | | given in table 6.2.3-7. | | | | | | | | NOTE: This value is the | | | | target identifier for the | | | | IRI-POI in the UPF and may | | | | be different from the | | | | target identifier specified | | | | in the warrant. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X2Only". | M | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | Header reporting-specific | M | | | tag to be carried in the | | | HeaderReporting | _TaskDetailsExtensions_ | | | | field of ETSI TS 103 221-1 | | | | [7]. See table | | | | 6.2.3.9.2-1. | | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints of | M | | | LI_X2. These delivery | | | | endpoints shall be | | | | configured by the IRI-TF in | | | | the SMF using the | | | | _CreateDestination_ message | | | | as described in ETSI TS 103 | | | | 221-1 [7] clause 6.3.1 | | | | prior to first use. | | +-----------------------------+-----------------------------+-------+ | CorrelationID | Correlation ID to assign | M | | | for xIRI generated by the | | | | IRI-POI in the UPF. This | | | | field is populated with the | | | | same CorrelationID the | | | | IRI-POI in the SMF uses for | | | | the associated xIRI. | | +-----------------------------+-----------------------------+-------+ | ProductID | Shall be set to the XID of | M | | | the Task Object associated | | | | with the interception at | | | | the IRI-TF. This value | | | | shall be used by the | | | | IRI-POI in the UPF to fill | | | | the XID of X2 PDUs. | | +-----------------------------+-----------------------------+-------+
The IRI-TF in the SMF shall not send the ListOfServiceTypes parameter of the
ActivateTask message to the IRI-POI in the SMF.
Table 6.2.3-10: Void
When the IRI-TF in the SMF detects that a targeted PDU session has changed
(i.e. when the SMF sends the N4: PFCP Session Modification Request to the UPF,
see TS 29.244 [15], clause 6.3.3) in a way which requires changes to the
interception by the IRI-POI in the UPF, the IRI-TF in the SMF shall modify the
interception at the IRI-POI in the UPF over the LI_T2 interface. This is
achieved by sending a ModifyTask message as defined in ETSI TS 103 221-1 [7]
clause 6.2.2. The ModifyTask message contains the same details as the
ActivateTask message with the following fields updated as appropriate.
Table 6.2.3-11: Parameters that may be changed in a ModifyTask message when
updating interception at the IRI-POI in the UPF
+-------------------+----------------------------------------+-------+ | Field name | Description | M/C/O | +-------------------+----------------------------------------+-------+ | TargetIdentifiers | Updated packet detection criteria as | M | | | determined by the IRI-TF in the SMF. | | | | | | | | NOTE: See notes on TargetIdentifiers | | | | in table 6.2.3-6. | | +-------------------+----------------------------------------+-------+
When the IRI-TF in the SMF detects that the PDU session has been released
(i.e. when the SMF sends the N4: PFCP Session Deletion Request to the UPF, see
TS 29.244 [15], clause 6.3.4) for a target UE, it shall send a deactivation
message to the IRI-POI in the UPF over the LI_T2 interface. When using ETSI TS
103 221-1 [7] this is achieved by sending a DeactivateTask message with the
XID field set to the XID associated with the interception, as described in
ETSI TS 103 221-1 [7] clause 6.2.3.
When a PDU session involves multiple UPFs, the selection of UPF to provide the
IRI-POI functions shall be done in the same way an UPF is selected to provide
the CC-POI functions as described in clauses 6.2.3.3.2 and 6.2.3.3.3.
When interception of packet header information is authorised for a target UE,
if approach 1 described in clause 6.2.3.9.1 is used for packet header
information reporting, the IRI-TF present in the SMF shall send an activation
message to the IRI-POI present in the UPF when the IRI-POI present in the SMF
generates the xIRI containing an
SMFStartOfInterceptionWithEstablishedPDUSession record to generate the packet
header information reporting related xIRIs from the user plane packets of that
PDU session.
#### 6.2.3.5 Generation of xIRI at UPF over LI_X2
##### 6.2.3.5.1 Packet data header reporting
When packet header information reporting is authorised, packet header
information reports are generated either by the IRI-POI in the UPF (if
approach 1 from clause 7.12.2.3 of TS 33.127 [5] is used) or by the MDF2 (if
approach 2 from clause 7.12.2.3 of TS 33.127 [5] is used). Depending on the
requirements of the warrant, the packet header information reports can be in
per-packet form, as Packet Data Header Reports (PDHRs), or in summary form, as
Packet Data Header Summary Reports (PDSRs).
##### 6.2.3.5.2 Fragmentation
If the IRI-POI in the UPF is placed on a link which fragmented the original IP
packet (see IETF RFC 791[34] for basic fragmentation rules, and IETF RFC 815
[26] for more complex re-assembly rules), a situation may occur in which only
the first fragment can be sensibly reported in a PDHR, while the subsequent
fragments may be missing essential fields that are mandatory, which may cause
simplistic implementations to mis-report them, or omit them altogether.
In this case, the IRI-POI in the UPF shall report the first fragment of a
fragmented IP packet, including the port numbers when they are included within
this first fragment, using the length of the fragment to determine if the port
numbers are indeed encoded within this first fragment. The subsequent
fragments are reported without port information. This technique relieves the
IRI-POI in the UPF from having to reassemble the original IP packet (at line
speed) at the cost of accuracy of the reported fields.
##### 6.2.3.5.3 Packet Data Header Report (PDHR)
If the per-packet form of packet header information reporting, i.e. PDHR, is
authorised, the PDHeaderReport xIRI shall be generated as described in clause
6.2.3.9.3.
##### 6.2.3.5.4 Packet Data Summary Report (PDSR)
If the summary form of the packet header information reporting, i.e. PDSR, is
authorised, the PDSummaryReport xIRI shall be generated as described in clause
6.2.3.9.4.
#### 6.2.3.6 Generation of xCC at CC-POI in the UPF over LI_X3
The CC-POI present in the UPF shall send xCC over LI_X3 for each IP packet
matching the criteria specified in the Triggering message (i.e. ActivateTask
message) received over LI_T3 from the CC-TF in the SMF.
NOTE: Implementers are reminded of the completeness and non-duplication
requirements (see TS 33.127 [5]).
Each X3 PDU shall contain the contents of the user plane packet given using
the GTP-U, IP or Ethernet payload format.
The CC-POI present in the UPF shall set the payload format to indicate the
appropriate payload type (5 for IPv4 Packet, 6 for IPv6 Packet, 7 for Ethernet
frame or 12 for GTP-U Packet as described in ETSI TS 103 221-2 [8] clauses 5.4
and 5.4.13.
If handover of the entire GTP-U packet is required over LI_HI3 (see clause
6.2.3.8), then consideration shall be made of the correct choice of LI_X3
payload type to ensure that the MDF3 has the necessary CC information. Support
for delivery of LI_X3 as payload type 12 (GTP-U packet) is mandatory.
The CC-POI present in the UPF may use the Additional XID Related Information
attributes to facilitate efficient delivery of xCC, as specified in ETSI TS
103 221-2 [8] clause 5.3.22.
#### 6.2.3.7 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in the SMF or the IRI-POI
in the UPF, the MDF2 shall send the IRI message over LI_HI2 without undue
delay. The IRI message shall contain a copy of the relevant record received
from LI_X2. The record may be enriched by other information available at the
MDF (e.g. additional location information).
The timestamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time at which the SMF event was observed (i.e. the timestamp field
of the xIRI).
The IRI type parameter (see ETSI TS 102 232-1 [9] clause 5.2.10) shall be
included and coded according to table 6.2.3-14.
Table 6.2.3-14: IRI type for IRI messages
Record type **IRI Type**
* * *
SMFPDUSessionEstablishment BEGIN SMFPDUSessionRelease END
SMFPDUSessionModification CONTINUE
SMFStartOfInterceptionWithEstablishedPDUSession BEGIN SMFUnsuccessfulProcedure
REPORT SMFMAPDUSessionEstablishment BEGIN SMFMAPDUSessionRelease END
SMFMAPDUSessionModification CONTINUE
SMFStartOfInterceptionWithEstablishedMAPDUSession BEGIN
SMFMAUnsuccessfulProcedure REPORT SMFPDUtoMAPDUSessionModification CONTINUE
PDHeaderReport REPORT PDSummaryReport REPORT
IRI messages associated with the same PDU Session shall be assigned the same
CIN (see ETSI TS 102 232-1 [9] clause 5.2.4).
The threeGPP33128DefinedIRI field (see ETSI TS 102 232-7 [10] clause 15) shall
be populated with the BER-encoded IRIPayload.
When an additional warrant is activated on a target UE and the LIPF uses the
same XID for the additional warrant, the MDF2 shall be able to generate and
deliver the IRI message containing the
SMFStartOfInterceptionWithEstablishedPDUSession record and the
SMFStartOfInterceptionWithEstablishedMAPDUSession record to the LEMF
associated with the additional warrant without receiving a corresponding xIRI.
The payload of the SMFStartOfInterceptionWithEstablishedPDUSession record is
specified in table 6.2.3-4, while the payload of the
SMFStartOfInterceptionWithEstablishedMAPDUSession record is specified in table
6.2.3-9. The MDF2 shall generate and deliver the IRI message containing the
SMFStartOfInterceptionWithEstablishedPDUSession record for each of the
established PDU sessions to the LEMF associated with the new warrant. The MDF2
shall generate and deliver the IRI message containing the
SMFStartOfInterceptionWithEstablishedMAPDUSession record for each of the
established MA PDU sessions to the LEMF associated with the new warrant.
If the MDF2 did not receive from the IRI-POI the value of
timeOfSessionEstablishment parameter in a previous corresponding
SMFStartOfInterceptionWithEstablishedPDUSession or
SMFStartOfInterceptionWithEstablishedMAPDUSession xIRI for the same session,
the MDF2, when generating the SMFStartOfInterceptionWithEstablishedPDUSession
or the SMFStartOfInterceptionWithEstablishedMAPDUSession IRI shall include in
that parameter the time provided in the timestamp previously received in the
header of the related SMFPDUSessionEstablishment or
SMFMAPDUSessionEstablishment xIRI.
When the delivery of packet header information is authorised and approach 2
described in clause 6.2.3.9.1 is used, the MDF2 shall generate the IRI message
and send it over LI_HI2 without undue delay when xCC is received over LI_MDF
from the MDF3. The MDF2 shall generate packet header information reporting as
described in clause 6.2.3.5.
#### 6.2.3.8 Generation of CC over LI_HI3
When the xCC is received over LI_X3, the MDF3 shall emit the CC over LI_HI3
without undue delay.
The timestamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time that the UPF observed the data (i.e. the timestamp field of
the xCC). The LIID and CID fields shall correctly reflect the target identity
and communication session to which the CC belongs.
The MDF3 shall populate the threeGPP33128DefinedCC field (see clause 5.5.3 of
the present document) with a BER-encoded CCPayload structure containing
either:
1\. The uPFCCPDU field containing the GTP-U packet received over LI_X3. It
shall only be used if the content of the GTP-U packet is an IPv4 or IPv6
packet.
2\. The extendedUPFCCPDU field as described in table 6.2.3-15.
The MDF3 shall support delivery using either option.
Table 6.2.3-15: ExtendedUPFCCPDU structure
* * *
Field name Description M/C/O payload Payload of the GTP-U packet without GTP-U
encapsulation. Content shall be supplied according to table 6.2.3-16. M qFI
Shall be populated with the QoS Flow Identifier value from the GTP-U header
extension (see TS 38.415 [41] clause 5.5.3.3) if present over LI_X3. C
* * *
Table 6.2.3-16: UPFCCPDUPayload structure
* * *
Field name Description uPFIPCC Contains an IPv4 or IPv6 packet uPFEthernetCC
Contains an Ethernet frame uPFUnstructuredCC Contains an unstructured packet
* * *
#### 6.2.3.9 Packet header information reporting
##### 6.2.3.9.1 General
As described in TS 33.127 [5] clause 7.12.2, warrants that do not require the
interception of communication contents but do require packet header
information reporting will require access to the user plane packets. Packet
header information reporting includes the following two IRI messages:
\- Packet Data Header Reporting (PDHR) in the form of PDHeaderReport records.
\- Packet Data Summary Reporting (PDSR) in the form of PDSummaryReport
records.
TS 33.127 [5] clause 7.12.2 provides two approaches for the generation of such
IRI messages.
In approach 1, the IRI-POI present in the UP Entityconstructs and delivers the
packet header information reporting related xIRIs to the MDF2 as described in
clause 6.2.3.4.
In approach 2, the CC-POI present in the UP Entity intercepts, constructs and
delivers the xCC to the MDF3 as described in clause 6.2.3.6. The MDF3 forwards
the xCC to the MDF2 over the LI_MDF interface and the MDF2 generates the IRI
messages containing the packet header information reporting related records
from the xCC.
In both approaches, the payload of the PDHeaderReport and PDSummaryReport
records are as described in clauses 6.2.3.9.3, 6.2.3.9.4, tables 6.2.3.9.3-1
and 6.2.3.9.4-1. Note that in approach 2, the MDF2 generates these IRI
messages containing PDHeaderReport and PDSummaryReport records without
receiving the equivalent xIRI from an IRI-POI. The actions of the MDF2, the
MDF3, the CC-TF in the CP Entity in 5GS and CUPS EPS, and the CC-POI in non-
CUPS EPS are managed as part of the intercept data provisioned to them over
the LI_X1 interface.
##### 6.2.3.9.2 Provisioning details
Table 6.2.3.9.2-1 shows the details of the HeaderReporting
TaskDetailsExtension used in the LI_X1 ActivateTask message used for
provisioning LI functions when packet header information reporting is
authorised.
Table 6.2.3.9.2-1: PDHRReportingExtensions parameters
+----------------+-------------------------------------------+-------+ | Field name | Description | M/C/O | +----------------+-------------------------------------------+-------+ | pDHType | This field shall be set to either: | M | | | | | | | - \"PDHR,\" for packet-by-packet | | | | reporting. | | | | | | | | - \"PDSR,\" for summarized reporting. | | +----------------+-------------------------------------------+-------+ | pDSRParameters | If pDHType is PDSR, this field shall be | C | | | set. See table 6.2.3.9.2-2. | | +----------------+-------------------------------------------+-------+
Table 6.2.3.9.2-2: PDSRParameters
+--------------------+---------------------------------------+-------+ | Field name | Description | M/C/O | +--------------------+---------------------------------------+-------+ | pDSRTriggerType | This field shall be set to at least | M | | | one of the following triggers: | | | | | | | | a) timer expiry (along with a timer | | | | value and unit). | | | | | | | | b packet count (along with a value | | | | for the number of packets detected | | | | before a summary is to be triggered). | | | | | | | | c) byte count (along with a value | | | | for the cumulative byte size reached | | | | across all packets belonging to the | | | | summary before said summary is to be | | | | triggered). | | | | | | | | Summary reports shall not be | | | | cumulative, i.e. each summary report | | | | shall describe only the packets | | | | contained in its respective range, | | | | and each new summary shall start its | | | | count (of whichever attribute from | | | | the numbered list above applies) from | | | | zero, i.e. the information in the | | | | (n+1)'th summary report starts | | | | immediately after the end of the n'th | | | | summary report. | | +--------------------+---------------------------------------+-------+ | useSessionTriggers | If useSessionTriggers is present and | C | | | set to true, the trigger described in | | | | the pDSRTriggerType parameter shall | | | | be applied at the session level | | | | instead of per-flow. | | +--------------------+---------------------------------------+-------+
##### 6.2.3.9.3 PDHeaderReport record
If the per-packet form of packet header information reporting, i.e. PDHR, is
used, the LI function responsible for generating the xIRI extracts the
information shown in table 6.2.3.9.3-1 from each packet.
Table 6.2.3.9.3-1: PDHeaderReport record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | pDUSessionID | The PDU Session ID value | M | | | 255 shall be used by the | | | | sender; the receiver shall | | | | ignore the parameter (see | | | | NOTE). | | +-----------------------------+-----------------------------+-------+ | sourceIPAddress | Shall contain the source | M | | | address of the packet from | | | | the 32-bit _"Source | | | | Address"_ field in IPv4, as | | | | defined in IETF RFC 791 | | | | [34], or from the 128-bit | | | | _"Source Address"_ field in | | | | IPv6, as defined in IETF | | | | RFC 2460 [27]. | | +-----------------------------+-----------------------------+-------+ | sourcePort | Shall contain the _"Source | C | | | Port_ " number that | | | | indicates an application or | | | | service running on top of | | | | the transport, if the | | | | _"Protocol"_ IP field (see | | | | the _nextLayerProtocol_ | | | | field below in this table) | | | | is one of: | | | | | | | | a) Transmission Control | | | | Protocol (**TCP**), IP | | | | "Protocol" field decimal | | | | "6"; see IETF RFC 793 | | | | [28]. | | | | | | | | b) User Datagram Protocol | | | | (**UDP**), IP "Protocol" | | | | field decimal "17"; see | | | | IETF RFC 768 [29]. | | | | | | | | c) Datagram Congestion | | | | Control Protocol | | | | (**DCCP**), IP "Protocol" | | | | field decimal "33"; see | | | | IETF RFC 4340 [30]. | | | | | | | | d) Stream Control | | | | Transmission Protocol | | | | (**SCTP**), IP "Protocol" | | | | field decimal "132"; see | | | | IETF RFC 4960 [31]. | | | | | | | | For further details on | | | | Layer four protocols, see | | | | IANA [32]. | | +-----------------------------+-----------------------------+-------+ | destinationIPAddress | Shall contain the | M | | | destination address of the | | | | packet from the 32-bit | | | | _"Destination Address"_ | | | | field in IPv4, as defined | | | | in IETF RFC 791 [34], or | | | | from the 128-bit | | | | _"Destination Address"_ | | | | field, as defined in IETF | | | | RFC 2460 [27]. | | +-----------------------------+-----------------------------+-------+ | destinationPort | Shall contain the | C | | | _"Destination Port_ " number | | | | that indicates an | | | | application or service | | | | running on top of the | | | | transport, if the | | | | _"Protocol"_ IP field (see | | | | the _nextLayerProtocol_ | | | | field below in this table) | | | | is one of: | | | | | | | | e) Transmission Control | | | | Protocol (**TCP**), IP | | | | "Protocol" field decimal | | | | "6"; see IETF RFC 793 | | | | [28]. | | | | | | | | f) User Datagram Protocol | | | | (**UDP**), IP "Protocol" | | | | field decimal "17"; see | | | | IETF RFC 768 [29]. | | | | | | | | g) Datagram Congestion | | | | Control Protocol | | | | (**DCCP**), IP "Protocol" | | | | field decimal "33"; see | | | | IETF RFC 4340 [30]. | | | | | | | | h) Stream Control | | | | Transmission Protocol | | | | (**SCTP**), IP "Protocol" | | | | field decimal "132"; see | | | | IETF RFC 4960 [31]. | | | | | | | | For further details on | | | | Layer four protocols, see | | | | IANA [32]. | | +-----------------------------+-----------------------------+-------+ | nextLayerProtocol | Shall contain the contents | M | | | of the IP _"Protocol"_ | | | | field as defined in IETF | | | | RFC 791 [34] (bits | | | | 72...79 in the IP header), | | | | and is one of the assigned | | | | Internet protocol numbers | | | | defined in IANA [32]. | | +-----------------------------+-----------------------------+-------+ | iPv6flowLabel | If the IP addresses in the | C | | | report are IPv6, this field | | | | shall contain the 20-bit | | | | IPv6 "Flow Label" as | | | | defined in: | | | | | | | | - IPv6 IETF RFC 2460 | | | | [27], and | | | | | | | | - IPV6 Flow Label | | | | Specification IETF RFC 6437 | | | | [33]. | | +-----------------------------+-----------------------------+-------+ | direction | Shall contain the direction | M | | | of the intercepted packet, | | | | and it indicates either | | | | "from target" or "to | | | | target." | | +-----------------------------+-----------------------------+-------+ | packetSize | Shall contain the value of | M | | | the _"Total Length_ " IP | | | | header field if IPv4 is | | | | used, as defined in IETF | | | | RFC 791 [34], or the | | | | value of the "_Payload | | | | Length_ " field if IPv6 is | | | | used, as defined in IETF | | | | RFC 2460 [27]. | | +-----------------------------+-----------------------------+-------+ | NOTE: This is a placeholder | | | | value used to fill the | | | | pDUSessionID field, given | | | | that the UPF does not | | | | receive the PDU Session ID | | | | used for the session by the | | | | SMF, so this information is | | | | not available at the UPF. | | | | The PDU Session ID can be | | | | retrieved by the LEMF from | | | | the IRIs generated by the | | | | IRI-POI at the SMF and | | | | delivered by the MDF2. | | | +-----------------------------+-----------------------------+-------+
##### 6.2.3.9.4 PDSummaryReport record
If the summary form of the packet header reporting, i.e. PDSR, is used, the LI
function responsible for generating the xIRI extracts the information shown in
table 6.2.3.9.4-1 from each packet and aggregates it in summaries according to
the pDSRType field defined in the PDHRReportingExtensions parameters of the
ActivateTask message used to provision the LI function. In addition, the
current summary is sent when the LI function responsible for generating the
xIRI receives a DeactivateTask message for the Task that generated the PDSR
regardless of whether the trigger in the pDSRType field of the ActivateTask
message was met. In this case, the pDSRSummaryTrigger field of the PDSR record
shall be set to endOfFlow.
A PDSR shall be generated each time a flow (Source IP, Source Port,
Destination IP, Destination Port, Next Level Protocol, Direction) starts or
ends.
If the useSessionTriggers flag (see table 6.2.3.9.2-2) is absent or set to
false and the provisioned pDSRTriggerType is:
\- Packet count, a PDSR shall be generated whenever the number of packets
detected as a part of the flow reaches the provisioned trigger value.
\- Byte count, a PDSR shall be generated whenever the value for the cumulative
byte size across all packets belonging to the flow reaches the provisioned
trigger value.
\- Timer expiry, a separate timer should be used for each flow. A PDSR shall
be generated for a flow whenever the timer for that flow expires.
If the useSessionTriggers flag (see table 6.2.3.9.2-2) is set to true and the
provisioned pDSRTriggerType is:
\- Packet count, a PDSR shall be generated for each open flow whenever the
number of packets sent and received in the PDU Session/PDN Connection is
reaches the provisioned trigger value.
\- Byte count, a PDSR shall be generated for each open flow whenever the value
for the cumulative byte size across all packets belonging to the PDU
Session/PDN Connection is reaches the provisioned trigger value.
\- Timer expiry, a single timer should be used for each PDU Session/PDN
Connection. A PDSR shall be generated for each open flow whenever the timer
expires.
Table 6.2.3.9.4-1: PDSummaryReport record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | pDUSessionID | The PDU Session ID value | M | | | 255 shall be used; the | | | | receiver shall ignore the | | | | parameter (see NOTE). | | +-----------------------------+-----------------------------+-------+ | sourceIPAddress | Shall contain the source | M | | | address of the packet from | | | | the 32-bit _"Source | | | | Address"_ field in IPv4, as | | | | defined in IETF RFC 791 | | | | [34], or from the 128-bit | | | | _"Source Address"_ field in | | | | IPv6, as defined in IETF | | | | RFC 2460 [27]. | | +-----------------------------+-----------------------------+-------+ | sourcePort | Shall contain the _"Source | C | | | Port_ " number that | | | | indicates an application or | | | | service running on top of | | | | the transport, if the | | | | _"Protocol"_ IP field (see | | | | the _nextLayerProtocol_ | | | | field below in this table) | | | | is one of: | | | | | | | | a) Transmission Control | | | | Protocol (**TCP**), IP | | | | "Protocol" field decimal | | | | "6"; see IETF RFC 793 | | | | [28]. | | | | | | | | b) User Datagram Protocol | | | | (**UDP**), IP "Protocol" | | | | field decimal "17"; see | | | | IETF RFC 768 [29]. | | | | | | | | c) Datagram Congestion | | | | Control Protocol | | | | (**DCCP**), IP "Protocol" | | | | field decimal "33"; see | | | | IETF RFC 4340 [30]. | | | | | | | | d) Stream Control | | | | Transmission Protocol | | | | (**SCTP**), IP "Protocol" | | | | field decimal "132"; Stream | | | | Control Transmission | | | | Protocol [31]. | | | | | | | | For further details on | | | | Layer four protocols, see | | | | IANA [32]. | | +-----------------------------+-----------------------------+-------+ | destinationIPAddress | Shall contain the | M | | | destination address of the | | | | packet from the 32-bit | | | | _"Destination Address"_ | | | | field in IPv4, as defined | | | | in IETF RFC 791 [34], or | | | | from the 128-bit | | | | _"Destination Address"_ | | | | field, as defined in IETF | | | | RFC 2460 [27]. | | +-----------------------------+-----------------------------+-------+ | destinationPort | Shall contain the | C | | | _"Destination Port_ " number | | | | that indicates an | | | | application or service | | | | running on top of the | | | | transport, if the | | | | _"Protocol"_ IP field (see | | | | the _nextLayerProtocol_ | | | | field below in this table) | | | | is one of: | | | | | | | | a) Transmission Control | | | | Protocol (**TCP**), IP | | | | "Protocol" field decimal | | | | "6"; see IETF RFC 793 | | | | [28]. | | | | | | | | b) User Datagram Protocol | | | | (**UDP**), IP "Protocol" | | | | field decimal "17"; see | | | | IETF RFC 768 [29]. | | | | | | | | c) Datagram Congestion | | | | Control Protocol | | | | (**DCCP**), IP "Protocol" | | | | field decimal "33"; see | | | | IETF RFC 4340 [30]. | | | | | | | | d) Stream Control | | | | Transmission Protocol | | | | (**SCTP**), IP "Protocol" | | | | field decimal "132"; Stream | | | | Control Transmission | | | | Protocol [31]. | | | | | | | | For further details on | | | | Layer four protocols, see | | | | IANA [32]. | | +-----------------------------+-----------------------------+-------+ | nextLayerProtocol | Shall contain the contents | M | | | of the IP _"Protocol"_ | | | | field as defined in IETF | | | | RFC 791 [34] (bits 72..79 | | | | in the IP header), and is | | | | one of the assigned | | | | Internet protocol numbers | | | | defined in IANA [32]. | | +-----------------------------+-----------------------------+-------+ | iPv6flowLabel | If the IP addresses in the | C | | | report are IPv6, this field | | | | shall contain the 20-bit | | | | IPv6 "Flow Label" as | | | | defined in IPv6 IETF RFC | | | | 2460 [27] and the _IPV6 | | | | Flow Label Specification_ | | | | IETF RFC 6437 [33]. | | +-----------------------------+-----------------------------+-------+ | direction | Shall contain the direction | M | | | of the intercepted packet, | | | | and it indicates either | | | | "from target" or "to | | | | target." | | +-----------------------------+-----------------------------+-------+ | pDSRSummaryTrigger | Shall contain the trigger | M | | | that caused the summary | | | | report to be generated, | | | | which is one of the | | | | following: | | | | | | | | a) timer expiry. | | | | | | | | b) packet count. | | | | | | | | c) byte count. | | | | | | | | d) start of a flow. | | | | | | | | e) end of a flow. | | +-----------------------------+-----------------------------+-------+ | firstPacketTimestamp | Shall contain the timestamp | M | | | that represents the time | | | | that the IRI-POI in the UPF | | | | detected the first packet | | | | in the set represented by | | | | this summary. | | +-----------------------------+-----------------------------+-------+ | lastPacketTimestamp | Shall contain the timestamp | M | | | that represents the time | | | | that the IRI-POI in the UPF | | | | detected the last packet in | | | | the set represented by this | | | | summary. | | +-----------------------------+-----------------------------+-------+ | packetCount | Shall contain the number of | M | | | packets detected during the | | | | creation of this summary. | | +-----------------------------+-----------------------------+-------+ | byteCount | Shall contain the number of | M | | | bytes summed across all | | | | packets that belong to this | | | | summary. For IPv4 it is the | | | | sum of the _"Total Length"_ | | | | fields across all packets | | | | in the summary as defined | | | | in _Internet Protocol_ IETF | | | | RFC 791 [34], while for | | | | IPv6 it is the sum of the | | | | _"Payload Length_ " fields | | | | across all packets in the | | | | summary as defined in | | | | _Internet Protocol, Version | | | | 6 (IPv6) Specification_ , | | | | IETF RFC 2460 [27]. | | +-----------------------------+-----------------------------+-------+ | perSessionTrigger | Shall be present and set to | C | | | true if the trigger that | | | | caused the summary report | | | | to be generated was applied | | | | to the Session. If the | | | | trigger that caused the | | | | summary report to be | | | | generated was applied per | | | | flow, this parameter may be | | | | omitted but shall be set to | | | | false if present. | | +-----------------------------+-----------------------------+-------+ | NOTE: This is a placeholder | | | | value used to fill the | | | | pDUSessionID field, given | | | | that the UPF does not | | | | receive the PDU Session ID | | | | used for the session by the | | | | SMF, so this information is | | | | not available at the UPF. | | | | The PDU Session ID can be | | | | retrieved by the LEMF from | | | | the IRIs generated by the | | | | IRI-POI at the SMF and | | | | delivered by the MDF2. | | | +-----------------------------+-----------------------------+-------+
#### 6.2.3.10 Sharing LI state information over LI_ST
##### 6.2.3.10.1 Overview
TFs in SMFs in SMF sets need to share LI state information to avoid losing
track of the XIDs and CorrelationIDs used in the tasks activated in the POI in
the UPF when the triggered task control is transferred from one TF to another.
POIs in SMFs in SMF sets need to share LI state information to avoid losing
track of the CorrelationIDs and sequence numbers used in the generation of
xIRI and xCC when the interception is moved to another POI in the same SMF
set.
The LIPF may request, store or remove any LI state records at any moment. The
LIPF may revoke the credentials of any LI function to use the LI_ST function
via LI_X0.
##### 6.2.3.10.2 Storing LI state
The TF in the SMF shall store the LI state (related to a task active in the
UPF POI) in the LISSF whenever the parent SMF stores session state for the
relevant PDU session in the UDSF and whenever the parent SMF sends session
state for the relevant PDU session to another SMF.
The POI in the SMF shall store the LI state (related to a task active in the
SMF POI) in the LISSF whenever the parent SMF stores session state for the
relevant PDU session in the UDSF and whenever the parent SMF sends session
state for the relevant PDU session to another SMF.
When storing state, the LI function in the SMF shall use the state storage
procedure specified in clause 5.10.2. During this procedure, the LI function
shall add the metadata shown in table 6.2.3.10.2-1 to the RecordMeta for the
record.
Table 6.2.3.10.2-1: Additional metadata for the RecordMeta
* * *
Field Name Description M/C/O PDUSessionID Identifier for the PDU session
related to task. M UDSFRecordID The recordID used by the parent SMF to store
the associated SMF session information in the UDSF. M LIStateRecordType
Identifier for the record type which can be \"TFLIState\" or \"POILIState\". M
* * *
The TF shall store the following information as the first record block (see TS
29.598 [64] clause 6.1.3.3.3.2), encoded as XML following the XSD schema given
in Annex H.
Table 6.2.3.10.2-2: TFLIState structure for storing TF state information in
the LISSF
* * *
Field Name Description M/C/O PDUSessionID Identifier for the PDU session
related to task. M XID XID of the task object associated with the interception
at the TF in SMF. M CorrelationID Correlation ID to assign to interception
product generated by the POI in the UPF. M TriggeredTasks Collection of
information about tasks that the TF in SMF has activated in triggered POIs in
UPF due to interception for this PDU session. As a list of TriggeredTask, see
table 6.2.3.10.2-3 below. M
* * *
Table 6.2.3.10.2-3: TriggeredTask
* * *
Field Name Description M/C/O XID XID of the task object associated with the
interception at the triggered. M NEID NEID used in LI_T2/LI_T3 communication
by the triggered POI in UPF. M
* * *
The TF shall specify the XID in order to avoid removing the LI state related
to the same ProductID but a different task in the UPF POI, for example if
there is more than one PDU session.
The SMF POI shall store the information shown in table 6.2.3.10.2-4 as the
first record block (see TS 29.598 [64] clause 6.1.3.3.3.2), encoded as XML
following the XSD schema given in Annex H.
Table 6.2.3.10.2-4: POILIState structure for storing POI state information in
the LISSF
* * *
Field Name Description M/C/O PDUSessionID Identifier for the PDU session
related to task. M XID XID of the task object associated with the interception
at the POI in SMF. M SequenceNumber Last sequence number used in the
generation of xIRI/xCC. M CorrelationID Correlation ID to assign to
interception product generated by the POI in the SMF. M
* * *
##### 6.2.3.10.3 Retrieving LI state
When the TF in an SMF in an SMF set is provisioned by the LIPF with a specific
XID and access to an LISSF function, the TF shall use the LISSF to retrieve LI
state information.
If the implementation of the SMF set does not ensure that active SM contexts
are always present in some SMF of the SMF set, when a task previously
provisioned by the LIPF in the TF is deactivated, the TF shall request the
records associated to the XID (received from the LIPF) from the LISSF, by
performing a search as described in clause 5.10.3, using the XID as a search
criteria. If no records are found, the TF may assume that no previous
interception has occurred and proceed accordingly.
When a TF detects that its parent SMF is retrieving state for a targetted PDU
session from the UDSF, the TF shall request records associated with that PDU
session from the LISSF by performing a search as described in clause 5.10.3
and using the UDSFRecordID used by the SMF as a search criteria. When a TF
detects that its parent SMF is receiving state for a targetted PDU session
from another SMF, the TF shall request records associated with that PDU
session from the LISSF by performing a search as described in clause 5.10.3
and using the XID of the task related to the target of that PDU session. If no
records are found, the TF may assume that no previous interception has
occurred and proceed accordingly. Implementers should be aware that multiple
records may be returned.
When an SMF POI detects that its parent SMF is retrieving state for a
targetted PDU session from the UDSF, the POI shall request records associated
with that PDU session from the LISSF by performing a search as described in
clause 5.10.3 and using the UDSFRecordID used by the SMF as a search criteria.
When an SMF POI detects that its parent SMF is receiving state for a targetted
PDU session from another SMF, the SMF POI shall request records associated
with that target PDU session from the LISSF by performing a search as
described in clause 5.10.3 and using the XID of the task related to the target
of that PDU session. If no records are found, the SMF POI may assume that no
previous interception has occurred and proceed accordingly.
##### 6.2.3.10.4 Removing LI state
When a task is deactivated successfully in the UPF POI, the TF shall remove
the LI state record from the LISSF as described in clause 5.10.4.
When a task is deactivated in the SMF POI, the POI shall remove the LI state
record from the LISSF as described in clause 5.10.4.
### 6.2.4 LI at UDM for 5G
#### 6.2.4.1 General description
In 5G packet core network, the UDM provides the unified data management for
UE. The UDM shall have LI capabilities to generate the target UE's service
area registration related xIRI. See clause 7.2.2 for the details.
### 6.2.5 LI at SMSF
#### 6.2.5.1 Provisioning over LI_X1
The IRI-POI present in the SMSF is provisioned over LI_X1 by the LIPF using
the X1 protocol as described in clause 5.2.2.
The IRI-POI in the SMSF shall support the following target identifier formats
in the ETSI TS 103 221-1 [7] messages:
\- SUPIIMSI.
\- SUPINAI.
\- PEIIMEI.
\- PEIIMEISV.
\- GPSIMSISDN.
\- GPSINAI.
If service scoping is to be performed at the IRI-POI in the SMSF, the IRI-POI
in the SMSF shall support the following CSP service types (see clauses 4.4.2
and 5.2.4):
\- Messaging.
If the IRI-POI in the SMSF receives an ActivateTask message and the
ListOfServiceTypes parameter contains a ServiceType that is not supported, the
IRI-POI in the SMSF shall reject the task with an appropriate error as
described in ETSI TS 103 221-1 [7] clause 6.2.1.2.
Table 6.2.5-1 shows the minimum details of the LI_X1 ActivateTask message used
for provisioning the IRI-POI in the SMSF.
Table 6.2.5-1: ActivateTask message for the IRI-POI in the SMSF
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. | M | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One of the target | M | | | identifiers listed in the | | | | paragraph above. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X2Only". | M | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints for | M | | | LI_X2 for the IRI-POI in | | | | the SMSF. These delivery | | | | endpoints are configured | | | | using the CreateDestination | | | | message as described in | | | | ETSI TS 103 221-1 [7] | | | | clause 6.3.1 prior to the | | | | task activation. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | This field shall be | C | | | included if the delivery of | | | SMSFExtensions | the full TPDU is not | | | | authorised. See table | | | | 6.2.5-2. | | +-----------------------------+-----------------------------+-------+ | ListOfServiceTypes | Shall be included when the | C | | | task should only intercept | | | | specific CSP service types | | | | as described in clause | | | | 5.2.4. This parameter is | | | | defined in ETSI TS 103 | | | | 221-1 [7], clause | | | | 6.2.1.2, table 4. | | +-----------------------------+-----------------------------+-------+
Table 6.2.5-2: TruncateTPUserData Parameters
* * *
Field Name Description M/C/O TruncateTPUserData If included, the
truncatedSMSTPDU field of the sMSTPDUData (as described in table 6.2.5-7)
structure shall be used when applicable (see text below table). If absent, the
sMSTPDU field of the sMSTPDUData structure shall be used. C
* * *
If the TruncateTPUserData field of the LI_X1 ActivateTask message is included,
the IRI-POI in the SMSF shall use the truncatedSMSTPDU field in xIRI generated
at the IRI-POI in the SMSF for SMS-SUBMIT and SMS-DELIVER TPDUs, otherwise,
the sMSTPDU field shall be used.
The MDF2 listed as the delivery endpoint for the LI_X2 generated by the IRI-
POI in the SMSF shall be provisioned over LI_X1 by the LIPF using the X1
protocol as described in clause 5.2.2. If SMS Content delivery is not
authorized, the MDF2 shall be provisioned with the TruncateTPUserData
included, otherwise it shall be be left absent.
Table 6.2.5-3 shows the minimum details of the LI_X1 ActivateTask message used
for provisioning the MDF2.
Table 6.2.5-3: ActivateTask message for MDF2
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. | M | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One of the target | M | | | identifiers listed in | | | | clause 6.2.5.1. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X2Only". (Ignored | M | | | by the MDF2). | | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints for | M | | | LI_HI2. These delivery | | | | endpoints are configured | | | | using the CreateDestination | | | | message as described in | | | | ETSI TS 103 221-1 [7] | | | | clause 6.3.1 prior to the | | | | task activation. | | +-----------------------------+-----------------------------+-------+ | ListOfMediationDetails | Sequence of Mediation | M | | | Details, see table 6.2.5-4. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | This field shall be | C | | | included if the delivery of | | | SMSFExtensions | the full TPDU is not | | | | authorised. See table | | | | 6.2.5-2. | | +-----------------------------+-----------------------------+-------+
Table 6.2.5-4: Mediation Details for MDF2
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O LIID Lawful Interception ID
associated with the task. M DeliveryType Set to \"HI2Only\". M ListOfDIDs
Details of where to send the IRI for this LIID. Shall be included if deviation
from the ListofDIDs in the ActivateTask message is necessary. If included, the
ListOfDIDs in the Mediation Details shall be used instead of any delivery
destinations specified in the ListOfDIDs field in the ActivateTask Message. C
ServiceScoping Shall be included to Identify the service(s) and associated
service-related delivery settings for this LIID. May include more than one
instance of this parameter to allow for different combinations of sub-
parameters associated with a single LIID. This parameter is defined in ETSI TS
103 221-1 [7] Annex C table C.2. C
* * *
#### 6.2.5.2 Generation of xIRI over LI_X2
The IRI-POI present in the SMSF shall send xIRI over LI_X2 for the event
listed in TS 33.127 [5] clause 6.2.5.3, the details of which are described in
the following clause.
#### 6.2.5.3 SMS Message
The IRI-POI in the SMSF shall generate an xIRI containing an SMSMessage record
for the following cases:
SMS-MO case:
\- When a target UE originates an SMS message or when any UE originates an SMS
message destined to a target non-local ID.
SMS-MT case:
\- When an SMS message delivery to a target UE is attempted or when an SMS
message delivery originated from a target non-local ID is attempted to any UE.
\- When an SMS message is successfully delivered to a target UE or when an SMS
message originated from a target non-local ID is successfully delivered to any
UE.
The SMS-MT case can also apply to the scenario when a receipt of SMS delivery
from the far end is delivered successfully to the target UE or when a receipt
of SMS delivery from a target non-Local ID is successfully delivered to the
originating UE.
The IRI-POI present in the SMSF shall generate the xIRI containing the
SMSMessage record when it detects following events:
\- The SMSF receives an SMCP message CP-DATA_RP-DATA [SMS-SUBMIT, SMS-COMMAND]
(via AMF in Nsmsf_SMService_UplinkSMS message) from a target UE.
\- The SMSF receives an SMCP message CP-DATA_RP-DATA [SMS-SUBMIT] (via AMF in
Nsmsf_SMService_UplinkSMS message) from any UE with TP-DA field within the
SMS-SUBMIT containing a target non-Local ID and SMSF returns the SMCP: CP-ACK
to that originating UE.
\- The SMSF receives an SMCP message CP-DATA_RP-DATA [SMS-COMMAND] (via AMF in
Nsmsf_SMService_UplinkSMS message) from any UE with TP-DA field within the
SMS-COMMAND containing a target non-Local ID and SMSF returns the SMCP: CP-ACK
to that originating UE.
\- The SMSF receives a TCAP message MAP MT-FORWARD-SHORT-MESSAGE Request [SMS-
DELIVER, SMS-STATUS-REPORT] destined to a target UE.
\- The SMSF receives a TCAP message MAP MT-FORWARD-SHORT-MESSAGE Request [SMS-
DELIVER] destined to any UE with the TP-OA field within the SMS-DELIVER
containing a target non-Local ID.
\- The SMSF receives a TCAP message MAP MT-FORWARD-SHORT-MESSAGE Request [SMS-
STATUS-REPORT] destined to any UE with the TP-RA field within the SMS-STATUS-
REPORT containing a target non-Local ID.
The IRI-POI present in the SMSF shall generate the xIRI containing the
SMSReport record when it detects following events:
\- The SMSF sends a SMCP message CP-DATA_RP-ACK [SMS-SUBMIT-REPORT] (via AMF
in Namf_ Communication_N1N2MessageTransfer message) in response to a
previously intercepted CP-DATA_RP-DATA.
\- The SMSF sends a SMCP message CP-DATA_RP-ERROR [SMS-SUBMIT-REPORT] (via AMF
in Namf_ Communication_N1N2MessageTransfer message) in response to a
previously intercepted CP-DATA_RP-DATA.
\- The SMSF sends a TCAP message MAP MT-FORWARD-SHORT-MESSAGE Response [SMS-
DELIVER-REPORT] in response to a previously intercepted MAP MT-FORWARD-SHORT-
MESSAGE Request.
NOTE 1: In the above-mentioned descriptions, the requirements of target Non-
Local ID do not apply when both originating and terminating users of an SMS
message are served by the same CSP. The method used to identify a target non-
Local ID is different from the method used to identify a local target ID.
If the IRI-POI is provisioned with the TruncateTPUserData parameter included
and the IRI-POI is generating xIRI for the SMS-SUBMIT type (TS 23.040 [18]
clause 9.2.2.2) or SMS-DELIVER type (TS 23.040 [18] clause 9.2.2.1) TPDUs, the
IRI-POI shall use the truncatedSMSTPDU (as described in table 6.2.5-7),
otherwise, the IRI-POI shall use the sMSTPDU.
Table 6.2.5-5: Payload for SMSMessage record
+---------------------+--------------------------------------+-------+ | Field name | Description | M/C/O | +---------------------+--------------------------------------+-------+ | originatingSMSParty | Identity of the originating SMS | M | | | party. See NOTE 2. | | +---------------------+--------------------------------------+-------+ | terminatingSMSParty | Identity of the terminating SMS | M | | | party. See NOTE 3. | | +---------------------+--------------------------------------+-------+ | direction | Direction of the SMS with respect to | M | | | the target. See NOTE 4. | | +---------------------+--------------------------------------+-------+ | linkTransferStatus | Indicates whether the SMSF sent the | M | | | TPDU to the next network element. | | | | See NOTE 5. | | +---------------------+--------------------------------------+-------+ | otherMessage | In the event of a server-initiated | C | | | transfer, indicates whether the | | | | server will send another SMS. May be | | | | omitted if the transfer is | | | | target-initiated. See NOTE 6. | | +---------------------+--------------------------------------+-------+ | location | Location information associated with | C | | | the target sending or receiving the | | | | SMS, if available and authorised. | | | | See NOTE 7. | | | | | | | | Encoded as a _userLocation_ | | | | parameter | | | | (_loc | | | | ation >locationInfo>userLocation_), | | | | see Annex A. | | +---------------------+--------------------------------------+-------+ | peerNFAddress | Address of the other network | C | | | function (SMS-GMSC/IWMSC/SMS-Router) | | | | involved in the communication of the | | | | SMS, if available. | | +---------------------+--------------------------------------+-------+ | peerNFType | Type of the other network function | C | | | (SMS-GMSC/IWMSC/SMS-Router) involved | | | | in the communication of the SMS, if | | | | available. | | +---------------------+--------------------------------------+-------+ | sMSTPDUData | See table 6.2.5-7. This is | C | | | conditional only for backwards | | | | compatibility. | | +---------------------+--------------------------------------+-------+ | messageType | See table 6.2.5-8. This is | C | | | conditional only for backwards | | | | compatibility. | | +---------------------+--------------------------------------+-------+ | rPMessageReference | The SM-RL Message Reference of the | C | | | message per TS 24.011 [46] clause | | | | 7.3. This is conditional only for | | | | backwards compatibility. | | +---------------------+--------------------------------------+-------+
The sMSTPDU field shall always be used for the sMSTPDUData field of the
SMSReport record.
Table 6.2.5-6: Payload for SMSReport record
* * *
Field name Description M/C/O location Location information associated with the
target sending or receiving the SMS, if available and authorised. See NOTE 7.
C sMSTPDUData SMS TPDU, encoded as per TS 23.040 [18] clause 9. M messageType
See table 6.2.5-8. M rPMessageReference The SM-RL Message Reference of the
message per TS 24.011 [46] clause 7.3. M
* * *
Table 6.2.5-7: SMSTPDUData field
* * *
Field name Description sMSTPDU SM-TL PDU encoded per the PDUs defined in TS
23.040 [18] clause 9.2.2. Shall be chosen if the TruncateTPUserData Parameter
is absent. truncatedSMSTPDU SM-TL PDU encoded per the PDUs defined in TS
23.040 [18] clause 9.2.2 but truncated to remove TP-User-Data (TS 23.040 [18]
clause 9.2.3.24). Shall be chosen if the TruncateTPUserData Parameter is set.
* * *
Table 6.2.5-8: SMSMessageType values
* * *
messageType value RP MTI Value RP Message Type TP-MTI Value SMS TPDU Message
Type deliver 001 RP-DATA (networkUE) 00 SMS-DELIVER deliverReportAck 010 RP-
ACK (UEnetwork) 00 SMS-DELIVER-REPORT deliverReportError 100 RP-ERROR
(UEnetwork) 00 SMS-DELIVER-REPORT statusReport 001 RP-DATA (networkUE) 10 SMS-
STATUS-REPORT command 000 RP-DATA (UEnetwork) 10 SMS-COMMAND submit 000 RP-
DATA (UEnetwork) 01 SMS-SUBMIT submitReportAck 011 RP-ACK (networkUE) 01 SMS-
SUBMIT-REPORT submitReportError 101 RP-ERROR (networkUE) 01 SMS-SUBMIT-REPORT
reserved Reserved 11 Reserved
* * *
The IRI-POI in the SMSF shall populate the messageType field with the values
listed in table 6.2.5-8 based on the SMS TPDU message type (see TS 23.040 [18]
clause 9.2.2) and the RP Message Type (see TS 24.011 [46] clause 8.2.2) that
triggered the generation of the xIRI. The SMS TPDU Message Type is indicated
by the value of the TP-Message Type Indicator (TP-MTI) (see TS 23.040 [18]
clause 9.2.3.1) as described in TS 23.040 [18] clause 9.2.3.1. The RP Message
Type is indicated by the value of the RP MTI (See TS 24.011 [46] clause
8.2.2).
NOTE 2: For the SMS-MO case, the originating party is the address of the UE
from which the SMSF receives the CP-DATA_RP-DATA [SMS-SUBMIT, SMS-COMMAND]
message (via AMF in the Nsmsf_SMService_UplinkSMS). The GPSI is one of the
data fields used in the Nsmsf related messages (see TS 29.540 [21]).
Alternatively, the SMSF may find the originating party address in the same way
it finds the address when generating charging records. For SMS-MT case, this
is derived from TP-OA field (TS 23.040 [18]) for SMS-DELIVER TPDUs or the TP-
RA field (TS 23.040 [18]) for SMS-STATUS-REPORT TPDUs. In cases where the
originatingSMSParty is not a GPSI, PEI, or SUPI, the sMSAddress parameter is
populated with the octets received in the field used to derive the address (as
per TS 23.040 [18] clause 9.1.2.5).
NOTE 3: For SMS-MT case, the terminating party is the address of the UE to
which the SMSF sends the CP-DATA_RP-DATA [SMS-DELIVER, SMS-STATUS-REPORT]
message (via AMF in Namf_Communications_N1N2MessageTransfer). The GPSI is one
of the data fields used in the Namf related messages (TS 29.518 [22]).
Alternatively, the SMSF may find the terminating party address in the same way
it finds the address when generating charging records. For SMS-MO case, this
is derived from the TP-DA field (TS 23.040 [18]). In cases where the
terminatingSMSParty is not a GPSI, PEI, or SUPI, the sMSAddress parameter is
populated with the octets received in the field used to derive the address (as
per TS 23.040 [18] clause 9.1.2.5).
NOTE 4: For the SMS-MO case, for SMS originated from the target UE, the value
fromTarget is used and for SMS destined to target Non-local ID, the toTarget
is used. For SMS-MT case, for SMS terminated to the target UE, the value
toTarget is used and for SMS originated from a target Non-local ID, the
fromTarget is used.
NOTE 5: This field is set to transferSucceeded or transferFailed as follows:
\- SMS-MO case:
\- To transferSucceeded: when the IRI-POI in the SMSF detects that SMSF sends
the MO-FORWARD-SHORT-MESSAGE-Request [SMS-SUBMIT] message to the SMS-IWMSC.
\- To transferFailed: when the IRI-POI in SMSF detects the scenarios where
SMSF cannot send the MO-FORWARD-SHORT-MESSAGE-Request [SMS-SUBMIT] to the SMS-
IWMSC, but still generates an xIRI containing the SMSMessage record.
\- SMS-MT case:
\- To transferSucceeded: when the IRI-POI in the SMSF detects that SMSF sends
the MT-FORWARD-SHORT-MESSAGE-Response [SMS-DELIVER-REPORT] message to the SMS-
GMSC.
\- To transferFailed: when the IRI-POI in SMSF detects the scenarios where
SMSF cannot send the MT-FORWARD-SHORT-MESSAGE-Response [SMS-DELIVER-REPORT] to
the SMS-GMSC, but an xIRI containing the SMSMessage record is still generated.
NOTE 6: This is only applicable to the SMS-MT case and can be derived from the
TP-MMS (More Message to Send) field present in the SMS-DELIVER sent to the UE
(via AMF in the Namf_Communications_N1N2MessageTransfer).
NOTE 7: This is derived from the ueLocation field of SmsRecord IE received
from the AMF in the Nsmsf_SMService_UplinkSMS message (TS 29.540 [21]). For
the SMSMessage record, the SMCP message is CP-DATA_RP-DATA [SMS-SUBMIT, SMS-
COMMAND] and for the SMSReport record, the SMCP message is CP-DATA-RP-ACK
[SMS-DELIVER-REPORT]. This value is encoded as a _userLocation_ parameter
(_location >locationInfo>userLocation_), see Annex A.
#### 6.2.5.4 Generation of IRI over LI_HI2
When an xIRI containing the SMSMessage record is received over LI_X2 from the
IRI-POI in SMSF, the MDF2 shall send the IRI message over LI_HI2 without undue
delay. The IRI message shall contain a copy of the SMSMessage record received
over LI_X2. The SMSMessage record may be enriched by other information
available at the MDF (e.g. additional location information).
If the MDF2 is provisioned with the TruncateTPUserData parameter included, the
truncatedSMSTPDU field shall be used in SMSMessage IRI message, otherwise, the
sMSTPDU field shall be used.
The threeGPP33128DefinedIRI field (see ETSI TS 102 232-7 [10] clause 15) shall
be populated with the BER-encoded IRIPayload.
The timestamp field of the PSHeader structure shall be set to the time that
the SMSF event was observed (i.e. the timestamp field of the xIRI).
Each SMSMessage record shall be delivered as an IRI REPORT (see ETSI TS 102
232-1 [9] clause 5.2.10) with a new CIN assigned (see ETSI TS 102 232-1 [9]
clause 5.2.4).
Each SMSReport record shall be delivered as a separate IRI REPORT (see ETSI TS
102 232-1 [9] clause 5.2.10) with the same CIN as the IRI REPORT of the
associated SMSMessage record.
### 6.2.6 LI support at NRF
The SIRF present within the NRF provides SBA-related information to the LIPF
over the LI_SI interface. Details for this interface are not considered in the
present document and are for further study.
## 6.3 4G
### 6.3.1 General
The present document allows three options for EPC LI stage 3 interfaces for 4G
/ LTE:
\- Option A: Use LI_X1, LI_X2 and LI_X3 interfaces specified below in clauses
6.3.2 and 6.3.3 for the events listed in TS 33.127 [5] clauses 6.3.2.3 and
6.3.3.3, and the events related to SMS over NAS as specified in TS 33.107 [36]
clause 18.2.4.
\- Option B: Use LI_X1, LI_X2 and LI_X3 interfaces as specified in clause
6.3.2 and 6.3.3 for the events listed in TS 33.107 [36] clause 12.2.1.2 and
for the events related to the MMEIdentifierAssociation record described in
clause 6.3.2.2.2.
\- Option C: Use TS 33.107 [36] clause 12 natively as defined in that
document.
For implementations that include EPS/5GS interworking, Option A shall be used.
In all cases, the present document specifies the stage 3 for the LI_HI1,
LI_HI2 and LI_HI3 interfaces.
### 6.3.2 LI at MME
#### 6.3.2.1 Provisioning over LI_X1
The IRI-POI present in the MME is provisioned over LI_X1 by the LIPF using the
X1 protocol as described in clause 5.2.2.
The POI in the MME shall support the following target identifier formats:
\- IMSI (using the IMSI target identifier format from ETSI TS 103 221-1 [7]).
\- MSISDN (using the E164Number target identifier format from ETSI TS 103
221-1 [7]).
\- ME Identity (using the IMEI target identifier format from ETSI TS 103 221-1
[7]).
Table 6.3.2-0A shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the IRI-POI in the MME.
Table 6.3.2-0A: ActivateTask message for the IRI-POI in the MME
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. | M | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One of the target | M | | | identifiers listed in the | | | | paragraph above. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to \"X2Only\". | M | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints for | M | | | LI_X2 for the IRI-POI in | | | | the MME. These delivery | | | | endpoints are configured | | | | using the CreateDestination | | | | message as described in | | | | ETSI TS 103 221-1 [7] | | | | clause 6.3.1 prior to the | | | | task activation. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | This field shall be | C | | | included if the IRI-POI is | | | Iden | required to generate | | | tifierAssociationExtensions | MMEIdentifierAssociation | | | | records (see clause | | | | 6.3.2.2.1). If the field is | | | | absent, | | | | MMEIdentifierAssociation | | | | records shall not be | | | | generated. | | +-----------------------------+-----------------------------+-------+ | ListOfServiceTypes | Shall be included when the | C | | | task should only intercept | | | | specific CSP service types | | | | as described in clause | | | | 5.2.4. This parameter is | | | | defined in ETSI TS 103 | | | | 221-1 [7], clause | | | | 6.2.1.2, table 4. | | +-----------------------------+-----------------------------+-------+
Table 6.3.2-0B: IdentifierAssociationExtensions Parameters
+-----------------+------------------------------------------+-------+ | Field Name | Description | M/C/O | +-----------------+------------------------------------------+-------+ | EventsGenerated | One of the following values: | M | | | | | | | - IdentifierAssociation | | | | | | | | - All | | | | | | | | See clause 6.3.2.2.1 for the | | | | interpretation of this field. | | +-----------------+------------------------------------------+-------+
#### 6.3.2.2 Generation of xIRI over LI_X2
##### 6.3.2.2.1 General
If the MME receives one or more cell IDs in an S1 message (as specified in TS
36.413 [38]), the POI associated with the MME shall report all of them.
The IRI-POI in the MME shall only generate xIRI containing the
MMEIdentifierAssociation record in the following scenarios:
\- IdentifierAssociation: MMEIdentifierAssociation and Tracking Area/EPS
Location Update (see TS 33.107 [36] clause 12.2.1.2) records shall be
generated. No other record types shall be generated for that target.
\- All: All MME record types shall be generated.
When Option A specified in clause 6.3.1 is used:
\- The IRI-POI present in the MME shall send the xIRIs over LI_X2 for each of
the events listed in TS 33.127 [5] clause 6.3.2.3, the details of which are
described in the following clauses.
\- In addition to the xIRI events listed in TS 33.127 [5] clause 6.3.2.3, the
MME shall support xIRI generation in case of SMS over NAS as specified in TS
33.107 [36] clause 18.2.4. For records related to SMS over NAS in EPS:
\- The IRI-POI present in the MME shall set the payload format to
EpsHI2Operations.EpsIRIContent (value 14), see clause 5.3 and ETSI TS 103
221-2 [8] clause 5.4. The payload field shall contain an
EpsHI2Operations.EpsIRIContent structure encoded according to TS 33.108 [12]
clauses 10.5, 15.2 and B.9.
\- As the LIID may be not available at the MME but is mandatory in
EpsHI2Operations.EpsIRIContent according to TS 33.108 [12] Annex B.9, its
value in the lawfulInterceptionIdentifier field of the encoded PDU shall be
set to the fixed string \"LIIDNotPresent\".
When Option B specified in clause 6.3.1 is used:
\- The IRI-POI present in the MME shall send the xIRIs over LI_X2 for each of
the events listed in TS 33.107 [36] clause 12.2.1.1, the details of which are
specified in clause 12.2.3 of the same TS, and in case of SMS over NAS as
specified in TS 33.107 [36] clause 18.2.4.
\- For all records except MMEIdentifierAssociation (see clause 6.3.2.2.2), the
IRI-POI present in the MME shall set the payload format to
EpsHI2Operations.EpsIRIContent (value 14), see clause 5.3 and ETSI TS 103
221-2 [8] clause 5.4. The payload field shall contain an
EpsHI2Operations.EpsIRIContent structure encoded according to TS 33.108 [12]
clauses 10.5, 15.2 and B.9.
\- As the LIID may be not available at the MME but is mandatory in
EpsHI2Operations.EpsIRIContent according to TS 33.108 [12] Annex B.9, its
value in the lawfulInterceptionIdentifier field of the encoded PDU shall be
set to the fixed string \"LIIDNotPresent\".
\- In addition to the xIRI events listed in TS 33.107 [36], the MME shall
support xIRI containing the MMEIdentiferAssociation record in clause
6.3.2.2.2.
##### 6.3.2.2.2 MME identifier association
The IRI-POI present in the MME shall generate an xIRI containing an
MMEIdentifierAssociation record when the IRI-POI present in the MME detects a
new identifier association for a UE matching one of the target identifiers
provided via LI_X1. Generation of this record is subject to this record type
being enabled for a specific target (see clause 6.3.2.2.1).
Table 6.3.2-1: Payload for MMEIdentifierAssociation record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +=============================+=============================+=======+ | iMSI | IMSI associated with the | M | | | procedure. (see NOTE 1). | | +-----------------------------+-----------------------------+-------+ | iMEI | IMEI used in the procedure, | C | | | if available (see NOTE 1). | | +-----------------------------+-----------------------------+-------+ | mSISDN | MSISDN used in the | C | | | procedure, if available | | | | (see NOTE 1). | | +-----------------------------+-----------------------------+-------+ | gUTI | LTE GUTI used in the | M | | | procedure. | | +-----------------------------+-----------------------------+-------+ | location | Location information | M | | | available when identifier | | | | association occurs. | | | | | | | | Shall include all location | | | | information for the target | | | | UE available at the MME | | | | encoded as one of the | | | | following: | | | | | | | | - | | | | e | | | | _PSUserLocationInformation_ | | | | parameter | | | | (_loca | | | | tion >fourGLocationInfo>eP | | | | SUserLocationInformation_). | | | | | | | | - _ePSLocationInformation | | | | parameter | | | | ( | | | | location >fourGLocationInfo | | | | >ePSLocationInformation)._ | | | | | | | | When Dual Connectivity is | | | | activated, the | | | | _additionalCellIDs_ | | | | parameter | | | | (_location >fourG | | | | LocationInfo>ePSLocationIn | | | | formation>mMELocationInfor | | | | mation>additionalCellIDs_) | | | | shall also be populated, | | | | see clause 7.3.3 and Annex | | | | A. | | +-----------------------------+-----------------------------+-------+ | tAIList | List of tracking areas | C | | | associated with the | | | | registration area within | | | | which the UE is current | | | | registered. (see NOTE 2). | | +-----------------------------+-----------------------------+-------+ | NOTE 1: IMSI shall always | | | | be provided, in addition to | | | | the warrant target | | | | identifier if different to | | | | IMSI. Other identifiers | | | | shall be provided if | | | | available. | | | | | | | | NOTE 2: List shall be | | | | included each time there is | | | | a change to the | | | | registration area. | | | +-----------------------------+-----------------------------+-------+
The IRI-POI present in the MME generating an xIRI containing an
MMEIdentifierAssociation record shall set the Payload Direction field in the
PDU header to _not applicable_ (Direction Value 5, see ETSI TS 103 221-2 [8]
clause 5.2.6).
When transmitting the xIRI, the IRI-POI present in the MME shall set the
payload format to 2, and provide the payload as a BER-encoded
TS33128Payloads.XIRIPayloads structure.
##### 6.3.2.2.3 Attach
The IRI-POI in the MME shall generate an xIRI containing an MMEAttach record
when the IRI-POI present in the MME detects that a UE matching one of the
target identifiers provided via LI_X1 has successfully attached to EPS.
Accordingly, the IRI-POI in the MME generates the xIRI when the following
event is detected:
\- MME sends an S1: ATTACH ACCEPT message to the target UE and the UE EPS
Mobility Management (EMM) state within the MME is changed to EMM-REGISTERED.
Table 6.3.2-2: Payload for MMEAttach record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | attachType | Specifies the type of EPS | M | | | Attach, see TS 24.301 | | | | [51] clause 9.9.3.11. | | | | This is derived from the | | | | information received from | | | | the UE in the Attach | | | | Request message. | | +-----------------------------+-----------------------------+-------+ | attachResult | Specifies the result of the | M | | | attach procedure, see TS | | | | 24.301 [51] clause | | | | 9.9.3.10. | | +-----------------------------+-----------------------------+-------+ | iMSI | IMSI associated with the | M | | | registration. | | +-----------------------------+-----------------------------+-------+ | iMEI | IMEI associated with the | C | | | registration, if available. | | +-----------------------------+-----------------------------+-------+ | mSISDN | mSISDN associated with the | C | | | registration, if available. | | +-----------------------------+-----------------------------+-------+ | gUTI | GUTI provided as outcome of | M | | | initial attach or used in | | | | other cases, see TS 24.301 | | | | [51] clause 5.5.1.2.4. | | +-----------------------------+-----------------------------+-------+ | location | Location information | C | | | determined by the network | | | | during the registration or | | | | known at the MME, if | | | | available. | | | | | | | | Shall include all location | | | | information for the target | | | | UE available at the MME | | | | encoded as one of the | | | | following: | | | | | | | | - | | | | * | | | | ePSUserLocationInformation _| | | | parameter | | | | (_ loca | | | | tion>fourGLocationInfo>eP | | | | SUserLocationInformation _). | | | | | | | | -_ ePSLocationInformation | | | | parameter | | | | ( | | | | location>fourGLocationInfo | | | | >ePSLocationInformation).* | | +-----------------------------+-----------------------------+-------+ | ePSTAIList | List of tracking areas | C | | | associated with the | | | | registration area within | | | | which the UE is currently | | | | registered, see TS 24.301 | | | | [51] clause 9.9.3.33. | | | | (see NOTE) | | +-----------------------------+-----------------------------+-------+ | sMSServiceStatus | Indicates the availability | C | | | of SMS Services. Shall be | | | | provided if present in the | | | | ATTACH ACCEPT. | | +-----------------------------+-----------------------------+-------+ | oldGUTI | Old GUTI used in the | C | | | registration, if available. | | +-----------------------------+-----------------------------+-------+ | eMM5GRegStatus | UE Status, if provided in | C | | | the REGISTRATION REQUEST | | | | message, see TS 24.501 | | | | [13] clause 9.11.3.56. | | +-----------------------------+-----------------------------+-------+ | NOTE: List shall be | | | | included each time there is | | | | a change to the | | | | registration area. | | | +-----------------------------+-----------------------------+-------+
##### 6.3.2.2.4 Detach
The IRI-POI in the MME shall generate an xIRI containing an MMEDetach record
when the IRI-POI present in the MME detects that a UE matching one of the
target identifiers provided via LI_X1 has deregistered from the EPS.
Accordingly, the IRI-POI in the MME generates the xIRI when any of the
following events is detected:
\- For network initiated de-registration, when the MME receives the S1: DETACH
ACCEPT message from the target UE, when the MME receives an S3: DETACH
NOTIFICATION about the target UE from the SGSN or when implicit deregistration
timer expires; and in all cases the UE EMM state within the MME is changed to
EMM-DEREGISTERED.
\- For UE initiated de-registration, when the MME sends the S1: DETACH ACCEPT
message to the target UE or when the MME receives the S1: DETACH REQUEST
message from the target UE with deregistration type value of "switch off"; and
in both cases the UE EMM state within the MME is changed to EMM-DEREGISTERED.
Table 6.3.2-3: Payload for MMEDetach record
+-------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-------------------------+-----------------------------+-------+ | deregistrationDirection | Indicates whether the | M | | | deregistration was | | | | initiated by the network or | | | | by the UE. | | +-------------------------+-----------------------------+-------+ | detachType | Indicates the type of | M | | | detach as determined by the | | | | direction of the detach | | | | request and the value of | | | | the DetachType information | | | | element, see table 6.3.2-4. | | +-------------------------+-----------------------------+-------+ | iMSI | IMSI associated with the | M | | | detach. | | +-------------------------+-----------------------------+-------+ | iMEI | IMEI associated with the | C | | | detach, if available. | | +-------------------------+-----------------------------+-------+ | mSISDN | mSISDN associated with the | C | | | detach, if available. | | +-------------------------+-----------------------------+-------+ | gUTI | GUTI associated with the | C | | | detach, if available. | | +-------------------------+-----------------------------+-------+ | cause | Indicates the EMM cause | C | | | value for network-initiated | | | | detach, see TS 24.301 | | | | [51] clause 9.9.3.9. | | +-------------------------+-----------------------------+-------+ | location | Location information | C | | | determined by the network | | | | during the deregistration | | | | or known at the MME, if | | | | available. | | | | | | | | Shall include all location | | | | information for the target | | | | UE available at the MME | | | | encoded as one of the | | | | following: | | | | | | | | - | | | | * | | | | ePSUserLocationInformation _| | | | parameter | | | | (_ loca | | | | tion>fourGLocationInfo>eP | | | | SUserLocationInformation _). | | | | | | | | -_ ePSLocationInformation | | | | parameter | | | | ( | | | | location>fourGLocationInfo | | | | >ePSLocationInformation)._| | | | | | | | When Dual Connectivity is | | | | activated, the | | | |_ additionalCellIDs _| | | | parameter | | | | (_ location>fourG | | | | LocationInfo>ePSLocationIn | | | | formation>mMELocationInfor | | | | mation>additionalCellIDs*) | | | | shall also be populated, | | | | see clause 7.3.3 and Annex | | | | A. | | +-------------------------+-----------------------------+-------+ | switchOffIndicator | If Bit 4 of the Detach type | C | | | information element sent in | | | | the Detach Request is set | | | | to 0, this parameter shall | | | | be set to "normalDetach". | | | | If Bit 4 of the Detach type | | | | information element sent in | | | | the Detach Request is set | | | | to 1, this parameter shall | | | | be set to "switchOff". See | | | | TS 24.301 [51] clause | | | | 9.9.3.7. This parameter is | | | | conditional only for | | | | backwards compatibility. | | +-------------------------+-----------------------------+-------+
Table 6.3.2-4: detachType values
* * *
Type of detach value Direction detachType value 001 UEnetwork ePSDetach 010
UEnetwork iMSIDetach 011 UEnetwork combinedEPSIMSIDetach 110 UEnetwork
reserved 111 UEnetwork reserved Any Other UEnetwork combinedEPSIMSIDetach 001
networkUE reAttachRequired 010 networkUE reAttachNotRequired 011 networkUE
iMSIDetach 110 networkUE reserved 111 networkUE reserved Any Other networkUE
reAttachNotRequired
* * *
The IRI-POI in the MME shall populate the ePSDetachType field with the values
listed in table 6.3.2-4 based on the Detach Type sent in the Detach Request
message (see TS 24.301 [51] clause 9.9.3.7) and the direction of the Detach
Request associated to the event that triggered the generation of the xIRI.
If the Detach Request message associated to the event that triggered the
generation of the xIRI has the EMM Cause field populated, the IRI-POI in the
MME shall set the value of the cause field of the MMEDetach record to the
integer value of the EMM Cause, see TS 24.301 [51] clause 9.9.3.9.
##### 6.3.2.2.5 Tracking Area/EPS Location update
When the reporting of location information is authorised, the IRI-POI in the
MME shall generate an xIRI containing an MMELocationUpdate record each time
the IRI-POI present in an MME detects that the target UE location is updated
due to target UE mobility or as a part of an MME service procedure. The
generation of such separate xIRI is not required if the updated UE location
information is obtained as a part of a procedure producing some other xIRIs
(e.g. mobility registration). In that case the location information is
included into the respective xIRI.
In addition to the Tracking Area Update described in TS 23.401 [50], clause
5.3.3, the UE mobility events resulting in generation of an MMELocationUpdate
xIRI include the _S1 Path Switch Request_ (_intra E-UTRAN handover_ _X2 based
handover_ procedure described in TS 23.401 [50] clause 5.5.1.1) and the _S1
Handover Notify_ (_Intra E-UTRAN S1 based handover_ procedure described in TS
23.401 [50] clause 5.5.1.2).
The MMELocationUpdate xIRI is also generated when the MME receives an E-UTRAN
S1AP _ERAB Modification Indication_ message as a result of Dual Connectivity
activation/release for the target UE, as described in TS 37.340 [37] clause
10.
Based on regulatory requirements and operator policy, the location information
obtained by the MME from E-UTRAN or the E-SMLC in the course of some service
operations may result in the generation of the MMELocationUpdate xIRI record.
Additionally, the IRI-POI in the MME shall capture the location information in
the scenarios described in TS 23.271 [52] clause 4.4.2. Also, in the case of
Mobile Originated LCS service invoked by the target, the location information
may be derived from the Location Service Response sent to the target UE via
the MME (see TS 23.271 [52] clause 9.2.6).
Optionally, based on regulatory and operator policy, other MME messages that
do not generate separate xIRI but carry location information such as emergency
services or LCS may trigger the generation of an MMELocationUpdate xIRI
record.
Table 6.3.2-5: Payload for MMELocationUpdate record
* * *
Field name Description M/C/O iMSI iMSI associated with the location update. M
iMEI iMEI associated with the location update, if available. C mSISDN mSISDN
associated with the location update, if available as part of the subscription
profile. C gUTI GUTI assigned during the location update, if available, see TS
24.301 [50]. C location Updated location information determined by the
network. Depending on the service or message type from which the location
information is extracted, it may be encoded in several forms (Annex A). M
oldGUTI GUTI used to initiate the location update, if available, see TS 24.301
[50]. C sMSServiceStatus Indicates the availability of SMS Services. Shall be
provided if present in the TRACKING AREA UPDATE ACCEPT. C
* * *
##### 6.3.2.2.6 Start of interception with EPS attached UE
The IRI-POI in the MME shall generate an xIRI containing an
MMEStartOfInterceptionWithEPSAttachedUE record when the IRI-POI present in the
MME detects that interception is activated on a UE that has already attached
to the EPS. A UE is considered already attached to the EPS when the EMM state
for that UE is EMM-REGISTERED. Therefore, the IRI-POI present in the MME shall
generate the xIRI MMEStartOfInterceptionWithEPSAttachedUE record when it
detects that a new interception for a UE is activated (i.e. provisioned by the
LIPF) and the EPS mobility management state within the MME for that UE is EMM-
REGISTERED.
Table 6.3.2-6: Payload for MMEStartOfInterceptionWithEPSAttachedUE record
+------------------+-----------------------------------------+-------+ | Field name | Description | M/C/O | +------------------+-----------------------------------------+-------+ | attachType | Specifies the type of EPS Attach, see | M | | | TS 24.301 [51] clause 9.9.3.11. This | | | | is derived from the information stored | | | | in the UE Context at the MME, see TS | | | | 23.401 [50] clause 5.7.2. | | +------------------+-----------------------------------------+-------+ | attachResult | Specifies the result of the attach | M | | | procedure, see TS 24.301 [51] clause | | | | 9.9.3.10. This is derived from the | | | | information stored in the UE Context at | | | | the MME, see TS 23.401 [50] clause | | | | 5.7.2. | | +------------------+-----------------------------------------+-------+ | iMSI | IMSI associated with the target UE | M | | | Context at the MME, see TS 23.401 | | | | [50] clause 5.7.2. | | +------------------+-----------------------------------------+-------+ | iMEI | IMEI associated with the target UE | C | | | Context at the MME, if available, see | | | | TS 23.401 [50] clause 5.7.2. | | +------------------+-----------------------------------------+-------+ | mSISDN | mSISDN associated with the target UE | C | | | Context at the MME, if available. | | +------------------+-----------------------------------------+-------+ | gUTI | Current GUTI associated with the target | C | | | UE context at the MME, if available, | | | | see TS 23.401 [50] clause 5.7.2. | | +------------------+-----------------------------------------+-------+ | location | Location information stored in the UE | C | | | Context at the MME, if available, see | | | | TS 23.401 [50] clause 5.7.2. | | | | | | | | Shall include all location information | | | | for the target UE available at the MME | | | | encoded as one of the following: | | | | | | | | - _ePSUserLocationInformation_ | | | | parameter | | | | (_location >fourGLoca | | | | tionInfo>ePSUserLocationInformation_). | | | | | | | | - _ePSLocationInformation parameter | | | | (location >fourG | | | | LocationInfo>ePSLocationInformation)._ | | | | | | | | When Dual Connectivity is activated, | | | | the _additionalCellIDs_ parameter | | | | (_location >fourGLoc | | | | ationInfo>ePSLocationInformation>mMEL | | | | ocationInformation>additionalCellIDs_) | | | | shall also be populated, see clause | | | | 7.3.3 and Annex A. | | +------------------+-----------------------------------------+-------+ | ePSTAIList | List of tracking areas associated with | C | | | the registration area within which the | | | | UE is currently registered, see TS | | | | 24.301 [51], clause 9.9.3.33 and TS | | | | 23.401 [50] clause 5.7.2. | | +------------------+-----------------------------------------+-------+ | sMSServiceStatus | Indicates the availability of SMS | C | | | Services. Shall be provided if present | | | | in the UE Context at the MME, see TS | | | | 23.401 [50] clause 5.7.2. | | +------------------+-----------------------------------------+-------+ | eMM5GRegStatus | UE Status, if present in the UE Context | C | | | at the MME, see TS 24.501 [13] clause | | | | 9.11.3.56. | | +------------------+-----------------------------------------+-------+
The IRI-POI present in the MME generating an xIRI containing an
MMEStartOfInterceptionWithEPSAttachedUE record shall set the Payload Direction
field in the PDU header to _not applicable_ (see ETSI TS 103 221-2 [8] clause
5.2.6).
##### 6.3.2.2.7 MME unsuccessful procedure
The IRI-POI in the MME shall generate an xIRI containing an
MMEUnsuccessfulProcedure record when the IRI-POI present in the MME detects an
unsuccessful procedure for a UE matching one of the target identifiers
provided via LI_X1.
Accordingly, the IRI-POI in the MME generates the xIRI when any of the
following events is detected:
\- MME sends a reject to any EMM request message to the target UE and the UE
EPS Mobility Management (EMM) within the MME is changed to EMM-DEREGISTERED.
\- MME aborts a registration procedure before the UE EPS Mobility Management
(EMM) state within the MME is changed to EMM-REGISTERED.
\- MME sends a reject to any ESM request message to the target UE.
Unsuccessful attach attempts shall be reported only if the target UE has been
successfully authenticated.
Table 6.3.2-7: Payload for MMEUnsuccessfulProcedure record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +=============================+=============================+=======+ | failedprocedureType | Specifies the procedure | M | | | which failed at the MME. | | +-----------------------------+-----------------------------+-------+ | failureCause | Provides the value of the | M | | | ESM or EMM cause, see TS | | | | 24.301 [51] clauses | | | | 9.9.3.9 and 9.9.4.4. | | +-----------------------------+-----------------------------+-------+ | iMSI | IMSI associated with the | C | | | procedure, if available | | | | (see NOTE). | | +-----------------------------+-----------------------------+-------+ | iMEI | IMEI associated with the | C | | | procedure, if available. | | +-----------------------------+-----------------------------+-------+ | mSISDN | mSISDN associated with the | C | | | procedure, if available. | | +-----------------------------+-----------------------------+-------+ | gUTI | GUTI provided used in the | C | | | procedure, if available. | | +-----------------------------+-----------------------------+-------+ | location | Location information | C | | | determined by the network | | | | during the procedure or | | | | known at the MME, if | | | | available. | | | | | | | | Shall include all location | | | | information for the target | | | | UE available at the MME | | | | encoded as one of the | | | | following: | | | | | | | | - | | | | * | | | | ePSUserLocationInformation _| | | | parameter | | | | (_ lo | | | | cation>fourGLocationInfo> | | | | eP | | | | SUserLocationInformation _). | | | | | | | | -_ ePSLocationInformation | | | | parameter | | | | ( | | | | location>fourGLocationInfo | | | | >ePSLocationInformation)._| | | | | | | | When Dual Connectivity is | | | | activated, the | | | |_ additionalCellIDs _| | | | parameter | | | | (_ location>fourG | | | | LocationInfo>ePSLocationIn | | | | formation>mMELocationInfor | | | | mation>additionalCellIDs*) | | | | shall also be populated, | | | | see clause 7.3.3 and Annex | | | | A. | | +-----------------------------+-----------------------------+-------+ | NOTE: At least one identity | | | | shall be provided, the | | | | others shall be provided if | | | | available. | | | +-----------------------------+-----------------------------+-------+
##### 6.3.2.2.8 Positioning info transfer
The IRI-POI present in the MME shall generate an xIRI containing an
MMEPositioningInfoTransfer when the IRI-POI present in the MME detects one of
the following events:
> \- a LPPa (see TS 36.455 [84]) message related to a target UE has been
> exchanged between the E-SMLC and the eNB via the MME.
>
> \- a LPP (see TS 37.355 [85]) message related to a target UE has been
> exchanged between the E-SMLC and the target UE via the MME.
Accordingly, the IRI-POI in MME generates the xIRI when any of the following
events is detected:
> \- MME receives an SLs CONNECTION ORIENTED INFORMATION message (see TS
> 29.171 [54]) from E-SMLC to request the transfer of a LPPa request to the
> serving eNB for a target UE as part of a UE associated LPPa positioning
> activity. The LPPa request may be E-CID MEASUREMENT INITIATION REQUEST or
> OTDOA INFORMATION REQUEST.
>
> \- MME sends an SLs CONNECTION ORIENTED INFORMATION message to the E-SMLC to
> forward the LPPa response or report received from the eNB for a target UE.
> The LPPa response or report may be E-CID MEASUREMENT INITIATION RESPONSE,
> E-CID MEASUREMENT REPORT or OTDOA INFORMATION RESPONSE.
>
> \- MME receives an SLs CONNECTION ORIENTED INFORMATION message from E-SMLC
> to request the transfer of a LPP request to the target UE.
>
> \- MME sends an SLs CONNECTION ORIENTED INFORMATION message to E-SMLC to
> forward a LPP message received from the target UE.
Table 6.3.2-7A: Payload for MMEPositioningInfoTransfer record
* * *
Field name Description M/C/O iMSI IMSI associated with the location update. M
iMEI IMEI associated with the location update, if available. C mSISDN MSISDN
associated with the location update, if available as part of the subscription
profile. C gUTI GUTI assigned during the location update, if available, see TS
24.301 [50]. C lPPaMessage Any UE associated LPPa message exchanged between
the LMF and eNB via MME. C lPPMessage Any LPP message exchanged between the
E-SMLC and the target UE via MME. C mMELCSCorrelationId MMELCSCorrelationId is
made of Correlation Id, described in clause 7.4.28 of TS 29.171 [54], related
to a location session, found in the SLs CONNECTION ORIENTED INFORMATION sent
by E-SMLC to MME and corresponding SLs CONNECTION ORIENTED INFORMATION sent by
MME to E-SMLC. All the MMEPositioningInfoTransfer records related to the same
location session have the same CorrelationId. M
* * *
#### 6.3.2.3 Generation of IRI over LI_HI2
##### 6.3.2.3.1 General
When Option A or Option B specified in clause 6.3.1 are used and an xIRI is
received over LI_X2 from the IRI-POI in the MME, the MDF2 shall generate the
corresponding IRI message and deliver it over LI_HI2 without undue delay. The
IRI message shall contain a copy of the relevant record received in the xIRI
over LI_X2.
When Option C specified in clause 6.3.1 is used the MDF2 shall generate IRI
messages based on the proprietary information received from the MME and
provide it over LI_HI2 without undue delay.
The IRI record may be enriched with any additional information available at
the MDF (e.g. additional location information).
The IRI messages shall be delivered over LI_HI2 according to ETSI TS 102 232-7
[10] clause 10.When Option A specified in clause 6.3.1 is used, LI_HI2 shall
be realised as described in clause 6.3.2.3.2.
When Option B or Option C specified in clause 6.3.1 is used, LI_HI2 shall be
realised as described in clause 6.3.2.3.3.
##### 6.3.2.3.2 Option A
The IRI message the MDF2 generates shall contain a copy of the relevant record
received in the xIRI over LI_X2 and provide it over LI_HI2 without undue
delay.
The timestamp field of the PSHeader structure shall be set to the time at
which the MME event was observed (i.e. the timestamp field of the X2 PDU).
The IRI type parameter (see ETSI TS 102 232-1 [9] clause 5.2.10) shall be
included and coded according to table 6.3.2-8.
Table 6.3.2-8: IRI type for IRI messages
IRI message IRI type
* * *
MMEAttach REPORT MMEDetach REPORT MMELocationUpdate REPORT
MMEStartOfInterceptionWithEPSAttachedUE REPORT MMEUnsuccessfulProcedure REPORT
MMEIdentifierAssociation REPORT MMEPositioningInfoTransfer REPORT
These IRI messages shall omit the CIN (see ETSI TS 102 232-1 [9] clause
5.2.4).
The threeGPP33128DefinedIRI field in ETSI TS 102 232-7 [10] clause 15 shall be
populated with the BER-encoded IRIPayload.
When an additional warrant is activated on a target UE and the LIPF uses the
same XID for the additional warrant, the MDF2 shall be able to generate and
deliver the IRI message containing the MMEStartOfInterceptionWithEPSAttachedUE
record to the LEMF associated with the additional warrant without receiving a
corresponding xIRI. The payload of the MMEStartOfInterceptionWithEPSAttachedUE
record is specified in table 6.3.2-6.
For records related to SMS over NAS in EPS, the process detailed in clause
6.3.2.3.3 shall be used.
##### 6.3.2.3.3 Option B and Option C
For all messages except MMEIdentifierAssociation, the IRI messages shall
include an IRI payload encoded according to TS 33.108 [12] Annex B.9.
The MDF2 shall encode the correct value of LIID in the IRI message, replacing
the value \"LIIDNotPresent\" given in the xIRI (see clause 6.3.2.2).
For MMEIdentifierAssociation messages, the IRI message shall be encoded as an
IRIEvent structure according to Annex B and used to populate the
threeGPP33128DefinedIRI field in ETSI TS 102 232-7 [10] clause 15.
### 6.3.3 LI at SGW/PGW and ePDG
#### 6.3.3.0 General
Unless otherwise specified, the following clauses apply to both CUPS and non-
CUPS EPS architectures. When CUPS architecture is used, unless otherwise
specified, the term SGW/PGW refers to both the SGW-U/PGW-U and the
SGW-C/PGW-C.
Unless otherwise specified, the following clauses apply in the case of EPC-5GC
interworking via combined SMF+PGW-C and UPF+PGW-U.
#### 6.3.3.1 Provisioning over LI_X1
##### 6.3.3.1.1 General
If the warrant is for IRI and CC, then the LI functions in the SGW/PGW shall
be provisioned in accordance with clause 6.3.3.1.2 for non-CUPS architecture
and clause 6.3.3.1.3 for CUPS architecture, the MDF2 shall be provisioned in
accordance with clause 6.3.3.1.4, and the MDF3 shall be provisioned in
accordance with clause 6.3.3.1.5.
If the warrant is for IRI only, the IRI-POI in the SGW/PGW shall be
provisioned in accordance with clause 6.3.3.1.2 for non-CUPS architecture and
clause 6.3.3.1.3 for CUPS architecture and the MDF2 shall be provisioned in
accordance with clause 6.3.3.1.4.If approach 1 described in clause 6.2.3.9 is
used for packet header information reporting:
\- For non-CUPS architecture, the IRI-POI in the SGW/PGW shall be provisioned
in accordance with clause 6.3.3.1.2 and the MDF2 shall be provisioned in
accordance with clause 6.3.3.1.4.
\- For CUPS architecture, the IRI-TF in the SGW-C/PGW-c shall be provisioned
in accordance with clause 6.3.3.1.3 and the MDF2 shall be provisioned in
accordance with clause 6.3.3.1.4.
If approach 2 described in clause 6.2.3.9 is used for packet header
information reporting:
\- For non-CUPS architecture, the CC-POI in the SGW/PGW shall be provisioned
in accordance with clause 6.3.3.1.2, the MDF2 shall be provisioned in
accordance with clause 6.3.3.1.4, and the MDF3 shall be provisioned in
accordance with clause 6.3.3.1.5.
\- For CUPS architecture, the CC-TF in the SGW-C/PGW-C shall be provisioned in
accordance with clause 6.3.3.1.3, the MDF2 shall be provisioned in accordance
with clause 6.3.3.1.4, and the MDF3 shall be provisioned in accordance with
clause 6.3.3.1.5.
The LI functions in the SGW/PGW and ePDG, the MDF2 and the MDF3 shall support
the following target identifier formats in the ETSI TS 103 221-1 [7] messages
(or equivalent if ETSI TS 103 221-1 [7] is not used):
\- IMSI.
\- MSISDN (using the E164Number target identifier format from ETSI TS 103
221-1 [7]).
\- IMEI.
In the case of EPC-5GC interworking via combined SMF+PGW-C and UPF+PGW-U, the
LI functions in the SMF+PGW-C, MDF2 and MDF3 shall support the following
target identifier formats in the ETSI TS 103 221-1 [7] messages (or
equivatlent if ETSI TS 103 221-1 [7] is not used):
\- SUPINAI.
\- SUPIIMSI.
\- IMSI.
\- GPSINAI.
\- GPSIMSISDN.
\- MSISDN (using the E164Number target identifier format from ETSI TS 103
221-1 [7]).
\- PEIIMEISV.
\- PEIIMEI.
\- IMEI.
When the target identifier is an IMSI, the LI functions in the SMF+PGW-C shall
also trigger when events associated to a SUPI in the form of an IMSI with a
value matching the provisioned IMSI target identifier value are detected.
Likewise, when the target identifier is a SUPIIMSI, the LI functions in the
SMF+PGW-C shall also trigger when events associated to an IMSI with a value
matching the provisioned SUPIIMSI target identifier value are detected.
When the target identifier is an MSISDN, the LI functions in the SMF+PGW-C
shall also trigger when events associated to a GPSI in the form of an MSISDN
with a value matching the provisioned MSISDN target identifier value are
detected. Likewise, then the target identifier is a GPSIMSISDN, the LI
functions in the SMF+PGW-C shall also trigger when events associated to an
MSISDN with a value matching the provisioned GPSIMSISDN target identifier
value are detected.
When the target identifier is an IMEI, the LI functions in the SMF+PGW-C shall
also trigger when events associated to a PEI in the form of an IMEI with a
value matching the provisioned IMEI target identifier value are detected.
Likewise, then the target identifier is a PEIIMEI, the LI functions in the
SMF+PGW-C shall also trigger when events associated to an IMEI with a value
matching the provisioned PEIIMEI target identifier value are detected.
NOTE: When both a 4G identifier and its equivalent 5G identifier are
provisioned by means of separate tasks in the LI functions present in the
SMF+PGW-C, interception will be triggered independently for each of the two
identifiers.
##### 6.3.3.1.2 Non-CUPS Architecture
When the EPS is implemented using non-CUPS architecture, the IRI-POI and CC-
POI present in the SGW/PGW and ePDG are provisioned over LI_X1 by the LIPF
using the X1 protocol as described in clause 5.2.2. A single task may be used.
Table 6.3.3.1-1 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the IRI-POI and the CC-POI in the SGW/PGW.
Table 6.3.3.1-1: ActivateTask message for the IRI-POI and CC-POI in the
SGW/PGW and ePDG in non-CUPS architecture
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. | M | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One of the target | M | | | identifiers listed in the | | | | clause above. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X2Only", "X3Only" | M | | | or "X2andX3" as needed to | | | | meet the requirements of | | | | the warrant. | | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints of | M | | | LI_X2 or LI_X3. These | | | | delivery endpoints shall be | | | | configured using the | | | | _CreateDestination_ message | | | | as described in ETSI TS 103 | | | | 221-1 [7] clause 6.3.1 | | | | prior to first use. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | Header reporting-specific | C | | | tag to be carried in the | | | HeaderReporting | _TaskDetailsExtensions_ | | | | field of ETSI TS 103 221-1 | | | | [7]. See table | | | | 6.2.3.9.2-1. Unless there | | | | is a CSP/LEA agreement to | | | | not report packet header | | | | information, this field | | | | shall be present to enable | | | | packet header information | | | | reporting. | | +-----------------------------+-----------------------------+-------+
To enable packet header information reporting, parameters specified in table
6.2.3.9.2-1: PDHRReportingExtensions parameters shall be provided as the
TaskDetailsExtensions/HeaderReporting field of the LI_X1 provisioning message.
##### 6.3.3.1.3 CUPS Architecture
When the EPS is implemented using CUPS architecture, the IRI-POI, IRI-TF and
CC-TF present in the SGW-C/PGW-C and the IRI-POI and CC-POI present in the
ePDG are provisioned over LI_X1 by the LIPF using the X1 protocol as described
in clause 5.2.2.
Table 6.3.3.1-2 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the IRI-POI, CC-TF and IRI-TF in the SGW-C/PGW-C. If the
ePDG is used, the minimum details of the LI_X1 ActivateTask message used for
provisioning the IRI-POI and the CC-POI in the ePDG are detailed in Table
6.3.3.1-1.
Table 6.3.3.1-2: ActivateTask message for the IRI-POI, CC-TF and IRI-TF in the
SGW-C/PGW-C in CUPS architecture
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. If | M | | | the CC-TF or IRI-TF is also | | | | being tasked for the same | | | | interception, the same XID | | | | shall be used. | | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One or more of the target | M | | | identifiers listed in | | | | clause 6.3.3.1.1. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X2Only", "X3Only" | M | | | or "X2andX3" as needed to | | | | meet the requirements of | | | | the warrant. | | | | | | | | NOTE: \"X2Only\" for | | | | IRI-POI, IRI-TF and | | | | \"X3Only\" for CC-TF can | | | | also be also be used. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | Header reporting-specific | C | | | tag to be carried in the | | | HeaderReporting | _TaskDetailsExtensions_ | | | | field of ETSI TS 103 221-1 | | | | [7]. See table | | | | 6.2.3.9.2-1. Unless there | | | | is a CSP/LEA agreement to | | | | not report packet header | | | | information, this field | | | | shall be present to enable | | | | packet header information | | | | reporting. | | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints of | M | | | LI_X2 or LI_X3. These | | | | delivery endpoints shall be | | | | configured using the | | | | _CreateDestination_ message | | | | as described in ETSI TS 103 | | | | 221-1 [7] clause 6.3.1 | | | | prior to first use. | | +-----------------------------+-----------------------------+-------+
To enable packet header information reporting, parameters specified in table
6.2.3.9.2-1: PDHRReportingExtensions parameters shall be provided as the
TaskDetailsExtensions/HeaderReporting field of the LI_X1 provisioning message.
##### 6.3.3.1.4 Provisioning of the MDF2
The MDF2 listed as the delivery endpoint for xIRI generated by the IRI-POI in
the CP entity of the SGW/PGW or ePDG shall be provisioned over LI_X1 by the
LIPF using the X1 protocol as described in clause 5.2.2. Table 6.3.3.1-3 shows
the minimum details of the LI_X1 ActivateTask message used for provisioning
the MDF2.
Table 6.3.3.1-3: ActivateTask message for MDF2
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. | M | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One or more of the target | M | | | identifiers listed in the | | | | paragraph above. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X2Only", "X3Only" | M | | | or "X2andX3" as needed to | | | | meet the requirements of | | | | the warrant. (Ignored by | | | | the MDF2). | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | Header reporting-specific | C | | | tag to be carried in the | | | HeaderReporting | _TaskDetailsExtensions_ | | | | field of ETSI TS 103 221-1 | | | | [7]. See table | | | | 6.2.3.9.2-1. Unless there | | | | is a CSP/LEA agreement to | | | | not report packet header | | | | information, this field | | | | shall be present to enable | | | | packet header information | | | | reporting. | | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints of | M | | | LI_HI2. These delivery | | | | endpoints shall be | | | | configured using the | | | | _CreateDestination_ message | | | | as described in ETSI TS 103 | | | | 221-1 [7] clause 6.3.1 | | | | prior to first use. | | +-----------------------------+-----------------------------+-------+ | ListOfMediationDetails | Sequence of Mediation | M | | | Details, See Table | | | | 6.3.3.1-4. | | +-----------------------------+-----------------------------+-------+
Table 6.3.3.1-4: Mediation Details for MDF2
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | LIID | Lawful Intercept ID | M | | | associated with the task. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to \"HI2Only\". | M | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Details of where to send | C | | | the IRI for this LIID. | | | | Shall be included if | | | | deviation from the | | | | ListofDIDs in the | | | | ActivateTask message is | | | | necessary. If included, the | | | | ListOfDIDs in the Mediation | | | | Details shall be used | | | | instead of any delivery | | | | destinations authorised by | | | | the ListOfDIDs field in the | | | | ActivateTask Message. | | +-----------------------------+-----------------------------+-------+ | ServiceScoping | Shall be included to | C | | | Identify the service(s) and | | | | associated service-related | | | | delivery settings for this | | | | LIID. May include more than | | | | one instance of this | | | | parameter to allow for | | | | different combinations of | | | | subparameters associated | | | | with a single LIID. This | | | | parameter is defined in | | | | ETSI TS 103 221-1 [7], | | | | Annex C, table C.2. | | +-----------------------------+-----------------------------+-------+ | MediationDetailsExtensions/ | Header reporting-specific | C | | | tag to be carried in the | | | HeaderReporting | MediationDetailsExtensions | | | | field of ETSI TS 103 221-1 | | | | [7]. See table | | | | 6.2.3.9.2-1. This field | | | | shall be included if | | | | deviation from the | | | | taskDetails HeaderReporting | | | | TaskDetailsExtensions is | | | | required. If included, the | | | | details shall be used | | | | instead of the | | | | HeaderReporting | | | | instructions specified in | | | | the HeaderReporting field | | | | in the TaskDetails | | | | structure. | | +-----------------------------+-----------------------------+-------+
##### 6.3.3.1.5 Provisioning of the MDF3
The MDF3 listed as the delivery endpoint for the xCC generated by the CC-POI
in the UP entity of the SGW/PGW or ePDG shall be provisioned over LI_X1 by the
LIPF using the X1 protocol as described in clause 5.2.2. Table 6.3.3.1-5 shows
the minimum details of the LI_X1 ActivateTask message used for provisioning
the MDF3. If packet header reporting is authorised and approach 2 described in
clause 6.2.3.9 is used, the endpoint for the MDF3 shall be the MDF2 over
LI_MDF.
Table 6.3.3.1-5: ActivateTask message for MDF3
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. | M | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One or more of the target | M | | | identifiers listed in the | | | | paragraph above. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X2Only", "X3Only" | M | | | or "X2andX3" as needed to | | | | meet the requirements of | | | | the warrant. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | Header reporting-specific | C | | | tag to be carried in the | | | HeaderReporting | _TaskDetailsExtensions_ | | | | field of ETSI TS 103 221-1 | | | | [7]. See table | | | | 6.2.3.9.2-1. Unless there | | | | is a CSP/LEA agreement to | | | | not report packet header | | | | information, this field | | | | shall be present to enable | | | | packet header information | | | | reporting. | | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints of | M | | | LI_HI3 or LI_MDF. These | | | | delivery endpoints shall be | | | | configured using the | | | | _CreateDestination_ message | | | | as described in ETSI TS 103 | | | | 221-1 [7] clause 6.3.1 | | | | prior to first use. | | +-----------------------------+-----------------------------+-------+ | ListOfMediationDetails | Sequence of Mediation | M | | | Details, See table | | | | 6.3.3.1-6. | | +-----------------------------+-----------------------------+-------+
Table 6.3.3.1-6: Mediation Details for MDF3
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | LIID | Lawful Intercept ID | M | | | associated with the task. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to \"HI3Only\". | M | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Details of where to send | C | | | the CC for this LIID. Shall | | | | be included if deviation | | | | from the ListofDIDs in the | | | | ActivateTask message is | | | | necessary. If included, the | | | | ListOfDIDs in the Mediation | | | | Details shall be used | | | | instead of any delivery | | | | destinations authorised by | | | | the ListOfDIDs field in the | | | | ActivateTask Message. | | +-----------------------------+-----------------------------+-------+ | ServiceScoping | Shall be included to | C | | | Identify the service(s) and | | | | associated service-related | | | | delivery settings for this | | | | LIID. May include more than | | | | one instance of this | | | | parameter to allow for | | | | different combinations of | | | | subparameters associated | | | | with a single LIID. This | | | | parameter is defined in | | | | ETSI TS 103 221-1 [7], | | | | Annex C, table C.2. | | +-----------------------------+-----------------------------+-------+ | MediationDetailsExtensions/ | Header reporting-specific | C | | | tag to be carried in the | | | HeaderReporting | MediationDetailsExtensions | | | | field of ETSI TS 103 221-1 | | | | [7]. See table | | | | 6.2.3.9.2-1. This field | | | | shall be included if | | | | deviation from the | | | | taskDetails HeaderReporting | | | | TaskDetailsExtensions is | | | | required. If included, the | | | | details shall be used | | | | instead of the | | | | HeaderReporting | | | | instructions specified in | | | | the HeaderReporting field | | | | in the TaskDetails | | | | structure. | | +-----------------------------+-----------------------------+-------+
#### 6.3.3.2 Generation of xIRI over LI_X2
##### 6.3.3.2.1 General
When Option A specified in clause 6.3.1 is used:
\- For architectures with EPC/5GC interworking:
\- For home routed roaming interception in the visited network, in this
version of the specification, the IRI-POI present in the SGW shall be
implemented in accordance with Option B or Option C specified in clause 6.3.1.
\- For all other cases, the IRI-POI present in the SMF+PGW-C shall send the
xIRIs over LI_X2 for each of the events listed in TS 33.127 [5] clause
6.3.3.3.1.2, as described in clause 6.3.1.
\- As described in TS 23.501 [2] clause 5.32.7.1, a PDN Connection in EPS can
be one leg of an MA PDU session. The details of the messages for single-access
PDU sessions are provided in clauses 6.3.3.2.2, 6.3.3.2.3, 6.3.3.2.4 and
6.3.3.2.5. The details for the messages for MA PDU sessions are provided in
clauses 6.3.3.2.6, 6.3.3.2.7, 6.3.3.2.8 and 6.3.3.2.9.
NOTE: The details of the events triggers used to generate the xIRIs are
specified at high-level in support of possible hitherto implementation
variations for EPS LI.
When Option B specified in clause 6.3.1 is used:
\- The IRI-POI present in the SGW/PGW and ePDG shall send the xIRIs over LI_X2
for each of the events listed in TS 33.107 [36] clause 12.2.1.2, the details
of which are specified in clause 12.2.3 of the same TS.
\- The IRI-POI present in the SGW/PGW and ePDG shall set the payload format to
EpsHI2Operations.EpsIRIContent (value 14), see clause 5.3 and ETSI TS 103
221-2 [8] clause 5.4. The payload field shall contain an
EpsHI2Operations.EpsIRIContent structure encoded according to TS 33.108 [12]
clauses 10.5 and B.9.
\- As the LIID may not be available at the SGW/PGW and ePDG but is mandatory
in EpsHI2Operations.EpsIRIContent according to TS 33.108 [12] Annex B.9, its
value in the lawfulInterceptionIdentifier field of the encoded PDU shall be
set to the fixed string \"LIIDNotPresent\".
##### 6.3.3.2.2 PDU Session Establishment message reporting PDU session
establishment or PDN Connection establishment
The IRI-POI in the SMF+PGW-C shall generate an xIRI containing an
SMFPDUSessionEstablishment record (see clause 6.2.3.2.2) when the IRI-POI
present in the SMF+PGW-C detects that a single-access PDU Session or PDN
Connection has been established for the target UE. The IRI-POI present in the
SMF+PGW-C shall generate the xIRI for the following events:
\- The SMF+PGW-C creates a new PDN Connection in the target UE context of the
SMF+PGW-C (see TS 23.401 [50] clause 5.7.4).
\- The SMF+PGW-C creates a new PDU Session context or SM Context for the
target UE (see TS 29.502 [16] clause 5.2.2.2 and clause 5.2.2.7).
When the SMFPDUSessionEstablishment record (see clause 6.2.3.2.2) is used to
report the creation of a new PDN Connection:
\- The ePSPDNConnectionEstablishment field shall be populated with the
information in Table 6.3.3-1.
\- If there is no SUPI associated to the SM context for the target UE, the
SUPI field of the SMFPDUSessionEstablishment record shall be populated with
the value of the IMSI from the target UE context.
\- If there is no PDU Session ID present in the PCO of the request or response
messages or associated to the context for the PDN connection, the pDUSessionID
field of the SMFPDUSessionEstablishment record shall be populated with the EBI
of the default bearer for the PDN Connection.
\- If there is no 5G UP tunnel present in the context associated to the PDN
Connection, the gTPTunnelID field of the SMFPDUSessionEstablishment record
shall be populated with the F-TEID for the PGW S5 or S8 interface for the
default bearer of the PDN Connection.
Table 6.3.3-1: Payload for ePSPDNConnectionEstablishment Field
* * *
Field name Description M/C/O ePSSubscriberIDs EPS Subscriber Identities
associated with the PDN connection (e.g. as provided by the MME or SGW in the
associated Create Session Request or as associated with the PDN connection in
the context known at the NF). The IMSI shall be present except for
unauthenticated emergency sessions. M iMSIUnauthenticated Shall be present if
an IMSI is present in the ePSSubscriberIDs and set to "true" if the IMSI has
not been authenticated, or "false" if it has been authenticated. C
defaultBearerID Shall contain the EPS Bearer Identity of the default bearer
associated with the PDN connection. M gTPTunnelInfo Contains the information
for the Control Plane GTP Tunnels present in the Create Session Request or
known in the context at the SGW or PGW. See Table 6.2.3-1B. C
pDNConnectionType Identifies selected PDN session type, see TS 29.274 [87]
clause 8.34. M uEEndpoints UE endpoint address(es) if available. Derived from
the PDN Address portion of the PDN Address Allocation parameter (see TS 29.274
[87] clause 8.14) present in the Create Session Request or the IP Address
associated to the PDN Connection in the context known at the NF (see TS 23.401
[50] clauses 5.7.3 and 5.7.4). C non3GPPAccessEndpoint UE\'s local IP address
used to reach the ePDG, if present in the Create Session Request (see TS
29.274 [87], clause 7.2.1) or known at the context at the SGW or PGW. C
location Location information present in the Create Session Request (see TS
29.274 [87], clause 7.2.1) or known in the context at the SGW or PGW. C
additionalLocation Additional location information present in the Create
Session Request, known in the context at the SGW or PGW, or known at the MDF.
C aPN Access Point Name associated with the PDN connection present in the
Create Session Request (see TS 29.274 [87] clauses 7.2.1 and 8.6) or known at
the context at the SGW or PGW (see TS 23.401 [50] clause 5.6.4), as defined in
TS 23.003[19] clause 9.1. M requestType Type of request as derived from the
Request Type described in TS 24.301 [50] clause 9.9.4.14 and TS 24.008 [93]
clause 10.5.6.17, if available. C accessType Access type associated with the
PDN connection (i.e. 3GPP or non-3GPP access). Shall be set to
nonThreeGPPAccess by the ePDG or by the PGW when the Create Session Request
for the PDN connection is received from an ePDG. Shall be set to
threeGPPAccess by the SGW or by the PGW when the Create Session Request for
the PDN connection is received from an SGW. C rATType RAT Type associated with
the PDN connection. Shall be present if included in the Create Session Request
(see TS 29.274 [87] clause 7.2.1) or known at the context at the SGW or PGW
(see TS 23.401 [50] clause 5.6.4). C protocolConfigurationOptions Shall be
present if the Create Session Request or the Create Session Response (see TS
29.274 [87] clause 7.2.2 and clause 7.2.3) contains the Protocol
Configuration, Additional Protocol Configuration Options or extended Protocol
Configuration Options IE. See Table 6.3.3-4. C servingNetwork Shall be present
if this IE is in the Create Session Request or the context for the PDN
connection at the SGW/PGW. C sMPDUDNRequest Contents of the SM PDU DN Request
container, if available, as described in TS 24.501 [13] clause 9.11.4.15. C
bearerContextsCreated Shall include a list of the Bearer Contexts created sent
in the Create Session Response message (see TS 29.274 [87] clause 7.2.2). See
Table 6.3.3-2. M bearerContextsMarkedForRemoval Shall include a list of the
Bearer Contexts to be removed sent in the Create Session Response message (see
TS 29.274 [87] clause 7.2.2). See Table 6.3.3-3. C indicationFlags Shall be
included if the Indication Flags field is present in the Create Session
Request (see TS 29.274 [87] clause 7.2.1). The value of this parameter shall
be set to the value of the Indication IE (see TS 29.274 [87] clause 8.12)
starting with octet 5. C handoverIndication Shall be present if the Handover
Indication is set to 1 in the Create Session Request (see TS 29.274 [87]
clauses 7.2.1 and 8.12). C nBIFOMSupport Shall be present if the NBIFOM
Support Indication is set to 1 in the Create Session Request (see TS 29.274
[87] clauses 7.2.1 and 8.12). C fiveGSInterworkingInfo Shall be present if the
5GS Interworking Indication is present in the Create Session Request (see TS
29.274 [87] clauses 7.2.1 and 8.12). See Table 6.3.3-5. C cSRMFI Shall be
present if the Create Session Request Message Forwarded Indication (CSRMFI) is
present in the Create Session Request (see TS 29.274 [87] clauses 7.2.1 and
8.12). Indicates the Create Session Request message has been forwarded by a
PGW. C restorationOfPDNConnectionsSupport Shall be present if the Restoration
of PDN connection after an PGW-C/SMF Change Support Indication is present in
the Create Session Request (see TS 29.274 [87] clauses 7.2.1 and 8.12). C
pGWChangeIndication Shall be present if the PGW Change Indication is present
in the Create Session Request (see TS 29.274 [87] clauses 7.2.1 and 8.12). C
pGWRNSI Shall be present if the PGW Redirection due to mismatch with Network
Slice subscribed by the UE Support Indication is present in the Create Session
Request (see TS 29.274 [87] clauses 7.2.1 and 8.12). C
* * *
Table 6.3.3-2: Payload for bearerContextsCreated Field
* * *
Field name Description M/C/O ePSBearerID Shall include the EPS bearer ID for
the EPS Bearer (See TS 29.274 [87] clauses 7.2.2 and 7.2.4). M cause Shall
indicate whether the bearer handling was successful and if not, it gives
information on the reason (see TS 29.274 [87] clause 7.2.2 and 7.2.4). Sent as
an integer cause value (see TS 29.274 [87] Table 8.4-1) M gTPTunnelInfo
Contains the information for the User Plane GTP Tunnels for the bearer context
if present in the Request or Response (see TS 29.274 [87] clauses 7.2.2, 7.2.4
and 8.15) or known at the context at the SGW or PGW (see TS 23.401 [50] clause
5.6.4). See Table 6.2.3-1B. C bearerQOS Shall include the QOS information for
the bearer if present in the Request or Response (see TS 29.274 [87] clauses
7.2.2, 7.2.15 and 8.15) or known at the context at the SGW or PGW (see TS
23.401 [50] clause 5.6.4). See Table 6.3.3-7. C protocolConfigurationOptions
Shall be present if the Bearer Context reported (see TS 29.274 [87] clauses
7.2.2, 7.2.3, and 7.2.4) contains the Protocol Configuration, Additional
Protocol Configuration Options or extended Protocol Configuration Options IE.
See Table 7.6.3.3-4. C
* * *
Table 6.3.3-3: Payload for bearerContextsMarkedForRemoval Field
* * *
Field name Description M/C/O ePSBearerID Shall include the EPS bearer ID for
the EPS Bearer (See TS 29.274 [87] clause 7.2.2, 7.2.8 and 7.2.10). M cause
Shall indicate whether the bearer handling was successful and if not, it gives
information on the reason (see TS 29.274 [87] clause 7.2.2, 7.2.8 and 7.2.10).
M
* * *
Table 6.3.3-4: Payload for protocolConfigurationOptions Field
* * *
Field name Description M/C/O requestPCO Shall be present if the Protocol
Configuration Options IE is present in the request message. The value of this
parameter shall contain a copy of the value field of the PCO IE of the request
message (see 29.274 [87] clause 8.13 starting with octet 5). C requestAPCO
Shall be present if the Additional Protocol Configuration Options IE is
present in the request message. The value of this parameter shall contain a
copy of the value field of the PCO IE of the request message (see 29.274 [87]
clause 8.94 starting with octet 5). C requestEPCO Shall be present if the
Extended Protocol Configuration Options IE is present in the request message.
The value of this parameter shall contain a copy of the value field of the PCO
IE of the request message (see 29.274 [87] clause 8.128 starting with octet
5). C responsePCO Shall be present if the Protocol Configuration Options IE is
present in the response message. The value of this parameter shall contain a
copy of the value field of the PCO IE of the response message (see 29.274 [87]
clause 8.13 starting with octet 5). C responseAPCO Shall be present if the
Additional Protocol Configuration Options IE is present in the response
message. The value of this parameter shall contain a copy of the value field
of the PCO IE of the response message (see 29.274 [87] clause 8.94 starting
with octet 5). C responseEPCO Shall be present if the Extended Protocol
Configuration Options IE is present in the response message. The value of this
parameter shall contain a copy of the value field of the PCO IE of the
response message (see 29.274 [87] clause 8.128 starting with octet 5). C
* * *
Table 6.3.3-5: Payload for fiveGSInterworkingInfo Field
* * *
Field name Description M/C/O fiveGSInterworkingIndicator Shall be set toTRUE
if the 5GSIWKI flag in the Indication IE of the request or response is set to
1. Indicates that the UE supports N1 mode and the PDN connection is not
restricted from interworking by the 5GS user subscription. See TS 29.274 [87]
clauses 7.2.1 and 8.12. M fiveGSInterworkingWithoutN26 Shall be set to TRUE if
the 5GS Interworking without N26 Indication flag in the Indication IE of the
request or response is set to 1. If the 5GS Interworking without N26
Indication flag in the Indication IE of the request or response is set to 0 or
not present, this parameter shall be set to FALSE. See TS 29.274 [87] clauses
7.2.1 and 8.12. M fiveGCNotRestrictedSupport Shall be set to True if the
5GCNRS (5GC Not Restricted Support) flag in the Indication IE of the request
or response is set to 1. If the 5GCNRS flag in the Indication IE of the
request or response is set to 0 or not present, this parameter shall be set to
FALSE. See TS 29.274 [87] clauses 7.2.1 and 8.12. M
* * *
Table 6.3.3-6: Payload for ePSGTPTunnels Field
* * *
Field name Description M/C/O controlPlaneSenderFTEID Shall include the Sender
F-TEID for the control plane if present in the Request or response (See TS
29.274 [87] clause 7.2.1, 7.2.2, 7.2.3, 7.2.4, 7.2.7, 7.2.8, 7.2.15, 7.2.16)
or known in the context at the SGW or PGW. C controlPlanePGWS5S8FTEID Shall
include the PGW F-TEID for the control plane if present in the Request or
response (See TS 29.274 [87] clause 7.2.1, 7.2.2, 7.2.3, 7.2.4, 7.2.7, 7.2.8,
7.2.15, 7.2.16) or known in the context at the SGW or PGW. C s1UeNodeBFTEID
Shall include the F-TEID for the eNodeB S1-U interface for the bearer if
present in the Request or response (See TS 29.274 [87] clause 7.2.1, 7.2.2,
7.2.3, 7.2.4, 7.2.7, 7.2.8, 7.2.15, 7.2.16) or known in the context at the SGW
or PGW. C s5S8SGWFTEID Shall include the F-TEID for the SGW S5 or S8 interface
for the bearer if present in the Request or response (See TS 29.274 [87]
clause 7.2.1, 7.2.2, 7.2.3, 7.2.4, 7.2.7, 7.2.8, 7.2.15, 7.2.16) or known in
the context at the SGW or PGW. C s5S8PGWFTEID Shall include the F-TEID for the
PGW S5 or S8 interface for the bearer if present in the Request or response
(See TS 29.274 [87] clause 7.2.1, 7.2.2, 7.2.3, 7.2.4, 7.2.7, 7.2.8, 7.2.15,
7.2.16) or known in the context at the SGW or PGW. C s2bUePDGFTEID Shall
include the F-TEID for the ePDG on the S2b-U interface for the bearer if
present in the Request or response (See TS 29.274 [87] clause 7.2.1, 7.2.2,
7.2.3, 7.2.4, 7.2.7, 7.2.8, 7.2.15, 7.2.16) or known in the context at the PGW
or ePDG. C s2aUePDGFTEID Shall include the F-TEID for the ePDG on the S2a-U
interface for the bearer if present in the Request or response (See TS 29.274
[87] clause 7.2.1, 7.2.2, 7.2.3, 7.2.4, 7.2.7, 7.2.8, 7.2.15, 7.2.16) or known
in the context at the PGW or ePDG. C
* * *
Table 6.3.3-7: Payload for bearerQOS Field
* * *
Field name Description M/C/O qCI Shall include the QCI for the bearer if
present in the Request or response (See TS 29.274 [87] clause 7.2.1, 7.2.2,
7.2.3 and 7.2.15), or known in the context at the SGW or PGW. C
maximumUplinkBitRate Shall include the maximum uplink bitrate encoded as
kilobits per second in binary value (see TS 29.274 [87] clause 8.15) if
present in the Request or response (See TS 29.274 [87] clause 7.2.1, 7.2.2,
7.2.3 and 7.2.15), or known in the context at the SGW or PGW. C
maximumDownlinkBitRate Shall include the maximum downlink bitrate encoded as
kilobits per second in binary value (see TS 29.274 [87] clause 8.15) if
present in the Request or response (See TS 29.274 [87] clause 7.2.1, 7.2.2,
7.2.3 and 7.2.15), or known in the context at the SGW or PGW. C
guaranteedUplinkBitRate Shall include the guaranteed uplink bitrate encoded as
kilobits per second in binary value (see TS 29.274 [87] clause 8.15) if
present in the Request or response (See TS 29.274 [87] clause 7.2.1, 7.2.2,
7.2.3 and 7.2.15), or known in the context at the SGW or PGW. C
guaranteedDownlinkBitRate Shall include the guaranteed downlink bitrate
encoded as kilobits per second in binary value (see TS 29.274 [87] clause
8.15) if present in the Request or response (See TS 29.274 [87] clause 7.2.1,
7.2.2, 7.2.3 and 7.2.15), or known in the context at the SGW or PGW. C
priorityLevel Shall include the priority level assigned to the bearer as an
integer value (see TS 29.274 [87] clause 8.15) if present in the Request or
response (See TS 29.274 [87] clause 7.2.1, 7.2.2, 7.2.3 and 7.2.15), or known
in the context at the SGW or PGW. C
* * *
##### 6.3.3.2.3 PDU Session Modification message reporting PDU session
modification, PDN Connection modification or inter-system handover
The IRI-POI in the SMF+PGW-C shall generate an xIRI containing an
SMFPDUSessionModification record (see clause 6.2.3.2.3) when the IRI-POI
present in the SMF+PGW-C detects that a single-access PDU Session or PDN
Connection has been modified for the target UE. The IRI-POI present in the
SMF+PGW-C shall generate the xIRI for the following events:
\- The SMF+PGW-C modifies an existing PDN Connection in the target UE context
of the SMF+PGW-C (see TS 23.401 [50] clause 5.7.4).
\- The SMF+PGW-C modifies an existing PDU Session context or SM Context for
the target UE (see TS 29.502 [16] clause 5.2.2.3 and clause 5.2.2.8).
\- The SMF+PGW-C transfers an existing PDU Session to EPS (see TS 23.502 [4]
clauses 4.11.1.2.1 and 4.11.2.2).
\- The SMF+PGW-C transfers an existing PDN Connection to 5GS (see TS 23.502
[4] clauses 4.11.1.2.2 and 4.11.2.3).
When the SMFPDUSessionModification record (see clause 6.2.3.2.3) is used to
report the modification of a PDN Connection:
\- The ePSPDNConnectionModification field shall be populated with the
information in Table 6.3.3-8.
\- If there is no SUPI associated to the SM context for the target UE, the
SUPI field of the SMFPDUSessionModification record shall be populated with the
value of the IMSI from the target UE context.
\- If there is no PDU Session ID present in the PCO of the request or response
messages or associated to the context for the PDN connection, the pDUSessionID
field of the SMFPDUSessionModification record shall be populated with the EBI
of the default bearer for the PDN Connection.
\- If there is no 5G UP tunnel present in the context associated to the PDN
Connection, the gTPTunnelID field of the SMFPDUSessionModification record
shall be populated with the F-TEID for the PGW S5 or S8 interface for the
default bearer of the PDN Connection.
Table 6.3.3-8: Payload for ePSPDNConnectionModification Field
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | ePSSubscriberIDs | EPS Subscriber Identities | M | | | associated with the PDN | | | | connection (e.g. as | | | | provided by the MME or SGW | | | | in the associated network | | | | message or as associated | | | | with the PDN connection in | | | | the context known at the | | | | NF). The IMSI shall be | | | | present except for | | | | unauthenticated emergency | | | | sessions. | | +-----------------------------+-----------------------------+-------+ | iMSIUnauthenticated | Shall be present if an IMSI | C | | | is present in the | | | | ePSSubscriberIDs and set to | | | | "true" if the IMSI has not | | | | been authenticated, or | | | | "false" if it has been | | | | authenticated. | | +-----------------------------+-----------------------------+-------+ | defaultBearerID | Shall contain the EPS | M | | | Bearer Identity of the | | | | default bearer associated | | | | with the PDN connection. | | +-----------------------------+-----------------------------+-------+ | gTPTunnelInfo | Contains the information | C | | | for the Control Plane GTP | | | | Tunnels present in the | | | | network message or known in | | | | the context at the SGW or | | | | PGW. See Table 6.2.3-1B. If | | | | the gTPTunnelInfo received | | | | in the network message is | | | | different than the | | | | gTPTunnelInfo in the | | | | context for the PDN | | | | Connection, this message | | | | shall be populated with the | | | | new information. | | +-----------------------------+-----------------------------+-------+ | pDNConnectionType | Identifies selected PDN | M | | | session type, see TS 29.274 | | | | [13] clause 8.34. | | +-----------------------------+-----------------------------+-------+ | uEEndpoints | UE endpoint address(es) if | C | | | available. Derived from the | | | | PDN Address portion of the | | | | PDN Address Allocation | | | | parameter (see TS 29.274 | | | | [87] clause 8.14) present | | | | in the network message or | | | | the IP Address associated | | | | to the PDN Connection in | | | | the context known at the NF | | | | (see TS 23.401 [50] | | | | clauses 5.7.3 and 5.7.4). | | +-----------------------------+-----------------------------+-------+ | non3GPPAccessEndpoint | UE\'s local IP address used | C | | | to reach the ePDG, if | | | | present in the network | | | | message (see TS 29.274 | | | | [87], clauses 7.2.4, | | | | 7.2.7 and 7.2.16) or known | | | | at the context at the SGW | | | | or PGW. | | +-----------------------------+-----------------------------+-------+ | location | Location information | C | | | present in the network | | | | message (see TS 29.274 | | | | [87], clause 8.21) or | | | | known in the context at the | | | | SGW or PGW. | | +-----------------------------+-----------------------------+-------+ | additionalLocation | Additional location | C | | | information present in the | | | | network message, known in | | | | the context at the SGW or | | | | PGW, or known at the MDF. | | +-----------------------------+-----------------------------+-------+ | aPN | Access Point Name | M | | | associated with the PDN | | | | connection present in the | | | | network message (see TS | | | | 29.274 [87] clause 8.6) | | | | or known at the context at | | | | the SGW or PGW (see TS | | | | 23.401 [50] clause | | | | 5.6.4), as defined in TS | | | | 23.003[19] clause 9.1. | | +-----------------------------+-----------------------------+-------+ | requestType | Type of request as derived | C | | | from the Request Type | | | | described in TS 24.301 | | | | [50] clause 9.9.4.14 and | | | | TS 24.008 [93] clause | | | | 10.5.6.17, if available. | | +-----------------------------+-----------------------------+-------+ | accessType | Access type associated with | C | | | the PDN connection (i.e. | | | | 3GPP or non-3GPP access). | | +-----------------------------+-----------------------------+-------+ | rATType | RAT Type associated with | C | | | the PDN connection. Shall | | | | be present if included in | | | | the network message (see TS | | | | 29.274 [87] clauses | | | | 7.2.3, 7.2.4, 7.2.7, 7.2.8, | | | | 7.2.9, 7.2.10, 7.2.15 and | | | | 7.2.16) or known at the | | | | context at the SGW or PGW | | | | (see TS 23.401 [50] | | | | clause 5.6.4). | | +-----------------------------+-----------------------------+-------+ | p | Shall be present if the | C | | rotocolConfigurationOptions | network message (see TS | | | | 29.274 [87]) contains the | | | | Protocol Configuration | | | | Options, Additional | | | | Protocol Configuration | | | | Options or extended | | | | Protocol Configuration | | | | Options IE. See Table | | | | 6.3.3-4. | | +-----------------------------+-----------------------------+-------+ | servingNetwork | Shall be present if this IE | C | | | is in the network message | | | | or the context for the PDN | | | | connection at the SGW/PGW. | | +-----------------------------+-----------------------------+-------+ | sMPDUDNRequest | Contents of the SM PDU DN | C | | | Request container, if | | | | available, as described in | | | | TS 24.501 [13] clause | | | | 9.11.4.15. | | +-----------------------------+-----------------------------+-------+ | bearerContextsCreated | Shall include a list of the | C | | | Bearer Contexts created if | | | | the event that resulted in | | | | the generation of the | | | | message was the activation | | | | of a dedicated Bearer. | | | | Shall contain the contents | | | | of the Bearer Context field | | | | of the Create Bearer | | | | Response message (see TS | | | | 29.274 [87] clause | | | | 7.2.4). See Table 6.3.3-2. | | +-----------------------------+-----------------------------+-------+ | bearerContextsModified | If the event that resulted | M | | | in the generation of the | | | | message was the | | | | modification of an existing | | | | bearer, shall be populated | | | | from the contents of the | | | | Bearer Contexts Modified | | | | field of the Modify Bearer | | | | Response message (see TS | | | | 29.274 [87] clause 7.2.8) | | | | or the Bearer Contexts | | | | within the Update Bearer | | | | Response message (see TS | | | | 29.274 [87] clause | | | | 7.2.16). | | | | | | | | If the event that resulted | | | | in the generation of the | | | | message was the | | | | establishment or release of | | | | a dedicated bearer context, | | | | then this field shall be | | | | populated with the | | | | information for the default | | | | bearer. | | | | | | | | See Table 6.3.3-9. | | +-----------------------------+-----------------------------+-------+ | bea | Shall include a list of the | C | | rerContextsMarkedForRemoval | Bearer Contexts to be | | | | removed if the event that | | | | resulted in the generation | | | | of the message included the | | | | removal of an existing | | | | bearer. (see TS 29.274 | | | | [87] clause 7.2.8 and | | | | 7.2.10). See Table 6.3.3-3. | | +-----------------------------+-----------------------------+-------+ | bearersDeleted | Shall include a list of the | C | | | Bearers to be deleted if | | | | the event that resulted in | | | | the generation of the | | | | message included a Delete | | | | Bearer Request or Response. | | | | (see TS 29.274 [87] | | | | clauses 7.2.9 and 7.2.10). | | | | See Table 6.3.3-10 | | +-----------------------------+-----------------------------+-------+ | indicationFlags | Shall be included if the | C | | | Indication Flags field is | | | | present in the network | | | | message (see TS 29.274 | | | | [87] clauses 7.2.3, | | | | 7.2.4, 7.2.7, 7.2.8, 7.2.9, | | | | 7.2.10, 7.2.15 and 7.2.16). | | | | The value of this parameter | | | | shall be set to the value | | | | of the Indication IE (see | | | | TS 29.274 [87] clause | | | | 8.12) starting with octet | | | | 5. | | +-----------------------------+-----------------------------+-------+ | handoverIndication | Shall be present if the | C | | | Handover Indication is set | | | | to 1 in the Modify Bearer | | | | Request (see TS 29.274 | | | | [87] clauses 7.2.7 and | | | | 8.12). | | +-----------------------------+-----------------------------+-------+ | nBIFOMSupport | Shall be present if the | C | | | NBIFOM Support Indication | | | | is set to 1 in the message | | | | that triggered the | | | | generation of the xIRI or | | | | known at the context (see | | | | TS 29.274 [87] clauses | | | | 7.2.1, 7.2.7 and 8.12). | | +-----------------------------+-----------------------------+-------+ | fiveGSInterworkingInfo | Shall be present if the 5GS | C | | | Interworking Indication is | | | | present in the Create | | | | Session Request (see TS | | | | 29.274 [87] clauses 7.2.1 | | | | and 8.12). See Table | | | | 6.3.3-5. | | +-----------------------------+-----------------------------+-------+ | cSRMFI | Shall be present if the | C | | | Create Session Request | | | | Message Forwarded | | | | Indication (CSRMFI) is | | | | present in the Create | | | | Session Request (see TS | | | | 29.274 [87] clauses 7.2.1 | | | | and 8.12). Indicates the | | | | Create Session Request | | | | message has been forwarded | | | | by a PGW. | | +-----------------------------+-----------------------------+-------+ | restora | Shall be present if the | C | | tionOfPDNConnectionsSupport | Restoration of PDN | | | | connection after an | | | | PGW-C/SMF Change Support | | | | Indication is present in | | | | the message that triggered | | | | the generation of the xIRI | | | | or known at the context | | | | (see TS 29.274 [87] | | | | clauses 7.2.1, 7.2.7 and | | | | 8.12). | | +-----------------------------+-----------------------------+-------+ | pGWChangeIndication | Shall be present if the PGW | C | | | Change Indication is | | | | present in the Create | | | | Session Request (see TS | | | | 29.274 [87] clauses 7.2.1 | | | | and 8.12). | | +-----------------------------+-----------------------------+-------+ | pGWRNSI | Shall be present if the PGW | C | | | Redirection due to mismatch | | | | with Network Slice | | | | subscribed by the UE | | | | Support Indication is | | | | present in the Create | | | | Session Request (see TS | | | | 29.274 [87] clauses 7.2.1 | | | | and 8.12). | | +-----------------------------+-----------------------------+-------+
Table 6.3.3-9: Payload for bearerContextsModified Field
* * *
Field name Description M/C/O ePSBearerID Shall include the EPS bearer ID for
the EPS Bearer (See TS 29.274 [87] clauses 7.2.7, 7.2.8, 7.2.15 and 7.2.16). M
cause Shall indicate whether the bearer handling was successful and if not, it
gives information on the reason (See TS 29.274 [87] clauses 7.2.7, 7.2.8,
7.2.15 and 7.2.16). Sent as an integer cause value (see TS 29.274 [87] Table
8.4-1) M gTPTunnelInfo Contains the information for the User Plane GTP Tunnels
for the bearer context if present in the Request or Response (see TS 29.274
[87] clauses 7.2.7, 7.2.8, 7.2.15, 7.2.16 and 8.15) or known at the context at
the SGW or PGW (see TS 23.401 [50] clause 5.6.4). See Table 6.2.3-1B. C
bearerQOS Shall include the QOS information for the bearer if present in the
Request or Response (see TS 29.274 [87] clauses 7.2.7, 7.2.8, 7.2.15, 7.2.16
and 8.15) or known at the context at the SGW or PGW (see TS 23.401 [50] clause
5.6.4). See Table 6.3.3-7. C protocolConfigurationOptions Shall be present if
the Bearer Context reported (see TS 29.274 [87] clauses 7.2.7, 7.2.8, 7.2.15,
7.2.16 and 8.15) contains the Protocol Configuration, Additional Protocol
Configuration Options or extended Protocol Configuration Options IE. See Table
6.3.3-4. C linkedEPSBearerIDs Shall be present if there are any linked EPS
bearers. If the bearer context being reported is the default bearer, then this
list shall be populated with all dedicated bearers linked to that default
bearer. If the bearer being reported is a dedicated bearer, then this field
shall be populated with the default bearer. C
* * *
Table 6.3.3-10: Payload for bearersDeleted Field
* * *
Field name Description M/C/O linkedEPSBearerID Shall include the EBI for the
default bearer associated with the PDN being disconnected if all bearers
belonging to a PDN connection are being released (See TS 29.274 [87] clause
7.2.9). C ePSBearerIDs Shall include a list of the EPS Bearer IDs to be
deleted if only some of the EPS Bearers belonging to a PDN Connection are
being released(See TS 29.274 [87] clause 7.2.9). C
protocolConfigurationOptions Shall be present if the Delete Bearer Request or
Response reported (see TS 29.274 [87] clauses 7.2.9) contains the Protocol
Configuration, Additional Protocol Configuration Options or extended Protocol
Configuration Options IE. See Table 6.3.3-4. C cause Shall indicate the reason
the EPS Bearers are being deleted (See TS 29.274 [87] clause 7.2.9). Sent as
an integer cause value (see TS 29.274 [87] Table 8.4-1) C deleteBearerResponse
Shall contain information from the Delete Bearer Response (See TS 29.274[87]
clause 7.2.10). See Table 6.3.3-11. M
* * *
Table 6.3.3-11: Payload for deleteBearerResponse Field
* * *
Field name Description M/C/O cause Indicates whether the bearers requested for
deletion were successfully deleted (See TS 29.274 [87] clause 7.2.10). M
linkedEPSBearerID Shall include the EBI for the default bearer associated with
the PDN being disconnected if all bearers belonging to a PDN connection are
being released (See TS 29.274 [87] clause 7.2.10). C bearerContexts Shall
include a list of the EPS Bearer Contexts requested for deletion along with
details on whether they were successfully deleted. Shall be included if only
some of the EPS Bearers belonging to a PDN Connection are being released(See
TS 29.274 [87] clause 7.2.10). See Table 6.3.3-12. C
protocolConfigurationOptions Shall be present if the Delete Bearer Request or
Response reported (see TS 29.274 [87] clauses 7.2.9) contains the Protocol
Configuration, Additional Protocol Configuration Options or extended Protocol
Configuration Options IE. See Table 6.3.3-4. C
* * *
Table 6.3.3-12: Payload for bearerContexts Field in deleteBearerResponse
* * *
Field name Description M/C/O cause Indicates whether the bearers requested for
deletion were successfully deleted (See TS 29.274 [87] clause 7.2.10). M
ePSBearerID Shall include the EBI for the bearer (See TS 29.274 [87] clause
7.2.10). M protocolConfigurationOptions Shall be present if the Delete Bearer
Request or Response reported (see TS 29.274 [87] clauses 7.2.9) contains the
Protocol Configuration, Additional Protocol Configuration Options or extended
Protocol Configuration Options IE. See Table 6.3.3-4. C rANNASCause Shall be
present if the RAN/NAS Release Cause is present in the delete session response
bearer context (see TS 29.274 [87] clause 7.2.10). Shall be sent as an Octet
String encoded as specified in TS 29.274 [87] clause 8.103. C
* * *
##### 6.3.3.2.4 PDU Session Release message reporting PDU session release, PDN
Connection release
The IRI-POI in the SMF+PGW-C shall generate an xIRI containing an
SMFPDUSessionRelease record (see clause 6.2.3.2.4) when the IRI-POI present in
the SMF+PGW-C detects that a single-access PDU Session or PDN Connection has
been released for the target UE. The IRI-POI present in the SMF+PGW-C shall
generate the xIRI for the following events:
\- The SMF+PGW-C releases an existing PDN Connection in the target UE context
of the SMF+PGW-C (see TS 23.401 [50] clause 5.7.4).
\- The SMF+PGW-C releases an existing PDU Session context or SM Context for
the target UE (see TS 29.502 [16] clause 5.2.2.4 and clause 5.2.2.9).
When the SMFPDUSessionRelease record (see clause 6.2.3.2.4) is used to report
the release of a PDN Connection:
\- The ePSPDNConnectionRelease field shall be populated with the information
in Table 6.3.3-13.
\- If there is no SUPI associated to the SM context for the target UE, the
SUPI field of the SMFPDUSessionRelease record shall be populated with the
value of the IMSI from the target UE context.
\- If there is no PDU Session ID present in the PCO of the request or response
messages or associated to the context for the PDN connection, the pDUSessionID
field of the SMFPDUSessionRelease record shall be populated with the EBI of
the default bearer for the PDN Connection.
\- If there is no 5G UP tunnel present in the context associated to the PDN
Connection, the gTPTunnelID field of the SMFPDUSessionRelease record shall be
populated with the F-TEID for the PGW S5 or S8 interface for the default
bearer of the PDN Connection.
Table 6.3.3-13: Payload for ePSPDNConnectionRelease Field
* * *
Field name Description M/C/O ePSSubscriberIDs EPS Subscriber Identities
associated with the PDN connection (e.g. as provided by the MME or SGW in the
associated network message or as associated with the PDN connection in the
context known at the NF). The IMSI shall be present except for unauthenticated
emergency sessions. M iMSIUnauthenticated Shall be present if an IMSI is
present in the ePSSubscriberIDs and set to "true" if the IMSI has not been
authenticated, or "false" if it has been authenticated. C defaultBearerID
Shall contain the EPS Bearer Identity of the default bearer associated with
the PDN connection. M location Location information present in the network
message (see TS 29.274 [87], clause 8.21) or known in the context at the SGW
or PGW. C gTPTunnelInfo Contains the information for the Control Plane GTP
Tunnels present in the network message or known in the context at the SGW or
PGW. See Table 6.2.3-1B. If the gTPTunnelInfo received in the network message
is different than the gTPTunnelInfo in the context for the PDN Connection,
this message shall be populated with the new information. C rANNASCause Shall
be present if the RAN/NAS Release Cause is present in the delete session
request (see TS 29.274 [87] clause 7.2.9). C pDNConnectionType Identifies
selected PDN session type, see TS 29.274 [13] clause 8.34. M indicationFlags
Shall be included if the Indication Flags field is present in the network
message (see TS 29.274 [87] clauses 7.2.3, 7.2.4, 7.2.7, 7.2.8, 7.2.9, 7.2.10,
7.2.15 and 7.2.16). The value of this parameter shall be set to the value of
the Indication IE (see TS 29.274 [87] clause 8.12) starting with octet 5. C
scopeIndication This flag shall be present and set to True, if the request
corresponds to TAU/RAU/Handover with SGW change/SRNS Relocation Cancel Using
S4 with SGW change, Inter RAT handover Cancel procedure with SGW change, S1
Based handover Cancel procedure with SGW change. If this parameter is absent,
it shall be interpreted as False. C bearersDeleted Shall include a list of the
Bearers to be deleted if the event that resulted in the generation of the
message included a Delete Bearer Request or Response. (see TS 29.274 [87]
clauses 7.2.9 and 7.2.10). See Table 6.3.3-10. C
* * *
##### 6.3.3.2.5 SMF Start of Interception with Already Established PDU Session
message reporting Start of Interception with Already Established PDU Session
or Start of Interception with Already Established PDN Connection
The IRI-POI in the SMF+PGW-C shall generate an xIRI containing an
SMFStartOfInterceptionWithEstablishedPDUSession record (see clause 6.2.3.2.5)
when the IRI-POI present in the SMF+PGW-C detects that a PDU Session or PDN
Connection has already been established for the target UE when interception
starts. The IRI-POI present in the SMF+PGW-C shall generate the xIRI for the
following events:
\- The SMF+PGW-C has an existing PDN Connection in the target UE context of
the SMF+PGW-C (see TS 23.401 [50] clause 5.7.4).
\- The SMF+PGW-C has an existing PDU Session context or SM Context for the
target UE (see TS 29.502 [16] clause 5.2.2.2 and clause 5.2.2.7).
When the SMFStartOfInterceptionWithEstablishedPDUSession record (see clause
6.2.3.2.5) is used to report an existing PDN Connection:
\- The ePSStartOfInterceptionWithEstablishedPDNConnection field shall be
populated with the information in Table 6.3.3-14.
\- If there is no SUPI associated to the SM context for the target UE, the
SUPI field of the SMFStartOfInterceptionWithEstablishedPDNConnection record
shall be populated with the value of the IMSI from the target UE context.
\- If there is no PDU Session ID associated to the context for the PDN
connection, the pDUSessionID field of the
SMFStartOfInterceptionWithEstablishedPDNConnection record shall be populated
with the EBI of the default bearer for the PDN Connection.
\- If there is no 5G UP tunnel present in the context associated to the PDN
Connection, the gTPTunnelID field of the
SMFStartOfInterceptionWithEstablishedPDNConnection record shall be populated
with the F-TEID for the PGW S5 or S8 interface for the default bearer of the
PDN Connection.
Table 6.3.3-14: Payload for ePSStartOfInterceptionWithEstablishedPDNConnection
Field
* * *
Field name Description M/C/O ePSSubscriberIDs EPS Subscriber Identities
associated with the PDN connection (as associated with the PDN connection in
the context known at the NF). The IMSI shall be present except for
unauthenticated emergency sessions. M iMSIUnauthenticated Shall be present if
an IMSI is present in the ePSSubscriberIDs and set to "true" if the IMSI has
not been authenticated, or "false" if it has been authenticated. C
defaultBearerID Shall contain the EPS Bearer Identity of the default bearer
associated with the PDN connection. M gTPTunnelInfo Contains the information
for the Control Plane GTP Tunnels known in the context at the SGW or PGW. See
Table 6.2.3-1B. C pDNConnectionType Identifies selected PDN session type, see
TS 29.274 [87] clause 8.34. M uEEndpoints UE endpoint address(es) if
available. Derived from the PDN Address portion of the PDN Address Allocation
parameter (see TS 29.274 [87] clause 8.14) associated to the PDN Connection in
the context known at the NF (see TS 23.401 [50] clauses 5.7.3 and 5.7.4). C
non3GPPAccessEndpoint UE\'s local IP address used to reach the ePDG, if known
at the context at the SGW or PGW. C location Location information known in the
context at the SGW or PGW. C additionalLocation Additional location
information known in the context at the SGW or PGW, or known at the MDF. C aPN
Access Point Name associated with the PDN known at the context at the SGW or
PGW (see TS 23.401 [50] clause 5.6.4), as defined in TS 23.003[19] clause 9.1.
M requestType Type of request as derived from the Request Type described in TS
24.301 [50] clause 9.9.4.14 and TS 24.008 [93] clause 10.5.6.17, if available.
C accessType Access type associated with the PDN connection (i.e. 3GPP or
non-3GPP access). C rATType RAT Type associated with the PDN connection. Shall
be present if known at the context at the SGW or PGW (see TS 23.401 [50]
clause 5.6.4). C protocolConfigurationOptions Shall be present the Protocol
Configuration, Additional Protocol Configuration Options or extended Protocol
Configuration Options are known in the context at the SGW or PGW. See Table
6.3.3-4. C servingNetwork Shall be present if this IE is in the context for
the PDN connection at the SGW/PGW. C bearerContexts Shall include a list of
the Bearer Contexts present in the UE Context (see TS 23.401 [50] clauses
5.7.3 and 5.7.4). See Table 6.3.3-2. M
* * *
##### 6.3.3.2.6 MA PDU Session Establishment message reporting MA PDU session
establishment or PDN Connection establishment as part of an MA PDU Session
The IRI-POI in the SMF+PGW-C shall generate an xIRI containing an
SMFMAPDUSessionEstablishment record (see clause 6.2.3.2.7) when the IRI-POI
present in the SMF+PGW-C detects that a PDN Connection has been established
for the target UE and associated to a multi-access PDU Session. The IRI-POI
present in the SMF+PGW-C shall generate the xIRI for the following events:
\- The SMF+PGW-C creates a new PDN Connection in the target UE context of the
SMF+PGW-C (see TS 23.401 [50] clause 5.7.4) and it is associated to an MA PDU
session as described in TS 23.502 [4] clause 4.22.2.3.
\- The SMF+PGW-C creates a new multi-access PDU Session context or SM Context
for the target UE (see TS 29.502 [16] clause 5.2.2.2 and clause 5.2.2.7).
When the SMFMAPDUSessionEstablishment record (see clause 6.2.3.2.7) is used to
report the creation of a new PDN Connection:
\- The ePSPDNConnectionEstablishment field shall be populated with the
information in Table 6.3.3-1.
\- If there is no SUPI associated to the SM context for the target UE, the
SUPI field of the SMFMAPDUSessionEstablishment record shall be populated with
the value of the IMSI from the target UE context.
\- If there is no PDU Session ID present in the PCO of the request or response
messages or associated to the context for the PDN connection, the pDUSessionID
field of the SMFMAPDUSessionEstablishment record shall be populated with the
EBI of the default bearer for the PDN Connection.
\- If there is no 5G UP tunnel present in the context associated to the PDN
Connection, the gTPTunnelID field of the SMFMAPDUSessionEstablishment record
shall be populated with the F-TEID for the PGW S5 or S8 interface for the
default bearer of the PDN Connection.
##### 6.3.3.2.7 MA PDU Session Modification message reporting MA PDU session
modification, modification of a PDN Connection associated to MA PDU session or
inter-system handover
The IRI-POI in the SMF+PGW-C shall generate an xIRI containing an
SMFMAPDUSessionModification record (see clause 6.2.3.2.7) when the IRI-POI
present in the SMF+PGW-C detects that an MA PDU Session or PDN Connection
associated to an MA PDU Session has been modified for the target UE. The IRI-
POI present in the SMF+PGW-C shall generate the xIRI for the following events:
\- The SMF+PGW-C modifies an existing PDN Connection associated to an MA PDU
Session in the target UE context of the SMF+PGW-C (see TS 23.401 [50] clause
5.7.4).
\- The SMF+PGW-C modifies an existing MA PDU Session context or SM Context for
the target UE (see TS 29.502 [16] clause 5.2.2.3 and clause 5.2.2.8).
\- The SMF+PGW-C transfers the 3GPP Access Leg of an existing MA PDU Session
to EPS (see TS 23.502 [4] clause 4.22.6).
\- The SMF+PGW-C transfers an existing PDN Connection associated to an MA PDU
Session to 5GS (see TS 23.502 [4] clause 4.22.6).
When the SMFMAPDUSessionModification record (see clause 6.2.3.2.7) is used to
report the modification of a PDN Connection:
\- The ePSPDNConnectionModification field shall be populated with the
information in Table 6.3.3-8.
\- If there is no SUPI associated to the SM context for the target UE, the
SUPI field of the SMFMAPDUSessionModification record shall be populated with
the value of the IMSI from the target UE context.
\- If there is no PDU Session ID present in the PCO of the request or response
messages or associated to the context for the PDN connection, the pDUSessionID
field of the SMFMAPDUSessionModification record shall be populated with the
EBI of the default bearer for the PDN Connection.
\- If there is no 5G UP tunnel present in the context associated to the PDN
Connection, the gTPTunnelID field of the SMFMAPDUSessionModification record
shall be populated with the F-TEID for the PGW S5 or S8 interface for the
default bearer of the PDN Connection.
##### 6.3.3.2.8 MA PDU Session Release message reporting MA PDU session
release or the release of a PDN Connection associated to an MA PDU session
The IRI-POI in the SMF+PGW-C shall generate an xIRI containing an
SMFMAPDUSessionRelease record (see clause 6.2.3.2.7) when the IRI-POI present
in the SMF+PGW-C detects that an MA PDU Session or PDN Connection associated
to an MA PDU Session has been released for the target UE. The IRI-POI present
in the SMF+PGW-C shall generate the xIRI for the following events:
\- The SMF+PGW-C releases an existing PDN Connection associated to an MA PDU
Session in the target UE context of the SMF+PGW-C (see TS 23.401 [50] clause
5.7.4).
\- The SMF+PGW-C releases an existing MA PDU Session context or SM Context for
the target UE (see TS 29.502 [16] clause 5.2.2.4 and clause 5.2.2.9).
When the SMFMAPDUSessionRelease record (see clause 6.2.3.2.7) is used to
report the release of a PDN Connection:
\- The ePSPDNConnectionRelease field shall be populated with the information
in Table 6.3.3-13.
\- If there is no SUPI associated to the SM context for the target UE, the
SUPI field of the SMFMAPDUSessionRelease record shall be populated with the
value of the IMSI from the target UE context.
\- If there is no PDU Session ID present in the PCO of the request or response
messages or associated to the context for the PDN connection, the pDUSessionID
field of the SMFMAPDUSessionRelease record shall be populated with the EBI of
the default bearer for the PDN Connection.
\- If there is no 5G UP tunnel present in the context associated to the PDN
Connection, the gTPTunnelID field of the SMFMAPDUSessionRelease record shall
be populated with the F-TEID for the PGW S5 or S8 interface for the default
bearer of the PDN Connection.
##### 6.3.3.2.9 SMF Start of Interception with Already Established MA PDU
Session message reporting Start of Interception with Already Established MA
PDU Session or Start of Interception with Already Established PDN Connection
associated to an MA PDU Session
The IRI-POI in the SMF+PGW-C shall generate an xIRI containing an
SMFStartOfInterceptionWithEstablishedMAPDUSession record (see clause
6.2.3.2.7) when the IRI-POI present in the SMF+PGW-C detects that an MA PDU
Session or PDN Connection associated to an MA PDU Session has already been
established for the target UE when interception starts. The IRI-POI present in
the SMF+PGW-C shall generate the xIRI for the following events:
\- The SMF+PGW-C has an existing PDN Connection associated to an MA PDU
Session in the target UE context of the SMF+PGW-C (see TS 23.401 [50] clause
5.7.4).
\- The SMF+PGW-C has an existing MA PDU Session context or SM Context for the
target UE (see TS 29.502 [16] clause 5.2.2.2 and clause 5.2.2.7).
When the SMFStartOfInterceptionWithEstablishedMAPDUSession record (see clause
6.2.3.2.7) is used to report an existing PDN Connection:
\- The ePSStartOfInterceptionWithEstablishedPDNConnection field shall be
populated with the information in Table 6.3.3-14.
\- If there is no SUPI associated to the SM context for the target UE, the
SUPI field of the SMFStartOfInterceptionWithEstablishedMAPDUSession record
shall be populated with the value of the IMSI from the target UE context.
\- If there is no PDU Session ID associated to the context for the PDN
connection, the pDUSessionID field of the
SMFStartOfInterceptionWithEstablishedMAPDUSession record shall be populated
with the EBI of the default bearer for the PDN Connection.
\- If there is no 5G UP tunnel present in the context associated to the PDN
Connection, the gTPTunnelID field of the
SMFStartOfInterceptionWithEstablishedMAPDUSession record shall be populated
with the F-TEID for the PGW S5 or S8 interface for the default bearer of the
PDN Connection.
#### 6.3.3.2A Triggering of the CC-POI from CC-TF over LI_T3
When CUPS architecture is used and the interception of user plane packets is
required, the CC-TF present in the SGW-C/PGW-C sends a trigger to the CC-POI
present in the SGW-U/PGW-U over the LI_T3 interface.
#### 6.3.3.3 Generation of xCC at CC-POI in the SGW/PGW and ePDG over LI_X3
##### 6.3.3.3.1 Non-CUPS architecture
The CC-POI present in the SGW/PGW and ePDG shall send xCC over LI_X3 for each
IP packet belonging to the target's communication.
Each X3 PDU shall contain the contents of the user plane packet given using
the GTP-U, IP or Ethernet payload format.
The CC-POI present in the SGW/PGW and ePDG shall set the payload format to
indicate the appropriate payload type (5 for IPv4 Packet, 6 for IPv6 Packet, 7
for Ethernet frame or 12 for GTP-U packet as per ETSI TS 103 221-2 [8] clause
5.4).
If it is required to send the ICE-type for the xCC, the CC-POI shall set the
NFID attribute (see ETSI TS 103 221-2 [8] clause 5.3.7) to the appropriate
value from the ICE-type enumeration in TS 33.108 [12] Annex B.10 as a single
octet. As an example, an ICE-type of \"sgw\" is indicated by setting the
attribute to value 3.
##### 6.3.3.3.2 CUPS architecture
When CUPS architecture is used, the CC-POI in the SGW-U/PGW-U is provisioned
by the CC-TF in the SGW-C/PGW-C using a Triggering message (i.e. ActivateTask
message) as described in clause 6.3.3.0.
The CC-POI present in the SGW-U/PGW-U shall send xCC over LI_X3 for each IP
packet matching the criteria specified in the Triggering message (i.e.
ActivateTask message) received over LI_T3 from the CC-TF in the SGW-C/PGW-C.
NOTE: Implementers are reminded of the completeness and non-duplication
requirements (see TS 33.127 [5]).
Each X3 PDU shall contain the contents of the user plane packet given using
the GTP-U, IP or Ethernet payload format.
The CC-POI present in the SGW-U/PGW-U shall set the payload format to indicate
the appropriate payload type (5 for IPv4 Packet, 6 for IPv6 Packet, 7 for
Ethernet frame or 12 for GTP-U Packet as described in ETSI TS 103 221-2 [8]
clauses 5.4 and 5.4.13.
If handover of the entire GTP-U packet is required over LI_HI3 (see clause
6.2.3.8), then consideration shall be made of the correct choice of LI_X3
payload type to ensure that the MDF3 has the necessary CC information. Support
for delivery of LI_X3 as payload type 12 (GTP-U packet) is mandatory.
#### 6.3.3.4 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in the SGW/PGW or ePDG,
the MDF2 shall generate the corresponding IRI message and deliver it over
LI_HI2 without undue delay. The IRI message shall contain a copy of the
relevant record received in the xIRI over LI_X2.
When option 2 specified in clause 6.3.1 is used, the MDF2 shall generate IRI
messages based on the proprietary information received from the SGW/PGW or
ePDG and provide it over LI_HI2 without undue delay.
The IRI messages shall include an IRI payload encoded according to clause 10.5
and TS 33.108 [12] Annex B.9. The MDF2 shall encode the correct value of LIID
in the IRI message, replacing the value \"LIIDNotPresent\" given in the xIRI
(see clause 6.3.2.2).
The IRI messages shall be delivered over LI_HI2 according to ETSI TS 102 232-7
[10] clause 10.
#### 6.3.3.5 Generation of CC over LI_HI3
When xCC is received over LI_X3 from the CC-POI in the SGW/PGW or ePDG, the
MDF3 shall generate the corresponding CC and deliver it over LI_HI3 without
undue delay. The CC message shall contain a copy of the relevant xCC received
over LI_X3.
When option 2 specified in clause 6.3.1 is used, the MDF3 shall generate CC
based on the proprietary information received from the SGW/PGW or ePDG and
provide it over LI_HI3 without undue delay.
The CC shall include a CC payload encoded according to TS 33.108 [12] Annex
B.10.
The CC shall be delivered over LI_HI3 according to ETSI TS 102 232-7 [10]
clause 10.
## 6.4 3G
The Present document does not specify details of the LI interfaces for 3G /
UMTS. Details for this release are specified in TS 33.108 [12].
# 7 Service Layer Based Interception
## 7.1 Introduction
This clause describes any remaining fields, behaviours or details necessary to
implement the required LI interfaces for specific 3GPP-defined services which
are not described in clauses 4 and 5.
## 7.2 Central Subscriber Management
### 7.2.1 General description
This clause describes interception at central subscriber management functions
or databases (e.g. UDM and HSS).
### 7.2.2 LI at UDM
#### 7.2.2.1 General description
In 3GPP network, the UDM provides the unified data management for UE. The UDM
shall have LI capabilities to generate the target UE's service area
registration and subscription management related xIRI.
#### 7.2.2.2 Provisioning over LI_X1
The IRI-POI present in the UDM is provisioned over LI_X1 by the LIPF using the
X1 protocol as described in clause 5.2.2.
The POI in the UDM shall support the following target identifier formats in
the ETSI TS 103 221-1 [7] messages:
\- SUPIIMSI.
\- SUPINAI.
\- PEIIMEI.
\- PEIIMEISV.
\- GPSIMSISDN.
\- GPSINAI.
#### 7.2.2.3 Generation of xIRI over LI_X2
##### 7.2.2.3.1 General description
The IRI-POI present in the UDM shall send xIRI over LI_X2 for each of the
events listed in TS 33.127 [5] clause 7.2.2.4, the details of which are
described in the following clauses.
##### 7.2.2.3.2 Serving system
The IRI-POI in the UDM shall generate an xIRI containing the
UDMServingSystemMessage record when it detects the following events:
\- When the UDM receives the amf3GPPAccessRegistration from the AMF as part of
the Nudm_UEContextManagement_Registration service operation (see TS 29.503
[25] clause 5.3.2.2.2).
\- When the UDM receives the amfNon3GPPAccessRegistration from the AMF as part
of the Nudm_UEContextManagement_Registration service operation (see TS 29.503
[25] clause 5.3.2.2.3).
When a target UE registers to both 3GPP and non-3GPP access, two separate
xIRIs each containing the UDMServingSystemMessage record may be generated by
the IRI-POI in the UDM.
Table 7.2.2.3-1: Payload for UDMServingSystemMessage record
* * *
Field name Description M/C/O sUPI SUPI associated with the target UE, see TS
29.571 [17]. M pEI PEI associated with the target UE, when known, see TS
29.571 17]. C gPSI GPSI associated with the target UE, when known, see TS
29.571 [17]. C gUAMI Serving AMF's GUAMI, when known., see NOTE 1. C gUMMEI
Serving MME's GUMMEI, see NOTE 2. C pLMNID Serving PLMN Id. See TS 29.571
[17]. See NOTE 3. C servingSystemMethod Identifies method used to access the
serving system, see NOTE 4. M serviceID Identifies the target UE's 5G service
identifiers (e.g. SNSSAI, CAGID) when the AMF Registration is executed, when
known, see TS 29.571 [17]. C roamingIndicator Boolean which indicates if the
serving PLMN is different from the HPLMN. See TS 29.503 [25] clause 6.4.6.2.8.
M
* * *
NOTE 1: GUAMI is the global unique identifier of an AMF [2] and its format is
defined in TS 29.571 [17]. As defined in TS 23.501 [2] clause 5.9.4, GUAMI
consists of \ \ \ \ \. The
GUAMI is reported if the UDM receives the same from the AMF.
NOTE 2: GUMMEI is the global unique identifier of an MME and its format is
defined in TS 23.003 [19]. As defined in TS 23.003 [19] clause 2.8.1, GUMMEI
consists of \ \ \. The GUMMEI is reported if the UDM
has this information (e.g. in a combined UDM/HSS).
NOTE 3: PLMN Id provides the VPLMN Id when the target UE is roaming.
NOTE 4: This identifies whether the xIRI containing the
UDMServingSystemMessage record is generated due to the reception of an
amf3GPPAccessRegistration, or an amfNon3GPPAccessRegistration. See TS 29.503
[25].
TS 29.571 [17] requires that the encoding of 3GPP defined identifiers (e.g.
IMSI, NAI) shall be prefixed with its corresponding prefix (e.g. with
reference to SUPI it requires \'imsi-\',\'nai-\'). However, identifiers and
parameters shall be coded over the LI_X2 and LI_HI2 according to Annex A of
the present document, so without the prefix specified in TS 29.571 [17].
The IRI-POI present in the UDM generating an xIRI containing an
UDMServingSystemMessage record shall set the Payload Direction field in the
PDU header to _not applicable_ (Direction Value 5, see ETSI TS 103 221-2 [8]
clause 5.2.6).
##### 7.2.2.3.3 Subscriber record change
The IRI-POI in the UDM shall generate an xIRI containing the
UDMSubscriberRecordChangeMessage record when it detects the following events:
\- When the UDM receives the Amf3GppAccessRegistration from the AMF as part of
the Nudm_UEContextManagement Registration service operation (see TS 29.503
[25] clause 5.3.2.2.2) and detects a change in the SUPI/GPSI/PEI association
for a target.
\- When the UDM receives the AmfNon3GppAccessRegistration from the AMF as part
of the Nudm_UEContextManagement Registration service operation (see TS 29.503
[25] clause 5.3.2.2.3) and detects a change in the SUPI/GPSI/PEI association
for a target.
\- When the UDM receives the Amf3GppAccessRegistrationModification from the
AMF as part of Nudm_UEContextManagement Update service operation (see TS
29.503 [25] clause 5.3.2.6.2) and detects a change in the SUPI/GPSI/PEI
association for a target.
\- When the UDM receives the AmfNon3GppAccessRegistrationModification from the
AMF as part of Nudm_UEContextManagement Update service operation (see TS
29.503 [25] clause 5.3.2.6.3) and detects a change in the SUPI/GPSI/PEI
association for a target.
\- When the UDM receives the PeiUpdateInfo from the HSS as part of the
Nudm_UEContextManagement PEI Update service operation (see TS 29.503 [25]
clause 5.3.2.10.2) and detects a change in the SUPI/GPSI/PEI association for a
target.
\- Upon detection of modification between SUPI and GPSI association (if UDR is
deployed, when UDM receives the DataChangeNotify from the UDR including the
modified GPSI as part of the Nudr_DataRepository Notification service
operation (see TS 29.504 [48] clause 5.2.2.8.3 and TS 29.505 [49] clause
5.4.2.6); if UDR is not deployed, when the modification is detected as result
of UDM provisioning).
\- Upon UE de-provisioning (if UDR is deployed, when UDM receives the
DataChangeNotify from the UDR including the deleted SUPI as part of the
Nudr_DataRepository Notification service operation (see TS 29.504 [48] clause
5.2.2.8.3 and TS 29.505 [49] clause 5.4.2.6); if UDR is not deployed, when the
modification is detected as result of UDM deprovisioning).
\- When a new SUPI is provisioned (if UDR is deployed, when UDM receives the
DataChangeNotify from the UDR including the new and the old SUPI as part of
the Nudr_DataRepository Notification service operation (see TS 29.504 [48]
clause 5.2.2.8.3 and TS 29.505 [49] clause 5.4.2.6); if UDR is not deployed,
when the modification is detected as result of UDM provisioning).
\- When the UDM receives the Amf3GppAccessRegistrationModification from the
AMF as part of Nudm_UEContextManagement Update service operation (see TS
29.503 [25] clause 5.3.2.2.2) and detects a change in the ServiceID
association for a target.
\- Upon detection of modification in the Service ID association (if UDR is
deployed, when UDM receives the DataChangeNotify from the UDR including the
modified Service ID as part of the Nudr_DataRepository Notification service
operation (see TS 29.504 [48] clause 5.2.2.8.3 and TS 29.505 [49] clause
5.4.2.6); if UDR is not deployed, when the modification is detected as a
result of UDM provisioning.
When a target UE registers to both 3GPP and non-3GPP access, two separate
xIRIs each containing the UDMSubscriberRecordChangeMessage report record may
be generated by the IRI-POI in the UDM.
Table 7.2.2.3-2: Payload for UDMSubscriberRecordChangeMessage record
* * *
Field name Description M/C/O sUPI SUPI currently associated with the target
UE, see TS 29.571 [17], see NOTE 1 C pEI PEI currently associated with the
target UE, when known, see TS 29.571 [17]. C gPSI GPSI currently associated
with the target UE, when known, see TS 29.571 [17]. C oldSUPI Old SUPI
associated with the target UE, when known. C oldServiceID Identifies the
target UE's old service identifiers (e.g. SNSSAI, CAGID), when known, see TS
29.571 [17]. C oldPEI Old PEI associated with the target UE, when known. C
oldGPSI Old GPSI associated with the target UE, when known. C
subscriberRecordChangeMethod Identifies the trigger of Subscriber Record
Change operation, see NOTE 2. M serviceID Identifies the target UE's 5G
service identifiers that have been modified (e.g. SNSSAI, CAGID), when known,
see TS 29.571 [17]. C
* * *
NOTE 1: When an identity is changed, both the old one and the current one are
reported; the target identity is always reported either as current identity or
old identity depending on the change, together with the other current
identities (e.g. ServiceIDs), if available. If the target identity is changed,
the old identity represents the target otherwise the current identity
represents the target (as examples, when SUPI is the target and PEI is
changing, SUPI (target), PEI and old PEI, along with GPSI, if available, are
reported; when SUPI is the target and SUPI is changed, SUPI and oldSUPI
(target), along with PEI and GPSI, if available, are reported).
NOTE 2: This identifies whether the xIRI containing the
UDMSubscriberRecordChangeMessage record is generated due to a PEI change, a
GPSI, a SUPI modification or ServiceID change, or a UE de-provisioning.
The IRI-POI present in the UDM generating an xIRI containing an
UDMSubscriberRecordChangeMessage record shall set the Payload Direction field
in the PDU header to _not applicable_ (Direction Value 5, see ETSI TS 103
221-2 [8] clause 5.2.6).
TS 29.571 [17] requires that the encoding of 3GPP defined identifiers (e.g.
IMSI, NAI) shall be prefixed with its corresponding prefix (e.g. with
reference to SUPI it requires \'imsi-\',\'nai-\'). However, identifiers and
parameters shall be coded over the LI_X2 and LI_HI2 according to Annex A of
the present document, so without the prefix specified in TS 29.571 [17].
##### 7.2.2.3.4 Cancel location
The IRI-POI in the UDM shall generate an xIRI containing the UDMCancelLocation
record when it detects the following events:
\- When the UDM sends DeregistrationData to AMF as part of the
Nudm_UEContextManagement DeregistrationNotification service operation (see TS
29.503 [25] clause 5.3.2.3.2).
\- When the UDM receives the Amf3GppAccessRegistrationModification with
PurgeFlag set from the AMF as part of Nudm_UEContextManagement Deregistration
service operation (see TS 29.503 [25] clause 5.3.2.4.2).
\- When UDM receives the AmfNon3GppAccessRegistrationModification with
PurgeFlag set from the AMF as part of Nudm_UEContextManagement Deregistration
service operation (see TS 29.503 [25] clause 5.3.2.4.3).
When a target UE deregisters from both 3GPP and non-3GPP access, two separate
xIRIs each containing the UDMCancelLocation report record may be generated by
the IRI-POI in the UDM.
NOTE: Invocation of the Nudm_UEContextManagement Deregistration service
operation in the case of UE deregistration is an implementation option (see TS
23.502 [4], clause 4.5.3). Consequently, the UDMCancel Location xIRI in such
case is only generated if this option is supported by the serving network.
Table 7.2.2.3.4-1: Payload for UDMCancelLocationMessage record
Field name Description M/C/O
* * *
sUPI SUPI associated with the target UE, see TS 29.571 [17]. M pEI PEI
associated with the target UE, when known, see TS 29.571 [17]. C gPSI GPSI
associated with the target UE, when known, see TS 29.571 [17]. C gUAMI
Previous serving AMF's GUAMI, when known. See NOTE 1. C pLMNID Previous
serving PLMN ID. See TS 29.571 [17]. See NOTE 2. C cancelLocationMethod
Identifies method used to access the serving system, see NOTE 3. M
NOTE 1: GUAMI is the global unique identifier of an AMF [2] and its format is
defined in TS 29.571 [17]. As defined in TS 23.501 [2] clause 5.9.4, GUAMI
consists of \ \ \ \ \. The
GUAMI is reported if the UDM receives the same from the AMF.
NOTE 2: PLMN ID provides the vPLMN ID when the target UE is roaming.
NOTE 3: This identifies whether the xIRI containing the
UDMCancelLocationMessage record is generated due to the reception of a UDM
deregistration, and AMF 3GPP Access deregistration, or an AMF Non 3GPP access
deregistration.
The IRI-POI present in the UDM generating an xIRI containing an
UDMCancelLocationMessage record shall set the Payload Direction field in the
PDU header to _not applicable_ (Direction Value 5, see ETSI TS 103 221-2 [8]
clause 5.2.6).
TS 29.571 [17] requires that the encoding of 3GPP defined identifiers (e.g.
IMSI, NAI) shall be prefixed with its corresponding prefix (e.g. with
reference to SUPI it requires \'imsi-\',\'nai-\'). However, identifiers and
parameters shall be coded over the LI_X2 and LI_HI2 according to Annex A of
the present document, so without the prefix specified in TS 29.571 [17].
##### 7.2.2.3.5 Location information request
Location information request is not supported in the present document.
##### 7.2.2.3.6 Location information result
The IRI-POI in the UDM shall generate an xIRI containing the
UDMLocationInformationResult record when it detects the following events:
\- When UDM receives the LocationInfoRequest from an NF service consumer (i.e.
HSS) as part of Nudm_MT_ProvideLocationInfo service operation (see TS 29.503
[25], clause 6.7.6.2.3) and the UDM sends the LocationInfoResult as part of
Nudm_MT_ProvideLocationInfo service operation (see TS 29.503 [25], clause
6.7.6.2.4).
When a target UE is registered to both 3GPP and non-3GPP access, two separate
xIRIs each containing the LocationInfoResult report record may be generated by
the IRI-POI in the UDM.
Table 7.2.2.3.6-1: Payload for UDMLocationInformationResult record
* * *
Field name Description M/C/O sUPI SUPI currently associated with the target,
see TS 29.571 [17]. M pEI PEI currently associated with the target UE, when
known, see TS 29.571 [17]. C gPSI GPSI currently associated with the target
UE, when known, see TS 29.571 [17]. C locationInfoRequest Indicates the
information received from the HSS in the LocationInfoRequest. At least one of
the parameters in Table 7.2.2.3.6-2 shall be included. See NOTE below table
7.2.2.3.6-2. M vPLMNId PLMNID of the visited PLMN, if UE is currently
registered to visited network. C currentLocationIndicator Shall indicate if
the UE location is current or last known. Include if provided in the
LocationInfoResult. C aMFinstanceID Provides the NF instance ID of the serving
AMF for 3GPP access. Shall be included if provided in the LocationInfoResult.
C sMSFinstanceID Provides the NF instance ID of the serving SMSF. Shall be
included if provided in the LocationInfoResult. C location Location
information available at the UDM at the time of the LocationInfoRequest,
include if in LocationInfoResult. C rATType Shall provide the current RAT type
of the UE, if present in the LocationInfoResult. C problemDetails Indicates
the reason for LocationInfoResult failure. See TS 29.571 [17], clause 5.2.4.1.
Shall be included if provided in the LocationInfoResult. C
* * *
Table 7.2.2.3.6-2: Payload for LocationInfoRequest parameter
* * *
Field name Description req5GSLocation Boolean that indicates If 5GS location
is requested. reqCurrentLocation Boolean that indicates if current location is
requested. reqRatType Boolean indicates if Rat Type is requested. reqTimeZone
Boolean indicates if time zone is requested. reqServingNode Boolean indicates
if serving node instance ID is requested.
* * *
NOTE: The absence of one or more of the parameters in table 7.2.2.3.6-2
assumes that it was not included in the LocationInfoRequest.
##### 7.2.2.3.7 UE information response
The IRI-POI in the UDM shall generate an xIRI containing the
UDMUEInfromationResponse record when it detects the following events:
\- When the UDM receives the ProvideUeInfo GET request from the NF service
consumer as part of Nudm_MT_ProvideUeInfo service operation (see TS 29.503
[25], clause 6.7.6.2.2) and the UDM returns a UeInfo response.
Table 7.2.2.3.7-1: Payload for UDMUEInformationResponse record
* * *
Field name Description M/C/O sUPI SUPI currently associated with the target
UE, see TS 29.571 [17]. M tADSInfo Contains the UE Context Information as
known at the UDM. See TS 29.518 [22], clause 6.3.6.2.4. Shall be included if
UE Context is returned in the UeInfo response. C fiveGSUserStateInfo Describes
the 5GS user state of the UE as known at the UDM. See TS 29.518 [22], clause
6.2.6.3.11. Shall be included if 5GS user state is returned in the UeInfo
response. C fiveGSRVCCInfo Indicates whether the UE supports 5G SRVCC. See TS
29.503 [25], clause 6.7.6.2.5. Shall be included if returned in the UeInfo
response. C problemDetails Indicates the reason for UeInfo response failure.
See TS 29.571 [17], clause 5.2.4.1. Shall be included if provided in the
UeInfo response. C
* * *
##### 7.2.2.3.8 UE Authentication response
The IRI-POI in the UDM shall generate an xIRI containing the
UDMUEAuthenticationResponse record when it detects the following events:
\- When the UDM receives the AuthenticationInfoRequest from the AUSF as part
of Nudm_UEAuthentication service operation (see TS 29.503 [25], clause
6.3.6.2.2) and the UDM sends the AuthenticationInfoResult to the AUSF as part
of the Nudm_UEAuthentication service operation (see TS 29.503 [25], clause
6.3.6.2.3).
\- When the UDM receives the HSSAuthenticationInfoRequest from the HSS as part
of the Nudm_UEAuthentication service operation (see TS 29.503 [25], clause
6.3.6.2.10) and the UDM sends the HSSAuthenticationInfoResult to the AUSF as
part of the Nudm_UEAuthentication service operation (see TS 29.503 [25],
clause 6.3.6.2.11).
When a target UE registers from both 3GPP and non-3GPP access, two separate
xIRIs each containing the UDMUEAuthentication report record may be generated
by the IRI-POI in the UDM.
Table 7.2.2.3.8-1: Payload for UDMUEAuthenticationResponse record
* * *
Field name Description M/C/O sUPI SUPI currently associated with the target
UE, see TS 29.571 [17]. M authenticationInfoRequest Indicateds information
provided in the UEAuthenticationInfoRequest. See Table 7.2.2.3.8-2 for details
of payload. M aKMAIndicator Indicates whether AKMA keys are needed for the UE,
Shall be included if AKMA keys are requested in the AuthenticationInfoRequest.
C problemDetails Shall Indicate reason for AuthenticationInfoResultfailure.
Shall be included if failure occurs. See TS 29.571 [17], clause 5.2.4.1. C
* * *
Table 7.2.2.3.8-2: Payload for AuthenticationInfoRequest parameter
* * *
Field name Description M/C/O infoRequestType Indicates whether the
AuthenticationInfoRequest was sent by the HSS, AUSF or other. M rGAuthCtx
Contains the UE ID (i.e. SUPI, SUCI) provided in the authentication
indication, at least one shall be present. M authType Indicates the
authentication method provided by the HSS or AUSF in the
AuthenticationInfoRequest. M servingNetworkName Serving network name. See TS
33.501 [11] clause 6.1.1.4. M aUSFInstanceID Identifies the AUSF instance
which generated the AuthenticationInformatoinRequest. Shall be included if
known. C cellCagInfo Provides CAG cell information (e.g. CAGId) if UE is
attempting registration from a CAG. C n5GCIndicator Boolean value that
indicates whether the device is a N5GC device. Include if provided in the
AuthenticationInfoRequest. C
* * *
#### 7.2.2.4 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in UDM, the MDF2 shall
send an IRI message over LI_HI2 without undue delay.
The timestamp field of the PSHeader structure shall be set to the time that
the UDM event was observed (i.e. the timestamp field of the xIRI).
The IRI type parameter (see ETSI TS 102 232-1 [9] clause 5.2.10) shall be
included and coded according to table 7.2.2-4.
Table 7.2.2-4: IRI type for IRI messages
IRI message IRI type
* * *
UDMServingSystemMessage REPORT UDMSubscriberRecordChangeMessage REPORT
UDMCancelLocationMessage REPORT UDMLocationInformationResult REPORT
UDMUEInformationResponse REPORT UDMUEAuthenticationResponse REPORT
These IRI messages shall omit the CIN (see ETSI TS 102 232-1 [9] clause
5.2.4).
### 7.2.3 LI at HSS
#### 7.2.3.1 General
The HSS provides the support functions in the mobility management, session
setup and user authentication and access authorization.
The present document allows two options for HSS LI stage 3 interfaces:
1\. Use LI_X1 and LI_X2 interfaces specified below in the present document for
stage 3.
2\. Use TS 33.107 [36] natively as defined in that document.
In both cases, the present document specifies the stage 3 for the LI_HI1 and
LI_HI2 interfaces.
#### 7.2.3.2 Provisioning over LI_X1
The IRI-POI present in the HSS is provisioned over LI_X1 by the LIPF using the
X1 protocol as described in clause 5.2.2 of the present document.
The IRI-POI in the HSS shall support the target identifiers specified in TS
33.107 [36]:
\- IMSI (using the IMSI target identifier format from ETSI TS 103 221-1 [7]).
\- MSISDN (using the E164Number target identifier format from ETSI TS 103
221-1 [7]).
\- IMEI (using the IMEI target identifier format from ETSI TS 103 221-1 [7]).
\- IMPU (using the IMPU target identifier format from ETSI TS 103 221-1 [7]).
\- IMPI (using the IMPI target identifier format from ETSI TS 103 221-1 [7]).
#### 7.2.3.3 Generation of xIRI over LI_X2
The IRI-POI present in the HSS shall send the xIRIs over LI_X2 for each of the
events listed in TS 33.107 [36], the details of which are also specified in TS
33.107 [36].
The IRI-POI present in the HSS shall set the payload format to
EpsHI2Operations.EpsIRIContent (value 14), see clause 5.3 of the present
document and ETSI TS 103 221-2 [8] clause 5.4. The payload field shall contain
an EpsHI2Operations.EpsIRIContent structure encoded according to TS 33.108
[12] clause B.9.
As the LIID may be not available at the HSS but is mandatory in
EpsHI2Operations.EpsIRIContent according to TS 33.108 [12] clause B.9, its
value in the lawfulInterceptionIdentifier field of the encoded PDU shall be
set to the fixed string \"LIIDNotPresent\".
#### 7.2.3.4 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in the HSS, the MDF2
shall generate the corresponding IRI message and deliver it over LI_HI2
without undue delay. The IRI message shall contain a copy of the relevant
record received in the xIRI over LI_X2.
When Option 2 specified in clause 7.2.3.1 above is used, the MDF2 shall
generate IRI messages based on the proprietary information received from the
HSS and provide it over LI_HI2 without undue delay.
The IRI messages shall include an IRI payload encoded according to TS 33.108
[12] clause B.9. The MDF2 shall encode the correct value of LIID in the IRI
message, replacing the value \"LIIDNotPresent\" given in the xIRI (see clause
7.2.3.3 above).
The IRI messages shall omit the CIN (see ETSI TS 102 232-1 [9] clause 5.2.4).
The IRI messages shall be delivered over LI_HI2 according to ETSI TS 102 232-7
[10] clause 10.
## 7.3 Location
### 7.3.1 Lawful Access Location Services (LALS)
#### 7.3.1.1 General description
The LALS architecture and functionality is specified in TS 33.127 [5] clause
7.3.3.
#### 7.3.1.2 Provisioning over LI_X1
#### 7.3.1.2.1 Target positioning service
For the LALS target positioning service (TS 33.127 [5] clause 7.3.3.2) the
IRI-POI provided by the LI-LCS Client is directly provisioned over LI_X1 by
the LIPF using the LI_X1 protocol as described in clause 5.2.2 with the
TaskDetailsExtensions field of the ActivateTask message specifying the type of
the target positioning request, immediate vs. periodic, and, in the latter
case, the periodicity of the positioning requests.
Based on national regulatory requirements and CSP policy, the
TaskDetailsExtensions may also include the QoS parameters (specified in OMA-
TS-MLP-V3_5-20181211-C [20]) for the use on the Le interface towards the LCS
Server/GMLC. Alternatively, the QoS parameters may be statically configured in
the LI-LCS Client.
Table 7.3.1.2-1 shows the details of the LI_X1 ActivateTask message used for
the LI-LCS Client provisioning for the target positioning service.
The LI_X1 DeactivateTask shall be issued by the LIPF to terminate the target
positioning service and withdraw the associated provisioning data, except for
the Immediate target positioning service in which case the LI_X1
DeactivateTask is not used.
Table 7.3.1.2-1: ActivateTask message for LI-LCS Client target positioning
provisioning
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 field | Description | M/C/O | | name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. | M | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One of the following (see | M | | | ETSI TS 103 221-1 [7]): | | | | | | | | - SUPIIMSI. | | | | | | | | - SUPINAI. | | | | | | | | - GPSIMSISDN. | | | | | | | | - GPSINAI. | | | | | | | | - IMSI. | | | | | | | | - MSISDN (E164Number | | | | target ID format, per ETSI | | | | TS 103 221-1 [7]). | | | | | | | | - IMPU. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X2Only". | M | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints of | M | | | LI_X2 interface. These | | | | delivery endpoints are | | | | configured in LI-LCS Client | | | | using the CreateDestination | | | | message as described in | | | | ETSI TS 103 221-1 [7] | | | | clause 6.3.1 prior to the | | | | task activation. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | "Immediate" or "Periodic". | M | | | | | | PositioningServiceType | | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | Time interval between the | C | | | positioning requests in | | | PositioningPeriodicity | case of Periodic | | | | positioning, in seconds. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | Set of optional parameters | O | | | for MLP SLIR message, per | | | PositioningParameters | OMA-TS-MLP-V3_5-20181211-C | | | | [20]: | | | | | | | | - requested location type | | | | (clause 5.3.60). | | | | | | | | - requested response type | | | | (clause 5.3.112.1). | | | | | | | | - max location age (clause | | | | 5.3.65). | | | | | | | | - response timing required | | | | (clause 5.3.106). | | | | | | | | - response timer (clause | | | | 5.3.107). | | | | | | | | - horizontal accuracy with | | | | QoS class (clause 5.3.44). | | | | | | | | - altitude accuracy with | | | | QoS class (clause 5.3.6). | | | | | | | | - motion state request | | | | (clause 5.3.70). | | +-----------------------------+-----------------------------+-------+
#### 7.3.1.2.2 Triggered location service
For the LALS triggered location service (TS 33.127 [5] clause 7.3.3.3) the
LTF, as an IRI-TF, is provisioned by the LIPF using the LI_X1 protocol as
described in clause 5.2.2. The "TaskDetailsExtensions" parameter of the
ActivateTask message in this case will carry the address of LI-LCS Client to
be used for the service and, optionally, the positioning parameters for use on
the Le interface, similar to the target positioning provisioning.
Prior to issuing one or more \"ActivateTask\" requests towards an LTF, the
LIPF shall provision the LTF with the LI_X2 destinations by using the
\"CreateDestination\" operation(s), as per clause 5.2.2.
Table 7.3.1.2-2 defines the details of the LI_X1 ActivateTask message used for
the LTF provisioning for the Triggered Location service.
Table 7.3.1.2-2: ActivateTask message for LTF triggered location service
provisioning
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 field | Description | M/C/O | | name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. | M | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One or more of the | M | | | following (see ETSI TS 103 | | | | 221-1 [7]): | | | | | | | | - SUPIIMSI. | | | | | | | | - SUPINAI. | | | | | | | | - GPSIMSISDN. | | | | | | | | - GPSINAI. | | | | | | | | - IMSI. | | | | | | | | - MSISDN (E164Number | | | | target ID format, per ETSI | | | | TS 103 221-1 [7]). | | | | | | | | - IMPU. | | | | | | | | NOTE: An ActivateTask for | | | | an LTF may be issued by the | | | | LIPF if and only if at | | | | least one of the | | | | identifiers in the above | | | | list was specified in the | | | | warrant. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X2Only". | M | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints for | M | | | LI-LCS Client LI_X2. These | | | | delivery endpoints are | | | | configured in LTF using the | | | | CreateDestination message | | | | as described in ETSI TS 103 | | | | 221-1 [7] clause 6.3.1 | | | | prior to the task | | | | activation. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | The IP address of the | M | | | LI-LCS Client for | | | LILCSClientAddress | triggering. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | Set of optional parameters | O | | | for MLP SLIR message, per | | | PositioningParameters | OMA-TS-MLP-V3_5-20181211-C | | | | [20]: | | | | | | | | - requested location type | | | | (clause 5.3.60). | | | | | | | | - requested response type | | | | (clause 5.3.112.1). | | | | | | | | - max location age (clause | | | | 5.3.65). | | | | | | | | - response timing required | | | | (clause 5.3.106). | | | | | | | | - response timer (clause | | | | 5.3.107). | | | | | | | | - horizontal accuracy with | | | | QoS class (clause 5.3.44). | | | | | | | | - altitude accuracy with | | | | QoS class (clause 5.3.6). | | | | | | | | - motion state request | | | | (clause 5.3.70). | | +-----------------------------+-----------------------------+-------+
#### 7.3.1.3 Triggering over LI_T2
An LTF, as an IRI-TF, provisioned as described in clause 7.3.1.2.2, triggers
the LI-LCS Client (which plays the role of a triggered IRI-POI) using the
LI_T2 protocol as described in clause 5.2.4. The \"TaskDetailsExtensions\" in
the LI_T2 \"ActivateTask\" message carries the positioing parameters mapped
from information the LTF receives from the ADMF over the LI_X1. The LI_T2
\"ActivateTask\" message header may include a correlation ID from the
triggering xIRI, if available.
Prior to issuing one or more \"ActivateTask\" requests towards an LI-LCS
Client, the LTF shall provision the LI-LCS Client with the LI_X2 destinations
by using the \"CreateDestination\" operation(s), as per clause 5.2.2. The LI-
LCS Client shall deactivate the task on its own upon issuing the final xIRI
for the trigger. There is no DeactivateTask operation on the LI_T2 for the LI-
LCS Client.
Table 7.3.1.3-1 shows the details of the LI_T2 ActivateTask message used by
the LTF to trigger LI-LCS Client for the triggered location service.
Table 7.3.1.3-1: ActivateTask message from LTF to LI-LCS Client for the
triggered location service triggering
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 field | Description | M/C/O | | name | | | +-----------------------------+-----------------------------+-------+ | XID | The same value as in the | M | | | LTF provisioning (clause | | | | 7.3.3.2.2). | | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | One of the following (see | M | | | ETSI TS 103 221-1 [7]): | | | | | | | | - SUPIIMSI. | | | | | | | | - SUPINAI. | | | | | | | | - GPSIMSISDN. | | | | | | | | - GPSINAI. | | | | | | | | - IMSI. | | | | | | | | - MSISDN (E164Number | | | | target ID format, per ETSI | | | | TS 103 221-1 [7]). | | | | | | | | - IMPU. | | | | | | | | NOTE: The target identifier | | | | used shall correspond to | | | | one of the target | | | | identifiers in the xIRI | | | | observed by the LTF, and | | | | shall be one of the | | | | identifiers provided in the | | | | ActivateTask for the LTF | | | | (clause 7.3.1.2.2). | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to "X2Only". | M | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints for | M | | | LI-LCS Client LI_X2. These | | | | delivery endpoints are | | | | configured in LI-LCS Client | | | | by the LTF using the | | | | CreateDestination message | | | | as described in ETSI TS 103 | | | | 221-1 [7], clause 6.3.1 | | | | prior to the task | | | | activation. | | +-----------------------------+-----------------------------+-------+ | CorrelationID | Correlates the requested | C | | | location to the triggering | | | | xIRI, if available. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | Set of optional parameters | O | | | for MLP SLIR message, per | | | PositioningParameters | OMA-TS-MLP-V3_5-20181211-C | | | | [20]: | | | | | | | | - requested location type | | | | (clause 5.3.60). | | | | | | | | - requested response type | | | | (clause 5.3.112.1). | | | | | | | | - max location age (clause | | | | 5.3.65). | | | | | | | | - response timing required | | | | (clause 5.3.106). | | | | | | | | - response timer (clause | | | | 5.3.107). | | | | | | | | - horizontal accuracy with | | | | QoS class (clause 5.3.44). | | | | | | | | - altitude accuracy with | | | | QoS class (clause 5.3.6). | | | | | | | | - motion state request | | | | (clause 5.3.70). | | +-----------------------------+-----------------------------+-------+
#### 7.3.1.4 Generation of xIRI over LI_X2
The IRI-POI provided by the LI-LCS client shall deliver the target location
reports to respective MDF(s) as xIRI over the LI_X2 interface.
Table 7.3.1.4-1: LALSReport record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | sUPI | SUPI of the target, if used | C | | | for the service (see NOTE). | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI of the target, if used | C | | | for the service (see NOTE). | | +-----------------------------+-----------------------------+-------+ | iMSI | IMSI of the target, if used | C | | | for the service (see NOTE). | | +-----------------------------+-----------------------------+-------+ | mSISDN | MSISDN of the target, if | C | | | used for the service (see | | | | NOTE). | | +-----------------------------+-----------------------------+-------+ | iMPU | IMPU of the target, if used | C | | | for the service (see NOTE). | | +-----------------------------+-----------------------------+-------+ | location | Location of the target, if | C | | | obtained successfully. | | | | | | | | Encoded as a | | | | _positioningInfo_ parameter | | | | (_l | | | | ocation >positioningInfo_). | | | | Both the _positionInfo_ | | | | (_location >posi | | | | tioningInfo>positionInfo_) | | | | and the _mLPPositionData_ | | | | (_locati | | | | on >positioningInfo>rawMLP | | | | Response>mLPPositionData_) | | | | are present in the case of | | | | successful positioning. In | | | | the case of positioning | | | | failure only the | | | | _mLPErrorCode | | | | (loc | | | | ation >positioningInfo>raw | | | | MLPResponse>mLPErrorCode)_ | | | | is present. See Annex A. | | +-----------------------------+-----------------------------+-------+ | NOTE: One and only one of | | | | SUPI, GPSI, IMSI, MSISDN, | | | | IMPU shall be present and | | | | it shall correspond to the | | | | target identifier included | | | | in the respective | | | | ActivateTask message for | | | | the LI-LCS Client. | | | +-----------------------------+-----------------------------+-------+
The LI-LCS Client generating an xIRI containing an LALSReport record shall set
the Payload Direction field in the PDU header to _not applicable_ (Direction
Value 5, see ETSI TS 103 221-2 [8] clause 5.2.6).
The LI_X2 header (as per clause 5.3.2) of the LALSReport record presented in
table 7.3.1.4-1 shall contain the correlation ID (if provided) from a
respective LI_T2 ActivationTask message.
#### 7.3.1.5 Generation of IRI over LI_HI2
The LALSReport payload, defined in clause 7.3.1.4, shall be used as the
payload of the respective LALSReport record, no payload mediation is required.
A LALSReport message shall be assigned the same CIN (see ETSI TS 102 232-1 [9]
clause 5.2.4) as the IRI message that triggered the LALS reporting, if that
triggering IRI message is assigned a CIN. Otherwise, i.e. when the LALSReport
is a result of the LALS Target Positioning, or the triggering IRI message has
no CIN assigned, the CIN in the LALSReport shall be omitted.
NOTE: In some specific scenarios the amount of LALS reports data may overload
the LI_HI2 and/or LI_X2 interfaces. To prevent the overload, a flow control
for LALS triggered location reports may be implemented in MDF and/or LI-LCS
client, e.g. by limiting the frequency of the reports for individual targets.
### 7.3.2 Cell database information reporting
#### 7.3.2.1 General description
When the location information present within an xIRI includes the cell
identity, the MDF2 that receives the xIRI may retrieve the cell site
information for that cell from a CSP database and deliver the same to the LEMF
either within the IRI message generated from the received xIRI or in a
separate IRI message containing the MDFCellSiteReport record.
For each intercept, if the MDF2 reports the cell site information, then it
shall provide such information at least on the initial appearance of the cell
identity in the related xIRI.
NOTE: The CSP needs to ensure that the most recent cell site information is
reported to the LEA.
#### 7.3.2.2 Delivery of cell site information over LI_HI2
The cell site information is encoded as the cellSiteInformation ASN.1
parameter and delivered either within the location field of an IRI message
carrying the respective cell identity, or in a stand-alone IRI message
containing the MDFCellSiteReport record.
The MDF2 shall use the IRI message containing the MDFCellSiteReport record to
convey cell site information retrieved asynchronously with the sending of the
IRI message that caused the retrieval. The MDFCellSiteReport record shall be
delivered as an IRI REPORT (see ETSI TS 102 232-1 [9] clause 5.2.10) and
allocated the same CIN, if any, as the IRI message that caused the retrieval.
When the cell site information is readily available at MDF2 or is retrieved
synchronously (i.e. blocking the sending of the IRI message until the
retrieval is complete), the cell site information shall be conveyed within the
location field of the IRI message that caused the retrieval.
The cell site information for multiple cell identities can be delivered to the
LEMF within an IRI message that carries the respective cell identities or
within the IRI message containing the MDFCellSiteReport record (see Annex A).
The MDF2 generating the IRI message MDFCellSiteReport shall set the Payload
Direction field in the PDU header to _not applicable_ (Direction Value 5, see
ETSI TS 103 221-2 [8] clause 5.2.6).
### 7.3.3 Use of the Location structure
#### 7.3.3.1 General description
The _Location_ structure is used to convey geolocation information.
When the reference datum used for a latitude and longitude given in the
_GeographicalCoordinates_ structure is known by the operator, the reference
datum shall be identified in the _mapDatumInformation_ field. The reference
datum identity shall be specified as an Open Geospatial Consortium URN, as
defined in OGC 05-010 [35].
### 7.3.4 Separated location reporting
#### 7.3.4.1 General description
When location information cannot be reported via an existing message
generation at the IRI-POI, a separate xIRI may be generated from any
provisioned IRI-POI that has access to location information and included in
the SeparatedLocationReporting record.
The following information needs to be transferred from the IRI-POI to the MDF2
to enable a MDF2 to perform its functionality:
\- Target identity.
\- Event date/time.
\- Target location(s).
\- Date/time of UE location(s).
\- Nature and identity of the POI.
\- Location source(s).
Details of how the IRI-POI in the SMF generates this record can be found in
clause 6.2.3.2.1.
Details of how the IRI-POI in the NEF generates this record can be found in
clause 7.7.2.1.1.
Table 7.3.4.1-1: Payload for SeparatedLocationReporting record
* * *
Field name Description M/C/O sUPI SUPI associated with the registration (see
clause 6.2.2.4). M sUCI SUCI used in the registration, if available. C pEI PEI
provided by the UE during the registration, if available. C gPSI GPSI obtained
in the registration, if available as part of the subscription profile. C gUTI
5G-GUTI provided as outcome of initial registration or used in other cases,
see TS 24.501 [13] clause 5.5.1.2.2. C location Location information
determined by the network at the time of message generation. M
non3GPPAccessEndpoint For Non-3GPP access, UE\'s local IP address used to
reach the N3IWF, TNGF or TWIF. IP addresses are given as 4 octets (for IPv4)
or 16 octets (for IPv6) with the most significant octet first (network byte
order). C rATType RAT Type associated with the data for which location
information is provided, see TS 23.502 [4] clause 4.3.2. Values given as per
TS 29.571 [17] clause 5.4.3.2. C
* * *
## 7.4 Messaging
### 7.4.1 Introduction
Stage 3 intercept capabilities for SMS at an SMSF are defined in clause 6.2.5.
Stage 3 for MMS interception follows in clause 7.4.3.
### 7.4.2 LI at the MMS Proxy-Relay
#### 7.4.2.1 Provisioning over LI_X1
The IRI-POI present in the MMS Proxy-Relay is provisioned over LI_X1 by the
LIPF using the X1 protocol as described in clause 5.2.2.
The POI in the MMS Proxy-Relay shall support the following target identifier
formats in the ETSI TS 103 221-1 [7] messages:
\- E164Number.
\- EmailAddress.
\- GPSIMSISDN.
\- IMPI.
\- IMPU.
\- IMSI.
\- SUPIIMSI.
\- NAI.
\- SUPINAI.
#### 7.4.2.2 Generation of xIRI over LI_X2
The IRI-POI present in the MMS Proxy-Relay shall send xIRI over LI_X2 for the
events listed in TS 33.127 [5] clause 7.5.2.3, which is further expanded in
the present document in clause 7.4.2.4 below.
#### 7.4.2.3 Generation of xCC over LI_X3
The CC-POI present in the MMS Proxy-Relay shall send xCC over LI_X3 for any
MMS event where CC is available and authorized for reporting for the events
listed in clause TS 33.127 [5] 7.5.2.3.
The xCC payload shall consist of the MMS contents given as a MIME encoded
document (RFC 2045) according to OMA-TS-MMS_ENC [39]. The payload format shall
be set to \"MIME document\" (value 15).
#### 7.4.2.4 MMS Record Generation Cases
The triggers for MMS record generation are detailed in each of clauses 7.4.3.1
through 7.4.3.20. All triggers are defined by the detection of messages at the
local MMS Proxy-Relay. They belong to one of two following high-level
categories:
\- at the local MMS Proxy-Relay, the sending or arrival of a message, either
to or from the local target UE, using OMA-TS-MMS_ENC [39] definitions, or
\- at the local MMS Proxy-Relay, the sending or arrival of a message to or
from a non-local MMS Proxy-Relay, pertaining to messages either to or from a
non-local target UE served by that non-local MMS Proxy-Relay, using the inter-
proxy MM4 reference point, TS 23.140 [40] clause 8.4 definitions.
The present document assumes that the intercepted MMS complies with version
1.3 of OMA-TS-MMS_ENC [39]. If the intercepted messages do not comply fully,
or the version is other than 1.3, parameters are required to be provided only
if available.
In the following tables, the acronym Multimedia Message (MM) refers to a
message in particular, while Multimedia Message Service (MMS) refers to the
service in general.
### 7.4.3 MMS Records
#### 7.4.3.1 MMSSend
The IRI-POI in the MMS Proxy-Relay shall generate an xIRI containing an
MMSSend record when the MMS Proxy-Relay sends _m-send-conf_ (as defined in
OMA-TS-MMS_ENC [39] clause 6.1.1) to local target UE.
Table 7.4.3-1 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-send-req_ message (from the local target UE to
the MMS Proxy-Relay), and the _m-send-conf_ message (from MMS Proxy-Relay to
the local target UE).
Table 7.4.3-1: Payload for MMSSend
+---------------------+--------------------------------------+-------+ | Field name | Description | M/C/O | +---------------------+--------------------------------------+-------+ | transactionID | An ID used to correlate an MMS | M | | | request and response between the | | | | target and the MMS Proxy-Relay. As | | | | defined in OMA-TS-MMS_ENC [39] | | | | clause 7.3.63. | | +---------------------+--------------------------------------+-------+ | version | The version of MM, to include major | M | | | and minor version. | | +---------------------+--------------------------------------+-------+ | dateTime | Date and Time when the MM was last | M | | | handled (either originated or | | | | forwarded). For origination, | | | | included by the sending MMS client | | | | or the originating MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | originatingMMSParty | ID(s) of the originating party in | M | | | one or more of the formats described | | | | in 7.4.2.1 | | | | | | | | When address translation occurs | | | | (such as the case of a token sent by | | | | the client and replaced with a | | | | proper address by the MMS | | | | Proxy-Relay), both the pre and post | | | | translated addresses (with | | | | appropriate correlation) are | | | | included. | | +---------------------+--------------------------------------+-------+ | terminatingMMSParty | ID(s) of the terminating party in | C | | | one or more of the formats described | | | | in 7.4.2.1 | | | | | | | | When address translation occurs | | | | (such as the case of a token sent by | | | | the client and replaced with a | | | | proper address by the MMS | | | | Proxy-Relay), both the pre and post | | | | translated addresses (with | | | | appropriate correlation) are | | | | included. | | | | | | | | This parameter is included if the | | | | corresponding MM includes a "TO" | | | | field. | | | | | | | | At least one of the | | | | terminatingMMSParty, cCRecipients, | | | | or bCCRecipients must be included. | | +---------------------+--------------------------------------+-------+ | cCRecipients | Address of a recipient; the \"CC\" | C | | | field may include addresses of | | | | multiple recipients. When address | | | | translation occurs, both the pre and | | | | post translated addresses (with | | | | appropriate correlation) are | | | | included. This parameter is included | | | | if the corresponding MM includes a | | | | \"CC\" field. | | | | | | | | At least one of the | | | | terminatingMMSParty, cCRecipients, | | | | or bCCRecipients must be included. | | +---------------------+--------------------------------------+-------+ | bCCRecipients | Address of a recipient; the \"BCC\" | C | | | field may include addresses of | | | | multiple recipients. When address | | | | translation occurs, both the pre and | | | | post translated addresses (with | | | | appropriate correlation) are | | | | included. This parameter is included | | | | if the corresponding MM includes a | | | | "BCC" field. | | | | | | | | At least one of the | | | | terminatingMMSParty, cCRecipients, | | | | or bCCRecipients must be included. | | +---------------------+--------------------------------------+-------+ | direction | Indicates the direction of the MM. | M | | | This shall be encoded as "from | | | | target." | | +---------------------+--------------------------------------+-------+ | subject | The subject of the MM. Include if | C | | | sent to the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | messageClass | Class of the MM. For example, a | C | | | value of \"auto\" is automatically | | | | generated by the UE. If the field is | | | | not present, the class should be | | | | interpreted as \"personal.\" Include | | | | if sent to the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | expiry | Length of time in seconds the MM | M | | | will be stored in MMS Proxy-Relay or | | | | time to delete the MM. The field has | | | | two formats, either absolute or | | | | relative. | | +---------------------+--------------------------------------+-------+ | desiredDeliveryTime | Date and Time of desired delivery. | C | | | Indicates the earliest possible | | | | delivery of the MM to the recipient. | | | | Include if sent to the MMS | | | | Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | priority | Priority of the MM assigned by the | C | | | originator MMS Client. Include if | | | | sent to the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | senderVisibility | An indication that the sender\'s | C | | | address should not be delivered to | | | | the recipient. Sent by the target to | | | | indicate the target\'s visibility to | | | | the other party or if not signalled | | | | by the target and the default is to | | | | not make target visible to the other | | | | party. The values given in | | | | OMA-TS-MMS_ENC [39] clause 7.3.52 | | | | shall be encoded as follows: "Show" | | | | = True, "Hide" = False. Include if | | | | sent to the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | deliveryReport | Specifies whether the originator MM | C | | | UE requests a delivery report from | | | | each recipient. Sent by the target | | | | to indicate the desired delivery | | | | report. The values given in | | | | OMA-TS-MMS_ENC [39] clause | | | | 7.3.13. shall be encoded as follows: | | | | "Yes" = True, "No" = False. Include | | | | if sent to the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | readReport | Specifies whether the originator MM | C | | | UE requests a read report from each | | | | recipient. Sent by the target to | | | | indicate the desired read report. | | | | The values given in OMA-TS-MMS_ENC | | | | [39] clause 7.3.37 shall be | | | | encoded as follows: "Yes" = True, | | | | "No" = False. Include if sent to the | | | | MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | store | Specifies whether the originator MM | C | | | UE wants the submitted MM to be | | | | saved in the user\'s MMBox, in | | | | addition to sending it. Sent by the | | | | target to indicate the MM is to be | | | | stored. The values given in | | | | OMA-TS-MMS_ENC [39] clause 7.3.56 | | | | shall be encoded as follows: "Yes" = | | | | True, "No" = False. Include if sent | | | | to the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+
+--------------------+-------------------------------------------+---+ | state | Identifies the value of the MM State | C | | | associated with a to be stored or stored | | | | MM. See OMA-TS-MMS_ENC [39] clause | | | | 7.3.33. Include if sent to the MMS | | | | Proxy-Relay. | | +--------------------+-------------------------------------------+---+ | flags | Identifies a keyword to add or remove | C | | | from the list of keywords associated with | | | | a stored MM. See OMA-TS-MMS_ENC [39] | | | | clause 7.3.32. Include if sent to the MMS | | | | Proxy-Relay. | | +--------------------+-------------------------------------------+---+ | replyCharging | If this field is present its value is set | C | | | to "accepted" or "accepted text only" and | | | | the MMS-version-value of the | | | | M-Notification.ind PDU is higher than | | | | 1.0, this header field will indicate that | | | | a reply to this particular MM is free of | | | | charge for the recipient. | | | | | | | | If the Reply-Charging service is offered | | | | and the request for reply-charging has | | | | been accepted by the MMS service provider | | | | the value of this header field SHALL be | | | | set to "accepted" or "accepted text | | | | only". | | | | | | | | See OMA-TS-MMS_ENC [39] clause 7.3.43. | | | | Include if sent to the MMS Proxy-Relay. | | +--------------------+-------------------------------------------+---+ | applicID | Identification of the originating | C | | | application of the original MM. Sent by | | | | the target to identify the destination | | | | application as defined in OMA-TS-MMS_ENC | | | | [39] clause 7.3.2. Include if sent to | | | | the MMS Proxy-Relay. | | +--------------------+-------------------------------------------+---+ | replyApplicID | Identification of an application to which | C | | | replies, delivery reports, and read | | | | reports are addressed. Sent by the target | | | | to identify the application to which | | | | replies, delivery reports, and read | | | | reports are addressed as defined in | | | | OMA-TS-MMS_ENC [39] clause 7.3.42. | | | | Include if sent to the MMS Proxy-Relay. | | +--------------------+-------------------------------------------+---+ | auxApplicInfo | Auxiliary application addressing | C | | | information as indicated in the original | | | | MM. As defined in OMA-TS-MMS_ENC [39] | | | | clause 7.3.4. Include if sent to the MMS | | | | Proxy-Relay. | | +--------------------+-------------------------------------------+---+ | contentClass | Classifies the content of the MM to the | C | | | smallest content class to which the | | | | message belongs. Sent by the target to | | | | identify the class of the content. See | | | | OMA-TS-MMS_ENC [39] clause 7.3.9. | | | | Include if sent to the MMS Proxy-Relay. | | +--------------------+-------------------------------------------+---+ | dRMContent | Indicates if the MM contains any | C | | | DRM-protected element. Provide when sent | | | | by the target to indicate if the MM | | | | contains any DRM-protected element. The | | | | values given in OMA-TS-MMS_ENC [39] | | | | clause 7.3.16 shall be encoded as | | | | follows: "Yes" = True, "No" = False. | | | | Include if sent to the MMS Proxy-Relay. | | +--------------------+-------------------------------------------+---+ | adaptationAllowed | Provide when sent by the target to | C | | | identify whether the target wishes the MM | | | | to be adapted or not. If overridden, an | | | | indication shall be included in the | | | | parameter. Include if sent to the MMS | | | | Proxy-Relay. | | +--------------------+-------------------------------------------+---+ | contentType | The content type of the MM. See | M | | | OMA-TS-MMS_ENC [39] clause 7.3.11 | | +--------------------+-------------------------------------------+---+ | responseStatus | MMS specific status. See OMA-TS-MMS_ENC | M | | | [39] clause 7.3.48. | | +--------------------+-------------------------------------------+---+ | responseStatusText | Text that qualifies the Response Status. | C | | | Include if sent to the target. As defined | | | | in OMA-TS-MMS_ENC [39] clause 7.3.49. | | | | Include if sent by the MMS Proxy-Relay. | | +--------------------+-------------------------------------------+---+ | messageID | An ID assigned by the MMS Proxy-Relay to | M | | | uniquely identify an MM. As defined in | | | | OMA-TS-MMS_ENC [39] clause 7.3.29. | | +--------------------+-------------------------------------------+---+
#### 7.4.3.2 MMSSendByNonLocalTarget
The IRI-POI in the MMS Proxy-Relay shall generate an xIRI containing an
MMSSendByNonLocalTarget record when the MMS Proxy-Relay receives
_MM4_forward.REQ_ (as defined in TS 23.140 [40] clause 8.4.1) from the non-
local MMS Proxy-Relay, that contains a non-local target ID.
Table 7.4.3-2 contains parameters generated by the IRI-POI, along with
parameters derived from the _MM4_forward.REQ_ message (from the non-local MMS
Proxy-Relay to the local MMS Proxy-Relay).
Table 7.4.3-2: Payload for MMSSendByNonLocalTarget
* * *
Field name Description M/C/O version The version of MM, to include major and
minor version. M transactionID An ID used to correlate an MMS request and
response between the proxies. As defined in TS 23.140 [40] clause 8.4.1.4. M
messageID An ID assigned by the MMS Proxy-Relay to uniquely identify an MM. As
defined in TS 23.140 [40] clause 8.4.1.4. M terminatingMMSParty ID(s) of the
terminating party in one or more of the formats described in 7.4.2.1. M
originatingMMSParty ID(s) of the originating party in one or more of the
formats described in 7.4.2.1. M direction Indicates the direction of the MM.
This shall be encoded as "from target." M contentType The content type of the
MM. See OMA-TS-MMS_ENC [39] clause 7.3.11 M messageClass Class of the MM. For
example, a value of \"auto\" is automatically generated by the UE. If the
field is not present, the class should be interpreted as \"personal.\" Include
if sent to the MMS Proxy-Relay. C dateTime Date and Time when the MM was last
handled (either originated or forwarded). M expiry Length of time in seconds
the MM will be stored in MMS Proxy-Relay or time to delete the MM. The field
has two formats, either absolute or relative. Include if sent to the MMS
Proxy-Relay. C deliveryReport Specifies whether the originator MM UE requests
a delivery report from each recipient. Indicates the desired delivery report.
The values given in TS 23.140 [40] clause 8.4.1.4 shall be encoded as follows:
"Yes" = True, "No" = False. Included if it exists in the MMS Proxy-Relay
message. Include if sent to the MMS Proxy-Relay. C priority Priority of the MM
assigned by the originator MMS Client. Reported if sent by the target. Include
if sent to the MMS Proxy-Relay. C senderVisibility An indication that the
sender\'s address should not be delivered to the recipient. Indicates the
target\'s visibility to the other party or if not signalled by the target and
the default is to not make target visible to the other party. The values given
in TS 23.140 [40] clause 8.4.1.4 shall be encoded as follows: "Show" = True,
"Hide" = False. Include if sent to the MMS Proxy-Relay. C readReport Specifies
whether the originator MM UE requests a read report from each recipient.
Provide when sent by the target to indicate the desired read report. The
values given in TS 23.140 [40] clause 8.4.1.4 shall be encoded as follows:
"Yes" = True, "No" = False. Include if sent to the MMS Proxy-Relay. C subject
The subject of the MM. Include if sent by the target. C forwardCount The
number of times the MM was forwarded C previouslySentBy History of UEs that
have forwarded (including originally submitted) the MM. Include if sent to the
MMS Proxy-Relay. C previouslySentByDateTime The timestamp associated with the
previous forward events. Include if sent to the MMS Proxy-Relay. C applicID
Identification of the originating application of the original MM. Provide when
sent by the target to identify the destination application as defined in TS
23.140 [40] clause 8.4.1.4. Include if sent to the MMS Proxy-Relay. C
replyApplicID Identification of an application to which replies, delivery
reports, and read reports are addressed. Provide when sent by the target to
identify the application to which replies, delivery reports, and read reports
are addressed as defined in TS 23.140 [40] clause 8.4.1.4. Include if sent to
the MMS Proxy-Relay. C auxApplicInfo Auxiliary application addressing
information as indicated in the original MM. As defined in OMA-TS-MMS_ENC [39]
clause 7.3.4. Include if sent to the MMS Proxy-Relay. C contentClass
Classifies the content of the MM to the smallest content class to which the
message belongs. Identifies the class of the content. Include if sent to the
MMS Proxy-Relay. Include if sent to the MMS Proxy-Relay. C dRMContent
Indicates if the MM contains any DRM-protected element. Indicates if the MM
contains any DRM-protected element. The values given as defined in TS 23.140
[40] clause 8.4.1.4 shall be encoded as follows: "Yes" = True, "No" = False.
Include if sent to the MMS Proxy-Relay. C adaptationAllowed Identifies whether
the target wishes the MM to be adapted or not. If overridden, an indication
shall be included in the parameter. Include if sent to the MMS Proxy-Relay. C
* * *
#### 7.4.3.3 MMSNotification
The IRI-POI in the MMS Proxy-Relay shall generate an xIRI containing an
MMSNotification record when the MMS Proxy-Relay sends a _m-notification-ind_
(as defined in OMA-TS-MMS_ENC [39] clause 6.2) to the MMS client in the local
target UE.
Table 7.4.3-3 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-notification-ind_ message (from the local MMS
Proxy-Relay to the local target).
Table 7.4.3-3: Payload for MMSNotification
+-------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-------------------------+-----------------------------+-------+ | transactionID | An ID used to correlate an | M | | | MMS request and response | | | | between the target and the | | | | MMS Proxy-Relay. As defined | | | | in OMA-TS-MMS_ENC[ AA] | | | | clause 7.3.63. | | +-------------------------+-----------------------------+-------+ | version | The version of MM, to | M | | | include major and minor | | | | version. | | +-------------------------+-----------------------------+-------+ | originatingMMSParty | ID(s) of the originating | C | | | party in one or more of the | | | | formats described in | | | | 7.4.2.1 | | | | | | | | When address translation | | | | occurs (such as the case of | | | | a token sent by the client | | | | and replaced with a proper | | | | address by the MMS | | | | Proxy-Relay), both the pre | | | | and post translated | | | | addresses (with appropriate | | | | correlation) are included. | | | | | | | | If the originating MMS | | | | client requested address | | | | hiding, but the MMS | | | | Proxy-Relay has access to | | | | the \"From\" field, this | | | | shall be reported, | | | | regardless of the fact that | | | | it may be hidden from the | | | | recepient. | | +-------------------------+-----------------------------+-------+ | direction | Indicates the direction of | M | | | the MM. This shall be | | | | encoded as "to target.\" | | +-------------------------+-----------------------------+-------+ | subject | The subject of the MM. | C | | | Include if sent by the MMS | | | | Proxy-Relay. | | +-------------------------+-----------------------------+-------+ | deliveryReportRequested | Specifies whether the | C | | | originator MMS UE requests | | | | a delivery report from each | | | | recipient. The values given | | | | in OMA-TS-MMS_ENC [39] | | | | clause 7.3.13 shall be | | | | encoded as follows: "Yes" = | | | | True, "No" = False. Include | | | | if sent by the MMS | | | | Proxy-Relay. | | +-------------------------+-----------------------------+-------+ | stored | Specifies whether the MM | C | | | was stored in the target\'s | | | | MMBox, and that the | | | | _content-location-value_ | | | | field is a reference to it. | | | | \"Stored\" is coded as | | | | True, and \"not Stored\" is | | | | coded as False. As defined | | | | in OMA-TS-MMS_ENC [39] | | | | clause 7.3.57. | | | | | | | | Include if sent by the MMS | | | | Proxy-Relay. | | +-------------------------+-----------------------------+-------+ | messageClass | Class of the MM. For | M | | | example, a value of | | | | \"auto\" is automatically | | | | generated by the UE. | | +-------------------------+-----------------------------+-------+ | priority | Priority of the MM assigned | C | | | by the originator MMS | | | | Client. Include if sent by | | | | the MMS Proxy-Relay. | | +-------------------------+-----------------------------+-------+ | messageSize | Specifies the size of the | M | | | MM that was viewed or | | | | uploaded. Specified in | | | | bytes. | | +-------------------------+-----------------------------+-------+ | expiry | Length of time in seconds | M | | | the MM will be stored in | | | | MMS Proxy-Relay or time to | | | | delete the MM. The field | | | | has two formats, either | | | | absolute or relative. | | +-------------------------+-----------------------------+-------+ | replyCharging | If this field is present | C | | | its value is set to | | | | "accepted" or "accepted | | | | text only" and the | | | | MMS-version-value of the | | | | M-Notification.ind PDU is | | | | higher than 1.0, this | | | | header field will indicate | | | | that a reply to this | | | | particular MM is free of | | | | charge for the recipient. | | | | | | | | If the Reply-Charging | | | | service is offered and the | | | | request for reply-charging | | | | has been accepted by the | | | | MMS service provider the | | | | value of this header field | | | | SHALL be set to "accepted" | | | | or "accepted text only". | | | | | | | | See OMA-TS-MMS_ENC [39] | | | | clause 7.3.43. Include if | | | | sent by the MMS | | | | Proxy-Relay. | | +-------------------------+-----------------------------+-------+
#### 7.4.3.4 MMSSendToNonLocalTarget
The IRI-POI in the MMS Proxy-Relay shall generate an xIRI containing an
MMSSendToNonLocalTarget record when the local MMS Proxy-Relay sends a
_MM4_forward.REQ_ (as defined in TS 23.140 [40] clause 8.4.1) to the non-local
MMS Proxy-Relay, that contains a non-local target ID.
Table 7.4.3-4 contains parameters generated by the IRI-POI, along with
parameters derived from the _MM4_forward.REQ_ message (from the non-local MMS
Proxy-Relay to the local MMS Proxy-Relay).
Table 7.4.3-4: Payload for MMSSendToNonLocalTarget
* * *
Field name Description M/C/O version The version of MM, to include major and
minor version. M transactionID An ID used to correlate an MMS request and
response between the proxies. As defined in TS 23.140 [40] clause 8.4.1.4. M
messageID An ID assigned by the MMS Proxy-Relay to uniquely identify an MM. As
defined in TS 23.140 [40] clause 8.4.1.4. M terminatingMMSParty ID(s) of the
terminating party in one or more of the formats described in 7.4.2.1. M
originatingMMSParty ID(s) of the originating party in one or more of the
formats described in 7.4.2.1. M direction Indicates the direction of the MM.
This shall be encoded as "to target." M contentType The content type of the
MM. See OMA-TS-MMS_ENC [39] clause 7.3.11 M messageClass Class of the MM. For
example, a value of \"auto\" is automatically generated by the UE. If the
field is not present, the class should be interpreted as \"personal.\" Include
if sent by the MMS Proxy-Relay message. C dateTime Date and Time when the MM
was last handled (either originated or forwarded). M expiry Length of time in
seconds the MM will be stored in MMS Proxy-Relay or time to delete the MM. The
field has two formats, either absolute or relative. Include if sent by the MMS
Proxy-Relay message. C deliveryReportRequested Specifies whether the
originator MMS UE requests a delivery report from each recipient. Indicates
the desired delivery report. The values given in TS 23.140 [40] clause 8.4.1.4
shall be encoded as follows: "Yes" = True, "No" = False. Include if sent by
the MMS Proxy-Relay message. C priority Priority of the MM assigned by the
originator MMS Client. Reported if sent by the target. Include if sent by the
MMS Proxy-Relay message. C senderVisibility Indicates whether the sender\'s
address should not be delivered to the recipient. Indicates the target\'s
visibility to the other party or if not signalled by the target and the
default is to not make target visible to the other party. The values given in
TS 23.140 [40] clause 8.4.1.4 shall be encoded as follows: "Show" = True,
"Hide" = False. Include if sent by the MMS Proxy-Relay message. C readReport
Specifies whether the originator MMS UE requests a read report from each
recipient. Indicates the desired read report. The values given in TS 23.140
[40] clause 8.4.1.4 shall be encoded as follows: "Yes" = True, "No" = False.
Include if sent by the MMS Proxy-Relay message. C subject The subject of the
MM. Include if sent to the target. C forwardCount The number of times the MM
was forwarded C previouslySentBy History of UEs that have forwarded (including
originally submitted) the MM. Include if sent by the MMS Proxy-Relay message.
C previouslySentByDateTime The timestamp associated with the previous forward
events. Include if sent by the MMS Proxy-Relay message. C applicID
Identification of the originating application of the original MM. Provide when
sent by the target to identify the destination application as defined in TS
23.140 [40] clause 8.4.1.4. Include if sent by the MMS Proxy-Relay message. C
replyApplicID Identification of an application to which replies, delivery
reports, and read reports are addressed. Identifies the application to which
replies, delivery reports, and read reports are addressed as defined in TS
23.140 [40] clause 8.4.1.4. Include if sent by the MMS Proxy-Relay message. C
auxApplicInfo Auxiliary application addressing information as indicated in the
original MM. As defined in OMA-TS-MMS_ENC [39] clause 7.3.4. Include if sent
by the MMS Proxy-Relay message. C contentClass Classifies the content of the
MM to the smallest content class to which the message belongs. Identifies the
class of the content. Include if sent by the MMS Proxy-Relay message. C
dRMContent Indicates if the MM contains any DRM-protected element. Indicates
if the MM contains any DRM-protected element. The values given as defined in
TS 23.140 [40] clause 8.4.1.4 shall be encoded as follows: "Yes" = True, "No"
= False. Include if sent by the MMS Proxy-Relay message. C adaptationAllowed
identifies whether the target wishes the MM to be adapted or not. If
overridden, an indication shall be included in the parameter. Include if sent
by the MMS Proxy-Relay message. C store Specifies whether the originator MMS
UE wants the submitted MM to be saved in the user\'s MMBox, in addition to
sending it. Indicates whether the MMS is to be stored. The values given in TS
23.140 [40] clause 8.4.1.4 shall be encoded as follows: "Yes" = True, "No" =
False. Include if sent by the MMS Proxy-Relay message. C
* * *
* * *
applicID Identification of the originating application of the original MM.
Identifies the destination application as defined in TS 23.140 [40] clause
8.4.1.4. Include if sent by the MMS Proxy-Relay message. C replyApplicID
Identification of an application to which replies, delivery reports, and read
reports are addressed. Identifies the application to which replies, delivery
reports, and read reports are addressed as defined in TS 23.140 [40] clause
8.4.1.4. Include if sent by the MMS Proxy-Relay message. C auxApplicInfo
Auxiliary application addressing information as indicated in the original MM.
As defined in OMA-TS-MMS_ENC [39] clause 7.3.4. Include if sent by the MMS
Proxy-Relay message. C contentClass Classifies the content of the MM to the
smallest content class to which the message belongs. Identifies the class of
the content. Include if sent by the MMS Proxy-Relay message. C dRMContent
Indicates if the MM contains any DRM-protected element. Indicates whether the
MM contains any DRM-protected element. The values given as defined in TS
23.140 [40] clause 8.4.1.4 shall be encoded as follows: "Yes" = True, "No" =
False. Include if sent by the MMS Proxy-Relay message. C
* * *
#### 7.4.3.5 MMSNotificationResponse
The IRI-POI in the MMS Proxy-Relay shall generate an xIRI containing an
MMSNotificationResponse record when the MMS Proxy-Relay receives a _m-
notifyresp-ind_ (as defined in OMA-TS-MMS_ENC [39] clause 6.2, table 4) from
the MMS client in the target UE for the deferred retrieval case only. The
immediate retrieval trigger on _m-notifyresp-ind_ is in clause 7.4.3.7.
Table 7.4.3-5 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-notifyresp-ind_ message (from the local target
UE to the MMS Proxy-Relay).
Table 7.4.3-5: Payload for MMSNotificationResponse
* * *
Field name Description M/C/O transactionID An ID used to correlate an MMS
request and response between the target and the MMS Proxy-Relay. As defined in
OMA-TS-MMS_ENC [39] clause 7.3.63. M version The version of MM, to include
major and minor version. M direction Indicates the direction of the MM. This
shall be encoded as "to target" M status Provides a MM status. A status of
\"retrieved\" is only signalled by the retrieving UE after retrieval of the
MM. M reportAllowed Indication whether or not the sending of delivery report
is allowed by the recipient MMS Client. The values given in OMA-TS-MMS_ENC
[39] clause 7.3.47 shall be encoded as follows: "Yes" = True, "No" = False.
Include if sent to the MMS Proxy-Relay. C
* * *
#### 7.4.3.6 MMSRetrieval
The IRI-POI in the MMS Proxy-Relay shall generate an xIRI containing an
MMSRetrieval record when the MMS Proxy-Relay sends a _m-retrieve-conf_ (as
defined in OMA-TS-MMS_ENC [39] clause 6.3) to the MMS client in the target UE.
Table 7.4.3-6 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-retrieve-conf_ message (from the MMS Proxy-
Relay to the local target UE).
Table 7.4.3-6: Payload for MMSRetrieval
+--------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +--------------------------+-----------------------------+-------+ | transactionID | An ID used to correlate an | M | | | MMS request and response | | | | between the target and the | | | | MMS Proxy-Relay. As defined | | | | in OMA-TS-MMS_ENC [39] | | | | clause 7.3.63. | | +--------------------------+-----------------------------+-------+ | version | The version of MM, to | M | | | include major and minor | | | | version. | | +--------------------------+-----------------------------+-------+ | messageID | An ID assigned by the MMS | M | | | Proxy-Relay to uniquely | | | | identify an MM. As defined | | | | in OMA-TS-MMS_ENC [39] | | | | clause 7.3.29. | | +--------------------------+-----------------------------+-------+ | dateTime | Date and Time when the MM | M | | | was last handled (either | | | | originated or forwarded). | | | | For origination, included | | | | by the sending MMS client | | | | or the originating MMS | | | | Proxy-Relay. | | +--------------------------+-----------------------------+-------+ | originatingMMSParty | ID(s) of the originating | C | | | party in one or more of the | | | | formats described in | | | | 7.4.2.1 | | | | | | | | When address translation | | | | occurs (such as the case of | | | | a token sent by the client | | | | and replaced with a proper | | | | address by the MMS | | | | Proxy-Relay), both the pre | | | | and post translated | | | | addresses (with appropriate | | | | correlation) are included. | | | | Include if sent by the MMS | | | | Proxy-Relay. | | +--------------------------+-----------------------------+-------+ | previouslySentBy | History of UEs that have | C | | | forwarded (including | | | | originally submitted) the | | | | MM. Include if sent by the | | | | MMS Proxy-Relay. | | +--------------------------+-----------------------------+-------+ | previouslySentByDateTime | The timestamp associated | C | | | with the previous forward | | | | events. Include if sent by | | | | the MMS Proxy-Relay. | | +--------------------------+-----------------------------+-------+ | terminatingMMSParty | ID(s) of the terminating | C | | | party in one or more of the | | | | formats described in | | | | 7.4.2.1 | | | | | | | | When address translation | | | | occurs (such as the case of | | | | a token sent by the client | | | | and replaced with a proper | | | | address by the MMS | | | | Proxy-Relay), both the pre | | | | and post translated | | | | addresses (with appropriate | | | | correlation) are included. | | | | Include if sent by the MMS | | | | Proxy-Relay. | | | | | | | | At least one of the | | | | terminatingMMSParty or | | | | cCRecipients must be | | | | included. | | +--------------------------+-----------------------------+-------+ | cCRecipients | Address of a recipient; the | C | | | \"CC\" field may include | | | | addresses of multiple | | | | recipients. When address | | | | translation occurs, both | | | | the pre and post translated | | | | addresses (with appropriate | | | | correlation) are included. | | | | Include if sent by the MMS | | | | Proxy-Relay. | | | | | | | | At least one of the | | | | terminatingMMSParty or | | | | cCRecipients must be | | | | included. | | +--------------------------+-----------------------------+-------+ | direction | Indicates the direction of | M | | | the MM. This shall be | | | | encoded as "to target," or | | | | \"fromTarget,\" as | | | | appropriate. | | +--------------------------+-----------------------------+-------+ | subject | The subject of the MM. | C | | | Include if sent by the MMS | | | | Proxy-Relay. | | +--------------------------+-----------------------------+-------+ | state | Identifies the value of the | C | | | MM State associated with a | | | | to be stored or stored MM. | | | | See OMA-TS-MMS_ENC [39] | | | | clause 7.3.33. Include if | | | | sent by the MMS | | | | Proxy-Relay. | | +--------------------------+-----------------------------+-------+ | flags | Identifies a keyword to add | C | | | or remove from the list of | | | | keywords associated with a | | | | stored MM. Include if sent. | | | | See OMA-TS-MMS_ENC [39] | | | | clause 7.3.32. Include if | | | | sent by the MMS | | | | Proxy-Relay. | | +--------------------------+-----------------------------+-------+ | messageClass | Class of the MM. For | C | | | example, a value of | | | | \"auto\" is automatically | | | | generated by the UE. If the | | | | field is not present, the | | | | class should be interpreted | | | | as \"personal.\" Include if | | | | sent by the MMS | | | | Proxy-Relay. | | +--------------------------+-----------------------------+-------+ | priority | Priority of the MM assigned | C | | | by the originator MMS | | | | Client. Include if sent by | | | | the MMS Proxy-Relay. | | +--------------------------+-----------------------------+-------+ | deliveryReport | Specifies whether the | C | | | originator MM UE requests a | | | | delivery report from each | | | | recipient. Indicates | | | | whether a delivery report | | | | is desired. The values | | | | given in OMA-TS-MMS_ENC | | | | [39] clause 7.3.13. shall | | | | be encoded as follows: | | | | "Yes" = True, "No" = False. | | | | Include if sent by the MMS | | | | Proxy-Relay. | | +--------------------------+-----------------------------+-------+ | readReport | Specifies whether the | C | | | originator MM UE requests a | | | | read report from each | | | | recipient. Indicates | | | | whether a read report is | | | | desired. The values given | | | | in OMA-TS-MMS_ENC [39] | | | | clause 7.3.37 shall be | | | | encoded as follows: "Yes" = | | | | True, "No" = False. Include | | | | if sent by the MMS | | | | Proxy-Relay. | | +--------------------------+-----------------------------+-------+ | replyCharging | If this field is present | C | | | its value is set to | | | | "accepted" or "accepted | | | | text only" and the | | | | MMS-version-value of the | | | | PDU is higher than 1.0, | | | | this header field will | | | | indicate that a reply to | | | | this particular MM is free | | | | of charge for the | | | | recipient. | | | | | | | | If the Reply-Charging | | | | service is offered and the | | | | request for reply-charging | | | | has been accepted by the | | | | MMS service provider the | | | | value of this header field | | | | SHALL be set to "accepted" | | | | or "accepted text only". | | | | | | | | See OMA-TS-MMS_ENC [39] | | | | clause 7.3.43. Include if | | | | sent by the MMS | | | | Proxy-Relay. | | +--------------------------+-----------------------------+-------+ | retrieveStatus | MMS specific status. It is | C | | | used by the recipient MMS | | | | Proxy-Relay to inform the | | | | recipient MMS Client about | | | | errors, if any that | | | | occurred during the | | | | preceding retrieval | | | | operation. Include if sent | | | | by the MMS Proxy-Relay. | | +--------------------------+-----------------------------+-------+ | retrieveStatusText | Text that qualifies the | C | | | Retrieve Status. As defined | | | | in OMA-TS-MMS_ENC [39] | | | | clause 7.3.55. Include if | | | | sent by the MMS | | | | Proxy-Relay. | | +--------------------------+-----------------------------+-------+
* * *
applicID Identification of the originating application of the original MM.
Sent by the target to identify the destination application as defined in OMA-
TS-MMS_ENC [39] clause 7.3.2. Include if sent by the MMS Proxy-Relay. C
replyApplicID Identification of an application to which replies, delivery
reports, and read reports are addressed. Sent by the target to identify the
application to which replies, delivery reports, and read reports are addressed
as defined in OMA-TS-MMS_ENC [39] clause 7.3.42. Include if sent by the MMS
Proxy-Relay. C auxApplicInfo Auxiliary application addressing information as
indicated in the original MM. As defined in OMA-TS-MMS_ENC [39] clause 7.3.4.
Include if sent by the MMS Proxy-Relay. C contentClass Classifies the content
of the MM to the smallest content class to which the message belongs. Sent by
the target to identify the class of the content. See OMA-TS-MMS_ENC [39]
clause 7.3.9. Include if sent by the MMS Proxy-Relay. C dRMContent Indicates
if the MM contains any DRM-protected element. Provide when sent by the target
to indicate if the MM contains any DRM-protected element. The values given in
OMA-TS-MMS_ENC [39] clause 7.3.16 shall be encoded as follows: "Yes" = True,
"No" = False. Include if sent by the MMS Proxy-Relay. C replaceID Indicates
the message ID of the message this one is intended to replace. Include if sent
by the MMS Proxy-Relay. C contentType The content type of the MM. See OMA-TS-
MMS_ENC [39] clause 7.3.11. M
* * *
#### 7.4.3.7 MMSDeliveryAck
The IRI-POI in the MMS Proxy-Relay shall generate an xIRI containing an
MMSDeliveryAck record when:
\- the MMS Proxy-Relay receives an m-acknowledge-ind (as defined in OMA-TS-
MMS_ENC [39] clause 6.4) from the MMS client in the target UE (for deferred
retrieval), or
\- the MMS Proxy-Relay receives an m-notifyresp-ind (as defined in OMA-TS-
MMS_ENC [39] clause 6.4) from the MMS client in the target UE (for immediate
retrieval).
Table 7.4.3-7 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-acknowledge-ind_ message (from the local target
UE to the MMS Proxy-Relay), and the _m-notifyresp-ind_ message (from the local
target UE to the MMS Proxy-Relay).
Table 7.4.3-7: Payload for MMSDeliveryAck
* * *
Field name Description M/C/O transactionID An ID used to correlate an MMS
request and response between the target and the MMS Proxy-Relay. As defined in
OMA-TS-MMS_ENC [39] clause 7.3.63. M version The version of MM, to include
major and minor version. M reportAllowed Indicates whether the target allows
sending of a delivery report. Encoded as \"Yes\" = True, \"No\" = False.
Include if received by the MMS Proxy-Relay. C status Provides a MM status. A
status of \"retrieved\" is only signalled by the retrieving UE after retrieval
of the MM. Include if received by the MMS Proxy-Relay and if generated from a
**_m-notifyresp-ind_**. C direction Indicates the direction of the MM. This
shall be encoded as "to target." M
* * *
#### 7.4.3.8 MMSForward
The IRI-POI in the MMS Proxy-Relay shall generate an xIRI containing an
MMSForward record when the MMS Proxy-Relay sends an _m-forward-conf_ (as
defined in OMA-TS-MMS_ENC [39] clause 6.5.2) to the MMS client in the target
UE.
Table 7.4.3-8 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-forward-req_ message (from the local target UE
to the MMS Proxy-Relay), and the _m-forward-conf_ message (from the MMS Proxy-
Relay to the local target UE).
Table 7.4.3-8: Payload for MMSForward
+-----------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------+-----------------------------+-------+ | transactionID | An ID used to correlate an | M | | | MMS request and response | | | | between the target and the | | | | MMS Proxy-Relay. As defined | | | | in OMA-TS-MMS_ENC [39] | | | | clause 7.3.63. | | +-----------------------+-----------------------------+-------+ | version | The version of MM, to | M | | | include major and minor | | | | version. | | +-----------------------+-----------------------------+-------+ | dateTime | Date and Time when the MM | C | | | was last handled (either | | | | originated or forwarded). | | | | For origination, included | | | | by the sending MMS client | | | | or the originating MMS | | | | Proxy-Relay. Include if | | | | sent to the MMS | | | | Proxy-Relay. | | +-----------------------+-----------------------------+-------+ | originatingMMSParty | ID(s) of the originating | M | | | (forwarding) party in one | | | | or more of the formats | | | | described in 7.4.2.1 | | | | | | | | When address translation | | | | occurs (such as the case of | | | | a token sent by the client | | | | and replaced with a proper | | | | address to the MMS | | | | Proxy-Relay), both the pre | | | | and post translated | | | | addresses (with appropriate | | | | correlation) are included. | | +-----------------------+-----------------------------+-------+ | terminatingMMSParty | ID(s) of the terminating | C | | | party in one or more of the | | | | formats described in | | | | 7.4.2.1 | | | | | | | | When address translation | | | | occurs (such as the case of | | | | a token sent by the client | | | | and replaced with a proper | | | | address by the MMS | | | | Proxy-Relay), both the pre | | | | and post translated | | | | addresses (with appropriate | | | | correlation) are included. | | | | Include if sent to the MMS | | | | Proxy-Relay. | | | | | | | | At least one of the | | | | terminatingMMSParty, | | | | cCRecipients, or | | | | bCCRecipients must be | | | | included. | | +-----------------------+-----------------------------+-------+ | cCRecipients | Address of a recipient; the | C | | | \"CC\" field may include | | | | addresses of multiple | | | | recipients. When address | | | | translation occurs, both | | | | the pre and post translated | | | | addresses (with appropriate | | | | correlation) are included. | | | | This parameter is included | | | | if the corresponding MM | | | | includes a \"CC\" field. | | | | Include if sent to the MMS | | | | Proxy-Relay. | | | | | | | | At least one of the | | | | terminatingMMSParty, | | | | cCRecipients, or | | | | bCCRecipients must be | | | | included. | | +-----------------------+-----------------------------+-------+ | bCCRecipients | Address of a recipient; the | C | | | \"BCC\" field may include | | | | addresses of multiple | | | | recipients. When address | | | | translation occurs, both | | | | the pre and post translated | | | | addresses (with appropriate | | | | correlation) are included. | | | | This parameter is included | | | | if the corresponding MM | | | | includes a "BCC" field. | | | | Include if sent to the MMS | | | | Proxy-Relay. | | | | | | | | At least one of the | | | | terminatingMMSParty, | | | | cCRecipients, or | | | | bCCRecipients must be | | | | included. | | +-----------------------+-----------------------------+-------+ | direction | Indicates the direction of | M | | | the MM. This shall be | | | | encoded as "from target." | | +-----------------------+-----------------------------+-------+ | expiry | Length of time in seconds | C | | | the MM will be stored in | | | | MMS Proxy-Relay or time to | | | | delete the MM. The field | | | | has two formats, either | | | | absolute or relative. | | | | Include either the | | | | signalled expiry or the | | | | default, whichever applies. | | | | Include if sent to the MMS | | | | Proxy-Relay. | | +-----------------------+-----------------------------+-------+ | desiredDeliveryTime | Date and Time of desired | C | | | delivery. Indicates the | | | | earliest possible delivery | | | | of the MM to the recipient. | | | | Include if sent to the MMS | | | | Proxy-Relay. | | +-----------------------+-----------------------------+-------+ | deliveryReportAllowed | An indication that the | C | | | target requested reporting | | | | to the original sender or | | | | the default, whichever | | | | applies. The values given | | | | in OMA-TS-MMS_ENC [39] | | | | clause 7.3.47 shall be | | | | encoded as follows: "Yes" = | | | | True, "No" = False. Include | | | | if sent to the MMS | | | | Proxy-Relay. | | +-----------------------+-----------------------------+-------+ | deliveryReport | Specifies whether the | C | | | originator MMS UE requests | | | | a delivery report from each | | | | recipient. The values given | | | | in OMA-TS-MMS_ENC [39] | | | | clause 7.3.13. shall be | | | | encoded as follows: "Yes" = | | | | True, "No" = False. Include | | | | if sent to the MMS | | | | Proxy-Relay. | | +-----------------------+-----------------------------+-------+ | store | Specifies whether the | C | | | originator MMS UE wants the | | | | submitted MM to be saved in | | | | the user\'s MMBox, in | | | | addition to sending it. | | | | Sent by the target to have | | | | the forwarded MM stored. | | | | The values given in | | | | OMA-TS-MMS_ENC [39] | | | | clause 7.3.56 shall be | | | | encoded as follows: "Yes" = | | | | True, "No" = False. Include | | | | if sent to the MMS | | | | Proxy-Relay. | | +-----------------------+-----------------------------+-------+ | state | Identifies the value of the | C | | | MM State associated with a | | | | MM to be stored or stored | | | | MM. Sets the state for the | | | | forwarded MM when it is | | | | stored. As defined in | | | | OMA-TS-MMS_ENC [39] | | | | clause 7.3.33. Include if | | | | sent to the MMS | | | | Proxy-Relay. | | +-----------------------+-----------------------------+-------+
+---------------------+------------------------------------------+---+ | flags | Identifies a keyword to add or remove | C | | | from the list of keywords associated | | | | with a stored MM. Include if sent to the | | | | MMS Proxy-relay. See OMA-TS-MMS_ENC | | | | [39] clause 7.3.32. | | +---------------------+------------------------------------------+---+ | contentLocationReq | The content-location-value field defines | M | | | the URL for the MMS server location of | | | | the content to be retrieved as it | | | | appears in the m-forward-req. As defined | | | | in OMA-TS-MMS_ENC [39] clause 7.3.10. | | +---------------------+------------------------------------------+---+ | replyCharging | If this field is present its value is | C | | | set to "accepted\" or "accepted text | | | | only" and the MMS-version-value is | | | | higher than 1.0, this header field will | | | | indicate that a reply to this particular | | | | MM is free of charge for the recipient. | | | | | | | | If the Reply-Charging service is offered | | | | and the request for reply-charging has | | | | been accepted by the MMS service | | | | provider the value of this header field | | | | SHALL be set to "accepted\" or "accepted | | | | text only". | | | | | | | | See OMA-TS-MMS_ENC [39] clause | | | | 7.3.43. Include if sent to the MMS | | | | Proxy-Relay. | | +---------------------+------------------------------------------+---+ | responseStatus | MMS specific status. See OMA-TS-MMS_ENC | M | | | [39] clause 7.3.48. | | +---------------------+------------------------------------------+---+ | responseStatusText | Text that qualifies the Response Status. | C | | | Include if sent to the target. As | | | | defined in OMA-TS-MMS_ENC [39] clause | | | | 7.3.49. Include if sent by the MMS | | | | Proxy-Relay. | | +---------------------+------------------------------------------+---+ | messageID | An ID assigned by the MMS Proxy-Relay to | C | | | uniquely identify an MM. As defined in | | | | OMA-TS-MMS_ENC [39] clause 7.3.29. | | | | Include if sent by the MMS Proxy-Relay. | | +---------------------+------------------------------------------+---+ | contentLocationConf | The _content-location-value_ field | C | | | defines the URL for the MMS server | | | | location of the MM as it appears in the | | | | _m-forward-conf_. As defined in | | | | OMA-TS-MMS_ENC [39] clause 7.3.10. | | | | Include if sent by the MMS Proxy-Relay. | | +---------------------+------------------------------------------+---+ | storeStatus | Indicates if the MM was successfully | C | | | stored in the MMBox. Include if sent by | | | | the MMS Proxy-Relay. | | +---------------------+------------------------------------------+---+ | storeStatusText | Text that qualifies the Store Status. As | C | | | defined in OMA-TS-MMS_ENC [39] clause | | | | 7.3.59. Include if sent by the MMS | | | | Proxy-Relay. | | +---------------------+------------------------------------------+---+
#### 7.4.3.9 MMSDeleteFromRelay
The IRI-POI present in the MMS Proxy-Relay shall generate an xIRI containing
an MMSDeleteFromRelay record when the MMS Proxy-Relay sends a _m-delete-conf_
(defined in OMA-TS-MMS_ENC [39]) to the MMS client in the target UE.
Table 7.4.3-9 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-delete-req_ message (from the local target UE
to the MMS Proxy-Relay), and the _m-delete-conf_ message (from the MMS Proxy-
Relay to the local target UE).
Table 7.4.3-9: Payload for MMSDeleteFromRelay
* * *
Field name Description M/C/O transactionID An ID used to correlate an MMS
request and response between the target and the MMS Proxy-Relay. M version The
version of MM, to include major and minor version. M direction Indicates the
direction of the MM. This shall be encoded as "to target," or \"fromTarget,\"
as appropriate. M contentLocationReq The _content-location-value_ field
defines the URL for the MMS server location of the MM as it appears in the _m-
delete-conf,_ as defined in OMA-TS-MMS_ENC [39] clause 7.3.10. Include if sent
to the MMS Proxy-Relay. M contentLocationConf The _content-location-value_
field defines the URL for the MMS server location of the MM as it appears in
the _m-delete-conf_ , as defined in OMA-TS-MMS_ENC [39] clause 7.3.10. Include
if sent by the MMS Proxy-Relay. C deleteResponseStatus The delete response, as
defined in OMA-TS-MMS_ENC [39] clause 7.3.48. M deleteResponseText The delete
response, as defined in OMA-TS-MMS_ENC [39] clause 7.3.49. Include if sent by
the MMS Proxy-Relay. C
* * *
#### 7.4.3.10 MMSMBoxStore
The IRI-POI in the MMS Proxy-Relay shall generate an xIRI containing an
MMSMBoxStore record when the MMS Proxy-Relay sends a m-mbox-store-conf
(defined in OMA-TS-MMS_ENC [39] clause 6.8) to the MMS client in the target
UE.
Table 7.4.3-10 contains parameters generated by the IRI-POI, along with
parameters derived from the m-mbox-store-req message (from the local target UE
to the MMS Proxy-Relay), and from the _m-mbox-store-conf_ message (from the
MMS Proxy-Relay to the local target UE).
Table 7.4.3-10: Payload for MMSMBoxStore
* * *
Field name Description M/C/O transactionID An ID used to correlate an MMS
request and response between the target and the MMS Proxy-Relay. As defined in
OMA-TS-MMS_ENC [39] clause 7.3.63. M version The version of MM, to include
major and minor version. M direction Indicates the direction of the MM. This
shall be encoded as "to target." M contentLocationReq The _content-location-
value_ field defines the URL for the MMS server location of the MM as it
appears in the _m-mbox-store-req_. As defined in OMA-TS-MMS_ENC [39] clause
7.3.10. Include if sent by the MMS Proxy-Relay. M state Identifies the value
of the MM State associated with a MM to be stored or stored MM. Sets the state
for the forwarded MM when it is stored. As defined in OMA-TS-MMS_ENC [39]
clause 7.3.33. Include if sent by the MMS Proxy-Relay. C flags Identifies a
keyword to add or remove from the list of keywords associated with a stored
MM. See OMA-TS-MMS_ENC [39] clause 7.3.32. Include if sent by the MMS Proxy-
Relay. C contentLocationConf The _content-location-value_ field defines the
URL for the MMS server location of the MM as it appears in the _m-mbox-store-
conf_. As defined in OMA-TS-MMS_ENC [39] clause 7.3.10. Include if sent by the
MMS Proxy-Relay. C storeStatus Indicates if the MM was successfully stored in
the MMBox. M storeStatusText Text that qualifies the Store Status. Include if
sent to the target. As defined in OMA-TS-MMS_ENC [39] clause 7.3.59. Include
if sent by the MMS Proxy-Relay. C
* * *
#### 7.4.3.11 MMSMBoxUpload
The IRI-POI present in the MMS Proxy-Relay shall generate an xIRI containing
an MMSMBoxUpload record when the MMS Proxy-Relay sends a _m-mbox-upload-conf_
(defined in OMA-TS-MMS_ENC [39] clause 6.10) to the MMS client in the target
UE.
Table 7.4.3-11 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-mbox-upload-req_ message (from the local target
UE to the MMS Proxy-Relay), and from the _m-mbox-upload-conf_ message (from
the MMS Proxy-Relay to the local target UE).
Table 7.4.3-11: Payload for MMSMBoxUpload
* * *
Field name Description M/C/O transactionID An ID used to correlate an MMS
request and response between the target and the MMS Proxy-Relay. As defined in
OMA-TS-MMS_ENC [39] clause 7.3.63. M version The version of MM, to include
major and minor version. M direction Indicates the direction of the MM. This
shall be encoded as "to target," or \"fromTarget,\" as appropriate. M state
Identifies the value of the MM State associated with a MM to be stored or
stored MM. Sets the state for the forwarded MM when it is stored. As defined
in OMA-TS-MMS_ENC [39] clause 7.3.33. Include if sent by the MMS Proxy-Relay.
C flags Identifies a keyword to add or remove from the list of keywords
associated with a stored MM. See OMA-TS-MMS_ENC [39] clause 7.3.32. Include if
sent by the MMS Proxy-Relay. C contentType The content type of the MM. See
OMA-TS-MMS_ENC [39] clause 7.3.11 M contentLocation The _content-location-
value_ field defines the URL for the MMS server location of the MM. As defined
in OMA-TS-MMS_ENC [39] clause 7.3.10. Include if sent by the MMS Proxy-Relay.
C storeStatus Indicates if the MM was successfully stored in the MMBox. M
storeStatusText Text that qualifies the Store Status. Include if sent to the
target. As defined in OMA-TS-MMS_ENC [39] clause 7.3.59. Include if sent by
the MMS Proxy-Relay. C mMBoxDescription The MMBox description PDU as defined
in 7.4.3.20 corresponds to the particular MM. include if sent by the MMS
Proxy-Relay. C
* * *
#### 7.4.3.12 MMSMBoxDelete
The IRI-POI present in the MMS Proxy-Relay shall generate an xIRI containing
an MMSMBoxDelete record when the MMS Proxy-Relay sends a _m-mbox-delete.conf_
(defined in OMA-TS-MMS_ENC [39]) to the MMS client in the target UE.
Table 7.4.3-12 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-mbox-delete-req_ message (from the local target
UE to the MMS Proxy-Relay), and from the _m-mbox-delete-conf_ message (from
the MMS Proxy-Relay to the local target UE).
Table 7.4.3-12: Payload for MMSMBoxDelete
* * *
Field name Description M/C/O transactionID An ID used to correlate an MMS
request and response between the target and the MMS Proxy-Relay. As defined in
OMA-TS-MMS_ENC [39] clause 7.3.63. M version The version of MM, to include
major and minor version. M direction Indicates the direction of the MM. This
shall be encoded as "to target," or \"fromTarget,\" as appropriate. M
contentLocationReq The _content-location-value_ field defines the URL for the
MMS server location of the MM as it appears in the _m-mbox-delete-req_. As
defined in OMA-TS-MMS_ENC [39] clause 7.3.10. M contentLocationConf The
_content-location-value_ field defines the URL for the MMS server location of
the MM as it appears in the _m-mbox-delete-conf_. As defined in OMA-TS-MMS_ENC
[39] clause 7.3.10. Include if sent by the MMS Proxy-Relay. C responseStatus
MMS specific status. M responseStatusText Text that qualifies the Response
Status. As defined in OMA-TS-MMS_ENC [39] clause 7.3.49. C
* * *
#### 7.4.3.13 MMSDeliveryReport
The IRI-POI present in the MMS Proxy-Relay shall generate an xIRI containing
an MMSDeliveryReport record when the MMS Proxy-Relay sends an _m-delivery-ind_
(as defined in OMA-TS-MMS_ENC [39] clause 6.11) to the MMS client in the
target UE.
Table 7.4.3-13 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-delivery-ind_ message (from the MMS Proxy-Relay
to the local target UE).
Table 7.4.3-13: Payload for MMSDeliveryReport
+---------------------+--------------------------------------+-------+ | Field name | Description | M/C/O | +---------------------+--------------------------------------+-------+ | version | The version of MM, to include major | M | | | and minor version. | | +---------------------+--------------------------------------+-------+ | messageID | An ID assigned by the MMS | M | | | Proxy-Relay to uniquely identify an | | | | MM. As defined in OMA-TS-MMS_ENC | | | | [39] clause 7.3.29. Include if | | | | sent by the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | terminatingMMSParty | ID(s) of the terminating party of | M | | | the original message this Delivery | | | | Report refers to, in one or more of | | | | the formats described in 7.4.2.1 | | | | | | | | When address translation occurs | | | | (such as the case of a token sent by | | | | the client and replaced with a | | | | proper address by the MMS | | | | Proxy-Relay), both the pre and post | | | | translated addresses (with | | | | appropriate correlation) are | | | | included. | | +---------------------+--------------------------------------+-------+ | dateTime | Date and Time when the MM was last | M | | | handled (either originated or | | | | forwarded). Include if sent by the | | | | MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | responseStatus | MMS specific status. | M | +---------------------+--------------------------------------+-------+ | responseStatusText | Text that qualifies the Response | C | | | Status. As defined in | | | | OMA-TS-MMS_ENC [39] clause | | | | 7.3.49. Include if sent by the MMS | | | | Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | applicID | Identification of the originating | C | | | application of the original MM. Sent | | | | by the target to identify the | | | | destination application as defined | | | | in OMA-TS-MMS_ENC [39] clause | | | | 7.3.2. Include if sent by the MMS | | | | Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | replyApplicID | Identification of an application to | C | | | which replies, delivery reports, and | | | | read reports are addressed. Sent by | | | | the target to identify the | | | | application to which replies, | | | | delivery reports, and read reports | | | | are addressed as defined in | | | | OMA-TS-MMS_ENC [39] clause | | | | 7.3.42. Include if sent by the MMS | | | | Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | auxApplicInfo | Auxiliary application addressing | C | | | information as indicated in the | | | | original MM. As defined in | | | | OMA-TS-MMS_ENC [39] clause 7.3.4. | | | | Include if sent by the MMS | | | | Proxy-Relay. | | +---------------------+--------------------------------------+-------+
#### 7.4.3.14 MMSDeliveryReportNonLocalTarget
The IRI-POI in the MMS Proxy-Relay shall generate an xIRI containing an
MMSDeliveryReportNonLocalTarget record when the MMS Proxy-Relay:
\- sends MM4_delivery_report.REQ (as defined in TS 23.140 [40] clause 8.4.2),
that contains a non-local target ID, to the non-local MMS Proxy-Relay, or
\- receives MM4_delivery_report.REQ, that contains a non-local target ID, from
the non-local MMS Proxy-Relay.
Table 7.4.3-14 contains parameters generated by the IRI-POI, along with
parameters derived from the _MM4_delivery_report.REQ_ message (from the local
MMS Proxy-Relay to the non-local MMS Proxy-Relay, or inversely).
Table 7.4.3-14: Payload for MMSDeliveryReportNonLocalTarget
* * *
Field name Description M/C/O version The version of MM, to include major and
minor version. M transactionID An ID used to correlate an MMS request and
response between the proxies. As defined in TS 23.140 [40] clause 8.4.1.4. M
messageID An ID assigned by the MMS Proxy-Relay to uniquely identify an MM. As
defined in TS 23.140 [40] clause 8.4.1.4. M terminatingMMSParty ID(s) of the
terminating party of the original message this Delivery Report refers to, in
one or more of the formats described in 7.4.2.1. M originatingMMSParty ID(s)
of the originating party of the original message this Delivery Report refers
to, in one or more of the formats described in 7.4.2.1. M direction Indicates
the direction of the MM. This shall be encoded as \"toTarget,\" or "from
target," as appropriate. M dateTime Date and Time when the MM was last handled
(either originated or forwarded). M forwardToOriginator Indicates whether the
MMS Proxy-Relay is allowed to forward the delivery report to the originating
UE. \"Yes\" is coded as True, and \"No\" is coded as False. Include if sent
to/by the MMS Proxy-Relay. C mMStatus Provides a MM status. A status of
\"retrieved\" is only signalled by the retrieving UE after retrieval of the
MM. M mMStatusExtension Extension of the MMStatus, that provides more
granularity. Include if sent to/by the MMS Proxy-Relay. C mMStatusText Text
that qualifies the MM Status. As defined in OMA-TS-MMS_ENC [39] clause 7.3.55.
Include if sent to/by the MMS Proxy-Relay. C applicID Identification of the
originating application of the original MM. Identifies the destination
application as defined in TS 23.140 [40] clause 8.4.1.4. Include if sent to/by
the MMS Proxy-Relay. C replyApplicID Identification of an application to which
replies, delivery reports, and read reports are addressed. Identifies the
application to which replies, delivery reports, and read reports are addressed
as defined in TS 23.140 [40] clause 8.4.1.4. Include if sent to/by the MMS
Proxy-Relay. C auxApplicInfo Auxiliary application addressing information as
indicated in the original MM. As defined in OMA-TS-MMS_ENC [39] clause 7.3.4.
Include if sent to/by the MMS Proxy-Relay. C
* * *
#### 7.4.3.15 MMSReadReport
The IRI-POI present in the MMS Proxy-Relay shall generate an xIRI containing
an MMSReadReport record when the MMS Proxy-Relay:
\- sends a m-read-orig-ind (as defined in OMA-TS-MMS_ENC [39] clause 6.7.2) to
the MMS client in the target UE, or
\- receives a m-read-rec-ind (as defined in OMA-TS-MMS_ENC [39] clause 6.7.2)
from the MMS client in the target UE.
Table 7.4.3-15 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-read-orig-ind_ message (from the MMS Proxy-
Relay to the local target UE), and from the _m-read-rec-ind_ message (from the
local target UE to the MMS Proxy-Relay).
Table 7.4.3-15: Payload for MMSReadReport
+---------------------+--------------------------------------+-------+ | Field name | Description | M/C/O | +---------------------+--------------------------------------+-------+ | version | The version of MM, to include major | M | | | and minor version. | | +---------------------+--------------------------------------+-------+ | messageID | An ID assigned by the MMS | M | | | Proxy-Relay to uniquely identify an | | | | MM. As defined in OMA-TS-MMS_ENC | | | | [39] clause 7.3.29. | | +---------------------+--------------------------------------+-------+ | terminatingMMSParty | ID(s) of the terminating party (i.e. | M | | | the intended recipient of the read | | | | report or the originator of the | | | | initial MM message to which the read | | | | report applies) in one or more of | | | | the formats described in 7.4.2.1 | | | | | | | | When address translation occurs | | | | (such as the case of a token sent by | | | | the client and replaced with a | | | | proper address by the MMS | | | | Proxy-Relay), both the pre and post | | | | translated addresses (with | | | | appropriate correlation) are | | | | included. | | +---------------------+--------------------------------------+-------+ | originatingMMSParty | ID(s) of the originating party (i.e. | M | | | the originator of the read report or | | | | the recipient the initial MM message | | | | to which the read report applies) in | | | | one or more of the formats described | | | | in 7.4.2.1 | | | | | | | | When address translation occurs | | | | (such as the case of a token sent by | | | | the client and replaced with a | | | | proper address by the MMS | | | | Proxy-Relay), both the pre and post | | | | translated addresses (with | | | | appropriate correlation) are | | | | included. | | +---------------------+--------------------------------------+-------+ | direction | Indicates the direction of the | M | | | original MM (**not** of this | | | | message). This shall be encoded | | | | either as \"from target,\" or "to | | | | target," as appropriate. | | +---------------------+--------------------------------------+-------+ | dateTime | Date and Time when the MM was last | C | | | handled (either originated or | | | | forwarded). Include if sent to/by | | | | the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | readStatus | Status of the MMS (e.g.read or | M | | | deleted without reading.) | | +---------------------+--------------------------------------+-------+ | applicID | Identification of the originating | C | | | application of the original MM. As | | | | defined in OMA-TS-MMS_ENC [39] | | | | clause 7.3.2. Include if sent to/by | | | | the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | replyApplicID | Identification of an application to | C | | | which replies, delivery reports, and | | | | read reports are addressed. As | | | | defined in OMA-TS-MMS_ENC [39] | | | | clause 7.3.42. Include if sent to/by | | | | the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | auxApplicInfo | Auxiliary application addressing | C | | | information as indicated in the | | | | original MM. As defined in | | | | OMA-TS-MMS_ENC [39] clause 7.3.4. | | | | Include if sent to/by the MMS | | | | Proxy-Relay. | | +---------------------+--------------------------------------+-------+
#### 7.4.3.16 MMSReadReportNonLocalTarget
The IRI-POI present in the MMS Proxy-Relay shall generate an xIRI containing
an MMSReadReportNonLocalTarget record when the MMS Proxy-Relay:
\- sends a MM4_read_reply_report.REQ (as defined in TS 23.140 [40] clause
8.4.3), that contains a non-local target ID, to the non-local MMS Proxy-Relay,
or
\- receives a MM4_read_reply_report.REQ (as defined in TS 23.140 [40] clause
8.4.3), that contains a non-local target ID, from the non-local MMS Proxy-
Relay.
Table 7.4.3-16 contains parameters generated by the IRI-POI, along with
parameters derived from the **_MM4_read_reply_report.REQ_** message (from the
local MMS Proxy-Relay to the non-local MMS Proxy-Relay, or inversely).
Table 7.4.3-16: Payload for MMSReadReportNonLocalTarget
+---------------------+--------------------------------------+-------+ | Field name | Description | M/C/O | +---------------------+--------------------------------------+-------+ | version | The version of MM, to include major | M | | | and minor version. | | +---------------------+--------------------------------------+-------+ | transactionID | An ID used to correlate an MMS | M | | | request and response between the | | | | proxies. As defined in TS 23.140 | | | | [40] clause 8.4.1.4. | | +---------------------+--------------------------------------+-------+ | terminatingMMSParty | ID(s) of the terminating party in | M | | | one or more of the formats described | | | | in 7.4.2.1 | | | | | | | | When address translation occurs | | | | (such as the case of a token sent by | | | | the client and replaced with a | | | | proper address by the MMS | | | | Proxy-Relay), both the pre and post | | | | translated addresses (with | | | | appropriate correlation) are | | | | included. | | +---------------------+--------------------------------------+-------+ | originatingMMSParty | ID(s) of the originating party in | M | | | one or more of the formats described | | | | in 7.4.2.1 | | | | | | | | When address translation occurs | | | | (such as the case of a token sent by | | | | the client and replaced with a | | | | proper address by the MMS | | | | Proxy-Relay), both the pre and post | | | | translated addresses (with | | | | appropriate correlation) are | | | | included. | | +---------------------+--------------------------------------+-------+ | direction | Indicates the direction of the | M | | | original MM (**not** of this | | | | message). This shall be encoded | | | | either as \"from target\" = True, or | | | | "to target" = False. | | +---------------------+--------------------------------------+-------+ | messageID | An ID assigned by the MMS | M | | | Proxy-Relay to uniquely identify an | | | | MM. As defined in TS 23.140 [40] | | | | clause 8.4.1.4. | | +---------------------+--------------------------------------+-------+ | dateTime | Date and Time when the MM was last | M | | | handled (either originated or | | | | forwarded). | | +---------------------+--------------------------------------+-------+ | readStatus | Status of the MMS (e.g.read or | M | | | deleted without reading.) | | +---------------------+--------------------------------------+-------+ | readStatusText | Text explanation corresponding to | C | | | the Read Status. Include if sent | | | | to/by the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | applicID | Identification of the originating | C | | | application of the original MM. | | | | Identifies the destination | | | | application as defined in TS 23.140 | | | | [40] clause 8.4.1.4. Include if | | | | sent to/by the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | replyApplicID | Identification of an application to | C | | | which replies, delivery reports, and | | | | read reports are addressed. | | | | Identifies the application to which | | | | replies, delivery reports, and read | | | | reports are addressed, as defined in | | | | TS 23.140 [40] clause 8.4.1.4. | | | | Include if sent to/by the MMS | | | | Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | auxApplicInfo | Auxiliary application addressing | C | | | information as indicated in the | | | | original MM. As defined in | | | | OMA-TS-MMS_ENC [39] clause 7.3.4. | | | | Include if sent to/by the MMS | | | | Proxy-Relay. | | +---------------------+--------------------------------------+-------+
#### 7.4.3.17 MMSCancel
The IRI-POI present in the MMS Proxy-Relay shall generate an xIRI containing
an MMSCancel record when the MMS Proxy-Relay sends a _m-cancel-req_ (as
defined in OMA-TS-MMS_ENC [39] clause 6.13) to the MMS client in the target
UE.
Table 7.4.3-17 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-cancel-req_ message (from the MMS Proxy-Relay
to the local target UE).
Table 7.4.3-17: Payload for MMSCancel
* * *
Field name Description M/C/O transactionID An ID used to correlate an MMS
request and response between the target and the MMS Proxy-Relay. As defined in
OMA-TS-MMS_ENC [39] clause 7.3.63. M version The version of MM, to include
major and minor version. M cancelID This field includes the Message ID
identifying the message to be cancelled. As defined in OMA-TS-MMS_ENC [39]
clause 7.3.6. M direction Indicates the direction of the original MM. This
shall be encoded as "to target.\" M
* * *
#### 7.4.3.18 MMSMBoxViewRequest
The IRI-POI present in the MMS Proxy-Relay shall generate an xIRI containing
an MMSViewRequest record when the MMS Proxy-Relay receives a _m-mbox-view-req_
(as defined in OMA-TS-MMS_ENC [39] clause 6.9) from the MMS client in the
target UE.
Table 7.4.3-18 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-mbox-vew-req_ message (from the local target UE
to the MMS Proxy-Relay).
Table 7.4.3-18: Payload for MMSMBoxViewRequest
+-----------------+------------------------------------------+-------+ | Field name | Description | M/C/O | +-----------------+------------------------------------------+-------+ | transactionID | An ID used to correlate an MMS request | M | | | and response between the target and the | | | | MMS Proxy-Relay. As defined in | | | | OMA-TS-MMS_ENC [39] clause 7.3.63. | | +-----------------+------------------------------------------+-------+ | version | The version of MM, to include major and | M | | | minor version. | | +-----------------+------------------------------------------+-------+ | contentLocation | The _content-location-value_ field | C | | | defines the URL for the MMS Proxy-Relay | | | | location of the content to be retrieved. | | | | As defined in OMA-TS-MMS_ENC [39] | | | | clause 7.3.10. Include if sent to the | | | | MMS Proxy-Relay. | | +-----------------+------------------------------------------+-------+ | state | Specifies a MM State value to use in | C | | | selecting the messages to return. As | | | | defined in OMA-TS-MMS_ENC [39] clause | | | | 7.3.33. Include if sent to the MMS | | | | Proxy-Relay. | | +-----------------+------------------------------------------+-------+ | flags | Specifies a MM Flags keyword to use in | C | | | selecting the messages to return in the | | | | response. See OMA-TS-MMS_ENC [39] | | | | clause 7.3.32. Include if sent to the | | | | MMS Proxy-Relay. | | +-----------------+------------------------------------------+-------+ | start | A number, indicating the index of the | C | | | first MM of those selected to have | | | | information returned in the response. | | | | Include if sent to the MMS Proxy-Relay. | | +-----------------+------------------------------------------+-------+ | limit | A number indicating the maximum number | C | | | of selected MMs whose information are to | | | | be returned in the response. | | | | | | | | If this is absent, information elements | | | | from all remaining MMs are to be | | | | returned. If this is zero, then no | | | | MM-related information are to be | | | | returned. Include if sent to the MMS | | | | Proxy-Relay. | | +-----------------+------------------------------------------+-------+ | mMSAttributes | A list of information elements that | C | | | should appear in the view for each | | | | selected message. Include if sent to the | | | | MMS Proxy-Relay. | | +-----------------+------------------------------------------+-------+ | mMSTotals | Indicates a request for or the actual | C | | | count of messages currently stored in | | | | the MMBox. The values given in | | | | OMA-TS-MMS_ENC [39] clause 7.3.62. | | | | shall be encoded as follows: "Yes" = | | | | True, "No" = False. Include if sent to | | | | the MMS Proxy-Relay. | | +-----------------+------------------------------------------+-------+ | mMSQuotas | Indicates a request for or the actual | C | | | quotas for the user\'s MMBox in messages | | | | or bytes. The values given in | | | | OMA-TS-MMS_ENC [39] clause 7.3.36. | | | | shall be encoded as follows: "Yes" = | | | | True, "No" = False. Include if sent to | | | | the MMS Proxy-Relay. | | +-----------------+------------------------------------------+-------+
#### 7.4.3.19 MMSMBoxViewResponse
The IRI-POI present in the MMS Proxy-Relay shall generate an xIRI containing
an MMSViewConfirm record when the MMS Proxy-Relay sends a _m-mbox-view.conf_
(as defined in OMA-TS-MMS_ENC [39] clause 6.9) to the MMS client in the target
UE.
Table 7.4.3-19 contains parameters generated by the IRI-POI, along with
parameters derived from the _m-mbox-vew-conf_ message (from the local target
UE to the MMS Proxy-Relay).
Table 7.4.3-19: Payload for MMSMBoxViewResponse
+--------------------+---------------------------------------+-------+ | Field name | Description | M/C/O | +--------------------+---------------------------------------+-------+ | version | The version of MM, to include major | M | | | and minor version. | | +--------------------+---------------------------------------+-------+ | responseStatus | MMS specific status. | M | +--------------------+---------------------------------------+-------+ | responseStatusText | Text that qualifies the Response | C | | | Status. As defined in OMA-TS-MMS_ENC | | | | [39] clause 7.3.49. | | +--------------------+---------------------------------------+-------+ | contentLocation | The _content-location-value_ field | C | | | defines the URL for the MMS server | | | | location of the content to be | | | | retrieved. As defined in | | | | OMA-TS-MMS_ENC [39] clause 7.3.10. | | | | Include if sent by the MMS | | | | Proxy-Relay. | | +--------------------+---------------------------------------+-------+ | state | Specifies a MM State value to use in | C | | | selecting the messages to return. As | | | | defined in OMA-TS-MMS_ENC [39] | | | | clause 7.3.33. Include if sent by the | | | | MMS Proxy-Relay. | | +--------------------+---------------------------------------+-------+ | flags | Specifies a MM Flags keyword to use | C | | | in selecting the messages to return | | | | in the response. See OMA-TS-MMS_ENC | | | | [39] clause 7.3.32. Include if sent | | | | by the MMS Proxy-Relay. | | +--------------------+---------------------------------------+-------+ | start | A number, indicating the index of the | C | | | first MM of those selected to have | | | | information returned in the response. | | | | Include if sent by the MMS | | | | Proxy-Relay. | | +--------------------+---------------------------------------+-------+ | limit | A number indicating the maximum | C | | | number of selected MMs whose | | | | information are to be returned in the | | | | response. | | | | | | | | If this is absent, information | | | | elements from all remaining MMs are | | | | to be returned. If this is zero then | | | | no MM-related information are to be | | | | returned. Include if sent by the MMS | | | | Proxy-Relay. | | +--------------------+---------------------------------------+-------+ | mMSAttributes | A list of information elements that | C | | | should appear in the view for each | | | | selected message. Include if sent by | | | | the MMS Proxy-Relay. | | +--------------------+---------------------------------------+-------+ | mMSTotals | Indicates a request for or the actual | C | | | count of messages currently stored in | | | | the MMBox. The values given in | | | | OMA-TS-MMS_ENC [39] clause 7.3.62. | | | | shall be encoded as follows: "Yes" = | | | | True, "No" = False. Include if sent | | | | by the MMS Proxy-Relay. | | +--------------------+---------------------------------------+-------+ | mMSQuotas | Indicates a request for or the actual | C | | | quotas for the user\'s MMBox in | | | | messages or bytes. The values given | | | | in OMA-TS-MMS_ENC [39] clause | | | | 7.3.36. shall be encoded as follows: | | | | "Yes" = True, "No" = False. Include | | | | if sent by the MMS Proxy-Relay. | | +--------------------+---------------------------------------+-------+ | mMBoxDescription | The MMBox description PDU as defined | M | | | in 7.4.3.20 corresponds to the | | | | particular MM. | | +--------------------+---------------------------------------+-------+
#### 7.4.3.20 MMBoxDescription
The MMBoxDescription used in MMSMBoxViewResponse and MMSMBoxUpload records is
defined in table 7.4.3-20.
Table 7.4.3-20: Payload for MMBoxDescription
+---------------------+--------------------------------------+-------+ | Field name | Description | M/C/O | +---------------------+--------------------------------------+-------+ | contentLocation | The _content-location-value_ field | C | | | defines the URL for the MMS | | | | Proxy-relay location of the content | | | | to be retrieved. As defined in | | | | OMA-TS-MMS_ENC [39] clause | | | | 7.3.10. Include if sent by the MMS | | | | Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | messageID | An ID assigned by the MMS | C | | | Proxy-Relay to uniquely identify an | | | | MM. Included unconditionally for the | | | | MMS View Confirm report and is | | | | included for the MMS Upload report | | | | if a Message ID was previously | | | | assigned to the MM. In this latter | | | | case, if a Message ID was not | | | | previously assigned, this parameter | | | | is excluded. As defined in | | | | OMA-TS-MMS_ENC [39] clause | | | | 7.3.29. Include if sent by the MMS | | | | Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | state | Identifies the value of the MM State | C | | | associated with a MM to be stored or | | | | stored MM. Include for the MMS View | | | | Confirm. Include for the MMS View | | | | Request if provided by the target. | | | | As defined in OMA-TS-MMS_ENC [39] | | | | clause 7.3.33. Include if sent by | | | | the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | flags | Identifies a keyword to add or | C | | | remove from the list of keywords | | | | associated with a stored MM. This | | | | parameter may convey all the | | | | keywords associated with the MM. | | | | Include if at least one keyword is | | | | associated with the MM. If no | | | | keywords are associated with the MM, | | | | then this parameter may be excluded. | | | | Include if sent by the MMS | | | | Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | dateTime | Date and Time when the MM request | C | | | was detected. Include if sent by the | | | | MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | originatingMMSParty | ID(s) of the originating party in | C | | | one or more of the formats described | | | | in 7.4.2.1 | | | | | | | | When address translation occurs | | | | (such as the case of a token sent by | | | | the client and replaced with a | | | | proper address by the MMS | | | | Proxy-Relay), both the pre and post | | | | translated addresses (with | | | | appropriate correlation) are | | | | included. Include if sent by the MMS | | | | Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | terminatingMMSParty | ID(s) of the terminating party in | C | | | one or more of the formats described | | | | in 7.4.2.1 | | | | | | | | When address translation occurs | | | | (such as the case of a token sent by | | | | the client and replaced with a | | | | proper address by the MMS | | | | Proxy-Relay), both the pre and post | | | | translated addresses (with | | | | appropriate correlation) are | | | | included. I Include if sent by the | | | | MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | cCRecipients | Address of a recipient; the \"CC\" | C | | | field may include addresses of | | | | multiple recipients. When address | | | | translation occurs, both the pre and | | | | post translated addresses (with | | | | appropriate correlation) are | | | | included. This parameter is included | | | | if the corresponding MM includes a | | | | "CC" field. Include if sent by the | | | | MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | bCCRecipients | Address of a recipient; the \"BCC\" | C | | | field may include addresses of | | | | multiple recipients. When address | | | | translation occurs, both the pre and | | | | post translated addresses (with | | | | appropriate correlation) are | | | | included. This parameter is included | | | | if the corresponding MM includes a | | | | "BCC" field. Include if sent by the | | | | MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | messageClass | Class of the MM. For example, a | C | | | value of \"auto\" is automatically | | | | generated by the UE. If the field is | | | | not present, the class should be | | | | interpreted as \"personal\". Include | | | | if sent by the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | subject | The subject of the MM. Include if | C | | | sent by the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | priority | Priority of the MM assigned by the | C | | | originator MMS Client. Reported if | | | | sent by the target. Include if sent | | | | by the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+ | deliveryTime | Date and Time of delivery. Include | C | | | if sent by the MMS Proxy-Relay. | | +---------------------+--------------------------------------+-------+
+--------------------------+-------------------------------+---+ | readReport | Specifies whether the | C | | | originator MMS UE requests a | | | | read report from each | | | | recipient. The values given | | | | in OMA-TS-MMS_ENC [39] | | | | clause 7.3.37. shall be | | | | encoded as follows: "Yes" = | | | | True, "No" = False. Include | | | | if sent by the MMS | | | | Proxy-Relay. | | +--------------------------+-------------------------------+---+ | messageSize | Specifies the size of the MM | C | | | that was viewed or uploaded. | | | | Specified in bytes. Include | | | | if sent by the MMS | | | | Proxy-Relay. | | +--------------------------+-------------------------------+---+ | replyCharging | If this field is present its | C | | | value is set to "accepted" or | | | | "accepted text only" and the | | | | MMS-version-value of the | | | | M-Notification.ind PDU is | | | | higher than 1.0, this header | | | | field will indicate that a | | | | reply to this particular MM | | | | is free of charge for the | | | | recipient. | | | | | | | | If the Reply-Charging service | | | | is offered and the request | | | | for reply-charging has been | | | | accepted by the MMS service | | | | provider the value of this | | | | header field SHALL be set to | | | | "accepted" or "accepted text | | | | only". | | | | | | | | See OMA-TS-MMS_ENC [39] | | | | clause 7.3.43. Include if | | | | sent by the MMS Proxy-Relay. | | +--------------------------+-------------------------------+---+ | previouslySentBy | Address of the MMS Client | C | | | that forwarded or previously | | | | sent the message. along with | | | | a sequence number and | | | | timestamp. | | | | | | | | A higher sequence number | | | | indicates a forwarding event | | | | at a later point in time. The | | | | sequence number indicates the | | | | correspondence to the MMS | | | | Client\'s address in the | | | | \"X-Mms-Previously- Sent-By\" | | | | header field with the same | | | | sequence number. This header | | | | field MAY appear multiple | | | | times. Include if sent by the | | | | MMS Proxy-Relay. | | +--------------------------+-------------------------------+---+ | previouslySentByDateTime | Date/Time MM was previously | C | | | sent.This header field MAY | | | | appear multiple times. | | | | Include if sent by the MMS | | | | Proxy-Relay. | | +--------------------------+-------------------------------+---+ | contentType | The content type of the MM. | C | | | Include if sent by the MMS | | | | Proxy-Relay. | | +--------------------------+-------------------------------+---+
#### 7.4.3.21 MMS Content
If content delivery is authorized, the CC-POI in the MMS Proxy-Relay shall
generate an xCC as per clause 7.4.2.3 when any of the events in clauses
7.4.3.1 through 7.4.3.19 are detected.
### 7.4.4 IRI and CC Generation
#### 7.4.4.1 Generation of IRI over LI_HI2
When an IRI-POI in the MMS Proxy-Relay generated xIRI is received over LI_X2,
the MDF2 shall send an xIRI over LI_HI2 without undue delay. The xIRI shall
contain a copy of the record received over LI_X2. The record may be enriched
by other information available at the MDF (e.g. additional location
information).
The threeGPP33128DefinedCC field (see ETSI TS 102 232-7 [10] clause 15) shall
be populated with the BER-encoded IRIPayload.
The timestamp field of the PSHeader structure shall be set to the time that
the MMS event was observed (i.e. the timestamp field of the xIRI). The LIID
and CID fields shall correctly reflect the target identity and communication
session to which the IRI belongs.
#### 7.4.4.2 Generation of CC over LI_HI3
When a CC-POI in the MMS Proxy-Relay generated xCC message is received over
LI_X3, the MDF3 shall send a CC message over LI_HI3 without undue delay. The
CC message shall contain a copy of the MMS received over LI_X3. The record may
be enriched with other information available at the MDF.
## 7.5 PTC service
### 7.5.1 Introduction
The Stage 3 intercept capabilities defined in this clause for the Push to Talk
over Cellular (PTC) service apply when supported by a CSP. The term PTC
represents either a Push to Talk over Cellular (PoC) or Mission Critical Push
to Talk (MCPTT) type service. The use of the term PTC server represents either
a MCPTT function or PoC server.
#### 7.5.1.1 Provisioning over LI_X1
The IRI-POI present in the PTC server is provisioned over LI_X1 by the LIPF
using the X1 protocol as described in clause 5.2.2 of the present document.
The POI in the PTC Server shall support the identifier types given in table
7.5.1-1.
Table 7.5.1-1: TargetIdentifier Types for PTC service
* * *
Identifier Owner ETSI TS 103 221-1 [7] TargetIdentifier type Definition iMPU
ETSI IMPU See ETSI TS 103 221-1 [7] iMPI ETSI IMPI See ETSI TS 103 221-1 [7]
mCPTTID ETSI TargetIdentifierExtension See XSD schema instanceIdentifierURN
3GPP TargetIdentifierExtension See XSD schema pTCChatGroupID 3GPP
TargetIdentifierExtension See XSD schema
* * *
#### 7.5.1.2 Generating xIRI over LI_X2
The IRI-POI present in the PTC server shall send xIRI over LI_X2 for each of
the events listed in TS 33.127 [5] clause 7.6.3, each of which is described in
the following clauses. The IRI events are based on the use of 3GPP MCPTT
features as defined in TS 24.379 [55] and OMA PoC features as defined in OMA-
TS-PoC_System_Description-V2_1-20110802-A [56].
#### 7.5.1.3 Generation of xCC over LI_X3
The CC-POI present in the PTC server shall send xCC over LI_X3.
The CC-POI shall set the payload format to indicate the appropriate payload
type (5 for IPv4 Packet, 6 for IPv6 Packet) per clause 6.2.3.6 of the present
document.
### 7.5.2 IRI events
#### 7.5.2.1 PTC registration
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCRegistration record when the IRI-POI present in the PTC server detects that
a PTC target matching one of the PTC target identifiers, referenced in clause
7.5.1.1, provided via LI_X1 has registered, re-registered, or de-registered
for PTC services , regardless of whether it is successful or unsuccessful.
Accordingly, the IRI-POI in the PTC server generates the xIRI when the
following event is detected:
\- when the PTC server receives a SIP REGISTER from a PTC target.
Table 7.5.2-1: Payload for PTCRegistration record
* * *
Field name Description M/C/O pTCTargetInformation Provide PTC target identity.
At least one among MCPTT ID, IMPU, IMPI, InstanceIdentifierURN and
PTCChatGroupID shall be provided for PTCTargetInformation. M pTCServerURI
Shall include the identity of the PTC server serving the PTC target. M
pTCRegistrationRequest Identifies the type of registration request (register,
re-register, or de-register). M pTCRegistrationOutcome Identifies success or
failure of the registration. M
* * *
#### 7.5.2.2 PTC session initiation
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCSessionInitiation record when the IRI-POI present in the PTC server detects
that the PTC target initiates an on-demand session or the target receives an
invitation to join an on-demand session regardless of the success or the final
disposition of the invitation. The PTCSessionIniation record shall also be
reported when a chat group is the PTC target. Accordingly, the IRI-POI in the
PTC server generates the xIRI when the following events are detected:
\- when the PTC server receives a SIP INVITE from a PTC target.
\- when the PTC Server sends a SIP INVITE to the PTC target.
\- when the PTC Server hosting a PTC chat group session, where the PTC chat
group is the target, receives a SIP INVITE from a participating PTC server to
initiate a PTC chat group session.
Table 7.5.2-2: Payload for PTCSessionInitiation record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | pTCTargetInformation | Provide PTC target | M | | | identity. At least one | | | | among MCPTT ID, IMPU, IMPI, | | | | InstanceIdentifierURN and | | | | PTCChatGroupID shall be | | | | provided for | | | | PTCTargetInformation. | | +-----------------------------+-----------------------------+-------+ | pTCDirection | Indicates the direction of | M | | | the session relative to the | | | | target: \"toTarget\" or | | | | \"fromTarget.\" | | +-----------------------------+-----------------------------+-------+ | pTCServerURI | Shall include the identity | M | | | of the PTC server serving | | | | the PTC target. | | +-----------------------------+-----------------------------+-------+ | pTCSessionInfo | Shall provide PTC session | M | | | information such as PTC | | | | Session URI and PTC Session | | | | type (e.g. on-demand, | | | | pre-established, ad-hoc, | | | | pre-arranged, group | | | | session). | | +-----------------------------+-----------------------------+-------+ | pTCOriginatingID | Shall identify the | M | | | originating party. | | +-----------------------------+-----------------------------+-------+ | pTCParticipants | Shall identify the | C | | | individual PTC participants | | | | of the communication | | | | session, when known. | | +-----------------------------+-----------------------------+-------+ | p | Shall provide the | C | | TCParticipantPresenceStatus | Participant Presence | | | | Status, which is a list of: | | | | | | | | - _PresenceID_ : Identity | | | | of PTC client(s) or PTC | | | | group, when known. | | | | | | | | - _PresenceType_ : | | | | Identifies type of ID [PTC | | | | client(s) or PTC group]. | | | | | | | | - _PresenceStatus_ : | | | | Presence state of each ID. | | | | True indicates PTC client | | | | is available, while false | | | | indicates PTC client is | | | | unavailable. | | | | | | | | Report when the Presence | | | | functionality is supported | | | | by the PTC server and the | | | | PTC server assumes the role | | | | of the watcher on behalf of | | | | the PTC target or in the | | | | case of a target PTC chat | | | | group, when the PTC server | | | | assumes the role of the | | | | watcher on behalf of any | | | | member of the chat group. | | +-----------------------------+-----------------------------+-------+ | location | Shall include the PTC | C | | | target's location when | | | | reporting of the PTC | | | | target's location | | | | information is authorized | | | | and available. | | +-----------------------------+-----------------------------+-------+ | pTCBearerCapability | Shall provide when known | C | | | the media characteristics | | | | information elements of the | | | | PTC session, encoded in SDP | | | | format as per RFC 4566 | | | | [43] clause 5. | | +-----------------------------+-----------------------------+-------+ | pTCHost | Shall identify the PTC | C | | | participant who has the | | | | authority to initiate and | | | | administrate a PTC session, | | | | if known. | | +-----------------------------+-----------------------------+-------+
#### 7.5.2.3 PTC session abandon attempt
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCSessionAbandon record when the IRI-POI present in the PTC server detects
that the PTC Session is not established and the request is abandoned before
the PTC session starts. Accordingly, the IRI-POI in the PTC server generates
the xIRI when the following events are detected:
\- when the PTC server serving the PTC target receives a SIP CANCEL from the
PTC target or sends a SIP CANCEL to the PTC target.
Table 7.5.2-3: Payload for PTCSessionAbandonAttempt record
* * *
Field name Description M/C/O pTCTargetInformation Provide PTC target identity.
At least one among MCPTT ID, IMPU, IMPI, InstanceIdentifierURN and
PTCChatGroupID shall be provided for PTCTargetInformation. M pTCDirection
Indicates the direction of the session relative to the target: \"toTarget\" or
\"fromTarget.\" M pTCSessionInfo Shall provide PTC session information such as
PTC Session URI and PTC Session type (e.g. on-demand, pre-established, ad-hoc,
pre-arranged, group session). M location Shall include the PTC target's
location when reporting of the PTC target's location information is authorized
and available. C pTCAbandonCause Shall identify the reason for the abandoned
PTC session based on the warning header field code provided in a response to a
SIP INVITE per TS 24.379 [55] clause 4.4.2. M
* * *
#### 7.5.2.4 PTC session start
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCSessionStart record when the IRI-POI present in the PTC server detects that
the PTC Session is initiated and communication begins for both an on-demand
and pre-established PTC session. The PTCSessionStart record shall also be
reported when a chat group is the PTC target. Accordingly, the IRI-POI in the
PTC server generates the xIRI when the following events are detected:
\- when the PTC server sends a SIP 200 OK to the PTC target in response to a
SIP INVITE from the PTC target for an on-demand PTC session where the PTC
target originates the PTC session.
\- when the PTC server receives a SIP 200 OK from the PTC target in response
to a SIP INVITE for an on-demand PTC session where the PTC target receives an
invitation to join a PTC session.
\- when the PTC server receives a SIP 200 OK from the participant PTC server
in response to a SIP INVITE previously sent to that participating PTC server
for PTC sessions initiated by the PTC target with a pre-established PTC
session (PTC server sends a TBCP Connect to the PTC target with a pre-
established session).
\- when the PTC server sends a SIP 200 OK to the participant PTC server in
response to a SIP INVITE previously received from that participating PTC
server for PTC sessions terminated to the PTC target with a pre-established
PTC session (PTC server sends a TBCP Connect to the PTC target with a pre-
established session).
\- when the PTC server hosting a PTC chat group session, where PTC chat group
is the PTC target, sends a SIP 200 OK in response to a SIP INVITE previously
received from the participant PTC server to initiate a PTC chat group session.
Table 7.5.2-4: Payload for PTCSessionStart record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | pTCTargetInformation | Provide PTC target | M | | | identity. At least one | | | | among MCPTT ID, IMPU, IMPI, | | | | InstanceIdentifierURN and | | | | PTCChatGroupID shall be | | | | provided for | | | | PTCTargetInformation. | | +-----------------------------+-----------------------------+-------+ | pTCDirection | Indicates the direction of | M | | | the session relative to the | | | | target: \"toTarget\" or | | | | \"fromTarget.\" | | +-----------------------------+-----------------------------+-------+ | pTCServerURI | Shall include the identity | M | | | of the PTC server serving | | | | the PTC target. | | +-----------------------------+-----------------------------+-------+ | pTCSessionInfo | Shall provide PTC session | M | | | information such as PTC | | | | Session URI and PTC Session | | | | type (e.g. on-demand, | | | | pre-established, ad-hoc, | | | | pre-arranged, group | | | | session). | | +-----------------------------+-----------------------------+-------+ | pTCOriginatingID | Shall identify the | M | | | originating party. | | +-----------------------------+-----------------------------+-------+ | pTCParticipants | Shall identify the | C | | | individual PTC participants | | | | of the communication | | | | session, when known. | | +-----------------------------+-----------------------------+-------+ | p | Shall provide the | C | | TCParticipantPresenceStatus | Participant Presence | | | | Status, which is a list of: | | | | | | | | - _PresenceID_ : Identity | | | | of PTC client(s) or PTC | | | | group, when known. | | | | | | | | - _PresenceType_ : | | | | Identifies type of ID [PTC | | | | client(s) or PTC group]. | | | | | | | | - _PresenceStatus_ : | | | | Presence state of each ID. | | | | True indicates PTC client | | | | is available, while false | | | | indicates PTC client is | | | | unavailable. | | | | | | | | Report when the Presence | | | | functionality is supported | | | | by the PTC server and the | | | | PTC server assumes the role | | | | of the watcher on behalf of | | | | the PTC target. | | +-----------------------------+-----------------------------+-------+ | location | Shall include the PTC | C | | | target's location when | | | | reporting of the PTC | | | | target's location | | | | information is authorized | | | | and available. | | +-----------------------------+-----------------------------+-------+ | pTCHost | Shall identify the PTC | C | | | participant who has the | | | | authority to initiate and | | | | administrate a PTC Session, | | | | if known. | | +-----------------------------+-----------------------------+-------+ | pTCBearerCapability | Shall provide the media | C | | | characteristics information | | | | elements of the PTC | | | | session, encoded in SDP | | | | format as per RFC 4566 | | | | [43] clause 5 when known. | | +-----------------------------+-----------------------------+-------+
#### 7.5.2.5 PTC session end
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCSessionEnd record when the IRI-POI present in the PTC server detects that
the PTC session is released for any reason (i.e. normal or abnormal release)
and voice communications ends. Accordingly, the IRI-POI in the PTC server
generates the xIRI when the following events are detected:
\- when the PTC server receives a SIP BYE from the PTC target to end the
session.
\- when the PTC server receives a SIP 200 OK from the PTC target in response
to a SIP BYE.
\- when the PTC server sends a SIP BYE to the participating PTC server to end
the PTC session of a PTC target with a pre-established PTC session (PTC server
also sends a TBCP Disconnect to the PTC target with a pre-established PTC
session).
\- when the PTC server receives a SIP BYE from the participant PTC server to
end the PTC session of a PTC target with a pre-established PTC session (PTC
server sends a TBCP Disconnect to the PTC target with a pre-established PTC
session).
\- when the PTC server hosting a PTC chat group session, where PTC chat group
is the PTC target, sends a SIP 200 OK in response to a SIP BYE received from
the participating PTC server of the last participant in the PTC chat group
session.
\- when the PTC server sends a SIP 487 to the PTC target in response to a SIP
CANCEL to end the session.
Table 7.5.2-5: Payload for PTCSessionEnd record
+----------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +----------------------+-----------------------------+-------+ | pTCTargetInformation | Provide PTC target | M | | | identity. At least one | | | | among MCPTT ID, IMPU, IMPI, | | | | InstanceIdentifierURN and | | | | PTCChatGroupID shall be | | | | provided for | | | | PTCTargetInformation. | | +----------------------+-----------------------------+-------+ | pTCDirection | Indicates the direction of | M | | | the session relative to the | | | | target: \"toTarget\" or | | | | \"fromTarget.\" | | +----------------------+-----------------------------+-------+ | pTCServerURI | Shall include the identity | M | | | of the PTC server serving | | | | the PTC target. | | +----------------------+-----------------------------+-------+ | pTCSessionInfo | Shall provide PTC session | M | | | information such as PTC | | | | Session URI and PTC Session | | | | type (e.g. on-demand, | | | | pre-established, ad-hoc, | | | | pre-arranged, group | | | | session). | | +----------------------+-----------------------------+-------+ | pTCParticipants | Shall identify the | C | | | individual PTC participants | | | | of the communication | | | | session, when known. | | +----------------------+-----------------------------+-------+ | location | Shall include the PTC | C | | | target's location when | | | | reporting of the PTC | | | | target's location | | | | information is authorized | | | | and available. | | +----------------------+-----------------------------+-------+ | pTCSessionEndCause | Shall identify the reason | M | | | for the PTC session end | | | | based on the following | | | | events per | | | | OMA-TS-PoC_System_D | | | | escription-V2_1-20110802-A | | | | [56] clause 4.5.7: | | | | | | | | - PTC session initiator | | | | leaves session | | | | | | | | - Defined participant | | | | leaves session | | | | | | | | - Number of participants | | | | less than certain value | | | | | | | | - PTC Session timer | | | | expired | | | | | | | | - PTC Speech inactive for | | | | specified time | | | | | | | | - All Media types inactive | | | | for specified time | | +----------------------+-----------------------------+-------+
#### 7.5.2.6 PTC start of interception
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCStartOfInterception record when a PTC target or a PTC chat group as a
target has an active PTC session in progress. If multiple PTC Sessions are
active at the start of interception, a PTCStartOfInterception record is
generated for each active session. Accordingly, the IRI-POI in the PTC server
generates the xIRI when the following event is detected:
\- when the PTC server detects that LI is enabled on a PTC participant or a
PTC chat group with an active PTC session.
Table 7.5.2-6: Payload for PTCStartOfIntercept record
* * *
Field name Description M/C/O pTCTargetInformation Provide PTC target identity.
At least one among MCPTT ID, IMPU, IMPI, InstanceIdentifierURN and
PTCChatGroupID shall be provided for PTCTargetInformation. M pTCDirection
Indicates the direction of the session relative to the target: \"toTarget\" or
\"fromTarget.\" M pTCPreEstSessionID Identifies the PTC Pre-Established
Session Identity when available. C pTCOriginatingID Shall identify the
originating party. M pTCSessionInfo Shall provide PTC session information such
as PTC Session URI and PTC Session type (e.g. on-demand, pre-established, ad-
hoc, pre-arranged, group session) when available. C pTCHost Shall identify the
PTC participant who has the authority to initiate and administrate a PTC
session, if known. C pTCParticipants Shall identify the individual PTC
participants of the communication session, when known. C location Shall
include the PTC target's location when reporting of the PTC target's location
information is authorized and available. C pTCMediaStreamAvail Shall include
this parameter to indicate if the PTC target is able/not able to receive media
streams immediately. True indicates available for media, while false indicates
not able to accept media. M pTCBearerCapability Shall provide when known the
media characteristics information elements of the PTC session, encoded in SDP
format as per RFC 4566 [43] clause 5. C
* * *
#### 7.5.2.7 PTC pre-established session
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCPre-EstablishedSession record when the IRI-POI present in the PTC server
detects that a pre-established session is setup/modified/released between the
PTC target and the PTC server associated with the PTC target. Accordingly, the
IRI-POI in the PTC server generates the xIRI when the following events are
detected:
\- when the PTC Server receives a SIP INVITE from the PTC target to setup a
pre-established session.
\- when the PTC Server receives a SIP BYE from the PTC target to release a
pre-established session.
\- when the PTC Server receives a SIP UPDATE or SIP re-INVITE from the PTC
target for a pre-established session to modify the current session.
Table 7.5.2-7: Payload for PTCPre-EstablishedSession record
* * *
Field name Description M/C/O pTCTargetInformation Provide PTC target identity.
At least one among MCPTT ID, IMPU, IMPI, InstanceIdentifierURN and
PTCChatGroupID shall be provided for PTCTargetInformation. M pTCServerURI
Shall include the identity of the PTC server serving the PTC target. M
rTPSetting The IP address and the port number of the PTC target at the PTC
server for the RTP Session. M pTCMediaCapability The codec(s) and media
parameters selected by the PTC server from those contained in the original SDP
offer from the PTC target's SIP REFER and encoded in SDP format as per RFC
4566 [43] clause 5. M pTCPreEstSessionID Identifies the PTC Pre-Established
Session Identity. M pTCPreEstStatus Indicates if the pre-established session
is established (setup completed), modified, or released. M pTCMediaStreamAvail
Shall include for a pre-established session to indicate if the PTC target\'s
PTC client is able/not able to receive media streams immediately, when the
pre-established session is established. True indicates available for media,
while false indicates not able to accept media. M location Shall include the
PTC target's location when reporting of the PTC target's location information
is authorized and available. C pTCFailureCode Provide when the pre-established
session cannot be established or modified. C
* * *
#### 7.5.2.8 PTC instant personal alert
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCInstantPersonalAlert record when the IRI-POI present in the PTC server
detects that an Instant Personal Alert (IPA) (i.e. a request for one
participant to initiate a one-to-one PTC session) is initiated by or sent to
the PTC target. Accordingly, the IRI-POI in the PTC server generates the xIRI
when the following events are detected:
\- when the PTC server receives a SIP MESSAGE from a PTC target for an IPA.
\- when the PTC Server sends a SIP MESSAGE to the PTC target for an IPA.
Table 7.5.2-8: Payload for PTCInstantPersonalAlert record
* * *
Field name Description M/C/O pTCTargetInformation Provide PTC target identity.
At least one among MCPTT ID, IMPU, IMPI, InstanceIdentifierURN and
PTCChatGroupID shall be provided for PTCTargetInformation. M pTCIPAPartyID
Identifies the PTC participant that receives or has sent the Instant Personal
Alert to the target. M pTCIPADirection Identifies the direction (To PTC target
or From PTC target) of the Instant Personal Alert. M
* * *
#### 7.5.2.9 PTC party join
The IRI-POI present in the PTC server hosting the PTC chat group session when
the PTC chat group is the PTC target, shall generate an xIRI containing a
PTCPartyJoin record when the IRI-POI present in that PTC server detects when a
PTC participant joins (or re-joins) an on-going PTC chat group session. The
PTCPartyJoin record shall also be generated when the IRI-POI present in the
participating PTC server of the PTC target detects when a PTC Participant
joins (or re-joins) an on-going PTC chat group session. Accordingly, the IRI-
POI in the participating PTC server generates the xIRI when the following
event is detected:
\- when the PTC server hosting a PTC chat group session sends a SIP 200 OK in
response to a SIP INVITE indicating a PTC participant joining the PTC chat
group session.
\- when the participating PTC server of a PTC target forwards a SIP NOTIFY
(received from the PTC server hosting the PTC chat group session) to the PTC
target containing information about a PTC participant joining the PTC chat
group session.
Table 7.5.2-9: Payload for PTCPartyJoin record
+---------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +---------------------------+-----------------------------+-------+ | pTCTargetInformation | Provide PTC target | M | | | identity. At least one | | | | among MCPTT ID, IMPU, IMPI, | | | | InstanceIdentifierURN and | | | | PTCChatGroupID shall be | | | | provided for | | | | PTCTargetInformation. | | +---------------------------+-----------------------------+-------+ | pTCDirection | Indicates the direction of | M | | | the session relative to the | | | | target: \"toTarget\" or | | | | \"fromTarget.\" | | +---------------------------+-----------------------------+-------+ | pTCSessionInfo | Shall provide PTC session | M | | | information such as PTC | | | | Session URI and PTC Session | | | | type (e.g. on-demand, | | | | pre-established, ad-hoc, | | | | pre-arranged, group | | | | session). | | +---------------------------+-----------------------------+-------+ | pTCParticipants | Shall identify the | C | | | individual PTC participants | | | | of the communication | | | | session, when known. | | +---------------------------+-----------------------------+-------+ | participantPresenceStatus | Shall provide the | C | | | Participant Presence | | | | Status, which is a list of: | | | | | | | | - _PresenceID_ : Identity | | | | of PTC client(s) or PTC | | | | group, when known. | | | | | | | | - _PresenceType_ : | | | | Identifies type of ID [PTC | | | | client(s) or PTC group]. | | | | | | | | - _PresenceStatus_ : | | | | Presence state of each ID. | | | | True indicates PTC client | | | | is available, while false | | | | indicates PTC client is | | | | unavailable. | | | | | | | | Report when the Presence | | | | functionality is supported | | | | by the PTC server and the | | | | PTC server assumes the role | | | | of the watcher on behalf of | | | | the PTC target. | | +---------------------------+-----------------------------+-------+ | pTCMediaStreamAvail | Shall include this | M | | | parameter to indicate if | | | | the PTC target is able/not | | | | able to receive media | | | | streams immediately. True | | | | indicates available for | | | | media, while false | | | | indicates not able to | | | | accept media. | | +---------------------------+-----------------------------+-------+ | pTCBearerCapability | Shall provide when known | C | | | the media characteristics | | | | information elements of the | | | | PTC session, encoded in SDP | | | | format as per RFC 4566 | | | | [43] clause 5. | | +---------------------------+-----------------------------+-------+
#### 7.5.2.10 PTC party drop
The IRI-POI present in the PTC server hosting the PTC chat group session, when
the PTC chat group is the PTC target, shall generate an xIRI containing a
PTCPartyDrop record when the IRI-POI present in that PTC server detects that a
PTC participant leaves the PTC chat group session that still remains active
with other PTC participants. The PTCPartyDrop record shall also be generated
when the IRI-POI present in the participating PTC server of the PTC target
detects when a PTC Participant leaves an on-going PTC chat group session.
Accordingly, the IRI-POI in the participating PTC server generates the xIRI
when the following event is detected:
\- when the PTC server hosting a PTC chat group session, where the PTC chat
group is the target, sends a SIP 200 OK in response to a SIP BYE with the PTC
chat group session remaining active with other PTC participants.
\- when the participating PTC server of a PTC target forwards a SIP NOTIFY
(received from the PTC server hosting the PTC chat group session) to the PTC
target containing information about a PTC participant leaving the PTC chat
group session.
Table 7.5.2-10: Payload for PTCPartyDrop record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | pTCTargetInformation | Provide PTC target | M | | | identity. At least one | | | | among MCPTT ID, IMPU, IMPI, | | | | InstanceIdentifierURN and | | | | PTCChatGroupID shall be | | | | provided for | | | | PTCTargetInformation. | | +-----------------------------+-----------------------------+-------+ | pTCDirection | Indicates the direction of | M | | | the session relative to the | | | | target: \"toTarget\" or | | | | \"fromTarget.\" | | +-----------------------------+-----------------------------+-------+ | pTCSessionInfo | Shall provide PTC session | M | | | information such as PTC | | | | Session URI and PTC Session | | | | type (e.g. on-demand, | | | | pre-established, ad-hoc, | | | | pre-arranged, group | | | | session). | | +-----------------------------+-----------------------------+-------+ | pTCPartyDrop | Shall provide the identity | M | | | of the participant that | | | | leaves the PTC session. | | +-----------------------------+-----------------------------+-------+ | p | Shall provide the | C | | TCParticipantPresenceStatus | Participant Presence | | | | Status, which is a list of: | | | | | | | | - _PresenceID_ : Identity | | | | of PTC client(s) or PTC | | | | group, when known. | | | | | | | | - _PresenceType_ : | | | | Identifies type of ID [PTC | | | | client(s) or PTC group]. | | | | | | | | - _PresenceStatus_ : | | | | Presence state of each ID. | | | | True indicates PTC client | | | | is available, while false | | | | indicates PTC client is | | | | unavailable. | | | | | | | | Report when the Presence | | | | functionality is supported | | | | by the PTC server and the | | | | PTC server assumes the role | | | | of the watcher on behalf of | | | | the PTC target. | | +-----------------------------+-----------------------------+-------+
#### 7.5.2.11 PTC party hold
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCPartyHold record when the IRI-POI present in the PTC server detects that an
on-going PTC session is placed on hold or retrieved from hold by the PTC
target or by a PTC participant in a PTC chat group, where the PTC chat group
is the PTC target. Accordingly, the IRI-POI in the PTC server generates the
xIRI when the following event is detected:
\- when the PTC server receives a SIP UPDATE or SIP re-INVITE from the PTC
target and returns a SIP 200 OK to the PTC target for hold/resume operations.
\- when the PTC server hosting a PTC chat group, where PTC chat group is the
PTC target, receives a SIP UPDATE or SIP re-INVITE from a PTC participant for
hold/resume operations.
Table 7.5.2-11: Payload for PTCPartyHold record
* * *
Field name Description M/C/O pTCTargetInformation Provide PTC target identity.
At least one among MCPTT ID, IMPU, IMPI, InstanceIdentifierURN and
PTCChatGroupID shall be provided for PTCTargetInformation. M pTCDirection
Indicates the direction of the session relative to the target: \"toTarget\" or
\"fromTarget.\" M pTCSessionInfo Shall provide PTC session information such as
PTC Session URI and PTC Session type (e.g. on-demand, pre-established, ad-hoc,
pre-arranged, group session). M pTCParticipants Shall identify the individual
PTC participants of the communication session, when known. C pTCHoldID The
identity of the PTC participant that placed the PTC session on hold or
retrieved the held PTC session. M pTCHoldRetrieveInd Shall indicate the PTC
session is put on hold (i.e. deactivate Media Bursts or a PTC session is
locked for talking/listening) or retrieved from hold. True indication equals
placed on hold, false indication was retrieved from hold. M
* * *
#### 7.5.2.12 PTC media modification
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCMediaModification record when the IRI-POI present in the PTC server detects
that a re-negotiation of the media parameters occurs during a PTC session
involving the PTC target. Accordingly, the IRI-POI in the PTC server generates
the xIRI when the following event is detected:
\- when the PTC server receives a SIP UPDATE or SIP reINVITE to indicate a PTC
media modification on a PTC session being intercepted.
Table 7.5.2-12: Payload for PTCMediaModification record
* * *
Field name Description M/C/O pTCTargetInformation Provide PTC target identity.
At least one among MCPTT ID, IMPU, IMPI, InstanceIdentifierURN and
PTCChatGroupID shall be provided for PTCTargetInformation. M pTCDirection
Indicates the direction of the session relative to the target: \"toTarget\" or
\"fromTarget.\" M pTCSessionInfo Shall provide PTC session information such as
PTC Session URI and PTC Session type (e.g. on-demand, pre-established, ad-hoc,
pre-arranged, group session). M pTCMediaStreamAvail Shall include this
parameter to indicate if the PTC target is able/not able to receive media
streams immediately. True indicates available for media, while false indicates
not able to accept media. M pTCBearerCapability Shall provide when known the
media characteristics information elements of the PTC session, encoded in SDP
format as per RFC 4566 [43] clause 5. C
* * *
#### 7.5.2.13 PTC group advertisement
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCGroupAdvertisement record when the IRI-POI present in the PTC server
detects when a PTC target sends group advertisement information to a single
PTC participant, a list of PTC participants, or to all members of a PTC chat
group, as well as when a PTC target receives group advertisement information
from a single PTC participant, a list of PTC participants, or from members of
a PTC chat group using the group identity. Accordingly, the IRI-POI in the PTC
server generates the xIRI when the following events are detected:
\- when the PTC server receives a SIP MESSAGE (containing group advertisement
information) from a PTC target.
\- when the PTC server sends a SIP MESSAGE (containing group advertisement
information) to the PTC target.
Table 7.5.2-13: Payload for PTCGroupAdvertisement record
+----------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +----------------------+-----------------------------+-------+ | pTCTargetInformation | Provide PTC target | M | | | identity. At least one | | | | among MCPTT ID, IMPU, IMPI, | | | | InstanceIdentifierURN and | | | | PTCChatGroupID shall be | | | | provided for | | | | PTCTargetInformation. | | +----------------------+-----------------------------+-------+ | pTCDirection | Indicates the direction of | M | | | the session relative to the | | | | target: \"toTarget\" or | | | | \"fromTarget.\" | | +----------------------+-----------------------------+-------+ | pTCIDList | Shall provide Identities of | C | | | each participant from the | | | | target\'s contact list | | | | (i.e. individuals) and PTC | | | | group list (i.e. list of | | | | pre-identified individuals | | | | using a group | | | | identification) for a group | | | | call when available. | | +----------------------+-----------------------------+-------+ | pTCGroupAuthRule | Identifies the action | C | | | requested by the PTC target | | | | to the PTC Group | | | | Authorization Rules: | | | | | | | | - Report when action | | | | requested to the PTC Group | | | | Authorization Rules by the | | | | PTC target. | | | | | | | | - Report when the PTC | | | | target attempts a change or | | | | queries the access control | | | | list(s). | | +----------------------+-----------------------------+-------+ | pTCGroupAdSender | Identifies the sender of | M | | | the group advertisement. | | +----------------------+-----------------------------+-------+ | pTCGroupNickname | The nickname is a | C | | | human-readable tag (e.g. | | | | \"display-name\" in a SIP | | | | header associated with a | | | | PTC client or PTC group per | | | | OMA-TS-PoC_System_D | | | | escription-V2_1-20110802-A | | | | [56]). | | +----------------------+-----------------------------+-------+
#### 7.5.2.14 PTC floor control
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCFloorControl record when the IRI-POI present in the PTC server detects when
the PTC target requests floor control (i.e. send media), when floor control is
granted to PTC target, when floor control request from the PTC target is
rejected/released, when the floor becomes open (e.g. idle), when the floor
control request from the PTC target is queued, when the floor control request
from the PTC target is dequeued, or when the floor control request is revoked.
In addition, when the PTC chat group is the PTC target, the IRI-POI present in
the PTC server hosting the PTC chat group shall generate an xIRI containing a
PTCFloorControl record when the IRI-POI present in the PTC server detects any
of the previously mentioned scenarios for all PTC participants participating
in the PTC chat group session. Accordingly, the IRI-POI in the PTC server
generates the xIRI when the following events are detected:
\- when the PTC server receives a TBCP Talk Burst Request from the PTC target.
\- when the PTC server hosting the PTC chat group, where the PTC chat group is
the PTC target, receives a TBCP Talk Burst Request from a PTC participant.
\- when the PTC server sends a TBCP Talk Burst Granted to a PTC target.
\- when the PTC server hosting the PTC chat group, where the PTC chat group is
the PTC target, sends a TBCP Talk Burst Granted to a PTC participant.
\- when the PTC server sends a TBCP Talk Burst Taken to a PTC target.
\- when the PTC server hosting the PTC chat group, where the PTC chat group is
the PTC target, sends a TBCP Talk Burst Taken to a PTC participant.
\- when the PTC server sends a TBCP Talk Burst Deny to a PTC target.
\- when the PTC server hosting the PTC chat group, where the PTC chat group is
the PTC target, sends a TBCP Talk Burst Deny to a PTC participant.
\- when the PTC server sends a TBCP Talk Burst Release to a PTC target.
\- when the PTC server hosting the PTC chat group, where the PTC chat group is
the PTC target, sends a TBCP Talk Burst Release to a PTC participant.
\- when the PTC server sends a TBCP Talk Burst Idle to a PTC target.
\- when the PTC server hosting the PTC chat group, where the PTC chat group is
the PTC target, sends a TBCP Talk Burst Idle to a PTC participant.
\- when the PTC server sends a TBCP Talk Burst Request Queue Status Response
to a PTC target.
\- when the PTC server hosting the PTC chat group, where the PTC chat group is
the PTC target, sends a TBCP Talk Burst Request Queue Status Response to a PTC
participant.
\- when the PTC server receives a TBCP Talk Burst Cancel from a PTC target.
\- when the PTC server hosting the PTC chat group, where the PTC chat group is
the PTC target, receives a TBCP Talk Burst Cancel from a PTC participant.
\- when the PTC server sends a TBCP Talk Burst Revoke to a PTC target.
\- when the PTC server hosting the PTC chat group, where the PTC chat group is
the PTC target, sends a TBCP Talk Burst Revke to a PTC participant.
Table 7.5.2-14: Payload for PTCFloorControl record
+-----------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------+-----------------------------+-------+ | pTCTargetInformation | Provide PTC target | M | | | identity. At least one | | | | among MCPTT ID, IMPU, IMPI, | | | | InstanceIdentifierURN and | | | | PTCChatGroupID shall be | | | | provided for | | | | PTCTargetInformation. | | +-----------------------+-----------------------------+-------+ | pTCDirection | Indicates the direction of | M | | | the session relative to the | | | | target: \"toTarget\" or | | | | \"fromTarget.\" | | +-----------------------+-----------------------------+-------+ | pTCSessioninfo | Shall provide PTC session | M | | | information such as PTC | | | | Session URI and PTC Session | | | | type (e.g. on-demand, | | | | pre-established, ad-hoc, | | | | pre-arranged, group | | | | session). | | +-----------------------+-----------------------------+-------+ | pTCFloorActivity | Sequence of: | M | | | | | | | a) \"TBCP_Request\": | | | | Received by the PTC server | | | | to request permission for | | | | the PTC target or PTC | | | | participant to send a talk | | | | burst. | | | | | | | | b) \"TBCP_Granted\": Used | | | | by the PTC server to notify | | | | the PTC target or PTC | | | | participant that it has | | | | been granted permission to | | | | send a talk burst. | | | | | | | | c) \"TBCP_Deny\": Used by | | | | the PTC server to notify a | | | | PTC target or PTC | | | | participant that it has | | | | been denied permission to | | | | send a talk burst. | | | | | | | | d) \"TBCP_Idle\": Used by | | | | the PTC server to notify | | | | the PTC target or PTC | | | | participant that no one has | | | | the permission to send a | | | | Talk Burst at the moment | | | | and that it may accept the | | | | TBCP talk burst request | | | | message. | | | | | | | | e) \"TBCP_Taken\": Used | | | | by the PTC server to notify | | | | the PTC target or PTC | | | | participant that another | | | | PTC participant has been | | | | given permission to send a | | | | talk burst. | | | | | | | | f) \"TBCP_Revoke\": Used | | | | by the PTC server to revoke | | | | the media resource from the | | | | PTC target or PTC | | | | participant and can be used | | | | for pre-emption | | | | functionality but is also | | | | used by the system to | | | | prevent overly long use of | | | | the media resource. | | | | | | | | g) \"TBCP_Queued\": | | | | Indicates the request to | | | | talk is queued, if queued | | | | floor control is supported. | | | | Include identification of | | | | the PTC target or PTC | | | | participant that has the | | | | queued talk burst, if | | | | known. | | | | | | | | h) \"TBCP_Release\": | | | | Indicates the request to | | | | talk has completed. | | +-----------------------+-----------------------------+-------+ | pTCFloorSpeakerID | Include identification of | C | | | the PTC participant that | | | | has initiated the talk | | | | burst, if known. | | +-----------------------+-----------------------------+-------+ | pTCMaxTBTime | Include the maximum | C | | | duration value for the talk | | | | burst before the permission | | | | is revoked. This parameter | | | | is defined in seconds. | | | | Provide when known. | | +-----------------------+-----------------------------+-------+ | pTCQueuedFloorControl | Indicates if queuing is | C | | | supported by the PTC server | | | | and the PTC target\'s | | | | device. | | +-----------------------+-----------------------------+-------+ | pTCQueuedPosition | Include if queue position | C | | | in the TBCP is detected by | | | | the IRI-POI. | | +-----------------------+-----------------------------+-------+ | pTCTalkBurstPriority | If more than one level of | C | | | priority is supported, | | | | indicates the talk burst | | | | priority level of the PTC | | | | target. | | +-----------------------+-----------------------------+-------+ | pTCTalkBurstReason | The reason for the denial | C | | | or revoke of a Talk Burst. | | | | Provide when known. | | +-----------------------+-----------------------------+-------+
#### 7.5.2.15 PTC target presence
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCTargetPresence record when the IRI-POI present in the PTC server detects
that the PTC server publishes network presence information to the Presence
server on behalf of the PTC target. Accordingly, the IRI-POI in the PTC server
generates the xIRI when the following event is detected:
\- when the PTC server sends a SIP PUBLISH message to the Presence server
based on the PTC target's PTC session involvement.
Table 7.5.2-15: Payload for PTCTargetPresence record
+-------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-------------------------+-----------------------------+-------+ | pTCTargetInformation | Provide PTC target | M | | | identity. At least one | | | | among MCPTT ID, IMPU, IMPI, | | | | InstanceIdentifierURN and | | | | PTCChatGroupID shall be | | | | provided for | | | | PTCTargetInformation. | | +-------------------------+-----------------------------+-------+ | pTCTargetPresenceStatus | Shall provide the PTC | M | | | target presence status, | | | | which is a list of: | | | | | | | | - _PresenceID_ : Identity | | | | of PTC client(s) or PTC | | | | group, when known. | | | | | | | | - _PresenceType_ : | | | | Identifies type of ID [PTC | | | | client(s) or PTC group]. | | | | | | | | - _PresenceStatus_ : | | | | Presence state of each ID. | | | | True indicates PTC target | | | | is available, while false | | | | indicates PTC target is | | | | unavailable. | | +-------------------------+-----------------------------+-------+
#### 7.5.2.16 PTC participant presence
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCParticipantPresence record when the IRI-POI present in the PTC server (when
it supports the Presence functionality and assumes the role of the Watcher on
behalf of the PTC target) detects that the PTC server receives presence status
notifications from the Presence servers after having subscribed to the PTC
presence status of other PTC participants (i.e. participants in communication
with the PTC target). Accordingly, the IRI-POI in the PTC server generates the
xIRI when the following event is detected:
\- when the PTC server receives a SIP NOTIFY in response to a SIP SUBSCRIBE
updating presence information for a participant.
Table 7.5.2-16: Payload for PTCParticipantPresence record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | pTCTargetInformation | Provide PTC target | M | | | identity. At least one | | | | among MCPTT ID, IMPU, IMPI, | | | | InstanceIdentifierURN and | | | | PTCChatGroupID shall be | | | | provided for | | | | PTCTargetInformation. | | +-----------------------------+-----------------------------+-------+ | p | Shall provide the | M | | TCParticipantPresenceStatus | Participant Presence | | | | Status, which is a list of: | | | | | | | | - _PresenceID_ : Identity | | | | of PTC client(s) or PTC | | | | group, when known. | | | | | | | | - _PresenceType_ : | | | | Identifies type of ID [PTC | | | | client(s) or PTC group]. | | | | | | | | - _PresenceStatus_ : | | | | Presence state of each ID. | | | | True indicates PTC client | | | | is available, while false | | | | indicates PTC client is | | | | unavailable. | | | | | | | | Report when the Presence | | | | functionality is supported | | | | by the PTC server and the | | | | PTC server assumes the role | | | | of the watcher on behalf of | | | | the PTC target. | | +-----------------------------+-----------------------------+-------+
#### 7.5.2.17 PTC list management
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCListManagement record when the IRI-POI present in the PTC server detects
that the PTC target attempts to change their contact list/group list(s) or
those lists are updated by the network. Accordingly, the IRI-POI in the PTC
server generates the xIRI when the following events are detected:
\- when the PTC server receives a SIP PUBLISH from a PTC target to change the
PTC target's contact list or group list(s).
\- when the PTC server receives a SIP NOTIFY from other PTC participants
updating the PTC target's contact list or group list(s) (e.g. participant
reachability).
Table 7.5.2-17: Payload for PTCListManagement record
+--------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +--------------------------+-----------------------------+-------+ | pTCTargetInformation | Provide PTC target | M | | | identity. At least one | | | | among MCPTT ID, IMPU, IMPI, | | | | InstanceIdentifierURN and | | | | PTCChatGroupID shall be | | | | provided for | | | | PTCTargetInformation. | | +--------------------------+-----------------------------+-------+ | pTCDirection | Indicates the direction of | M | | | the session relative to the | | | | target: \"toTarget\" or | | | | \"fromTarget.\" | | +--------------------------+-----------------------------+-------+ | pTCListManagementType | The \"List Management | C | | | Attempts\" identify the | | | | type of list being managed | | | | by the target when | | | | available: | | | | | | | | a) | | | | C | | | | ontactListManagementAttempt | | | | | | | | b) | | | | GroupListManagementAttempt | | | | | | | | c) | | | | ContactListManagementResult | | | | | | | | d) | | | | GroupListManagementResult | | | | | | | | e) Request unsuccessful | | | | | | | | For example, a) and b) are | | | | reported when PTC target | | | | attempts changes to their | | | | contact list and their PTC | | | | group list(s). | | | | | | | | The \"List Management | | | | Results\" identify the | | | | network response to a | | | | modification by the PTC | | | | target. | | | | | | | | For example, c), d), or e) | | | | is reported when the | | | | network notifies the PTC | | | | target of changes to their | | | | contact list or their PTC | | | | group list(s). | | +--------------------------+-----------------------------+-------+ | pTCListManagementAction | Identifies the action | C | | | requested by the PTC target | | | | to the contact lists or PTC | | | | group list(s). Report when | | | | PTC target attempts changes | | | | to his contact list or PTC | | | | group list(s): | | | | | | | | a) Create | | | | | | | | b) Modify | | | | | | | | c) Retrieve | | | | | | | | d) Delete | | | | | | | | e) Notify | | | | | | | | Also report when a | | | | notification is sent to the | | | | PTC target due to changes | | | | occurring to his contact | | | | list or PTC group list(s). | | +--------------------------+-----------------------------+-------+ | pTCListManagementFailure | Report when list management | C | | | request is unsuccessful. | | +--------------------------+-----------------------------+-------+ | pTCContactID | Identity of the contact in | C | | | the list. One contact per | | | | contact list or PTC group | | | | list. Report if known. | | +--------------------------+-----------------------------+-------+ | pTCIDList | Shall provide identities of | C | | | each participant from the | | | | PTC target\'s contact list | | | | (i.e. individuals) and PTC | | | | group list (i.e. list of | | | | pre-identified individuals | | | | using a group | | | | identification) for a group | | | | call. Report if known. | | +--------------------------+-----------------------------+-------+ | pTCHost | Identifies the PTC | C | | | participant who has | | | | authority to initiate and | | | | administrate an active PTC | | | | group session. Provide when | | | | known. | | +--------------------------+-----------------------------+-------+
#### 7.5.2.18 PTC access policy
The IRI-POI present in the PTC server shall generate an xIRI containing a
PTCAccessPolicy record when the IRI-POI present in the PTC server detects when
the PTC target attempts to change the access control lists (e.g. PTC user
access policy and PTC group authorization rules) located in the PTC XML
Document Management Server (XDMS). Accordingly, the IRI-POI in the PTC server
generates the xIRI when the following event is detected:
\- when the PTC server receives a SIP PUBLISH from a PTC target to change the
access control lists.
Table 7.5.2-18: Payload for PTCAccessPolicy record
+------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +------------------------+-----------------------------+-------+ | pTCTargetInformation | Provide PTC target | M | | | identity. At least one | | | | among MCPTT ID, IMPU, IMPI, | | | | InstanceIdentifierURN and | | | | PTCChatGroupID shall be | | | | provided for | | | | PTCTargetInformation. | | +------------------------+-----------------------------+-------+ | pTCDirection | Indicates the direction of | M | | | the session relative to the | | | | target: \"toTarget\" or | | | | \"fromTarget.\" | | +------------------------+-----------------------------+-------+ | pTCAccessPolicyType | Identifies the type of | C | | | access policy list being | | | | managed or queried by the | | | | target when known: | | | | | | | | a) | | | | PTCUserAccessPolicyAttempt | | | | | | | | b) | | | | Gro | | | | upAuthorizationRulesAttempt | | | | | | | | c) | | | | PTCUserAccessPolicyQuery | | | | | | | | d) | | | | G | | | | roupAuthorizationRulesQuery | | | | | | | | e) | | | | PTCUserAccessPolicyResult | | | | | | | | f) | | | | Gr | | | | oupAuthorizationRulesResult | | | | | | | | g) Request unsuccessful | | | | | | | | - Report a), b), c), or d) | | | | when the PTC target | | | | attempts a change or | | | | queries the Access Control | | | | list(s). | | | | | | | | - Report e), f), or g) | | | | when the network notifies | | | | the target of changes to | | | | the access control list(s) | | | | or the request was | | | | unsuccessful. | | +------------------------+-----------------------------+-------+ | pTCUserAccessPolicy | Identifies the action | C | | | requested by the PTC target | | | | to the PTC user or group | | | | access policy: | | | | | | | | a) Allow Incoming PTC | | | | session request | | | | | | | | b) Block Incoming PTC | | | | session request | | | | | | | | c) Allow Auto Answer Mode | | | | | | | | d) Allow Override Manual | | | | Answer Mode | | | | | | | | - Report when action | | | | requested to the PTC user | | | | access policy. | | | | | | | | - Report when the PTC | | | | target attempts a change or | | | | queries the access control | | | | list(s). | | +------------------------+-----------------------------+-------+ | pTCGroupAuthRule | Identifies the action | C | | | requested by the PTC target | | | | to the PTC Group | | | | Authorization Rules: | | | | | | | | a) Allow Initiating PTC | | | | session | | | | | | | | b) Block Initiating PTC | | | | session | | | | | | | | c) Allow Joining PTC | | | | session | | | | | | | | d) Block Joining PTC | | | | session | | | | | | | | e) Allow Add Participants | | | | | | | | f) Block Add Participants | | | | | | | | g) Allow Subscription PTC | | | | session state | | | | | | | | h) Block Subscription PTC | | | | session state | | | | | | | | i) Allow Anonymity | | | | | | | | j) Forbid Anonymity | | | | | | | | - Report when action | | | | requested to the PTC group | | | | authorization rules by the | | | | PTC target. | | | | | | | | - Report when the PTC | | | | target attempts a change or | | | | queries the access control | | | | List(s). | | +------------------------+-----------------------------+-------+ | pTCContactID | Identity of the contact in | C | | | the list. One contact per | | | | contact list or PTC group | | | | list. Report if known. | | +------------------------+-----------------------------+-------+ | pTCAccessPolicyFailure | Reports the reason for | C | | | failure when access policy | | | | request is _unsuccessful._ | | +------------------------+-----------------------------+-------+
### 7.5.3 IRI and CC Generation
#### 7.5.3.1 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in the PTC server, the
MDF2 shall generate the corresponding IRI message and deliver it over LI_HI2
without undue delay. The IRI shall contain a copy of the record received over
LI_X2. This record may be enriched with any additional information available
at the MDF2 (e.g. additional location information).
#### 7.5.3.2 Generation of CC over LI_HI3
When xCC is received over LI_X3 from the CC-POI in the PTC server, the MDF3
shall populate the threeGPP33128DefinedCC field with a CCPayload structure
containing PTCCCPDU and send it over LI_HI3 interface to LEMF without undue
delay.
The PTC media contents are structured in a CC payload as formatted in clause
5.5.3 of the present document.
## 7.6 Identifier Association Reporting
### 7.6.1 General
The IEF, ICF and IQF are responsible for detecting, storing and providing to
the LEA permanent to temporary identifier associations, requested by the LEA
in authorised requests. The IEF as defined in clause 6.2.2A is responsible for
detecting and generating identifier associations records. The ICF is
responsible for caching identifier associations for short duration and the IQF
is responsible for handling requests from the LEA and providing those requests
to the ICF in order to identify the matching identifier associations.
### 7.6.2 ICF
#### 7.6.2.1 General
The ICF is responsible for caching identifier associations provided in event
records from the IEF over LI_XER and handling queries and subsequent responses
from the IQF for responses over LI_XQR.
#### 7.6.2.2 ICF receipt of records over LI_XER
When the ICF receives an identifier association event record over LI_XER from
an IEF (see clause 5.9), the ICF shall use the records to update the
identifier associations cached by the ICF. The ICF shall handle the event
records as described in clause 7.6.2.4.
#### 7.6.2.3 ICF Query and Response over LI_XQR
When the ICF receives an identifier association query request from the IQF,
the ICF shall search the cached identifier associations to establish a match,
based on RequestValues received in the request (see clause 5.8), subject to
clause 7.6.2.4.
Upon successful matching of one or more identifier associations which were
active at or around (within a pre-defined search time window) the observed
time specified in the query, the ICF shall provide a response to the IQF using
the IdentityAssociationResponse message as defined in clause 5.8. Where the
ICF is not able to provide a single identifier association based on the
RequestValues, the IQF is responsible for any subsequent handling of multiple
identifier associations in terms of whether to provide all associations to the
LEA over LI_HIQR.
#### 7.6.2.4 ICF Identifier Association Event Handling
Upon receipt of an Association event as defined in clause 6.2.2A.2, the ICF
shall cache the identifier association(s) contained within the record as
followings:
\- SUPI to 5G-GUTI association received, in an IEFAssociationRecord is stored
by ICF as an active association. The previous active association for the same
SUPI, if any, is marked as a previously active association and cached until
the cache time limit is reached.
\- If the IEFAssociationRecord also contains a SUCI, the SUCI is stored as a
part of the received SUPI to 5G-GUTI association, for the lifetime of that
association.
\- Where the IEFDeassociationRecord corresponds to an active SUPI to 5G-GUTI
association at ICF, the association is marked as a previously active
association and cached until the cache time limit is reached.
The ICF shall have a CSP defined maximum active association lifetime (upon
expiry of which the association is deleted from the ICF).
NOTE 1: This is needed to prevent an association from not being deleted from
ICF under some error conditions (e.g. a loss of IEF message carrying
IEFDeassociationRecord caused by the implicit deregistration of an out-of-
service UE). The selection of the maximum active association lifetime value
needs to ensure that no valid active associations are deleted upon the
lifetime expiry, i.e. the longest possible association refresh time supported
by CSP's network needs to be accommodated.
For previous associations placed in the cache, the ICF shall store the times
of association and disassociation, respectively.
Where an IEFAssociationRecord contains a PEI, GPSI, NCGI or a TAI list, the
ICF shall store the received values and associate them both the current
received SUPI to 5G-GUTI association and any future association until:
\- A subsequent IEFAssociationRecord is received which updates the PEI, GPSI,
NCGI or TAI list values.
\- The old PEI / GPSI / NCGI / TAI list shall be retained in association with
previous SUPI to 5G-GUTI associations until those associations are deleted
from cache.
\- New PEI / GPSI / NCGI / TAI list shall be used in association with both the
association(s) with which it was received and any subsequent associations
until another update is received.
\- All SUPI associations for which the PEI / GPSI / NCGI / TAI list is valid
are deleted from the cache.
When the ICF receives a query request from the IQF as defined in clause
7.6.2.3, the ICF shall search available identifier associations (both active
associations and those marked for deletion in the cache) for a match. The ICF
shall be able to use both time and TAI (as a single TAI and in relation to a
TAI list) to identify the correct SUPI to 5G-GUTI association(s). For
associations which have been disassociated (and will be deleted once the cache
time limit is reached), the time of disassociation is used by the ICF to
identify the correct association match (based on observed time in LEA
request), where multiple associations are held in the cache.
NOTE 2: Use of nCGI to match associations based on physical location for SUCI
/ 5G-S-TMSI to SUPI requests, is out of scope of the present document.
As the LEA and CSP are unlikely to have synchronised the time of identifier
observation / association provided by the LEA in the query request, with NF
time of the IEFs, the ICF shall search the cached identifier associations
using a short window time duration both before and after (subject to overall
cache duration) the observed time provided by the LEA in the RequestValues
over LI_XQR.
NOTE 3: While the search window duration before and after the LEA provided
observed time value is outside the scope of the present document, selection of
this value by the CSP needs to take into consideration, among other aspects,
the duration of a potential period of recovery from a 5G-GUTI update error, in
order to prevent missing of otherwise matching associations due to
discrepancies between their stored association/disassociation time and the
observed time provided by LEA.
NOTE 4: While the value of the short-term caching time is outside the scope of
the present document, selection of this value by the CSP needs to take into
consideration, among other aspects, the duration of potential period of
recovery from a 5G-GUTI update error, in order to prevent previous
associations being deleted before they have been fully disassociated by both
the UE and AMF.
### 7.6.3 IQF
#### 7.6.3.1 General
The IQF is responsible for receiving and responding to LEA requests over
LI_HIQR. Following receipt of a request over LI_HIQR, the IQF shall validate
the request and ensure that the request is within the cache period of
associations stored in the ICF. If the request is valid and within the ICF
cache period, the IQF shall send an association search request to the ICF over
LI_XQR. If the request is not within the ICF cache period or overwise invalid,
the IQF shall reject the request and respond to the LEA over LI_HIQR.
Following receipt of an association search request response from the ICF over
LI_XQR, the IQF shall forward any matching identifier association(s) to the
LEA over LI_HIQR. If the ICF indicates zero matches were found based on the
information provided in the initial request over LI_HIQR, the IQF shall
respond to the LEA over LI_HIQR indicating that no identifier associations
were found based on the request from the LEA.
If the ICF responds with multiple associations of 5G-GUTIs / SUCIs to a single
SUPI, the IQF shall provide all matched associations to the LEA over LI_HIQR.
Handling in the case of multiple SUPIs to a single 5G-GUTI (where the initial
request over LI_HIQR is based on 5G-S-TMSI or SUCI) is outside the scope of
the present document.
#### 7.6.3.2 IQF Query and Response over LI_HIQR
The IQF is responsible for receiving query requests from and providing query
responses to the LEA over LI_HIQR. Further details of LI_HIQR messages are
defined in clause 5.7.
#### 7.6.3.3 IQF Query and Response over LI_XQR
The IQF is responsible for generating queries to and receiving query responses
requests from the ICF over LI_XQR, based on queries received from the LEA over
LI_HIQR. Further details of LI_XQR messages are defined in clause 5.8.
## 7.7 LI at NEF
### 7.7.1 Provisioning over LI_X1
#### 7.7.1.1 General
For NIDD using NEF:
\- If delivery type for the warrant is \"IRI and CC\", then the IRI-POI and
the CC-POI in the NEF, the MDF2 and MDF3 shall be provisioned.
\- If delivery type for the warrant is \"IRI\", then the IRI-POI in the NEF
and the MDF2 shall be provisioned.
\- Delivery type \"CC\" is not applicable to the warrant.
For device triggering, MSISDN-less MO SMS and Parameter Provisioning:
\- the delivery type for the warrant is \"IRI\"; the IRI-POI in the NEF and
the MDF2 shall be provisioned.
#### 7.7.1.2 Provisioning of the IRI-POI and CC-POI in NEF
The IRI-POI and CC-POI present in the NEF are provisioned over LI_X1 by the
LIPF using the X1 protocol as described in clause 5.2.2.
The POI in the NEF shall support the following target identifier formats in
the ETSI TS 103 221-1 [7] messages (or equivalent if ETSI TS 103 221-1 [7] is
not used):
\- SUPIIMSI.
\- SUPINAI.
\- GPSIMSISDN.
\- GPSINAI.
NOTE: For Parameter Provisioning, only GPSIMSISDN and GPSINAI are applicable.
### 7.7.2 LI for NIDD using NEF
#### 7.7.2.1 Generation of xIRI at IRI-POI in NEF over LI_X2
##### 7.7.2.1.1 General
The IRI-POI present in the NEF shall send the xIRIs over LI_X2 for each of the
events listed in TS 33.127 [5] clause 7.9.2.3, the details of which are
described in the following clauses. Each event will be based on PDU session
between NEF and target UE, except for Unsuccessful Procedure event. The IRI-
POI in the NEF shall also send a SeparatedLocationReporting xIRI (as described
in clause 7.3.4.1) when the IRI-POI provisioned in the NEF receives updated UE
location information via the Nnef_Location_LocationUpdateNotify service
operation destined for an external AF.
##### 7.7.2.1.2 PDU session establishment
The IRI-POI in the NEF shall generate an xIRI containing an
NEFPDUSessionEstablishment record when the IRI-POI present in the NEF detects
that an unstructured PDU session using NEF has been established for the target
UE. The IRI-POI present in the NEF shall generate the xIRI for the following
event:
\- NEF returns Nnef_SMContext_Create Response towards the SMF confirming the
establishment of the unstructured PDU session to the NEF for the target UE (as
defined in TS 29.541 [57] clause 5.2.2.2) and connection to the AF is
established.
Table 7.7.2-1: NEFPDUSessionEstablishment record
Field name Value M/C/O
* * *
sUPI SUPI associated with the PDU session (e.g. as provided by the SMF in the
associated Nnef_SMContext_Create Request). M gPSI GPSI associated with the PDU
session. M pDUSessionID PDU Session ID. M sNSSAI Slice identifier associated
with the PDU session. C nEFID NEF identity handling the PDU session. M dNN
Data Network Name associated with the target traffic. Shall be given in
dotted-label presentation format as described in TS 23.003 [19] clause 9.1. M
rDSSupport True if Reliable Data Service is supported in the PDU session,
otherwise False. M sMFID Identifier of the SMF associated with the target UE
for that that PDU Session. M aFID Identifier of the AF. M
##### 7.7.2.1.3 PDU session modification
The IRI-POI in the NEF shall generate an xIRI containing an
NEFPDUSessionModification record when the IRI-POI present in the NEF detects
that an unstructured PDU session using NEF has been modified for the target
UE. The IRI-POI present in the NEF shall generate the xIRI for the following
events:
\- NEF returns Nnef_SMContext_Update Response to SMF to confirm the
modification of the connection between SMF and NEF (see TS 29.541 [57] clause
5.2.2.5).
\- NEF returns a RDS MANAGE PORT Response to a UE with a \"Status\" field set
to \"Success\" in response to a RDS MANAGE PORT command sent by UE with an
\"Action\" field set to \"Reserve port\" to confirm the reservation of a
combination of source and destination port numbers for use for a traffic to be
sent by the UE to a specific application on an AF (see TS 24.250 [61] clause
5.4.2.6.2).
\- NEF receives a RDS MANAGE PORT Response from a UE with a \"Status\" field
set to \"Success\" in response to a RDS MANAGE PORT command sent by the NEF
with an \"Action\" field set to \"Reserve port" to confirm the reservation of
a combination of source and destination port numbers for use for a traffic to
be sent by an AF to a specific application on the UE (see TS 24.250 [61]
clause 5.4.2.6.2).
\- NEF returns a RDS MANAGE PORT Response to a UE with a \"Status\" field set
to \"Success\" in response to a RDS MANAGE PORT command sent by UE with an
\"Action\" field set to \"Release port\" to confirm the release of a
combination of source and destination port numbers for an application on an AF
(see TS 24.250 [61] clause 5.4.2.6.3).
\- NEF receives a RDS MANAGE PORT Response from a UE with a \"Status\" field
set to \"Success\" in response to a RDS MANAGE PORT command sent by the NEF
with an \"Action\" field set to \"Release port\" to confirm the release of a
combination of source and destination port numbers for an application on the
UE (see TS 24.250 [61] clause 5.4.2.6.3).
Table 7.7.2-2: NEFPDUSessionModification record
Field name Value M/C/O
* * *
sUPI SUPI associated with the PDU session M gPSI GPSI associated with the PDU
session M sNSSAI Slice identifier associated with the PDU session M Initiator
Initiator of the modification of the PDU session, UE, SMF or NEF M
rDSSourcePortNumber RDS source port number C rDSDestinationPortNumber RDS
destination port number C applicationID Application identifier on the UE or on
the AF if RDS is used C aFID Identifier of the AF if RDS is used C rDSAction
Action if RDS is used. Possible values: \"ReservePort\", \"ReleasePort\" C
serializationFormat Data format exchanged between UE and AF if RDS is used C
##### 7.7.2.1.4 PDU session release
The IRI-POI in the NEF shall generate an xIRI containing an
NEFPDUSessionRelease record when the IRI-POI present in the NEF detects that
an unstructured PDU session using NEF related to the target UE needs to be
released. The IRI-POI present in the NEF shall generate the xIRI for the
following events:
\- NEF notifies the SMF that the SMF-NEF Connection for NIDD via NEF is no
longer valid using Nnef_SMContext_DeleteNotify service operation when NEF
receives a notification from the UDM that the NIDD authorization has ended.
NEF releases the SM Context for NIDD on NEF as described in TS 29.541 [57]
clause 5.2.2.4. This corresponds to NEF Initiated SMF-NEF Connection Release
procedure.
\- NEF returns Nnef_SMContext_Delete Response towards SMF confirming release
of the SMF-NEF session for the target UE. In this scenario, SMF releases the
SM Context for NIDD on NEF as specified in TS 29.541 [57] clause 5.2.2.3).
Table 7.7.2-3: NEFPDUSessionRelease record
Field name Value M/C/O
* * *
sUPI SUPI associated with the PDU session M gPSI GPSI associated with the PDU
session M pDUSessionID PDU Session ID as assigned by the AMF M
timeOfFirstPacket Time of first packet for the PDU session C timeOfLastPacket
Time of last packet for the PDU session C uplinkVolume Number of uplink octets
for the PDU session C downlinkVolume Number of downlink octets for the PDU
session C releaseCause Cause of PDU Session Release M
##### 7.7.2.1.5 Unsuccessful procedure
The IRI-POI in the NEF shall generate an xIRI containing an
NEFUnsuccessfulProcedure record when the IRI-POI present in the NEF detects an
unsuccessful procedure or error condition for a UE matching one of the target
identifiers provided via LI_X1.
Accordingly, the IRI-POI in the NEF generates the xIRI when one of the
following events are detected as described in TS 29.541 [57] clause 6.1.7.3
and TS 24.250 [61] clause 5.4.2.6:
\- NEF sends a Nnef_SMContext_Create Reject message to the SMF with a reject
cause set to \"USER_UNKNOWN\" or \"NIDD_CONFIGURATION_NOT_AVAILABLE\".
\- NEF returns a RDS MANAGE PORT Response to a UE with a \"Status\" field set
to \"Port not free\" in response to a RDS MANAGE PORT command sent by UE with
an \"Action\" field set to \"Reserve port\".
\- NEF receives a RDS MANAGE PORT Response from a UE with a \"Status\" field
set to \"Port not free\" in response to a RDS MANAGE PORT command sent by NEF
with an \"Action\" field set to \"Reserve port\".
\- NEF returns a RDS MANAGE PORT Response to a UE with a \"Status\" field set
to \"Port not associated with specified application\" in response to a RDS
MANAGE PORT command sent by UE with an \"Action\" field set to \"Release
port\".
\- NEF receives a RDS MANAGE PORT Response from a UE with a \"Status\" field
set to \"Port not associated with specified application\" in response to a RDS
MANAGE PORT command sent by NEF with an \"Action\" field set to \"Release
port\".
Table 7.7.2-4: NEFUnsuccessfulProcedure record
Field name Value M/C/O
* * *
failureCause Provides the value of the failure cause. M sUPI SUPI associated
with the procedure. M gPSI GPSI used in the procedure, if available. C
pDUSessionID PDU Session ID. C dNN Data Network Name associated with the
target traffic, if available. Shall be given in dotted-label presentation
format as described in TS 23.003 [19] clause 9.1. C sNSSAI Slice requested for
the procedure, if available. C rDSDestionationPortNumber RDS destination port
number. C applicationID Application associated with the RDS destination port
number. C aFID Application Function identifier. If the Application Function
idenitifer is not available, the placeholder value \"Unknown\" shall be used.
M
##### 7.7.2.1.6 Start of interception with established PDU session
The IRI-POI in the NEF shall generate an xIRI containing an
NEFStartOfInterceptionWithEstablishedPDUSession record when the IRI-POI
present in the NEF detects that an unstructured PDU session using NEF has
already been established, at the time the POI on NEF is provisioned with a new
target ID.
The IRI-POI in the NEF shall generate the xIRI containing the
NEFStartOfInterceptionWithEstablishedPDUSession record for each of the PDU
sessions for NIDD using NEF associated with the target UE with a different
value of correlation information.
Table 7.7.2-5: NEFStartOfInterceptionWithEstablishedPDUSession record
Field name Value M/C/O
* * *
sUPI SUPI associated with the PDU session (e.g. as provided by the SMF in the
associated Nnef_SMContext_Create Request). M gPSI GPSI associated with the PDU
session. M pDUSessionID PDU Session ID. M sNSSAI Slice identifier associated
with the PDU session. M dNN Data Network Name associated with the target
traffic. Shall be given in dotted-label presentation format as described in TS
23.003 [19] clause 9.1. M nEFID NEF identity handling the PDU session. M
rDSSupport True if Reliable Data Service is supported in the PDU session,
otherwise False. M sMFID Identifier of the SMF associated with the target UE
for that that PDU Session. M aFID String Identifying the AF the traffic will
be delivered to. M
The IRI-POI present in the SMF generating an xIRI containing a
NEFStartOfInterceptionWithEstablishedPDUSession record shall set the Payload
Direction field in the PDU header to _not applicable_ (see ETSI TS 103 221-2
[8] clause 5.2.6).
#### 7.7.2.2 Generation of xCC at CC-POI in NEF over LI_X3
The CC-POI present in the NEF shall send xCC over LI_X3 for each NIDD packet.
Each X3 PDU shall contain the contents of the user plane packet (i.e. NIDD)
using an unstructured payload format.
The CC-POI present in the NEF shall set the payload format to indicate the
appropriate payload type (i.e. unstructured payload) as described in ETSI TS
103 221-2 [8] clause 5.4.
#### 7.7.2.3 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in the NEF, the MDF2
shall send the IRI message over LI_HI2 without undue delay. The IRI message
shall contain a copy of the relevant record received from LI_X2. The record
may be enriched by other information available at the MDF (e.g. additional
location information).
The timestamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time at which the NEF event was observed (i.e. the timestamp field
of the xIRI).
The IRI type parameter (see ETSI TS 102 232-1 [9] clause 5.2.10) shall be
included and coded according to table 7.7.2-6.
**Table 7.7.2-6: IRI type for IRI messages**
**Record type** **IRI Type**
* * *
NEFPDUSessionEstablishment BEGIN NEFPDUSessionRelease END
NEFPDUSessionModification CONTINUE
NEFStartOfInterceptionWithEstablishedPDUSession BEGIN NEFUnsuccessfulProcedure
REPORT or CONTINUE
IRI messages associated with the same PDU Session shall be assigned the same
CIN (see ETSI TS 102 232-1 [9] clause 5.2.4).
The threeGPP33128DefinedIRI field (see ETSI TS 102 232-7 [10] clause 15) shall
be populated with the BER-encoded IRIPayload.
#### 7.7.2.4 Generation of CC over LI_HI3
When xCC is received over LI_X3 from the CC-POI in the NEF, the MDF3 shall
populate the threeGPP33128DefinedCC field with a CCPayload structure
containing NIDDCCPDU and send it over LI_HI3 interface to LEMF without undue
delay.
The timestamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time that the NEF observed the data (i.e. the timestamp field of
the xCC). The LIID and CID fields shall correctly reflect the target identity
and communication session to which the CC belongs.
### 7.7.3 LI for device triggering
#### 7.7.3.1 Generation of xIRI LI_X2 at IRI-POI in NEF over LI_X2
##### 7.7.3.1.1 General
The IRI-POI present in the NEF shall send the xIRIs over LI_X2 for each of the
events listed in TS 33.127 [5] clause 7.9.3.4, the details of which are
described in the following clauses.
##### 7.7.3.1.2 Device trigger
The IRI-POI in the NEF shall generate an xIRI containing a NEFDeviceTrigger
record when the IRI-POI present in the NEF detects that an AF has sent a
Device trigger to a target UE matching one of the target identifiers.
Accordingly, the IRI-POI in the NEF generates the xIRI when any of the
following events is detected:
\- NEF sends a Nnef_Trigger_Delivery Response to the AF to acknowledge the
reception of Nnef_Trigger_Delivery Request with GPSI matching the target
identifier (see TS 23.502 [4] clause 4.13.2.1 and TS 29.522 [58] clause
4.4.3).
\- NEF sends a T4 Device-Trigger-Request (DTR) to SM-SC with Trigger-Action
AVP set to TRIGGER and User-Identifier AVP matching the SUPI of the target UE
as described in TS 29.337 [60] clause 5.2.1.
Table 7.7.3-1: NEFDeviceTrigger record
Field name Value M/C/O
* * *
sUPI SUPI associated with the UE. M gPSI GPSI used with the UE. M triggerId
Identity of the Device trigger that should be provided in the
deviceTriggeringDeliveryReportNotification IRI, Device trigger replacement IRI
and Device trigger cancellation IRI. M aFID The AF sending the Device trigger.
M triggerPayload The Device triggering payload. C validityPeriod The validity
time in seconds for the specific action requested. C priorityDT The priority
indication for a trigger payload. C sourcePortId Application identity on the
AF which delivers the Device trigger. C destinationPortId Used to uniquely
identify the triggering application addressed in the device. C
##### 7.7.3.1.3 Device trigger replace
The IRI-POI in the NEF shall generate an xIRI containing a
NEFDeviceTriggerReplace record when the IRI-POI present in the NEF detects
that an AF has sent a Device trigger replacement for a previously sent Device
trigger to a UE matching one of the target identifiers provided via LI_X1 to
the IRI POI in the NEF. It replaces a previously submitted Device trigger
message which has not yet been delivered to the UE.
Accordingly, the IRI-POI in the NEF generates the xIRI when any of the
following events is detected:
\- NEF receives a Nnef_Trigger_Delivery Request (for a device trigger
replacement) from an AF as described in TS 29.522 [58] clause 4.4.3 with GPSI
matching the target identifier.
\- NEF sends a T4 Device-Trigger-Request (DTR) to SM-SC with Trigger-Action
AVP set to REPLACE and User-Identifier AVP matching the SUPI of the target UE
as specified in 29.337 [60] clause 5.2.1.
Table 7.7.3-2: NEFDeviceTriggerReplace record
Field name Value M/C/O
* * *
sUPI SUPI associated with the target UE. M gPSI GPSI used with the taget UE. M
triggerId Identity of the corresponding Device trigger to be replaced. M aFID
The AF replacing an existing Device trigger which has not been delivered yet
to the device (e.g. because the device is unreachable) by a new Device
trigger. M triggerPayload The device triggering payload. C validityPeriod The
validity time in seconds for the specific action requested. C priorityDT
Priority indication for a trigger payload. C sourcePortId Port on the AF which
delivers the device trigger. C destinationPortId Port on the device which is
the recipient of the device trigger. C
##### 7.7.3.1.4 Device trigger cancellation
The IRI-POI in the NEF shall generate an xIRI containing a
NEFDeviceTriggerCancellation record when the IRI-POI present in the NEF
detects that an AF has sent a Device trigger cancellation for a previously
sent Device trigger to a UE matching one of the target identifiers provided
via LI_X1 to the IRI-POI in the NEF. It cancels previously submitted Device
trigger message which has not yet been delivered to the target UE.
Accordingly, the IRI-POI in the NEF generates the xIRI when any of the
following events is detected:
\- NEF receives a Nnef_Trigger_Delivery Request (for a device trigger
cancellation) with GPSI matching the target identifier as described in TS
29.522 [58] clause 4.4.3.
\- NEF sends a T4 Device-Trigger-Request (DTR) to SM-SC with Trigger-Action
AVP set to RECALL and User-Identifier AVP matching the SUPI of the target UE
as specified in TS 29.337 [60] clause 5.2.1.
Table 7.7.3-3: NEFDeviceTriggerCancellation record
Field name Value M/C/O
* * *
sUPI SUPI associated with the target UE. M gPSI GPSI used with the target UE.
M triggerId Identity of the corresponding device trigger to be cancelled. M
##### 7.7.3.1.5 Device trigger report notification
The IRI-POI in the NEF shall generate an xIRI containing a
NEFDeviceTriggerReportNotify record when the IRI-POI present in the NEF
detects that the NEF has returned a Device trigger report to the AF with a
cause value indicating the trigger delivery outcome (e.g. succeeded, unknown
or failed).
Accordingly, the IRI-POI in the NEF generates the xIRI when any of the
following events is detected:
\- NEF sends a Nnef_Trigger_DeliveryNotify service operation with the GPSI of
the target UE to inform the AF on the delivery outcome of the device trigger
as described in TS 29.522 [58] clause 4.4.3.
\- SM-SC sends a T4 Delivery-Report-Request (DRR) to the NEF with User-
Identifier matching the SUPI of the target UE as specified in 29.337 [60]
clause 5.2.2.
Table 7.7.3-4: NEFDeviceTriggerReportNotify record
+-----------------------------+-----------------------------+-------+ | Field name | Value | M/C/O | +=============================+=============================+=======+ | sUPI | SUPI associated with the | M | | | target UE. | | +-----------------------------+-----------------------------+-------+ | gPSI | GPSI used with the target | M | | | UE. | | +-----------------------------+-----------------------------+-------+ | triggerId | Identity of the | M | | | corresponding Device | | | | trigger. | | +-----------------------------+-----------------------------+-------+ | deviceTriggerDeliveryResult | Delivery result represents | M | | | the result of the delivery | | | | of a device triggering | | | | request: | | | | | | | | - SUCCESS: The value | | | | indicates that the device | | | | action request was | | | | successfully completed. | | | | | | | | - UNKNOWN: The value | | | | indicates any unspecified | | | | errors. | | | | | | | | - FAILURE: The value | | | | indicates that this trigger | | | | encountered a delivery | | | | error and is deemed | | | | permanently undeliverable. | | | | | | | | - TRIGGERED: The value | | | | indicates that Device | | | | triggering request is | | | | accepted by the NEF. | | | | | | | | - EXPIRED: The value | | | | indicates that the validity | | | | period expired before the | | | | trigger could be delivered. | | | | | | | | - UNCONFIRMED: The value | | | | indicates that the delivery | | | | of the device action | | | | request is not confirmed. | | | | | | | | - REPLACED: The value | | | | indicates that the device | | | | triggering replacement | | | | request is accepted by the | | | | NEF. | | | | | | | | - TERMINATE: The NEF | | | | includes this value in the | | | | response for a successful | | | | device triggering | | | | cancellation request. The | | | | value indicates that the | | | | delivery of the device | | | | action request is | | | | terminated by the AF. | | +-----------------------------+-----------------------------+-------+
#### 7.7.3.2 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in the NEF, the MDF2
shall send the IRI message over LI_HI2 without undue delay. The IRI message
shall contain a copy of the relevant record received from LI_X2. The record
may be enriched by other information available at the MDF (e.g. additional
location information).
The timestamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time at which the NEF event was observed (i.e. the timestamp field
of the xIRI).
The IRI type parameter (see ETSI TS 102 232-1 [9] clause 5.2.10) shall be
included and coded according to table 7.7.3-5.
**Table 7.7.3-5: IRI type for IRI messages**
**Record type** **IRI Type**
* * *
NEFDeviceTrigger REPORT NEFDeviceTriggerReplace REPORT
NEFDeviceTriggerCancellation REPORT NEFDeviceTriggerReportNotify REPORT
### 7.7.4 LI for MSISDN-less MO SMS
#### 7.7.4.1 Generation of xIRI LI_X2 at IRI-POI in NEF over LI_X2
##### 7.7.4.1.1 General
The IRI-POI present in the NEF shall send the xIRIs over LI_X2 for each of the
events listed in TS 33.127 [5] clause 7.9.4.4, the details of which are
described in the following clauses.
##### 7.7.4.1.2 MSISDN-less MO SMS
The IRI-POI in the NEF shall generate an xIRI containing a NEFMSISDNLessMOSMS
record when the IRI-POI present in the NEF detects that a target UE has sent a
MSISDN-less MO SMS to an AF.
Accordingly, the IRI-POI in the NEF generates the xIRI when any of the
following events is detected:
\- NEF receives a SGd MO-Forward-Short-Message-Request (OFR) from an SM-SC
with SUPI matching the target identifier (see TS 29.338 [59] clause 6.2.1).
\- NEF sends a Nnef_MSISDN-less_MO_SMSNotify service operation to the AF with
the GPSI of the target UE sending the MSISDN-less SMS as described in TS
29.522 [58] clause 4.4.10.
Table 7.7.4-1: NEFMSISDNLessMOSMS record
Field name Value M/C/O
* * *
sUPI SUPI associated with the target UE. M gPSI GPSI in the form of an
external identifier as username\@realm and corresponding to the identity of
the originating SMS party. M terminatingSMSParty Identity of the AF receiving
the SMS. M sMS SMS TPDU. C sourcePort port identifying the application of the
target UE sending the MSISN-less MO SMS. C destinationPort port identifying
the application of the AF which is the recipient of the MSISN-less MO SMS. C
#### 7.7.4.2 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in the NEF, the MDF2
shall send the IRI message over LI_HI2 without undue delay. The IRI message
shall contain a copy of the relevant record received from LI_X2. The record
may be enriched by other information available at the MDF (e.g. additional
location information).
The timestamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time at which the NEF event was observed (i.e. the timestamp field
of the xIRI).
The IRI type parameter (see ETSI TS 102 232-1 [9] clause 5.2.10) shall be
included and coded according to table 7.7.4-2.
**Table 7.7.4-2: IRI type for IRI messages**
**Record type** **IRI Type**
* * *
NEFMSISDNLessMOSMS REPORT
### 7.7.5 LI for parameter provisioning
#### 7.7.5.1 Generation of xIRI LI_X2 at IRI-POI in NEF over LI_X2
##### 7.7.5.1.1 General
The IRI-POI present in the NEF shall send the xIRIs over LI_X2 for each of the
events listed in TS 33.127 [5] clause 7.9.5.4, the details of which are
described in the following clauses.
##### 7.7.5.1.2 Expected UE behavior update
The IRI-POI in the NEF shall generate an xIRI containing an
NEFExpectedUEBehaviorUpdate record when the IRI-POI present in the NEF detects
that an AF has updated the UE Expected behavior data.
Accordingly, the IRI-POI in the NEF generates the xIRI when any of the
following events is detected (see TS 29.503 [25] clauses 5.6.2.1 and
6.1.6.2.49):
\- NEF receives a NEF_ParameterProvision_Create Request or
NEF_ParameterProvision_Update Request from an AF, related to the target UE.
\- NEF receives a NEF_ParameterProvision_Delete Request from an AF to delete
the existing UE Expected Behaviour parameters related to the target UE.
\- NEF returns a NEF_ParameterProvision_Get Response containing the UE
Expected Behavior of the target UE to the querying AF.
Table 7.7-5-1: NEFExpectedUEBehaviorUpdate record
+-----------------------------+-----------------------------+-------+ | Field name | Value | M/C/O | +=============================+=============================+=======+ | gPSI | GPSI of the target UE to | M | | | which the expected UE | | | | behavior applies. | | +-----------------------------+-----------------------------+-------+ | expectedUEMovingTrajectory | Identifies the UE\'s | O | | | expected geographical | | | | movement. | | +-----------------------------+-----------------------------+-------+ | stationaryIndication | Identifies whether the UE | O | | | is stationary or mobile. | | +-----------------------------+-----------------------------+-------+ | communicationDurationTime | Indicates for how long the | O | | | UE will normally stay in | | | | CM-Connected for data | | | | transmission expressed in | | | | seconds. | | +-----------------------------+-----------------------------+-------+ | periodicTime | Interval Time of periodic | O | | | communication in seconds. | | +-----------------------------+-----------------------------+-------+ | scheduledCommunicationTime | Time and day of the week | O | | | when the UE is available | | | | for communication, as | | | | defined in TS 29.571 | | | | [17]. | | +-----------------------------+-----------------------------+-------+ | batteryIndication | Identifies power | O | | | consumption criticality for | | | | the UE: if the | | | | | | | | UE is battery powered but | | | | the battery is not | | | | rechargeable/not | | | | | | | | replaceable, battery | | | | powered with | | | | | | | | rechargeable/replaceable | | | | battery, or not battery | | | | powered. | | +-----------------------------+-----------------------------+-------+ | trafficProfile | Identifies the type of data | O | | | transmission: single packet | | | | transmission (UL or DL), | | | | dual packet transmission | | | | (UL with subsequent DL or | | | | DL with subsequent UL), | | | | multiple packets | | | | transmission. | | +-----------------------------+-----------------------------+-------+ | scheduledCommunicationType | Indicates that the | O | | | Scheduled Communication | | | | Type is Downlink only or | | | | Uplink only or | | | | Bi-directional. | | +-----------------------------+-----------------------------+-------+ | expectedT | Identifies the time and day | O | | imeAndDayOfWeekInTrajectory | of week when the UE is | | | | expected to be at each | | | | location included in the | | | | Expected UE Moving | | | | Trajectory. | | +-----------------------------+-----------------------------+-------+ | aFID | AF identity requesting | M | | | expected UE behavior | | | | update. | | +-----------------------------+-----------------------------+-------+ | validityTime | Identifies when the | O | | | expected UE behavior | | | | parameter set expires and | | | | shall be deleted. If | | | | absent, it indicates that | | | | there is no expiration time | | | | for this parameter set. | | +-----------------------------+-----------------------------+-------+
#### 7.7.5.2 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in the NEF, the MDF2
shall send the IRI message over LI_HI2 without undue delay. The IRI message
shall contain a copy of the relevant record received from LI_X2. The record
may be enriched by other information available at the MDF (e.g. additional
location information).
The timestamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time at which the NEF event was observed (i.e. the timestamp field
of the xIRI).
The IRI type parameter (see ETSI TS 102 232-1 [9] clause 5.2.10) shall be
included and coded according to table 7.7.4-2.
**Table 7.7.5-2: IRI type for IRI messages**
**Record type** **IRI Type**
* * *
NEFExpectedUEBehaviorUpdate REPORT
## 7.8 LI at SCEF
### 7.8.1 Provisioning over LI_X1
#### 7.8.1.1 General
For NIDD using SCEF:
\- If delivery type for the warrant is \"IRI and CC\", then the IRI-POI and
the CC-POI in the SCEF, the MDF2 and MDF3 shall be provisioned.
\- If delivery type for the warrant is \"IRI\", then the IRI-POI in the SCEF
and the MDF2 shall be provisioned.
\- Delivery type \"CC\" is not applicable to the warrant.
For device triggering, MSISDN-less MO SMS and Parameter Provisioning:
\- the delivery type for the warrant is \"IRI\"; the IRI-POI in the SCEF and
the MDF2 shall be provisioned.
#### 7.8.1.2 Provisioning of the IRI-POI and CC-POI in SCEF
The IRI-POI and CC-POI present in the SCEF are provisioned over LI_X1 by the
LIPF using the X1 protocol as described in clause 5.2.2.
The POI in the SCEF shall support the following target identifier formats in
the ETSI TS 103 221-1 [7] messages (or equivalent if ETSI TS 103 221-1 [7] is
not used):
\- IMSI.
\- MSISDN.
\- External Identifier.
NOTE: For Parameter Provisioning, only MSISDN and External Identifier are
applicable.
### 7.8.2 LI for NIDD using SCEF
#### 7.8.2.1 Generation of xIRI at IRI-POI in SCEF over LI_X2
##### 7.8.2.1.1 General
The IRI-POI present in the SCEF shall send the xIRIs over LI_X2 for each of
the events listed in TS 33.127 [5] clause 7.11.2.3, the details of which are
described in the following clauses. Each event will be based on PDN Connection
between SCEF and target UE, except in case of Unsucessful Procedure.
##### 7.8.2.1.2 SCEF PDN connection establishment
The IRI-POI in the SCEF/IWK-SCEF shall generate an xIRI containing an
SCEFPDNConnectionEstablishment record when the IRI-POI present in the
SCEF/IWK-SCEF detects that a Non-IP PDN Connection using SCEF has been
established by the target UE. The IRI-POI present in the SCEF/IWK-SCEF shall
generate the xIRI for the following events (see TS 29.128 [62], clause 5.8):
\- the SCEF/IWK-SCEF sends a T6a/T6ai Connection Management Answer to MME as a
response to a T6a/T6ai Connection Management Request received with User-
Identifier AVP including the set of identities of the UE, i.e.
IMSI/MSISDN/External Identifier matching the target Identifier and Connection-
Action AVP set to CONNECTION_ESTABLISHMENT to confirm the establishment of a
Non-IP PDN connection.
\- in roaming situation SCEF sends a T7 Connection Management Answer to IWK-
SCEF as a confirmation to the T7 Connection Management Request received with
User-Identifier AVP including the set of identities of the UE, i.e.
IMSI/MSISDN/External Identifier matching the target Identifier and with
Connection-Action AVP set to CONNECTION_ESTABLISHMENT.
Table 7.8.2-1: SCEFPDNConnectionEstablishment record
Field name Value M/C/O
* * *
iMSI IMSI associated with the Non-IP PDN Connection of the target UE (e.g. as
provided by the MME in the associated Connection Management Request). C mSISDN
MSISDN associated with the PDN Connection if available. C externalIdentifier
External Identifier associated with the PDN Connection if available, defined
as NAI in ASN.1. C iMEI IMEI associated to the device if available. C
ePSBearerID Identity of the EPS bearer that MME allocated to the Non-IP PDN
connection. M sCEFID SCEF identity handling the EPS Bearer. M aPN Access Point
Name used to establish the PDN Connection. Shall be given in dotted-label
presentation format as described in TS 23.003 [19] clause 9.1. M rDSSupport
True if Reliable Data Service is supported in the PDN Connection,. otherwise
False M sCSASID String Identifying the AF the traffic will be delivered to. M
##### 7.8.2.1.3 PDN connection update
The IRI-POI in the SCEF/IWK-SCEF shall generate an xIRI containing an
SCEFPDNConnectionUpdate record when the IRI-POI present in the SCEF/IWK-SCF
detects that a Non-IP PDN Connection has been updated for the target UE. The
IRI-POI present in the SCEF/IWK-SCEF shall generate the xIRI for the following
events:
\- SCEF/IWK-SCEF sends a T6a/T6ai Connection Management Answer to confirm the
T6a/T6ai Connection Management Request received with User-Identifier AVP
including the set of identities of the UE, i.e. IMSI/MSISDN/External
Identifier matching the target Identifier and with Connection-Action AVP set
to CONNECTION_UPDATE as described in TS 29.128 [62] clause 5.7.
\- SCEF/IWK-SCEF receives a T6a/T6ai Connection Management Answer from MME
which confirms the T6a/T6ai Connection Management Request sent by SCEF/IWK-
SCEF with User-Identifier AVP including the set of identities of the UE, i.e.
IMSI/MSISDN/External Identifier matching the target Identifier and with
Connection-Action AVP set to CONNECTION_UPDATE as described in TS 29.128 [62]
clause 5.8.
\- in roaming situation SCEF sends a T7 Connection Management Answer to IWK-
SCEF to confirm the T7 Connection Management Request received with User-
Identifier AVP including the set of identities of the UE, i.e.
IMSI/MSISDN/External Identifier matching the target Identifier and with
Connection-Action AVP set to CONNECTION_UPDATE as described in TS 29.128 [62]
clause 5.7.
\- in roaming situation SCEF receives a T7 Connection Management Answer from
IWK-SCEF which confirms the T7 Connection Management Request with User-
Identifier AVP including the set of identities of the UE, i.e.
IMSI/MSISDN/External Identifier matching the target Identifier and with
Connection-Action AVP set to CONNECTION_UPDATE as described in TS 29.128 [62]
clause 5.8.
\- SCEF returns a RDS MANAGE PORT Response to a UE with a \"Status\" field set
to \"Success\" in response to a RDS MANAGE PORT command sent by UE with an
\"Action\" field set to \"Reserve port\" to confirm the reservation of a
combination of source and destination port numbers for use for a traffic to be
sent by the UE to a specific application on an SCS/AS (see TS 24.250 [61]
clause 5.4.2.6.2).
\- SCEF receives a RDS MANAGE PORT Response from a UE with a \"Status\" field
set to \"Success\" in response to a RDS MANAGE PORT command sent by the SCEF
with an \"Action\" field set to \"Reserve port\" to confirm the reservation of
a combination of source and destination port numbers for use for a traffic to
be sent by an SCS/AS to a specific application on the UE (see TS 24.250 [61]
clause 5.4.2.6.2).
\- SCEF returns a RDS MANAGE PORT Response to a UE with a \"Status\" field set
to \"Success\" in response to a RDS MANAGE PORT command sent by UE with an
\"Action\" field set to \"Release port\" to confirm the release of a
combination of source and destination port numbers for an application on an
SCS/AS (see TS 24.250 [61] clause 5.4.2.6.3).
\- SCEF receives a RDS MANAGE PORT Response from a UE with a \"Status\" field
set to \"Success\" in response to a RDS MANAGE PORT command sent by the SCEF
with an \"Action\" field set to \"Release port\" to confirm the release of a
combination of source and destination port numbers for an application on the
UE (see TS 24.250 [61] clause 5.4.2.6.3).
Table 7.8.2-2: SCEFPDNConnectionUpdate record
Field name Value M/C/O
* * *
iMSI IMSI associated with the Non-IP PDN Connection of the target UE (e.g. as
provided by the MME in the associated Connection Management Request). C mSISDN
MSISDN associated with the PDN Connection if available. C externalIdentifier
External Identifier associated with the PDN Connection if available, defined
as NAI in ASN.1. C initiator Initiator of the modification of the PDN
Connection, UE, MME or SCEF. M rDSSourcePortNumber RDS source port number. C
rDSDestinationPortNumber RDS destination port number. C applicationID
Application identifier on the UE or on the SCS/AS if RDS is used. C sCSASID
Identifier of the SCS/AS if RDS is used. C rDSAction Action if RDS is used.
Possible values: "ReservePort", "ReleasePort". C serializationFormat Data
format exchanged between UE and SCS/AS if RDS is used. C
##### 7.8.2.1.4 PDN connection release
The IRI-POI in the SCEF/IWK-SCEF shall generate an xIRI containing an
SCEFPDNConnectionRelease record when the IRI-POI present in the SCEF/IWK-SCEF
detects that a Non-IP PDN Connection needs to be released for the target UE.
The IRI-POI present in the SCEF/IWK-SCEF shall generate the xIRI for the
following events:
\- SCEF/IWK-SCEF informs MME that the Non-IP PDN Connection for NIDD is no
longer valid using T6a Connection Management Request with User-Identifier AVP
including the set of identities of the UE, i.e. IMSI/MSISDN/External
Identifier matching the target Identifier and Connection-Action AVP set to
CONNECTION_RELEASE. SCEF initiates the release of the Non-IP PDN connection
when it is notified by the HSS about the end of NIDD authorization for the
target UE (see TS 29.128 [62] clause 5.8).
\- SCEF sends a T6a Connection Management Answer to MME to confirm the T6a
Connection Management Request received with User-Identifier AVP including the
set of identities of the UE, i.e. IMSI/MSISDN/External Identifier matching the
target Identifier and with Action-Action AVP set to CONNECTION_RELEASE (see TS
29.128 [62] clause 5.7).
\- SCEF informs IWK-SCEF that the Non-IP PDN Connection for NIDD is no longer
valid using T6a Connection Management Request with User-Identifier AVP
including the set of identities of the UE, i.e. IMSI/MSISDN/External
Identifier matching the target Identifier and Connection-Action AVP set to
CONNECTION_RELEASE (see TS 29.128 [62] clause 5.8).
\- SCEF sends a T7 Connection Management Answer to IWK-SCEF to confirm the T7
Connection Management Request with User-Identifier AVP including the set of
identities of the UE, i.e. IMSI/MSISDN/External Identifier matching the target
Identifier and with Action AVP set to CONNECTION_RELEASE (see TS 29.128 [62]
clause 5.7).
Table 7.8.2-3: SCEFPDNConnectionRelease record
Field name Value M/C/O
* * *
iMSI IMSI associated with the Non-IP PDN Connection of the target UE (e.g. as
provided by the MME in the associated Connection Management Request). C mSISDN
MSISDN associated with the PDN Connection if available. C externalIdentifier
External Identifier associated with the PDN Connection if available, defined
as NAI in ASN.1. C ePSBearerID Identity of the EPS bearer that MME allocates
to the Non-IP PDN Connection. M timeOfFirstPacket Time of first packet for the
PDN Connection. C timeOfLastPacket Time of last packet for the PDN Connection.
C uplinkVolume Number of uplink octets for the PDN Connection. C
downlinkVolume Number of downlink octets for the PDN Connection. C
releaseCause Reason for PDN Connection release. M
##### 7.8.2.1.5 Unsuccessful procedure
The IRI-POI in the SCEF/IWK-SCEF shall generate an xIRI containing an
SCEFUnsuccessfulProcedure record when the IRI-POI present in the SCEF/IWK-SCEF
detects an unsuccessful procedure or error condition for a target UE matching
one of the target identifiers provided via LI_X1.
Accordingly, the IRI-POI in the SCEF/IWK-SCEF generates the xIRI when any of
the following events is detected (see TS 29.128 [62] clause 6.3.3 and TS
24.250 [61] clause 5.4.2.6):
\- SCEF sends a T6a Connection Management Answer with Experimental-Result AVP
set to DIAMETER_ERROR_USER_UNKNOWN.
\- SCEF sends a T6a Connection Management Answer with Experimental-Result AVP
set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED when Action AVP of the T6a
Connection Management Request received by the SCEF is not set to
CONNECTION_ESTABLISHMENT, CONNECTION_UPDATE or CONNECTION_ RELEASE.
\- SCEF sends a T6a Connection Management Answer with Experimental-Result AVP
set to DIAMETER_ERROR_NIDD_CONFIGURATION_NOT_AVAILABLE when Action AVP of the
T6a Connection Management Request received by the SCEF is set to
CONNECTION_ESTABLISHMENT and the NIDD configuration for the target UE does not
exist or fails at SCEF.
\- SCEF sends a T6a Connection Management Answer with Experimental-Result AVP
set to DIAMETER_ERROR_INVALID_EPS_BEARER when Action AVP of the T6a Connection
Management Request received by the SCEF is set to CONNECTION_UPDATE or
CONNECTION_RELEASE and the EPS Bearer Identity does not exist.
\- SCEF returns a RDS MANAGE PORT Response to a UE with a \"Status\" field set
to \"Port not free\" in response to a RDS MANAGE PORT command sent by UE with
an \"Action\" field set to \"Reserve port\".
\- SCEF receives a RDS MANAGE PORT Response from a UE with a \"Status\" field
set to \"Port not free\" in response to a RDS MANAGE PORT command sent by SCEF
with an \"Action\" field set to \"Reserve port\".
\- SCEF returns a RDS MANAGE PORT Response to a UE with a \"Status\" field set
to \"Port not associated with specified application\" in response to a RDS
MANAGE PORT command sent by UE with an \"Action\" field set to \"Release
port\".
\- SCEF receives a RDS MANAGE PORT Response from a UE with a \"Status\" field
set to \"Port not associated with specified application\" in response to a RDS
MANAGE PORT command sent by SCEF with an \"Action\" field set to \"Release
port\".
Table 7.8.2-4: SCEFUnsuccessfulProcedure record
Field name Value M/C/O
* * *
failureCause Cause of unsuccessful procedure. M iMSI IMSI associated with the
Non-IP PDN Connection of the target UE (e.g. as provided by the MME in the
associated Connection Management Request). C mSISDN MSISDN associated with the
PDN Connection if available. C iMEI IMEI associated to the device if
available. C externalIdentifier External Identifier associated with the PDN
Connection if available, defined as NAI in ASN.1. C ePSBearerID Identity of
the EPS bearer that MME allocated to the Non-IP PDN connection. M aPN Access
Point Name associated with the target traffic. Shall be given in dotted-label
presentation format as described in TS 23.003 [19] clause 9.1. M
rDSDestionationPortNumber RDS destination port number. C applicationID
Application identifier associated with the RDS port number. C sCSASID SCS/AS
Identifier. If the SCS/AS Idenitifer is not available, the placeholder value
\"Unknown\" shall be used. M
##### 7.8.2.1.6 Start of interception with established PDN connection
The IRI-POI in the SCEF/IWK-SCEF shall generate an xIRI containing an
SCEFStartOfInterceptionWithEstablishedPDNConnection record when the IRI-POI
present in the SCEF detects that a Non-IP PDN Connection using SCEF has
already been established for the target UE when interception starts.
In a non-roaming scenario, the IRI-POI in the SCEF (or in a roaming scenario,
the IRI-POI in the IWK-SCEF in the VPLMN) shall generate the xIRI containing
the SCEFStartOfInterceptionWithEstablishedPDNConnection record when it detects
that a new interception for a UE is activated (i.e. provisioned by the LIPF)
for the following case:
\- A PDN connection to the SCEF for the target UE exists, uniquely identified
by an EPS Bearer Identity, APN, and UE Identity.
The IRI-POI in the SCEF/IWK-SCEF shall generate the xIRI containing the
SCEFStartOfInterceptionWithEstablishedPDNConnection record for each of the PDN
Connections for NIDD using SCEF associated with the target UE.
Table 7.8.2-5: SCEFStartOfInterceptionWithEstablishedPDNConnection record
Field name Value M/C/O
* * *
iMSI IMSI associated with the Non-IP PDN Connection of the target UE (e.g. as
provided by the MME in the associated Connection Management Request). C mSISDN
MSISDN associated with the PDN Connection if available. C externalIdentifier
External Identifier associated with the PDN Connection if available, defined
as NAI in ASN.1. C iMEI IMEI associated to the device if available. C
ePSBearerID Identity of the EPS bearer that MME allocated to the Non-IP PDN
connection. M sCEFID SCEF identity handling the EPS Bearer. M aPN Access Point
Name associated with the target traffic. Shall be given in dotted-label
presentation format as described in TS 23.003 [19] clause 9.1. M rDSSupport
True if Reliable Data Service is supported in the PDN Connection, otherwise
False. M sCSASID String Identifying the SCS/AS the traffic will be delivered
to. M
The IRI-POI present in the SMF generating an xIRI containing a
SCEFStartOfInterceptionWithEstablishedPDUSession record shall set the Payload
Direction field in the PDU header to _not applicable_ (see ETSI TS 103 221-2
[8] clause 5.2.6).
#### 7.8.2.2 Generation of xCC at CC-POI in SCEF over LI_X3
The CC-POI present in the SCEF shall send xCC over LI_X3 for each NIDD packet.
Each X3 PDU shall contain the contents of the user plane packet (i.e. NIDD)
using an unstructured payload.
The CC-POI present in the SCEF shall set the payload format to indicate the
appropriate payload type (i.e. unstructured payload) as described in ETSI TS
103 221-2 [8] clause 5.4.
#### 7.8.2.3 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in the SCEF/IWK-SCEF, the
MDF2 shall send the IRI message over LI_HI2 without undue delay. The IRI
message shall contain a copy of the relevant record received from LI_X2. The
record may be enriched by other information available at the MDF (e.g.
additional location information).
The timestamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time at which the SCEF event was observed (i.e. the timestamp field
of the xIRI).
The IRI type parameter (see ETSI TS 102 232-1 [9] clause 5.2.10) shall be
included and coded according to table 7.8.2-6.
**Table 7.8.2-6: IRI type for IRI messages**
**Record type** **IRI Type**
* * *
SCEFPDNConnectionEstablishment BEGIN SCEFPDNConnectionRelease END
SCEFPDNConnectionUpdate CONTINUE
SCEFStartOfInterceptionWithEstablishedPDNConnection BEGIN
SCEFUnsuccessfulProcedure REPORT
IRI messages associated with the same PDU Session shall be assigned the same
CIN (see ETSI TS 102 232-1 [9] clause 5.2.4).
The threeGPP33128DefinedIRI field (see ETSI TS 102 232-7 [10] clause 15) shall
be populated with the BER-encoded IRIPayload.
#### 7.8.2.4 Generation of CC over LI_HI3
When xCC is received over LI_X3 from the CC-POI in the SCEF, the MDF3 shall
populate the threeGPP33128DefinedCC field with a CCPayload structure
containing NIDDCCPDU and send it over LI_HI3 interface to LEMF without undue
delay.
The timestamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time that the SCEF observed the data (i.e. the timestamp field of
the xCC). The LIID and CID fields shall correctly reflect the target identity
and communication session to which the CC belongs.
### 7.8.3 LI for device triggering
#### 7.8.3.1 Generation of xIRI LI_X2 at IRI-POI in SCEF over LI_X2
##### 7.8.3.1.1 General
The IRI-POI present in the SCEF shall send the xIRIs over LI_X2 for each of
the events listed in TS 33.127 [5] clause 7.11.3.4, the details of which are
described in the following clauses.
##### 7.8.3.1.2 Device trigger
The IRI-POI in the SCEF shall generate an xIRI containing a SCEFDeviceTrigger
record when the IRI-POI present in the SCEF detects that an SCS/AS has sent a
Device triggering request to a target UE matching one of the target
identifiers.
Accordingly, the IRI-POI in the SCEF generates the xIRI when any of the
following events is detected:
\- SCEF sends a Device triggering response to the SCS/AS to acknowledge the
reception of a Device triggering request with MSISDN or External Identifier
matching the target identifier (See TS 29.122 [63] clause 5.7).
\- SCEF sends a T4 Device-Trigger-Request (DTR) to SM-SC with Trigger-Action
AVP set to TRIGGER and User-Identifier AVP matching the IMSI of the target UE
as specified in TS 29.337 [60] clause 5.2.1.
Table 7.8.3-1: SCEFDeviceTrigger record
Field name Value M/C/O
* * *
iMSI IMSI associated with the UE C mSISDN MSISDN used with the UE C
externalIdentifier External Identifier used with the UE C triggerId Identity
of the Device trigger that should be provided in the
deviceTriggeringDeliveryReportNotification IRI, Device trigger replacement IRI
and Device trigger cancellation IRI M sCSASID The SCS/AS sending the Device
trigger M triggerPayload The Device triggering payload C validityPeriod The
validity time in seconds for the specific action requested C priorityDT The
priority of the Device trigger C sourcePortId Application identity on the
SCS/AS which delivers the Device trigger C destinationPortId Used to uniquely
identify the triggering application addressed in the device C
##### 7.8.3.1.3 Device trigger replacement
The IRI-POI in the SCEF shall generate an xIRI containing a
SCEFDeviceTriggerReplace record when the IRI-POI present in the SCEF detects
that an SCS/AS has sent a Device triggering replacement for a previously sent
Device triggering request to a UE matching one of the target identifiers
provided via LI_X1 to the IRI POI in the SCEF. It replaces a previously
submitted Device triggering request which has not yet been delivered to the
UE.
Accordingly, the IRI-POI in the SCEF generates the xIRI when any of the
following events is detected:
\- SCEF receives a Device triggering request (for a Device trigger
replacement) from an SCS/AS with MSISDN or External Identifier matching the
target identifier (See TS 29.122 [63] clause 5.7).
\- SCEF sends a T4 Device-Trigger-Request (DTR) to SM-SC with Trigger-Action
AVP set to REPLACE and User-Identifier AVP matching the IMSI of the target UE
as specified in TS 29.337 [60] clause 5.2.1.
Table7.8.3-2: SCEFDeviceTriggerReplace record
Field name Value M/C/O
* * *
iMSI IMSI associated with the target UE C mSISDN MSISDN used with the taget UE
C externalIdentifier External Identifier used with the taget UE C triggerId
Identity of the corresponding Device trigger to be replaced M sCSASID Identity
of the SCS/AS replacing an existing Device trigger which has not been
delivered yet to the device (e.g. because the device is unreachable) by a new
Device trigger M triggerPayload The device triggering payload C validityPeriod
The validity time in seconds for the specific action requested C priorityDT
The priority of the device trigger C sourcePortId Port on the SCSAS which
delivers the device trigger C destinationPortId Port on the device which is
the recipient of the device trigger C
##### 7.8.3.1.4 Device trigger cancellation
The IRI-POI in the SCEF shall generate an xIRI containing a
SCEFDeviceTriggerCancellation record when the IRI-POI present in the SCEF
detects that an SCS/AS has sent a Device triggering cancellation for a
previously sent Device triggering request to a UE matching one of the target
identifiers provided via LI_X1 to the IRI-POI in the SCEF. It cancels
previously submitted Device triggering request which has not yet been
delivered to the target UE.
Accordingly, the IRI-POI in the SCEF generates the xIRI when any of the
following events is detected:
\- SCEF receives a Device triggering request (for a device trigger
cancellation) from SCS/AS related to a previously received Device triggering
request with MSISDN or External Identifier matching the target identifier (See
TS 29.122 [63] clause 5.7).
\- SCEF sends a T4 Device-Trigger-Request (DTR) to SM-SC with Trigger-Action
AVP set to RECALL and User-Identifier AVP matching the IMSI of the target UE
as specified in TS 29.337 [60] clause 5.2.1.
Table 7.8.3-3: SCEFDeviceTriggerCancellation record
Field name Value M/C/O
* * *
iMSI IMSI associated with the target UE C mSISDN MSISDN used with the taget UE
C externalIdentifier External Identifier used with the target UE C triggerId
Identity of the corresponding device trigger to be cancelled M
##### 7.8.3.1.5 Device trigger report notification
The IRI-POI in the SCEF shall generate an xIRI containing a
SCEFDeviceTriggerReportNotify record when the IRI-POI present in the SCEF
detects that the SCEF has returned a Device triggering delivery report
notification to the SCS/AS with a cause value indicating the trigger delivery
outcome (e.g. succeeded, unknown or failed).
Accordingly, the IRI-POI in the SCEF generates the xIRI when any of the
following events is detected:
\- SCEF sends a Device triggering delivery report notification to inform the
SCS/AS on the delivery outcome of the device trigger (see TS 29.122 [63]
clause 5.7).
\- SM-SC sends a T4 Delivery-Report-Request (DRR) to the SCEF with User-
Identifier matching the IMSI of the target UE as specified in TS 29.337 [60]
clause 5.2.2.
Table 7.8.3-4: SCEFDeviceTriggerReportNotify record
+-----------------------------+-----------------------------+-------+ | Field name | Value | M/C/O | +=============================+=============================+=======+ | iMSI | IMSI associated with the | M | | | target UE | | +-----------------------------+-----------------------------+-------+ | mSISDN | MSISDN used with the target | C | | | UE | | +-----------------------------+-----------------------------+-------+ | externalIdentifier | External Identifier used | C | | | with the target UE | | +-----------------------------+-----------------------------+-------+ | triggerId | Identity of the | M | | | corresponding Device | | | | trigger | | +-----------------------------+-----------------------------+-------+ | deviceTriggerDeliveryResult | Delivery result represents | M | | | the result of the delivery | | | | of a device triggering | | | | request: | | | | | | | | - SUCCESS: The value | | | | indicates that the device | | | | action request was | | | | successfully completed. | | | | | | | | - UNKNOWN: The value | | | | indicates any unspecified | | | | errors. | | | | | | | | - FAILURE: The value | | | | indicates that this trigger | | | | encountered a delivery | | | | error and is deemed | | | | permanently undeliverable. | | | | | | | | - TRIGGERED: The value | | | | indicates that Device | | | | triggering request is | | | | accepted by the SCEF. | | | | | | | | - EXPIRED: The value | | | | indicates that the validity | | | | period expired before the | | | | trigger could be delivered. | | | | | | | | - UNCONFIRMED: The value | | | | indicates that the delivery | | | | of the device action | | | | request is not confirmed. | | | | | | | | - REPLACED: The value | | | | indicates that the device | | | | triggering replacement | | | | request is accepted by the | | | | SCEF. | | | | | | | | - TERMINATE: The SCEF | | | | includes this value in the | | | | response for a successful | | | | device triggering | | | | cancellation request. The | | | | value indicates that the | | | | delivery of the device | | | | action request is | | | | terminated by the SCS/AS. | | +-----------------------------+-----------------------------+-------+
#### 7.8.3.2 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in the SCEF, the MDF2
shall send the IRI message over LI_HI2 without undue delay. The IRI message
shall contain a copy of the relevant record received from LI_X2. The record
may be enriched by other information available at the MDF (e.g. additional
location information).
The timestamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time at which the SCEF event was observed (i.e. the timestamp field
of the xIRI).
Table 7.8.3-5 shows the IRI type (see ETSI TS 102 232-1 [9] clause 5.2.10) to
be used for each record type.
**Table 7.8.3-5: IRI type for messages**
**Record type** **IRI Type**
* * *
SCEFDeviceTrigger REPORT SCEFDeviceTriggerReplace REPORT
SCEFDeviceTriggerCancellation REPORT SCEFDeviceTriggerReportNotify REPORT
### 7.8.4 LI for MSISDN-less MO SMS
#### 7.8.4.1 Generation of xIRI LI_X2 at IRI-POI in SCEF over LI_X2
##### 7.8.4.1.1 General
The IRI-POI present in the SCEF shall send the xIRIs over LI_X2 for each of
the events listed in TS 33.127 [5] clause 7.11.4.4, the details of which are
described in the following clauses.
##### 7.8.4.1.2 MSISDN-less MO SMS
The IRI-POI in the SCEF shall generate an xIRI containing a
SCEFMSISDNLessMOSMS record when the IRI-POI present in the SCEF detects that a
target UE has sent a MSISDN-less MO SMS to an SCS/AS.
Accordingly, the IRI-POI in the SCEF generates the xIRI when any of the
following events is detected:
\- SCEF receives a SGd MO-Forward-Short-Message-Request (OFR) from an SM-SC
with IMSI matching the target identifier (see TS 29.338 [59] clause 6.2.1).
\- SCEF sends a MsisdnLessMoSmsNotification to the SCS/AS with the External
Identifier of the UE sending the MSISDN-less SMS (see TS 29.122 [63] clause
5.15).
Table 7.8.4-1: SCEFMSISDNLessMOSMS record
Field name Value M/C/O
* * *
iMSI IMSI associated with the target UE C externalIdentifier External
Identifier in the form of username\@realm and corresponding to the identity of
the originating SMS party C terminatingSMSParty Identity of the SCS/AS
receiving the SMS M sMS SMS TPDU C sourcePort port identifying the application
of the target UE sending the MSISN-less MO SMS C destinationPort port
identifying the application of the SCS/AS which is the recipient of the MSISN-
less MO SMS C
#### 7.8.4.2 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in the SCEF, the MDF2
shall send the IRI message over LI_HI2 without undue delay. The IRI message
shall contain a copy of the relevant record received from LI_X2. The record
may be enriched by other information available at the MDF (e.g. additional
location information).
The timestamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time at which the SCEF event was observed (i.e. the timestamp field
of the xIRI).
The IRI type parameter (see ETSI TS 102 232-1 [9] clause 5.2.10) shall be
included and coded according to table 7.8.4-2.
**Table 7.8.4-2: IRI type for IRI messages**
**Record type** **IRI Type**
* * *
SCEFMSISDNLessMOSMS REPORT
### 7.8.5 LI for parameter provisioning
#### 7.8.5.1 Generation of xIRI LI_X2 at IRI-POI in SCEF over LI_X2
##### 7.8.5.1.1 General
The IRI-POI present in the SCEF shall send the xIRIs over LI_X2 for each of
the events listed in corresponding in TS 33.127 [5] clause 7.11.5.4, the
details of which are described in the following clauses.
##### 7.8.5.1.2 Communication pattern update
The IRI-POI in the SCEF shall generate an xIRI containing an
SCEFCommunicationPatternUpdate record when the IRI-POI present in the SCEF
detects that an SCS/AS has updated the Communication pattern data.
Accordingly, the IRI-POI in the SCEF generates the xIRI when any of the
following events is detected (See TS 29.122 [63] clause 5.10):
\- SCEF receives a request to provision the communication pattern parameters
from an SCS/AS related to the target UE (PUT).
\- SCEF receives a request to delete the existing communication patterns
parameters from an SCS/AS related to the target UE (DELETE).
\- SCEF returns a response (200 OK) containing the communication pattern
parameters of the target UE to the querying SCS/AS (GET).
Table 7.8.5-1: SCEFCommunicationPatternUpdate record
+-----------------------------+-----------------------------+-------+ | Field name | Value | M/C/O | +=============================+=============================+=======+ | mSISDN | MSISDN of the target UE the | C | | | communication pattern | | | | applies to | | +-----------------------------+-----------------------------+-------+ | externalIdentifier | External Identifier of the | C | | | target UE the communication | | | | pattern applies to | | +-----------------------------+-----------------------------+-------+ | per | Identifies whether UE | O | | iodicCommunicationIndicator | communicates periodically | | | | or on demand | | +-----------------------------+-----------------------------+-------+ | communicationDurationTime | Indicates for how long the | O | | | UE will normally stay in | | | | CM-Connected for data | | | | transmission expressed in | | | | seconds | | +-----------------------------+-----------------------------+-------+ | periodicTime | Interval Time of periodic | O | | | communication in seconds | | +-----------------------------+-----------------------------+-------+ | scheduledCommunication | Time and day of the week | O | | | when the UE is available | | | Time | for communication, as | | | | defined in TS 29.571 | | +-----------------------------+-----------------------------+-------+ | scheduledCommunicationType | Indicates that the | O | | | Scheduled Communication | | | | Type is Downlink only or | | | | Uplink only or | | | | Bi-directional | | +-----------------------------+-----------------------------+-------+ | stationaryIndication | Identifies whether the UE | O | | | is stationary or mobile | | +-----------------------------+-----------------------------+-------+ | batteryIndication | Identifies power | O | | | consumption criticality for | | | | the UE: if the | | | | | | | | UE is battery powered but | | | | the battery is not | | | | rechargeable/not | | | | | | | | replaceable, battery | | | | powered with | | | | | | | | rechargeable/replaceable | | | | battery, or not battery | | | | powered. | | +-----------------------------+-----------------------------+-------+ | trafficProfile | Identifies the type of data | O | | | transmission: single packet | | | | transmission (UL or DL), | | | | dual packet transmission | | | | (UL with subsequent DL or | | | | DL with subsequent UL), | | | | multiple packets | | | | transmission | | +-----------------------------+-----------------------------+-------+ | expectedUEMovingTrajectory | Identifies the UE's | O | | | expected geographical | | | | movement | | +-----------------------------+-----------------------------+-------+ | expectedT | Identifies the time and day | O | | imeAndDayOfWeekInTrajectory | of week when the UE is | | | | expected to be at each | | | | location included in the | | | | Expected UE Moving | | | | Trajectory | | +-----------------------------+-----------------------------+-------+ | sCSASID | SCS/AS identity requesting | M | | | communication pattern | | | | update | | +-----------------------------+-----------------------------+-------+ | validityTime | Identifies when the | O | | | expected UE behavior | | | | parameter set expires and | | | | shall be deleted. If | | | | absent, it indicates that | | | | there is no expiration time | | | | for this parameter set | | +-----------------------------+-----------------------------+-------+
#### 7.8.5.2 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in the SCEF, the MDF2
shall send the IRI message over LI_HI2 without undue delay. The IRI message
shall contain a copy of the relevant record received from LI_X2. The record
may be enriched by other information available at the MDF (e.g. additional
location information).
The timestamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time at which the SCEF event was observed (i.e. the timestamp field
of the xIRI).
The IRI type parameter (see ETSI TS 102 232-1 [9] clause 5.2.10) shall be
included and coded according to table 7.8.5-2.
**Table 7.8.5-2: IRI type for IRI messages**
**Record type** **IRI Type**
* * *
SCEFCommunicationPatternUpdate REPORT
## 7.9 LI for services encrypted by CSP-provided keys
### 7.9.1 LI for general AKMA-based service
#### 7.9.1.1 General
This clause describes basic IRI-intercept for a generic, encrypted service
between a target UE and an application in the CSP network, making use of AKMA-
provided cryptographic keys according to TS 33.535 [65].
#### 7.9.1.2 Provisioning over LI_X1
##### 7.9.1.2.1 General
The IRI-POI in the AAnF (AKMA Anchor Function), the IRI-TF in the AAnF, and
the MDF2 shall be provisioned.
Details of provisioning of an IRI-POI at a network internal AF (Application
Function) making use of AKMA services of the AAnF is in general service
specific and not part of the present clause. Generally, triggering, rather
than provisioning, could in some cases be necessary for the AF. An application
independent generic triggering mechanism is defined in clause 7.9.1.2.3.
Provisioning of CC-intercept at the AF is service specific and not covered in
the present document.
##### 7.9.1.2.2 Provisioning of the IRI-POI and IRI-TF in AAnF
The IRI-POI and IRI-TF present in the AAnF are provisioned over LI_X1 by the
LIPF using the X1 protocol as described in clause 5.2.2.
The IRI-POI and IRI-TF in the AAnF shall support the following target
identifier formats:
\- SUPI, given in either SUPIIMSI or SUPINAI formats as defined in ETSI TS 103
120 [6] clause C.2.
Table 7.9.1.2-1 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the IRI-POI and IRI-TF in the AAnF.
Table 7.9.1.2-1: ActivateTask message for the IRI-POI and IRI-TF in the AAnF
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID XID assigned by LIPF. M
TargetIdentifiers One of the target identifiers listed in the paragraph above.
M DeliveryType Set to \"X2Only\". M ListOfDIDs Delivery endpoints for LI_X2
for the IRI-POI in the AMF. These delivery endpoints are configured using the
CreateDestination message as described in ETSI TS 103 221-1 [7] clause 6.3.1
prior to the task activation. M
* * *
##### 7.9.1.2.3 Triggering of the IRI-POI in AF
The IRI-POI present in the AF shall be triggered by the IRI-TF present in the
AAnF over LI_T2 using the X1 protocol as described in clause 5.2.2. An AAnF
can provide services for several different types of applications. Triggering
could be service/application specific, which can effect whether or not certain
conditional fields are included in the xIRI described in clause 7.9.1.4 below.
For all AFs a priori known to match the scope of the warrant, when the IRI-TF
in the AAnF detects that an A-KID has been associated with a SUPI (see clause
7.9.1.3.2), it shall send an ActivateTask message to the IRI-POI present in
the AF. The same shall apply if the AAnF detects that the A-KID of a target
changes due to primary authentication. For AFs not a priori known at the AAnF,
the ActivateTask message shall instead be sent when the IRI-TF in the AAnF
detects that the AF performs an AKMA application key get associated with the
A-KID. The ActivateTask message shall contain at least the following
information.
NOTE: AFs providing services based on SUPI could, as an alternative to
triggering, be directly provisioned by the LIPF as part of service-specific
provisioning. This is however outside the scope of the present document.
Table 7.9.1.2-2: ActivateTask message for triggering the IRI-POI in the AF
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID Allocated by the IRI-TF
as per ETSI TS 103 221-1 [7]. M TargetIdentifiers A-KID associated with the
AKMA Anchor Key (see table 7.9.1.3-3 below). M DeliveryType Set to "X2Only". M
ListOfDIDs Delivery endpoints for LI_X2. These delivery endpoints shall be
configured by the IRI-TF in the SMF using the CreateDestination message as
described in ETSI TS 103 221-1 [7] clause 6.3.1 prior to first use. M
implicitDeactivationAllowed Shall be set to \"True\". M ProductID Shall be set
to the XID of the Task Object associated with the interception at the CC-TF.
This value shall be used by the CC-POI in the UPF to fill the XID of X3 PDUs.
M
* * *
Table 7.9.1.2-3: Target Identifier Types for LI_T3
* * *
Identifier type Owner ETSI TS 103 221-1 [7] TargetIdentifier type Definition
A-KID 3GPP TargetIdentifierExtension / AKID AKID (see XSD schema)
* * *
When the IRI-POI present in the AF detects that a UE has requested the use of
a targeted A-KID, it shall continue to generate xIRI events for that A-KID
until it detects that the UE has requested the use of a different A-KID, at
which point it shall implicitly deactivate the previous Task. In addition, the
AAnF may at any time issue a DeactivateTask message against the Task, at which
point the AF shall cease interception of the A-KID and remove the Task as per
ETSI TS 103 221-1 [7] clause 6.2.3.
#### 7.9.1.3 Generation of xIRI at IRI-POI in AAnF over LI_X2
##### 7.9.1.3.1 General
The IRI-POI present in the AAnF shall send the xIRIs over LI_X2 for each of
the events listed in TS 33.127 [5] clause 7.9.3.1, the details of which are
described in the following clauses.
##### 7.9.1.3.2 AAnF Anchor Key Register
The IRI-POI in the AAnF shall generate an xIRI containing an
AAnFAnchorKeyRegister record when the IRI-POI present in the AAnF detects
reception of an AKMA-context, i.e. an (A-KID, K~AKMA~)-pair associated with a
target, from the AUSF, see TS 33.535 [65] clause 7.1.2.
Table 7.9.1.3-1: AAnFAnchorKeyRegister record
+------------+-----------------------------------------------+-------+ | Field name | Value | M/C/O | +============+===============================================+=======+ | aKID | AKMA Anchor Key Identifier (see TS 33.535 | M | | | [65] clause 4.4.2). | | +------------+-----------------------------------------------+-------+ | SUPI | SUPI associated with the A-KID. | M | +------------+-----------------------------------------------+-------+ | kAKMA | AKMA Anchor Key (see TS 33.535 [65] clause | C | | | 5.1). Shall be included if available | | | | | | | | NOTE: Whether kAKMA is included could also | | | | depend on whether provisioning is general or | | | | service specific. | | +------------+-----------------------------------------------+-------+
##### 7.9.1.3.3 AAnF AKMA application key get
The IRI-POI in the AAnF shall generate an xIRI containing an
AAnFAKMAApplicationKeyGet record when the IRI-POI present in the AAnF detects
an AKMA application key get from an AF (directly or via NEF), see TS 33.535
[65], clauses 7.1.3 and 7.3.1.
Table 7.9.1.3-2: AAnFKAKMAApplicationKeyGet record
Field name Value M/C/O
* * *
Type Indicates whether the AF requesting the key is internal to the network or
external. M aKID AKMA Anchor Key Identifier. M keyInfo Key information for the
requested derived AF-specific key (see table 7.9.1.3-3). M
Table 7.9.1.3-3: AFKeyInfo structure
Field name Value M/C/O
* * *
aFID AKMA AF identifier of the AF associated with the derived AF-specific key.
M kAF Derived AF-specific key (see TS 33.535 [65] clauses 5.1 and A.4). M
kAFExpTime Expiry time associated with the derived AF-specific key. M
##### 7.9.1.3.4 AAnF Start of intercept with established AKMA key material
The IRI-POI in the AAnF shall generate an xIRI containing an
AAnFStartOfInterceptWithEstablishedAKMAKeyMaterial record when the IRI-POI
present in the AAnF detects that interception is activated on a target UE that
has already established AKMA key material.
Table 7.9.1.3-4: AAnFStartOfInterceptWithEstablishedAKMAKeyMaterial record
Field name Value M/C/O
* * *
aKID AKMA Anchor Key Identifier (currently valid). M kAKMA AKMA Anchor Key
associated with aKID. C aFKeyList List of all available (aFID, kAF,
kAFExpTime)-tuples which are available, have not expired and complies with
provisioning. C
##### 7.9.1.3.5 AAnF AKMA context removal
The IRI-POI in the AAnF shall generate an xIRI containing an
AAnFAKMAContextRemovalRecord when the IRI-POI present in the AAnF receives a
request from an NF to delete AKMA context, see TS 33.535 [65] clause 7.1.4.
Table 7.9.1.3-5: AAnFAKMAContextRemovalRecord record
Field name Value M/C/O
* * *
aKID AKMA Anchor Key Identifier. M nFInstanceID Identity of NF originating the
request encoded as per TS 29.571 [17] clause 5.3.2. M
#### 7.9.1.4 Generation of xIRI at IRI-POI in AF over LI_X2
##### 7.9.1.4.1 General
The IRI-POI present in the AF shall send the xIRIs over LI_X2 for each of the
events listed in TS 33.127 [5] clause 7.9.3.1, the details of which are
described in the following clauses.
##### 7.9.1.4.2 AF Application key refresh
The IRI-POI in the AF shall generate an xIRI containing an
AFAKMApplicationKeyRefresh record when the IRI-POI present in the AF detects
that a K~AF~-key previously obtained from an AAnF is being locally refreshed
by the Ua* security protocol in use, see TS 33.535 [65] clause 6.4.3.
Table 7.9.1.4-1: AFAKMAApplicationKeyRefresh record
Field name Value M/C/O
* * *
aFID AKMA AF identifier. M aKID AKMA Anchor Key Identifier. M kAF New value of
the AF-specific key, after refresh. M uaStarParams Set of new Ua* security
protocol parameters associated with kAF, if updated. C
##### 7.9.1.4.3 AF Start of intercept with established AKMA application key
The IRI-POI in the AF shall generate an xIRI containing an
AFStartOfInterceptWithEstablishedAKMAApplicationKey record when the IRI-POI
present in the AF detects interception is being triggered on a target UE that
has already established AKMA application key.
Table 7.9.1.4-2: AFStartOfInterceptWithEstablishedAKMAApplicationKey record
+--------------+---------------------------------------------+-------+ | Field name | Value | M/C/O | +==============+=============================================+=======+ | aFFQDN | FQDN-part of AKMA AF identifier. | M | +--------------+---------------------------------------------+-------+ | aKID | AKMA Anchor Key Identifier. | M | +--------------+---------------------------------------------+-------+ | kAFParamList | List of all available all AFSecurityParams | M | | | (see table 7.9.1.4-3) which have not | | | | expired and where the Ua* security | | | | protocol parameters corresponds to the set | | | | of security parameters used on the Ua* | | | | security protocol instance associated with | | | | K~AF~, see TS 33.127 [5] clause | | | | 7.9.3.1.5. | | | | | | | | NOTE: At least one such tuple exists when | | | | this event occurs. | | +--------------+---------------------------------------------+-------+
Table 7.9.1.4-3: AFSecurityParams structure
+--------------+---------------------------------------------+-------+ | Field name | Value | M/C/O | +==============+=============================================+=======+ | aFID | AF identifier. | M | +--------------+---------------------------------------------+-------+ | aKID | AKMA Anchor Key Identifier. | M | +--------------+---------------------------------------------+-------+ | kAF | AKMA derived AF-specific key associated | M | | | with aKID and Ua* security protocol. | | +--------------+---------------------------------------------+-------+ | uaStarParams | Set of Ua* security protocol parameters | M | | | after complete establishment/update. | | | | | | | | NOTE: Generic and TLS 1.2 [66] specific | | | | formats are provided in Annex A. | | +--------------+---------------------------------------------+-------+
##### 7.9.1.4.4 AF Auxiliary security parameter establishment
The IRI-POI in the AF shall generate an xIRI containing an
AFAuxiliarySecurityParameterEstablishment record when the IRI-POI present in
the AF detects that security parameters for the Ua* security protocol in use
have been established with the target UE, or, when they have been updated
without the associated AKMA application key having been refreshed according to
clause 7.9.1.4.3.
Table 7.9.1.4-4: AFAuxiliarySecurityParameterEstablishment record
Field name Value M/C/O
* * *
aFSecurityParams Auxiliary security parameters established (see table
7.9.1.4-3). M
##### 7.9.1.4.5 AF Application key removal
The IRI-POI in the AF shall generate an xIRI containing an
AFApplicationKeyRemoval record when the IRI-POI present in the AF detects that
an AKMA-derived AF-specific key is deleted or otherwise decommissioned.
Table 7.9.1.4-5: AFApplicationKeyRemoval record
Field name Value M/C/O
* * *
aFID AF identifier. M aKID AKMA Anchor Key Identifier associated with removed
key. M removalCause Reason for the removal of the application key. M
#### 7.9.1.5 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the IRI-POI in the AAnF or AF, the
MDF2 shall send the IRI message over LI_HI2 without undue delay. The IRI
message shall contain a copy of the relevant record received from LI_X2. The
record may be enriched by other information available at the MDF.
The timestamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time at which the AAnF/AF event was observed (i.e. the timestamp
field of the xIRI).
Table 7.9.1.5-1 shows the IRI type (see ETSI TS 102 232-1 [9] clause 5.2.10)
to be used for each record type.
**Table 7.9.1.5-1: IRI type for AAnF originated messages**
**Record type** **IRI Type**
* * *
AAnFAnchorKeyRegister BEGIN AAnFKAKMAApplicationKeyGet CONTINUE
AAnFStartOfInterceptWithEstablishedAKMAKeyMaterial BEGIN
AAnFAKMAContextRemovalRecord END
IRI messages associated with the same A-KID from the same AAnF shall be
assigned the same CIN.
**Table 7.9.1.5-2: IRI type for AF originated messages**
**Record type** **IRI Type**
* * *
AFAKMAApplicationKeyGet BEGIN AFAKMAApplicationKeyRefresh CONTINUE
AFStartOfInterceptWithEstablishedAKMAApplicationKey BEGIN
AFAuxiliarySecurityParameterEstablishment CONTINUE AFApplicationKeyRemoval END
IRI messages associated with the same A-KID from the same AF shall be assigned
the same CIN.
## 7.10 LI in VPLMN for IMS-based services with home-routed roaming
### 7.10.1 Background
This clause defines protocol and procedures to support the LI in the VPLMN for
IMS-based services with home-routed roaming architecture where IMS signaling
(e.g. CSCFs) and media functions (e.g. IMS-AGW) are in the HPLMN. The scope of
LI functions defined here are the following in the VPLMN:
\- IMS-based voice services.
\- SMS over IP.
For IMS-based voice services and the SMS over IP, the target can be an inbound
roaming UE or a non-local ID.
As defined in TS 33.127 [5] clause 7.4.7.4.2, LMISF-IRI, LMISF-CC, BBIFF-C and
BBIFF-U handle the LI in the VPLMN for IMS-based services with home routed
roaming architecture.
NOTE 1: When N9 is the interface between the two PLMNs for the user plane
data, the LI architecture is referred to as N9HR LI. With N9HR LI, the BBIFF-C
is present in the SMF and the BBIFF-U is present in the UPF.
NOTE 2: When S8 is the interface between the two PLMNs for the user plane
data, the LI architecture is referred to as S8HR LI. With S8HR LI, the BBIFF-C
and BBIFF-U are combined into BBIFF and is present in the SGW. When SGW is
deployed with CUPS, the S8U is the interface between the two PLMNs for the
user plane data and in this case, the BBIFF-C is present in the SGW-C and
BBIFF-U is present in the SGW-U.
This clause uses the term \"HR LI\" in referring to the common functions
associated with the N9HR LI and S8HR LI collectively.
The HR LI includes two phases of LI processing with the following scope:
\- Phase 1 - Initial configuration and target checking, applies to all in-
bound roaming UEs with home-routed roaming and using IMS-based services. No
interception is done in this phase.
\- Phase 2 - Applies to specific target UEs or UEs in communication with a
target non-local ID. Interception is done in this phase.
The details of the above two phases of LI processes are described in TS 33.127
[5] clause 7.4.7.4.11.
### 7.10.2 Backward compatibility
The present document provides two options for stage 3 definitions for
implementing S8HR LI:
\- Use LI_X1, LI_X2 and LI_X3 interfaces specified below in the present
document.
\- Use TS 33.107 [36] natively as defined in that document.
In both cases, the present document specifies the stage 3 for the LI_HI1 and
LI_HI2 interfaces. Only the first option indicated above is used for N9HR LI.
### 7.10.3 HR LI Phase 1
#### 7.10.3.1 Overview
The Phase-1 of HR LI that applies to all inbound roaming UEs with home-routed
roaming using the IMS-based services include the functions that revolve around
the following interfaces (see TS 33.127 [5]):
\- LI_X1: Used by the LIPF to provision the BBIFF-C/BBIFF and optionally, the
LMISF-IRI to enable the same for HR LI (aka initial configuration of HR LI).
\- LI_T3: Used by the BBIFF-C to instruct the BBIFF-U to capture and deliver
the IMS signaling related user plane packets of inbound roaming UEs to the
LMISF-IRI.
\- LI_X2_LITE: Used by the BBIFF-C/BBIFF to carry the control plane
information (e.g. packet data connection related notifications, UE location)
to LMISF-IRI for inbound roaming UEs.
\- LI_X3_LITE_S: Used by the BBIFF-U/BBIFF to forward the IMS signalling
related user plane packets of inbound roaming UEs to the LMISF-IRI.
The triggering interface LI_T3 is not used in the case of BBIFF in SGW. The
LI_X3_LITE_S is also used in HR LI Phase-2.
The LI_X2_LITE shall be realized using the X2 protocol as defined in ETSI TS
103 221-2 [8]. Likewise, the LI_X3_LITE_S and LI_X3_LITE_M shall be realized
using the X3 protocol as defined in ETSI TS 103 221-2 [8].
#### 7.10.3.2 Provisioning over LI_X1
##### 7.10.3.2.1 General
For Phase-1 of HR LI, the following LI functions are provisioned over LI_X1 by
the LIPF using the X1 protocol defined in ETSI TS 103 221-1 [7] with the LIPF
playing the role of ADMF and the following LI functions playing the role of NE
as per the reference model depicted in ETSI TS 103 221-1 [7]:
\- BBIFF-C present in the SMF.
\- BBIFF-C present in the SGW-C.
\- BBIFF present in the SGW.
\- LMISF-IRI.
As described in clause 7.10.1, the Phase-1 of HR LI applies to all inbound
roaming UEs that use the IMS-based services with home-routed roaming. The
target identities \"HR\" and \"IMSSignaling\" are used for Phase-1 of HR LI.
##### 7.10.3.2.2 Provisioning of BBIFF-C and BBIFF
The minimum details of LI_X1 ActivationTask message is shown in table
7.10.3.2-2.
Table 7.10.3.2-1: Void
Table 7.10.3.2-2: ActivateTask message for activating BBIFF-C and BBIFF
* * *
ETSI TS 103 221-1 field name Description M/C/O XID Shall be set to a value
assigned by the LIPF. This shall be same as the XID used for ActivateTask as
shown in table 7.10.3.2-4 when LMISF-IRI is configured using the ActivateTask.
M TargetIdentifiers Shall contain Target Identifiers of type \"HR\" and
\"IMSSignaling\" (see table 7.10.3.2-3). M DeliveryType Set to \"X2andX3\". M
ListOfDIDs Shall give the DID of the LMISF-IRI to which the xIRI and xCC
should be delivered. The delivery endpoint is configured using the
CreateDestination message as described in ETSI TS 103 221-1 [7] clause 6.3.1
prior to the task activation. M
* * *
Table 7.10.3.2-3: Target Identifier Type for enabling HR LI
* * *
Identifier type ETSI TS 103 221-1 [7] TargetIdentifier type Definition HR
TargetIdentifierExtension /HR Empty tag (see XSD schema) IMSSignaling
TargetIdentifierExtension/IMSSignaling Empty tag (see XSD schema)
* * *
##### 7.10.3.2.3 Provisioning of LMISF-IRI
The LMISF-IRI is listed as the delivery endpoint over LI_X2_LITE for xIRI
generated by the BBIFF-C/BBIFF and for the xCC generated by the BBIFF-U/BBIFF.
The provisioning of LMISF-IRI is to enable it to receive the xIRIs and xCC
sent from the BBIFF-C (SMF, SGW-C), BBIFF-U (UPF, SGW-U) and BBIFF (SGW). As
an alternate deployment option, LMISF-IRI may be presumed to be enabled to
receive such xIRI/xCC by default. This clause does not apply to such alternate
deployment option.
Table 7.10.3.2-4 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the LMISF-IRI for Phase-1.
Table 7.10.3.2-4: ActivateTask message for activating the LMISF-IRI for
Phase-1
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 field | Description | M/C/O | | name | | | +-----------------------------+-----------------------------+-------+ | XID | Shall be set to a value | M | | | assigned by the LIPF. This | | | | shall be same as the XID | | | | used for ActivateTask as | | | | shown in table 7.10.3-2. | | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | Shall contain two Target | M | | | Identifiers of type \"HR\" | | | | and \"IMSSignaling\" (see | | | | table 7.10.3.2-3). | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to \"X2andX3\". | M | | | | | | | LMISF-IRI shall use this | | | | only to enable the | | | | receiving of xIRI and xCC | | | | from the BBIFF-C/BBIFF. | | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Shall be given as an empty | M | | | list, since DIDs are not | | | | required in LMISF-IRI for | | | | Phase-1. | | +-----------------------------+-----------------------------+-------+
#### 7.10.3.3 Generation of xIRI over LI_X2_LITE
##### 7.10.3.3.1 General
LI_X2_LITE is an interface between the BBIFF-C/BBIFF to the LMISF-IRI. The
xIRIs are generated at the BBIFF-C/BBIFF and are sent over LI_X2_LITE
interface to the LMISF-IRI. These xIRIs are applicable to HR LI Phase-1 only.
For N9HR LI, the BBIFF-C present in the SMF shall generate the xIRIs as
described in clause 7.10.3.3.2. For S8HR LI, the BBIFF-C present in the SGW-C
and BBIFF present in the SGW shall generate the xIRIs as defined in clause
7.10.3.3.3.
The xIRIs are generated only when the following prior conditions are met:
\- ActivateTask with target identity \"HR\" and \"IMSSignaling\" is received
with X2 being included in the delivery type.
\- The MCC + MNC of the Operator Identifier field of the DNN (for N9HR) or APN
(for S8HR) is different from the MCC+MNC configured in the SMF (N9HR) or
SGW-C/SGW (S8HR) - see TS 29.502 [16], clause 6.1.6.2.2 and 23.003 [19] clause
9.1.2.
\- The Network Identifier field of DNN (for N9HR) or APN (for S8HR) contains
\"IMS\" (IMS services) - see GSMA IR.88 [67].
The first point is indicating that HR LI is enabled (see clause 7.10.3.2.2).
The second point is telling that the UE is an inbound roamer with home-routed
based roaming. The third point is telling that the PDU session/PDN connection
is for IMS services.
##### 7.10.3.3.2 N9HR LI
The BBIFF-C present in the SMF shall generate the following xIRI when the
prior conditions defined in clause 7.10.3.3.1 are met:
\- N9HRPDUSessionInfo.
The main purpose of the xIRI is to report the UE location, PDU session ID and
the SMF identity. The scenarios that result in the above xIRI are listed below
and apply to all inbound roaming UEs with home-routed roaming and using IMS
services:
\- PDU session is established with the creation of a default QoS flow for IMS
signaling.
\- PDU session is modified with the creation of a dedicated QoS flow used for
IMS media.
\- PDU session is modified with the updates to the QoS flow.
\- PDU session is modified with the deleting of dedicated QoS flow used for
IMS media.
\- PDU session is deleted.
\- MA PDU session is created, modified or deleted.
\- SMF relocation.
\- New UE location due to UE requested or network initiated service request.
\- New UE location due to hand-over situations including EPS to 5GS handover.
\- New UE location due to tracking area updates or routing area updates.
\- New SMF from the SMF set is taking over the PDU session.
\- HR LI is enabled with an established PDU session.
The exact trigger for the xIRI is subject to implementation, however, the
following can be used as a general guidance along with observing the prior
conditions listed in clause 7.10.3.3.1:
\- SMF receives the Nsmf_PDU_Session_Create response message with n1SmInfoToUe
IE containing the PDU SESSION ESTABLISHMENT ACCEPT (see TS 29.502 [16]) from
the H-SMF and sends the NAS message (via AMF) PDU SESSION ESTABLISHMENT ACCEPT
to the UE as a part of PDU session establishment procedures. This may also
happen with MA PDU session establishment procedures, or during handover
procedures with access type change, or as a part of SMF relocation procedures.
\- SMF receives an Nsmf_PDUSession_UpdateSMContext request from the AMF with a
new UE location. This may happen whenever a PDU session or a MA PDU session is
modified with the addition, modification or deletion of a dedicated QoS flow.
This may also happen for UE-initiated or network-initiated service request
procedures, or as a part of the handover procedures, or as a part of the
tracking area update procedures.
\- When a new SMF (e.g. in the SMF set) takes over the control for the PDU
session.
\- When an ActivateTask is received from the LIPF over LI_X1 (see clause
7.10.3.2.2) to enable the HR LI, the BBIFF-C present in the SMF detects that a
PDU session for IMS services is already established for an inbound roaming UE
with home-routed roaming.
NOTE: The sending of xIRI for each already established PDU session may result
in a significant number of xIRI messages from the BBIFF-C to the LMISF-IRI.
The contents of xIRI N9HRPDUSessionInfo record is shown in table 7.10.3.3-1
below.
Table 7.10.3.3-1: Payload of N9HRPDUSessionInfo record
Field name Description M/C/O
* * *
sUPI SUPI associated with the PDU session (e.g. as provided by the AMF in the
associated Nsmf_PDU Session_CreateSMContext service operation). M pEI PEI
associated with the PDU session, if available. C pDUSessionID PDU Session ID.
See TS 24.501 [13] clause 9.4. M location UE location information provided by
the AMF. C sNSSAI Slice identifiers associated with the PDU session, if
available. See TS 23.003 [19] clause 28.4.2 and TS 23.501 [2] clause 5.12.2.2.
C dNN Data Network Name associated with the UE traffic, as defined in TS
23.003[19] clause 9A and described in TS 23.501 [2] clause 4.3.2.2. Shall be
given in dotted-label presentation format as described in TS 23.003 [19]
clause 9.1. C messageCause Included to indicate why the xIRI is generated (see
table 7.10.3.3-2). M
Table 7.10.3.3-2: messageCause details
Field name Description
* * *
pDUSessionEstablished Indicates that the PDU session is established.
pDUSessionModified Indicates that the PDU session is being modified.
pDUReleased Indicates that the PDU session is being released.
updatedLocationAvailable Indicates that an updated UE location is available
sMFChanged Indicates that the SMF that is handling the PDU session is changed.
other Indicates that cause is other than those listed elsewhere in this table.
hRLIEnabled Indicates that the HR LI is enabled after the PDU session for IMS
services is established.
The xIRIs shall include the Network Function ID (NFID), a conditional
attribute field as defined in ETSI TS 103 221-2 [8], with the V-SMF identity.
Handling of this xIRI within the LMISF-IRI is described in clause 7.10.3.4.
#### 7.10.3.3.3 S8HR LI
The BBIFF-C present in the SGW-C and BBIFF present in the SGW shall generate
the following xIRI for the purpose of S8HR LI when the prior conditions
defined in clause 7.10.3.3.1 are met:
\- S8HRBearerInfo.
The main purpose of the xIRI is to report the UE location and the SGW/SGW-C
identity to the LMISF-IRI. This xIRI is generated for the following scenarios
that apply to all inbound roaming UEs with home-routed roaming and using IMS
services:
\- PDN connection is established with the creation of a default bearer for IMS
signaling.
\- Dedicated bearer is activated for the for IMS media.
\- Dedicated bearer is updated for IMS media.
\- Dedicated bearer is deactivated for IMS media.
\- PDN is disconnected.
\- SGW-C/SGW relocation.
\- New UE location due to UE requested or network initiated service request.
\- New UE location due to hand-over situations including 5GS to EPS handover.
\- New UE location due to tracking area updates or routing area updates.
\- HR LI is enabled with an established PDN connection with the creation of a
default bearer.
The exact trigger for the xIRI is subject to implementation, however, the
following can be used as a general guidance observing the prior conditions
listed in clause 7.10.3.3.1:
\- SGW-C/SGW receives a Create Session Response from the PGW-C/PGW and
forwards the same to the MME as a part of PDN connection establishment
procedures that creates the default bearer used for IMS signaling or as a part
of the handover procedures that results in the SGW-C/SGW relocation or 5GS to
EPS relocation.
\- SGW-C/SGW receives a Create Session Response from the MME and forwards the
same to the PGW-C/PGW as a part of dedicated bearer activation procedure on a
PDN connection used for IMS media.
\- SGW-C/SGW receives an Update Bearer Response from MME and forwards the same
to the PGW-C/PGW as a part of bearer update procedures with or without the
bearer update QoS.
\- SGW-C/SGW receives a Delete Bearer Response from MME and forwards the same
to the PGW-C/PGW as a part of bearer deactivation procedure.
\- SGW-C/SGW receives a Delete Session Request from the MME and forwards the
same to the PGW-C/PGW as a part of PDN disconnection procedures. The
procedures potentially have the last known UE location.
\- SGW-C/SGW receives a Create Session Request from the MME and sends a Modify
Bearer Request to the PGW-C/PGW as a part of tracking area/routing area update
procedures with a change of SGW-C/SGW. The procedures potentially have a new
UE location.
\- SGW-C/SGW receives a Modify Bearer Request from the MME and sends the same
to the PGW-C/PGW as a part of Service Request handling procedures, or hand-
over procedures, or tracking area/routing area update procedures without a
change in the SGW-C/SGW. The procedures potentially have a new UE location.
\- When an ActivateTask is received from the LIPF over LI_X1 (see clause
7.10.3.2.2) to enable the HR LI, the BBIFF-C/BBIFF present in the SGW-C/SGW
detects that a PDN connection with a default bearer used for IMS services is
already established for an inbound roaming UE with home-routed roaming.
NOTE: The sending of xIRI for each already established PDN connection may
result in a significant number of xIRI messages from the BBIFF-C/BBIFF to the
LMISF-IRI.
The details of the xIRI S8HRBearerInfo record is defined in table 7.10.3.3-3
below.
Table 7.10.3.3-3: Payload for S8HRBearerInfo record
Field name Description M/C/O
* * *
iMSI IMSI associated with the PDN connection on which a bearer is created. M
iMEI IMEI associated with the PDN connection on which a bearer is created, if
available. C bearerID The identity of the EPS bearer. M linkedBearerID The
identity of the default bearer when the bearerID is for dedicated bearer. C
location Location information provided by the MME. C aPN Packet Data Network
to which the connection is being made, as defined in TS 23.003[19] clause 9A
and described in TS 23.401 [50] clause 4.3.2.2. Applicable for PDN connection
establishment. Shall be given in dotted-label presentation format as described
in TS 23.003 [19] clause 9.1. C sGWIPAddress IP Address of the SGW-C or SGW as
applicable and when available. C messageCause Included to indicate why the
xIRI is generated (see table 7.10.3.3-4). M
Table 7.10.3.3-4: messageCause details
Field name Description
* * *
bearerActivated Indicates that the bearer is activated (default or dedicated).
bearerModified Indicates that the bearer is being modified. bearerDeleted
Indicates that the bearer is being deactivated. pDNDisconnected Indicates that
the PDN is disconnected. updatedLocationAvailable Indicates that an updated UE
location is available. sGWChanged Indicates that the SGW that is handling the
PDN connection is changed. other Indicates that cause is other than those
listed elsewhere in this table. hRLIEnabled Indicates that the HR LI is
enabled after the PDN connection with default bearer for IMS services is
established.
All of the xIRIs listed above shall also include the Network Function ID
(NFID), a conditional attribute field as defined in ETSI TS 103 221-2 [8],
with the SGW-C/SGW identity.
Handling of this xIRI within the LMISF-IRI is described in clause 7.10.3.4.
#### 7.10.3.4 LMISF-IRI handling of xIRIs received over LI_X2_LITE
##### 7.10.3.4.1 Handling of xIRIs
The LMISF-IRI that receives the xIRI, N9HRPDUSessionInfo record shall store or
update the record with the information received in the xIRI (e.g. UE location)
as applicable, for the future handling.
The LMISF-IRI that receives the xIRI, S8HRBearerInfo record shall store or
update the record with the information received in the xIRI (e.g. UE location)
as applicable, for the future handling.
The stored record is referred to LI_X2_LITE record in the present document.
##### 7.10.3.4.2 Handling of the stored record
For the N9HR LI related LI_X2_LITE records, the LMISF-IRI shall use the SUPI
and PDU Session ID to uniquely associate a record with the inbound roaming UE.
For S8HR LI related LI_X2_LITE records, the LMISF-IRI shall use the IMSI,
Linked Bearer ID or the Bearer ID (when the Linked Bearer ID is not present)
to uniquely associate a record with the inbound roaming UE.
#### 7.10.3.5 Triggering of BBIFF-U from BBIFF-C over LI_T3
##### 7.10.3.5.1 General
With HR LI Phase-1, the user plane packets from the IMS signaling channel are
delivered to the LMISF-IRI for all inbound roaming UEs with home-routed
roaming.
When BBIFF is separated into BBIFF-C and BBIFF-U, these user plane packets are
captured at the BBIFF-U. In order to enable the BBIFF-U to do that function,
the BBIFF-C triggers the BBIFF-U over the LI_T3 interface.
The BBIFF-U delivers the user plane from the IMS signaling channel over the
LI_X3_LITE-S interface to the LMISF-IRI.
##### 7.10.3.5.2 N9HR LI
When the BBIFF-C present in the SMF detects that a PDU session is established
with IMS signaling related QoS Flow for an inbound roaming UE with home-routed
roaming, it shall send an activation message to the BBIFF-U present in the UPF
over the LI_T3 interface with the associated QFI value.
The exact point at which the trigger is sent is left to the implementation
(preferably, when the SMF receives the N4: PFCF Session
Establishment/Modification Response from the UPF, see TS 29.244 [15] clauses
6.3.2 and 6.3.3), however, the BBIFF-C can send the trigger only when the
following conditions are met:
\- ActivateTask with target identity \"HR\" and \"IMSSignaling\" is received
with X3 being included in the delivery type.
\- The MCC + MNC of the Operator Identifier field of the DNN is different from
the MCC+MNC configured in the SMF - see TS 29.502[16] clause 6.1.6.2.2 and
23.203 [19] clause 9.1.2.
\- The Network Identifier field of DNN contains \"IMS\" (IMS services) - see
GSMA IR.88 [67].
\- The 5QI value associated with the QoS Flow is 5 -- see GSMA NG.114 [68].
The first point is indicating that N9HR LI is enabled (see clause 7.10.3.3.1)
with a need to capture and deliver the IMS signaling related user plane
packets. The second point is telling that the UE is an inbound roamer with
Home Routed based roaming. The third point is telling that the PDU session is
established for IMS services. The fourth point is telling that the IMS
signaling related QoS Flow is established.
If the PDU session for IMS services is already established for an inbound
roaming UE with Home-Routed based roaming when the above indicated
ActivateTask is received, then the BBIFF-C shall send the trigger at the time
Activation Task is received from the LIPF.
The details of ActivateTask sent to the BBIFF-U are shown in table 7.10.3.5-1.
Table 7.10.3.5-1: ActivateTask message for triggering the BBIFF-U in the UPF
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID Shall be set to the XID
of the Task Object associated with the interception at the BBIFF-C. M
TargetIdentifiers Packet detection criteria as determined by the BBIFF-C in
the SMF, which enables the BBIFF-U to isolate user-plane packets. The BBIFF-U
in the UPF shall support the identifier types given in table 6.2.3-7. The
target identity type of PDR ID shall be mandatory. The BBIFF-C in SMF shall
use the QFI associated with the IMS signaling (5QI = 5) related QoS flow to
populate the QFI field within the PDI of PDR ID. M DeliveryType Set to
\"X3Only\". M ListOfDIDs Shall give the DID of the LMISF-IRI to which the xCC
should be delivered. The delivery endpoint is configured using the
CreateDestination message as described in ETSI TS 103 221-1 [7] clause 6.3.1
prior to the task activation. M CorrelationID Correlation ID to assign to X3
PDUs generated by the BBIFF-U in the UPF. This field is populated with the
same CorrelationID the BBIFF-C in the SMF uses for the associated xIRI. M
* * *
When the BBIFF-C present in the SMF detects that the PDU session is released
(e.g. when SMF receives the N4: PFCF Session Deletion Response from the UPF,
see TS 29.244 [15], clause 6.3.4), it shall send a deactivation message to the
BBIFF-U present in the UPF over the LI_T3 interface, if the task is still
active in the BBIFF-U.
The BBIFF-C shall also send the deactivation message to the BBIFF-U when a
DeactivateTask is received from the LIPF for the XID if the task is still
active in the BBIFF-U.
##### 7.10.3.5.3 S8HR LI
When the BBIFF-C present in the SGW-C detects that the default bearer used for
IMS signaling is activated on the PDN connection for an inbound roaming UE
with home-routed roaming, it shall send an activation message to the BBIFF-U
present in the SGW-U over the LI_T3 interface.
The exact point at which the trigger is sent is left to the implementation
(preferably, when the SGW-C receives the Sx: Session
Establishment/Modification Response from the SGW-U). However, the BBIFF-C can
send the trigger only when the following conditions are met:
\- ActivateTask with target identity \"HR\" and \"IMSSignaling\" is received
with X3 being included in the delivery type.
\- The MCC + MNC of the Operator Identifier field of the APN is different from
the MCC+MNC configured in the SGW/SGW-C - see TS 29.502 [16] clause 6.1.6.2.2
and 23.203 [19] clause 9.1.2.
\- The Network Identifier field of APN contains \"IMS\" (IMS services) - see
GSMA IR.88 [67].
\- The QCI value associated with the default bearer is 5 -- see GSMA NG.114
[68].
The first point is indicating that S8HR LI is enabled (see clause 7.10.3.3.1)
with a need to capture and deliver the IMS signaling related user plane
packets. The second point is telling that the UE is an inbound roamer with
Home Routed based roaming. The third point is telling that the PDN connection
is established for IMS services. The fourth point is telling that the IMS
signaling bearer is activated.
If the default bearer (for IMS signaling bearer) on the PDN connection is
already established for an inbound roaming UE with Home-Routed based roaming
when the above indicated ActivateTask is received, then the BBIFF-C shall send
the trigger at the time Activation Task is received from the LIPF.
The details of ActivateTask sent to the BBIFF-U present in the SGW-U are shown
in table 7.10.3.5-2.
Table 7.10.3.5-2: ActivateTask message for triggering the BBIFF-U in the SGW-U
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID Shall be set to the XID
of the Task Object associated with the interception at the BBIFF-C. M
TargetIdentifiers Packet detection criteria as determined by the BBIFF-C in
the SGW-C, which enables the BBIFF-U in SGW-U to isolate user-plane packets.
The BBIFF-U in the SGW-U shall support the identifier types given in table
6.2.3-7. The target identity type of PDR ID shall be mandatory. The BBIFF-C in
SGW-C shall use the F-TIEDs associated with the IMS signaling (QCI = 5)
related default bearer to populate the F-TEID field within the PDI of PDR ID.
M DeliveryType Set to \"X3Only\". M ListOfDIDs Shall give the DID of the
LMISF-IRI to which the xCC should be delivered. The delivery endpoint is
configured using the CreateDestination message as described in ETSI TS 103
221-1 [7] clause 6.3.1 prior to the task activation. M CorrelationID
Correlation ID to assign to X3 PDUs generated by the BBIFF-U in the SGW-U.
This field is populated with the same CorrelationID the BBIFF-C in the SGW-C
uses for the associated xIRI. M
* * *
When the BBIFF-C present in the SGW-C detects that the PDN connection is
released (e.g. when SGW-C receives the Sx: Session Release Response from the
SGW-U), it shall send a deactivation message to the BBIFF-U present in the
SGW-U over the LI_T3 interface, if the task is still active in the BBIFF-U.
The BBIFF-C present in the SGW-C shall also send the deactivation message to
the BBIFF-U present in the SGW-U when a DeactivateTask is received from the
LIPF for the XID if the task is still active in the BBIFF-U.
#### 7.10.3.6 Generation of xCC over LI_X3_LITE_S
##### 7.10.3.6.1 BBIFF-U
The BBIFF-U in UPF and the BBIFF-U in SGW-U shall send the xCC over
LI_X3_LITE_S for each of the packet matching the criteria specified in the
Triggering message (i.e. Activate Task message) received over the LI_T3 from
the BBIFF-C.
##### 7.10.3.6.2 BBIFF
The BBIFF present in the SGW shall send the xCC over LI_X3_LITE_S for each of
the packet from the default bearer with the QCI value of 5 (GSMA NG.114 [68])
with following other conditions:
\- ActivateTask with target identity \"HR\" and \"IMSSignaling\" is received
with delivery type \"X3Only\".
\- The MCC + MNC of the Operator Identifier field of the APN is different from
the MCC+MNC configured in the SGW - see TS 29.502 [16], clause 6.1.6.2.2 and
23.203 [19] clause 9.1.2.
\- The Network Identifier field of APN contains \"IMS\" (IMS services) - see
GSMA IR.88 [67].
The first point is indicating that S8HR LI is enabled (see clause 7.10.3.2.2)
with a need to capture and deliver the IMS signaling related user plane
packets. The second point is telling that the UE is an inbound roamer with
Home Routed based roaming. The third point is telling that the PDN connection
is established for IMS services.
The BBIFF in SGW uses the QCI value of 5 (GSMA NG.114 [68]) to identify that
the packets are from the IMS signaling bearer.
##### 7.10.3.6.3 X3 PDU format
Each X3 PDU shall contain the contents of the user plane packet given using
the GTP-U, IP or Ethernet payload format.
The BBIFF-U/BBIFF shall set the payload format to indicate the appropriate
payload type (5 for IPv4 Packet, 6 for IPv6 Packet, 12 for GTP-U Packet as
described in ETSI TS 103 221-2 [8] clauses 5.4 and 5.4.13.
#### 7.10.3.7 LMISF-IRI handling of xCC received over LI_X3_LITE_S
The LMISF-IRI shall extract the IMS signaling messages (i.e. SIP messages)
from the xCC received over the LI_X3_LITE_S from the BBIFF-U/BBIFF.
The LMISF-IRI shall examine the extracted SIP message for a target match as
described in clause 7.10.4.2. If no match is found, then the LMISF-IRI shall
store the extracted SIP message for a later use. If a match is found, then the
LMISF-IRI shall proceed according to clause 7.10.4.3.
The record that stores the SIP message is referred to as LI_X2_LITE_S record.
### 7.10.4 HR LI Phase 2
#### 7.10.4.1 Overview
The Phase-2 of HR LI that applies to inbound roaming target UEs that use IMS-
based services with home-routed roaming or the inbound roaming UEs that use
IMS-based services with home-routed roaming to communicate with the target
non-local ID include the functions that revolve around the following
interfaces.
\- LI_X1: Used by the LIPF to provision the LMISF-IRI, MDF2 and MDF3 with the
LI information for a target.
\- LI_T1: Used by the LMISF-IRI to instruct the BBIFF-C/BBIFF that IMS media
related user plane packets of target\'s communication need to be captured and
delivered to the LMISF-CC.
\- LI_T3: Used by the BBIFF-C to instruct the BBIFF-U to capture and deliver
the IMS media related user plane packets of target\'s communication to the
LMISF-CC.
\- LI_X3_LITE_S: Used by the BBIFF-U/BBIFF to forward the IMS signalling
related user plane packets of inbound roaming UEs to the LMISF-IRI.
\- LI_X3_LITE_M: Used by the BBIFF-U/BBIFF to forward the IMS media related
user plane packets of target\'s communication to the LMISF-CC.
The triggering interface LI_T3 is not used in the case of BBIFF in SGW. The
LI_X3_LITE_S is also used for HR LI Phase-1.
#### 7.10.4.2 Provisioning over LI_X1
##### 7.10.4.2.1 General
For Phase-2 of HR LI, the following LI functions are provisioned over LI_X1 by
the LIPF using the X1 protocol defined in ETSI TS 103 221-1 [7] with the LIPF
playing the role of ADMF and the following LI functions playing the role of NE
as per the reference model depicted in ETSI TS 103 221-1 [7].
\- LMISF-IRI.
\- MDF2.
\- MDF3.
As described in clause 7.10.1, the Phase-2 of HR LI applies to inbound roaming
target UEs that use IMS-based services with home-routed roaming or the inbound
roaming UEs that use IMS-based services with home-routed roaming to
communicate with the target non-local ID. The following target identities are
used for Phase-2 of HR LI:
\- IMPU.
\- IMPI.
\- PEIIMEI.
\- IMEI.
The target identity in the IMPI format may contain a value derived from a SUPI
or an IMSI. The target identity in the IMPU format containing a SIP URI or TEL
URI may contain a value derived from a GPSI, MSISDN, an E.164 number, or IMSI.
Only IMPU is used for target non-local ID. For triggered LALS, the LTF
function associated with LMISF-IRI (see clause 7.3.1 and Annex G) is
provisioned with the target identity of IMPU.
##### 7.10.4.2.2 Provisioning of LMISF-IRI
The LMISF-IRI shall be provisioned over LI_X1 by the LIPF for target based
interception of IMS services in the VPLMN with home-routed roaming.
The target identities listed in clause 7.10.4.2.1 shall apply for the
provisioning of LMISF-IRI with LMISF-IRI playing the combined role of IRI-POI
and CC-TF for the interception of IMS-based services in the VPLMN with home-
routed roaming.
> The LMISF-IRI shall support the following service scoping from the structure
> defined in ETSI TS 103 221-1 [7]:
\- The enumerated value of \"voice\" or \"messaging\" in the service type
field.
\- When location reporting is required, one or both of
\"reportBeginingAndEnd\", \"reportUponChange\".
\- \"SuspendOnOutboundInternationalRoaming\".
Table 7.10.4.2-1 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the LMISF-IRI for Phase-2.
Table 7.10.4.2-1: ActivateTask message for activating LMISF-IRI for Phase-2
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID XID assigned by LIPF.
The value used here is different from the value used in ActivateTask shown in
table 7.10.3.2-4. M TargetIdentifiers One or more of the target identifiers
listed in clause 7.10.4.2.1. M DeliveryType Set to "X2Only", "X3Only" or
"X2andX3" as needed to meet the requirements of the warrant. M ListOfDIDs
Delivery endpoints of LI_X2 or LI_X3. These delivery endpoints shall be
configured using the _CreateDestination_ message as described in ETSI TS 103
221-1 [7] clause 6.3.1 prior to first use. M ServiceScoping Using the format
defined in ETS TS 103 221 [7] based on the service scoping listed above the
table. When multiple intercepts are activated on a target identifier, the
service scoping shall be the union of all of them. C
* * *
##### 7.10.4.2.3 Provisioning of the MDF2
The MDF2 listed as the delivery endpoint over LI_X2 for xIRI generated by the
LMISF-IRI shall be provisioned over LI_X1 by the LIPF.
The target identities listed in clause 7.10.4.2.1 shall apply for the
provisioning of MDF2.
> The MDF2 shall support the following service scoping from the structure
> defined in ETSI TS 103 221-1 [7]:
\- The enumerated value of \"voice\" or \"messaging\" in the service type
field.
\- When location reporting is required, one or both of
\"reportBeginingAndEnd\", \"reportUponChange\".
Table 7.10.4.2-2 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the MDF2.
Table 7.10.4.2-2 ActivateTask message for MDF2
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID XID assigned by LIPF. M
TargetIdentifiers One or more of the target identifiers listed in clause
7.10.4.2.1. M DeliveryType This value shall be Ignored by the MDF2. M
ListOfDIDs Delivery endpoints of LI_HI2. These delivery endpoints shall be
configured using the _CreateDestination_ message as described in ETSI TS 103
221-1 [7] clause 6.3.1 prior to first use. M ListOfMediationDetails Sequence
of Mediation Details, See table 7.10.4.2-3. M
* * *
Table 7.10.4.2-3: Mediation Details for MDF2
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O LIID Lawful Intercept ID
associated with the task. M DeliveryType Set to \"HI2Only\". M ListOfDIDs
Details of where to send the IRI for this LIID. Shall be included if deviation
from the ListofDIDs in the ActivateTask message is necessary. If included, the
ListOfDIDs in the Mediation Details shall be used instead of any delivery
destinations authorised by the ListOfDIDs field in the ActivateTask Message. C
ServiceScoping Using the format defined in ETS TS 103 221 [7] include the
service scoping as applicable to this LIID based on the service scoping listed
above the table. C
* * *
##### 7.10.4.2.4 Provisioning of the MDF3
The MDF3 listed as the delivery endpoint over LI_X3 for xCC generated by the
LMISF-CC shall be provisioned over LI_X1 by the LIPF.
The target identities listed in clause 7.10.4.2.1 shall apply for the
provisioning of MDF3.
> The MDF3 shall support the following service scoping from the structure
> defined in ETSI TS 103 221-1 [7]:
\- The enumerated value of \"voice\" or \"messaging\" in the service type
field.
\- When location reporting is required, one or both of
\"reportBeginingAndEnd\", \"reportUponChange\".
Table 7.10.4.2-4 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the MDF3.
Table 7.10.4.2-4 ActivateTask message for MDF3
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID XID assigned by LIPF. M
TargetIdentifiers One or more of the target identifiers listed in clause
7.10.4.2.1. M DeliveryType This value shall be Ignored by the MDF3. M
ListOfDIDs Delivery endpoints of LI_HI3. These delivery endpoints shall be
configured using the _CreateDestination_ message as described in ETSI TS 103
221-1 [7] clause 6.3.1 prior to first use. M ListOfMediationDetails Sequence
of Mediation Details, See table 7.10.4.2-5. M
* * *
Table 7.10.4.2-5: Mediation Details for MDF3
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O LIID Lawful Intercept ID
associated with the task. M DeliveryType Set to \"HI3Only\". M ListOfDIDs
Details of where to send the IRI for this LIID. Shall be included if deviation
from the ListofDIDs in the ActivateTask message is necessary. If included, the
ListOfDIDs in the Mediation Details shall be used instead of any delivery
destinations authorised by the ListOfDIDs field in the ActivateTask Message. C
ServiceScoping Using the format defined in ETS TS 103 221 [7] include the
service scoping as applicable to this LIID based on the service scoping listed
above the table. C
* * *
#### 7.10.4.3 Generation of xIRI over LI_X2
##### 7.10.4.3.1 General concepts
The LMISF-IRI extracts the SIP messages that it receives within the xCC from
the BBIFF-U/BBIFF over the LI_X3_LITE_S.
On the originating end of a voice session, the LMISF-IRI examines the SIP
message, the stored LI_X2_LITE record and the stored LI_X3_LITE_S record to
check for the following:
\- Whether the calling party identity is a target.
\- Whether the called party identity is a target non-local ID.
On the terminating end of a voice session, the LMISF-IRI examines the SIP
message, the stored LI_X2_LITE record and the stored LI_X3_LITE_S record to
check for the following:
\- Whether the called party identity is a target.
\- Whether the calling party identity is a target non-local ID.
\- Whether the redirecting party identity is a target non-local ID.
The SIP headers used for identifying a calling party identity, called party
identity, redirecting party identity can be same identities used by the IMS
signaling functions with the following additions:
\- P-Preferred Identity as calling party identity.
When any of the conditions listed above are true, the LMISF-IRI concludes that
target is involved in an IMS session that shall be intercepted. Accordingly,
the LMISF-IRI generates the xIRIs and delivers the same to the MDF2 over the
LI_X2.
For IMS-based voice services, if media interception is required, the LMISF-IRI
sends a trigger for the same to the BBIFF-C/BBIFF over the LI_T1 interface.
##### 7.10.4.3.2 Target match
###### 7.10.4.3.2.1 General
When an IMS UE performs an IMS registration (using SIP REGISTER) request, the
LMISF-IRI examines the following for a target match:
\- From header and To header of the SIP REGISTER when the target identity is
IMPU.
\- SUPI or IMSI stored in the LI_X2_LITE record when the target identity is
IMPI.
\- +sip.instance-id of Contact header of the SIP REGISTER when the target
identity is PEIIMEI or IMEI.
The LMISF-IRI shall store the +sip.instance-id in the LI_X2_LITE_S record for
later use.
###### 7.10.4.3.2.2 Service type of voice
When an IMS UE originates an IMS session (using SIP INVITE), the LMISF-IRI
examines the following to verify for a target match:
\- P-Preferred Identity header and From header present in the SIP INVITE when
the target identity is IMPU.
\- Request URI header and To header present in the SIP INVITE when the target
identity is IMPU and target is non-local ID.
\- SUPI or IMSI stored in the LI_X2_LITE record when the target identity is
IMPI.
\- +sip.instance-id of Contact header received in the SIP REGISTER request
when the target identity is PEIIMEI or IMEI.
When an IMS UE receives an incoming IMS session (using SIP INVITE), the LMISF-
IRI examines the following to verify for a target match:
\- Request URI and To header present in the SIP INVITE when the target
identity is IMPU.
\- P-Asserted-Id, From header, History Info header and Diversion header
present in the SIP header when the target identity is IMPU and target is non-
local ID.
\- SUPI or IMSI stored in the LI_X2_LITE record when the target identity is
IMPI.
\- +sip.instance-id of Contact header received in the SIP REGISTER request
when the target identity is PEIIMEI or IMEI.
LMISF-IRI may use the Via header or the Route header to determine whether the
SIP INVITE is for an originating IMS session or a terminating IMS session.
LMISF-IRI stores the SIP Call Id to associate the subsequent SIP messages
received on the same session for a target match.
For subsequent SIP messages, the LMISF-IRI may use the stored LI_X3_LITE_S
record to determine for a target match.
###### 7.10.4.3.2.3 Service type of messaging
When the Service Type received in the LI_X1 provisioning is \"messaging\", the
LMISF-IRI examines the SIP MESSAGE for a target match as shown below:
\- For MO-SMS over IP, P-Preferred Identity header and From header present in
the SIP MESSAGE when the target identity is IMPU.
\- For MO-SMS over IP, TP-DA field of SMS-SUBMIT within the Message-body of
SIP MESSAGE when the target identity IMPU for target non-local ID.
\- For MT-SMS over IP, the Request URI and To header present in the SIP
MESSAGE when the target identity is IMPU.
\- For MT-SMS over IP, the TP-OA field or TP-RA field of SMS-SUBMIT within the
Message-body SIP MESSAGE when the target identity IMPU for target non-local
ID.
\- SUPI or IMSI stored in the LI_X2_LITE record when the target identity is
IMPI.
\- +sip.instance-id of Contact header received in the SIP REGISTER request
when the target identity is PEIIMEI or IMEI.
LMISF-IRI may use the Via header or the Route header to determine whether the
SIP MESSAGE is for MO-SMS over IP or MT-SMS over IP.
##### 7.10.4.3.3 xIRIs
The xIRIs generated at the LMISF-IRI shall be same as the xIRIs generated in
the IRI-POIs present in the IMS signaling functions (see clause 7.12.4.12).
As defined in TS 33.127 [5] the LMISF-IRI generates the following xIRIs:
\- Encapsulated SIP message.
\- Start of interception with an established IMS session.
The xIRI CC Unavailable defined in TS 33.127 [5] for IMS-based services is not
applicable to N9HR LI and S8HR LI. The encapsulated SIP message is sent using
the xIRI IMSMessage record.
Further details of the xIRIs are defined in clause 7.12.4.12.
#### 7.10.4.4 Triggering of BBIFF-C from LMISF over LI_T1
##### 7.10.4.4.1 General
When the intercepted IMS-session requires the media interception, the LMISF-
IRI sends a trigger to the BBIFF-C/BBIFF over to the LI_T1 interface (see TS
33.127 [5]) with LMISF-CC as the delivery end point.
The LMISF-IRI upon discovering through the xIRIs received over the LI_X2_LITE
interface that a change in SMF or SGW-C/SGW has occurred for an interception
involving an IMS-session shall send the trigger to BBFF-C/BBIFF present in the
new SMF or SGW-C/SGW over LI_T1 interface with LMISF-CC as the delivery end
point to continue the IMS media interception when required.
When the IMS session is completely released (e.g. all session-legs are
released), the LMISF-IRI sends a trigger to the BBIFF-C/BBIFF to stop the
media intereption. The LMISF-IRI may also send the trigger to stop the media
interception when the target information is deprovisioned in the LMISF-IRI by
the LIPF.
NOTE: When multiple warrants are active on a target, the activation or
deactivation of a warrant may not result in a trigger to BBIFF-C./BBIFF (e.g.
if a trigger has already been sent due to other warrants).
The present document supports the media interception of IMS voice media.
##### 7.10.4.4.2 N9HR LI
The LI_T1 trigger that the LMISF-IRI sends to the BBIFF-C present in the SMF
shall include at least the following information:
\- The XID that LMISF-IRI receives from the LIPF over LI_X1 for the target
related activation.
\- Target identity: SUPI, PDU session ID, IMS voice media.
\- Delivery end point: LMISF-CC.
The details of ActivateTask sent to the BBIFF-C in SMF over LI_T1 are shown in
table 7.10.4.4-1.
Table 7.10.4.4-1: ActivateTask message for triggering the BBIFF-C in the SMF
over LI_T1
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID Allocated by the LMISF-
IRI as per ETSI TS 103 221-1 [7]. M TargetIdentifiers Information that
identifies the need to intercept the IMS voice media. The target identifiers
as shown in table 7.10.4.4-2. M DeliveryType Set to \"X3Only\". M ListOfDIDs
Shall give the DID of the LMISF-CC to which the xCC should be delivered. The
delivery endpoint is configured using the CreateDestination message as
described in ETSI TS 103 221-1 [7] clause 6.3.1 prior to the task activation.
M CorrelationID This value is set by the LMISF-IRI and shall be same as the
value to be used in the xCC generated at the LMISF-CC. The BBIIF-C passes this
field to the BBIFF-U over LI_T3. M ProductID Shall be set to the XID of the
Task Object associated with the interception at the LMISF-IRI. This value
shall be passed to the BBIFF-U over LI_T3. M
* * *
Table 7.10.4.4-2: Target Identifier Types for LI_T1 (BBIFF-C in SMF)
* * *
Identifier type ETSI TS 103 221-1 [7] TargetIdentifier type Definition SUPI
SUPI ETSI TS 103 221-1 [7] PDUSessionID TargetIdentifierExtension/PDUSessionID
Integer (see XSD schema) IMSVoiceMedia TargetIdentifierExtension/IMSVoiceMedia
Empty tag (see XSD schema) NOTE: The LMISF-IRI shall use the SUPI and PDU
Session ID received over the LI_X2_LITE interface to populate the target
identifiers SUPI and PDUSessionID respectively. The SUPI is in either SUPIIMSI
or IMSI format (ETSI TS 103-221-1 [7]).
* * *
The DeactivateTask message that the LMISF-IRI sends to the BBIFF-C present in
the SMF shall include the XID of the Task created by the ActivateTask message
(see table 7.10.4.4-1).
##### 7.10.4.4.3 S8HR LI
The LI_T1 trigger that the LMISF-IRI sends to the BBIFF-C present in the
SGW-C/SGW shall include at least the following information:
\- The XID that LMISF-IRI receives from the LIPF over LI_X1 for the target
related activation.
\- Target identity: IMSI, Bearer ID, IMS voice media.
\- Delivery end point: LMISF-CC.
The details of ActivateTask sent to the BBIFF-C in SGW-C over LI_T1 are shown
in table 7.10.4.4-3.
Table 7.10.4.4-3: ActivateTask message for triggering BBIFF-C/BBIFF in the
SGW-C/SGW over LI_T1
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID Allocated by the LMISF-
IRI as per ETSI TS 103 221-1 [7]. M TargetIdentifiers Information that
identifies the need to intercept the IMS voice media. See table 7.10.4.4-4. M
DeliveryType Set to \"X3Only\". M ListOfDIDs Shall give the DID of the LMISF-
CC to which the xCC should be delivered. The delivery endpoint is configured
using the CreateDestination message as described in ETSI TS 103 221-1 [7]
clause 6.3.1 prior to the task activation. M CorrelationID This value is set
by the LMISF-IRI and shall be same as the value to be used in the xCC
generated at the LMISF-CC. The BBIIF-C in passes this field to the BBIFF-U
over LI_T3. M ProductID Shall be set to the XID of the Task Object associated
with the interception at the LMISF-IRI. This value shall be passed to the
BBIFF-U over LI_T3. M
* * *
Table 7.10.4.4-4: Target Identifier Types for LI_T1 (BBIFF-C/BBIFF in
SGW-C/SGW)
* * *
Identifier type ETSI TS 103 221-1 [7] TargetIdentifier type Definition IMSI
IMSI ETSI TS 103 221-1 [7] BearerID TargetIdentifierExtension/BearerID Integer
(see XSD schema) IMSVoiceMedia TargetIdentifierExtension/IMSVoiceMedia Empty
tag (see XSD schema) NOTE: The LMISF-IRI shall use the IMSI and Bearer ID
received over the LI_X2_LITE interface to populate the target identifiers IMSI
and BearerID respectively.
* * *
The DeactivateTask message that the LMISF-IRI sends to the BBIFF-C/BBIFF
present in the SGW-C/SGW shall include the XID of the Task created by the
ActivateTask message (see table 7.10.4.4-3).
#### 7.10.4.5 Triggering of BBIFF-U from BBIFF-C over LI_T3
##### 7.10.4.5.1 General
When the trigger is received over the LI_T1 for activating the media
interception, the BBIFF-C present in the SGW-C shall send a trigger over LI_T3
to the BBIFF-U present in the SGW-U when a dedicated bearer for the IMS media
is established on the PDN connection.
When the trigger is received over the LI_T1 for activating the media
interception, the BBIFF-C present in the SMF shall send a trigger over LI_T3
to the BBIFF-U present in the UPF when the PDU session is modified for adding
IMS media related QoS flow.
If the trigger over LI_T1 is received for activating the media interception
after the IMS media related changes has happened (i.e. dedicated bearer is
established for IMS media, PDU session is modified for adding the IMS media
related QoS flow), then the BBIFF-C shall send the trigger to the BBIFF-U over
LI_T3 immediately.
The BBIFF-C shall trigger the BBIFF-U to stop the delivery of xCC to the
LMISF-CC when it receives the trigger from the LMISF-IRI over LI_T1 for
stopping the media interception, independent of whether the IMS media related
changes have happened or not.
##### 7.10.4.5.2 N9HR LI
The LI_T3 trigger that the BBIFF-C in SMF sends to the BBIFF-U present in the
UPF shall include at least the following information:
\- XID assigned locally by the BBIFF-C in the SMF.
\- The Product ID that includes the XID it receives from the LMISF-IRI over
LI_T1.
\- Target identity: PFCP Session ID, PDR ID with the QFI associated with the
IMS voice media (5Q = 1) related QoS flow.
\- Delivery end point: LMISF-CC
The details of ActivateTask sent to the BBIFF-U in UPF over LI_T3 are shown in
table 7.10.4.5-1.
Table 7.10.4.5-1: ActivateTask message for triggering the BBIFF-U in the UPF
over LI_T3
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID Allocated by the
BBIFF-C as per ETSI TS 103 221-1 [7]. M TargetIdentifiers Packet detection
criteria as determined by the BBIFF-C in the SMF, which enables the BBIFF-U to
isolate user-plane packets of IMS voice media. The BBIFF-U in the UPF shall
support the identifier types given in Table 6.2.3-7. The target identity type
of PDR ID shall be mandatory. The BBIFF-C in SMF shall use the QFI associated
with the IMS voice media (5QI = 1) related QoS flow to populate the QFI field
within the PDI of PDR ID. M DeliveryType Set to "X3Only". M ListOfDIDs Shall
give the DID of the LMISF-CC to which the xCC should be delivered. The
delivery endpoint is configured using the CreateDestination message as
described in ETSI TS 103 221-1 [7] clause 6.3.1 prior to the task activation.
M CorrelationID Correlation ID to assign to X3 PDUs generated by the BBIFF-U
in the UPF. This field is populated with the same CorrelationID received over
the LI_T1 interface (see table 7.10.4.4.1). M ProductID Shall be set to the
XID of the Task Object associated with the interception as received in the
ProductID field over LI_T1 interface (see table 7.10.4.4.1). This value shall
be used by the BBIFF-U in the UPF to fill the XID of X3 PDUs. M
* * *
The DeactivateTask sent to the BBIFF-U present in the UPF over LI_T3 shall
include the XID of the Task created by the ActivateTask message (see table
7.10.4.5-1).
##### 7.10.4.5.3 S8HR LI
The LI_T3 trigger that the BBIFF-C in SGW-C sends to the BBIFF-U present in
the SGW-U shall include at least the following information:
\- XID assigned locally by the BBIFF-C in the SGW-C.
\- The Product ID that includes the XID it receives from the LMISF-IRI over
LI_T1.
\- Target identity: PFCP Session ID, PDR ID with the F-TEID associated with
the IMS voice media (QCI = 1) related dedicated bearer.
\- Delivery end point: LMISF-CC.
The details of ActivateTask sent to the BBIFF-U in SGW-U over LI_T3 are shown
in table 7.10.4.5-2.
Table 7.10.4.5-2: ActivateTask message for triggering the BBIFF-U in the SGW-U
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID Allocated by the
BBIFF-C as per ETSI TS 103 221-1 [7]. M TargetIdentifiers Packet detection
criteria as determined by the BBIFF-C in the SGW-C, which enables the BBIFF-U
in SGW-U to isolate user-plane packets. The BBIFF-U in the SGW-U shall support
the identifier types given in Table 6.2.3-7. The target identity type of PDR
ID shall be mandatory. The BBIFF-C in SGW-C shall use the F-TEIDs associated
with the IMS voice media (QCI = 1) related dedicated bearer to populate the
F-TEID field within the PDI of PDR ID. M DeliveryType Set to "X3Only". M
ListOfDIDs Shall give the DID of the LMISF-CC to which the xCC should be
delivered. The delivery endpoint is configured using the CreateDestination
message as described in ETSI TS 103 221-1 [7] clause 6.3.1 prior to the task
activation. M CorrelationID Correlation ID to assign to X3 PDUs generated by
the BBIFF-U in the SGW-U. This field is populated with the same CorrelationID
received over the LI_T1 interface (see table 7.10.4.4.3). M ProductID Shall be
set to the XID of the Task Object associated with the interception as received
in the ProductID field over LI_T1 interface (see table 7.10.4.4.3). This value
shall be used by the BBIFF-U in the SGW-U to fill the XID of X3 PDUs. M
* * *
The DeactivateTask sent to the BBIFF-U present in the SGW-U over LI_T3 shall
include the XID of the Task created by the ActivateTask message (see table
7.10.4.5-2).
#### 7.10.4.6 Generation of xCC over LI_X3_LITE_M
The BBIFF-U in UPF and the BBIFF-U in SGW-U shall send the xCC over
LI_X3_LITE_M for each of the packet matching the criteria specified in the
Triggering message (i.e. Activate Task message) received over the LI_T3 from
the BBIFF-C.
The BBIFF in SGW shall identify the IMS voice media (QCI = 1) related
dedicated bearer associated with the IMS signaling related bearer as indicated
in the trigger received over the LI_T1 from the LMISF-IRI and then send xCC
over LI_X3_LITE_M for each of the packet captured from that dedicated bearer.
The BBIFF-U/BBIFF shall set the payload format to indicate the appropriate
payload type (5 for IPv4 Packet, 6 for IPv6 Packet, or 12 for GTP-U Packet as
described in ETSI TS 103 221-2 [8] clauses 5.4 and 5.4.13).
#### 7.10.4.7 Generation of xCC over LI_X3
The xCC generated at the LMISF-CC shall be same as the xCC generated in the
CC-POIs present in the IMS media functions. Further details of this are not
specified in the present document.
The correlation identifier value included in the xCC of an IMS session can be
dependent on the UDP port numbers associated with the voice-media related RTP
streams. This is the case when a user is involved in multiple IMS sessions. An
illustrated of this is shown in clause 7.10.4.8
#### 7.10.4.8 Correlation identifier
The xIRIs generated at the LMISF-IRI shall be correlated using the correlation
identifier field defined ETSI TS 103 221-2 [8]. This correlation identifier
value can be independent of the correlation identifier value received in the
xCC from the BBIFF-U/BBIFF over the LI_X3_LITE_S interface.
Furthermore, the xIRIs generated at the LMISF_IRI shall include the
correlation identifier value used in the xCC generated at the LMISF-CC. Any
intra-LMISF interactions required to associate the correlation identifier
values used by the LMISF-IRI and LMISF-CC are outside the scope of the present
document.
Each session-leg of an IMS session may have to be correlated separately. This
is accomplished using the RTP/RTCP port numbers present in the SDP of IMS
signaling message and the UDP port numbers present in the IMS voice media
related RTP as illustrated in figure 7.10.4.8-1 below.
Figure 7.10.4.8-1: Correlation at the session-leg level (an illustration)
Figure 7.10.4.8-1 illustrates an example where an IMS session includes two
session-legs.
Session-leg 1:
\- Source IP address: 192.0.2.10 and source port number: 24000 (RTP), 24001
(RTCP).
\- Destination IP address: 198.51.100.1 and destination port number: 32000
(RTP), 32001 (RTCP).
Session-leg 2:
\- Source IP address: 192.0.2.10 and source port number: 26000 (RTP), 26001
(RTCP).
\- Destination IP address: 198.51.100.1 and destination port number: 36000
(RTP), 36001 (RTCP).
The IP address of the two end-points happen to be the same for the two session
legs. The RTP port numbers present in the SDP of IMS signaling message and the
UDP port numbers of the associated with the IMS voice-media related RTP happen
to be the same for a session-leg.
Therefore, in general, multiple session-legs can be identified using the RTP
port numbers present in the SDP of IMS signaling message and the UDP port
numbers associated with the IMS voice-media related RTP.
#### 7.10.4.9 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from the LMISF-IRI, the MDF2 shall send
the IRI message over LI_HI2 without undue delay. The IRI message shall contain
a copy of the relevant record received from LI_X2. The record may be enriched
by other information available at the MDF (e.g. additional location
information).
The IRI messages delivered over the LI_HI2 for HR LI are same as the IRI
messages delivered over the LI_HI2 for LI IMS-based voice services. Further
details of this are outside the scope of the present document.
#### 7.10.4.10 Generation of CC over LI_HI3
When the xCC is received over LI_X3 from the LMISF-CC, the MDF3 shall deliver
the CC over LI_HI3 without undue delay.
The CC delivered over the LI_HI3 for HR LI is the same as the CC delivered
over the LI_HI3 for LI IMS-based voice services. Further details of this are
outside the scope of the present document.
## 7.11 STIR/SHAKEN and RCD/eCNAM
### 7.11.1 Provisioning over LI_X1
#### 7.11.1.1 General
When the interception of STIR/SHAKEN is required, the LIPF shall provision the
IRI-POI present in the following IMS NFs for the reporting of signing and
verification results, as applicable:
\- IBCF.
\- Telephony AS.
If the IRI-POI functions in IBCF or Telephony AS are already provisioned for
IMS-based services, then separate provisioning is not required. However, the
\"ReportDiversionPASSporTInfo\" shall be included, as specified in clause
7.11.1.2, as a part of provisioning the IRI-POIs in Telephony AS and IBCF for
IMS-based services.
NOTE: The P-CSCF and LMISF-IRI may also provide IRI-POI functions for
reporting of STIR/SHAKEN validation results when the target (or user
communicating with the target non-local ID) is roaming (P-CSCF with LBO and
LMIF-IRI with home-routed). However, separate provisioning of those IRI-POIs
for STIR/SHAKEN is not required.
#### 7.11.1.2 Provisioning of the IRI-POI in the IMS network functions
The LIPF provisions the IRI-POIs present in the NFs mentioned in 7.11.1.1
using the X1 protocol as described in clause 5.2.2 with the following target
identifier formats as defined in the ETSI TS 103 221-1 [7] messages (or
equivalent if ETSI TS 103 221-1 [7] is not used):
\- IMPU.
The \"div\" PASSporT information for the redirecting party (ies) when the IMS
session is redirected later on the signaling path may have to be reported to
some LEAs. To identify the need for such reporting, a parameter
\"ReportDiversionPASSporTInfo\" shall be included as part of ActivateTask
message.
Table 7.11.1.2-1 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the IRI-POI in the Telephony AS, IBCF, for separate
provisioning case, for STIR/SHAKEN and RCD/eCNAM.
Table 7.11.1.2-1: ActivateTask message for IRI-POI in the IMS Network
Functions for STIR/SHAKEN and RCD/eCNAM
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. | M | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | The target identifier | M | | | listed in the paragraph | | | | above. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to \"X2Only\". | M | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints of | M | | | LI_X2. These delivery | | | | endpoints shall be | | | | configured using the | | | | _CreateDestination_ message | | | | as described in ETSI TS 103 | | | | 221-1 [7] clause 6.3.1 | | | | prior to first use. | | +-----------------------------+-----------------------------+-------+ | TaskDetailsExtensions/ | Shall be included if the | C | | | interception of STIR/SHAKEN | | | STIRSHAKENProvisioning | is required. See table | | | | 7.11.1.2-2. | | +-----------------------------+-----------------------------+-------+
Table 7.11.1.2-2: STIRSHAKENProvisioning extension
* * *
Extensions field name Description M/C/O ReportDiversionPASSporTInfo Indicates
whether \"div\" PASSporT information of redirecting party (ies) when the IMS
session is redirected later on the signaling path is to be reported. When set
to \"true\", it shall be reported. When set to \"false\", it shall not be
reported. M
* * *
When the IRI-POIs in Telephony AS or IBCF are provisioned for IMS-based
services, then the minimal details of LI_X1 ActivateTask message shall be as
defined in clause 7.12.3.2.1 (table 7.12.3.2-2) with the addition of
\"ReportDiversionPASSporTInfo\" parameter.
#### 7.11.1.3 Provisioning of the MDF2
This clause is applicable when the MDF2 is not provisioned for IMS-based
interception.
The MDF2 listed as the delivery endpoint for xIRI generated by the IRI-POI in
the IMS Network Functions for STIR/SHAKEN and RCD/eCNAM shall be provisioned
over LI_X1 by the LIPF using the X1 protocol as described in clause 5.2.2.
Table 7.11.1.3-1 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the MDF2.
The MDF2 shall support the following target identifier formats in the ETSI TS
103 221-1 [7] messages (or equivalent if ETSI TS 103 221-1 [7] is not used):
\- IMPU.
Table 7.11.1.3-1: ActivateTask message for MDF2
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID XID assigned by LIPF. M
TargetIdentifiers The target identifier listed in the paragraph above. M
DeliveryType Set to "X2Only\". (Ignored by the MDF2). M ListOfDIDs Delivery
endpoints of LI_HI2. These delivery endpoints shall be configured using the
CreateDestination message as described in ETSI TS 103 221-1 [7] clause 6.3.1
prior to first use. M ListOfMediationDetails Sequence of Mediation Details,
see table 7.11.1.3-2. M
* * *
Table 7.11.1.3-2: Mediation Details for MDF2
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O LIID Lawful Intercept ID
associated with the task. M DeliveryType Set to \"HI2Only\". M ListOfDIDs
Details of where to send the IRI for this LIID. Shall be included if deviation
from the ListofDIDs in the ActivateTask message is necessary. If included, the
ListOfDIDs in the Mediation Details shall be used instead of any delivery
destinations authorised by the ListOfDIDs field in the ActivateTask Message. C
* * *
### 7.11.2 Generation of xIRI at IRI-POI in the IMS Network Functions over
LI_X2
#### 7.11.2.1 General
The IRI-POI present in the IMS Network Functions for STIR/SHAKEN and RCD/eCNAM
shall send xIRI over LI_X2 for each of the events listed in TS 33.127 [5]
clause 7.14.3, each of which is described in the following clauses.
NOTE: The clauses below on signing and verification shall be applied for
diverted call based on the RFC 8946 [76]. LI system has to generate xIRI
containing all the pASSporT objects of the SIP messages and signature
validation or generation results, even those of the History-Info field.
#### 7.11.2.2 Signature generation
The IRI-POI present in the Telephony AS or IBCF, shall generate an xIRI
containing a STIRSHAKENSignatureGeneration record under the following
conditions:
\- Telephony AS or IBCF is interacting with the SIGNING AS. Whether it is the
Telephony AS or IBCF for sessions is based on network configuration and local
policy of the CSP as described in clause 7.11.2.4.
\- When P-Asserted Identity or From header of SIP INVITE request received from
S-CSCF is a target identity with the conditions mentioned below:
\- The identities in one or both of those headers are used to interact with
the SIGNING AS.
\- The \"shaken\" PASSporT is not received in the SIP INVITE request from the
S-CSCF.
\- The \"shaken\" PASSporT is received from the SIGNING AS.
\- The \"shaken\" PASSporT is included in the outgoing SIP INVITE.
\- When the \"ReportDiversionPASSporTInfo\" parameter is set to \"True\" in
the ActivateTask with P-Asserted Identity or From header of SIP INVITE request
received from S-CSCF is a target identity with the conditions mentioned below:
\- The identities in one or both of those headers are used to interact with
the SIGNING AS.
\- A \"shaken\" PASSporT or a \"div\" PASSporT with those identities are
included in the \"orig\" claim of \"shaken\" or \"div\" PASSporT received from
the SIGNING AS.
\- The \"shaken\" PASSporT or a \"div\" PASSporT with those identities are
included in the \"orig\" claim of \"shaken\" or \"div\" PASSporT in the
outgoing SIP INVITE.
\- When Diversion header or the History Info of SIP INVITE request received
from the S-CSCF includes a target identity with the conditions mentioned
below:
\- The identities in one or both of those headers are used to interact with
the SIGNING AS.
\- The \"div\" PASSporT with those identities in the \"div\" claim is not
received in the SIP INVITE request from the S-CSCF.
\- The \"div\" PASSporT with those identities in the \"div\" claim is received
from the SIGNING AS.
\- The \"div\" PASSporT with those identities in the \"div\" claim is included
in the outgoing SIP INVITE.
\- When the \"ReportDiversionPASSporTInfo\" parameter is set to \"True\" in
the ActivateTask with Diversion or HistoryInfo header of SIP INVITE request
received from S-CSCF includes the target identity with the conditions
mentioned below:
\- The identities in P-Asserted Identity or From of SIP INVITE received from
the S-CSCF are used to interact with the SIGNING AS.
\- A \"div\" PASSporT with the identities in P-Asserted Identity or From of
SIP INVITE request received from S-CSCF are included in the \"orig\" claim of
\"div\" PASSporT received from the SIGNING AS.
\- The \"div\" PASSporT with the identities in P-Asserted Identity or From of
SIP INVITE request received from S-CSCF are included in the \"orig\" claim of
\"div\" PASSporT in the outgoing SIP INVITE.
\- When Request URI of outgoing SIP INVITE is a target non-local ID and is
present in the \"dest\" claim of \"shaken\" or \"div\" PASSporT received from
the SIGNING AS and the same is included in the outgoing SIP INVITE.
\- When Telephony AS is interacting with the SIGNING AS, and when Request URI
of SIP INVITE received from the S-CSCF is a target identity with the
conditions mentioned below:
\- The identity is used to interact with the SIGNING AS.
\- The \"div\" PASSporT with that identity in the \"div\" claim is received
from the SIGNING AS.
\- The \"div\" PASSporT with that identity in the \"div\" claim is included in
the outgoing SIP INVITE.
When the target is not a non-local ID, the STIRSHAKENSignatureGeneration
includes only the PASSporT received in the SIGING AS response with the
following rules:
\- When the \"ReportDiversionPASSporTInfo\" parameter is set to \"True\" in
the ActivateTask, all of the PASSporT received from the SIGNING AS.
\- When the \"ReportDiversionPASSporTInfo\" parameter is set to \"False\" in
the ActivateTask:
\- If P-Asserted Identity or From header in the SIP INVITE received from the
S-CSCF is a target identity, then only \"shaken\" PASSporT received from the
SIGNING AS with those identities in the \"orig\" claim of the \"shaken\"
PASSporT.
\- If Diversion or HistoryInfo header in the SIP INVITE received from the
S-CSCF is a target identity, then only the \"div\" PASSporT received from the
SIGNING AS with those identities in the \"div\" claim of \"div\" PASSporT.
\- If REQUEST URI or To header in the SIP INVITE received from the S-CSCF is a
target identity, then only the \"div\" PASSporT received from the SIGNING AS
with those identities in the \"div\" claim of \"div\" PASSporT.
When the target is non-local ID, STIRSHAKENSignatureGeneration includes all of
the PASSporT included in the outgoing SIP message.
The following table contains parameters, with IRITargetIdentifier, generated
by the IRI-POI.
Table 7.11.2.2-1: Payload for STIRSHAKENSignatureGeneration record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | pASSporTs | Identifies the content of | M | | | the SIP Identity headers | | | | added by the originating | | | | network and transit | | | | networks. This is a set of | | | | PASSporT parameter. See | | | | table 7.11.2.2-2. | | +-----------------------------+-----------------------------+-------+ | encapsulatedSIPMessage | Encapsulated SIP INVITE | M | | | request that includes SIP | | | | Identity header carrying | | | | the PASSporT (Outgoing SIP | | | | request) based on the | | | | structure defined in table | | | | 7.12.4.2-2 (see NOTE | | | | below). | | +-----------------------------+-----------------------------+-------+ | NOTE 1: For the backward | | | | compatibility purposes the | | | | parameter is coded as | | | | OPTIONAL in the ASN.1 | | | | schema (Annex A.). | | | | | | | | NOTE 2: The same SIP | | | | message may be encapsulated | | | | in the xIRI IMSMessage as | | | | well. | | | +-----------------------------+-----------------------------+-------+
Table 7.11.22-2: Details for PASSporT parameter
* * *
Field name Description M/C/O pASSporTHeader PASSporT Header as defined in RFC
8224 [70] clause 4 for \"shaken" PASSporT, in RFC 8946 [76] clause 3 for
\"div" PASSportT and in TS 24.229 [74]. See table 7.11.2.2-3. M
pASSporTPayload PASSporT Payload as defined in RFC 8224 [70] clause 4 for
\"shaken" PASSporT, in RFC 8946 [76] clause 3 for \"div" PASSporTand in TS
24.229 [74]. See table 7.11.2.2-4. M pASSporTSignature PASSporT Signature as
defined in RFC 8224 [70] clause 4 for \"shaken" PASSporT, in RFC 8946 [76]
clause 3 for \"div" PASSporTand in TS 24.229 [74]. M
* * *
Table 7.11.2.2-3: Details for pASSporTHeader parameter
* * *
Field name Description M/C/O type Shall be populated with the type contained
in the PASSporT Header as defined in RFC 8225 [69] clause 4.1 for \"shaken"
PASSporT and in RFC 8946 [76] clause 3 for \"div" PASSporT. M algorithm Shall
be derived from the value of the \'alg\' parameter of the PASSporT Header as
defined in RFC 8225 [69] clause 4.2 for \"shaken" PASSporT and in RFC 8946
[76] clause 3 for "div" PASSporT. M ppt Shall be derived from the value of the
\'ppt\' parameter of the PASSporT Header as defined in RFC 8225 [69] clause
8.1 for "shaken" PASSporT if the PASSporT Header contains a ppt parameter and
in RFC 8946 [76] clause 3 for "div" PASSporT. C x5u Shall be populated with
the URI contained in the \'x5u\' parameter of the PASSporT Header as defined
in RFC 8225 [69] clause 4.3 for "shaken" PASSporT and in RFC 8946 [76] clause
3 for \"div" PASSporT. M
* * *
Table 7.11.2.2-4: Details for pASSporTPayload parameter
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | issuedAtTime | Shall be populated with the | M | | | GenrealizedTime format | | | | timestamp converted from | | | | the NumericDate contained | | | | in the \'iat\' parameter of | | | | the PASSporT Payload as | | | | defined in RFC 8225 [69] | | | | clause 5.1.1 and in RFC | | | | 8946 [76] clause 3. | | +-----------------------------+-----------------------------+-------+ | originator | Shall be populated with the | M | | | value of the \"orig\" claim | | | | of the PASSporT Payload as | | | | defined in RFC 8225 [69] | | | | clause 5.2.1 and in RFC | | | | 8946 [76] clause 3. | | +-----------------------------+-----------------------------+-------+ | destination | Shall contain the list of | M | | | destinations contained in | | | | the \"dest\" claim of the | | | | PASSporT Payload as defined | | | | in RFC 8225 [69] clause | | | | 5.2.1 and in RFC 8946 | | | | [76] clause 3. | | +-----------------------------+-----------------------------+-------+ | diversion | Shall be populated with the | C | | | \"div\" claim of the | | | | \"div\" PASSporT payload. | | | | For first diversion this | | | | contains the original | | | | identifier of the | | | | destination as defined in | | | | RFC 8946 [76] clause 3 | | | | for "div\" PASSporT. | | +-----------------------------+-----------------------------+-------+ | attestation | Indicates the attestation | M | | | level as defined in RFC | | | | 8588 [71] clause 4 for | | | | the \"shaken" PASSporT. The | | | | different values of | | | | attestation level are A = | | | | Full Attestation, B= | | | | Partial Attestation, C = | | | | Gateway Attestation (see | | | | NOTE 3 below). | | +-----------------------------+-----------------------------+-------+ | origID | Shall be populated with the | M | | | value of the origID | | | | contained in the \'origid\' | | | | parameter of the PASSporT | | | | Payload as defined in RFC | | | | 8588 [71] clause 5 for | | | | the "shaken" PASSporT (see | | | | NOTE 4 below). | | +-----------------------------+-----------------------------+-------+ | > NOTE 3: For the backward | | | | > compatibility purposes | | | | > the parameter is coded as | | | | > MANDATORY in the ASN.1 | | | | > schema (Annex A). | | | | > \'attestation\' is | | | | > mandatory for \"shaken\" | | | | > PASSporT and absent for | | | | > \"div\" PASSporT. | | | | > Therefore, for div | | | | > PASSporT, since | | | | > \"attestation\" is not | | | | > available, the | | | | > placeholder value \"Not | | | | > available\" shall be | | | | > used. | | | | > | | | | > NOTE 4: For the backward | | | | > compatibility purposes | | | | > the parameter is coded as | | | | > MANDATORY in the ASN.1 | | | | > schema (Annex A). This | | | | > parameter is mandatory | | | | > for \"shaken\" PASSporT | | | | > and absent for the | | | | > \"div\" PASSporT. | | | | > Therefore, for div | | | | > PASSporT, since | | | | > \"origId\" is not | | | | > available, the | | | | > placeholder value \"Not | | | | > available\" shall be | | | | > used. | | | +-----------------------------+-----------------------------+-------+
#### 7.11.2.3 Signature validation
The IRI-POI present in the Telephony AS or IBCF, shall generate an xIRI
containing a STIRSHAKENSignatureValidation record when the following
conditions are met:
\- Either IBCF or Telephony AS, is interacting with the VERIFICATION AS.
Whether it is the Telephony AS or IBCF for sessions is based on network
configuration and local policy of the CSP as described in clause 7.11.2.5.
\- With one or more of the following are true:
\- Request URI and To Headers of SIP INVITE request received from S-CSCF (in
the case of Telephony AS) or from the previous IP network (in the case of
IBCF) is a target identity.
\- One or more of P-Asserted Identity, From, Diversion, History-Info Headers
of SIP INVITE request received from S-CSCF (in the case of Telephony AS) or
from the previous IP network (in the case of IBCF) is a target non-local
identity without any prior intra-network diversions.
\- If PASSporTs are received in the SIP INVITE request, they are submitted by
the IBCF to the VERIFICATION AS for validation and the result is included in
an outgoing SIP INVITE request together with possible RCD data or eCNAM data
as Call-Info headers.
\- If PASSporTs are received in the SIP INVITE request, they are submitted by
the Telephony AS to the VERIFICATION AS for validation and the validation
result is received from the Verification AS and the outgoing SIP INVITE
possibly includes RCD data or eCNAM data as Call-Info headers.
NOTE: The IRI-POI may use the Via headers, Record-route headers to determine
any prior intra-network diversions.
The IRI-POI present in the Telephony AS shall also generate an xIRI containing
a STIRSHAKENSignatureValidation record when it detects the following
conditions:
\- Session is redirected.
\- Request URI header of outgoing SIP INVITE is a target identity.
\- Validation result is included in the outgoing SIP INVITE with the possible
the RCD data and the eCNAM data as Call-Info headers.
The IRI-POI present in the LMISF-IRI or P-CSCF shall generate an xIRI
containing a STIRSHAKENSignatureValidation record when the following
conditions are met:
\- With one or more of the following are true:
\- Request URI or To header of SIP INVITE request sent to the UE is a target
identity.
\- One or more of P-Asserted Identity, From, Diversion, History-Info Headers
of SIP INVITE request sent to the UE is a target non-local identity.
\- SIP INVITE request sent to the UE includes SIP Call-Info headers containing
possible RCD data or eCNAM data, and the result of the PASSporT verification.
In the above paragraphs, a validation result (i.e. result of all PASSporT
verification) is included means a \"verstat\" parameter within the P-Asserted
Identity header is included in the outgoing SIP INVITE.
The following table contains parameters, with IRITargetIdentifier, generated
by the IRI-POI.
Table 7.11.2.3-1: Payload for STIRSHAKENSignatureValidation record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +-----------------------------+-----------------------------+-------+ | pASSporTs | Identifies the content of | C | | | the SIP Identity headers | | | | added by the originating | | | | network and transit | | | | networks. See TS 24.229 | | | | [74] and RFC 8224 [70]. | | | | | | | | This is a set of PASSporT | | | | parameter. See table | | | | 7.11.2.2-2. | | +-----------------------------+-----------------------------+-------+ | rCDTerminalDisplayInfo | RCD display information | C | | | when applicable. See IETF | | | | draf | | | | t-ietf-stir-passport-rcd-12 | | | | [73]. | | +-----------------------------+-----------------------------+-------+ | eCNAMTerminalDisplayInfo | eCNAM display information | C | | | when applicable. See TS | | | | 24.196 [72]. | | +-----------------------------+-----------------------------+-------+ | sHAKENValidationResult | SHAKEN validation result: | M | | | TN-Validation-Passed, | | | | TN-Validation-Failed, | | | | No-TN-Validation. See TS | | | | 24.229 [74] and IETF RFC | | | | 8588 [71]. | | +-----------------------------+-----------------------------+-------+ | sHAKENFailureStatusCode | SHAKEN status code when | C | | | validation fails in the | | | | terminating network. See | | | | IETF RFC 8224 [70]. | | +-----------------------------+-----------------------------+-------+ | encapsulatedSIPMessage | Encapsulated SIP INVITE | C | | | request that carries | | | | P-Asserted Identifier or | | | | From header that includes | | | | the SHAKEN validation | | | | result (Outgoing SIP | | | | request) based on the | | | | structure defined in table | | | | 7.12.4.2-2. (see NOTE | | | | below). | | +-----------------------------+-----------------------------+-------+ | NOTE: The same SIP message | | | | may be encapsulated in the | | | | xIRI IMSMessage as well. | | | +-----------------------------+-----------------------------+-------+
When the termination network performs SHAKEN verification, one of the
following values shall be assigned to the SHAKEN validation result parameter
as part of the display information: \"TN-Validation-Passed\", \"TN-Validation-
Failed\", or \"No-TN-Validation\". In case of TN-Validation-Failed, the SHAKEN
failure status code shall be present and coded as an integer. The SHAKEN
failure status codes are at least, according to RFC 8224 and to IANA Session
Initiation Protocol (SIP) Parameters [75]:
\- 403 **\"** Stale Date**\"** response code is sent when the verification
service receives a request with a Date header field value that is older than
the local policy of the CSP for freshness permits. The same response may be
used when the \"iat\" has a value older than the local policy of the CSP for
freshness permits.
\- **428 \"Use Identity Header\" response code is sent when the verification
service receives a SIP request that lacks an Identity header. This is to
indicate that the request should be re-sent with an Identity header.**
\- **436 \"Bad Identity-Info\" response code is used to indicate an inability
to acquire the credentials needed by the verification service for validating
the signature in an Identity header field.**
\- **437 \"Unsupported Credential\" response code is used when the
verification service cannot validate the certificate referenced by the URI of
the Identity-Info header, for reasons such as failing to trust the issuing
certification authority (CA) or failing to support the algorithm with which
the credential was signed.**
\- **438 \"Invalid Identity Header\" response code is used to indicate that of
the set of Identity header fields in a request, no header field with a valid
and supported Identity token has been received.**
#### 7.11.2.4 IMS Network Function that interacts with signing AS
The Telephony AS interacts with the SIGNING AS when any of the following is
true:
\- RCD is supported.
\- Intra-CSP session signing is required.
\- CSP choice for signing is AS.
The IBCF interacts with the SIGNING AS when all of the following are true:
\- RCD is not supported.
\- Intra-CSP session signing is not required.
\- CSP choice for signing is IBCF.
The IBCF also interacts with the SIGNING AS for an IMS emergency session.
The presence of RCD is on a per call basis.
#### 7.11.2.5 IMS Network Function that interacts with the verification AS
The Telephony AS interacts with the VERIFICATION AS when any of the following
is true:
\- Intra-CSP session verification is required.
\- CSP choice for verification is AS.
\- CSP choice for emergency session callback verification is AS.
The IBCF interacts with the VERIFICATION AS when all of the following are
true:
\- Intra-CSP session verification is not required.
\- CSP choice for verification is ICBF.
The IBCF also interacts with the VERIFICATION AS for an IMS emergency session
callback when the CSP choice for verification for emergency callback session
is IBCF.
### 7.11.3 Generation of IRI over LI_HI2
When an xIRI is received over LI_X2 from an IRI-POI, the MDF2 shall generate
the corresponding IRI message and deliver over LI_HI2 without undue delay. The
IRI message shall contain a copy of the relevant record
(STIRSHAKENSignatureGeneration or STIRSHAKENSignatureValidation) received in
the xIRI over LI_X2.
The MDF2 shall able to remove information regarded as content from RCD or
eCNAM parameters in the case of an IRI-only warrant. The details of what needs
to be removed and under what circumstances are outside the scope of the
present document.
The timeStamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time present in the timestamp field of the xIRI.
The threeGPP33128DefinedIRI field (see ETSI TS 102 232-7 [10] clause 15) shall
be populated with the BER-encoded IRIPayload.
The STIRSHAKENSignatureGeneration and STIRSHAKENSignatureValidation IRI
messages shall have the same CIN as in the other IRI messages delivered for
the IMS session (see ETSI TS 102 232-1 [9] clause 5.2.4).
The IRI type parameter (see ETSI TS 102 232-1 [9] clause 5.2.10) shall be
included and coded according to table 7.11.3-1.
Table 7.11.3-1: IRI type for IRI messages
Record type **IRI Type**
* * *
STIRSHAKENSignatureGeneration REPORT STIRSHAKENSignatureValidation REPORT
## 7.12 LI for IMS based services
### 7.12.1 General
The present document provides two options for stage 3 definitions for
implementing IMS LI:
\- Use LI_X1, LI_X2 and LI_X3 interfaces specified below in the present
document.
\- Use TS 33.107 [36] and TS 33.108 [12] natively as defined in that document.
In both cases, the present document specifies the stage 3 for the LI_HI1,
LI_HI2 and LI_HI3 interfaces.
### 7.12.2 Overview
#### 7.12.2.1 General
This clause defines protocol and procedures to support the LI for IMS-based
services. The scope of LI functions defined here are based on the IMS LI
architecture defined in TS 33.127 [5] that includes:
\- Target type -- local ID, non-local ID.
\- Roaming considerations -- local break-out (LBO), home-routed (HR).
\- Service specific aspects - normal sessions, redirected sessions,
conferencing, STIR/SHAKEN, RCD/eCNAM.
\- Location reporting.
The IMS LI shall apply to all IMS-based services unless restricted by the
service scoping as defined in clause 4.4 of the present document. When
restricted by the service scoping, the IMS LI applies only to service types
listed in table C.2 of ETSI TS 103 221-1 [7]). Clause 7.12.2.5 provides
further details of IMS LI with service scoping.
As defined in TS 33.127 [5], the NFs that provide the IRI-POI and CC-TF are in
the IMS signaling functions that handle the SIP messages and the NFs that
provide the CC-POI are in the IMS media functions. The media interception in
the packet core network (EPC or 5GC) is outside the scope of the present
document.
For some of the services listed above, an alternate deployment option in
addition to the default option is also specified in TS 33.127 [5]. The NFs
that provide the IRI-POI, CC-TF and CC-POI in the alternate deployment option
can be different.
The LIPF provisioning scenarios for IMS LI is illustrated in Annex G LIPF
Logic of the present document.
#### 7.12.2.2 Target type and target identifiers
An IMS user served by the CSP can be the target or can be in communication
with a target non-local ID. In the former case, the target can also be an
outbound roaming IMS user or an inbound roaming IMS user (see clause
7.12.2.3).
NOTE: A target non-local ID is identified distinctly through the provisioning.
The following target identifier formats (ETSI TS 103 221-1 [7]) can be used to
identify a target for IMS based services:
\- IMPU.
\- IMPI.
\- PEIIMEI.
\- IMEI.
When service scoping is applicable, additional target identities may be used
in LI for IMS based specific services (e.g. MCPTT ID for PTC). The details of
such additional target identities are provided in the service specific clauses
of the present document.
The target identity in the IMPI format may contain a value derived from a SUPI
or an IMSI. The target identity in the IMPU format containing a SIP URI or TEL
URI may contain a value derived from a SIP URI, TEL URI, GPSI, MSISDN, an
E.164 number or IMSI. Only IMPU is used for target non-local ID.
#### 7.12.2.3 Roaming considerations
An IMS user who is the target, or in communication with the target non-local
ID, can be part of the following roaming scenarios for the LI purpose:
\- Non-roaming.
\- Outbound roaming with HR.
\- Outbound roaming with LBO.
\- Inbound roaming with HR.
\- Inbound roaming with LBO.
The details of LI functions for the case of inbound roaming with HR are
described in clause 7.10.
#### 7.12.2.4 Service specific aspects
##### 7.12.2.4.1 General
The NFs that provide the IRI-POI, CC-TF and CC-POI functions can be different
depending on the IMS session scenarios the target, or the IMS user in
communication with a target non-local ID, is involved in.
An IMS user shall be considered to be in communications with a target non-
local ID even if the session is redirected from that target non-local ID.
##### 7.12.2.4.2 LI for normal sessions
This includes LI for session originations and session terminations.
LI for session originations applies when an IMS session is originated by an
IMS user whose communications are intercepted either because that originating
IMS user happens to be a target or because that originating IMS user happens
to be in communications with a target non-local ID. The originating IMS user
can also be inbound roaming (LBO or HR) or outbound roaming (LBO or HR).
LI for session terminations applies when an IMS session is terminated to an
IMS user whose communications are intercepted either because that terminating
IMS user happens to be a target or because that terminating IMS user happens
to be in communications with a target non-local ID. The terminating IMS user
can also be inbound roaming (LBO or HR) or outbound roaming (LBO or HR).
The other party can be within the same CSP domain (intra-CSP sessions) or in
another CSP domain (inter-CSP sessions). In the latter case, the other CSP can
be CS-based or IP-based. For target non-local ID, the session is always an
inter-CSP session.
##### 7.12.2.4.3 LI for redirected sessions
This includes LI for the incoming IMS sessions that are redirected.
LI for redirected sessions applies when a terminating session to a target is
redirected to (or forwarded to) another user. Either the target (i.e.
redirecting party) or the redirected-to party can be outbound roaming (LBO or
HR).
The redirected-to party can be in the same CSP domain as that of initial
terminating party (i.e. redirecting party) or can be a another CSP domain. In
the latter case, the other CSP can be CS-based or IP-based. The LI for
redirected sessions in the VPLMN are handed as LI for session terminations.
##### 7.12.2.4.4 LI for conferencing
This includes the LI for conferencing services.
LI for conferencing services applies when a target initiates a multi-party
conferencing session or when a target joins a \"meet-me\" conferenceing
session or when a \"meet me\" conferencing session is established with
conferencing URI itself being the target.
When a target happens to be one of the participant of a conference initiated
by another IMS user, the LI for normal sessions (see clause 7.12.2.4.2)
applies.
##### 7.12.2.4.5 STIR/SHAKEN
This includes the LI for STIR/SHAKEN when signature is signed or verified in
an IMS session involving a target as described in TS 33.127 [5].
The further details of LI for STIR/SHAKEN are described in clause 7.11.
##### 7.12.2.4.6 RCD/eCNAM
This includes the LI for RCD/eCNAM when enhanced calling name is included in a
terminating IMS session involving a target as described in TS 33.127 [5].
The further details of LI for RCD/eCNAM are described in clause 7.11.
#### 7.12.2.5 Service scoping
##### 7.12.2.5.1 General
LI for IMS-based services shall support service scoping with the following
specific service types:
\- Voice.
\- PTC.
\- Messaging.
\- RCS.
\- LALS.
When an NF is involved in the handling of one or more of the above mentioned
IMS-based services (e.g. voice, messaging at the S-CSCF), the LI functions
within that NF shall limit the interception to the service type to which the
warrant applies. However, type of service used by a UE may not be known when
an IMS session begins, or if known, may change while, or after, the session is
established. Therefore, the present document limits the applicability of
service-based interception to the media only.
The present document supports service-based interception to signaling as well
media when the NF is involved in the handling of a specific service mentioned
above (e.g. PTC server for PTC).
When service scoping is not applicable, the delivery of IRI and CC for IMS-
based services are done independent of service types. Location reporting
aspects that are also part of the service scoping are described in clause
7.12.2.6.
##### 7.12.2.5.2 LI for voice
This includes the LI for IMS-based voice services.
LI for IMS-based voice services applies to the interception of IMS-based voice
media for the IMS sessions involving the targets if and only if the m-line in
the SDP answer includes either one of the following:
\- Audio.
\- Text.
For the generation and delivery of IRI for the IMS sessions, the LI for IMS-
based voice is handled independent of the m-line in the SDP.
If the m-line includes \"audio\" and \"video\" then only audio part of the
media is intercepted.
It is possible that SDP offer and SDO answer may have different information in
m-line. The determination on whether to intercept the voice media is based on
the final outcome of SDP offer and answer, which happens to be in the SDP
answer.
The media associated with an IMS session may also change in the middle of a
session using the re-INVITE procedures invoked by either of the parties
involved in the session. Accordingly, the interception of voice media may
resume or cease in the middle of an IMS session based media type negotiated at
the conclusion the related SDP offer and answer.
NOTE: The present document excludes the m-line values of video, msrp, image,
application and other, for Service Type of \"voice\" while determining the
media interception (i.e. CC delivery).
##### 7.12.2.5.3 LI for Messaging
This includes LI for SMS over IP and MSRP originated from, or terminated to, a
target.
LI for SMS over IP originated from a target applies to the interception of a
SIP MESSAGE originated from an IMS user who happens to be a target or happens
to be receiving a SIP MESSAGE that has originated from a target non-local ID.
That IMS user can also be inbound roaming (LBO or HR) or outbound roaming (LBO
or HR).
LI for SMS over IP terminated to a target applies to the interception of a SIP
MESSAGE terminated to an IMS user who happens to be a target or happens to be
sending the SIP MESSAGE to a target non-local ID. That IMS user can also be
inbound roaming (LBO or HR) or outbound roaming (LBO or HR).
LI for MSRP applies to the interception of media for the IMS sessions
involving the targets if and only if MSRP is included in the m-line of the SDP
answer. For the generation and delivery of IRI for the IMS sessions, the LI
for messaging is handled independent of the m-line in the SDP.
When service scoping applies, the LI for Messaging (i.e. SMS over IP or MSRP)
is provided if and only if the \"messaging\" service type is included as a
part of LI provisioning. If no service type is provisioned, service scoping
does not apply and the LI for messaging shall be provided (per clause 4.4.2).
##### 7.12.2.5.4 LI for voice-mail
This includes LI for IMS-based voice services (see clause 7.12.2.5.3) when an
incoming voice session to an IMS user who happens to be a target or an
incoming voice session to an IMS user from a target non-local ID is redirected
to a voice mail server.
When the incoming session happens to be from a target non-local ID to an IMS
user, the retrieval of the voice message from the voice mail server is not
intercepted. However, when the IMS user who happens to be the target, the
retrieval of the voice message from the voice-mail server may be intercepted
in the network that handles the IMS session initiated from the target used to
retrieve the voice message.
When service scoping applies, LI for voice-mail is provided if and only if
\"voice\" service type is included as a part of LI provisioning. If no service
type is provisioned, service scoping does not apply and the LI for voice-mail
shall be provided (per clause 4.4.2).
##### 7.12.2.5.5 LI for RCS
This includes the LI for RCS services when a target executes one of the RCS
related services described in TS 33.127 [5].
The further details of LI for RCS are described in clause 7.13.
##### 7.12.2.5.6 LI for PTC service
This includes LI for PTC when a target is engaged in a PTC service as
described in TS 33.127 [5].
The further details of LI for PTC are described in clause 7.5.
##### 7.12.2.5.7 LALS triggering
This includes the reporting of location by the LI-LCS Client triggered by the
LTF as described in TS 33.127 [5].
The further details of LALS triggering are defined in clause 7.3.
#### 7.12.2.6 Location reporting
When the location reporting is only required at the beginning and end of an
IMS session, the location is reported when an IMS session is originated (SIP
INVITE) from a target or terminating session is answered (SIP 200 OK for
INVITE) from the target or either of the two sessions are released (SIP BYE
from the target or SIP 200 OK for BYE from the target).
#### 7.12.2.7 Deployment considerations
As described in TS 33.127 [5], some of the service types may have two
deployment options denoted as \"default option\" and \"alternate option\".
As illustrated in Annex G, the LIPF provisions the LI functions in a NF based
on the option the CSP has deployed within the network.
#### 7.12.2.8 Identifying the intercepted IMS-based communications
##### 7.12.2.8.1 General concepts
An IMS based communication is intercepted when one of the following is true:
\- The calling party identity on session originations or SMS originations is a
target.
\- The called party identity on session originations is a target non-local ID.
\- The destination party identity in SMS originations is a target non-local
ID.
\- The called party identity on session terminations or SMS terminations is a
target.
\- The calling party identity on session terminations is a target non-local
ID.
\- The origination party identity in SMS terminations is target non-local ID.
\- The redirecting party identity on session terminations is a target non-
local ID.
\- In the alternate deployment option for redirected sessions (see TS 33.127
[5]), redirecting party is a target.
\- The redirected-to party identity is a target non-local ID.
\- The conference URI in a conferencing session is a target.
The above identities are used to identify that an IMS session is intercepted
in the IRI-POI and in the CC-TF, the latter when the LI requires CC
interception. In addition, the CC-TF uses the redirecting party identity to
trigger the CC-POI even if the target is not a non-local ID.
##### 7.12.2.8.2 Target match
###### 7.12.2.8.2.1 General
When an IMS UE performs an IMS registration (using SIP REGISTER) request, the
IRI-POI/CC-TF examines the following for a target match:
\- From header and To header of the SIP REGISTER when the target identity is
IMPU.
\- +sip.instance-id of Contact header of the SIP REGISTER when the target
identity is PEIIMEI or IMEI.
\- Digest username of Authorization header of the SIP REGISTER when the target
identity is IMPI.
NOTE: The SIP REGISTER that carries the Authorization header is sent in
response when the initial Registration is challenged.
A target match for SIP REGISTER can only be done when the NF where the IRI-POI
resides is in the path of the SIP REGISTER flow (e.g. P-CSCF, S-CSCF).
###### 7.12.2.8.2.2 Session based IMS services
This clause describes the method used to identify a session-based IMS service
such as IMS-based voice service.
When an IMS session is originated from an IMS UE (using SIP INVITE), the IRI-
POI/CC-TF examines the following to verify for a target match:
\- P-Asserted Identity header and From header present in the SIP INVITE when
the target identity is IMPU.
\- Request URI header and To header present in the SIP INVITE when the target
identity is IMPU and target is non-local ID.
\- Digest username of Authorization header of the SIP REGISTER when the target
identity is IMPI.
\- +sip.instance-id of Contact header received in the SIP REGISTER request
when the target identity is PEIIMEI or IMEI.
The use of Request URI header and To header present in the SIP INVITE for
matching target non-local ID is done on the redirected sessions irrespective
of whether the session is originated from an IMS UE.
When an IMS session is terminated at an IMS UE (using SIP INVITE), the IRI-
POI/CC-TF examines the following to verify for a target match:
\- Request URI and To header present in the SIP INVITE when the target
identity is IMPU.
\- P-Asserted-Identity, From header, History Info header and Diversion header
present in the SIP INVITE when the target identity is IMPU and target is non-
local ID.
\- Digest username of Authorization header of the SIP REGISTER when the target
identity is IMPI.
\- +sip.instance-id of Contact header received in the SIP REGISTER request
when the target identity is PEIIMEI or IMEI.
NOTE: IRI-POI/CC-TF that uses the information received in the SIP REGISTER to
perform a target match cannot do such a target match unless the NF is on the
signaling path of SIP REGISTER flow.
In addition, the IRI-POI in the alternate deployment option (TS 33.127 [5])
and CC-TF, examine the following to verify a target match when an IMS session
is terminated to an IMS UE:
\- History Info header and Diversion header present in the SIP INVITE when the
target identity is IMPU and the target is not a non-local ID.
For conference sessions, the IRI-POI and CC-TF examine the following to verify
a target match:
\- P-Asserted-Identity, From header present in the SIP INVITE when a target
initiates a conference session or when the target joins a \"meet-me\"
conference session.
\- Conference URI present in the SIP INVITE when the conference URI is the
target.
IRI-POI/CC-TF may use the Via header or the Route header to determine whether
the SIP INVITE is for an originating IMS session or a terminating IMS session.
IRI-POI/CC-TF stores (locally) the SIP Call Id to associate the subsequent SIP
messages received on the same session for a target match.
###### 7.12.2.8.2.3 Session independent IMS services
This clause describes the method used to identify a session-independent IMS
service (i.e. SMS over IP).
For SMS over IP, the SIP MESSAGE includes \"vnd.3gpp.sms\" as the MIME Content
Type in the payload with RP-DATA or RP-ACK as the content, see 3GPP TS 24.341
[95].
For MSISDN-less SMS over IP (i.e. SIP URI instead of MSISDN), SIP MESSAGE
additionally includes \"vnd.3gpp.sms+xml\" as the MIME Content Type in the
payload with destination or origination addresses, see 3GPP TS 24.341 [95].
The target match for the SIP MESSAGE is done as shown below:
\- For MO-SMS over IP, the P-Asserted Identity header and From header present
in the SIP MESSAGE when the target identity is IMPU.
\- For MO-SMS over IP, the TP-DA field of SMS-SUBMIT within the Message-body
of SIP MESSAGE when the target identity is IMPU for target non-local ID.
\- For MO-SMS over IP, the \ field within the XML body of the content type
\"vnd.3gpp.sms+xml\" present in the Message-body of SIP MESSAGE when the
target identity is IMPU for target non-local ID. In this case, the TP_DA field
of SMS-SUBMIT is be set to dummy MSISDN, see 3GPP TS 24.341 [95].
\- For MT-SMS over IP, the Request URI and To header present in the SIP
MESSAGE when the target identity is IMPU.
\- For MT-SMS over IP, the TP-OA field or TP-RA field of SMS-DELIVER or SMS-
STATUS-REPORT within the Message-body SIP MESSAGE when the target identity
IMPU for target non-local ID.
\- For MSISDN-less MT-SMS over IP, the \ field within the XML body of
the content type \"vnd.3gpp.sms+xml\" present in the Message-body of SIP
MESSAGE when the target identity is IMPU for target non-local ID. In this
case, the TP_OA of SMS-DELIVER or TP-RA field of SMS-STATUS-REPORT may be set
to dummy MSISDN, see 3GPP TS 24.341 [95].- Digest username of Authorization
header of the SIP REGISTER when the target identity is IMPI.
\- Digest username of Authorization header of the SIP REGISTER when the target
identity is IMPI.
\- +sip.instance-id of Contact header received in the SIP REGISTER request
when the target identity is PEIIMEI or IMEI.
NOTE: IRI-POI/CC-TF that uses the information received in the SIP REGISTER to
perform a target match cannot do such a target match unless the NF is on the
signaling path of SIP REGISTER flow.
IRI-POI may use the Via header or the Route header to determine whether the
SIP MESSAGE is for MO-SMS over IP or MT-SMS over IP.
#### 7.12.2.9 Handling of correlation information
The IRI records delivered to the LEMF over the LI_HI2 and the CC delivered to
the LEMF over LI_HI3 shall be correlated.
According to the protocol defined in ETSI TS 103 221-1 [7] and ETSI TS 103
221-2 [8], the xIRI messages and the xCC carry the CorrelationID which enables
the MDF2 and MDF3 to provide the needed correlation between the IRI and CC.
When the CC-POI is triggered by a CC-TF, the CC-TF sends the CorrelationID to
the CC-POI over the LI_T3 interface in the ActivateTask message. The CC-POI
uses that CorrelationID in the xCC sent to the MDF3.
NOTE: The IRI-POI and CC-POI may be provided within the same NF (e.g. PTC
Server, RCS Server). When the CC-POI is triggered from a CC-TF, the IRI-POI
and CC-TF may be provided within the same NF (e.g. P-CSCF, AS/MRFC) or in
different NFs (e.g. IRI-POI in S-CSCF and CC-TF in P-CSCF).
When the IRI-POI and CC-POI (or CC-TF in a triggerred CC-POI case) are in the
same NF, the procedures can be similar to the way the correlation of xIRI and
xCC are done in the packet core system (e.g. IRI-POI and CC-TF in the SMF).
The details of any needed interactions between those LI functions are not
defined in the present document.
When the IRI-POI and CC-TF are in separate NFs, any additional procedures that
may be needed are also implementation specific and the details of the same are
not described in the present document.
### 7.12.3 Provisioning over LI_X1
#### 7.12.3.1 General
The LIPF shall provision the IRI-POIs, CC-TFs, MDF2 and MDF3 over LI_X1 for
IMS-based services using the X1 protocol as described in clause 5.2.2.
The clause 7.12.2.2 provides a list of target identifiers that shall be
supported for IMS based services in a general sense.
The target identifiers used during the provisioning over LI_X1 for a specific
IMS-based service (e.g. PTC) are listed in the respective service specific
clauses.
#### 7.12.3.2 Provisioning of IRI-POI
##### 7.12.3.2.1 Session-based IMS services
The table 7.12.3.2-1 below shows the applicability of NFs in which the IRI-
POIs are provisioned with the target identifiers listed in clause 7.12.2.2 for
session based IMS sessions (e.g. voice). See TS 33.127 [5] and Annex G.
When the service scoping is applicable, the IRI-POIs in the NFs shown in table
7.12.3.2-1 are provisioned only when the type of service is voice/text or
messaging (i.e. MSRP-based).
Table 7.12.3.2-1: IRI-POIs in the NFs that need to be provisioned for session-
based IMS service
+----------+----------+----------+----------+----------+----------+ | NF | Not a | Target | R | | | | | target | n | eference | | | | (IMS | n | on-local | | | | | s | on-local | ID | | | | | ignaling | ID | | | | | | f | | | | | | | unction) | | | | | | +==========+==========+==========+==========+==========+==========+ | | Default | A | Default | A | | | | | lternate | | lternate | | | | | option | | option | | +----------+----------+----------+----------+----------+----------+ | P-CSCF | YES | YES | YES | NO | In this | | | | | | | clause | +----------+----------+----------+----------+----------+----------+ | S-CSCF | YES | NO | NO | YES | In this | | | | | | | clause | +----------+----------+----------+----------+----------+----------+ | E-CSCF | YES | NO | NO | NO | In this | | | | | | | clause | +----------+----------+----------+----------+----------+----------+ | IBCF | NO | YES | YES | YES | In this | | | | | | | clause | +----------+----------+----------+----------+----------+----------+ | MGCF | NO | YES | YES | NO | In this | | | | | | | clause | +----------+----------+----------+----------+----------+----------+ | AS | YES | YES | YES | YES | In this | | | | | | | clause | +----------+----------+----------+----------+----------+----------+ | HSS | YES | YES | NO | NO | 7.2.3 | +----------+----------+----------+----------+----------+----------+
Table 7.12.3.2-2 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the IRI-POIs in the NFs listed in tables7.12.3.2-1 for
session based IMS-based services.
Table 7.12.3.2-2: ActivateTask message for activating IRI-POI for session-
based IMS service
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID XID assigned by LIPF.
The value used here shall be the same when IRI-POIs in multiple NFs are
provisioned for a warrant. The value used here shall also be same as the value
used for provisioning the CC-TFs (see table 7.12.3.3-1), MDF2 (see 7.12.3.4-1)
and MDF3 (see table 7.12.3.5-1). M TargetIdentifiers One or more of the target
identifiers listed in the clause 7.12.2.2 with the embedded conditions
implied. M DeliveryType Set to "X2Only. M ListOfDIDs Delivery endpoints of
LI_X2. These delivery endpoints shall be configured using the
_CreateDestination_ message as described in ETSI TS 103 221-1 [7] clause 6.3.1
prior to first use. M ListOfServiceTypes Present if interception is to be done
on one or more a specific service type. Using the format defined in ETS TS 103
221 [7] based on the service scoping listed below this table. When multiple
intercepts are activated on a target identifier, the service scoping shall be
the union of all of them. C
* * *
When service scoping is required, the IRI-POIs present in the NFs listed in
table 7.12.3.2-1 shall support the following service types from the structure
defined in ETSI TS 103 221-1 [7]:
\- The enumerated value of \"voice\" or \"messaging\" in the service type
field.
The ModifyTask and DeactivateTask messages that the LIPF may send to the IRI-
POIs present in the NFs listed in table 7.12.3.2-1 shall include the XID of
the Task created by the above ActivateTask message.
##### 7.12.3.2.2 Session-independent IMS services
Table 7.12.3.2-3 below shows the applicability of NFs in which the IRI-POIs
are provisioned with the target identifiers listed in clause 7.12.2.2 for
session independent services (e.g. SMS over IP). See TS 33.127 [5] and Annex
G.
When the service scoping is applicable, the IRI-POIs in the NFs shown in table
7.12.3.2-3 are provisioned only when the service type is messaging (i.e. SMS
over IP).
Table 7.12.3.2-3: IRI-POIs in the NFs that need to be provisioned for session-
independent IMS-based service
+----------+----------+----------+----------+----------+----------+ | NF | Not a | Target | R | | | | | target | n | eference | | | | (IMS | n | on-local | | | | | s | on-local | ID | | | | | ignaling | ID | | | | | | f | | | | | | | unction) | | | | | | +==========+==========+==========+==========+==========+==========+ | | Default | A | Default | A | | | | | lternate | | lternate | | | | | option | | option | | +----------+----------+----------+----------+----------+----------+ | P-CSCF | YES | YES | YES | YES | In this | | | | | | | clause | +----------+----------+----------+----------+----------+----------+ | S-CSCF | YES | NO | YES | NO | In this | | | | | | | clause | +----------+----------+----------+----------+----------+----------+ | E-CSCF | YES | NO | NO | NO | In this | | | | | | | clause | +----------+----------+----------+----------+----------+----------+ | IBCF | NO | YES | NO | YES | In this | | | | | | | clause | +----------+----------+----------+----------+----------+----------+ | MGCF | NO | NO | NO | NO | In this | | | | | | | clause | +----------+----------+----------+----------+----------+----------+ | AS | NO | NO | NO | NO | In this | | | | | | | clause | +----------+----------+----------+----------+----------+----------+ | HSS | YES | YES | NO | NO | 7.2.3 | +----------+----------+----------+----------+----------+----------+
Table 7.12.3.2-4 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the IRI-POIs in the NFs listed in table 7.12.3.2-3 for
session independent IMS-based voice services.
Table 7.12.3.2-4: ActivateTask message for activating IRI-POI for session
independent IMS-based service
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID XID assigned by LIPF.
The value used here shall be the same when IRI-POIs in multiple NFs are
provisioned for a warrant. M TargetIdentifiers One or more of the target
identifiers listed in the clause 7.12.2.2 with the embedded conditions
implied. M DeliveryType Set to "X2Only. M ListOfDIDs Delivery endpoints of
LI_X2. These delivery endpoints shall be configured using the
_CreateDestination_ message as described in ETSI TS 103 221-1 [7] clause 6.3.1
prior to first use. M ListOfServiceTypes Present if interception of one or
more listed service types is required. Using the format defined in ETS TS 103
221 [7] based on the service scoping listed below this table. When multiple
intercepts are activated on a target identifier, the service scoping shall be
the union of all of them. C
* * *
When service scoping is required, the IRI-POIs present in the NFs listed in
table 7.12.3.2-3 shall support the following service types from the structure
defined in ETSI TS 103 221-1 [7]:
\- The enumerated value of \"messaging\" in the service type field.
The ModifyTask and DeactivateTask messages that the LIPF may send to the IRI-
POIs present in the NFs listed in table 7.12.3.2-3 shall include the XID of
the Task created by the above ActivateTask message.
#### 7.12.3.3 Provisioning of CC-TF
The table 7.12.3.3-1 below shows the applicability of NFs in which the CC-TFs
are provisioned with the target identifiers listed in clause 7.12.2.2 for
session-based IMS services (e.g. voice). See TS 33.127 [5] and Annex G.
Table 7.12.3.3-1: CC-TFs in the NFs that need to be provisioned for session-
based IMS service
+--------------+--------------+--------------+---------+--------------+ | NF | Not a target | Target | | | | | non-local ID | non-local ID | | | | (IMS | | | | | | signaling | | | | | | function) | | | | | +==============+==============+==============+=========+==============+ | | Default | Alternate | Default | Alternate | | | | option | | option | +--------------+--------------+--------------+---------+--------------+ | P-CSCF | YES | YES | YES | NO | +--------------+--------------+--------------+---------+--------------+ | IBCF | YES | YES | YES | YES | +--------------+--------------+--------------+---------+--------------+ | MGCF | YES | YES | YES | NO | +--------------+--------------+--------------+---------+--------------+ | AS/MRFC | YES | YES | YES | YES | +--------------+--------------+--------------+---------+--------------+ | Conferencing | YES | YES | YES | YES | | AS/MRFC | | | | | +--------------+--------------+--------------+---------+--------------+
Table 7.12.3.3-2 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the CC-TFs in the NFs listed in table 7.12.3.3-1 for
session-based IMS services.
Table 7.12.3.3-2: ActivateTask message for activating CC-TF for session-based
IMS services
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID XID assigned by LIPF.
The value used here shall be the same when IRI-POIs in multiple NFs are
provisioned for a warrant. The value used here shall also be same as the value
used for provisioning the IRI-POIs (see table 7.12.3.2-2), MDF2 (see
7.12.3.4-1) and MDF3 (see table 7.12.3.5-1). M TargetIdentifiers One or more
of the target identifiers listed in the clause 7.12.2.2 with the embedded
conditions implied. M DeliveryType Set to "X3Only. M ListOfDIDs Delivery
endpoints of LI_X3. These delivery endpoints shall be configured using the
_CreateDestination_ message as described in ETSI TS 103 221-1 [7] clause 6.3.1
prior to first use. M ListOfServiceTypes Present if interception of one or
more listed service types is required. The value provisioneUsing the format
defined in ETS TS 103 221 [7] based on the service scoping listed below this
table. When multiple intercepts are activated on a target identifier, the
service scoping shall be the union of all of them. C
* * *
When service scoping is required, the CC-TF present in the NFs listed in table
7.12.3.3-1 shall support the following service scoping from the structure
defined in ETSI TS 103 221-1 [7]:
\- The enumerated value of \"voice\" or \"messaging\" in the service type
field.
The ModifyTask and DeactivateTask messages that the LIPF may send to the CC-
TFs present in the NFs listed in table 7.12.3.3-1 shall include the XID of the
Task created by the above ActivateTask message.
#### 7.12.3.4 Provisioning of the MDF2
The MDF2 listed as the delivery endpoint over LI_X2 for xIRI generated by the
IRI-POIs shall be provisioned over LI_X1 by the LIPF.
Table 7.12.3.4-1 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the MDF2.
Table 7.12.3.4-1 ActivateTask message for MDF2
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID XID assigned by LIPF.
The value used here shall also be same as the value used for provisioning the
IRI-POIs, CC-TFs, and and MDF3 (see table 7.12.3.5-1). M TargetIdentifiers One
or more of the target identifiers listed in the clause 7.12.2.2 with the
embedded conditions implied. M DeliveryType Not used. M ListOfDIDs Delivery
endpoints of LI_HI2. These delivery endpoints shall be configured using the
_CreateDestination_ message as described in ETSI TS 103 221-1 [7] clause 6.3.1
prior to first use. M ListOfMediationDetails Sequence of Mediation Details,
see table 7.12.3.4-2. M
* * *
Table 7.12.3.4-2: Mediation Details for MDF2
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O LIID Lawful Intercept ID
associated with the task. M DeliveryType Set to \"HI2Only\". M ListOfDIDs
Details of where to send the IRI for this LIID. Shall be included if deviation
from the ListofDIDs in the ActivateTask message is necessary. If included, the
ListOfDIDs in the Mediation Details shall be used instead of any delivery
destinations authorised by the ListOfDIDs field in the ActivateTask Message. C
ServiceScoping Present if service scoping is required. Using the format
defined in ETS TS 103 221 [7] include the service scoping as applicable to
this LIID based on the service scoping listed below the table. C
* * *
The MDF2 shall support the following service scoping from the structure
defined in ETSI TS 103 221-1 [7]:
\- The enumerated value of \"voice\" or \"messaging\" in the service type
field.
\- When location reporting is required, one or both of
\"reportBeginingAndEnd\", \"reportUponChange\".
The ModifyTask and DeactivateTask messages that the LIPF may send to the MDF2
present in the NFs listed in table 7.12.3.4-1 shall include the XID of the
Task created by the above ActivateTask message.
#### 7.12.3.5 Provisioning of the MDF3
The MDF3 listed as the delivery endpoint over LI_X3 for xCC generated by the
IRI-POIs shall be provisioned over LI_X1 by the LIPF.
Table 7.12.3.5-1 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the MDF3.
Table 7.12.3.5-1 ActivateTask message for MDF3
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID XID assigned by LIPF.
The value used here shall also be same as the value used for provisioning the
IRI-POIs, CC-TFs, and MDF2 (see table 7.12.3.4-1). M TargetIdentifiers One or
more of the target identifiers listed in the clause 7.12.2.2 with the embedded
conditions implied. M DeliveryType Not used. M ListOfDIDs Delivery endpoints
of LI_HI3. These delivery endpoints shall be configured using the
_CreateDestination_ message as described in ETSI TS 103 221-1 [7] clause 6.3.1
prior to first use. M ListOfMediationDetails Sequence of Mediation Details,
See table 7.12.3.5-2. M
* * *
Table 7.12.3.5-2: Mediation Details for MDF3
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O LIID Lawful Intercept ID
associated with the task. M DeliveryType Set to \"HI3Only\". M ListOfDIDs
Details of where to send the CCI for this LIID. Shall be included if deviation
from the ListofDIDs in the ActivateTask message is necessary. If included, the
ListOfDIDs in the Mediation Details shall be used instead of any delivery
destinations authorised by the ListOfDIDs field in the ActivateTask Message. C
ServiceScoping Present if service scoping is required. Using the format
defined in ETS TS 103 221 [7] include the service scoping as applicable to
this LIID based on the service scoping listed below the table. C
* * *
When service scoping is required, the MDF3 shall support the following service
scoping from the structure defined in ETSI TS 103 221-1 [7]:
\- The enumerated value of \"voice\" or \"messaging\" in the service type
field.
The ModifyTask and DeactivateTask messages that the LIPF may send to the
MDF3shall include the XID of the Task created by the above ActivateTask
message.
### 7.12.4 Generation of xIRIs over LI_X2
#### 7.12.4.1 IRI-POIs in IMS signaling functions
##### 7.12.4.1.1 General
The IRI-POIs present in the NFs provisioned as shown in table 7.12.3.3-1
generate the xIRIs according to the conditions described in TS 33.127 [5] and
illustrated in Annex G.
As described in TS 33.127 [5], clause 7.12.3.2.2 and illustrated in Annex G,
the present document supports two deployment options:
\- Default option.
\- Alternate option.
The options used for LI involving a specific IMS service may be different from
the option used for LI involving another IMS service. For example, a default
option may be used for target non-local ID and an alternate option may be used
for a local target ID.
NOTE: One of the obvious conditions not stated in the subsequent clauses is
that an NF can provide an IRI-POI functions if and only if the SIP signaling
messages pass through that NF.
When a condition (e.g. inbound roaming with LBO) under which an NF provides
the IRI-POI functions is dependent on the handling of SIP REGISTER message,
the IRI-POIs may have to scan the SIP REGISTER for all IMS users to address
the case when that IMS user engages in a communication with a target non-local
ID.
##### 7.12.4.1.2 IRI-POI in P-CSCF
###### 7.12.4.1.2.1 Session-based IMS communications
In the default deployment option, the P-CSCF provides the IRI-POI functions
when any of the following conditions are met:
\- The target is inbound roaming (with LBO) IMS user and is not registered for
emergency services. The E-CSCF provides the IRI-POI functions when the target
is registered for the emergency services.
\- An inbound roaming (with LBO) IMS user is in communication with a target
non-local ID.
In the alternate deployment option, the P-CSCF always provides the IRI-POI
functions except for the following cases:
\- A non-roaming or outbound roaming (with HR) IMS user in communication with
a target non-local ID. The S-CSCF provides the IRI-POI functions for such a
case.
\- An inbound roaming (with LBO) IMS user is in communication with a target
non-local ID when the media is home-routed. The IBCF provides the IRI-POI
functions for such a case.
With the above conditions met, the IRI-POI present in the P-CSCF identifies
that an IMS-based communication is to be intercepted according to clause
7.12.2.8.
###### 7.12.4.1.2.2 Session-independent IMS communications
In the default deployment option, the P-CSCF provides the IRI-POI functions
when any of the following conditions are met:
\- The target is inbound roaming (with LBO) IMS user and is not registered for
emergency services. If applicable, E-CSCF provides the IRI-POI functions when
IMS user is registered for emergency services.
\- An inbound roaming (with LBO) IMS user is in communication with a target
non-local ID.
In the alternate deployment option, the P-CSCF always provides the IRI-POI
functions.
With the above conditions met, the IRI-POI present in the P-CSCF identifies
that an IMS-based communication is to be intercepted according to clause
7.12.2.8.
##### 7.12.4.1.3 IRI-POI in S-CSCF
###### 7.12.4.1.3.1 Session-based IMS communications
In the default deployment option, the S-CSCF always provides the IRI-POI
functions except for the following conditions:
\- The target is registered for emergency services and E-CSCF provides the
IRI-POI for IMS-based emergency services.
\- IMS user is in communication with a target non-local ID. The MGCF or IBCF
provide the IRI-POI functions for such a case.
\- The S-CSCF is not serving the target.
In the alternate deployment option, the S-CSCF provides the IRI-POI functions
when any of the the following condition is met:
\- IMS user is in communication with a target non-local ID.
\- The S-CSCF is serving the IMS user in communication with the target non-
local ID.
With the above conditions met, the IRI-POI present in the S-CSCF identifies
that an IMS-based communication is to be intercepted according to clause
7.12.2.8.
###### 7.12.4.1.3.2 Session-independent IMS communications
In the default deployment option, the S-CSCF always provides the IRI-POI
functions except for the following conditions:
\- The target is registered for emergency services and E-CSCF provides the
IRI-POI for IMS-based emergency services.
\- The S-CSCF is neither serving the target nor the IMS user in communication
with a target non-local ID.
In the alternate deployment option, the S-CSCF does not provide the IRI-POI
functions.
When the above conditions are met, the IRI-POI present in the S-CSCF
identifies that an IMS-based communication is to be intercepted according to
clause 7.12.2.8.
##### 7.12.4.1.4 IRI-POI in E-CSCF
In the default deployment option, the E-CSCF provides the IRI-POI functions
except for the following condition (see Annex G):
\- S-CSCF provides the IRI-POI for emergency services.
In the alternate deployment option, the E-CSCF does not provide the IRI-POI
functions.
When the above conditions are met, the IRI-POI present in the E-CSCF
identifies that an IMS-based communication is to be intercepted according to
clause 7.12.2.8.
##### 7.12.4.1.5 IRI-POI in IBCF
###### 7.12.4.1.5.1 Session-based IMS communications
In the default deployment option, the IBCF provides the IRI-POI functions when
any of the following conditions are met (see Annex G):
\- A non-roaming IMS user is in communication with a target non-local ID.
\- An outbound roaming IMS user is in communication with a target non-local
ID.
In the alternate deployment option, the IBCF shall provide the IRI-POI
functions when any of the following conditions are met:
\- The target involved is an outbound roaming (with LBO) IMS user.
\- The IMS session to a target is redirected to a user in the IP domain.
\- IMS session to a target is redirected to an outbound roaming (with LBO) IMS
user.
\- An inbound roaming (with LBO) IMS user is in communication with a target
non-local ID on an IMS session that employs home-routed media.
When the above conditions are met, the IRI-POI present in the IBCF identifies
that an IMS-based communication is to be intercepted according to clause
7.12.2.8.
###### 7.12.4.1.5.2 Session-independent IMS communications
In the default deployment option, the IBCF does not provide the IRI-POI
functions.
In the alternate deployment option, the IBCF provides the IRI-POI functions
except for the following condition:
\- The target is an inbound roaming (with LBO) IMS user. The P-CSCF provides
the IRI-POI functions for such a case.
\- The inbound roaming (with LBO) IMS user is in communication with a non-
local target. The P-CSCF provides the IRI-POI functions for such a case.
When the above conditions are met, the IRI-POI present in the IBCF identifies
that an IMS-based communication is to be intercepted according to clause
7.12.2.8.
##### 7.12.4.1.6 IRI-POI in MGCF
###### 7.12.4.1.6.1 Session-based IMS communications
In the default deployment option, the MGCF provides the IRI-POI functions when
any of the following conditions are met:
\- A non-roaming IMS user is in communication with a target non-local ID.
\- An outbound roaming IMS user is in communication with a target non-local
ID.
For session-based IMS communications, in the alternate deployment option, the
MGCF shall provide the IRI-POI functions when the following condition is met:
\- The IMS session to a target is redirected to a user in the CS domain.
When the above conditions are met, the IRI-POI present in the MGCF identifies
that an IMS-based communication is to be intercepted according to clause
7.12.2.8.
###### 7.12.4.1.6.2 Session-independent IMS communications
For session-independent IMS communications, the MGCF does not provide the IRI-
POI functions.
##### 7.12.4.1.7 IRI-POI in AS
###### 7.12.4.1.7.1 Session-based IMS communications
In both default and alternate deployment options, the AS provides the IRI-POI
when the interception of IMS sessions involving special services such as
conferencing is required.
The IRI-POI present in the AS identifies that an IMS-based communication is to
be intercepted according to clause 7.12.2.8.
###### 7.12.4.1.7.2 Session-independent IMS communications
For session-independent IMS communications, the AS does not provide the IRI-
POI functions.
#### 7.12.4.2 IMS records
##### 7.12.4.2.1 IMS Message
For an intercepted IMS based communication (see clause 7.12.2.8), the IRI-POI
present in the IMS Signaling Function shall generate the xIRI IMSMessage from
the SIP message used to handle that IMS based communication. All SIP messages
use the same xIRI record as shown in table 7.12.4.2-1.
Table 7.12.4.2-1: Payload for IMSMessage record
+-----------------------------+-----------------------------+-------+ | Field name | Description | M/C/O | +=============================+=============================+=======+ | payload | One of the following | M | | | payload types (other | | | | payload types may be added | | | | in future versions of the | | | | specification): | | | | | | | | - encapsulatedSIPMessage: | | | | See table 7.12.4.2-2. | | +-----------------------------+-----------------------------+-------+ | sessionDirection | Indicates the direction of | M | | | the SIP session: | | | | fromTarget, toTarget, | | | | combined (if target calls | | | | him/herself) or | | | | indeterminate if the | | | | direction cannot be | | | | determined reliable (see | | | | NOTE). | | +-----------------------------+-----------------------------+-------+ | voIPRoamingIndication | Indicates whether the | C | | | roaming mode is inbound | | | | LBO, S8HR or N9HR when the | | | | target is in roaming | | | | situation. | | +-----------------------------+-----------------------------+-------+ | location | Location (e.g. PANI Header) | C | | | with timestamp, if | | | | available. | | +-----------------------------+-----------------------------+-------+ | NOTE: When an incoming call | | | | to a target is redirected | | | | to another user, the | | | | sessionDirection field | | | | shall be set to toTarget. | | | | When an incoming call from | | | | a target non-local ID to an | | | | IMS user is redirected to, | | | | the sessionDirection field | | | | shall be set to fromTarget. | | | +-----------------------------+-----------------------------+-------+
Table 7.12.4.2-2: Structure of the encapsulatedSIPMessage parameter
Field name Description M/C/O
* * *
iPSourceAddress Indicates the conditional source IPv4 address or source IPv6
address field in the PDU header to the source IP address of the intercepted
SIP message (see ETSI TS 103 221-2 [8] clause 5.3). M iPDestinationAddress
Indicates the conditional destination IPv4 address or destination IPv6 address
field in the PDU header to the destination IP address of the intercepted SIP
message (see ETSI TS 103 221-2 [8] clause 5.3). M sIPContent The relevant SIP
message, or SIP message header if the warrant requires IRI-only. In addition,
for IRI-only intercepts, specific content (e.g. SIP MESSAGE method) may have
to be deleted. M
The IRI-POI present in the IMS signaling function generating an xIRI
containing an IMSMessage record shall set:
\- The Payload Direction field in the PDU header to the direction of the
signaling message carried in the IRI payload (see ETSI TS 103 221-2 [8] clause
5.2.6). If the signalling message was sent from the target, the Direction
Value \"3\" (sent from the target) shall be used, if the signalling message
was sent to the target, the Direction Value \"2\" (sent to the target) shall
be used; if the direction could not be determined reliably, the Direction
Value \"1\" (not known to the POI) shall be used. If the SIP message is sent
from and to the target, the Direction Value \"4\" (more than one direction)
shall be used. For the SIP messages generated by the network, the Direction
Value \"5\" (not applicable) shall be used.
\- The conditional source IPv4 address or source IPv6 address field in the PDU
header to the source IP address of the intercepted SIP message (see ETSI TS
103 221-2 [8] clause 5.3). It shall contain the source address of the packet
from the 32-bit \"Source Address\" field in IPv4, as defined in IETF RFC 791
[34], or from the 128-bit \"Source Address\" field in IPv6, as defined in IETF
RFC 2460 [27].
\- The conditional destination IPv4 address or destination IPv6 address field
in the PDU header to the destination IP address of the intercepted SIP message
(see ETSI TS 103 221-2 [8] clause 5.3). It shall contain the destination
address of the packet from the 32-bit \"Source Address\" field in IPv4, as
defined in IETF RFC 791 [34], or from the 128-bit \"Source Address\" field in
IPv6, as defined in IETF RFC 2460 [27].
##### 7.12.4.2.2 Start of interception with Active IMS session
The IRI-POI present in the IMS signaling function shall generate the xIRI
StartOfInterceptionForActiveIMSSession when all of the following conditions
are met:
\- The IRI-POI receives an LI_X1: ActivateTask from the LIPF.
\- The IRI-POI detects the IMS user identified by one or more of the target
identifier (s) included in the ActivateTask is on an active IMS session.
\- The-IRI-POI in the IMS signaling functions meets the criteria mentioned in
TS 33.127 [5] for providing the IRI-POI functions.
The generation of the xIRI shall be independent of the IMS media associated
with the session. If multiple IMS sessions are active at the start of
interception, a StartOfInterceptionForActiveIMSSession record shall be
generated for each active session.
The following table contains parameters, with IRITargetIdentifier, generated
by the IRI-POI.
Table 7.12.4.2.-3: Payload for StartOfInterceptionForActiveIMSSession record
Field name Description M/C/O
* * *
originatingId Identities of the originator of the session. M terminatingId
Identities of the termination of the service. M sDPState Latest state of
session from IMS signaling function (including LMISF) will provide the agreed
SDP answer and related modification (encoded in SDP format as per RFC 4566
[43] clause 5 when known.) for each media stream of the target. C
diversionIdentity Provided if available and applicable. C
voIPRoamingIndication Indicates whether the roaming mode is LBO, S8HR or
N9HR.when the target is in roaming situation. C location Location (e.g. PANI
Header) with timestamp, if available. C
##### 7.12.4.2.3 IMS CC Unavailable
The IRI-POI present in the IMS signaling function that also has the CC-TF
(which would have triggered the media interception at the CC-POI) shall
generate the xIRI IMSCCUnavailable when the media is not available for
interception in the CSP\'s network.
Accordingly, the IRI-POI present in the IMS signaling function that has the
CC-TF shall generate the xIRI IMSCCUnavailable when the following conditions
are met:
\- The target of interception is on an IMS session with established SDP offer
and answer.
\- The media does not enter the IMS network of the CSP that has received the
warrant. In other words, the CC-TF does not send the LI_T3 ActivateTask to the
CC-POI.
\- The CSP is required to send a notification to the LEMF when the media
interception is required but not available for the interception.
NOTE: The details of any interactions required between the IRI-POI and CC-TF
present in the same IMS Signaling Function (e.g. IBCF) is outside the scope of
the present document.
The payload of the IMSCCUnavailable xIRI is as shown in table 7.12.4.2-4.
Table 7.12.4.2.-4: Payload for IMSCCUnavailable record
Field name Description M/C/O
* * *
cCUnavailableReason Provides the reason for the unavailability of CC. M
sDPState The latest SDP information, if known. C
### 7.12.5 Triggering of CC-POI by CC-TF over LI_T3
#### 7.12.5.1 CC-TFs in IMS signaling functions
##### 7.12.5.1.1 General
The CC_TFs present in the NFs provisioned as shown in table 7.12.3.3-1
activate the CC-POIs according to the conditions described in TS 33.127 [5]
and illustrated in Annex G.
NOTE 1: One of the obvious conditions not stated in the subsequent clauses is
that an NF can provide the CC-TF functions if and only if the SIP signaling
messages pass through that NF.
NOTE 2: The CC-TF functions apply only for session-based IMS communications.
When a condition (e.g. inbound roaming with LBO) under which an NF provides
the CC-TF functions is dependent on the handling of SIP REGISTER message, the
CC-TFs may have to scan the SIP REGISTER for all IMS users to address the case
when that IMS user engages in a communication with a target non-local ID.
##### 7.12.5.1.2 CC-TF in P-CSCF
The P-CSCF provides the CC-TF functions when the CC-POI functions are provided
at the IMS-AGW.
The P-CSCF always provides the CC-TF functions (based on the call direction,
of-course) except for the following cases:
\- A non-roaming IMS user in communication with a target non-local ID. IBCF or
MGCF provide the CC-TF functions for that case.
\- An outbound roaming (with LBO) IMS user is in communication with a target
non-local ID. IBCF or MGCF provide the CC-TF functions for that case.
When an inbound roaming (LBO) IMS user is in communication with a target non-
local ID, two deployment options are defined (see TS 33.127 [5]) for providing
the CC-TFs functions. The P-CSCF provides the CC-TF functions except for the
following case:
\- An inbound roaming (with LBO) IMS user is in communication with a target
non-local ID when the media is home-routed. IBCF provides the CC-TF functions
for that case.
With the above conditions met, the CC-TF present in the P-CSCF identifies that
an IMS-based communication is to be intercepted according to clause 7.12.2.8.
##### 7.12.5.1.3 CC-TF in IBCF
The IBCF provides the CC-TF functions when the CC-POI functions are provided
at the TrGW.
The IBCF provides the CC-TF functions when any of the following conditions are
met:
\- A non-roaming IMS user is in communication with a target non-local ID in
the IP domain.
\- An outbound roaming IMS user is in communication with a target non-local ID
in the IP domain.
\- IMS session is to an outbound roaming (with LBO) target.
\- An IMS session to a target is redirected to a user in the IP domain.
\- An IMS session to a target is redirected to an outbound roaming (with LBO)
IMS user.
\- An inbound roaming (with LBO) IMS user is in communication with a target
non-local ID on an IMS session that employs home-routed media and alternate
deployment option is used for media interception.
When the above conditions are met, the CC-TF present in the IBCF identifies
that an IMS-based communication is to be intercepted according to clause
7.12.2.8.
##### 7.12.5.1.4 CC-TF in MGCF
The MGCF provides the CC-TF functions when the CC-POI functions are provided
at the IM-MGW.
The MGCF provides the CC-TF functions when any of the following conditions are
met (see Annex G):
\- A non-roaming IMS user is in communication with a target non-local ID in
the CS domain.
\- An outbound roaming IMS user is in communication with a target non-local ID
in the CS domain.
\- An IMS session to a target is redirected to a user in the CS domain.
When the above conditions are met, the CC-TF present in the MGCF identifies
that an IMS-based communication is to be intercepted according to clause
7.12.2.8.
##### 7.12.5.1.5 CC-TF in AS/MRFC
The AS/MRFC provides the CC-TF functions when the CC-POI functions are
provided at the MRFP.
The AS/MRFC provides the CC-TF functions when the interception of IMS sessions
involving special services such as conferencing, music or tones is required.
The CC-TF present in the AS/MRFC identifies that an IMS-based communication is
to be intercepted according to clause 7.12.2.8.
#### 7.12.5.2 LI_T3 triggering details
##### 7.12.5.2.1 General
As described in clause 7.12.5.1, the CC-POI may reside in the IMS-AGW, TrGW,
IM-MGW or the MRFP. The trigger to perform the media interception is provided
by the CC-TF present in the P-CSCF, IBCF, MGCF, AS/MRFC respectively.
NOTE 1: The present document assumes that the above NFs that have the CC-TF
and the NFs that have the CC-POI interact with each other using the H.248
messages.
When the IRI-POI and the CC-TF are provided by two different NFs, the
interception of media is performed at the core-network side of the NF that has
the CC-POI. This is to align the media interception with the SDP information
reported in the xIRI.
When the IRI-POI and the CC-TF are provided by the same NF, based on the
deployment option, the interception of media can be done at the access side or
core network side of an IMS-AGW, at the peer network side or the core network
side of an TrGW. For the IM-MGW, the media interception is always done on the
core network side since the peer network is in CS domain. For the MRFP, all
sides are core network and therefore, the media interception is always on the
core network side.
The possibilities of such media interception points are illustrated in figure
7.12.5.2-1.
Figure 7.12.5.2-1: Media interception point options in the CC-POIs
NOTE 2: Even when the option of access side or peer network side is chosen,
for certain session scenarios (e.g. hold), media interception may have to be
moved to the core network side.
The time at which trigger is sent to the CC-POI has a relationship to the NF
(that has the CC-TF) handling of SIP messages that carry the SDP offer and SDP
answer as those SIP messages result in the NF (that has the CC-TF)
creating/modifying the media contexts at the NF that handles the media.
The procedures used to activate (i.e. trigger) the media interception at the
CC-POI present in IMS-AGW, TrGW and IM-MGW are the same. The procedures used
to activate (i.e. trigger) the media interception at the MRFP can be different
due to the nature of media functions provided by the MRFP can be different
(e.g. conferencing, announcements).
##### 7.12.5.2.2 Activation Task
###### 7.12.5.2.2.1 Overview
The ActivateTask message over the LI_T3 interface is sent from CC-TF to CC-POI
as a trigger to start the media interception at the CC-POI. The details of the
ActivateTask are as shown in table 7.12.5.2.2-1:
Table 7.12.5.2.2-1: ActivateTask message for triggering the CC-POI over LI_T3
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID Allocated by the CC-TF
as per ETSI TS 103 221-1 [7]. M TargetIdentifiers IP address and the UDP port
number are to be used at the CC-POI in identifying the IMS media that needs to
be intercepted. See table 7.12.5.2.2-2. M DeliveryType Set to \"X3Only\". M
ListOfDIDs Shall give the DID of the MDF3 to which the xCC should be
delivered. The delivery endpoint is configured using the CreateDestination
message as described in ETSI TS 103 221-1 [7] clause 6.3.1 prior to the task
activation. M CorrelationID This value is set by the CC-TF and shall be same
as the value to be used in the xCC generated at the CC-POI. M ProductID Shall
be set to the XID of the Task Object associated with the interception at the
CC-TF. This value shall be used by the CC-POI to fill the XID field of xCC
sent over LI_X3 to the MDF3. M TaskDetailsExtensions/SDP See table
7.12.5.2.2-3. M
* * *
Along with the IP address and UDP port number, a few additional identifiers
are needed for the media interception. These are shown as
TargetIdentifierExtension in table 7.12.5.2.2-2 and TaskDetailsExtensions in
table 7.12.5.2.2-3.
Table 7.12.5.2.2-2: Target identifiers and extensions for LI_T3
+-------------------+-------+-------------------+-------------------+ | Identifier type | Owner | ETSI TS 103 221-1 | Definition | | | | [7] | | | | | TargetIdentifier | | | | | type | | +-------------------+-------+-------------------+-------------------+ | IPv4 Address | ETSI | IPv4Address | ETSI TS 103 221-1 | | | | | [7] | +-------------------+-------+-------------------+-------------------+ | IPv6 Address | ETSI | IPv6Address | ETSI TS 103 221-1 | | | | | [7] | +-------------------+-------+-------------------+-------------------+ | UDP Port Number | ETSI | UDPPort | ETSI TS 103 221-1 | | | | | [7] | +-------------------+-------+-------------------+-------------------+ | H248 Context ID | 3GPP | TargetIde | H248ContextID | | | | ntifierExtension/ | | | | | | (see XSD Schema) | | | | H248ContextID | | +-------------------+-------+-------------------+-------------------+ | Payload Direction | 3GPP | TargetIde | PayloadDi | | Assignment | | ntifierExtension/ | rectionAssignment | | | | | (see XSD Schema) | | | | PayloadDi | | | | | rectionAssignment | | +-------------------+-------+-------------------+-------------------+ | Trigger Scope | 3GPP | TargetIde | TriggerScope | | | | ntifierExtension/ | | | | | | (see XSD Schema) | | | | TriggerScope | | +-------------------+-------+-------------------+-------------------+
Table 7.12.5.2.2-3: SDP task details extensions for LI_T3
* * *
Extensions field name Description M/C/O LocalSDP SDP sent to the remote end of
the session (see paragraph below) C RemoteSDP SDP received from the remote end
of the session (see paragraph below) C
* * *
The IP address and the UDP port number as target identifiers give the
destination address at the UDP layer of the to-be intercepted media. For
symmetric media, the same IP address and UDP port number give the source
address at the UDP layer of the to-be-intercepted media in the reverse
direction.
The H248ContextID identifies the identity of the media context created at the
IMS Media Function using the H.248 Add Context message.
The TriggerScope indicates whether IP address and UDP port number included as
the target identifiers in the LI_T3 ActivateTask are to be used for
bidirectional media or unidirectional media. In the latter case, a separate
trigger shall be sent to intercept media in the reverse direction.
\"Bidirectional\" and \"Unidirectional\" are the values that can be set for
the TriggerScope by the CC-TF in the ActivateTask message.
When the TriggerScope is \"Unidirectional\", the IP address and UDP port
number identify the destination IP address and the UDP port number of the
intercepted IMS media stream. When the TriggerScope is \"Bidirectional\", the
IP address and UDP port number identify the destination IP address and UDP
port number of the incoming intercepted IMS media and the source IP address
and UDP port number of the outgoing IMS media.
The PayloadDirectionAssignment field indicates the direction of the media
stream destined to the IP address and UDP port number (indicated as target
identifiers in the ActivateTask) from the perspective of the target.
\"FromTarget\", \"ToTarget\" and \"NotDetermined\" are the values that can be
set for this by the CC-TF in the ActivateTask message.
The LocalSDP provides the SDP information to be sent in a SIP message by the
NF that has the CC-TF. The RemoteSDP provides the SDP information received in
a SIP message at the NF that has the CC-TF. In some cases, both LocalSDP and
RemoteSDP may be included in the ActivateTask message. The CC-POI is expected
to use the LocalSDP to populate the SDP Session Description field of the X3
PDUs for the incoming media streams and to use the the RemoteSDP to populate
the SDP Session Description field of the X3 PDUs for the outgoing media
streams.
###### 7.12.5.2.2.2 Activation of CC-POI in IMS-AGW, TrGW, IM-MGW
The CC-TF shall send a trigger to the CC-POI using the ActivateTask message
over the LI_T3 interface for an intercepted IMS session (as determined
according to the clause 7.12.2.8) that requires the CC interception when the
following occur:
\- The NF that has the CC-TF receives the acknowledgement (i.e. H.248 Reply)
to the H.248: Add Context from the NF that has the CC-POI. The H.248: Add
Context is sent when the SIP message that contains the SDP offer is handled.
\- The CC-TF receives an ActivateTask from the LIPF over LI_X1 with CC
interception required for an IMS session with an already established SDP offer
and possibly SDP answer as well. This process is part of a mid-session
activation of interception.
When the media streams are asymmetric, the CC-TF shall send a second trigger
to the CC-POI using the ActivateTask message over the LI_T3 interface to
intercept the media in the reverse direction when the following occur:
\- When the SDP offer is received from the side where the media interception
is done, the NF that has the CC-TF receives the acknowledgement (i.e. H.248
Reply) to the H.248: Add Context from the NF that has the CC-POI. The H.248:
Add Context is sent when the SIP message that contains the SDP offer is
handled. This happens at the same time the first trigger (LI_T3 ActivateTask)
is sent.
\- When the SDP answer is received from the side where the media interception
is done, the NF that has the CC-TF receives the acknowledgement (i.e. H.248
Reply) to the H.248 Mod Context from the NF that has the CC-POI. The H.248:
Mod Context is sent when the SIP message that contains the SDP answer is
handled.
\- The CC-TF receives an ActivateTask from the LIPF over LI_X1 with CC
interception required for an IMS session with an already established SDP offer
and possibly SDP answer as well. This process is part of a mid-session
activation of interception.
The details of ActivateTask sent from the CC-TF to the CC-POI over LI_T3 are
shown in table 7.12.5.2.2-1.
For the trigger (for the asymmetric media case, it is the first trigger):
\- The CC-TF shall use the IP address and UDP port number present in the local
descriptor part of the acknowledgement (i.e. H.248 Reply) to an H.248 Add
context message. The same IP address and the UDP port numbers are also present
in the SIP messages that carry the SDP offer or SDP answer (depending on the
SIP message direction and the session scenario).
> NOTE 1: The SDP offer may be present in a forward SIP message (e.g. SIP
> INVITE) or in a response SIP message (e.g. SIP 200 OK). In the latter case,
> the trigger to perform media interception is sent when the response SIP
> message is handled.
>
> When the CC-TF and IRI-POI are present in different NFs, the IP address and
> the UDP port number are associated with the core network side of the NF that
> has the CC-POI.
>
> When the CC-TF and the IRI-POI are in the same NF, as a deployment option,
> the CC-TF may choose the side for media interception and hence, includes the
> IP address and the UDP port number that correspond to the side at which the
> media interception is to be done. The sides thus chosen based on the IP
> address and UDP port number can be the access side or core network side when
> the CC-POI is in IMS-AGW, the side can be peer network side or core network
> side when the CC-POI is in TrGW, and the side is always the core network
> side when the CC-POI is in the IM-MGW (see figure 7.12.5.2-1). The CC-POI is
> expected to perform the media interception on the side as determined by that
> IP address and the UDP port number.
For the second trigger that applies to asymmetric media case:
\- The CC-TF shall use the IP address and UDP port number present in the
remote descriptor part of the of the H.248 transaction that happens between
the NF that has the CC-TF and the NF that has the CC-POI. The same IP address
and the UDP port numbers are also present in the SIP messages that carry the
SDP offer or SDP answer (depending on the SIP message direction and the
session scenario).
> The remote IP address and the UDP port number are on the same side where the
> local IP address and UDP port number were provided in the first trigger.
The values that the CC-TF sets for the PayloadDirectionAssignment and
TriggerScope shall be determined as described in tables 7.12.5.2.2-4 and
7.12.5.2.2-5.
Table 7.12.5.2.2-4: PayloadDirectionAssignment and TriggerScope values (target
identifier from local descriptor)
Media interception side PayloadDirectionAssignment TriggerScope
* * *
                            Not a non-local ID           Non-local ID   Symmetric media   Asymmetric media
IMS-AGW Access FromTarget ToTarget \"Bidirectional\" n/a Core network ToTarget
FromTarget \"Bidirectional\" \"Unidirectional\" TrGW Peer network FromTarget
FromTarget \"Bidirectional\" \"Unidirectional\" Core network ToTarget ToTarget
\"Bidirectional\" \"Unidirectional\" IM-MGW Core network ToTarget ToTarget
\"Bidirectional\" \"Unidirectional\"
Table 7.12.5.2.2-5: PayloadDirectionAssignment and TriggerScope values (target
identifier from remote descriptor)
Media interception side PayloadDirectionAssignment TriggerScope
* * *
                            Not a non-local ID           Non-local ID   Symmetric media   Asymmetric media
IMS-AGW Access n/a n/a n/a n/a Core network FromTarget ToTarget n/a
\"Unidirectional\" TrGW Peer network ToTarget ToTarget n/a \"Unidirectional\"
Core network FromTarget FromTarget n/a \"Unidirectional\" IM-MGW Core network
FromTarget FromTarget n/a \"Unidirectional\"
NOTE 2: The media interception of target non-local ID is done in the IMS-AGW
only when the IMS user is in communication with the target non-local ID is an
inbound roamer with LBO with the alternate deployment option (see TS 33.127
[5]).
NOTE 3: When media is neither sent to nor received from the target (e.g. call
waiting scenario, held session), and when the CC-TF is aware of the scenario,
the value of \"NotDetermined\" is used as the PayloadDirectionAssignment
value. The CC-TF changes the PayloadDirectionAssignment value using a LI_T3
ModifyTask (see clause 7.12.5.2.3) when the media is cross connected to the
target (e.g. held session is retrieved).
The table 7.12.5.2.2-6 shows how the CC-POI is expected to set the Payload
Direction field in the xCC based on the PayloadDirectionAssignment and
TriggerScope values received in the LI_T3 ActivateTask message.
Table 7.12.5.2.2-6: Expected payload direction value in the xCC
TriggerScope PayloadDirectionAssignment RTP stream (media stream) direction
* * *
                                                To the target identifier              From the target identifier
Bidirectional FromTarget \"3\" from the target \"2\" to the target ToTarget
\"2\" to the target \"3\" from the target NotDetermined \"5\" not applicable
to this xCC \"5\" not applicable to this xCC Unidirectional FromTarget \"3\"
from the target n/a ToTarget \"2\" to the target n/a NotDetermined \"5\" not
applicable to this xCC n/a
NOTE 4: When the TriggerScope value is \"Unidirectional\", two LI_T3 triggers
are sent to the CC-POI and in this case, the CC-POI is expected to set the
Payload Direction field separately according to the PayloadDirectionAssignment
received in the corresponding LI_T3 trigger.
The following paragraphs describe the algorithm the CC-TF shall use for the
inclusion of the LocalSDP and Remote SDP in the LI T3 ActivateTask message.
\- When the TriggerScope value is \"Bidirectional\":
\- When the SDP offer is received at the NF that has the CC-TF (on the side
where the media interception is done) before the sending of a ActivateTask to
the CC-POI, the CC-TF shall use the SDP information received in the SDP offer
as RemoteSDP and the SDP information that will be sent later in the SDP answer
of a SIP message as LocalSDP.
\- When the SDP offer is sent by the NF that has the CC-TF (on the side where
the media interception is done) after the sending of a ActivateTask to the CC-
POI, the CC-TF shall use the SDP information that will be included in the SDP
offer of a SIP message as LocalSDP. In this case, the RemoteSDP is sent in the
LI_T3 ModifyTask when the SDP answer is received in a SIP message (see clause
7.12.5.2.3).
\- When the TriggerScope value is \"Unidirectional\":
\- When the SDP offer is received at the NF that has the CC-TF (on the side
where the media interception is done) before the sending of a ActivateTask to
the CC-POI, the CC-TF shall use the SDP information that will be sent later in
the SDP answer of a SIP message as the LocalSDP in the first LI_T3 trigger.
The SDP information received in the SDP offer as the RemoteSDP in the second
LI_T3 trigger.
\- When the SDP offer is sent by the NF that has the CC-TF (on the side where
the media interception is done) after the sending of a ActivateTask to the CC-
POI, the CC-TF shall use the SDP information that will be included in the SDP
offer of a SIP message as LocalSDP in the first trigger.
\- When the SDP answer is received at the NF that has the CC-TF (on the side
where the media interception is done), the CC-TF shall use the SDP information
received in the SDP answer of SIP message as RemoteSDP of the second LI_T3
trigger.
For the mid-session interception case, the CC-TF shall include both the
LocalSDP and RemoteSDP in the trigger (LI_T3 ActivateTask) when the
TriggerScope is \"Bidirectional\".
For mid-session interception case when the TriggerScopeValue is
\"Unidirectional\", the CC-TF shall include the LocalSDP in the first trigger
(LI_T3 ActivateTask) and the RemoteSDP in the second trigger (LI_T3
ActivateTask).
The CC-POI is expected to populate the SDP Session Description field of X3 PDU
with the SDP information received in the LocalSDP, for the xCC that represent
the incoming media streams destined to the IP address and UDP port number
specified as the target identifiers.
The CC-POI is expected to populate the SDP Session Description field of X3 PDU
with the SDP information received in the RemoteSDP, for the xCC that represent
the outgoing media streams. In the case where TriggerScope value is
\"Bidirectional\", the outgoing media streams will be from the IP address and
UDP port number specified as the target identifiers. In the case where
TriggerScope value is \"Unidirectional\", the outgoing media streams will be
destined to the IP address and UDP port number specified as the target
identifiers.
###### 7.12.5.2.2.3 CC-POI in MRFP
The CC-TF present in the AS/MRFC shall send a trigger to the CC-POI present in
the MRFP using the ActivateTask message over the LI_T3 interface for an
intercepted IMS session (as determined according to the clause 7.12.2.8) that
requires the CC interception when the following occurs:
\- The AS/MRFC that has the CC-TF receives the acknowledgement (i.e. H.248
Reply) to the H248: Add Context from the MRFP.
When the media streams are asymmetric, the CC-TF present in the AS/MRFC shall
send a second trigger to the CC-POI present in the MRFP using the ActivateTask
message over the LI_T3 interface to intercept the media in the reverse
direction when the following occur:
\- When the SDP offer is received, the AS/MRFC receives the acknowledgement
(i.e. H.248 Reply) to the H.248: Add Context from the MRFP. The H.248: Add
Context is sent when the SIP message that contains the SDP offer is handled.
This happens at the same time the first trigger (LI_T3 ActivateTask) is sent.
\- When the SDP answer is received, the AS/MRFC receives the acknowledgement
(i.e. H.248 Reply) to the H.248 Mod Context from the MRFP. The H.248: Mod
Context is sent when the SIP message that contains the SDP answer is handled.
For a conferencing scenario, the AS/MRFC is expected to send the H.248: Add
Context to the MRFP when it handles a SIP message that includes a Conference
Factory URI in the Request URI field. Only one LI_T3 ActivateTask is required
to intercept the media for a conference.
Additionally, in support of the mid-session interception, the CC-TF present in
the AS/MRFC shall send a trigger to the CC-POI present in the MRFP using the
ActivateTask message over the LI_T3 interface when the following occur:
\- The CC-TF present in the AS/MRFC receives an ActivateTask from the LIPF
over LI_X1 with CC interception required, when an incoming IMS session to the
target identifier included in the LI_X1 ActivateTask was redirected to voice
mail server with an already established SDP offer and possibly SDP answer as
well.
\- The CC-TF present in the AS/MRFC receives an ActivateTask from the LIPF
over LI_X1 with CC interception required, when announcement or tones are being
applied to the caller of an incoming IMS session to the target identifier
included in the LI_X1 ActivateTask message.
\- The CC-TF present in the AS/MRFC receives an ActivateTask from the LIPF
over LI_X1 with CC interception required, when the user represented through
the target identifier included in the LI_X1 Activate Task is one of the
participants in an established conference session.
\- The CC-TF present in the AS/MRFC receives an ActivateTask from the LIPF
over LI_X1 with CC interception required, when the Conference URI associated
with an established conference session is included as a target identifier in
the LI_X1 Activate Task message.
When the media streams are asymmetric, the CC-TF present in the AS/MRFC shall
send a second trigger to the CC-POI present in the MRFP using the ActivateTask
message over the LI_T3 interface to intercept the media in the reverse
direction to any of the events except the last two in the above list occurs.
The details of LI_T3 ActivateTask are shown in table 7.12.5.2.2-1.
For the trigger (for the asymmetric media case, it is the first trigger):
\- The CC-TF shall use the IP address and UDP port number present in the local
descriptor part of the acknowledgement (i.e. H.248 Reply) to an H.248 Add
context message. The same IP address and the UDP port numbers are also present
in the SIP messages that carry the SDP offer or SDP answer (depending on
whether the AS/MRFC receives or sends the SDP offer).
For the second trigger that applies to asymmetric media case:
\- The CC-TF shall use the IP address and UDP port number present in the
remote descriptor part of the of the H.248 transacation that happens between
AS/MRFC and the MRFP.The same IP address and the UDP port numbers are also
present in the SIP messages that carry the SDP offer or SDP answer (depending
on whether the AS/MRFC receives or sends the SDP offer).
The values that the CC-TF sets for the PayloadDirectionAssignment and
TriggerScope shall be determined as described in tables 7.12.5.2.2-7 and
7.12.5.2.2-8.
Table 7.12.5.2.2-7: PayloadDirectionAssignment and TriggerScope values (target
identifier from local descriptor)
Service type PayloadDirectionAssignment TriggerScope
* * *
                 Not a non-local ID           Non-local ID   Conference URI   Symmetric media      Asymmetric media
Redirected NotDetermined FromTarget n/a \"Bidirectional\" \"Unidirectional\"
Conference NotDetermined n/a NotDetermined \"Bi-directional\" n/a
Table 7.12.5.2.2-8: PayloadDirectionAssignment and TriggerScope values (target
identifier from remote descriptor)
Service type PayloadDirectionAssignment TriggerScope
* * *
                 Not a non-local ID           Non-local ID   Conference URI   Symmetric media   Asymmetric media
Redirected NotDetermined ToTarget n/a n/a \"Unidirectional\" Conference
NotDetermined n/a n/a n/a n/a
Tables 7.12.5.2.2-5 and 7.12.5.2.2-6 (clause 7.12.5.2.2) shows how the CC-POI
is expected to set the Payload Direction field in the xCC based on the
PayloadDirectionAssignment and TriggerScope values received in the LI_T3
ActivateTask message.
For an intercepted conference session, the CC-POI shall perform the media
interception in a mixed mode including the media from all conference
participants. The concept of Payload Direction, therefore, does not apply to
the corresponding xCC.
The CC-TF present in the in the AS/MRFC shall follow the algorithm described
in clause 7.12.5.2.2.2 to populate the LocalSDP and RemoteSDP fields of LI_T3
ActivateTask.
###### 7.12.5.2.2.4 Activation of CC-POI when media interceptions are done at
both sides IMS media function
This is a special case where the media interception is done at both sides of
an IMS Media Function. In this case, the CC-POI would intercept the outgoing
media streams on both sides of IMS Media Function as shown in figure
7.12.5.2-2 below.
Figure 7.12.5.2.2-2: Media interception on both sides of the IMS Media
Function
The CC-POI would capture the media streams destined to the remote IP address
and UDP port number for the generation of xCC both sides. For this case, even
if the media streams are symmetric, the TriggerScope shall be set to
\"Unidirectional\". Accordingly, the CC-TF shall send the two triggers to CC-
POI using the ActivateTask message over the LI_T3 interface when the following
occur:
\- When the SDP offer is received from the side where the media interception
is done, the NF that has the CC-TF receives the acknowledgement (i.e. H.248
Reply) to the H.248: Add Context from the NF that has the CC-POI.
\- When the SDP answer is received from the side where the media interceptions
is done, the NF that has the CC-TF receives the acknowledgement (i.e. H.248
Reply) to the H.248: Mod Context from the NF that has the CC-POI.
\- The CC-TF receives an ActivateTask from the LIPF over LI_X1 with CC
interception required for an IMS session with an already established SDP offer
and possibly SDP answer as well. This process is part of a mid-session
activation of interception.
The details of ActivateTask sent from the CC-TF to the CC-POI over LI_T3 are
shown in table 7.12.5.2.2-1.
> The CC-TF shall use the IP address and UDP port number present in the remote
> descriptor part of the of the H.248 transaction that happens between the NF
> that has the CC-TF and the NF that has the CC-POI. The same IP address and
> the UDP port numbers are also present in the SIP messages that carry the SDP
> offer or SDP answer (depending on the SIP message direction and the session
> scenario).
The CC-TF shall set the PayloadDirectionAssignment value described in table
7.12.5.2.2-9:
Table 7.12.5.2.2-9: PayloadDirectionAssignment values
Target side First trigger Second trigger
* * *
On the side from which the SDP offer is received ToTarget FromTarget On the
side from which the SDP answer is received FromTarget ToTarget
NOTE: When the media is neither sent to nor received from the target (e.g.
call waiting scenario, held session), and when the CC-TF is aware of the
scenario, the value of \"NotDetermined\" is used as the
PayloadDirectionAssignment value. The CC-TF changes the
PayloadDirectionAssignment value using a LI_T3 ModifyTask (see clause
7.12.5.2.3) when the media is cross connected to the target (e.g. held session
is retrieved).
For this case, the CC-TF shall include the SDP information in the RemoteSDP of
TaskDetailsExtensions of LI_T3 ActivateTask for both triggers as described
below:
\- When the SDP offer is received at the NF that has the CC-TF (on the side
where the media interception is done), the CC-TF shall use the SDP information
received in the SDP offer of SIP message as RemoteSDP of the first LI_T3
trigger.
\- When the SDP answer is received at the NF that has the CC-TF (on the side
where the media interception is done), the CC-TF shall use the SDP information
received in the SDP answer of SIP message as RemoteSDP of the second LI_T3
trigger.
The CC-POI is expected to populate the SDP Session Description field of X3 PDU
with the SDP information received in the RemoteSDP, for the xCC that represent
the outgoing media streams on both sides. The outgoing media streams will be
destined to the IP address and UDP port number specified as the target
identifiers.
##### 7.12.5.2.3 ModifyTask
The ModifyTask message (s) that a CC-TF may send to a CC-POI shall include the
XID of the Task (s) created by the ActivateTask message(s) (see table
7.12.5.2.2-1). The details of the ModifyTask are as shown in the table
7.12.5.2.2-10:
Table 7.12.5.2.2-10: ModifyTask message to update the previous trigger the CC-
POI over LI_T3
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID Shall be same as in the
ActivateTask message (see 7.12.5.2.1). M TargetIdentifiers Shall be same as in
the ActivateTask message (see 7.12.5.2.1). M DeliveryType Set to \"X3Only\". M
ListOfDIDs Shall give the DID of the MDF3 to which the xCC should be
delivered. The delivery endpoint is configured using the CreateDestination
message as described in ETSI TS 103 221-1 [7] clause 6.3.1 prior to the task
activation. M CorrelationID Shall be same as in the ActivateTask message (see
7.12.5.2.1). M ProductID Shall be same as in the ActivateTask message (see
7.12.5.2.1). M TaskDetailsExtensions/SDP See table 7.12.5.2-2. M
* * *
The LI_T3 ModifyTask shall also use the same correlation ID, the same target
identifiers as used in the LI_T3 ActivateTask.
The examples of few scenarios that may necessitate the sending of a ModifyTask
over LI_T3 to the CC-POI are the following:
\- When the TriggerScope value used in the LI_T3 ActivateTask is
\"Bidirectional\", the SDP answer is received in a SIP message on the side
where the media interception is done. The SDP information received in the SDP
answer of SIP message shall be included as RemoteSDP in the LI_T3 ModifyTask.
The LI_T3 ModifyTask shall also include the LocalSDP which was previously sent
to the CC-POI in the LI_T3 ActivateTask message.
NOTE: The same SDP information is sent to the CC-POI when the TriggerScope
value is \"Unidirectional\" as RemoteSDP in a second LI_T3 ActivateTask
trigger (see clause 7.12.5.2.2.2).
\- The SDP is changed through a new SDP offer and answer during the session
establishment phase.
\- The cases such as IP address or UDP port numbers are being changed on an
established IMS session (using H.248 Modify Context (which may also include a
Add Request to an existing context)).
\- When a session is placed on hold, if the media interception sides have to
be switched (e.g. from access side of IMS-AGW to core network side of IMS-
AGW).
\- When a session is placed on hold or retrieved from hold, if the
PayloadDirectionAssignment value for the Target Identifier (associated with a
previously sent LI_T3 Activate Task or LI_T3 Modify Task) are to be changed.
\- When the media interception has to begin only when the media is cross-
connected within the NF that has the CC-POI (e.g. call waiting).
Usually, the LI_T3 ModifyTask is sent when the NF that has the CC-TF sends a
H.248: Modify Context (or a H.248 Add Request to an existing context) message
to the NF that has the CC-POI, if certain aspects of media interception
require to be changed.
As an alternate implementation, the CC-TF could use a LI_T3 DeactivateTask
(clause 7.12.5.2.4) and LI_T3 ActivateTask (clause 7.12.5.2.1) to handle the
held/retrieval scenario. Similarly, as an alternate implementation, the CC-TF
could delay the LI_T3 ActivateTask till the media is cut-through within the NF
that has the CC-POI in the call waiting scenario.
If two LI_T3 ActivateTask messages were used (asymmetric media stream case),
then two LI-T3 ModifyTask messages may be required (depending on the
scenario).
##### 7.12.5.2.4 DeactivateTask
The DeactivateTask message(s) that the CC-TF sends to the CC-POI shall include
the XID of the Task created by the associated ActivateTask message (see table
7.12.5.2.2-1).
The examples of few scenarios that may necessitate the sending of a
DeactivateTask over LI_T3 to the CC-POI are the following:
\- Media interception of an IMS session ends.
Usually, the LI_T3 DeactivateTask is sent when the NF that has the CC-TF sends
a H.248: Subtract Context to the NF that has the CC-POI which in turn normally
happens when the SIP BYE is handled. Also, as an alternate implementation, the
CC-TF could send a LI_T3 DeactivateTask when a session is placed on hold.
If two LI_T3 ActivateTask messages were used (asymmetric media stream case),
then two LI-T3 DeactivateTask messages are required.
### 7.12.6 Generation of xCC over LI_X3
#### 7.12.6.1 General
The CC-POI shall generate the xCC for the IMS media based on the LI_T3 trigger
received from the CC-TF. The CC-POI shall then deliver the xCC to the MDF3
(destination end point indicated in the LI_T3 trigger).
As described in clause 7.12.5.1, the CC-POI may reside in the IMS-AGW, TrGW,
IM-MGW, the MRFP or the LMISF.
#### 7.12.6.2 Media capture
The CC-POI shall use the H248ContextID received in the LI_T3 ActivateTask
trigger to match the Context ID seen in the H.248 transactions with the NF
that has the CC-TF.
In addition, the CC-POI shall use the IP address and UDP port number received
as the target identifiers in the LI_T3 trigger along with the TriggerScope
also received in the LI_T3 trigger to identify the media packets to be
intercepted for the generation of xCC using the following algorithm:
\- When the TriggerScope value received in the LI_T3 trigger is
\"Unidirectional\", the IP address and UDP port number received in the LI_T3
ActivateTask as target identifiers shall match the destination IP address and
UDP port number of the media packets.
\- When the TriggerScope value received in the LI_T3 trigger is
\"Bidirectional\", the IP address and UDP port number received in the LI_T3
ActivateTask as target identifiers shall match the destination IP address and
UDP port number of the incoming media packets and shall match the source IP
address and UDP port number of outgoing media packets in the reverse
direction.
The CC-POI shall expect to receive two LI_T3 ActivateTask triggers when the
value of TriggerScope is \"Unidirectional\". The two triggers provide the
information necessary to identify the media in two directions of the media
flow. The H248ContextID in the two triggers are the same. The CorrelationID in
the two triggers are the same.
The media packets destined to the local IP address and UDP port number are
referred to as incoming media packets. The media packets destined to the
remote IP address and UDP port number are referred to as outgoing media
packets.
#### 7.12.6.3 Payload format
The CC-POI shall set the payload format to indicate the appropriate payload
type (5 for IPv4 packet, 6 for IPv6 packet) as described in ETSI TS 103 221-2
[8] (clauses 5.4 and 5.4.13).
#### 7.12.6.4 Payload direction
The CC-POI shall set the payload direction to indicate the direction of the
media packets included in the xCC delivered to the MDF3 as described in ETSI
TS 103 221-2 [8] clause 5.2.6 and the following paragraph.
The PayloadDirectionAssignment field received in the LI_T3 ActivateTask
message instructs the CC-POI how to populate the Payload Direction for each
xCC PDU that it generates. If an intercepted media stream (i.e. IP packet) is
destined for the IP address and port given in the LI_T3 ActivateTask message,
the CC-POI shall set the Payload Direction of the xCC packet to the value that
has the same meaning as the value given in the PayloadDirectionAssignment
field. For an intercepted IP packet travelling in the other direction, the CC
POI should use the opposite direction value. Specific instructions on how to
set the xCC Payload Direction field for given combinations of IP packet
direction and TriggerScope value are given in table 7.12.6.4-1 below.
7.12.6.4-1: Payload direction value in the xCC
+----------------+----------------+----------------+----------------+ | TriggerScope | PayloadDirec | RTP stream | | | | tionAssignment | (media stream) | | | (LI_T3 | | direction | | | trigger) | (LI_T3 | | | | | trigger) | | | +================+================+================+================+ | | | Media to the | Media from the | | | | LI_T3 target | LI_T3 target | | | | identifier | identifier | +----------------+----------------+----------------+----------------+ | Bidirectional | FromTarget | \"3\" from the | \"2\" to the | | | | target | target | +----------------+----------------+----------------+----------------+ | | ToTarget | \"2\" to the | \"3\" from the | | | | target | target | +----------------+----------------+----------------+----------------+ | | NotDetermined | \"5\" not | \"5\" not | | | | applicable to | applicable to | | | | this xCC | this xCC | +----------------+----------------+----------------+----------------+ | Unidirectional | FromTarget | \"3\" from the | n/a | | | | target | | +----------------+----------------+----------------+----------------+ | | ToTarget | \"2\" to the | n/a | | | | target | | +----------------+----------------+----------------+----------------+ | | NotDetermined | \"5\" not | n/a | | | | applicable to | | | | | this xCC | | +----------------+----------------+----------------+----------------+
NOTE: When the TriggerScope value is \"Unidirectional\", two LI_T3 triggers
are received from the CC-TF and in this case, the CC-POI sets the Payload
Direction field separately according to the PayloadDirectionAssignment
received in the corresponding LI_T3 trigger.
In some session scenarios, the media packets destined to the IP address and
UDP port number specified as target identifiers in the LI_T3 Activate Task may
not be delivered to the intercept target (e.g. call waiting scenario, hold
scenario). When the CC-TF is aware of this, it would have used the value
\"NotDetermined\" as the PayloadDirectionAssignment field.
When the xCC is delivered in a combined form (e.g. conference), independent of
the PayloadDirectionAssignment value received in the LI_T3 Activate Task, the
CC-POI shall use the Payload Direction value 4: _sent to and received from the
target._
#### 7.12.6.5 SDP session description
The CC-POI shall generate the SDP Session Description field (as specified in
ETSI TS 103 221-2 [8] clause 5.3.23) of xCC from the the LocalSDP and
RemoteSDP received in the LI_T3 trigger from the CC-TF as described below.
When the TriggerScope value is \"Bidirectional\", the CC-POI may receive the
Local SDP and RemoteSDP in one LI_T3 trigger or in two separate LI_T3
triggers. When the TriggerScope value is \"Unidirectional\", the Local SDP and
RemoteSDP are received in two separate triggers.
NOTE 1: When the TriggerScope value in the LI_T3 trigger is
\"Unidirectional\", the CC-TF includes LocalSDP in the LI_T3 trigger that has
the local IP address and UDP port number as target identifiers and RemoteSDP
in the LI_T3 trigger that has the remote IP address and the UDP port number as
the target identifiers.
NOTE 2: When the media interception is done at two sides of the IMS Media
Function, the CC-POI receives RemoteSDP in both LI_T3 triggers with the
TriggerScope value set to \"Unidirectional\".
The CC-POI shall include the LocalSDP in the SDP Session Description field of
the xCC generated from the incoming media packets. The CC-POI shall include
the RemoteSDP in the Session Description field of xCC from the outgoing media
media packets. Clause 7.12.6.2 describes how the CC-POI identifies the
incoming and outgoing media packets.
NOTE 3: The LocalSDP provides the SDP information (e.g. codec information)
expected by the IMS Media Function that has the CC-POI. The media packets sent
by the remote end of the media flow are based on this SDP information.
Therefore, the LocalSDP is associated to the incoming media packets.
NOTE 4: The RemoteSDP address provides the SDP information (e.g. codec
information) expected by the remote end of the media flow. The media packets
sent to that remote end of the media flow are based on this SDP information.
Therefore, the RemoteSDP is associated to the outgoing media packets.
The SDP Session Description field shall be included in the xCC each time a new
LocalSDP or RemoteSDP is received in the LI_T3 trigger from the CC-TF.
#### 7.12.6.6 Additional XID related information
The CC-POI may use the Additional XID Related Information attribute to
facilitate efficient delivery of xCC, as specified in ETSI TS 103 221-2 [8]
clause 5.3.22.
### 7.12.7 Generation of IRI over LI_HI2
#### 7.12.7.1 General
When an xIRI is received over LI_X2 from the IRI-POI, the MDF2 shall send the
IRI message over LI_HI2 according to clause 5.5.2 of the present document
without undue delay.
The IRI message shall contain a copy of the relevant record received from
LI_X2. The record may be enriched by other information available at the MDF2
(e.g. additional location information).
The timeStamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the time present in the timestamp field of the xIRI.
The threeGPP33128DefinedIRI field (see ETSI TS 102 232-7 [10] clause 15) shall
be populated with the BER-encoded IRIPayload.
IRI messages associated with the same IMS session shall have the same CIN (see
ETSI TS 102 232-1 [9] clause 5.2.4).
The IRI type parameter (see ETSI TS 102 232-1 [9] clause 5.2.10) shall be
included and coded according to table 7.12.7.1-1.
Table 7.12.7.1-1: IRI type for IRI messages
Record type **IRI Type**
* * *
IMSMessage REPORT StartOfInterceptionForActiveIMSSession REPORT
IMSCCUnavailable REPORT
#### 7.12.7.2 Handling of multiple instances of list of mediation details
The MDF2 may have to deliver IRI messages to more than one LEMFs when more
than one instances of ListOfMediationDetails are associated with a task (i.e.
XID) provisioned at the MDF2.
The MDF2 shall populate the LIID field in the IRI messages delivered over the
LI_HI2 accordingly.
#### 7.12.7.3 Mid-session activation for additional warrants at MDF2
When a new warrant is to be activated on a target identity (i.e. the
associated IMS user is already the target of interception due to another
warrant), the LIPF may use the same XID for the new warrant (e.g. when there
is no need to receive two separate copies of xIRI messages over LI_X2). In
this case, the LIPF may activate the new warrant only at the MDFs using an
LI_X1 ModifyTask message with a new instance of ListOfMediationDetails.
The MDF2 that receives a LI_X1 ModifyTask with a new instance of
ListOfMediationDetails shall be able to generate and deliver the IRI message
containing the StartOfInterceptionForActiveIMSSession record to the LEMF as
represented in the new instance of ListOfMediationDetails without receiving a
corresponding xIRI from the IRI-POI. The MDF2 shall generate and deliver such
an IRI message for each of the established IMS session legs to the LEMF
represented within the ListOfMediationDetails.
The timeStamp field of the ETSI TS 102 232-1 [9] PSHeader structure shall be
set to the present time known to the MDF2.
The payload of the StartOfInterceptionForActiveIMSSession record is specified
in table 7.12.4.2-3 (see also clause 7.12.7.1).
#### 7.12.7.4 Location reporting
The MDF2 shall include the location information in the IRI messages sent over
the LI_HI2 according to the service scoping received within the
ListOfMediationDetails of the LI_X1 ActivateTask. For example, if service
scoping does not allow the reporting of location to an LEMF, then the MDF2
shall not copy the location information if received in an xIRI to the IRI
message sent to that LEMF.
The MDF2 shall also remove the location information (e.g. PANI header) from
the SIP message contents included as a part of the IRI message, when the
service scoping does not allow the reporting of location to the LEMF.
### 7.12.8 Generation of CC over LI_HI3
#### 7.12.8.1 General
When xCC is received over LI_X3 from a CC-POI, the MDF3 shall deliver the CC
over LI_HI3 to the LEMF according to the clause 5.5.3 of the present document
without undue delay.
The MDF3 shall populate the threeGPP33128DefinedCC field with a CCPayload
structure containing IMSCCPDU. The IMSCCPDUPayload shall contain the IPv4 or
IPv6 packet received over LI_X3.
The MDF3 shall populate the timeStamp field of the ETSI TS 102 232-1 [9]
PSHeader structure of CC with the xCC timeStamp and the Payload Direction of
the CCPayload structure to reflect the value received on xCC. The LIID and CID
fields shall correctly reflect the target identity and communication session
to which the CC belongs.
#### 7.12.8.2 Handling of multiple instances of list of mediation details
The MDF3 may have to deliver the received xCC to more than one LEMFs when more
than one instances of ListOfMediationDetails are associated with a task (i.e.
XID) provisioned at the MDF3. The MDF3 shall populate the LIID field in the CC
delivered over the LI_HI3 accordingly.
#### 7.12.8.3 Handling of additional XID related information
In addition to the XID present in the XID field of xCC, the MDF3 shall deliver
a copy of the CC to the LEMFs represented in one or more instances of
ListOfMediationDetails associated with the XID values present in the
Additional XID Related Information received in the xCC.
#### 7.12.8.4 SDP session description
The MDF3 shall deliver the SDP session description received in the xCC over
LI_X3 using the SDPInfo element of the IMSCCPDU to the LEMF over LI_HI3. This
shall be done each time the SDP Session Description is present on the xCC.
#### 7.12.8.5 Mid-session activation for additional warrants at MDF3
When a new warrant is to be activated on a target identity (i.e. the
associated IMS user is already the target of interception due to another
warrant), the LIPF may use the same XID for the new warrant (e.g. when there
is no need to receive two separate copies of xCC over LI_X3). In this case,
the LIPF may activate the new warrant only at the MDFs using an LI_X1
ModifyTask message with a new instance of ListOfMediationDetails.
The MDF3 that receives a LI_X1 ModifyTask with a new instance of
ListOfMediationDetails, shall deliver the CC to the LEMF represented in this
new instance of ListOfMediationDetails upon the reception of next xCC from the
CC-POI.
7.12.8.6 Media handling at the MDF and LEMF
The MDF and LEMF perform protocol level correlation between intercepted
signalling and media. LI_T3 ensures that the SDP in the intercepted SIP
signalling or in LI_X3 matches the IP/UDP destination IP-address and port for
every intercepted RTP stream.
In a scenario where NAT is used, the protocol level correlation may not be
possible. In all other scenarios the implementation shall ensure that it is.
To support the interception scenario where transmission of CC occurs before
the IRI, the LEMF may use SDP Session Description field in the CC to process
the media.
## 7.13 RCS
### 7.13.1 Provisioning over LI_X1
#### 7.13.1.1 General
If the warrant is for IRI only, the IRI-POI and IRI-TF in the RCS Servers and
the IRI-POI in the HTTP Content Server and the S-CSCF shall be provisioned in
accordance with clause 7.13.1.2.
If the warrant is for IRI and CC, then the IRI-POI, IRI-TF, CC-POI and CC-TF
in the RCS Servers defined in TS 33.127 [5] clause 7.13.2.1 (see RCS
definition in GSMA RCC.07 [78]) and the IRI-POI and the CC-POI in the HTTP
Content Server and S-CSCF shall be provisioned in accordance with clause
7.13.1.2.
In both cases, the MDF2 shall be provisioned in accordance with clause
7.13.1.3, and the MDF3 shall be provisioned in accordance with clause
7.13.1.4.
The POIs in the HTTP content server may be provisioned directly by the LIPF as
described in clause 7.13.1.2. or may be triggered by the TFs in the RCS Server
as described in clause 7.13.2.
#### 7.13.1.2 Provisioning of the POIs and TFs in the RCS Server and the POIs
in the HTTP Content Server and S-CSCF by the LIPF
The IRI-POI. CC-POI. IRI-TF and CC-TF present in the RCS Server and the IRI-
POI and CC-POI in the HTTP Content Server and S-CSCF are provisioned over
LI_X1 by the LIPF using the X1 protocol as described in clause 5.2.2.
The POIs and TFs in the RCS Server and the IRI-POIs in the S-CSCF shall
support the following target identifier formats in the ETSI TS 103 221-1 [7]
messages (or equivalent if ETSI TS 103 221-1 [7] is not used).
\- IMPU.
\- IMPI.
\- IMEI.
\- PEIIMEI.
The POIs in the HTTP Content Server shall support the following additional
target identifier formats in the ETSI TS 103 221-1 [7] messages (or equivalent
if ETSI TS 103 221-1 [7] is not used).
\- SIPURI.
\- TELURI.
\- GPSIMSISDN.
\- GPSINAI.
\- IMSI.
\- SUPIIMSI.
\- SUPINAI.
\- Email Address.
Table 7.13.1.2-1 shows the minimum details of the LI_X1 ActivateTask message
used for provisioning the IRI-POI, CC-POI, IRI-TF and CC-TF in the RCS Servers
and the IRI-POI and CC-POI in the HTTP Content Server and S-CSCF.
Table 7.13.1.2-1: ActivateTask message for the IRI-POI, CC-POI, IRI-TF and CC-
TF in the RCS Servers and the IRI-POI and CC-POI in the HTTP Content Server
and S-CSCF
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID XID assigned by LIPF.
If the CC-TF or IRI-TF is also being tasked for the same interception, the
same XID shall be used. The same XID shall be used at the RCS Servers, the
S-CSCF and the HTTP Content Server for the same interception. M
TargetIdentifiers One or more of the target identifiers listed in the
paragraphs above. M DeliveryType Set to "X2Only", "X3Only" or "X2andX3" as
needed to meet the requirements of the warrant. (NOTE: \"X2Only\" for IRI-POI,
IRI-TF and \"X3Only\" for CC-TF and CC-POI can also be also be used). M
ListOfDIDs Delivery endpoints of LI_X2 or LI_X3. These delivery endpoints
shall be configured using the _CreateDestination_ message as described in ETSI
TS 103 221-1 [7] clause 6.3.1 prior to first use. M ListOfServiceTypes Shall
be included when the task should only intercept specific CSP service types as
described in clause 5.2.4. This parameter is defined in ETSI TS 103 221-1 [7],
clause 6.2.1.2, table 4. C
* * *
#### 7.13.1.3 Provisioning of the MDF2
The MDF2 listed as the delivery endpoint for xIRI generated by the IRI-POI in
the RCS Servers, the IRI-POI in the HTTP Content Server, or the IRI-POI in the
S-CSCF shall be provisioned over LI_X1 by the LIPF using the X1 protocol as
described in clause 5.2.2. Table 7.13.1.3-1 shows the minimum details of the
LI_X1 ActivateTask message used for provisioning the MDF2.
The MDF2 shall support the following target identifier formats in the ETSI TS
103 221-1 [7] messages (or equivalent if ETSI TS 103 221-1 [7] is not used):
\- IMPU.
\- IMPI.
\- IMEI.
\- GPSIMSISDN.
\- GPSINAI.
\- IMSI.
\- SUPIIMSI.
\- SUPINAI.
\- Email Address.
Table 7.13.1.3-1: ActivateTask message for MDF2
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID Same XID used by the
LIPF for provisioning the LI functions of the RCS Servers, the S-CSCF and the
HTTP Content Servers for this intercept. M TargetIdentifiers One or more of
the target identifiers listed in the paragraph above. M DeliveryType Set to
"X2Only", "X3Only" or "X2andX3" as needed to meet the requirements of the
warrant. (Ignored by the MDF2). M ListOfDIDs Delivery endpoints of LI_HI2.
These delivery endpoints shall be configured using the _CreateDestination_
message as described in ETSI TS 103 221-1 [7] clause 6.3.1 prior to first use.
M ListOfMediationDetails Sequence of Mediation Details, see table 7.13.1.3-2.
M
* * *
Table 7.13.1.3-2: Mediation Details for MDF2
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O LIID Lawful Intercept ID
associated with the task. M DeliveryType Set to \"HI2Only\". M ListOfDIDs
Details of where to send the IRI for this LIID. Shall be included if deviation
from the ListofDIDs in the ActivateTask message is necessary. If included, the
ListOfDIDs in the Mediation Details shall be used instead of any delivery
destinations authorised by the ListOfDIDs field in the ActivateTask Message. C
ServiceScoping Shall be included to Identify the service(s) and associated
service-related delivery settings for this LIID. May include more than one
instance of this parameter to allow for different combinations of
subparameters associated with a single LIID. This parameter is defined in ETSI
TS 103 221-1 [7] Annex C table C.2. C
* * *
#### 7.13.1.4 Provisioning of the MDF3
The MDF3 listed as the delivery endpoint for the xCC generated by the CC-POI
in the RCS Servers, the CC-POI in the HTTP Content Servers and the CC-POI in
the S-CSCF shall be provisioned over LI_X1 by the LIPF using the X1 protocol
as described in clause 5.2.2. Table 7.13.1.4-1 shows the minimum details of
the LI_X1 ActivateTask message used for provisioning the MDF3.
The MDF3 shall support the following target identifier formats in the ETSI TS
103 221-1 [7] messages (or equivalent if ETSI TS 103 221-1 [7] is not used):
\- IMPU.
\- IMPI.
\- IMEI.
\- GPSIMSISDN.
\- GPSINAI.
\- IMSI.
\- SUPIIMSI.
\- SUPINAI.
\- EmailAddress.
Table 7.13.1.4-1: ActivateTask message for MDF3
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID Same XID used by the
LIPF for provisioning the POIs, TFs of the RCS Servers and the POIs of the
HTTP Content Servers and the S-CSCF. M TargetIdentifiers One or more of the
target identifiers listed in the paragraph above. M DeliveryType Set to
"X2Only", "X3Only" or "X2andX3" as needed to meet the requirements of the
warrant (Ignored by the MDF3). M ListOfDIDs Delivery endpoints of LI_HI3 or
LI_MDF. These delivery endpoints shall be configured using the
_CreateDestination_ message as described in ETSI TS 103 221-1 [7] clause 6.3.1
prior to first use. M ListOfMediationDetails Sequence of Mediation Details,
see table 7.13.1.4-2. M
* * *
Table 7.13.1.4-2: Mediation Details for MDF3
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O LIID Lawful Intercept ID
associated with the task. M DeliveryType Set to \"HI3Only\". M ListOfDIDs
Details of where to send the CC for this LIID. Shall be included if deviation
from the ListofDIDs in the ActivateTask message is necessary. If included, the
ListOfDIDs in the Mediation Details shall be used instead of any delivery
destinations authorised by the ListOfDIDs field in the ActivateTask Message. C
ServiceScoping Shall be included to Identify the service(s) and associated
service-related delivery settings for this LIID. May include more than one
instance of this parameter to allow for different combinations of
subparameters associated with a single LIID. This parameter is defined in ETSI
TS 103 221-1 [7] Annex C table C.2. C
* * *
### 7.13.2 Triggering of the IRI-POI and CC-POI in the HTTP Content Server
#### 7.13.2.1 Triggering of the IRI-POI in the HTTP Content Server over LI_T2
##### 7.13.2.1.1 LI_T2 interface Specifics
In order to allow the IRI-POI in the HTTP content server to detect all events
related to files uploaded or downloaded by a target, the IRI-TF in the RCS
Server sends a trigger to the IRI-POI present in the HTTP Content Server with
the necessary information over the LI_T2 interface.
When the IRI-TF in the RCS Server detects that a file is being uploaded or
downloaded by a target UE it shall send an activation message to the IRI-POI
in the HTTP Content Server over the LI_T2 interface. The activation message
shall contain the correlation identifiers that the IRI-POI in the HTTP Content
Server shall use with the xIRI. This can be achieved by sending an
ActivateTask message as defined in ETSI TS 103 221-1 [7] clause 6.2.1 with the
following details.
Table 7.13.2.1-1: ActivateTask message from the IRI-TF in the RCS Server for
the IRI-POI in the HTTP Content Server
+-----------------------------+-----------------------------+-------+ | ETSI TS 103 221-1 [7] | Description | M/C/O | | field name | | | +-----------------------------+-----------------------------+-------+ | XID | XID assigned by LIPF. If | M | | | the CC-TF or IRI-TF is also | | | | being tasked for the same | | | | interception, the same XID | | | | shall be used. The same XID | | | | shall be used at the RCS | | | | Servers, the S-CSCF and the | | | | HTTP Content Server for the | | | | same interception. | | +-----------------------------+-----------------------------+-------+ | TargetIdentifiers | File detection criteria as | M | | | determined by the IRI-TF in | | | | the RCS Server, which | | | | enables the IRI-POI in the | | | | HTTP Content Server to | | | | isolate target files. The | | | | IRI-POI in the HTTP Content | | | | Server shall support the | | | | identifier types given in | | | | table 7.13.2.1-2. | | | | | | | | NOTE: This value is the | | | | target identifier for the | | | | IRI-POI in the HTTP Content | | | | Server and may be different | | | | from the target identifier | | | | specified in the warrant. | | +-----------------------------+-----------------------------+-------+ | DeliveryType | Set to \"X2Only\". | M | +-----------------------------+-----------------------------+-------+ | ListOfDIDs | Delivery endpoints for | M | | | LI_X2. These delivery | | | | endpoints shall be | | | | configured by the IRI-TF in | | | | the RCS Server using the | | | | CreateDestination message | | | | as described in ETSI TS 103 | | | | 221-1 [7] clause 6.3.1 | | | | prior to first use. | | +-----------------------------+-----------------------------+-------+ | CorrelationID | Correlation ID to assign to | M | | | xIRI generated by the | | | | IRI-POI in the HTTP Content | | | | Server. This field is | | | | populated with the same | | | | CorrelationID the IRI-POI | | | | in the RCS Server uses for | | | | the associated xIRI. | | +-----------------------------+-----------------------------+-------+ | ProductID | Shall be set to the XID of | M | | | the Task Object associated | | | | with the interception at | | | | the IRI-TF. This value | | | | shall be used by the | | | | IRI-POI in the HTTP Content | | | | Server to fill the XID of | | | | X2 messages. | | +-----------------------------+-----------------------------+-------+ | ListOfServiceTypes | Shall be included when the | C | | | task should only intercept | | | | specific CSP service types | | | | as described in clause | | | | 5.2.4. This parameter is | | | | defined in ETSI TS 103 | | | | 221-1 [7], clause | | | | 6.2.1.2, table 4. | | +-----------------------------+-----------------------------+-------+
Table 7.13.2.1-2: Target Identifier Types for LI_T2
* * *
Identifier type Owner ETSI TS 103 221-1 [7] TargetIdentifier type Definition
RCS Content URI (See Note) 3GPP TargetIdentifierExtension / RCSContentURI
RCSContentURI (see XSD schema) NOTE: If the TargetIdentifier used is an RCS
Content URI, only one RCS Content URI shall be included per ActivateTask
message.
* * *
#### 7.13.2.2 Triggering of the CC-POI in the HTTP Content Server over LI_T3
##### 7.13.2.2.1 LI_T3 interface Specifics
To support the use-cases where the IRI-POI in the HTTP Content Server does not
get the identity of the user involved in the file-transfer (and therefore, the
CC-POI in the HTTP Content Server cannot perform the intereption based on the
target identity provisioned by the LIPF), the CC-TF present in the RCS Server
sends a trigger to the CC-POI present in the HTTP Content Server. When the CC-
TF in the RCS Server detects that a file is being uploaded or downloaded by a
target UE, it shall send an activation message to the CC-POI in the HTTP
Content Server over the LI_T3 interface. The activation message shall contain
the correlation identifiers that the CC-POI in the HTTP Content Server shall
use with the xCC. This can be achieved by sending an ActivateTask message as
defined in ETSI TS 103 221-1 [7] clause 6.2.1 with the following details.
Table 7.13.2.2-1: ActivateTask message from the CC-TF in the RCS Server for
the CC-POI in the HTTP Content Server
* * *
ETSI TS 103 221-1 [7] field name Description M/C/O XID XID assigned by LIPF.
If the CC-TF or IRI-TF is also being tasked for the same interception, the
same XID shall be used. The same XID shall be used at the RCS Servers, the
S-CSCF and the HTTP Content Server for the same interception. M
TargetIdentifiers File detection criteria as determined by the CC-TF in the
RCS Server, which enables the CC-POI in the HTTP Content Server to isolate
target files. The CC-POI in the HTTP Content Server shall support the
identifier types given in table 7.13.2.1-2. M DeliveryType Set to "X3Only". M
ListOfDIDs Delivery endpoints for LI_X3. These delivery endpoints shall be
configured by the CC-TF in the RCS Server using the CreateDestination message
as described in ETSI TS 103 221-1 [7] clause 6.3.1 prior to first use. M
CorrelationID Correlation ID to assign to xCC generated by the CC-POI in the
HTTP Content Server. This field is populated with the same CorrelationID the
IRI-POI in the RCS Server uses for the associated xIRI. M ProductID Shall be
set to the XID of the Task Object associated with the interception at the CC-
TF. This value shall be used by the CC-POI in the HTTP Content Server to fill
the XID of X3 messages. M ListOfServiceTypes Shall be included when the task
should only intercept specific CSP service types as described in clause 5.2.4.
This parameter is defined in ETSI TS 103 221-1 [7], clause 6.2.1.2, table 4. C
* * *
### 7.13.3 Generation of xIRI at IRI-POI in the RCS Server over LI_X2
#### 7.13.3.1 General
The IRI-POI present in the RCS Servers shall send xIRI over LI_X2 for the
events listed in TS 33.127 [5] clause 7.13.4, the details of which are
described in the following clauses.
#### 7.13.3.2 Registration
The xIRI containing an RCSRegistration record shall be generated when the IRI-
POI in the S-CSCF or in an RCS Server detects that an RCS target matching one
of the RCS identifiers, provided via LI_X1 has registered, re-registered or
de-registered for RCS services. Accordingly, the IRI-POI in the RCS Server
generates the xIRI when the following event is detected:
\- When the IRI-POI is located in the S-CSCF:
\- If the S-CSCF uses third-party registrations to notify the RCS Server when
a UE registers, when the S-CSCF receives a 200 OK from the RCS Server in
response to a third-party SIP REGISTER request registering, re-registering or
de-registering a target with the RCS Server.
\- If the S-CSCF is the NF responsible for handling RCS Registrations:
\- When the S-CSCF sends a 200 OK to a target in response to a SIP REGISTER
request that includes any of the service feature tags listed in GSMA RCC.07
[78] clause 2.4.4.1 table 3.
\- When the S-CSCF sends a 200 OK to a target in response to a SIP REGISTER
request for de-registration when the service features supported by the target
include any of the service features listed in GSMA RCC.07 [78] clause 2.4.4.1
table 3.
\- When the IRI-POI is located in the RCS Server:
\- When the RCS Server sends a 200 OK to a target in response to a SIP
REGISTER request that includes any of the service feature tags listed in GSMA
RCC.07 [78] clause 2.4.4.1 table 3.
\- When the RCS Server sends a 200 OK to a target in response to a SIP
REGISTER request for de-registration when the service features supported by
the target include any of the service features listed in GSMA RCC.07 [78]
clause 2.4.4.1 table 3.
#### 7.13.3.3 RCS Message
The IRI-POI present in the RCS Server shall generate an xIRI containing an
RCSMessage record when the IRI-POI present in the RCS Server detects that an
RCS target has sent or received an RCS message. In this specification, an RCS
message refers to any message sent or received in the context of pager mode
standalone messaging, large message mode messaging, 1-to-1 chat or group chat.
This xIRI is also generated when the target sends or receives a delivery
notification or display notification.
Accordingly, the IRI-POI in the RCS Server shall generate the RCSMessage xIRI
when it detects the following events:
\- The RCS Server receives a SIP MESSAGE from the target or destined to the
target, determined by the direction attribute present in the CPM Header, and:
\- The \"Contact\" or \"Accept-Contact\" header includes +g.3gpp.icsi-
ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.oma.cpm.msg\".
\- The SIP \"Content-Type\" header is \"message/cpim\".
\- The RCS Server receives an MSRP packet from the target or destined to the
target and:
\- The content of the MSRP packet is a CPIM (Common Presence and Instant
Messaging) object (see definition in IETF RFC 3862 [80]).
#### 7.13.3.4 Session establishment
The IRI-POI present in the RCS Server shall generate an xIRI containing an
RCSSessionEstablishment record when the IRI-POI in the RCS Server detects that
a SIP session has been established for a large message mode standalone message
delivery, a 1-to-1 chat session or a group chat session.
Accordingly, the IRI-POI in the RCS Server shall generate the
RCSSessionEstablishment xIRI when it detects the following events:
\- The RCS Server receives a SIP 200 OK from the target in response to a SIP
INVITE sent to the target with service feature tag +g.gsma.rcs.cpm.pager-large
or +g.3gpp.icsi-ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.oma.cpm.largemsg\"
in the SIP \"Contact\" header.
\- The RCS Server returns a SIP 200 OK to the target in response to a SIP
INVITE received from the target with service feature tag
+g.gsma.rcs.cpm.pager-large or +g.3gpp.icsi-ref=\"urn%3Aurn-7%3A3gpp-
service.ims.icsi.oma.cpm.largemsg\" in the SIP \"Contact\" header.
\- The RCS Server receives a SIP 200 OK from the target in response to a SIP
INVITE sent to the target with service feature tag +g.3gpp.icsi-
ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.oma.cpm.session\" in the SIP
\"Contact\" header.
\- The RCS Server returns a SIP 200 OK to the target in response to a SIP
INVITE received from the target with service feature tag +g.3gpp.icsi-
ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.oma.cpm.session\" in the SIP
\"Contact\" header.
\- The RCS Server receives a SIP 200 OK from the target in response to a SIP
INVITE sent to the target with service feature tag +g.3gpp.icsi-
ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.oma.cpm.filetransfer\" in the SIP
\"Contact\" header.
\- The RCS Server returns a SIP 200 OK to the target in response to a SIP
INVITE received from the target with service feature tag +g.3gpp.icsi-
ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.oma.cpm.filetransfer\" in the SIP
\"Contact\" header.
###### ## Annex A (normative): ASN.1 Schema for the Internal and External
Interfaces
The ASN.1 module describing the structures used for LI_X2, LI_X3, LI_HI2 and
LI_HI3 (\"TS33128Payloads\") is given in the file _TS33128Payloads.asn_ which
accompanies the present document.
###### ## Annex B (normative): LI Notification
Based on clause 5.6 of the present document, this annex defines a system of
management notification of LI system with the LI_HI4 interface.
The LI_HI4 interface shall be used to transport specific LI service O&M
information (referred to as LI Notification) from the CSP to the LEMF. The
individual parameters of the LI Notification message shall be coded using
ASN.1 and the basic encoding rules (BER). The delivery of LI Notification
shall be performed directly using the same mechanism as used for delivery of
IRI messages over LI_HI2 and CC over LI_HI3.
The LI Notification shall be used to send electronic notification to the LEMF
in the following cases:
1) after the activation of lawful interception;
2) after the deactivation of lawful interception;
3) after the modification of an active lawful interception.
Table B.1-1: LINotification message
* * *
**Field name** **Description** **M/C/O** notificationType Information on the
type of notification: activation, deactivation or modification M
deliveryInformation Delivery Information which has been decided by the LEA in
terms of delivery numbers, IP addresses for LI_HI2 and LI_HI3 O
appliedTargetID Target Identifier applied in the ADMF for the warrant O
appliedStartTime Start time applied to the ADMF for the warrant C
appliedEndTime End time applied to the ADMF for the warrant C
* * *
Conditional parameters shall be set as follows:
+---------------------------+---------------------------+-----------+ | **LI Activation | | | | Notification** | | | +---------------------------+---------------------------+-----------+ | **Field name** | **Description** | **M/C/O** | +---------------------------+---------------------------+-----------+ | notificationType | Activation | M | +---------------------------+---------------------------+-----------+ | appliedStartTime | Always present and | C | | | represents: | | | | | | | | The Start Date/Time in | | | | the warrant or, | | | | | | | | The Date/Time of the CSP | | | | activation in the ADMF | | | | or, | | | | | | | | The scheduled future | | | | Start Date/Time. | | +---------------------------+---------------------------+-----------+ | appliedEndTime | [Absence | C | | | means]{.underline} the | | | | interception has been | | | | activated with no | | | | predefined End Date/Time. | | | | | | | | [Presence | | | | means]{.underline} the | | | | End time is scheduled to | | | | be applied at that | | | | (future) time. | | +---------------------------+---------------------------+-----------+
* * *
**LI Modification Notification**  
**Field name** **Description** **M/C/O** notificationType Modification M
appliedStartTime Present and provides the new Start Date/Time if modified by
the LI Modification command C appliedEndTime Present and provides the new End
Date/Time if modified by the LI Modification command C
* * *
* * *
**LI Deactivation Notification**  
**Field name** **Description** **M/C/O** notificationType Deactivation M
appliedStartTime Absent C appliedEndTime Present and provides the actual End
Date/Time, e.g. timed stop as per initial warrant or as per new warrant, or as
pre-emptive audited stop from the LEA, or major LI failure. C
* * *
The individual notifications parameters shall be sent to the LEMF as soon as
possible with the lowest latency at least once (if available).
The MDF2/3 will deliver the LINotification message to LEMF.
###### ## Annex C (normative): XSD Schema for LI_X1 extensions
The XSD schema describing the extensions used for LI_X1 is given in the file
_urn_3GPP_ns_li_3GPPX1Extensions.xsd_ which accompanies the present document.
###### ## Annex D (informative): Drafting Guidance
# D.1 Introduction
This annex provides drafting guidance for contributors wishing to propose
changes to the present document.
# D.2 Drafting conventions
Table D.2-1: Drafting conventions
D.2.1 The details for each field, including a complete description of the
usage, format, cardinality and conditionality of that field, are given in the
prose in the main body of the document.
* * *
D.2.2 The field names used in the main body of the document match those used
in the ASN.1. D.2.3 ASN.1 comments are not used, except for to indicate where
to find a description of the field or structure in the main body of the
specification. D.2.4 If a field is made conditional, the condition for its
presence or absence is specified.
# D.3 Naming conventions
Table D.3-1: Naming conventions
D.3.1 To meet ASN.1 syntax rules, the first character of each ASN.1 field name
are lower-cased.
* * *
D.3.2 To meet ASN.1 syntax rules, the first character of an ASN.1 type name
are upper-cased. D.3.3 To meet ASN.1 syntax rules, the first character of a
field or a type name is not a number. D.3.4 Only the character ranges A-Z, a-z
and 0-9 are used in names. D.3.5 Names are be CamelCased, where the first
character of each word is upper-cased (except for the first character of the
name -- see rule D.3.1). D.3.6 Any acronyms in a name should be entirely
upper-cased (except for the first character of the name -- see rule D.3.1).
ExampleBadStructure ::= SEQUENCE
{
[F]{.underline}irstField [1] FirstFieldType, -- D.3.1 First letter of field is
upper case
secondField [2] [s]{.underline}econdFieldType, -- D.3.2 First letter of type
is lower case
[3]{.underline}rdField [3] [3]{.underline}rdFieldType, -- D.3.3 Names starts
with digit
fourth[-]{.underline}field [4] Fourth[_]{.underline}Field_Type, -- D.3.4 Names
include hyphen and underscore
fifth[f]{.underline}ield [5] Fifth[f]{.underline}ield[t]{.underline}ype, --
D.3.5 Names are not camelCased
m[sisdn]{.underline} [6] MSISDN, -- D.3.6 Acronyms in field name not wholly
upper-cased
mSISDN [7] M[sisdn]{.underline} -- D.3.6 Acronyms in type name not wholly
upper-cased
}
Figure 1 -- Naming convention counter-examples
# D.4 ASN.1 Syntax conventions
Table D.4-1: ASN.1 Syntax conventions
D.4.1 Modules are be defined with EXTENSIBILITY IMPLIED unless there is a
specific reason to limit extensibility.
* * *
D.4.2 The AUTOMATIC TAGS module directive is not used. D.4.3 SEQUENCE and
CHOICE tag numbers start at one. D.4.4 ENUMERATED tag numbers start at one.
D.4.5 Anonymous types are not used. Non-trivial fields are assigned their own
named type. D.4.6 Consideration should be given to making types re-usable and
independent of a particular release. Re-using or extending an existing type,
where the intent is similar, is preferable to creating a new type. D.4.7
Consideration should be given to making types extensible by declaring them as
a SEQUENCE or CHOICE where possible. D.4.8 Multiple smaller messages or
structures with fewer OPTONAL fields are preferred to larger structures with
many OPTIONAL fields, as this increases the ability of the ASN.1 schema to
enforce the intent of the specification. D.4.9 Field names, tag numbers, field
types and optional flags are be space-aligned where possible. An indent of
four spaces is used. D.4.10 Field and type names (when defining a type) are
not in bold. D.4.11 Braces are given their own line. D.4.12 OIDs containing a
version number are updated when the structure that uses the OID is changed,
even if the change is solely to correct a syntactic error. Other OIDs in the
same module need not be updated if they are not associated with structures
that have been changed. D.4.13 For backward compatibility, fields added to
existing SEQUENCE or SET are defined as OPTIONAL, irrespective of their M/C/O
designation in the main body of the specification.
ConformatModule
{itu-t(0) identified-organization(4) etsi(0) securityDomain(2)
lawfulIntercept(2) ... }
DEFINITIONS EXTENSIBILITY IMPLIED ::=
BEGIN
Structure1 ::= SEQUENCE
{
field1 [1] Field1,
field2 [2] Field2
}
Field1 ::= ENUMERATED
{
choice1(1),
choice2(2),
choice3(3)
}
Field2 ::= OCTET STRING
END
Figure 2 -- Syntax convention example
NonconformantModule
{itu-t(0) identified-organization(4) etsi(0) securityDomain(2)
lawfulIntercept(2) ... }
DEFINITIONS [AUTOMATIC TAGS]{.underline} ::= -- D.4.1 Not declared with
EXTENSIBILITY IMPLIED
\-- D.4.2 Declared AUTOMATIC TAGS
BEGIN
Structure1 ::= SEQUENCE [{]{.underline} -- D.4.11 Braces not given their own
line
field1 [[0]]{.underline} ::= [ENUMERATED]{.underline} -- D.4.3 SEQUENCE tags
don't start at 1
{ -- D.4.5 Anonymous type used
choice1[(0),]{.underline} -- D.4.4 ENUMERATED tag numbers don't start at 1
choice2(2),
choice3(3)
},
**[field2]{.underline}** [2] Field2 -- D.4.10 Field name is bold
}
**[Field2]{.underline}** ::= OCTET STRING -- D.4.10 Type names in definitions
is bold
END
Figure 3 -- Syntax convention counter-examples
###### ## Annex E (normative): XSD Schema for Identity Association
The XSD schema describing the extensions used for Identity Association is
given in the file _urn_3GPP_ns_li_3GPPIdentityExtensions.xsd_ which
accompanies the present document.
###### ## Annex F (normative): ASN.1 Schema for LI_XER messages
The ASN.1 schema describing the structures used for LI_XER is given in the
file _TS33128IdentityAssociation.asn_ which accompanies the present document.
###### ## Annex G (informative): LIPF logic
# G.1 Background
According to TS 33.126 [3] clause 6.4, the CSP is expected to only deliver
Interception Product relating to specific CSP services which are specified
implicitly or explicitly in the warrant. In other words, the CSP is expected
to perform the interception only for the services indicated in the warrant.
NOTE: The term \"interception\" used in this annex refers to the step that
involves actual capturing and then delivery of the Intercept Product to the
LEMF.
This annex considers the following possibilities in the analysis:
\- The intended target may have subscribed to only a specific service and in
this case, by default, the interception would apply only to such service when
specified in the warrant. The CSP network would provide the interception as
and when the service is accessed by the target.
\- The intended target may have subscribed to multiple services and in this
case, the interception would have to be done based on the service type(s)
specified in the warrant as and when CSP network detects that such services
are accessed by the target.
\- A NF may be involved in providing only a particular service and in this
case, by default, the interception performed by the POI present in that NF
would apply to such service when specified in the warrant.
\- A NF may be involved in providing multiple services and in this case, the
interception performed by the POI present in that NF would have to be based on
the service type applicable to the warrant.
\- There may be multiple warrants with differing service types active on a
target, in this case, all applicable services would have to be intercepted at
the POIs, and the MDFs would have to then deliver Interception Product based
on the service type (s) applicable to the warrant.
In supporting the above scenarios, as per clause 4.4 (of the present
document), the LIPF will have to provision the POIs, TFs and the MDF2/MDF3
according to the CSP service type(s) applicable to a warrant.
To cover all the scenarios mentioned above, the service type may have to be
part of LI provisioning data sent to the MDFs. Whether a service type will
have to be provisioned to the POIs and TFs as an indication will depend on the
services provided by the NFs that have such POIs and TFs.
In addition to the CSP service type, a few other factors present in the
warrant may influence the LIPF logic in provisioning the POIs, TFs and
MDF2/MDF3. Few examples are:
\- Delivery type.
\- LALS triggering.
\- CSP deployment options.
\- The target type (local Vs non-local ID).
For the target non-local ID, Voice and Messaging type of services are
supported in the present document. In this case, the other party communicating
with the target non-local ID happens to access the service provided by the
CSP.
This annex illustrates the LIPF logic through a series of flow-charts in
provisioning the POIs and the TFs. The provisioning aspect of MDF2/MDF3 are
not shown.
# G.2 Governing scenarios
With respect to the interception performed within the CSP network, there are
five scenarios:
1\. The target (or party communicating with a target non-local ID) is non-
roaming.
2\. The target (or party communicating with a target non-local ID) is outbound
roaming with HR.
3\. The target (or party communicating with a target non-local ID) is outbound
roaming with LBO.
4\. The target (or party communicating with a target non-local ID) is inbound
roaming with HR.
5\. The target (or party communicating with a target non-local ID) is inbound
roaming with LBO.
The scenario 4 is also referred to as N9HR or S8HR, depending on whether the
packet core is 5GC or EPC. As indicated clause G.1, a target can be a non-
local ID only when the service type is Voice or Messaging.
The same NF that provides an LI function may be present in one or more of the
above scenarios. The LIPF logic, even though may not be aware of the roaming
nature of a target, will have to accommodate the above five scenarios while
provisioning the LI functions.
# G.3 Top-level LIPF provisioning logic
The flow-chart in figure G.3-1 shows a top-level logic within the LIPF to
branch off into separate processes according to the service type defined in
the present document.
Figure G.3-1: Top-level view of LIPF logic in handling the service type
Based on the LI functionality defined in the present document:
\- For the service type of Data, it is assumed that the NFs in the packet core
network are involved and hence, provide the IRI and CC interception.
\- For the service type of Voice, it is assumed that the NFs in the IMS domain
are involved and hence, provide the IRI and CC interception.
\- For the service type of Messaging (that includes SMS and MMS), the NFs in
the packet core network, IMS or MMS Proxy Relay are involved and hence,
provide the IRI and CC interception. The interception of SMS has only the
IRIs.
\- For the service type of PTC, the PTC Server is involved and hence, provides
the IRI and CC interception.
\- For the service type of LALS, the LI-LCS Client provides the IRI
interception, and the CC interception does not apply to LALS.
The UDM and HSS are also the NFs that have the IRI-POI and the provisioning of
IRI-POI in UDM and HSS is independent of the service type indicated in the
warrant as long as the target is not indicated as a non-local ID.
# G.4 Data
## G.4.1 Scope of interception
For the service type of Data, the NFs present in the packet core network
provide the LI functions. This annex illustrates the LIPF logic for 5GC and
EPC as the two packet core networks.
The interception of service type of Data includes:
\- Delivery of IRI, or CC based on the delivery type indicated in the warrant.
\- When required, the delivery of packet data header reporting.
\- When required, the delivery of LALS reports based on the LALS triggering.
The CSP may have differing implementation options for the packet data header
reporting and LALS triggering.
In the case of EPC, the CSP may also have differing deployment options in
choosing the NFs (SGW-based Vs PGW-based) that provide the interception.
## G.4.2 Top-level view
When the target identifier is one or more of IMSI, IMEI, MSISDN, the LI
functions in EPC are provisioned. When the target identifier is one or more
variants of SUPI, PEI, GPSI, the LI functions in 5GC are provisioned.
Figure G.4-1 provides the top-level view of LIPF logic for the service type of
Data.
Figure G.4-1: Top-level view of LIPF logic for the service type Data
Within figure G.4-1, PEI collectively represents PEIIMEI and PEIIMEISV.
Likewise, SUPI represents SUPIIMSI and SUPINAI whereas GPSI represents
GPSIMISDN and GPSINAI.
## G.4.3 5GC
### G.4.3.1 The flow-chart
Figure G.4-2 shows the LIPF logic in provisioning the LI functions for the 5GC
for the service type of Data.
Figure G.4-2: LIPF logic for the service type Data in 5GC
For the delivery type of IRI + CC, the IRI-POIs and the CC-TFs are
provisioned. For the delivery type of IRI, the IRI-POIs and the IRI-TFs are
provisioned. For the delivery type of CC, the CC-TFs are provisioned.
### G.4.3.2 Interception
#### G.4.3.2.1 PDHR
There are two deployment options for the packet data header reporting. It is
expected that the CSP implements one of the two deployment options.
In PDHR option 1, the IRI-POI in the UPF (based on a trigger from IRI-TF
present in the SMF) generates the xIRI. Accordingly, the IRI-TFs in SMFs are
provisioned.
In PDHR option 2, the CC-POI present in the UPF (based on a trigger from CC-TF
present in the SMF) delivers the UP packets as xCC to the MDF3, which in turn,
forwards the same to the MDF2 and MDF2 would then generate the IRI messages
from the received xCC. Accordingly, the CC-TFs in SMFs, and the PDHR handling
function in MDF3 are provisioned.
#### G.4.3.2.2 LALS triggering
There are two deployment options for LALS triggering. It is expected that the
CSP implements one of the two deployment options.
In LALS triggering option 1, the LTF present in the host NF that has the
associated IRI-POI triggers the LI-LCS Client. Accordingly, the LTFs in AMFs
and SMFs are provisioned.
In LALS triggering option 2, the LTF present in the MDF2 triggers the LI-LCS
Client. Accordingly, the LTF in MDF2 is provisioned.
#### G.4.3.2.3 UDM
The UDM is expected to provide the IRI-POI functions in the HPLMN only.
#### G.4.3.2.4 Summary
Table G.4-1 provides the scope of NF domain that provides the IRI-POI/CC-
TF/CC-POI functions for the service type of Data in the 5GC for various
scenarios.
Table G.4-1: Scope of NF domain in 5GC providing the LI functions
NFs with LI function Non-roaming Roaming with LBO Roaming with HR
* * *
                                       VPLMN              HPLMN             VPLMN     HPLMN
UDM IRI-POI n/a IRI-POI n/a IRI-POI  
AMF IRI-POI IRI-POI n/a IRI-POI n/a  
SMF IRI-POI IRI-POI n/a IRI-POI IRI-POI  
SMF CC-TF CC-TF n/a CC-TF CC-TF  
UPF CC-POI CC-POI n/a CC-POI CC-POI  
PDHR Option 1 SMF IRI-TF IRI-TF n/a IRI-TF IRI-TF UPF IRI-POI IRI-POI n/a IRI-
POI IRI-POI Option 2 SMF CC-TF CC-TF n/a CC-TF CC-TF UPF CC-POI CC-POI n/a CC-
POI CC-POI MDF3 PDHR PDHR n/a PDHR PDHR LALS triggering Option 1 AMF LTF LTF
n/a LTF n/a SMF LTF LTF n/a LTF LTF Option 2 MDF2 LTF LTF n/a LTF LTF
NOTE 1: The use of \"n/a\" in the above table implies that the LI function is
not applicable to the NF for the indicated scenario.
NOTE 2: The LIPF is not aware of the above role played by the host NFs in
providing the LI functions.
NOTE 3: MDF2, MDF3 and LI-LCS Client which are also involved in providing the
LI functions are not shown in the tables above.
## G.4.4 EPC
### G.4.4.1 The flow-chart
Fgure G.4-3 shows the LIPF logic in determining the host NFs in EPC that have
the LI functions for the service type of Data.
Figure G.4-3: LIPF logic for the service type Data in EPC
For the delivery type of IRI + CC, the IRI-POIs, the CC-TFs and the CC-POIs
(when EPC is deployed without CUPS) are provisioned. For the delivery type of
IRI, the IRI-POIs and the IRI-TFs (when EPC is deployed with CUPS) are
provisioned. For the delivery type of CC, the CC-TFs and the CC-POIs (when EPC
is deployed without CUPS) are provisioned.
For the LI within the EPC, the CSP may deploy either an SGW-based interception
or a PGW-based interception. The LIPF logic in supporting the two deployment
options is illustrated in figure G.4-4.
Figure G.4-4: Two deployment options in EPC
The LIPF includes a parameter while provisioning the SGW/SGW-C and PGW/PGW-C.
To PGW/PGW-C, with the SGW based deployment option:
\- Provide LI functions only for the targets that are outbound roaming with
HR.
SGW/SGW-C, with the PGW based deployment option:
\- Provide LI functions only for the targets that are inbound roaming with HR.
The above parameter is needed to avoid both SGW/SGW-C and PGW/PGW-C end up
performing the interceptions for the same packet data session.
### G.4.4.2 Interception
#### G.4.4.2.1 PDHR
There are two deployment options for the packet data header reporting. It is
expected that the CSP implements one of the two deployment options.
In PDHR option 1, the IRI-POI present in the SGW-U/PGW-U (based on a trigger
from IRI-TF present in the SGW-C/PGW-C) or the IRI-POI present in the SGW/PGW
generates the xIRI. Accordingly, the IRI-TFs in SGW-C/PGW-C and IRI-POI in
SGW/PGW are provisioned.
In PDHR option-2, the CC-POI present in the SGW-U/PGW-U (based on a trigger
from CC-TF present in the SGW-C/PGW-C) or the CC-POI present in the SGW/PGW
delivers the UP packets as xCC to the MDF3, which in turn, forward the same to
the MDF2, and MDF2 would then would generate the IRI messages from the
received xCC. Accordingly, the CC-TF in SGW-C/PGW-C, CC-POI in SGW/PGW and the
PDHR handling function in MDF3 are provisioned.
#### G.4.4.2.2 LALS triggering
There are two deployment options for LALS triggering. It is expected that the
CSP implements one of the two deployment options.
In LALS triggering option 1, the LTF present in the host NF that has the
associated IRI-POI triggers the LI-LCS client. Accordingly, the LTFs in MME,
SGW, PGW, SGW-C and PGW-C (when EPC is deployed with CUPS) are provisioned.
In LALS triggering option 2, the LTF present in the MDF2 triggers the LI-LCS
Client. Accordingly, the LTF in MDF2 is provisioned.
#### G.4.4.2.3 SGW/PGW deployment options
For the IRI/CC generation, two deployment options are considered:
\- SGW-based.
\- PGW-based.
The CSP expected to implement one of the two options.
When SGW/SGW-C is provisioned, if the deployment option is PGW-based approach,
then the SGW/SGW-C does not perform an interception unless the target is
inbound roaming with HR. Similarly, when the PGW/PGW-C is provisioned, if the
deployment option is SGW-based approach, then the PGW/PGW does not perform the
interception unless the target is outbound roaming with HR.
#### G.4.4.2.4 HSS
The HSS is expected to provide the IRI-POI functions in the HPLMN only.
#### G.4.4.2.5 Summary
Table G.4-2 provides the scope of NF domain that provides the IRI-POI/CC-
TF/CC-POI functions for the service type of Data in the EPC for an SGW-based
deployment option.
Table G.4-2: Scope of NF domain in EPC providing the LI functions (SGW-based
deployment)NFs with LI function Non-roaming Roaming with LBO Roaming with HR
* * *
                                                                                                                               VPLMN              HPLMN             VPLMN     HPLMN
HSS IRI-POI n/a IRI-POI n/a IRI-POI  
MME IRI-POI IRI-POI n/a IRI-POI n/a  
SGW IRI-POI IRI-POI n/a IRI-POI n/a  
SGW CC-POI CC-POI n/a CC-POI n/a  
PGW n/a n/a n/a n/a IRI-POI  
PGW n/a n/a n/a n/a CC-POI  
SGW-C IRI-POI IRI-POI n/a IRI-POI n/a  
SGW-C CC-TF CC-TF n/a CC-TF n/a  
SGW-U CC-POI CC-POI n/a CC-POI n/a  
PGW-C n/a n/a n/a n/a IRI-POI  
PGW-C n/a n/a n/a n/a CC-TF  
PGW-U n/a n/a n/a n/a CC-POI  
PDHR Option 1 SGW IRI-POI IRI-POI n/a IRI-POI n/a SGW-C IRI-TF IRI-TF n/a IRI-
TF n/a SGW-U IRI-POI IRI-POI n/a IRI-POI n/a PGW n/a n/a n/a n/a IRI-POI PGW-C
n/a n/a n/a n/a IRI-TF PGW-U n/a n/a n/a n/a IRI-POI Option 2 SGW CC-POI CC-
POI n/a CC-POI n/a SGW-C CC-TF CC-TF n/a CC-TF n/a SGW-U CC-POI CC-POI n/a CC-
POI n/a PGW n/a n/a n/a n/a CC-POI PGW-C n/a n/a n/a n/a CC-TF PGW-U n/a n/a
n/a n/a CC-POI MDF3 PDHR PDHR n/a PDHR PDHR LALS triggering Option 1 SGW LTF
LTF n/a LTF n/a SGW-C LTF LTF n/a LTF n/a PGW n/a n/a n/a n/a LTF PGW-C n/a
n/a n/a n/a LTF Option 2 MDF2 LTF LTF n/a LTF LTF
Table G.4-3 provides the scope of NF domain that provides the IRI-POI/CC-
TF/CC-POI functions for the service type of Data in the EPC for a PGW-based
deployment option.
Table G.4-3: Scope of NF domain in EPC providing the LI functions (PGW-based
deployment)
NFs with LI function Non-roaming Roaming with LBO Roaming with HR
* * *
                                       VPLMN              HPLMN             VPLMN     HPLMN
HSS IRI-POI n/a IRI-POI n/a IRI-POI  
MME IRI-POI IRI-POI n/a IRI-POI n/a  
SGW n/a n/a n/a IRI-POI n/a  
SGW n/a n/a n/a CC-POI n/a  
PGW IRI-POI IRI-POI n/a n/a IRI-POI  
PGW CC-POI CC-POI n/a n/a CC-POI  
SGW-C n/a n/a n/a IRI-POI n/a  
SGW-C n/a n/a n/a CC-TF n/a  
SGW-U n/a n/a n/a CC-POI n/a  
PGW-C IRI-POI IRI-POI n/a n/a IRI-POI  
PGW-C CC-TF CC-TF n/a n/a CC-TF  
PGW-U CC-POI CC-POI n/a n/a CC-POI  
PDHR Option 1 SGW n/a n/a n/a IRI-POI n/a SGW-C n/a n/a n/a IRI-TF n/a SGW-U
n/a n/a n/a IRI-POI n/a PGW IRI-POI IRI-POI n/a n/a IRI-POI PGW-C IRI-TF IRF-
TF n/a n/a IRI-TF PGW-U IRI-POI IRI-POI n/a n/a IRI-POI Option 2 SGW n/a n/a
n/a CC-POI n/a SGW-C n/a n/a n/a CC-TF n/a SGW-U n/a n/a n/a CC-POI n/a PGW
CC-POI CC-POI n/a n/a CC-POI PGW-C CC-TF CC-TF n/a n/a CC-TF PGW-U CC-POI CC-
POI n/a n/a CC-POI MDF3 PDHR PDHR n/a PDHR PDHR LALS triggering Option 1 SGW
n/a n/a n/a LTF n/a SGW-C n/a n/a n/a LTF n/a PGW LTF LTF n/a n/a LTF PGW-C
LTF LTF n/a n/a LTF Option 2 MDF2 LTF LTF n/a LTF LTF
NOTE 1: The use of \"n/a\" in the above table implies that the LI function is
not applicable to the NF for the indicated scenario.
NOTE 2: The LIPF is not aware of the above role played by the host NFs in
providing the LI functions.
NOTE 3: MDF2, MDF3 and LI-LCS Client which are also involved in providing the
LI functions are not shown in the tables above.
# G.5 Voice
## G.5.1 Scope of interception
For the service type of Voice, the NFs present in IMS domain provide the LI
functions except for the case of inbound roaming targets with home routed
roaming architecture.
A target can be a subscriber of the CSP, an inbound roamer or a non-local ID.
In the case where a target is a non-local ID, the party communicating with the
target can be non-roaming, inbound roamer or outbound roamer. When a target is
non-local ID, provisioning of HSS and LTF are not applicable.
The interception of service type of Voice includes:
\- Delivery of IRI, or CC based on the delivery type indicated in the warrant.
\- When required, the delivery of LALS reports based on the LALS triggering.
\- Whether a target is non-local ID.
\- IMS services such as redirection, conferencing, application of media such
as music or announcements.
The CSP may have differing implementation options for the interception of IRI
and CC, for local as well as non-local ID targets. The CSP may also have
differing implementation options for LALS triggering.
The CSP may have either an LBO based roaming architecture or a home-routed
based roaming architecture.
## G.5.2 Initial configuration for N9HR/S8HR
To support the N9HR/S8HR (i.e. scenario 4 listed in clause G.2), the LIPF will
have to configure the BBIFF/BBIFF-C present in the packet core network. This
applies to all inbound roaming users using the IMS service.
Figure G.5-1 provides the LIPF logic for N9HR/S8HR that is applicable to all
inbounding roaming users using IMS services.
Figure G.5-1: LIPF logic for initial configuration for N9HR/S8HR
When the packet core network is 5GC, the BBIFF-C function is provided by the
SMF and when the packet core network is EPC, the BBIFF-C/BBIFF function is
provided by the SGW-C/SGW.
## G.5.3 Top level LIPF logic for service type voice
When a target ID is an IMPU, the warrant may specify whether a target is non-
local ID. The host NFs that provide the LI functions when the target is non-
local ID can be different from the host NFs that provide the LI functions when
the target is not a non-local ID. The provisioning of IRI-POI in HSS and
provisioning of LTF in support of LALS triggering applies only when the target
is not a non-local ID.
Figure G.5-2 provides the top-level view of LIPF logic for the service type of
Voice.
Figure G.5-2: Top level view of LIPF logic for service type of Voice
Within figure G.5-2, PEI (IMEI only) represents PEIIMEI. The target identity
in the IMPI format may contain a value derived from a SUPI or an IMSI. The
target identity in the IMPU format containing a SIP URI or TEL URI may contain
a value derived from a GPSI, MSISDN, an E.164 number, or IMSI. Only IMPU is
used for target non-local ID.
The LMISF-IRI is provisioned to support the interception of inbound roaming
target (or party communicating with a target non-local ID target is inbound
roaming) with HR that uses IMS services. The LMISF-IRI is expected to provide
the LI functions only for non-emergency services.
## G.5.4 LIPF logic for targets that are not non-local ID
### G.5.4.1 The flowchart
Figures G.5-3, G.5-4, G.5-5 and G.5-6 show the LIPF logic for the service type
of Voice when the target is not a non-local ID.
Figure G.5-3: Top level LIPF logic for service type of Voice when target is
not a non-local ID
For the delivery type of IRI + CC, the IRI-POIs and the CC-TFs are
provisioned. For the delivery type of IRI, the IRI-POIs are provisioned. For
the delivery type of CC, the CC-TFs are provisioned.
Figure G.5-4 shows the LIPF logic for the provisioning of IRI-POIs and figure
G.5-5 shows the LIPF logic for the provisioning of CC-TFs.
Figure G.5-4: LIPF logic for delivery type of IRI for service type of Voice
when target is not a non-local ID
The S-CSCF, E-CSCF, P-CSCF, IBCF, MGCF and AS (in figure G.5-4) provide IRI-
POI functions under certain conditions as noted within the illustration. To
prevent those IRI-POIs from providing the LI functions when not supposed to,
the LIPF may have to include a parameter during the provisioning. If
STIR/SHAKEN is required to be intercepted in the network, then the
provisioning of IRI-POIs in IBCF and AS include the parameter
ReportDiversionPASSporTInfo if the target identity is IMPU. Additional
STIR/SHAKEN related provisioning is illustrated in figure G.5-6A.
Figure G.5-5: LIPF logic for delivery type of CC for service type of Voice
when target is not a non-local ID
The IBCF, MGCF and AS (in figure G.5-5) provide CC-TF functions under certain
conditions as noted within the illustration. To prevent those CC-TFs from
triggering the CC-POIs when not supposed to, the LIPF may have to include a
parameter during the provisioning.
Figure G.5-6 illustrates the LIPF logic for LALS triggering.
Figure G.5-6: LIPF logic for LALS triggering for the service type of Voice
In LALS triggering option 1, the host NF that provides the LTF is same as the
NF that provides the IRI-POI functions. And therefore, the host NFs that
provide the LTF can be different based on the IMS deployment options.
The P-CSCF, IBCF and LMISF-IRI (in figure G.5-6) provide LTF under certain
conditions as noted within the illustration. Under special scenario, the
S-CSCF may provide the IRI-POI for emergency services (instead of E-CSCF) as
specified in TS 33.127 [5]. To prevent those LTFs from providing the LI
functions when not supposed to, the LIPF may have to include a parameter
during the provisioning.
Figure G.5-6A illustrates the LIPF logic for additional STIR/SHAKEN related
provisioning.
Figure G.5-6A: LIPF logic for additional STIR/SHAKEN related provisioning
For STIR/SHAKEN related reporting, IBCF, AS, P-CSCF (VPLMN with LBO), LMISF-
IRI (VPLMN with HR) provide the IRI-POI functions. The LIPF logic shown in
figure G.5-6A is additional logic required to support the LI for STIR/SHAKEN.
As illustrated in figure G.5-4, the IRI-POIs in P-CSCF, LMISF-IRI and AS are
provisioned as part IMS-based voice LI. Likewise, the IRI-POI in IBCF is also
provisioned for IMS-based voice LI when the alternate option is used.
When the STIR/SHAKEN is required to be intercepted in the network, the IRI-
POIs in IBCF and AS are to be provisioned with ReportDiversionPASSporTInfo
value when the target identity is IMPU.
### G.5.4.2 Interception
#### G.5.4.2.1 IMS deployment
There are two deployment options for IMS for intercepting the service type of
Voice (TS 33.127 [5]):
\- Default.
\- Alternate option.
It is expected that the CSP implements one of the two deployment options.
The conditions under which IRI-POI or CC-TF functions have to provisioned are
illustrated within the drawing and are further clarified in table G.5-1 and
G.5-2.
#### G.5.4.2.2 LALS triggering
There are two deployment options for LALS triggering. It is expected that the
CSP implements one of the two deployment options.
In LALS triggering option 1, the LTF present in the host NF that has the
associated IRI-POI triggers the LI-LCS Client. In LALS triggering option 2,
the LTF presents in the MDF2 triggers the LI-LCS Client.
#### G.5.4.2.3 Summary
Table G.5-1 provides the scope of NF domain that provides the IRI-POI/CC-
TF/CC-POI functions for the service type of Voice with the IMS deployment
option Default.
Table G.5-1: Scope of NF domain in IMS providing the LI functions with Default
option
NFs with LI function Non-roaming Roaming with LBO Roaming with HR
* * *
                                       VPLMN              HPLMN             VPLMN             HPLMN
HSS IRI-POI n/a IRI-POI n/a IRI-POI  
AS (NOTE 6, NOTE 12) IRI-POI n/a IRI-POI n/a IRI-POI  
AS (NOTE 7) CC-TF n/a CC-TF n/a CC-TF  
MRFP (NOTE 7) CC-POI n/a CC-POI n/a CC-POI  
S-CSCF (NOTE 8) IRI-POI n/a IRI-POI n/a IRI-POI  
E-CSCF (NOTE 8) IRI-POI IRI-POI n/a IRI-POI n/a  
P-CSCF n/a IRI-POI (NOTE 1) n/a n/a n/a  
P-CSCF CC-TF CC-TF n/a CC-TF (NOTE 2) n/a  
IMS-AGW CC-POI CC-POI n/a CC-POI (NOTE 2) n/a  
MGCF (NOTE 3) CC-TF n/a CC-TF n/a CC-TF  
IM-MGW (NOTE 3) CC-POI n/a CC-POI n/a CC-POI  
IBCF (NOTE 14) IRI-POI IRI-POI IRI-POI IRI-POI IRI-POI  
IBCF (NOTE 4) CC-TF n/a CC-TF n/a CC-TF  
TrGW (NOTE 4) CC-POI n/a CC-POI n/a CC-POI  
LMISF-IRI (NOTE 1) n/a n/a n/a IRI-POI n/a  
LMISF-CC (NOTE 1) n/a n/a n/a CC-POI n/a  
LALS triggering Option 1 S-CSCF LTF n/a LTF n/a LTF E-CSCF LTF LTF n/a LTF n/a
P-CSCF n/a LTF (NOTE 1) n/a n/a n/a LMISF-IRI n/a n/a n/a LTF (NOTE 1) n/a
Option 2 MDF2 LTF LTF LTF LTF LTF
Table G.5-2 provides the scope of NF domain that provides the IRI-POI/CC-
TF/CC-POI functions for the service type of Voice with the IMS deployment
option Alternate option.
Table G.5-2: Scope of NF domain in IMS providing the LI functions with
Alternate option
* * *
NFs with LI function Non-roaming Roaming with LBO Roaming with HR
* * *
                                       VPLMN              HPLMN             VPLMN              HPLMN
HSS IRI-POI n/a IRI-POI n/a IRI-POI
AS (NOTE 6, NOTE 12) IRI-POI n/a IRI-POI n/a IRI-POI
AS (NOTE 7) CC-TF n/a CC-TF n/a CC-TF
MRFP (NOTE 7) CC-POI n/a CC-POI n/a CC-POI
P-CSCF IRI-POI IRI-POI n/a IRI-POI (NOTE 2) IRI-POI
P-CSCF CC-TF CC-TF n/a CC-TF (NOTE 2) CC-TF
IMS-AGW CC-POI CC-POI n/a CC-POI (NOTE 2) CC-POI
MGCF (NOTE 3) IRI-POI n/a IRI-POI n/a IRI-POI
MGCF (NOTE 3) CC-TF n/a CC-TF n/a CC-TF
IM-MGW (NOTE 3) CC-POI n/a CC-POI n/a CC-POI
IBCF IRI-POI\ IRI-POI\ IRI-POI\ IRI-POI\ IRI-POI\  
(NOTE 13) (NOTE 2, 14) (NOTE 13) (NOTE 2, 14) (NOTE 13)
IBCF (NOTE 4) CC-TF n/a CC-TF n/a CC-TF
TrGW (NOTE4) CC-POI n/a CC-POI n/a CC-POI
LMISF-IRI (NOTE 1) n/a n/a n/a IRI-POI n/a
LMISF-CC (NOTE 1) n/a n/a n/a CC-POI n/a
LALS Triggering Option 1 P-CSCF LTF LTF n/a LTF (NOTE 2) LTF
                                       IBCF               n/a               n/a                LTF (NOTE 5)   n/a            n/a
                                       LMISF-IRI          n/a               n/a                n/a            LTF (NOTE 1)   n/a
                         Option 2      MDF2               LTF               LTF                LTF            LTF            LTF
* * *
NOTE 1: For non-emergency sessions only.
NOTE 2: For emergency sessions only.
NOTE 3: Only when an incoming session to a target is redirected over a CS
domain.
NOTE 4: Only when target is outbound roaming or when an incoming session to a
target is redirected over an IP domain, or to an outbound roaming party with
LBO.
NOTE 5: Only when the target is outbound roaming without a redirection.
NOTE 6: When the interception of conferencing services is required.
NOTE 7: When the content interception of conferencing, or application of
music/ is required.
NOTE 8: For IMS emergency sessions in fixed networks when the S-CSCF is on the
signaling path, S-CSCF may optionally (instead of E-CSCF) provide the IRI-POI
functions with the default option.
NOTE 9: The use of \"n/a\" in the above table implies that the LI function is
not applicable to the NF for the indicated scenario.
NOTE 10: The LIPF is not aware of the above role played by the host NFs in
providing the LI functions.
NOTE 11: MDF2, MDF3 and LI-LCS Client which are also involved in providing the
LI functions are not shown in the tables above.
NOTE 12: When the interception of STIR/SHAKEN is required.
NOTE 13: Only when target is outbound roaming or when an incoming session to a
target is redirected over an IP domain, or to an outbound roaming party with
LBO, or when the interception of STIR/SHAKEN is required.
NOTE 14: Only when the interception of STIR/SHAKEN is required.
#### G.5.4.2.4 STIR/SHAKEN
Since the IRI-POI in AS, in support of LI for special services such as
conferencing, is always provisioned, the LIPF logic has to ensure that when
the STIR/SHAKEN is required to be intercepted and the target Id is IMPU, the
ReportDiversionPASSporTInfo is included as part of that provisioning.
Likewise, the IRI-POI in IBCF is also provisioned except for the case when the
default option for IMS LI is deployed. The diagram shown in figure G.5-6A
illustrates that when STIR/SHAKEN is required to be intercepted and the target
Id is IMPU, the IRI-POI in IBCF is provisioned even with the default option of
IMS LI with ReportDiversionPASSporTInfo is included.
In general, when the STIR/SHAKEN is required to be intercepted in the network,
and the target Id is IMPU, the IRI-POIs in AS and the IBCF are provisioned
with ReportDiversionPASSporTInfo parameter included.
The diagram shown in figure G.5-6B below illustrates the LI provisioning just
from STIR/SHAKEN perspective. However, from an overall provisioning
perspective, it is embedded within the LIPF logic of IMS LI provisioning as
illustrated in clause G.5.4.1.
Figure G.5-6B: Localized LI provisioning view from STIR/SHAKEN perspective
The inclusion of ReportDiversionPASSporTInfo for provisioning of IRI-POI in
P-CSCF and LMISF-IRI is not required.
Table G.5-2A shows the NFs that will have to provide the STIR/SHAKEN LI
(signing) for various scenarios and the table G.5-2B shows the NFs that will
have to provide the STIR/SHAKEN LI (verification) for various scenarios.
The signing for STIR/SHAKEN happens in the HPLMN except for the emergency
sessions it can also happen in the VPLMN. In these tables the indicated
scenarios are from the perspective of target.
Table G.5-2A: Scope of NF domain in IMS providing the LI functions for
STIR/SHAKEN (signing)
Scenario HPLMN VPLMN
* * *
                                                        CSP choice AS       CSP choice is IBCF
Emergency call IBCF IBCF IBCF  
RCD present AS AS n/a  
Intra-CSP session signing/verification required AS AS n/a  
Intra-CSP session signing/verification not required Intra-CSP session n/a n/a
n/a Inter-CSP session AS IBCF n/a
Table G.5-2B: Scope of NF domain in IMS providing the LI functions for
STIR/SHAKEN (verification)
Scenario HPLMN VPLMN
* * *
                                                        CSP choice AS       CSP choice is IBCF
Emergency callback AS IBCF See NOTE 1  
Inbound roaming with LBO n/a n/a P-CSCF  
Inbound roaming with Home-Routed n/a n/a LMISF-IRI  
Intra-CSP session signing/verification required AS AS See NOTE 1  
Intra-CSP session signing/verification not required Intra-CSP session AS (see
NOTE 2) AS (see NOTE 2) See NOTE 1 Inter-CSP session AS IBCF (see NOTE 3) See
NOTE 1
NOTE 1: Same as in the row for inbound roaming (LBO) and inbound roaming (HR).
NOTE 2: This is the case where the redirection happens with the outgoing SIP
INVITE containing the validation result and the REQUEST URI is a target
identity (see clause 7.11.2.3). The AS may or may not interact with the
Verification AS.
NOTE 3: The IRI-POI is in IBCF. The IRI-POI can be in AS for the special
redirection case depicted in NOTE 2 (see clause 7.11.2.3).
The indicated CSP choice is applicable when the signing/verification of only
inter-CSP session is required. The CSP choice for signing and verification
need not be the same.
## G.5.5 LIPF logic for targets that are non-local ID
### G.5.5.1 The flowchart
Figures G.5-7, G.5-8 and G.5-9 show the LIPF logic for the service type of
Voice when the target is a non-local ID.
Figure G.5-7: LIPF logic for service type of Voice when target is a non-local
ID
For the delivery type of IRI + CC, the IRI-POIs and the CC-TFs are
provisioned. For the delivery type of IRI, the IRI-POIs are provisioned. For
the delivery type of CC, the CC-TFs are provisioned.
Figure G.5-8 shows the LIPF logic for the provisioning of IRI-POIs and figure
G.5-9 shows the LIPF logic for the provisioning of CC-TFs.
Figure G.5-8: LIPF logic for delivery type of IRI for service type of Voice
when target is a non-local ID
The P-CSCF, IBCF and MGCF (in figure G.5-8) provide IRI-POI functions under
certain conditions as noted within the illustration. To prevent those IRI-POIs
from providing the LI functions when not supposed to, the LIPF may have to
include a parameter during the provisioning.
If STIR/SHAKEN is required to be intercepted in the network, the provisioning
of IRI-POI in IBCF include the parameter ReportDiversionPASSporTInfo.
Additional STIR/SHAKEN related provisioning for target non-local ID is
illustrated in figure G.5-9A.
Figure G.5-9: LIPF logic for delivery type of CC for service type of Voice
when target is a non-local ID
The P-CSCF, IBCF and MGCF (in figure G.5-9) provide CC-TF functions under
certain conditions as noted within the illustration. To prevent those CC-TFs
from triggering the CC-POI when not supposed to, the LIPF may have to include
a parameter during the provisioning.
Figure G.5-9A illustrates the LIPF logic for additional STIR/SHAKEN related
provisioning for target non-local ID.
Figure G.5-9A: LIPF logic for additional STIR/SHAKEN related provisioning for
target non-local ID
For STIR/SHAKEN related reporting IBCF, AS, P-CSCF (VPLMN with LBO), LMISF-
IRI-POI (VPLMN with HR) provide the IRI-POI functions. The LIPF logic shown in
figure G.5-9A is additional logic required to support the STIR/SHAKEN when the
target is non-local ID.
As illustrated in figure G.5-8, the IRI-POIs in P-CSCF, LMISF-IRI are
provisioned as part IMS-based voice LI. Likewise, the IRI-POI in IBCF is also
provisioned for IMS-based voice LI when default option is used in HPLMN, or
when alternate options are used in both HPLMN and VPLMN.
When the interception of STIR/SHAKEN is required in the network, the IRI-POIs
in IBCF and AS are to be provisioned with ReportDiversionPASSporTInfo value.
### G.5.5.2 Interception
#### G.5.5.2.1 IMS deployment
There are two deployment options for IMS for intercepting the service type of
Voice (TS 33.127 [5]):
\- Default.
\- Alternate option.
It is expected that the CSP implements one of the two deployment options.
The conditions under which IRI-POI or CC-TF functions have to provided are
illustrated within the deawing and are further clarified in table G.5-3 and
G.5-4. The LIPF may have to indicate to the IRI-POI and CC-TF the condition in
which they have to provide the respective functions.
#### G.5.5.2.2 Summary
Table G.5-3 provides the scope of NF domain that provides the IRI-POI/CC-
TF/CC-POI functions for the service type of Voice with the IMS deployment
option Default in HPLMN.
Table G.5-3: Scope of NF domain in IMS providing the LI functions with Default
in HPLMN
NF with LI function Non-roaming Roaming with LBO Roaming with HR
* * *
                                      VPLMN              HPLMN             VPLMN     HPLMN             
                                      Default            Alternate
P-CSCF n/a IRI-POI n/a n/a n/a n/a P-CSCF n/a CC-TF n/a n/a n/a n/a IMS-AGW
n/a CC-POI n/a n/a n/a n/a AS (NOTE 5) IRI-POI n/a n/a IRI-POI n/a IRI-POI
MGCF IRI-POI n/a n/a IRI-POI n/a IRI-POI MGCF CC-TF n/a n/a CC-TF n/a CC-TF
IM-MGW CC-POI n/a n/a CC-POI n/a CC-POI IBCF IRI-POI IRI-POI (NOTE 5) IRI-POI
IRI-POI IRI-POI (NOTE5) IRI-POI IBCF CC-TF n/a CC-TF CC-TF n/a CC-TF TrGW CC-
POI n/a CC-POI CC-POI n/a CC-POI LMISF-IRI n/a n/a n/a n/a IRI-POI n/a LMISF-
CC n/a n/a n/a n/a CC-POI n/a
Table G.5-4 provides the scope of NF domain that provides the IRI-POI/CC-
TF/CC-POI functions for the service type of Voice with the IMS deployment
option Alternate option in HPLMN.
Table G.5-4: Scope of NF domain in IMS providing the LI functions with
Alternate option in HPLMN
NF with LI function Non-roaming Roaming with LBO Roaming with HR
* * *
                                      VPLMN              HPLMN             VPLMN     HPLMN     
                                      Default            Alternate
P-CSCF n/a IRI-POI n/a n/a n/a n/a P-CSCF n/a CC-TF n/a n/a n/a n/a IMS-AGW
n/a CC-POI n/a n/a n/a n/a AS (NOTE 5) IRI-POI n/a n/a IRI-POI n/a IRI-POI
S-CSCF IRI-POI n/a n/a IRI-POI n/a IRI-POI MGCF CC-TF n/a n/a CC-TF n/a CC-TF
IM-MGW CC-POI n/a n/a CC-POI n/a CC-POI IBCF (NOTE 5) IRI-POI IRI-POI IRI-POI
IRI-POI IRI-POI I-IRI-POI IBCF CC-TF n/a CC-TF CC-TF n/a CC-TF TrGW CC-POI n/a
CC-POI CC-POI n/a CC-POI LMISF-IRI n/a n/a n/a n/a IRI-POI n/a LMISF-CC n/a
n/a n/a n/a CC-POI n/a
NOTE 1: In tables G.5-3 and G.5-4, the use of the phrase non-roaming/roaming
applies to the party communicating with the target non-local ID.
NOTE 2: The use of \"n/a\" in the above table implies that the LI function is
not applicable to the NF for the indicated scenario.
NOTE 3: The LIPF is not aware of the above role played by the host NFs in
providing the LI functions.
NOTE 4: MDF2, MDF3 and LI-LCS Client which are also involved in providing the
LI functions are not shown in the tables above.
NOTE 5: Only when the interception of STIR/SHAKEN is required.
#### G.5.5.2.3 STIR/SHAKEN
When the target is non-local ID, the IRI-POI in AS is not provisioned for IMS-
LI. The IRI-POI in IBCF is provisioned except for the case where the alternate
option is deployed in the HPLMN for IMS LI (target non-local ID) and default
option is used for IMS-LI in the VPLMN (target non-local ID).
The diagram shown in figure G.5-9A illustrates that when the interception of
STIR/SHAKEN is required in the network, and the target Id is IMPU, and the
target is non-local ID, the IBCF is provisioned even when the alternate option
for IMS LI is used in the HPLMN and default option is used for IMS LI in the
VPLMN.
The diagram shown in figure G.5-6A (clause G.5.4.1) illustrates the LI
provisioning just from STIR/SHAKEN perspective. However, from an overall
provisioning perspective for target non-local ID, it is embedded within the
LIPF logic of IMS LI provisioning as illustrated in clause G.5.5.1.
Table G.5-5 shows the NFs that will have to provide the STIR/SHAKEN LI
(signing) for various scenarios and table G.5-6 shows the NFs that will have
to provide the STIR/SHAKEN LI (verification) for various scenarios.
The signing for STIR/SHAKEN happens in the HPLMN. In these tables the
indicated scenarios are from the perspective of the party communicating with
the target non-local ID.
Table G.5-5: Scope of NF domain in IMS providing the LI functions for
STIR/SHAKEN (signing)
Scenario CSP choice AS CSP choice is IBCF
* * *
RCD present AS AS  
Intra-CSP session n/a n/a  
Inter-CSP session Intra-CSP session signing/verification is required AS AS
Intra-CSP session signing/verification not required AS IBCF
Table G.5-6: Scope of NF domain in IMS providing the LI functions for
STIR/SHAKEN (verification)
Scenario HPLMN VPLMN
* * *
                                     CSP choice AS                                         CSP choice is IBCF   Default     Alternate
Inbound roaming with LBO n/a n/a P-CSCF IBCF  
Inbound roaming with Home-Routed n/a n/a LMISF-IRI LMISF-IRI  
Intra-CSP session n/a n/a n/a n/a  
Inter-CSP session Intra-CSP session signing/verification is required AS AS See
NOTE See NOTE Intra-CSP session signing/verification not required AS IBCF See
NOTE See NOTE
NOTE: Same as in the rows for inbound roaming (LBO) and inbound roaming (HR).
The indicated CSP choice is applicable when the signing/verification of only
inter-CSP session is required. The CSP choice for signing and verification
need not be the same.
# G.6 Messaging
## G.6.1 Scope of interception
The illustrations shown in the annex for the service type Messaging includes:
\- MMS.
\- SMS.
The interception for the MMS is done by the IRI-POI and CC-POI present in the
MMS Proxy Relay. The interception for the SMS is done by the IRI-POI present
in the SMSF and the MME (when MME provides the SMS service) and the IMS domain
for SMS over IMS.
A target can be a subscriber of the CSP, an inbound roamer or a non-local ID.
In the case where a target is a non-local ID, the party communicating with the
target can be non-roaming, inbound roamer or outbound roamer. When a target is
non-local ID, provisioning of HSS and LTF are not applicable.
For N9HR/S8HR, the LI functions for the inbound roamers are provided in the
LMISF-IRI. To support the interception in LMISF-IRI, the initial configuration
for N9HR/S8HR will have to be done as illustrated in clause G.5.2.
The interception of service type of Messaging includes:
\- Delivery of IRI or CC based on the delivery type indicated in the warrant
(the delivery of CC is applicable to MMS only).
\- Whether a target is non-local ID.
\- When required, the delivery of LALS reports based on the LALS triggering
(applicable to SMS only).
In view of SMS over IMS, the CSP may have either an LBO based roaming
architecture or a home-routed based roaming architecture. The CSP may have
differing implementation options for LALS triggering.
Table G.6-1 shows the target identities that are applicable to different type
of SMS use.
Table G.6-1: Target IDs as applicable to the interception of service type
Messaging
+-------+-------+-------+-------+-------+-------+-------+------+------+ | SMS | GPSI | SUPI | PEI | M | IMSI | IMEI | IMPU | IMPI | | m | | | | SISDN | | | | | | ethod | | | | | | | | | +=======+=======+=======+=======+=======+=======+=======+======+======+ | MMS | YES | n/a | n/a | YES | n/a | n/a | n/a | n/a | +-------+-------+-------+-------+-------+-------+-------+------+------+ | MMS | YES | n/a | n/a | YES | n/a | n/a | n/a | n/a | | (t | | | | | | | | | | arget | | | | | | | | | | non- | | | | | | | | | | local | | | | | | | | | | ID) | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+------+------+ | SMS | YES | As | As | YES | As | YES | YES | YES | | over | | IMPI | IMEI | ( | IMPI | | | | | IMS | ( | | | NOTE) | | | | | | (l | NOTE) | | | | | | | | | ocal) | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+------+------+ | SMS | YES | n/a | n/a | YES | n/a | n/a | YES | n/a | | over | | | | | | | | | | IMS | | | | | | | | | | (non- | | | | | | | | | | local | | | | | | | | | | ID) | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+------+------+ | SMS | YES | YES | YES | As | As | As | n/a | n/a | | over | | | | GPSI | SUPI | PEI | | | | 5GS | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+------+------+ | SMS | YES | n/a | n/a | As | n/a | n/a | n/a | n/a | | over | | | | GPSI | | | | | | 5GS | | | | | | | | | | (t | | | | | | | | | | arget | | | | | | | | | | non- | | | | | | | | | | local | | | | | | | | | | ID) | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+------+------+ | SMS | n/a | n/a | n/a | YES | YES | YES | n/a | n/a | | over | | | | | | | | | | EPS | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+------+------+ | SMS | n/a | n/a | n/a | YES | n/a | n/a | n/a | n/a | | over | | | | | | | | | | EPS | | | | | | | | | | (t | | | | | | | | | | arget | | | | | | | | | | non- | | | | | | | | | | local | | | | | | | | | | ID) | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+------+------+
The target identity PEI collectively represents PEIIMEI and PEIIMEISV.
Likewise, SUPI represents SUPIIMSI and SUPINAI whereas GPSI represents
GPSIMISDN and GPSINAI. The target identity in the IMPI format may contain a
value derived from a SUPI or an IMSI. The target identity in the IMPU format
containing a SIP URI or TEL URI may contain a value derived from a GPSI,
MSISDN, an E.164 number, or IMSI.
NOTE: The GPSI and MSISDN may also be the target IDs as an IMPU.
A part of LIPF logic is based on the target identity applicability shown in
table G.6-1.
### G.6.2 LIPF logic for service type messaging
#### G.6.2.1 Flowcharts
Figure G.6-1 provides the top-level view of LIPF logic for the service type of
Messaging.
Figure G.6-1: Top-level view of LIPF logic for service type of Messaging
The IRI-POI in HSS, UDM and LMISF-IRI are provisioned only when a target is
not a non-local ID.
Figure G.6-2 shows the LIPF logic for service type Messaging with SMS over
IMS.
Figure G.6-2: LIPF logic for service type of Messaging for SMS over IMS
The P-CSCF (in figure G.6-2) provides IRI-POI functions under certain
conditions as noted within the illustration. To prevent the IRI-POI in P-CSCF
from providing the LI functions when not supposed to, the LIPF may have to
include a parameter during the provisioning.
Figure G.6-3 shows the LIPF logic for LALS triggering with service type of
Messaging.
Figure G.6-3: LIPF logic for LALS triggering for the service type of Messaging
The P-CSCF (in figure G.6-3) provides LTF functions under certain conditions
as noted within the illustration. To prevent LTF in P-CSCF from providing the
LI functions when not supposed to, the LIPF may have to include a parameter
during the provisioning.
### G.6.2.2 Interception
#### G.6.2.2.1 IMS deployment
There are two deployment options for IMS for intercepting the service type of
Messaging for SMS over IMS:
\- Default.
\- Alternate option.
It is expected that the CSP implements one of the two deployment options.
The conditions under which IRI-POI functions have to be provisioned are
illustrated within the drawing and are further clarified in tables from G.6-3
to G.6-6.
#### G.6.2.2.2 LALS triggering
There are two deployment options for LALS triggering. It is expected that the
CSP implements one of the two deployment options.
In LALS triggering option 1, the LTF present in the host NF that has the
associated IRI-POI triggers the LI-LCS Client. In LALS triggering option 2,
the LTF presents in the MDF2 triggers the LI-LCS Client.
#### G.6.2.2.3 Summary
Table G.6-2 provides the scope of NF domain that provides the IRI-POI/CC-
POI/LTF functions for the service type of Messaging.
Table G.6-2: Scope of NF domain providing the LI functions for service type
Messaging
NFs with LI function Non-roaming Roaming with LBO Roaming with HR
* * *
                                                                                    VPLMN              HPLMN                           VPLMN     HPLMN
MMS Proxy Relay IRI-POI n/a IRI-POI n/a IRI-POI  
MMS Proxy Relay CC-POI n/a CC-POI n/a CC-POI  
SMSF IRI-POI IRI-POI n/a IRI-POI n/a  
MME (with SMS service) IRI-POI IRI-POI n/a IRI-POI n/a  
IMS NFs See table G.6-3, table G.6-4, table 6.5 and table 6.6.  
LALS triggering Option 1 SMSF LTF LTF n/a LTF n/a MME LTF LTF n/a LTF n/a IMS
NFs See table G.6-3 and table 6.4  
Option 2 MDF2 LTF LTF LTF LTF LTF
Table G.6-3 provides the scope of NF domain in the IMS that provides the IRI-
POI/LTF for SMS over IMS when the target is not a non-local ID with default
IMS deployment option.
Table G.6-3: Scope of NF domain in IMS providing the LI functions for SMS over
IMS (local ID) with Default
NFs with LI function Non-roaming Roaming with LBO Roaming with HR
* * *
                                       VPLMN              HPLMN             VPLMN              HPLMN
P-CSCF n/a IRI-POI (NOTE 1) n/a n/a n/a  
E-CSCF IRI-POI IRI-POI n/a IRI-POI n/a  
S-CSCF IRI-POI n/a IRI-POI n/a IRI-POI  
LMISF-IRI n/a n/a n/a IRI-POI (NOTE 1) n/a  
LALS triggering Option 1 P-CSCF n/a LTF (NOTE 1) n/a n/a n/a E-CSCF n/a LTF
n/a LTF n/a S-CSCF LTF n/a LTF n/a LTF LMISF-IRI n/a n/a n/a LTF (NOTE1) n/a
Option 2 MDF2 LTF LTF LTF LTF LTF
Table G.6-4 provides the scope of NF domain in the IMS that provides the IRI-
POI/LTF for SMS over IMS when the target is not a non-local ID with Alternate
IMS deployment option.
Table G.6-4: Scope of NF domain in IMS providing the LI functions for SMS over
IMS (local ID) with Alternate option
NFs with LI function Non-roaming Roaming with LBO Roaming with HR
* * *
                                       VPLMN              HPLMN             VPLMN              HPLMN
P-CSCF IRI-POI IRI-POI n/a IRI-POI (NOTE 2) IRI-POI  
IBCF n/a n/a IRI-POI n/a n/a  
LMISF-IRI n/a n/a n/a IRI-POI (NOTE 1) n/a  
LALS triggering Option 1 P-CSCF LTF LTF n/a LTF (NOTE 2) n/a IBCF n/a n/a LTF
n/a n/a LMISF-IRI n/a n/a n/a LTF (NOTE 1) n/a Option 2 MDF2 LTF LTF LTF LTF
LTF
Table G.6-5 provides the scope of NF domain in the IMS that provides the IRI-
POI/LTF for SMS over IMS when the target is a non-local ID with default IMS
deployment option.
Table G.6-5: Scope of NF domain in IMS providing the LI functions for SMS over
IMS (non-local ID) with Default
NFs with LI function Non-roaming Roaming with LBO Roaming with HR
* * *
                                       VPLMN              HPLMN             VPLMN     HPLMN
P-CSCF n/a IRI-POI n/a n/a n/a S-CSCF IRI-POI n/a IRI-POI n/a IRI-POI LMISF-
IRI n/a n/a n/a IRI-POI n/a
Table G.6-6 provides the scope of NF domain in the IMS that provides the IRI-
POI/LTF for SMS over IMS when the target is a non-local ID with Alternate IMS
deployment option.
Table G.6-6: Scope of NF domain in IMS providing the LI functions for SMS over
IMS (non-local ID) with Alternate option
NFs with LI function Non-roaming Roaming with LBO Roaming with HR
* * *
                                       VPLMN              HPLMN             VPLMN     HPLMN
P-CSCF IRI-POI IRI-POI n/a n/a IRI-POI IBCF n/a n/a IRI-POI n/a n/a LMISF-IRI
n/a n/a n/a IRI-POI n/a
NOTE 1: Only for SMS over IMS not involving the emergency center.
NOTE 2: Only for SMS over IMS to emergency centers.
NOTE 3: The use of \"n/a\" in the above table implies that the LI function is
not applicable to the NF for the indicated scenario.
NOTE 4: The LIPF is not aware of the above role played by the host NFs in
providing the LI functions
NOTE 5: MDF2, MDF3 and LI-LCS Client which are also involved in providing the
LI functions are not shown in the tables above.
# G.7 PTC
## G.7.1 Scope of interception
The illustrations shown in this clause are for the service type PTC.
The interception of service type of PTC is done by the IRI-POI and CC-POI
present in the PTC server and includes delivery of IRI or CC based on the
delivery type indicated in the warrant.
The following target identifiers are applicable to the service type of PTC for
provisioning the IRI-POI/CC-POI at the PTC Server:
\- IMPU.
\- IMPI.
\- MCPTT ID.
\- Instant ID URN.
\- Chat group ID.
The following target identifiers are applicable to the service type of PTC for
provisioning the IRI-POI at the HSS:
\- IMPU.
\- IMPI.
The target identity in the IMPU format may contain a SIP URI, TEL URI.
## G.7.2 LIPF logic for service type of PTC
Figure G.7-1 illustrates the LIPF logic for the provisioning of IRI-POI/CC-POI
in the PTC server.
Figure G.7-1: LIPF logic for provisioning the IRI-POI/CC-POI in PTC Server for
the service type of PTC
When the Chat Group ID is used as the target ID, the PTC server happens to
intercept when the indicated chat group ID is used for a PTC chat session.
# G.8 LALS
## G.8.1 Scope of interception
The illustrations shown in this clause are for the service type LALS.
The interception of service type of LALS includes the delivery of target's
location information either immediate (at the time of provisioning) or
periodic by the LI-LCS Client.
## G.8.2 LIPF logic for service type of LALS
Figure G.8-1 illustrates the LIPF logic for the provisioning of LI-LCS Client.
Figure G.8-1: LIPF logic the provisioning of LI-LCS Client for the service
type of LALS
###### ## Annex H (normative): XSD Schema for State Transfers
The XSD schema describing the structures used for state transfer is given in
the file _urn_3GPP_ns_li_3GPPStateTransfer.xsd_ which accompanies the present
document.
#
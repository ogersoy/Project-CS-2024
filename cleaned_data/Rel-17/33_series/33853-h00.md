# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# Introduction
User Plane integrity protection allows the network operator and the UE detect
that user plane data has been modified in transit between each other.
Recently, several potential attacks on the 3GPP AN interface and AN
infrastructure have come to light that can be mitigated by the use of
integrity protection on the User Plane over at least the radio interface. This
protection is currently available for a 5G AN with a 5G core but not for LTE
with EPC, LTE with a 5G Core, or for EN-DC. Integrity protection is currently
specified for the control plane to protect signalling messages but is only
currently specified for 5G user plane up to 64Kb per bearer.
Furthermore, supporting User Plane Integrity Protection (UP IP) at full data
rate for 5G NR with 5G Core has been identified as an issue in Rel-15 and thus
a UE capability-based negotiation was introduced in 5G system. Key issues and
Potential enhancements to support UP IP up to the full data rate need to be
studied while meeting the expected peak data throughput and lower latency as
the NR and LTE radio capabilities evolve.
5G and LTE can be implemented independently and together in a number of ways.
These are described in 3GPP TR 38.801 [2] (clause 7.2) and are summarised as:
\- Option 1 - eUTRA with EPC
\- Option 2 - NR standalone with 5G Core
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G core with eUTRA
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
# 1 Scope
The present document studies the key issues and potential solutions for
integrity protecting the user plane, including potential enhancements needed
to support UP IP up to the full data rate, in the following combinations as
defined in 3GPP TR 38.801 [2] (clause 7.2):
\- Option 1 - eUTRA with EPC
\- Option 2 - NR standalone with 5G Core
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
\- Option 4 - 5G Core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G Core with eUTRA
\- Option 7 - 5G Core based Dual Connectivity (eUTRA master - NR secondary)
The present document does not detail key issues, solutions, evaluations,
conclusions and recommendations for GERAN and UTRAN.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 38.801:\"Study on new radio access technology: Radio access
architecture and interfaces\".
[3] 3GPP TS 33.401: \"5G System Architecture Evolution (SAE); Security
architecture\".
[4] 3GPP TS 33.501: \"Security architecture and procedures for 5G system\".
[5] S3-181429, LTE and the upcoming 5G standard (GSMA).
[6] 3GPP TS 37.340: \"NR; Multi-connectivity; Overall description; Stage-2\".
[7] 3GPP TS 38.413: \" NG-RAN; NG Application Protocol (NGAP)\".
[8] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC) protocol
specification\".
[9] 3GPP TS 36.331: \"Radio Resource Control (RRC); Protocol specification\".
[10] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
[11] 3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS); Stage 3\".
[12] 3GPP TS 23.501: \"System architecture for the 5G System (5GS); Stage 2\".
[13] 3GPP TS 23.502: \"Procedures for the 5G System (5GS); Stage 2\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
## 3.2 Symbols
Void.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
AN Access Network
AS Access Stratum
CP Control Plane
DRB IP Data Radio Bearer Integrity Protection
EN-DC eUTRA-NR Dual Connectivity
EPS Evolved Packet System
eUTRA evolved Universal Terrestrial Radio Access
IP Integrity Protection
NR New Radio (5G)
RAT Radio Access Technology
SMC Security Mode Command
UE User Equipment
UP User Plane
UP IP User Plane Integrity Protection
# 4 3GPP Network Options
LTE and NR networks can be implemented in many combinations, for the purpose
of the present document each key issue and solution is referenced to one or
more of the options as defined in TR 38.801 [2] (clause 7.2):
\- Option 1 - eUTRA with EPC
\- Option 2 - NR standalone with 5G Core
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
\- Option 4 - 5G Core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G Core with eUTRA
\- Option 7 - 5G Core based Dual Connectivity (eUTRA master - NR secondary)
# 5 Key Issues
## 5.1 Key Issue #1: UP integrity activation in EPS
### 5.1.1 Issue description
In the 5G system, as specified in TS 33.501 [4], UP security activation is
separate from CP security activation and is based on a UP policy sent by the
core network. In EPS, as specified in TS 33.401 [3], UP and CP AS security are
activated simultaneously by the AS SMC.
For the introduction of UP integrity in EPS, it needs to be specified how UP
integrity is activated in a secure way.
### 5.1.2 Network options affected
This key issue is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 5.1.3 Threat description
If UP integrity activation is not secure, a man-in-the-middle could deceive
the UE into sending UP traffic unprotected that is supposed to be protected.
### 5.1.4 Potential security requirements
The system shall support secure activation of UP integrity in EPS.
## 5.2 Key Issue #2: Secure negotiation of integrity protection support in EPS
### 5.2.1 Issue description
Integrity protection for the user plane is not supported in EPS according to
TS 33.401 [3]. Neither it is possible to introduce it in a backward-compatible
way. Therefore, to introduce such feature, it needs to be considered that
upgraded entities (network nodes or UEs) supporting the feature will coexist
and interact with legacy ones for a long period of time. It is then expected
that the network and the UE needs to be able to negotiate the support of such
feature to be able to activate it in the first place. If this feature is not
securely negotiated, a man-in-the-middle can deceive the network into not
activating the feature. In other terms, the feature would be vulnerable to
bidding-down attacks.
### 5.2.2 Network options affected
This key issue is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 5.2.3 Threat description
In case the negotiation of the user plane integrity protection feature is not
secure, a man-in-the-middle could deceive the network into not activating the
feature.
### 5.2.4 Potential security requirements
The system shall support a secure negotiation of the user plane integrity
protection feature while maintaining backward compatibility.
## 5.3 Key Issue #3: UE support of UP IP at the full uplink data rate
### 5.3.1 Issue description
NR (as well as the evolution of E-UTRA) is expected to support ever increasing
UE peak data rates (e.g., in the order of 10\'s of gbps) while at the same
time meeting ultra-low latency requirements for transmission of certain delay
sensitive packets, e.g., use cases such as autonomous driving, industrial
automation and virtual/augmented reality. For these use cases, it is important
that the User Plane Integrity Protection (UP IP) can be applied at UE for the
full data rate on the uplink.
The UE capability based negotiation was introduced given that it was not
possible to support UP IP at the UE supported full data rate in all cases.
This key issue is to study solutions for supporting UP IP at the UE supported
full data rate on the uplink.
NOTE: Potential solutions to address this key issue may impact RAN protocol
stack.
### 5.3.2 Network options affected
If DRB IP is applied at the PDCP layer also for E-UTRA, this key issue is
applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 2 - NR standalone with 5G Core
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G core with eUTRA
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 5.3.3 Threat description
If UE is not able to support DRB IP at the full data rate on the UE uplink,
then it will not be possible to integrity protect all DRBs on the uplink while
also meeting the ultra-low latency expected by certain applications. This
would allow an attacker to exploit the lack of integrity protection on the
UE\'s uplink data transmission.
### 5.3.4 Potential security requirements
It shall be possible to apply DRB IP at the UE full data rate on the UE\'s
uplink.
## 5.4 Key Issue #4: Integrity protection capability imbalance in enodeB
connected to 5GC
### 5.4.1 Issue description
In TS 33.501 [4], NGEN-DC and NE-DC are defined as two possible MR-DC
scenarios. In these cases, eNB and gNB are used in dual connectivity.
Rel.15 solution in MR-DC scenarios in TS 33.501[4] specify that, depending on
the MR-DC scenario being used and the security policy at the time of PDU
session establishment, the PDU session may either be rejected, the integrity
protection in 5G Uu interface implicitly disabled, or the offload to SN is not
allowed. The following cases summarize this behaviour according to TS
33.501[4]:
1\. NGEN-DC scenario (CN=5GC, eNB=MN, gNB=SN)
a. If the UP security policy indicates UP integrity protection is
\"required\", then the MN (MeNB) rejects the PDU session because the MN being
an eNB does not support UP IP.
b. If the UP security policy indicates UP integrity protection is
\"preferred\", then the MN (MeNB) always deactivates UP IP. The SN (SgNB)
always deactivates the UP IP of any PDU session terminated at the SN. This is
because MN being an eNB does not support UP IP and thus is not able to
indicate to the SN (SgNB) regarding the use of UP IP.
c. If the UP security policy indicates UP integrity protection is \"not
needed\", then the MN and SN always activates DRBs disabling the UP IP.
2\. NE-DC scenario (CN=5GC, eNB=SN, gNB=MN)
a. If the UP security policy indicates UP integrity protection is
\"required\", then if the MN (MgNB) activates the UP IP for the PDU session,
then the MN (MgNB) does not offload any DRB of the PDU session to the SN
(SeNB). This is because the MN (MgNB) supports UP IP, but the SN being an eNB
does not support the UP IP.
b. If the UP security policy indicates UP integrity protection is
\"preferred\", and if the MN (MgNB) activates any of the PDU session DRBs with
UP IP, then the MN (MgNB) does not offload any DRB on this PDU session to the
SN (SeNB). This is because the SN being an eNB does not support UP IP.
c. If the UP security policy indicates UP integrity protection is
\"preferred\", and if the MN (MgNB) activates any of the PDU session DRBs
without UP IP, the MN may offload DRBs of this PDU session to the SN (SeNB).
In this case, the SN accepts the DRBs always disabling the UP IP. This is
because the SN being an eNB does not support UP IP.
d. If the UP security policy indicates UP integrity protection is \"not
needed\", then the MN and SN always activates DRBs disabling the UP IP
Therefore, the MR-DC solution results in the situation where gNB and UE does
not use UP integrity protection in some scenarios even if they are perfectly
capable of supporting it on its own. This is due to the nature of combining
the functionality with 2 different generation system where the older system
(i.e. eNB) does not support UP integrity protection. In other words, gNB is
being forced to \"bid down\" to a lower capability due to the presence of eNB.
### 5.4.2 Network options affected
This key issue is applicable to the following network options:
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 5.4.3 Threat description
In the MR-DC solution, gNB is forced to not to use UP integrity protection in
some scenarios due to the combined use of eNB which does not support UP
integrity protection. This situation brings the gNB down to the same level of
vulnerability as in LTE although 5G system by itself is capable of UP
integrity protection.
### 5.4.4 Potential security requirements
No potential security requirements for this key issue are addressed in the
present document.
## 5.5 Key Issue #5: Optionality of integrity protection in UP DRB with 5GC
### 5.5.1 Issue description
In the security architecture for 5G in TS 33.501 [4] the use of UP IP is
specified. This is an improvement over LTE in light of the attack mentioned
above ([5]). As specified in TS 23.501 [12], whether or not to use, UP IP in
5G system is controlled, on a PDN basis, by the (home) SMF based on parameters
received from the UDM in the HPLMN. This HPLMN control is available even with
Local BreakOut in the VPLMN. The capabilities of the VPLMN and the capability
of the UE (as some UEs has a limitation in terms of the data rate it can
support the UP IP in DRB limited to \"64Kbps\" in TS 33.501 [4]) then
determine whether the PDN is established or not. This indicates that the
**inadequate support of UP IP will continue to persist** as long as UEs with
limited UP IP support exist, irrespective of new UE appearing to make it a
\"non-issue\". However, with 5GS, the HPLMN remains in control of UPIP in a
manner that is different to the HPLMN\'s influence over the VPLMN\'s
encryption policy.
The use of UP IP is home network operator-dependent policy, thus optional for
the network to enable for a PDU session. If the home network operator sets the
policy to disable the UP IP for some reason (service-dependent policy, e.g.
online Gaming, etc.), then the attack (ALTER attack) discussed in [5] is
possible.
When encryption is used with no integrity protection, the attacker still could
modify the UP packet. In the aLTEr attack mentioned in [5], an active attack
called \"user data redirection\" is proposed. The attacker can modify the
content of a packet if he knows the original plain text, even the packet is
encrypted. In the case of DNS packets, the attacker can easily guess or find
out the destination address of the original DNS server so the attacker can add
a specific offset to redirect to a DNS server under the adversary\'s control.
This is possible because the data is encrypted in a stream cipher mode, where
the encryption algorithm is used as a keystream generator, and the ciphertext
is computed by XORing the keystream with the plaintext.
As a result, UEs will continue to be vulnerable to potential attack exploiting
the same vulnerability with LTE as discussed in [5] and also for the services
where the home network operator sets the policy to disable the UP IP. In other
words, as long as optionality of the UP IP exists in the system, the attack
such as [5] continues to be relevant in 5G system as well, but only if the
HPLMN chooses to allow this vulnerability.
### 5.5.2 Network options affected
This key issue is applicable to the following network options:
\- Option 2 - NR standalone with 5G Core
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G core with eUTRA
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 5.5.3 Threat description
Inadequate support of UP IP will continue to persist as long as the
optionality of the UP IP exists in the system. UEs not supporting UP IP at
full data rate or no support of UP IP for a particular PDU session, will
continue to be vulnerable to potential attacks exploiting the same
vulnerability as described in [5]. In other words, as long as the optionality
of the UP IP exists in the system, the attack such as [5] continues to be
relevant in both 5GS and EPS.
### 5.5.4 Potential security requirements
The 5G system should support solution(s) to mitigate the threat mentioned in
clause 5.5.3, when the integrity protection of a PDU session is not activated
due to UE capability limitations or home network policy.
## 5.6 Key Issue #6: UE connected to 5GC indicating support of UP IP over
eUTRA
### 5.6.1 Issue description
According to TS 33.501 [4], an NR UE and a gNB connected to 5GC, are mandated
to support UP IP in NR PDCP. The use of UP IP between the UE and the gNB when
connected to a 5GC is optional though. The enforcement whether to use UP IP or
not, is determined by the 5G Core Network.
The eUTRA UE needs to be able to indicate to the 5GC whether it supports UP IP
over eUTRA. Solutions to this key issue should specify how to do this.
### 5.6.2 Network options affected
This key issue is applicable to the following network options:
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G core with eUTRA
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 5.6.3 Threat description
If the network is not informed whether the UE connected to the 5GC supports UP
IP over eUTRA, it may not be possible to use UP IP in this case, i.e.
sensitive user plane traffic may not be integrity protected.
### 5.6.4 Potential security requirements
The 5G system shall support a mechanism for the UE connected to 5GC to
indicate support of UP IP over eUTRA.
## 5.7 Key Issue #7: Ensuring UP IP is enforced at interworking
### 5.7.1 Issue description
At interworking from 5G to LTE, there is a security issue if the 5G network
moves data bearers that require integrity protection to a base station
connected to EPC that cannot support integrity protection. This issue is
currently prevented from happening by the following requirement in clause
5.10.3 of TS 23.501 [12]:
\- In the case of mobility with N26 to EPS, the source NG-RAN ensures that a
PDU Session with UP integrity protection of the User Plane Security
Enforcement information set to Required is not handed over to EPS.
In UEs mobility from 5G to LTE, it is necessary to ensure that UP IP will be
applied to bearers that required UP IP in 5G when UP IP is supported at the
target RAN node and such bearers are moved to EPS. Similarly it needs to be
ensured that such bearers are integrity protected on the return to the 5G
network.
### 5.7.2 Network options affected
This key issue is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 5.7.3 Threat description
User plane traffic that requires integrity protection may be sent without
integrity protection.
### 5.7.4 Potential security requirements
The interworking between EPS and 5GS shall ensure that integrity protection is
applied to user bearers that require integrity protection.
## 5.8 Key Issue #8: HPLMN Control of UP IP usage in EPC
### 5.8.1 Issue description
Addition of UPIP to EPC is an improvement over LTE in light of the attack
mentioned above ([5]).
When encryption is used with no integrity protection, the attacker still could
modify the UP packet. In the aLTEr attack mentioned in [5], an active attack
called \"user data redirection\" is proposed. The attacker can modify the
content of a packet if he knows the original plain text, even the packet is
encrypted. In the case of DNS packets, the attacker can easily guess or find
out the destination address of the original DNS server so the attacker can add
a specific offset to redirect to a DNS server under the adversary\'s control.
This is possible because the data is encrypted in a stream cipher mode, where
the encryption algorithm is used as a keystream generator, and the ciphertext
is computed by XORing the keystream with the plaintext.
Mechanisms (e.g. similar to those in 5GS) to allow the HPLMN to enforce the
use of UPIP need to be investigated.
### 5.8.2 Network options affected
This key issue is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 5.8.3 Threat description
If the HPLMN cannot enforce the use of UPIP, then they cannot guarantee
protection for their subscribers against the threat mentioned in [5].
### 5.8.4 Potential security requirements
The EPS should support solution(s) to mitigate the threat mentioned in clause
5.8.3.
# 6 Potential Solutions
## 6.1 Solution #1: Dedicated PDU for UP Signalling message IP
### 6.1.1 Introduction
This solution addresses key issue #5 (Optionality of integrity protection in
UP DRB). This solution covers the integrity protection of the UP signalling
messages, when the integrity protection of a PDU session is not activated due
to UE capability limitations or serving network policy, using a dedicated
integrity protection enabled PDU session.
There is impact to the UE and the AMF, to establish a dedicated integrity
protection enabled PDU session.
### 6.1.2 Network options affected
This solution is applicable to the following network options:
\- Option 2 - NR standalone with 5G Core
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
### 6.1.3 Solution description
The network configures a special DNN for exchange of secure user plane
signalling messages. The UE initiates an PDU session establishment procedure
to establish a separate PDU session exclusively for the user plane signalling
messages and the network enables integrity protection for the PDU session. The
user plane signalling messages means, for example DNS message exchanges over
the UP, which requires integrity protection. Even though, the integrity
protection of a PDU session is not activated due to UE capability limitations
or serving network policy for a PDU session, protection of sensitive protocol
message (for example, DNS exchanges) can be achieved using the dedicated PDU
sessions which serves low data rate signalling exchanges, as shown in Figure
6.1.3-1.
The UE identifies/decides to send particular IP packet (UP signalling
messages) over the established PDU session, based on at least one of the
following Traffic Filtering information:
\- application layer protocol (for example: DNS).
\- Transport layer port numbers.
\- Destination IP address and/or source IP address.
Figure 6.1.3-1: Dedicated PDU for UP Signalling message IP
### 6.1.4 Solution evaluation
This solution enables the integrity protection of the UP signalling messages,
when the integrity protection of a PDU session is not activated due to UE
capability limitations, using a dedicated integrity protection enabled PDU
session. With the solution the key issue #5 (Optionality of integrity
protection in UP DRB) is addressed.
The impact to the UE and the AMF is to have a new DNN configuration and it can
be done as part of URSP procedure or other mechanisms, for the establishment
of a dedicated integrity protection enabled PDU session, to protect the
sensitive message exchanges (for example, DNS exchanges).
This solution is applicable for resource constraint Rel-15 and Rel-16 UEs,
which can support integrity protection of sensitive application layer
signalling messages (like DNS messages) only and does not support integrity
protection of other non-signalling UP traffic.
NOTE: This solution assumes that all sensitive application layer signalling
traffic are confined to 64 kbps.
## 6.2 Solution #2: Integrity protection between SgNB and UE in NGEN-DC
### 6.2.1 Introduction
This solution addresses key issue #4.
In NGEN-DC scenario, in which the CN is 5GC, MN is eNB, and SN is gNB. When
the UP security policy indicates UP integrity protection is \"preferred\",
then the MN (MeNB) always deactivates UP IP. The SN (SgNB) always deactivates
the UP IP of any PDU session terminated at the SN. This lead to the result
that even though the UP policy is set to preferred, the PDU session is still
not integrity protected between SgNB and the UE.
However, this issue can be solved through implementation way. This above issue
happens in the split PDU session scenario, where some of the DRB(s) is
terminated at the MN and some DRB(s) is terminated at the SN, the MN ensures
that all DRBs which belong to the same PDU session have the same UP integrity
protection and ciphering activation. If the network needs to protect the DRB
terminated at the SgNB, it can choose to not split the PDU session.
### 6.2.2 Network options affected
This solution is applicable to the following network options:
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 6.2.3 Solution description
According to TS 37.340 [6] and TS 38.413 [7], The 5GC provides two UL TEID
addresses during PDU Session Resource Setup, to be applied as the first UL
tunnel on the NG-U interface and the additional NG-U tunnel in case the MN
decides to split the PDU session. In this message, the _Security Indication_
IE is included in the _PDU Session Resource Setup Request Transfer_ IE of the
PDU SESSION RESOURCE SETUP REQUEST message, and the _Integrity Protection
Indication_ IE or _Confidentiality Protection Indication_ IE is set to
\"required\", then the NG-RAN node performs user plane integrity protection or
ciphering, respectively, for the concerned PDU session. If the NG-RAN node
cannot perform the user plane integrity protection or ciphering, it rejects
the setup of the PDU session resources with an appropriate cause value.
Before MN decides to split the session or not, it already knows whether this
PDU session needs integrity protection or not. If MN prioritize the security,
it makes decision based on the _Security Indication_ IE as following:
\- If the _Security Indication_ IE is set to \"required\", MN never decides to
split the PUD session, but load all the DRB to SgNB to achieve the integrity.
\- If the _Security Indication_ IE is set to \"preferred\", and security has
higher priority in this MN, then MN never decides to split the PDU session,
but load all the DRB to SgNB to achieve the integrity.
\- If the _Security Indication_ IE is set to \"preferred\", and security has
lower priority in this MN, then MN may still decide to split the PUD session.
\- If the _Security Indication_ IE is set to \"not needed\", MN may decide to
split the PUD session.
NOTE: This solution needs to be aligned with TS 33.501 [4].
### 6.2.4 Solution evaluation
Note: This solution has not been evaluated.
## 6.3 Solution #3: Improved MR-DC bearer handling
### 6.3.1 Introduction
This solution addresses KI #4, Integrity protection capability imbalance in
enodeB connected to 5GC.
This solution introduces enhancement to the bearer establishment and offload
behaviour in Rel.15 in MR-DC scenarios. Scenarios where Rel.15 behaviour
dictates suboptimal handling are addressed in such a way that the UP IP is
activated whenever possible.
This solution affects the bearer establishment and offload decision in MN.
### 6.3.2 Network options affected
This solution is applicable to the following network options:
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 6.3.3 Solution description
In Rel-15 MR-DC handling of UP IP, there are certain constraints exist.
Specifically:
1\. In NGEN-DC scenario and UP security policy is \"required\", then the MN
(eNB) rejects bearer establishment.
2\. In NGEN-DC scenario and UP security policy is \"preferred\", then the MN
(eNB) establishes bearer without UP IP.
3\. In NE-DC scenario and UP security policy is \"preferred\", then the MN
(gNB) activates the bearer with or without UP IP. When UP IP is activated,
then the MN does not offload bearer to the SN (eNB).
In all of the above scenarios, it is possible to introduce improvements to:
i) accept bearer establishment instead of rejecting it (case 1);
ii) select whether to activate UP IP or not (case 2, 3).
The improvement is described in Table 6.3.3-1 below. In all of these cases,
these improvements alleviate the existing constraints in Rel.15 and introduces
more cases where UP IP is activated in the bearer, enhancing the overall
security of the user plane.
Table 6.3.3-1: Improvement of MR-DC handling over Rel.15 behaviour
+------+-------------------+-------------------+-------------------+ | Case | Scenario | Per Rel.15 MR-DC | Improvement in | | | description | bearer handling | this solution | +======+===================+===================+===================+ | 1 | NGEN-DC scenario | The MeNB rejects | The MeNB | | | (MN=eNB, SN=gNB) | bearer | establishes | | | and UP IP CN | establishment. | bearer and | | | security policy = | | immediately | | | \"required\" | | offloads it to | | | | | SgNB. The MeNB | | | | | instructs the | | | | | SgNB to activate | | | | | UP IP. The SgNB | | | | | accepts the | | | | | bearer with UP | | | | | IP. | +------+-------------------+-------------------+-------------------+ | 2 | NGEN-DC scenario | The MeNB | The MeNB | | | (MN=eNB, SN=gNB) | establishes | establishes | | | and UP IP CN | bearer without | bearer either | | | security policy = | (i.e. | with or without | | | \"preferred\" | deactivating) UP | UP IP. | | | | IP. Bearer can be | | | | | offloaded to the | If the MeNB | | | | SgNB. In this | establishes | | | | case, the SgNB | bearer with UP | | | | accepts bearer | IP, the MeNB | | | | offload from MeNB | immediately | | | | without UP IP. | offloads it to | | | | | SgNB. The MeNB | | | | | instructs the | | | | | SgNB to activate | | | | | UP IP. The SgNB | | | | | accepts the | | | | | bearer with UP | | | | | IP. | | | | | | | | | | If the MeNB | | | | | establishes | | | | | bearer without UP | | | | | IP, the MeNB can | | | | | offload it to | | | | | SgNB. The MeNB | | | | | instructs the | | | | | SgNB to activate | | | | | UP IP. The SgNB | | | | | accepts the | | | | | bearer optionally | | | | | with UP IP. | +------+-------------------+-------------------+-------------------+ | 3 | NE-DC scenario | If the MgNB | If the MgNB | | | (MN=gNB, SN=eNB) | activates bearer | activates bearer | | | and CN UP IP | with UP IP, the | with UP IP, the | | | security policy = | MgNB does not | MgNB may offload | | | \"preferred\" | offload bearer to | the bearer to the | | | | the SeNB. | SeNB. The SeNB | | | | | accepts the | | | | If the MgNB | bearer without UP | | | | activates without | IP. | | | | (i.e. | | | | | deactivating) UP | If the MgNB | | | | IP, the MgNB can | activates without | | | | offload bearer to | (i.e. | | | | the SeNB. The | deactivating) UP | | | | SeNB accepts the | IP, the MgNB can | | | | bearer offload | offload bearer to | | | | without UP IP. | the SeNB. The | | | | | SeNB accepts the | | | | | bearer offload | | | | | without UP IP. | +------+-------------------+-------------------+-------------------+
Note 1: The termination point of offloaded bearers needs to be clarified.
NOTE 2: additional detail on bearer establishment and offload needs to be
described.
### 6.3.4 Solution evaluation
NOTE: This solution has not been evaluated.
## 6.4 Solution #4: Zero-overhead user plane integrity protection on the link
layer
### 6.4.1 Introduction
Existing attacks on UP-IP require a man-in-the-middle (MitM) relay that is
located between UE and eNB. The MitM relay receives packets from the UE/eNB,
modifies them, and forwards them towards eNB/UE. Thus, techniques that defeat
MitM relay attacks defeat also attacks on UP-IP. The \"Zero-overhead user
plane integrity protection on the link layer\" solution does this -- it
defeats MitM relay attacks -- by replacing the CRC associated to each
transport block in L2 by a cryptographic CRC denoted CRC\' and linked to the
transport block **_identity_** itself. By doing this, an attacker cannot
receive a packet, process and modify it, and forward it in a later transport
block since this changes the transport block _identity_ used, and thus, the
verification of the cryptographic CRC fails.
This solution addresses the key issue #3: \"UE support of UP IP at the full
uplink data rate\" and key issue #5: \"Optionality of integrity protection in
UP DRB\".
Key issue #3 is addressed since it provides protection against attacks on UP
IP even at full uplink data rate. Key issue #5 is addressed since this
protection is applied to all UP DRBs.
The proposal is to use a cryptographic CRC instead of the regular CRC in
Transport Blocks on the user plane.
This solution reduces the overhead of integrity protection to ZERO.
The effective user data throughput remains the same as without the integrity
protection.
The error behaviour of the Link layer remains exactly the same as without the
proposed integrity protection.
This solution requires the addition of the computation of a MAC over or the
encryption of 128 bits per CRC in a Transport Block so per 6.144 bits, which
is a reduction of about a factor 50 in the amount of computations required for
the UP IP of a PDCP packet. It can therefore be used at full uplink data rates
and is a solution to key issue 3.
With this solution, all Transport Blocks independent of the data rate can be
integrity protected, so automatically, all PDCP packets become integrity
protected and the integrity protection does not have to be a serving network
operator-dependent policy anymore, which solves the UP IP optionality KI#5.
**Some background**
\- A Transport Block is defined as the basic data unit exchanged between L1
and MAC. An equivalent term for Transport Block is \"MAC PDU\".
\- Each Transport Block has a CRC over the total TB. Most TBs, including User
Data TBs, have a 24-bit CRC.
\- Transport Blocks are subdivided in Code Blocks if larger than 6144 bit.
Each CB has its own 24-bit CRC.
\- A Resource Block pair is the unit for the scheduling of resources by the
base station.
\- One Resource Block consists of 12 successive OFDM sub-carriers in frequency
and one slot of 0.5 millisecond in time
72 or 84 OFDM symbols per RB of 1 to 10-bit each.
\- A Resource Block pair consists of the two successive RBs in the two
successive slots of a subframe of 1 millisecond.
\- If a Transport Block is larger than a Resource Block pair, more RB pairs
are added in the frequency direction.
Each TB is limited to a subframe of 1 millisecond.
\- TBs with an incorrect CRC are discarded by the receiver and a
retransmission is requested (Hybrid Automatic Repeat-Request (HARQ)).
\- An LTE frame consists of 10 subframes.
{width="6.683333333333334in" height="3.9791666666666665in"}
Figure 6.4.1-1: LTE packet structure relating PDCP packets to Transport Blocks
### 6.4.2 Network options affected
This solution is applicable to the following network options:
\- Option 2 - NR standalone with 5G Core
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 6.4.3 Solution description
It is proposed to use a cryptographic version of the CRC in every user
Transport Block.
This can be achieved by replacing the 24-bit CRCs in a Transport block by
24-bit CRC\'s as computed by
CRC\' = truncate { 24, HMAC( K, CRC \| TransportBlockID) } (1)
or
CRC\' = truncate { 24, Encrypt( K, CRC \| TransportBlockID) } (2)
In addition, the CRCs of the Code Blocks inside a TB may also be replaced by
their cryptographic versions.
Encryption requires probably less effort than HMAC. The encryption is done in
ECB mode. A truncated encryption is OK, the truncated encryption serves as a
CRC. Both sender and transmitter compute the CRC\' using truncated encryption
of equation (2). The transmitter puts the computed CRC\' at the CRC field of
the TB. The receiver computes it too according to equation (2) and compares
this with the CRC\' value in the CRC field of the received TB. If they are the
same, the integrity protection check passes, else it fails. Therefore, because
there is no decryption required, only checking whether truncated encryptions
are the same or not.
Mobility problem (different key per gNB)
The key K to use is derived from a master key such that the derivation is
dependent on the gNB or the DU inside the gNB. The master key is different for
each UE (or UICC/USIM), but is used only for the UPIP functionality in this
solution. gNBs or DUs get provisioned with the key K derived for them. The UE
(or UICC/USIM) is provisioned with the master key and does the derivation of
the key K itself.
Rekeying of the master key
The master key needs to be rekeyed before the time dependent part of
TransportBlockID rolls over. An HSFN + 11 extra bits leads to a roll-over
every 1.4 year.
Bundling of PDCP-PDUs
The master key and the key K are not dependent on the content of a TB, i.e.
the PDCP-PDUs that are carried inside that TB.
Dual connectivity (split bearer) situation
In case of dual connectivity (split bearer), TBs that are sent over a bearer
that does support this solution are integrity protected, while TBs that are
sent over a bearer that does not support this solution are not protected.
The TransportBlockID is used to prevent an attacker to collect entries for a
CRC -> CRC\' dictionary.
Requirements for the TransportBlockID are the following two.
1\. TransportBlockID should be different for different slots or subframes.
2\. TransportBlockID should be different for TBs of the same user in the same
slot or subframe.
Candidates for requirement 1 that are simple to retrieve by both UE and eNodeB
may be:
\- the subframe number (0 - 9) that the TB starts in;
\- the System Frame Number (SFN) (0 - 1023) that the TB starts in (repeats
every 10.24 seconds);
\- the hyper-SFN (HSFN) (0 - 1023) that the TB starts in (repeats about every
3hours; the HSF is also used as part of the COUNT in the PDCP integrity
protection);
\- a new sequence number similar to the hyper-SFN (HSFN) and made available in
a system message to all devices in a cell similar to the way the HSFN or the
SFN is made known (HSFN + 11 extra bits leads to a roll-over every 1.4 year);
\- a new sequence number made available through an AS secured RRC message;
\- a Radio Network Temporary Identifier (RNTI), either existing or new one,
only known to the UE and the gNB, that gets updated frequently;
\- the length of the TB;
\- the slot number (0 or 1) of the slot the TB starts in (?);
\- etc.
Candidates for requirement 2 that are simple to retrieve by both UE and eNodeB
may be:
\- indication of uplink or downlink bit;
\- indication whether the CRC/CRC\' is for the entire TB or for a Code Block
(sub part of TB with its own CRC);
\- CB number in case the CRC/CRC\' is for a CB;
\- indication whether the TB is the first (0) or second (1) TB to/from a
device in this subframe;
\- lowest (or highest) frequency of all sub carriers used for the entire TB;
\- number of subcarriers and/or Resource Blocks used for the entire TB;
\- number of the spatial stream or the antenna port number in case of spatial
multiplexing;
\- carrier indicator indicating the carrier this TB is transferred on in case
of carrier aggregation;
\- PLMN ID, or Cell Identity;
\- Evolved Cell Global Identifier = PLMN ID concatenated with the Cell
Identity;
\- physical layer cell identity (0 - 503);
\- base station name (eNodeB name) as transmitted in the System Information
Block 9 (SIB9);
\- etc.
Control of the Transport Block level integrity protection provided by this
solution.
When the system wants to use the UP-IP at the Transport Block level of this
solution between a certain UE and gNB, it starts a PDCP entity just for this
purpose, while using one integrity algorithm identifier of a set of new
integrity algorithm identifiers in the integrityProtAlgorithm attribute in the
SecurityAlgorithmConfig information element (clause 6.3.3 of TS 36.331 [9]),
see \"Negotiation of UP-IP\" below. Any of the existing ciphering algorithm
identifiers can be used for the cipheringAlgorithm attribute.
This PDCP entity, as any other PDCP entity, may be used for the transfer of IP
packets. All of these packets are integrity protected at the Transport Block
level.
When the system wants to use different bearers, with different policies and
QoS, etc., it can do so as it was used to. But when the system starts a PDCP
entity with one of the new nia4, nia5, nia6, nia7 integrity algorithm
identifiers, all Transport Blocks to and from the UE are going to use the
cryptographic CRC. This does not influence the data rates/QoS of the other
PDCP entities. In case another PDCP entity did not use PDCP UP-IP protection,
it has now UP-IP based on the cryptographic CRC. In case it already had PDCP
UP-IP, it now also has UP-IP based on the cryptographic CRC at the TB level.
If performing cryptographic CRC is not desired for all user plane data (even
though this is identified as possibly problematic in KI#5), then the security
policy per PDU session may be extended to include a flag which indicates
whether to apply cryptographic CRC or not. A UE that supports multiple MAC
entities (as described in TS 38.321), which the UE may already have in order
to support e.g. multi-RAT connections or dual connectivity, can use one MAC
entity to serve all PDU sessions with integrity protection switched on, and
another MAC entity to serve all PDU sessions with integrity protection
switched off. If a UE that does not support multiple MAC entities wants to
establish an additional PDU session, and the additional PDU session has a
different value for cryptographic CRC in the security policy as the already
established PDU session(s), then the UE may choose to wait or cancel the
additional PDU session until the existing PDU session is torn down and the MAC
entity becomes available, and may inform the user that the additional PDU
session cannot be established due to device limitations. Alternatively, the
AMF can be made aware of such device limitation and update the security policy
such that the UE will change to using PDCP based integrity protection instead
of using cryptographic CRC, possibly at a lower data rate, due to overhead
that this may bring.
Negotiation of UP-IP
The application of this solution can be negotiated and controlled with the
same procedures as those for the PDCP integrity protection with the following
extensions for NR. Similar extensions may be made for E-UTRA.
\- The F1-C interface is extended with one or more new messages to supply the
DU with the required information for the integrity protection of this
solution.
\- The list of integrity algorithm identifiers in clause 5.11.1.2 of TS 33.501
[4] is extended with one or more of the following values:
\- \"0100~2~\" 128-NIA4 128-bit SNOW 3G based algorithm using equation (2)
above in ECB mode;
\- \"0101~2~\" 128-NIA5 128-bit AES based algorithm using equation (2) above
in ECB mode;
\- \"0110~2~\" 128-NIA6 128-bit ZUC based algorithm using equation (2) above
in ECB mode; and/or
\- \"0111~2~\" 256-NIA7 HMAC-SHA256 based algorithm using equation (1) above.
\- The list of integrity algorithm identifiers in the integrityProtAlgorithm
attribute in the SecurityAlgorithmConfig information element (clause 6.3.3 of
TS 36.331 [9]) is extended with the same new value(s) as the ones in the
previous bullet.
\- The _integrityProtAlgorithm_ enumeration in the IE
_SecurityAlgorithmConfig_ in clause 6.3.2 of TS 38.331 [8] is extended with
nia4, nia5, nia6, and/or nia7, consistent with the extension of the list of
integrity algorithm identifiers as described the bullet above.
Consequence of UP-IP termination in the DU
Since the negotiation of the application of this solution is done in the PDCP
layer, but the application itself in the DU, the F1-C interface is extended
with one or more new messages to supply the DU with the required information
for the integrity protection of this solution.
This solution provides integrity protection between the UE and the DU. The
integrity protection can be extended to the CU, by applying IPsec on the F1-U
interface, as specified in clause 9.8.2 of TS 33.501 [4].
Since the key K is part of the information to be sent on the F1-C interface to
the DU, the security mechanisms as specified in clause 9.8.2 of TS 33.501 [4]
for the F1-C interface need to be applied as well.
The contents of a TB with an incorrect cryptographic CRC is blocked by the DU
from further transmission to the CU.
Key hierarchy and key management
The key K in equation (1) or (2) above can be taken as the key K~UPint~ as
specified in TS 33.501 [4].
However, this would mean that PDCP UP-IP and the integrity protection of this
solution cannot be used at the same time. Therefore, a new key K~TBint~ may be
defined in TS 33.501 [4] that is managed and derived in the same way as
K~UPint~ except that a value of 0x07 is used for the algorithm type
distinguisher in clause A.8 of TS 33.501 [4] instead of 0x06.
### 6.4.4 Solution evaluation
The impact on the protocol stack (PHY + MAC + RRC)
The PHY in the UE and in the DU needs to be extended with means to generate
the CRC\' in outgoing Transport Blocks and means to check the CRC\' of
incoming Transport Blocks according to equations (1) and/or (2) above. This
means that for every CRC computed, an additional HMAC needs to be computed if
equation (1) is used or one encrypted value needs to be computed if equation
(2) is used.
Since the cryptographic CRC computation is based on the (linear) CRC itself,
XOR-ing a TB that is protected with the cryptographic CRC with a TB with a
zero-valued CRC will lead to a TB that passes the integrity check.
The PHY in the UE needs to be extended with means to receive the information
required to apply and cease to apply the integrity protection of this solution
from the RRC layer in the UE.
The PHY in the DU and the RRC in the CU need to be extended with means to
exchange the information required to apply and cease to apply the integrity
protection of this solution using one or more new messages over the F1-C
interface. Since the key K is part of this information, the security
mechanisms as specified in clause 9.8.2 of TS 33.501 [4] for the F1-C
interface need to be applied.
The RRC in the UE and CU need to be extended with the new integrity algorithm
identifier(s) specified for this solution.
There is no change required in the MAC, but it may be desirable for a UE to
support multiple MAC entities..
The integrity protection strength of this solution is less than that of the
PDCP MAC, namely 24 bit instead of 32 bit.
The security properties of using the cryptographic CRC as an integrity
protection have not been evaluated.
This solution addresses the key issue #3: \"UE support of UP IP at the full
uplink data rate\" and key issue #5: \"Optionality of integrity protection in
UP DRB\".
The proposal is to use a cryptographic CRC instead of the regular CRC in
Transport Blocks on the user plane.
This solution reduces the overhead of integrity protection to ZERO.
The effective user data throughput remains the same as without the integrity
protection.
The error behaviour of the Link layer remains exactly the same as without the
proposed integrity protection.
This solution requires the addition of the computation of a MAC over or the
encryption of 128 bits per CRC in a Transport Block so per 6.144 bits, which
is a reduction of about a factor 50 in the amount of computations required for
the UP IP of a PDCP packet. It can therefore be used at full uplink data rates
and is a solution to key issue 3.
With this solution, all Transport Blocks independent of the data rate can be
integrity protected, so automatically, all PDCP packets become integrity
protected and the integrity protection does not have to be a serving network
operator-dependent policy anymore, which solves the UP IP optionality KI#5.
## 6.5 Solution #5: Integrity Protection of packet header in the User Plane
### 6.5.1 Introduction
This solution addresses key issue #5 (Optionality of integrity protection in
UP DRB). The solution only protects the integrity of the packet header when
data rate is over 64 kbit/s.
### 6.5.2 Network options affected
This solution is applicable to the following network options:
\- Option 2 - NR standalone with 5G Core
### 6.5.3 Solution description
The protocol stack of the user plane in 5G network differs from the protocol
stack of the user plane in 4G network in that a Service Data Adaptation
Protocol (SDAP) is added as shown in the Figure 6.5.3-1. The role of SDAP [2]
is to map the QoS flow to the Data Radio Bearer (DRB) and mark the QoS flow
identifier (ID) in the SDAP header. It provides a finer-grained management of
QoS than LTE with respect to the user plane data.
Figure 6.5.3-1: Protocol stack
After the user plane packet is encapsulated, the PDCP layer packet format is
as follows:
Figure 6.5.3-2: Packet format in the PDCP layer
Where H~PDCP~ is the header of PDCP layer, H~SDAP~ is the header of the SDAP
layer, and H~data~ is the header of the packet. The PDCP sequence number (PDCP
SN) in the H~PDCP~ is part of the packet count value COUNT. To protect the
header of the packet, the following parameters are input to the integrity
function (e.g. NIA1) to produce MAC-I.
\- COUNTï¼Œ
\- MESSAGE
\- DIRECTION
\- BEARER
\- KEY
Where MESSAGE is to be integrity protected, which is the cascade of the
H~SDAP~ and H~data~.
### 6.5.4 Solution evaluation
The proposed scheme can be evaluated in context of security, efficiency, and
compatibility as follows:
**Security**
The proposed scheme addresses key issue #5 (Optionality of integrity
protection in UP DRB) by integrity protecting the header part of the PDCP
data. Besides the packet header of UP IP signalling messages (DNS query
packets), the subsequent IP header of the data are integrity protected.
Moreover, the packet headers for some applications that does not have DNS
query procedure are also integrity protected. As a result, the attacks that
wants to route the packets to a wrong destination by modifying the packet
header can be prevented. However, this solution does not protect the whole
packet, thus the modification on the payload part could not be mitigated.
**Efficiency**
This solution provides a means to integrity protect IP header part of the PDCP
data payload. The proposed scheme is more efficiency than the scheme specified
in TS 33.501 [4]. This is because only the packet header is integrity
protected, while the whole packet is integrity protected in TS 33.501 [4].
However, the PDCP layer needs to look inside the PDCP payload to determine the
payload type (e.g., non-IP, IPv4 or IPv6) and this adds additional overhead.
**Compatibility**
This solution faces difficulty to implement as PDCP layer could not identify
the type of upper layer data. It could neither recognize whether the data is
IP packet or non-IP packet, nor whether IP packet is IPv4 packet or IPv6
packet. That means it is hard to define which part of PDCP head should be
integrity protected.
## 6.6 Solution #6: Addition of UP IP for eUTRA with 5GC
### 6.6.1 Introduction
To protect user plane communication reliably in Options 4, 5 and 7 and to
maintain compatibility with NR, this solution describes the addition of User
Plane integrity protection to eUTRA in a similar way to the 5G implementation.
### 6.6.2 Network options affected
This solution is applicable to the following network options:
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G core with eUTRA
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 6.6.3 Solution description
The clauses regarding user plane integrity protection for eUTRA are added as
detailed for NR in TS 33.501[4].
### 6.6.4 Solution evaluation
NOTE: This solution is not evaluated.
## 6.7 Solution #7: UE connected to 5GC indicating support of UP IP over eUTRA
### 6.7.1 Introduction
This solution addresses key issue #6 (UE connected to 5GC indicating support
of UP IP over eUTRA). This solution describes how the UE provides its
capability to the network to indicate that it supports UP IP over eUTRA when
connected to 5GC.
According to TS 33.501 [4], UP IP is mandatory to be supported for the gNB and
the UE., The UE indicates its capability for maximum data bitrate for UP IP
over NR to the 5G network in NAS layer. Its FFS whether this capability
applies to eUTRA supporting UP IP as well or whether a new capability is
required for eUTRA.
As UP IP in a ng-eNB connected to 5GC is currently not specified in TS 33.501
[4], this implies that even if a UE would have supported UP IP over eUTRA,
there was no possibility for a UE to test UP IP over eUTRA in any live 5G
network, therefore its envisioned that a UE has not enabled UP IP over eUTRA
(connected to a 5GC). A capability indication is required for a UE which
supports UP IP over eUTRA (connected to a 5GC) in order for a network to be
able to distinguish between a UE which cannot enable UP IP over eUTRA and a UE
which can enable UP IP over eUTRA.
This solution assumes that the UE has been upgraded to support UP IP over
eUTRA connected to 5GC. It also assumes that the ng-eNB supports UP IP and
supports the capability of enabling UP IP with the UE over eUTRA.
There is impact on UE, SMF, AMF and ng-eNB/gNB.
### 6.7.2 Network options affected
This solution is applicable to the following network options:
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G core with eUTRA
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 6.7.3 Solution description
#### 6.7.3.1 Signalling flows
##### 6.7.3.1.1 PDU Session Establishment Request procedure in 5G system
The UE initiates the PDU Session establishment procedure with the SMF, via the
AMF, to establish data bearers with the network. If the UE supports UP IP over
eUTRA when connected to a 5GC, then the UE includes its capability to support
UP IP over eUTRA in the PDU Session Establishment Request message to the SMF.
Figure 6.7.3.1.1-1: UE indicating support of UP IP over eUTRA when connected
to 5GC
1) UE initiates PDU Session Establishment procedure with the SMF to establish
bearers with the network and includes its capability to support UP IP over
eUTRA when connected to 5GC into PDU Session Establishment Request message.
2) The SMF initiates the N2 PDU Session Request procedure with ng-eNB/gNB and
includes the UE capability to support UP IP over ng-eNB when connected to 5GC.
The SMF also includes the UP security policy.
3) The ng-eNB/gNB initiates RRC Reconfiguration procedure with the UE and
indicates to the UE to activate UP integrity protection for the DRBs (data
radio bearers) established with the ng-eNB/gNB.
#### 6.7.3.1.2 Dual connectivity
If a ng-eNB acting as a MN receives the UE capability from the 5GC indicating
that the UE supports UP integrity protection over eUTRA, then the MN takes
that capability into consideration together with the UP security policy, when
it makes the decision whether to activate UP integrity protection for its own
DRB\'s established with the UE.
For the scenario when \'no split PDU session\' takes place, the handling of
the UP security policy should be the same as for as described in clause
6.10.2.1 in TS 33.501 [4].
In the scenario of \'no split PDU session\' when MN offloads DRB(s) for a PDU
session to a ng-eNB acting as a SN, there are two options to consider as
described below.
ALTERNATIVE 1:
The MN determines from the UP security policy and the UE capability indicating
that the UE supports UP integrity protection over eUTRA, both received from
the 5G Core Network, and also the capability of the SN i.e. whether it
supports UP IP or not, before the MN decides to offload any DRB(s) of the PDU
Session to the SN which requires UP integrity protection.
ALTERNATIVE 2:
The MN forwards the UE capability indicating that the UE supports UP integrity
protection over eUTRA and the UP security policy, both received from the 5G
Core Network, to the ng-eNB acting as a SN. The SN will make the decision of
activating UP integrity protection or not for the PDU sessions that are
terminated at the SN.
In the scenario of \'split PDU session\' when MN offloads some of the DRB(s)
for a PDU session to a ng-eNB acting as a SN, the handling of the UP security
policy should be the same as for NR-DC as described in clause 6.10.4 in TS
33.501 [4].
### 6.7.4 Solution evaluation
The solution fulfils the requirement in key issue #6 (UE connected to 5GC
indicating support of UP IP over eUTRA).
The impact of the solution is to require the UE to indicate its support of UP
IP over eUTRA when connected to 5GC, to the ng-eNB/gNB via NAS layer. There is
impact on UE, SMF, AMF and ng-eNB/gNB.
According to TS 33.501 [4], the UE indicates its capability for maximum data
bitrate for UP IP over NR to the 5G network in NAS layer. It is out of scope
of the present document whether this capability applies to eUTRA supporting UP
IP as well or whether a new capability is required for eUTRA.
As UP IP in a ng-eNB connected to 5GC was not enabled in Rel-15, this implies
that even if a Rel-15 UE would have supported UP IP over eUTRA, there was no
possibility for a Rel-15 UE to test UP IP over eUTRA in any live 5G Rel-15
network, therefore its envisioned that a Rel-15 UE has not enabled UP IP over
eUTRA connected to a 5GC. A capability indication is required for a Rel-16 UE
which supports UP IP over eUTRA connected to a 5GC, in order for a Rel-16
eUTRA to be able to distinguish between a Rel-15 UE which cannot enable UP IP
over eUTRA and a Rel-16 UE which can enable UP IP over eUTRA. This is out of
scope of the present document.
For the scenario when \'no split PDU session\' takes place, the handling of
the UP security policy should be the same as described in clause 6.10.2.1 in
TS 33.501 [4]. The MN always forwards the UE capability including the UP
security capability and the UP security policy to the SN. The SN makes the
decision whether to activate UP integrity protection or not, and also whether
to activate UP encryption or not. Therefore, it is proposed to go forward with
alternative 2 in clause 6.7.3.1.2.
In the scenario of \'split PDU session\' when MN offloads some of the DRB(s)
for a PDU session to a ng-eNB acting as a SN, the handling of the UP security
policy should be the same as for NR-DC as described in clause 6.10.4 in TS
33.501 [4].
The ng-eNB and the 5G core network could be of different releases, e.g.:
\- a Rel-15 ng-eNB connected to a Rel-16 5G core network;
A Rel-15 ng-eNB cannot activate UP integrity protection with a Rel-16 UE
supporting UP IP over e-UTRA for any established DRB\'s with the Rel-16 UE. A
Rel-15 ng-eNB would ignore any additional capability or indication from a
Rel-16 5G core network which indicates the Rel-16 UE supports UP IP over
e-UTRA.
\- a Rel-16 ng-eNB connected to a Rel-15 5G core network;
A Rel-16 ng-eNB cannot activate UP integrity protection with a Rel-16 UE
supporting UP IP over e-UTRA for any established DRB\'s if the Rel-16 ng-eNB
is connected to a Rel-15 5G core network. A Rel-15 5G core network would
ignore any additional capability or indication from a Rel-16 UE which
indicates the Rel-16 UE supports UP IP over e-UTRA and would not be able to
indicate to the Rel-16 ng-eNB that the Rel-16 UE supports UP IP over e-UTRA).
This solution requires that both 5G core network and ng-eNB are upgraded in
order to be able to activate UP IP over E-UTRA.
## 6.8 Solution #8: Using existing 5G UE security capability to signal the UE
support of UP IP over eUTRA to 5GC
### 6.8.1 Introduction
This solution addresses key issue #6 (UE connected to 5GC indicating support
of UP IP over eUTRA).
This solution only impacts the UE and the ng-eNB.
### 6.8.2 Network options affected
This solution is applicable to the following network options:
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G core with eUTRA
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 6.8.3 Solution description
The solution is to use one of the bits that is used to indicate support of an
EEA or EIA algorithm that is currently not used in 5G UE Security Capability
IE (see 9.11.3.54 of TS 24.501 [10]) to indicate that the UE supports user
plane integrity protection with an ng-eNB.
This information element is already protected to the core network in NAS
signalling and also replayed to the UE to ensure Man-in-the-middle attacks are
avoided. It is also already signalled to the RAN nodes so would require no
additional signalling.
### 6.8.4 Solution evaluation
This solution meets the security requirement for key issue #6 and only impacts
the UE and the ng-NB as it reuses the existing NAS signalling and the
information element in a secure manner to indicate UE\'s support of user plane
integrity protection over eUTRA to the network.
## 6.9 Solution #9: Adding padding in the data part
### 6.9.1 Introduction
This solution addresses key issue #5.
The aLTEr attack mentioned in [5], an active attack called \"user data
redirection\" is proposed, in which the attacker could change the DNS packet
address even when the packet is encrypted.
The proposed issue is caused by adequate of integrity protection. When there
is no UP IP, the attacker could change the destination address even the
encryption is used. The solution is proposing to add some random length
padding, thus the attacker would not know which part is the destination
address when the validation time is limited to a tight higher bound.
### 6.9.2 Network options affected
This solution is applicable to the following network options:
\- Option 2 - NR standalone with 5G Core
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 6.9.3 Solution description
5G NR PDCP PDUs is formatted as mentioned in TS 38.323 [a] clause 6.2.2.
Hence, each PDCP data PDU will be composed of PDCP SN, data payload and an
optional 4B MAC-i payload. As per spec, data unit that is ciphered is the data
part of the PDCP Data PDU except the SDAP header if included in the PDCP SDU,
and the MAC-I.
{width="3.5631944444444446in" height="3.042361111111111in"}
Figure 6.9.3-1: PDCP data PDU format (refer to TS38.331)
In a new implementation, it is possible to add padding bytes to data part(The
data part includes the IP header and will be encrypted). These padding bytes
and the Padding Size LI can be part of the cipher payload. One example of such
an implementation is as follows:
\- One of the \"R\" bits in the PDCP header can be used to indicate if Padding
is included.
\- One of the \"R\" bits in the PDCP header can be used to indicate the whole
length of the PDU.
\- Padding Size is added at the octet \"N-4\". It can range from 0 - 255
octets. The first half is used to indicate how many bits is added before the
data part, and the second half is used to indicate how many bits is added
after the data part.
\- Non-Zero Initialized Padding Bytes (based on Padding Size) are added after
the data part of the PDCP PDU.
\- Transmit PDCP entity can determine \"randomly\" a value from 0 - 255 bytes
of padding.
In some implementations, padding size could be limited to a maximum of \"x\" %
of the original PDCP PDU to avoid wasting bandwidth. Padding could be
configured by the network in RRC Signalling.
{width="2.9298611111111112in" height="3.1125in"}
Figure 6.9.3-2: New PDCP data PDU format
With this mechanism, the attacker could not know where to put the offset since
all the data part is encrypted and the destination address is not in the first
few bits anymore. However, the attack could still try [the length of the
padding] times to verify where exactly the true data part. So the solution
could be enhanced with adding the limitation of validation times. Thus even if
the attacker does not corrupt the padding, they\'ll just end up corrupting the
SDU itself unless they guess exactly the right offset.
### 6.9.4 Solution evaluation
PDCP PDU maximum size is 9000byte, when the IP packet is less than 8744byte,
there will be no impact.
This solution doesn\'t work when confidentiality is not used.
## 6.10 Solution #10: UE activating UP IP over eUTRA to EPC
### 6.10.1 Introduction
This solution addresses KI#2 (Secure negotiation of integrity protection
support in EPS).This solution describes how the UE tells the eUTRA the support
of UP IP, and how the eUTRA activates the UP IP with the UE.
### 6.10.2 Network options affected
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.10.3 Solution description
In TS 33.401 [3], UP encryption is activated after UE successfully verifies
the integrity protection of the AS SMC message. This means that UP ciphering
is always on for UE connects to EPC via eUTRA. But for activating UP IP in
eUTRA when UE connects to EPC, the \"always on\" feature for UP integrity will
consume a lot of resources and reduce the user experience. Therefore, the
similar scheme as defined in TS 33.501 [4] is introduced, which is the eUTRA
will control whether the UP IP is activated or not. But due to the impact on
EPC should be limited, which means the MME should not be mandatory to be
upgraded to send the UP security policy to the eUTRA, so the eUTRA is based on
its configuration to decide whether the UP IP is activated or not.
The eUTRA recognizes whether the UE supporting UP IP by reading the UE
capability IE. As there are 4 reserved bits in UE capability IE, one of them
can be used by the UE to indicate whether the UP IP is supported by this UE.
If the eUTRA finds the UE supporting UP IP feature and decides the UP IP is
activated, then it will signal the UE in AS SMC.
NOTE: How the eUTRA make decisions on the UP IP policy is not addressed in the
present document.
The UE will activate the UP IP after successfully checks the integrity of AS
SMC, and the eUTRA will activate the UP IP after sending the AS SMC.
### 6.10.4 Solution evaluation
This solution is not evaluated in the present document.
## 6.11 Solution #11: Support of UP IP in EPS
### 6.11.1 Introduction
This solution addresses key issue #1 (UP integrity activation in EPS). A UE
which has been upgraded to support UP IP over LTE access, when connected to
EPS, needs to indicate UE support of UP IP to the network.
This solution impacts the UE, the MME, the HSS and the LTE eNB.
### 6.11.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.11.3 Solution description
The UE capability to support UP IP over LTE access when connected to EPS could
be indicated in Attach Request and Tracking Area Update Request message. A new
IE could be included in the Attach Request message and Tracking Area Update
Request message. The new IE would need to be mapped on the S1 interface to the
LTE eNB.
A new IE would be protected by the Hash mechanism described in TS 33.401 [3]
in order to detect bidding down attacks. If the new IE included in a
Attach/TAU Request messages is not integrity protected or if the integrity
check is not successfully in the MME, then the MME would calculate a HASH~MME~
of the entire plain Request message and include the HASH~MME~ in the integrity
protected NAS security mode command message to the UE. The UE would calculate
a HASH~UE~ from the entire plain Attach Request or TAU Request that it sent
and compare the HASH~UE~ with the received HASH~MME~.
An alternative solution could be to indicate the UE capability to support UP
IP in the PDN connection establishment request message. This message would be
protected by the regular NAS security established between the UE and the MME.
The transfer of the new IE would also have impact on S10 interface between
MME\'s. For coexistence with legacy nodes then support needs to be signalled
by the UE again during mobility procedures at MME change, but this should not
be a problem as the UE would initiate a new Tracking Area Update procedure at
MME change anyway. Also, it is not envisioned that the LTE eNB would be
upgraded, without upgrading the MME as well.
The MME could apply/request use of UP IP at PDN Connection establishment (on
par with 5GS). UP IP would then be applied per PDN connection lifetime.
The MME could configure a security policy for UP IP i.e. a UP IP policy, per
APN and/or the MME could obtain the UP IP policy by potentially retrieving a
UP IP policy for the subscription stored in the HSS or from the locally
configured UP IP policy. The UP IP policy could use similar setting options as
in 5GS: \"required\", \"preferred\", \"not needed\".
The MME provides the obtained UP IP policy per UE to the LTE eNB on the S1
interface.
When the MME is mapping an EPS bearer to an E-RAB on the S1 interface, the MME
would need to repeat the UP IP policy on the S1 interface for each EPS bearer
established for the same PDN connection.
The UP IP policy could be extended to a UP security policy which includes a
security policy for UP encryption as well. This would harmonize the feature
over both systems (EPS and 5GS).
The eNB determines whether it can comply with the UP IP policy received from
the MME i.e. if there is enough resources to enable or disable UP IP. If UP IP
policy is set to REQUIRED, then the eNB does not overrule the policy (similar
as in 5GS). If the UP IP policy is set to PREFERRED, the eNB should try to
enable UP IP. The enabling/disabling of UP IP for DRB\'s is done using AS SMC
procedure and/or RRC Reconfiguration procedure, similar as in NR.
### 6.11.4 Handling of legacy UE\'s and legacy network nodes in EPS
If the MME supports UP IP but the eNB does not support UP IP, then the legacy
eNB would ignore the Rel-17 extensions sent on the S1 interface as the UP IP
policy and the UE capability to support UP IP over LTE access when connected
to EPS.
In X2 handover in mixed environments, if the UE is handed over from a legacy
source eNB to an upgraded target eNB that supports UP IP, then the UP IP
policy will not be forwarded by the legacy source eNB to the target eNB and
the target eNB will not be able to activate UP IP even if the UE supports UP
IP. If the MME is an upgraded MME which supports UP IP, then the MME does not
receive the UP IP policy, the integrity protection result and the UE
capability indicating UP IP support in the S1-PATH-SWITCH-REQUEST message from
the target eNB to which the UE is connected to. The MME should always send the
UP IP policy and UE capability indicating UP IP support to the target eNB via
the PATH SWITCH REQUEST ACKNOWLEDGE message to the target eNB. The target eNB
should activate UP IP for the radio bearer established with the UE.
If the target eNB is a legacy eNB not supporting UP IP, then after X2 handover
when target eNB performs Path Switch procedure with the MME, an upgraded MME
which supports UP IP should send the UP IP policy and UE capability indicating
UP IP support to the target eNB in the Path Switch Request Acknowledge message
to the target eNB. The message encoding should ensure that a legacy target eNB
can ignore this information from the MME.
NOTE: Stage 3 message encoding and the meaning of \"reserved for future use\"
in TS 36.413 [z] is out of scope of the present document.
It is expected though that if the eNB is upgraded to support UP IP, then the
connected MME is upgraded as well to support the UP security policy (i.e. UP
IP). A legacy eNB which is not supporting UP IP, is most likely connected to
MME which is not supporting the UP security policy (i.e. UP IP).
**Legacy UE\'s:**
A legacy UE which establishes a new PDN connection with an upgraded MME and
eNB (to support UP IP), should be handled by the MME and the eNB in the legacy
way, and this decision could be based upon a configured operator policy. If
the configured operator policy allows the upgraded MME/eNB to handle the
legacy UE, then the MME cannot determine a UP IP policy to \"required\" as UP
IP cannot be activated by the eNB with the legacy UE. In this case the MME
should determine a UP IP policy to be set to \"not needed\".
**Legacy network nodes:**
An upgraded UE (to support UP IP), which establishes a new PDN connection with
a legacy MME, UP IP cannot be activated by the eNB (even if the eNB supports
UP IP).
**Mobility:**
At MME change (both at handover and idle mode mobility) a PDN connection with
UP IP \"required\" is deactivated if UP IP is not supported by the target
MME/target eNB or the new MME. At handover, if the source MME and the source
eNB are upgraded to support UP IP, then the source MME/source eNB ensures that
the PDN connection with activated UP IP due to a setting of UP IP to be
\"required\" is not handed over to a target MME or a target eNB which does not
support UP IP. At idle mode mobility, if the new MME is not upgraded to
support UP IP, then support UP IP over LTE IE and UP security policy is not
forwarded from the old MME to the new MME.
### 6.11.5 Solution evaluation
This solution meets the security requirement for key issue #1 (UP integrity
activation in EPS) and impacts the UE, the MME, the LTE eNB and the HSS.
Currently the solution does not work when the UE and network nodes are of
different releases, for example if a legacy UE wants to transfer data but the
MME determines a UP IP policy to \"required\". If the configured operator
policy allows the upgraded MME/eNB to handle the legacy UE, then in this case
the MME should determine a UP IP policy to be set to \"not needed\".
## 6.12 Solution #12: Using spare bit in existing 5G UE security capability to
signal the UE support of UP IP over eUTRA to 5GC
### 6.12.1 Introduction
This solution addresses key issue #6 (UE connected to 5GC indicating support
of UP IP over eUTRA).
This solution impacts the UE, the AMF and the ng-eNB.
### 6.12.2 Network options affected
This solution is applicable to the following network options:
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G core with eUTRA
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 6.12.3 Solution description
The solution is to use one of the spare bits that is currently not used in 5G
UE Security Capability IE (see clause 9.11.3.54 of TS 24.501 [10] copied below
as _Figure 6.12.3-1_) to indicate that the UE supports user plane integrity
protection with an ng-eNB. This would avoid taking one of the existing code
points for indicating support/no support for encryption algorithms and
integrity algorithms.
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | _8_ | _7_ | _6_ | _5_ | _4_ | _3_ | _2_ | _1_ | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | _UE | * | | | | | | | | | sec | octet | | | | | | | | | urity | 1_ | | | | | | | | | capab | | | | | | | | | | ility | | | | | | | | | | IEI _| | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ |_ L | * | | | | | | | | | ength | octet | | | | | | | | | of UE | 2 _| | | | | | | | | sec | | | | | | | | | | urity | | | | | | | | | | capab | | | | | | | | | | ility | | | | | | | | | | cont | | | | | | | | | | ents_ | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | _5G | * | * | * |_ 5G | _5G |_ 5G | _5G | * | | -EA0_ | 128-_| 128-_ | 128-_| -EA4_ | -EA5 _| -EA6_ | -EA7 _| octet | | | | | | | | | | 3_ | | | _5G |_ 5G | _5G | | | | | | | | -EA1_ | -EA2 _| -EA3_ | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | _5G | * | * | * |_ 5G | _5G |_ 5G | _5G | * | | -IA0_ | 128-_| 128-_ | 128-_| -IA4_ | -IA5 _| -IA6_ | -IA7 _| octet | | | | | | | | | | 4_ | | | _5G |_ 5G | _5G | | | | | | | | -IA1_ | -IA2 _| -IA3_ | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | * | * | * | * | * | * | * | * | * | | EEA0 _| 128-_ | 128-_| 128-_ | EEA4 _| EEA5_ | EEA6 _| EEA7_ | octet | | | | | | | | | | 5*_| | | * | * | * | | | | | | | | EEA1_ | EEA2 _| EEA3_ | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | * | * | * | * | * | * | * | * | * | | EIA0 _| 128-_ | 128-_| 128-_ | EIA4 _| EIA5_ | EIA6 _| EIA7_ | octet | | | | | | | | | | 6*_| | | * | * | * | | | | | | | | EIA1_ | EIA2 _| EIA3_ | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | _0_ | _0_ | _0_ | _0_ | _0_ | _0_ | _0_ | _0_ | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | _S | * | | | | | | | | | pare_ | octet | | | | | | | | | | 7* | | | | | | | | | | - | | | | | | | | | | 10** | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
_Figure 6.12.3-1: UE security capability information element_
This information element is already protected to the core network in NAS
signalling and also replayed to the UE to ensure Man-in-the-middle attacks are
avoided.
This new spare bit would need to be signalled from the AMF to the RAN nodes
and therefore mapped to a new information element on N2 interface. This new
spare bit would also need to be signalled on the Xn interface between the RAN
nodes and therefore mapped to a new information element on Xn interface.
At N2 handover with AMF re-allocation, the new spare bit would need to be
signalled from the source AMF to the target AMF on N14 interface, mapped to a
new information element.
At IW HO from 5GS to EPS and IW HO from EPS to 5GS, the new spare bit would be
need to be signalled on N26 interface, mapped to a new information element.
The UE will always include the new spare bit in the following Registration
Request message, as the UE security capability IE is always included in the
Registration Request message at mobility when there is a possible AMF change.
### 6.12.4 Solution evaluation
This solution meets the security requirement for key issue #6 (UE connected to
5GC indicating support of UP IP over eUTRA) and impacts the UE, the AMF and
the ng-eNB.
It reuses the existing NAS signalling and the information element in a secure
manner to indicate UE\'s support of user plane integrity protection over eUTRA
to the network.
## 6.13 Solution #13: Using existing IEs to signal the UE support of UP IP
over UTRA to EPC
### 6.13.1 Introduction
This solution addresses key issue #2 (Secure negotiation of integrity
protection support in EPS).
This solution only impacts the UE and the eNB.
NOTE: Whether an unmodified MME will copy the proposed new bit from the NAS
signalling into the S1-AP signalling is not addressed in the present document.
### 6.13.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.13.3 Solution description
The solution is to use one of the bits that is used to indicate support of an
EEA or EIA algorithm that is currently not used in the UE network capability
IE and UE Security Capability IE (see clauses 9.9.3.34 and 9.9.3.36 of TS
24.301 [11] respectively) to indicate that the UE supports user plane
integrity protection with an eNB.
This information element is already protected to the core network in NAS
signalling and also replayed to the UE to ensure Man-in-the-middle attacks are
avoided. It is also already signalled to the RAN nodes so would require no
additional signalling.
### 6.13.4 Solution evaluation
This solution meets the security requirement for key issue #2 and only impacts
the UE and the eNB as it reuses the existing NAS signalling and the
information element in a secure manner to indicate UE\'s support of user plane
integrity protection over eUTRA to the network.
The use of \"one bit\" for \"UPIP support over eUTRA\" rather \"one bit per
integrity protection algorithm\" means that the UE needs to implement UP IP
for all algorithms that it supports. The use of one bit per algorithm would
allow UP IP support to be added on a per algorithm basis. Having only one bit
for \"UPIP support over eUTRA\" could make the inter-operability testing of
UPIP difficult for the existing algorithms and (as many operators have
different RAN and CN vendors) for future algorithms.
NOTE: This testing issue might be able to be mitigated by combining this \"one
bit\" in NAS signalling with \"one bit per algorithm\" UPIP support
indications within the UE\'s Radio Access Capability IE.
## 6.14 Solution #14: LTE-EPC UP IP with option 3X/1X
### 6.14.1 Introduction
This solution uses NR PDCP in the EPS and UE to provide full rate User Plane
Integrity Protection.
It is based on the capability of \"Option 3\" UEs to support NR PDCP (when
used in the \"option 3X\" configuration), however the part of the UE\'s NR
PDCP functionality used in an \"option 3X\" configuration may need to be
extended to support NR UP IP capability. This solution would not change the
UE\'s implementation of LTE PDCP.
NOTE: Other solutions may be proposed, e.g. that use User Plane Integrity
Protection in LTE PDCP.
Within the network, with the option 3X architecture the eNB can remotely
control an entity implementing NR PDCP functionality.
As a deployment option, the network\'s PDCP functionality could be located at
a gNB site (which uses NR-PDCP).
With the option 3X architecture, the UE\'s data radio bearers use NR-PDCP
(specified in TS 38.323[a]). The NR-PDCP firmware can be located in a separate
gNB site, or in the \"Centralised Unit\" of a gNB implemented with a CU-DU
split. This PDCP firmware can be common to what is used by the UE in \"Option
2\" operation and hence may be able to support User Plane Integrity
Protection.
As specified in clause 4.2.2 of TS 37.340 [6]:
_\"In E-UTRA connected to EPC, if the UE supports EN-DC, regardless whether
EN-DC is configured or not, the network can configure either E-UTRA PDCP or NR
PDCP for MN terminated MCG bearers while NR PDCP is always used for all other
bearers_.\"
Figure 6.14.1-1: Radio Protocol Architecture for MCG, SCG and split bearers
from a UE perspective in MR-DC with EPC (EN-DC)
### 6.14.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.14.3 Solution description
With the option 3X architecture, the UE\'s data radio bearers use NR-PDCP
(specified in TS 38.323 [a]). The NR-PDCP firmware can be located in a
separate gNB site, or in the \"Centralised Unit\" of a gNB implemented with a
CU-DU split. This network PDCP firmware is what is expected to be used by
\"Option 2\" UEs and hence can be expected to be able to support User Plane
Integrity protection.
When configured to use EN-DC, the UE does not know whether the network will
allocate radio resources on the NR cell, or the LTE cell, or both. The network
allocates these resources dynamically - e.g. on a per TTI basis (1 ms on LTE,
500 ms (or less) on NR with 30 kHz subcarrier spacing). When resources are
allocated on NR, the HARQ loop timings need to comply with the NR
specifications, and these require faster processing times than on LTE. Hence
the PDCP layer in an EN-DC UE needs to be adapted to work with NR speeds.
It is also perfectly feasible for the network to configure an EN-DC capable UE
to use NR PDCP without the use of dual connectivity. This is specified in
clause 4.2.2 of TS 37.340 [6] (copied below). Hence the addition of User Plane
Integrity Protection in LTE could be realistic in a UE that supports Option 2
UPIP.
In E-UTRA connected to EPC, if the UE supports EN-DC, regardless whether EN-DC
is configured or not, the network can configure either E-UTRA PDCP or NR PDCP
for MN terminated MCG bearers while NR PDCP is always used for all other
bearers.
Figure 6.14.3-1: Radio Protocol Architecture for MCG, SCG and split bearers
from a UE perspective in MR-DC with EPC (EN-DC)
Future changes to the UE\'s NR-PDCP firmware to support full rate option 2 NR
UPIP may be able to be used by the UE with option 3(X) and hence also for
option 1. The UE\'s UPIP capabilities would be based on the NR algorithm
options and would be signalled (to the MME) by adding 2 extra octets into the
UE additional security capability IE defined in TS 24.301 [11] clause 9.9.3.53
(by adding 2 octets, independent interoperability testing of the User Plane
Integrity Protection for each of the NR PDCP algorithms is possible).
Within the E-UTRAN there could be a mixture of eNBs that support and do not
support UPIP. As the Access Stratum Security Mode Command is normally only
sent by the eNB where the RRC connection starts (and not be other eNBs after
handover), it is therefore proposed to use the RRC Reconfiguration Command
(which is used for both resource allocation in the existing cell and as a
\"handover command\") to instruct the UE as to which DRBs to apply UPIP to
(e.g. by extending the RRC signalling that tells the UE the length of the PDCP
Sequence Number to use for that DRB).
NOTE: If it is acceptable to have more than one option to enable UPIP, the
Security Mode Command could also be used.
### 6.14.4 Solution evaluation
This solution requires RAN upgrades and UE updates. Specifically, UE, MME,
(and SGW and PGW) and RAN (S1 and e.g. X2) signalling software updates are
expected. The UE PDCP layer needs to support FR UPIP.
NOTE: This solution requires UE to support NR-PDCP with the capability to run
Integrity Protection at its full LTE data rate.
UE performance impact would be similar to that of NR devices, except that the
lower data rates of LTE mean that the performance impact might well be less.
## 6.15 Solution #15: APN based control of UPIP usage
### 6.15.1 Introduction
This solution addresses KI#8.
The solution uses the UE\'s APN to resolve to a combined \"SMF+PGW\" in the
HPLMN, and the 5GC UDM configures the SMF+PGW according to its existing 5GC
behaviour. When the UE registers in EPC, the UPIP policy is downloaded in
GTP-C signalling to the VPLMN\'s EPC, and then sent in S1-AP signalling to the
RAN.
### 6.15.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.15.3 Solution description
The solution is that the UE\'s APN resolves to a combined \"SMF+PGW\" in the
HPLMN, and the 5GC UDM sends the UE\'s UPIP policy to the SMF+PGW according to
its existing 5GC behaviour.
An alternative to UDM control is that (per APN) local SMF+PGW configuration is
used to set the UPIP policy. In many cases this alternative is likely to be
sufficient because, in the absence of full LTE eNB support for UPIP, the
default setting would probably be \"UPIP preferred\" and not \"UPIP
required\".
These UPIP policy selection techniques align with existing 5GC functionality
specified in clause 5.10.3 of TS 23.501[12]:
> _\"The SMF determines at PDU session establishment a User Plane Security
> Enforcement information for the user plane of a PDU session based on:_
>
> _\- subscribed User Plane Security Policy which is part of SM subscription
> information received from UDM; and_
>
> _\- User Plane Security Policy locally configured per (DNN, S-NSSAI) in the
> SMF that is used when the UDM does not provide User Plane Security Policy
> information._
_\- ...\"_
The GTP-C signalling from PGW to SGW to MME is extended to carry the \"UPIP
required/preferred/not needed\" information to the MME. As GTP-C signalling
largely operates on an EPS bearer basis rather than PDN connection basis, this
signalling is sent on a per EPS-bearer basis.
Existing GTP-C signalling compatibility concepts are reused to enable the PGW
and SGW to have prior knowledge as to whether the SGW and MME support this
\"UPIP required/preferred/not needed\" signalling. Hence the PGW can block the
establishment of EPS bearers on MMEs that do not support UPIP \"policing\".
The UE\'s support (or not) for Full Rate UPIP is signalled from the UE to the
MME.
The MME uses the \"UPIP required/preferred/not needed\" information from the
PGW and the UE\'s support for FR-UPIP to determine what EPS bearers are
permitted to be established when the UE performs a Service Request (or Attach,
PDN Connectivity Request or Dedicated Bearer Activation occurs).
For those bearers that pass this check, the MME signals the \"UPIP
required/preferred/not needed\" information to the eNB in R17 extensions of
S1-AP signalling that:
a) allow the UPIP \"Preferred\" and \"Not-needed\" settings to be ignored by a
non-supporting eNB, and
b) ensure that the UPIP \"Required\" setting causes a non-supporting eNB to
reject the request.
This S1-AP functionality might be enhanced or simplified by UPIP-supporting
eNBs indicating their support for UPIP control signalling in the S1 Setup
message.
Using similar message encoding techniques, at S1 handover (including 5GC to
EPC handover), the \'source to target transparent container\' is used to
signal the \"UPIP required/preferred/not needed\" information to the target
eNB.
NOTE 0: Solution 18 is an acceptable alternative to this S1 handover issue.
At X2 handover, X2-AP signalling extensions carry the \"UPIP
required/preferred/not needed\" information to the target eNB using similar
message encoding techniques.
NOTE 0a: Solution 18 is an acceptable alternative to this X2 handover issue.
For EPS to 5GS handover, existing procedures are used by the source eNB to
encode the \"source to target transparent container\" using NG-AP (TS 38.413
[7]) which already contains codepoints for \"UPIP required/preferred/not
needed\".
NOTE 1: Use of the above message encoding within the S1 interface transparent
container enables \"UPIP Required\" enforcement at inter-MME handover (and 5GC
to EPC handover) to a target MME that does not support UPIP policing.
NOTE 2: To restore UPIP usage (when \"Preferred\") after S1/X2 handovers from
a non-supporting eNB to a supporting eNB, the MME inserts the \"UPIP
required/preferred/not needed\" information into the S1-AP Handover Command
(S1 case) and Path Switch Request Ack (X2 case) messages.
Use of \"UPIP Required\" is not recommended unless the HPLMN is confident that
the UE will only move within areas where there is full VPLMN support for UPIP.
NOTE 3: The PGW is not aware of the UE\'s support (or not) for FR UPIP on EPC.
The PGW does not need to be aware of the UE\'s support level because the
\'UPIP policing\' function has to be performed in the MME and not in the
SMF+PGW. This is because (in contrast to 5GC), EPS procedures such as Service
Request need only involve the MME and need not involve the SMF+PGW.
NOTE 4: As described in solution #14, with the Control Plane - User plane
split of E-UTRAN, the architecture of option 1 will also allow the control
plane of the eNB to remotely control an entity implementing PDCP
functionality. As a deployment option, the network\'s PDCP functionality could
be located at a gNB site (which uses NR-PDCP).
### 6.15.4 Solution evaluation
UE, MME, Serving GW, PGW and RAN (S1 and e.g. X2) signalling software updates
are expected.
The solution aligns with the per \"DNN and S-NSSAI\" control of UPIP policy
used in 5GC. For an EPC-only operator, per APN (or per-node) configuration of
the UPIP policy on the SMF+PGW is likely to be sufficient and hence there is
no mandate to have an interface from the \"SMF+PGW\" to a UDM.
## 6.16 Solution #16: Use existing behaviour to block transfer to EPS of PDN
connections that have UPIP set to \"Required\"
### 6.16.1 Introduction
This solution addresses key issue #7 (Ensuring UP IP is enforced at
interworking).
This solution has no impact on any node.
### 6.16.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.16.3 Solution description
The solution proposes to keep the existing procedures for not passing bearers
that require UP IP to EPS. This ensures that no bearer that requires UP IP is
ever used without UP IP.
### 6.16.4 Solution evaluation
The solution has no impact to any nodes but comes at the cost of not being
able to move bearers that require UP IP to EPS. For a UE with UPIP set to
Required for all its PDN connections (and an MME that does not support
\"attach without PDN connectivity\"), the NG-RAN would keep the UE connection
until it suffers radio link failure and therefore cause extra interference
into adjacent LTE cells. This is an issue of existing behaviour and not
introduced by this solution.
## 6.17 Solution #17: Support of UP IP in LTE eNB connected to EPS
### 6.17.1 Introduction
This solution addresses key issue #1 (UP integrity activation in EPS).
This solution impacts the LTE eNB and the UE.
### 6.17.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.17.3 Solution description
This solution proposes to perform the UP integrity protection in PDCP in the
LTE eNB.
The type of PDCP to be used to support UP IP in the LTE eNB and the UE is out
of scope of the present document.
If the UP IP policy indicates \"Required\", the eNB does not overrule the UP
IP policy provided by the MME. If the eNB cannot activate UP IP when the
received UP IP policy is \"Required\", the eNB rejects establishment of UP
resources for the radio bearer and indicate the reject-cause to the MME.
The enabling/disabling of UP IP for DRB\'s is done using AS SMC procedure and
RRC Reconfiguration procedure, similar as in NR.
### 6.17.4 Solution evaluation
This solution meets the security requirement for key issue #1 (UP integrity
activation in EPS) and impacts the UE and the LTE eNB.
## 6.18 Solution #18: Restricting handovers to RAN nodes that don\'t support
UP IP
### 6.18.1 Introduction
This solution addresses Key Issue# 7 for handovers.
### 6.18.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.18.3 Solution description
Introducing user plane integrity protection (UP IP) to EPS means that there
will be a need to deal with legacy (CN and RAN) nodes that do not support UP
IP and upgraded nodes that do support UP IP. As described in Key Issue #7,
there is a need to ensure that a legacy RAN node does not configure a bearer
that requires UP IP as it cannot support UP IP. While the key issue focuses on
interworking, it is similarly true during mobility in EPS.
This solution provides a method of ensuring that the bearer that requires UP
IP is not handed over from a ng-RAN node to an eNB that does not support UP
IP. The solution works by the target eNB providing an indication that it
supports UP IP as part of its response to a request for a handover initiated
by an ng-RAN node connected to 5GS. If the source ng-RAN node gets no
indication that the target eNB supports UP IP, then the source ng-RAN node
does not proceed with a handover procedure for the UE that has bearers that
require UP IP.
Whether the UP IP support indication is signalled in the target to source
transparent container or on a hop by hop basis will depend on the rest of the
solution, e.g. it could be necessary to know that the intervening nodes on the
handover signalling path support UP IP in EPS but this can be already be known
due to other aspects of a chosen solution.
NOTE: In 5GS, this solution is not needed because all NG-RAN nodes connected
to 5GC (including the ones that do not support UP IP) are aware of the UP IP
policy and ensure that bearers that require UP IP are not used without UP IP.
As not all eNBs will be aware of UP IP functionality, target eNB connected to
EPC may establish bearers that require UP IP (or accept Handover request that
contains bearers requiring UP IP) even if it does not support UP IP. This
means some solution beyond what is done in 5G is needed.
Figure 6.18.3-1 provides the flows for the solution.
Figure 6.18.3-1: Restricting handovers to RAN nodes that don\'t support UP IP
The steps proceed as follows:
0\. UE is connected to an ng-RAN node
1\. ng-RAN node decides a handover to an eNB is needed
2\. ng-RAN node initiates the handover preparation (via AMF and MME) to the
eNB
3\. eNB responds to handover preparation (via MME and AMF) and if it supports
UP IP the eNB includes an indication of its support for UP IP. The indication
can be carried hop by hop or end to end manner.
NOTE: This solution does not address how the target RAN node decides UP IP.
Instead, this solution addresses the issue of the 5GS to EPS handover with the
target eNB that does not support UP IP so that the source NG-RAN node does not
transfer bearers that require UP IP to such target eNB.
4\. (4b) If no UP IP support indication is received by the ng-RAN node and the
handover includes bearers that require UP IP, then the ng-RAN node cancels the
handover in the AMF, target MME and target eNB as in clause 4.11.1.2.3 of TS
23.502. (4a) Otherwise it can continue with the handover.
A similar solution could also apply to S1 handovers in EPS (e.g. see clause
5.5.2.5.2 of TS 23.401 [b]).
### 6.18.4 Solution evaluation
This solution will impact the service continuity when the UE is trying to
handover bearers that require UP IP from ng-RAN with UP IP protection enabled
to the eNB that doesn\'t support UP IP, although employing the solution
enables better service continuity when trying to handover bearers that require
UP IP from ng-RAN to an eNB that does support UP IP. An advantage of this
solution is it allows source RAN node of a handover to learn of the UP IP
capabilities of target nodes without relying on pre-configuration. If the
source node keeps track of the target node\'s capabilities, then the source
can decide to not try to hand bearers requiring UP IP to target nodes that are
known not to support UP IP. This allows service to continue and provide
minimal interruption. It will of course take one handover attempt to discover
that a target node capability has changed.
The solution requires change on bNB and eNB. For the \"hop by hop\" variant
mentioned in step 3, changes on AMF and MME are also needed.
## 6.19 Solution #19: UP IP for EPC connected RAN options at NR or E-UTRA PDCP
layer
### 6.19.1 Introduction
This solution addresses key issue #1 (UP integrity activation in EPS),
specifically, how to support UP IP at the PDCP layer for the EPC connected RAN
options (i.e., option 1 and option 3) irrespective of whether NR PDCP or
E-UTRA PDCP is configured by the RAN. This solution impacts the UE and the
eNB/gNB.
### 6.19.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.19.3 Solution description
This solution supports UP IP at the PDCP layer using either E-UTRA PDCP or NR
PDCP.
For option 1 (eUTRA with EPC), the UP IP over E-UTRA PDCP is already specified
in TS 33.401 [3] for the relay nodes. This solution reuses this feature to
support UP IP at the E-UTRA PDCP layer.
NOTE 1: Option 1 can use either E-UTRA PDCP or NR PDCP as determined by the
eNB.
For option 3 (eUTRA - NR Dual Connectivity or EN-DC), the network can either
configure the UE with NR PDCP or E-UTRA PDCP for the MN terminated MCG bearers
_while NR PDCP is always configured for all other bearers,_ as specified in
clause 4.2.2 of TS 37.340 [6] (as also shown in the figure below)_._
NOTE 2: How the network configures the UE with NR PDCP or E-UTRA PDCP for MN
terminated MCG bearers is not addressed in the present document.
Figure 6.19.3-1: Radio Protocol Architecture for MCG, SCG and split bearers
from a UE perspective in MR-DC with EPC (EN-DC)
In this solution, when E-UTRA PDCP is configured, the UP IP is activated at
the E-UTRA PDCP layer and when NR PDCP is configured, UP IP is activated at
the NR PDCP layer. The UP IP support at the E-UTRA PDCP layer is specified in
TS 33.401 [3]. The UP IP support at the NR PDCP layer is specified in TS
33.501 [4].
### 6.19.4 Solution evaluation
This solution supports use of UP IP irrespective of whether E-UTRA PDCP or NR
PDCP is configured by the network. It also supports use of UP IP with all EPC
connected RAN options.
This solution impacts the UE and the eNB/gNB.
If the UP IP policy is not locally configured at the eNB/gNB, this solution
also impacts the EPC.
## 6.20 Solution #20: \'Best effort\' UP IP for EPS
### 6.20.1 Introduction
The solution addresses key issue #1 and key issue #2.
The solution only affects UE and RAN nodes
### 6.20.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.20.3 Solution description
This solution is effectively a best effort solution in that it is left to the
RAN nodes to apply UP IP to bearers based on their local configuration. The
existing security capability IEs are used to signal the capability of the UE
to support UP IP to the RAN nodes (via the MME) and the RAN nodes decide on
whether to use UP IP for each bearer. Furthermore, this solution aims to
enable the use of UP IP when connected to (part of) a core network that has
not been upgraded.
NOTE 1: Whether an not-upgraded MME will copy bits (re)defined from NAS
signalling (TS 24.301) in the _UE network capability_ IE (clause 9.9.3.34) or
the _UE additional security capability_ IE (clause 9.9.3.53) into bits that
are \"reserved for future use\" in the TS 36.413 (S1-AP) _UE Security
Capabilities_ IE (9.2.1.40) or _NR UE Security Capabilitie_ s IE (9.2.1.127).
NOTE 2: It is FFS whether an not-upgraded eNB will copy bits (re)defined in
R17 that were \"reserved for future use\" in the Rel 16 TS 36.413 (S1-AP) _UE
Security Capabilities_ IE (9.2.1.40) or _NR UE Security Capabilitie_ s IE
(9.2.1.127) into the corresponding information elements in X2-AP messages for
handover and secondary node addition.
The solution does not prevent the use of UP IP security policy. If the RAN
node has been upgraded to understand security policy and has received the
security policy, then the RAN node uses the received security policy to decide
on whether to activate UP IP, i.e. the local configuration is ignored when
security policy has been received.
There is no special handling of X2 and S1 handovers needed as the target RAN
node decides on whether to activate UP IP based on the UE\'s capability, which
is signalled in existing IE and its own local capabilities. Furthermore no
special handling of nodes, in particular legacy eNBs, is required as the
required information for the solution is signalled transparently through
legacy nodes using existing IEs. The solution does not aim for consistent UP
IP policy but allows the use of UP IP between UEs and RAN nodes that support
UP IP. An operator can set a consistent local configuration for use of UP IP
on RAN nodes that support UP IP, in the same way that eNBs can be configured
with a consistent confidentiality policy.
The solution consists of the following aspects:
\- Solution #13 is used to indicate the UE\'s support of UP IP with EPS
\- AS SMC and RRC Reconfiguration procedures are used to configure the use of
UP IP per bearer as in 5G or EPS relay nodes
\- MAC-I is added to the PDCP PDU as for relay nodes in LTE PDCP or as in NR
PDCP.
### 6.20.4 Solution evaluation
NOTE: This solution has not been evaluated.
## 6.21 Solution #21: Interworking handover from EPS to 5GS
### 6.21.1 Introduction
This solution addresses key issue #7: Ensuring UP IP is enforced at
interworking.
The PGW-C+SMF provides the UP IP policy per PDU session and provides the
policies to the target gNB/ng-eNB.
This solution impacts the UE, the MME, the AMF, the SMF, the eNB and the ng-
eNB and gNB.
### 6.21.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 2 - NR standalone with 5G Core
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G core with eUTRA
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 6.21.3 Solution description
#### 6.21.3.0 General
\"UE capability indicating UP IP support\" in this clause and its clauses
refers to \"UE capability indicating UP IP support over eUTRA when connected
to 5GC\".
#### 6.21.3.1 Upgraded RAN nodes and core network nodes to support UP IP
##### 6.21.3.1.0 Overview
The solution is to describe the behaviour of the source eNB node and the
target ng-eNB node at interworking handover from EPS to 5GS when the source
eNB and the target ng-eNB/gNB support UP IP.
The procedure described below applies to when UP IP policy is set to either:
\"required\", \"preferred\" or \"not needed\".
##### 6.21.3.1.1 Interworking handover from EPS to 5GS
The source eNB has received a UP IP policy from the MME per radio bearer
established with the UE. The source eNB includes the UP IP activation status
in the _Source to Target Transparent Container_ to the target ng-eNB/gNB.
The target AMF/SMF ignores any UP IP policy received from the source MME.
The PGW-C+SMF provides a UP IP policy as described in TS 23.501 [12]. The SMF
responds to the target AMF including a UP IP policy per PDU session to be
handovered to 5GS which the AMF forwards to the target ng-eNB/gNB.
A target ng-eNB/gNB which supports UP IP is able to activate UP IP according
to the received UP IP policy and the \"UE capability indicating UP IP support
over eUTRA when connected to 5GC\" received from the source MME via target
AMF.
NOTE: If the UP IP indication reuses 1 bit of EPS security capability, the
protection of UE EPS security capability in interworking from EPS to 5GS can
be reused for protection of indication of UE support UP IP in E-UTRA.
Figure 6.21.3.1.1-1: Interworking handover from EPS to 5GS
Step 1: The source eNB includes the UP IP activation status in the _Source to
Target Transparent Container_ in Handover Required message to the source MME.
Step 2: The source MME forwards the _Source to Target Transparent Container_
together with the \"UE capability indicating UP IP support over eUTRA when
connected to 5GC\" to the target AMF.
Step 2b: The target AMF invokes the Nsmf_PDUSession_CreateSMContext Request
service operation with the SMF. The target AMF/SMF ignores any UP IP policy
received from the source MME. The SMF provides a UP IP policy per PDU session
as described in TS 23.501 [12].
Step 2c: The SMF responds with the Nsmf_PDUSession_CreateSMContext Response to
the target AMF including a UP IP policy per PDU session to be handovered to
5GS.
Step 3: The target AMF forwards the _Source to Target Transparent Container_
together with the \"UE capability indicating UP IP support over eUTRA when
connected to 5GC\" and the UP IP policy per radio bearer to the target ng-
eNB/gNB.
Step 4: The target ng-eNB/gNB prepares the _Target to Source Transparent
Container_ to the source eNB. _Confirmation of valid_ \"_UE capability to
support UP IP over E-UTRA when connected to 5GC_ \" _and valid activation
status included in the Source to Target Transparent container is made at the
target ng-eNB/gNB_ when the _core network includes the stored_ \"_UE
capability to support UP IP over E-UTRA when connected to 5GC_ \" _and the UP
IP policy via the target AMF to the target ng-eNB/gNB._ If the target ng-
eNB/gNB becomes aware that there is a mismatch between the \"UE capability to
support UP IP over E-UTRA when connected to 5GC\" and the UP IP policy
received from the source eNB in the Source to Target Transparent container and
the ones stored and received from the core network, then the target ng-eNB/gNB
takes the \"UE capability to support UP IP over E-UTRA when connected to 5GC\"
and the UP IP _activation status_ stored and received from the core network
into use.
The target ng-eNB/gNB activates UP IP for the radio bearers to be handovered
to the target ng-eNB/gNB. The target ng-eNB/gNB sends the Handover Request
Acknowledgement message including the _Target to Source Transparent Container_
to the target MME.
Step 5: The target AMF forwards the parameters received in Handover Request
Acknowledge message to the source MME in the Forward Relocation Response
message.
Step 6: The source MME forwards the parameters received in Forward Relocation
Response message to the source eNB in the Handover Command message.
Step 7: The source eNB initiates Handover Command procedure with the UE.
Step 8: The UE confirms by sending a Handover Complete message to the target
eNB.
Step 9: The target ng-eNB/gNB notifies the target AMF that the handover
procedure is completed by sending a Handover Notify message.
Step 10. The UE initiates a Registration procedure with the target AMF
including the \"UE capability indicating UP IP support over eUTRA when
connected to 5GC\" in the Registration Request message.
Step 11: If the target AMF identifies a mismatch with the previously stored UE
capability and becomes aware that the target ng-eNB/gNB doesn\'t know the \"UE
capability indicating UP IP support over eUTRA when connected to 5GC\" after
an interworking handover from EPS, the target AMF sends the \"UE capability
indicating UP IP support over eUTRA when connected to 5GC\" to the target ng-
eNB/gNB in the UE Context Modification Request message.
Step 12: If the target ng-eNB identifies a mismatch between the stored
capabilities and the received capabilities then the target ng-eNB may activate
UP IP for the DRB(s) established with the UE.
Step 13: The target ng-eNB/gNB responds to the target AMF by sending a UE
Context Modification Response message when the RRC Reconfiguration procedure
is completed.
#### 6.21.3.2 Handling of legacy eNB and legacy ng-eNB
##### 6.21.3.2.1 Handling of legacy source eNB
A legacy source eNB node has not be upgraded to support UP IP, and cannot
activate UP IP for radio bearers established with the UE and therefore cannot
handover data radio bearers with UP IP activated to 5GS.
After the HO is completed the UE initiates a Registration procedure with the
target AMF including the \"UE capability indicating UP IP support over eUTRA
when connected to 5GC\". If the target AMF identifies a mismatch with the
previously stored UE capabilities and becomes aware that the target ng-eNB/gNB
doesn\'t know the UP IP policy and the \"UE capability indicating UP IP
support over eUTRA when connected to 5GC\" after an interworking handover from
EPS, the AMF should send the \"UE capability indicating UP IP support over
eUTRA when connected to 5GC\" to the target ng-eNB/gNB via the UE Context
Modification Request message. The target ng-eNB/gNB may activate UP IP for the
data radio bearer established with the UE and/or respond to the target MME by
sending a UE Context Modification Response message.
##### 6.21.3.2.2 Handling of legacy target ng-eNB
A legacy target ng-eNB node has not been upgraded to support UP IP and cannot
activate UP IP for a radio bearer handovered from the source eNB.
NOTE: If the UP IP policy is set to \"required\", its FFS how the source eNB
identifies that the target ng-eNB is not supporting UP IP,
### 6.21.4 Solution evaluation
_Confirmation of valid_ \"_UE capability to support UP IP over E-UTRA when
connected to 5GC_ \"_, valid UP IP activation status included in the Source to
Target Transparent container at the target ng-eNB/gNB, is achieved by the core
network including the stored_ \"_UE capability to support UP IP over E-UTRA
when connected to 5GC_ \"_, the UP IP policy via the target AMF to the target
ng-eNB/gNB._ If the target ng-eNB/gNB becomes aware that there is a mismatch
between the \"_UE capability to support UP IP over E-UTRA when connected to
5GC_ \" and the _UP IP activation status_ received from the source eNB in the
Source to Target Transparent Container and the ones stored and received from
the core network, then the target ng-eNB/gNB takes the \"UE capability to
support UP IP over E-UTRA when connected to 5GC\" and the UP IP policy stored
and received from the core network into use.
## 6.22 Solution #22: S1 handover
### 6.22.1 Introduction
This solution addresses key issue #7 (Ensuring UP IP is enforced at
interworking).
This solution impacts the UE, the MME and the eNB.
### 6.22.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.22.3 Solution description
\"UE capability indicating UP IP support\" in this clause and its clauses
refers to \"UE capability indicating UP IP support over eUTRA when connected
to EPS\".
#### 6.22.3.1 Upgraded eNB\'s and MME\'s to support UP IP
The solution is to describe the behaviour of the source eNB and the target eNB
node at S1 handover when the source eNB/source MME and the target eNB/target
MME have been upgraded to support UP IP.
The procedure described below applies to when UP IP policy is set to either:
\"required\", \"preferred\" or \"not needed\".
##### 6.22.3.1.1 S1 handover
The source eNB has received the \"UE capability indicating UP IP support\"
from the MME. The source eNB has a UP IP policy and a UP IP activation status
stored per radio bearer established with the UE. The source eNB includes the
UP IP activation status per radio bearer in the _Source to Target Transparent
Container_ to the target ng-eNB.
The target eNB is able to activate UP IP for the indicated radio bearer
included in the _Source to Target Transparent Container_ according to the UP
IP policy and the \"UE capability indicating UP IP support\" received from the
source MME.
NOTE: If the UP IP indication reuses 1 bit of EPS security capability, the
protection of UE EPS security capability in S1 handover can be reused for
protection of indication of UE support UP IP in E-UTRA.
Figure 6.22.3.1.1-1: S1 handover
Step 1: The source eNB includes the UP IP activation status and the UPIP
policy in the _Source to Target Transparent Container_ included in the
Handover Required message to the source MME.
Step 2: The source MME forwards the _Source to Target Transparent Container_
received from the source eNB to the target MME. The source MME includes also
the \"UE capability indicating UP IP support\" and the UP IP policy per radio
bearer to the target MME.
Step 3: The target MME forwards the _Source to Target Transparent Container_ ,
the \"UE capability indicating UP IP support\" and the UP IP policy per radio
bearer received from the source MME to the target eNB.
Step 4: The target eNB sends the Handover Request Acknowledgement message to
the target MME including the _Target to Source Transparent Container_.
_Confirmation of valid_ \"_UE capability to support UP IP over E-UTRA when
connected to EPS_ \" _and valid UP IP policy included in the Source to Target
Transparent container is made at the target eNB_ when the _source MME includes
the stored_ \"_UE capability to support UP IP over E-UTRA when connected to
EPS_ \" _and the UP IP policy via the target MME to the target eNB._ If the
target eNB becomes aware that there is a mismatch between the \"UE capability
to support UP IP over E-UTRA when connected to EPS\" and the UP IP policy
received from the source eNB in the Source to Target Transparent container and
the ones stored in source MME and received via target MME, then the target eNB
takes the \"UE capability to support UP IP over E-UTRA when connected to EPS\"
and the UP IP policy received from the source MME into use. The target eNB
activates UP IP for the radio bearer handovered from the source eNB.
Step 5: The target MME forwards the parameters received in Handover Request
Acknowledge message to the source MME in the Forward Relocation Response
message.
Step 6: The source MME forwards the parameters received in Forward Relocation
Response message to the source eNB in the Handover Command message.
Step 7: The source eNB initiates Handover Command procedure with the UE.
Step 8: The UE confirms by sending a Handover Complete message to the target
eNB.
Step 9: The target eNB notifies the target MME that the handover procedure is
completed by sending a Handover Notify message.
Step 10. The UE initiates a Tracking Area Update procedure with the target MME
including the \"UE capability indicating UP IP support\" in the Tracking Area
Update Request message.
Step 11: The target MME stores the \"UE capability indicating UP IP support\"
received from the UE. If the target MME identifies a mismatch with the
previously stored UE capability and becomes aware that the target eNB doesn\'t
know the \"UE capability indicating UP IP support\" after an S1-handover, the
MME sends the UP IP policy and \"UE capability indicating UP IP support\" per
radio bearer to the target eNB via the UE Context Modification Request
message.
Step 12: If the target eNB becomes aware of a mismatch between the information
received from the MME and the information stored in the target eNB, then the
target eNB may decide to activate UP IP for the radio bearer established with
the UE by initiating a RRC Reconfiguration procedure.
Step 13: The target eNB responds to the target MME by sending a UE Context
Modification Response message when step 12 is completed.
#### 6.22.3.2 Handling of legacy eNB
##### 6.22.3.2.1 Handling of legacy source eNB
A legacy source eNB has not been upgraded to support UP IP and cannot handover
a radio bearer with UP IP activated to another target eNB. The target eNB can
therefore not activate UP IP in the target cell even if the target eNB
supports UP IP.
After the HO is completed the UE initiates a Tracking Area Update procedure
with the target MME including the \"UE capability indicating UP IP support\".
If the target MME identifies a mismatch with the previously stored UE
capabilities and/or becomes aware that the target eNB doesn\'t know the UP IP
policy per radio bearer and the \"UE capability indicating UP IP support\"
after an S1-handover, the target MME sends the UP IP policy and UE capability
indicating UP IP support to the target eNB via the UE CONTEXT MODIFICATION
REQUEST message. The target eNB may activate UP IP for radio bearer
established with the UE and/or respond to the target MME by sending a UE
Context Modification Response message.
##### 6.22.3.2.2 Handling of legacy target eNB
A legacy target eNB node has not been upgraded to support UP IP and cannot
activate UP IP for a radio bearer handovered from the source eNB.
NOTE: If the UP IP policy is set to \"required\", it is not addressed in the
present document how the source eNB/ identifies that the target eNB is not
supporting UP IP,
### 6.22.4 Solution evaluation
_Confirmation of valid_ \"_UE capability to support UP IP over E-UTRA when
connected to EPS_ \" _and valid UP IP policy included in the Source to Target
Transparent container at the target eNB, is achieved by an source MME
including the stored_ \"_UE capability to support UP IP over E-UTRA when
connected to EPS_ \" _and the stored UP IP policy via the target MME to the
target eNB._ _If the target eNB becomes aware that there is a mismatch, then
the target eNB takes the_ \"_UE capability to support UP IP over E-UTRA when
connected to EPS_ \" _and the UP IP policy received from the source MME into
use._
## 6.23 Solution #23: X2 handover
### 6.23.1 Introduction
This solution addresses key issue #7 (Ensuring UP IP is enforced at
interworking).
This solution impacts the UE, the MME and the eNB.
### 6.23.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.23.3 Solution description
#### 6.23.0 General
\"UE capability indicating UP IP support\" in this clause and its clauses
refers to \"UE capability indicating UP IP support over eUTRA when connected
to EPS\".
#### 6.23.3.1 Upgraded eNB\'s to support UP IP
The solution is to describe the behaviour of the source eNB and the target eNB
node at X2 handover when the source eNB/source MME and the target eNB/target
MME have been upgraded to support UP IP.
The procedure described below applies to when UP IP policy is set to either:
\"required\", \"preferred\" or \"not needed\".
##### 6.23.3.1.1 X2 handover
The source eNB has received the \"UE capability indicating UP IP support\" and
the UP IP policy from the MME. The source eNB has a UP IP policy and a UP IP
activation status stored per radio bearer established with the UE. The source
eNB includes the UP IP policy and the UP IP activation status per radio bearer
and the \"UE capability indicating UP IP support\" in the Handover Request
message to the target eNB.
The target eNB activates UP IP for the indicated radio bearer included in the
Handover Request message according to the UP IP policy received from the
source eNB via X2 interface.
NOTE: If the UP IP indication reuses 1 bit of EPS security capability, the
protection of UE EPS security capability in X2 handover can be reused for
protection of indication of UE support UP IP in E-UTRA.
Figure 6.23.3.1.1-1: X2 handover
Step 1: The source eNB includes the \"UE capability indicating UP IP
support\", the UP IP policy and the UP IP activation status per radio bearer
established with the UE, in the Handover Request message to the target eNB.
Step 2: The target eNB activates UP IP for the indicated radio bearer included
in the Handover Request message according to the UP IP policy received from
the source eNB considering the \"UE capability indicating UP IP support\"
received via X2 interface. The target eNB sends the Handover Request
Acknowledgement message to the source eNB.
Step 3: The source eNB sends Handover Command to the UE.
Step 4: The UE responds with a Handover Complete message to the target eNB.
Step 5: The target eNB includes the \"UE capability indicating UP IP
support\", the UP IP activation status (e.g. integrity protection result) and
the UP IP policy per each radio bearer established with the UE, in the Path
Switch Request message to the MME.
Step 6: If the MME does not receive the UP IP policy, the UP IP activation
status and the \"UE capability indicating UP IP support\" in the S1-PATH-
SWITCH-REQUEST message from the target eNB, or if an MME becomes aware that
there is a mismatch between the information received from the target eNB and
the information stored in the MME after an X2-handover, then the MME should
send per radio bearer: the UP IP policy and the \"UE capability indicating UP
IP support\" to the target eNB via the PATH SWITCH REQUEST ACKNOWLEDGE
message.
Step 7: If the target eNB becomes aware of a mismatch between the information
received from the MME and the information stored in the target eNB, then the
target eNB may decide to activate UP IP with the UE for the radio bearer
established with the UE by initiating a RRC Reconfiguration procedure.
#### 6.23.3.2 Handling of legacy eNB\'s
##### 6.23.3.2.1 Handling of legacy source eNB
If the legacy source eNB node has not be upgraded to support UP IP, then the
source eNB does not have the capability to activate UP IP for a radio bearer
established with the UE. At X2 handover, no UP IP policy is transferred over
X2 interface to the target eNB. Even if the target eNB supports UP IP, the
target eNB cannot activate UP IP for a radio bearer established with the UE.
If the MME is an upgraded MME which supports UP IP, then if the MME does not
receive the UP IP policy, the UP IP activation status and the \"UE capability
indicating UP IP support\" in the S1-PATH-SWITCH-REQUEST message from the
target eNB to which the UE is connected to, or if the MME becomes aware that
there is a mismatch between the information received from the target eNB and
the information stored in the MME after an X2-handover, the MME should send
the UP IP policy and \"UE capability indicating UP IP support\" to the target
eNB via the PATH SWITCH REQUEST ACKNOWLEDGE message to the target eNB.
If the MME is not upgraded to support UP IP, then the MME cannot forward any
UP IP policy or any \"UE capability indicating support of UP IP\" to the
target eNB. In this case the target eNB cannot activate UP IP for the radio
bearer established with the UE.
If the target eNB becomes aware of a mismatch between the information received
from the MME and the information stored in the target eNB, then the target eNB
may decide to activate UP IP with the UE for the radio bearer established with
the UE. The procedure initiated by target eNB in order to activate UP IP with
the UE is left for stage 3.
##### 6.23.3.2.2 Handling of legacy target eNB
A legacy target eNB node has not been upgraded to support UP IP and cannot
activate UP IP for a radio bearer handovered from the source eNB.
NOTE: If the UP IP policy is set to \"required\", it is not addressed in the
present document how the source ng-eNB/gNB identifies that the target eNB is
not supporting UP IP.
### 6.23.4 Solution evaluation
This solution assumes that the MME is upgraded to support UP IP. Confirmation
of valid \"UE capability to support UP IP over E-UTRA when connected to EPS\"
and valid UP IP policy at the target eNB, is achieved during the Path Switch
procedure after the X2 handover is completed.
## 6.24 Solution #24: Interworking handover from 5GS to EPS
### 6.24.1 Introduction
This solution addresses key issue #7: Ensuring UP IP is enforced at
interworking.
This solution impacts the UE, the MME, the AMF, the eNB and the ng-eNB and
gNB.
### 6.24.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 2 - NR standalone with 5G Core
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G core with eUTRA
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 6.24.3 Solution description
#### 6.24.3.0 General
\"UE capability indicating UP IP support\" in this clause and its clauses
refers to \"UE capability indicating UP IP support over eUTRA when connected
to EPS\".
#### 6.24.3.1 Upgraded RAN nodes and core network nodes to support UP IP
##### 6.24.3.1.0 Overview
The solution is to describe the behaviour of the source ng-eNB/gNB node and
the target eNB node at interworking handover from 5GS to EPS when the source
ng-eNB/gNB and the target eNB support UP IP.
The procedure described below applies to when UP IP policy is set to either:
\"required\", \"preferred\" or \"not needed\".
##### 6.24.3.1.1 Interworking handover from 5GS to EPS
The source ng-eNB/gNB has received a UP IP policy from the AMF per radio
bearer established with the UE. The source ng-eNB/gNB includes the UP IP
activation status in the _Source to Target Transparent Container_ to the
target eNB.
A target eNB which supports UP IP is able to activate UP IP according to the
UP IP policy and the \"UE capability indicating UP IP support over eUTRA when
connected to EPS\" received from the source AMF via the target MME.
NOTE: If the UP IP indication reuses 1 bit of EPS security capability, the
protection of UE EPS security capability in interworking handover from 5GS to
EPS can be reused for protection of indication of UE support UP IP in E-UTRA.
Figure 6.24.3.1.1-1: Interworking handover from 5GS to EPS
Step 1: The source ng-eNB/gNB includes the UP IP activation status per radio
bearer established with the UE, in the _Source to Target Transparent
Container_ in Handover Required message to the source AMF.
Step 2a: The source AMF sends Nsmf_PDUSession_ContextRequest to the SMF.
Step 2b: The SMF provides UP IP policy and responds with
Nsmf_PDUSession_ContextResponse including the UP IP policy to the source AMF.
Step 2c: The source AMF forwards the _Source to Target Transparent Container_
received from the source ng-eNB/gNB to the target MME. The source AMF includes
also the \"UE capability indicating UP IP support over eUTRA when connected to
EPS\" and forwards the UP IP policy per PDU session received from the SMF to
the target MME.
Step 3: The target MME forwards the _Source to Target Transparent Container_
together with the \"UE capability indicating UP IP support over eUTRA when
connected to EPS\" and the UP IP policy per PDU session received from the SMF
via source AMF to the target eNB.
Step 4: The target eNB sends the Handover Request Acknowledgement message to
the target MME. The target eNB prepares the Target to Source Transparent
Container to the source ng-eNB/gNB. Confirmation of valid \"UE capability to
support UP IP over E-UTRA when connected to EPS\" and valid UP IP activation
status included in the Source to Target Transparent container is made at the
target eNB when the core network includes the stored \"UE capability to
support UP IP over E-UTRA when connected to EPS\" and the UP IP policy via the
target MME to the target eNB. If the target eNB becomes aware that there is a
mismatch between the \"UE capability to support UP IP over E-UTRA when
connected to EPS\" and the UP IP activation status received from the source
ng-eNB/gNB in the Source to Target Transparent container and the ones received
from the core network, then the target eNB takes the \"UE capability to
support UP IP over E-UTRA when connected to EPS\" and the UP IP policy
received from the core network into use.
The target eNB indicates UP IP to be activated for the radio bearers to be
handovered to the target eNB.
Step 5: The target MME forwards the parameters received in Handover Request
Acknowledge message to the source AMF in the Forward Relocation Response
message.
Step 6: The source AMF forwards the parameters received in Forward Relocation
Response message to the source ng-eNB/gNB in the Handover Command message.
Step 7: The source ng-eNB/gNB initiates Handover Command procedure with the
UE.
Step 8: The UE confirms by sending a Handover Complete message to the target
eNB.
Step 9: The target eNB notifies the target MME that the handover procedure is
completed by sending a Handover Notify message.
Step 10. The UE initiates a Tracking Area Update procedure with the target MME
including the \"UE capability indicating UP IP support over eUTRA when
connected to EPS\" in the Tracking Area Update Request message to the target
MME.
Step 11: If the target MME identifies a mismatch with the previously stored UE
capability and the one received from the UE and becomes aware that the target
eNB doesn\'t know the \"UE capability indicating UP IP support over eUTRA when
connected to EPS\", the target MME sends the \"UE capability indicating UP IP
support over eUTRA when connected to EPS\" in the Context Modification Request
message.
Step 12: If the target eNB identifies a mismatch in the stored capability and
the received one from target MME, then the target eNB may activate UP IP for
the radio bearers established with the UE by initiating an RRC Reconfiguration
procedure.
Step 13: The target eNB responds to the target MME by sending a UE Context
Modification Response message.
#### 6.24.3.2 Handling of legacy eNB and legacy ng-eNB
##### 6.24.3.2.1 Handling of legacy source ng-eNB
A legacy source ng-eNB node has not be upgraded to support UP IP and cannot
activate UP IP and therefore cannot handover radio bearers with UP IP
activated to EPS.
After the HO is completed the UE initiates a Tracking Area Update procedure
with the target MME including the \"UE capability indicating UP IP support
over eUTRA when connected to EPS\". If the target MME identifies a mismatch
with the previously stored UE capabilities and becomes aware that the target
eNB doesn\'t know the \"UE capability indicating UP IP support over eUTRA when
connected to EPS\", the MME sends as the \"UE capability indicating UP IP
support over eUTRA when connected to EPS\" to the target eNB via the UE
Context Modification Request message. The target eNB may activate UP IP for
the radio bearer established with the UE and/or respond to the target MME by
sending a UE Context Modification Response message.
##### 6.24.3.2.2 Handling of legacy target eNB
A legacy target eNB node has not been upgraded to support UP IP and cannot
activate UP IP for a radio bearer handovered from the source ng-eNB/gNB.
NOTE: If the UP IP policy is set to \"required\", it is not addressed in the
present document how the source ng-eNB/gNB identifies that the target eNB is
not supporting UP IP.
### 6.24.4 Solution evaluation
Confirmation of valid \"UE capability to support UP IP over E-UTRA when
connected to EPS\" and valid UP IP activations status included in the Source
to Target Transparent container is made at the target eNB when the source AMF
includes the stored \"UE capability to support UP IP over E-UTRA when
connected to EPS\" and the core network include the UP IP policy via the
target MME to the target eNB. If the target eNB becomes aware that there is a
mismatch, then the target eNB takes the \"UE capability to support UP IP over
E-UTRA when connected to EPS\" and the UP IP policy received from the core
network into use.
## 6.25 Solution #25: \'Best effort\' with extensibility for HPLMN Control for
UP IP for EPS
### 6.25.1 Introduction
The solution addresses key issue #1, key issue #2 and key issue #8.
### 6.25.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.25.3 Solution description
#### 6.25.3.1 Indication for UP Security Support.
The EIA7 of existing UE EPS security capability IEs is used to signal the
capability of the UE to support UP security with eNB. Since it is a reserved
bit, the indication will not lost during mobility case (e.g. RAN mobility or
MME mobility), and the check of the indication can be triggered using existing
security capability verification method, e.g. MME check via path switch, or UE
context modification procedure.
#### 6.25.3.2 UP Security Policy Maintenance
The eNB can be configured with a default UP security policy per RAN node.
The HSS can be configured a subscribed UP security policy per APN, either
locally configured or mapping from subscribed UP security policy per DNN.
The UP security policy could use similar setting options as in 5GS: cipher:
\"required\", \"preferred\", \"not needed\", integrity protection:
\"required\", \"preferred\", \"not needed\".
If the MME could get subscribed UP security policy from the HSS during initial
attach procedure, or if the MME could get subscribed UP security policy from
UE context during PDN Connection establishment procedure, then the MME maps
the subscribed UP security policy from APN to EPS bearer, and then to E-RAB,
and sends the subscribed UP security policy per E-RAB to the eNB, and the eNB
uses the subscribed UP security policy. Otherwise, the eNB uses default UP
security policy if the UE supports UP security with eNB.
For X2 handover, the source eNB sends subscribed security policy per E-RAB to
the target eNB in X2: Handover Request, and the target eNB uses the subscribed
security policy. If the source eNB is upgraded but does not receive subscribed
security policy, or if the source eNB is a legacy NE, then the source eNB does
not send any security policy in X2 signalling, the target eNB uses default UP
security policy if the UE supports UP security with eNB.
If the UE supports UP security with eNB, the target eNB sensd UP security
policy per E-RAB (either subscribed or default) in the Path Switch Request to
the MME, the target eNB may receive a new security policy in the Path Switch
Request ACK message from the MME if there is a mismatch. The target eNB uses
the received UP security policy if the UE supports UP security with eNB.
For S1 handover, the source MME sends subscribed security policy per E-RAB to
the target MME, and the target MME sends subscribed security policy per E-RAB
to the target eNB in S1: Handover Request. In addition, the source eNB sends
subscribed security policy per E-RAB in source eNB to target eNB transparent
container in S1: Handover Request. If the source MME or the target MME is a
legacy NE, but the source eNB has subscribed UP security policy, then the
target eNB can use subscribed security policy in source eNB to target eNB
transparent container. If source MME and the target MME are upgraded, then the
target eNB can use subscribed security policy in S1: Handover Request.
Otherwise, the target eNB uses the default UP security policy if the UE
supports UP security with eNB.
NOTE: In case that the source eNB is upgraded and has subscribed security
policy, but the target MME is not upgraded, the target eNB cannot receive
subscribed security policy from MME in S1: Handover Request. Since subscribed
security policy has higher priority, the source eNB can include the subscribed
security policy in source eNB to target eNB transparent container so that the
target eNB can get the subscribed security policy.
#### 6.25.3.3 UP Security Activation
The eNB decides on whether to use UP IP for each DRB based on security policy
(either subscribed or default) per E-RAB and UE EPS security capability
indicating UE to support UP security with eNB.
AS SMC and RRC Reconfiguration procedures are used to negotiate the use of UP
IP for bearer as in 5G.
### 6.25.4 Solution evaluation
The solution can meet security requirement for key issue #1 and key issue #2.
The solution can support UP IP with least update on UE and eNB.
The solution can provide extensibility by updating MME and HSS if more
features are required, e.g. HPLMN Control of UPIP usage, verification of UP
security policy, etc..
## 6.26 Solution #26: \'Best effort\' UP IP for EPS using UE Radio Access
capabilities
### 6.26.1 Introduction
The solution addresses key issue #1 and key issue #2.
The solution only affects UE and RAN nodes
### 6.26.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.26.3 Solution description
This solution is similar in concept to solution #20, but, the UE\'s EPC UPIP
capabilities are encoded in the UE Radio Access Capability information
element.
This avoids potential problems with legacy MMEs not copying NAS information
into S1-AP signalling; and/or legacy eNBs not copying S1-AP signalling into X2
signalling.
The UE RAC (or, if using \"RACS\", the corresponding UE Capability ID) is
handled by the core network as a \"transparent container\", and at handover
legacy RAN nodes do not modify fields in the UE RAC that they do not
understand.
For each Integrity Protection algorithm, the UE RAC would contain one bit to
indicate whether or not it supports UPIP for that algorithm.
The eNB assumes that \"UPIP is preferred\" unless conflicting policy
information is received from the core network (or source eNB at X2 handover).
As specified in clause 5.11.2 of TS 23.401 [b], the MME normally stores the UE
Radio Access Capabilities. However, for some infrequent NAS procedures the MME
makes the RAN obtain the UE Radio Access Capabilities from the UE (for them to
then be sent on to the MME and stored). The MME does this by sending the
security parameters to the RAN in the S1-AP INITIAL CONTEXT SETUP REQUEST
message but omitting the UE Radio Access Capability information from that
message. The RAN should then activate RRC security (at least integrity
protection of RRC signalling) and subsequently retrieve the UE Radio Access
Capabilities in integrity protected signalling. The use of integrity protected
signalling by the RAN avoids a man-in-the-middle attack being able to \"bid
down\" the UPIP algorithms listed as supported in the UE Radio Access
Capabilities.6.AB.4 Solution evaluation
This approach can avoid impact on the core network, and, allows Inter-
operability testing on a per-algorithm basis.
The network operator remains in control of the RAN configuration that controls
which Integrity Protection algorithms are permitted.
## 6.27 Solution #27: Interworking handover from EPS to 5GS using R15
signalling and procedures
### 6.27.1 Introduction
This solution addresses key issue #7: Ensuring UP IP is enforced at
interworking.
This solution does not impact the UE nor any of the MME, the AMF, the eNB,
SMF, the ng-eNB and gNB.
### 6.27.2 Network options affected
This solution is applicable to the following network options as source RAN:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.27.3 Solution description
The existing solutions are reused without modification. These solutions
support handover to and from the gNB and provide the gNB with the capability
to enforce the UPIP policy.
\- The signalling flow specified in TS 23.502 [13] clause 4.11.1.2.2 is used.
\- The target gNB/ng-eNB receives the UPIP \"required, preferred, not
needed,...\" value in the Security Indication IE (clause 9.3.1.27 of TS 38.413
[7]) which is sent within the PDU Session Resource Setup Request Transfer IE
(clause 9.3.4.1 of TS 38.413 [7]) that is sent \"_transparent to the AMF_ \"
as a mandatory IE in the Handover Request message (clause 9.2.3.4 of TS 38.413
[7]).
\- The legacy ng-eNB understands the signalling for \"UPIP required\" and can
obey it.
### 6.27.4 Solution evaluation
This solution meets the requirements with minimal network impact.
## 6.28 Solution #28: Interworking from 5GS to EPS
### 6.28.1 Introduction
The solution addresses key issue #7. The solution provides a whole picture for
UP security policy handling of interworking from 5GS to EPS.
### 6.28.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 2 - NR standalone with 5G Core
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
\- Option 4 - 5G core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G core with eUTRA
\- Option 7 - 5G core based Dual Connectivity (eUTRA master - NR secondary)
### 6.28.3 Solution description
#### 6.28.3.0 Solution Details
Currently, there is restriction for interworking as depicted in clause 5.10.3
in TS 23.501 [12],
\"_For PDU Sessions with UP integrity protection of UP Security Enforcement
Information set to Required, the SMF shall not trigger the EPS bearer ID
allocation procedure in TS 23.502 [13] clause 4.11.1.4._ \",
It means that when one of the PDU session\'s UP integrity protection policy is
set to \"Required\", this PDU session cannot be interworked from 5GS to EPS
because no EPS bearer ID is allocated.
As depicted in clause 4.11.5.3 in TS 23.502 [13],
\"_Step 4: If the EPS Interworking indication received from AMF indicates that
the UE supports EPS interworking and the SMF determines, based on the EPS
interworking support indication from the AMF and additional UE subscription
data (e.g. whether UP integrity protection of UP Security Enforcement
Information is not set to required, EPS interworking is allowed for this DNN
and S-NSSAI), that the PDU Session supports EPS interworking, the PGW-C+SMF
FQDN for S5/S8 interface is included in the Nudm_UECM_Registration Request._
\",
it means that when one of the PDU session\'s UP integrity protection policy is
set to \"Required\", this PDU session cannot be interworked from 5GS to EPS
because SGW cannot find PGW-C+SMF with its FQDN for S5/S8 interface.
However, if UP integrity protection is supported in EPC, such restriction
should not be valid. Thus, this solution proposes as below:
\- When the UE is in 5G, if the network knows that the UE supports user plane
integrity protection with an eNB, the restriction for interworking is
cancelled. And the PGW-C+SMF also prepares mapped UP security policy for EPS,
and stores it in EPS bearer context.
\- During or after 5GS to EPS interworking procedure, e.g. 5GS to EPS idle
mode mobility, 5GS to EPS handover, since PGW-C+SMF has already stored UP
security policy in EPS bearer context, the new MME can retrieve EPS bearer
context with UP security policy from PGW-C+SMF via AMF transparently.
\- The eNB can retrieve UP security policy from the MME, and use AS SMC and
RRC Reconfiguration procedure to configure the usage of UP Integrity
Protection with the UE.
#### 6.28.3.1 Impacts to 5GC procedures
During Registration procedure, the AMF receives indication that the UE
supports user plane integrity protection with an eNB from the UE, and stores
it in the UE context.
During the PDU session establishment procedure enhanced for interworking, the
procedure is the same as the procedure depicted in clause 4.11.5.3 in TS
23.502 [13] with the following modifications:
\- In step 3, if the AMF knows UE support UP IP with eNB according to the UE
context, the AMF sends the indication that the UE supports user plane
integrity protection to the SMF+PGW-C.
\- In step 4, the SMF+PGW-C determines whether restriction of EPS interworking
is still available based on the received indication, i.e. if the indication is
received, the SMF+PGW-C can provide PGW-C+SMF FQDN for S5/S8 interface to the
UDM without considering the UP integrity protection.
\- After step 4, if the indication is received, the PGW-C+SMF can trigger EPS
Bearer ID allocation procedure as depicted in clause 4.11.1.4.1 in TS 23.502
[13] without considering the UP integrity protection.
\- After step 4, if the indication is received, the PGW-C+SMF also maps UP
security policy from PDU session to EPS bearer, and stores it in EPS bearer
context.
#### 6.28.3.2 5GS to EPS Idle Mode Mobility
The procedure is the same as the procedure depicted in clause 4.11.1.3.2 in TS
23.502 [13] with the following modifications:
\- In step 5a, if both MME and UE support user plane integrity protection, the
AMF sends an indication in the Nsmf_PDUSession_Context Request message.
\- In step 5c and 6, if the SMF+PGW-C receives the indication, and already
stored UP security policy in EPS bearer context, the SMF+PGW-C sends UP
security policy in the EPS bearer context to the AMF, and the AMF sends the
EPS bearer context to the MME transparently. If the SMF+PGW-C does not receive
the indicator, the SMF+PGW-C does not send the EPS bearer context whose UP IP
policy is set as \"required\".
After receiving the UP security policy, the MME maps the UE security policy
from EPS bearer to E-RAB, and sends it to the eNB during any existing
procedures, e.g. attach, service request, bearer management procedure, etc.
#### 6.28.3.3 5GS to EPS Handover
The procedure is the same as the procedure depicted in clause 4.11.1.2.1 in TS
23.502 [13] with the following modifications:
> \- In step 2a, if both MME and UE support user plane integrity protection,
> the AMF sends an indication in the Nsmf_PDUSession_Context Request message.
\- In step 2c and 3, if the SMF+PGW-C receives the indication, and has already
stored UP security policy in EPS bearer context, the SMF+PGW-C sends UP
security policy in the EPS bearer context to the AMF, and the AMF sends the
EPS bearer context to the MME transparently. If the SMF+PGW-C does not receive
the indicator, the SMF+PGW-C does not send the EPS bearer context whose UP IP
policy is set as \"required\".
\- In step 6, the MME maps the UE security policy from EPS bearer to E-RAB,
and sends it to the eNB in the Handover Request message.
### 6.28.4 Solution evaluation
The solution impacts UE, eNB, MME, AMF and SMF+PGW-C.
If UE or eNB have not been upgraded to support UP IP, then UP IP is not
supported absolutely.
If UE and eNB have been upgraded, and the eNB is configured with local UP
security policy based on solution 20,
\- If AMF, MME, and SMF+PGW-C have been upgraded, the solution unlocks the
current restriction for 5GS to EPS interworking, so that the eNB can retrieve
the UP security policy (even the UP IP policy is set as required) from the UDM
in 5GC.
\- If AMF or MME or SMF+PGW-C have not been upgraded, the eNB can use locally
configured UP security policy.
In case that UP IP policy is set as \"required\" in SMF+PGW-C, but target eNB
is legacy eNB, how to ensure the bearers that require UP IP are not handed
over to a legacy eNB can be addressed in solution 18 or 25 or 26.
## 6.29 Solution #29: Source eNB pre-configured with neighbour target eNB\'s
support of UP IP
### 6.29.1 Introduction
This solution addresses Key Issue# 7 for handovers.
This solution applies to X2 handover.
### 6.29.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.29.3 Solution description
_At X2-handover, an upgraded source eNB supporting UP IP needs to identify a
legacy target eNB which does support UP IP_. This solution proposes that
source eNB could be pre-configured with the neighbouring target eNB\'s
capability to support UP IP. This could save resources in the network when the
UP IP policy is set to \"Required\" as the source eNB would not attempt to
initiate an X2-handover to a target eNB which does not support UP IP in this
particular case.
If the target eNB supports UP IP and receives the UP IP policy from the source
eNB over X2 interface and UP IP policy is set to \"Required\", but the target
eNB cannot activate UP IP, then the target eNB rejects the X2-handover.
NOTE: Pre-configuring the policy may not be feasible in all network
situations, configuring all the neighbouring eNB capability policy may not be
practical in dense networks. It will affect existing eNBs as more base
stations are added or configurations changed.
### 6.29.4 Solution evaluation
The solution requires change on eNB.
An advantage of this solution is that the source eNB is pre-configured with
the neighbouring target eNB\'s capability to support UP IP. This could save
resources in the network when the UP IP policy is set to \"Required\" as the
source eNB would not attempt to initiate an X2-handover to the target eNB
which does not support UP IP in this particular case and unnecessary
reservation of resources in the target eNB is avoided.
## 6.30 Solution #30: Use of criticality information when UP IP policy is set
to \"Required\"
### 6.30.1 Introduction
This solution addresses Key Issue #1 and Key Issue #7 for handovers.
This solution applies to X2 handover, S1 handover and interworking handover
from 5GS to EPS.
### 6.30.2 Network options affected
This solution is applicable to the following network options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
### 6.30.3 Solution description
This solution proposes to use criticality information on S1 interface and X2
interface when UP IP policy is set to \"Required\". Criticality information is
already defined in existing protocols defined in TS 36.413 [7] in clause
10.3.2 and in TS 36.423.
If the target eNB does not understand or comprehend the new UP IP policy IE
received on S1 interface and X2 interface for a radio bearer/PDN connection,
then the target eNB should reject or ignore the corresponding IE in the
handover request and notify the sender. Otherwise the source eNB needs to peak
into the RRCReconfiguration provided by the target eNB in order to find out
whether UP IP has been configured or not, by the target eNB.
### 6.30.4 Solution evaluation
This solution fulfils the security requirements key issue #1 and key issue #7.
This solution proposes to re-use criticality information defined in existing
protocols in TS 36.413 and TS 36.423.
This solution works with legacy target eNBs which does not support UP IP.
# 7 Conclusions
## 7.1 Conclusions on UE connects to 5GC via eUTRA
It is concluded that the architectural approach of applying user plane
integrity protection at NR PDCP layer in TS 33.501[4] is adopted as the basis
for normative work for the following network options:
\- Option 2 - NR standalone with 5G Core
\- Option 4 - 5G Core based Dual Connectivity (NR master - eUTRA secondary)
\- Option 5 - 5G Core with eUTRA
\- Option 7 - 5G Core based Dual Connectivity (eUTRA master - NR secondary)
For Key Issue #6 (UE connected to 5GC indicating support of UP IP over eUTRA),
Solution #8 (Using existing 5G UE security capability to signal the UE support
of UP IP over eUTRA to 5GC) is adopted for the normative work.
## 7.2 Conclusions on UE connects to EPC via eUTRA
It is concluded that the user plane integrity protection at PDCP layer in TS
33.401 is adopted as the basis for normative work for the following network
options:
\- Option 1 - eUTRA with EPC
\- Option 3 - EPC based Dual Connectivity of eUTRA and NR RAT
For Key Issue #1 (UP integrity activation in EPS) and Key Issue #2 (Secure
negotiation of integrity protection support in EPS), the following conclusions
have been made:
\- Support of UP IP provided at PDCP layer in the UE and the eNB using NR
PDCP.
\- A solution with a local RAN policy configuration for UP IP, to be used when
connected to a legacy core network is supported.
\- The solution with local RAN policy configuration for UP IP is enhanced with
the option of a Core Network/RAN solution for UP IP policy handling.
For Key Issue #7 (Ensuring UP IP is enforced at interworking), the following
conclusions have been made:
\- For interworking from EPS to 5GS, solution 27 is recommended as baseline
for UP security policy handling.
\- For interworking from 5GS to EPS, it is concluded that UP security policy
handling will be addressed in normative phase.
#
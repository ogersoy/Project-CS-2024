# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
> Version x.y.z
>
> where:
>
> x the first digit:
>
> 1 presented to TSG for information;
>
> 2 presented to TSG for approval;
>
> 3 or greater indicates TSG approved document under change control.
>
> y the second digit is incremented for all changes of substance, i.e.
> technical enhancements, corrections, updates, etc.
>
> z the third digit is incremented when editorial only changes have been
> incorporated in the document.
In the present document, modal verbs have the following meanings:
> **shall** indicates a mandatory requirement to do something
>
> **shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
> **should** indicates a recommendation to do something
>
> **should not** indicates a recommendation not to do something
>
> **may** indicates permission to do something
>
> **need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
> **can** indicates that something is possible
>
> **cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
> **will** indicates that something is certain or expected to happen as a
> result of action taken by an agency the behaviour of which is outside the
> scope of the present document
>
> **will not** indicates that something is certain or expected not to happen
> as a result of action taken by an agency the behaviour of which is outside
> the scope of the present document
>
> **might** indicates a likelihood that something will happen as a result of
> action taken by some agency the behaviour of which is outside the scope of
> the present document
>
> **might not** indicates a likelihood that something will not happen as a
> result of action taken by some agency the behaviour of which is outside the
> scope of the present document
In addition:
> **is** (or any other verb in the indicative mood) indicates a statement of
> fact
>
> **is not** (or any other negative verb in the indicative mood) indicates a
> statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document studies the charging aspects of 5G LAN-type service based
on TS 23.501 [6] and TS 23.502 [7] specifications:
\- Charging scenarios and potential requirements for 5G LAN-type service.
\- The possible charging aspects for 5G VN group management and 5G VN group
communication, including the impact on charging architecture, charging
functions and charging procedures.
The stage 1 charging requirements from TS 22.261 [5] Release 16 on 5G LAN-type
service topic are considered in this study.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
> [1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 32.255: \"Telecommunication management; 5G data connectivity
domain charging; stage 2\".
[3] 3GPP TS 32.290: \"Telecommunication management; Charging management; 5G
system; Services, operations and procedures of charging using Service Based
Interface (SBI)\".
[4] Void.
[5] 3GPP TS 22.261: \"Service requirements for next generation new services
and markets; Stage 1\".
[6] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[7] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[8] 3GPP TS 32.254: \"Exposure function Northbound Application Program
Interfaces (APIs) charging\".
[9] 3GPP TS 28.202: \"Charging management; Network slice management charging
in the 5G System (5GS); Stage 2\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
**5GLAN Group:** A set of UEs using private communication for 5G LAN-type
service.
**5G LAN-Type Service:** A service over the 5G system offering private
communication using IP and/or non-IP type communications.
**5G LAN-Virtual Network:** A virtual network over the 5G system capable of
supporting 5G LAN-type service.
## 3.2 Symbols
> Void.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
5GLAN 5G Local Area Network
PSA PDU Session Anchor
UPF User Plane Function
CHF Charging Function
VN Virtual Network
# 4 Background
## 4.1 General
As defined in TS 23.501 [6], the 5G Virtual Network (VN) group consists of a
set of UEs using private communication for 5G LAN-type services. For example,
in the enterprise environment, the UE in the 5G VN group can communicate with
each other within a 5G VN.
## 4.2 5G LAN-type Architecture
5G System architecture defined in clause 4.2 TS 23.501[6] is applicable to
5GLAN-type services with the following enhancement and clarifications.
There are three types of traffic forwarding methods allowed for 5G VN
communication:
> \- N6-based, where the UL/DL traffic for the 5G VN communication is
> forwarded to/from the DN; Figure 4.2-1 depicts the non-roaming user plane
> architecture to support 5G LAN-type service using N6 tunnel.
{width="4.1875in" height="1.5104166666666667in"}
Figure 4.2-1: N6-based user plane architecture in non-roaming scenario
> \- Local switch, where traffic is locally forwarded by a single UPF if this
> UPF is the common PSA UPF of different PDU Sessions for the same 5G VN
> group. Figure 4.2-2 depicts the non-roaming user plane architecture to
> support 5G LAN-type service using local switch.
{width="4.1875in" height="1.5104166666666667in"}
Figure 4.2-2: Local-switch based user plane architecture in non-roaming
scenario
> \- N19-based, where the UL/DL traffic for the 5G VN group communication is
> forwarded between PSA UPFs of different PDU sessions via N19. N19 is based
> on a shared User Plane tunnel connecting PSA UPFs of a single 5G VN group.
> Figure 4.2-3 depicts the non-roaming user plane architecture to support 5G
> LAN-type service using N19 tunnel.
{width="4.125in" height="1.0416666666666667in"}
Figure 4.2-3: N19-based user plane architecture in non-roaming scenario
A UE gets access to 5G LAN-type services via a PDU Session of IP PDU Session
type or Ethernet PDU Session type.
A dedicated SMF is responsible for all the PDU Sessions for communication of a
certain 5G VN group.
The SMF handles the user plane paths of the 5G VN group, including:
> \- The SMF may prefer to select a single PSA UPF for as many PDU sessions
> (targeting the same 5G VN group) as possible, in order to implement local
> switch on the UPF.
>
> \- (if needed) Establishing N19 tunnels between PSA UPFs to support
> N19-based traffic forwarding.
For Ethernet PDU Session, the SMF may instruct the UPF(s) to classify frames
based on VLAN tags, and to add and remove VLAN tags, on frames received and
sent on N6 or N19 or internal interface (\"5G VN internal\"),
The UE may be connected with the PSA via an I-UPF which is controlled by the
I-SMF. In this case, traffic switching (e.g. UPF local traffic switching) is
controlled by the SMF without any specific knowledge or involvement of the
I-SMF to support the 5G LAN-type service.
## 4.3 5G Virtual Network Group Management
The 5G System supports management of 5G VN Group identification and membership
(i.e. definition of 5G VN group identifiers and membership) and 5G VN Group
data (i.e. definition of 5G VN group data). The 5G VN Group management can be
configured by a network administrator from OAM or can be managed dynamically
by AF to NEF.
A 5G VN group is characterized by the following:
\- 5G VN group identities: External Group ID and Internal Group ID are used to
identify the 5G VN group.
\- 5G VN group membership: The 5G VN group members are uniquely identified by
GPSI. The group as described in clause 5.2.3.3.1 of TS 23.502 [3] is
applicable to 5G LAN-type services.
\- 5G VN group data. The 5G VN group data may include the following
parameters: PDU session type, DNN, S-NSSAI and Application descriptor,
Information related with secondary authentication / authorization (e.g. to
enable IP address assignment by the DN-AAA).
In order to support dynamic management of 5G VN Group identification and
membership, the NEF exposes a set of services to manage (e.g.
add/delete/modify) 5G VN groups and 5G VN members. The NEF also exposes
services to dynamically manage 5G VN group data.
A 5G VN group is identified by the AF using External Group ID. The NEF
provides the External Group ID to UDM. The UDM maps the External Group ID to
Internal Group ID. For a newly created 5G VN Group, an Internal Group ID is
allocated by the UDM.
An External Group ID for a 5G VN group corresponds to a unique set of 5G VN
group data parameters.
The 5G VN group configuration is either provided by OA&M or provided by an AF
to the NEF.
An AF may update the UE Identities of the 5G VN group at any time after the
initial provisioning.
The PDU session type, DNN, S-NSSAI provided within 5G VN group data cannot be
modified after the initial provisioning.
The support of 5G VN group management configured by a network administrator
(OAM-based 5G VN group management) is described in clause 5.25.2 of TS 23.501
[6].
## 4.4 5G Virtual Network Group Communication
A PDU Session provides unicast, broadcast and multicast communication for the
DNN and S-NSSAI associated to a 5G VN group. The PSA UPF determines whether
the communication is for unicast, broadcast or multicast based on the
destination address of the received data, and performs unicast, broadcast or
multicast communication handling.
# 5\. Topics
## 5.1 Topic 1: Converged charging for 5G VN group management
### 5.1.1 Use Case
#### 5.1.1.1 Use Case #1.1: 5G VN group data management via AF
The enterprise provides the 5G group addition requirement via the service
exposure NEF to AF, the AF creates the 5G VN group.
The enterprise provides the 5G group modification requirement via the service
exposure NEF to AF, the AF modifies the 5G VN group.
The enterprise provides the 5G group deletion requirement via the service
exposure NEF to AF, the AF deletes the 5G VN group.
The potential charging requirements for this UC are: **REQ-3GPPCH-VNM-01** and
**REQ-3GPPCH-VNM--02**.
#### 5.1.1.2 Use Case #1.2: OAM-based 5G VN group data management
The 5G VN group parameters about a UE may be configured in subscription data
of the UE and delivered together with other subscription data by the UDM for
supporting 5G LAN.
When OAM makes a 5G VN group addition request, the UDM creates the 5G VN
group.
When OAM makes a 5G VN group modification request, the UDM updates the 5G VN
group.
When OAM makes a 5G VN group deletion request, the UDM deletes the 5G VN
group.
The potential charging requirements for this UC are: **REQ-3GPPCH-VNM-01**.
### 5.1.2 Potential charging requirements
**REQ-3GPPCH-VNM-01** The 5G system should support converged charging for 5G
VN group data creation, modification and deletion based external and internal
group id.
**REQ-3GPPCH-VNM-02** The 5G system should support converged charging for 5G
VN group membership update, UE addition and removal based on external and
internal group id.
### 5.1.3 Key issues
#### 5.1.3.1 Key issue #1.1: Chargeable events and charging information
required
This key issue is for investigating how to support the 5G LAN-type service
charging considering REQ-3GPPCH-VNM-01, REQ-3GPPCH-VNM-02, and REQ-3GPPCH-
VNM-03. This investigation covers the following:
\- identification and classification of the charging information for 5G VN
group management;
\- identification and classification of the chargeable event for 5G VN group
management;
#### 5.1.3.2 Key issue #1.2: NF/Service suitable to provide charging
information
This key issue is for investigating how to support the 5G LAN-type service
charging considering REQ-3GPPCH-VNM-01, REQ-3GPPCH-VNM-02, and REQ-3GPPCH-
VNM-03.
This investigation covers the following:
\- determination of which NF in the 5G system are suitable to provide the
charging information to support the 5G group management;
### 5.1.4 Solutions
#### 5.1.4.1 Solution #1.1: Add the NEF based Solution for 5G VN Group
##### 5.1.4.1.1 General description
This solution#1.1 which _relying on_ CHF/5G Converged Charging System for NEF
Converged Charging, addresses the Key Issue#1.1 and Key Issue#1.2.
In order to support dynamic 5G VN Group management, the NEF exposes a set of
services to manage (e.g. add/delete/modify) 5G VN groups, 5G VN groups data
and 5G VN members. The NEF Converged charging specified in TS 32.254 [8] is
used for 5G VG Group Converged Charging.
In the solution#1.1, the interactions between CHF and NEF is present as the
following:
\- Charging Function (CHF) exposing Nchf_ConvergedCharging service
\- NEF as the NF consumer (CTF) consumer the Nchf_ConvergedCharging service
The NEF should be able to perform converged charging for charging data related
to 5G VN group management services. The Charging Data Request and Charging
Data Response are exchanged between the NEF and the CHF, based on event based
charging specified in TS 32.290 [3].
The Charging Data Request is issued by the NEF towards the CHF when certain
following conditions (chargeable events) are met. The related charging
information (e.g. External Group ID, Internal Group ID, etc.) is reported in
the Charging Data Request.
\- Addition of 5G VN group;
\- Modification of 5G VN group;
\- Deletion of 5G VN group;
##### 5.1.4.1.2 Architecture description
The converged charging architecture for NEF based solution as depicted in
figure 5.1.4.1.2-1 is proposed for the event based charging of 5G VN Group.
Figure 5.1.4.1.2-1: NEF based solution
##### 5.1.4.1.3 Procedures description
The figure 5.1.4.1.3 describes the high level charging procedure for NEF
Converged charging for 5G VN group. The event based charging specified in TS
32.290[3] are supported for this solution.
Figure 5.1.4.1.3-1: Message flow for NEF Converged charging for 5G VN group
> 1\. NEF receives a 5G VN Group Management service Request from an NEF,
> including e.g. addition/modification/deletion the 5G VN Group and 5G VN
> members, and the modification of 5G VN group data..
>
> 1ch-a. The NEF sends Charging Data Request [Event] to CHF for the received
> service request.
>
> 1ch-b. The CHF creates a CDR.
>
> 1ch-c. The CHF acknowledges by sending Charging Data Response [Event] to the
> NEF.
>
> 2\. NEF performs the actions to fulfil the 5G VN Group management service
> request and send the service response.
#### 5.1.4.2 Solution #1.2: Add the UDM based solution for 5G VN Group
##### 5.1.4.2.1 General description
This solution#1.2 which _relying on_ CHF/5G Converged Charging System for UDM
Converged Charging, addresses the Key Issue#1.1 and Key Issue#1.2.
As per the TS 23.501[6], in order to support the dynamic 5G VN Group
management which is either provided by OAM or provided by an AF to the NEF,
the following proceduces are provided by the UDM:
\- 5G VN Group identification and membership:
> \- the UDM allocates the Internal Group ID for a newly created 5G VN Group
> and maps the External Group ID to Internal Group ID.
>
> \- the UDM updates the Internal Group ID-list of the corresponding UE\'s
> subscription data in UDR, if needed.
>
> \- The UDM updates the Group Identifier translation in the Group
> Subscription data with the Internal Group ID, External Group ID and list of
> group members, if needed.
\- 5G VN Group data: The UDM stores/updates the 5G VN group data (PDU session
type, DNN and S-NSSAI, Application descriptor, Information related with
secondary authentication / authorization) in UDR.
According the difference interactions between CHF and UDM, the solution#1.Y
will be present as the following:
> \- Charging Function (CHF) exposing Nchf_ConvergedCharging service
>
> \- UDM as the NF service producer to provide the Nudm_SDM_Get service.
>
> \- CEF as the NF Consumer to consume the Nchf_ConvergedCharging Service and
> Nudm_SDM_Get service.
The Charging Data Request and Charging Data Response are exchanged between the
CEF and the CHF, based on event based charging scenarios specified in TS
32.290 [3].
The Charging Data Request is issued by the CEF towards the CHF when certain
following conditions (chargeable events) are met.
\- Addition of 5G VN group;
\- Modification of 5G VN group;
\- Deletion of 5G VN group;
##### 5.1.4.2.2 Solution #1.2.1: UDM Charging Enablement Function(CEF) based
solution
###### 5.1.4.2.2.1 Architecture description
The converged charging architecture for UDM Charging Enablement Function(CEF)
based solution as depicted in figure 5.1.4.2.2.1-1 UDM based solution-CEF and
are proposed for the event based charging of 5G VN Group.
Figure 5.1.4.2.2.1-1: UDM based solution-CEF
###### 5.1.4.2.2.2 Procedures description
The figure 5.1.4.2.2.2-1 describes the high level charging procedure for UDM
based solution (CEF) Converged charging for 5G VN group. The intention of
solution #1.2 is to reuse the current services exposed by UDM.
Figure 5.1.4.2.2.2-1: Message flow for UDM Converged charging (CEF) for 5G VN
group
> 1\. The CEF decides to subscribe the 5G VN Group information based on the
> charging requirement.
>
> 2\. The CEF sends the 5G VN Group information subscription Request to the
> UDM.
>
> 3\. The UDM sends the 5G VN Group information subscription successful
> Response to the CEF, including current VG group information, e.g. the
> Internal Group ID, Internal Group ID-list of the corresponding UE\'s
> subscription data.
>
> 3ch-a. The CEF sends Charging Data Request [Event] to CHF for 5G VN Group
> subscription information.
>
> 3ch-b. The CHF creates a CDR.
>
> 3ch-c. The CHF acknowledges by sending Charging Data Response [Event] to the
> CEF.
>
> 4\. The UDM sends the notifications when the subscribed the 5G VN Group
> information is modified.
>
> 4ch-a. The CEF sends Charging Data Request [Event] to CHF for the received
> notifications.
>
> 4ch-b. The CHF creates a CDR.
>
> 4ch-c. The CHF acknowledges by sending Charging Data Response [Event] to the
> CEF.
### 5.1.5 Evaluation
#### 5.1.5.1 Solutions evaluation for Key issue #1.1
Both solution #1.1 and #1.2 address Key issue #1.1 with the same chargeable
event and charging information.
#### 5.1.5.2 Solutions evaluation for Key issue #1.2
Both solution #1.1 and #1.2 address Key issue #1.2, with the difference the NF
that is responsible for the interaction with CHF.
The solution #1.1:
\- The NEF can provide charging for the group information when the 5G VN group
is added, modified and deleted via AF according to TS 32.254[8].
\- If the 5G VG group is configured by OAM or not handled via the AF, the
charging would be required to be handled by BSS (out of the current scope of
SA5) or OAM which reusing the charging mechanism specified in TS 28.202[9].
The solution #1.2:
\- An enhancement on the UDM the subscription and notification mechanism would
be required (e.g. adding 5G LAN VN Group information into the Nudm_SDM_Get
service). If the enhancement is done then the UDM can provide the group
information since the UDM is aware of the 5G VN Group addition, modification
and deletion.
### 5.1.6 Conclusion
It is concluded to that solution #1.1 is already supported and could be
extended with #1.2, preferably the charging in both solutions should be the
same.
## 5.2 Topic 2: Converged charging for traffic forwarding of 5G VN group
communication
### 5.2.1 Use Case
#### 5.2.1.1 Use Case #2.1: Traffic Forwarding of 5G VN Group Communication
A 5G LAN service is subscribed and the 5G VN group1 is created. The UE 1
accesses the 5G VN group 1, and sends the message/data to the other UEs using
either the N6-based, Local-switch or N19-based user plane. The 5G LAN
architectures for N6-based, Local-switch and N19-based used in the use case is
described in the clause 4.2.
The consumptions of network traffic in operator are different in three types
of traffic forwarding methods of 5G VN communication. For Local switch, the
traffic is locally forwarded by a single UPF for the same 5G VN group. In this
scenario, the volumes of traffic among UEs are mainly in the intranet of
enterprise. For N19-based, the traffic for the 5G VN group communication is
forwarded between PSA UPFs of different PDU sessions. For N6-based, the
traffic for the 5G VN communication is forwarded to/from the DN. N19-based and
N6-based occupy more resources and traffics of operator than Local switch.
The subscriber is charged based on the VN group communication type (e.g. N6
based/N19-based/Local switch) and volume/duration.
The potential charging requirements for this UC are: REQ-3GPPCH-TFM-01,
REQ-3GPPCH-TFM-02 and REQ-3GPPCH-TFM-03.
### 5.2.2 Potential charging requirements
**REQ-3GPPCH-TFM-01:** The 5G system should support converged charging for 5G
VN group communication using N6 tunnel.
**REQ-3GPPCH-TFM-02:** The 5G system should support converged charging for 5G
VN group communication using local switch.
**REQ-3GPPCH-TFM-03:** The 5G system should support converged charging for 5G
VN group communication using N19 tunnel.
### 5.2.3 Key issues
#### 5.2.3.1 Key issue #2.1: Chargeable events and charging information
required
This key issue is for investigating how to support the 5G LAN-type service
charging considering REQ-3GPPCH- TFM-01, REQ-3GPPCH-TFM-02 and REQ-3GPPCH-
TFM-03.
This investigation covers the following:
\- identification and classification of the charging information for different
traffic forwarding of 5G VN group communication;
\- identification and classification of the chargeable event for different
traffic forwarding of 5G VN group communication;
\- determination of which NF in the 5G system are suitable to provide the
charging information to support the different traffic forwarding of 5G group
communication.
### 5.2.4 Solutions
#### 5.2.4.1 Solution #2.1: Add the SMF based solution for traffic forwarding
##### 5.2.4.1.1 General description
This solution#2.1 which _relying on_ CHF/5G Converged Charging System for
traffic forwarding charging, addresses the Key Issue#2.1.
In order to support the 5G VN Group communication, the following three types
of traffic forwarding methods are provided in the TS 23.501[6]:
\- N6 based user plane architecture:
> \- A dedicated SMF is responsible for all the PDU Sessions for communication
> of a certain 5G VN group. The SMF requests the quota management and reports
> the charging information per PDU session.
\- Local switch based user plane architecture:
> \- The SMF may prefer to select a single PSA UPF for as many PDU sessions
> (targeting the same 5G VN group) as possible, in order to implement local
> switch on the UPF. The SMF requests the quota management and reports the
> charging information per PDU session.
\- N19 based user plane architecture:
> \- The SMF correlates PDU sessions established to the same 5G VN group and
> uses this to configure the UPF with the group level N4-session including
> packet detection and forwarding rules for N19 tunnelling forwarding.
>
> \- The SMF supports 2 charging scenarios:
>
> \- The SMF requests the quota management and reports the charging
> information per PDU session.
>
> \- The SMF reports the charging information per PDU session with N19
> information to support the aggregation of N19 based usage.
##### 5.2.4.1.2 Solution #2.1.1: SMF Charging Trigger Function (CTF) based
solution
###### 5.2.4.1.2.1 Architecture description
The converged charging architecture for SMF Charging Trigger Function (CTF)
based solution as depicted in figure 5.2.4.1.2.1-1 SMF based solution-CTF and
are proposed for the session based charging.
Figure 5.2.4.1.2.1-1: SMF based solution-CTF
###### 5.2.4.1.2.2 Procedures description
###### # 5.2.4.1.2.2.1 Charging procedures for traffic forwarding
The figure 5.2.4.1.2.2.1-1 describes the high level charging procedure for SMF
(CTF) Converged charging for traffic forwarding of 5G VN group communication,
which is applicable for the case that only one of the traffic forwarding way
is used.
Figure 5.2.4.1.2.2.1-1: Message flow for traffic forwarding
> 1\. SMF received the PDU session establishment request as specified in
> clause 5.2.2.2.2 TS 32.255 [2].
>
> 1ch-a. The SMF sends Charging Data Request [Initial, Requested Quota] to CHF
> for the traffic forwarding of UEs.
>
> 1ch-b. The CHF creates a CDR.
>
> 1ch-c. The CHF acknowledges by sending Charging Data Response [Initial,
> Granted Quota] to the SMF.
>
> 2\. SMF sends the PDU session establishment response. For PDU Session of
> Ethernet type, the SMF may instruct the UPF to handle VLAN information of
> the Ethernet frames related with the PDU Session received and sent on N6 or
> N19 or internal interface, as described in TS 23.501 [6] clause 5.6.10.2.
>
> 3\. The traffic is forwarded between UEs in the 5G VN group as the request.
>
> 4\. UPF/PSA UPF reports the usage reporting of the traffic forwarding to
> SMF.
>
> 4ch-a. The SMF sends Charging Data Request [Update, Used Quota and Requested
> Quota] to CHF with the traffic forwarding information (i.e. Local switch,
> N19 based or N6 based).
>
> 4ch-b. The CHF update a CDR.
>
> 4ch-c. The CHF acknowledges by sending Charging Data Response [Update,
> Granted Quota] to the SMF.
>
> 5\. SMF sends the granted quotas to the UPF/PSA UPF in the usage reporting
> response.
>
> 6\. UPF/PSA UPF reports the usage reporting of the last traffic forwarding
> to SMF.
>
> 6ch-a. The SMF sends Charging Data Request [Termination, Used Units] to CHF
> with the traffic forwarding information (i.e. Local switch, N19 based or N6
> based).
>
> 6ch-b. The CHF close a CDR.
>
> 6ch-c. The CHF acknowledges by sending Charging Data Response [Termination]
> to the SMF.
>
> 7\. SMF sends the usage reporting response to the UPF/PSA UPF.
NOTE: The different traffic forwarding methods consume different 5G network
resources. For various business reasons at the operator, that may require the
recording and logging based on the different traffic forwarding methods.
### 5.2.5 Evaluation
#### 5.2.5.1 Solutions evaluation for Key issue #2.1
The solution #2.1.1 addresses Key issue #2.1 with no impact on the SMF
charging architecture, operation. New parameters for 5G VN Group service are
required.
### 5.2.6 Conclusion
It is concluded to use the solution #2.1.1, that the SMF may require to record
the charging information based on the different traffic forwarding methods and
then reports to CHF with the indication for traffic forwarding methods.
## 5.3 Topic 3: Converged charging for 5G VN Group Communication
### 5.3.1 Use Case
#### 5.3.1.1 Use Case #3.1: 5G VN group communication
The UE 1, UE 2 and UE 3 subscribes the 5G VN group 1, the following scenarios
for 5G VN group communication should be supported:
\- UE 1 sends the message/data to the UE 2;
\- UE 1 sends the broadcast messages/data of the 5G VN group, all the other
UEs who subscribes the 5G VN group 1 can receive the broadcast messages/data;
\- UE 1 sends the multicast messages/data to the multiple UEs (UE 2 and UE 3)
of the 5G VN group 1.
A PDU Session provides unicast, broadcast and multicast communication for the
DNN and S-NSSAI associated to a 5G VN group 1. The PSA UPF determines whether
the communication is for unicast, broadcast or multicast based on the
destination address of the received data, and performs unicast, broadcast or
multicast communication handling.
The potential charging requirement for this UC is: REQ-3GPPCH-VNC-01.
### 5.3.2 Potential charging requirements
**REQ-3GPPCH-VNC-01:** The 5G system should support converged charging for 5G
VN group communication, including the unicast, broadcast and multicast
communication.
### 5.3.3 Key issues
#### 5.3.3.1 Key issue #3.1: Chargeable events and charging information
required
This key issue is for investigating how to support the 5G LAN-type service
charging considering REQ-3GPPCH-VNC-01. This investigation covers the
following:
\- identification and classification of the charging information for 5G VN
group communication;
\- identification and classification of the chargeable event for 5G VN group
communication;
\- determination of which NF in the 5G system are suitable to provide the
charging information to support the 5G group communication.
### 5.3.4 Solutions
#### 5.3.4.1 Solution #3.1: 5G VN group unicast communication per PDU session
##### 5.3.4.1.1 General description
This solution#3.1 which _relying on_ CHF/5G Converged Charging System for 5G
VN group unicast communication charging, addresses the Key Issue#3.1.
In order to support the unicast communication between two UEs within a 5G VN,
or between a UE and a device on the DN, SMF may adopted the three traffic
forwarding way, as the following figure 5.3.4.1.1-1.
Figure 5.3.4.1.1-1: unicast communication via traffic forwarding
\- **UE 1 communicates with UE 2:** PSA UPF 1 receives the request from UE 1.
PSA UPF 1 determines the communication is for unicast based on the destination
address of the UE 2 and adopts the local switch traffic forwarding.
\- **UE 1 communicates with UE 3:** PSA UPF 1 receives the request from UE 1.
PSA UPF 1 determines the communication is for unicast based on the destination
address of the UE 3 and adopts the N19 tunnel between PSA UPF 1 and PSA UPF 2
for traffic forwarding.
\- **UE 3 communicates with UE 4:** UPF 3 receives the request from UE 3\. UPF
3 determines the communication is for unicast based on the destination address
of the UE 4 and adopts the N6 based traffic forwarding.
##### 5.3.4.1.2 Architecture description
The converged charging architecture for SMF Charging Trigger Function (CTF)
based solution as depicted in figure 5.2.4.1.2.1-1 SMF based solution-CTF for
the session based charging is applicable for the solution #3.1.
##### 5.3.4.1.3 Procedures description
Figure 5.3.4.1.3-1: unicast communication via traffic forwarding
> 1\. UE 1 sends the data to the UE 2.
>
> 2\. UPF1 (PSA UPF) determinates to adapt the unicast communication based on
> the destination and traffic forwarding way based on the description in TS
> 23.501 [6].
>
> 3\. The traffic is forwarded between UEs in the 5G VN group or between a UE
> and a device on the DN as the request.
>
> 4\. UPF/PSA UPF reports the usage reporting of the traffic forwarding to SMF
> and the identifier of the traffic forwarding way (e.g. Local switch, N19
> based and N6 based).
>
> 5\. SMF sends the charging information related to UE 1 and UE 2 respectively
> (e.g. uplink data, volume, identifier of the traffic forwarding way) to the
> CHF.
#### 5.3.4.2 Solution #3.2: 5G VN group unicast communication per N19
##### 5.3.4.2.1 General description
This solution#3.2 which _relying on_ CHF/5G Converged Charging System for 5G
VN group unicast communication charging, addresses the Key Issue#3.1.
##### 5.3.4.2.2 Architecture description
The converged charging architecture for SMF Charging Trigger Function (CTF)
based solution as depicted in figure 5.2.4.1.2.1-1 SMF based solution-CTF for
the session based charging is applicable for the solution #3.1.
##### 5.3.4.2.3 Procedures description
The message flow of the solution #3.2 is the similar with the figure
5.3.4.1.3-1 unicast communication via traffic forwarding, with the different
that:
  * UPF1 (PSA UPF) reports the usage volume per PDU session per UE to SMF.
  * When N19-based forwarding is used, the SMF may report the volume in the N19 tunnel for the PDU session.
#### 5.3.4.3 Solution #3.3: 5G VN group multicast and broadcast communication
##### 5.3.4.3.1 General description
This solution#3.1 which _relying on_ CHF/5G Converged Charging System for 5G
VN group multicast and broadcast communication charging, addresses the Key
Issue#3.1.
In order to support one to many communication including the traffic forwarding
of multicast and broadcast from one UE (or device on the DN) to many/all UEs
within a 5G VN and devices on the DN. SMF may adopted all of the three traffic
forwarding ways.
##### 5.3.4.3.2 Architecture description
The converged charging architecture for SMF Charging Trigger Function (CTF)
based solution as depicted in figure 5.2.4.1.2.1-1 SMF based solution-CTF for
the session based charging is applicable for the solution #3.1.
##### 5.3.4.3.3 Procedures description
The message flow of the solution #3.x is the similar with the figure
5.3.4.1.3-1 unicast communication via traffic forwarding, with the different
that:
  * The multicast and broadcast communication charging is already covered by the unicast communication per PDU session per UE, which is the aggregation of the volume usage.
  * When N19-based forwarding is used, the SMF may report the volume per PDU sessions for the 5G VN Group members, which the CHF may aggregate per 5G VG group.
### 5.3.5 Evaluation
#### 5.3.5.1 Solutions evaluation for Key issue #3.1
Both solution #3.1 #3.2 and #3.3 address Key issue #3.1 with the same
chargeable event, NF and charging information.
In the solution #3.1:
  * For 5G VN group communication per PDU session charging, no impaction > on the SMF and CHF. The extention of 5G VN Group related > information should be reported to CHF.
In the solution #3.2:
  * For 5G VN group communication per PDU session for N19 forwarding, > the enhancement for CHF may aggregate the volume per 5G VG group, > which is out of scope. The extention of 5G VN Group N19 forwarding > related information should be reported to CHF. The solution #3.2 > only support the N19 based traffic forwarding for the 5G VN Group > communication.
In the solution #3.3:
  * The multicast and broadcast communication charging is already > covered by the unicast communication per PDU session per UE, which > is the aggregation of the volume usage per PDU session per UE.
### 5.3.6 Conclusion
It is concluded to that the SMF reports 5G VN group communication per PDU
session in solution #3.1 for unicast and solution #3.3 for multicast and
broadcast communication are preferred.
## 5.4 Topic 4: Charging the usage of 5G VN group communication
### 5.4.1 Use Case
#### 5.4.1.1 Use Case #4.1: Total volume and duration of 5G VN group
communication
The 5G VN group communication is subscribed by a 5G VN group including a
number of UEs. Those UEs can send messages and data to the other UEs via
either the N6-based, Local-switch or N19-based user plane. The 5G LAN
architectures for N6-based, Local-switch and N19-based used in the use case is
described in the clause 4.2.
The 5G VN group as a whole is charged based on the VN group communication type
and usage of 5G VN group communication. The usage of 5G VN group communication
can be the data volume, the number of terminals or duration of 5G VN group
communication. The duration of 5G VN group communication can be counted by the
sum of duration of individual PDU sessions within the 5G VN group
communication. The 5G VN group communication could be identified by
DNN/S-NSSAI by the SMF. The internal group identifier, the map of internal
group identifier and external group identifier are maintained by PCF.
The potential charging requirements for this UC are: **REQ-3GPPCH-UVN-01,
REQ-3GPPCH-UVN-02 and REQ-3GPPCH-UVN-03.**
### 5.4.2 Potential charging requirements
**REQ-3GPPCH-UVN-01: The 5G system should support the capability to collect
charging information of 5G VN group communication related to the data
volume.**
**REQ-3GPPCH-UVN-02: The 5G system should support the capability to collect
charging information of 5G VN group communication related to the duration per
PDU sessions.**
**REQ-3GPPCH-UVN-03: The 5G system should support the capability to collect
charging information of 5G VN group communication related to the number of
terminals.**
### 5.4.3 Key issues
This key issue is for investigating how to support the 5G LAN-type service
charging considering REQ-3GPPCH-UVN-01, REQ-3GPPCH-UVN-02, REQ-3GPPCH-UVN-03.
This investigation covers the following:
\- identification and classification of the charging information related to
the usage for 5G VN group communication;
\- identification and classification of the chargeable event related to the
usage for 5G VN group communication.
### 5.4.4 Solutions
#### 5.4.4.1 Solution #4.1: SMF reports the aggregated usage for 5G VN group
##### 5.4.4.1.1 General description
This solution#4.2 which _relying on_ CHF/5G Converged Charging System for
total volume and duration of 5G VN group communication charging, addresses the
Key Issue#4.1.
As per the TS 23.501, in this release of the specification (R17), only a 1:1
mapping between (DNN, S-NSSAI) combination and 5G VN group is supported. In
order to support the total volume and duration of 5G VN within a 5G VN, the
SMF should aggregates the volume of the PDU sessions of the membership of the
5G LAN VN Group.
For the volume based charging of the 5G VN Group, the total volume is the
aggregation of the volume per PDU session for uplink direction and downlink
direction.
For the duration based charging of the 5G VN Group, the total duration is the
aggregation of the duration per PDU session based on the start timestamp, stop
timestamp and duration for each PDU session. The duration per PDU session is
counted as the duration between PDU session establishment and release.
For the **terminals based charging of the 5G VN Group, the number of terminals
is the number of the membership of** 5G LAN VN Group.
##### 5.4.4.1.2 Architecture description
The converged charging architecture for SMF Charging Trigger Function (CTF)
based solution as depicted in figure 5.2.4.1.2.1-1 SMF based solution-CTF for
the session based charging is applicable for the solution #4.1.
##### 5.4.4.1.3 Procedures description
Figure 5.4.4.1.3-1: SMF aggregates the usage
#### 5.4.4.2 Solution #4.2: CCS aggregates the usage of 5G VN Group per PDU
session
##### 5.4.4.2.1 General description
This solution#4.2 which _relying on_ Converged Charging System for total
volume and duration of 5G VN group communication charging, addresses the Key
Issue#4.1.
The SMF reports the usage (e.g. uplink and downlink volume, duration) per PDU
session, the CCS aggregates the charging information based on the total usage
PDU session. In order to avoid the duplication aggregation, 5G VN group
identifier, the uplink/downlink direction and traffic forwarding way should be
reported to CHF.
##### 5.4.4.2.2 Architecture description
The converged charging architecture for SMF Charging Trigger Function (CTF)
based solution as depicted in figure 5.2.4.1.2.1-1 SMF based solution-CTF for
the session based charging is applicable for the solution #4.2.
##### 5.4.4.2.3 Procedures description
Figure 5.4.4.2.3-1: CCS aggregates per PDU session
### 5.4.5 Evaluation
#### 5.4.5.1 Solutions evaluation for Key issue #4.1
Both solution #4.1 and #4.2 address Key issue #4.1.
For the solution #4.1, in many cases charging information about the individual
as well as the aggregated is required, the SMF aggregating would result in the
double reporting from the SMF to the CHF. New charging resource for SMF
aggregating 5G VN Group charging information should be defined. For the
solution #4.2, the enhancement of CCS to aggregate the information for 5G VN
Group is out of SA5 standard scope. PDU session charging information may be
extended for CCS aggregating the 5G VN Group information.
### 5.4.6 Conclusion
It is concluded to that the solution #4.2 is preferred.
# 6 Conclusions and Recommendations
It is concluded that:
\- solution #1.1 (NEF based solution) and solution #1.2 (CEF based solution)
are selected for 5G VN Group management charging. Preferably the charging
information and events in solutions #1.1 and #1.2 should be the same.
\- SMF reports to CHF with the charging information including the traffic
forwarding methods indication.
\- SMF reports the usage of 5G VN group communication per PDU session.
#
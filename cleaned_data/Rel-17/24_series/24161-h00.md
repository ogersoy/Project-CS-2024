# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the procedures of network-based IP flow
mobility (NBIFOM). NBIFOM is based on network mobility protocols (i.e. GTP or
PMIP) which is performed between 3GPP access and WLAN access network as
specified in 3GPP TS 23.161 [2].
NOTE: IP flow mobility based on PMIP is not supported in this release of the
specification.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.161: \"Network-Based IP Flow Mobility (NBIFOM); Stage 2\".
[3] 3GPP TS 24.008: \"Mobile radio interface Layer 3 specification; Core
network protocols; Stage 3\".
[4] 3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS); Stage 3\".
[5] 3GPP TS 24.302: \"Access to the 3GPP Evolved Packet Core (EPC) via
non-3GPP access networks; Stage 3\".
_[6]_ 3GPP TS 24.244: \"Wireless LAN control plane protocol for trusted WLAN
access to EPC\".
[7] 3GPP TS 29.274: \"Tunnelling Protocol for Control plane (GTPv2-C)\".
[8] IEEE Std 802.11-2012: \"IEEE Standard for Information technology -
Telecommunications and information exchange between systems - Local and
metropolitan area networks - Specific requirements - Part 11: Wireless LAN
Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
**3GPP access is unusable** : the UE detects that usage of 3GPP access is
prevented based on a UE implementation specific mechanism.
**3GPP access is usable** : 3GPP access is not unusable.
**WLAN access is unusable** : the UE detects that usage of the WLAN access is
prevented based on a UE implementation specific mechanism.
**WLAN access is usable** : WLAN access is not unusable.
**Multi-access PDN connection** : A PDN connection **whose IP flows can be
routed** over **either a** 3GPP **access or** a WLAN access or both. At any
single time, e**ach IP flow is only routed over one access**.
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.302 [5] apply:
**3GPP AAA server**
**RAN rules**
**TWAG**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.301 [4] apply:
**A/Gb mode**
**Iu mode**
**S1 mode**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
APN Access Point Name
EAP Extensible Authentication Protocol
E-UTRAN Evolved Universal Terrestrial Radio Access Network
ePDG Evolved Packet Data Gateway
GERAN GSM EDGE Radio Access Network
GTP GPRS Tunnelling Protocol
IE Information Element
MCM Multi-connection mode
MME Mobility Management Entity
NBIFOM Network-based IP flow mobility
PDN Packet Data Network
PDN GW Packet Data Network Gateway
PDP Packet Data Protocol
PMIP Proxy Mobile IP version 6
SCM Single-connection mode
SGSN Serving GPRS Support Node
TWAG Trusted WLAN Access Gateway
UE User Equipment
UTRAN UMTS Terrestrial Radio Access Network
WLAN Wireless Local Area Network
WLCP Wireless LAN control plane protocol
# 4 General
This document specifies the following procedures for Network-Based IP Flow
Mobility (NBIFOM) as specified in 3GPP TS 23.161 [2] between the User
Equipment (UE) and the network. The present document specifies the following
procedures for support of NBIFOM in clause 5:
a) Initial PDN connection establishment procedure;
b) Extending NBIFOM traffic flows to additional access network;
c) IP flow mobility between 3GPP and WLAN;
d) Removal of an access from a PDN connection;
e) IP flow mapping procedures;
f) Handling of change of access usability; and
g) Handling of Access stratum indication.
For a), b), e), f) and g), the procedures are always initiated by the UE.
Specifically, for e) and g), the procedures are performed only if the network-
initiated NBIFOM mode is selected as specified in subclause 5.4 of 3GPP TS
23.161 [2].
For c), the procedure is initiated by:
\- the UE if the UE-initiated NBIFOM mode is selected as specified in
subclause 5.4 of 3GPP TS 23.161 [2]; or
\- the network if the network-initiated NBIFOM mode is selected as specified
in subclause 5.4 of 3GPP TS 23.161 [2].
For d), the procedure may be initiated by the UE or the network.
This document also defines the coding of the PDUs and parameters for NBIFOM in
clause 6.
# 5 NBIFOM control procedures
## 5.1 Initial PDN connection establishment procedures
### 5.1.1 UE procedures
#### 5.1.1.1 UE-initiated PDN connection establishment over GERAN or UTRAN
This procedure can only be executed if the UE is operating in A/Gb mode or Iu
mode. The UE shall not trigger an inter-system change to A/Gb mode of
operation or Iu mode of operation to execute this procedure.
Upon request from upper layers to setup a PDN connection with NBIFOM support
over GERAN or UTRAN, the UE shall initiate the PDP context activation
procedure according to 3GPP TS 24.008 [3].
In the ACTIVATE PDP CONTEXT REQUEST message of the PDP context activation
procedure:
a) the UE shall set the request type IE to \"initial request\";
b) the UE shall include the protocol configuration options IE. In the protocol
configuration options IE, the UE shall include the NBIFOM request indicator;
and
c) the UE shall include the NBIFOM container IE. In the NBIFOM container IE,
the UE shall include the NBIFOM mode parameter indicating the requested NBIFOM
mode.
Upon receiving from the network an ACTIVATE PDP CONTEXT ACCEPT message with
the NBIFOM container IE containing the NBIFOM status parameter set to
\"Accepted\":
a) the UE shall consider that NBIFOM applies to the PDN connection;
b) the UE shall consider the NBIFOM mode parameter of the NBIFOM container IE
of the ACTIVATE PDP CONTEXT ACCEPT message as the selected NBIFOM mode; and
c) if the network-initiated NBIFOM mode is the selected NBIFOM mode, and the
NBIFOM RAN rules handling parameter of the NBIFOM container IE of the ACTIVATE
PDP CONTEXT ACCEPT message is included and has the \"RAN rules handling
parameter is set\" value, then the UE shall consider that the RAN rules
handling parameter is set.
#### 5.1.1.2 UE-initiated PDN connection establishment over E-UTRAN
This procedure can only be executed if the UE is operating in S1 mode. The UE
shall not trigger an inter-system change to S1 mode of operation to execute
this procedure.
Upon request from upper layers to setup a PDN connection with NBIFOM support
over E-UTRAN, the UE shall initiate the UE requested PDN connectivity
procedure according to 3GPP TS 24.301 [4].
In the PDN CONNECTIVITY REQUEST message or, when applicable, in the ESM
INFORMATION RESPONSE message, of the UE requested PDN connectivity procedure:
a) the UE shall set the request type IE to \"initial request\";
b) the UE shall include the protocol configuration options IE. In the protocol
configuration options IE, the UE shall include the NBIFOM request indicator;
and
c) the UE shall include the NBIFOM container IE. In the NBIFOM container IE,
the UE shall include the NBIFOM mode parameter indicating the requested NBIFOM
mode.
Upon receiving from the network an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST
message with the NBIFOM container IE containing the NBIFOM status parameter
set to \"Accepted\":
a) the UE shall consider that NBIFOM applies to the PDN connection;
b) the UE shall consider the NBIFOM mode parameter of the NBIFOM container IE
of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message as the selected
NBIFOM mode; and
c) if the network-initiated NBIFOM mode is the selected NBIFOM mode, and the
NBIFOM RAN rules handling parameter of the NBIFOM container IE of the ACTIVATE
DEFAULT EPS BEARER CONTEXT REQUEST message is included and has the \"RAN rules
handling parameter is set\" value, then the UE shall consider that the RAN
rules handling parameter is set.
#### 5.1.1.3 UE-initiated PDN connection establishment over trusted WLAN using
SCM
Upon request from upper layers to setup a PDN connection with NBIFOM support
over trusted WLAN using SCM, the UE shall initiate usage of single-connection
mode (SCM) procedure according to 3GPP TS 24.302 [5].
In the AT_TWAN_CONN_MODE attribute with the message type field set to
SCM_REQUEST and included in the EAP-Response/AKA\'-Challenge message of the
usage of single-connection mode procedure:
a) the UE shall set the CONNECTIVITY_TYPE item set to the PDN connection;
b) the UE shall set the ATTACHMENT_TYPE item set to the initial attach; and
c) the UE shall include the PROTOCOL_CONFIGURATION_OPTIONS item. In the
PROTOCOL_CONFIGURATION_OPTIONS item, the UE shall include the NBIFOM request
indicator and the NBIFOM mode parameter indicating the requested NBIFOM mode.
Upon receiving from the network an EAP-Request/AKA\'-Notification message:
a) including the AT_NOTIFICATION attribute indicating success; and
b) including the AT_TWAN_CONN_MODE attribute containing the message type field
indicating SCM_RESPONSE; and
c) in the item list field, including the PROTOCOL_CONFIGURATION_OPTIONS item
containing the NBIFOM accepted indicator and the NBIFOM mode parameter as
defined in 3GPP TS 24.008 [3];
then:
a) the UE shall consider that NBIFOM applies to the PDN connection; and
b) the UE shall consider the NBIFOM mode parameter included in the
PROTOCOL_CONFIGURATION_OPTIONS item as the selected NBIFOM mode.
#### 5.1.1.4 UE-initiated PDN connection establishment over trusted WLAN using
MCM
Upon request from upper layers to setup a PDN connection with NBIFOM support
over trusted WLAN using MCM, the UE shall initiate the PDN connectivity
establishment procedure according to 3GPP TS 24.244 [6].
In the PDN CONNECTIVITY REQUEST message of the PDN connectivity establishment
procedure:
a) the UE shall set the request type IE to \"initial request\";
b) the UE shall include the protocol configuration options IE. In the protocol
configuration options IE, the UE shall include the NBIFOM request indicator;
and
c) the UE shall include the NBIFOM container IE. In the NBIFOM container IE,
the UE shall include the NBIFOM mode parameter indicating the requested NBIFOM
mode.
Upon receiving from the network a PDN CONNECTIVITY ACCEPT message with the
NBIFOM container IE containing the NBIFOM status parameter set to \"Accepted\"
a) the UE shall consider that NBIFOM applies to the PDN connection; and
b) the UE shall consider the NBIFOM mode parameter of the NBIFOM container IE
included in the PDN CONNECTIVITY ACCEPT message as the selected NBIFOM mode.
#### 5.1.1.5 UE-initiated PDN connection establishment over untrusted WLAN
Upon request from the upper layers to setup a PDN connection with NBIFOM
support over untrusted WLAN, the UE shall initiate the tunnel establishment
procedure according to 3GPP TS 24.302 [5].
In the IKE_AUTH request message of the tunnel establishment procedure:
a) the UE shall include the CFG_REQUEST configuration payload. In the
CFG_REQUEST configuration payload, the UE shall include the
INTERNAL_IP4_ADDRESS attribute, the INTERNAL_IP6_ADDRESS attribute or both,
with the length field set to zero; and
b) the UE shall include the NBIFOM_GENERIC_CONTAINER Notify payload. In the
NBIFOM_GENERIC_CONTAINER Notify payload, the UE shall include the NBIFOM mode
parameter indicating the requested NBIFOM mode.
NOTE: Inclusion of the NBIFOM_GENERIC_CONTAINER Notify payload is an implicit
indication of the NBIFOM request.
Upon receiving from the network an IKE_AUTH response message without a Notify
payload indicating an error, and with the NBIFOM_GENERIC_CONTAINER Notify
payload containing the NBIFOM status parameter set to \"Accepted\":
a) the UE shall consider that NBIFOM applies to the PDN connection; and
b) the UE shall consider the NBIFOM mode parameter of the
NBIFOM_GENERIC_CONTAINER Notify payload included in the IKE_AUTH response
message as the selected NBIFOM mode.
### 5.1.2 Network procedures
#### 5.1.2.1 UE-initiated PDN connection establishment over GERAN or UTRAN
If the SGSN receives a Create Session Response message with an acceptance
cause value including NBIFOM container IE from the SGW as specified in 3GPP TS
29.274 [7], the SGSN shall include the received NBIFOM container IE in the
ACTIVATE PDP CONTEXT ACCEPT message to the UE as specified in 3GPP TS 24.008
[3].
If the SGSN receives a Create Session Response message with a reject cause
value including NBIFOM container IE from the SGW as specified in 3GPP TS
29.274 [7], the SGSN shall include the received NBIFOM container IE in the
ACTIVATE PDP CONTEXT REJECT message with an appropriate error cause to the UE
as specified in 3GPP TS 24.008 [3].
#### 5.1.2.2 UE-initiated PDN connection establishment over E-UTRAN
If the MME receives a Create Session Response message with an acceptance cause
value including the NBIFOM container IE from the SGW as specified in 3GPP TS
29.274 [7], the MME shall include the received NBIFOM container IE in the
ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message to the UE as specified in
3GPP TS 24.301 [4].
If the MME receives a Create Session Response message with a reject cause
value including the NBIFOM container IE from the SGW as specified in 3GPP TS
29.274 [7], the MME shall include the received NBIFOM container IE in the PDN
CONNECTIVITY REJECT message with an appropriate error cause to the UE as
specified in 3GPP TS 24.301 [4].
#### 5.1.2.3 UE-initiated PDN connection establishment over trusted WLAN using
SCM
The 3GPP AAA Server shall follow the 3GPP AAA server behaviour towards UE for
PDN connection establishment requests initiated for single-connection mode
usage, as specified in 3GPP TS 24.302 [5].
#### 5.1.2.4 UE-initiated PDN connection establishment over trusted WLAN using
MCM
If the TWAG receives a Create Session Response message with an acceptance
cause value including the NBIFOM container IE from the PGW as specified in
3GPP TS 29.274 [7], the TWAG shall include the received NBIFOM container IE in
the PDN CONNECTIVITY ACCEPT message to the UE as specified in 3GPP TS 24.244
[6].
If the TWAG receives a Create Session Response message with a reject cause
value including the NBIFOM container IE from the PGW as specified in 3GPP TS
29.274 [7], the TWAG shall include the received NBIFOM container IE in the PDN
CONNECTIVITY REJECT message with an appropriate error cause to the UE as
specified in 3GPP TS 24.244 [6].
#### 5.1.2.5 UE-initiated PDN connection establishment over untrusted WLAN
If the ePDG receives a Create Session Response message that includes the
NBIFOM container IE from the PDN GW as specified in 3GPP TS 29.274 [7],
a) the ePDG shall construct the NBIFOM_GENERIC_CONTAINER Notify payload as
specified in 3GPP TS 24.302 [5] and copy the contents of the NBIFOM container
IE into the NBIFOM container contents field of the NBIFOM_GENERIC_CONTAINER
Notify payload;
b) the ePDG shall include the NBIFOM_GENERIC_CONTAINER Notify payload to the
UE, in the IKE_AUTH response message; and
c) if the Create Session Response message includes a reject cause, the ePDG
shall also include a Notify payload to the UE, indicating an error in the
IKE_AUTH response message.
## 5.2 Extending NBIFOM traffic flows to additional access network
### 5.2.1 UE procedures
#### 5.2.1.1 Adding GERAN or UTRAN access to NBIFOM PDN connections (UE-
initiated)
This procedure can only be executed if the UE is operating in A/Gb mode or Iu
mode. The UE shall not trigger an inter-system change to A/Gb mode of
operation or Iu mode of operation to execute this procedure.
If the NBIFOM applies to a PDN connection, then upon request from upper layers
to add GERAN or UTRAN access to the PDN connection, the UE shall initiate the
PDP context activation procedure according to 3GPP TS 24.008 [3].
In the ACTIVATE PDP CONTEXT REQUEST message of the PDP context activation
procedure:
a) the UE shall include the APN IE set to the APN indicated when the PDN
connection was initially setup in subclause 5.1;
b) the UE shall set the request type IE to \"handover\";
c) the UE shall include the protocol configuration options IE. In the protocol
configuration options IE, the UE shall include the NBIFOM request indicator;
and
d) the UE shall include the NBIFOM container IE. In the NBIFOM container IE:
1) if the UE-initiated NBIFOM mode is the selected NBIFOM mode:
A) the UE may include the NBIFOM routing rules parameter; and
B) the UE shall include the NBIFOM default access parameter.
Upon receiving an ACTIVATE PDP CONTEXT ACCEPT message with the NBIFOM
container IE containing the NBIFOM status parameter set to \"Accepted\":
a) the UE shall consider that the network has accepted that NBIFOM traffic for
that PDN connection can be sent through GERAN or UTRAN;
b) the UE shall consider the NBIFOM default access parameter of the NBIFOM
container IE of the ACTIVATE PDP CONTEXT ACCEPT message as the NBIFOM default
access; and
c) if the network-initiated NBIFOM mode is the selected NBIFOM mode, and the
NBIFOM RAN rules handling parameter of the NBIFOM container IE of the ACTIVATE
PDP CONTEXT ACCEPT message is included and has the \"RAN rules handling
parameter is set\" value, then the UE shall consider that the RAN rules
handling parameter is set.
#### 5.2.1.2 Adding E-UTRAN access to NBIFOM PDN connections (UE-initiated)
This procedure can only be executed if the UE is operating in S1 mode. The UE
shall not trigger an inter-system change to S1 mode of operation to execute
this procedure.
If the NBIFOM applies to a PDN connection, then upon request from upper layers
to add E-UTRAN access to the PDN connection, the UE shall initiate the UE
requested PDN connectivity procedure according to 3GPP TS 24.301 [4].
In the PDN CONNECTIVITY REQUEST message or, when applicable, in the ESM
INFORMATION RESPONSE message, of the UE requested PDN connectivity procedure:
a) the UE shall include the APN IE set to the APN indicated when the PDN
connection was initially setup in subclause 5.1;
b) the UE shall set the request type IE to \"handover\";
c) the UE shall include the protocol configuration options IE. In the protocol
configuration options IE, the UE shall include the NBIFOM request indicator;
and
d) the UE shall include the NBIFOM container IE. In the NBIFOM container IE:
1) if the UE-initiated NBIFOM mode is the selected NBIFOM mode:
A) the UE may include the NBIFOM routing rules parameter; and
B) the UE shall include the NBIFOM default access parameter.
Upon receiving an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with the
NBIFOM container IE containing the NBIFOM status parameter set to
\"Accepted\":
a) the UE shall consider that the network has accepted that NBIFOM traffic for
that PDN connection can be sent through E-UTRAN;
b) the UE shall consider the NBIFOM default access parameter of the NBIFOM
container IE of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message as the
NBIFOM default access; and
c) if the network-initiated NBIFOM mode is the selected NBIFOM mode, and the
NBIFOM RAN rules handling parameter of the NBIFOM container IE of the ACTIVATE
DEFAULT EPS BEARER CONTEXT REQUEST message is included and has the \"RAN rules
handling parameter is set\" value, then the UE shall consider that the RAN
rules handling parameter is set.
#### 5.2.1.3 Adding trusted WLAN access to NBIFOM PDN connections (UE-
initiated, using SCM)
If the NBIFOM applies to a PDN connection, then upon request from upper layers
to add, using SCM, trusted WLAN access to the PDN connection, the UE shall
initiate the usage of single-connection mode procedure according to 3GPP TS
24.302 [5].
In the AT_TWAN_CONN_MODE attribute with the message type field set to
SCM_REQUEST and included in the EAP-Response/AKA\'-Challenge message of the
usage of single-connection mode procedure:
a) the UE shall set the CONNECTIVITY_TYPE item set to the PDN connection;
b) the UE shall set the APN item to the APN indicated when the PDN connection
was setup in subclause 5.1.1;
c) the UE shall set the ATTACHMENT_TYPE item set to the handover; and
d) the UE shall include the PROTOCOL_CONFIGURATION_OPTIONS item. In the
PROTOCOL_CONFIGURATION_OPTIONS item, the UE shall include the NBIFOM request
indicator.
Upon receiving an EAP-Request/AKA\'-Notification message:
a) including the AT_NOTIFICATION attribute indicating success; and
b) including the AT_TWAN_CONN_MODE attribute:
1) containing the message type field indicating SCM_RESPONSE;
2) in the item list field, containing the PROTOCOL_CONFIGURATION_OPTIONS item
including the NBIFOM accepted indicator as defined in 3GPP TS 24.008 [3]:
the UE shall consider that the network has accepted that NBIFOM traffic for
that PDN connection can be sent through trusted WLAN using SCM.
#### 5.2.1.4 Adding trusted WLAN access to NBIFOM PDN connections (UE-
initiated, using MCM)
If the NBIFOM applies to a PDN connection, then upon request from upper layers
to add, using MCM, trusted WLAN access to the PDN connection, the UE shall
initiate the PDN connectivity establishment procedure according to 3GPP TS
24.244 [6].
In the PDN CONNECTIVITY REQUEST message of the PDN connectivity establishment
procedure:
a) the UE shall include the APN IE set to the APN indicated when the PDN
connection was setup in subclause 5.1.1;
b) the UE shall set the request type IE to the \"handover\";
c) the UE shall include the protocol configuration options IE. In the protocol
configuration options IE, the UE shall include the NBIFOM request indicator;
and
d) the UE shall include the NBIFOM container IE. In the NBIFOM container IE:
1) if the UE-initiated NBIFOM mode is the selected NBIFOM mode:
A) the UE may include the NBIFOM routing rules parameter; and
B) the UE shall include the NBIFOM default access parameter.
Upon receiving a PDN CONNECTIVITY ACCEPT message with the NBIFOM container IE
containing the NBIFOM status parameter set to \"Accepted\":
a) the UE shall consider that trusted WLAN using MCM is added to the PDN
connection; and
b) the UE shall consider the NBIFOM default access parameter of the NBIFOM
container IE of the PDN CONNECTIVITY ACCEPT message as the NBIFOM default
access.
#### 5.2.1.5 Adding untrusted WLAN access to NBIFOM PDN connections (UE-
initiated)
If the NBIFOM applies to a PDN connection, then upon request from upper layers
to add untrusted WLAN access to the PDN connection, the UE shall initiate the
tunnel establishment procedure according to 3GPP TS 24.302 [5].
In the IKE_AUTH request message of the tunnel establishment procedure:
a) the UE shall set the IDr payload to the APN indicated when the PDN
connection was setup in subclause 5.1.1;
b) the UE shall include the CFG_REQUEST configuration payload. In the
CFG_REQUEST configuration payload, the UE shall include the
INTERNAL_IP4_ADDRESS attribute, the INTERNAL_IP6_ADDRESS attribute or both,
indicating the IP address(es) allocated when the PDN connection was setup in
subclause 5.2.1; and
c) the UE shall include the NBIFOM_GENERIC_CONTAINER Notify payload. In the
NBIFOM_GENERIC_CONTAINER Notify payload:
A) if the UE-initiated NBIFOM mode is the selected NBIFOM mode:
i) the UE may include the NBIFOM routing rules parameter; and
ii) the UE shall include the NBIFOM default access parameter.
NOTE: Inclusion of the NBIFOM_GENERIC_CONTAINER Notify payload is an implicit
indication of a request to apply NBIFOM for that PDN connection.
Upon receiving an IKE_AUTH response message without a Notify payload
indicating an error, and with the NBIFOM_GENERIC_CONTAINER Notify payload
containing the NBIFOM status parameter set to \"Accepted\":
a) the UE shall consider that the network has accepted that NBIFOM traffic for
that PDN connection can be sent through untrusted WLAN access; and
b) the UE shall consider the NBIFOM default access parameter of the
NBIFOM_GENERIC_CONTAINER Notify payload of the IKE_AUTH response message as
the NBIFOM default access.
### 5.2.2 Network procedures
#### 5.2.2.1 UE-initiated addition of NBIFOM traffic flows to go over GERAN or
UTRAN
The SGSN shall perform the procedure as specified in subclause 5.1.2.1.
#### 5.2.2.2 UE-initiated addition of NBIFOM traffic flows to go over E-UTRAN
The MME shall perform the procedure as specified in subclause 5.1.2.2.
#### 5.2.2.3 UE-initiated addition of NBIFOM traffic flows to go over trusted
WLAN using SCM
The 3GPP AAA Server shall follow the 3GPP AAA server behaviour towards UE
initiated PDN connection establishment procedure as specified in subclause
6.4.3.5.2 of 3GPP TS 24.302 [5].
#### 5.2.2.4 UE-initiated addition of NBIFOM traffic flows to go over trusted
WLAN using MCM
The TWAG shall perform the procedure as specified in subclause 5.1.2.4.
#### 5.2.2.5 UE-initiated addition of NBIFOM traffic flows to go over
untrusted WLAN
The ePDG shall perform the procedure as specified in subclause 5.1.2.5.
## 5.3 IP flow mobility between 3GPP and WLAN
### 5.3.1 UE procedures
#### 5.3.1.1 UE-initiated IP flow mobility over GERAN or UTRAN
This procedure can only be executed if the UE is operating in A/Gb mode or Iu
mode. The UE shall not trigger an inter-system change to A/Gb mode of
operation or Iu mode of operation to execute this procedure.
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over GERAN or UTRAN and WLAN, and the UE-
initiated NBIFOM mode is the selected NBIFOM mode, then upon request to
initiate UE-initiated IP flow mobility over GERAN or UTRAN, the UE shall
initiate the PDP context modification procedure or the secondary PDP context
activation procedure according to 3GPP TS 24.008 [3].
In:
a) the MODIFY PDP CONTEXT REQUEST message of the PDP context modification
procedure; or
b) ACTIVATE SECONDARY PDP CONTEXT REQUEST message of the secondary PDP context
Activation Procedure;
the UE shall include the NBIFOM container IE. In the NBIFOM container IE:
a) the UE shall include the NBIFOM routing rules parameter with the requested
routing rules; and
b) if the multi-access PDN connection is for IP flows over GERAN or UTRAN and
over trusted WLAN using SCM, the UE shall include the NBIFOM default access
parameter when the first time the UE initiates an IP flow mobility procedure
over 3GPP access.
Upon receiving a MODIFY PDP CONTEXT ACCEPT message or ACTIVATE SECONDARY PDP
CONTEXT ACCEPT message:
a) the UE shall apply the requested routing rules; and
b) if the NBIFOM container IE contains the NBIFOM default access parameter,
the UE shall consider the NBIFOM default access parameter as the NBIFOM
default access.
Upon receiving a MODIFY PDP CONTEXT REJECT message or an ACTIVATE SECONDARY
PDP CONTEXT REJECT message, the UE shall consider the NBIFOM status parameter
of the NBIFOM container IE of the MODIFY PDP CONTEXT REJECT message or the
ACTIVATE SECONDARY PDP CONTEXT REJECT message as the cause of failure.
#### 5.3.1.2 UE-initiated IP flow mobility over E-UTRAN
This procedure can only be executed if the UE is operating in S1 mode. The UE
shall not trigger an inter-system change to S1 mode of operation to execute
this procedure.
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over E-UTRAN and WLAN, and the UE-initiated
NBIFOM mode is the selected NBIFOM mode, then upon request to initiate UE-
initiated IP flow mobility over E-UTRAN, the UE shall initiate the UE
requested bearer resource modification procedure or the UE requested bearer
resource allocation procedure according to 3GPP TS 24.301 [4].
In:
a) the BEARER RESOURCE MODIFICATION REQUEST message of the UE requested bearer
resource modification procedure; or
b) the BEARER RESOURCE ALLOCATION REQUEST message of the UE requested bearer
resource allocation procedure;
the UE shall include the NBIFOM container IE. In the NBIFOM container IE:
a) the UE shall include the NBIFOM routing rules parameter with the requested
routing rules; and
b) if the multi-access PDN connection is for IP flows over E-UTRAN and over
trusted WLAN using SCM, the UE shall include the NBIFOM default access
parameter when the first time the UE initiates an IP flow mobility procedure
over 3GPP access.
Upon receiving from the network:
a) an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message of the dedicated
EPS bearer context activation procedure, such that:
1) the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is related to the
UE requested bearer resource modification procedure or the UE requested bearer
resource allocation procedure; and
2) the IEs of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message are
acceptable;
b) a MODIFY EPS BEARER CONTEXT REQUEST message of the EPS bearer context
modification procedure such that:
1) the MODIFY EPS BEARER CONTEXT REQUEST message is related to the UE
requested bearer resource modification procedure or the UE requested bearer
resource allocation procedure; and
2) the IEs of the MODIFY EPS BEARER CONTEXT REQUEST message are acceptable; or
c) a DEACTIVATE EPS BEARER CONTEXT REQUEST message of the EPS bearer context
deactivation procedure such that:
1) the DEACTIVATE EPS BEARER CONTEXT REQUEST message is related to the UE
requested bearer resource modification procedure or the UE requested bearer
resource allocation procedure; and
2) the EPS bearer identity IE of the DEACTIVATE EPS BEARER CONTEXT REQUEST
message indicates identity of a dedicated EPS bearer context;
then:
a) the UE shall respond with the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT
message, the MODIFY EPS BEARER CONTEXT ACCEPT message or the DEACTIVATE EPS
BEARER CONTEXT ACCEPT message; and
b) the UE shall apply the requested routing rules; and
c) if the NBIFOM container IE contains the NBIFOM default access parameter,
the UE shall consider the NBIFOM default access parameter as the NBIFOM
default access.
If however, the UE receives a BEARER RESOURCE MODIFICATION REJECT message or a
BEARER RESOURCE ALLOCATION REJECT message, the UE shall consider the NBIFOM
status parameter of the NBIFOM container IE of the BEARER RESOURCE
MODIFICATION REJECT message or a BEARER RESOURCE ALLOCATION REJECT message as
the cause of failure.
#### 5.3.1.3 UE-initiated IP flow mobility over trusted WLAN using SCM
Not applicable.
#### 5.3.1.4 UE-initiated IP flow mobility over trusted WLAN using MCM
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over trusted WLAN using MCM and 3GPP
accesses, and the UE-initiated NBIFOM mode is the selected NBIFOM mode, then
upon request to initiate UE-initiated IP flow mobility over trusted WLAN using
MCM, the UE shall initiate the UE requested PDN connectivity modification
procedure according to 3GPP TS 24.244 [6].
In the PDN MODIFICATION INDICATION message of the UE requested PDN
connectivity modification procedure, the UE shall include the NBIFOM container
IE. In the NBIFOM container IE, the UE shall include the NBIFOM routing rules
parameter with the requested routing rules.
Upon receiving a PDN MODIFICATION REQUEST message of the TWAG initiated PDN
connectivity modification procedure such that:
a) the PDN MODIFICATION REQUEST message is initiated by the UE requested PDN
connectivity modification procedure; and
b) the IEs of the PDN MODIFICATION REQUEST message are acceptable;
then:
a) the UE shall respond with a PDN MODIFICATION ACCEPT message; and
b) the UE shall apply the requested routing rules.
If however, the UE receives a PDN MODIFICATION REJECT message, the UE shall
consider the NBIFOM status parameter of the NBIFOM container IE of the PDN
MODIFICATION REJECT message as the cause of failure.
#### 5.3.1.5 UE-initiated IP flow mobility over untrusted WLAN
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over untrusted WLAN access and 3GPP
accesses, and the UE-initiated NBIFOM mode is the selected NBIFOM mode, then
upon request to initiate UE-initiated IP flow mobility over untrusted WLAN
access, the UE shall initiate the UE-initiated modification procedure
according to 3GPP TS 24.302 [5].
In the INFORMATIONAL request message of the UE-initiated modification
procedure, the UE shall include the NBIFOM_GENERIC_CONTAINER Notify payload.
In the NBIFOM_GENERIC_CONTAINER Notify payload, the UE shall include the
NBIFOM routing rules parameter with the requested routing rules.
Upon receiving an INFORMATIONAL request message of the ePDG-initiated
modification procedure such that:
a) the received INFORMATIONAL request message does not contain a Notify
payload indicating an error;
b) the received INFORMATIONAL request message contains a PTI Notify payload
with the Related Message ID field set to the Message ID field of the sent
INFORMATIONAL request message; and
c) the IEs of the received INFORMATIONAL request message are acceptable;
then:
a) the UE shall respond with an INFORMATIONAL response message without a
Notify payload indicating an error; and
b) the UE shall apply the requested routing rules.
Upon receiving an INFORMATIONAL request message of the ePDG-initiated
modification procedure such that:
a) the received INFORMATIONAL request message contains a Notify payload
indicating an error; and
b) the received INFORMATIONAL request message contains a PTI Notify payload
with the Related Message ID field set to the Message ID field of the sent
INFORMATIONAL request message;
then:
a) the UE shall consider the NBIFOM status parameter of the
NBIFOM_GENERIC_CONTAINER Notify payload of the INFORMATIONAL request message
as the cause of failure; and
b) the UE shall respond with an INFORMATIONAL response message.
#### 5.3.1.6 Network-initiated IP flow mobility over GERAN or UTRAN
The network-initiated IP flow mobility over GERAN or UTRAN takes place during
the network initiated PDP context modification procedure or the secondary PDP
context activation procedure requested by the network according to 3GPP TS
24.008 [3].
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over GERAN or UTRAN and WLAN, and the
network-initiated NBIFOM mode is the selected NBIFOM mode, then, the UE upon
receiving:
a) a REQUEST SECONDARY PDP CONTEXT ACTIVATION message from the network in
which:
1) the REQUEST SECONDARY PDP CONTEXT ACTIVATION message contains the NBIFOM
container IE containing the NBIFOM routing rules parameter; and
2) the IEs of the REQUEST SECONDARY PDP CONTEXT ACTIVATION message other than
the NBIFOM container IE are acceptable; or
b) a MODIFY PDP CONTEXT REQUEST message from the network in which:
1) the MODIFY PDP CONTEXT REQUEST message contains the NBIFOM container IE
containing the NBIFOM routing rules parameter; and
2) the IEs of the MODIFY PDP CONTEXT REQUEST message other than the NBIFOM
container IE are acceptable;
then:
a) if the UE accepts the requested routing rules indicated in the NBIFOM
routing rules parameter:
1) the UE shall proceed with the secondary PDP context activation procedure
according to 3GPP TS 24.008 [3] or the UE shall send the MODIFY PDP CONTEXT
ACCEPT message;
2) the UE shall apply the requested routing rules; and
3) if the NBIFOM container IE contains the NBIFOM default access parameter,
the UE shall consider the NBIFOM default access parameter as the NBIFOM
default access; and
b) if the UE rejects the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall respond with:
1) the REQUEST SECONDARY PDP CONTEXT ACTIVATION REJECT message; or
2) the MODIFY PDP CONTEXT REJECT message;
together with the NBIFOM container IE. In the NBIFOM container IE, the UE
shall include the NBIFOM status parameter with appropriate error value.
#### 5.3.1.7 Network-initiated IP flow mobility over E-UTRAN
The network-initiated IP flow mobility over E-UTRAN takes place during the EPS
bearer context modification procedure according to 3GPP TS 24.301 [4].
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over E-UTRAN and WLAN, and the network-
initiated NBIFOM mode is the selected NBIFOM mode, then, the UE upon
receiving:
a) an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message from the network,
in which:
1) the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is unrelated to
any UE requested bearer resource allocation procedure and is unrelated to any
UE requested bearer resource modification procedure;
2) the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains the
NBIFOM container IE containing the NBIFOM routing rules parameter; and
3) the IEs of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message other
than the NBIFOM container IE are acceptable; or
b) a MODIFY EPS BEARER CONTEXT REQUEST message from the network, in which:
1) the MODIFY EPS BEARER CONTEXT REQUEST message is unrelated to any UE
requested bearer resource allocation procedure and is unrelated to any UE
requested bearer resource modification procedure;
2) the MODIFY EPS BEARER CONTEXT REQUEST message contains the NBIFOM container
IE containing the NBIFOM routing rules parameter; and
3) the IEs of the MODIFY EPS BEARER CONTEXT REQUEST message other than the
NBIFOM container IE are acceptable;
then:
a) if the UE accepts the requested routing rules indicated in the NBIFOM
routing rules parameter:
1) the UE shall respond with the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT
message or the MODIFY EPS BEARER CONTEXT ACCEPT message;
2) the UE shall apply the requested routing rules; and
3) if the NBIFOM container IE contains the NBIFOM default access parameter,
the UE shall consider the NBIFOM default access parameter as the NBIFOM
default access; and
b) if the UE rejects the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall respond with:
1) the ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message; or
2) the MODIFY EPS BEARER CONTEXT REJECT message
together with the NBIFOM container IE. In the NBIFOM container IE, the UE
shall include the NBIFOM status parameter with appropriate error value.
#### 5.3.1.8 Network-initiated IP flow mobility over trusted WLAN using SCM
Not applicable.
#### 5.3.1.9 Network-initiated IP flow mobility over trusted WLAN using MCM
The network-initiated IP flow mobility over trusted WLAN using MCM is
performed by the network, by executing the TWAG initiated PDN connectivity
modification procedure of 3GPP TS 24.244 [6].
If the NBIFOM applies to a PDN connection, the PDN connection is connected
simultaneously over trusted WLAN using MCM and 3GPP access, and the network-
initiated NBIFOM mode is the selected NBIFOM mode, then upon receiving a PDN
MODIFICATION REQUEST message of the TWAG initiated PDN connectivity
modification procedure such that:
a) the PDN MODIFICATION REQUEST message is not initiated by any UE requested
PDN connectivity modification procedure;
b) the PDN MODIFICATION REQUEST message contains the NBIFOM container IE
containing the NBIFOM routing rules parameter; and
c) the IEs of the PDN MODIFICATION REQUEST other than the NBIFOM container IE
are acceptable;
then:
a) if the UE accepts the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall respond with the PDN MODIFICATION ACCEPT
message, and the UE shall apply the requested routing rules; and
b) if the UE rejects the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall respond with the PDN MODIFICATION REJECT
message with the NBIFOM container IE. In the NBIFOM container IE, the UE shall
include the NBIFOM status parameter with appropriate error value.
#### 5.3.1.10 Network-initiated IP flow mobility over untrusted WLAN
The network-initiated IP flow mobility over untrusted WLAN is performed by the
network, by executing the ePDG initiated modification procedure of 3GPP TS
24.302 [5].
If the NBIFOM applies to a PDN connection, the PDN connection is connected
simultaneously over untrusted WLAN and 3GPP access, and the network-initiated
NBIFOM mode is the selected NBIFOM mode, then upon receiving an INFORMATIONAL
request message of the ePDG initiated modification procedure such that:
a) the INFORMATIONAL request message does not contains a PTI Notify payload;
b) the INFORMATIONAL request message contains the NBIFOM_GENERIC_CONTAINER
Notify payload containing the NBIFOM routing rules parameter; and
c) the IEs other than the NBIFOM_GENERIC_CONTAINER Notify payload are
acceptable;
then:
a) if the UE accepts the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall respond with the INFORMATIONAL response
message without a Notify payload indicating an error, and the UE shall apply
the requested routing rules; and
b) if the UE rejects the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall respond with the INFORMATIONAL response
message. In the INFORMATIONAL response message, the UE shall include a Notify
payload indicating an error and shall include the NBIFOM_GENERIC_CONTAINER
Notify payload. In the NBIFOM_GENERIC_CONTAINER Notify payload, the UE shall
include the NBIFOM status parameter with appropriate error value.
### 5.3.2 Network procedures
#### 5.3.2.1 UE-initiated IP flow mobility over GERAN or UTRAN
If the SGSN receives an NBIFOM container IE in an Update Bearer Request
message or a Create Bearer Request message as specified in 3GPP TS 29.274 [7]
including NBIFOM container IE from the SGW, the SGSN shall include the
received NBIFOM container IE in the MODIFY PDP CONTEXT ACCEPT message or the
ACTIVATE SECONDARY PDP CONTEXT ACCEPT message to the UE as specified in 3GPP
TS 24.008 [3].
If the SGSN receives a Bearer Resource Failure Indication message including
NBIFOM container IE from the SGW as specified in 3GPP TS 29.274 [7], the SGSN
shall include the received NBIFOM container IE in the MODIFY PDP CONTEXT
REJECT message or the ACTIVATE SECONDARY PDP CONTEXT REJECT message to the UE
as specified in 3GPP TS 24.008 [3].
#### 5.3.2.2 UE-initiated IP flow mobility over E-UTRAN
If the MME receives a Create Bearer Request message, or an Update Bearer
Request message, or a Delete Bearer Request message including NBIFOM container
IE from the SGW as specified in 3GPP TS 29.274 [7], the MME shall include the
NBIFOM container IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST
message, MODIFY EPS BEARER CONTEXT REQUEST message or DEACTIVATE EPS BEARER
CONTEXT REQUEST message to the UE as specified in 3GPP TS 24.301 [4].
If the MME receives a Bearer Resource Failure Indication message including
NBIFOM container IE from the SGW as specified in 3GPP TS 29.274 [7], the MME
shall include the received NBIFOM container IE in the BEARER RESOURCE
MODIFICATION REJECT message or BEARER RESOURCE ALLOCATION REJECT message to
the UE as specified in 3GPP TS 24.301 [4].
#### 5.3.2.3 UE-initiated IP flow mobility over trusted WLAN using SCM
The delivery of routing rules over trusted WLAN access using SCM is not
supported as specified in 3GPP TS 23.161 [2].
#### 5.3.2.4 UE-initiated IP flow mobility over trusted WLAN using MCM
If the TWAG receives an Update Bearer Request message or a Create Bearer
Request message including NBIFOM container IE from the PDN GW as specified
3GPP TS 29.274 [7], TWAG shall include the NBIFOM container IE in the PDN
MODIFICATION REQUEST message to the UE as specified in 3GPP TS 24.244 [6].
If the TWAG receives a Bearer Resource Failure Indication including NBIFOM
container IE from the PDN GW as specified in 3GPP TS 29.274 [7], the TWAG
shall include the NBIFOM container IE in the PDN MODIFICATION REJECT message
to the UE as specified in 3GPP TS 24.244 [6].
#### 5.3.2.5 UE-initiated IP flow mobility over untrusted WLAN
Once the ePDG receives an INFORMATIONAL request message including NBIFOM
container IE from the UE, the ePDG shall send the INFORMATIONAL response
message to the UE as specified in subclause 6.3.3.3 of 3GPP TS 23.161 [2].
If the ePDG receives an Update Bearer Request message, or a Create Bearer
Request message, or a Bearer Resource Failure Indication message including
NBIFOM container IE from the PDN GW as specified in 3GPP TS 29.274 [7],
a) the ePDG shall construct the NBIFOM_GENERIC_CONTAINER Notify payload as
specified in 3GPP TS 24.302 [5] and copy the NBIFOM container contents from
the NBIFOM container IE into the NBIFOM container contents field of the
NBIFOM_GENERIC_CONTAINER Notify payload;
b) the ePDG shall include the NBIFOM_GENERIC_CONTAINER Notify payload in the
INFORMATIONAL request message to the UE;
c) the ePDG shall include a PTI notify payload as specified in subclause
7.4.2.1 of 3GPP TS 24.302 [5] in the INFORMATIONAL request message to the UE;
and
d) if receiving Bearer Resource Failure Indication message, the ePDG shall
also include a Notify payload indicating an error in the INFORMATIONAL request
message to the UE.
#### 5.3.2.6 Network-initiated IP flow mobility over GERAN or UTRAN
If the SGSN receives an Update Bearer Request message or a Create Bearer
Request message including the NBIFOM container IE from the SGW as specified in
3GPP TS 29.274 [7], the SGSN shall include the received NBIFOM container IE in
the MODIFY PDP CONTEXT REQUEST message or the REQUEST SECONDARY PDP CONTEXT
ACTIVATION message to the UE as specified in 3GPP TS 24.008 [3].
#### 5.3.2.7 Network-initiated IP flow mobility over E-UTRAN
If the MME receives an Update Bearer Request message or a Create Bearer
Request message including the NBIFOM container IE from the SGW as specified in
3GPP TS 29.274 [7], the MME shall include the received NBIFOM container IE in
the MODIFY EPS BEARER CONTEXT REQUEST message or the ACTIVATE DEDICATED EPS
BEARER CONTEXT REQUEST message to the UE as specified in 3GPP 24.301 [4].
#### 5.3.2.8 Network-initiated IP flow mobility over trusted WLAN using SCM
Not applicable.
#### 5.3.2.9 Network-initiated IP flow mobility over trusted WLAN using MCM
If the TWAG receives an Update Bearer Request message or a Create Bearer
Request message including NBIFOM container IE from the PGW as specified in
3GPP TS 29.274 [7], the TWAG shall include the received NBIFOM container IE in
the PDN MODIFICATION REQUEST message to the UE as specified in 3GPP TS 24.244
[6].
#### 5.3.2.10 Network-initiated IP flow mobility over untrusted WLAN
If the ePDG receives an Update Bearer Request message, or a Create Bearer
Request message including NBIFOM container IE from the PGW as specified in
3GPP TS 29.274 [7],
a) the ePDG shall construct the NBIFOM_GENERIC_CONTAINER Notify payload as
specified in 3GPP TS 24.302 [5] and copy the NBIFOM container contents from
the NBIFOM container IE into the NBIFOM container contents field of the
NBIFOM_GENERIC_CONTAINER Notify payload ; and
b) the ePDG shall include the NBIFOM_GENERIC_CONTAINER Notify payload in the
INFORMATIONAL request message to the UE.
## 5.4 Removal of an access from a multi-access PDN connection
### 5.4.1 General
The removal of an access network from a multi-access PDN connection can be
initiated by the UE or the network.
There can be two possible scenarios for this procedure:
\- the multi-access PDN connection via 3GPP access network is removed and the
multi-access PDN connection via WLAN access network is maintained; or
\- the multi-access PDN connection via WLAN access network is removed and the
multi-access PDN connection via 3GPP access network is maintained.
Once the procedure is completed, the UE uses the PDN connection over the
maintained access network, except in the case of a network-initiated PDN
connection release with cause \"reactivation requested\" as specified in
subclause 5.4.2.7.2 or subclause 5.4.2.9.2 or subclause 5.4.2.10.2.
### 5.4.2 UE procedures
#### 5.4.2.1 UE-initiated removal of GERAN or UTRAN access from a multi-access
PDN connection
This procedure can only be executed if the UE is operating in A/Gb mode or Iu
mode. The UE shall not trigger an inter-system change to A/Gb mode of
operation or Iu mode of operation to execute this procedure.
In order to remove GERAN or UTRAN as an access for IP flows of a multi-access
PDN connection, UE shall perform the PDP context deactivation initiated by the
MS procedure as specified in subclause 6.1.3.4.1 of 3GPP TS 24.008 [3].
#### 5.4.2.2 UE-initiated removal of E-UTRAN access from a multi-access PDN
connection
This procedure can only be executed if the UE is operating in S1 mode. The UE
shall not trigger an inter-system change to S1 mode of operation to execute
this procedure.
In order to remove E-UTRAN as an access for IP flows of a multi-access PDN
connection, the UE shall perform the UE requested PDN disconnect procedure as
specified in subclause 6.5.2 of 3GPP TS 24.301 [4].
#### 5.4.2.3 UE-initiated removal of trusted WLAN using SCM as an access from
a multi-access PDN connection
In order to remove trusted WLAN using SCM as an access for IP flows of a
multi-access PDN connection, the UE can send a disassociation or
deauthentication notification to the TWAN according to IEEE Std 802.11-2012
[8].
#### 5.4.2.4 UE-initiated removal of trusted WLAN using MCM as an access from
a multi-access PDN connection
In order to remove trusted WLAN using MCM as an access for IP flows of a
multi-access PDN connection, the UE shall perform UE requested PDN
disconnection procedure as specified in subclause 5.4 of 3GPP TS 24.244 [6].
#### 5.4.2.5 UE-initiated removal of untrusted WLAN as an access from a multi-
access PDN connection
In order to remove untrusted WLAN access network as ab acess for IP flows of a
multi-access PDN connection, the UE shall perform the UE initiated
disconnection procedure as specified in subclause 7.2.4.1 of 3GPP TS 24.302
[5].
#### 5.4.2.6 Network-initiated removal of GERAN or UTRAN access from a multi-
access PDN connection
In order to perform the network-initiated removal of PDN connection over GERAN
or UTRAN, the UE shall follow the PDP context deactivation initiated by the
network procedure as specified in subclause 6.1.3.4.2 of 3GPP TS 24.008 [3].
#### 5.4.2.7 Network-initiated removal of E-UTRAN access from a multi-access
PDN connection
##### 5.4.2.7.1 General
In order to perform the network-initiated removal of PDN connection over
E-UTRAN, the UE shall follow the network initiated detach procedure as
specified in subclause 5.5.2.3 of 3GPP TS 24.301 [4] or the EPS bearer context
deactivation procedure as specified in subclause 6.4.4 of 3GPP TS 24.301 [4].
##### 5.4.2.7.2 Handling of ESM cause #39 \"reactivation requested\"
Upon receipt of a DEACTIVATE EPS BEARER CONTEXT REQUEST message with the EPS
bearer context of a default EPS bearer context and ESM cause #39
\"reactivation requested\" over the 3GPP access as described in 3GPP TS 24.301
[4], if the corresponding PDN connection is established over both 3GPP access
and WLAN, the UE shall:
\- follow the procedures specified in 3GPP TS 24.301 [4] to complete the EPS
bearer context deactivation; and
\- follow the procedures specified in 3GPP TS 24.244 [6] and in 3GPP TS 24.302
[5] to locally release the corresponding PDN connection over trusted WLAN and
untrusted WLAN, respectively.
The UE should then re-establish the PDN connection(s) at least over one access
with the choice of the access being implementation specific.
Upon receipt of a DETACH REQUEST message with the detach type \"re-attach
required\" over 3GPP access as described in 3GPP TS 24.301 [4], if the PDN
connection(s) is established over both 3GPP access and WLAN, the UE shall:
\- follow the procedures specified in 3GPP TS 24.244 [6] and in 3GPP TS 24.302
[5] to locally the release the corresponding PDN connection over trusted WLAN
and untrusted WLAN, respectively; and
\- re-attach through E-UTRAN access using procedures specified in 3GPP TS
24.301 [4].
The UE should then re-establish any previously established PDN connection(s)
in the 3GPP access.
NOTE: When the detach type indicates \"re-attach required\", user interaction
is necessary in some cases when the UE cannot re-activate the EPS bearer(s)
automatically.
#### 5.4.2.8 Network-initiated removal of trusted WLAN using SCM as an access
from a multi-access PDN connection
In order to remove the PDN connection over trusted WLAN using SCM applied with
NBIFOM, the UE will perform the TWAN-initiated disconnection procedure which
is out of 3GPP scope.
#### 5.4.2.9 Network-initiated removal of trusted WLAN using MCM as an access
from a multi-access PDN connection
##### 5.4.2.9.1 General
In order to remove the multi-access PDN connection over trusted WLAN using
MCM, the UE shall perform the TWAG initiated PDN disconnection procedure as
specified in subclause 5.3 of 3GPP TS 24.244 [6].
##### 5.4.2.9.2 Handling of ESM cause #39 \"reactivation requested\"
Upon receipt of a PDN DISCONNECT REQUEST message to release a PDN connection
with the cause \"reactivation requested\" over the trusted WLAN as described
in 3GPP TS 24.244 [6], if the PDN connection is established on both
accessesand the UE is in EMM-IDLE mode over the 3GPP access, the UE shall:
\- follow the procedure specified in 3GPP TS 24.301 [4] to locally release the
PDN connection over the 3GPP access; and
\- re-establish the PDN connection at least over one access, the choice of the
access being implementation specific.
NOTE: If the UE is in EMM-CONNECTED mode instead of the EMM-IDLE mode over the
3GPP access, the UE follows the connection release procedure initiated by the
network.
#### 5.4.2.10 Network-initiated removal of untrusted WLAN as an access from a
multi-access PDN connection
##### 5.4.2.10.1 General
In order to remove the multi-access PDN connection over untrusted WLAN access
network, the UE shall perform the UE behaviour towards ePDG initiated
disconnection as specified in subclause 5.3 of 3GPP TS 24.244 [6].
##### 5.4.2.10.2 Handling of Notify payload indicating reactivation requested
Upon receipt of an INFORMATIONAL request message including the DELETE payload
and a NOTIFY payload with a private status type indicating a reactivation
requested cause as described in 3GPP TS 24.302 [5] and if the PDN connection
is established on both accessesand the UE is in EMM-IDLE mode over the 3GPP
access, the UE shall:
\- follow the procedure specified in 3GPP TS 24.301 [4] to locally release the
PDN connection over the 3GPP access; and
\- re-establish the PDN connection at least over one access, the choice of the
access being implementation specific.
NOTE: When the UE is in EMM-CONNECTED mode instead of the EMM-IDLE mode over
the 3GPP access, the UE follows the connection release procedure initiated by
the network.
### 5.4.3 Network procedures
#### 5.4.3.1 UE-initiated removal of GERAN or UTRAN access from a multi-access
PDN connection
The SGSN shall follow the PDP context deactivation initiated by the MS
procedure as specified in 3GPP TS 24.008 [3].
#### 5.4.3.2 UE-initiated removal of E-UTRAN access from a multi-access PDN
connection
The MME shall follow the UE requested PDN disconnect procedure as specified in
3GPP TS 24.301 [4].
#### 5.4.3.3 UE-initiated removal of trusted WLAN using SCM as an access from
a multi-access PDN connection
The TWAN shall follow the procedure as specified in subclause 6.5.2.1 of 3GPP
TS 23.161 [2].
#### 5.4.3.4 UE-initiated removal of trusted WLAN using MCM as an access from
a multi-access PDN connection
The TWAG shall follow the UE requested PDN disconnection procedure as
specified in 3GPP TS 24.244 [6].
#### 5.4.3.5 UE-initiated removal of untrusted WLAN as an access from a multi-
access PDN connection
The ePDG shall follow the ePDG behaviour towards UE initiated disconnection
procedure as specified in subclause 7.4.3.2 of 3GPP TS 24.302 [5].
#### 5.4.3.6 Network-initiated removal of GERAN or UTRAN access from a multi-
access PDN connection
The SGSN shall follow the PDP context deactivation initiated by the network
procedure as specified in 3GPP TS 24.008 [3].
#### 5.4.3.7 Network-initiated removal of E-UTRAN access from a multi-access
PDN connection
The MME shall follow the EPS bearer context deactivation initiated by the
network procedure as specified in 3GPP TS 24.301 [4].
#### 5.4.3.8 Network-initiated removal of trusted WLAN using SCM as an access
from a multi-access PDN connection
The TWAN shall follow the procedure as specified in subclause 6.5.2.2 of 3GPP
TS 23.161 [2].
#### 5.4.3.9 Network-initiated removal of trusted WLAN using MCM as an access
from a multi-access PDN connection
The TWAG shall follow the TWAG initiated PDN disconnection procedure specified
in 3GPP TS 24.244 [6].
#### 5.4.3.10 Network-initiated removal of untrusted WLAN as an access from a
multi-access PDN connection
The ePDG shall follow the ePDG initiated disconnection procedure as specified
in subclause 7.4.3.1 of 3GPP TS 24.302 [5].
## 5.5 IP flow mapping
### 5.5.1 UE procedures
#### 5.5.1.1 UE-initiated IP flow mapping over GERAN or UTRAN
This procedure can only be executed if the UE is operating in A/Gb mode or Iu
mode. The UE shall not trigger an inter-system change to A/Gb mode of
operation or Iu mode of operation to execute this procedure.
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over GERAN or UTRAN and WLAN, and the
network-initiated NBIFOM mode is the selected NBIFOM mode, then upon request
to initiate UE-initiated IP flow mapping over GERAN or UTRAN, the UE shall
initiate the PDP context modification procedure according to 3GPP TS 24.008
[3].
In the MODIFY PDP CONTEXT REQUEST message of the PDP context modification
procedure, the UE shall include the NBIFOM container IE. In the NBIFOM
container IE, the UE shall include the NBIFOM IP flow mapping parameter.
NOTE: If a MODIFY PDP CONTEXT ACCEPT message is received, network can provide
routing rules updated based on the NBIFOM IP flow mapping parameter using the
network-initiated IP flow mobility over GERAN or UTRAN described in subclause
5.3.2.6.
Upon receiving a REQUEST SECONDARY PDP CONTEXT ACTIVATION message or a MODIFY
PDP CONTEXT REQUEST message including the NBIFOM container IE containing the
NBIFOM routing rules parameter updated based on the UE requested NBIFOM IP
flow mapping parameter, the UE shall provide the network with the routing
rules accepted or rejected by the UE, using the network-initiated IP flow
mobility over GERAN or UTRAN described in subclause 5.3.1.6.
Upon receiving a MODIFY PDP CONTEXT REJECT message, the UE shall consider the
NBIFOM status parameter of the NBIFOM container IE of the MODIFY PDP CONTEXT
REJECT message as the cause of failure.
#### 5.5.1.2 UE-initiated IP flow mapping over E-UTRAN
This procedure can only be executed if the UE is operating in S1 mode. The UE
shall not trigger an inter-system change to S1 mode of operation to execute
this procedure.
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over E-UTRAN and WLAN, and the network-
initiated NBIFOM mode is the selected NBIFOM mode, then upon request to
initiate UE-initiated IP flow mapping over E-UTRAN, the UE shall initiate the
UE requested bearer resource modification procedure or the UE requested bearer
resource allocation procedure according to 3GPP TS 24.301 [4].
In:
a) the BEARER RESOURCE MODIFICATION REQUEST message of the UE requested bearer
resource modification procedure; or
b) the BEARER RESOURCE ALLOCATION REQUEST message of the UE requested bearer
resource allocation procedure;
the UE shall include the NBIFOM container IE. In the NBIFOM container IE, the
UE shall include the NBIFOM IP flow mapping parameter.
Upon receiving:
a) an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message of the dedicated
EPS bearer context activation procedure, such that:
1) the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is related to the
UE requested bearer resource modification procedure or the UE requested bearer
resource allocation procedure;
2) the IEs of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message are
acceptable; and
3) the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains the
NBIFOM routing rules parameter in the NBIFOM container IE; or
b) a MODIFY EPS BEARER CONTEXT REQUEST message of the EPS bearer context
modification procedure such that:
1) the MODIFY EPS BEARER CONTEXT REQUEST message is related to the UE
requested bearer resource modification procedure or the UE requested bearer
resource allocation procedure;
2) the IEs of the MODIFY EPS BEARER CONTEXT REQUEST message are acceptable;
and
3) the MODIFY EPS BEARER CONTEXT REQUEST message contains the NBIFOM routing
rules parameter in the NBIFOM container IE;
then:
a) if the UE accepts the requested routing rules indicated in the NBIFOM
routing rules parameter:
1) the UE shall respond with the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT
message or the MODIFY EPS BEARER CONTEXT ACCEPT message; and
2) the UE shall apply the requested routing rules; and
b) if the UE rejects the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall respond with:
1) the ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message; or
2) the MODIFY EPS BEARER CONTEXT REJECT message,
with the NBIFOM container IE. In the NBIFOM container IE, the UE shall include
the NBIFOM status parameter with appropriate error value.
If however, the UE receives a BEARER RESOURCE MODIFICATION REJECT message or a
BEARER RESOURCE ALLOCATION REJECT message, the UE shall consider the NBIFOM
status parameter of the NBIFOM container IE of the BEARER RESOURCE
MODIFICATION REJECT message or a BEARER RESOURCE ALLOCATION REJECT message as
the cause of failure.
#### 5.5.1.3 UE-initiated IP flow mapping over trusted WLAN using SCM
Not applicable.
#### 5.5.1.4 UE-initiated IP flow mapping over trusted WLAN using MCM
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over trusted WLAN using MCM and 3GPP
accesses, and the network-initiated NBIFOM mode is the selected NBIFOM mode,
then upon request to initiate UE-initiated IP flow mapping over trusted WLAN
using MCM, the UE shall initiate the UE requested PDN connectivity
modification procedure according to 3GPP TS 24.244 [6].
In the PDN MODIFICATION INDICATION message of the UE requested PDN
connectivity modification procedure, the UE shall include the NBIFOM container
IE. In the NBIFOM container IE, the UE shall include the NBIFOM IP flow
mapping parameter.
Upon receiving a PDN MODIFICATION REQUEST message of the TWAG initiated PDN
connectivity modification procedure such that:
a) the PDN MODIFICATION REQUEST message is initiated by the UE requested PDN
connectivity modification procedure; and
b) the IEs of the PDN MODIFICATION REQUEST message are acceptable;
then:
a) if the PDN MODIFICATION REQUEST message does not contain the NBIFOM routing
rules parameter in the NBIFOM container IE or does not contain the NBIFOM
container IE, the UE shall send a PDN MODIFICATION ACCEPT message; and
b) if the PDN MODIFICATION REQUEST contains the NBIFOM routing rules parameter
in the NBIFOM container IE:
1) if the UE accepts the requested routing rules indicated in the NBIFOM
routing rules parameter:
A) the UE shall send a PDN MODIFICATION ACCEPT message; and
B) the UE shall apply the requested routing rules; and
2) if the UE rejects the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall send a PDN MODIFICATION REJECT message
with the NBIFOM container IE. In the NBIFOM container IE, the UE shall include
the NBIFOM status parameter with appropriate error value.
If however, the UE receives a PDN MODIFICATION REJECT message, the UE shall
consider the NBIFOM status parameter of the NBIFOM container IE of the PDN
MODIFICATION REJECT message as the cause of failure.
#### 5.5.1.5 UE-initiated IP flow mapping over untrusted WLAN
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over untrusted WLAN access and 3GPP access,
and the network-initiated NBIFOM mode is the selected NBIFOM mode, then upon
request to initiate IP flow mapping over untrusted WLAN access, the UE shall
initiate the UE-initiated modification procedure according to 3GPP TS 24.302
[5].
In the INFORMATIONAL request message of the UE-initiated modification
procedure, the UE shall include the NBIFOM_GENERIC_CONTAINER Notify payload.
In the NBIFOM_GENERIC_CONTAINER Notify payload, the UE shall include the
NBIFOM IP flow mapping parameter.
Upon receiving an INFORMATIONAL request message of the ePDG-initiated
modification procedure such that:
a) the received INFORMATIONAL request message does not contain a Notify
payload indicating an error;
b) the received INFORMATIONAL request message contains a PTI Notify payload
with the Related Message ID field set to the Message ID field of the sent
INFORMATIONAL request message; and
c) the IEs of the received INFORMATIONAL request message are acceptable;
then:
a) if the received INFORMATIONAL request message does not contain the NBIFOM
routing rules parameter in the NBIFOM_GENERIC_CONTAINER Notify payload, the UE
shall send an INFORMATIONAL response message without a Notify payload
indicating an error; and
b) if the received INFORMATIONAL request message contains the NBIFOM routing
rules parameter in the NBIFOM_GENERIC_CONTAINER Notify payload:
1) if the UE accepts the requested routing rules indicated in the NBIFOM
routing rules parameter:
A) the UE shall send an INFORMATIONAL response message without a Notify
payload indicating an error; and
B) the UE shall apply the requested routing rules; and
2) if the UE rejects the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall send an INFORMATIONAL response message.
In the INFORMATIONAL response message, the UE shall include a Notify payload
indicating an error and shall include the NBIFOM_GENERIC_CONTAINER Notify
payload. In the NBIFOM_GENERIC_CONTAINER Notify payload, the UE shall include
the NBIFOM status parameter with appropriate error value.
Upon receiving an INFORMATIONAL request message of the ePDG-initiated
modification procedure such that:
a) the received INFORMATIONAL request message contains a Notify payload
indicating an error; and
b) the received INFORMATIONAL request message contains a PTI Notify payload
with the Related Message ID field set to the Message ID field of the sent
INFORMATIONAL request message;
then:
a) the UE shall consider the NBIFOM status parameter of the
NBIFOM_GENERIC_CONTAINER Notify payload of the INFORMATIONAL request message
as the cause of failure; and
b) the UE shall send an INFORMATIONAL response message.
### 5.5.2 Network procedures
#### 5.5.2.1 UE-initiated IP flow mapping over GERAN or UTRAN
If the SGSN receives an NBIFOM container IE in an Update Bearer Request
message or a Create Bearer Request message and the SGSN stored a Triggering
SGSN initiated PDP Context Creation/Modification Indication received in the
PDP Context Creation Procedure as specified in 3GPP TS 29.274 [7] from the
SGW, the SGSN shall include the received NBIFOM container IE in the MODIFY PDP
CONTEXT REQUEST message or the REQUEST SECONDARY PDP CONTEXT ACTIVATION
message to the UE as specified in 3GPP TS 24.008 [3]. Before that, the SGSN
shall also reply the MODIFY PDP CONTEXT ACCEPT message without the NBIFOM
container IE in order to reply the MODIFY PDP CONTEXT REQUEST message sent by
the UE.
If the SGSN receives a Bearer Resource Failure Indication message including
NBIFOM container IE from the SGW as specified in 3GPP TS 29.274 [7], the SGSN
shall include the received NBIFOM container IE in the MODIFY PDP CONTEXT
REJECT message to the UE as specified in 3GPP TS 24.008 [3].
#### 5.5.2.2 UE-initiated IP flow mapping over E-UTRAN
The MME shall include the NBIFOM container IE in the ACTIVATE DEDICATED EPS
BEARER CONTEXT REQUEST message, MODIFY EPS BEARER CONTEXT REQUEST message as
specified in 3GPP TS 24.301 [4] to the UE according to the response message
from the network as specified in 3GPP TS 29.274 [7].
If the MME receives a Bearer Resource Failure Indication message including
NBIFOM container IE from the SGW as specified in 3GPP TS 29.274 [7], the MME
shall include the received NBIFOM container IE to the UE in the BEARER
RESOURCE MODIFICATION REJECT message as specified in 3GPP TS 24.301 [4].
#### 5.5.2.3 UE-initiated IP flow mapping over trusted WLAN using SCM
Not applicable.
#### 5.5.2.4 UE-initiated IP flow mapping over trusted WLAN using MCM
If the TWAG receives an Update Bearer Request message or a Create Bearer
Request message including NBIFOM container IE from the PDN GW as specified
3GPP TS 29.274 [7], TWAG shall include the NBIFOM container IE in the PDN
MODIFICATION REQUEST message to the UE as specified in 3GPP TS 24.244 [6].
If the TWAG receives a Bearer Resource Failure Indication message including
NBIFOM container IE from the PDN GW as specified in 3GPP TS 29.274 [7], the
TWAG shall include the NBIFOM container IE in the PDN MODIFICATION REJECT
message to the UE as specified in 3GPP TS 24.244 [6].
#### 5.5.2.5 UE-initiated IP flow mapping over untrusted WLAN
Once the ePDG receives an INFORMATIONAL request message including NBIFOM
container IE from the UE, the ePDG shall send the INFORMATIONAL response
message to the UE as specified in subclause 6.4.3 of 3GPP TS 23.161 [2].
If the ePDG receives an Update Bearer Request message, or a Create Bearer
Request message, or a Bearer Resource Failure Indication message including
NBIFOM container IE from the PDN GW as specified in 3GPP TS 29.274 [7],
a) the ePDG shall construct the NBIFOM_GENERIC_CONTAINER Notify payload as
specified in 3GPP TS 24.302 [5] and copy the NBIFOM container contents from
the NBIFOM container IE into the NBIFOM container contents field of the
NBIFOM_GENERIC_CONTAINER Notify payload;
b) the ePDG shall include the NBIFOM_GENERIC_CONTAINER Notify payload in the
INFORMATIONAL request message to the UE;
c) the ePDG shall include a PTI notify payload as specified in subclause
7.4.2.1 of 3GPP TS 24.302 [5] in the INFORMATIONAL request message to the UE;
and
d) if receiving the Bearer Resource Failure Indication message, the ePDG shall
also include a Notify payload indicating an error in the INFORMATIONAL request
message to the UE.
## 5.6 Handling of change of access usability
### 5.6.1 UE procedures
#### 5.6.1.1 Change in usability of GERAN or UTRAN access
This procedure can only be executed if the UE is operating in A/Gb mode or Iu
mode. The UE shall not trigger an inter-system change to A/Gb mode of
operation or Iu mode of operation to execute this procedure.
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over GERAN or UTRAN and WLAN, the network-
initiated NBIFOM mode is the selected NBIFOM mode, and:
a) the UE detects that GERAN or UTRAN access that was previously unusable has
now become usable;
b) the UE detects that the trusted WLAN using SCM that was previously usable
has now become unusable;
c) the UE detects that the trusted WLAN using MCM that was previously usable
has now become unusable;
d) the UE detects that the untrusted WLAN that was previously usable has now
become unusable; or
e) the UE detects that the trusted WLAN using SCM that was previously unusable
has now become usable;
then the UE shall initiate the PDP context modification procedure according to
3GPP TS 24.008 [3].
In the MODIFY PDP CONTEXT REQUEST message of the PDP context modification
procedure, the UE shall include the NBIFOM container IE. In the NBIFOM
container IE, the UE shall include the NBIFOM access usability indication.
NOTE: If a MODIFY PDP CONTEXT ACCEPT message is received, network can provide
routing rules updated based on the NBIFOM access usability indication
parameter using the network-initiated IP flow mobility over GERAN or UTRAN
described in subclause 5.3.1.6.
Upon receiving a REQUEST SECONDARY PDP CONTEXT ACTIVATION message or a MODIFY
PDP CONTEXT REQUEST message including the NBIFOM container IE containing the
NBIFOM routing rules parameter, the UE shall provide the network with the
routing rules accepted or rejected by the UE, using the network-initiated IP
flow mobility over GERAN or UTRAN described in subclause 5.3.1.6.
If however, the UE receives a MODIFY PDP CONTEXT REJECT message, the UE shall
consider the NBIFOM status parameter of the NBIFOM container IE of the MODIFY
PDP CONTEXT REJECT message as the cause of failure.
#### 5.6.1.2 Change in usability of E-UTRAN access
This procedure can only be executed if the UE is operating in S1 mode. The UE
shall not trigger an inter-system change to S1 mode of operation to execute
this procedure.
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over E-UTRAN and WLAN, the network-
initiated NBIFOM mode is the selected NBIFOM mode, and:
a) the UE detects that E-UTRAN access that was previously unusable has now
become usable;
b) the UE detects that the trusted WLAN using SCM that was previously usable
has now become unusable;
c) the UE detects that the trusted WLAN using MCM that was previously usable
has now become unusable;
d) the UE detects that the untrusted WLAN that was previously usable has now
become unusable; or
e) the UE detects that the trusted WLAN using SCM that was previously unusable
has now become usable;
then the UE shall initiate the UE requested bearer resource modification
procedure or the UE requested bearer resource allocation procedure according
to 3GPP TS 24.301 [4].
In:
a) the BEARER RESOURCE MODIFICATION REQUEST message of the UE requested bearer
resource modification procedure; or
b) the BEARER RESOURCE ALLOCATION REQUEST message of the UE requested bearer
resource allocation procedure;
the UE shall include the NBIFOM container IE. In the NBIFOM container IE, the
UE shall include the NBIFOM access usability indication.
Upon receiving:
a) an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message of the dedicated
EPS bearer context activation procedure, such that:
1) the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is related to the
UE requested bearer resource modification procedure or the UE requested bearer
resource allocation procedure;
2) the IEs of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message are
acceptable; and
3) the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains the
NBIFOM routing rules parameter in the NBIFOM container IE; or
b) a MODIFY EPS BEARER CONTEXT REQUEST message of the EPS bearer context
modification procedure such that:
1) the MODIFY EPS BEARER CONTEXT REQUEST message is related to the UE
requested bearer resource modification procedure or the UE requested bearer
resource allocation procedure; and
2) the IEs of the MODIFY EPS BEARER CONTEXT REQUEST message are acceptable; or
3) the MODIFY EPS BEARER CONTEXT REQUEST message contains the NBIFOM routing
rules parameter in the NBIFOM container IE;
then:
a) if the UE accepts the requested routing rules indicated in the NBIFOM
routing rules parameter:
1) the UE shall send the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message
or the MODIFY EPS BEARER CONTEXT ACCEPT message; and
2) the UE shall apply the requested routing rules; and
b) if the UE rejects the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall send:
1) the ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message; or
2) the MODIFY EPS BEARER CONTEXT REJECT message,
with the NBIFOM container IE. In the NBIFOM container IE, the UE shall include
the NBIFOM status parameter with appropriate error value.
If however, the UE receives a BEARER RESOURCE MODIFICATION REJECT message or a
BEARER RESOURCE ALLOCATION REJECT message, the UE shall consider the NBIFOM
status parameter of the NBIFOM container IE of the BEARER RESOURCE
MODIFICATION REJECT message or a BEARER RESOURCE ALLOCATION REJECT message as
the cause of failure.
#### 5.6.1.3 Change in usability of trusted WLAN using SCM
Not applicable.
#### 5.6.1.4 Change in usability of trusted WLAN using MCM
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over trusted WLAN using MCM and 3GPP
accesses, the network-initiated NBIFOM mode is the selected NBIFOM mode, and:
a) the UE detects that the trusted WLAN using MCM that was previously unusable
has now become usable; or
b) the UE detects that the 3GPP accesses that were previously usable have now
become unusable;
then the UE shall initiate the UE requested PDN connectivity modification
procedure according to 3GPP TS 24.244 [6].
In the PDN MODIFICATION INDICATION message of the UE requested PDN
connectivity modification procedure, the UE shall include the NBIFOM container
IE. In the NBIFOM container IE, the UE shall include the NBIFOM access
usability indication.
Upon receiving a PDN MODIFICATION REQUEST message of the TWAG initiated PDN
connectivity modification procedure such that:
a) the PDN MODIFICATION REQUEST message is initiated by the UE requested PDN
connectivity modification procedure; and
b) the IEs of the PDN MODIFICATION REQUEST message are acceptable;
then:
a) if the PDN MODIFICATION REQUEST message does not contain the NBIFOM routing
rules parameter in the NBIFOM container IE or does not contain the NBIFOM
container IE, the UE shall send a PDN MODIFICATION ACCEPT message; and
b) if the PDN MODIFICATION REQUEST contains the NBIFOM routing rules parameter
in the NBIFOM container IE:
1) if the UE accepts the requested routing rules indicated in the NBIFOM
routing rules parameter:
A) the UE shall send a PDN MODIFICATION ACCEPT message; and
B) the UE shall apply the requested routing rules; and
2) if the UE rejects the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall send a PDN MODIFICATION REJECT message
with the NBIFOM container IE. In the NBIFOM container IE, the UE shall include
the NBIFOM status parameter with appropriate error value.
If however, the UE receives a PDN MODIFICATION REJECT message, the UE shall
consider the NBIFOM status parameter of the NBIFOM container IE of the PDN
MODIFICATION REJECT message as the cause of failure.
#### 5.6.1.5 Change in usability of untrusted WLAN
If NBIFOM applies to a PDN connection, and the PDN connection is a multi-
access PDN connection for IP flows over untrusted WLAN access and 3GPP
accesses, and the network-initiated NBIFOM mode is the selected NBIFOM mode,
and:
a) the UE detects that the untrusted WLAN that was previously unusable has now
become usable; or
b) the UE detects that the 3GPP accesses that was previously usable has now
become unusable;
then the UE shall initiate the UE-initiated modification procedure according
to 3GPP TS 24.302 [5].
In the INFORMATIONAL request message of the UE-initiated modification
procedure, the UE shall include the NBIFOM_GENERIC_CONTAINER Notify payload.
In the NBIFOM_GENERIC_CONTAINER Notify payload, the UE shall include the
NBIFOM access usability indication.
Upon receiving an INFORMATIONAL request message of the ePDG-initiated
modification procedure such that:
a) the received INFORMATIONAL request message does not contain a Notify
payload indicating an error;
b) the received INFORMATIONAL request message contains a PTI Notify payload
with the Related Message ID field set to the Message ID field of the sent
INFORMATIONAL request message; and
c) the IEs of the received INFORMATIONAL request message are acceptable;
then:
a) if the received INFORMATIONAL request message does not contain the NBIFOM
routing rules parameter in the NBIFOM_GENERIC_CONTAINER Notify payload, the UE
shall send an INFORMATIONAL response message without a Notify payload
indicating an error; and
b) if the received INFORMATIONAL request message contains the NBIFOM routing
rules parameter in the NBIFOM_GENERIC_CONTAINER Notify payload:
1) if the UE accepts the requested routing rules indicated in the NBIFOM
routing rules parameter:
A) the UE shall send an INFORMATIONAL response message without a Notify
payload indicating an error; and
B) the UE shall apply the requested routing rules; and
2) if the UE rejects the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall send an INFORMATIONAL response message.
In the INFORMATIONAL response message, the UE shall include a Notify payload
indicating an error and the NBIFOM_GENERIC_CONTAINER Notify payload. In the
NBIFOM_GENERIC_CONTAINER Notify payload, the UE shall include the NBIFOM
status parameter with appropriate error value.
If however, the UE receives an INFORMATIONAL request message of the ePDG-
initiated modification procedure such that:
a) the received INFORMATIONAL request message contains a Notify payload
indicating an error; and
b) the received INFORMATIONAL request message contains a PTI Notify payload
with the Related Message ID field set to the Message ID field of the sent
INFORMATIONAL request message;
then:
a) the UE shall consider the NBIFOM status parameter of the
NBIFOM_GENERIC_CONTAINER Notify payload of the INFORMATIONAL request message
as the cause of failure; and
b) the UE shall send an INFORMATIONAL response message.
### 5.6.2 Network procedures
#### 5.6.2.1 Change in usability of GERAN or UTRAN
If the SGSN receives an NBIFOM container IE in an Update Bearer Request
message or a Create Bearer Request message as specified in 3GPP TS 29.274 [7]
from the SGW as specified in 3GPP TS 29.274 [7], the SGSN shall include the
received NBIFOM container IE in the MODIFY PDP CONTEXT REQUEST message or the
REQUEST SECONDARY PDP CONTEXT ACTIVATION message to the UE as specified in
3GPP TS 24.008 [3]..
If the SGSN receives a Bearer Resource Failure Indication message including
NBIFOM container IE from the SGW as specified in 3GPP TS 29.274 [7], the SGSN
shall include the received NBIFOM container IE in the MODIFY PDP CONTEXT
REJECT message to the UE as specified in 3GPP TS 24.008 [3].
#### 5.6.2.2 Change in usability change of E-UTRAN
If the MME receives an Update Bearer Request message, or a Create Bearer
Request message including NBIFOM container IE from the SGW as specified in
3GPP TS 29.274 [7], the MME shall include the received NBIFOM container IE in
the MODIFY EPS BEARER CONTEXT REQUEST message, or the ACTIVATE DEDICATED EPS
BEARER CONTEXT REQUEST message to the UE as specified in 3GPP TS 24.301 [4].
If the MME receives a Bearer Resource Failure Indication message including
NBIFOM container IE from the SGW as specified in 3GPP TS 29.274 [7], the MME
shall include the received NBIFOM container IE to the UE in the BEARER
RESOURCE MODIFICATION REJECT message or BEARER RESOURCE ALLOCATION REJECT
message as specified in 3GPP TS 24.301 [4].
#### 5.6.2.3 Change in usability of trusted WLAN using SCM
Not applicable.
#### 5.6.2.4 Change in usability of trusted WLAN using MCM
If the TWAG receives an Update Bearer Request message or a Create Bearer
Request message including NBIFOM container IE from the PDN GW as specified
3GPP TS 29.274 [7], TWAG shall include the NBIFOM container IE in the PDN
MODIFICATION REQUEST message to the UE as specified in 3GPP TS 24.244 [6].
If the TWAG receives a Bearer Resource Failure Indication message including
NBIFOM container IE from the PDN GW as specified in 3GPP TS 29.274 [7], the
TWAG shall include the NBIFOM container IE in the PDN MODIFICATION REJECT
message to the UE as specified in 3GPP TS 24.244 [6].
#### 5.6.2.5 Change in usability of untrusted WLAN
Once the ePDG receives an INFORMATIONAL request message including NBIFOM
container IE from the UE, the ePDG shall send the INFORMATIONAL response
message to the UE as specified in subclause 6.4.3 of 3GPP TS 23.161 [2].
If the ePDG receives an Update Bearer Request message, or a Create Bearer
Request message, or a Bearer Resource Failure Indication message including
NBIFOM container IE from the PDN GW as specified in 3GPP TS 29.274 [7],
a) the ePDG shall construct the NBIFOM_GENERIC_CONTAINER Notify payload as
specified in 3GPP TS 24.302 [5] and copy the NBIFOM container contents from
the NBIFOM container IE into the NBIFOM container contents field of the
NBIFOM_GENERIC_CONTAINER Notify payload;
b) the ePDG shall include the NBIFOM_GENERIC_CONTAINER Notify payload in the
INFORMATIONAL request message to the UE;
c) the ePDG shall include a PTI notify payload as specified in subclause
7.4.2.1 of 3GPP TS 24.302 [5] in the INFORMATIONAL request message to the UE;
and
d) if receiving the Bearer Resource Failure Indication message, the ePDG shall
also include a Notify payload indicating an error in the INFORMATIONAL request
message to the UE.
## 5.7 Handling of Access stratum indication
### 5.7.1 UE procedures
#### 5.7.1.1 Access stratum indication via GERAN or UTRAN
This procedure can only be executed if the UE is operating in A/Gb mode or Iu
mode. The UE shall not trigger an inter-system change to A/Gb mode of
operation or Iu mode of operation to execute this procedure.
If NBIFOM applies to a PDN connection, the network-initiated NBIFOM mode is
the selected NBIFOM mode, the RAN rules control the WLAN access selection and
traffic routing as described in 3GPP TS 24.302 [5], the RAN rules handling
parameter is set and:
a) the PDN connection is a multi-access PDN connection for IP flows over GERAN
or UTRAN and over trusted WLAN using SCM, the move-traffic-to-WLAN indication
specified in 3GPP TS 24.302 [5] is received from the access stratum layer of
the 3GPP access, and the Local Operating Environment Information in the UE
does not contain non-radio-related conditions that prohibit the use of WLAN
access; or
b) the PDN connection is a multi-access PDN connection for IP flows over GERAN
or UTRAN and WLAN, and the move-traffic-from-WLAN indication specified in 3GPP
TS 24.302 [5] is received from the access stratum layer of the 3GPP access;
then the UE shall initiate the PDP context modification procedure according to
3GPP TS 24.008 [3].
NOTE 1: The WLAN offload indication information element described in 3GPP TS
24.301 [4] and 3GPP TS 24.008 [3] does not influence execution of the Access
stratum indication via GERAN or UTRAN.
In the MODIFY PDP CONTEXT REQUEST message of the PDP context modification
procedure, the UE shall include the NBIFOM container IE. In the NBIFOM
container IE, the UE shall include the NBIFOM Access stratum status parameter
with value indicating the indication received from the access stratum layer of
the 3GPP access.
NOTE 2: If a MODIFY PDP CONTEXT ACCEPT message is received, network can
provide routing rules updated based on the NBIFOM Access stratum status
parameter using the network-initiated IP flow mobility over GERAN or UTRAN
described in subclause 5.3.2.6.
Upon receiving a REQUEST SECONDARY PDP CONTEXT ACTIVATION message or a MODIFY
PDP CONTEXT REQUEST message including the NBIFOM container IE containing the
NBIFOM routing rules parameter, the UE shall provide the network with the
routing rules accepted or rejected by the UE, using the network-initiated IP
flow mobility over GERAN or UTRAN described in subclause 5.3.1.6.
If however, the UE receives a MODIFY PDP CONTEXT REJECT message, the UE shall
consider the NBIFOM status parameter of the NBIFOM container IE of the MODIFY
PDP CONTEXT REJECT message as the cause of failure.
#### 5.7.1.2 Access stratum indication via E-UTRAN
This procedure can only be executed if the UE is operating in S1 mode. The UE
shall not trigger an inter-system change to S1 mode of operation to execute
this procedure.
If NBIFOM applies to a PDN connection, the network-initiated NBIFOM mode is
the selected NBIFOM mode, the RAN rules control the WLAN access selection and
traffic routing as described in 3GPP TS 24.302 [5], the RAN rules handling
parameter is set and:
a) the PDN connection is a multi-access PDN connection for IP flows over
E-UTRAN and over trusted WLAN using SCM, the move-traffic-to-WLAN indication
specified in 3GPP TS 24.302 [5] is received from the access stratum layer of
the 3GPP access, and the Local Operating Environment Information in the UE
does not contain non-radio-related conditions that prohibit the use of WLAN
access; or
b) the PDN connection is a multi-access PDN connection for IP flows over
E-UTRAN and WLAN, and the move-traffic-from-WLAN indication specified in 3GPP
TS 24.302 [5] is received from the access stratum layer of the 3GPP access;
then the UE shall initiate the UE requested bearer resource modification
procedure or the UE requested bearer resource allocation procedure according
to 3GPP TS 24.301 [4].
NOTE: The WLAN offload indication information element described in 3GPP TS
24.301 [4] and 3GPP TS 24.008 [3] does not influence execution of the Access
stratum indication via E-UTRAN.
In:
a) the BEARER RESOURCE MODIFICATION REQUEST message of the UE requested bearer
resource modification procedure; or
b) the BEARER RESOURCE ALLOCATION REQUEST message of the UE requested bearer
resource allocation procedure;
the UE shall include the NBIFOM container IE. In the NBIFOM container IE, the
UE shall include the NBIFOM Access stratum status parameter with value
indicating the indication received from the access stratum layer of the 3GPP
access.
Upon receiving:
a) an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message of the dedicated
EPS bearer context activation procedure, such that:
1) the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is related to the
UE requested bearer resource modification procedure or the UE requested bearer
resource allocation procedure;
2) the IEs of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message are
acceptable; and
3) the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains the
NBIFOM routing rules parameter in the NBIFOM container IE; or
b) a MODIFY EPS BEARER CONTEXT REQUEST message of the EPS bearer context
modification procedure such that:
1) the MODIFY EPS BEARER CONTEXT REQUEST message is related to the UE
requested bearer resource modification procedure or the UE requested bearer
resource allocation procedure;
2) the IEs of the MODIFY EPS BEARER CONTEXT REQUEST message are acceptable;
and
3) the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains the
NBIFOM routing rules parameter in the NBIFOM container IE;
then:
a) if the UE accepts the requested routing rules indicated in the NBIFOM
routing rules parameter:
1) the UE shall send the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message
or the MODIFY EPS BEARER CONTEXT ACCEPT message; and
2) the UE shall apply the requested routing rules; and
b) if the UE rejects the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall send:
1) the ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message; or
2) the MODIFY EPS BEARER CONTEXT REJECT message,
with the NBIFOM container IE. In the NBIFOM container IE, the UE shall include
the NBIFOM status parameter with appropriate error value.
If however, the UE receives a BEARER RESOURCE MODIFICATION REJECT message or a
BEARER RESOURCE ALLOCATION REJECT message, the UE shall consider the NBIFOM
status parameter of the NBIFOM container IE of the BEARER RESOURCE
MODIFICATION REJECT message or a BEARER RESOURCE ALLOCATION REJECT message as
the cause of failure.
#### 5.7.1.3 Access stratum indication via trusted WLAN using SCM
Not applicable.
#### 5.7.1.4 Access stratum indication via trusted WLAN using MCM
If NBIFOM applies to a PDN connection, the network-initiated NBIFOM mode is
the selected NBIFOM mode, the RAN rules control the WLAN access selection and
traffic routing as described in 3GPP TS 24.302 [5], the RAN rules handling
parameter is set, the PDN connection is a multi-access PDN connection for IP
flows over trusted WLAN using MCM and 3GPP accesses, the move-traffic-to-WLAN
indication specified in 3GPP TS 24.302 [5] is received from the access stratum
layer of the 3GPP access, and the Local Operating Environment Information in
the UE does not contain non-radio-related conditions that prohibit the use of
WLAN access then the UE shall initiate the UE requested PDN connectivity
modification procedure according to 3GPP TS 24.244 [6].
NOTE: The WLAN offload indication information element described in 3GPP TS
24.301 [4] and 3GPP TS 24.008 [3] does not influence execution of the Access
stratum indication via trusted WLAN using MCM.
In the PDN MODIFICATION INDICATION message of the UE requested PDN
connectivity modification procedure, the UE shall include the NBIFOM container
IE. In the NBIFOM container IE, the UE shall include the NBIFOM Access stratum
s status parameter with value indicating the indication received from the
access stratum layer of the 3GPP access.
Upon receiving a PDN MODIFICATION REQUEST message of the TWAG initiated PDN
connectivity modification procedure such that:
a) the PDN MODIFICATION REQUEST message is initiated by the UE requested PDN
connectivity modification procedure; and
b) the IEs of the PDN MODIFICATION REQUEST message are acceptable;
then:
a) if the PDN MODIFICATION REQUEST message does not contain the NBIFOM routing
rules parameter in the NBIFOM container IE or does not contain the NBIFOM
container IE, the UE shall send a PDN MODIFICATION ACCEPT message; and
b) if the PDN MODIFICATION REQUEST contains the NBIFOM routing rules parameter
in the NBIFOM container IE:
1) if the UE accepts the requested routing rules indicated in the NBIFOM
routing rules parameter:
A) the UE shall send a PDN MODIFICATION ACCEPT message; and
B) the UE shall apply the requested routing rules; and
2) if the UE rejects the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall send a PDN MODIFICATION REJECT message
with the NBIFOM container IE. In the NBIFOM container IE, the UE shall include
the NBIFOM status parameter with appropriate error value.
If however, the UE receives a PDN MODIFICATION REJECT message, the UE shall
consider the NBIFOM status parameter of the NBIFOM container IE of the PDN
MODIFICATION REJECT message as the cause of failure.
#### 5.7.1.5 Access stratum indication via untrusted WLAN
If NBIFOM applies to a PDN connection, the network-initiated NBIFOM mode is
the selected NBIFOM mode, the RAN rules control the WLAN access selection and
traffic routing as described in 3GPP TS 24.302 [5], the RAN rules handling
parameter is set, the PDN connection is a multi-access PDN connection for IP
flows over 3GPP accesses and over untrusted WLAN, the move-traffic-to-WLAN
indication specified in 3GPP TS 24.302 [5] is received from the access stratum
layer of the 3GPP access, and the Local Operating Environment Information in
the UE does not contain non-radio-related conditions that prohibit the use of
WLAN access then the UE shall initiate the UE-initiated modification procedure
according to 3GPP TS 24.302 [5].
NOTE: The WLAN offload indication information element described in 3GPP TS
24.301 [4] and 3GPP TS 24.008 [3] does not influence execution of the Access
stratum indication via untrusted WLAN.
In the INFORMATIONAL request message of the UE-initiated modification
procedure, the UE shall include the NBIFOM_GENERIC_CONTAINER Notify payload.
In the NBIFOM_GENERIC_CONTAINER Notify payload, the UE shall include the
NBIFOM Access stratum status parameter with value indicating the indication
received from the access stratum layer of the 3GPP access.
Upon receiving an INFORMATIONAL request message of the ePDG-initiated
modification procedure such that:
a) the received INFORMATIONAL request message contains a PTI Notify payload
with the Related Message ID field set to the Message ID field of the sent
INFORMATIONAL request message; and
b) the IEs of the received INFORMATIONAL request message are acceptable;
then:
a) if the received INFORMATIONAL request message does not contain the NBIFOM
routing rules parameter in the NBIFOM_GENERIC_CONTAINER Notify payload, the UE
shall send an INFORMATIONAL response message without a Notify payload
indicating an error; and
b) if the received INFORMATIONAL request message contains the NBIFOM routing
rules parameter in the NBIFOM_GENERIC_CONTAINER Notify payload:
1) if the UE accepts the requested routing rules indicated in the NBIFOM
routing rules parameter:
A) the UE shall send an INFORMATIONAL response message without a Notify
payload indicating an error; and
B) the UE shall apply the requested routing rules; and
2) if the UE rejects the requested routing rules indicated in the NBIFOM
routing rules parameter, the UE shall send an INFORMATIONAL response message.
In the INFORMATIONAL response message, the UE shall include a Notify payload
indicating an error and shall include the NBIFOM_GENERIC_CONTAINER Notify
payload. In the NBIFOM_GENERIC_CONTAINER Notify payload, the UE shall include
the NBIFOM status parameter with appropriate error value.
If however, the UE receives an INFORMATIONAL request message of the ePDG-
initiated modification procedure such that:
a) the received INFORMATIONAL request message contains a Notify payload
indicating an error; and
b) the received INFORMATIONAL request message contains a PTI Notify payload
with the Related Message ID field set to the Message ID field of the sent
INFORMATIONAL request message;
then:
a) the UE shall consider the NBIFOM status parameter of the
NBIFOM_GENERIC_CONTAINER Notify payload of the INFORMATIONAL request message
as the cause of failure; and
b) the UE shall send an INFORMATIONAL response message.
### 5.7.2 Network procedures
#### 5.7.2.1 Access stratum indication via GERAN or UTRAN
If the SGSN receives an NBIFOM container IE inan Update Bearer Request message
or a Create Bearer Request message as specified in 3GPP TS 29.274 [7] from the
SGW, the SGSN shall include the received NBIFOM container IE in the MODIFY PDP
CONTEXT REQUEST message or the REQUEST SECONDARY PDP CONTEXT ACTIVATION
message to the UE as specified in 3GPP TS 24.008 [3]..
If the SGSN receives a Bearer Resource Failure Indication message including
NBIFOM container IE from the SGW as specified in 3GPP TS 29.274 [7], the SGSN
shall include the received NBIFOM container IE in the MODIFY PDP CONTEXT
REJECT message to the UE as specified in 3GPP TS 24.008 [3].
#### 5.7.2.2 Access stratum indication via E-UTRAN
If the MME receives an NBIFOM container IE in an Update Bearer Request
message, or a Create Bearer Request message as specified in 3GPP TS 29.274 [7]
from the SGW, the MME shall include the received NBIFOM container IE in the
MODIFY EPS BEARER CONTEXT REQUEST message, or the ACTIVATE DEDICATED EPS
BEARER CONTEXT REQUEST message to the UE as specified in 3GPP TS 24.301 [4].
If the MME receives a Bearer Resource Failure Indication message including
NBIFOM container IE from the SGW as specified in 3GPP TS 29.274 [7], the MME
shall include the received NBIFOM container IE in the BEARER RESOURCE
MODIFICATION REJECT message or BEARER RESOURCE ALLOCATION REJECT message to
the UE as specified in 3GPP TS 24.301 [4].
#### 5.7.2.3 Access stratum indication via trusted WLAN using SCM
Not applicable.
#### 5.7.2.4 Access stratum indication via trusted WLAN using MCM
If the TWAG receives an Update Bearer Request message or a Create Bearer
Request message including NBIFOM container IE from the PDN GW as specified
3GPP TS 29.274 [7], TWAG shall include the NBIFOM container IE in the PDN
MODIFICATION REQUEST message to the UE as specified in 3GPP TS 24.244 [6].
If the TWAG receives a Bearer Resource Failure Indication message including
NBIFOM container IE from the PDN GW as specified in 3GPP TS 29.274 [7], the
TWAG shall include the NBIFOM container IE in the PDN MODIFICATION REJECT
message to the UE as specified in 3GPP TS 24.244 [6].
#### 5.7.2.5 Access stratum indication via untrusted WLAN
Once the ePDG receives an INFORMATIONAL request message including NBIFOM
container IE from the UE, the ePDG shall send the INFORMATIONAL response
message to the UE as specified in subclause 6.7.2 of 3GPP TS 23.161 [2].
If the ePDG receives an Update Bearer Request message, or a Create Bearer
Request message, or a Bearer Resource Failure Indication message including
NBIFOM container IE from the PDN GW as specified in 3GPP TS 29.274 [7]:
a) the ePDG shall construct the NBIFOM_GENERIC_CONTAINER Notify payload as
specified in 3GPP TS 24.302 [5] and copy the NBIFOM container contents from
the NBIFOM container IE into the NBIFOM container contents field of the
NBIFOM_GENERIC_CONTAINER Notify payload;
b) the ePDG shall include the NBIFOM_GENERIC_CONTAINER Notify payload in the
INFORMATIONAL request message to the UE;
c) the ePDG shall include a PTI notify payload as specified in subclause
7.4.2.1 of 3GPP TS 24.302 [5] in the INFORMATIONAL request message to the UE;
and
d) if receiving the Bearer Resource Failure Indication message, the ePDG shall
also include a Notify payload indicating an error in the INFORMATIONAL request
message to the UE.
# 6 PDUs and parameters specific to the present document
## 6.0 General
The sending entity shall set value of a spare bit to zero. The receiving
entity shall ignore value of a spare bit.
The sending entity shall not set value of a field to a reserved value. The
receiving entity shall discard a message carrying a field with value set to a
reserved value.
## 6.1 NBIFOM parameter list
### 6.1.1 General
The purpose of the NBIFOM parameter list is to transfer parameters associated
with the network-based IP flow mobility (NBIFOM).
The NBIFOM parameter list is coded as shown in figure 6.1.1-1 and table
6.1.1-1.
+--------------------------------+------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +--------------------------------+------------+---+---+---+---+---+---+---+ | Parameter identifier 1 | octet 1 | | | | | | | | +--------------------------------+------------+---+---+---+---+---+---+---+ | Length of parameter contents 1 | octet 2 | | | | | | | | +--------------------------------+------------+---+---+---+---+---+---+---+ | Parameter contents 1 | octet 3 | | | | | | | | | | | | | | | | | | | | octet x | | | | | | | | +--------------------------------+------------+---+---+---+---+---+---+---+ | . . . | octet x+1\ | | | | | | | | | | \ | | | | | | | | | | octet y | | | | | | | | +--------------------------------+------------+---+---+---+---+---+---+---+ | Parameter identifier n | octet y+1 | | | | | | | | +--------------------------------+------------+---+---+---+---+---+---+---+ | Length of parameter contents n | octet y+2 | | | | | | | | +--------------------------------+------------+---+---+---+---+---+---+---+ | Parameter contents n | octet y+3 | | | | | | | | | | | | | | | | | | | | octet z | | | | | | | | +--------------------------------+------------+---+---+---+---+---+---+---+
Figure 6.1.1-1: NBIFOM parameter list
Table 6.1.1-1: NBIFOM parameter list
+----------------------------------------------------------------------+ | The NBIFOM _parameter list_ contains a list of parameters, each one | | in a separate unit consisting of a parameter _identifier field_ , a | | length of parameter contents _field_ and a parameter contents | | _field_. | | | | The parameter _identifier field_ of a unit _contains_ the | | hexadecimal coding of the parameter identifier. Bit 8 of the | | _parameter identifier_ field contains the most significant bit. | | | | The _length of_ parameter _contents_ field of a unit contains the | | binary coded representation of the length of the parameter | | _contents_ field of the unit. Bit 8 of the _length of_ parameter | | _contents_ field contains the most significant bit. | | | | The parameter contents field of a unit contains the binary coded | | representation of the value of the parameter identified in the | | parameter _identifier field_ of the unit. Bit 8 of the parameter | | _contents_ field contains the most significant bit. | | | | If the _parameter list_ contains a unit with a parameter | | _identifier_ that is not supported by the receiving entity, the | | receiving entity ignores the unit and the receiving entity continues | | handling the rest of the units in the _parameter list_. | | | | The receiving entity does not assume that a certain order of units | | will be used in the _parameter list_. | | | | In this version of the protocol, the following parameter identifiers | | are specified: | | | | MS to network direction: | | | | - 00H (Not assigned). | | | | - 01H (NBIFOM mode); | | | | - 02H (NBIFOM default access); | | | | - 03H (NBIFOM status); | | | | - 04H (NBIFOM routing rules); | | | | - 05H (NBIFOM IP flow mapping); | | | | - 06H (Not assigned); | | | | - 07H (NBIFOM Access stratum status); and | | | | - 08H (NBIFOM access usability indication). | | | | - 09H to FFH (Not assigned). | | | | Network to MS direction: | | | | - 00H (Not assigned). | | | | - 01H (NBIFOM mode); | | | | - 02H (NBIFOM default access); | | | | - 03H (NBIFOM status); | | | | - 04H (NBIFOM routing rules); | | | | - 05H (Not assigned); | | | | - 06H (NBIFOM RAN rules handling); | | | | - 07H (Not assigned); and | | | | - 08H (Not assigned). | | | | - 09H to FFH (Not assigned). | +----------------------------------------------------------------------+
### 6.1.2 NBIFOM default access parameter
When the parameter _identifier_ field of a unit in the NBIFOM parameter list
indicates the NBIFOM default access, the _length of parameter contents field
is set to one and_ the _parameter_ contents field is coded according to table
6.1.2-1.
Table 6.1.2-1: Parameter contents field of a unit carrying NBIFOM default
access parameter
The parameter contents field is coded as follows:
* * *
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 1 3GPP access 0 0 0 0 0 0 1 0 non-3GPP access All other values
are reserved.
### 6.1.3 NBIFOM status parameter
When the parameter _identifier_ field of a unit in the NBIFOM parameter list
indicates the NBIFOM status, the _length of parameter contents field is set to
one and_ the _parameter_ contents field is coded according to table 6.1.3-1.
Table 6.1.3-1: Parameter contents field of a unit carrying NBIFOM status
parameter
The status parameter is coded as follows:
* * *
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 0 Accepted 0 0 0 1 1 0 1 0 Insufficient resources 0 0 1 0 0 1 0
1 Requested service option not subscribed 0 0 1 0 0 0 1 0 Service option
temporarily out of order 0 0 1 1 1 1 1 1 Request rejected, unspecified 0 0 1 1
1 0 0 1 Incorrect indication in the routing rule operation 0 0 1 1 1 0 1 0
Unknown information in IP flow filter(s) 0 1 1 0 1 1 1 1 Protocol error,
unspecified 1 0 0 0 0 0 1 0 Unknown routing access information All other
values are interpreted as \"Protocol error, unspecified\".
Status parameter #26 -- Insufficient resources
This status code is used by the UE or by the network to indicate that the
requested routing rule cannot be accepted due to insufficient resources for
the requested routing access.
Status parameter #33 -- Requested service option not subscribed
This status code is used when the UE requested routing access cannot be used
to transport the requested service due to the restriction of subscription.
Status parameter #34 -- Service option temporarily out of order
This status code is used when the requested routing rule cannot be accepted
due to temporary outage of one or more functions required for supporting the
service via the requested routing access.
Status parameter #31 -- Request rejected, unspecified
This status code is used by the network or by the UE to indicate that the
requested routing rule cannot be accepted due to unspecified reasons.
Status parameter #57 --Incorrect indication in the routing rule operation
This status code is used by the network or the UE to indicate that the
requested routing rule cannot be accepted due to incorrect operation code
included in the request.
Status parameter #58 -- Unknown information in IP flow filter(s)
This status code is used by the network or the UE to indicate that the
requested routing rule cannot be accepted due to unknown information included
in the routing rule\'s IP flow filter(s).
Status parameter #111 -- Protocol error, unspecified
This status code is used to report a protocol error event only when no other
status code in the protocol error class applies.
Status parameter #130 --Unknown routing access information
This status code is used by the network or by the UE to indicate that the
requested routing rule cannot be accepted due to unknown routing access
information.
### 6.1.4 NBIFOM routing rules
When the parameter _identifier_ field of a unit in the NBIFOM parameter list
indicates the NBIFOM routing rules, the _parameter_ contents field is coded
according to figure 6.1.4-1 and table 6.1.4-1.
+-------+-------+-------+-------+-------+-------+-------+-------+---+ | **8** | **7** | **6** | **5** | **4** | **3** | **2** | **1** | | +-------+-------+-------+-------+-------+-------+-------+-------+---+ | L | octet | | | | | | | | | ength | 1 | | | | | | | | | of | | | | | | | | | | ro | | | | | | | | | | uting | | | | | | | | | | rule | | | | | | | | | | 1 | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+---+ | Ro | octet | | | | | | | | | uting | 2 | | | | | | | | | rule | | | | | | | | | | ident | | | | | | | | | | ifier | | | | | | | | | | 1 | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+---+ | Ro | 0 | 0 | 0 | Oper | octet | | | | | uting | | | | ation | 3 | | | | | a | Spare | Spare | Spare | code | | | | | | ccess | | | | 1 | | | | | | 1 | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+---+ | Ro | octet | | | | | | | | | uting | 4 | | | | | | | | | rule | | | | | | | | | | pri | | | | | | | | | | ority | | | | | | | | | | 1 | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+---+ | Ro | octet | | | | | | | | | uting | 5\ | | | | | | | | | f | \ | | | | | | | | | ilter | octet | | | | | | | | | 1 | x | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+---+ | . . . | octet | | | | | | | | | | x+1\ | | | | | | | | | | \ | | | | | | | | | | octet | | | | | | | | | | y | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+---+ | L | octet | | | | | | | | | ength | y+1 | | | | | | | | | of | | | | | | | | | | ro | | | | | | | | | | uting | | | | | | | | | | rule | | | | | | | | | | n | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+---+ | Ro | octet | | | | | | | | | uting | y+2 | | | | | | | | | rule | | | | | | | | | | ident | | | | | | | | | | ifier | | | | | | | | | | n | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+---+ | Ro | 0 | 0 | 0 | Oper | octet | | | | | uting | | | | ation | y+3 | | | | | a | Spare | Spare | Spare | code | | | | | | ccess | | | | n | | | | | | n | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+---+ | Ro | octet | | | | | | | | | uting | y+4 | | | | | | | | | rule | | | | | | | | | | pri | | | | | | | | | | ority | | | | | | | | | | n | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+---+ | Ro | octet | | | | | | | | | uting | y+5\ | | | | | | | | | f | \ | | | | | | | | | ilter | octet | | | | | | | | | n | z | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+---+
Figure 6.1.4-1: Parameter contents field of a unit carrying NBIFOM routing
rules parameter
Table 6.1.4-1: Parameter contents field of a unit carrying NBIFOM routing
rules parameter
+-------------------+-------+-----------------+-------------------+ | **Routing rules** | | | | | (octets 1 to z) | | | | | | | | | | The routing rules | | | | | contain a list of | | | | | routing rules, | | | | | each one in a | | | | | separate unit | | | | | consisting of a | | | | | length of routing | | | | | rule _field, and | | | | | the routing rule | | | | | contents. The | | | | | routing rule | | | | | contents consist | | | | | of_ a routing | | | | | rule identifier | | | | | _field, a routing | | | | | access field, an | | | | | operation code | | | | | field, a routing | | | | | rule priority | | | | | field, and a | | | | | routing filter | | | | | field_. | | | | +===================+=======+=================+===================+ | The _length of_ | | | | | routing rule | | | | | _field_ (octet 1) | | | | | of a unit | | | | | contains the | | | | | binary coded | | | | | representation of | | | | | the length of | | | | | _the routing rule | | | | | contents of the | | | | | unit_. Bit 8 of | | | | | the _length of_ | | | | | routing filter | | | | | _field_ contains | | | | | the most | | | | | significant bit. | | | | +-------------------+-------+-----------------+-------------------+ | Routing rule | | | | | identifier (octet | | | | | 2) uniquely | | | | | identifies the | | | | | routing rule | | | | | within one | | | | | multi-access PDN | | | | | connection. The | | | | | routing rule | | | | | identifier is | | | | | allocated by the | | | | | entity creating | | | | | the routing rule, | | | | | i.e. by the UE in | | | | | the UE-initiated | | | | | NBIFOM mode and | | | | | by the PDN GW in | | | | | the | | | | | network-initiated | | | | | NBIFOM mode. | | | | +-------------------+-------+-----------------+-------------------+ | | | | | +-------------------+-------+-----------------+-------------------+ | Operation code | | | | | (bits 1-3 in | | | | | octet 3) | | | | +-------------------+-------+-----------------+-------------------+ | Bits | | | | +-------------------+-------+-----------------+-------------------+ | **3** | **2** | **1** | | +-------------------+-------+-----------------+-------------------+ | 0 | 0 | 0 | Spare | +-------------------+-------+-----------------+-------------------+ | 0 | 0 | 1 | Create routing | | | | | rule | +-------------------+-------+-----------------+-------------------+ | 0 | 1 | 0 | Delete routing | | | | | rule | +-------------------+-------+-----------------+-------------------+ | 0 | 1 | 1 | Replace existing | | | | | routing rule | +-------------------+-------+-----------------+-------------------+ | 1 | 0 | 0 | Reserved | +-------------------+-------+-----------------+-------------------+ | The values from | | | | | \"100\" to | | | | | \"111\" are | | | | | reserved. | | | | +-------------------+-------+-----------------+-------------------+ | | | | | +-------------------+-------+-----------------+-------------------+ | Routing access | | | | | (bits 8-7 in | | | | | octet 3) | | | | +-------------------+-------+-----------------+-------------------+ | Bits | | | | +-------------------+-------+-----------------+-------------------+ | **8** | **7** | | | +-------------------+-------+-----------------+-------------------+ | 0 | 1 | 3GPP access | | +-------------------+-------+-----------------+-------------------+ | 1 | 0 | non-3GPP access | | +-------------------+-------+-----------------+-------------------+ | The values \"00\" | | | | | and \"11\" are | | | | | reserved. | | | | +-------------------+-------+-----------------+-------------------+ | Routing rule | | | | | priority (octet | | | | | 4) indicates the | | | | | order of the | | | | | routing rule | | | | | application when | | | | | the IP packet | | | | | matches more than | | | | | one routing | | | | | filter. The lower | | | | | value indicates | | | | | higher priority. | | | | +-------------------+-------+-----------------+-------------------+ | | | | | +-------------------+-------+-----------------+-------------------+ | Routing filter | | | | | (octet 5 to octet | | | | | x) contains a | | | | | routing filter | | | | | and is coded | | | | | according to | | | | | figure 6.1.4-2 | | | | | and | | | | | table 6.1.4-2. | | | | +-------------------+-------+-----------------+-------------------+ | | | | | +-------------------+-------+-----------------+-------------------+
+-----------------------------------------+------------+---+---+---+---+---+---+---------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=========================================+============+===+===+===+===+===+===+=========+ | | | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | H | G | F | E | D | C | B | A | octet 1 | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | Z | Z | N | M | L | K | J | I | octet 2 | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | Z | Z | Z | Z | Z | Z | Z | Z | octet 3 | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | Z | Z | Z | Z | Z | Z | Z | Z | octet 4 | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (A) Source IPv4 address | octet 5 | | | | | | | | | | | | | | | | | | | | octet 8 | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (B) Destination IPv4 address | octet a | | | | | | | | | | | | | | | | | | | | octet a+3 | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (C) Source IPv6 address | octet b | | | | | | | | | | | | | | | | | | | | octet b+15 | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (D) Destination IPv6 address | octet c | | | | | | | | | | | | | | | | | | | | octet c+15 | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (E) Source address prefix length | octet d | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (F) Destination address prefix length | octet e | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (G) IPSec security parameter Index | octet f | | | | | | | | | | | | | | | | | | | | octet f+3 | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (H) Protocol type next header | octet g | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (I) Start source port range | octet h | | | | | | | | | | | | | | | | | | | | octet h+3 | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (J) End source port range | octet i | | | | | | | | | | | | | | | | | | | | octet i+3 | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (K) Start destination port range | octet j | | | | | | | | | | | | | | | | | | | | octet j+3 | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (L) End destination port range | octet k | | | | | | | | | | | | | | | | | | | | octet k+3 | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (M) Type of service | octet l | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+ | (N) Flow label | octet m | | | | | | | | | | | | | | | | | | | | octet m+3 | | | | | | | | +-----------------------------------------+------------+---+---+---+---+---+---+---------+
Figure 6.1.4-2: Routing filter
Table 6.1.4-2: Routing filter
+----------------------------------------------------------------------+ | Routing filter component type indication \'A\' to \'N\' flags | | (octet 1 - octet 4) | | | | Each flag in this field indicates whether the corresponding field is | | present in the IE as shown in Figure 6.1.4-2. | | | | IPv4 address field and IPv6 address field shall not be present in | | the same routing rule item, i.e. if \'A\' flag, \'B\' flag or both | | are set, then \'C\' flag and \'D\' flag are not set. | | | | End source port range can be present only when start source port | | range is present, i.e. if \'J\' flag is set, then \'I\' flag is set. | | | | End destination port range can be present only when start | | destination port range is present, i.e. if \'L\' flag is set, then | | \'K\' flag is set. | | | | The sending entity sets \'Z\' flags to zero. If a \'Z\' flag is set | | to zero, the receiving entity ignores the \'Z\' flag. If a \'Z\' | | flag is set to one, the receiving entity ignores the routing rule. | +======================================================================+ | | +----------------------------------------------------------------------+ | Source IPv4 address indicates the source IPv4 address of the uplink | | packet to be matched and indicates the destination IPv4 address of | | the downlink packet to be matched. If \'A\' flag is set, then this | | field is present otherwise this field is not present. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | Destination IPv4 address indicates the destination IPv4 address of | | the uplink packet to be matched and indicates the source IPv4 | | address of the downlink packet to be matched. If \'B\' flag is set, | | then this field is present otherwise this field is not present. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | Source IPv6 address indicates the source IPv6 address of the uplink | | packet to be matched and indicates the destination IPv6 address of | | the downlink packet to be matched. If \'C\' flag is set, then this | | field is present otherwise this field is not present. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | Destination IPv6 address indicates the destination IPv6 address of | | the uplink packet to be matched and indicates the source IPv6 | | address of the downlink packet to be matched. If \'D\' flag is set, | | then this field is present otherwise this field is not present. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | Source address prefix length indicates the subnet length of IPv4 | | source address or the prefix length of the IPv6 source address of | | the uplink packet to be matched and indicates the subnet length of | | IPv4 destination address or the prefix length of the IPv6 | | destination address of the downlink packet to be matched. If \'E\' | | flag is set, then this field is present otherwise this field is not | | present. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | Destination address prefix length indicates the subnet length of | | IPv4 destination address or the prefix length of the IPv6 | | destination address of the uplink packet to be matched and indicates | | the subnet length of IPv4 source address or the prefix length of the | | IPv6 source address of the downlink packet to be matched. If \'F\' | | flag is set, then this field is present otherwise this field is not | | present. | +----------------------------------------------------------------------+ | IPSec security parameter index indicates the 32-bit IPSec SPI value | | of the packet to be matched. If \'G\' flag is set, then this field | | is present otherwise this field is not present. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | Protocol type next header indicates the 8-bit protocol type (for | | IPv4) or next header (for IPv6) value of the packet to be matched. | | If \'H\' flag is set, then this field is present otherwise this | | field is not present. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | Start source port range indicates the first value of a range of port | | numbers of the source port of the uplink packet to be matched and | | indicates the first value of a range of port numbers of the | | destination port of the downlink packet to be matched. If \'I\' flag | | is set, then this field is present otherwise this field is not | | present. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | End source port range indicates the end value of a range of port | | numbers of the source port of the uplink packet to be matched and | | indicates the end value of a range of port numbers of the | | destination port of the downlink packet to be matched. If \'J\' flag | | is set, then this field is present otherwise this field is not | | present. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | Start destination port range indicates the first value of a range of | | port numbers of the destination port of the uplink packet to be | | matched and indicates the first value of a range of port numbers of | | the source port of the downlink packet to be matched. If \'K\' flag | | is set, then this field is present otherwise this field is not | | present. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | End destination port range indicates the end value of a range of | | port numbers of the destination port of the uplink packet to be | | matched and indicates the end value of a range of port numbers of | | the source port of the downlink packet to be matched. If \'L\' flag | | is set, then this field is present otherwise this field is not | | present. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | Type of service indicates the type of service value of the packet to | | be matched. If \'M\' flag is set, then this field is present | | otherwise this field is not present. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | Flow label indicates the 20-bit IPv6 flow label value of the packet | | to be matched. The bits 8 through 5 of the first octet of this field | | are spare. If \'N\' flag is set, then this field is present | | otherwise this field is not present. | +----------------------------------------------------------------------+
### 6.1.5 NBIFOM IP flow mapping parameter
When the parameter _identifier_ field of a unit in the NBIFOM parameter list
indicates the NBIFOM IP flow mapping, the _parameter_ contents field is coded
according to figure 6.1.4-1 and table 6.1.4-1.
NOTE: Coding of the _parameter_ contents field of the NBIFOM IP flow mapping
parameter is the same as coding of the _parameter_ contents field of the
NBIFOM routing rules parameter.
### 6.1.6 NBIFOM RAN rules handling parameter
When the parameter _identifier_ field of a unit in the NBIFOM parameter list
indicates the NBIFOM RAN rules handling, the _length of parameter contents
field is set to one and_ the _parameter_ contents field is coded according to
table 6.1.6-1.
Table 6.1.6-1: Parameter contents field of a unit carrying NBIFOM RAN rules
handling parameter
The parameter contents field is coded as follows:
* * *
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 1 RAN rules handling parameter is not set 0 0 0 0 0 0 1 0 RAN
rules handling parameter is set All other values are reserved.
### 6.1.7 NBIFOM Access stratum status parameter
When the parameter _identifier_ field of a unit in the NBIFOM parameter list
indicates the NBIFOM Access stratumstatus, the _length of parameter contents
field is set to one and_ the _parameter_ contents field is coded according to
table 6.1.7-1.
Table 6.1.7-1: Parameter contents field of a unit carrying NBIFOM Access
stratumstatus parameter
The parameter contents field is coded as follows:
* * *
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 1 no indication 0 0 0 0 0 0 1 0 move-traffic-from-WLAN
indication 0 0 0 0 0 0 1 1 move-traffic-to-WLAN indication All other values
are reserved.
### 6.1.8 NBIFOM access usability indication
When the parameter _identifier_ field of a unit in the NBIFOM parameter list
indicates the NBIFOM access usability indication, the _length of parameter
contents field is set to one and_ the _parameter_ contents field is coded
according to figure 6.1.8-1 and table 6.1.8-1.
+-------+-------+-------+-------+--------+--------+--------+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=======+=======+=======+=======+========+========+========+===+===+ | 0 | 0 | 0 | 0 | WLAN | 3GPP | octet | | | | | | | | access | access | 1 | | | | Spare | Spare | Spare | Spare | usable | usable | | | | | | | | | value | value | | | | +-------+-------+-------+-------+--------+--------+--------+---+---+
Figure 6.1.8-1: Parameter contents field of a unit carrying NBIFOM access
usability indication parameter
Table 6.1.8-1: Parameter contents field of a unit carrying NBIFOM access
usability indication parameter
3GPP access usable value (octet 1)
* * *
Bit  
2 1  
0 0 no change in usability of 3GPP access. 0 1 3GPP access becomes usable 1 0
3GPP access becomes unusable. 1 1 reserved.
WLAN access usable value (octet 1)  
Bit  
4 3  
0 0 no change in usability of WLAN access. 0 1 WLAN access becomes usable. 1 0
WLAN access becomes unusable. 1 1 reserved.
### 6.1.9 NBIFOM mode parameter
When the parameter identifier field of a unit in the NBIFOM parameter list
indicates the NBIFOM mode, the length of parameter contents field is set to
one and the parameter contents field is coded according to table 6.1.9-1.
Table 6.1.9-1: Parameter contents field of a unit carrying NBIFOM mode
parameter
The parameter contents field is coded as follows:
* * *
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 1 UE-initiated NBIFOM mode 0 0 0 0 0 0 1 0 Network-initiated
NBIFOM mode All other values are reserved.
#
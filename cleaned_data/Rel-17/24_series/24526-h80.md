# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document defines UE policies for 5G System (5GS) as specified in
3GPP TS 23.503 [2] including:
\- UE route selection policy; and
\- Access network discovery and selection policy.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.503: \" Policy and Charging Control Framework for the 5G
System; Stage 2\".
[3] 3GPP TS 24.502: \"Access to the 3GPP 5G Core Network (5GCN) via Non-3GPP
Access Networks (N3AN); Stage 3\".
[4] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[5] 3GPP TS 25.331: \"Radio Resource Control (RRC); Protocol Specification\".
[6] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA)
Radio Resource Control (RRC); Protocol specification\".
[7] 3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".
[8] IEEE Std 802.11™-2016: \"Information Technology- Telecommunications and
information exchange between systems-Local and metropolitan area networks-
Specific requirements-Part 11: Wireless LAN Medium Access Control (MAC) and
Physical Layer (PHY) Specifications\".
[9] Wi-Fi Alliance: \"Hotspot 2.0 (Release 2) Technical Specification, version
1.0.0\", 2014-08-08.
[10] ITU-T Recommendation E.212: \"The international identification plan for
public networks and subscriptions\", 2016-09-23.
[11] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
[12] IETF RFC 1035: \"Domain names - implementation and specification\".
[13] ISO 8601:2004: \"Data elements and interchange formats -- Information
interchange -- Representation of dates and times\".
[14] 3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\".
[15] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[16] IETF RFC 4122: \"A Universally Unique IDentifier (UUID) URN Namespace\".
[17] IETF RFC 5905: \"Network Time Protocol Version 4: Protocol and Algorithms
Specification\".
[18] 3GPP TS 24.588: \"Vehicle-to-Everything (V2X) services in 5G System
(5GS); User Equipment (UE) policies; Stage 3\".
[18A] 3GPP TS 24.555: \"Proximity-services (ProSe) in 5G System (5GS); User
Equipment (UE) policies; Stage 3\".
[19] IEEE 1003.1-2004, Part 1: Base Definitions.
[20] IEEE Std 802.1Q-2018: \"IEEE Standard for Local and metropolitan area
networks--Bridges and Bridged Networks\".
[21] 3GPP TS 24.554: \"Proximity-services (ProSe) in 5G System (5GS) protocol
aspects; Stage 3\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1]apply. A term defined in the present document takes
precedence over the definition of the same term, if any, in 3GPP TR 21.905
[1].
**Non-subscribed SNPN signalled URSP:** URSP rules signalled by a non-
subscribed SNPN according to annex D of 3GPP TS 24.501 [11].
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.501 [15] apply:
**non-seamless non-3GPP offload**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.503 [2] apply:
**UE local configuration**
**User preferences on non-3GPP access selection**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.501 [11] apply:
**5GMM-IDLE mode**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
5GCN 5G Core Network
5GS 5G System
ANDSP Access Network Discovery and Selection Policy
DNN Data Network Name
ePDG evolved Packet Data Gateway
FQDN Fully Qualified Domain Name
H-PCF A PCF in the HPLMN
IMS IP Multimedia Subsystem
LADN Local Area Data Network
MCC Mobile Country Code
ME Mobile Equipment
MMS Multimedia Messaging Service
MNC Mobile Network Code
N3AN Non-3GPP Access Network
N3IWF Non-3GPP InterWorking Function
OS Operating System
PCF Policy Control Function
ProSeP 5G ProSe Policy
RSN Redundancy Sequence Number
S-NSSAI Single Network Slice Selection Assistance Information
SSC Session and Service Continuity
SUPI Subscriber Permanent Identifier
SUPL Secure User Plane Location
URSP UE Route Selection Policy
USIM User Services Identity Module
V-PCF A PCF in the VPLMN
V2XP V2X Policy
WLANSP WLAN Selection Policy
# 4 Descriptions of UE policies for 5GS
## 4.1 Overview
The UE policies for 5GS include:
\- UE route selection policy (URSP)(see clause 4.2);
\- Access network discovery and selection policy (ANDSP)(see clause 4.3);
\- V2X policy (V2XP); and
\- 5G ProSe policy (ProSeP).
The UE policies can be delivered from the PCF to the UE. The UE policy
delivery procedure is specified in 3GPP TS 24.501 [11].
The UE policies can also be pre-configured in the UE. The pre-configured
policy shall be applied by the UE only when the UE has not received the same
type of policy from the PCF. The implementation of pre-configured UE policies
is out of scope of this specification.
The UE policies can be delivered from the PCF to the 5G-RG or a W-AGF acting
on behalf of the FN-RG. The UE policy delivery service is specified in 3GPP TS
24.501 [11]. These UE policies include the UE route selection policy (URSP)
(see clause 4.2).
The UE policies can also be pre-configured in the 5G-RG or a W-AGF acting on
behalf of the FN-RG. The pre-configured policy shall be applied by the 5G-RG
or a W-AGF acting on behalf of the FN-RG only when the 5G-RG or a W-AGF acting
on behalf of the FN-RG has not received the same type of policy from the PCF.
The implementation of pre-configured UE policies is out of scope of this
specification.
The UE policies for V2X (V2XP) are specified in 3GPP TS 24.588 [18].
The UE policies for 5G ProSe policy (ProSeP) are specified in 3GPP TS 24.555
[18A].
## 4.2 UE route selection policy (URSP)
### 4.2.1 General
The URSP is defined in 3GPP TS 23.503 [2] and is a set of one or more URSP
rules, where a URSP rule is composed of:
a) a precedence value of the URSP rule identifying the precedence of the URSP
rule among all the existing URSP rules;
b) a traffic descriptor, including either:
1) match-all traffic descriptor; or
2) at least one of the following components:
A) one or more application identifiers;
B) one or more IP 3 tuples as defined in 3GPP TS 23.503 [2] i.e. the
destination IP address, the destination port number, and the protocol in use
above the IP;
C) one or more non-IP descriptors, i.e. destination information of non-IP
traffic;
D) one or more DNNs;
E) one or more connection capabilities; and
F) one or more domain descriptors, i.e. destination FQDN(s) or a regular
expression as a domain name matching criteria; and
c) one or more route selection descriptors each consisting of a precedence
value of the route selection descriptor and either
1) one PDU session type and, optionally, one or more of the followings:
A) SSC mode;
B) one or more S-NSSAIs. If the URSP rule is a part of a non-subscribed SNPN
signalled URSP, the S-NSSAI is of the non-subscribed SNPN otherwise the
S-NSSAI is of the HPLMN or the subscribed SNPN. Mapped HPLMN SST and mapped
HPLMN SD are not included in the S-NSSAI;
C) one or more DNNs;
D) Void;
E) preferred access type;
F) multi-access preference;
G) a time window;
H) location criteria;
I) PDU session pair ID; and
J) RSN;
2) non-seamless non-3GPP offload indication; or
3) 5G ProSe layer-3 UE-to-network relay offload indication.
Only one URSP rule in the URSP can be a default URSP rule and the default URSP
rule shall contain a match all traffic descriptor. If a default URSP rule and
one or more non-default URSP rules are included in the URSP, any non-default
URSP rule shall have lower precedence value than (i.e. shall be prioritised
over) the default URSP rule.
If a traffic descriptor lists one or more application identifiers together
with one or more connection capabilities, the UE shall consider that the
application identifiers identify the applications requesting access to the
connection capabilities.
NOTE 1: The connection capabilities requested by the applications are OS
dependent. The connection capability identifiers defined in table 5.2.1 are OS
independent. It is based on the UE implementation how the UE matches the
connection capabilities requested by the applications to the connection
capability identifiers in table 5.2.1.
NOTE 2: If the UE has multiple concurrently active OS, the traffic descriptor
can list as many multiple OS Ids.
NOTE 3: It is recommended to avoid the combination of more than two components
in the traffic descriptor.
### 4.2.2 Association between an application and a PDU session, non-seamless
non-3GPP offload or 5G ProSe layer-3 UE-to-network relay offload
#### 4.2.2.1 General
Association between an application and a PDU session, non-seamless non-3GPP
offload or 5G ProSe Layer-3 UE-to-network relay offload is described
separately for a UE and for a 5G-RG or a W-AGF acting on behalf of an FN-RG.
Clause 4.2.2.2 is not applicable for the 5G-RG or the W-AGF acting on behalf
of the FN-RG.
#### 4.2.2.2 Association between an application and a PDU session, non-
seamless non-3GPP offload or 5G ProSe layer-3 UE-to-network relay offload by a
UE
In order to send a PDU of an application, the upper layers require information
on the PDU session (e.g. PDU address) via which to send a PDU of an
application.
NOTE 0: If PAP/CHAP is used, it is recommended that the request from the upper
layers includes a DNN.
When the upper layers request information of the PDU session via which to send
a PDU of an application;
\- information on the non-3GPP access outside of a PDU session shall be
provided to the upper layers, without evaluating the URSP rules, if due to UE
local configuration non-seamless non-3GPP offload is requested; or
\- information on the 5G ProSe layer-3 UE-to-network relay shall be provided
to the upper layers, without evaluating the URSP rules, if due to UE local
configuration 5G ProSe layer-3 UE-to-network relay offload is requested;
otherwise, the UE shall proceed in the following order:
a) the UE shall evaluate the URSP rules, except the default URSP rule, with a
traffic descriptor matching the application information in increasing order of
their precedence values, if any. If the traffic descriptor contains more than
one traffic descriptor component type, each of a different type, all of them
shall be matched. If the traffic descriptor contains more than one traffic
descriptor component of the same traffic descriptor component type, at least
one of the traffic descriptor components of the same traffic descriptor
component type shall be matched with the application information. A URSP rule
is determined not to be applicable when for any given component in the traffic
descriptor no corresponding information from the application is available or
the corresponding information from the application does not match any of the
values in the traffic descriptor component as specified in clause 6.6.2.1 of
3GPP TS 23.503 [2].
If the UE finds the traffic descriptor in a non-default URSP rule matching the
application information, and:
I) if there is an established connection to non-3GPP access, an established
connection with a 5G ProSe layer-3 UE-to-network relay UE, or one or more
established PDU sessions or any combinations of these, the UE shall evaluate
the route selection descriptors of the URSP rule in increasing order as
followings:
if:
1) the route selection descriptor of the URSP rule contains a non-seamless
non-3GPP offload indication and the information on the non-3GPP access outside
of a PDU session is available;
the UE shall provide information on the non-3GPP access outside of a PDU
session to the upper layers;
1a) the route selection descriptor of the URSP rule contains a 5G ProSe
layer-3 UE-to-network relay offload indication and the information on 5G ProSe
layer-3 UE-to-network relay is available;
the UE shall provide information on the 5G ProSe layer-3 UE-to-network relay
to the upper layers; and
2) there is one or more PDU sessions:
i) for which the parameters associated with the PDU session or the parameters
requested by the UE during the PDU session establishment procedure match the
route selection descriptors of the URSP rule except the preferred access type
and the multi-access preference, if any, wherein:
\- a route selection descriptor with PDU session type IPv4v6 matches also with
PDU session type IPv4 if the network has sent 5GSM cause value #50 \"PDU
session type IPv4 only allowed\" in the PDU SESSION ESTABLISHMENT ACCEPT
message;
\- the route selection descriptor with PDU session type IPv4v6 matches also
with PDU session type IPv6 if the network has sent 5GSM cause value #51 \"PDU
session type IPv6 only allowed\" in the PDU SESSION ESTABLISHMENT ACCEPT
message;
\- the route selection descriptor with PDU session type IPv4v6 matches also
with PDU session type IPv6 or IPv4 if the UE requested the PDU session type
IPv4v6 but the selected PDU session type is set to IPv4 or IPv6 in the PDU
SESSION ESTABLISHMENT ACCEPT message; and
\- if the UE is in a non-subscribed SNPN and the URSP rule is a part of the
non-subscribed SNPN signalled URSP, or is in the HPLMN or the subscribed SNPN,
then a route selection descriptor with an S-NSSAI matches the S-NSSAI of the
PDU session, otherwise a route selection descriptor with an S-NSSAI matches
the mapped S-NSSAI of the PDU session; and
ii) established without requesting any parameter for which the matching route
selection descriptor of the URSP rule does not provide a route selection
descriptor component, except:
A) the preferred access type;
B) the multi-access preference;
C) the DNN, if no DNN is included in the route selection descriptor component
and the DNN provided by the application is the same as the DNN requested by
the UE during the PDU session establishment; and
D) the S-NSSAI, if the UE has only one S-NSSAI in the allowed NSSAI.
the UE shall provide information on the PDU session that matches the route
selection to the upper layers;
NOTE 1: It is up to the UE implementation which PDU session to select if there
exist multiple PDU sessions matching the same route selection descriptor of
the lowest precedence value.
II) otherwise:
1) the UE shall select a route selection descriptor with the next smallest
precedence value which has not yet been evaluated;
2) if:
i) the selected route selection descriptor contains a non-seamless non-3GPP
offload indication:
A) if the information on the non-3GPP access outside of a PDU session is
available, it shall be provided to the upper layers and the UE shall stop
selecting a route selection descriptor matching the application information.
B) if the information about the non-3GPP access outside of a PDU session is
not available, or non-3GPP access is not available the UE shall proceed to
step 4);
ia) the selected route selection descriptor contains a 5G ProSe layer-3 UE-to-
network relay offload indication:
A) if the information on the 5G ProSe layer-3 UE-to-network relay is available
and the UE supports acting as a 5G ProSe layer-3 remote UE as specified in
3GPP TS 24.554 [21], it shall be provided to the upper layers and the UE shall
stop selecting a route selection descriptor matching the application
information.
B) if the information about the 5G ProSe layer-3 UE-to-network relay is not
available, the UE may initiate a UE-to-network relay discovery over PC5
interface as specified in clause 8.2.1 of 3GPP TS 24.554 [21] if the UE
supports acting as a 5G ProSe layer-3 remote UE as specified in 3GPP TS 24.554
[21]. If the connection with a 5G ProSe layer-3 UE-to-network relay UE has
been successfully established, the UE shall provide information on the 5G
ProSe layer-3 UE-to-network relay to the upper layers and the UE shall stop
selecting a route selection descriptor matching the application information.
If the connection with a 5G ProSe layer-3 UE-to-network relay UE has not been
successfully established or the UE does not support acting as a 5G ProSe
layer-3 remote UE as specified in 3GPP TS 24.554 [21], the UE shall proceed to
step 4);
ii) the selected route selection descriptor includes a PDU session type or an
SSC mode which is not supported by the UE (SSC mode 2 or 3), the UE shall
proceed to step 4);
iii) the selected route selection descriptor contains a time window but the
time does not match the time window, the UE shall proceed to step 4);
iv) the selected route selection descriptor contains location criteria but the
UE location does not match the location criteria, the UE shall proceed to step
4);
v) the selected route selection descriptor includes the multi-access
preference but the UE does not support ATSSS, the UE shall proceed to step 4);
va) the selected route selection descriptor includes an SSC mode which either
has been rejected by the network with 5GSM cause value #68 \"not supported SSC
mode\" for the same DNN (or no DNN, if no DNN was indicated by the UE) and the
same S-NSSAI associated with (if available in roaming scenarios) a mapped
S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE) or was not
included in the Allowed SSC mode IE following a rejection with 5GSM cause
value #68 \"not supported SSC mode\" for the same DNN (or no DNN, if no DNN
was indicated by the UE) and the same S-NSSAI associated with (if available in
roaming scenarios) a mapped S-NSSAI (or no S-NSSAI, if no S-NSSAI was
indicated by the UE), the UE shall proceed to step 4); or
vi) the selected route selection descriptor does not contain a non-seamless
non-3GPP offload indication nor a 5G ProSe layer-3 UE-to-network relay offload
indication, the URSP handling layer requests the UE NAS layer to establish a
PDU session providing the following PDU session attributes based on the
selected route selection descriptor:
A) SSC mode if there is a SSC mode in the route selection descriptor;
NOTE 2: The SSC mode 3 is only used when the PDU session type is IPv4, IPv6 or
IPv4v6.
B) one S-NSSAI if the S-NSSAI is in the route selection descriptor; and the
S-NSSAI is in the allowed NSSAI. If none of the S-NSSAI(s) in the route
selection descriptor is in the allowed NSSAI, the UE shall proceed to step 4);
NOTE 3: If there are multiple S-NSSAIs in the route selection descriptor, an
S-NSSAI is chosen among the S-NSSAIs based on UE implementation.
C) one DNN, if the DNN is in the route selection descriptor; and if the DNN is
an LADN DNN and the UE is in the service area of that LADN;
NOTE 4: If one or more DNNs are included in the traffic descriptor and no DNN
is included in the route selection descriptor, the DNN provided by the
application is selected as one of the PDU session attributes by the URSP
handling layer to request the UE NAS layer.
NOTE 5: If there are multiple DNNs in the route selection descriptor, a DNN is
chosen based on UE implementation.
D) the PDU session type of the route selection descriptor;
E) preferred access type or multi-access preference, if the preferred access
type or the multi-access preference is in the route selection descriptor;
NOTE 6: If a preferred access type or a multi-access preference is included in
the route selection descriptor of a URSP rule, it is recommended that the UE
establishes a PDU session based on the preferred access type or the multi-
access preference.
NOTE 7: If a preferred access type is included in the route selection
descriptor of a URSP rule and the preferred access type is 3GPP access, the UE
is allowed to discover a 5G ProSe layer-2 UE-to-network relay UE as specified
in clause 8.2.1 of 3GPP TS 24.554 [21] to establish a PDU session if the UE is
configured with the corresponding ProSe policy as specified in clause 5.2.5 of
3GPP TS 24.554 [21].
NOTE 8: If a preferred access type is included in the route selection
descriptor of a URSP rule and the preferred access type is non-3GPP access,
the UE is allowed to discover a 5G ProSe layer-3 UE-to-network relay UE with
N3IWF support as specified in clause 8.2.7 of 3GPP TS 24.554 [21] to establish
a PDU session if the UE is configured with the corresponding ProSe policy as
specified in clause 5.2.5 of 3GPP TS 24.554 [21].
F) PDU session pair ID if there is a PDU session pair ID in the route
selection descriptor; and
G) RSN if there is an RSN in the route selection descriptor;
The UE NAS layer indicates the result of the PDU session establishment. Upon
successful completion of the PDU session establishment, the UE NAS layer shall
additionally indicate the attributes of the established PDU session (e.g. PDU
session identity, SSC mode, S-NSSAI, DNN, PDU session type, access type, PDU
address) to the URSP handling layer, and shall provide information (e.g. PDU
address) of the successfully established PDU session to the upper layers. The
UE shall stop selecting a route selection descriptor matching the application
information. If the PDU session establishment is unsuccessful, the UE shall
proceed to step 3);
3) Based on the rejection cause and if there is another value which can be
used for the rejected component in the same route selection descriptor, the UE
shall select another combination of values in the currently selected route
selection descriptor by using this value of the rejected component and proceed
to step 2), otherwise the UE shall proceed to step 4); and
4) if there is any route selection descriptor which has not yet been
evaluated, the UE shall proceed to step 1). If all route selection descriptors
for the matching non-default URSP rule have been evaluated and there is one or
more non-default matching URSP rule which has not yet been evaluated, the UE
shall proceed to step a). If all non-default matching URSP rules have been
evaluated, the UE shall inform the upper layers of the failure.
b) if no non-default matching URSP rule can be found and if UE local
configuration for the application is available, the UE shall perform the
association of the application to a PDU session accordingly. If no matching
PDU session exists, the UE NAS layer shall attempt to establish a PDU session
using UE local configuration.
NOTE 7: Any missing information in the UE local configuration needed to build
the PDU session establishment request can be the appropriate corresponding
component from the default URSP rule with the \"match-all\" traffic
descriptor.
NOTE 8: If a DNN was provided by the application and no DNN is included in the
UE local configuration, the DNN provided by the application is selected as one
of the PDU session attributes by the URSP handling layer to request the UE NAS
layer.
NOTE 9: If there are multiple DNNs in the UE local configuration, a DNN is
chosen based on UE implementation.
If the PDU session establishment is successful, the UE NAS layer shall provide
information (e.g. PDU address) of the successfully established PDU session to
the upper layers. Otherwise, the UE shall go to step c);
c) if no non-default matching URSP rule can be found and if either UE local
configuration for the application is not available or the PDU session
establishment based on UE local configuration for the application was
unsuccessful, the UE shall perform the association of the application to a PDU
session, to non-seamless non-3GPP offload or to 5G ProSe layer-3 UE-to-network
relay offload according to the default URSP rule with the \"match-all\"
traffic descriptor, if any. If the association is unsuccessful, the UE shall
inform the upper layers of the failure.
NOTE 10: If a DNN was provided by the application and no DNN is included in
the route selection descriptor of the default URSP rule, the DNN provided by
the application is selected as one of the PDU session attributes by the URSP
handling layer to request the UE NAS layer. If one or more DNNs are included
in the route selection descriptor of the default URSP rule, the DNN in the
route selection descriptor is selected as one of the PDU session attributes by
the URSP handling layer to request the UE NAS layer. When there are multiple
DNNs in the route selection descriptor, the DNN is selected based on UE
implementation.
The HPLMN may pre-configure the UE with URSP in the ME or in the USIM and the
subscribed SNPN(s) may pre-configure the UE with URSP in the corresponding
entry of the \"list of subscriber data\" stored in ME. The HPLMN or subscribed
SNPN may pre-configure URSP(s) in the ME for non-subscribed SNPN(s) and
associate the URSP(s) with the entry of the subscribed SNPN of the \"list of
subscriber data\" or associate the URSP(s) with the corresponding PLMN
subscription of the HPLMN. It is up to implementation how many pre-configured
URSP(s) for non-subscribed SNPN(s) per entry of the \"list of subscriber
data\" or per PLMN subscription can be stored in the ME.The HPLMN, the
subscribed SNPN(s) and the non-subscribed SNPN(s) may provide URSP to the UE
by signalling as described in annex D of 3GPP TS 24.501 [11]. The HPLMN pre-
configured URSP in the ME and the HPLMN signalled URSP shall be stored in a
non-volatile memory in the ME together with the SUPI from the USIM. The
subscribed SNPN(s) signalled URSP shall be stored per SNPN in a non-volatile
memory in the ME together with the subscriber identifier and the associated
SNPN identity of the SNPN in the \"list of subscriber data\" configured in the
ME. If the UE accepts URSP rules signalled by a non-subscribed SNPN that the
UE accesses using credentials from a credential holder (see 3GPP TS 24.501
[11] clause C.2 and D.2), the non-subscribed SNPN(s) signalled URSP shall be
stored per non-subscribed SNPN and associated with the selected entry of the
\"list of subscriber data\" or the selected PLMN subscription. It is up to
implementation how many signalled URSP(s) for non-subscribed SNPN(s) per entry
of the \"list of subscriber data\" or per PLMN subscription can be stored in
the ME. Only the subscribed SNPN(s) pre-configured URSP and the subscribed
SNPN(s) signalled URSP shall be used when the selected SNPN identity matches
the associated subscribed SNPN identity.
If the UE registered to a subscribed SNPN or a PLMN, has both pre-configured
URSP(s) and signalled URSP, the UE shall only use the signalled URSP. For a UE
not operating in SNPN access operation mode, if the UE has no signalled URSP,
the UE shall:
\- only use the pre-configured URSP rules of the HPLMN and ignore URSP rules
of other PLMN(s) in the USIM, if there are pre-configured URSP rules of the
HPLMN in the USIM; or
\- use the pre-configured URSP rules in the ME if the UE has pre-configured
URSP in the ME and:
\- only pre-configured URSP rules of PLMN(s) other than HPLMN in the USIM; or
\- no pre-configured URSP in the USIM.
When the UE is registered to a non-subscribed SNPN using credentials from a
credentials holder:
a) if the UE has the non-subscribed SNPN signalled URSP associated with the
selected entry of the \"list of subscriber data\" or the selected PLMN
subscription, or the subscribed SNPN signalled URSP when the credentials
holder is an SNPN or the HPLMN signalled URSP when the credentials holder is a
PLMN, the UE shall evaluate URSP rules, if available, in accordance with the
following order until a matching URSP rule is found:
1) the non-subscribed SNPN signalled non-default URSP rules associated with
the selected entry of the \"list of subscriber data\" or the selected PLMN
subscription stored in the ME;
2) if the credentials holder is:
\- an SNPN, the subscribed SNPN signalled non-default URSP rules stored in the
ME; or
\- a PLMN, the HPLMN signalled non-default URSP rules stored in the ME;
3) UE local configuration for the application;
4) the non-subscribed SNPN signalled default URSP rule associated with the
selected entry of the \"list of subscriber data\" or the selected PLMN
subscription stored in the ME; or
5) if the credentials holder is:
\- an SNPN, the subscribed SNPN signalled default URSP rule stored in the ME;
or
\- a PLMN, the HPLMN signalled default URSP rule stored in the ME;
NOTE X: If no matching URSP rule is found, the UE informs the upper layers of
the failure.
b) otherwise, if the UE has
\- URSP pre-configured for the non-subscribed SNPN associated with the
selected entry of the \"list of subscriber data\" or the selected PLMN
subscription;
\- URSP pre-configured for the subscribed SNPN when the credentials holder is
an SNPN or for the HPLMN when the credentials holder is a PLMN; or
\- UE local configuration for the application;
then the UE shall evaluate URSP rules, if available, in accordance with the
following order until a matching URSP rule is found:
1) the non-default URSP rules pre-configured for the non-subscribed SNPN and
associated with the selected entry of the \"list of subscriber data\" or the
selected PLMN subscription stored in the ME;
2) if the credentials holder is:
\- an SNPN, the subscribed SNPN pre-configured non-default URSP rules stored
in the ME; or
\- a PLMN:
\- the HPLMN pre-configured non-default URSP rules stored in the in USIM; or
\- the HPLMN pre-configured non-default URSP rules stored in the in ME;
3) UE local configuration for the application;
4) the default URSP rule pre-configured for the non-subscribed SNPN and
associated with the selected entry of the \"list of subscriber data\" or the
selected PLMN subscription stored in the ME; or
5) if the credentials holder is:
\- an SNPN, the subscribed SNPN pre-configured default URSP rule stored in the
ME; or
\- a PLMN:
\- the HPLMN pre-configured default URSP rule stored in the in USIM; or
\- the HPLMN pre-configured default URSP rule stored in the in ME.
NOTE Y: If no matching URSP rule is found, the UE informs the upper layers of
the failure.
The HPLMN pre-configured URSP in the ME shall be stored until a new URSP is
configured by HPLMN or the USIM is removed.
For a UE not operating in SNPN access operation mode, the signalled URSP may
be modified by the procedures defined in annex D of 3GPP TS 24.501 [11] and
shall be stored until USIM is removed. The URSP can only be used if the SUPI
from the USIM matches the SUPI stored in the non-volatile memory of the ME. If
the SUPI from the USIM does not match the SUPI stored in the non-volatile
memory of the ME, the UE shall delete the URSP.
For a UE operating in SNPN access operation mode and registered to a
subscribed SNPN, the subscribed SNPN signalled URSP may be modified by the
procedures defined in annex D of 3GPP TS 24.501 [11] and shall be stored until
the entry of the \"list of subscriber data\" with the corresponding SNPN
identity is updated or considered as \"invalid\".
For a UE operating in SNPN access operation mode and registered to a non-
subscribed SNPN, the non-subscribed SNPN signalled URSP may be modified by the
procedures defined in annex D of 3GPP TS 24.501 [11].
The UE may re-evaluate the URSP rules, to check if the change of the
association of an application to a PDU session is needed, when:
NOTE 11: The time when the UE performs the re-evaluation is up to UE
implementation. It is recommended that the UE performs the re-evaluation in a
timely manner.
a) the UE performs periodic URSP rules re-evaluation based on UE
implementation;
b) the UE NAS layer indicates that an existing PDU session used for routing
traffic of an application based on a URSP rule is released;
c) the URSP is updated by the PCF;
d) the UE NAS layer indicates that the UE performs inter-system change from S1
mode to N1 mode;
e) the UE NAS layer indicates that the UE is successfully registered in N1
mode over 3GPP access or non-3GPP access;
f) the UE establishes or releases a connection to a WLAN access and
transmission of a PDU of the application via non-3GPP access outside of a PDU
session becomes available/unavailable;
g) the allowed NSSAI or the configured NSSAI is changed; or
h) the LADN information is changed.
If the re-evaluation leads to a change of the association of an application to
a PDU session, the UE may enforce such change immediately or when UE returns
to 5GMM-IDLE mode.
NOTE 12: The time when the UE enforces the change of the association of an
application to a PDU Session is up to UE implementation. It is recommended
that the UE performs the enforcement in a timely manner.
The URSP handling layer may request the UE NAS layer to release an existing
PDU session after the re-evaluation.
#### 4.2.2.3 Association between an application and a PDU session by a 5G-RG
or a W-AGF acting on behalf of FN-RG
In order to send a PDU of an application, the upper layers require information
on the PDU session (e.g. PDU address) via which to send a PDU of an
application.
NOTE 1: If PAP/CHAP is used, it is recommended that the request from the upper
layers includes a DNN.
The 5G-RG or the W-AGF acting on behalf of the FN-RG shall proceed in the
following order:
a) the 5G-RG or the W-AGF acting on behalf of the FN-RG shall evaluate the
URSP rules, except the default URSP rule, with a traffic descriptor matching
the application information in increasing order of their precedence values, if
any. If the traffic descriptor contains more than one traffic descriptor
component type, each of a different type, all of them shall be matched. If the
traffic descriptor contains more than one traffic descriptor component of the
same traffic descriptor component type, at least one of the traffic descriptor
components of the same traffic descriptor component type shall be matched with
the application information. A URSP rule is determined not to be applicable
when for any given component in the traffic descriptor no corresponding
information from the application is available or the corresponding information
from the application does not match any of the values in the traffic
descriptor component as specified in clause 6.6.2.1 of 3GPP TS 23.503 [2].
If the 5G-RG or the W-AGF acting on behalf of the FN-RG finds the traffic
descriptor in a non-default URSP rule matching the application information,
and:
I) if there is one or more PDU sessions:
1) for which the parameters associated with the PDU session or the parameters
requested by the UE during the PDU session establishment procedure match at
least one of the route selection descriptors of the URSP rule except the
preferred access type and the multi-access preference, if any, wherein:
A) a route selection descriptor with PDU session type IPv4v6 matches also with
PDU session type IPv4 if the network has sent 5GSM cause value #50 \"PDU
session type IPv4 only allowed\" in the PDU SESSION ESTABLISHMENT ACCEPT
message;
B) a route selection descriptor with PDU session type IPv4v6 matches also with
PDU session type IPv6 if the network has sent 5GSM cause value #51 \"PDU
session type IPv6 only allowed\" in the PDU SESSION ESTABLISHMENT ACCEPT
message;
C) a route selection descriptor with PDU session type IPv4v6 matches also with
PDU session type IPv6 or IPv4 if the UE requested the PDU session type IPv4v6
but the selected PDU session type is set to IPv4 or IPv6 in the PDU SESSION
ESTABLISHMENT ACCEPT message; and
D) if the 5G-RG is in the HPLMN or the W-AGF acts on behalf of the FN-RG, then
a route selection descriptor with an S-NSSAI matches the S-NSSAI of the PDU
session, otherwise a route selection descriptor with an S-NSSAI matches the
mapped S-NSSAI of the PDU session; and
2) established without requesting any parameter, except the preferred access
type and the multi-access preference, for which the matching route selection
descriptor of the URSP rule does not provide a route selection descriptor
component,
the 5G-RG or the W-AGF acting on behalf of the FN-RG shall provide information
on the PDU session that matches the route selection descriptor of the lowest
precedence value to the upper layers;
NOTE 2: It is up to the 5G-RG or the W-AGF acting on behalf of the FN-RG
implementation which PDU session to select if there exist multiple PDU
sessions matching the same route selection descriptor of the lowest precedence
value.
II) otherwise:
1) the 5G-RG or the W-AGF acting on behalf of the FN-RG shall select a route
selection descriptor with the next smallest precedence value which has not yet
been evaluated;
2) if:
i) the selected route selection descriptor contains a non-seamless non-3GPP
offload indication, the 5G-RG or the W-AGF acting on behalf of the FN-RG shall
proceed to step 4);
ii) the selected route selection descriptor includes a PDU session type which
is not supported by the 5G-RG or the W-AGF acting on behalf of the FN-RG, the
5G-RG or the W-AGF acting on behalf of the FN-RG shall proceed to step 4);
iii) the selected route selection descriptor contains a time window but the
time does not match the time window, the 5G-RG or the W-AGF acting on behalf
of the FN-RG shall proceed to step 4);
iv) the selected route selection descriptor contains location criteria but
location of the 5G-RG or the W-AGF acting on behalf of the FN-RG does not
match the location criteria, the 5G-RG or the W-AGF acting on behalf of the
FN-RG shall proceed to step 4);
v) the selected route selection descriptor includes the multi-access
preference but the 5G-RG or the W-AGF acting on behalf of the FN-RG does not
support ATSSS, the 5G-RG or the W-AGF acting on behalf of the FN-RG shall
proceed to step 4);
va) the selected route selection descriptor includes an SSC mode which either
has been rejected by the network with 5GSM cause value #68 \"not supported SSC
mode\" for the same DNN (or no DNN, if no DNN was indicated by the 5G-RG or
the W-AGF acting on behalf of the FN-RG) and the same S-NSSAI associated with
(if available in roaming scenarios) a mapped S-NSSAI (or no S-NSSAI, if no
S-NSSAI was indicated by the 5G-RG or the W-AGF acting on behalf of the FN-RG)
or was not included in the Allowed SSC mode IE following a rejection with 5GSM
cause value #68 \"not supported SSC mode\" for the same DNN (or no DNN, if no
DNN was indicated by the 5G-RG or the W-AGF acting on behalf of the FN-RG) and
the same S-NSSAI associated with (if available in roaming scenarios) a mapped
S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the 5G-RG or the W-AGF
acting on behalf of the FN-RG), the 5G-RG or the W-AGF acting on behalf of the
FN-RG shall proceed to step 4); or
vi) the URSP handling layer requests NAS layer of the 5G-RG or the W-AGF
acting on behalf of the FN-RG to establish a PDU session providing at least
one of the following PDU session attributes:
A) SSC mode if there is a SSC mode in the route selection descriptor;
NOTE 3: The SSC mode 3 is only used when the PDU session type is IPv4, IPv6 or
IPv4v6.
B) one S-NSSAI if the S-NSSAI is in the route selection descriptor; and the
S-NSSAI is in the allowed NSSAI. If none of the S-NSSAI(s) in the route
selection descriptor is in the allowed NSSAI, the 5G-RG or the W-AGF acting on
behalf of the FN-RG shall proceed to step 4);
NOTE 4: If there are multiple S-NSSAIs in the route selection descriptor, an
S-NSSAI is chosen among the S-NSSAIs based on implementation of the 5G-RG or
the W-AGF acting on behalf of the FN-RG.
C) one DNN, if the DNN is in the route selection descriptor; and if the DNN is
an LADN DNN and the 5G-RG is in the service area of that LADN;
NOTE 5: The LADN service does not apply for either 5G-RG connected to 5GC via
wireline access or the W-AGF acting on behalf of the FN-RG.
NOTE 6: If one or more DNNs are included in the traffic descriptor of a URSP
rule and no DNN is included in the route selection descriptor, the DNN
provided by the application is selected as one of the PDU session attributes
by the URSP handling layer to request the UE NAS layer.
NOTE 7: If there are multiple DNNs in the route selection descriptor, a DNN is
chosen based on implementation of the 5G-RG or the W-AGF acting on behalf of
the FN-RG.
D) the PDU session type of the route selection descriptor;
E) preferred access type or multi-access preference, if the preferred access
type or the multi-access preference is in the route selection descriptor;
NOTE 8: If a preferred access type or a multi-access preference is included in
the route selection descriptor of a URSP rule, it is recommended that the
5G-RG or the W-AGF acting on behalf of the FN-RG establishes a PDU session
based on the preferred access type or the multi-access preference.
F) PDU session pair ID if there is a PDU session pair ID in the route
selection descriptor; and
G) RSN if there is an RSN in the route selection descriptor;
the NAS layer of the 5G-RG or the W-AGF acting on behalf of the FN-RG
indicates the result of the PDU session establishment. Upon successful
completion of the PDU session establishment, the NAS layer of the 5G-RG or the
W-AGF acting on behalf of the FN-RG shall additionally indicate the attributes
of the established PDU session (e.g. PDU session identity, SSC mode, S-NSSAI,
DNN, PDU session type, access type, PDU address) to the URSP handling layer,
and shall provide information (e.g. PDU address) of the successfully
established PDU session to the upper layers. The 5G-RG or the W-AGF acting on
behalf of the FN-RG shall stop selecting a route selection descriptor matching
the application information. If the PDU session establishment is unsuccessful,
the 5G-RG or the W-AGF acting on behalf of the FN-RG shall proceed to step 3);
3) Based on the rejection cause and if there is another value which can be
used for the rejected component in the same route selection descriptor, the
5G-RG or the W-AGF acting on behalf of the FN-RG shall select another
combination of values in the currently selected route selection descriptor by
using this value of the rejected component and proceed to step 2), otherwise
the 5G-RG or the W-AGF acting on behalf of the FN-RG shall proceed to step 4);
and
4) if there is any route selection descriptor which has not yet been
evaluated, the 5G-RG or the W-AGF acting on behalf of the FN-RG shall proceed
to step 1). If all route selection descriptors for the matching non-default
URSP rule have been evaluated and there is one or more non-default matching
URSP rule which has not yet been evaluated, the 5G-RG or the W-AGF acting on
behalf of the FN-RG shall proceed to step a). If all non-default matching URSP
rules have been evaluated, the 5G-RG or the W-AGF acting on behalf of the FN-
RG shall inform the upper layers of the failure.
b) if no non-default matching URSP rule can be found:
1) by the 5G-RG and local configuration of the 5G-RG for the application is
available, the 5G-RG shall perform the association of the application to a PDU
session accordingly. If no matching PDU session exists, the NAS layer of the
5G-RG shall attempt to establish a PDU session using local configuration of
the 5G-RG.
NOTE 9: Any missing information in local configuration of the 5G-RG needed to
build the PDU session establishment request can be the appropriate
corresponding component from the default URSP rule with the \"match-all\"
traffic descriptor.
If the PDU session establishment is successful, the NAS layer of the 5G-RG
shall provide information (e.g. PDU address) of the successfully established
PDU session to the upper layers. Otherwise, the 5G-RG shall go to step c); or
2) by the W-AGF acting on behalf of the FN-RG, the W-AGF acting on behalf of
the FN-RG shall go to step c); and
c) if no non-default matching URSP rule can be found:
1) by the 5G-RG and if either local configuration of the 5G-RG for the
application is not available or the PDU session establishment based on local
configuration of the 5G-RG for the application was unsuccessful, the 5G-RG
shall perform the association of the application to a PDU session according to
the default URSP rule with the \"match-all\" traffic descriptor, if any. If
the association is unsuccessful, the 5G-RG shall inform the upper layers of
the failure; or
2) by the W-AGF acting on behalf of the FN-RG, the W-AGF acting on behalf of
the FN-RG shall perform the association of the application to a PDU session
according to the default URSP rule with the \"match-all\" traffic descriptor,
if any. If the association is unsuccessful, and local configuration of the
W-AGF acting on behalf of the FN-RG for the application is available, the
W-AGF acting on behalf of the FN-RG shall perform the association of the
application to a PDU session accordingly. If no matching PDU session exists,
the NAS layer of the W-AGF acting on behalf of the FN-RG shall attempt to
establish a PDU session using local configuration of the W-AGF acting on
behalf of the FN-RG. If the PDU session establishment is successful, the NAS
layer of the W-AGF acting on behalf of the FN-RG shall provide information
(e.g. PDU address) of the successfully established PDU session to the upper
layers. Otherwise, the W-AGF acting on behalf of the FN-RG shall inform the
upper layers of the failure.
The HPLMN may pre-configure the 5G-RG or the W-AGF acting on behalf of the FN-
RG with URSP or may provide URSP to the 5G-RG or the W-AGF acting on behalf of
the FN-RG by signalling as described in annex D of 3GPP TS 24.501 [11]. In the
5G-RG, the pre-configured URSP and the signalled URSP shall be stored in a
non-volatile memory in the ME together with the SUPI from the USIM. If the
5G-RG or the W-AGF acting on behalf of the FN-RG has both pre-configured URSP
and signalled URSP, the 5G-RG or the W-AGF acting on behalf of the FN-RG shall
only use the signalled URSP. The pre-configured URSP shall be stored until a
new URSP is configured by HPLMN or the USIM is removed from the 5G-RG. The
signalled URSP may be modified by the procedures defined in annex D of 3GPP TS
24.501 [11] and shall be stored until USIM is removed from the 5G-RG or until
W-AGF acting on behalf of the FN-RG deregisters on behalf of the FN-RG. In the
5G-RG, the URSP can only be used if the SUPI from the USIM matches the SUPI
stored in the non-volatile memory of the ME. In the 5G-RG, if the SUPI from
the USIM does not match the SUPI stored in the non-volatile memory of the ME,
the 5G-RG shall delete the URSP.
The 5G-RG or the W-AGF acting on behalf of the FN-RG may re-evaluate the URSP
rules, to check if the change of the association of an application to a PDU
session is needed, when:
NOTE 10: The time when the 5G-RG or the W-AGF acting on behalf of the FN-RG
performs the re-evaluation is up to implementation of the 5G-RG or the W-AGF
acting on behalf of the FN-RG. It is recommended that the 5G-RG or the W-AGF
acting on behalf of the FN-RG performs the re-evaluation in a timely manner.
a) the 5G-RG or the W-AGF acting on behalf of the FN-RG performs periodic URSP
rules re-evaluation based on implementation of the 5G-RG or the W-AGF acting
on behalf of the FN-RG;
b) the NAS layer of the 5G-RG or the W-AGF acting on behalf of the FN-RG
indicates that an existing PDU session used for routing traffic of an
application based on a URSP rule is released;
c) the URSP is updated by the PCF;
d) the NAS layer of the 5G-RG indicates that the 5G-RG performs inter-system
change from S1 mode to N1 mode;
e) the NAS layer of the 5G-RG indicates that the 5G-RG is successfully
registered in N1 mode over 3GPP access;
f) the allowed NSSAI or the configured NSSAI is changed; or
g) the LADN information is changed for the 5G-RG.
If the re-evaluation leads to a change of the association of an application to
a PDU session, the 5G-RG or the W-AGF acting on behalf of the FN-RG may
enforce such change immediately or when the 5G-RG or the W-AGF acting on
behalf of the FN-RG returns to 5GMM-IDLE mode.
NOTE 11: The time when the 5G-RG or the W-AGF acting on behalf of the FN-RG
enforces the change of the association of an application to a PDU Session is
up to implementation of the 5G-RG or the W-AGF acting on behalf of the FN-RG.
It is recommended that the 5G-RG or the W-AGF acting on behalf of the FN-RG
performs the enforcement in a timely manner.
The URSP handling layer may request the NAS layer of the 5G-RG or the W-AGF
acting on behalf of the FN-RG to release an existing PDU session after the re-
evaluation.
### 4.2.3 Unknown or unexpected URSP rules
If the network provides URSP rules including any new component in the traffic
descriptor or in the route selection descriptor which is not recognized by the
UE, the 5G-RG or the W-AGF acting on behalf of an FN-RG, such URSP rules are
unknown or unexpected to the UE, the 5G-RG or the W-AGF acting on behalf of an
FN-RG. In this case:
\- if the traffic descriptor of this URSP rule includes any component which is
not recognized by the UE, the UE shall skip this URSP rule when evaluating the
URSP rules to associate an application with a PDU session, with non-seamless
non-3GPP offload or with 5G ProSe layer-3 UE-to-network relay offload;
\- if the traffic descriptor of this URSP rule includes any component which is
not recognized by the 5G-RG or the W-AGF acting on behalf of an FN-RG, the
5G-RG or the W-AGF acting on behalf of an FN-RG shall skip this URSP rule when
evaluating the URSP rules to associate an application either with a PDU
session;
\- if the route selection descriptor of this URSP rule includes any component
which is not recognized by the UE, the 5G-RG or the W-AGF acting on behalf of
an FN-RG, the UE, the 5G-RG or the W-AGF acting on behalf of an FN-RG shall
skip this route selection descriptor and handle this URSP rule with the
remaining route selection descriptors.
If the UE receives any unknown value within a known traffic descriptor or
route selection descriptor component, the value shall be still used to
identify a match with the application information, when the same unknown value
is provided by upper layers. The same handling shall be applied to operator-
specific values.
## 4.3 Access network discovery and selection policy (ANDSP)
### 4.3.1 Overview
The ANDSP is used to control the UE behaviour related to access network
discovery and selection over non-3GPP access network.
The ANDSP consists of:
\- WLAN Selection Policy (WLANSP) which is described in clause 4.3.2.; and
\- non-3GPP access network (N3AN) node configuration information which is
described in clause 4.3.3.
The 5G-RG or a W-AGF acting on behalf of the FN-RG shall ignore any ANDSP
information, if received.
### 4.3.2 WLAN selection policy (WLANSP)
#### 4.3.2.1 General
The WLANSP is used to control UE behaviour related to selection and
reselection of a WLAN.
The WLANSP consists of zero or more WLANSP rules.
Each WLANSP rule consists of:
\- rule identifier;
\- one or more groups of WLAN selection criteria;
\- validity area;
\- zero or more time of day;
\- rule priority;
\- roaming.
Each group of WLAN selection criteria contains:
\- criteria priority;
\- home network indication;
\- preferred roaming partner list;
\- min backhaul threshold;
\- maximum BSS load value;
\- required proto port tuple;
\- SP exclusion list; and
\- preferred SSID list.
The priority of a selection criteria is encoded in the criteria priority
field. The WLAN priority defined in the preferred SSID list (see figure
5.3.2.4c) represents the priority of the WLAN matching the selection criteria.
The validity of the WLANSP rule can be restricted by validity conditions. The
validity of the WLANSP rule takes into account validity area, roaming, and
time of day where each condition shall match in order to make the WLANSP rule
valid.
Each validity area consists of:
\- 3GPP location;
\- WLAN location; and
\- Geo location.
Each time of day consists of:
\- time start;
\- time stop;
\- date start;
\- date stop; and
\- day of week.
The WLANSP rule is considered valid if none of the validity conditions exist
or all validity conditions match.
There can be multiple valid WLANSP rules at the same time. In addition to
validity conditions and selection criteria, there is a rule priority that
shall be set for each WLANSP rule. The rule priority is encoded in the rule
priority field, and it enables the UE to determine which WLANSP rule, out of
potentially several valid WLANSP rules, it should consider as active. A WLANSP
rule is active if it is valid and has highest rule priority out of the valid
WLANSP rules. At any point in time, there shall be at most one active WLANSP
rule. A WLAN that matches a selection criteria of the active WLANSP rule is
considered as matching the selection criteria.
If the UE is roaming and WLANSP rules from both HPLMN and VPLMN are available,
visited WLANSP rules shall take precedence.
#### 4.3.2.2 WLAN access selection
The procedure of UE selecting WLAN access network based on WLAN selection
policy is specified in 3GPP TS 24.502 [3].
The 5G-RG and the W-AGF acting on behalf of an FN-RG shall ignore the WLAN
selection policy, if received.
### 4.3.3 N3AN node configuration information
#### 4.3.3.1 General
Non-3GPP access network (N3AN) node configuration information is used to
control UE behaviour related to selection of either N3IWF or ePDG for
accessing 5GCN or EPC respectively via non-3GPP access.
The non-3GPP access network (N3AN) node configuration information consists of:
\- Non-3GPP access network (N3AN) node selection information;
\- optionally, home ePDG identifier configuration; and
\- optionally, home N3IWF identifier configuration.
#### 4.3.3.2 N3AN node selection
The procedure of UE selecting an N3AN node based on N3AN node configuration
information is specified in 3GPP TS 24.502 [3].
## 4.4 Interworking with EPC
### 4.4.1 Precedence between URSP, ANDSP, ANDSF and RAN rules
If the UE supports both S1 mode and N1 mode:
\- the UE shall always use the ANDSP information and applicable user
preferences on non-3GPP access selection, if available at the UE, for non-3GPP
access node selection;
NOTE: This includes the case when the UE is registered to the 5GCN via 3GPP
access, the case when the UE is registered to the EPC via 3GPP access, and the
case when the UE is not registered to any CN via 3GPP access.
\- if the UE is:
a) registered to the 5GCN via 3GPP access and not registered to any CN via
non-3GPP access; or
b) registered to the 5GCN via 3GPP access and registered to the 5GCN via
non-3GPP access,
the UE shall apply URSP rules and applicable UE local configuration, if
available at the UE, to all uplink user data;
\- if the UE is registered to the 5GCN via 3GPP access and registered to the
EPC via non-3GPP access, the UE shall:
a) use the ANDSF rules and RAN rules, if available at the UE, for uplink user
data sent via the ePDG; and
b) apply URSP rules and applicable UE local configuration, if available at the
UE, to all other uplink user data;
\- if the UE is:
a) registered to the EPC via 3GPP access and not registered to any CN via
non-3GPP access; or
b) registered to the EPC via 3GPP access and registered to the EPC via
non-3GPP access,
the UE:
a) shall use the ANDSF rules and RAN rules, if available at the UE, for all
uplink user data for which there is one or more applicable ANDSF rule or RAN
rule, except for the rules and parameters related to non-3GPP access node
selection; and
b) should use the URSP rules, if available at the UE, to derive the parameters
to be used in EPS as specified in clause 4.4.2 for all uplink user data for
which there is no applicable ANDSF rule or RAN rule except for the rules and
parameters related to non-3GPP access node selection and there is no
applicable UE local configuration; and
\- if the UE is registered to the EPC via 3GPP access and registered to the
5GCN via non-3GPP access, the UE:
a) shall apply URSP rules and applicable UE local configuration, if available
at the UE, to uplink user data sent via the N3IWF;
b) shall use the ANDSF rules and RAN rules, if available at the UE, for all
other uplink user data for which there is one or more applicable ANDSF rule or
RAN rule, except for the rules and parameters related to non-3GPP access node
selection; and
c) should use the URSP rules, if available at the UE, to derive the parameters
to be used in EPS as specified in clause 4.4.2 for all uplink user data for
which there is no applicable ANDSF rule or RAN rule except for the rules and
parameters related to non-3GPP access node selection. and there is no
applicable UE local configuration
### 4.4.2 Use of URSP in EPS
If the UE:
\- supports both S1 mode and N1 mode;
\- does not have preconfigured rules for associating an application to a PDN
connection, a non-seamless non-3GPP offload or a 5G ProSe layer-3 UE-to-
network relay offload (i.e. there are no rules in UE local configuration and
no ANDSF rules applicable for the application); and
\- is provisioned with URSP,
when in S1 mode, the UE should use a matching URSP rule, if available, to
derive the parameters, e.g. APN, using the mapping between the parameters in
the URSP rules and the parameters used for PDN connection establishment
specified in table 4.4.2.1 and table 4.4.2.2. The URSP rule with the derived
EPS parameters are used for associating the application to a PDN connection,
non-seamless non-3GPP offload or a 5G ProSe layer-3 UE-to-network relay
offload, as specified in clause 4.2.2. The precedence of URSP rule is reused
in EPS.
If a route selection descriptor for the matching URSP rule includes:
\- at least one parameter not applicable in EPS, the UE shall not use the
route selection descriptor and shall proceed to evaluate the route selection
descriptor with the next lowest precedence value; and
\- one or more parameters ignored in EPS, the UE shall evaluate the route
selection descriptor without considering the one or more parameters ignored in
EPS.
Table 4.4.2.1: Mapping table for traffic descriptor parameters
Traffic descriptor parameter name Description Mapped EPS parameter description
* * *
Application descriptors It consists of OSId and OSAppId(s) OSId and OSAppId(s)
IP descriptors Destination IP 3 tuple(s) (IP address or IPv6 network prefix,
port number, protocol ID of the protocol above IP) Destination IP 3 tuple(s)
(IP address or IPv6 network prefix, port number, protocol ID of the protocol
above IP) Domain descriptors Destination FQDN(s) or a regular expression as a
domain name matching criteria Destination FQDN(s) or a regular expression as a
domain name matching criteria Non-IP descriptors Descriptor(s) for destination
information of non-IP traffic Descriptor(s) for destination information of
non-IP traffic DNN This is matched against the DNN information provided by the
application APN Connection Capabilities This is matched against the
information provided by a UE application when it requests a network connection
with certain capabilities This is matched against the information provided by
a UE application when it requests a network connection with certain
capabilities
Table 4.4.2.2: Mapping table for route selection descriptor parameters
+----------------------+----------------------+----------------------+ | Route selection | Description | Mapped EPS parameter | | descriptor parameter | | description | | name | | | +======================+======================+======================+ | Route selection | Determines the order | Determines the order | | descriptor | in which the route | in which the route | | precedence | selection | selection | | | descriptors are to | descriptors are to | | | be applied | be applied | +----------------------+----------------------+----------------------+ | SSC Mode Selection | One single value of | Ignored in EPS if | | | SSC mode | set to SSC mode 1 | | | | | | | | Not applicable in | | | | EPS if set to SSC | | | | mode 2 or 3 | +----------------------+----------------------+----------------------+ | Network Slice | Either a single | Not applicable in | | Selection | value or a list of | EPS | | | values of S-NSSAI(s) | | +----------------------+----------------------+----------------------+ | DNN Selection | Either a single | Either a single | | | value or a list of | value or a list of | | | values of DNN(s) | values of APN(s). | | | | | | | | Not applicable in | | | | EPS if it contains | | | | at least one LADN | | | | DNN | +----------------------+----------------------+----------------------+ | PDU Session Type | One single value of | PDN type: | | Selection | PDU Session Type | | | | | > \- PDU session | | | | > type | | | | > \"Unstructured\" | | | | > is mapped to PDN | | | | > type \"non-IP\". | | | | > | | | | > \- PDU session | | | | > type \"Ethernet\" | | | | > is mapped to PDN | | | | > type \"Ethernet\", | | | | > if supported by | | | | > the UE. Otherwise | | | | > PDU session type | | | | > \"Ethernet\" is | | | | > mapped to PDN type | | | | > \"non-IP\" | +----------------------+----------------------+----------------------+ | Non-Seamless Offload | Indicates if the | Indicates if the | | indication | traffic of the | traffic of the | | | matching application | matching application | | | is to be offloaded | is to be offloaded | | | to non-3GPP access | to non-3GPP access | | | outside of a PDU | outside of a PDN | | | session | connection | +----------------------+----------------------+----------------------+ | 5G ProSe layer-3 | Indicates if the | Not applicable in | | UE-to-network relay | traffic of the | EPS | | offload indication | matching application | | | | is to be offloaded | | | | to 5G ProSe layer-3 | | | | UE-to-network relay | | | | outside of a PDU | | | | session | | +----------------------+----------------------+----------------------+ | Access Type | Indicates the | preferred Access | | preference | preferred Access | Type (3GPP or | | | Type (3GPP or | non-3GPP) | | | non-3GPP) when the | | | | UE establishes a PDU | | | | Session for the | | | | matching application | | +----------------------+----------------------+----------------------+ | Multi-Access | Indicates that the | Not applicable in | | preference | PDU session should | EPS | | | be established as a | | | | multi-access PDU | | | | session, using both | | | | 3GPP access and | | | | non-3GPP access. | | +----------------------+----------------------+----------------------+ | Time window | The time window when | Not applicable in | | | the matching traffic | EPS | | | is allowed. | | +----------------------+----------------------+----------------------+ | Location criteria | The UE location | Not applicable in | | | where the matching | EPS | | | traffic is allowed. | | +----------------------+----------------------+----------------------+ | PDU session pair ID | One single value of | Ignored in EPS | | | PDU session pair ID | | | | for redundant PDU | | | | session | | | | establishment. | | +----------------------+----------------------+----------------------+ | RSN | One single value of | Ignored in EPS | | | RSN for redundant | | | | PDU session | | | | establishment. | | +----------------------+----------------------+----------------------+
# 5 Encoding of UE policies
## 5.1 Overview
The content of UE policies is included in the UE policy part contents defined
in annex D.6.2 of 3GPP TS 24.501 [11].
The UE policy part contents include URSP or ANDSP.
For URSP definition, the encoding is defined in clause 5.2.
For ANDSP definition, it includes encoding of WLANSP and encoding of N3AN node
configuration information. The encoding of WLANSP is defined in clause 5.3.2.
The encoding of N3AN node configuration information is defined in clause
5.3.3.
## 5.2 Encoding of UE policy part type URSP
The UE policy part type URSP contains one or more URSP rules which may be
included in the UE policy part contents as defined in annex D.6.2 of 3GPP TS
24.501 [11].
If the UE policy part contents includes one or more URSP rules (i.e. the UE
policy part type field is set to \"URSP\"), the UE policy part contents
including URSP rules is encoded as shown in figures 5.2.1 to 5.2.4 and table
5.2.1.
+-------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------------+-------------+---+---+---+---+---+---+---+ | URSP rule 1 | octet q+3 | | | | | | | | | | | | | | | | | | | | octet s | | | | | | | | +-------------+-------------+---+---+---+---+---+---+---+ | URSP rule 2 | octet s+1* | | | | | | | | | | | | | | | | | | | | octet t* | | | | | | | | +-------------+-------------+---+---+---+---+---+---+---+ | ... | octet t+1* | | | | | | | | | | | | | | | | | | | | octet u* | | | | | | | | +-------------+-------------+---+---+---+---+---+---+---+ | URSP rule n | octet u+1* | | | | | | | | | | | | | | | | | | | | octet r* | | | | | | | | +-------------+-------------+---+---+---+---+---+---+---+
Figure 5.2.1: UE policy part contents including one or more URSP rules
+-------------------------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------------------------------------------+-----------+---+---+---+---+---+---+---+ | Length of URSP rule | octet v | | | | | | | | | | | | | | | | | | | | octet v+1 | | | | | | | | +-------------------------------------------+-----------+---+---+---+---+---+---+---+ | Precedence value of URSP rule | octet v+2 | | | | | | | | +-------------------------------------------+-----------+---+---+---+---+---+---+---+ | Length of traffic descriptor | octet v+3 | | | | | | | | | | | | | | | | | | | | octet v+4 | | | | | | | | +-------------------------------------------+-----------+---+---+---+---+---+---+---+ | Traffic descriptor | octet v+5 | | | | | | | | | | | | | | | | | | | | octet w | | | | | | | | +-------------------------------------------+-----------+---+---+---+---+---+---+---+ | Length of route selection descriptor list | octet w+1 | | | | | | | | | | | | | | | | | | | | octet w+2 | | | | | | | | +-------------------------------------------+-----------+---+---+---+---+---+---+---+ | Route selection descriptor list | octet w+3 | | | | | | | | | | | | | | | | | | | | octet x | | | | | | | | +-------------------------------------------+-----------+---+---+---+---+---+---+---+
Figure 5.2.2: URSP rule
+------------------------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------------+-------------+---+---+---+---+---+---+---+ | Route selection descriptor 1 | octet w+3 | | | | | | | | | | | | | | | | | | | | octet y | | | | | | | | +------------------------------+-------------+---+---+---+---+---+---+---+ | Route selection descriptor 2 | octet y+1* | | | | | | | | | | | | | | | | | | | | octet z* | | | | | | | | +------------------------------+-------------+---+---+---+---+---+---+---+ | ... | octet z+1* | | | | | | | | | | | | | | | | | | | | octet a* | | | | | | | | +------------------------------+-------------+---+---+---+---+---+---+---+ | Route selection descriptor m | octet a+1* | | | | | | | | | | | | | | | | | | | | octet x* | | | | | | | | +------------------------------+-------------+---+---+---+---+---+---+---+
Figure 5.2.3: Route selection descriptor list
+------------------------------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Length of route selection descriptor | octet b | | | | | | | | | | | | | | | | | | | | octet b+1 | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Precedence value of route selection descriptor | octet b+2 | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Length of route selection descriptor contents | octet b+3 | | | | | | | | | | | | | | | | | | | | octet b+4 | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Route selection descriptor contents | octet b+5 | | | | | | | | | | | | | | | | | | | | octet c | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+
Figure 5.2.4: Route selection descriptor
Table 5.2.1: UE policy part contents including a URSP rule
Precedence value of URSP rule (octet v+2) The precedence value of URSP rule field is used to specify the precedence of the URSP rule among all URSP rules in the URSP. This field includes the binary encoded value of the precedence value in the range from 0 to 255 (decimal). The higher the value of the precedence value field, the lower the precedence of the URP rule is. Multiple URSP rules in the URSP shall not have the same precedence value. |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---  
Traffic descriptor (octets v+5 to w) The traffic descriptor field is of variable size and contains a variable number (at least one) of traffic descriptor components. Each traffic descriptor component shall be encoded as a sequence of one octet traffic descriptor component type identifier and a traffic descriptor component value field. The traffic descriptor component type identifier shall be transmitted first. |  |  |  |  |  |  |  |  |   
Traffic descriptor component type identifier Bits  
8 7 6 5 4 3 2 1 0 0 0 0 0 0 0 1 Match-all type  
0 0 0 0 1 0 0 0 OS Id + OS App Id type (NOTE 1)(NOTE 3)  
0 0 0 1 0 0 0 0 IPv4 remote address type  
0 0 1 0 0 0 0 1 IPv6 remote address/prefix length type  
0 0 1 1 0 0 0 0 Protocol identifier/next header type  
0 1 0 1 0 0 0 0 Single remote port type  
0 1 0 1 0 0 0 1 Remote port range type  
0 1 0 1 0 0 1 0 IP 3 tuple type  
0 1 1 0 0 0 0 0 Security parameter index type  
0 1 1 1 0 0 0 0 Type of service/traffic class type  
1 0 0 0 0 0 0 0 Flow label type 1 0 0 0 0 0 0 1 Destination MAC address type  
1 0 0 0 0 0 1 1 802.1Q C-TAG VID type (NOTE 4)  
1 0 0 0 0 1 0 0 802.1Q S-TAG VID type (NOTE 4)  
1 0 0 0 0 1 0 1 802.1Q C-TAG PCP/DEI type (NOTE 4)  
1 0 0 0 0 1 1 0 802.1Q S-TAG PCP/DEI type (NOTE 4)  
1 0 0 0 0 1 1 1 Ethertype type 1 0 0 0 1 0 0 0 DNN type (NOTE 3)  
1 0 0 1 0 0 0 0 Connection capabilities type (NOTE 3)  
1 0 0 1 0 0 0 1 Destination FQDN 1 0 0 1 0 0 1 0 Regular expression  
1 0 1 0 0 0 0 0 OS App Id type (NOTE 3) 1 0 1 0 0 0 0 1 Destination MAC
address range type  
All other values are spare. If received they shall be interpreted as unknown. |  |  |  |  |  |  |  |  |   
For "match-all type", the traffic descriptor component shall not include the traffic descriptor component value field. The "match-all type" traffic descriptor component shall not appear more than once among all traffic descriptors of the whole URSP rules in the URSP. If the "match-all type" traffic descriptor component is included in a traffic descriptor, there shall be no traffic descriptor component with a type other than "match-all type" in the traffic descriptor. |  |  |  |  |  |  |  |  |   
For "OS Id + OS App Id type", the traffic descriptor component value field shall be encoded as a sequence of a sixteen octet OS Id field, a one octet OS App Id length field, and an OS App Id field. The OS Id field shall be transmitted first. The OS Id field contains a Universally Unique IDentifier (UUID) as specified in IETF RFC 4122 [16]. |  |  |  |  |  |  |  |  |   
For "IPv4 remote address type", the traffic descriptor component value field shall be encoded as a sequence of a four octet IPv4 address field and a four octet IPv4 address mask field. The IPv4 address field shall be transmitted first. |  |  |  |  |  |  |  |  |   
For "IPv6 remote address/prefix length type", the traffic descriptor component value field shall be encoded as a sequence of a sixteen octet IPv6 address field and one octet prefix length field. The IPv6 address field shall be transmitted first. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
For "protocol identifier/next header type", the traffic descriptor component value field shall be encoded as one octet which specifies the IPv4 protocol identifier or IPv6 next header. |  |  |  |  |  |  |  |  |   
For "single remote port type", the traffic descriptor component value field shall be encoded as two octets which specify a port number. |  |  |  |  |  |  |  |  |   
For "remote port range type", the traffic descriptor component value field shall be encoded as a sequence of a two octet port range low limit field and a two octet port range high limit field. The port range low limit field shall be transmitted first. |  |  |  |  |  |  |  |  |   
For "IP 3 tuple type", the traffic descriptor component value field shall be encoded as a sequence of a one octet IP 3 tuple information bitmap field where: \- bit 1 set to zero indicates that the IPv4 address field is absent; \- bit 1 set to one indicates that the IPv4 address field is present; \- bit 2 set to zero indicates that the IPv6 remote address/prefix length field is absent; \- bit 2 set to one indicates that the IPv6 remote address/prefix length field is present; \- bit 3 set to zero indicates that the protocol identifier/next header field is absent; \- bit 3 set to one indicates that the protocol identifier/next header field is present; \- bit 4 set to zero indicates that the single remote port field is absent; \- bit 4 set to one indicates that the single remote port field is present; \- bit 5 set to zero indicates that the remote port range field is absent; \- bit 5 set to one indicates that the remote port range field is present; and \- bits 6,7, and 8 are spare bits; followed by a four octet IPv4 address field and a four octet IPv4 address mask field, if the IPv4 address field is present; followed by a sixteen octet IPv6 address field and one octet prefix length field, if the IPv6 remote address/prefix length field is present; followed by one octet which specifies the IPv4 protocol identifier or IPv6 next header, if the protocol identifier/next header field is present; followed by two octets which specify a port number, if the single remote port field is present; followed by a two octet port range low limit field and a two octet port range high limit field, if the remote port range field is present. The IP 3 tuple information bitmap field shall be transmitted first. The traffic descriptor component value field shall not contain both the IPv4 address field and the IPv6 remote address/prefix length field. If the traffic descriptor component value field contains both the IPv4 address field and the IPv6 remote address/prefix length field, the receiving entity shall ignore the URSP rule. The traffic descriptor component value field shall not contain both the single remote port field and the remote port range field. If the traffic descriptor component value field contains both the single remote port field and the remote port range field, the receiving entity shall ignore the URSP rule. The traffic descriptor component value field shall contain at least one of the IPv4 address field, IPv6 remote address/prefix length field, the protocol identifier/next header field, the single remote port field and the remote port range field, otherwise the receiving entity shall ignore the URSP rule. |  |  |  |  |  |  |  |  |   
For "security parameter index type", the traffic descriptor component value field shall be encoded as four octets which specify the IPsec security parameter index. |  |  |  |  |  |  |  |  |   
For "type of service/traffic class type", the traffic descriptor component value field shall be encoded as a sequence of a one octet type-of-service/traffic class field and a one octet type-of-service/traffic class mask field. The type-of-service/traffic class field shall be transmitted first. |  |  |  |  |  |  |  |  |   
For "flow label type", the traffic descriptor component value field shall be encoded as three octets which specify the IPv6 flow label. The bits 8 through 5 of the first octet shall be spare whereas the remaining 20 bits shall contain the IPv6 flow label. |  |  |  |  |  |  |  |  |   
For "destination MAC address type", the traffic descriptor component value field shall be encoded as 6 octets which specify a MAC address. |  |  |  |  |  |  |  |  |   
For "802.1Q C-TAG VID type", the traffic descriptor component value field shall be encoded as two octets which specify the VID of the customer-VLAN tag (C-TAG) as specified in IEEE Std 802.1Q-2018 [20]. The bits 8 through 5 of the first octet shall be spare whereas the remaining 12 bits shall contain the VID. |  |  |  |  |  |  |  |  |   
For "802.1Q S-TAG VID type", the traffic descriptor component value field shall be encoded as two octets which specify the VID of the service-VLAN tag (S-TAG) as specified in IEEE Std 802.1Q-2018 [20]. The bits 8 through 5 of the first octet shall be spare whereas the remaining 12 bits shall contain the VID. |  |  |  |  |  |  |  |  |   
For "802.1Q C-TAG PCP/DEI type", the traffic descriptor component value field shall be encoded as one octet which specifies the 802.1Q C-TAG PCP and DEI as specified in IEEE Std 802.1Q-2018 [20]. The bits 8 through 5 of the octet shall be spare, and the bits 4 through 2 contain the PCP and bit 1 contains the DEI. |  |  |  |  |  |  |  |  |   
For "802.1Q S-TAG PCP/DEI type", the traffic descriptor component value field shall be encoded as one octet which specifies the 802.1Q S-TAG PCP as specified in IEEE Std 802.1Q-2018 [20]. The bits 8 through 5 of the octet shall be spare, and the bits 4 through 2 contain the PCP and bit 1 contains the DEI. |  |  |  |  |  |  |  |  |   
For "ethertype type", the traffic descriptor component value field shall be encoded as two octets which specify an ethertype. |  |  |  |  |  |  |  |  |   
For "DNN type", the traffic descriptor component value field shall be encoded as a sequence of a one octet DNN length field and a DNN value field of a variable size. The DNN value contains an APN as defined in 3GPP TS 23.003 [4]. |  |  |  |  |  |  |  |  |   
For "connection capabilities" type, the traffic descriptor component value field shall be encoded as a sequence of one octet for number of network capabilities followed by one or more octets, each containing a connection capability identifier encoded as follows: |  |  |  |  |  |  |  |  |   
Bits |  |  |  |  |  |  |  |  |   
8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |  |   
0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 |  | IMS  
0 | 0 | 0 | 0 | 0 | 0 | 1 | 0 |  | MMS  
0 | 0 | 0 | 0 | 0 | 1 | 0 | 0 |  | SUPL  
0 | 0 | 0 | 0 | 1 | 0 | 0 | 0 |  | Internet  
0 | 0 | 1 | 0 | 0 | 0 | 0 | 0 |  |   
to |  | Operator specific connection capabilities |  |  |  |  |  |  |   
0 | 0 | 1 | 1 | 1 | 1 | 1 | 1 |  |   
All other values are spare. If received, they shall be interpreted as unknown. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
For "destination FQDN" type, the traffic descriptor component value field shall be encoded as a sequence of one octet destination FQDN length field and a destination FQDN value of variable size. The destination FQDN value field shall be encoded as defined in clause 28.3.2.1 in 3GPP TS 23.003 [4]. For "regular expression" type, the traffic descriptor component value field shall be encoded as a sequence of one octet regular expression length field and a regular expression value of variable size. The regular expression value field shall take the form of Extended Regular Expressions (ERE) as defined in chapter 9 in IEEE 1003.1-2004 Part 1 [19]. |  |  |  |  |  |  |  |  |   
For "OS App Id type", the traffic descriptor component value field shall be encoded as a one octet OS App Id length field and an OS App Id field. For "destination MAC address range type", the traffic descriptor component value field shall be encoded as a sequence of a 6 octet destination MAC address range low limit field and a 6 octet destination MAC address range high limit field. The destination MAC address range low limit field shall be transmitted first. |  |  |  |  |  |  |  |  |   
Precedence value of route selection descriptor (octet b+2) The precedence value of route selection descriptor field is used to specify the precedence of the route selection descriptor among all route selection descriptors in the URSP rule. This field includes the binary encoded value of the precedence value in the range from 0 to 255 (decimal). The higher the value of the precedence value field, the lower the precedence of the route selection descriptor is. |  |  |  |  |  |  |  |  |   
Route selection descriptor contents (octets b+5 to c) The route selection descriptor contents field is of variable size and contains a variable number (at least one) of route selection descriptor components. Each route selection descriptor component shall be encoded as a sequence of a one octet route selection descriptor component type identifier and a route selection descriptor component value field. The route selection descriptor component type identifier shall be transmitted first. |  |  |  |  |  |  |  |  |   
Route selection descriptor component type identifier Bits  
8 7 6 5 4 3 2 1 0 0 0 0 0 0 0 1 SSC mode type  
0 0 0 0 0 0 1 0 S-NSSAI type  
0 0 0 0 0 1 0 0 DNN type  
0 0 0 0 1 0 0 0 PDU session type type  
0 0 0 1 0 0 0 0 Preferred access type type (NOTE 2)  
0 0 0 1 0 0 0 1 Multi-access preference type (NOTE 2)  
0 0 1 0 0 0 0 0 Non-seamless non-3GPP offload indication type  
0 1 0 0 0 0 0 0 Location criteria type  
1 0 0 0 0 0 0 0 Time window type  
1 0 0 0 0 0 0 1 5G ProSe layer-3 UE-to-network relay offload indication type 1
0 0 0 0 0 1 0 PDU session pair ID type (NOTE 5) 1 0 0 0 0 0 1 1 RSN type (NOTE
5)  
All other values are spare. If received they shall be interpreted as unknown. |  |  |  |  |  |  |  |  |   
For "SSC mode type", the route selection descriptor component value field shall be encoded as a one octet SSC mode field. The bits 8 through 4 of the octet shall be spare, and the bits 3 through 1 shall be encoded as the value part of the SSC mode information element defined in clause 9.11.4.16 of 3GPP TS 24.501 [11]. The "SSC mode type" route selection descriptor component shall not appear more than once in the route selection descriptor. |  |  |  |  |  |  |  |  |   
For "S-NSSAI type", the route selection descriptor component value field shall be encoded as a sequence of a one octet S-NSSAI length field and an S-NSSAI value field of a variable size. The S-NSSAI value shall be encoded as the value part of the S-NSSAI information element defined in clause 9.11.2.8 of 3GPP TS 24.501 [11], without the mapped HPLMN SST field and without the mapped HPLMN SD field. |  |  |  |  |  |  |  |  |   
For "DNN type", the route selection descriptor component value field shall be encoded as a sequence of a one octet DNN length field and a DNN value field of a variable size. The DNN value contains an APN as defined in 3GPP TS 23.003 [4]. |  |  |  |  |  |  |  |  |   
For "PDU session type type", the route selection descriptor component value field shall be encoded as a one octet PDU session type field. The bits 8 through 4 of the octet shall be spare, and the bits 3 through 1 shall be encoded as the value part of the PDU session type information element defined in clause 9.11.4.11 of 3GPP TS 24.501 [11]. The "PDU session type type" route selection descriptor component shall not appear more than once in the route selection descriptor. |  |  |  |  |  |  |  |  |   
For "preferred access type type", the route selection descriptor component value field shall be encoded as a one octet preferred access type field. The bits 8 through 3 shall be spare, and the bits 2 and 1 shall be encoded as the value part of the access type information element defined in clause 9.11.2.1A of 3GPP TS 24.501 [11]. The "preferred access type type" route selection descriptor component shall not appear more than once in the route selection descriptor. |  |  |  |  |  |  |  |  |   
For "multi-access preference type", the route selection descriptor component value field shall be of zero length. The "multi-access preference type" route selection descriptor component shall not appear more than once in the route selection descriptor. The "multi-access preference type" route selection descriptor component in the route selection descriptor indicates the multi-access preference. |  |  |  |  |  |  |  |  |   
For "non-seamless non-3GPP offload indication type", the route selection descriptor component shall not include the route selection descriptor component value field. The "non-seamless non-3GPP offload indication type" route selection descriptor component shall not appear more than once in the route selection descriptor. If the "non-seamless non-3GPP offload indication type" route selection descriptor component is included in a route selection descriptor, there shall be no route selection descriptor component with a type other than "non-seamless non-3GPP offload indication type" in the route selection descriptor. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
For "location criteria type", the route selection descriptor component value field may contain one or more types of location area and is encoded as shown in Figure 5.2.5 and Table 5.2.2. |  |  |  |  |  |  |  |  |   
For "time window type", the route selection descriptor component value field shall be encoded as a sequence of a Starttime field and a Stoptime field. The Starttime field is represented by the number of seconds since 00:00:00 on 1 January 1970 and is encoded as the 64-bit NTP timestamp format defined in IETF RFC 5905 [17], where binary encoding of the integer part is in the first 32 bits and binary encoding of the fraction part in the last 32 bits. The encoding of the Stoptime field is the same as the Starttime field. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
For "5G ProSe layer-3 UE-to-network relay offload indication type", the route selection descriptor component shall not include the route selection descriptor component value field. The "5G ProSe layer-3 UE-to-network relay offload indication type" route selection descriptor component shall not appear more than once in the route selection descriptor. If the "5G ProSe layer-3 UE-to-network relay offload indication type" route selection descriptor component is included in a route selection descriptor, there shall be no route selection descriptor component with a type other than "5G ProSe layer-3 UE-to-network relay offload indication type" in the route selection descriptor. If "5G ProSe layer-3 UE-to-network relay offload indication type" is not present the traffic shall not be routed via a 5G ProSe layer-3 UE-to-network relay outside of a PDU Session. |  |  |  |  |  |  |  |  |   
For "PDU session pair ID type", the route selection descriptor component value field shall be encoded as a one octet PDU session pair ID field. The PDU session pair ID value shall be encoded as defined in clause 9.11.4.32 of 3GPP TS 24.501 [11]. |  |  |  |  |  |  |  |  |   
For "RSN type", the route selection descriptor component value field shall be encoded as a one octet RSN field. The RSN value shall be encoded as the value part of the RSN information element defined in clause 9.11.4.33 of 3GPP TS 24.501 [11]. |  |  |  |  |  |  |  |  |   
NOTE 1: For "OS Id + OS App Id type", the traffic descriptor component value field does not specify the OS version number or the version number of the application. NOTE 2: The PCF does not include both the "preferred access type type" and the "multi-access preference type" route selection descriptor components in a single route selection descriptor. If there are both "preferred access type type" and "multi-access preference type" route selection descriptor components in a single route selection descriptor, the UE ignores the "preferred access type type" route selection descriptor component. NOTE 3: The W-AGF acting on behalf of the FN-RG shall interpret the value as unknown. NOTE 4: The traffic descriptor of a URSP rule cannot include more than one instance of this traffic component type. NOTE 5: Redundant PDU session is not applicable over non-3GPP access. The UE ignores any route selection descriptor which includes "PDU session pair ID type" or "RSN type" route selection descriptor component and also includes a "preferred access type type" route selection descriptor component set to "non-3GPP access" or a "multi-access preference type" route selection descriptor component. |  |  |  |  |  |  |  |  |   
+-----------------------------+---------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=============================+===============+===+===+===+===+===+===+===+ | Length of location criteria | octet d | | | | | | | | | | | | | | | | | | | Location area 1 | octet e=(d+1) | | | | | | | | | | | | | | | | | | | | octet f | | | | | | | | +-----------------------------+---------------+---+---+---+---+---+---+---+ | Location area 2 | octet f+1* | | | | | | | | | | | | | | | | | | | | octet g* | | | | | | | | +-----------------------------+---------------+---+---+---+---+---+---+---+ | ... | octet g+1* | | | | | | | | | | | | | | | | | | | | octet h* | | | | | | | | +-----------------------------+---------------+---+---+---+---+---+---+---+ | Location area m | octet h+1* | | | | | | | | | | | | | | | | | | | | octet i* | | | | | | | | +-----------------------------+---------------+---+---+---+---+---+---+---+
Figure 5.2.5: Location criteria
+------------------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------+-------------+---+---+---+---+---+---+---+ | Type of location area | octet e | | | | | | | | +------------------------+-------------+---+---+---+---+---+---+---+ | Location area contents | octet e+1* | | | | | | | | | | | | | | | | | | | | octet f* | | | | | | | | +------------------------+-------------+---+---+---+---+---+---+---+
Figure 5.2.6: Location area
+----------------------------------+-----------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------------------------------+-----------------+---+---+---+---+---+---+---+ | Number of E-UTRA cell identities | octet e+1 | | | | | | | | +----------------------------------+-----------------+---+---+---+---+---+---+---+ | E-UTRA cell id 1 | octet e+2 | | | | | | | | | | | | | | | | | | | | octet e+8 | | | | | | | | +----------------------------------+-----------------+---+---+---+---+---+---+---+ | E-UTRA cell id 2 | octet e+9 | | | | | | | | | | | | | | | | | | | | octet e+15 | | | | | | | | +----------------------------------+-----------------+---+---+---+---+---+---+---+ | ... | octet e+16 | | | | | | | | | | | | | | | | | | | | octet j-1* | | | | | | | | +----------------------------------+-----------------+---+---+---+---+---+---+---+ | E-UTRA cell id n | octet j* | | | | | | | | | | | | | | | | | | | | octet f=(j+6)* | | | | | | | | +----------------------------------+-----------------+---+---+---+---+---+---+---+
Figure 5.2.7: Location area contents {Type of location area = E-UTRA cell
identities list}
+------------------------------+-----------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------------+-----------------+---+---+---+---+---+---+---+ | Number of NR cell identities | octet e+1 | | | | | | | | +------------------------------+-----------------+---+---+---+---+---+---+---+ | NR cell id 1 | octet e+2 | | | | | | | | | | | | | | | | | | | | octet e+9 | | | | | | | | +------------------------------+-----------------+---+---+---+---+---+---+---+ | NR cell id 2 | octet e+10 | | | | | | | | | | | | | | | | | | | | octet e+17 | | | | | | | | +------------------------------+-----------------+---+---+---+---+---+---+---+ | ... | octet e+18 | | | | | | | | | | | | | | | | | | | | octet k-1* | | | | | | | | +------------------------------+-----------------+---+---+---+---+---+---+---+ | NR cell id n | octet k* | | | | | | | | | | | | | | | | | | | | octet f=(k+7)* | | | | | | | | +------------------------------+-----------------+---+---+---+---+---+---+---+
Figure 5.2.8: Location area contents {Type of location area = NR cell
identities list}
+---------------------------------+-----------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---------------------------------+-----------------+---+---+---+---+---+---+---+ | Number of Global gNB identities | octet e+1 | | | | | | | | +---------------------------------+-----------------+---+---+---+---+---+---+---+ | Global gNB id 1 | octet e+2 | | | | | | | | | | | | | | | | | | | | octet e+8 | | | | | | | | +---------------------------------+-----------------+---+---+---+---+---+---+---+ | Global gNB id 2 | octet e+9 | | | | | | | | | | | | | | | | | | | | octet e+15 | | | | | | | | +---------------------------------+-----------------+---+---+---+---+---+---+---+ | ... | octet e+16 | | | | | | | | | | | | | | | | | | | | octet l-1* | | | | | | | | +---------------------------------+-----------------+---+---+---+---+---+---+---+ | Global gNB id n | octet l* | | | | | | | | | | | | | | | | | | | | octet f=(l+6)* | | | | | | | | +---------------------------------+-----------------+---+---+---+---+---+---+---+
Figure 5.2.9: Location area contents {Type of location area = Global RAN node
identities list}
Table 5.2.2: Location criteria
Length of location criteria (octect d) This field indicates the length of the included Location criteria contents. Type of location area is coded as follows. |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---  
8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |  |   
0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 |  | E-UTRA cell identities list  
0 | 0 | 0 | 0 | 0 | 0 | 1 | 0 |  | NR cell identities list  
0 | 0 | 0 | 0 | 0 | 0 | 1 | 1 |  | Global RAN node identities list  
0 | 0 | 0 | 0 | 0 | 1 | 0 | 0 |  | TAI list  
All other values are spare. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
When the type of location area is "E-UTRA cell identities list", the location area contents shall be encoded as in Figure 5.2.7. Each E-UTRA cell id field is of 7 octet size and shall be encoded as specified in clause 9.3.1.9 of 3GPP TS 38.413 [14]. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
When the type of location area is "NR cell identities list", the location area contents shall be encoded as in Figure 5.2.8. Each NR cell id field is of 8 octet size shall be encoded as specified in clause 9.3.1.7 of 3GPP TS 38.413 [14]. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
When the type of location area is "Global RAN node identities list", the location area contents shall be encoded as in Figure 5.2.8. Each Global gNB id field is of 7 octet size shall be encoded as specified in clause 9.3.1.6 of 3GPP TS 38.413 [14]. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
When the type of location area is "TAI list", the location area contents shall be encoded as the 5GS _tracking area identity list_ information element (starting with octet 2) defined in clause 9.11.3.9 of 3GPP TS 24.501 [11]. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
## 5.3 Encoding of UE policy part type ANDSP
### 5.3.1 General
The purpose of the ANDSP is to indicate the WLAN Selection Policy (WLANSP) and
non-3GPP access network (N3AN) node configuration information related to
access network discovery and selection and N3AN node selection for non-3GPP
access network.
The ANDSP is encoded as shown in figures 5.3.1.1 to 5.3.1.3 and table 5.3.1.1
according to UE policy part top level format (see Annex D of 3GPP TS 24.501
[11]).
+------------+---------+---+---+------------+---------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------+---------+---+---+------------+---------+---+---+---+ | UE policy | octet 1 | | | | | | | | | part | | | | | | | | | | contents | octet 2 | | | | | | | | | length | | | | | | | | | +------------+---------+---+---+------------+---------+---+---+---+ | 0 | 0 | 0 | 0 | UE policy | octet 3 | | | | | | | | | part | | | | | | | | | | ty | | | | | | | | | | pe={ANDSP} | | | | | +------------+---------+---+---+------------+---------+---+---+---+ | Spare | | | | | | | | | +------------+---------+---+---+------------+---------+---+---+---+ | UE policy | octet 4 | | | | | | | | | part | | | | | | | | | | conte | octet x | | | | | | | | | nts={ANDSP | | | | | | | | | | contents} | | | | | | | | | +------------+---------+---+---+------------+---------+---+---+---+
Figure 5.3.1.1: UE policy part when UE policy part type = {ANDSP}
+----------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------------+-----------+---+---+---+---+---+---+---+ | ANDSP info #1 | octet 4 | | | | | | | | | | | | | | | | | | | | octet a | | | | | | | | +----------------+-----------+---+---+---+---+---+---+---+ | ANDSP info #2 | octet a+1 | | | | | | | | | | | | | | | | | | | | octet b | | | | | | | | +----------------+-----------+---+---+---+---+---+---+---+ | ... | octet b+1 | | | | | | | | | | | | | | | | | | | | octet w | | | | | | | | +----------------+-----------+---+---+---+---+---+---+---+ | ANDSP info #n | octet w+1 | | | | | | | | | | | | | | | | | | | | octet x | | | | | | | | +----------------+-----------+---+---+---+---+---+---+---+
Figure 5.3.1.2: ANDSP contents
+-------------------------------+-----------+---+---+-----------------+---------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------------------------------+-----------+---+---+-----------------+---------+---+---+---+ | 0 | 0 | 0 | 0 | ANDSP Info type | octet k | | | | +-------------------------------+-----------+---+---+-----------------+---------+---+---+---+ | Spare | | | | | | | | | +-------------------------------+-----------+---+---+-----------------+---------+---+---+---+ | Length of ANDSP info contents | octet k+1 | | | | | | | | | | | | | | | | | | | | octet k+2 | | | | | | | | +-------------------------------+-----------+---+---+-----------------+---------+---+---+---+ | ANDSP info contents | octet k+3 | | | | | | | | | | | | | | | | | | | | octet l | | | | | | | | +-------------------------------+-----------+---+---+-----------------+---------+---+---+---+
Figure 5.3.1.3: ANDSP Info
Table 5.3.1.1: ANDSP information format
* * *
UE policy part type field is set to \'00000010\' (=ANDSP) as specified in 3GPP
TS 24.501 [4] Annex D.
UE policy part contents length field indicate the length of the ANDSP contents
in octets.  
ANDSP contents (octets 4 to x)
ANDSP contents consist of 1 or more ANDSP info (see figure 5.3.1.2).
ANDSP Info type (bit 1 to 4 of octet k) shall be set according to the
following:  
Bits  
4 3 2 1  
0 0 0 0 Reserved 0 0 0 1 WLANSP 0 0 1 0 N3AN node configuration information
All other values are reserved.
Bits 8 to 5 of octet k are spare and shall be encoded as zero.
Length of ANDSP info contents (octets k+1 to k+2) indicates the length of the
ANDSP info contents field.
ANDSP info contents (octets k+3 to l) can be WLANSP (see clause 5.3.2) or N3AN
node configuration information (see clause 5.3.3).
* * *
### 5.3.2 Encoding of WLANSP
The purpose of the WLANSP field is to indicate the rules related to selection
and reselection of a WLAN.
The WLANSP field is encoded as shown in figures 5.3.2.1 to 5.3.2.20 and table
5.3.2.1.
+------------+---------+---+---+------------+---------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------+---------+---+---+------------+---------+---+---+---+ | 0 | 0 | 0 | 0 | ANDSP Info | octet 1 | | | | | | | | | typ | | | | | | | | | | e={WLANSP} | | | | | +------------+---------+---+---+------------+---------+---+---+---+ | Spare | | | | | | | | | +------------+---------+---+---+------------+---------+---+---+---+ | Length of | octet 2 | | | | | | | | | ANDSP info | | | | | | | | | | contents | octet 3 | | | | | | | | +------------+---------+---+---+------------+---------+---+---+---+ | ANDSP info | octet 4 | | | | | | | | | conten | | | | | | | | | | ts={WLANSP | octet x | | | | | | | | | contents } | | | | | | | | | +------------+---------+---+---+------------+---------+---+---+---+
Figure 5.3.2.1: ANDSP Info = {WLANSP}
+---------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---------------+-------------+---+---+---+---+---+---+---+ | WLANSP rule 1 | octet 4 | | | | | | | | | | | | | | | | | | | | octet u | | | | | | | | +---------------+-------------+---+---+---+---+---+---+---+ | WLANSP rule 2 | octet u+1* | | | | | | | | | | | | | | | | | | | | octet v* | | | | | | | | +---------------+-------------+---+---+---+---+---+---+---+ | ... | octet v+1* | | | | | | | | | | | | | | | | | | | | octet w* | | | | | | | | +---------------+-------------+---+---+---+---+---+---+---+ | WLANSP rule n | octet w+1* | | | | | | | | | | | | | | | | | | | | octet x* | | | | | | | | +---------------+-------------+---+---+---+---+---+---+---+
Figure 5.3.2.2: WLANSP contents
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | octet | | | | | | | | | ength | 4 | | | | | | | | | of | | | | | | | | | | W | octet | | | | | | | | | LANSP | 5 | | | | | | | | | rule | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Rule | octet | | | | | | | | | ident | 6 | | | | | | | | | ifier | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Rule | octet | | | | | | | | | pri | 7 | | | | | | | | | ority | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Ro | val | 3GPP | WLAN | Geo | time | 0 | 0 | octet | | aming | idity | loc | loc | loc | of | | | 8 | | | area | ind | ind | ind | day | spare | spare | | | | ind | | | | ind | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Sele | octet | | | | | | | | | ction | 9 | | | | | | | | | cri | | | | | | | | | | teria | octet | | | | | | | | | | r | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Val | octet | | | | | | | | | idity | r+1* | | | | | | | | | area | | | | | | | | | | | octet | | | | | | | | | | s* | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Time | octet | | | | | | | | | of | s+1* | | | | | | | | | day | | | | | | | | | | | octet | | | | | | | | | | u* | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure 5.3.2.3: WLANSP rule
+--------------------------------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +--------------------------------------+-------------+---+---+---+---+---+---+---+ | Length of selection criteria | octet 9 | | | | | | | | | | | | | | | | | | | | octet 10 | | | | | | | | +--------------------------------------+-------------+---+---+---+---+---+---+---+ | number of selection criteria entries | octet 11 | | | | | | | | +--------------------------------------+-------------+---+---+---+---+---+---+---+ | Selection criteria entry 1 | octet 12 | | | | | | | | | | | | | | | | | | | | octet a | | | | | | | | +--------------------------------------+-------------+---+---+---+---+---+---+---+ | Selection criteria entry 2 | octet a+1* | | | | | | | | | | | | | | | | | | | | octet b* | | | | | | | | +--------------------------------------+-------------+---+---+---+---+---+---+---+ | ... | octet b+1* | | | | | | | | | | | | | | | | | | | | octet c* | | | | | | | | +--------------------------------------+-------------+---+---+---+---+---+---+---+ | Selection criteria entry n | octet c+1* | | | | | | | | | | | | | | | | | | | | octet r* | | | | | | | | +--------------------------------------+-------------+---+---+---+---+---+---+---+
Figure 5.3.2.4: Selection criteria
+----------+----------+----------+----------+----------+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------+----------+----------+----------+----------+---+---+---+---+ | Length | octet 12 | | | | | | | | | of | | | | | | | | | | s | octet 13 | | | | | | | | | election | | | | | | | | | | criteria | | | | | | | | | | entry | | | | | | | | | +----------+----------+----------+----------+----------+---+---+---+---+ | Spare | Ma | Home | Criteria | octet 14 | | | | | | | xBSSload | network | priority | | | | | | | | ind | ind | | | | | | | +----------+----------+----------+----------+----------+---+---+---+---+ | Maximum | octet 15 | | | | | | | | | BSS load | | | | | | | | | | value | octet 16 | | | | | | | | +----------+----------+----------+----------+----------+---+---+---+---+ | S | octet 17 | | | | | | | | | election | | | | | | | | | | criteria | octet | | | | | | | | | set 1 | t* | | | | | | | | +----------+----------+----------+----------+----------+---+---+---+---+ | ... | octet | | | | | | | | | | t+1* | | | | | | | | | | | | | | | | | | | | octet | | | | | | | | | | y* | | | | | | | | +----------+----------+----------+----------+----------+---+---+---+---+ | S | octet | | | | | | | | | election | y+1* | | | | | | | | | criteria | | | | | | | | | | set n (n | octet | | | | | | | | | \/Policy/MaximumBSSLoadValue | | | | defined in Hotspot 2.0 | | | | (Release 2) Technical | | | | Specification [9]. | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | Selection criteria set | | | | (octets 17 to dd) contains | | | | the contents of a specific | | | | criteria set. In this release | | | | of specification there can be | | | | 5 types of criteria sets. | | | | | | | | Selection criteria set type | | | | (bits 5-8 of octet 19) is | | | | coded as follows. | | | | | | | | Bits | | | | | | | | **8 7 6 5** | | | | | | | | 0 0 0 1 preferred SSID list | | | | (NOTE 4) | | | | | | | | 0 0 1 0 preferred roaming | | | | partner list (NOTE 5) | | | | | | | | 0 0 1 1 required protocol | | | | port tuple | | | | | | | | 0 1 0 0 SP exclusion list | | | | | | | | 0 1 0 1 minimum backhaul | | | | threshold | | | | | | | | All other values are | | | | reserved. | | | +-------------------------------+---+-------------------------------+ | Selection criteria sub entry | | | | (octets 20 to ee+6) when set | | | | type is \"_preferred SSID | | | | list_ \" is coded as follows. | | | | | | | | Length of sub entry (octet | | | | 20) indicates length of | | | | subsequent fields in the | | | | selection criteria sub entry. | | | | | | | | WLAN priority (octet 21): the | | | | lower WLAN priority value | | | | indicates the WLAN having the | | | | higher priority among the | | | | WLANs in the preferred SSID | | | | list. | | | | | | | | SSID ind (bit 1 of octet 22): | | | | | | | | Bit | | | | | | | | **5** | | | | | | | | 0 SSID field (octets 24 to | | | | ee) is not present. | | | | | | | | 1 SSID field (octets 24 to | | | | ee) is present. | | | | | | | | HESSID ind (bit 2 of octet | | | | 22): | | | | | | | | Bit | | | | | | | | **6** | | | | | | | | 0 HESSID field (octets ee+1 | | | | to ee+6) is not present. | | | | | | | | 1 HESSID field (octet ee+1 to | | | | ee+6) is present. | | | | | | | | SSID length (octet 23) | | | | indicates the length of the | | | | SSID field. | | | | | | | | SSID field (octets 24 to ee) | | | | is an Octet String which | | | | shall have a maximum length | | | | of 32 octets (see IEEE Std | | | | 802.11 [8]). | | | | | | | | HESSID field (octets ee+1 to | | | | ee+6) is a 6 octet MAC | | | | address that identifies the | | | | homogeneous ESS (see IEEE Std | | | | 802.11 [8]). | | | +-------------------------------+---+-------------------------------+ | Selection criteria sub entry | | | | (octets 20 to ff) when set | | | | type is \"_preferred roaming | | | | partner list_ \" is coded as | | | | follows. | | | | | | | | Length of sub entry (octet | | | | 20) indicates length of | | | | subsequent fields in the | | | | selection criteria sub entry. | | | | | | | | Priority (octet 21): the | | | | lower priority value | | | | indicates the higher priority | | | | in the preferred roaming | | | | partner list. | | | | | | | | FQDN_Match length (octet 22) | | | | indicates the length of the | | | | FQDN_Match field. | | | | | | | | FQDN_Match field (octets 23 | | | | to ee) is as the node | | | | PerProviderSubscription/\/Policy/PreferredRoamingP | | | | artnerList/\/FQDN_Match | | | | defined in Hotspot 2.0 | | | | (Release 2) Technical | | | | Specification [9]. | | | | | | | | Country length (octet ee+1) | | | | indicates the length of the | | | | country field. | | | | | | | | Country field (octets ee+2 to | | | | ff) is as the node | | | | PerProviderSubscriptio | | | | n/\/Policy/PreferredRoam | | | | ingPartnerList/\/Country | | | | defined in Hotspot 2.0 | | | | (Release 2) Technical | | | | Specification [9]. | | | | | | | | Selection criteria sub entry | | | | (octets 20 to ff) when set | | | | type is \"_required protocol | | | | port tuple_ \" is coded as | | | | follows. | | | | | | | | Length of sub entry (octet | | | | 20) indicates length of | | | | subsequent fields in the | | | | selection criteria sub entry. | | | | | | | | IP protocol field (octet 21) | | | | shall be present in the sub | | | | entry and refers to IP | | | | protocol field in IPv4 | | | | packets or the next header | | | | field in IPv6 packets. It is | | | | required by | | | | operator-supported | | | | application(s) on UE as | | | | specified in Hotspot 2.0 | | | | (Release 2) Technical | | | | Specification [9]. | | | | | | | | Length of port number (octet | | | | 22) indicates the length of | | | | port number field. | | | | | | | | Port number field (octets 23 | | | | to ff) is as the node | | | | PerProviderSubscript | | | | ion/\/Policy/RequiredPro | | | | toPortTuple/\/PortNumber | | | | defined in Hotspot 2.0 | | | | (Release 2) Technical | | | | Specification [9]. | | | +-------------------------------+---+-------------------------------+ | Selection criteria sub entry | | | | (octets 20 to ff) when set | | | | type is \"_SP exclusion | | | | list_ \" is coded as follows. | | | | | | | | Length of sub entry (octet | | | | 20) indicates length of | | | | subsequent fields in the | | | | selection criteria sub entry, | | | | i.e. the length of SSID | | | | field. | | | | | | | | SSID field (octets 21 to ff) | | | | is as the node | | | | PerPro | | | | viderSubscription/\/Poli | | | | cy/SPExclusionList/\SSID | | | | defined in Hotspot 2.0 | | | | (Release 2) Technical | | | | Specification [9]. | | | +-------------------------------+---+-------------------------------+ | Selection criteria sub entry | | | | (octets 20 to 28) when set | | | | type is \"_minmum backhaul | | | | threshold_ \" is coded as | | | | follows. | | | | | | | | Network type (bit 1-2 of | | | | octet 20) is coded as follows | | | | according to the definition | | | | of the node | | | | PerProviderSubscrip | | | | tion/\/Policy/MinBackhau | | | | lThreshold/\/NetworkType | | | | in Hotspot 2.0 (Release 2) | | | | Technical | | | | Specification [9]. | | | | | | | | Bits | | | | | | | | **2 1** | | | | | | | | 0 0 home | | | | | | | | 0 1 roaming | | | | | | | | All other values are | | | | reserved. | | | | | | | | DLBI (bit 3 of octet 20): | | | | | | | | Bit | | | | | | | | **3** | | | | | | | | 0 Downlink bandwidth field | | | | (octets 21 to 24) is not | | | | present. | | | | | | | | 1 Downlink bandwidth field | | | | (octets 21 to 24) is present. | | | | | | | | ULBI (bit 4 of octet 20): | | | | | | | | Bit | | | | | | | | **4** | | | | | | | | 0 Uplink bandwidth field | | | | (octets 25 to 28) is not | | | | present. | | | | | | | | 1 Uplink bandwidth field | | | | (octets 25 to 28) is present. | | | +-------------------------------+---+-------------------------------+ | Downlink bandwidth field | | | | (octets 21 to 24) is as the | | | | node | | | | PerProviderSubscrip | | | | tion/\/Policy/MinBackhau | | | | lThreshold/\/DLBandwidth | | | | defined in Hotspot 2.0 | | | | (Release 2) Technical | | | | Specification [9]. | | | | | | | | Uplink bandwidth field | | | | (octets 25 to 28) is as the | | | | node | | | | PerProviderSubscrip | | | | tion/\/Policy/MinBackhau | | | | lThreshold/\/ULBandwidth | | | | defined in Hotspot 2.0 | | | | (Release 2) Technical | | | | Specification [9]. | | | +-------------------------------+---+-------------------------------+ | Validity area (octets r+1 to | | | | s) | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | This field contains the | | | | binary encoding of the | | | | validity area for a | | | | particular WLANSP rule. | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | Entry type (bits 7-8 of octet | | | | r+6) is coded as follows: | | | | | | | | Bits | | | | | | | | **8 7** | | | | | | | | 0 1 3GPP location\ | | | | 1 0 WLAN location\ | | | | 1 1 Geo location\ | | | | All other values are | | | | reserved. | | | +-------------------------------+---+-------------------------------+ | Length of 3GPP location sub | | | | entry (octets r+7 to r+8) | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | This field contains the | | | | length of the location entry | | | | when the WLANSP rule is for | | | | validity area of a 3GPP | | | | location. | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | MCC, Mobile country code | | | | (octet r+9, and bits 4 to 1 | | | | of octet r+10) | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | The MCC field is coded as in | | | | ITU-T | | | | Recommendation E.212 [10], | | | | annex A. | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | MNC, Mobile network code | | | | (bits 8 to 5 of octet r+10, | | | | and octet r+11) | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | The encoding of this field is | | | | the responsibility of each | | | | administration but BCD | | | | encoding shall be used. The | | | | MNC shall consist of 2 or 3 | | | | digits. If a network operator | | | | may decide to use only two | | | | digits in the MNC over the | | | | radio interface, MNC digit 3 | | | | shall be encoded as \"1111\". | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | When the location entry type | | | | is \"geo location\", the | | | | location field in this entry | | | | has fixed length as shown in | | | | figure 5.3.2.11a. | | | | | | | | Anchor latitude (octets r+10 | | | | to r+13) is defined in | | | | clause 6.1 of | | | | 3GPP TS 23.032 [7]. | | | | | | | | Anchor longitude (octets r+14 | | | | to r+17) is defined in | | | | clause 6.1 of | | | | 3GPP TS 23.032 [7]. | | | | | | | | Radius (octets r+18 to r+19) | | | | is given in meters and is | | | | defined in clause 6.6 of | | | | 3GPP TS 23.032 [7]. | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | Location field type (octet | | | | r+14) when entry type is 3GPP | | | | location, or | | | | | | | | Location field type (octet | | | | r+11) when entry type is WLAN | | | | location. | | | | | | | | This field indicates the type | | | | of location field. | | | | | | | | Bits\ | | | | 8 7 6 5 4 3 2 1 | | | | | | | | 0 0 0 0 0 0 0 1 TAC\ | | | | 0 0 0 0 0 0 1 0 EUTRA CI\ | | | | 0 0 0 0 0 1 0 0 NR CI\ | | | | 1 0 0 0 0 0 0 1 HESSID\ | | | | 1 0 0 0 0 0 1 0 SSID\ | | | | 1 0 0 0 0 1 0 0 BSSID\ | | | | All other values are | | | | reserved. | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | When 3GPP location field type | | | | is set to \"TAC\", the TAC | | | | field is as defined in | | | | 3GPP TS 23.003 [4]. | | | | | | | | When 3GPP location field type | | | | is set to \"EUTRA CI\", the | | | | EUTRA CI field is set to the | | | | cell identity part of the | | | | Evolved Cell Global | | | | Identifier, as described in | | | | 3GPP TS 36.331 [6]. | | | | | | | | When 3GPP location field type | | | | is set to \"NR CI\", the NR | | | | CI field is set to the NR | | | | cell identity part of the NR | | | | Cell Global Identifier as | | | | defined in | | | | 3GPP TS 38.413 [14]. | | | | | | | | When WLAN location field type | | | | is set to \"HESSID\", the | | | | HESSID field is set to a 6 | | | | octet MAC address that | | | | identifies the homogeneous | | | | ESS (see IEEE Std | | | | 802.11 [8]). | | | | | | | | When WLAN location field type | | | | is set to \"SSID\", the SSID | | | | field is set to an Octet | | | | String which shall have a | | | | maximum length of 32 octets | | | | (see IEEE Std 802.11 [8]). | | | | | | | | When WLAN location field type | | | | is set to \"BSSID\", the | | | | BSSID field is set to an | | | | Octet String which shall be 6 | | | | octets long (see IEEE Std | | | | 802.11 [8]). | | | +-------------------------------+---+-------------------------------+ | Time of day (octets s+1 to u) | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | This field contains the | | | | binary encoding of the time | | | | of day condition for a | | | | particular WLANSP rule. | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | ToD sub field type ={time | | | | start, time stop, date start, | | | | date stop, day of week} | | | | (octet s+8) | | | | | | | | Bits\ | | | | 8 7 6 5 4 3 2 1 | | | | | | | | 0 0 0 0 0 0 0 1 time start\ | | | | 0 0 0 0 0 0 1 0 time stop\ | | | | 0 0 0 0 0 1 0 0 date start\ | | | | 0 0 0 0 1 0 0 0 date stop\ | | | | 0 0 0 1 0 0 0 0 day of the | | | | week | | | | | | | | All other values are | | | | reserved. | | | | | | | | when field type is set to | | | | \"time start\" or \"time | | | | stop\", the value of this ToD | | | | sub field contents is time of | | | | the day represented in string | | | | format, as defined in | | | | ISO 8601:2004 [13] | | | | | | | | When field type is set to | | | | \"date start\" or \"date | | | | stop\", the value of this ToD | | | | sub field contents is a date | | | | represented in string format, | | | | as defined in | | | | ISO 8601:2004 [13]. | | | | | | | | When field type is set to | | | | \"day of the week\", the | | | | value of this ToD sub field | | | | contents is an 8-bit integer | | | | formatted as a bitmap | | | | representing days of the | | | | week. The most significant | | | | bit is set to one. The | | | | remaining bits represent days | | | | of the week. | | | +-------------------------------+---+-------------------------------+ | | | | +-------------------------------+---+-------------------------------+ | NOTE 1: The value of roaming | | | | is valid only if the WLANSP | | | | rule is provided by the | | | | H-PCF. | | | | | | | | NOTE 2: The group of | | | | selection criteria as | | | | described in clause 4.3.2.1 | | | | is encoded as selection | | | | criteria entry. | | | | | | | | NOTE 3: The home network | | | | indication shall not be set | | | | by V-PCF. | | | | | | | | NOTE 4: If the home network | | | | indication bit is set to | | | | \"1\", the preferred SSID | | | | list shall not be present. | | | | | | | | NOTE 5: If the home network | | | | indication bit is set to | | | | \"1\", the preferred roaming | | | | partner list shall not be | | | | present. The preferred | | | | roaming partner list is | | | | provided by H-PCF only. | | | +-------------------------------+---+-------------------------------+
### 5.3.3 Encoding of N3AN node configuration information
#### 5.3.3.1 General
The purpose of the N3AN node configuration information is to indicate the
non-3GPP access network (N3AN) node configuration information to the UE for
selection of either N3IWF or ePDG for accessing 5GCN or EPC respectively via
non-3GPP access.
The N3AN node configuration information is encoded as shown in figure
5.3.3.1.1, table 5.3.3.1.1, figure 5.3.3.1.2, table 5.3.3.1.2.
+------------+-----------+---+---+------------+---------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------+-----------+---+---+------------+---------+---+---+---+ | 0 | 0 | 0 | 0 | ANDSP Info | octet x | | | | | | | | | ty | | | | | | | | | | pe={N3AN-n | | | | | | | | | | ode-config | | | | | | | | | | uration-in | | | | | | | | | | formation} | | | | | +------------+-----------+---+---+------------+---------+---+---+---+ | Spare | | | | | | | | | +------------+-----------+---+---+------------+---------+---+---+---+ | Length of | octet x+1 | | | | | | | | | ANDSP info | | | | | | | | | | contents | octet x+2 | | | | | | | | +------------+-----------+---+---+------------+---------+---+---+---+ | ANDSP info | octet x+3 | | | | | | | | | cont | | | | | | | | | | ents={N3AN | octet z | | | | | | | | | node | | | | | | | | | | con | | | | | | | | | | figuration | | | | | | | | | | i | | | | | | | | | | nformation | | | | | | | | | | contents} | | | | | | | | | +------------+-----------+---+---+------------+---------+---+---+---+
Figure 5.3.3.1.1: ANDSP info containing N3AN node configuration information,
where x=k
Table 5.3.3.1.1: N3AN node configuration information
* * *
ANDSP Info type (bit 1 to 4 of octet x) shall be set to \"0010\" (N3AN node
configuration information) Bits 8 to 5 of octet x are spare and shall be
encoded as zero. Length of ANDSP info contents (octets x+1 to x+2) indicates
the length of the N3AN node configuration information contents.
* * *
+------------------------------------------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------------------------------+-------------+---+---+---+---+---+---+---+ | Length of N3AN node selection information | octet x+3 | | | | | | | | | | | | | | | | | | | | octet x+4 | | | | | | | | +------------------------------------------------+-------------+---+---+---+---+---+---+---+ | Content of N3AN node selection information | octet x+5 | | | | | | | | | | | | | | | | | | | | octet v | | | | | | | | +------------------------------------------------+-------------+---+---+---+---+---+---+---+ | N3AN node configuration information type | octet v+1* | | | | | | | | | | | | | | | | | | | (type = home N3IWF identifier configuration) | | | | | | | | | +------------------------------------------------+-------------+---+---+---+---+---+---+---+ | Length of home N3IWF identifier configuration | octet v+2* | | | | | | | | | | | | | | | | | | | | octet v+3* | | | | | | | | +------------------------------------------------+-------------+---+---+---+---+---+---+---+ | Content of home N3IWF identifier configuration | octet v+4* | | | | | | | | | | | | | | | | | | | | octet w* | | | | | | | | +------------------------------------------------+-------------+---+---+---+---+---+---+---+ | N3AN node configuration information type | octet w+1* | | | | | | | | | | | | | | | | | | | (type = home ePDG identifier configuration) | | | | | | | | | +------------------------------------------------+-------------+---+---+---+---+---+---+---+ | Length of home ePDG identifier configuration | octet w+2* | | | | | | | | | | | | | | | | | | | | octet w+3* | | | | | | | | +------------------------------------------------+-------------+---+---+---+---+---+---+---+ | Content of home ePDG identifier configuration | octet w+4* | | | | | | | | | | | | | | | | | | | | octet z* | | | | | | | | +------------------------------------------------+-------------+---+---+---+---+---+---+---+
Figure 5.3.3.1.2: N3AN node configuration information contents
Table 5.3.3.1.2: Content of N3AN node configuration information
N3AN node configuration information type is coded as follows.
* * *
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 1 Home N3IWF identifier configuration 0 0 0 0 0 0 1 0 Home ePDG
identifier configuration All other values are reserved.
N3AN node selection information field (octet x+5 to v) shall be present and
the content is as encoded in clause 5.3.3.2.
Home N3IWF identifier configuration field (octet v+1 to w) may be present and
the content is as encoded in clause 5.3.3.3.
Home ePDG identifier configuration field (octet w+1 to z) may be present and
the content is is as encoded in clause 5.3.3.4.
#### 5.3.3.2 N3AN node selection information
The content of N3AN node selection information contains a sequence of the N3AN
node selection information entries. Each N3AN node selection information entry
contains a PLMN ID and information for the PLMN ID. The content of N3AN node
selection information contains at least an N3AN node selection information
entry with information for the HPLMN and an N3AN node selection information
entry for \"any_PLMN\".
NOTE: If N3AN node selection information does not contain at least:
\- an N3AN node selection information entry with information for the HPLMN;
and
\- an N3AN node selection information entry for \"any_PLMN\";
the N3AN node selection information is handled as a syntactically incorrect IE
according to 3GPP TS 24.501 [11].
The content is encoded according to figure 5.3.3.2.1, figure 5.3.3.2.2 and
table 5.3.3.2.1.
+-----------------------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-----------------------------------------+-----------+---+---+---+---+---+---+---+ | N3AN node selection information entry 1 | octet x+5 | | | | | | | | +-----------------------------------------+-----------+---+---+---+---+---+---+---+ | | octet y | | | | | | | | +-----------------------------------------+-----------+---+---+---+---+---+---+---+ | N3AN node selection information entry 2 | octet y+1 | | | | | | | | | | | | | | | | | | | | octet t | | | | | | | | +-----------------------------------------+-----------+---+---+---+---+---+---+---+ | ... | | | | | | | | | +-----------------------------------------+-----------+---+---+---+---+---+---+---+ | N3AN node selection information entry n | octet u | | | | | | | | | | | | | | | | | | | | octet v | | | | | | | | +-----------------------------------------+-----------+---+---+---+---+---+---+---+
Figure 5.3.3.2.1: Content of N3AN node selection information
* * *
8 7 6 5 4 3 2 1  
Length of N3AN node selection information entry octet x+5  
MCC digit 2 MCC digit 1 octet x+6  
MNC digit 3 MCC digit 3 octet x+7  
MNC digit 2 MNC digit 1 octet x+8  
FQDN format Preference Priority octet x+9
* * *
Figure 5.3.3.2.2: N3AN node selection information entry
Table 5.3.3.2.1: N3AN node selection information
Length of N3AN node selection information entry (octet x+5) contains length of
subsequent fields in the N3AN node selection information entry.
* * *
PLMN ID (octet x+6 to x+8) field shall be set to zero if it indicates
\"any_PLMN\". Otherwise,
MCC, Mobile country code (octet x+6, and bits 4 to 1 of octet x+7)  
The MCC field is encoded as in ITU-T Recommendation E.212 [10], annex A.
MNC, Mobile network code (bits 8 to 5 of octet x+7, and octet x+8)  
The encoding of this field is the responsibility of each administration but
BCD coding shall be used. The MNC shall consist of 2 or 3 digits. If a network
operator decides to use only two digits in the MNC, MNC digit 3 shall be
encoded as \"1111\".
Priority (bits 5 to 1 of octet x+9) indicates the preference order given to
N3AN nodes of a PLMN. The lower value indicates higher priority. If the PLMN
is the UE\'s HPLMN or the PLMN ID indicates \"any_PLMN\", this priority filed
shall be ignored.
Preference (bit 6 of octet x+9) indicates which N3AN node type is preferred in
this PLMN and is encoded as follows.  
**6**  
0 N3IWF is preferred  
1 ePDG is preferred
FQDN format (bits 8 to 7 of octet x+9) indicates format to be used when the
FQDN is constructed by the UE. This field is encoded as follows.  
**8** **7**  
0 0 Operator identifier based ePDG FQDN format or operator identifier based
N3IWF FQDN.
0 1 Tracking/location area identity based ePDG FQDN format or tracking area
identity based N3IWF FQDN format. All other values are reserved.
#### 5.3.3.3 Home N3IWF identifier configuration
The content of home N3IWF identifier configuration contains a list of home
N3IWF identifier entries.
The content of home N3IWF identifier configuration is encoded according to
figure 5.3.3.3.1.
The content of each home N3IWF identifier entry is coded according to figure
5.3.3.3.2, table 5.3.3.3.1, figure 5.3.3.3.3 and table 5.3.3.3.2.
+-------------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------------------------------+-----------+---+---+---+---+---+---+---+ | Home N3IWF identifier entry 1 | octet v+4 | | | | | | | | +-------------------------------+-----------+---+---+---+---+---+---+---+ | | octet u | | | | | | | | +-------------------------------+-----------+---+---+---+---+---+---+---+ | Home N3IWF identifier entry 2 | octet u+1 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +-------------------------------+-----------+---+---+---+---+---+---+---+ | ... | | | | | | | | | +-------------------------------+-----------+---+---+---+---+---+---+---+ | Home N3IWF identifier entry n | octet w | | | | | | | | +-------------------------------+-----------+---+---+---+---+---+---+---+
Figure 5.3.3.3.1: Content of home N3IWF identifier configuration
+------------------------------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------------------------------+---------+---+---+---+---+---+---+---+ | Home N3IWF identifier type (= IP address type) | octet 1 | | | | | | | | +------------------------------------------------+---------+---+---+---+---+---+---+---+ | Home N3IWF IP addresses | octet 2 | | | | | | | | | | | | | | | | | | | | octet z | | | | | | | | +------------------------------------------------+---------+---+---+---+---+---+---+---+
Figure 5.3.3.3.2: Home N3IWF identifier entry (type = IP address type)
Table 5.3.3.3.1: Home N3IWF identifier entry (type = IP address type)
Home N3IWF identifier type (octet 1) is set as follows when the type is IP
address.
* * *
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 1 IPv4 0 0 0 0 0 0 1 0 IPv6 0 0 0 0 0 0 1 1 IPv4IPv6
If the home N3IWF identifier type indicates IPv4, then the home N3IWF IP
addresses field contains an IPv4 address in octet 2 to octet 5.
If the home N3IWF identifier type indicates IPv6, then the home N3IWF IP
addresses field contains an IPv6 address in octet 2 to octet 17.
If the home N3IWF identifier type indicates IPv4IPv6, then the home N3IWF IP
addresses field contains two IP addresses. The first IP address is an IPv4
address in octet 2 to octet 5. The second IP address is an IPv6 address in
octet 6 to octet 21.
+-------------------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------------------------------------+---------+---+---+---+---+---+---+---+ | Home N3IWF identifier type (= FQDN) | octet 1 | | | | | | | | +-------------------------------------+---------+---+---+---+---+---+---+---+ | Length of home N3IWF FQDN | octet 2 | | | | | | | | +-------------------------------------+---------+---+---+---+---+---+---+---+ | Home N3IWF FQDN | octet 3 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +-------------------------------------+---------+---+---+---+---+---+---+---+
Figure 5.3.3.3.3: Home N3IWF identifier entry (type = FQDN)
Table 5.3.3.3.2: Home N3IWF identifier entry (type = FQDN)
Home N3IWF identifier type (octet 1) is set as follows when the type is FQDN.
* * *
8 7 6 5 4 3 2 1  
0 0 0 0 0 1 0 0 FQDN
Length of home N3IWF FQDN field (octet 2) indicates the length of home N3IWF
FQDN.
Home N3IWF FQDN field (octet 3 to octet m) is encoded as defined in clause
28.3.2.2.2 in 3GPP TS 23.003 [4].
#### 5.3.3.4 Home ePDG identifier configuration
The content of home ePDG identifier configuration contains a list of home ePDG
identifier entries.
The content of home ePDG identifier configuration is encoded according to
figure 5.3.3.4.1.
The content of each home ePDG identifier entry is encoded according to figure
5.3.3.4.2, table 5.3.3.4.1, figure 5.3.3.4.3 and table 5.3.3.4.2.
+------------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------------+-----------+---+---+---+---+---+---+---+ | Home ePDG identifier entry 1 | octet w+4 | | | | | | | | +------------------------------+-----------+---+---+---+---+---+---+---+ | | octet u | | | | | | | | +------------------------------+-----------+---+---+---+---+---+---+---+ | Home ePDG identifier entry 2 | octet u+1 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +------------------------------+-----------+---+---+---+---+---+---+---+ | ... | | | | | | | | | +------------------------------+-----------+---+---+---+---+---+---+---+ | Home ePDG identifier entry n | octet p | | | | | | | | +------------------------------+-----------+---+---+---+---+---+---+---+
Figure 5.3.3.4.1: Content of home ePDG identifier configuration
+-----------------------------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-----------------------------------------------+---------+---+---+---+---+---+---+---+ | Home ePDG identifier type (= IP address type) | octet 1 | | | | | | | | +-----------------------------------------------+---------+---+---+---+---+---+---+---+ | Home ePDG IP addresses | octet 2 | | | | | | | | | | | | | | | | | | | | octet e | | | | | | | | +-----------------------------------------------+---------+---+---+---+---+---+---+---+
Figure 5.3.3.4.2: Home ePDG identifier entry (type = IP address type)
Table 5.3.3.4.1: Home ePDG identifier entry (type = IP address type)
Home ePDG identifier type (octet 1) is set as follows when the type is IP
address.
* * *
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 1 IPv4 0 0 0 0 0 0 1 0 IPv6 0 0 0 0 0 0 1 1 IPv4IPv6
If the home ePDG identifier type indicates IPv4, then the home ePDG IP
addresses field contains an IPv4 address in octet 2 to octet 5.
If the home ePDG identifier type indicates IPv6, then the home ePDG IP
addresses field contains an IPv6 address in octet 2 to octet 17.
If the home ePDG identifier type indicates IPv4IPv6, then the home ePDG IP
addresses field contains two IP addresses. The first IP address is an IPv4
address in octet 2 to octet 5. The second IP address is an IPv6 address in
octet 6 to octet 21.
+------------------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------------------+---------+---+---+---+---+---+---+---+ | Home ePDG identifier type (= FQDN) | octet 1 | | | | | | | | +------------------------------------+---------+---+---+---+---+---+---+---+ | Length of home ePDG FQDN | octet 2 | | | | | | | | +------------------------------------+---------+---+---+---+---+---+---+---+ | Home ePDG FQDN | octet 3 | | | | | | | | | | | | | | | | | | | | octet f | | | | | | | | +------------------------------------+---------+---+---+---+---+---+---+---+
Figure 5.3.3.4.3: Home ePDG identifier entry (type = FQDN)
Table 5.3.3.4.2: Home ePDG identifier entry (type = FQDN)
Home ePDG identifier type (octet 1) is set as follows when the type is FQDN.
* * *
8 7 6 5 4 3 2 1  
0 0 0 0 0 1 0 0 FQDN
Length of home ePDG FQDN field (octet 2) indicates the length of home ePDG
FQDN.
Home ePDG FQDN field (octet 3 to octet f) is encoded as defined in clause
19.4.2.9.2 in 3GPP TS 23.003 [4].
#
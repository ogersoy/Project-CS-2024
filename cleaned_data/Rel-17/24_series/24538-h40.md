# Foreword
This Technical Specification\| has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document specifies the protocol aspects for supporting MSGin5G
services as specified in 3GPP TS 23.554 [2] for:
1\. communication between the MSGin5G UE and the MSGin5G Server over the
MSGin5G-1 interface;
2\. communication between the Constrained UE (without MSGin5G Client) and
MSGin5G Gateway UE which is an Unconstrained UE over the MSGin5G-5 interfaces;
and
3\. communication between the Constrained UE (with MSGin5G Client) and the
MSGin5G Relay UE which is an Unconstrained UE over the MSGin5G-6 interfaces.
The present specification defines the usage and interactions of the MSGin5G
Service with SEAL services.
The present specification also defines the message format, message contents,
error handling and system parameters applied by the protocols for the MSGin5G
Service.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.554: \"Application architecture for MSGin5G Service; Stage
2;\".
[3] 3GPP TS 23.434: \"Service Enabler Architecture Layer for Verticals\".
[4] IETF RFC 7641: \"Observing Resources in the Constrained Application
Protocol (CoAP)\".
[5] IETF RFC 7252: \"The Constrained Application Protocol (CoAP)\".
[6] 3GPP TS 24.546: \"Configuration management - Service Enabler Architecture
Layer for Verticals (SEAL); Protocol specification\".
[7] 3GPP TS 29.538: \"Enabling MSGin5G Service; Application Programming
Interfaces (API) specification; Stage 3\".
[8] JSON Schema: \" JSON Schema Draft-07\", http://json-
schema.org/specification.html
[9] 3GPP TS 23.304: \"Proximity based Services (ProSe) in the 5G System
(5GS)\".
[10] 3GPP TS 24.544: \"Group Management - Service Enabler Architecture Layer
for Verticals (SEAL); Protocol specification\".
[11] 3GPP TS 24.545: \"Location Management - Service Enabler Architecture
Layer for Verticals (SEAL); Protocol specification\".
[12] 3GPP TS 24.546: \"Configuration Management - Service Enabler Architecture
Layer for Verticals (SEAL); Protocol specification\".
[13] 3GPP TS 24.547: \"Identity Management - Service Enabler Architecture
Layer for Verticals (SEAL); Protocol specification\".
[14] 3GPP TS 24.548: \"Network Resource Management - Service Enabler
Architecture Layer for Verticals (SEAL); Protocol specification\".
[15] 3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General
Aspects\".
[16] 3GPP TS 33.501: \"Security architecture and procedures for 5G system\".
[17] 3GPP TS 23.502: \" Procedures for the 5G System; Stage 2\"
[18] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[19] IETF RFC 4122: \"A Universally Unique IDentifier (UUID) URN Namespace\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in 3GPP TR 21.905
[1] and the following apply. A term defined in the present document takes
precedence over the definition of the same term, if any, in 3GPP TR 21.905
[1].
**example:** text used to clarify abstract rules by applying them literally.
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.554 [2] apply:
**Broadcast Area**
**Messaging Topic**
**MSGin5G Client**
**MSGin5G Gateway UE**
**MSGin5G Group**
**MSGin5G Relay UE**
**MSGin5G Service**
**MSGin5G Server**
**MSGin5G UE**
**Non-3GPP UE**
**Non-MSGin5G UE**
**Constrained UE**
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
\ \
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
AF Application Function
AS Application Server
CAPIF Common API Framework for northbound APIs
CoAP Constrained Application Protocol
NIDD Non IP Data Delivery
SCEF Service Capability Exposure Function
SCS Service Capability Server
SEAL Service Enabler Architecture Layer for Verticals
# 4 General description
The MSGin5G Service (message service for MIoT over 5G System) is basically
designed and optimized for massive IoT device communication including thing-
to-thing communication and person-to-thing communication. The MSGin5G Service
provides messaging communication capability in 5GS including the following
message communication models:
a) Point-to-Point message;
b) Application-to-Point message/ Point-to-Application message;
c) Group message;
d) Broadcast message.
The MSGin5G Service support the message exchanging between the following UE
types:
a) MSGin5G UE:
1) light weight Constrained UEs (e.g. sensors, actuators) and
2) Unconstrained UEs with advanced capabilities (e.g. washing machine, micro-
ovens).
b) Legacy 3GPP UE.
c) Non-3GPP UE.
The MSGin5G Client contained in the MSGin5G UE communicates with the MSGin5G
Server over the MSGin5G-1 interface (see 3GPP TS 23.554 [2]). CoAP specified
in IETF RFC 7252 [5] is used as the basic transport protocol of MSGin5G
service in this reference point and shall be supported by the MSGin5G Client
and MSGin5G Server. For supporting sending/receiving MSGin5G message for the
MSGin5G Client contained in Constrained UE, the transport protocols of
MSGin5G-6 interface is also CoAP specified in IETF RFC 7252 [5].
An MSGin5G UE-1 may be a Constrained UEs which does not have enough capability
to connect to 3GPP network. If allowed by configuration, an Unconstrained UE
MSGin5G UE-2 may act as an MSGin5G Gateway UE or an MSGin5G Relay UE to
MSGin5G UE-1. In this scenario, the MSGin5G UE-1 communicates with the MSGin5G
UE-2 over the MSGin5G-5 and/or MSGin5G-6 interfaces (see 3GPP TS 23.554 [2]).
Additionally, the MSGin5G Client(s) may interact with SEAL Clients over the
SEAL-C reference point specified for each SEAL service as specified in 3GPP TS
23.434 [3]. The MSGin5G Server(s) may interact with SEAL Servers over the
SEAL-S reference point specified for each SEAL service as specified in 3GPP TS
23.434 [3]. The interaction between a SEAL Client and the corresponding SEAL
Server is supported by SEAL-UU reference point specified for each SEAL service
as specified in 3GPP TS 23.434 [3].
By means of using the MSGin5G-1 interface, the following aspects can be
provided:
a) MSGin5G UE registration and de-registration towards the MSGin5G Server;
b) MSGin5G message delivery and MSGin5G message delivery status report; and
c) Messaging Topic Subscription.
By means of using the MSGin5G-5 interfaces, the following aspects can be
provided:
a) Constrained UE registration and de-registration towards the MSGin5G Gateway
UE; and
b) The exchanging of message and message delivery status report between
Constrained UE and MSGin5G Server by using MSGin5G Gateway UE.
By means of using MSGin5G-6 interfaces, the following aspects can be provided:
a) Constrained UE registration and de-registration towards the MSGin5G Server
by using MSGin5G Relay UE; and
b) The exchanging of MSGin5G message and MSGin5G message delivery status
report between Constrained UE and MSGin5G Server by using MSGin5G Relay UE.
The necessary 5GC Network Capabilities, e.g. device triggering, may be used in
MSGin5G Service as specified in 3GPP TS 23.554 [2]. The device trigger is
delivered to the MSGin5G Client via SCEF/NEF and the Core Network as specified
in 3GPP TS 23.502 [17] and is out of scope of this document.
# 5 Functional entities
## 5.1 MSGin5G Client
An MSGin5G Client acts as client-side functionality for MSGin5G UE
configuration, registration and message delivery.
The functionalities of MSGin5G Client include:
a) supporting registration to an MSGin5G Server;
b) supporting configuration required to use MSGin5G Service;
c) constructing MSGin5G message when:
1) requested by an Application Client resides on the same MSGin5G UE or;
2) requested by the Application Client resides on a Constrained UE without
MSGin5G Client by acting as a gateway;
d) delivering MSGin5G message payload to the targeted Application Client;
1) directly when the Application Client resides on the same MSGin5G UE or;
2) resides on a Constrained UE without MSGin5G Client by acting as a gateway;
e) exchanging MSGin5G messages with an MSGin5G Server;
f) supporting MSGin5G message segmentation according to service provider\'s
policy;
g) acting as a relay for MSGin5G Client resides in other UE, which does not
have enough capability to connect to the 3GPP network(i.e. a Constrained UE),
to use MSGin5G Service; and
h) acting as a gateway to handle the registration and deregistration
procedures initiated by the application client in a Constrained UE.
## 5.2 MSGin5G Server
An MSGin5G Server functional entity provides server-side functionality for
configuration, registration and message delivery.
The following functionalities of MSGin5G Server need to be considered in
current document:
a) exchanging MSGin5G messages with MSGin5G Client;
b) routing MSGin5G messages based on UE Service ID;
c) supporting transport level protocol selection and conversion for exchanging
MSGin5G messages with MSGin5G UE;
d) to resolve the MSGin5G Group Service ID to determine the members of the
Group specified in 3GPP TS 23.434 [3];
e) supporting MSGin5G message segmentation according to service provider\'s
policy;
f) supporting MSGin5G UE configuration procedures as specified in 3GPP TS
23.434 [3] and 3GPP TS 24.546 [6] or communicating with the SEAL Configuration
Management Server to provide MSGin5G configuration data on a UE to be ready
for the MSGin5G Service; and
g) managing MSGin5G UE information related to the MSGin5G Service, such as
MSGin5G Client availability.
# 6 MSGin5G Procedures
## 6.1 General
In clause 6, the detailed behaviors of the MSGin5G UE, the MSGin5G Server and
Constrained UE with/without MSGin5G Client during the MSGin5G procedures are
described.
Depending on communication over different MSGin5G interfaces, different
MSGin5G procedures are supported as:
a) For the communication between the MSGin5G Client of MSGin5G UE and the
MSGin5G Server over the MSGin5G-1 interface, the following procedures are
involved:
1) Configuration;
2) Registration and de-registration;
3) MSGin5G message delivery including sending and receiving MSGin5G message,
aggregated MSGin5G message, MSGin5G message delivery status report and
aggregated MSGin5G message delivery status report.
4) MSGin5G message segment and reassembly; and
5) Messaging topic subscription.
b) For the communication between the Constrained UE (without MSGin5G Client)
and MSGin5G Gateway UE which is an Unconstrained UE over the MSGin5G-5
interfaces, the following procedures are involved:
1) Registration and de-registration;
2) message delivery procedure including sending and receiving message and
message delivery status report.
c) For the communication between the Constrained UE (with MSGin5G Client) and
the MSGin5G Relay UE which is an Unconstrained UE over the MSGin5G-6
interfaces, all the procedures listed in bullet a) are supported. The
communication between MSGin5G Client of the Constrained UE and the MSGin5G
Server re-uses the procedures listed in bullet a). The MSGin5G Relay UE relays
the requests and responses as traffic between the MSGin5G Client of the
Constrained UE and the MSGin5G Server.
For procedures used for bullet a) and bullet c), CoAP specified in IETF RFC
7252 [5] is used as the basic transport protocol. For procedures used for
bullet b), guidance on definitions of the message format and information
elements are described in Annex A.
The authorization of MSGin5G Client by the MSGin5G Server is performed by
verifying the UE service ID as specified in Annex Y of TS 33.501 [16].
## 6.2 Configuration
### 6.2.1 MSGin5G UE Configuration
#### 6.2.1.1 General
MSGin5G UE Configuration is based on the configuration management
functionality specified in TS 23.434 [3] and TS 24.546 [6].
#### 6.2.1.2 Procedure at MSGin5G Client
The MSGin5G UE should support the configuration management client
functionality as specified in 3GPP TS 23.546 [6]. The configuration management
client functionality may be collocated with MSGin5G Client or it can be
separated with MSGin5G Client as per 3GPP TS 23.554 [2].
If the configuration management client functionality is not collocated with
the MSGin5G Client, the MSGin5G Client should use SEAL-C interface to interact
with configuration management client functionality for MSGin5G UE
configuration.
The MSGin5G UE configuration procedures at the configuration management client
functionality are based on the procedures in clause 6.2.3.3 of 3GPP TS 24.546
[6], in the procedures:
a) the configuration management client functionality on the MSGin5G UE acts as
SCM-C;
b) the configuration management server functionality at the server-side acts
as SCM-S;
c) shall set the Option header to the CoAP URI identifying the user profile
document to be retrieved according to the resource API definition in Annex
C.3.1 of 3GPP TS 24.546 [6],
1) the \"apiRoot\" is set to the URI of the configuration management server
functionality at the server-side;
2) the \"valServiceId\" is set to the unique service identifier of MSGin5G
service; and
3) the configuration management client functionality shall make a GET request
for the UE Configurations as described in Annex C.3.1.2.2.3.1 of 3GPP TS
24.546 [6] and shall set applicable query parameters defined in table
C.3.1.2.2.3.1-1 of 3GPP TS 24.546 [6] with the clarification listed below.
i) the ue-uri is set to the MSGin5G UE ID as specified in 3GPP TS 23.554 [2]
ii) the ue-vendor and/or the ue-type parameter are set to the MSGin5G UE
information as specified in 3GPP TS 23.554 [2] if included.
Upon receiving the requested MSGin5G UE configuration data, the configuration
management client functionality shall submit the configuration data to MSGin5G
Client by SEAL-C interface if it is not collocated with the MSGin5G Client.
The MSGin5G Client shall store the configuration data, including MSGin5G UE
Service ID, the address of MSGin5G Server and other available MSGin5G Service
specific information.
The corresponding JSON Schema used in step e) is defined in 7.3.2.1.
#### 6.2.1.3 Procedure at MSGin5G Server
The configuration management server functionality as specified in 3GPP TS
23.546 [6] may be collocated with MSGin5G Server or it can be separated with
MSGin5G Server as per 3GPP TS 23.554 [2].
The MSGin5G UE configuration procedures at the configuration management server
functionality are based on the procedures in clause 6.2.3.4 of 3GPP TS 24.546
[6]. In the procedures, the configuration management server function acts as
SCM-S.
### 6.2.2 Constrained device Configuration
#### 6.2.2.1 Procedure at MSGin5G Relay UE
When the MSGin5G Client on the MSGin5G Relay UE receives a CoAP GET request
from UDP port 65401and the recipient\'s address included in the CoAP Option is
set to the configuration management server functionality, the MSGin5G Relay UE
acts as either 5G ProSe Layer-2 and Layer-3 UE-to-Network Relay entity as
specified in 3GPP TS 23.304 [9] and relays the CoAP GET request as a uplink
traffic to the configuration management server functionality.
When the MSGin5G Client-1 on the MSGin5G Relay UE receives a CoAP 2.05
(Content), 4.03 (Forbidden) or 4.04 (Not found) response from UDP port
65401and the recipient\'s address included in the CoAP Option is set to
another MSGin5G Client-2 which has established a connection for One-to-one
ProSe Direct Communication with it as specified in 3GPP TS 23.304[9], the
MSGin5G Relay UE acts as either 5G ProSe Layer-2 and Layer-3 UE-to-Network
Relay entity as specified in 3GPP TS 23.304 [9] and relays the CoAP 2.05
(Content), 4.03 (Forbidden) or 4.04 (Not found) response as a downlink traffic
to the MSGin5G Client-2, Otherwise the MSGin5G Client-1 shall discard the CoAP
2.05 (Content), 4.03 (Forbidden) or 4.04 (Not found) response.
#### 6.2.2.2 Procedure at Constrained UE with MSGin5G Client
In order to send an MSGin5G UE Configuration request, the configuration
management client functionality on the Constrained UE with MSGin5G Client
shall use the procedures specified in clause 6.2.1.2.
Upon receiving an CoAP 2.05 (Content), 4.03 (Forbidden) or 4.04 (Not found)
response and the recipient\'s address included in the CoAP Option is set to
the MSGin5G Client itself, the MSGin5G Client shall handle the CoAP 2.05
(Content), 4.03 (Forbidden) or 4.04 (Not found) response as specified in
clause 6.2.1.2.
## 6.3 Registration
### 6.3.1 MSGin5G UE Registration
#### 6.3.1.1 Procedure at MSGin5G Client
##### 6.3.1.1.1 MSGin5G UE registration
After the UE Service ID is configured to the MSGin5G UE, in order to register
MSGin5G UE to the MSGin5G Server, the MSGin5G Client shall send a CoAP POST
request to the MSGin5G Server according to procedures specified in IETF RFC
7252 [5]. In this CoAP POST request, the MSGin5G Client:
a) shall set the \"T\" field in the CoAP header to 0 to indicate acknowledge
message required;
b) shall include the MSGin5G Server address in the Option header of the CoAP
POST request and set the Option header to a corresponding value, e.g. if the
MSGin5G Server address is a URI, the Uri-Path Option is set to the value of
such URI;
c) shall set the \"Content-Format\" element to \"50\" to indicate the format
of the CoAP payload is \"application/json\"; and
d) shall include the following information elements in the CoAP payload
encoded in JSON format as specified in clause 7.3.3.1:
1) the \"MSGin5G service identifier\" element to indicate that this CoAP POST
request is used for MSGin5G service;
2) the \"Message Type\" element with a \"REG\" value to indicate that this
CoAP POST request is used for registration;
3) the \"UE Service ID\" element to indicate the MSGin5G UE initiating
registration procedure; and
4) optionally, the \"MSGin5G Client Profile\" element to include a set of
parameters describing the MSGin5G Client. This element may include the
\"MSGin5G Client Triggering Information\" element and the \"MSGin5G Client
Communication Availability\" element. The \"MSGin5G Client Triggering
Information\" element shall include the \"MSGin5G UE ID\" element to indicate
the MSGin5G UE hosting the MSGin5G Client and the \"MSGin5G Client Ports\"
element to indicate that the MSGin5G Client listens on for device triggers
from the MSGin5G Server. The \"MSGin5G Client Communication Availability\"
element informs the MSGin5G Server whether the client has a specific
application-level schedule/periodicity to its MSGin5G communications, which
may be used in conjunction with UE reachability monitoring to determine
whether and when MSGin5G communications are attempted. This element:
i) shall include the \"Scheduled communication time\" element to indicate the
time when the UE becomes available for communication;
ii) shall include the \"Communication duration time\" element to indicate the
duration time of periodic communication;
iii) may include the \"Periodic communication indicator\" element to identify
whether the client communicates periodically or not;
iv) may include the \"Periodic communication interval\" element to indicate
the interval Time of periodic communication if \"Periodic communication
indicator\" element is included;
v) may include the \"Data size indication\" element to indicate the expected
data size to be exchanged during the communication duration; and
vi) may include the \"Store and forward option\" element to indicate the UE
does not request store and forward services for incoming MSGin5G requests.
##### 6.3.1.1.2 MSGin5G UE de-registration
The MSGin5G Client initiates a CoAP POST request to de-register from the
MSGin5G Server. In this CoAP POST request, the MSGin5G Client:
a) shall set the \"T\" field in the CoAP header to 0 to indicate acknowledge
message required;
b) shall include the MSGin5G Server address in the Option header of the CoAP
POST request and set the Option header to a corresponding value, e.g. if the
MSGin5G Server address is a URI, the Uri-Path Option is set to the value of
such URI;
c) shall set the \"Content-Format\" element to \"50\" to indicate the format
of the CoAP payload is \"application/json\"; and
d) shall include the following information elements encoded in JSON format as
specified in clause 7.3.3.2:
1) the \"MSGin5G service identifier\" element to indicate that this CoAP POST
request is used for MSGin5G service;
2) the \"Message Type\" element with a \"DEREG\" value to indicate that the
CoAP POST request is used for de-registration; and
3) the \"UE Service ID\" element to indicate the MSGin5G UE initiating de-
registration procedure.
#### 6.3.1.2 Procedure at MSGin5G Server
##### 6.3.1.2.1 MSGin5G UE registration
Upon reception of the CoAP POST request containing MSGin5G service identifier
indicating that the received request is for MSGin5G service and Message Type
indicating that the received request is for registration, the MSGin5G Server
shall verify the UE service ID. After a successful verification, the MSGin5G
Server:
a) shall store the UE Service ID and the MSGin5G Client Profile information
included in the received CoAP POST request; and
b) shall generate a CoAP 2.01 (Created) response or CoAP 2.04 (Change)
response including the following parameters:
1) the CoAP \"Message ID\" element and the \"Token\" element with the same
values with those in the CoAP POST request for registration; and
2) the \"Content-Format\" element with \"50\" to indicate the format of the
CoAP payload is \"application/json\" and the CoAP payload encoded in JSON
format as specified in clause 7.3.3.1 including:
i) the \"UE Service ID\" element to indicate the MSGin5G UE initiating
registration procedure; and
ii) the \"Registration result\" element to indicate whether the registration
is success or failure.
##### 6.3.1.2.2 MSGin5G UE de-registration
Upon reception of the CoAP POST request containing MSGin5G service identifier
indicating that the received request is for MSGin5G service and Message Type
indicating that the received request is for deregistration from an MSGin5G UE,
the MSGin5G Server shall verify the UE service ID. After a successful
verification, the MSGin5G Server:
a) shall delete the registration information of the MSGin5G UE and any
applicable MSGin5G Client Profile information that it has stored; and
b) shall generate a CoAP 2.04 (Change) response including the following
parameters:
1) the CoAP \"Message ID\" element and the \"Token\" element with the same
values with those in the CoAP POST request for deregistration;
2) optionally, the MSGin5G Client address in the Option header of the CoAP
response and set the Option header to a corresponding value, if it is provided
in the payload of CoAP POST request; and
3) the \"Content-Format\" element with \"50\" to indicate the format of the
CoAP payload is \"application/json\" and the CoAP payload encoded in JSON
format as specified in clause 7.3.3.2 including:
i) the \"UE Service ID\" element to indicate the MSGin5G UE initiating de-
registration procedure; and
ii) the \"De-registration result\" element to indicate whether the
registration is success or failure.
### 6.3.2 Constrained UE registration to use MSGin5G Gateway UE
#### 6.3.2.1 Procedure at Gateway MSGin5G UE
##### 6.3.2.1.1 Constrained UE registration to use MSGin5G Gateway UE
Upon reception of registration request from the application client on the
Constrained UE, the MSGin5G Gateway UE decides whether to accept the
registration request based on local condition.
If the registration is accepted by the MSGin5G Gateway UE, the MSGin5G Client
on the MSGin5G Gateway UE:
a) stores Application ID included in the registration request from the
Constrained UE and the mapping between the transport identifier and the
Application ID;
NOTE 1: Based on the connection mode, e.g. L2 connection or L3 connection, the
MSGin5G Gateway UE can allocate a specified MAC address or UDP port for
exchanging information between the MSGin5G Gateway UE and the Constrained UE.
The transport mechanism is based on the legacy transport protocol.
NOTE 2: The MSGin5G Gateway UE retrieves the transport identifier from the
transport layer. The transport identifier can be a Layer-2 ID, e.g. a MAC
address, or a Layer-3 ID, e.g. an IP address with a specific UDP port.
b) allocates a Registration ID for the Constrained UE; and
c) constructs the registration response and sends it to the application client
on the Constrained UE. The registration response shall include:
1) the Registration Result indicates the registration is accepted by the
MSGin5G Gateway UE; and
2) the Registration ID allocated by the MSGin5G Gateway UE.
If the registration is not accepted by the MSGin5G Gateway UE, the MSGin5G
Client on the MSGin5G Gateway UE constructs the registration response and
sends it to the application client on the Constrained UE. The registration
response shall include:
a) the Registration Result indicating the registration is not accepted by the
MSGin5G Gateway UE; and
b) the Failure Reason indicating an appropriate reason why the registration
request is rejected by the MSGin5G Gateway UE.
##### 6.3.2.1.2 Constrained UE de-registration to use MSGin5G Gateway UE
Upon reception of de-registration request from the application client on the
Constrained UE, the MSGin5G Gateway UE:
a) removes the mapping between Application ID and transport identifier of the
UE-2 based on the Registration ID included in the de-registration request; and
b) constructs the de-registration response including:
1) the De-registration Result indicating whether the de-registration is
accepted or not;
2) the Registration ID included in the de-registration request, if the de-
registration is accepted by the MSGin5G Gateway UE; and
3) the Failure Reason indicating an appropriate cause indicating why the de-
registration request is rejected by the MSGin5G Gateway UE, if the de-
registration is not accepted by the MSGin5G Gateway UE.
NOTE: Based on the connection mode, e.g. L2 connection or L3 connection, the
MSGin5G Gateway UE may allocate a specified MAC address or UDP port for
exchanging information between the MSGin5G Gateway UE and the Constrained UE.
The transport mechanism is based on the legacy transport protocol.
#### 6.3.2.2 Procedure at Constrained UE
##### 6.3.2.2.1 Constrained UE registration to use MSGin5G Gateway UE
In order to register Constrained UE to the MSGin5G Gateway UE, the Application
Client on the Constrained UE sends a registration request to the MSGin5G
Client on the MSGin5G Gateway UE. The registration request shall include the
\"Application ID\" to indicate the Application Client on the Constrained UE
initiating registration.
NOTE: If a specified MAC address or UDP port is configured for exchanging
information between the MSGin5G Gateway UE and the Constrained UE, the
Constrained UE shall send the registration request to the specified MAC
address or UDP port.
##### 6.3.2.2.2 Constrained UE de-registration to use MSGin5G Gateway UE
In order to de-register Constrained UE to the MSGin5G Gateway UE, the
Application Client on the Constrained UE sends a de-registration request to
the MSGin5G Client on the MSGin5 Gateway UE. The de-registration request shall
include the \"Registration ID\" which has been allocated by the MSGin5G
Gateway UE during the registration procedure.
NOTE: If a specified MAC address or UDP port is configured for exchanging
information between the MSGin5G Gateway UE and the Constrained UE, the
Constrained UE shall send the de-registration request to the specified MAC
address or UDP port.
### 6.3.3 Constrained UE registration to use MSGin5G Relay UE
#### 6.3.3.1 General
The MSGin5G Relay UE acts as either 5G ProSe Layer-2 or Layer-3 UE-to-Network
Relay entity as specified in 3GPP TS 23.304 [9] and relays the CoAP POST
request/response as traffic between the MSGin5G Server and the Constrained UE.
#### 6.3.3.2 Procedure at MSGin5G Relay UE
##### 6.3.3.2.1 Constrained UE with MSGin5G Client registration via MSGin5G
Relay UE
When a CoAP POST request for registration from the MSGin5G Client of the
Constrained UE, the MSGin5G Relay UE relays the CoAP POST request as an uplink
traffic to the MSGin5G Server.
When the CoAP 2.01 (Created) response or CoAP 2.04 (Change) response returned
from the MSGin5G Server and the response is the acknowledgement for a CoAP
request from a Constrained UE, the MSGin5G Relay UE relays the CoAP 2.01
(Created) response or CoAP 2.04 (Change) response as a downlink traffic to the
Constrained UE.
##### 6.3.3.2.2 Constrained UE with MSGin5G Client de-registration via MSGin5G
Relay UE
When a CoAP POST request for de-registration from the MSGin5G Client of the
Constrained UE, the MSGin5G Relay UE relays the CoAP POST request as an uplink
traffic to the MSGin5G Server.
When a CoAP 2.04 (Change) response returned from the MSGin5G Server and the
response is the acknowledgement for a CoAP request from a Constrained UE, the
MSGin5G Relay UE relays the CoAP 2.04 (Change) response as a downlink traffic
to the Constrained UE.
#### 6.3.3.3 Procedure at Constrained UE
##### 6.3.3.3.1 Constrained UE with MSGin5G Client registration via MSGin5G
Relay UE
In order to register Constrained UE to the MSGin5G Server, the MSGin5G Client
of Constrained UE sends a CoAP POST request to the MSGin5G Server via the
MSGin5G Relay UE. The CoAP POST request is constructed as specified in clause
6.3.1.1.1.
##### 6.3.3.3.2 Constrained UE with MSGin5G Client de-registration via MSGin5G
Relay UE
In order to de-register Constrained UE to the MSGin5G Server, the MSGin5G
Client of Constrained UE sends a CoAP POST request to the MSGin5G Server via
the MSGin5G Relay UE. The CoAP POST request is constructed as specified in
clause 6.3.1.1.2.
## 6.4 MSGin5G Message delivery
### 6.4.1 Procedures between MSGin5G UE and MSGin5G Server
#### 6.4.1.1 Procedure at MSGin5G Client
##### 6.4.1.1.1 General
This clause specifies the procedures for sending and receiving MSGin5G
message, aggregated MSGin5G message, MSGin5G message delivery status report
and aggregated MSGin5G message delivery status report at MSGin5G Client.
##### 6.4.1.1.2 Sending of an MSGin5G message
In order to send an MSGin5G message, the MSGin5G Client shall compare the size
of the received message from the Application Client to the maximum allowed
MSGin5G message segmentation size. If the size exceeds, the MSGin5G Client
shall segment the MSGin5G message into a set of segmented MSGin5G messages
such that each segmented MSGin5G message can fit within the maximum allowed
MSGin5G message segmentation size. For each segmented MSGin5G message, the
steps listed below shall be processed individually.
The MSGin5G Client shall send the MSGin5G message in a CoAP POST request
message according to procedures specified in IETF RFC 7252 [5]. In the CoAP
POST request message, The MSGin5G Client:
a) shall set the \"T\" field in the CoAP header to 0 if delivery status report
from the recipient is requested, i.e. indicates that this message is the type
of Confirmable, to ensure the application layer delivery status report;
b) shall include the MSGin5G Server address in a CoAP Option, e.g. if the
MSGin5G Server address is a URI, includes a Uri-Path Option with the value of
the URI;
c) shall set the CoAP Content-Format to \"50\", i.e. application/json;
d) shall include the information elements specified in 3GPP TS 23.554 [2] in
the CoAP payload encoded in JSON format as specified in clause 7.3.4:
1) shall include an \"MSGin5G service identifier\" element to indicate that
this CoAP POST request message is used for MSGin5G service;
2) shall include a \"Message Type\" element and set it to \"MSG\" to indicate
that this CoAP POST request message is used for MSGin5G message;
3) shall include an \"Originating UE Service ID\" element set to the UE which
requests the sending of the MSGin5G message;
4) shall include a \"Recipient UE Service ID/AS Service ID\" element if the
recipient is an MSGin5G UE/Non-MSGin5G UE or Application Server;
5) shall include a \"Group Service ID\" element if the recipient is an MSGin5G
Group;
6) shall include a \"Broadcast Area ID\" element if the message needs to be
broadcast;
7) shall include a \"Messaging Topic\" element if this message will be
distributed based on message topic. This element shall not present in other
message scenarios;
NOTE: In an MSGin5G Message request, only one of these IEs listed from step 4)
to step 6) shall be included.
8) may include one or more \"Application ID\" elements to indicate the
application(s) for which the payload is(are) intended;
9) shall include a \"Message ID\" which is globally unique within the MSGin5G
service to identify this specific MSGin5G message;
10) may include a \"Delivery status required\" element if delivery
acknowledgement from the recipient is requested;
11) may include a \"Priority type\" element to indicate the application
priority level requested for this message;
12) may include a \"Message is segmented\" element with a \"true\" value to
indicate that this message is part of a segmented message;
13)if \"Message is segmented\" element with a \"true\" value is included,
shall include a \"Segmentation set identifier\" element to indicate that this
segmented message is associated within a set of segmented messages. All
segmented messages associated with the same MSGin5G message shall be assigned
the same unique identifier;
14) if \"Message is segmented\" element with a \"true\" value is included and
this message is the first segment of the set of segmented messages, shall
include a \"Total number of message segments\" element to indicate the total
number of segments for the MSGin5G message;
15) if \"Message is segmented\" element with a \"true\" value is included,
shall include a \"Message segment number\" element to indicate the number of
each segmented message within a set of segmented messages;
16) if \"Message is segmented\" element with a \"true\" value is included and
this message is the last segment of the set of segmented messages, shall
include a \"Last segment flag\" element to indicate that this segmented
message is the last segment in the set of segmented messages;
17)shall include a \"Store and forward flag\" element to indicate whether
store and forward services are requested for this message;
18) if store and forward services are requested, may include a \"Store and
forward parameters\" element to carry the parameters used by MSGin5G Server
for providing store and forward services. The \"Store and forward
parameters\":
i) may include a \"Message expiration time\" element to indicate the message
expiration time used for providing store and forward services if the
destination is not available for communications; and
ii) may include an \"Application specific store and forward information\"
element to carry the information used by MSGin5G Server for handling store and
forward, e.g. a delivery time/date; and
19) may include a \"Payload\" element which carries the application payload
that is transferred by the MSGin5G Service in the CoAP payload and located it
after the elements listed from step 1) to 19); The content of \"Payload\"
element is transparent to the MSGin5G Service; and
e) if needed, i.e. a message segment recovery request is received, acts as
Message Sender to perform the procedures in clause 6.5.1.1.
##### 6.4.1.1.3 Sending of an aggregated MSGin5G message
Before the sending of an MSGin5G message, the MSGin5G Client shall check if
aggregation is allowed for this message, check the message data size, and the
priority level to determine if the message can be aggregated. For example, if
the MSGin5G Client finds that the messages have small payload size when
compared to the maximum segment size that can be transmitted over CoAP and the
messages are not high priority messages, which could be sent as per scheduling
policy towards a selected target, the MSGin5G Client can decide to aggregate
messages until optimal use of segment size before sending message towards
MSGin5G Server.
If the message can be aggregated, the MSGin5G Client aggregates multiple
MSGin5G message requests intended for a selected target and sends the
aggregated message in a single CoAP POST request message. The sending of the
CoAP POST request message shall follow the procedures specified in clause
6.4.1.1.2 with the clarifications listed below:
a) The MSGin5G Client should not segment the aggregated message, so in step d)
of clause 6.4.1.1.2, the \"Message is segmented\", \"Segmentation set
identifier\", \"Total number of message segments\", \"Message segment number\"
and \"Last segment flag\" elements should not be included.
b) In addition to the step d) of clause 6.4.1.1.2, the MSGin5G Client should
include a \"Number of individual messages\" element in this message to
indicate the total number of messages which are aggregated into this single
message.
c) In addition to the step d) of clause 6.4.1.1.2, the MSGin5G Client should
include a \"List of individual messages\" element in this message. Each child
element of this \"List of individual messages\" element contains information
elements listed below:
1) \"Message ID\" of the individual message;
2) \"Payload\" which carries the application payload that is transferred by
the individual MSGin5G message;
3) one or more optional \"Application ID\" elements;
4) an optional \"Delivery status required\" element; and
5) an optional \"Priority type\" element.
d) The MSGin5G Client should not include the \"Payload\" element outside the
\"List of individual messages\" element, i.e. the 19) in step e) of clause
6.4.1.1.2 shall not be processed.
##### 6.4.1.1.4 Sending of an MSGin5G message delivery status report
In order to send a MSGin5G message delivery status report, the MSGin5G Client
shall send an CoAP POST request according to procedures specified in IETF RFC
7252 [5]. In the CoAP POST request, the MSGin5G Client:
a) shall sets the \"T\" field in the CoAP header to 0, i.e. indicates that
this message is the type of Confirmable, to ensure that the MSGin5G message
delivery status report can be received by the originator of the receiving
MSGin5G message;
b) shall include the MSGin5G Server address in an CoAP Option, e.g. if the
MSGin5G Server address is a URI, includes a Uri-Path Option with the value of
the URI;
c) shall set the CoAP Content-Format to \"50\", i.e. application/json; and
d) shall include the information elements specified in 3GPP TS 23.554 [2] in
the CoAP payload encoded in JSON format as specified in clause 7.3.4.2:
1) shall include an \"MSGin5G service identifier\" element to indicate that
this CoAP POST request message is used for MSGin5G service;
2) shall include an \"Message Type\" element and set it to \"IMDN\" to
indicate that this CoAP POST request message is used for MSGin5G message
delivery status report;
3) shall include an \"Originating UE Service ID\" element set to the UE which
requests the sending of the MSGin5G message delivery status report;
4) shall include a \"Recipient UE Service ID/AS Service ID\" element if the
recipient is an MSGin5G UE/Non-MSGin5G UE or an Application Server. This
element indicates is the sender of the message that this message delivery
status report is for;
5) shall include the \"Message ID\" element copied from the MSGin5G message
that is being acknowledged;
6) shall include a \"Delivery Status\" element to carry the delivery status
description. The delivery status can be success or failure in delivery; and
7) may include a \"Failure Cause\" element to indicate the failure reason if
the delivery status is failure.
##### 6.4.1.1.5 Sending of a aggregated MSGin5G message delivery status report
The MSGin5G Client can aggregate multiple MSGin5G message delivery status
reports into one single message. The MSGin5G Client shall check whether the
MSGin5G message delivery status reports can be aggregated as specified in
clause 6.4.1.1.3.
If the MSGin5G message delivery status reports can be aggregated, the MSGin5G
Client aggregates MSGin5G message delivery status reports intended for a
selected target and sends the aggregated MSGin5G message delivery status
reports in a single CoAP POST request message. The sending of the CoAP POST
request message shall follow the procedures specified in clause 6.4.1.1.4 with
the clarifications listed below:
a) In step d) of clause 6.4.1.1.4, the \"Delivery Status\" element and the
\"Failure Cause\" element should not be included.
b) In addition to the step d) of clause 6.4.1.1.4, the MSGin5G Client should
include a \"Number of individual messages\" element in this message to
indicate the total number of MSGin5G message delivery status reports which are
aggregated into this single message.
c) In addition to the step d) of clause 6.4.1.1.4, the MSGin5G Client should
include a \"\"List of individual messages\" element in this message. Each
child element in this \"List of individual messages\" element contains
information elements listed below:
1) \"Message ID\" of the individual MSGin5G message delivery status reports
which is copied from the MSGin5G message that is being acknowledged;
2) \"Delivery Status\" element; and
3) an optional \"Failure Cause\" element.
##### 6.4.1.1.6 Reception of an MSGin5G message
Upon receiving an CoAP POST request containing the MSGin5G Service identifier
and the \"Message Type\" with the value \"MSG\", if the \"Number of individual
messages\" element and \"List of individual messages\" element are not
included, the MSGin5G Client shall handle the CoAP POST request according to
procedures specified in IETF RFC 7252 [5] with the clarifications listed
below:
a) The MSGin5G Client shall check whether a \"Message is segmented\" element
is included in the CoAP POST request. If this element is included, the MSGin5G
Client shall wait until all the segmented messages have been received by
checking the \"Segmentation set identifier\", \"Total number of message
segments\", \"Message segment number\" and \"Last segment flag\" elements. The
MSGin5G Client shall reassemble all the segmented messages into a single
MSGin5G message.
b) The MSGin5G Client shall provide the received information in the
\"payload\" element to the Application Client(s) if one or more \"Application
ID\" elements are included. The Application Client(s) is(are) indicated by the
\"Application ID\" element(s):
1) If the Application Client is on the other MSGin5G UE-2 for which this
MSGin5G Client is acting as MSGin5G Relay UE or MSGin5G Gateway UE, the
MSGin5G Client shall send the received information to the corresponding
MSGin5G UE via MSGin5G-6 (if MSGin5G Client is supported by MSGin5G UE-2) as
specified in clause 6.4.2.4 or MSGin5G-5 reference point (if MSGin5G Client is
not supported by MSGin5G UE-2) as specified in clause 6.4.2.2.
2) If the Application Client is on the same MSGin5G UE with the MSGin5G
Client, the MSGin5G Client shall deliver the received information to the
Application Client via MSGin5G-5 reference point.
NOTE: when the Application Client and MSGin5G Client are resided on the same
MSGin5G UE, the interaction in MSGin5G-5 reference point may implementation
specific and is out of scope of the present document.
c) If a \"Delivery status required\" element is included in the CoAP POST
request, the MSGin5G Client shall send an MSGin5G message delivery status
report as specified in clause 6.4.1.1.4 or clause 6.4.1.1.5 with the
clarifications listed below:
1) if the message delivery status is supported by the Application Client(s),
the MSGin5G message delivery status report shall be sent after the delivery
status information is received from the Application Client(s), and shall be
generated based on this(these) delivery status information; or
2) if the message delivery status is not supported by the Application Client,
the MSGin5G message delivery status report shall be sent immediately by the
MSGin5G Client on behalf of the Application Client(s).
##### 6.4.1.1.7 Reception of a aggregated MSGin5G message
Upon receiving an CoAP POST request containing the MSGin5G Service identifier
and the \"Message Type\" with the value \"MSG\", if a \"Number of individual
messages\" and a \"List of individual messages\" are included, the MSGin5G
Client determines that this message is an aggregated MSGin5G message. The
MSGin5G Client shall handle the CoAP POST request according to procedures
specified in IETF RFC 7252 [5] with the clarifications listed below:
a) The MSGin5G Client shall split the received aggregated message request into
multiple new created individual MSGin5G messages:
1) all elements listed in step d) of clause 6.4.1.1.2 included in the received
MSGin5G message, except the \"Message ID\", \"Message is segmented\",
\"Segmentation set identifier\", \"Total number of message segments\",
\"Message segment number\" and \"Last segment flag\" elements, are copied to
each new created individual MSGin5G message; and
2) each child element of the \"List of individual messages\" element in the
received aggregated MSGin5G message is included in a new created individual
MSGin5G message. The \"Message ID\", \"Payload\", \"Application ID\" (if
present), \"Delivery status required\" (if present) and \"Priority type\" (if
present) in the child element of the \"List of individual messages\" are used
as the same elements in the new created individual MSGin5G message; and
b) The MSGin5G Client shall handle each individual MSGin5G messages according
to step b) and c) specified in clause 6.4.1.1.6.
##### 6.4.1.1.8 Reception of an MSGin5G message delivery status report
Upon receiving an CoAP POST request containing the MSGin5G Service identifier
and the \"Message Type\" with the value \"IMDN\", if the \"Number of
individual messages\" element and \"List of individual messages\" element are
not be included and a \"Delivery Status\" element is included, the MSGin5G
Client shall handle the CoAP POST request according to procedures specified in
IETF RFC 7252 [5] with the clarifications listed below:
a) The MSGin5G Client shall provide the received information in the \"Delivery
Status\" element and the \"Failure Cause\" element (if applicable) to the
Application Client(s) if one or more \"Application ID\" elements are included.
The Application Client(s) is(are) indicated by the \"Application ID\"
element(s):
1) If the Application Client on the other MSGin5G UE for which this MSGin5G
Client is acting as MSGin5G Relay UE or MSGin5G Gateway UE, the MSGin5G Client
shall send the received information to the corresponding MSGin5G UE via
MSGin5G-6 (if MSGin5G Client is supported by MSGin5G UE-2) as specified in
clause 6.4.2.4 or MSGin5G-5 reference point (if MSGin5G Client is not
supported by MSGin5G UE-2) as specified in clause 6.4.2.2.
2) If the Application Client is on the same MSGin5G UE with the MSGin5G
Client, the MSGin5G Client shall deliver the received information to the
Application Client via MSGin5G-5 reference point.
NOTE: when the Application Client and MSGin5G Client are resided on the same
MSGin5G UE, the interaction in MSGin5G-5 reference point may implementation
specific and is out of scope of the present document.
##### 6.4.1.1.9 Reception of a aggregated MSGin5G message delivery status
report
Upon receiving an CoAP POST request containing the MSGin5G Service identifier
and the \"Message Type\" with the value \"IMDN\", if a \"Number of individual
messages\" and a \"List of individual messages\" are included, the MSGin5G
Client determines that this message is an aggregated MSGin5G message. The
MSGin5G Client shall handle the CoAP POST request according to procedures
specified in IETF RFC 7252 [5] with the clarifications listed below:
a) The MSGin5G Client shall split the received aggregated MSGin5G message
request into multiple new created individual MSGin5G messages:
1) all elements listed in step d) of clause 6.4.1.1.4 included in the received
MSGin5G message, except the \"Message ID\", \"Delivery Status\" and the
\"Failure Cause\" elements, are copied to each new created individual MSGin5G
message; and
2) each child element of the \"List of individual messages\" element in the
received aggregated MSGin5G message is included in a new created individual
MSGin5G message. The\"Message ID\", \"Delivery Status\" and the \"Failure
Cause\" (if present) in the child element of the \"List of individual
messages\" are used as the same elements in the new created individual MSGin5G
message; and
b) If \"Delivery Status\" element is included in the new created individual
MSGin5G message, the MSGin5G Client determines that the new created individual
MSGin5G messages are MSGin5G delivery status reports. The MSGin5G Client shall
handle each individual MSGin5G delivery status report according to step a)
specified in clause 6.4.1.1.8.
#### 6.4.1.2 Procedure at MSGin5G Server
##### 6.4.1.2.1 General
An MSGin5G Server provides server-side functionality of messages delivery
among MSGin5G UE, Application Server and Message Gateway. A messages delivery
procedure in the MSGin5G Server can be divided to reception and sending
procedures.
The reception procedure consists:
a) the messages arrival at the MSGin5G Server;
b) the related authentication and authorization of the message on the MSGin5G
Server; and
c) the possible message response to the sender.
The sending procedure consists the outbound messages from the MSGin5G Server.
When the MSGin5G Server receives message from MSGin5G UE, the reception
procedure is specified in clause 6.4.1.2.2, 6.4.1.2.3, 6.4.1.2.4 and
6.4.1.2.5. When the MSGin5G Server receives message from Application Server or
Message Gateway, the reception procedure is specified in 3GPP TS 29.538 [7].
Upon reception of a message, the MSGin5G Server shall analysis the
communication model of the message by analysis the Service ID of the recipient
in the message, then generates a new message based on the received message and
send it to the recipient:
a) if a \"Recipient UE Service ID\" element is included, this message is a
Point-to-Point message or a Application-to-Point message. The MSGin5G Server
analyzes the URI:
1) if the URI points to an MSGin5G Client, the MSGin5G Server send the MSGin5G
message to the MSGin5G Client via MSGin5G-1 reference point as specified in
clause 6.4.1.2.6, 6.4.1.2.7, 6.4.1.2.8 or 6.4.1.2.9; or
2) if the URI points to a Message Gateway, the MSGin5G Server sends the
message to the Message Gateway via MSGin5G-2 or MSGin5G-4 reference point as
specified in 3GPP TS 29.538 [7];
NOTE: The analysis procedure is implementation specific, e.g. by querying the
DNS or local database, and is out of scope of the present document.
b) if a \"Recipient AS Service ID\" element is included, this message is a
Point-to-Application message. The MSGin5G Server analysis the URI and send the
message to the Application Server via MSGin5G-3 reference point as specified
in 3GPP TS 29.538 [7];
c) if a \"Group Service ID\" element is included, this message is a Group
message. The MSGin5G Server obtains the group members by checking the group
profile with the \"Group Service ID\". For each group member, the MSGin5G
Server analyzes its UE Service ID and sends the message to it as specified in
step a);
d) if a \"Broadcast Area ID\" element is included, this message is a Broadcast
message; and
NOTE: The detailed procedure for broadcast message will be given in future
release.
e) if a \"Messaging Topic\" element is included, this message is needed to be
distributed based on message topic. The MSGin5G Server obtains the subscribers
of the Messaging Topic by checking the related subscription. The subscriber of
the Messaging Topic can be MSGin5G UE, Application Server or Message Gateway
(on behalf of non-MSGin5G UE). For each subscriber, the MSGin5G Server
analyzes its Service ID and sends the message to it as specified in step a) or
b).
##### 6.4.1.2.2 Reception of an MSGin5G message
Upon receiving an CoAP POST request from the MSGin5G Client on a MSGin5G UE,
containing the MSGin5G Service identifier and the \"Message Type\" with the
value \"MSG\", i.e. the request is for sending a MSGin5G message, if the
\"Number of individual messages\" element and \"List of individual messages\"
element are not be included, the MSGin5G Server shall handle the CoAP POST
request according to procedures specified in IETF RFC 7252 [5] with the
clarifications listed below:
a) The MSGin5G Server shall authenticate the message and shall verify that the
sending UE is authorized to send the message by checking the registration
status of the MSGin5G Client and the \"Originating UE Service ID\" element in
the CoAP payload. If message is needed to be rejected, the MSGin5G Server
shall send a message response in a new CoAP POST request to the originating
entity as specified in step e) and skips the rest steps in this clause;
b) The MSGin5G Server executes the message segment related procedures as
specified in clause 6.5.3 if needed;
c) The MSGin5G Server shall determine the communication model of the message
as specified in clause 6.4.1.2.1;
d) If the message is stored for deferred delivery as specified in clause
6.4.1.2.6 or 6.4.1.2.7, the MSGin5G Server shall send a message response in a
new CoAP POST request to the originating entity as specified in step e); and
e) The MSGin5G Server shall send a message response in a new CoAP POST request
to the originating entity as specified in IETF RFC 7252 [5] with the
clarifications listed below:
1) may set the \"T\" field in the CoAP header to 0 or 1;
2) shall include the originating MSGin5G Client\'s address in an CoAP Option,
e.g. if the originating MSGin5G Client address is a URI, includes a Uri-Path
Option with the value of the URI;
3) shall set the CoAP Content-Format to \"50\", i.e. application/json; and
4) shall include the information elements specified in 3GPP TS 23.554 [2] in
the CoAP payload encoded in JSON format as specified in clause 7.3.4.3:
i) shall include an \"MSGin5G service identifier\" element to indicate that
this CoAP POST request is used for MSGin5G service;
ii) shall include an \"Originating UE Service ID\" element set to the UE which
sends the previous MSGin5G message;
iii) shall include the \"Message ID\" copied from the received MSGin5G message
which this Message response is responded to;
iv) may include a \"Delivery Status\" element to indicate that the delivery
status of this MSGin5G message is a failure, or is stored for deferred
delivery;
v) may include a \"Failure Cause\" element to indicate the reason for failure;
and
vi) in addition to the information elements specified in 3GPP TS 23.554 [2],
shall also include a \"Message Type\" element set to \"MSGRESP\" to indicate
that this message is a message response.
##### 6.4.1.2.3 Reception of an aggregated MSGin5G message
Upon receiving an CoAP POST request containing the MSGin5G Service identifier
and the \"Message Type\" with the value \"MSG\", if a \"Number of individual
messages\" and a \"List of individual messages\" are included, the MSGin5G
Server determines that this message is an aggregated MSGin5G message. The
MSGin5G Server shall handle the whole aggregated MSGin5G message according to
procedures specified in clause 6.4.1.2.2.
##### 6.4.1.2.4 Reception of an MSGin5G delivery status report
Upon receiving an CoAP POST request containing the MSGin5G Service identifier
and the \"Message Type\" with the value \"IMDN\", if the \"Number of
individual messages\" element and \"List of individual messages\" element are
not be included and a \"Delivery Status\" element is included, the MSGin5G
Server shall handle the CoAP POST request according to procedures specified in
IETF RFC 7252 [5] with no additional requirement.
##### 6.4.1.2.5 Reception of an aggregated MSGin5G delivery status report
Upon receiving an CoAP POST request containing the MSGin5G Service identifier
and the \"Message Type\" with the value \"IMDN\", if a \"Number of individual
messages\" and a \"List of individual messages\" are included, the MSGin5G
Server determines that this message is an aggregated MSGin5G message. The
MSGin5G Server shall handle the whole aggregated MSGin5G delivery status
report according to procedures specified in clause 6.4.1.2.4.
##### 6.4.1.2.6 Sending of an MSGin5G message
In order to deliver the MSGin5G message to an MSGin5G UE, the MSGin5G Server
shall send the MSGin5G message in an new CoAP message according to procedures
specified in IETF RFC 7252 [5] via MSGin5G-1 reference point. The sending of
the CoAP message shall follow the procedures below:
a) the MSGin5G Server shall set the \"T\" field in the CoAP header to 0 if
delivery status report from the recipient is requested, i.e. indicate that
this message is the type of Confirmable, to ensure the application layer
delivery status report;
b) the MSGin5G Server shall set the CoAP Content-Format to \"50\", i.e.
application/json;
c) The MSGin5G Server shall remove any \"Priority type\" element, \"Store and
forward flag\" and related \"Store and forward parameters\" elements from the
CoAP payload of the received message. If \"Message is segmented\" and related
elements is included in the received message, the MSGin5G Server shall handle
the message as specified in clause 6.5.3;
d) the MSGin5G Server shall determine the communication model of the message
by checking the recipient of the message as specified in clause 6.4.1.2.1 and
generate the new CoAP message:
1) if the Service ID of the recipient points to an MSGin5G Client, the MSGin5G
Server:
i) shall include the recipient MSGin5G Client address in an CoAP Option, e.g.
if the MSGin5G Client address is a URI, include a Uri-Path Option with the
value of the URI; and
ii) shall copy other elements in the CoAP payload of the received message to
the new CoAP POST request;
2) if the Service ID of the recipient points to an Application Server or a
Message Gateway, the MSGin5G Server shall follow the procedure specified in
3GPP TS 29.538 [7];
3) if the MSGin5G message is a Group message, the MSGin5G Server:
i) shall obtain the group members by checking the group profile with the
\"Group Service ID\" element included in the received MSGin5G message; and
ii) for each group member which is an MSGin5G UE, include its CoAP address got
from the recipient MSGin5G UE registration specified in clause 6.3.1.2 in an
CoAP Option, e.g. if the recipient client\'s address is a URI, includes a Uri-
Path Option with the value of the URI. The MSGin5G Server shall add the
\"Recipient UE Service ID\" element and set the value of it to the UE Service
ID. The MSGin5G Server shall also copy other elements in the CoAP payload of
the received message to the new CoAP POST request; and
4) if the MSGin5G message is needed to be distributed based on message topic,
the MSGin5G Server:
i) shall obtain the UE Service ID/AS Service ID of the subscribers by checking
the subscription with this Messaging Topic; and
ii) for each subscriber which is an MSGin5G UE, include its CoAP address got
from the recipient MSGin5G UE registration specified in clause 6.3.1.2 in an
CoAP Option, e.g. if the recipient client\'s address is a URI, includes a Uri-
Path Option with the value of the URI. The MSGin5G Server shall add the
\"Recipient UE Service ID\" element and set the value of it to the UE Service
ID. The MSGin5G Server shall also copy other elements in the payload of the
received message to the new CoAP 2.05 response.
e) before sending the new CoAP message generated in step d), the MSGin5G
Server shall compare the size of the new CoAP message to the maximum allowed
MSGin5G message segmentation size. If the size exceeds, the MSGin5G Server
shall segment the MSGin5G message into a set of segmented MSGin5G messages
such that each segmented MSGin5G message can fit within the maximum allowed
MSGin5G message segmentation size. For each segmented MSGin5G message, the
MSGin5G Server:
1) shall include a \"Message is segmented\" element with a \"true\" value to
indicate that this message is part of a segmented message;
2) shall include a \"Segmentation set identifier\" element to indicate that
this segmented message is associated within a set of segmented messages. The
same unique identifier is assigned to all segmented messages associated with
the same MSGin5G message;
3) shall include a \"Total number of message segments\" element in the first
segment of the MSGin5G message to indicate the total number of segments for
the MSGin5G message;
4) shall include a \"Message segment number\" element to indicate segmented
message number of each segmented message within the set of segmented messages;
and
5) shall include a \"Last segment flag\" element in the last segment in the
set of segmented messages; and
f) the MSGin5G Server checks the availability of recipient by checking the UE
registration status. The MSGin5G Server can also use UE reachability status
monitoring specified in 3GPP TS 29.538 [7] to determine whether the recipient
is available. If the recipient is available, the MSGin5G Server send the new
CoAP message generated as above to the recipient. If the recipient is
unavailable, the MSGin5G Server checks whether a \"Store and forward flag\"
element is included in the received MSGin5G message:
1) if the \"Store and forward flag\" element is not included, the MSGin5G
Server discards the message and may send a message response as specified in
clause 6.4.1.2.2 which includes delivery status information in the \"Delivery
Status\" element, e.g., that the message was discarded; and
2) if the \"Store and forward flag\" element is included:
i) the MSGin5G Server stores the message and uses the information obtained
from the \"Store and forward parameters\" element to determine the forwarding.
The MSGin5G Server may send a message response as specified in clause
6.4.1.2.2 which includes store and forward status information in the
\"Delivery Status\" element, e.g., the delivery had been deferred; and
ii) when the recipient UE becomes available, the MSGin5G Server attempts
delivery of the new CoAP message to the recipient. If the UE does not become
available prior to the time included in the \"Message expiration time\"
element, the MSGin5G Server attempts delivery of the new CoAP message at the
message expiration time and the stored message is discarded afterwards. The
MSGin5G Server may send a message response as specified in clause 6.4.1.2.2
which includes store and forward status information the \"Delivery Status\"
element, e.g., that the message was discarded.
##### 6.4.1.2.7 Sending of an aggregated MSGin5G message
If the MSGin5G Server receives an aggregated MSGin5G message as specified in
clause 6.4.1.2.3, and the received aggregated MSGin5G message is smaller than
the supported message segment size of the recipient, it shall send it as
specified in clause 6.4.1.2.6 without splitting the received aggregated
message request into multiple individual MSGin5G message.
If the received aggregated MSGin5G message is larger than the supported
message segment size of the recipient, the MSGin5G Server should remove the
last individual message in the List of individual messages element from the
aggregated message until the aggregated message is smaller than the maximum
segmentation size that can be transmitted over available transport, and then
send the remaining aggregated MSGin5G message as specified in clause
6.4.1.2.6. The MSGin5G messages removed from the aggregated message may be
sent individually or aggregated again by the MSGin5G Server according to
service configuration.
NOTE: Aggregated MSGin5G message is supported by all MSGin5G Clients and
Application Servers. MSGin5G message and MSGin5G delivery status report cannot
be aggregated in the same aggregated MSGin5G message.
If the MSGin5G Server receives an MSGin5G message as specified in clause
6.4.1.2.2, it may send multiple MSGin5G messages toward the same recipient in
an aggregated MSGin5G message. Before the sending of an MSGin5G message, the
MSGin5G Server shall check if aggregation is allowed for this message, MSGin5G
Server shall also check the message data size, and the priority level to
determine if the message can be aggregated. For example, if the MSGin5G Server
finds that the received messages have small payload size when compared to the
maximum segment size that can be transmitted over CoAP and the messages are
not high priority messages, which could be sent as per scheduling policy
towards a selected target. The MSGin5G Server can decide to aggregate messages
until optimal use of segment size before sending message towards MSGin5G
Client.
If the message can be aggregated, the MSGin5G Server aggregates multiple
MSGin5G messages, and sends the aggregated message in a single CoAP POST
request message. The sending of the CoAP POST request message shall follow the
procedures specified in clause 6.4.1.2.6 with the clarifications listed below:
a) The MSGin5G Server should not segment the aggregated message, so the
MSGin5G Server should ensure that the new aggregated MSGin5G message is
smaller than the maximum allowed MSGin5G message segmentation size and skips
the step e) in clause 6.4.1.2.6. The \"Message is segmented\", \"Segmentation
set identifier\", \"Total number of message segments\", \"Message segment
number\" and \"Last segment flag\" elements should not be included in the
aggregated MSGin5G message.
b) In addition to the elements specified in clause 6.4.1.2.6, the MSGin5G
Server should include a \"Number of individual messages\" element in this
message to indicate the total number of messages which are aggregated into
this single message.
c) In addition to the elements specified in clause 6.4.1.2.6, the MSGin5G
Server should include a \"List of individual messages\" element in this
message. Each child element of this \"List of individual messages\" element
contains information elements listed below:
1) \"Message ID\" of the individual message;
2) \"Payload\" which carries the application payload that is transferred by
the individual MSGin5G message;
3) one or more optional \"Application ID\" element(s);
4) an optional \"Delivery status required\" element; and
5) an optional \"Priority type\" element.
##### 6.4.1.2.8 Sending of an MSGin5G delivery status report
Upon receiving an MSGin5G delivery status report as specified in clause
6.4.1.2.4, the MSGin5G Server may generate a new CoAP POST request contains
the MSGin5G delivery status report if the MSGin5G Server decides not to
aggregate the delivery status report. The new CoAP POST request is sent to the
recipient obtained from the \"Recipient UE Service ID\" element in the payload
of the received CoAP POST request. The MSGin5G Server:
a) shall set the \"T\" field in the CoAP header to 0;
b) shall include the recipient address in the Option header of the CoAP
message and set the Option header to a corresponding value, e.g. if the
MSGin5G Client address is a URI, includes a Uri-Path Option with the value of
the URI; and
c) shall copy other elements in the payload of the received message to the new
CoAP POST request.
##### 6.4.1.2.9 Sending of a aggregated MSGin5G delivery status report
If the MSGin5G Server receives an aggregated MSGin5G delivery status report as
specified in clause 6.4.1.2.5, it shall generate a new CoAP POST request
contains the aggregated MSGin5G delivery status report and sends it to the
recipient obtained from the \"Recipient UE Service ID\" element in the payload
of the received CoAP POST request. The MSGin5G Server:
a) shall set the \"T\" field in the CoAP header to 0;
b) shall include the recipient address in the Option header of the CoAP
message and set the Option header to a corresponding value, e.g. if the
MSGin5G Client address is a URI, includes a Uri-Path Option with the value of
the URI; and
c) shall copy other elements in the payload of the received message to the new
CoAP POST request.
If the MSGin5G Server receives MSGin5G delivery status report as specified in
clause 6.4.1.2.4, it may aggregate multiple MSGin5G message delivery status
reports into one single message. The MSGin5G Server shall check whether the
MSGin5G message delivery status reports can be aggregated as specified in
clause 6.4.1.2.7.
If the MSGin5G message delivery status reports can be aggregated, the MSGin5G
Server aggregates MSGin5G message delivery status reports intended for a
selected target and sends the aggregated MSGin5G message delivery status
reports in a single CoAP POST request message. The sending of the CoAP POST
request message shall follow the procedures specified in clause 6.4.1.2.6 with
the clarifications listed below:
a) In step d) of clause 6.4.1.2.6, the \"Delivery Status\" element and the
\"Failure Cause\" element in payload of every individual MSGin5G message
should not be copied to the payload of the new CoAP POST request message.
b) In addition to the step d) of clause 6.4.1.2.6, the MSGin5G Server should
include a \"Number of individual messages\" element in this message to
indicate the total number of MSGin5G message delivery status reports which are
aggregated into this single message.
c) In addition to the step d) of clause 6.4.1.2.6, the MSGin5G Server should
include a \"List of individual messages\" element in this message. Each child
element of this \"List of individual messages\" element contains information
elements listed below:
1) \"Message ID\" of the individual MSGin5G message delivery status reports
which is copied from the MSGin5G message that is being acknowledged;
2) \"Delivery Status\" element copied from the individual MSGin5G message
delivery status report; and
3) an optional \"Failure Cause\" element copied from the individual MSGin5G
message delivery status report.
### 6.4.2 Message delivery and message delivery status report delivery for
Constrained UE
#### 6.4.2.1 General
Clause 6.4.2.2 and 6.4.2.3 define the procedures used for message or message
delivery report sending/receiving over MSGin5G-5.
In the procedures, for delivering messages or message delivery reports to
MSGin5G Client in MSGin5G Gateway UE, the Application Client in Constrained UE
may use any message format or protocol supported by the MSGin5G Client.
NOTE 1: How the Application Client knows the message protocol/format supported
by the MSGin5G Client is out of scope of this specification.
In the procedures, for delivering messages or message delivery reports to
Application Client in Constrained UE, the MSGin5G Client in MSGin5G Gateway UE
may use any message format or protocol supported by the Application Client.
NOTE 2: How the MSGin5G Client knows the message protocol/format supported by
the Application Client is out of scope of this specification.
Annex A lists some message formats/protocols examples (only for implementation
reference) which may be used for the interaction between Application Client in
Constrained UE and MSGin5G Client in MSGin5G Gateway UE over MSGin5G-5.
Clauses 6.4.2.4 and 6.4.2.5 define the procedures used for MSGin5G message or
MSGin5G message delivery report sending/receiving over MSGin5G-6. The MSGin5G
Relay UE relays the CoAP POST request/response as traffic between the MSGin5G
Server and the Constrained UE.
#### 6.4.2.2 Procedure at MSGin5G Gateway UE
##### 6.4.2.2.1 Sending of an message to Constrained UE
Upon successfully receiving a MSGin5G message including an Application ID from
MSGin5G Server, if the Application ID is registered by an Application Client
in Constrained UE, based on Constrained UE registration information, the
MSGin5G Client on the MSGin5G Gateway UE shall send a request/message to the
Application Client, including the following information elements:
a) the Message Type IE with the value "MESSAGE RECEIVED REQUEST" indicating
the request/message is for delivering a message;
b) the Message ID IE with the unique identity of this message;
c) if the received message is a point-to-point or application-to-point
message, the Originator Address IE indicating the originating UE or AS;
d) if the received message is a group message, the Group ID IE indicating the
originating group;
NOTE: the information included in the Originator Address IE is generated based
on the received originating UE/AS Service ID, the information included in the
Group ID IE is generated based on received Group Service ID. How to generate
the value of Originator Address IE and Group ID IE is implementation specific.
e) the Payload IE indicating the application message content included in the
received message;
f) if the delivery status report is required by the originator, the Delivery
Status Required IE with "true"; and
g) optionally, the Priority IE indicating the application priority level.
##### 6.4.2.2.2 Reception of an message from Constrained UE
Upon receiving a request from Application Client in Constrained UE, and the
request is for initiating a MSGin5G message, i.e. with Message Type IE set to
"MESSAGE SENDING REQUEST", the MSGin5G Client in the MSGin5G Gateway UE shall
construct and send a CoAP POST request to MSGin5G Server as specified in
clause 6.4.1.1.2. The MSGin5G Client generates the Recipient UE Service ID/AS
Service ID based on Target address IE the included in the request from the
Constrained UE.
If the Constrained UE indicates "UE" in the Target Type IE, the Target Address
shall include information of another MSGin5G Client, i.e. it shall not
indicate a Constrained UE without MSGin5G Client.
If an IPv4 or IPv6 address is included in the Target Address, the MSGin5G
Client generates the Recipient UE Service ID/AS Service ID based on the
mapping between the addresses and UE Service IDs/AS Service IDs stored in the
MSGin5G UE.
If the Constrained UE indicates "UE" in the Target Type IE, in order to route
the MSGin5G message to the correct target MSGin5G Client, the Target Address
may indicate an FQDN.
When the MSGin5G Client cannot generate the Recipient UE Service ID/AS Service
ID based on Target address IE, the MSGin5G Client generates the request
message to the Application Client in Constrained UE as specified in clause
6.4.2.2.3 if the Delivery status required IE indicates "DELIVERY REPORT
REQUIRED ". Otherwise, the MSGin5G Client discards the request from the
Constrained UE.
##### 6.4.2.2.3 Sending of a message delivery status report to Constrained UE
Upon receiving a MSGin5G message delivery status report request including an
Application ID from MSGin5G Server, and the Application ID is registered by
the Application Client on Constrained UE, based on the Constrained UE
registration information, the MSGin5G Client on the MSGin5G Gateway UE shall
send a request/response message to the Application Client, in the request,
including the following information elements:
a) the Message Type IE with the value \"DELIVERY REPORT RECEIVED REQUEST\"
indicating the request/message is for delivering a message delivery status;
b) the Message ID IE with the unique identity of this message delivery report;
c) the Reply-to Message ID IE indicating the delivery status is for which
message; and
d) the Delivery Status IE indicating the delivery status.
##### 6.4.2.2.4 Reception of an message delivery status report from
Constrained UE
Upon receiving a request/response from Application Client in Constrained UE,
and the request is for delivering a message delivery report, i.e. with Message
Type IE set to \"DELIVERY REPORT SENDING REQUEST\", the MSGin5G Client in the
MSGin5G Gateway UE shall construct and send a CoAP POST request to MSGin5G
Server as specified in clause 6.4.1.1.4.
##### 6.4.2.2.5 Sending of an message sending response to Constrained UE
Upon received the message request from Application Client in Constrained UE,
the MSGin5G Client in the MSGin5G Gateway UE sends a response to the
Application Client including the following information elements:
a) the Message Type IE with the value \"MESSAGE SENDING RESPONSE\" indicating
this is a response to the message sending request.
b) the Result IE indicating success or failure of the message sending request;
and
c) optionally, the Failure Reason IE indicating the reason of failure when the
Result IE is set to failure.
#### 6.4.2.3 Procedure at Constrained UE
##### 6.4.2.3.1 Sending of an message via MSGin5G Gateway UE
In order to initiate an MSGin5G message by using the MSGin5G Client in MSGin5G
Gateway UE, the Application Client in Constrained UE shall send a
request/message to the MSGin5G Client including the following information
elements:
a) the Message Type IE with the value \"MESSAGE SENDING REQUEST\" indicating
the request/message is for initiating a MSGin5G message;
b) the Message ID IE with the unique identity of this message;
c) the Target Address IE with the information for MSGin5G Client to generate
the Recipient UE/AS/Group Service ID in the MSGin5G message request;
d) optionally, the Target Type IE indicating the type of the message
recipient, with \"UE\" if the message is sent to a UE, with \"AS\" if the
message is sent to an Application Server, or with \"GROUP\" if message is sent
to a MSGin5G Group;
e) optionally, the Application ID IE indicating the application(s) for which
the payload is intended;
f) the Payload IE including the application content of the message to send to
the recipient; and
g) optionally, the Delivery Status Required IE with the value \"true\" if
delivery status report is required.
##### 6.4.2.3.2 Sending of an MSGin5G message delivery status report via
MSGin5G Gateway UE
In order to sending an message delivery report by using the MSGin5G Client in
MSGin5G Gateway UE, the Application Client in Constrained UE shall send a
request/response to the MSGin5G Client including the following information
elements:
a) the Message Type IE with the value \"DELIVERY REPORT SENDING REQUEST\"
indicating the request/response is for sending a delivery status report;
b) the Message ID IE with the unique identity of this message delivery report;
c) the Reply-to Message ID IE copied from the received message, to indicate
the delivery status is for which message; and
d) the Delivery Status IE with delivery status.
##### 6.4.2.3.3 Sending of a message received response to MSGin5G Gateway UE
Upon received the message request from MSGin5G Client in MSGin5G Gateway UE,
the Application Client in the Constrained UE sends a response to the MSGin5G
Client, including the following information elements:
a) the Message Type IE with the value \"MESSAGE RECEIVED RESPONSE\" indicating
the request/message is for initiating a MSGin5G message.
b) the Result IE indicating success or failure of the message received
request; and
c) optionally, the Failure Reason IE indicating the reason of failure when the
Result IE is set to failure.
#### 6.4.2.4 Procedure at MSGin5G Relay UE
##### 6.4.2.4.1 Sending of an MSGin5G message to Constrained UE with MSGin5G
Client
When the MSGin5G Client-1 on the MSGin5G Relay UE receives a CoAP POST request
from UDP port 65401and the recipient\'s address included in the CoAP Option is
set to another MSGin5G Client-2 which has established a connection for One-to-
one ProSe Direct Communication with it as specified in 3GPP TS 23.304[9], the
MSGin5G Relay UE acts as either 5G ProSe Layer-2 and Layer-3 UE-to-Network
Relay entity as specified in 3GPP TS 23.304 [9] and relays the CoAP POST
request as a downlink traffic to the MSGin5G Client-2, Otherwise the MSGin5G
Client-1 shall discard the CoAP POST request and may send a CoAP 4.04 (Not
Found) response to the MSGin5G Server.
##### 6.4.2.4.2 Reception of an MSGin5G message from Constrained UE with
MSGin5G Client
When the MSGin5G Client on the MSGin5G Relay UE receives a CoAP POST request
from UDP port 65401and the recipient\'s address included in the CoAP Option is
set to the MSGin5G Server, the MSGin5G Relay UE acts as either 5G ProSe
Layer-2 and Layer-3 UE-to-Network Relay entity as specified in 3GPP TS 23.304
[9] and relays the CoAP POST request as a uplink traffic to the MSGin5G
Server.
#### 6.4.2.5 Procedure at MSGin5G Client in Constrained UE
##### 6.4.2.5.1 Sending of an MSGin5G message
In order to send an MSGin5G message or MSGin5G message delivery status report,
the MSGin5G Client shall use the procedures specified in clause 6.4.1.1.2,
6.4.1.1.3, 6.4.1.1.4 and 6.4.1.1.5.
##### 6.4.2.5.2 Reception of an MSGin5G message
Upon receiving an CoAP POST request and the recipient\'s address included in
the CoAP Option is set to the MSGin5G Client itself, the MSGin5G Client shall
handle the CoAP Post request as specified in clause 6.4.1.1.6, 6.4.1.1.7,
6.4.1.1.8 and 6.4.1.1.9.
## 6.5 MSGin5G Message Segmentation and Reassembly
### 6.5.1 Segment recovery and received confirmation procedures
The Message Sender in this clause can only be the MSGin5G Client (when the
message is from MSGin5G Client) or MSGin5G Server (when the message is from
Application Server).
The Message Receiver in this clause can only be the MSGin5G Client (when the
message is targeted to an MSGin5G Client) or MSGin5G Server (when the message
is targeted to an Application Server).
#### 6.5.1.1 Procedure at Message Sender
Upon receiving a CoAP POST request containing the MSGin5G service identifier
and containing the Message Type with a value \"SEGREC\" which indicates the
request is for messgage segment recovery, the MSGin5G Client shall send a CoAP
ACK response to the request. Then the MSGin5G Client shall send all requested
segmented messages as requested in the received \"List of Segment range\"
element to the message receiver (e.g. Application Server, UE) as specified in
6.4.1.1.2.
#### 6.5.1.2 Procedure at Message Receiver
##### 6.5.1.2.1 Segments recovery procedure when failed to receive all
segments
If not all segments are received within expected time, the Message Receiver
shall send a CoAP POST request to the Message Sender for recovering the
segments which are not received. In the CoAP POST request, the Message
Receiver:
a) shall set the \"T\" field in the CoAP header to 0 to indicate this request
is the type of Confirmable;
b) shall include the Message Sender address in a CoAP Option, e.g. if the
Message Sender address is a URI, includes a Uri-Path Option with the value of
the URI;
c) shall set the CoAP Content-Format to \"50\", i.e. application/json; and
d) shall include the following information elements in the CoAP payload
encoded in JSON format:
1) an \"MSGin5G service identifier\" element to indicate that this CoAP POST
request is used for MSGin5G service;
2) a \"Message Type\" element with a value \"SEGREC\" to indicate that this
request is for segments recovery;
3) a \"Segmentation Set Identifier\" element copied from one of the previous
received segments; and
4) a \"List of Segment range\" element to indicate the segments range which
the client wants to recover, each segment range consist of start and end
sequence number of missing segments e.g. (5-7, 10-10, 15-19).
If not all segments are received within the expected time (based on
configuration), the Message Receiver may consider that the recovery is failed.
The Message Receiver may initiate the procedure again with updated list of
segment range.
NOTE: The MSGin5G message segment recovery procedure may repeat based on the
configuration.
The corresponding JSON Schema used in step d) is defined in clause 7.3.6.2.
##### 6.5.1.2.2 Segments received confirmation procedure
If the Message Receiver determines that it receives all segments successfully,
or the Message Receiver determines that it is failed (including recovery
failed) to receive all segments, the Message Receiver sends the message
segments received confirmation to the Message Sender by a CoAP POST request.
In the CoAP POST request, the Message Receiver:
a) shall set the \"T\" field in the CoAP header to 0 to indicate this request
is the type of Confirmable;
b) shall include the Message Sender address in a CoAP Option, e.g. if the
Message Sender address is a URI, includes a Uri-Path Option with the value of
the URI;
c) shall set the CoAP Content-Format to \"50\", i.e. application/json; and
d) shall include the following information elements in the CoAP payload
encoded in JSON format:
1) the \"MSGin5G service identifier\" element to indicate that this CoAP POST
request is used for MSGin5G service;
2) the \"Message Type\" element with a value \"SEGCONFIR\" to indicate that
this request is for sending message segments received confirmation;
3) the \"Segmentation Set Identifier\" element copied from one of the previous
received segments; and
4) the \"Result\" element to indicate whether the segments are received
successful or failed.
The corresponding JSON Schema used in step d) is defined in 7.3.6.1.
### 6.5.2 Procedure at MSGin5G Client
#### 6.5.2.1 Procedure at MSGin5G Client in Sending UE
To support MSGin5G Message segmentation and reassembly, the Message Client
performs the procedures specified in 6.4.1.1.2, and acts as Message Sender to
perform the procedures in clause 6.5.1.1 if needed. When the MSGin5G Client
performs the procedures in clause 6.5.1.1, the MSGin5G Server acts as Message
Receiver.
#### 6.5.2.2 Procedure at MSGin5G Client in Recipient UE
Upon receiving an MSGin5G message, to support MSGin5G Message segmentation and
reassembly, the MSGin5G Client performs the procedures in 6.4.1.1.6, and acts
as Message Receiver to perform the procedures in clause 6.5.1.2 if needed.
When the MSGin5G Client performs the procedures in clause 6.5.1.2, the MSGin5G
Server acts as Message Sender.
### 6.5.3 Procedure at MSGin5G Server
#### 6.5.3.1 General
When the MSGin5G Server receives a message which is not segment message, the
MSGin5G Server should follow the procedures in clause 6.4.1.2.6 to perform
potential segment if needed (i.e. if the received message size exeeds the
maxmium allowed MSGin5G message segmentation size of the target UE).
This following clauses specify the procedures when the MSGin5G Server receives
segemented message delivery request, messgage segments recovery request or
messgage segments received confirmation request.
#### 6.5.3.2 Procedures on receiving message segments targeting to a MSGin5G
UE
Upon receiving a message segment targeting to MSGin5G UE, the MSGin5G Server
checks if the segment size exceeds the configured maximum message segment size
of the targeted UE,
a) if exceed, upon receiving all segments,
1) reassembles them into a single MSGin5G message;
2) splits the re-assembled message to segments such that each segment is
smaller than the maximum allowed message segment size of the targeted UE; and
3) sends each new segment to the target MSGin5G UE as specified in clause
6.4.1.2.6; and
b) if not exceed, upon receiving all segments, sends each segment to the
target MSGin5G UE as specified in clause 6.4.1.2.6.
#### 6.5.3.3 Procedures on receiving message segments targeting to an
Application Server
Upon receiving all message segments from MSGin5G UE to an Application Server,
the MSGin5G Server shall reassemble them into a single MSGin5G message and
sends it to the Application Server as specified in TS 29.538 [7].
Upon receiving message segments from MSGin5G UE to an Application Server, the
MSGin5G Server acts as a Message Receiver to perform the procedures specified
in clause 6.5.1.2.1 and in clause 6.5.1.2.2 if needed. In these procedures,
the MSGin5G Client in the MSGin5G UE acts as Message Sender.
#### 6.5.3.4 Procedures on receiving message segments recovery request to a
MSGin5G UE
Upon receiving a CoAP POST request containing the MSGin5G service identifier
and containing the Message Type with a value \"SEGREC\" indicating the request
is for messgage segment recovery, if the request is targeted to an MSGin5G UE,
the MSGin5G Server shall construst a new CoAP POST request to the targeted UE.
In the request, the MSGin5G Server:
a) shall construct the new CoAP POST request with the corresponding value in
the recevied CoAP POST request message except the Option header; and
b) shall include the MSGin5G Client address in the Option header of the CoAP
message and set the Option header to a corresponding value, e.g. if the
MSGin5G Server address is a URI, the Uri-Path Option is set to the value of
such URI.
#### 6.5.3.5 Procedures on receiving message segments received confirmation to
a MSGin5G UE
Upon receiving a CoAP POST request containing the MSGin5G service identifier
and containing the Message Type with a value \"SEGCOFIR\" indicating the
request is for message segments received confirmation, if the request is
targeted to an MSGin5G UE, the MSGin5G Server shall construst a new CoAP POST
request to the targeted UE. In the request, the MSGin5G Server:
a) shall construct the new CoAP POST request with the corresponding value in
the received CoAP POST request message except the Option header; and
b) shall include the MSGin5G Client address in the Option header of the CoAP
message and set the Option header to a corresponding value, e.g. if the
MSGin5G Server address is a URI, the Uri-Path Option is set to the value of
such URI.
## 6.6 Messaging Topic Subscription and Unsubscription
### 6.6.1 General
As specified in 3GPP TS 23.554 [2], an MSGin5G Client may subscribe one or
more Messaging Topics on the MSGin5G Server.
The message topic subscription and unsubscription are based on the CoAP
Observe method as specified in IETF RFC 7641 [4], the MSGin5G Client acts as
an observer, the MSGin5G Server acts as a CoAP Server, the message topic is a
resource to observe.
### 6.6.2 Procedure at MSGin5G Client
#### 6.6.2.1 Messaging Topic Subscription
Upon receiving a request to subscribe a messsage topic from an Application
Client, MSGin5G Client shall send a CoAP GET request, as specified in IETF RFC
7641 [4], to the MSGin5G Server. In the CoAP GET request, the MSGin5G Client:
a) shall set the \"T\" field in the CoAP header to the value \"0\" to indicate
this request is the type of Confirmable;
b) shall include the MSGin5G Server address in the Option header and set the
Option header to a corresponding value, e.g. if the MSGin5G Server address is
a URI, the Uri-Path Option is set to the value of such URI;
c) shall include the message topic name in the Uri-Path Option (e.g.
\"\top\");
d) shall include the Observe Option with the value \"0\" which indicates the
request is for observing a resource, i.e. for subscribing a message topic;
e) shall include the Content-Format Option with the value \"50\" which
indicate the format of the CoAP payload is \"application/json\" as specified
in RFC 7252 [5]; and
f) shall include the CoAP Payload in JSON format, including the following
information elements as specified in clause 8.8.1 of 3GPP TS 23.554 [2]:
1) an \"Originating UE Service ID\" element set to the MSGin5G UE which
requests the message topic subscription; and
2) optionally, an \"Expiration time\" element which indicates the expiration
time of the message topic subscription.
The corresponding JSON Schema used in step g) is defined in clause 7.3.5.1.
#### 6.6.2.2 Messaging Topic Unsubscription
If the MSGin5G Client needs to unsubscribe a messsage topic, as specified in
RFC 7641 [4], the MSGin5G Client shall send a CoAP GET request to MSGin5G
Server. In the request, the MSGin5G Client:
a) shall set the \"T\" field in the CoAP header to the value \"0\" to indicate
this request is the type of Confirmable;
b) shall include the MSGin5G Server address in the Option header and set the
Option header to a corresponding value, e.g. if the MSGin5G Server address is
a URI, the Uri-Path Option is set to the value of such URI;
c) shall include the message topic name in the Uri-Path Option (e.g.
\"\top\");
d) shall include the Observe Option with the value \"1\" which indicates the
observer request to cancel the previous resource observation, i.e. the MSGin5G
Client requests to unsubscribe the message topic;
e) shall include the Content-Format Option with the value \"50\" which
indicate the format of the CoAP payload is \"application/json\" as specified
in RFC 7252 [5]; and
e) shall include the CoAP Payload in JSON format and an \"Originating UE
Service ID\" element indicating the MSGin5G UE which requests the message
topic unsubscription shall be included in the CoAP Payload.
The corresponding JSON Schema used in step g) is defined in 7.3.5.2.
### 6.6.3 Procedures at MSGin5G Server
The MSGin5G Server should support parsing CoAP request as specified in RFC
7252 [5] and RFC 7641 [4].
Upon receiving a CoAP GET request from MSGin5G Client, the MSGin5G Server
shall parse the CoAP headers, Options and Payload in the request to get:
a) the value of Observe Option;
b) the message topic from the Uri-Path Option;
c) the Originating UE Service ID from the Payload; and
d) the Expiration time from the Payload if exists in the Payload.
#### 6.6.3.1 Messaging Topic Subscription
If the Observe Option is included in the CoAP GET request with a value \"0\"
as specified in RFC 7641 [4], the MSGin5G Server shall:
a) if the message topic does not exist, create the message topic;
b) if the Originating UE Service ID is not in the list of the subscribers of
the message topic, add the Originating UE Service ID to the list of the
subscribers of the topic, and record its expiration time if exists;
c) if an entry with a matching Originating UE Service ID is already present in
the list of the subscribers of the message topic, updates the expiration time
of the subscription of this UE; and
d) send a CoAP Notifications with a 2.05 (Content) response code to the
MSGin5G Client and with CoAP Payload in JSON format, including the following
information elements as specified in clause 8.8.1 of 3GPP TS 23.554 [2]:
1) a \"subscription status\" element set to indicate whether the subscription
was successfully added or deleted on the MSGin5G Server; and
2) optionally, an \"Expiration time\" element set to indicate the expiration
time of the message topic subscription.
The MSGin5G Server shall remove the Originating UE Service ID from list of the
subscribers of the message topic when the expiration time reached.
#### 6.6.3.2 Messaging Topic Unsubscription
If the Observe Option is included in the received CoAP GET request with a
value \"1\" as specified in RFC 7461 [4], the MSGin5G Server shall handle the
CoAP GET request according to procedures specified in IETF RFC 7252 [5] with
the clarifications listed below:
a) if the message topic exists, the MSGin5G Server shall remove the
Originating UE Service ID from list of the subscribers of the message topic;
and
b) the MSGin5G Server sends a CoAP Notifications with a 2.05 (Content)
response code to the MSGin5G Client, and with CoAP Payload in JSON format. A
\"subscription status\" element set to indicate whether the subscription was
successfully added or deleted on the MSGin5G Server shall be included in this
CoAP Payload as specified in clause 8.8.3 of 3GPP TS 23.554 [2].
## 6.7 Void
## 6.8 Usage of SEAL
### 6.8.1 General
The MSGin5G Service functional entities MSGin5G Client and MSGin5G Server
utilize the SEAL services. All SEAL services specified in 3GPP TS 24.544 [10],
3GPP TS 24.545 [11], 3GPP TS 24.546 [12], 3GPP TS 24.547 [13] and 3GPP TS
24.548 [14] are available to MSGin5G Service. In this clause, the procedures
whose utilization by MSGin5G Service are well-known are described.
NOTE: If SEAL client is co-located with MSGin5G client, then MSGin5G client
act as a SEAL client to perform procedures. If SEAL client is not co-located
with MSGin5G client, then the interaction between MSGin5G client and SEAL
client is implementation specific.
### 6.8.2 Configuration management service
#### 6.8.2.1 General
The MSGin5G Client and MSGin5G Server utilize configuration management service
procedures of SEAL to support MSGin5G Service. The procedure to fetch VAL UE
configuration data specified in clause 6.2.3 of 3GPP TS 24.546 [12] is
applicable for the configuration management services of the MSGin5G Service.
The MSGin5G UE configuration data is specified in clause 7.2.
### 6.8.3 Group management service
#### 6.8.3.1 General
The MSGin5G Client and MSGin5G Server utilize group management service
procedures of SEAL to support MSGin5G Service. The following procedures of
group management service of SEAL as specified in 3GPP TS 24.544 [10] are
applicable for the MSGin5G Service:
a) Group creation specified in clause 6.2.2; with following clarification:
1) Upon receiving Group Creation notification as specified in clause of 3GPP
TS 24.544 [10], for list of VAL user IDs or VAL UE IDs which does not have
group management client on the UE (e.g. Legacy 3GPP UEs or Non-3GPP UEs), the
MSGin5G server initiate the group creation notification towards those UEs;
b) Group configuration management specified in clause 6.2.5; and
c) Group membership update specified in clause 6.2.4.
# 7 Coding
## 7.1 General
This clause contains the information elements coding for the messages used in
the procedures described in the present document.
In order to identify the usage of messages, in addition to the information
elements specified in 3GPP TS 23.554 [2], a \"Message Type\" element shall be
added to each message. The possible values of \"Message Type\" element are
listed below:
a) \"REG\" refers to Registration;
b) \"DEREG\" refers to de-registration;
c) \"MSG\" refers to MSGin5G message;
d) \"MSGRESP\" refers to message response; and
e) \"IMDN\" refers to MSGin5G delivery status report\";
f) \"SEGREC\" refers to segments recovery; and
g) \"SEGCONFIR\" refers to message segments received confirmation.
## 7.2 MSGin5G UE Configuration data
### 7.2.1 General
This clause specified the extension of the SEAL UE configuration document as
defined in 3GPP TS 24.546 [6].
### 7.2.2 Application unique ID
The AUID shall be set to the unique service identifier of MSGin5G service as
specified in 3GPP TS 23.554 [2]
### 7.2.3 Structure
The MSGin5G UE configuration document structure is described in clause 7.2 of
3GPP TS 24.546 [6] with the MSGin5G specific clarifications specified in this
clause.
The \ element of the \ element specified in
clause 7.2 of 3GPP TS 24.546 [6]:
a) shall include a \ element;
b) shall include a \ element; and
c) may include a \ element.
### 7.2.4 XML schema
#### 7.2.4.1 General
The MSGin5G UE configuration document is composed according the XML schema
described in the clause 7.2 of 3GPP TS 24.546 [6], and extended with
extensions from the XML schema defined in clause 7.2.4.2.
#### 7.2.4.2 XML schema for MSGin5G specific extensions
\
\
\
\
\
\
\
### 7.2.5 Data semantics
The \ element in \ element is MSGin5G UE ID
as specified in TS 23.554 [2].
The \ element in \ element is MSGin5G
service ID.
The \ element in \ element of \ element is the address information of the initial MSGin5G
Server serving the MSGin5G Client.
The \ element in \ element of \ element is the MSGin5G UE Service ID as specified in TS 23.554
[2].
The \ element in \ element of \ element is the segment size used for the MSGin5G UE to do
message segmentation, the payload size of every segmented message will not
exceed the segment size.
### 7.2.6 MIME types
The MIME type for the MSGin5G UE configuration document shall use the MIME
type as specified in the clause 7.2.6 of 3GPP TS 24.546 [6].
## 7.3 MSGin5G message structure
### 7.3.1 General
This clause defines the JSON schema of the body of CoAP requests realizing the
MSGin5G message. The schema is based on JSON Schema Draft-07 [8]. For reducing
the overhead of MSGin5G message, the properties are defined as shorten form
and the relationship between the properties and IEs used in clause 6 are
described in the description of the properties.
### 7.3.2 Configuration
#### 7.3.2.1 MSGin5G UE Configuration structure
The schema is based on JSON Schema Draft-07 [8]. For reducing the overhead of
the message used in MSGin5G service, the properties are defined as shorten
form and the relationship between the properties and IEs used in clause 6.2
are described in the description of the properties, The JSON schema is defined
below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/MSGin5G_UE_Configuration_schema\",
\"title\": \"MSGin5G_UE_Configuration\",
\"type\": \"object\",
\"properties\": {
\"ueId\": {
\"type\": \"string\",
\"description\": \"Refer to MSGin5G UE ID\"
},
\"addInfos\": {
\"type\": \"array\",
\"description\": \"Refer to other related informations\",
\"items\": {
\"\$ref\": \"#/\$defs/AddInfo\"
}
}
},
\"required\": [\"ueId\"],
\"\$defs\": {
\"AddInfo\": {
\"type\": \"object\",
\"properties\": {
\"name\": {
\"type\": \"string\"
},
\"value\": {
\"type\": \"string\"
}
},
\"required\": [\"name\", \"value\"]
}
}
}
### 7.3.3 Registration
#### 7.3.3.1 MSGin5G UE Registration structure
The schema is based on JSON Schema Draft-07 [8]. For reducing the overhead of
the message used in MSGin5G service, the properties are defined as shorten
form and the relationships between the properties and elements used in clause
6.3.1.1.1 are described in the description of the properties. The JSON schema
of the CoAP POST request for the MSGin5G registration is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/MSGin5G_Registration_request_schema\",
\"title\": \"MSGin5G Registration Request\",
\"type\": \"object\",
\"properties\": {
\"msgIden\": {
\"type\": \"string\",
\"format\": \"uri\",
\"description\": \"Refer to Service identifier of MSGin5G service\"
},
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"REG\"
],
\"description\": \"Refer to the usage of this message. The value REG refers to
MSGin5G Registration\"
},
\"oriAddr\": {
\"type\": \"object\",
\"properties\": {
\"oriAddrType\": {
\"enum\": [
\"UE\"
]
},
\"addr\": {
\"type\": \"string\"
}
},
\"description\": \"Refer to Originating UE Service ID\"
},
\"cliProfile\": {
\"type\": \"object\",
\"properties\": {
\"triInfo\": {
\"type\": \"object\",
\"properties\": {
\"ueId\": {
\"type\": \"string\",
\"format\": \"uri\",
\"description\": \"Refer to MSGin5G UE ID\"
},
\"cliPort\": {
\"type\": \"string\",
\"description\": \"Refer to MSGin5G Client Ports\"
}
},
\"required\": [
\"ueId\",
\"cliPort\"
],
\"description\": \"Refer to MSGin5G Client Triggering Information\"
},
\"comAvail\": {
\"type\": \"object\",
\"properties\": {
\"schTime\": {
\"type\": \"string\",
\"format\": \"date-time\",
\"description\": \"Refer to Scheduled Communication Time\"
},
\"durTime\": {
\"type\": \"string\",
\"format\": \"date-time\",
\"description\": \"Refer to Communication Duration Time\"
},
\"periIndi\": {
\"type\": \"boolean\",
\"default\": false,
\"description\": \"Refer to Periodic Communication Indicator\"
},
\"periInterval\": {
\"type\": \"string\",
\"format\": \"date-time\",
\"description\": \"Refer to Periodic Communication Interval\"
},
\"dataSize\": {
\"type\": \"string\",
\"description\": \"Refer to Data Size Indication\"
},
\"storeForward\": {
\"type\": \"string\",
\"description\": \"Refer to Store and Forward Option\"
}
},
\"description\": \"Refer to MSGin5G Client Communication Availability\"
}
},
\"description\": \"Refer to MSGin5G Client Profile\"
}
},
\"required\": [
\"msgIden\",
\"oriAddr \",
\"secCred\"
]
}
The schema is based on JSON Schema Draft-07 [8]. For reducing the overhead of
the message used in MSGin5G service, the properties are defined as shorten
form and the relationships between the properties and elements used in clause
6.3.1.2.1 are described in the description of the properties. The JSON schema
of CoAP 2.01 (Created) response or CoAP 2.04 (Change) response for the MSGin5G
registration is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\":
\"http://www.3gpp.org/MSGin5G/MSGin5G_Registration_response_schema\",
\"title\": \"MSGin5G Registration Response\",
\"type\": \"object\",
\"properties\": {
\"oriAddr\": {
\"type\": \"object\",
\"properties\": {
\"oriAddrType\": {
\"enum\": [
\"UE\"
]
},
\"addr\": {
\"type\": \"string\"
}
},
\"description\": \"Refer to Originating UE Service ID\"
},
\"result\": {
\"type\": \"boolean\",
\"default\": true,
\"description\": \"Refer to Registration result. The value true refers to
succcess\"
}
},
\"required\": [
\"oriAddr\",
\"result\"
]
}
#### 7.3.3.2 MSGin5G UE De-registration structure
The schema is based on JSON Schema Draft-07 [8]. For reducing the overhead of
the message used in MSGin5G service, the properties are defined as shorten
form and the relationships between the properties and elements used in clause
6.3.1.1.2 are described in the description of the properties. The JSON schema
of the CoAP POST request for the MSGin5G de-registration is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\":
\"http://www.3gpp.org/MSGin5G/MSGin5G_Deregistration_request_schema\",
\"title\": \"MSGin5G Deregistration Request\",
\"type\": \"object\",
\"properties\": {
\"msgIden\": {
\"type\": \"string\",
\"format\": \"uri\",
\"description\": \"Refer to Service identifier of MSGin5G service\"
},
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"DEREG\"
],
\"description\": \"Refer to the usage of this message. The value DEREG refers
to MSGin5G De-registration\"
},
\"oriAddr\": {
\"type\": \"object\",
\"properties\": {
\"oriAddrType\": {
\"enum\": [
\"UE\"
]
},
\"addr\": {
\"type\": \"string\"
}
},
\"description\": \"Refer to Originating UE Service ID\"
}
},
\"required\": [
\"msgIden\",
\"oriAddr \",
\"secCred\"
]
}
The schema is based on JSON Schema Draft-07 [8]. For reducing the overhead of
the message used in MSGin5G service, the properties are defined as shorten
form and the relationships between the properties and elements used in clause
6.3.1.2.2 are described in the description of the properties. The JSON schema
of CoAP 2.04 (Change) response for the MSGin5G de-registration is defined
below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/MSGin5G_
Deregistration_response_schema\",
\"title\": \"MSGin5G Deregistration Response\",
\"type\": \"object\",
\"properties\": {
\"oriAddr\": {
\"type\": \"object\",
\"properties\": {
\"oriAddrType\": {
\"enum\": [
\"UE\"
]
},
\"addr\": {
\"type\": \"string\"
}
},
\"description\": \"Refer to Originating UE Service ID\"
},
\"result\": {
\"type\": \"boolean\",
\"default\": true,
\"description\": \"Refer to De-registration result. The value true refers to
succcess\"
}
},
\"required\": [
\"oriAddr\",
\"result\"
]
}
### 7.3.4 MSGin5G Message
#### 7.3.4.1 JSON schema of MSGin5G message
The JSON schema of the MSGin5G message is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/MSGin5G_Message_schema\",
\"title\": \"MSGin5G Message\",
\"type\": \"object\",
\"properties\": {
\"msgIden\": {
\"type\": \"string\",
\"format\": \"uri\",
\"description\": \"Refer to Service identifier of MSGin5G service\"
},
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"MSG\"
],
\"description\": \"the usage of this message. The value MSG refers to MSGin5G
message\"
},
\"appId\": {
\"type\": \"string\",
\"description\": \"Refer to Application ID\"
},
\"msgId\": {
\"type\": \"string\",
\"format\": \"uuid\",
\"description\": \"Refer to Message ID\"
},
\"isDelivStatReq\": {
\"type\": \"boolean\",
\"default\": false,
\"description\": \"Refer to Delivery status required\"
},
\"oriAddr\": {
\"type\": \"object\",
\"properties\": {
\"oriAddrType\": {
\"enum\": [
\"UE\",
\"AS\"
]
},
\"addr\": {
\"type\": \"string\"
}
},
\"description\": \"Refer to Originating UE Service ID or Originating AS
Service ID\"
},
\"destAddr\": {
\"type\": \"object\",
\"properties\": {
\"destAddrType\": {
\"enum\": [
\"UE\",
\"AS\",
\"GROUP\",
\"BC\",
\"TOPIC
]
},
\"addr\": {
\"type\": \"string\"
}
},
\"description\": \"Refer to Recipient UE Service ID or Recipient AS Service ID
or Group Service ID or Broadcast Area ID or Messaging Topic\"
},
\"sfFlag\": {
\"type\": \"boolean\",
\"default\": false,
\"description\": \"Refer to Store And Forward Flag\"
},
\"sfParam\": {
\"\$ref\": \"#/\$defs/SfParams\",
\"description\": \"Refer to Store And Forward Parameters\"
},
\"payload\": {
\"type\": \"string\",
\"description\": \"Refer to Payload\"
},
\"priority\": {
\"type\": \"string\",
\"enum\": [
\"HIGH\",
\"MIDDLE\",
\"LOW\"
],
\"default\": \"MIDDLE\",
\"description\": \"Refer to Priority Type\"
},
\"isSegmented\": {
\"type\": \"boolean\",
\"default\": false,
\"description\": \"Refer to Message Is Segmented\"
},
\"segParams\": {
\"\$ref\": \"#/\$defs/SegParams\"
}
},
\"required\": [
\"msgIden \",
\"msgId\",
\"msgType\",
\"oriAddr\",
\"destAddr\"
],
\"dependentRequired\": {
\" sfParams\": [
\" sfFlag\"
],
\" segParams\": [
\" isSegmented \"
],
\"if\": {
\"properties\": {
\"oriAddrType\": {
\"const\": \"AS\"
}
}
},
\"then\": {
\"properties\": {
\"destAddrType\": {
\"not\":{
\"const\": \"AS\"
}
}
}
}
},
\"\$defs\": {
\"SfParams\": {
\"type\": \"object\",
\"properties\": {
\"expireTime\": {
\"type\": \"string\",
\"format\": \" date-time\",
\"description\": \"Refer to Message expiration time\"
},
\"appSpecSf\": {
\"type\": \"object\",
\"description\": \"Refer to Application Specific Store And Forward
Information\"
}
}
},
\"SegParams\": {
\"type\": \"object\",
\"properties\": {
\"segId\": {
\"type\": \"string\",
\"description\": \"Refer to Segmentation Set Identifier\"
},
\"totalSegCount\": {
\"type\": \"integer\",
\"description\": \"Refer to Total Number Of Message Segments\"
},
\"segNumb\": {
\"type\": \"integer\",
\"description\": \"Refer to Message Segment Number\"
},
\"lastSegFlag\": {
\"type\": \"string\",
\"description\": \"Refer to Last Segment Flag\"
},
\"required\": [
\"segId\",
\"totalSegCount\",
\"segNumb\"
]
}
}
}
}
#### 7.3.4.2 JSON schema of MSGin5G message delivery status report
The JSON schema of the MSGin5G message delivery status report is defined
below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/MSGin5G_Message_schema\",
\"title\": \"MSGin5G message delivery status report\",
\"type\": \"object\",
\"properties\": {
\"msgIden\": {
\"type\": \"string\",
\"format\": \"uri\",
\"description\": \"Refer to Service identifier of MSGin5G service\"
},
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"IMDN\"
],
\"description\": \"the usage of this message. The value IMDN refers to MSGin5G
message delivery status report\"
},
\"oriAddr\": {
\"type\": \"object\",
\"properties\": {
\"oriAddrType\": {
\"enum\": [
\"UE\",
\"AS\"
]
},
\"addr\": {
\"type\": \"string\"
}
},
\"description\": \"Refer to Originating UE Service ID or Originating AS
Service ID\"
},
\"destAddr\": {
\"type\": \"object\",
\"properties\": {
\"destAddrType\": {
\"enum\": [
\"UE\",
\"AS\"
]
},
\"addr\": {
\"type\": \"string\"
}
},
\"description\": \"Refer to Recipient UE Service ID or Recipient AS Service
ID\"
},
\"msgId\": {
\"type\": \"string\",
\"format\": \"uuid\",
\"description\": \"Refer to Message ID\"
},
\"DelSta\": {
\"type\": \"string\",
\"enum\": [
\"success\",
\"failure\"
],
\"description\": \"Refer to Delivery Status\"
},
\"Cause\": {
\"type\": \"string\",
\"description\": \"Refer to Failure Cause\"
}
},
\"required\": [
\"msgIden \",
\"msgType\",
\"msgId\",
\"oriAddr\",
\"destAddr\",
\"DelSta\"
],
\"dependentRequired\": {
\"Cause\": [{
\"DelSta\": {
\"const\": \"failure\"
}
}],
\"if\": {
\"properties\": {
\"oriAddrType\": {
\"const\": \"AS\"
}
}
},
\"then\": {
\"properties\": {
\"destAddrType\": {
\"not\": {
\"const\": \"AS\"
}
}
}
}
}
}
#### 7.3.4.3 JSON schema of MSGin5G message response
The JSON schema of the MSGin5G message response is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/MSGin5G_Message_schema\",
\"title\": \"MSGin5G message response\",
\"type\": \"object\",
\"properties\": {
\"msgIden\": {
\"type\": \"string\",
\"format\": \"uri\",
\"description\": \"Refer to Service identifier of MSGin5G service\"
},
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"MSGRESP\"
],
\"description\": \"the usage of this message. The value MSGRESP refers to
MSGin5G message response\"
},
\"oriAddr\": {
\"type\": \"object\",
\"properties\": {
\"oriAddrType\": {
\"enum\": [
\"UE\",
\"AS\"
]
},
\"addr\": {
\"type\": \"string\"
}
},
\"description\": \"Refer to Originating UE Service ID or Originating AS
Service ID\"
},
\"msgId\": {
\"type\": \"string\",
\"format\": \"uuid\",
\"description\": \"Refer to Message ID\"
},
\"DelSta\": {
\"type\": \"string\",
\"enum\": [
\"failure\",
\"stored for deferred delivery\"
],
\"description\": \"Refer to Delivery Status\"
},
\"Cause\": {
\"type\": \"string\",
\"description\": \"Refer to Failure Cause\"
}
},
\"required\": [
\"msgIden \",
\"msgType\",
\"msgId\",
\"oriAddr\",
\"DelSta\"
]
}
### 7.3.5 Messaging Topic Subscription and Unsubscription
#### 7.3.5.1 Message topic subscription structure
The schema is based on JSON Schema Draft-07 [8]. For reducing the overhead of
the message used in MSGin5G service, the properties are defined as shorten
form and the relationship between the properties and IEs used in clause 6.6
are described in the description of the properties, The JSON schema is defined
below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/Message_Topic_Subscription_schema\",
\"title\": \"Message_Topic_Subscription\",
\"type\":\"object\",
\"properties\": {
\"oriAddr\": {
\"type\": \"object\",
\"properties\": {
\"oriAddrType\": {
\"enum\": [
\"UE\"
]
},
\"addr\": {
\"type\": \"string\"
}
},
\"description\": \"Refer to Originating UE Service ID\"
},
\"expireTime\": {
\"type\": \"string\",
\"format\": \"date-time\",
\"description\": \"Refer to message topic subscripition expiration time\"
},
\"required\": [\"oriAddr\"]
}
}
#### 7.3.5.2 Message topic unsubscription structure
The schema is based on JSON Schema Draft-07 [8]. For reducing the overhead of
the message used in MSGin5G service, the properties are defined as shorten
form and the relationship between the properties and IEs used in clause 6.6
are described in the description of the properties, The JSON schema is defined
below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/Message_Topic_Unsubscription_schema\",
\"title\": \"Message_Topic_Unsubscription\",
\"type\":\"object\",
\"properties\": {
\"oriAddr\": {
\"type\": \"object\",
\"properties\": {
\"oriAddrType\": {
\"enum\": [
\"UE\"
]
},
\"addr\": {
\"type\": \"string\"
}
},
\"description\": \"Refer to Originating UE Service ID\"
},
\"required\": [\"oriAddr\"]
}
}
### 7.3.6 Structure about message segment
The schema is based on JSON Schema Draft-07 [8]. For reducing the overhead of
the message used in MSGin5G service, the properties are defined as shorten
form and the relationship between the properties and IEs used in clause 6.5
are described in the description of the properties, The JSON schema is defined
below.
#### 7.3.6.1 Segments received confirmation structure
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\":
\"http://www.3gpp.org/MSGin5G/Segments_Received_Confirmation_schema\",
\"title\": \"Message_Received_Confirmation\",
\"type\":\"object\",
\"properties\": {
\"msgIden\": {
\"type\": \"string\",
\"format\": \"uri\",
\"description\": \"Refer to Service identifier of MSGin5G service\"
},
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"SEGCONFIR\"
],
\"description\": \"the usage of this message. The value SEGCONFIR refers to
message segments received confirmation\"
},
\"segId\": {
\"type\": \"string\",
\"description\": \"Refer to Segmentation Set Identifier\"
},
\"result\": {
\"type\": \"boolean\",
\"description\": \"Refer to segments received result. The value true refers to
succcess\"
},
\"required\": [\"msgIden\",\"msgType\",\"segId\",\"result\"]
}
}
#### 7.3.6.2 Segments recovery structure
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/Segments_Recovery_schema\",
\"title\": \"Segments_Recovery\",
\"type\":\"object\",
\"properties\": {
\"msgIden\": {
\"type\": \"string\",
\"format\": \"uri\",
\"description\": \"Refer to Service identifier of MSGin5G service\"
},
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"SEGREC\"
],
\"description\": \"the usage of this message. The value SEGREC refers to
message segment recovery\"
},
\"segId\": {
\"type\": \"string\",
\"description\": \"Refer to Segmentation Set Identifier\"
},
\"segNoList\": {
\"type\": \"string\",
\"description\": \"Refer to List of Segment range, e.g. (5-7, 10-10, 15-19)\"
},
\"required\": [\"msgIden\",\"msgType\",\"segId\",\"segNoList\"]
}
}
###### ## Annex A (Informative): Message formats/protocols used for
Constrained UE
# A.1 General
The following clauses provide guidance of message formats/protocols which may
be used between the Application Client on the constrained UE and the MSGin5G
Client on the MSGin5G Gateway UE.
# A.2 Based on standard L3 message
The following clauses describe an example based on standard L3 message as
specified in clause 11.2 of 3GPP TS 24.007 [15].
Each message definition in the clause includes a brief description of the
message direction, the use, and the significance indicates whether the message
is relevant only on the sender or receiver (local) or the message is relevant
on both sender and receiver (dual).
NOTE: Message format defined in this clause can be used if the communication
between the Constrained UE and the MSGin5G GW UE is based on PC5 / NR-PC5.
## A.2.1 Message contents and functions
### A.2.1.1 for sending a message to MSGin5G Client
For sending a message to MSGin5G Client, the Application Client may use the
message content specified in Table A.2.1.1-1.
Message type: MESSAGE SENDING REQUEST
Significance: dual
Direction: the Application Client of the Constrained UE to the MSGin5G Client
of the MSGin5G Gateway UE
Table A.2.1.1-1: message content for sending a message to MSGin5G Client
+-----+--------------------------+--------------------------+----------+--------+---------+ | IEI | Information Element | Type/Reference | Presence | Format | Length | +=====+==========================+==========================+==========+========+=========+ | | Message Type | Message Type | M | V | 1 | | | | | | | | | | | A.2.2.1 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+ | | Target address | Target address\ | M | LV | 6-n | | | | A.2.2.2 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+ | | Message ID | Message ID\ | M | V | 16 | | | | A.2.2.4 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+ | | Payload | Payload | M | LV-E | 3-65537 | | | | | | | | | | | A.2.2.5 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+ | A | Application ID | Application ID\ | O | TV | 3 | | | | A.2.2.3 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+ | B | Delivery status required | Delivery status required | O | TV | 1 | | | | | | | | | | | A.2.2.6 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+ | D | Target Type | Target Type | O | TV | 1 | | | | | | | | | | | A.2.2.7 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+
If using the message content specified in table A.2.1.1-1, the Application
Client may generate a message according to 6.4.2.3.1 and send the generated
message to the MSGin5G Client.
### A.2.1.2 for sending a message delivery report to MSGin5G Client
For sending a message delivery status report to MSGin5G Client, the
Application Client may use the message content specified in Table A.2.1.2-1.
Message type: DELIVERY REPORT SENDING REQUEST
Significance: dual
Direction: the Application Client of the Constrained UE to the MSGin5G Client
of the MSGin5G Gateway UE
Table A.2.1.2-1: message content for sending a message delivery status report
to MSGin5G Client
+-----+---------------------+----------------------+----------+--------+--------+ | IEI | Information Element | Type/Reference | Presence | Format | Length | +=====+=====================+======================+==========+========+========+ | | Message Type | Message Type | M | V | 1 | | | | | | | | | | | A.2.2.1 | | | | +-----+---------------------+----------------------+----------+--------+--------+ | | Delivery Status | Delivery Status\ | M | V | 1 | | | | A.2.2.8 | | | | +-----+---------------------+----------------------+----------+--------+--------+ | | Message ID | Message ID | M | V | 16 | | | | | | | | | | | A.2.2.4 | | | | +-----+---------------------+----------------------+----------+--------+--------+ | | Reply-to Message ID | Reply-to Message ID\ | M | V | 16 | | | | A.2.2.13 | | | | +-----+---------------------+----------------------+----------+--------+--------+
If using the message content specified in table A.2.1.2-1, the Application
Client may generate a message according to 6.4.2.3.2 and send the generated
message to the MSGin5G Client.
### A.2.1.3 for sending a message to Application Client
For sending a message to Application Client, the MSGin5G Client may use the
message content specified in Table A.2.1.3-1.
Message type: MESSAGE RECEIVED REQUEST
Significance: dual
Direction: the MSGin5G Client of the MSGin5G Gateway UE to the Application
Client of the Constrained UE
Table A.2.1.3-1: message content for sending a message to Application Client
+-----+--------------------------+--------------------------+----------+--------+---------+ | IEI | Information Element | Type/Reference | Presence | Format | Length | +=====+==========================+==========================+==========+========+=========+ | | Message Type | Message Type | M | V | 1 | | | | | | | | | | | A.2.2.1 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+ | | Message ID | Message ID\ | M | V | 16 | | | | A.2.2.4 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+ | | Payload | Payload | M | LV-E | 2-65537 | | | | | | | | | | | A.2.2.5 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+ | F | Originator Address | Originator Address | O | TLV | 3-257 | | | | | | | | | | | A.2.2.10 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+ | E | Group ID | Group ID\ | O | TLV | 3-257 | | | | A.2.2.11 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+ | B | Delivery status required | Delivery status required | O | TV | 1 | | | | | | | | | | | A.2.2.6 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+ | C | Priority | Priority | O | TV | 1 | | | | | | | | | | | A.2.2.9 | | | | +-----+--------------------------+--------------------------+----------+--------+---------+
If using the message content specified in table A.2.1.3-1, the MSGin5G Client
may generate a message according to 6.4.2.2.1 and send the generated message
to the Application Client.
### A.2.1.4 for sending a message delivery status report to Application Client
For sending a message delivery status report to Application Client, the
MSGin5G Client may use the message content specified in Table A.2.1.4-1.
Message type: DELIVERY REPORT RECEIVED REQUEST
Significance: dual
Direction: the MSGin5G Client of the MSGin5G Gateway UE to the Application
Client of the Constrained UE
Table A.2.1.4-1: message content for sending a message delivery status report
to MSGin5G Client
+-----+---------------------+----------------------+----------+--------+--------+ | IEI | Information Element | Type/Reference | Presence | Format | Length | +=====+=====================+======================+==========+========+========+ | | Message Type | Message Type | M | V | 1 | | | | | | | | | | | A.2.2.1 | | | | +-----+---------------------+----------------------+----------+--------+--------+ | | Delivery Status | Delivery Status\ | M | V | 1 | | | | A.2.2.8 | | | | +-----+---------------------+----------------------+----------+--------+--------+ | | Message ID | Message ID | M | V | 16 | | | | | | | | | | | A.2.2.4 | | | | +-----+---------------------+----------------------+----------+--------+--------+ | | Reply-to Message ID | Reply-to Message ID\ | M | V | 16 | | | | A.2.2.13 | | | | +-----+---------------------+----------------------+----------+--------+--------+
If using the message content specified in table A.2.1.4-1, the MSGin5G Client
may generate a message according to 6.4.2.2.3 and send the generated message
to the Application Client.
### A.2.1.5 for sending a message sending response to Application Client
For sending a message sending response to Application Client, the MSGin5G
Client may use the message content specified in Table A.2.1.5-1.
Message type: MESSAGE SENDING RESPONSE
Significance: dual
Direction: the MSGin5G Client of the MSGin5G Gateway UE to the Application
Client of the Constrained UE
Table A.2.1.5-1: message content for message sending response
+-----+---------------------+------------------+----------+--------+--------+ | IEI | Information Element | Type/Reference | Presence | Format | Length | +=====+=====================+==================+==========+========+========+ | | Message Type | Message Type | M | V | 1 | | | | | | | | | | | A.2.2.1 | | | | +-----+---------------------+------------------+----------+--------+--------+ | | Result | Result | M | V | 1 | | | | | | | | | | | A.2.2.11 | | | | +-----+---------------------+------------------+----------+--------+--------+ | | Spare half octet | Spare half octet | M | V | 1/2 | | | | | | | | | | | A.2.2.18 | | | | +-----+---------------------+------------------+----------+--------+--------+ | X | Failure Reason | MSGin5G cause | O | TV | 2 | | | | | | | | | | | A.2.2.17 | | | | +-----+---------------------+------------------+----------+--------+--------+
If using the message content specified in table A.2.1.5-1, the MSGin5G Client
may generate a message according to 6.4.2.2.3 and send the generated message
to the Application Client.
### A.2.1.6 for sending a message received response to MSGin5G Client
For sending a message sending response to MSGin5G Client, the Application
Client of the Constrained UEmay use the message content specified in Table
A.2.1.6-1.
Message type: MESSAGE RECEIVED RESPONSE
Significance: dual
Direction: the Application Client of the Constrained UE to the MSGin5G Client
of the MSGin5G Gateway UE
Table A.2.1.6-1: message content for message sending response
+-----+---------------------+------------------+----------+--------+--------+ | IEI | Information Element | Type/Reference | Presence | Format | Length | +=====+=====================+==================+==========+========+========+ | | Message Type | Message Type | M | V | 1 | | | | | | | | | | | A.2.2.1 | | | | +-----+---------------------+------------------+----------+--------+--------+ | | Result | Result | M | V | 1 | | | | | | | | | | | A.2.2.11 | | | | +-----+---------------------+------------------+----------+--------+--------+ | | Spare half octet | Spare half octet | M | V | 1/2 | | | | | | | | | | | A.2.2.18 | | | | +-----+---------------------+------------------+----------+--------+--------+ | X | Failure Reason | MSGin5G cause | O | TV | 2 | | | | | | | | | | | A.2.2.17 | | | | +-----+---------------------+------------------+----------+--------+--------+
If using the message content specified in table A.2.1.6-1, the Application
Client may generate a message according to 6.4.2.3.3 and send the generated
message to the MSGin5G Client.
### A.2.1.7 Registration Request
The Registration Request is sent by the Application Client of the Constrained
UE to the MSGin5G Client of the MSGin5G Gateway UE to initiate registration.
See table A.2.1.7.
Message type: REGISTRATION REQUEST
Significance: dual
Direction: the Application Client of the Constrained UE to the MSGin5G Client
of the MSGin5G Gateway UE
Table A.2.1.7: REGISTRATION REQUEST content
+-----+------------------------+------------------------+----------+--------+---------+ | IEI | Information Element | Type/Reference | Presence | Format | Length | +=====+========================+========================+==========+========+=========+ | | Message Type | Message Type | M | V | 1 | | | | | | | | | | | A.2.2.1 | | | | +-----+------------------------+------------------------+----------+--------+---------+ | | Application ID | Application ID | M | V | 2 | | | | | | | | | | | A.2.2.3 | | | | +-----+------------------------+------------------------+----------+--------+---------+ | | Credential information | Credential information | M | LV | 3-65537 | | | | | | | | | | | A.2.2.15 | | | | +-----+------------------------+------------------------+----------+--------+---------+
### A.2.1.8 Registration Accept
The Registration Accept is sent by the MSGin5G Client of the MSGin5G Gateway
UE to the Application Client of the Constrained UE to indicate the
registration is accepted. See table A.2.1.8.
Message type: REGISTRATION ACCEPT
Significance: dual
Direction: the MSGin5G Client of the MSGin5G Gateway UE to the Application
Client of the Constrained UE
Table A.2.1.8: REGISTRATION ACCEPT content
+-----+---------------------+-------------------------+----------+--------+--------+ | IEI | Information Element | Type/Reference | Presence | Format | Length | +=====+=====================+=========================+==========+========+========+ | | Message Type | Message Type | M | V | 1 | | | | | | | | | | | A.2.2.1 | | | | +-----+---------------------+-------------------------+----------+--------+--------+ | | Registration ID | MSCin5G Registration ID | M | V | 6 | | | | | | | | | | | A.2.2.16 | | | | +-----+---------------------+-------------------------+----------+--------+--------+
### A.2.1.9 Registration Reject
The Registration Reject is sent by the MSGin5G Client of the MSGin5G Gateway
UE to the Application Client of the Constrained UE to indicate the
registration is rejected. See table A.2.1.9.
Message type: REGISTRATION REJECT
Significance: dual
Direction: the MSGin5G Client of the MSGin5G Gateway UE to the Application
Client of the Constrained UE
Table A.2.1.9: REGISTRATION REJECT content
+-----+---------------------+----------------+----------+--------+--------+ | IEI | Information Element | Type/Reference | Presence | Format | Length | +=====+=====================+================+==========+========+========+ | | Message Type | Message Type | M | V | 1 | | | | | | | | | | | A.2.2.1 | | | | +-----+---------------------+----------------+----------+--------+--------+ | | Failure Reason | MSGin5G cause | M | V | 1 | | | | | | | | | | | A.2.2.17 | | | | +-----+---------------------+----------------+----------+--------+--------+
### A.2.1.10 De-registration Request
The De-registration Request is sent by the Application Client of the
Constrained UE to the MSGin5G Client of the MSGin5G Gateway UE to initiate de-
registration. See table A.2.1.10.
Message type: DEREGISTRATION REQUEST
Significance: dual
Direction: the Application Client of the Constrained UE to the MSGin5G Client
of the MSGin5G Gateway UE
Table A.2.1.10: DEREGISTRATION REQUEST content
+-----+---------------------+-------------------------+----------+--------+--------+ | IEI | Information Element | Type/Reference | Presence | Format | Length | +=====+=====================+=========================+==========+========+========+ | | Message Type | Message Type | M | V | 1 | | | | | | | | | | | A.2.2.1 | | | | +-----+---------------------+-------------------------+----------+--------+--------+ | | Registration ID | MSCin5G Registration ID | M | V | 6 | | | | | | | | | | | A.2.2.16 | | | | +-----+---------------------+-------------------------+----------+--------+--------+
### A.2.1.11 De-registration Accept
The De-registration Accept is sent by the MSGin5G Client of the MSGin5G
Gateway UE to the Application Client of the Constrained UE to indicate the de-
registration is accepted. See table A.2.1.11.
Message type: DEREGISTRATION ACCEPT
Significance: dual
Direction: the MSGin5G Client of the MSGin5G Gateway UE to the Application
Client of the Constrained UE
Table A.2.1.11: DEREGISTRATION ACCEPT content
+-----+---------------------+-------------------------+----------+--------+--------+ | IEI | Information Element | Type/Reference | Presence | Format | Length | +=====+=====================+=========================+==========+========+========+ | | Message Type | Message Type | M | V | 1 | | | | | | | | | | | A.2.2.1 | | | | +-----+---------------------+-------------------------+----------+--------+--------+ | | Registration ID | MSCin5G Registration ID | M | V | 6 | | | | | | | | | | | A.2.2.16 | | | | +-----+---------------------+-------------------------+----------+--------+--------+
### A.2.1.12 De-registration Reject
The De-registration Reject is sent by the MSGin5G Client of the MSGin5G
Gateway UE to the Application Client of the Constrained UE to indicate the de-
registration is rejected. See table A.2.1.12.
Message type: DEREGISTRATION REJECT
Significance: dual
Direction: the MSGin5G Client of the MSGin5G Gateway UE to the Application
Client of the Constrained UE
Table A.2.1.12: DEREGISTRATION REJECT content
+-----+---------------------+----------------+----------+--------+--------+ | IEI | Information Element | Type/Reference | Presence | Format | Length | +=====+=====================+================+==========+========+========+ | | Message Type | Message Type | M | V | 1 | | | | | | | | | | | A.2.2.1 | | | | +-----+---------------------+----------------+----------+--------+--------+ | | Failure Reason | MSGin5G cause | M | V | 1 | | | | | | | | | | | A.2.2.17 | | | | +-----+---------------------+----------------+----------+--------+--------+
## A.2.2 information elements coding
### A.2.2.1 Message Type
The purpose of the Message type information element is to identify the type of
the request or response.
The value part of the Message type information element is coded as shown in
Table A.2.2.1-1.
The Message type information element is a type 3 information element with a
length of 1 octet.
Table A.2.2.1-1: Message types
Bits |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---  
8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |  |   
|  |  |  |  |  |  |  |  |   
0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 |  | MESSAGE SENDING REQUEST  
0 | 0 | 0 | 0 | 0 | 0 | 1 | 0 |  | MESSAGE SENDING RESPONSE  
0 | 0 | 0 | 0 | 0 | 0 | 1 | 1 |  | MESSAGE RECEIVED REQUEST  
0 | 0 | 0 | 0 | 0 | 1 | 0 | 0 |  | MESSAGE RECEIVED RESPONSE  
0 | 0 | 0 | 0 | 0 | 1 | 0 | 1 |  | DELIVERY REPORT SENDING REQUEST  
0 | 0 | 0 | 0 | 0 | 1 | 1 | 0 |  | DELIVERY REPORT RECEIVED REQUEST  
0 0 0 0 0 0 | 0 0 0 0 0 0 | 0 0 0 0 0 0 | 0 0 0 0 0 0 | 0 1 1 1 1 1 | 1 0 0 0 0 1 | 1 0 0 1 1 0 | 1 0 1 0 1 0 |  | REGISTRATION REQUEST REGISTRATION ACCEPT REGISTRATION REJECT DEREGISTRATION REQUEST DEREGISTRATION REJECT DEREGISTRATION ACCEPT  
All other values are reserved. |  |  |  |  |  |  |  |  |   
### A.2.2.2 Target address
The Target address information element is used to indicate the address of
target recipient or the target group while sending message from Constrained
UE.
The Target address information element is coded as shown in figure A.2.2.2-1
and table A.2.2.2-1.
The Target address information element is a type 4 information element.
8 7 6 5 4 3 2 1
* * *
Length of Target address contents octet 1  
Target address type value octet 2  
octet 3  
Target address contents  
octet n
Figure A.2.2.2-1: Target address information element
Table A.2.2.2-1: Target address information element
+---------------------+---+---+---+---+---+---+---+--------------+ | Target Address type | | | | | | | | | | value (octet 2) | | | | | | | | | | | | | | | | | | | | Bits | | | | | | | | | +=====================+===+===+===+===+===+===+===+==============+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | | +---------------------+---+---+---+---+---+---+---+--------------+ | 0 | 0 | 0 | 0 | 0 | 0 | 1 | | IPv4 address | +---------------------+---+---+---+---+---+---+---+--------------+ | 0 | 0 | 0 | 0 | 0 | 1 | 0 | | IPv6 address | +---------------------+---+---+---+---+---+---+---+--------------+ | 0 | 0 | 0 | 0 | 0 | 1 | 1 | | FQDN | +---------------------+---+---+---+---+---+---+---+--------------+ | All other values | | | | | | | | | | are reserved. | | | | | | | | | +---------------------+---+---+---+---+---+---+---+--------------+ | Target address | | | | | | | | | | content is | | | | | | | | | | contained in octet | | | | | | | | | | 6 to octet n; The | | | | | | | | | | maximum value | | | | | | | | | | depends on the | | | | | | | | | | length of FQDN. | | | | | | | | | +---------------------+---+---+---+---+---+---+---+--------------+ | | | | | | | | | | +---------------------+---+---+---+---+---+---+---+--------------+ | If Target address | | | | | | | | | | type value | | | | | | | | | | indicates IPv4 | | | | | | | | | | address, the Target | | | | | | | | | | address contents in | | | | | | | | | | octet 3 to octet 6 | | | | | | | | | | contains an IPv4 | | | | | | | | | | address. | | | | | | | | | | | | | | | | | | | | If Target address | | | | | | | | | | type value | | | | | | | | | | indicates IPv6 | | | | | | | | | | address, the Target | | | | | | | | | | address contents in | | | | | | | | | | octet 3 to octet 18 | | | | | | | | | | contains an IPv6 | | | | | | | | | | address. | | | | | | | | | | | | | | | | | | | | If Target address | | | | | | | | | | type indicates | | | | | | | | | | FQDN, the Target | | | | | | | | | | address contents in | | | | | | | | | | octet 3 to octet n | | | | | | | | | | contains an FQDN | | | | | | | | | | encoded as defined | | | | | | | | | | in clause 28.3.2 of | | | | | | | | | | 3GP | | | | | | | | | | P TS 23.003 [18]. | | | | | | | | | +---------------------+---+---+---+---+---+---+---+--------------+
### A.2.2.3 Application ID
The purpose of the Application ID information element is to uniquely identify
the application for which the payload is intended.
The Application ID information element is coded as shown in figure A.2.2.3-1
and table A.2.2.3-1
The Application ID information element is a type 3 information element with a
length of 3 octets.
8 7 6 5 4 3 2 1
* * *
Application ID IEI octet1  
Application ID value octet 2  
octet 3
Figure A.2.2.3-1: Application ID value
Table A.2.2.3-1: Application ID value
+----------------------------------------------------------------------+ | Application ID value (octet 2-3) | | | | The Application ID contains a number that uniquely identifies the | | destination application. | +----------------------------------------------------------------------+
### A.2.2.4 Message ID
The Message ID information element uniquely identifies a message or message
delivery report.
The Message ID information element is coded as shown in Figure A.2.2.4-1 and
Table A.2.2.4-1.
The Message ID information element is a type 3 information element with a
length of 16 octets.
+------------------+----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +==================+==========+===+===+===+===+===+===+===+ | Message ID value | octet 1 | | | | | | | | | | | | | | | | | | | | octet 16 | | | | | | | | +------------------+----------+---+---+---+---+---+---+---+
Figure A.2.2.4-1: Message ID value
Table A.2.2.4-1: Message ID value
+----------------------------------------------------------------------+ | Message ID value (octet 1 to 16) | | | | The Message ID contains a number uniquely identifying a message or | | message delivery report. The value is a universally unique | | identifier as specified in IETF RFC 4122 [19]. | +----------------------------------------------------------------------+
### A.2.2.5 Payload
The Payload information element is used to send application specific message;
The Payload information element is coded as shown in Figure A.2.2.5-1 and
Table A.2.2.5-1.
The Payload data information element is a type 6 information element.
8 7 6 5 4 3 2 1
* * *
Length of Payload contents octet 1  
octet 2  
octet 3  
Payload contents  
octet n
Figure A.2.2.5-1: Payload information element
Table A.2.2.5-1: Payload information element
Payload data is contained in octet 3 to octet n; Max value of 65535 octets.
* * *
### A.2.2.6 Delivery Status Required
The purpose of the Delivery Status Required information element is to identify
whether delivery status is required from the receiver or not.
The value part of the Delivery Status Required information element is coded as
shown in Figure A.2.2.6-1 and Table A.2.2.6-1.
The Delivery Status Required information element is a type 1 information
element.
* * *
8 7 6 5 4 3 2 1  
Delivery Status Required IEI Delivery Status Required value octet 1
* * *
Figure A.2.2.6-1: Delivery Status Required type
Table A.2.2.6-1: Delivery Status Required type
* * *
Delivery status value (octet 1)  
Bits  
4 3 2 1  
0 0 0 0 DELIVERY REPORT NOT REQUIRED 0 0 0 1 DELIVERY REPORT REQUIRED
All other values are reserved.
* * *
### A.2.2.7 Target Type
The purpose of the Target Type information element is to indicate the type of
the message target.
The value part of the Target Type information element is coded as shown in
Figure A.2.2.7-1 and Table A.2.2.7-1.
The Target Type information element is a type 1 information element.
* * *
8 7 6 5 4 3 2 1  
Target Type IEI Target Type value octet 1
* * *
Figure A.2.2.7-1: Target Type type
Table A.2.2.7-1: Target Type type
* * *
E2E Message type value (octet 1)  
Bits  
4 3 2 1  
0 0 0 0 UE 0 0 0 1 GROUP 0 0 1 0 AS
All other values are reserved.
* * *
### A.2.2.8 Delivery Status
The Delivery Status information element is used to indicate the delivery
status from message recipient.
The Delivery Status information element is coded as shown in Figure A.2.2.8-1
and Table A.2.2.8-1.
The Delivery Status information element is a type 3 information element.
* * *
8 7 6 5 4 3 2 1  
Delivery Status value octet 1
* * *
Figure A.2.2.8-1: Delivery Status type
Table A.2.2.8-1: Delivery Status type
* * *
Delivery status value (octet 1)  
Bits  
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 0 FAILED 0 0 0 0 0 0 0 1 SUCCESS
All other values are reserved.
* * *
### A.2.2.9 Priority
The purpose of the priority information element is to identify application
level priority of the received message.
The value part of the priority information element is coded as shown in Figure
2.2.9-1 and Table 2.2.9-1.
The priority type information element is a type 1 information element.
* * *
8 7 6 5 4 3 2 1  
Priority IEI Priority value octet 1
* * *
Figure 2.2.9-1: Priority type
Table 2.2.9-1: Priority type
* * *
Priority type value (octet 1)  
Bits  
4 3 2 1  
0 0 0 0 LOW 0 0 0 1 MEDIUM 0 0 1 0 HIGH
All other values are reserved.
* * *
### A.2.2.10 Originator Address
The Originator Address information element is used to indicate address of
originating UE/AS while sending message to Constrained UE.
The Originator Address information element is coded as shown in Figure
A.2.2.10-1 and Table A.2.2.10-1.
The Originator Address information element is a type 4 information element.
8 7 6 5 4 3 2 1
* * *
Originator Address TEI octet 1  
Length of Originator Address contents octet 2  
octet 3  
Originator Address contents  
octet n
Figure A.2.2.10-1: Originator Address information element
Table A.2.2.10-1: Originator Address information element
Originator Address is contained in octet 3 to octet n; Max value of 255
octets.
* * *
### A.2.2.11 Group ID
The Group ID information element is used to indicate the group which the
message is from while sending message to Constrained UE.
The Group ID information element is coded as shown in Figure A.2.2.11-1 and
Table A.2.2.11-1.
The Group ID information element is a type 4 information element.
8 7 6 5 4 3 2 1
* * *
Group ID IEI octet 1  
Length of Group ID contents octet 2  
octet 3  
Group ID contents  
octet n
Figure A.2.2.11-1: Group ID information element
Table A.2.2.11-1: Group ID information element
Group ID is contained in octet 3 to octet n; Max value of 255 octets.
* * *
### A.2.2.11 Result
The Result information element is used to indicate the result of handling
message sending request as described in A.2.1.1.
The Result information element is coded as shown in Figure A.2.2.11-1 and
Table A.2.2.11-1.
The Result information element is a type 1 information element.
* * *
8 7 6 5 4 3 2 1  
Result value octet 1
* * *
Figure A.2.2.11-1: Result type
Table A.2.2.11-1: Result type
* * *
Result value (octet 1)  
Bits  
4 3 2 1  
0 0 0 0 FAILED 0 0 0 1 SUCCESS
All other values are reserved.
* * *
### A.2.2.12 Void
### A.2.2.13 Reply-to Message ID
The Reply-to Message ID information element uniquely identifies the message
delivery report and is same with the Message ID included in the message
acknowledged.
The Reply-to Message ID information element is coded as shown in Figure
A.2.2.13-1 and Table A.2.2.13-1.
The Reply-to Message ID information element is a type 3 information element
with a length of 16 octets.
+---------------------------+----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +===========================+==========+===+===+===+===+===+===+===+ | Reply-to Message ID value | octet 1 | | | | | | | | | | | | | | | | | | | | octet 16 | | | | | | | | +---------------------------+----------+---+---+---+---+---+---+---+
Figure A.2.2.13-1: Reply-to Message ID value
Table A.2.2.13-1: Reply-to Message ID value
+----------------------------------------------------------------------+ | Reply-to Message ID value (octet 1 to 16) | | | | The Reply-to Message ID contains a number uniquely identifying a | | message. The value is a universally unique identifier as specified | | in IETF RFC 4122 [19]. | +----------------------------------------------------------------------+
### A.2.2.14 Void
### A.2.2.15 Credential information
The purpose of the Credential information information element is to carrie
credentials from a credentials holder(e.g. application server, the MSGin5G
Gateway UE).
The Credential information information element is coded as shown in Figure
A.2.2.15-1 and Table A.2.2.15-1.
The Credential information information element is a type 6 information element
with a minimum length of 3 octets and a maximum length of 65537 octets.
8 7 6 5 4 3 2 1
* * *
Length of Credential information contents octet 1  
octet 2  
octet 3  
Credential information contents  
octet n
Figure A.2.2.15-1: Credential information information element
Table A.2.2.15-1: Credential information information element
Payload data is contained in octet 3 to octet n; Max value of 65535 octets.
* * *
The format of the Credential information contents is out of scope of this
specification.
### A.2.2.16 MSCin5G Registration ID
The purpose of the MSCin5G Registration ID information element is to indicate
the Registration ID that is allocated by the MSGin5G Client of the MSGin5G
Gateway UE.
The MSCin5G Registration ID is a type 3 information element with a length of 6
octets.
The MSCin5G Registration ID information element is coded as shown in figure
A.2.2.16 and table A.2.2.16.
8 7 6 5 4 3 2 1
* * *
MSCin5G Registration ID value octet 1
                                  octet 6
Figure A.2.2.16: MSCin5G Registration ID information element
Table A.2.2.16: MSCin5G Registration ID information element
+---------------------------------------------------------+ | MSCin5G Registration ID (octet 1 to 6) | | | | This field contains the 48-bit MSCin5G Registration ID. | +---------------------------------------------------------+
### A.2.2.17 MSGin5G cause
The purpose of the MSGin5G cause information element is to indicate the cause
used for MSGin5G procedures.
The MSGin5G cause is a type 3 information element with a length of 2 octets.
The MSGin5G cause information element is coded as shown in figure A.2.2.17 and
table A.2.2.17.
8 7 6 5 4 3 2 1
* * *
MSGin5G cause IEI octet 1  
MSGin5G cause value octet 2
Figure A.2.2.17: MSGin5G cause information element
Table A.2.2.17: MSGin5G cause information element
MSGin5G cause (octet 2)
* * *
Bits  
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 1 Access via a Gateway UE is not allowed 0 0 0 0 0 0 1 0 Invalid
credentials 0 0 0 0 0 0 1 1 Conflict of transport identifier for unicast
communication is detected 0 0 0 0 0 1 0 0 Connection is not available anymore
0 0 0 0 0 1 0 1 Lack of resources for lower layer 0 0 0 0 0 1 1 0 Congestion
situation 0 0 0 0 0 1 1 1 Unknown device
0 1 1 0 1 1 1 1 Protocol error, unspecified
Any other value received by the UE shall be treated as 0110 1111, \"protocol
error, unspecified\".
### A.2.2.18 Spare half octet
This element is used in the L3 messages as specified in clause A.2.1 when an
odd number of half octet type 1 information elements are used. This element is
filled with spare bits set to zero and is placed in bits 5 to 8 of the octet
unless otherwise specified.
# A.3 Based on CoAP
The following clauses describe example of the MSGin5G Constrained UE message
format based on CoAP.
NOTE 1: Message format and protocol defined in this clause can be used if the
communication between the Constrained UE and the MSGin5G GW UE is not based on
PC5 / NR-PC5.
NOTE 2: Routing CoAP messages between the Constrained UE and the MSGin5G GW UE
is not specified in this version of the specification and is implementation
specific.
## A.3.1 message contents and functions
### A.3.1.1 for sending a message to MSGin5G Client
In order to send a message, the Application Client on the constrained UE may
generate an CoAP POST request according to procedures specified in IETF RFC
7252 [5] to the MSGin5G Client on a MSGin5G UE. In the CoAP POST request
message, the Application Client:
a) set the \"T\" field in the CoAP header to 0 if delivery status report from
the recipient is requested, i.e. indicates this message is the type of
Confirmable, to ensure the application layer delivery status report;
b) include the MSGin5G Client address in an CoAP Option, e.g. if the MSGin5G
Client address is a URI, include a Uri-Path Option with the value of the URI;
c) set the CoAP Content-Format to \"50\", i.e. application/json; and
d) include the information elements specified in clause 6.4.2.3.1 in the CoAP
payload encoded in JSON format as specified in clause A.3.2.1.
### A.3.1.2 for sending a message delivery status report to MSGin5G Client
In order to send a message delivery status report, the Application Client on
the constrained UE may generate an CoAP POST request according to procedures
specified in IETF RFC 7252 [5] to the MSGin5G Client on a MSGin5G UE. In the
CoAP POST request message, the Application Client:
a) set the \"T\" field in the CoAP header to 0 indicating this message is the
type of Confirmable;
b) include the MSGin5G Client address in an CoAP Option, e.g. if the MSGin5G
Client address is a URI, include a Uri-Path Option with the value of the URI;
c) set the CoAP Content-Format to \"50\", i.e. application/json;
d) include the information elements specified in clause 6.4.2.3.2 in the CoAP
payload encoded in JSON format as specified in clause A.3.2.2.
### A.3.1.3 for sending a message to Application Client
In order to send a message, the MSGin5G Client may generate an CoAP POST
request according to procedures specified in IETF RFC 7252 [5] to the
Application Client. In the CoAP POST request message, the MSGin5G Client:
a) set the \"T\" field in the CoAP header to 0 if delivery status report from
the recipient is requested, i.e. indicates this message is the type of
Confirmable, to ensure the application layer delivery status report;
b) include the Application Client address in an CoAP Option, e.g. if the
Application Client address is a URI, include a Uri-Path Option with the value
of the URI;
c) set the CoAP Content-Format to \"50\", i.e. application/json;
d) include the information elements specified in clause 6.4.2.2.1 in the CoAP
payload encoded in JSON format as specified in clause A.3.2.3.
### A.3.1.4 for sending a message delivery status report to Application Client
In order to send a message delivery status report, the MSGin5G Client may
generate an CoAP POST request according to procedures specified in IETF RFC
7252 [5] to the Application Client. In the CoAP POST request message, the
MSGin5G Client:
a) set the \"T\" field in the CoAP header to 0 indicating this message is the
type of Confirmable;
b) include the Application Client address in an CoAP Option, e.g. if the
Application Client address is a URI, include a Uri-Path Option with the value
of the URI;
c) set the CoAP Content-Format to \"50\", i.e. application/json;
d) include the information elements specified in clause 6.4.2.2.3 in the CoAP
payload encoded in JSON format as specified in clause A.3.2.4.
### A.3.1.5 for sending a message sending response to Application Client
After receiving a CoAP POST request for sending a message from Application
Client, the MSGin5G Client may generate an CoAP 2.05 response according to
procedures specified in IETF RFC 7252 [5] to the Application Client. In the
response, the MSGin5G Client:
a) include the Application Client address in an CoAP Option, e.g. if the
Application Client address is a URI, include a Uri-Path Option with the value
of the URI;
b) set the CoAP Content-Format to \"50\", i.e. application/json; and
c) include the information elements specified in clause 6.4.2.2.5 in the CoAP
payload encoded in JSON format as specified in clause A.3.2.5.
### A.3.1.6 for sending a message received response to MSGin5G Client
After receiving a CoAP POST request for sending a message from MSGin5G Client,
the Application Client may generate an CoAP 2.05 response according to
procedures specified in IETF RFC 7252 [5] to the Application Client. In the
response, the MSGin5G Client:
a) include the MSGin5G Client address in an CoAP Option, e.g. if the MSGin5G
Client address is a URI, include a Uri-Path Option with the value of the URI;
b) set the CoAP Content-Format to \"50\", i.e. application/json; and
c) include the information elements specified in clause 6.4.2.3.3 in the CoAP
payload encoded in JSON format as specified in clause A.3.2.6.
### A.3.1.7 Registration Request
The registration request sent by the Application Client of the Constrained UE
to the MSGin5G Client of the MSGin5G Gateway UE is based on the CoAP POST
request as specified in IETF RFC 7252 [5]. The Application Client of the
Constrained UE:
a) shall set the \"T\" field in the CoAP header to 0 to indicate acknowledge
message required;
b) shall include the address of the MSGin5G Gateway UE in the Option header of
the CoAP POST request and set the Option header to a corresponding value, e.g.
if address of the MSGin5G Gateway UE is a URI, the Uri-Path Option is set to
the value of such URI;
c) shall set the \"Content-Format\" element to \"50\" to indicate the format
of the CoAP payload is \"application/json\"; and
d) shall include the following information elements in the CoAP payload
encoded in JSON format:
1) the \"MSGin5G service identifier\" element to indicate that this CoAP POST
request is used for MSGin5G service;
2) the \"Message Type\" element to indicate that the CoAP POST request is used
for registration;
3) the \"Application ID \" element to indicate the application client
initiating registration; and
4) the \"Credential information\" element to indicate the credential
information of the Constrained UE.
### A.3.1.8 Registration Response
The registration response sent by the MSGin5G Client of the MSGin5G Gateway UE
to the Application Client of the Constrained UE is based on the CoAP 2.01
(Created) response or CoAP 2.04 (Change) response as specified in IETF RFC
7252 [5]. The Application Client of the Constrained UE:
a) shall include the CoAP \"Message ID\" element and the \"Token\" element
with the same values with those in the CoAP POST request for registration; and
b) shall include the \"Content-Format\" element with \"50\" to indicate the
format of the CoAP payload is \"application/json\". The CoAP payload:
1) shall include the \"Registration Result\" element to indicate whether the
registration is success or failure;
2) shall include the \"Registration ID\" element allocated by the MSGin5G
Client of the MSGin5G Gateway UE if the value of \"Registration Result\"
element is set to true; and
3) shall include the \"Failure Reason\" element to indicate why the
registration request is rejected by the MSGin5G Client of the MSGin5G Gateway
UE if the value of \"Registration Result\" element is set to false.
### A.3.1.9 De-registration Request
The de-registration request sent by the Application Client of the Constrained
UE to the MSGin5G Client of the MSGin5G Gateway UE is based on the CoAP POST
request as specified in IETF RFC 7252 [5]. The Application Client of the
Constrained UE:
a) shall set the \"T\" field in the CoAP header to 0 to indicate acknowledge
message required;
b) shall include the address of the MSGin5G Gateway UE in the Option header of
the CoAP POST request and set the Option header to a corresponding value, e.g.
if address of the MSGin5G Gateway UE is a URI, the Uri-Path Option is set to
the value of such URI;
c) shall set the \"Content-Format\" element to \"50\" to indicate the format
of the CoAP payload is \"application/json\"; and
d) shall include the following information elements in the CoAP payload
encoded in JSON format:
1) the \"MSGin5G service identifier\" element to indicate that this CoAP POST
request is used for MSGin5G service;
2) the \"Message Type\" element to indicate that the CoAP POST request is used
for de-registration; and
3) the \"Registration ID\" element to indicate which has been allocated by the
MSGin5G Gateway UE during the registration procedure.
### A.3.1.10 De-registration Response
The de-registration response sent by the MSGin5G Client of the MSGin5G Gateway
UE to the Application Client of the Constrained UE is based on the CoAP 2.01
(Created) response or CoAP 2.04 (Change) response as specified in IETF RFC
7252 [5]. The Application Client of the Constrained UE:
a) shall include the CoAP \"Message ID\" element and the \"Token\" element
with the same values with those in the CoAP POST request for de-registration;
and
b) shall include the \"Content-Format\" element with \"50\" to indicate the
format of the CoAP payload is \"application/json\". The CoAP payload:
1) shall include the \"De-registration Result\" element to indicate whether
the de-registration is success or failure;
2) shall include the \"Registration ID\" element allocated by the MSGin5G
Client of the MSGin5G Gateway UE if the value of \"De-registration Result\"
element is set to true; and
3) shall include the \"Failure Reason\" element to indicate why the de-
registration request is rejected by the MSGin5G Client of the MSGin5G Gateway
UE if the value of \"de-registration Result\" element is set to false.
## A.3.2 JSON Schema
### A.3.2.1 for sending a message to MSGin5G Client
The JSON schema for application client sending message is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/MSGin5G_APP_Message_schema\",
\"title\": \"APP Message\",
\"type\": \"object\",
\"properties\": {
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"MESSAGE SENDING REQEUST\"
],
\"description\": \" Refer to Message Type, it indicates the usage of this
message. The value MESSAGE SENDING REQEUST refers to message sending\"
},
\"appId\": {
\"type\": \"string\",
\"description\": \"Refer to Application ID\"
},
\"msgId\": {
\"type\": \"string\",
\"format\": \"uuid\",
\"description\": \"Refer to Message ID\"
},
\"isDelivStatReq\": {
\"type\": \"boolean\",
\"default\": false,
\"description\": \"Refer to Delivery Status Required\"
},
\"destAddr\": {
\"type\": \"object\",
\"properties\": {
\"destAddrType\": {
\"enum\": [
\"UE\",
\"AS\",
\"GROUP\"
],
\"description\": \"the target type\"
},
\"addr\": {
\"type\": \"string\",
\"description\": \"the target address\"
}
}
},
\"payload\": {
\"type\": \"string\",
\"description\": \"Refer to Payload\"
},
},
\"required\": [
\"msgId\",
\"destAddr\",
\"payload\"
]
}
### A.3.2.2 for sending a message delivery report to MSGin5G Client
The JSON schema for application client sending message delivery status report
is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/MSGin5G_APP_Delivery REPORT_schema\",
\"title\": \"APP_Delivery REPORT\",
\"type\": \"object\",
\"properties\": {
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"DELIVERY REPORT SENDING REQEUST\"
],
\"description\": \" Refer to Message Type, it indicates the usage of this
message. The value DELIVERY REPORT SENDING REQEUST refers to message delivery
status report sending\"
},
\"msgId\": {
\"type\": \"string\",
\"format\": \"uuid\",
\"description\": \"Refer to Message ID indicating unique identity of this
message delivery report\"
},
\"reply2msgId\": {
\"type\": \"string\",
\"format\": \"uuid\",
\"description\": \"Refer to Reply-to Message ID indicating which message the
delivery status report is for\"
},
\"deliveryStatus\": {
\"enum\": [
\"SUCCESS\",
\"FAILED\"
],
\"description\": \"Refer to delivery status\"
}
},
\"required\": [
\"msgId\",
\"deliveryStatus\",
\"msgType\"
]
}
### A.3.2.3 for sending a message to Application Client
The JSON schema for MSGin5G client sending message to Application Client is
defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/MSGin5G_Messsage-to-APP_schema\",
\"title\": \"Message to APP\",
\"type\": \"object\",
\"properties\": {
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"MESSAGE RECEIVED REQEUST\"
],
\"description\": \" Refer to Message Type indicating the usage of this
message. The value MESSAGE RECEIVED REQEUST refers to sending message to a
application client\"
},
\"msgId\": {
\"type\": \"string\",
\"format\": \"uuid\",
\"description\": \"Refer to Message ID indicating which message is for\"
},
\"oriAddr\": {
\"type\": \"string\",
\"description\": \"Refer to the Originator Address indicating the originating
group if the message is a group message\"
},
\"groupId\": {
\"type\": \"string\",
\"description\": \"Refer to the Group ID indicating the originating UE or AS\"
},
\"payload\": {
\"type\": \"string\",
\"description\": \"Refer to Payload\"
},
\"isDelivStatReq\": {
\"type\": \"boolean\",
\"default\": false,
\"description\": \"Refer to Delivery Status Required\"
},
\"priority\": {
\"type\": \"string\",
\"enum\": [
\"HIGH\",
\"MEDIUM\",
\"LOW\"
],
\"default\": \"MIDDLE\",
\"description\": \"Refer to Priority Type\"
},
},
\"required\": [
\"msgId\",
\"msgType\",
\"payload\"
]
}
### A.3.2.4 for sending a message delivery report to Application Client
The JSON schema for MSGin5G client sending message delivery status report to
Application Client is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/MSGin5G_Delivery-Report-to-APP
schema\",
\"title\": \"Delivery report to APP\",
\"type\": \"object\",
\"properties\": {
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"DELIVERY REPORT RECEIVED REQUEST\"
],
\"description\": \" Refer to Message Type indicating the usage of this
message. The value DELIVERY REPORT RECEIVED REQUEST refers to sending a
message delivery status report to Application Client\"
},
\"msgId\": {
\"type\": \"string\",
\"format\": \"uuid\",
\"description\": \"Refer to Message ID indicating unique identity of this
message delivery report\"
},
\"reply2msgId\": {
\"type\": \"string\",
\"format\": \"uuid\",
\"description\": \"Refer to Reply-to Message ID indicating which message the
delivery status report is for\"
},
\"deliveryStatus\": {
\"type\": \"string\",
\"enum\": [
\"SUCCESS\",
\"FAILED\"
],
\"description\": \"Refer to delivery status\"
}
},
\"required\": [
\"msgId\",
\"deliveryStatus\",
\"msgType\"
]
}
### A.3.2.5 for sending a message sending response to Application Client
The JSON schema for MSGin5G client sending message sending response to
Application Client is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/MSGin5G_Message-Sending-Response
schema\",
\"title\": \"Delivery message sending response to APP\",
\"type\": \"object\",
\"properties\": {
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"MESSAGE SENDING RESPONSE\"
],
\"description\": \" Refer to Message Type indicating the usage of this
message. The value MESSAGE SENDING RESPONSE refers to the resonse for the
message sending of a Application Client\"
},
\"failReason\": {
\"type\": \"string\",
\"description\": \"Refer to the failure reason\"
},
\"result\": {
\"type\": \"string\",
\"enum\": [
\"SUCCESS\",
\"FAILED\"
],
\"description\": \"Refer to the result\"
}
},
\"required\": [
\"result\",
\"msgType\"
]
}
### A.3.2.6 for sending a message received response to MSGin5G Client
The JSON schema for Application client sending message received response to
MSGin5G Client is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/MSGin5G_ Message-Received-Response
schema\",
\"title\": \"Delivery message received response to MSGin5G Client\",
\"type\": \"object\",
\"properties\": {
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"MESSAGE RECEIVED RESPONSE\"
],
\"description\": \" Refer to Message Type indicating the usage of this
message. The value MESSAGE RECEIVED RESOPNSE refers to sending a response for
receiving a message from MSGin5G Client\"
},
\"failReason\": {
\"type\": \"string\",
\"description\": \"Refer to the failure reason\"
},
\"result\": {
\"type\": \"string\",
\"enum\": [
\"SUCCESS\",
\"FAILED\"
],
\"description\": \"Refer to the result\"
}
},
\"required\": [
\"result\",
\"msgType\"
]
}
### A.3.2.7 Registration structure
The schema is based on JSON Schema Draft-07 [8]. For reducing the overhead of
the message used in MSGin5G service, the properties are defined as shorten
form and the relationships between the properties and elements used in clause
A.3.1.7 are described in the description of the properties. The JSON schema of
the CoAP POST request for the MSGin5G registration is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\": \"http://www.3gpp.org/MSGin5G/MSGin5G_Registration_request_schema\",
\"title\": \"MSGin5G Registration Request\",
\"type\": \"object\",
\"properties\": {
\"msgIden\": {
\"type\": \"string\",
\"format\": \"uri\",
\"description\": \"Refer to Service identifier of MSGin5G service\"
},
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"REG\"
],
\"description\": \"Refer to the usage of this message. The value REG refers to
MSGin5G Registration\"
},
\"appId\": {
\"type\": \"string\",
\"description\": \"Refer to Application ID\"
},
\"credential\": {
\"type\": \"string\",
\"description\": \"Refer to Credential Information\"
}
},
\"required\": [
\"msgId\",
\"msgType\",
\"l2ID\",
\"appID\",
\"credential\"
]
}
The schema is based on JSON Schema Draft-07 [8]. For reducing the overhead of
the message used in MSGin5G service, the properties are defined as shorten
form and the relationships between the properties and elements used in clause
A.3.1.8 are described in the description of the properties. The JSON schema of
CoAP 2.01 (Created) response or CoAP 2.04 (Change) response for the MSGin5G
registration is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\":
\"http://www.3gpp.org/MSGin5G/MSGin5G_Registration_response_schema\",
\"title\": \"MSGin5G Registration Response\",
\"type\": \"object\",
\"properties\": {
\"result\": {
\"type\": \"boolean\",
\"default\": true,
\"description\": \"Refer to Registration result. The value true refers to
succcess\"
},
\"registration ID\": {
\"type\": \"string\",
\"description\": \"Refer to Regsitration ID\"
},
\"failure reason\": {
\"type\": \"string\",
\"description\": \"Refer to Failure Reason\"
}
},
\"required\": [
\"result\"
]
}
### A.3.2.8 De-registration structure
The schema is based on JSON Schema Draft-07 [8]. For reducing the overhead of
the message used in MSGin5G service, the properties are defined as shorten
form and the relationships between the properties and elements used in clause
A.3.1.9 are described in the description of the properties. The JSON schema of
the CoAP POST request for the MSGin5G de-registration is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\":
\"http://www.3gpp.org/MSGin5G/MSGin5G_Deregistration_request_schema\",
\"title\": \"MSGin5G Deregistration Request\",
\"type\": \"object\",
\"properties\": {
\"msgIden\": {
\"type\": \"string\",
\"format\": \"uri\",
\"description\": \"Refer to Service identifier of MSGin5G service\"
},
\"msgType\": {
\"type\": \"string\",
\"enum\": [
\"DEREG\"
],
\"description\": \"Refer to the usage of this message. The value DEREG refers
to MSGin5G De-registration\"
},
\"registrationID\": {
\"type\": \"string\",
\"description\": \"Refer to Registration ID\"
}
},
\"required\": [
\"msgId\",
\"msgType\",
\"RegistrationID\"
]
}
The schema is based on JSON Schema Draft-07 [8]. For reducing the overhead of
the message used in MSGin5G service, the properties are defined as shorten
form and the relationships between the properties and elements used in clause
A.3.1.10 are described in the description of the properties. The JSON schema
of CoAP 2.01 (Created) response or CoAP 2.04 (Change) response for the MSGin5G
de-registration is defined below:
{
\"\$schema\": \"http://json-schema.org/draft-07/schema#\",
\"\$id\":
\"http://www.3gpp.org/MSGin5G/MSGin5G_Deregistration_response_schema\",
\"title\": \"MSGin5G Deregistration Response\",
\"type\": \"object\",
\"properties\": {
\"result\": {
\"type\": \"boolean\",
\"default\": true,
\"description\": \"Refer to Registration result. The value true refers to
succcess\"
},
\"registration ID\": {
\"type\": \"string\",
\"description\": \"Refer to Registration ID\"
},
\"failure reason\": {
\"type\": \"string\",
\"description\": \"Refer to Failure Reason\"
}
},
\"required\": [
\"result\"
]
}
###### ## Annex X (Informative): IANA UDP port registration form
This annex contains information to be provided to IANA for exchange of CoAP
protocol messages used between MSGin5G clients acting as a realy on UEs UDP
port registration or MSGin5G RelayProtocol (MSGin5GRP). The following
information is to be used to register CoAPRP user port number and service name
in the \"IANA Service Name and Transport Protocol Port Number Registry\" and
specifically \"Service Name and Transport Protocol Port Number Registry\".
This registration form can be found at: https://www.iana.org/form/ports-
services.
+----------------------------------+----------------------------------+ | Assignee Name | \ | +==================================+==================================+ | Assignee E-mail | \ | +----------------------------------+----------------------------------+ | Contact Person | \ | +----------------------------------+----------------------------------+ | Contact E-mail | \ | +----------------------------------+----------------------------------+ | Resources required | Port number and service name | +----------------------------------+----------------------------------+ | Transport Protocols | UDP | +----------------------------------+----------------------------------+ | Service Code | | +----------------------------------+----------------------------------+ | Service Name | MSGin5GRP | +----------------------------------+----------------------------------+ | Desired Port Number | | +----------------------------------+----------------------------------+ | Description | Message Service within the 5G | | | System (MSGin5G) RelayProtocol | | | (MSGin5GRP) is a 3GPP control | | | protocol used by MSGin5G client | | | acting as a relay hosted on a | | | User Equipment (UE) for when the | | | MSGin5G client resides in a UE, | | | which does not have enough | | | capability to communicate with a | | | MSGin5G Server (i.e. a | | | constrained device). MSGin5GRP | | | provides MSGin5G functionality | | | between MSGin5G clients hosted | | | on UEs communicating using IP | | | using a single physical network | | | segment, separated from Internet | | | and any other IP network. The | | | network segment is wireless | | | network segment and UEs are | | | mobile devices. | +----------------------------------+----------------------------------+ | Reference | 3GPP TS 24.538 | +----------------------------------+----------------------------------+ | Defined TXT keys | N/A | +----------------------------------+----------------------------------+ | If broadcast/multicast is used, | The MSGin5G supports group and | | how and what for? | broadcast message delivery for | | | thing-to-thing communication and | | | person-to-thing communication. | | | When performing group calls, the | | | MSGin5G client initiates the | | | group call to an MSGin5G group | | | by sending a group call | | | announcement message based on | | | Service Enabler Architecture | | | Layer for Verticals (SEAL) group | | | management. The group call | | | announcement message is an | | | MSGin5GRP message which is sent | | | as a UDP message to a multicast | | | IP address of the MSGin5G group | | | so that it is ensured that the | | | MSGin5GRP messages sent for the | | | corresponding MSGin5G group are | | | only received by the MSGin5G | | | group\'s members. | +----------------------------------+----------------------------------+ | If UDP is requested, please | The number of MSGin5GRP messages | | explain how traffic is limited, | that need to be sent between | | and whether the protocol reacts | MSGin5GRP clients depends upon | | to congestion. | the number of members of the | | | MSGin5G group. MSGin5GRP employs | | | a message control mechanism | | | which includes a back-off | | | mechanism to defer transmission | | | of another MSGin5GRP message | | | once an MSGin5GRP message is | | | received. MSGin5GRP controls the | | | number of messages transmitted | | | within a certain, configurable | | | amount of time, thus averting | | | congestion. At maximum a few | | | SLMP messages per second are | | | expected in communication | | | between MSGin5GRP clients. | | | MSGin5GRP does not support any | | | reaction to congestion. | +----------------------------------+----------------------------------+ | If UDP is requested, please | MSGin5GRP is not used solely for | | indicate whether the service is | discovery of hosts supporting | | solely for the discovery of | this protocol. | | hosts supporting this protocol. | | +----------------------------------+----------------------------------+ | Please explain how your protocol | MSGin5GRP does not support | | supports versioning. | versioning. | +----------------------------------+----------------------------------+ | If your request is for more than | N/A | | one transport, please explain in | | | detail how the protocol differs | | | over each transport. | | +----------------------------------+----------------------------------+ | Please describe how your | MSGin5GRP does not support | | protocol supports security. Note | security. MSGin5GRP relies on | | that presently there is no IETF | the security mechanisms of the | | consensus on when it is | lower layers. | | appropriate to use a second port | | | for an insecure version of a | | | protocol. | | +----------------------------------+----------------------------------+ | Please explain why a unique port | As a general principle, 3GPP | | assignment is necessary as | protocols use assigned User | | opposed to a port in range | Ports, e.g. GTP-C uses UDP port | | (49152-65535) or existing port. | number 2123, GTP-U uses UDP port | | | number 2152, S1AP uses SCTP port | | | number 36412, X2AP uses SCTP | | | port number 36422, WLCP uses | | | 36411. A dynamic port number | | | (i.e. 49152 to 65535) cannot be | | | used for the MSGin5GRP because | | | of the nature of communication | | | on a single physical network | | | segment, separated from Internet | | | and any other IP network. The | | | requirement of MSGin5GRP to | | | continuously listen for incoming | | | messages needs an always active | | | listener port. There is no local | | | server that is administering the | | | use of emphemeral ports in the | | | MSGin5GRP architecture, so there | | | would be no way for one MSGin5GR | | | client acting as a relay to know | | | that a port is already being | | | used by another MSGin5GRP | | | client. | +----------------------------------+----------------------------------+ | Please explain the state of | Protocol standard definition. No | | development of your protocol. | implementation exists yet. | +----------------------------------+----------------------------------+ | If SCTP is requested, is there | N/A | | an existing TCP and/or UDP | | | service name or port number | | | assignment? If yes, provide the | | | existing service name and port | | | number. | | +----------------------------------+----------------------------------+ | What specific SCTP capability is | N/A | | used by the application such | | | that a user who has the choice | | | of both TCP (and/or UDP) and | | | SCTP ports for this application | | | would choose SCTP? See [RFC | | | 4960] | | | (http://www.iana.org/go/rfc4960) | | | section 7.1. | | +----------------------------------+----------------------------------+ | Please provide any other | This protocol is between the UEs | | information that would be | communicating using IP over a | | helpful in understanding how | single physical network segment, | | this protocol differs from | separated from Internet and any | | existing assigned services | other IP network. MSGin5GRP | | | functionality offered by the | | | MSGin5GRP clients acting as a | | | relay hosted by the UEs is to | | | messaging communication | | | capability in 5GS especially for | | | Massive Internet of Things | | | (MIoT). The need of listening | | | for incoming messages requires | | | an active listener port. | | | | | | This differs from existing | | | protocols in 3GPP where UDP | | | ports have been requested, as | | | those protocols have been either | | | between the UE and network or | | | between network elements. | +----------------------------------+----------------------------------+
#